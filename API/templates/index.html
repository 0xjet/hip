<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Alias Cluster Search API</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="container">
    <h1>Alias Cluster Search API</h1>
    <p class="description">
      This simple web interface allows you to test the <strong>/search</strong> endpoint.
      Enter a name or alias, and the API will return the cluster, direct aliases, and indirect aliases.
    </p>

    <div class="search-box">
      <input type="text" id="query" placeholder="Enter alias, e.g. dragon bridge">
      <button onclick="performSearch()">Search</button>
    </div>

    <div id="result" class="result"></div>

    <section class="docs">
      <h2>How it works</h2>
      <p>The API normalizes your query and searches it in the cluster dataset:</p>
      <ul>
        <li>Removes spaces, underscores, and dashes</li>
        <li>Ignores letter case</li>
        <li>Finds matching clusters containing your query as a name or alias</li>
      </ul>
      <p>Example request:</p>
      <code>http://127.0.0.1:5000/search?query=dragon%20bridge</code>
    </section>
  </div>

  <script>
    async function performSearch() {
      const query = document.getElementById("query").value.trim();
      const resultDiv = document.getElementById("result");
      if (!query) {
        resultDiv.innerHTML = "<p class='error'>Please enter a query.</p>";
        return;
      }

      resultDiv.innerHTML = "<p>Searching...</p>";

      try {
        const response = await fetch(`/search?query=${encodeURIComponent(query)}`);
        const data = await response.json();

        if (!response.ok) {
          resultDiv.innerHTML = `<p class='error'>${data.message || data.error}</p>`;
        } else {
          resultDiv.innerHTML = `
            <h3>Cluster: ${data.cluster}</h3>
            <p><strong>Direct Aliases:</strong> ${data.direct_aliases.join(", ")}</p>
            <p><strong>Indirect Aliases:</strong> ${data.indirect_aliases.join(", ")}</p>
          `;
        }
      } catch (err) {
        resultDiv.innerHTML = `<p class='error'>Error fetching results: ${err.message}</p>`;
      }
    }
  </script>
</body>
</html>
