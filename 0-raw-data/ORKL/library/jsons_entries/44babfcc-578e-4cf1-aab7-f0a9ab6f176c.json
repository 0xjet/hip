{
    "id": "44babfcc-578e-4cf1-aab7-f0a9ab6f176c",
    "created_at": "2023-01-12T15:08:39.19159Z",
    "updated_at": "2025-03-27T02:05:58.397213Z",
    "deleted_at": null,
    "sha1_hash": "8e5f6e9bcb4660b7fa8a477c29ff44b91a360a4d",
    "title": "2017-12-08 - GratefulPOS credit card stealing malware - just in time for the shopping season",
    "authors": "",
    "file_creation_date": "2022-05-27T21:27:23Z",
    "file_modification_date": "2022-05-27T21:27:23Z",
    "file_size": 1623084,
    "plain_text": "# GratefulPOS credit card stealing malware - just in time for the shopping season\n\n**[community.rsa.com/community/products/netwitness/blog/2017/12/08/gratefulpos-credit-card-stealing-malware-just-in-time-for-the-shopping-season](https://community.rsa.com/community/products/netwitness/blog/2017/12/08/gratefulpos-credit-card-stealing-malware-just-in-time-for-the-shopping-season)**\n\nDecember 8, 2017\n\n**_RSA FirstWatch would like to thank the Target Cyber Threat Intelligence & Detection Team for sharing technical insight into the topic_**\n**_of this post._**\n\nWell into the holiday season, people are making their shopping lists, recovering from Black Friday and Cyber Monday, and perhaps\ncontemplating the many things for which they are grateful. Criminals, too, are making their lists, and posturing for the big shopping days\nahead.\n\nThreat researchers are still at work of course, so it was inevitable that FirstWatch contemplated which things credit card stealing criminals-AKA “carders” appreciate. This is what we came up with.\n\n## What carders are thankful for this year\n\n1. Malicious code and techniques shared by other criminal developers\n\n2. Merchants that still use swipe-only Point of Sale (POS) systems\n\n3. Merchants with POS systems that lack Point-to-Point (P2P) encryption of payment card data\n\n4. Merchants that employ antivirus easily bypassed by unsophisticated malware\n\nWith a combination of one or more of these carder’s favorite things, intruders have stolen payment card data associated with millions of\nconsumers (like us), resulting in tens of billions of dollars of losses annually.\n\nWe would like to illustrate a carder’s favorite thing number four with a sample of malware uploaded to the VirusTotal website on Tuesday\nmorning, 21 November 2017, detected by zero out of 65 different antivirus vendors (Figure 1).\n\nFigure 1 Zero detection POS RAM-scraping malware uploaded to VT\n\nCertainly this won’t be the last POS malware not detected (statically and initially, at least) by any antivirus, nor is it the first. Consider the\n[analysis of the zero detection Getmypass POS malware by Nick Hoffman during the holiday season three years ago[ii].](http://securitykitten.github.io/getmypass-point-of-sale-malware/)\n\n“While this isn’t the most advanced POS RAM scraper there is, it’s still capable of bypassing all 55 AV’s used to scan it.”\n\nThree years later, there are now ten more antivirus vendors represented on VirusTotal, whose static scans are still bypassed by this recent\niteration of payment card information stealing malware.\n\nBy their very nature, merchant POS intrusions are rather targeted, and if the minimal barrier to installation of their payment card\ncollector/exfiltrator is an antivirus, merchant intruders so far continue to effectively bypass that minimal barrier.\n\nFirstWatch would like to use this post to expose this particular campaign that unfortunately has been active since at least February of this year,\nwith indications that thousands of credit card numbers from targeted merchants are being exfiltrated to the perpetrators at this very moment.\nWith any luck, we hope to make this perpetrator’s holiday season perhaps a little less enjoyable than yours. Will use some of the tools at our\n\n\n-----\n\neady d sposa, a e y et t ess a d at s s e, to pee to ts be a o\n\nThis malware is a variant of FrameworkPOS, and shares some code with other POS malware families variously known as TRINITY, BlackPOS,\nand BrickPOS, so we have decided to call it GratefulPOS, because, well, tis the season.\n\n## A set it and forget it stealer, not a controller\n\nThis is a tool designed to scrape and exfiltrate payment card information from one or more processes in use by a Windows-based Point of Sale\nsystem, from probably a wide variety of POS vendors. Compiled for x64 architectures, we can assume that this malware is designed to run on\nPOS systems running Windows 7 or later. It has no command and controller capability itself; the perpetrator uses other means of privileged\naccess to install and execute the malware on the target POS systems.\n\nGratefulPOS has the following functions\n\n1. Access arbitrary processes on the target POS system\n\n2. Scrape track 1 and 2 payment card data from the process(es)\n\n3. Exfiltrate the payment card data via lengthy encoded and obfuscated DNS queries to a hardcoded domain registered and controlled by the\nperpetrators, similar to that described by Paul Rascagneres in his analysis of FrameworkPOS in 2014[iii], and more recently by Luis Mendieta\nof Anomoli in analysis of a precursor to this sample[iv].\n\n## GratefulPOS WTF Score\n\n[A high threat score of 80 is computed when GratefulPOS is submitted to RSA What’s This File (https://whatsthisfile.rsa.com, Figure2)](https://whatsthisfile.rsa.com/)\n\nFigure 2 GratefulPOS scores a high 80 on WTF\n\n## NetWitness Endpoint and GratefulPOS\n\nThe GratefulPOS sample was executed on a renamed but otherwise stock Windows x64 VM running NetWitness Endpoint, and analyzed\nthrough the NWE UI.\n\nThe malware installs itself as persistent Windows service, with a legitimate sounding name “TrueType Fonts Management Service” (Figure 3).\n\nFigure 3 GratefulPOS Windows service\n\nCombined risk and Instant Indicators of Compromise (IIOC) score rose significantly from 23 (Figure 4) to 159 (Figure 5) after the malware\ninstallation.\n\n\n-----\n\nFigure 4 NetWitness Endpoint before GratefulPOS execution\n\nFigure 5 NetWitness Endpoint score after GratefulPOS execution and installation\n\nNWE reveals the process memory scraping activity typical of RAM-scraping POS malware, by tracking GratefulPOS’s access to consecutive\nprocesses on the system in the Tracking panel (Figure 6).\n\nFigure 6 GratefulPOS process memory scraping observed in NWE tracking panel\n\n## More credit card numbers, more DNS traffic\n\nGratefulPOS has a simple and efficient method of exfiltrating scraped payment card data to the perpetrator by means of DNS queries to a\nmalicious controlled domain and DNS name server daemon. This method can typically bypass firewall and other enclaving set up on a\nmerchant’s POS network infrastructure because the compromised POS system does not need to communicate directly to the Internet. It can\njust as easily communicate to an internal DNS server on the merchant’s network, which would presumably pass on the payment card data\nencoded in the DNS queries, to the perpetrator.\n\nWe observed the initial DNS “check-in” beacon communication on our test system in NetWitness Packets, that sent information about the\ncompromised system to the perpetrator.\n\nQuery\n\n**44105+ A? 93c61f10.v1702.ping.adm.cdd2e9cde8e8e9cde8e8e9fec4fc.fcfee9fec4c8e9cdc4cde9fefec4.c59dec87ed9dd8d8fa.ns.a193-**\n**108-94-56-deploy-akamaitechnologies.com. (166)**\n\nResponse\n\n**44105 1/0/0 A 96.44.135.70 (182)**\n\n**E...f...<.4.....**\n\n**....5.....w.I...........93c61f10.v1702.ping.adm.cdd2e9cde8e8e9cde8e8e9fec4fc.fcfee9fec4c8e9cdc4cde9fefec4.c59dec87ed9dd8d8fa.ns(a193-**\n**108-94-56-deploy-akamaitechnologies.com**\n\nBeacon communication was to a public DNS server (lower part of Figure 7), however, it could have been to an internal DNS server, further\nhiding its origins on a large enterprise network by the time it leaves the perimeter.\n\n\n-----\n\nFigure 7 GratefulPOS malware initial DNS beacon communication to public DNS server\n\nTo add insult to injury, the domain was not selected at random. It was designed to mimic legitimate DNS queries typically encountered in\nvolume on large enterprise networks, associated with the large Content Delivery Network (CDN) service Akamai. We have reached out to\nAkamai with this information.\n\nWe used NetWitness Packets to observe GratefulPOS perform a web check-in to the malicious name server on port 80. The web server\nresponded with a page that displayed the compromised system’s public IP address (Figure 8).\n\nFigure 8 NetWitness 11 display of GratefulPOS malware web check-in with public IP response in body\n\nIt appears that the malware developer created their own IP information service, perhaps to help them organically track the source and public\nnetwork infrastructure of their targeted POS systems, rather than using one of the many free services available such as ipinfo.io,\nipchicken.com or canihazip.com.\n\nWe also generated a few hundred fake credit card numbers and formatted them as would be encountered on a real POS system, and\nobserved via NetWitness as the payment card information flew out the door via encoded DNS to the still clearly active exfiltration node (Figure\n9).\n\n\n-----\n\nFigure 9 GratefulPOS exfiltrates credit card numbers as observed with NetWitness\n\nCompared to the sample analyzed by Mr. Mendieta of Anomali in 2015, we observed only minor code changes. Instead of the particular\ncampaign specified by “grp” strings, we see “v1702” is the campaign identifier, as displayed in an exfiltration packet (Figure 10).\n\nFigure 10 Encoded Track 1 data with campaign identifier \"v1702\" as observed in NetWitness 11 event analysis\n\n## Implications and Conclusions\n\nAs Paul Rascagneres suggested, this DNS exfiltration method employed by the POS malware is clever. It effectively negates a common POS\nsystem control employed by payment card merchants, which is blocking direct access to the Internet from the POS systems. If the POS\nsystems point to internal DNS servers, this malware should have no problem exfiltrating credit card data en masse without direct connect to\nthe Internet.\n\nKeen visibility of enterprise endpoints and network traffic allows an analyst to detect business and customer-critical threats not otherwise\ndetected by antivirus. Hardware-enabled Point-to-Point encryption of payment card data would prevent RAM scrapers like FrameworkPOS and\nGratefulPOS from working at all. In absence of that, one strategy as mentioned by Mr. Rascagneres from GData includes DNS domain\nwhitelisting of only necessary domains needed for POS function.\n\n## Indicators of Compromise\n\nThe exfiltration domain and current exfiltration DNS server IP address have been added to the RSA FirstWatch C2 Domains and IPs feeds.\n\nTable 1 GratefulPOS Indicators of Compromise\n\nGratefulPOS MD5 9a58657669bb3075c1103e73a8948a56\n\n\n-----\n\nGratefulPOS exfiltration domain a193-108-94-56-deploy-akamaitechnologies.com\n\nCurrent Exfiltration DNS server 96.44.135.70\n\n_[https://wallethub.com/edu/credit-debit-card-fraud-statistics/25725/](https://community.rsa.com/external-link.jspa?url=https%3A%2F%2Fwallethub.com%2Fedu%2Fcredit-debit-card-fraud-statistics%2F25725%2F)_\n\n[ii] [http://securitykitten.github.io/getmypass-point-of-sale-malware/](https://community.rsa.com/external-link.jspa?url=http%3A%2F%2Fsecuritykitten.github.io%2Fgetmypass-point-of-sale-malware%2F)\n\n[iii] [https://www.gdatasoftware.com/blog/2014/10/23942-new-frameworkpos-variant-exfiltrates-data-via-dns-requests](https://community.rsa.com/external-link.jspa?url=https%3A%2F%2Fwww.gdatasoftware.com%2Fblog%2F2014%2F10%2F23942-new-frameworkpos-variant-exfiltrates-data-via-dns-requests)\n\n[iv] [https://www.anomali.com/blog/three-month-frameworkpos-malware-campaign-nabs-43000-credits-cards-from-poi](https://community.rsa.com/external-link.jspa?url=https%3A%2F%2Fwww.anomali.com%2Fblog%2Fthree-month-frameworkpos-malware-campaign-nabs-43000-credits-cards-from-poi)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-12-08 - GratefulPOS credit card stealing malware - just in time for the shopping season.pdf"
    ],
    "report_names": [
        "2017-12-08 - GratefulPOS credit card stealing malware - just in time for the shopping season.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536119,
    "ts_updated_at": 1743041158,
    "ts_creation_date": 1653686843,
    "ts_modification_date": 1653686843,
    "files": {
        "pdf": "https://archive.orkl.eu/8e5f6e9bcb4660b7fa8a477c29ff44b91a360a4d.pdf",
        "text": "https://archive.orkl.eu/8e5f6e9bcb4660b7fa8a477c29ff44b91a360a4d.txt",
        "img": "https://archive.orkl.eu/8e5f6e9bcb4660b7fa8a477c29ff44b91a360a4d.jpg"
    }
}