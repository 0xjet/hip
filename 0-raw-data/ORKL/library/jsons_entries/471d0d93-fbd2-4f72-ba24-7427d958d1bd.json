{
    "id": "471d0d93-fbd2-4f72-ba24-7427d958d1bd",
    "created_at": "2023-01-12T15:01:48.451221Z",
    "updated_at": "2025-03-27T02:09:18.84964Z",
    "deleted_at": null,
    "sha1_hash": "b7dac4cdb5477bfcd040b25cc248d0930b026559",
    "title": "2021-03-09 - Cloud Federated Credential Abuse & Cobalt Strike- Threat Research February 2021",
    "authors": "",
    "file_creation_date": "2022-05-28T23:10:11Z",
    "file_modification_date": "2022-05-28T23:10:11Z",
    "file_size": 115851,
    "plain_text": "# Cloud Federated Credential Abuse & Cobalt Strike: Threat Research February 2021\n\n**[splunk.com/en_us/blog/security/cloud-federated-credential-abuse-cobalt-strike-threat-research-feb-2021.html](https://www.splunk.com/en_us/blog/security/cloud-federated-credential-abuse-cobalt-strike-threat-research-feb-2021.html)**\n\nMarch 9, 2021\n\nSECURITY\n\nBy [Splunk Threat Research Team March 09,](https://www.splunk.com/en_us/blog/author/secmrkt-research.html)\n\n2021\n\n\n-----\n\nThis month, the Splunk Threat Research team developed a total of seven analytic stories\naddressing different types of threats and more than a dozen of new detections to help our\n[customers detect and fight against these threats.](https://www.splunk.com/en_us/customers.html)\n\nIn this blog post, we’ll walk you through two analytic stories and a few detection searches\nthat we want to highlight from the February 2021 releases. Watch the video below to learn\n[more about why Splunk's Rod Soto, Principal Security Research Engineer, and Michael](https://www.splunk.com/en_us/blog/author/rsoto.html)\nHaag, Senior Threat Researcher, think it is important to share their knowledge on emerging\nthreats such as Cloud Federated Credential Abuse and Cobalt Strike.\n\n## Cloud Federated Credential Abuse\n\nThe Cloud Federated Credential Abuse analytic story addresses the recently notorious\ncampaigns featuring tactics, techniques and procedures (TTPs) that target the extraction of\ncredentials in cloud federated environments. These environments are composed by\nfederation-enabling technologies such as Active Directory Federation Services, and these\nfederations can be from inside the perimeter or between cloud vendors.\n\nFederations are based in the flow of trusted credentials. These trusted credentials allow the\nseamless interaction of entities from perimeter to cloud or from cloud to cloud. Current\n[federation credential frameworks such as OAuth2 and](https://oauth.net/2/) [SAML are the most popular in use](https://en.wikipedia.org/wiki/Security_Assertion_Markup_Language)\nbetween federated environments. In this research blog we delve into how these credentials\noperate and how these attacks work within the perimeter and between cloud environments.\n\n[The scenarios addressed in this new analytic story (release v3.15) are the](https://github.com/splunk/security_content/blob/develop/stories/cloud_federated_credential_abuse.yml) [Golden SAML](https://www.cyberark.com/resources/threat-research-blog/golden-saml-newly-discovered-attack-technique-forges-authentication-to-cloud-apps)\nattack and [Pass The Cookie. Specially the Golden SAML scenario, which is reported to be](https://stealthbits.com/blog/bypassing-mfa-with-pass-the-cookie/)\n[one of the attack techniques involved during the SolarWinds campaign. We are including](https://www.darkreading.com/attacks-breaches/solarwinds-campaign-focuses-attention-on-golden-saml-attack-vector/d/d-id/1339794)\ndetection and hunting searches for endpoint and cloud vendors such as AWS and Azure.\n\nWe decided to approach the federation attacks from two different fronts:\n\n**Perimeter: The servers and endpoints where we find the elements to craft forge**\nrequests, including items such as SAML assertions or session cookies, private keys\nand certificates.\n**Cloud provider: The providers of federation services where the extracted credentials**\nare reused.\n\n### Perimeter-Focused Detection Searches\n\n\n**Name** **Technique**\n**ID**\n\n\n**Tactic(s)** **Note**\n\n\n-----\n\n[Certutil exe certificate extraction](https://github.com/splunk/security_content/blob/develop/detections/endpoint/certutil_exe_certificate_extraction.yml) [T1552.004](https://attack.mitre.org/techniques/T1552/004/) Credential access New\ndetection\n\n\nRegistry keys used for privilege\nescalation\n\n\n[T1546.012](https://attack.mitre.org/techniques/T1546/012/) Privilege escalation,\npersistence\n\n\n[Detect Mimikatz using loaded images](https://github.com/splunk/security_content/blob/develop/detections/endpoint/detect_mimikatz_using_loaded_images.yml) [T1003.001](https://attack.mitre.org/techniques/T1003/001/) Credential access\n\n\nDetect Mimikatz via PowerShell and\nevent code 4703\n\n\n[T1003.001](https://attack.mitre.org/techniques/T1003/001/) Credential access\n\n\n### New Cloud-Focused Hunting and Detection Searches\n\n\n**Name** **Technique**\n**ID**\n\n\n**Tactic(s)** **Provider**\n\n\nAWS SAML access by\nprovider user and principal\n\nAWS SAML update identity\nprovider\n\nO365 Excessive SSO logon\nerrors\n\nO365 added service\nprincipal\n\nO365 new federated\ndomain added\n\n## Detecting Cobalt Strike\n\n\n[T1078](https://attack.mitre.org/techniques/T1078/) Defense evasion, persistence,\nprivilege escalation, initial access\n\n[T1078](http://t1078/) Defense evasion, persistence,\nprivilege escalation, initial access\n\n[T1556](https://attack.mitre.org/techniques/T1556/) Credential access, defense\nevasion\n\n\nAWS\n\nAWS\n\nAzure\n\n\n[T1136.003](https://attack.mitre.org/techniques/T1136/003/) Persistence Azure\n\n[T1136.003](https://attack.mitre.org/techniques/T1136/003/) Persistence Azure\n\n\nCobalt Strike is threat emulation software that Red Teams, penetration testers and threat\nactors all use. More recently, adversaries have used cracked or leaked versions to perform\npost exploitation within the target’s environment. In December 2020 we got a rare glimpse\n[into FireEye’s Red Team tools after an actor gained unauthorized access. As a defender,](https://www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html)\n\n\n-----\n\nwe may not always have access to a tool like Cobalt Strike, so we need to research it to\nbetter understand how we may generate our content. With Cobalt Strike comes the ability to\ndeploy what are called Malleable C2 profiles. Each profile is a customization to how the\nbeacon payload will blend in with the network and endpoint. It may be as short or detailed\nas the operator needs. If unable to customize, there are many profiles freely available.\n\n**Functions within the Malleable C2 profile are: spawnto_x86 and spawnto_x64.**\n**Spawnto_ is a process that Cobalt Strike opens to inject shellcode into. The default**\n**spawnto_ process is rundll32.exe.**\n\n**Top five publicly available spawnto values identified in Malleable C2 profiles:**\n\n**spawnto** **count**\n\nrundll32.exe 401\n\ngpupdate.exe 16\n\nsvchost.exe 8\n\nmstsc.exe 6\n\nWerFault.exe 3\n\n**In generating content related to Cobalt Strike, consider the following:**\n\n1. Is it normal for spawnto_ value to have no command line arguments? No command\n\nline arguments and a network connection?\n2. What is the default, or normal, process lineage for spawnto_ value?\n3. Does the spawnto_ value normally make network connections?\n\nContent is currently in active development and much more is to come. We want to help\norganizations of all sizes begin to advance their detection capabilities against Cobalt Strike\nand more.\n\n\n**Name** **Technique**\n**ID**\n\n\n**Tactic** **Note**\n\n\n-----\n\n[Rundll32 with no command line arguments](https://github.com/splunk/security_content/blob/develop/detections/endpoint/suspicious_rundll32_with_no_command_line_arguments.yml) [T1218.011](https://attack.mitre.org/techniques/T1218/011/) Defense\nevasion\n\n[Suspicious rundll32 startw](https://github.com/splunk/security_content/blob/develop/detections/endpoint/suspicious_rundll32_startw.yml) [T1218.011](https://attack.mitre.org/techniques/T1218/011/) Defense\nevasion\n\n[Suspicious MSBuild path/rename](https://github.com/splunk/security_content/blob/develop/detections/endpoint/suspicious_msbuild_path.yml) [T1127.001](https://attack.mitre.org/techniques/T1127/001/) Defense\nevasion\n\n\nSuspicious Microsoft.Workflow.Compiler\n[rename/usage](https://github.com/splunk/security_content/blob/develop/detections/endpoint/suspicious_microsoft_workflow_compiler_rename.yml)\n\n\n[T1127](https://attack.mitre.org/techniques/T1127/) Defense\nevasion\n\n\nNew\ndetection\n\nNew\ndetection\n\nNew\ndetection\n\nNew\ndetection\n\nNew\ndetection\n\n\n[Detect Regsvr32 Application Control Bypass](https://github.com/splunk/security_content/blob/develop/detections/endpoint/detect_regsvr32_application_control_bypass.yml) [T1218.010](https://attack.mitre.org/techniques/T1218/010/) Defense\nevasion\n\n## Why Should You Care?\n\n\nSome of these attack vectors are new and evolving and they seem to emulate past lateral\n[movement techniques such as pass the hash or](https://en.wikipedia.org/wiki/Pass_the_hash) [pass the ticket. Many vendors do not](https://attack.mitre.org/techniques/T1550/003/)\nconsider these attack vectors as vulnerabilities but rather an abuse of features. These types\nof attacks are bound to become more popular as enterprises continue to implement cloud\nservices.\n\nCobalt Strike is the baseline adversary tool we defenders need to ensure we have coverage\nfor moving forward in 2021. With the increasing usage of leaked versions of Cobalt Strike,\ncontent needs to be created to detect and ultimately prevent the capabilities it provides. In\naddition, defenders need to understand what malicious looks like and how to respond to\nactivity related to methodologies using Cobalt Strike.\n\n[For a full list of security content, check out the release notes on Splunk Docs:](https://docs.splunk.com/Documentation/ESSOC)\n\n[3.15.0](https://docs.splunk.com/Documentation/ESSOC/3.15.0/RN/Enhancements)\n[3.14.0](https://docs.splunk.com/Documentation/ESSOC/3.14.0/RN/Enhancements)\n\n## Learn more\n\n[You can find the latest content about security analytic stories on GitHub and in Splunkbase.](https://github.com/splunk/security-content/releases/tag/v3.12.0)\n[Splunk Security Essentials also has all these detections now available via push update.](https://splunkbase.splunk.com/app/3435/)\n\n## Feedback\n\n\n-----\n\nAny feedback or requests? Feel free to put in an Issue on Github and we’ll follow up.\nAlternatively, join us on the [Slack channel #security-research. Follow these instructions If](https://splunk-usergroups.slack.com/)\nyou need an invitation to our Splunk user groups on Slack.\n\n### About the Splunk Threat Research Team\n\nThe Splunk Threat Research team is devoted to understanding actor behavior and\nresearching known threats to build detections that the entire Splunk community can benefit\nfrom. The Splunk Threat Research team does this by building and open-sourcing tools that\n[analyze threats and actors like the Splunk Attack Range and using these tools to create](https://github.com/splunk/attack_range)\nattack data sets. From these data sets, new detections are built and shared with the Splunk\n[community under Splunk Security Content. These detections are then consumed by various](https://github.com/splunk/security-content)\nSplunk products like Enterprise Security, Splunk Security Essentials and Mission Control to\nhelp customers quickly and effectively find known threats.\n\n### Contributors\n\nWe would like to thank Rod Soto, Michael Haag, Patrick Bareiss and Bhavin Patel for their\ncontributions to this post, as well as all of the community contributors who provided\nfeedback and helped generate new security content.\n\nPosted by\n\n**[Splunk Threat Research Team](https://www.splunk.com/en_us/blog/author/secmrkt-research.html)**\n\n\n-----\n\nThe Splunk Threat Research Team is an active part of a customer’s overall defense\nstrategy by enhancing Splunk security offerings with verified research and security content\nsuch as use cases, detection searches, and playbooks. We help security teams around the\nglobe strengthen operations by providing tactical guidance and insights to detect,\ninvestigate and respond against the latest threats. The Splunk Threat Research Team\nfocuses on understanding how threats, actors, and vulnerabilities work, and the team\n[replicates attacks which are stored as datasets in the Attack Data repository.](https://github.com/splunk/attack_data/)\n\nOur goal is to provide security teams with research they can leverage in their day to day\noperations and to become the industry standard for SIEM detections. We are a team of\nindustry-recognized experts who are encouraged to improve the security industry by\nsharing our work with the community via conference talks, open-sourcing projects, and\nwriting white papers or blogs. You will also find us presenting our research at conferences\nsuch as Defcon, Blackhat, RSA, and many more.\n\n[Read more Splunk Security Content.](https://github.com/splunk/security_content)\n\nTAGS\nShow All Tags\n\nShow Less Tags\n\n**Join the Discussion**\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-03-09 - Cloud Federated Credential Abuse & Cobalt Strike- Threat Research February 2021.pdf"
    ],
    "report_names": [
        "2021-03-09 - Cloud Federated Credential Abuse & Cobalt Strike- Threat Research February 2021.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535708,
    "ts_updated_at": 1743041358,
    "ts_creation_date": 1653779411,
    "ts_modification_date": 1653779411,
    "files": {
        "pdf": "https://archive.orkl.eu/b7dac4cdb5477bfcd040b25cc248d0930b026559.pdf",
        "text": "https://archive.orkl.eu/b7dac4cdb5477bfcd040b25cc248d0930b026559.txt",
        "img": "https://archive.orkl.eu/b7dac4cdb5477bfcd040b25cc248d0930b026559.jpg"
    }
}