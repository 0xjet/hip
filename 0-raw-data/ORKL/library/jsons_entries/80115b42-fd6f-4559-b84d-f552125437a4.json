{
    "id": "80115b42-fd6f-4559-b84d-f552125437a4",
    "created_at": "2023-01-12T15:09:06.765037Z",
    "updated_at": "2025-03-27T02:09:50.953849Z",
    "deleted_at": null,
    "sha1_hash": "8d6aef291c8bccda20f9df786369b35f24786d07",
    "title": "2019-11-05 - Try not to stare - MedusaLocker at a glance",
    "authors": "",
    "file_creation_date": "2022-05-28T01:28:07Z",
    "file_modification_date": "2022-05-28T01:28:07Z",
    "file_size": 1762667,
    "plain_text": "# Try not to stare - MedusaLocker at a glance\n\n**[dissectingmalwa.re/try-not-to-stare-medusalocker-at-a-glance.html](https://dissectingmalwa.re/try-not-to-stare-medusalocker-at-a-glance.html)**\n\nTue 05 November 2019 in [Ransomware](https://dissectingmalwa.re/category/ransomware.html)\n\nMystic but also a new(-ish) threat: Medusa ransomware. Let's take a quick peek, but don't look too close or\nyou may need to fetch backups soon.\n\n**_A general disclaimer as always: downloading and running the samples linked below will lead to the_**\n**_encryption of your personal data, so be f$cking careful. Also check with your local laws as owning_**\n**_malware binaries/ sources might be illegal depending on where you live._**\n\n[medusa.exe @ AnyRun -->](https://app.any.run/tasks/75bbf936-ab86-4a02-9512-290d130f4c2c/) `sha256`\n```\n3a5b015655f3aad4b4fd647aa34fda4ce784d75a20d12a73f8dc0e0d866e7e01\n\n```\n[dix_16.exe @ HybridAnalysis -->](https://www.hybrid-analysis.com/sample/49da42d00cc3ad6379ead2e07fd5f09bd358b144a6e78aad4bb1a8298e2bb568) `sha256`\n```\n49da42d00cc3ad6379ead2e07fd5f09bd358b144a6e78aad4bb1a8298e2bb568\n\n```\n[Taking a look at the stringdump that stringsifter produced one of the first things that stood out was this](https://github.com/fireeye/stringsifter)\nbase64 encoded image:\n\n\n-----\n\nAfter decoding it we get an image of a medieval pest doctor. Fun fact: They wore these masks because\nthey thought it would protect them from the black death. One day someone will probably start selling these\nfor endpoint protection.\n\nAnother interesting extracted string is this PDB-Path:\n_C:\\Users\\Gh0St\\Desktop\\MedusaLockerInfo\\MedusaLockerProject\\MedusaLocker\\Release\\MedusaLocker.pdb_\n\nRunning it through Detect it easy returns that MedusaLocker was built with Visual C++ and a (in malwareterms) relatively new Linker Version.\n\nEntropy-wise it doesn't look like this sample is packed and the sections found don't look out of the ordinary\neither.\n\n\n-----\n\nAfter digging around in Ghidra for a bit I found FUN_00405bc0 which seems to be the main program\nroutine of MedusaLocker. The strings shown here match the output in the debug console present in the\nsecond sample discussed below.\n\nYet another mysterious CLSID that I can't make sense of at the moment: {8761ABBD-7F85-42EE-B272A76179687C63}. Search results referencing it are around since October 21st and might make tracking\nMedusa a bit easier.\n\n\n-----\n\n[Next up the Locker will \"initialize the crypto module\" which uses CryptGenKey provided by WinCrypt to](https://docs.microsoft.com/en-us/windows/win32/api/wincrypt/nf-wincrypt-cryptgenkey)\nderive a keypair. I'll have a closer look at the encryption routine later.\n\nIt will skip files with the following suffixes:\n```\nexe, dll, sys, ini, lnk, rdp, encrypted\n\n```\nAs it is very popular with Ransomware to disable the Automatic Startup Repair and delete System Restore\nPoints plus shadow copies Medusa will do so as well. After that it will also relanch LanmanWorkstation to\nensure that mapped network drives are available.\n\n\n-----\n\nAfter the \"Adding to Autoload\" debug message it will rename itself to svchost.exe and add it's Registry Key\nto the System startup.\n\n\n-----\n\nMedusaLocker will try to terminate the following processes by their name. The List contains Security\nSoftware as well as Services commonly used in productive environments such as SQL or Webservers.\n```\nwrapper, DefWatch, ccEvtMgr, ccSetMgr, SavRoam, sqlservr, sqlagent, sqladhlp, Culserver, RTVscan,\nsqlbrowser, SQLADHLP, \nQBIDPService, Intuit.QuickBooks.FCS, QBCFMonitorService, sqlwriter, msmdsrv, tomcat6,\nzhudongfangyu, SQLADHLP, \nvmware-usbarbitator64, vmware-converter, dbsrv12, dbeng8wxServer.exe, wxServerView, sqlservr.exe,\nsqlmangr.exe, \nRAgui.exe, supervise.exe, Culture.exe, RTVscan.exe, Defwatch.exe, sqlbrowser.exe, winword.exe,\nQBW32.exe, QBDBMgr.exe, \nqbupdate.exe, QBCFMonitorService.exe, axlbridge.exe, QBIDPService.exe, httpd.exe, fdlauncher.exe,\nMsDtSrvr.exe, \ntomcat6.exe, java.exe, 360se.exe, 360doctor.exe, wdswfsafe.exe, fdlauncher.exe, fdhost.exe,\nGDscan.exe, ZhuDongFangYu.exe\n\n```\nIt also copies itself to %APPDATA% after renaming to executable to \"svchostt.exe\".\n\nTo check if an instance of MedusaLocker previously ran on the system it will create a Registry Key at\n\n```\nHKEY_CURRENT_USER\\Software\\Medusa\n\n```\n\nFurthermore it tries to read the State of EnableLinkedConnections via\n**RegOpenKeyExW(HKEY_LOCAL_MACHINE,**\n**L\"SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\" ... and enables the key if**\nnecessary since Medusa tries to encrypt Shared Network Drives and removeable Media as well.\n\n\n-----\n\nAfter terminating the encryption loop the Ransomware will wait for 60 seconds and start a new scan to\ncheck for new unencrypted files.\n\nRunning MedusaLocker in a VM yields us this UAC Prompt with a mysterious CLSID ({3E5FC7F9-9A51_[4367-9063-A120244FBEC7}). A quick google search brings us to Wikileaks Page for the CIA Vault7 leaks](https://wikileaks.org/ciav7p1/cms/page_13762807.html)_\nand the ID seems to be corresponding to cmstplua.dll. Turns out this is an UAC bypass known and\n[implemented since August 2017 (mentioned here).](https://twitter.com/hfiref0x/status/897662607544508417)\n\nThe Ransomnote (which is dropped in every directory that contains files to encrypt) is delivered as a HTML\nfile. In this early sample they seem to have messed up their text alignment. This was fixed in a later version\n(see below) and will make it easier to identify new samples as they may appear.\n\n\n-----\n\nLooking at the section list compared to the\n\n\n-----\n\nThis sample seems to have an enabled debug console which allows us to trace the steps of the infection.\n\nBelow you can see the new ransomnote. The Protonmail E-Mail address was exchanged for a cock.li one\nand the Victim ID blob was fitted to the textbox.\n\n\n-----\n\nBleepingComputer Forum User ttrifonov who was hit by the ransomware as well found suspicious files on\nhis Desktop after the Infection took place. Fortunately for us Medusa skipped the executables.\n\n\n-----\n\nThis would be a huge discovery infection vector-wise as this looks like the attacker gained access to the\nmachine via RDP. (Yet another proof [if we would need any] that RDP exposed to the internet isn't a good\nidea)\n\nLooks like the attacker left a few files related to Mimikatz as well...\n\nAs I mentioned earlier the keypair is generated via CryptGenKey. I'm still trying to map out all the actions on\nthe key material.\n\n\n-----\n\n[The encryption itself is done via the CryptEncrypt function. It seems to use AES for the files and then](https://docs.microsoft.com/en-us/windows/win32/api/wincrypt/nf-wincrypt-cryptencrypt)\nencrypts the key with a RSA-2048 public key that is stored via a keyblob in the executable.\n\n\n-----\n\n-----\n\n[After the encryption routine is done the generated hKey is deleted via CryptDestroyKey.](https://docs.microsoft.com/en-us/windows/win32/api/wincrypt/nf-wincrypt-cryptdestroykey)\n\n## Update 23.11.2019:\n\nNow I want to take a closer look at the files left by the attacker on the Victim's Desktop as it was reported\nmultiple times on the BleepingComputer Forum. Besides the Mimikatz files in the kamikadze directory there\n[is a semi-legit tool called \"Advanced Port Scanner\" (AnyRun, which is basically just a garbage Zenmap](https://app.any.run/tasks/727e8b8d-48ee-40cb-9c19-171ed5c32431)\n[alternative for Windows people) and another one called \"NetworkShare.exe\" (AnyRun, seems to scan for](https://app.any.run/tasks/bfa0580d-7e16-4ea0-ab44-685f62ab9bd5)\nreachable network shares and tries to mount them).\n\nIt also looks like there's a dedicated version of MedusaLocker for Windows XP called dix_16_xp.exe. As\nyou can see below the Debug Messages start with [LockerXP] instead of [Locker].\n\n\n-----\n\n### The Decryptor ðŸ§\n\nThe Decryptor is delivered per Machine with a 4 letter filename indicating to which victim ID it belongs.\n\n\n-----\n\n## IOCs\n\n### Medusa (SHA256)\n```\nmedusa.exe --> SHA256: 3a5b015655f3aad4b4fd647aa34fda4ce784d75a20d12a73f8dc0e0d866e7e01\n        SSDEEP:\n12288:f+IZ+bobAyYFJPrsU4VwryxjpBx8ajiOhA8tsV1YRbRb7:2++EMyYFJPoUecOh8aWdD1UB7 \ndix_16.exe --> SHA256: 49da42d00cc3ad6379ead2e07fd5f09bd358b144a6e78aad4bb1a8298e2bb568\n        SSDEEP:\n24576:nJC1YAOp0eRaNaQgxPubcoiukAby3LV1jqjx9/WBRQ/8PxS//lTQKJfF27:nw1OfMGxRoiuWZ1jUx9qrS3lsC27 \ndix_16_xp.exe --> SHA256: 6c7eda3f5e9bbc685b0eefde2a51f0ccb06ad33805e617876a5124410cac9945\n         SSDEEP:\n24576:Sx7USQ2bEdBF4XUCAdbpH7KYlvnIVGDDUWuXrO0VY/QjFdIkyoRn:MISXu5C47KMIaDWVY/QZdjpB\n\n E-Mail Addresses\nCtorsenoria@tutanota[.]com\nFolieloi@protonmail[.]com\nmrromber@cock[.]li\nmrromber@tutanota[.]com\nsambolero@tutanoa[.]com\nrightcheck@cock[.]li \nfartcool@protonmail[.]ch\nbestcool@keemail[.]me\ntanoss@protonmail[.]com\nsypress@protonmail[.]com\n\n Associated Files\n\n```\n\n-----\n\n```\nHOW_TO_OPEN_FILES.html\nAdvanced Port Scanner 2.4.2750.exe\nd_upd1008.exe\nNetworkShare_pre2.exe\nPsExec64.exe (legitimate)\nPsExec.exe (legitimate)\nb.bat\nNetworkShare.exe\nkamikadze/32.exe\nkamikadze/64.exe\nkamikadze/64_log.txt\nkamikadze/dump.bat\nkamikadze/mimidrv (2).sys\nkamikadze/mimilib (2).dll\nkamikadze/86_log.txt\nkamikadze/mimidrv.sys\nkamikadze/mimilib.dll\n\n### Registry Keys\nHKCU\\SOFTWARE\\Medusa\nHKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\ --> EnableLinkedConnections = 1\nHKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System -->\nConsentPromptBehaviorAdmin = 5\nHKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System --> EnableLUA = 1\n\n Ransomnote\n\n```\n\n-----\n\n```\n  y yp\nWhat happened?\nYour files are encrypted, and currently unavailable.\nYou can check it: all files on you computer has new expansion.\nBy the way, everything is possible to recover (restore), but you need to buy a unique decryptor.\nOtherwise, you never cant return your data.\nFor purchasing a decryptor contact us by email:\nmrromber@cock.li\nIf you will get no answer within 24 hours contact us by our alternate emails:\nmrromber@tutanota.com\nWhat guarantees?\nIts just a business. If we do not do our work and liabilities - nobody will not cooperate with us.\nTo verify the possibility of the recovery of your files we can decrypted 1 file for free.\nAttach 1 file to the letter (no more than 10Mb). Indicate your personal ID on the letter:\n54E87CD3C1529DD06EB22FF80C49B5374ABB8E5B30D06E13BBE2E81411234A20DF1ADA53FDA68BD6294C96DAC3049B4BDC5\nFE764BF468AF1A029B41162759D6164EB0652E95D3FAE3939773B505073E6090079C9C9243EE8B96AEB41A43B787B47DD01\n425E042C6CBDE89BB5F2E7F9CC6601BD9430E87B42A56BEEFF207F20F9E4E5E48FA3274AE0DE8D65EEC0F2BA2CC4AECB22A\n6FD2B21FF152A6A11BD86D063A965C1571078A439C97D52215738104F7B6EF7415CC4A2C03260BCB9A84E71E08832687477\n39CFF3002697B8AD04E01A6B6DC0A460F4273778429962A7AEECEE3BA16A577A6B1D6B67A7FAEFA5C9CB8BBCEFEDC3FF6B0\nBE5D37B69B42BBEE2EA0D00C7439858D2D9BD4A57B47F3E05EBF913F5FAB195AF0575DD345E84347A82010CDC4C0507C986\nC61ED4091E4155585A687EAB73CBEA8ADA7B93B5EB67877CDD0E35C9116B8DCADD2038C4EEAC42302F3B787E54F8AD24012\nA89B3C32252BD438399FAE630A1E099E9D130E7EA7E042841B468FF00FCF86B9C07C054827EE76956211CE70FEB686EC199\n34C96D1D35DD713CA33774C4D5D0\nAttention!\n- Attempts of change files by yourself will result in a loose of data.\n- Our e-mail can be blocked over time. Write now, loss of contact with us will result in a loose of\ndata.\n- Use any third party software for restoring your data or antivirus solutions will result in a\nloose of data.\n- Decryptors of other users are unique and will not fit your files and use of those will result in\na loose of data.\n- If you will not cooperate with our service - for us, its does not matter. But you will lose your\ntime and data, cause just we have the private key.\n\n```\nMedusa Icon made by Freepik from www.flaticon.com\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-11-05 - Try not to stare - MedusaLocker at a glance.pdf"
    ],
    "report_names": [
        "2019-11-05 - Try not to stare - MedusaLocker at a glance.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "23dfc9f5-1862-4510-a6ae-53d8e51f17b1",
            "created_at": "2024-05-01T02:03:08.146025Z",
            "updated_at": "2025-03-27T02:05:17.420497Z",
            "deleted_at": null,
            "main_name": "PLATINUM TERMINAL",
            "aliases": [
                "Longhorn ",
                "The Lamberts ",
                "Vault7 ",
                "APT-C-39 "
            ],
            "source_name": "Secureworks:PLATINUM TERMINAL",
            "tools": [
                " Assassin",
                " Marble Framework",
                "AfterMidnight"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "b69037ec-2605-4de4-bb32-a20d780a8406",
            "created_at": "2023-01-06T13:46:38.790766Z",
            "updated_at": "2025-03-27T02:00:02.919758Z",
            "deleted_at": null,
            "main_name": "MUSTANG PANDA",
            "aliases": [
                "TEMP.HEX",
                "TA416",
                "TANTALUM",
                "Twill Typhoon",
                "Earth Preta",
                "Stately Taurus",
                "LuminousMoth",
                "Polaris",
                "BRONZE PRESIDENT",
                "HoneyMyte",
                "Red Lich"
            ],
            "source_name": "MISPGALAXY:MUSTANG PANDA",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "9baa7519-772a-4862-b412-6f0463691b89",
            "created_at": "2022-10-25T15:50:23.354429Z",
            "updated_at": "2025-03-27T02:00:55.45162Z",
            "deleted_at": null,
            "main_name": "Mustang Panda",
            "aliases": [
                "Mustang Panda",
                "TA416",
                "RedDelta",
                "BRONZE PRESIDENT"
            ],
            "source_name": "MITRE:Mustang Panda",
            "tools": [
                "Cobalt Strike",
                "RCSession",
                "NBTscan",
                "PoisonIvy",
                "PlugX"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "2ee03999-5432-4a65-a850-c543b4fefc3d",
            "created_at": "2022-10-25T16:07:23.882813Z",
            "updated_at": "2025-03-27T02:02:10.0116Z",
            "deleted_at": null,
            "main_name": "Mustang Panda",
            "aliases": [
                "Bronze President",
                "Camaro Dragon",
                "Earth Preta",
                "HoneyMyte",
                "Mustang Panda",
                "Operation SMUGX",
                "Operation SmugX",
                "PKPLUG",
                "Red Lich",
                "Stately Taurus",
                "TEMP.Hex"
            ],
            "source_name": "ETDA:Mustang Panda",
            "tools": [
                "9002 RAT",
                "AdFind",
                "Agent.dhwf",
                "Agentemis",
                "CHINACHOPPER",
                "China Chopper",
                "Chymine",
                "ClaimLoader",
                "Cobalt Strike",
                "CobaltStrike",
                "DCSync",
                "DOPLUGS",
                "Darkmoon",
                "Destroy RAT",
                "DestroyRAT",
                "Farseer",
                "Gen:Trojan.Heur.PT",
                "HOMEUNIX",
                "Hdump",
                "HenBox",
                "HidraQ",
                "Hodur",
                "Homux",
                "HopperTick",
                "Hydraq",
                "Impacket",
                "Kaba",
                "Korplug",
                "LadonGo",
                "MQsTTang",
                "McRAT",
                "MdmBot",
                "Mimikatz",
                "NBTscan",
                "NetSess",
                "Netview",
                "Orat",
                "POISONPLUG.SHADOW",
                "PUBLOAD",
                "PVE Find AD Users",
                "PlugX",
                "Poison Ivy",
                "PowerView",
                "QMAGENT",
                "RCSession",
                "RedDelta",
                "Roarur",
                "SPIVY",
                "ShadowPad Winnti",
                "SinoChopper",
                "Sogu",
                "TIGERPLUG",
                "TONEINS",
                "TONESHELL",
                "TVT",
                "TeamViewer",
                "Thoper",
                "TinyNote",
                "WispRider",
                "WmiExec",
                "XShellGhost",
                "Xamtrav",
                "Zupdax",
                "cobeacon",
                "nbtscan",
                "nmap",
                "pivy",
                "poisonivy"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536146,
    "ts_updated_at": 1743041390,
    "ts_creation_date": 1653701287,
    "ts_modification_date": 1653701287,
    "files": {
        "pdf": "https://archive.orkl.eu/8d6aef291c8bccda20f9df786369b35f24786d07.pdf",
        "text": "https://archive.orkl.eu/8d6aef291c8bccda20f9df786369b35f24786d07.txt",
        "img": "https://archive.orkl.eu/8d6aef291c8bccda20f9df786369b35f24786d07.jpg"
    }
}