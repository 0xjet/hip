{
    "id": "f07b34ad-c1a3-401f-9540-979ae7bb459d",
    "created_at": "2023-01-12T15:06:18.436574Z",
    "updated_at": "2025-03-27T02:08:59.026931Z",
    "deleted_at": null,
    "sha1_hash": "169e5f198757ccd6f72aed0bdaa2c5b2d7bf831a",
    "title": "2021-03-15 - JavaScript sniffers' new tricks- Analysis of the E1RB JS sniffer family",
    "authors": "",
    "file_creation_date": "2022-05-28T17:05:42Z",
    "file_modification_date": "2022-05-28T17:05:42Z",
    "file_size": 2575816,
    "plain_text": "# JavaScript sniffers' new tricks: Analysis of the E1RB JS sniffer family\n\n**group-ib.com/blog/e1rb**\n\n15.03.2021\n\n\n-----\n\n**Victor Okorokov**\n\nLead Threat Intelligence analyst at Group-IB\n\nIn January 2021, Group-IB analysts came across a new JS sniffer family. While analyzing\ntwo infected websites, they found two similar samples that used unusual anti-detection\ntechniques. Both samples had a unique hash for each request: when a victim visited an\ninfected online store, the JS sniffer injector uploaded the JS sniffer main script, which\nrepresented a unique sample with unique obfuscated data and the names of all variables\nand functions. In one of the samples, the threat actor used time-based obfuscation: part of\nthe key in the obfuscation mechanism was the value of the minutes when the attacker's\n\n\n-----\n\nwebsite, which hosted the JS sniffer payload, received the request. After analyzing the code\nand studying the deobfuscation logic, Group-IB analysts found that both samples were\nsimilar and only differed by the gates for collecting stolen credentials. Both samples analyzed\nbelonged to the JS sniffer family that Group-IB named E1RB. Judging from the code\nspecificities, this JS sniffer family is based on Grelos JS sniffer family, used by many\ncybercriminal groups.\n\n**First E1RB sample**\n\nIn the first case, the infection starts after a small piece of code is injected into the HTML code\nof a compromised website (Picture 1).\n\n_Picture 1: Malicious injector for downloading another payload_\n\nThis small piece of code is a modified sample of a legitimate snippet designed to load a\nGoogle Analytics script (Picture 2).\n\n_Picture 2: Legitimate Google Analytics injector_\n\nDue to this modification, instead of loading the legitimate library the malicious injector checks\nwhether there is a \"onepage\" keyword in the user's location address, which would indicate\nthat the user visited the checkout page. If so, the injector loads the malicious script for\nstealing bank card information from URL google-analitics[.]org/diem/stat.\n\nThe first part of the injected script is designed to replace a payment form: a fake one is\nstored as Base64-encoded data in the script in the \"val\" variable (Picture 3).\n\n_Picture 3: Code for replacing the original payment form with the fake one_\n\n\n-----\n\nAfter decoding Base64 data, Group-IB analysts obtained the HTML code of the fake form\nthat was used to collect bank card information and that replaced the original payment form\n(Picture 4).\n\n_Picture 4: Fake payment form used in the JS sniffer_\n\nThe second part of the injected script collects bank card information. It is obfuscated and\ncontains a deobfuscation function. The obfuscation/deobfuscation mechanism uses current\ntime: when the attacker's server receives a request of the JavaScript sniffer script, it\nobfuscates the script source code using the minute value of the request time. When the\nscript is ready to be executed, it is deobfuscated using the getUTCMinutes() function, which\nreturns value in minutes of the current time (Picture 5).\n\nAn interesting fact about this script is that, for each request, the names of functions and\nvariables are unique: the server-side script renames the names with random strings. As\nsuch, for each request the malicious script has a unique fingerprint.\n\n\n-----\n\n_Picture 5: Code to deobfuscate the main part of the JS sniffer source code_\n\nAfter the deobfuscation, we get a clean script designed to collect the customer's bank card\ninformation on the infected website of the online store during checkout.\n\nMalicious script uses the URL address hXXps://google-analitics[.]org/diem/track as a gate.\nAll collected bank cards are sent there (Picture 6).\n\n_Picture 6: Part of the final JS payload with the gate for collecting stolen data_\n\nThe script collects information from the following elements: input, select, text area, checkbox,\nand button (Picture 7).\n\n\n-----\n\n_Picture 7: Part of the JS sniffer for collecting bank card information_\n\nAll the collected information is encoded and then sent to the gate address using a HTTP\nPOST request (Picture 8).\n\n_Picture 8: Part of the JS sniffer for sending collected payment information_\n\nAn analysis of the final payload used to steal customer bank cards showed that, in this case,\nthe attackers used a modified version of the Grelos JavaScript sniffer. Variations of Grelosbased sniffers are used by many groups, including UltraRank, which used it in its earliest\nattacks in 2015. Group-IB named this variation of the Grelos JS sniffer E1RB, after the name\nof the main object in the sniffer source code.\n\n**Second sample**\n\n\n-----\n\nThe second infection starts with a similar snippet of a modified Google Analytics injector. The\nmodified Google Analytics script searches for string \"onestepcheckout\" in the user's address\nand if the search returns \"true\", the script loads a JavaScript sniffer from the URL address\ncdn-gstat[.]com/thredzonline/script.\n\n_Picture 9: Malicious injector for downloading the JS sniffer_\n\nThe downloaded script (Picture 10) uses another obfuscation mechanism, however. In this\ncase, the attackers again used a server-side script for creating unique JS sniffer samples.\nWith each request, the server re-obfuscates the script with new names of functions and\nvariables.\n\n_Picture 10: Script downloaded by the injector_\n\nAfter cleaning up the script text, Group-IB analysts uncovered the deobfuscation algorithm\n(Picture 11). This variant uses a similar snippet for replacing the original payment form with a\nfake one, stored as Base64-encoded data.\n\n\n-----\n\n_Picture 11: Function for the deobfuscation of the JS sniffer source code_\n\nAfter decoding we get the final payload, which is designed to replace the original payment\nform with a fake form, collect bank card information from it, and send any data collected to\nthe attacker's gate using the URL hXXps://cdn-gstat[.]com/thredzonline/data (Picture 12).\n\nThe decoded payload is another sample of a Grelos-based JS sniffer of the E1RB family,\nwhich is similar to the JS sniffer detected in the first previous of this investigation. As in the\nprevious case, it uses the \"val\" variable for storing Base64-encoded HTML code of the fake\npayment form.\n\n_Picture 12: Part of the E1RB sniffer source code with the Base64-encoded fake form and the_\n_gate address_\n\n**Analysis of infrastructure**\n\n\n-----\n\n[According to an analysis using the Group-IB Graph Network, the domain name google-](https://www.group-ib.com/ti/graph.html)\nanalitics[.]org was created using the email address alexey_rublev@protonmail.ru. The same\naddress was used to create cdn-host[.]org.\n\nAt the same time, a similar email address, alexey_rublev@protonmail.com, was used for four\nother domain names:\n\n- telrshop[.]com\n\n- jquery-live[.]com\n\n- cdn-gstat[.]com\n\n- jquery-on[.]com\n\nAs such, during their attacks the cybercriminals behind the E1RB JavaScript sniffer created 6\nunique domain names for storing malicious files and collecting stolen bank card information.\nWhile 4 of these domain names use well-known legitimate brands like jQuery and Google\nAnalytics, the domain name telrshop[.]com caught our attention. We found that \"Telr\" is the\nlegitimate brand belonging to a Dubai-based payment gateway that recently launched its\nown platform for building e-commerce websites (the original website is\n[https://www.telrshops.com/). We can therefore assume that threat actors prepared this fake](https://www.telrshops.com/)\ndomain name for the attacks on websites created using the Telr platform.\n**Recommendations**\n\n**For issuing banks**\n\n- Notify users of possible risks in the online payment process when using bank cards.\n\n- If payment cards related to your bank have been compromised, block these cards and\nnotify the users that the eCommerce store has been infected with a payment card sniffer.\n\n- Receive first-hand reports about compromised card sales on the Dark web. Check for the\ncards issued by the bank in the DBs for sale.\nTo access unique closed sources, and improve your visibility into the underground card\n[shops you may use Group-IB Threat Intelligence & Attribution](https://www.group-ib.com/intelligence-attribution.html)\n\n- Prevent fraud with stolen credit cards and protect your customers' digital identity. An\nexample of such a solution is the\n\n**[Group-IB Fraud Hunting Platform](https://www.group-ib.com/fraud-hunting-platform.html)**\n\n**For eCommerce websites administrators**\n\n\n-----\n\n- Use complex and unique passwords to access the website s admin panel and any services\nused for administration, for example phpMyAdmin, Adminer. If possible, set up two-factor\nauthentication.\n\n- Install all necessary updates for the software used, including CMS of websites. Do not use\noutdated or unsupported versions of the CMS. This will help to reduce the risk of servers\nbeing compromised and make it more difficult for an attacker to download the web shell and\ninstall malicious code.\n\n- Regularly check the store for malware and conduct regular security audits of your website.\nFor example, for websites based on CMS Magento, you can use Magento Security Scan\nTool.\n\n- Conduct **[complex security assessment of your website to discover all possible](https://www.group-ib.com/security-assessment.html)**\nvulnerabilities, get information about existing exploits, and receive in-depth\nrecommendations to eliminate them.\n\n- Use the appropriate systems to log all changes that occur on the website, as well as to log\naccess to the website's control panel and database and track file change dates. This will help\nyou to detect website files infected with malicious code, as well as track unauthorized access\nto the website or web server.\n\n**For payment systems/payment processing banks**\n\n- If you provide payment services for eCommerce websites, regularly inform your customers\nabout basic security measures when accepting online payments on the websites, as well as\nthe threat of JavaScript sniffers.\n\n- Ensure that your services use a correctly configured Content Security Policy.\n\n\n-----\n\n[Lear more about Group-IB's Security Assessment,](https://www.group-ib.com/security-assessment.html) [Threat Intelligence & Attribution, and](https://www.group-ib.com/intelligence-attribution.html)\n[Fraud Hunting Platform on our](https://www.group-ib.com/fraud-hunting-platform.html) [website.](https://www.group-ib.com/)\n**Indicators of compromise**\n\n- jquery-live[.]com\n\n- jquery-on[.]com\n\n- cdn-gstat[.]com\n\n- cdn-host[.]org\n\n- google-analitics[.]org\n\n- telrshop[.]com\n\nShare\n\nReceive insights on the latest cybercrime trends\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-03-15 - JavaScript sniffers' new tricks- Analysis of the E1RB JS sniffer family.pdf"
    ],
    "report_names": [
        "2021-03-15 - JavaScript sniffers' new tricks- Analysis of the E1RB JS sniffer family.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "d802a34a-fcca-484e-8b12-1f0c721fccbe",
            "created_at": "2022-10-25T16:07:24.35515Z",
            "updated_at": "2025-03-27T02:02:10.187236Z",
            "deleted_at": null,
            "main_name": "UltraRank",
            "aliases": [],
            "source_name": "ETDA:UltraRank",
            "tools": [
                "SnifLite"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535978,
    "ts_updated_at": 1743041339,
    "ts_creation_date": 1653757542,
    "ts_modification_date": 1653757542,
    "files": {
        "pdf": "https://archive.orkl.eu/169e5f198757ccd6f72aed0bdaa2c5b2d7bf831a.pdf",
        "text": "https://archive.orkl.eu/169e5f198757ccd6f72aed0bdaa2c5b2d7bf831a.txt",
        "img": "https://archive.orkl.eu/169e5f198757ccd6f72aed0bdaa2c5b2d7bf831a.jpg"
    }
}