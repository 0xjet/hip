{
    "id": "7d444f4e-b01e-4695-b175-b2e8ee8d3602",
    "created_at": "2023-01-12T15:08:02.415975Z",
    "updated_at": "2025-03-27T02:05:56.856275Z",
    "deleted_at": null,
    "sha1_hash": "50eb6258761b85e95e619c4088d03b3191a37e84",
    "title": "2022-04-08 - New SolarMarker (Jupyter) Campaign Demonstrates the Malware’s Changing Attack Patterns",
    "authors": "",
    "file_creation_date": "2022-05-27T22:56:09Z",
    "file_modification_date": "2022-05-27T22:56:09Z",
    "file_size": 3473054,
    "plain_text": "# New SolarMarker (Jupyter) Campaign Demonstrates the Malware’s Changing Attack Patterns\n\n**unit42.paloaltonetworks.com/solarmarker-malware/**\n\nShimi Cohen, Inbal Shalev, Irena Damsky April 9, 2022\n\nBy [Shimi Cohen,](https://unit42.paloaltonetworks.com/author/shimi-cohen/) [Inbal Shalev and](https://unit42.paloaltonetworks.com/author/inbal-shalev/) [Irena Damsky](https://unit42.paloaltonetworks.com/author/irena-damsky/)\n\nApril 8, 2022 at 6:00 PM\n\n[Category: Malware](https://unit42.paloaltonetworks.com/category/malware-2/)\n\nTags: [backdoor,](https://unit42.paloaltonetworks.com/tag/backdoor/) [C2,](https://unit42.paloaltonetworks.com/tag/c2/) [Cortex,](https://unit42.paloaltonetworks.com/tag/cortex/) [Infostealer,](https://unit42.paloaltonetworks.com/tag/infostealer/) [Jupyter,](https://unit42.paloaltonetworks.com/tag/jupyter/) [Polazert,](https://unit42.paloaltonetworks.com/tag/polazert/) [SolarMarker,](https://unit42.paloaltonetworks.com/tag/solarmarker/) [WildFire,](https://unit42.paloaltonetworks.com/tag/wildfire/) Yellow\nCockatoo\n\nThis post is also available in: 日本語 [(Japanese)](https://unit42.paloaltonetworks.jp/solarmarker-malware/)\n\n## Executive Summary\n\nRecently, we've identified a new version of SolarMarker, a malware family known for its\ninfostealing and backdoor capabilities, mainly delivered through search engine optimization\n(SEO) manipulation to convince users to download malicious documents.\n\nSome of SolarMarker’s capabilities include the exfiltration of auto-fill data, saved passwords\nand saved credit card information from victims’ web browsers. Besides capabilities typical for\ninfostealers, SolarMarker has additional capabilities such as file transfer and execution of\ncommands received from a C2 server\n\n\n-----\n\nThe malware invests significant effort into defense evasion, which consists of techniques like\nsigned files, huge files, impersonation of legitimate software installations and obfuscated\nPowerShell scripts.\n\n[This malware has been prevalent since September 2020 targeting U.S. organizations, and](https://www.prodaft.com/m/reports/Solarmarker_TLPWHITEv2.pdf)\npart of the infrastructure is still active as of 2022 in addition to a new infrastructure that\nattackers have recently deployed.\n\nHere, we dive into the technical details of the newly identified SolarMarker activity –\nspecifically, how this malware often changes and modifies its attack patterns. For example,\nthe recent version demonstrated an evolution from Windows Portable Executables (EXE\nfiles) to working with Windows installer package files (MSI files). According to the evidence\nwe have, this campaign is still in development and going back to using executables files\n(EXE) as it did in its earlier versions.\n\nPalo Alto Networks customers received protections against the newly discovered campaigns\nthrough [Cortex XDR and](https://www.paloaltonetworks.com/cortex/cortex-xdr) [WildFire.](https://www.paloaltonetworks.com/products/secure-the-network/wildfire)\n\nRelated malware names SolarMarker, Jupyter, Yellow Cockatoo, Polazert\n\nRelated Unit 42 topics [infostealer,](https://unit42.paloaltonetworks.com/tag/infostealer/) [backdoor](https://unit42.paloaltonetworks.com/tag/backdoor/)\n\n## Table of Contents\n\nInfection Vector\n\nDeployment of SolarMarker Infrastructure on a Victim Machine\n\nMain Sections of the PowerShell Script\n\nEncrypted Payload\n\nSolarMarker Backdoor\n\nSolarMarker Infostealer\n\nKey Changes Observed in the New Version of SolarMarker\n\nConclusion\n\nIndicators of Compromise\n\nAdditional Resources\n\n## Infection Vector\n\nSolarMarker is multi-stage malware. The attackers use obfuscated PowerShell scripts to\ndeploy their attack and stay under the radar.\n\nThe primary infection vector of SolarMarker is SEO poisoning, which is an attack method in\nwhich threat actors create malicious websites packed with keywords and use search engine\noptimization techniques to make them show up prominently in search results.\n\n\n-----\n\n## Deployment of SolarMarker Infrastructure on a Victim Machine\n\nThe initial stage is an EXE file larger than 250MB (the large file size helps to avoid inspection\nby an automated sandbox or an AV engine). In this case, the file we analyzed was called\nsetup.exe. based on the sample compilation date in February 2022, the demonstrated\nartifacts belong to a new development in the malware lifecycle.\n\nFigure 1. Dropper file properties.\n\nFigure 2. The file is signed with valid digital certificates to further hide from detection. We\nassume a stolen code-signing cert from a legitimate company was used to sign SolarMarker\n– but at the time of writing, the certificate chain has been revoked.\n\n\n-----\n\nThis file is a .NET-compiled dropper that will drop and execute an installer of a legitimate\nprogram to avoid raising the user’s suspicion toward the downloaded binary.\n\nFigure\n\n3. Legitimate PDF Merge installer.\n\nFigure 4. The name of the legitimate dropped installer file is the same as the first stage file\nwith the ”_install” suffix. (setup_install.exe)\nIn parallel, the malware runs a PowerShell loader in a new thread to load and execute the\nSolarMarker backdoor payload.\n\n\n-----\n\nWe can see the loaded script decoded by debugging the PowerShell invoke function.\n\nLet's take a look at the script.\n\nFigure 5. Obfuscated PowerShell script.\n\nFigure 6. To improve the readability of this PowerShell loader script, we removed various\ntypes of obfuscation and added comments.\n\n## Main Sections of the PowerShell Script\n\nshowWindowAsync makes PowerShell windows hidden to conceal malicious activity\nfrom the plain sight of users.\nWrites the encrypted base64 payload of the SolarMarker backdoor to file with random\nextension into the TEMP folder.\n\n\n-----\n\nAchieves persistence using the lnk file in the startup folder. The target file of the lnk is\nthe encrypted base64 payload of the SolarMarker backdoor with the random extension.\n(This file cannot be run directly).\nIn Windows environments, every file extension is associated with a default program.\nThe associations of extensions with programs are handled through the registry.\nSolarMarker sets a handler to the custom random extension to run the encrypted\npayload. This handler is a PowerShell script that decrypts the payload and loads the\nbytes of the encrypted payload (backdoor) into memory.\n\nThe attacker avoids downloading the assembly to disk and subverts it using the ”Load”\nmethod, which accepts a byte array instead of a file. The loading technique is called\n[Reflective Code Loading.](https://attack.mitre.org/techniques/T1620/)\n\nIn the first execution of the malware on the victim machine, the encrypted payload\n(backdoor) will load into the first stage of the malware (setup.exe) because, as we mentioned\nearlier, setup.exe opened a new thread in which it ran the PowerShell script.\n\nAfter the reboot, the encrypted payload will load directly into the PowerShell process due to\nthe lnk file from the startup folder.\n\n## Encrypted Payload\n\nWe’ve so far mentioned the encrypted payload many times. What exactly is it?\n\nWe can make a small change to the PowerShell script of the attacker to save the assembly\nto disk rather than loading it directly into memory. In addition, this can help us understand the\nfunctionality of this version of SolarMarker.\n\nWe got a .NET-compiled Dynamic-Link Library (.DLL) that contains the core code of the\nSolarMarker backdoor with an embedded C2 client.\n\nWhen looking at the decompiled code and the names of the classes and functions, we can\nsee that they don't look right. Instead, they look like they are obfuscated.\n\n\n-----\n\nFigure 7. Obfuscated names of the classes and functions/obfuscated code doesn't make\nmuch sense.\n[After quickly running de4dot, we can see that it unpacked and deobfuscated:](https://github.com/de4dot/de4dot)\n\nFigure 8. Deobfuscated strings in functions.\n\n## SolarMarker Backdoor\n\n\n-----\n\nThe SolarMarker backdoor is a .NET C2 client that will communicate with the C2 server\nwithin the encrypted channel.\n\nThe protocol communication is HTTP – usually POST requests.\n\nThe data is encrypted using RSA encryption with Advanced Encryption Standard (AES)\nsymmetric encryption.\n\nFigure 9. Encrypted network communication with the C2 server.\nThe client performs internal reconnaissance, collects basic information about the victim\nmachine and exfiltrates it over an existing C2 channel.\n\nFigure 10. Exfiltrated data before encryption.\nThe client sends a signal to the attacker’s server to check for instructions or additional\npayloads at regular intervals (60 seconds).\n\nThe attacker can run a PowerShell script and transfer files to the victim machine.\n\nThe next stage is again a PowerShell encoded script that deploys the SolarMarker final\npayload (.NET Infostealer) and loads it into memory (this typically occurs about a few hours\nafter the initial infection of the victim machine).\n\nThe attackers' servers and version names vary between the backdoor and infostealer\nmodules.\n\n## SolarMarker Infostealer\n\nIn terms of its structure, the infostealer module looks very similar to the backdoor module we\nintroduced earlier but has extended capabilities.\n\n\n-----\n\nThe SolarMarker infostealer module acquires login data, cookies and web data (auto-fill)\nfrom web browsers by reading files specific to the target browser. SolarMarker uses the API\n[function CryptUnprotectData (DPAPI) to decrypt the credentials.](https://docs.microsoft.com/en-us/windows/win32/api/dpapi/nf-dpapi-cryptunprotectdata)\n\nFigure 11. Data collection for exfiltration example.\n\nFigure 12. Collected data is exfiltrated as XML format.\n\n\n-----\n\nFigure 13. Data leakage exfiltration through HTTP encrypted channel.\n\n### Key Changes Observed in the New Version of SolarMarker\n\nLet's summarize the main changes seen in the new version of SolarMarker:\n\nSwitches back to executables as the dropper instead of MSI.\nIncreases the dropper files to larger volumes.\nThe dropper files are always signed by a legitimate company.\nModified the PowerShell loader script.\nIn the first execution of the malware on the victim machine, the backdoor will load into\nthe dropper process and not into the PowerShell process as in previous versions.\n\n## Conclusion\n\nThis blog post documents recent changes in SolarMarker behavior patterns. These updates\nappear to upgrade evasion abilities in an attempt to stay under the radar and demonstrate\nthat SolarMarker continues to evolve.\n\nIn recent years, the security industry has come to realize the importance of behavior-based\ndetectors to reduce the dwell time of threats inside their network.\n\n[Palo Alto WildFire Customers are protected from the SolarMarker malware.](https://www.paloaltonetworks.com/products/secure-the-network/wildfire)\n\n[Palo Alto Customers using Cortex XDR Prevent or Pro are protected from such campaigns in](https://docs.paloaltonetworks.com/cortex/cortex-xdr/cortex-xdr-pro-admin/endpoint-security/endpoint-security-concepts/endpoint-protection-modules#id181B84070AX)\ndifferent layers, including over 30 Behavioral Threat Protection, BIOC, and Analytics BIOCs\nrules that identify the tactics and techniques that SolarMarker uses at different stages of its\n\n\n-----\n\nexecution.\n\nMost rules are not customized for SolarMarker and are based on unusual, rare behaviors –\nand therefore provide protection against many additional malware families and campaigns\nthat use the same methods. On top of that, the Local Analysis Engine and WildFire\nintegration provide additional layers of protection to Cortex customers.\n\n## Indicators of Compromise\n\n**IP**\n\n84.252.95[.]225\n\n89.44.9[.]108\n\n5.254.118[.]226\n\n37.120.247[.]199\n\n69.46.15[.]151\n\n37.120.237[.]251\n\n146.70.101[.]97\n\n146.70.24[.]173\n\n188.241.83[.]61\n\n185.244.213[.]64\n\n45.42.201[.]248\n\n216.230.232[.]134\n\n46.102.152[.]102\n\n146.70.53[.]153\n\n146.70.88[.]119\n\n37.221.113[.]115\n\n92.204.160[.]114\n\n92.204.160[.]101\n\n**SHA256**\n\n\n-----\n\naf1e952b5b02ca06497e2050bd1ce8d17b9793fdb791473bdae5d994056cb21f\n\nb4878d6b9d7462cafe81d20da148a44750aa707f4e34eae1f23f21f9e0d9afa0\n\n3b79aab07b9461a9d4f3c579555ee024888abcda4f5cc23eac5236a56bf740c7\n\nd40da05d477f2a6a0da575194dd9a693f85440e6b2d08d1687e1415ce0b00df7\n\nb90ac9da590ba7de19414b7ba6fbece13ba0c507f1d6be2be2b647091f5779f0\n\ne91e49fa225b2a9d7b6d5b33a64d4ebe96bbbcea3705438910a5196e0b9d030f\n\n1ad2af16a803f6f72f3f8bd305fe2e1b2049ecc8c401ed48e72446abb33022f8\n\n67735dd94093998ea9011435f6e56f90e3d66131b841706c4418c14907a497f9\n\n5239c3b84de73e2a5d9a2ea3f99889f5c81769df388dae21db37a37688f6617e\n\n5a2005552ba03f22f4d89d638b7e87b1dc1397c82f665fe3c63fd7d29bc6215b\n\n44af59a2d70ba23f2f80d80090d11184ef923a746c0c9ea3c81922bd8d899346\n\n2f7287a8b0c612801e77de6c2f37e22e0a67579f203a0aaf40095bf6ff70e6ee\n\n0c933001de544ebc071d175d9f8e3bfad8066b532dc69dea4c713c52eb6a64a0\n\n067ead7f7950dac95836899d08e93e6888fc87603b9ebf49d10ffeaed27ae466\n\na9df1cb6aa6061056b78ad88e7101b076cf20c1a82cc79b1215d1ea80c3fbd2c\n\n3407a30a697cc9ad2aa84fddc9f643a6b0f2012b286f99f5ac01064bbd56e09a\n\n7cc35fbce4b353c541f1ee62366248cc072d1c7ce38b1d5ef5db4a2414f26e08\n\n7ce31f51f539761f9922bec50d38c6b9c0d6cc3a912517d947bc0a49dd507026\n\nbbfae2ab644c8d0f1ba82b01032b1962c43855cc6716193ce872ac16cda166df\n\n3be8e9f9e76df60bc682887ea31813762e9d2c316260a702c3b3e54391a9111b\n\n11543f09c416237d92090cebbefafdb2f03cec72a6f3fdedf8afe3c315181b5a\n\nb0e926d0e8a2379173ce220071d409839d02a87f7b25f39e29d9e47afa4f7378\n\n**Filename**\n\n\n-----\n\nOptumrx-Quantity-Limit-Prior-Authorization-Form.exe\n\nFedex-Domestic-Air-Waybill.exe\n\nOsha-Required-Training-Checklist-For-General-Industry.exe\n\nThetford Porta Potti 345 Instructions.exe\n\nParkland-Heritage-Gazebo-Instructions.exe\n\nHoward-County-Refinance-Affidavit.exe\n\nChecklist-For-Bringing-New-Baby-Home.exe\n\nPool-Cover-Cable-Winch-Instructions.exe\n\nRadiation-Pregnancy-Consent-Form.exe\n\nRival-Frozen-Delights-Ice-Cream-Maker-Manual.exe\n\nFord-Direct-Window-Sticker-Lookup.exe\n\nSentence-Structure-Simple-Compound-Complex-Worksheets.exe\n\nAdrenal-Protocol-Ct-Washout.exe\n\nOsha-Propane-Tank-Storage-Requirements.exe\n\nIndiana-Alcohol-And-Tobacco-Liquor-License-Renewal.exe\n\nMonthly-Elevator-Inspection-Checklist.exe\n\nFamily-Nurse-Practitioner-Certification-Exam-Questions.exe\n\nIai-Latent-Print-Certification-Test-Preparation-Training.exe\n\nCornwall-Ontario-Pool-Bylaw.exe\n\nState-Of-Michigan-Workmans-Comp-Waiver.exe\n\nLilly-Cares-Patient-Assistance-Application-Form.exe\n\nMarket-Adjustment-Salary-Increase-Letter.exe\n\nAre-Doctors-Obligated-By-Law-To-Perform-A-Surgery.exe\n\nAffidavit-Of-Correction-South-Carolina.exe\n\nMedicare-Annual-Wellness-Visit-Questionnaire-In-Spanish.exe\n\nAcceptance-Letter-Phd-Neuroscience.exe\n\nCigna-Precertification-Request-Form.exe\n\nOregon-Inheritance-Tax-Waiver-Form.exe\n\nReligious-Exemption-Letter-Nj-Example.exe\n\nTraining-Needs-Analysis-Questionnaire-For-Employees.exe\n\nSample-Texas-Will-And-Testament.exe\n\nMatter-As-Particles-Worksheet.exe\n\nSdlc-Life-Cycle-With-Examples.exe\n\nRandall-High-School-Volleyball-Schedule.exe\n\nUses-Of-Rocks-Worksheet.exe\n\nSample-Demand-Letter-For-Services-Not-Rendered.exe\n\nFe-Exam-Review-Lecture-Notes.exe\n\nQuit-Claim-Deed-Form-Volusia-County-Florida.exe\n\nImsa-Ite-Traffic-Signal-Maintenance-Handbook.exe\n\nCapital-One-Mortgage-Pre-Approval.exe\n\nField-Trip-Reflection-Worksheet-Pdf.exe\n\nLivingston-Mt-City-Court-Warrants-List.exe\n\nOne-Page-Lease-Agreement-Texas.exe\n\nThetford Porta Potti 345 Instructions.exe\n\nHoward-County-Refinance-Affidavit.exe\n\nChecklist-For-Bringing-New-Baby-Home.exe\n\nExample Of Discharge Summary For Substance Abuse\n\n**Certificates**\n\n\n-----\n\n**Name:** **Zimmi Consulting Inc**\n\n**Serial Number: 06 FA 27 A1 21 CC 82 23 0C 30 13 EE 63 4B 6C 62**\n\n**Status: Trust for this certificate or one of the certificates in the certificate chain has been**\n**revoked.**\n\n**Valid From: 12:00 AM 02/18/2022**\n\n**Valid To: 11:59 PM 02/13/2023**\n\n**Thumbprint: BA256F3716A5613B2DDA5F2DBD36ABC9AC321583Name:** **Divertida**\n**Creative Limited**\n\n**Serial Number: 08 83 DB 13 70 21 B5 1F 3A 2A 08 A7 6A 4B C0 66**\n\n**Status: Trust for this certificate or one of the certificates in the certificate chain has been**\n**revoked.**\n\n**Issuer: DigiCert Trusted G4 Code Signing RSA4096 SHA384 2021 CA1**\n\n**Valid From: 12:00 AM 07/28/2021**\n\n**Valid To: 11:59 PM 07/27/2022**\n\n**Thumbprint: C049731B453AB96F0D81D02392C9FC57257E647D**\n\n## Additional Resources\n\n**Get updates from**\n**Palo Alto**\n**Networks!**\n\nSign up to receive the latest news, cyber threat intelligence and research from us\n\n[By submitting this form, you agree to our Terms of Use and acknowledge our Privacy](https://www.paloaltonetworks.com/legal-notices/terms-of-use)\nStatement.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-04-08 - New SolarMarker (Jupyter) Campaign Demonstrates the Malware’s Changing Attack Patterns.pdf"
    ],
    "report_names": [
        "2022-04-08 - New SolarMarker (Jupyter) Campaign Demonstrates the Malware’s Changing Attack Patterns.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536082,
    "ts_updated_at": 1743041156,
    "ts_creation_date": 1653692169,
    "ts_modification_date": 1653692169,
    "files": {
        "pdf": "https://archive.orkl.eu/50eb6258761b85e95e619c4088d03b3191a37e84.pdf",
        "text": "https://archive.orkl.eu/50eb6258761b85e95e619c4088d03b3191a37e84.txt",
        "img": "https://archive.orkl.eu/50eb6258761b85e95e619c4088d03b3191a37e84.jpg"
    }
}