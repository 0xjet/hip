{
    "id": "358392a0-b466-4d11-ad35-22235a1c3fba",
    "created_at": "2023-01-12T15:10:42.207401Z",
    "updated_at": "2025-03-27T02:09:29.498424Z",
    "deleted_at": null,
    "sha1_hash": "bc337a425be60bf9c3ec72976e3e042b2c6d8f5e",
    "title": "2015-09-11 - CSI MacMark- Janicab",
    "authors": "",
    "file_creation_date": "2022-05-28T16:10:11Z",
    "file_modification_date": "2022-05-28T16:10:11Z",
    "file_size": 353775,
    "plain_text": "# CSI MacMark: Janicab\n\n**macmark.de/blog/osx_blog_2013-08-a.php**\n\n[Da ich den Janicab-\"Trojaner\" nicht \"in the wild\" auftreiben konnte, hatte ich Thomas von](https://twitter.com/thomasareed)\n[The Safe Mac um Rat gefragt. Er gab mir den Hinweis, bei VirusTotal anzufragen, ob sie mir](http://www.thesafemac.com/new-signed-malware-called-janicab/)\nZugriff auf ihre Malware-Samples geben. Dank VirusTotal bin ich nun in der Lage, diesen\nArtikel als Fortsetzung von [Trojanisches Pferd Janicab erledigt zu schreiben.](https://www.macmark.de/blog/osx_blog_2013-07-b.php)\n\nDie Berichte, die ich sonst so lesen konnte, sind mir zu wenig. Manche schreiben, es würde\ngar keine Warnmeldung angezeigt, was nicht stimmt. Und ich vermisse Hilfestellung für den\nnormalen User, Infos darüber, wie er sich mit Bordmitteln schützen kann. Aus dem Grund\nmache ich hier eine kleine \"Crime Scene Investigation\" aus der Serie \"CSI:MacMark\".\n\nCRIME SCENE DO NOT CROSS    CRIME SCENE DO NOT CROSS    CRIME\nSCENE DO NOT CROSS    CRIME SCENE DO NOT CROSS    CRIME SCENE DO\nNOT CROSS    CRIME SCENE DO NOT CROSS    CRIME SCENE DO NOT\nCROSS    CRIME SCENE DO NOT CROSS\n\n## Öffnen oder nicht?\n\nAls Janicab frisch unterwegs war, bekam man, wenn man ihn doppelklickte, eine teils\nfalschrum geschriebene Warnmeldung angezeigt, die verkündet, daß es sich um eine\nAnwendung handelt. Falschrum, weil der Dateiname ein Sonderzeichen für\nLeserichtungswechsel enhält. Die Meldung kommt, weil die üblichen Netzprogramme von\nOS X ein [Quarantäne-Flag auf ihre Downloads setzen. Ist das Ding ausführbar, wird der](https://www.macmark.de/osx_security.php#quarantine)\nBenutzer gewarnt.\n\nLeider ist die Standardeinstellung in OS X, daß Datei-Endungen nicht angezeigt werden.\nDas ist keine gute Idee, weil man damit auf eine Kontrollstelle verzichtet.\n\n\n-----\n\nJanicab ohne eingeschaltete Dateinamen-Erweiterungen im Finder.\n\nViel verdächtiger sieht das Trojanische Pferd aus, wenn man sich Datei-Endungen anzeigen\nläßt.\n\nJanicab mit eingeschalteten Dateinamen-Erweiterungen im Finder.\n\nIn jedem Fall kann man aber die Info-Box aufrufen, bevor man etwas doppelklickt. In diesem\nFall sagt sie eindeutig, daß es sich bei dem \"PDF\" um eine Application handelt, und, daß sie\ntatsächlich eine komische Doppelendung hat.\n\n\n-----\n\nDie Infobox von Janicab zeigt, daß es ein Programm ist und den tatsächlichen Namen.\n\n## Signierte Malware\n\nJanicab ist eine signierte Mac-Application, die ein Wrapper um Python-Skripte ist. Im\nTerminal kann man sich die Details der Signatur ansehen:\n\n\n-----\n\n```\nGoldCoast:Desktop joeuser$ codesign vvvd RecentNews.fdp.app/\nExecutable=/Users/joeuser/Desktop/RecentNews.fdp.app/Contents/MacOS/installer\nIdentifier=org.pythonmac.unspecified.installer\nFormat=bundle with Mach-O universal (i386 x86_64)\nCodeDirectory v=20100 size=344 flags=0x0(none) hashes=10+3 location=embedded\nHash type=sha1 size=20\nCDHash=ee045a751fb61e33b353b0c91796cc3d4e8fc37b\nSignature size=8510\nAuthority=Developer ID Application: Gladys Brady\nAuthority=Developer ID Certification Authority\nAuthority=Apple Root CA\nTimestamp=23 Apr 2013 11:34:48\nInfo.plist entries=21\nSealed Resources version=1 rules=4 files=21\nInternal requirements count=1 size=196\n\n```\nDiese Signatur macht es für Apple einfach, die Malware aus dem Verkehr zu ziehen. OS X\nbekommt von Apple Infos über ungültige Entwickler-Zertifikate. Nach kurzer Zeit hatte Apple\noffenbar das Zertifikat von Gladys Brady deaktiviert. Seitdem sieht man beim Öffnen des\nSchadprogrammes eine andere Meldung:\n\nJanicab kann per Doppelklick im Finder nicht mehr geöffnet werden (deutsch).\n\nJanicab kann per Doppelklick im Finder nicht mehr geöffnet werden (englisch).\n\n\n-----\n\nWie schon erwähnt, kommt die Meldung falschrum. Das allerdings nur, wenn man sich die\nDateinamen-Erweiterungen im Finder nicht anzeigen läßt. Aktiviert man sie, dann ist die\nMeldung auch im Klartext richtigrum lesbar:\n\nJanicab-Warnmeldung mit eingeschalteten Dateinamen-Erweiterungen im Finder.\n\nDarum nochmals der Hinweis: Schaltet im Finder die Dateinamen-Erweiterungen ein!\n\n## Testlauf in der Sandbox\n\nAn der Signatur oben sieht man, daß die ausführbare Datei im Application-Bundle an der\nüblichen Stelle liegt und hier \"installer\" heißt. Damit deutet die Malware schon an, was sie\ntut. Man sieht, daß die App 32- und 64-Bit-Systeme nativ unterstützt.\n```\nGoldCoast:MacOS joeuser$ file installer \ninstaller: Mach-O universal binary with 2 architectures\ninstaller (for architecture i386): Mach-O executable i386\ninstaller (for architecture x86_64): Mach-O 64-bit executable x86_64\n\n```\nManche Seiten schreiben, es handele sich um eine Multiplattform-Malware. Allerdings läuft\ndieses Exemplar nur auf OS X. Die Schwester-Malware für Windows ist eine andere\nGeschichte. Sie ist also nicht wirklich plattformübergreifend, sondern speziell für jedes\nBetriebssystem.\n\nUm zu schauen, was Janicab wohl anstellen möchte, starte ich ihn in einer Sandbox, die\nsowohl das Schreiben von Dateien als auch Netzverkehr unterbindet. Außerdem schalte ich\nDebug-Ausgaben ein, um zu erfahren, was er tut:\n\n\n-----\n\n```\nGoldCoast:MacOS joeuser$ sandbox exec p (version 1) (allow default) (deny network )\n(deny file-write*) (debug deny)\" ./installer \nmkdir: /Users/joeuser/.t: Operation not permitted\nTraceback (most recent call last):\n File \"/Users/joeuser/Desktop/RecentNews.fdp.app/Contents/Resources/__boot__.py\",\nline 65, in \n  _run()\n File \"/Users/joeuser/Desktop/RecentNews.fdp.app/Contents/Resources/__boot__.py\",\nline 60, in _run\n  exec(compile(source, path, 'exec'), globals(), globals())\n File \"/Users/joeuser/Desktop/RecentNews.fdp.app/Contents/Resources/installer.py\",\nline 49, in \n  shutil.copy(fullName,workdir)\n File\n\"/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/shutil.py\",\nline 119, in copy\n File\n\"/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/shutil.py\",\nline 83, in copyfile\nIOError: [Errno 1] Operation not permitted: '/Users/joeuser/.t'\n2013-08-01 09:48:34.833 installer[6961:d07] installer Error\n2013-08-01 09:48:45.209 installer[6961:3007] Persistent UI failed to open file\nfile://localhost/Users/joeuser/Library/Saved%20Application%20State/org.pythonmac.unspe\n No such file or directory (2)\n\n```\nEr versucht ein Verzeichnis \".t\" anzulegen in Home des Users. Der Punkt sorgt dafür, daß\ndas Verzeichnis im Finder normalerweise nicht angezeigt wird. Wenn man Janicab ohne\nSandbox laufen läßt, dann legt einen Cronjob für den User an, der die in .t gespeicherten\nDateien verwendet:\n```\ncrontab -l\n* * * * * python ~/.t/runner.pyc \n\n```\nAugrund meiner Sandbox kann Janicab nicht tun, was er will, und endet mit einem Fehler.\n\nDie in meiner Sandbox gestartete Malware wird in ihrer Aktion behindert und ist nicht weiter\nlauffähig Ich muß sie erstmal zwingend beenden und sehe die App auch im Dock\n\n\n-----\n\nJanicab als laufendes Programm im Dock, also ganz offensichtlich kein Dokument.\n\nDie Dateien, die Janicab in das Verzeichnis kopiert, wenn er normal ausgeführt wird, zeigen,\ndaß er Kommandos von außen abholen möchte, Screenshots und Tonaufnahmen macht.\nDie Screenshots landen erstmal unter /tmp/cur.jpg. Für Sound-Aufgaben verwendet Janicab\n[SoX, the Swiss Army knife of sound processing programs, ein Open Source](http://sox.sourceforge.net/)\nKommandozeilen-Tool für Sound-Verarbeitung. Wenn ich es direkt aufrufe, bestätigt es seine\nIdentität:\n```\nsandbox-exec -p \"(version 1) (allow default) (deny network*) (deny file-write*)\n(debug deny)\" ./sox\n./sox:   SoX v14.4.0\n./sox FAIL sox: Not enough input filenames specified\nUsage summary: [gopts] [[fopts] infile]... [fopts] outfile [effect [effopt]]...\n\n```\nAls Sound-Format bevorzugt Janicab anscheinend OGG. Außerdem verwendet Janicab\nnoch ein weiteres Drittprogramm, das er mitinstalliert: mt, die MouseTools:\n\n\n-----\n\n```\nsandbox exec p (version 1) (allow default) (deny network ) (deny file write )\n(debug deny)\" ./mt\n MouseTools\n Created 31 July 2010 by Hank McShane\n version 0.5\n requires Mac OS X 10.4 or higher\n Updated 18 Nov 2012 by Hank McShane to v0.5\n - added leftClickNoRelease and releaseMouse at the request of a customer\n Updated 22 Feb 2011 by Hank McShane to v0.4\n - added a double click for the left mouse button\n Updated 31 August 2010 by Hank McShane to v0.3\n - fixed and issue where negative x or y values were not being read properly\n - fixed issue where the mouse cursor wasn't updating properly\n Updated 26 August 2010 by Hank McShane to v0.2\n - using simpler method to move the mouse: CGWarpMouseCursorPosition()\n - streamlined stepMouseToPoint()\n - added 64-bit builds for 10.5 and higher\n This foundation tool will help you perform things with your mouse.\n By default, Screen Coordinates are measured from the top-left\n corner of the screen but with the [-b] switch they can be measured\n from the bottom-left.\n\n```\nJanicab holt sich Einstellungen von einem Server, benutzt anscheinend FTP und einen\nSkype-Recorder. Zumindest deuten die Strings in StarterSettings.pyc darauf hin. In\nStarterCmdExec.pyc finden sich offenbar Funtionen für das Selbstupdate der Malware:\n```\nCE: handleUpdate: starting update procedure.s!\nCE: Copied update file succefullys\n/tmp/s\nrm -f /tmp/R\nCE: update: copy new files to work dirs+\n/tmp/installer.app/Contents/Resources/Libscs\nCE: copied: s\n to s\nCE: detele the update files\nrm -rf /tmp/installer.apps\n\n```\nStarterNetUtils.pyc richtete augenscheinlich die Crontab ein, prüft, auf welcher MaximumSystem-Version Safari läuft mit \"defaults read com.apple.Safari\nLastOSVersionSafariWasLaunchedOn\". Neben anderen Dingen, ist dieser Teil wohl auch für\ndie Verbindungsaufnahme mit den Spitzbuben zuständig:\n```\nStarting backConnect to R\nWrong parameters for backConnecti\n/bin/shs\nConnected to server at s\n\n```\n\n-----\n\nEine Logdatei findet sich unter /tmp/starter.log. StarterRec.pyc kümmert sich um\nTonaufnahmenim OGG-Format, deren Versandt und das Wegräumen selbiger. Unter\nanderem wird dazu benutzt:\n```\nosascript -e 'do shell script \"~/.t/sox -q -V6 -d -t ogg s\n trim 0 01:00\"'t\n\n```\nDer Teil StarterScreenShots.pyc verwendet die MouseTools und macht offenbar\nScreenshots, immer wenn die Maus bewegt wurde:\n```\nSS: Starting SS Threadt\nSS: last mouse pos: s\nSS: new mouse pos: s\nSS: Creating new SS at: sN\nosascript -e 'do shell script \"/usr/sbin/screencapture -x -tjpg /tmp/cur.jpg\"'t\nshells\nSS: delete the ss files%\nSS: Same mouse position, Do Nothing..s\n\n```\nInsgesamt ist es also ein Spionage-Tool, das allgemeine Informationen über das System,\nsammelt und verschickt, anscheinend auch Kommandos von außen abfragt. Zusätzlich\nfertigt es Tonaufnahmen und Screenshots an. Es ist auch damit zu rechnen, daß Skype\nmitgeschnitten wird. Das Schadprogramm prüft, ob seine Tools brav laufen und aktualisiert\nsich bei Bedarf. Ehrlich gesagt ist mir ein bißchen übel nach dieser Kurz-Analyse.\n\n## Beseitigung\n\nSollte der genannte Cronjob (siehe oben) mit \"crontab -l\" auftauchen oder andere\nangesprochene Dateien aufzufinden sein, dann sollte man mit \"crontab -r;rm -rf ~/.t\" die\nCrontab leer machen, denn sie ist per Default auf OS X leer und die Dateien unter ~/.t\nlöschen. Anschließend bitte Ausloggen, damit eventuelle Prozesse auch beendet werden.\nDazu rät [The Safe Mac und dem kann ich zustimmen.](http://www.thesafemac.com/new-signed-malware-called-janicab/)\n\nLatest Update: 11. September 2015 at 19:49h (german time)\n\nLink: [www.macmark.de/blog/osx_blog_2013-08-a.php](https://www.macmark.de/blog/osx_blog_2013-08-a.php)\n\n\n-----",
    "language": "DE",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2015/2015-09-11 - CSI MacMark- Janicab.pdf"
    ],
    "report_names": [
        "2015-09-11 - CSI MacMark- Janicab.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536242,
    "ts_updated_at": 1743041369,
    "ts_creation_date": 1653754211,
    "ts_modification_date": 1653754211,
    "files": {
        "pdf": "https://archive.orkl.eu/bc337a425be60bf9c3ec72976e3e042b2c6d8f5e.pdf",
        "text": "https://archive.orkl.eu/bc337a425be60bf9c3ec72976e3e042b2c6d8f5e.txt",
        "img": "https://archive.orkl.eu/bc337a425be60bf9c3ec72976e3e042b2c6d8f5e.jpg"
    }
}