{
    "id": "23bfbae0-d35b-4db3-880e-fdffa0fcb690",
    "created_at": "2023-01-12T15:01:26.720019Z",
    "updated_at": "2025-03-27T02:05:30.86669Z",
    "deleted_at": null,
    "sha1_hash": "0e3915f3901404ea5143b64a0a1865027ad7219d",
    "title": "2016-08-30 - OSX-Keydnap spreads via signed Transmission application",
    "authors": "",
    "file_creation_date": "2022-05-28T18:05:36Z",
    "file_modification_date": "2022-05-28T18:05:36Z",
    "file_size": 443868,
    "plain_text": "# OSX/Keydnap spreads via signed Transmission application\n\n**[welivesecurity.com/2016/08/30/osxkeydnap-spreads-via-signed-transmission-application/](https://www.welivesecurity.com/2016/08/30/osxkeydnap-spreads-via-signed-transmission-application/)**\n\nAugust 30, 2016\n\nDuring the last hours, OSX/Keydnap was distributed on a trusted website, which turned out to be “something\nelse”. It spread via a recompiled version of the otherwise legitimate open source BitTorrent client application\nTransmission and distributed on their official website.\n\n[ESET Research](https://www.welivesecurity.com/author/esetresearch/)\n30 Aug 2016 - 02:28PM\n\nDuring the last hours, OSX/Keydnap was distributed on a trusted website, which turned out to be “something\nelse”. It spread via a recompiled version of the otherwise legitimate open source BitTorrent client application\nTransmission and distributed on their official website.\n\n[Last month ESET researchers wrote an article about a new OS X malware called OSX/Keydnap, built to steal](https://www.welivesecurity.com/2016/07/06/new-osxkeydnap-malware-hungry-credentials/)\nthe content of OS X’s keychain and maintain a permanent backdoor. At that time of the analysis, it was\nunclear how victims were exposed to OSX/Keydnap. To quote the original article: “It could be through\nattachments in spam messages, downloads from untrusted websites or something else.”\n\n\n-----\n\nDuring the last hours, OSX/Keydnap was distributed on a trusted website, which turned out to be something\nelse”. It spread via a recompiled version of the otherwise legitimate open source BitTorrent client application\nTransmission and distributed on their official website.\n\n## Instant response from the Transmission team\n\nLiterally minutes after being notified by ESET, the Transmission team removed the malicious file from their\nweb server and launched an investigation to identify how this happened. At the time of writing, it was\nimpossible to tell exactly when the malicious file was made available for download. According to the\nsignature, the application bundle was signed on August 28th, 2016, but it seems to have been distributed only\nthe next day. Thus, we advise anyone who downloaded Transmission v2.92 between August 28th and August\n29th, 2016, inclusively, to verify if their system is compromised by testing the presence of any of the following\nfile or directory:\n\n/Applications/Transmission.app/Contents/Resources/License.rtf\n/Volumes/Transmission/Transmission.app/Contents/Resources/License.rtf\n$HOME/Library/Application Support/com.apple.iCloud.sync.daemon/icloudsyncd\n$HOME/Library/Application Support/com.apple.iCloud.sync.daemon/process.id\n$HOME/Library/LaunchAgents/com.apple.iCloud.sync.daemon.plist\n/Library/Application Support/com.apple.iCloud.sync.daemon/\n$HOME/Library/LaunchAgents/com.geticloud.icloud.photo.plist\n\nIf any of them exists, it means the malicious Transmission application was executed and that Keydnap is most\nlikely running. Also note that the malicious disk image was named Transmission2.92.dmg while the legitimate\none is Transmission-2.92.dmg (notice the hyphen).\n\n## Similarity with KeRanger\n\nIf this modus operandi sounds familiar, you are totally correct. In March 2016, Palo Alto Networks published a\n[blog post warning about the first OS X ransomware observed. In fact, Keydnap used the same technique to](http://researchcenter.paloaltonetworks.com/2016/03/new-os-x-ransomware-keranger-infected-transmission-bittorrent-client-installer/)\nspread itself.\n\nIn both cases, a malicious block of code is added to the main function of the Transmission application. The\ncode responsible for dropping and running the malicious payload is astonishingly the same.\n\n\n-----\n\nTransmission’s main function dropping OSX/KeRanger\n\nTransmission’s main function dropping OSX/Keydnap\n\nJust like in the KeRanger case, a legitimate code signing key was used to sign the malicious Transmission\napplication bundle. It’s different from the legitimate Transmission certificate, but is still signed by Apple and\nbypasses Gatekeeper protection.\n\n\n-----\n\n1\n\n2\n\n3\n\n4\n\n5\n\n6\n\n7\n\n8\n\n9\n\n10\n\n11\n\n12\n\n13\n\n14\n\n15\n\n16\n\n17\n\n18\n\n19\n\n\n# Malicious Transmission.app\n\n$ codesign -dvvv /Volumes/Transmission/Transmission.app\n\nExecutable=/Volumes/Transmission/Transmission.app/Contents/MacOS/Transmission\n\nIdentifier=org.m0k.transmission\n\nFormat=app bundle with Mach-O thin (x86_64)\n\nCodeDirectory v=20200 size=6304 flags=0x0(none) hashes=308+3 location=embedded\n\nHash type=sha1 size=20\n\nCandidateCDHash sha1=37ffe70260919ee70e9f2a601d5ad00e2dd5a011\n\nHash choices=sha1\n\nCDHash=37ffe70260919ee70e9f2a601d5ad00e2dd5a011\n\nSignature size=4255\n\nAuthority=Developer ID Application: <strong>Shaderkin Igor (836QJ8VMCQ)</strong>\n\nAuthority=Developer ID Certification Authority\n\nAuthority=Apple Root CA\n\nSigned Time=Aug 28, 2016, 12:09:55 PM\n\nInfo.plist entries=38\n\nTeamIdentifier=<strong>836QJ8VMCQ</strong>\n\nSealed Resources version=2 rules=12 files=331\n\nInternal requirements count=1 size=212\n\n\n-----\n\n1\n\n2\n\n3\n\n4\n\n5\n\n6\n\n7\n\n8\n\n9\n\n10\n\n11\n\n12\n\n13\n\n14\n\n15\n\n16\n\n17\n\n18\n\n19\n\n\n<span style=\"font-weight: 400;\" data-mce-style=\"font-weight: 400;\"># Clean Transmission.app</span>\n\n<span style=\"font-weight: 400;\" data-mce-style=\"font-weight: 400;\">$ codesign -dvvv\n/Volumes/Transmission/Transmission.app</span>\n\n<span style=\"font-weight: 400;\" data-mce-style=\"font-weight:\n400;\">Executable=/Volumes/Transmission/Transmission.app/Contents/MacOS/Transmission</span>\n\n<span style=\"font-weight: 400;\" data-mce-style=\"font-weight:\n400;\">Identifier=org.m0k.transmission</span>\n\n<span style=\"font-weight: 400;\" data-mce-style=\"font-weight: 400;\">Format=app bundle with Mach-O\nthin (x86_64)</span>\n\n<span style=\"font-weight: 400;\" data-mce-style=\"font-weight: 400;\">CodeDirectory v=20200 size=6304\nflags=0x0(none) hashes=308+3 location=embedded</span>\n\n<span style=\"font-weight: 400;\" data-mce-style=\"font-weight: 400;\">Hash type=sha1 size=20</span>\n\n<span style=\"font-weight: 400;\" data-mce-style=\"font-weight: 400;\">CandidateCDHash\nsha1=a68d09161742573b09a17b8aef05f918a1cebcac</span>\n\n<span style=\"font-weight: 400;\" data-mce-style=\"font-weight: 400;\">Hash choices=sha1</span>\n\n<span style=\"font-weight: 400;\" data-mce-style=\"font-weight:\n400;\">CDHash=a68d09161742573b09a17b8aef05f918a1cebcac</span>\n\n<span style=\"font-weight: 400;\" data-mce-style=\"font-weight: 400;\">Signature size=8561</span>\n\n<span style=\"font-weight: 400;\" data-mce-style=\"font-weight: 400;\">Authority=Developer ID\nApplication: </span><b>Digital Ignition LLC</b>\n\n<span style=\"font-weight: 400;\" data-mce-style=\"font-weight: 400;\">Authority=Developer ID\nCertification Authority</span>\n\n<span style=\"font-weight: 400;\" data-mce-style=\"font-weight: 400;\">Authority=Apple Root CA</span>\n\n<span style=\"font-weight: 400;\" data-mce-style=\"font-weight: 400;\">Timestamp=Mar 6, 2016, 3:01:41\nPM</span>\n\n<span style=\"font-weight: 400;\" data-mce-style=\"font-weight: 400;\">Info.plist entries=38</span>\n\n<span style=\"font-weight: 400;\" data-mce-style=\"font-weight: 400;\">TeamIdentifier=</span>\n<b>5DPYRBHEAR</b>\n\n<span style=\"font-weight: 400;\" data-mce-style=\"font-weight: 400;\">Sealed Resources version=2\nrules=12 files=328</span>\n\n<span style=\"font-weight: 400;\" data-mce-style=\"font-weight: 400;\">Internal requirements count=1\nsize=180</span>\n\n\nESET has notified Apple about compromised code signing key.\n\nBeside the distribution method, Keydnap and KeRanger features some similarity in its code such as the C&C\nURL resource path and parameter.\n\nKeRanger: /osx/ping?user_id=%s&uuid=%s&model=%s\nKeydnap: /api/osx?bot_id=%s&action=ping&data=%s (parameters as POST data, encrypted with RC4)\n\n## Keydnap now at version 1.5\n\n\n-----\n\nWhile reporting to the C&C server, Keydnap included an internal version. The one we observed in the new\nbinary is 1.5.\n\n[It is still packed with the modified UPX described in our first article about Keydnap. The patch we published](https://www.welivesecurity.com/2016/07/06/new-osxkeydnap-malware-hungry-credentials/)\non Github to unpack the executable file still works with the new variant.\n\nA significant change in the new version is the presence of a standalone Tor client. This enables Keydnap to\nreach its onion-routed C&C server without the need of a Tor2Web relay such as onion.to.\n\nInside Keydnap, curl is set to use the local Tor client as a proxy\n\nThere is only one additional command compared to the previous version we analyzed. This new command,\nwith id 10, allows the C&C server to be set to a different URL and saves it on the disk.\n\nThe RC4 key used to encrypt HTTP POST data and decrypt the response changed to “u-4&LpZ!6Kgu^=$a“.\n\nThe hardcoded C&C URL is now hxxp://t4f2cocitdpqa7tv.onion/api/osx\n\n## How to remove OSX/Keydnap\n\nTo remove Keydnap v1.5, start by quitting Transmission. Then, in Activity Monitor, kill processes with any of\nthe following names:\n\n– icloudproc\n\n– License.rtf\n\n– icloudsyncd\n\n– /usr/libexec/icloudsyncd -launchd netlogon.bundle\n\nRemove the following files and directories:\n\n\n-----\n\n/Library/Application Support/com.apple.iCloud.sync.daemon/\n– /Library/LaunchAgents/com.apple.iCloud.sync.daemon.plist\n– /Users/$USER/Library/Application Support/com.apple.iCloud.sync.daemon/\n– /Users/$USER/Library/Application Support/com.geticloud/\n– /Users/$USER/Library/LaunchAgents/com.apple.iCloud.sync.daemon.plist\n– /Users/$USER/Library/LaunchAgents/com.geticloud.icloud.photo.plist\n\nRemove Transmission from your system and redownload it from a trusted source. The Transmission website\nand binaries are now hosted on Github. You can verify the hash and the signature of the legitimate binary\npackage with:\n\n– “shasum -a 256” and compare with the one on the site and\n– “codesign -dvvv” and verify if is signed by “Digital Ignition LLC” with team identifier 5DPYRBHEAR.\n\n## IOCs\n\n**Transmission bundle**\n\n**SHA-1** **Filename** **ESET Detection name**\n\n1ce125d76f77485636ecea330acb038701ccc4ce Transmission2.92.dmg OSX/Keydnap.A\n\n**OSX/Keydnap dropper**\n\n**SHA-1** **Filename** **ESET Detection name**\n\ne0ef6a5216748737f5a3c8d08bbdf204d039559e Transmission OSX/TrojanDropper.Agent.A\n\n**OSX/Keydnap backdoor**\n\n\n**SHA-1** **ESET**\n**Detection**\n**name**\n\n\n**C&C** **Version**\n\n\n8ca03122ee73d3e522221832872b9ed0c9869ac4 OSX/Keydnap.A hxxp://t4f2cocitdpqa7tv.onion 1.5\n\n30 Aug 2016 - 02:28PM\n\n### Sign up to receive an email update whenever a new article is published in our Ukraine Crisis – Digital Security Resource Center\n\n Newsletter\n\n Discussion\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2016/2016-08-30 - OSX-Keydnap spreads via signed Transmission application.pdf"
    ],
    "report_names": [
        "2016-08-30 - OSX-Keydnap spreads via signed Transmission application.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535686,
    "ts_updated_at": 1743041130,
    "ts_creation_date": 1653761136,
    "ts_modification_date": 1653761136,
    "files": {
        "pdf": "https://archive.orkl.eu/0e3915f3901404ea5143b64a0a1865027ad7219d.pdf",
        "text": "https://archive.orkl.eu/0e3915f3901404ea5143b64a0a1865027ad7219d.txt",
        "img": "https://archive.orkl.eu/0e3915f3901404ea5143b64a0a1865027ad7219d.jpg"
    }
}