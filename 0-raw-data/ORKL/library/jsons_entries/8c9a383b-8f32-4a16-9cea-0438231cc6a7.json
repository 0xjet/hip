{
    "id": "8c9a383b-8f32-4a16-9cea-0438231cc6a7",
    "created_at": "2023-01-12T15:06:24.626086Z",
    "updated_at": "2025-03-27T02:05:48.993369Z",
    "deleted_at": null,
    "sha1_hash": "f4facdedc8b5027c1614a4cc53d230be4c870587",
    "title": "2021-09-20 - Water Basilisk Uses New HCrypt Variant to Flood Victims with RAT Payloads",
    "authors": "",
    "file_creation_date": "2022-05-29T10:36:56Z",
    "file_modification_date": "2022-05-29T10:36:56Z",
    "file_size": 2585347,
    "plain_text": "# Water Basilisk Uses New HCrypt Variant to Flood Victims with RAT Payloads\n\n**trendmicro.com/en_us/research/21/i/Water-Basilisk-Uses-New-HCrypt-Variant-to-Flood-Victims-with-RAT-**\nPayloads.html\n\nSeptember 20, 2021\n\n\n-----\n\nFigure 1. The HCrypt v7.8 builder\nWe encountered a fileless campaign that used a new HCrypt variant to distribute numerous\nremote access trojans (RATs) in victim systems. This new variant uses a newer obfuscation\nmechanism compared to what has been observed in past reports. It reached the peak of\nactivity in the middle of August 2021.\n\nHCrypt is a crypter and multistage generator that is considered difficult to detect. It is\n[identified as a crypter-as-a-service, paid for by threat actors to load a RAT (or in this case](https://blog.morphisec.com/tracking-hcrypt-an-active-crypter-as-a-service)\nRATs) of their choosing. The campaign also showed new obfuscation techniques and attack\nvectors, different from those that were observed in the past.\n\n## Overview of the Water Basilisk campaign\n\nIn this campaign, which we have labelled Water Basilisk, the attacker mostly used publicly\navailable file hosting services such as “archive.org”, “transfer.sh”, and \"discord.com\", to host\nthe malware while hacked WordPress websites were used to host phishing kits.\n\nThe malicious file is hidden as an ISO that is distributed through a phishing email or website.\nThis file contains an obfuscated VBScript stager responsible for downloading and executing\nthe next stage of the VBScript content onto the infected system memory.\n\n\n-----\n\nThe final stage is an obfuscated PowerShell script that contains the payloads and is\nresponsible for deobfuscating and injecting them into the assigned process. In some cases,\nthe final stage PowerShell script contained up to seven various RATs. These are typically\nNjRat, BitRat, Nanocore RAT, QuasarRat, LimeRat, and Warzone.\n\nHCrypt version 7.8\n\nIn a nutshell, Water Basilisk’s attack chain is a combination of the VBScript and PowerShell\ncommands. HCrypt creates various obfuscated VBScripts and PowerShell to deliver or inject\nthe final payload into a given process in a victim system. The latest version of this crypter is\n7.8, based on what we have seen in its builder and website.\n\nFigure 2. HCrypt v7.8 updates that also list RAT variants and the purchase price\n\n\n-----\n\nFigure 3. HCrypt v7.8 on Sellix\nAs can be seen in Figures 1 to 3, HCrypt 7.8 is being sold for US$199. Figure 2 also lists, as\npart of an update, the various RATs that can be loaded using this variant that we mentioned\nearlier.\n\n### Attack analysis\n\nThis section discusses how this version works. Figure 4 summarizes Water Basilisk. The\ninfection chain goes as follows:\n\nA phishing email or website tricks a user into downloading and executing the malicious\nISO file that contains the initial VBScript stager\nThe initial VBScript downloads and executes the next stage VBScript content via a\nPowerShell command in memory\nThe downloaded VBScript would be responsible for achieving persistence on the victim\nsystem and downloads and executes the final stage via a PowerShell command in\nmemory\nThe final stage PowerShell is responsible for deobfuscating and injecting the payload\n(RATs) into the given process\n\n\n-----\n\nFigure 4. An overview of the attack\nThis campaign uses two different attack vectors: phishing websites and emails. Both have\nthe same infection chain, which we have already described. The attack begins with the\nmalicious ISO image file.\n\nWe can assume two reasons why this attack uses ISO files. One is how ISO images tend to\nhave larger file sizes, making it so that email gateway scanners would not be able to scan\nISO file attachments properly. Another is how opening an ISO file in new operating systems\nis as simple as double-clicking the file, due to native IOS mounting tools. This improves the\nchances of a victim opening the file and infecting their system.\n\nAs we have also mentioned, and as seen in Figure 4, an interesting aspect of this attack is\nhow HCrypt developers host stager scripts were hosted from public file hosting services such\nas Transfer.sh and Internet Archive (archive.org). Once the ISO file is opened the needed\nscripts are downloaded from this hosting archive. Figure 5 is an example of the archive.org\naccount used to host scripts.\n\n\n-----\n\nFigure 5. The archive.org account hosting the loader’s scripts\n\n\n-----\n\nFigure 6. The archive.org account hosting the loader’s scripts\nFigure 7 shows an example of the hacked WordPress website that hosts a phishing kit that\ndownloads the “Spectrum Bill.iso” file. Figure 8 shows the malicious content added by the\nattacker in the said website.\n\n\n-----\n\nFigure 7.\n\n\nThe phishing website used in this campaign\n\n\n-----\n\nFigure 8. Malicious content uploaded by the attacker\nThe “Spectrum Bill.iso” file contains an HCrypt obfuscated VBScript stager that is\nresponsible for downloading and executing the next stage via a PowerShell command. We\nnote here that, with the exception of this second stage for persistence, all scripts,\nPowerShell, and binaries are fileless and execute in memory.\n\nFigure 9. “Spectrum\n\nBill.iso” content\n\n\n-----\n\nFigure 10. \"Spectrum Bill.vbs\" content and cleanup code\nThe downloaded content in memory, “bx25.txt,” is another obfuscated HCrypt VBScript. As\nmentioned, this code is for achieving persistence and is the only one not executed in\nmemory. It achieves persistence by creating the file C:\\Users\\Public\\Run\\Run.vbs, adding it\nto the Startup path, and downloading and executing the final stage in memory.\n\nEach time an infected computer starts, the malware downloads the latest payload(s) from the\ngiven URL. The attacker can therefore change the final payload(s) and its command and\ncontrol (C&C) server easily, reducing their fingerprints on an infected system.\n\n\n-----\n\nFigure 11. The cleaned code of bx.25, the second VBScript stage for persistenc\nRun.vbs (“dx25.txt”) is the final stage PowerShell that contains the final payload(s). This\nexecutes on an infected system memory and its responsible for deobfuscating, loading, and\ninjecting payload(s) into the given hardcoded legitimate process. In some cases, the\nmalware loads up to seven RATs on an infected system. The snippet in Figure 12\ndemonstrates this behaviour of the malware.\n\n\n-----\n\nFigure 12. The code of the file dx25.txt, the PowerShell loader\nAmong the loaded binaries is a DLL injector called “VBNET,” which reflectively loads a .NET\nPE payload in a selected .NET legitimate process. In Figure 12, $HH1 is a VBNET PE\ninjector DLL and $HH5 contains a PowerShell command to pass a final malware payload\n($HH3) into the given process, which is “aspnet_regbrowsers.exe.”\n\n\n-----\n\nTo automate the final payload extraction we developed a Python script to deobfuscated and\nextract the payloads from the final PowerShell stage which simply accept a directory where\nan obfuscated PowerShell script are stored and output directory where the extracted payload\n[will be stored. The Python script can be viewed here.](https://www.trendmicro.com/content/dam/trendmicro/global/en/research/21/i/water-basilisk-uses-new-hcrypt-variant-to-flood-victims-with-rat-payloads/Water-Basilisk-Uses-New-HCrypt-Variant-to-Flood-Victims-with-RAT-Payloads-script.txt)\n\n### Bitcoin and Ethereum Hijacker\n\nWe were also able to observe Bitcoin/Ethereum address hijacker binaries among the loaded\nRATs in an infected system. These binaries search the victim’s clipboard content for Bitcoin\nand Ethereum addresses using regex, then replaces them with the attacker’s own address.\nFigure 13 shows where the binary can be generated in the HCrypt interface.\n\nFigure 13. HCrypt builder interface showing where to start generating the hijacker binaries\nBy default, the HCrypt stealer builder shows built-in Ethereum and Bitcoin addresses, likely\nbelonging to the malware’s author.\n\n\n-----\n\nFigure 14. Built-in Ethereum and Bitcoin addresses, potentially belonging to the author(s),\nseen here as “HBankers”\n\nFigure 15. Using regex to search for Bitcoin and Ethereum addresses in the victim’s\nclipboard content\n\nFigure 16.\n\nThe HCrypt builder where the user (attacker) can only choose either Bitcoin or Ethereum\nThe stealer builder will only accept one option, either Bitcoin or Ethereum, from a user. As\nshown in the example in Figure 16, in such a scenario the crypto address hijacker will\nreplace the victim’s Ethereum address with “1111111,” generate the payload, and replace the\nbitcoin address with the HCrypt builder author’s (HBankers) address. Overall, this shows the\nHCrypt’s developers’ attempt to also make a profit from attacks that use this loader.\n\n### Conclusion\n\nThis case shows how cybercriminals can take an advantage of crypter tools, such as HCrypt,\nto dynamically distribute malware. HCrypt also shows signs of undergoing active\ndevelopment It would be best to anticipate newer versions to cover more RAT variants and\n\n\n-----\n\nan updated obfuscation algorithm to reduce the chances of detection.\n\nOrganizations should also remain vigilant against phishing tactics that remain a staple in\ncyberattacks. Users should be wary of opening ISO files, especially from suspicious sources,\nas threat actors have used image files in their campaigns before. They are too easy to open\nand can bypass email gateway scanners, giving users less chances to consider whether the\nfile is malicious.\n\nOrganizations can also consider security solutions that provide a multilayered defense\nsystem that helps in detecting, scanning, and blocking malicious URLs.\n\n[The indicators of compromise (IOCs) can be found here.](https://www.trendmicro.com/content/dam/trendmicro/global/en/research/21/i/water-basilisk-uses-new-hcrypt-variant-to-flood-victims-with-rat-payloads/Water-Basilisk-Uses-New-HCrypt-Variant-to-Flood-Victims-with-RAT-Payloads-IoCs.txt)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-09-20 - Water Basilisk Uses New HCrypt Variant to Flood Victims with RAT Payloads.pdf"
    ],
    "report_names": [
        "2021-09-20 - Water Basilisk Uses New HCrypt Variant to Flood Victims with RAT Payloads.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535984,
    "ts_updated_at": 1743041148,
    "ts_creation_date": 1653820616,
    "ts_modification_date": 1653820616,
    "files": {
        "pdf": "https://archive.orkl.eu/f4facdedc8b5027c1614a4cc53d230be4c870587.pdf",
        "text": "https://archive.orkl.eu/f4facdedc8b5027c1614a4cc53d230be4c870587.txt",
        "img": "https://archive.orkl.eu/f4facdedc8b5027c1614a4cc53d230be4c870587.jpg"
    }
}