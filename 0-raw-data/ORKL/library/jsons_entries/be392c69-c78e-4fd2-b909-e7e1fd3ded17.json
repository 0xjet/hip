{
    "id": "be392c69-c78e-4fd2-b909-e7e1fd3ded17",
    "created_at": "2023-01-12T15:02:12.508129Z",
    "updated_at": "2025-03-27T02:12:11.078207Z",
    "deleted_at": null,
    "sha1_hash": "69769fd0fc91ef1de40e9092ab041ba40db9426b",
    "title": "2019-01-01 - VB2018 - Inside Formbook InfoStealer",
    "authors": "",
    "file_creation_date": "2022-05-28T16:57:39Z",
    "file_modification_date": "2022-05-28T16:57:39Z",
    "file_size": 913129,
    "plain_text": "# VB2018 paper: Inside Formbook infostealer\n\n**[virusbulletin.com/virusbulletin/2019/01/vb2018-paper-inside-formbook-infostealer/](https://www.virusbulletin.com/virusbulletin/2019/01/vb2018-paper-inside-formbook-infostealer/)**\n\n### Gabriela Nicolao\n\nDeloitte, Argentina\n\n_Copyright © 2018 Virus Bulletin_\n\nTable of contents\n\nAbstract\n\nAbout formgrabbers\n\nFormbook background\n\nCharacteristics\n\nControl panel\n\nCampaigns\n\nAnalysis\n\n1. Hiding mechanism\n\n2. Persistence mechanism\n\n3. Protection disabling and anti-analysis\n\n4. Check default browser\n\n5. Formbook deletion and termination\n\nConclusion\n\nIOCs\n\nReferences\n\n## Abstract\n\nFormbook [1] is an infostealer that has been advertised for sale in public hacking forums\nsince February 2016 by a user with the handle 'ng-Coder'. It is more advanced than a\nkeylogger as it can retrieve authorization and login credentials from a web data form before\nthe information reaches a secure server, bypassing HTTPS encryption. Formbook is\neffective even if the victims use a virtual keyboard, auto-fill, or if they copy and paste\ninformation to fill the form. The author of Formbook affirms that it is 'browser-logger\nsoftware', a.k.a. form-grabbing software. Formbook offers a PHP panel, where the buyers\ncan track their victims' information, including screenshots, keylogged data, and stolen\ncredentials. Hosting and domain services are provided for low prices with a bin only\navailable in the Pro version.\n\n\n-----\n\nFormbook was used in a spam campaign in late 2017, targeting the aerospace, defence\ncontractor and manufacturing sectors in South Korea and the USA. It includes hiding,\npersistence, anti-analysis, deletion and termination mechanisms along with several\ncommands that the C&C (command-and-control) server can receive. The 'ng-Coder' user\nindicated that Formbook should not be used for malicious purposes and blocked sales until\nfurther notice after the spam campaigns became known. According to 'ng-Coder', Formbook\nshould only be used to spy on family members or employees if the user has the explicit right\nto do so. However, this claim is dubious given the barely legitimate nature of the use of\nsuch software.\n\n## About formgrabbers\n\nFormgrabbers intercept HTTP(S) data and use inline hooking to redirect the function to one\nwithin the formgrabber before transferring the execution flow back to the HTTP function to\ncomplete the request. This technique allows formgrabbers to capture a user's information\nbefore the user submits it over the Internet to a secure server. While keyloggers focus\nmainly on capturing the user's input, formgrabbers collect pasted information and/or\ninformation selected via a drop-down option, which makes them more efficient than\nkeyloggers.\n\nA formgrabber injects a DLL (Dynamic Link Library) into a browser and monitors for calls to\nthe HttpSendRequest API within WININET.DLL in order to intercept the data before\nencryption and send all requests to its own code, prior to sending the data onwards.\nAndromeda (aka Gamarue), Tinba and Weyland‑Yutani BOT are some malware families\nthat use this technique.\n\n## Formbook background\n\nPrior to advertising it for sale, a user with the handle 'ng-Coder' offered Formbook for free in\npublic hacking forums so that other users could review it.\n\n\n-----\n\nFigure 1: First mention of Formbook in a forum.\n\nSoon after the free version was released, the user 'ng-Coder' advertised Formbook for sale\nat an initial price of 250 USD. However, the author reduced the price to 120 USD in early\nMarch 2016 after receiving several complaints about the price from forum members. The\ncurrent pricing list and payment methods offered in the forum are displayed in Figure 2.\n\nFigure 2: Pricing list and payment\n\nmethods for Formbook.\n\n\n-----\n\n## Characteristics\n\nAccording to the user 'ng-Coder', Formbook boasts the following features:\n\nCoded in ASM/C (x86_x64)\nStartup (hidden)\nFull PE-injection (no DLL/no drop/both x86 and x64)\nRing3 kit\nBin is Balloon Executable (MPIE + MEE)\nDoesn't use suspicious Windows APIs\nNo blind hook, all hooks are thread safe including the x64, so crash is unlikely\nAll communications with the panel are encrypted\nInstall manager\nFile browsing (FB Connect)\nFull Unicode support.\n\n## Control panel\n\nFormbook works as a botnet, infecting victims that are shown in a web panel in order to\nmanage the information that is retrieved from them. Figure 3 shows the web panel.\n\nFigure 3: Formbook web panel.\n\nEach bot can receive the following commands from the C&C server:\n\nDownload and execute\nUpdate\nUninstall\n\n\n-----\n\nVisit URL\nClear cookies\nRestart system\nShut down system\nForce upload keystroke\nTake screenshot\nFB Connect (file browsing)\nDownload and execute from FB Connect\nUpdate bin from FB Connect\n\n## Campaigns\n\nFormbook was used in spam campaigns targeting the aerospace, defence contractor and\nmanufacturing sectors within the US and South Korea in 2017 [2]. It was distributed via\nPDFs with embedded links, DOC and XLS files with malicious macros, and compressed\nfiles containing the executable.\n\nIt was also observed in 2018, distributed via emails with DOCX files that contained a URL\n\n[3]. This URL downloaded an RTF file that exploits CVE-2017-8570 and drops an\nexecutable. This executable downloads the Formbook sample.\n\n## Analysis\n\nThe analysed sample is a RAR self-extracting archive (SFX) that contains several files, as\nshown in Figure 4.\n\n\n-----\n\nFigure 4: SFX file.\n\nThe description to the right of the files shows the following strings:\n\nPath=%LocalAppData%\\temp\\cne\nSilent=1\nUpdate=UcE1U8\nSetup=axo.exe pwm-axa\n\n\n-----\n\nFiles with a size below 1K contain a few strings that are probably used during\ndecompression.\n\nAfter executing the SFX file, Formbook extracts the files in %LocalAppData%\\temp\\cne\nusing CreateDirectoryW. It then deletes the SFX file. Figure 5 shows the file extraction.\n\nFigure 5: File\n\nextraction.\n\nThe axo.exe file is an AutoIt script that is executed with the pwm-axa file as a parameter.\nFigure 6 shows the properties of the axo.exe file.\n\n\n-----\n\nFigure 6: Properties of the\n\naxo.exe AutoIt executable.\n\nThe script decrypts Formbook and loads it in memory. In order to do this, it creates a file\nwith a random name that contains Formbook's functionality and deletes it soon after loading\nit in memory. This file contains 44 functions with obfuscated names. The sni.mp3 file\nincludes interesting strings that were used during the execution, as shown in Figure 7.\n\nFigure 7: Interesting strings found in the sni.mp3 file.\n\n\n-----\n\nThe script contains the following features:\n\n### 1. Hiding mechanism\n\nThe script changes the cne folder attributes to hide its content by executing the command\nFileSetAttrib($cne_Folder_Path, \"+H\").\n\n### 2. Persistence mechanism\n\nIn order to remain persistent, it modifies the Run registry key with a new key named\nWindowsUpdate that instructs the execution of axo.exe along with pwm-axa:\n```\nIf IsAdmin() Then\nRegWrite(\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\",\n$WindowsUpdate, \"REG_SZ\", $cne_Folder_Path & \"\\\" & $axo.exe & \" \" &\nFileGetShortName(FileGetShortName($cne_Folder_Path & \"\\\" & $pwm-axa)))\nElse\nRegWrite(\"HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\",\n$WindowsUpdate, \"REG_SZ\", $cne_Folder_Path & \"\\\" & $axo.exe & \" \" &\nFileGetShortName($cne_Folder_Path & \"\\\" & $pwm-axa))\nRegWrite(\"HKCU64\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\", $WindowsUpdate,\n\"REG_SZ\", $cne_Folder_Path & \"\\\" & $axo.exe & \" \" &\nFileGetShortName($cne_Folder_Path & \"\\\" & $pwm-axa))\nEndIf\nSleep(1000)\nSleep(1000)\nEndFunc\n\n```\nFigure 8: Persistence mechanism.\n\n### 3. Protection disabling and anti-analysis\n\nThe script tries to modify the following registry keys:\n\nRegWrite(\"HKCU64\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\",\n\"DisableTaskMgr\", \"REG_DWORD\", \"1\")\nRegDelete(\"HKLM64\\Software\\Microsoft\\Windows NT\\CurrentVersion\\SPP\\Clients\")\nRegWrite(\"HKLM64\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\",\n\"EnableLUA\", \"REG_DWORD\", \"0\")\n\nAnd it:\n\nDisables Task Manager\nTurns off the system protection\nDisables UAC (User Account Controls)\n\n\n-----\n\nFormbook will terminate if it finds VMware or VirtualBox processes running in the victim s\nsystem and if the 'D' drive has space of less than 1MB:\n\nVMwaretray.exe\nVbox.exe\nVMwareUser.exe\nVMwareService.exe\nVboxService.exe\nvpcmap.exe\nVBoxTray.exe\nIf DriveSpaceFree (\"d:\\\") <1 And ProcessExists ([VMWare or VBox]) then Exit\n\n### 4. Check default browser\n\nThe script will check the HKCR\\http\\shell\\open\\command registry key to know which\nInternet browser the victim's machine uses by default.\n\n### 5. Formbook deletion and termination\n\nFormbook will look for the svshost.exe process and terminate if it finds more than two\nsvshost.exe processes running, as shown in Figure 9.\n\nFigure 9: Termination.\n\n## Conclusion\n\nDespite Formbook infostealer having been around for a couple of years now, it only came to\npublic attention after it was extensively used in spam campaigns in late 2017. The fact that\nFormbook wasn't noticed before is probably because its developers didn't release the\nbuilder to the public, so it was easy for them to track its activities and turn it off if they found\nthat it was being used for purposes for which it was not intended or if it was gaining too\nmuch attention from the security community. Despite not being broadly used, Formbook\nrepresents a real threat, due to it being stealthier and more powerful than keyloggers.\n\nSimilar to the Agent Tesla remote access trojan (RAT), the author of Formbook initially\noffered a beta version of the product free of charge in order to receive feedback and make\nimprovements.\n\nThe 'ng-Coder' user indicates that Formbook should not be used for malicious purposes,\nand after the spam campaigns were made public, he blocked Formbook's sales until further\nnotice. According to 'ng-Coder', Formbook should only be used to spy on family members\nor employees if the user has the explicit right to do so. However, this claim itself is dubious\ngiven the barely legitimate nature of the use of such software.\n\n\n-----\n\n## IOCs\n\nThe SHA256 hash of the SFX file that was analysed is:\n2f74f8518bd14a882a870f3794a76dba381b59c1e40247a2483468959b572d82.\n\n## References\n\n[1] Schwarz, D. The Formidable FormBook Form Grabber. Arbor Networks, 20 September\n[2017. https://www.arbornetworks.com/blog/asert/formidable-formbook-form-grabber/.](https://www.arbornetworks.com/blog/asert/formidable-formbook-form-grabber/)\n\n[2] Villeneuve, N.; Eitzman, R.; Nemes S.; Dean, T. Significant FormBook Distribution\nCampaigns Impacting the U.S. and South Korea. FireEye, 5 October 2017.\nhttps://www.fireeye.com/blog/threat-research/2017/10/formbook-malware-distributioncampaigns.html.\n\n[3] Urgent server alert malspam delivers formbook trojan via CVE-2017-8570 word doc. My\nOnline Security, 16 February 2018. https://myonlinesecurity.co.uk/urgent-server-alertmalspam-delivers-formbook-trojan-via-cve-2017-8570-word-doc.\n\n## Latest articles:\n\n### Cryptojacking on the fly: TeamTNT using NVIDIA drivers to mine cryptocurrency\n\nTeamTNT is known for attacking insecure and vulnerable Kubernetes deployments in order\nto infiltrate organizations’ dedicated environments and transform them into attack\nlaunchpads. In this article Aditya Sood presents a new module introduced by…\n\n### Collector-stealer: a Russian origin credential and information extractor\n\nCollector-stealer, a piece of malware of Russian origin, is heavily used on the Internet to\nexfiltrate sensitive data from end-user systems and store it in its C&C panels. In this article,\nresearchers Aditya K Sood and Rohit Chaturvedi present a 360…\n\n### Fighting Fire with Fire\n\nIn 1989, Joe Wells encountered his first virus: Jerusalem. He disassembled the virus, and\nfrom that moment onward, was intrigued by the properties of these small pieces of selfreplicating code. Joe Wells was an expert on computer viruses, was partly…\n\n### Run your malicious VBA macros anywhere!\n\n\n-----\n\nKurt Natvig wanted to understand whether it s possible to recompile VBA macros to another\nlanguage, which could then easily be ‘run’ on any gateway, thus revealing a sample’s true\nnature in a safe manner. In this article he explains how he recompiled…\n\n### Dissecting the design and vulnerabilities in AZORult C&C panels\n\nAditya K Sood looks at the command-and-control (C&C) design of the AZORult malware,\ndiscussing his team's findings related to the C&C design and some security issues they\nidentified during the research.\n\n[Bulletin Archive](https://www.virusbulletin.com/virusbulletin/archive)\n\nWe have placed cookies on your device in order to improve the functionality of this site, as\n[outlined in our cookies policy. However, you may delete and block all cookies from this site](https://www.virusbulletin.com/about-vb/privacy-policy/cookies)\nand your use of the site will be unaffected. By continuing to browse this site, you are\n[agreeing to Virus Bulletin's use of data as outlined in our privacy policy.](https://www.virusbulletin.com/about-vb/privacy-policy/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-01-01 - VB2018 - Inside Formbook InfoStealer.pdf"
    ],
    "report_names": [
        "2019-01-01 - VB2018 - Inside Formbook InfoStealer.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "f809bfcb-b200-4988-80a8-be78ef6a52ef",
            "created_at": "2023-01-06T13:46:39.186988Z",
            "updated_at": "2025-03-27T02:00:03.016358Z",
            "deleted_at": null,
            "main_name": "TeamTNT",
            "aliases": [
                "Adept Libra"
            ],
            "source_name": "MISPGALAXY:TeamTNT",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "c3ca592f-0669-49bd-ab5c-310007ab2fb4",
            "created_at": "2022-10-25T15:50:23.334495Z",
            "updated_at": "2025-03-27T02:00:55.445098Z",
            "deleted_at": null,
            "main_name": "TeamTNT",
            "aliases": [
                "TeamTNT"
            ],
            "source_name": "MITRE:TeamTNT",
            "tools": [
                "Peirates",
                "MimiPenguin",
                "LaZagne",
                "Hildegard"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535732,
    "ts_updated_at": 1743041531,
    "ts_creation_date": 1653757059,
    "ts_modification_date": 1653757059,
    "files": {
        "pdf": "https://archive.orkl.eu/69769fd0fc91ef1de40e9092ab041ba40db9426b.pdf",
        "text": "https://archive.orkl.eu/69769fd0fc91ef1de40e9092ab041ba40db9426b.txt",
        "img": "https://archive.orkl.eu/69769fd0fc91ef1de40e9092ab041ba40db9426b.jpg"
    }
}