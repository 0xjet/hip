{
    "id": "5f3b73af-c53a-477d-9a1a-7cd5ee7b66ba",
    "created_at": "2022-10-25T16:48:11.102559Z",
    "updated_at": "2025-03-27T02:16:16.832047Z",
    "deleted_at": null,
    "sha1_hash": "0511740e527c025858aa577e7b6b198f28e2a1ac",
    "title": "",
    "authors": "",
    "file_creation_date": "2019-10-16T15:38:34Z",
    "file_modification_date": "2019-10-16T15:38:34Z",
    "file_size": 951404,
    "plain_text": "# LOWKEY: Hunting for the Missing Volume Serial ID\n\n**[fireeye.com/blog/threat-research/2019/10/lowkey-hunting-for-the-missing-volume-serial-id.html](https://www.fireeye.com/blog/threat-research/2019/10/lowkey-hunting-for-the-missing-volume-serial-id.html)**\n\n[In August 2019, FireEye released the “Double Dragon” report on our newest graduated threat](https://content.fireeye.com/apt41/rpt-apt41)\ngroup: APT41. A China-nexus dual espionage and financially-focused group, APT41 targets\nindustries such as gaming, healthcare, high-tech, higher education, telecommunications, and\ntravel services.\n\nThis blog post is about the sophisticated passive backdoor we track as LOWKEY, mentioned in\n[the APT41 report and recently unveiled at the FireEye Cyber Defense Summit. We observed](https://summit.fireeye.com/)\nLOWKEY being used in highly targeted attacks, utilizing payloads that run only on specific\nsystems. Additional malware family names are used in the blog post and briefly described. For a\ncomplete overview of malware used by APT41 please refer to the Technical Annex section of our\n[APT41 report.](https://content.fireeye.com/apt-41/rpt-apt41/)\n\nThe blog post is split into three parts, which are shown in Figure 1. The first describes how we\nmanaged to analyze the encrypted payloads. The second part features position independent\nloaders we observed in multiple samples, adding an additional layer of obfuscation. The final part\nis about the actual backdoor we call LOWKEY, which comes in two variants, a passive TCP\nlistener and a passive HTTP listener targeting Internet Information Services (IIS).\n\nFigure 1: Blog post overview\n\n## DEADEYE – RC5\n\n\n-----\n\nTracking APT41 activities over the past months, we observed multiple samples that shared two\nunique features: the use of RC5 encryption which we don’t encounter often, and a unique string\n“f@Ukd!rCto R$.”. We track these samples as DEADEYE.\n\nDEADEYE comes in multiple variants:\n\nDEADEYE.DOWN has the capability to download additional payloads.\nDEADEYE.APPEND has additional payloads appended to it.\nDEADEYE.EXT loads payloads that are already present on the system.\n\n## DEADEYE.DOWN\n\nA sample belonging to DEADEYE.DOWN (MD5: 5322816c2567198ad3dfc53d99567d6e)\nattempts to download two files on the first execution of the malware.\n\nThe first file is downloaded from hxxp://checkin.travelsanignacio[.]com/static/20170730.jpg. The\ncommand and control (C2) server response is first RC5 decrypted with the key “wsprintfA” and\nthen RC5 encrypted with a different key and written to disk as <MODULE_NAME>.mui.\n\nThe RC5 key is constructed using the volume serial number of the C drive. The volume serial\nnumber is a 4-byte value, usually based on the install time of the system. The volume serial\nnumber is XORed with the hard-coded constant “f@Ukd!rCto R$.” and then converted to hex to\nderive a key of up to 28 bytes in length. The key length can vary if the XORed value contains an\nembedded zero byte because the lstrlenA API call is used to determine the length of it. Note that\nthe lstrlenA API call happens before the result is converted to hex. If the index of the byte modulo\n4 is zero, the hex conversion is in uppercase. The key derivation is illustrated in Table 1.\n\nVolume Serial number of C drive, for example 0xAABBCCDD\n\nF     ^     0xAA =     0xCC uppercase\n\n@     ^     0xBB =     0xFB lowercase\n\nU     ^     0xCC =     0x99 lowercase\n\nk     ^     0xDD =     0xB6 lowercase\n\nd     ^     0xAA =     0xCE uppercase\n\n!      ^     0xBB =     0x9A lowercase\n\nr      ^     0xCC =     0xBE lowercase\n\nC     ^     0xDD =     0x9E lowercase\n\nt      ^     0xAA =     0xDE uppercase\n\n|Volume Serial number of C drive, for example 0xAABBCCDD|Col2|Col3|\n|---|---|---|\n|F ^ 0xAA|= 0xCC|uppercase|\n|@ ^ 0xBB|= 0xFB|lowercase|\n|U ^ 0xCC|= 0x99|lowercase|\n|k ^ 0xDD|= 0xB6|lowercase|\n|d ^ 0xAA|= 0xCE|uppercase|\n|! ^ 0xBB|= 0x9A|lowercase|\n|r ^ 0xCC|= 0xBE|lowercase|\n|C ^ 0xDD|= 0x9E|lowercase|\n\n\n-----\n\no     ^     0xBB =     0xD4 lowercase\n\n(0x20)  ^     0xCC =     0xEC lowercase\n\nR     ^     0xDD =     0x8F lowercase\n\n$     ^     0xAA =     0x8E uppercase\n\n.      ^     0xBB =     0x95 lowercase\n\nDerived key CCfb99b6CE9abe9eDEd4ec8f8E95\n\nTable 1: Key derivation example\n\nThe second file is downloaded from hxxp://checkin.travelsanignacio[.]com/static/20160204.jpg.\nThe C2 response is RC5 decrypted with the key “wsprintfA” and then XORed with 0x74, before it\nis saved as C:\\Windows\\System32\\wcnapi.mui.\n\nFigure 2: 5322816c2567198ad3dfc53d99567d6e download\n\nThe sample then determines its own module name, appends the extension mui to it and attempts\nto decrypt the file using RC5 encryption. This effectively decrypts the file the malware just\ndownloaded and stored encrypted on the system previously. As the file has been encrypted with a\nkey based on the volume serial number it can only be executed on the system it was downloaded\non or a system that has the same volume serial number, which would be a remarkable\ncoincidence\n\n|(0x20) ^ 0xCC|= 0xEC|lowercase|\n|---|---|---|\n|R ^ 0xDD|= 0x8F|lowercase|\n|$ ^ 0xAA|= 0x8E|uppercase|\n|. ^ 0xBB|= 0x95|lowercase|\n|Derived key CCfb99b6CE9abe9eDEd4ec8f8E95|||\n\n\n-----\n\nAn example mui file is the MD5 hash e58d4072c56a5dd3cc5cf768b8f37e5e. Looking at the\nencrypted file in a hex editor reveals a high entropy (7.999779/8). RC5 uses Electronic Code\nBook (ECB) mode by default. ECB means that each code block (64 bit) is encrypted independent\nfrom other code blocks. This means the same plaintext block always results in the same cipher\ntext, independent from its position in the binary. The file has 792933 bytes in total but almost no\nduplicate cipher blocks, which means the data likely has an additional layer of encryption.\n\nWithout the correct volume serial number nor any knowledge about the plaintext there is no\nefficient way to decrypt the payload e58d4072c56a5dd3cc5cf768b8f37e5e with just the\nknowledge of the current sample.\n\n## DEADEYE.APPEND\n\nFortunately searching for the unique string “f@Ukd!rCto R$.“ in combination with artifacts from\nRC5 reveals additional samples. One of the related samples is DEADEYE.APPEND (MD5:\n**37e100dd8b2ad8b301b130c2bca3f1ea), which has been previously analyzed by Kaspersky**\n(https://securelist.com/operation-shadowhammer-a-high-profile-supply-chain-attack/90380/). This\nsample is different because it is protected with VMProtect and has the obfuscated binary\nappended to it. The embedded binary starts at offset 3287552 which can be seen in Figure 3 with\nthe differing File Size and PE Size.\n\n\n-----\n\nFigure 3: A look at the PE header reveals a larger file size than PE size\n\nThe encrypted payload has a slightly lower entropy of 7.990713 out of 8. Looking at the\nembedded binary in a hex editor reveals multiple occurrences of the byte pattern 51 36 94 A4 26\n5B 0F 19, as seen in Figure 4. As this pattern occurs multiple times in a row in the middle of the\nencrypted data and ECB mode is being used, an educated guess is that the plaintext is supposed\nto be 00 00 00 00 00 00 00 00.\n\nFigure 4: Repeating byte pattern in 37e100dd8b2ad8b301b130c2bca3f1ea\n\n## RC5 Brute Forcer\n\n[With this knowledge we decided to take a reference implementation of RC5 and add a main](https://github.com/stamparm/cryptospecs/blob/master/symmetrical/sources/rc5.c)\nfunction that accounts for the key derivation algorithm used by the malware samples (see Figure\n5). Brute forcing is possible as the key is derived from a single DWORD; even though the final\nkey length might be 28 bytes, there are only 4294967296 possible keys. The code shown in\nFigure 5 generates all possible volume serial numbers, derives the key from them and tries to\ndecrypt 51 36 94 A4 26 5B 0F 19 to 00 00 00 00 00 00 00 00. Running the RC5 brute forcer for a\ncouple of minutes shows the correct volume serial number for the sample, which is 0xc25cff4c.\n\n_Note if you want to run the brute forcer yourself_\nThe number of DWORDs of the key in the reference implementation we used is represented by\nthe global c, and we had to change it to 7 to match the malware’s key length of 28 bytes. There\nwere some issues with the conversion because in the malware a zero byte within the generated\nkey ultimately leads to a shorter key length. The implementation we used uses a hard-coded key\nlength (c), so we generated multiple executables with c = 6, c = 5, c = 4… as these usually only\nran for a couple of minutes to cover the entire key space. All the samples mentioned in the\nAppendix 1 could be solved with c = 7 or c = 6.\n\n\n-----\n\nFigure 5: Main function RC5 brute forcer\n\nThe decrypted payload belongs to the malware family POISONPLUG (MD5:\n**84b69b5d14ba5c5c9258370c9505438f). POISONPLUG is a highly obfuscated modular**\nbackdoor with plug-in capabilities. The malware is capable of registry or service persistence, selfremoval, plug-in execution, and network connection forwarding. POISONPLUG has been\nobserved using social platforms to host encoded command and control commands.\n\nWe confirmed the findings from Kaspersky and additionally found a second command and control\nURL hxxps://steamcommunity[.]com/id/oswal053, as mentioned in our APT 41 report.\n\n\n-----\n\nTaking everything into account that we learned from DEADEYE.APPEND\n(MD5: 37e100dd8b2ad8b301b130c2bca3f1ea), we decided to take another look at the\nencrypted mui file (e58d4072c56a5dd3cc5cf768b8f37e5e). Attempts to brute force the first bytes\nto match with the ones of the decrypted POISONPLUG payload did not yield any results.\n\nFortunately, we found additional samples that use the same encryption scheme. In one of the\nsamples the malware authors included two checks to validate the decrypted payload. The\nexpected plaintext at the specified offsets for DEADEYE.APPEND (MD5:\n**7f05d410dc0d1b0e7a3fcc6cdda7a2ff) is shown in Table 2.**\n\n**Offset** **Expected byte after decryption**\n\n0 0x48\n\n1 0x8B\n\n0x3C0 0x48\n\n0x3C1 0x83\n\nTable 2: Byte comparisons after decrypting in DEADEYE.APPEND (MD5:\n**7f05d410dc0d1b0e7a3fcc6cdda7a2ff)**\n\nApplying these constraints to our brute forcer and trying to decrypt mui file\n(e58d4072c56a5dd3cc5cf768b8f37e5e) once moreresulted in a low number of successful hits\nwhich we could then manually check. The correct volume serial number for the encrypted mui is\n0x243e2562. Analysis determined the decrypted file is XMRig miner. This also explains why the\ndropper downloads two files. The first, <MODULE_NAME>.mui is the crypto miner, and the\nsecond C:\\Windows\\System32\\wcnapi.mui, is the configuration. The decrypted mui contains\nanother layer of obfuscation and is eventually executed with the command x -c wcnapi.mui. An\nexplanation on how the command was obtained and the additional layer of obfuscation is given in\nthe next part of the blog post.\n\nFor a list of samples with the corresponding volume serial numbers, please refer to Appendix 1.\n\n## Additional RC4 Layer\n\nAn additional RC4 layer has been identified in droppers used by APT41, which we internally track\n[as DEADEYE. The layer has been previously detailed in a blog post by ESET. We wanted to](https://www.welivesecurity.com/2019/03/11/gaming-industry-scope-attackers-asia/)\nprovide some additional information on this, as it was used in some of the samples we managed\nto brute force.\n\nThe additional layer is position independent shellcode containing a reflective DLL loader. The\nloader decrypts an RC4 encrypted payload and loads it in memory. The code itself is a straight\nforward loader with the exception of some interesting artifacts identified during analysis.\n\n|Offset|Expected byte after decryption|\n|---|---|\n|0|0x48|\n|1|0x8B|\n|0x3C0|0x48|\n|0x3C1|0x83|\n\n\n-----\n\nAs mentioned in the blog post by ESET, the encrypted payload is prepended with a header. It\ncontains the RC4 encryption key and two fields of variable length, which have previously been\nidentified as file names. These two fields are encrypted with the same RC4 encryption key that is\nalso used to decrypt the payload. The header is shown in Table 3.\n\n**Header bytes** **Meaning**\n\n0 – 15 RC4 key XOR encoded with 0x37\n\n16 – 19 Size of loader stub before the header\n\n20 – 23 RC4 key size\n\n24 – 27 Command ASCII size (CAS)\n\n28 – 31 Command UNICODE size (CUS)\n\n32 – 35 Size of encrypted payload\n\n36 – 39 Launch type\n\n40 – (40 + CAS) Command ASCII\n\n(40 + CAS) – (40 + CAS + CUS) Command UNICODE\n\n(40 + CAS + CUS) – (40 + CAS + CUS + size of encrypted payload) Encrypted payload\n\nTable 3: RC4 header overview\n\nLooking at the payloads hidden behind the RC5 layer, we observed, that these fields are not\nlimited to file names, instead they can also contain commands used by the reflective loader. If no\ncommand is specified, the default parameter is the file name of the loaded payload. In some\ninstances, this revealed the full file path and file name in the development environment. Table 4\nshows some paths and file names. This is also how we found the command (x -c wcnapi.mui)\nused to launch the decrypted mui file from the first part of the blog post.\n\n|Header bytes|Meaning|\n|---|---|\n|0 – 15|RC4 key XOR encoded with 0x37|\n|16 – 19|Size of loader stub before the header|\n|20 – 23|RC4 key size|\n|24 – 27|Command ASCII size (CAS)|\n|28 – 31|Command UNICODE size (CUS)|\n|32 – 35|Size of encrypted payload|\n|36 – 39|Launch type|\n|40 – (40 + CAS)|Command ASCII|\n|(40 + CAS) – (40 + CAS + CUS)|Command UNICODE|\n|(40 + CAS + CUS) – (40 + CAS + CUS + size of encrypted payload)|Encrypted payload|\n\n|MD5 hash|Arguments found in the RC4 layer|\n|---|---|\n|7f05d410dc0d1b0e7a3fcc6cd‐ da7a2ff|E:\\code\\PortReuse\\3389-share\\DeviceIOContrl-Hook\\v1.3-53\\Inner- Loader\\x64\\Release\\Inner-Loader.dll|\n\n\n7f05d410dc0d1b0e7a3fcc6cd‐\nda7a2ff\n\n\nE:\\code\\PortReuse\\3389-share\\DeviceIOContrl-Hook\\v1.353\\NetAgent\\x64\\Release\\NetAgent.exe\n\n\n-----\n\n7f05d410dc0d1b0e7a3fcc6cd‐\nda7a2ff\n\n\nE:\\code\\PortReuse\\3389-share\\DeviceIOContrl-Hook\\v1.353\\SK3.x\\x64\\Release\\SK3.x.exe\n\n|7f05d410dc0d1b0e7a3fcc6cd‐ da7a2ff|UserFunction.dll|\n|---|---|\n|7f05d410dc0d1b0e7a3fcc6cd‐ da7a2ff|ProcTran.dll|\n|c11d‐ d805de683822bf4922aecb9bfef5|E:\\code\\PortReuse\\iis-share\\2.5\\IIS_Share\\x64\\Release\\IIS_Share.dll|\n|c11d‐ d805de683822bf4922aecb9bfef5|UserFunction.dll|\n|c11d‐ d805de683822bf4922aecb9bfef5|ProcTran.dll|\n\n\nTable 4: Decrypted paths and file names\n\n## LOWKEY\n\nThe final part of the blog post describes the capabilities of the passive backdoor LOWKEY (MD5:\n**8aab5e2834feb68bb645e0bad4fa10bd) decrypted from DEADEYE.APPEND (MD5:**\n**7f05d410dc0d1b0e7a3fcc6cdda7a2ff). LOWKEY is a passive backdoor that supports**\ncommands for a reverse shell, uploading and downloading files, listing and killing processes and\nfile management. We have identified two variants of the LOWKEY backdoor.\n\nThe first is a TCP variant that listens on port 53, and the second is an HTTP variant that listens on\nTCP port 80. The HTTP variant intercepts URL requests matching the UrlPrefix\nhttp://+:80/requested.html. The + in the given UrlPrefix means that it will match any host name. It\n[has been briefly mentioned by Kaspersky as “unknown backdoor”.](https://securelist.com/operation-shadowhammer-a-high-profile-supply-chain-attack/90380/)\n\nBoth variants are loaded by the reflective loader described in the previous part of the blog post.\nThis means we were able to extract the original file names. They contain meaningful names and\nprovide a first hint on how the backdoor operates.\n\n_HTTP variant (MD5: c11dd805de683822bf4922aecb9bfef5)_\nE:\\code\\PortReuse\\iis-share\\2.5\\IIS_Share\\x64\\Release\\IIS_Share.dll\n\n_TCP variant (MD5: 7f05d410dc0d1b0e7a3fcc6cdda7a2ff)_\nE:\\code\\PortReuse\\3389-share\\DeviceIOContrl-Hook\\v1.3-53\\SK3.x\\x64\\Release\\SK3.x.exe\n\nThe interesting parts are shown in Figure 6. PortReuse describes the general idea behind the\nbackdoor, to operate on a well-known port. The paths also contain version numbers 2.5 and v1.353. IIS_Share is used for the HTTP variant and describes the targeted application,\nDeviceIOContrl-Hook is used for the TCP variant.\n\n\n-----\n\nFigure 6: Overview important parts of executable path\n\n\n-----\n\nBoth LOWKEY variants are functionally identical with one exception. The TCP variant relies on a\nsecond component, a user mode rootkit that is capable of intercepting incoming TCP\nconnections. The internal name used by the developers for that component is\nE:\\code\\PortReuse\\3389-share\\DeviceIOContrl-Hook\\v1.353\\NetAgent\\x64\\Release\\NetAgent.exe.\n\nFigure 7: LOWKEY components\n\n## Inner-Loader.dll\n\nInner-Loader.dll is a watch guard for the LOWKEY backdoor. It leverages the\nGetExtendedTcpTable API to retrieve all processes with an open TCP connection. If a process is\nlistening on TCP port 53 it injects NetAgent.exe into the process. This is done in a loop with a 10\nsecond delay. The loader exits the loop when NetAgent.exe has been successfully injected. After\nthe injection it will create a new thread for the LOWKEY backdoor (SK3.x.exe).\n\nThe watch guard enters an endless loop that executes every 20 minutes and ensures that the\nNetAgent.exe and the LOWKEY backdoor are still active. If this is not the case it will relaunch the\nbackdoor or reinject the NetAgent.exe.\n\n## NetAgent.exe\n\nNetAgent.exe is a user mode rootkit that provides covert communication with the LOWKEY\nbackdoor component. It forwards incoming packets, after receiving the byte sequence FF FF 01\n00 00 01 00 00 00 00 00 00, to the named pipe \\\\.\\pipe\\Microsoft Ole Object {30000-7100-1298500001-00001}.\n\nThe component works by hooking the NtDeviceIoControlFile API. It does that by allocating a\nsuspiciously large region of memory, which is used as a global hook table. The table consists of\n\n\n-----\n\nEach hook table entry consists of 3 pointers. The first points to memory containing the original 11\nbytes of each hooked function, the second entry contains a pointer to the remaining original\ninstructions and the third pointer points to the function hook. The malware will only hook one\nfunction in this manner and therefore allocates an unnecessary large amount of memory. The\nmalware was designed to hook up to 10000 functions this way.\n\nThe hook function begins by iterating the global hook table and compares the pointer to the hook\nfunction to itself. This is done to find the original instructions for the installed hook, in this\ncase NtDeviceIoControlFile. The malware then executes the saved instructions which results in a\nregular NtDeviceIoControlFile API call. Afterwards the IoControlCode is compared to 0x12017\n(AFD_RECV).\n\nIf the IoControlCode does not match, the original API call results are returned.\n\nIf they match the malware compares the first 12 bytes of the incoming data. As it is effectively a\nTCP packet, it is parsing the TCP header to get the data of the packet. The first 12 bytes of\nthe data section are compared against the hard-coded byte pattern: FF FF 01 00 00 01 00 00 00\n00 00 00.\n\nIf they match it expects to receive additional data, which seems to be unused, and then responds\nwith a 16 byte header 00 00 00 00 00 91 03 00 00 00 00 00 80 1F 00 00, which seems to be\nhard-coded and to indicate that following packets will be forwarded to the named\npipe \\\\.\\pipe\\Microsoft Ole Object {30000-7100-12985-00001-00001}. The backdoor\ncomponent (SK3.x.exe) receives and sends data to the named pipe. The hook function will\nforward all received data from the named pipe back to the socket, effectively allowing a covert\ncommunication between the named pipe and the socket.\n\n## SK3.x.exe\n\nSK3.x.exe is the actual backdoor component. It supports writing and reading files, modification of\nfile properties, an interactive command shell, TCP relay functionality and listing running\nprocesses. The backdoor opens a named pipe \\\\.\\pipe\\Microsoft Ole Object {30000-7100-1298500001-00001} for communication.\n\nData received by the backdoor is encrypted with RC4 using the key “CreateThread“ and then\nXORed with 0x77. All data sent by the backdoor uses the same encryption in reverse order (first\nXOR with 0x77, then RC4 encrypted with the key “CreateThread“). Encrypted data is preceded by\na 16-byte header which is unencrypted containing an identifier and the size of the following\nencrypted packet.\n\nAn example header looks as follows:\n00 00 00 00 00 FD 00 00 10 00 00 00 00 00 00 00\n\n|Bytes|Meaning|\n|---|---|\n|00 00 00 00 00|unknown|\n\n\n-----\n\nFD 00 Bytes 5 and 6 are the command identifier, for a list of all supported identifiers check Table 6\nand Table 7.\n\n00 unknown\n\n10 00 00 00 Size of the encrypted packet that is send after the header\n\n00 00 00 00 unknown\n\nTable 5: Subcomponents of header\n\nThe backdoor supports the commands listed in tables Table 6 and Table 7. Most commands\nexpect a string at the beginning which likely describes the command and is for the convenience of\nthe operators, but this string isn't actively used by the malware and could be anything. For\nexample, KILL <PID> could also be A <PID>. Some of the commands rely on two payloads\n(UserFunction.dll and ProcTran.dll), that are embedded in the backdoor and are either injected\ninto another process or launch another process.\n\n## UserFunction.dll\n\nUserfunction.dll starts a hidden cmd.exe process, creates the named pipe \\\\.\\pipe\\Microsoft Ole\nObject {30000-7100-12985-00000-00000} and forwards all received data from the pipe to the\nstandard input of the cmd.exe process. All output from the process is redirected back to the\nnamed pipe. This allows interaction with the shell over the named pipe.\n\n## ProcTran.dll\n\nThe component opens a TCP connection to the provided host and port, creates the named\npipe \\\\.\\pipe\\Microsoft Ole Object {30000-7100-12985-00000-00001} and forwards all received\ndata from the pipe to the opened TCP connection. All received packets on the connection are\nforwarded to the named pipe. This allows interaction with the TCP connection over the named\npipe.\n\n|00|unknown|\n|---|---|\n|10 00 00 00|Size of the encrypted packet that is send after the header|\n|00 00 00 00|unknown|\n\n|Iden‐ tifier|Argu‐ ments|Description|\n|---|---|---|\n|0xC8|<cmd> <arg1> <arg2>|Provides a simple shell, that supports the following commands, dir, copy, move, del, sys‐ teminfo and cd. These match the functionality of standard commands from a shell. This is the only case where the <cmd> is actually used.|\n|0xC9|<cmd> <arg1>|The argument is interpreted as a process id (PID). The backdoor injects UserFunction.dll into the process, which is an interactive shell that forwards all input and output data to Microsoft Ole Object {30000-7100-12985-00000-00000}. The backdoor will then forward incoming data to the named pipe allowing for communication with the opened shell. If no PID is provided, the `cmd.exe` is launched as child process of the backdoor process with input and output redirected to the named pipe Microsoft Ole Object {30000-7100-12985- 00001-00001}|\n\n\n-----\n\n0xCA <cmd>\n<arg1>\n<arg2>\n\n\nWrites data to a file. The first argument is the <file_name>, the second argument is an\noffset into the file\n\n|0xCB|<cmd> <arg1> <arg2> <arg3>|Reads data from a file. The first argument is the <file_name>, the second argument is an offset into the file, the third argument is optional, and the exact purpose is unknown|\n|---|---|---|\n|0xFA|-|Lists running processes, including the process name, PID, process owner and the exe‐ cutable path|\n|0xFB|<cmd> <arg1>|Kills the process with the provided process id (PID)|\n|0xFC|<cmd> <arg1> <arg2>|Copies the files CreationTime, LastAccessTime and LastWriteTime from the second ar‐ gument and applies them to the first argument. Both arguments are expected to be full file paths. The order of the arguments is a bit unusual, as one would usually apply the ac‐ cess times from the second argument to the third|\n|0xFD|-|List running processes with additional details like the SessonId and the CommandLine by executing the WMI query SELECT Name,ProcessId,SessionId,CommandLine,Exe‐ cutablePath FROM Win32_Process|\n|0xFE|-|Ping command, the malware responds with the following byte sequence 00 00 00 00 00 65 00 00 00 00 00 00 06 00 00 00. Experiments with the backdoor revealed that the iden‐ tifier 0x65 seems to indicate a successful operation, whereas 0x66 indicates an error.|\n\n\nTable 6: C2 commands\n\nThe commands listed in Table 7 are used to provide functionality of a TCP traffic relay. This\nallows operators to communicate through the backdoor with another host via TCP. This could be\nused for lateral movement in a network. For example, one instance of the backdoor could be used\nas a jump host and additional hosts in the target network could be reached via the TCP traffic\nrelay. Note that the commands 0xD2, 0xD3 and 0xD6 listed in Table 7 can be used in the main\nbackdoor thread, without having to use the ProcTran.dll.\n\n|Iden‐ tifier|Argu‐ ments|Description|\n|---|---|---|\n|0x105|<cmd> <arg1>|The argument is interpreted as a process id (PID). The backdoor injects ProcTran.dll into the process, which is a TCP traffic relay component that forwards all input and output data to Microsoft Ole Object {30000-7100-12985-00000-00001}. The commands 0xD2, 0xD3 and 0xD6 can then be used with the component.|\n\n\n0xD2 <arg1>\n<arg2>\n\n\nOpens a connection to the provided host and port, the first argument is the host, the sec‐\nond the port. On success a header with the identifier set to 0xD4 is returned (00 00 00\n00 00 D4 00 00 00 00 00 00 00 00 00 00). This effectively establishes a TCP traffic relay\nallowing operators to communicate with another system through the backdoored\nmachine.\n\n\n-----\n\n0xD3 <arg1> Receives and sends data over the connection opened by the 0xD2 command. Received\ndata is first RC4 decrypted with the key “CreateThread“ and then single-byte XOR de‐\ncoded with 0x77. Data sent back is directly relayed without any additional encryption.\n\n0xD6 - Closes the socket connection that had been established by the 0xD2 command\n\n0xCF - Closes the named pipe Microsoft Ole Object {30000-7100-12985-00000-00001} that is\nused to communicate with the injected ProcTran.dll. This seems to terminate the thread\nin the targeted process by the 0x105 command\n\nTable 7: C2 commands TCP relay\n\n## Summary\n\nThe TCP LOWKEY variant passively listens for the byte sequence FF FF 01 00 00 01 00 00 00\n00 00 00 on TCP port 53 to be activated. The backdoor then uses up to three named pipes for\ncommunication. One pipe is used for the main communication of the backdoor, the other ones are\nused on demand for the embedded payloads.\n\n\\\\.\\pipe\\Microsoft Ole Object {30000-7100-12985-00001-00001} main communication pipe\n\\\\.\\pipe\\Microsoft Ole Object {30000-7100-12985-00000-00001} named pipe used for\ninteraction with the TCP relay module ProcTran.dll\n\\\\.\\pipe\\Microsoft Ole Object {30000-7100-12985-00000-00000} named pipe used for the\ninteractive shell module UserFunction.dll\n\nFigure 8 summarizes how the LOWKEY components interact with each other.\n\n|0xD6|-|Closes the socket connection that had been established by the 0xD2 command|\n|---|---|---|\n|0xCF|-|Closes the named pipe Microsoft Ole Object {30000-7100-12985-00000-00001} that is used to communicate with the injected ProcTran.dll. This seems to terminate the thread in the targeted process by the 0x105 command|\n\n\n-----\n\nFigure 8: LOWKEY passive backdoor overview\n\n## Appendix\n\n|MD5 HASH|Correct Volume Serial|Dropper Family|Final Payload Family|\n|---|---|---|---|\n|2b9244c526e2c2b6d40e79a8c3ed‐ b93c|0xde82ce06|DEADEYE.AP‐ PEND|POISONPLUG|\n|04be89f‐ f5d217796bc68678d2508a0d7|0x56a80cc8|DEADEYE.AP‐ PEND|POISONPLUG|\n|092ae9ce61f6575344c424967b‐ d79437|0x58b5ef5c|DEADEYE.AP‐ PEND|LOWKEY.HTTP|\n|37e100dd8b2ad8b301b130c2b‐ ca3f1ea|0xc25cff4c|DEADEYE.AP‐ PEND|POISONPLUG|\n|39fe65a46c03b930c‐ cf0d552ed3c17b1|0x24773b24|DEADEYE.AP‐ PEND|POISONPLUG|\n\n\n-----\n\n5322816c2567198ad3d‐\nfc53d99567d6e\n\n\n- DEADEYE.DOWN \n|557ff68798c71652d‐ b8a85596a4bab72|0x4cebb6e9|DEADEYE.AP‐ PEND|POISONPLUG|\n|---|---|---|---|\n|64e09cf2894d6e5ac50207edf‐ f787ed7|0x64fd8753|DEADEYE.AP‐ PEND|POISONPLUG|\n|650a3dce1380f9194361e0c7be9ff‐ b97|0xeaa61f82|DEADEYE.AP‐ PEND|POISONPLUG|\n|7dc6bbc202e039d‐ d989e1e2a93d2ec2d|0xa8c5a006|DEADEYE.AP‐ PEND|LOWKEY|\n|7f05d410dc0d1b0e7a3fcc6cdda7a2ff|0x9438158b|DEADEYE.AP‐ PEND|LOWKEY|\n|904bbe5ac0d53e74a6cefb14eb‐ d58c0b|0xde82ce06|DEADEYE.AP‐ PEND|POISONPLUG|\n|c11dd805de683822bf4922aecb9bfe‐ f5|0xcab011e1|DEADEYE.AP‐ PEND|LOWKEY.HTTP|\n|d49c186b1bfd7c9233e5815c2572e‐ b98|0x4a23bd79|DEADEYE.AP‐ PEND|LOWKEY|\n|e58d4072c56a5dd3c‐ c5cf768b8f37e5e|0x243e2562|None - encrypted data|XMRIG|\n|eb37c75369046fb1076450b3c34f‐ b8ab|0x00e5a39e|DEADEYE.AP‐ PEND|LOWKEY|\n|ee5b707249c562d‐ c916b125e32950c8d|0xdecb3d5d|DEADEYE.AP‐ PEND|POISONPLUG|\n|ff8d92dfbcda572ef97c142017eec658|0xde82ce06|DEADEYE.AP‐ PEND|POISONPLUG|\n|ffd0f34739c1568797891b9961111464|0xde82ce06|DEADEYE.AP‐ PEND|POISONPLUG|\n\n\nAppendix 1: List of samples with RC5 encrypted payloads\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2019/2019.10.15.LOWKEY/LOWKEY_%20Hunting%20for%20the%20Missing%20Volume%20Serial%20ID.pdf"
    ],
    "report_names": [
        "LOWKEY_ Hunting for the Missing Volume Serial ID"
    ],
    "threat_actors": [
        {
            "id": "1c97ccfd-1888-492c-b7b9-bb52c4c3809b",
            "created_at": "2023-01-06T13:46:38.940529Z",
            "updated_at": "2025-03-27T02:00:02.957652Z",
            "deleted_at": null,
            "main_name": "Operation ShadowHammer",
            "aliases": [],
            "source_name": "MISPGALAXY:Operation ShadowHammer",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "4c68ccd0-caba-4189-9ead-86ac4c2d9b70",
            "created_at": "2024-05-01T02:03:07.930196Z",
            "updated_at": "2025-03-27T02:05:17.251237Z",
            "deleted_at": null,
            "main_name": "BRONZE ATLAS",
            "aliases": [
                "Axiom",
                "BARIUM ",
                "Blackfly ",
                "CTG-2633",
                "GREF",
                "Group 72 ",
                "Red Kelpie ",
                "TG-2633 ",
                "Wicked Panda ",
                "Winnti",
                "APT41 "
            ],
            "source_name": "Secureworks:BRONZE ATLAS",
            "tools": [
                " CCleaner v5.33 backdoor",
                " ChinaChopper",
                " Cobalt Strike",
                " Dicey MSDN",
                " ForkPlayground",
                " HUC Proxy Malware (Htran)",
                " Mimikatz",
                " PipeMon",
                " PlugX",
                " PortReuse",
                " Powershell Empire",
                " RCMD",
                " RbDoor",
                " SPEEDBOAT",
                " ShadowPad",
                " Sidewalk",
                " Speculoos",
                " TeamViewer",
                " Winnkit",
                " Winnti",
                " reg save",
                " vssadmin",
                "Acehash"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "c7d9878a-e691-4c6f-81ae-84fb115a1345",
            "created_at": "2022-10-25T16:07:23.359506Z",
            "updated_at": "2025-03-27T02:02:09.752427Z",
            "deleted_at": null,
            "main_name": "APT 41",
            "aliases": [
                "BrazenBamboo",
                "Bronze Atlas",
                "Double Dragon",
                "Earth Baku",
                "Grayfly",
                "Operation ColunmTK",
                "Operation CuckooBees",
                "Operation ShadowHammer",
                "Red Kelpie",
                "SparklingGoblin",
                "TA415",
                "TG-2633"
            ],
            "source_name": "ETDA:APT 41",
            "tools": [
                "9002 RAT",
                "ADORE.XSEC",
                "ASPXSpy",
                "ASPXTool",
                "AceHash",
                "Agent.dhwf",
                "Agentemis",
                "AndroidControl",
                "AngryRebel",
                "AntSword",
                "BIOPASS",
                "BIOPASS RAT",
                "BLUEBEAM",
                "Barlaiy",
                "BlackCoffee",
                "Bladabindi",
                "BleDoor",
                "CCleaner Backdoor",
                "CHINACHOPPER",
                "COLDJAVA",
                "China Chopper",
                "ChyNode",
                "Cobalt Strike",
                "CobaltStrike",
                "Crackshot",
                "CrossWalk",
                "CurveLast",
                "CurveLoad",
                "DAYJOB",
                "DBoxAgent",
                "DEADEYE",
                "DEADEYE.APPEND",
                "DEADEYE.EMBED",
                "DEPLOYLOG",
                "DIRTCLEANER",
                "DUSTTRAP",
                "Derusbi",
                "Destroy RAT",
                "DestroyRAT",
                "DodgeBox",
                "DragonEgg",
                "ELFSHELF",
                "EasyNight",
                "Farfli",
                "FunnySwitch",
                "Gh0st RAT",
                "Ghost RAT",
                "HDD Rootkit",
                "HDRoot",
                "HKDOOR",
                "HOMEUNIX",
                "HUI Loader",
                "HidraQ",
                "HighNoon",
                "HighNote",
                "Homux",
                "Hydraq",
                "Jorik",
                "Jumpall",
                "KEYPLUG",
                "Kaba",
                "Korplug",
                "LATELUNCH",
                "LOLBAS",
                "LOLBins",
                "LightSpy",
                "Living off the Land",
                "Lowkey",
                "McRAT",
                "MdmBot",
                "MessageTap",
                "Meterpreter",
                "Mimikatz",
                "MoonBounce",
                "MoonWalk",
                "Motnug",
                "Moudour",
                "Mydoor",
                "NTDSDump",
                "PACMAN",
                "PCRat",
                "PINEGROVE",
                "PNGRAT",
                "POISONPLUG",
                "POISONPLUG.SHADOW",
                "POTROAST",
                "PRIVATELOG",
                "PipeMon",
                "PlugX",
                "PortReuse",
                "ProxIP",
                "ROCKBOOT",
                "RbDoor",
                "RedDelta",
                "RedXOR",
                "RibDoor",
                "Roarur",
                "RouterGod",
                "SAGEHIRE",
                "SPARKLOG",
                "SQLULDR2",
                "STASHLOG",
                "SWEETCANDLE",
                "ScrambleCross",
                "Sensocode",
                "SerialVlogger",
                "ShadowHammer",
                "ShadowPad Winnti",
                "SinoChopper",
                "Skip-2.0",
                "SneakCross",
                "Sogu",
                "Speculoos",
                "Spyder",
                "StealthReacher",
                "StealthVector",
                "TERA",
                "TIDYELF",
                "TIGERPLUG",
                "TOMMYGUN",
                "TVT",
                "Thoper",
                "Voldemort",
                "WIDETONE",
                "WINNKIT",
                "WINTERLOVE",
                "Winnti",
                "WyrmSpy",
                "X-Door",
                "XDOOR",
                "XMRig",
                "XShellGhost",
                "Xamtrav",
                "ZXShell",
                "ZoxPNG",
                "certutil",
                "certutil.exe",
                "cobeacon",
                "gresim",
                "njRAT",
                "pwdump",
                "xDll"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "4d5f939b-aea9-4a0e-8bff-003079a261ea",
            "created_at": "2023-01-06T13:46:39.04841Z",
            "updated_at": "2025-03-27T02:00:02.985296Z",
            "deleted_at": null,
            "main_name": "APT41",
            "aliases": [
                "G0096",
                "Grayfly",
                "BARIUM",
                "BRONZE ATLAS",
                "BRONZE EXPORT",
                "Red Kelpie",
                "HOODOO",
                "Brass Typhoon",
                "TA415",
                "WICKED SPIDER",
                "WICKED PANDA",
                "G0044",
                "Earth Baku"
            ],
            "source_name": "MISPGALAXY:APT41",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "e698860d-57e8-4780-b7c3-41e5a8314ec0",
            "created_at": "2022-10-25T15:50:23.287929Z",
            "updated_at": "2025-03-27T02:00:55.43005Z",
            "deleted_at": null,
            "main_name": "APT41",
            "aliases": [
                "APT41",
                "Wicked Panda",
                "Brass Typhoon",
                "BARIUM"
            ],
            "source_name": "MITRE:APT41",
            "tools": [
                "ASPXSpy",
                "BITSAdmin",
                "PlugX",
                "Impacket",
                "gh0st RAT",
                "netstat",
                "PowerSploit",
                "ZxShell",
                "KEYPLUG",
                "ipconfig",
                "sqlmap",
                "China Chopper",
                "ShadowPad",
                "MESSAGETAP",
                "Mimikatz",
                "certutil",
                "njRAT",
                "Cobalt Strike",
                "pwdump",
                "BLACKCOFFEE",
                "ROCKBOOT",
                "dsquery",
                "Winnti for Linux",
                "DUSTTRAP",
                "Derusbi",
                "ftp"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1666716491,
    "ts_updated_at": 1743041776,
    "ts_creation_date": 1571240314,
    "ts_modification_date": 1571240314,
    "files": {
        "pdf": "https://archive.orkl.eu/0511740e527c025858aa577e7b6b198f28e2a1ac.pdf",
        "text": "https://archive.orkl.eu/0511740e527c025858aa577e7b6b198f28e2a1ac.txt",
        "img": "https://archive.orkl.eu/0511740e527c025858aa577e7b6b198f28e2a1ac.jpg"
    }
}