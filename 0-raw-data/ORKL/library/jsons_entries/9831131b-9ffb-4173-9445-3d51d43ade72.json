{
    "id": "9831131b-9ffb-4173-9445-3d51d43ade72",
    "created_at": "2023-01-12T15:08:28.29637Z",
    "updated_at": "2025-03-27T02:09:18.832615Z",
    "deleted_at": null,
    "sha1_hash": "261589a1f941a304d09ae3750953d94ddb474c44",
    "title": "2021-03-18 - Return of the Darkside- Analysis of a Large-Scale Data Theft Campaign",
    "authors": "",
    "file_creation_date": "2022-05-28T19:30:26Z",
    "file_modification_date": "2022-05-28T19:30:26Z",
    "file_size": 1000389,
    "plain_text": "# Return of the Darkside: Analysis of a Large-Scale Data Theft Campaign\n\n**varonis.com/blog/darkside-ransomware/**\n\nOur team has recently led several high-profile investigations of attacks attributed to an up-and-coming cybercrime group, Darkside. These\nhighly targeted campaigns were conducted in several phases over weeks or months, ultimately targeting theft and encryption of sensitive data,\nincluding backups. In this technical blog post, we will review the tactics, techniques, and procedures (TTPs) we’ve observed.\n\n### About Darkside, inc.\n\nThe Darkside ransomware group announced their RaaS (Ransomware-as-a-Service) in August of 2020 via a “press release.” Since then, they\nhave become known for their professional operations and large ransoms. They provide web chat support to victims, build intricate data leak\nstorage systems with redundancy, and perform financial analysis of victims prior to attacking.\n\nThe group’s name, Darkside, evokes the image of a good guy (or gal) that has turned from the light. While we can’t conclude that the group is\ncomprised of former IT security professionals, their attacks reveal a deep knowledge of their victims’ infrastructure, security technologies, and\nweaknesses.\n\nThey have publicly stated that they prefer not to attack hospitals, schools, non-profits, and governments, but rather big organizations that can\nafford to pay large ransoms.\n\nOur reverse engineering revealed that Darkside’s malware will check device language settings to ensure they don’t attack Russia-based\norganizations. They have also answered questions on Q&A forums in Russian and are actively recruiting Russian-speaking partners.\n\n[The group has both Windows and Linux toolsets. Much like NetWalker and REvil, Darkside has an affiliate program that offers anyone who](https://www.varonis.com/blog/netwalker-ransomware?hsLang=en)\nhelps spread their malware 10-25% of the payout.\n\n## Anatomy of an Attack\n\nThe Darkside ransomware attack campaigns stood out for their use of stealthy techniques, especially in the early stages. The group performed\ncareful reconnaissance and took steps to ensure that their attack tools and techniques would evade detection on monitored devices and\nendpoints.\n\nWhile their initial entry vectors vary, their techniques are more standardized once inside, and their endgame is coldly efficient.\n\n**Stealth tactics include:**\n\nCommand and control over TOR\nAvoiding nodes where EDR is running\nWaiting periods & saving noisier actions for later stages\nCustomized code and connection hosts for each victim\nObfuscation techniques like encoding and dynamic library loading\nAnti-forensics techniques like deleting log files\n\n**During the later stages of their attack sequence, they:**\n\nHarvest credentials stored in files, in memory, and on domain controllers\nUtilize file shares to distribute attack tools and store file archives\nRelax permissions on file shares for easy harvesting\nDelete backups, including shadow copies\n\n\n-----\n\nep oy custo ed a so a e\n\n### Initial Access: Finding the Weak Link\n\nDarkside ransomware gained initial entry through weak links – remotely exploitable accounts and systems.\n\nWe observed Darkside use compromised contractor accounts to access Virtual Desktop Infrastructure (VDI) that had been put in place to\nfacilitate remote access during the pandemic. Though, contractor accounts did not.\n\nWe also observed them exploit servers, and then quickly deploy an additional RDP that would preserve access should the vulnerable server\nbe patched.\n\nWhile neither of these vectors is novel, they should serve as a warning that sophisticated threat actors are easily bypassing perimeter\ndefenses. They illustrate the need for multi-factor authentication on all internet-facing accounts and rapid patching of internet-facing systems.\n\n### Command and Control\n\nThe Darkside ransomware attackers established command and control primarily with an RDP client running over port 443, routed through\nTOR. After installing a Tor browser, they modified its configuration to run as a persistent service, redirecting traffic sent to a local (dynamic)\nport through [TOR via HTTPS over port 443, so it would be indistinguishable from normal web traffic. These connections were](https://www.allthingsdfir.com/rdp-over-tor/)\npersistent, so the attackers could establish RDP sessions to and through the compromised hosts, facilitating lateral movement.\n\nWe found traces of TOR clients across many servers and observed dozens of active TOR connections.\n\nThe attackers used Cobalt Strike as a secondary command and control mechanism. We observed dozens of customized stagers that\ndownloaded customized beacons that connected to specific servers. The stagers (named file.exe) were deployed remotely on specific targeted\ndevices using WinRM, each one configured differently. Cobalt-Strike stagers established connections to a dedicated C2 server to download\nthe Cobalt Strike Beacon.\n\nThreat actors commonly use only a few C2 servers per victim, but Darkside configured each beacon to connect to a different C2 server with a\ndifferent user agent. This would indicate that Darkside operates a large, well-established attack infrastructure.\n\nThe stagers and TOR executables were stored in network shares for easy distribution. The actors avoided installing backdoors on systems\nmonitored by EDR solutions.\n\n\n-----\n\nDetection of the beacon being downloaded into a\n\ncompromised server\nWe observed the threat actors log into the Virtual Desktop environment with many accounts, sometimes concurrently. Each time the threat\nactor logged on, .lnk files were created in the compromised user’s home folders. The .lnk file activity helped determine which accounts and VDI\nenvironments had been compromised and when each account was used in the attack.\n\n### Recon and Credential Harvesting\n\nDarkside ransomware is known for living off the land (LOtL), but we observed them to scan networks, run commands, dump processes, and\nsteal credentials. Like the command and control code, the attack tools were also executed on hosts that had minimal detection and blocking\ncapabilities. Well-known tools included advanced_ip_scanner.exe, psexec, Mimikatz, and more.\n\nFrom the initial set of compromised hosts, ticket requests, and NTLM connections to gain access to additional systems and accounts. After a\nwaiting period, the actor used an Active Directory reconnaissance tool (ADRecon.ps1) to gather additional information about users, groups,\nand privilege, storing results in a file called, DC.txt. Each of their attack tools was deleted after use. The attacker temporarily stored the recon\nresults and credential information on a very active windows server. Interesting file names written and deleted on the server included:\nTyped_history.zip, Appdata.zip, IE_Passwords.zip, AD_intel, and ProcessExplorer.zip.\n\nIn addition to credential harvesting, the attacker mined credentials from User profile folders, including:\n\nUsers\\<user name>\\Appdata\\[Roaming\\Local]\\Microsoft [Credentials\\Vault]\nUsers\\<user name>\\Appdata\\Roaming\\Mozilla\\Firefox\\Profiles\nUsers\\<user name>\\\\Appdata\\Local\\Google\\Chrome\n\nThe threat actor used Invoke-mimikatXz.ps1 to extract credentials from unmonitored servers and stored them in a file called “dump.txt.” This\noperation was performed on a high-value target with minimal detective capabilities.\n\nOnce the attacker obtained domain admin credentials, accessed domain controllers. In later stages they performed the well-known DCSync\nattack, where the attacker pretends to be a legitimate domain controller and utilizes the Directory Replication Service to replicate AD\ninformation, gaining access to password data for the entire domain, including the KRBTGT HASH.\n\n### Data Collection and Staging\n\nThe active Windows server also served as a hub to store data before exfiltration. Data was mined from hundreds of servers with a batch\nroutine (dump.bat) located in \\Desktop\\Dump, writing files to the same location, compressing them into 7zip archives with a simple naming\nconvention, *.7z.[001]-[999].\n\nThough they had accumulated elevated privileges, we observed the attacker relax the permissions on file systems, opening them up so that\nthey could access the files with any domain user account. The batch file, target data, and the archives were deleted by the attackers within\nhours of collection\n\n### Encryption\n\nDarkside doesn’t deploy ransomware until they’ve mapped the environment, exfiltrated interesting data, gained control of privileged accounts,\nand identified all backup systems, servers, and applications. We observed several connections to primary backup repositories using\ncompromised services accounts shortly before encryption. By holding off on the encryption phase of the attack, they put themselves in a\nposition to maximize damage and profit.\n\nThe ransomware code is delivered through established backdoors (TOR-RDP or Cobalt Strike) and is customized for each victim. The payload\nincludes the executable, a unique extension, and a unique victim ID that allows the victim to access Darkside’s website and make payment.\n\n\n-----\n\ny us g u que e ecutab es a d e te s o s, t e a so a e eas y e ades s g atu e based detect o ec a s s a s de a so p o des\ncustomized ransomware to other threat actors (Ransomware as a Service) and takes a part of the profit in successful attacks.\n\nOne version of the customized code was named, “Homie.exe.” In addition to being customized, we found it also uses anti-forensics and antidebugging techniques, such as self-injection, virtual machine detection, and dynamic library loading. It also deletes shadow copies on victim\ndevices.\n\n**Darkside Ransomware Stage 1 – Self Injection**\n\nOn execution, the malware copies itself to the path “C:\\Users\\admin\\AppData\\Local\\Temp\\” and injects its code into the existing process with a\nCMD command:\n\nIf the malware finds indications that it is being debugged or run in a VM, it immediately stops.\n\nTo avoid detection by AV and EDR solutions, the ransomware dynamically loads its libraries, without registering them in its imports section:\n\nOnly 3 libraries are imported, which indicates that other libraries’ names resolved dynamically during the malware’s run instead of being\nexplicitly imported.\n\n**Ransomware Stage 2 – Deletion of Shadow Copies**\n\nUsing an obfuscated PowerShell command, the malware attempts to delete the shadow copies on the victim device. The obfuscated\ncommand:\n\nThe de-obfuscated command:\n\n**Ransomware Stage 3 – Encryption of Files**\n\nAfter the deletion of the shadow copies, the malware first closes specific processes to avoid locked files that can delay encryption, and then\nbegins its encryption routine.\n\n**List of processes:**\n\nsql\noracle\nocssd\ndbsnmp\nsynctime\nagntsvc\nisqlplussvc\nxfssvccon\nmydesktopservice\nocautoupds\nencsvc\nfirefox\ntbirdconfig\nmydesktopqos\nocomm\ndbeng50\nsqbcoreservice\nexcel\ninfopath\n\n\n-----\n\nsaccess\nmspub\nonenote\noutlook\npowerpnt\nsteam\nthebat\nthunderbird\nvisio\nwinword\nwordpad\nnotepad\n\nDuring encryption, the malware appends an 8-character string to the end of the encrypted file names.\n\nDark side ransomware avoids encrypting files with the following extensions:\n\n386,adv,ani,bat,bin,cab,cmd,com,cpl,cur,deskthemepack,diagcab,diagcfg,diagpkg,dll,drv,exe,hlp,icl,icns,ico,ics,idx,ldf,lnk,mod,mpa,msc,msp,mssty\n\nIt creates a ransom instructions (“README…txt”) to contact the ransomware creator for decryption:\n\n## How to Prepare for Threat Actors in 2021\n\n**Find and fix the weak links before attackers do**\n\nAny internet-facing account that doesn’t require MFA is a brute-force attack away from a compromise. Any unpatched internet-facing server is\nan exploit away from script-kiddie payday.\n\n**Assume breach and fix weak links inside**\n\nThreat actors look for quick ways to obtain domain admin credentials. Service or admin accounts with SPNs that also have weak encryption, or\nworse still, privileged accounts with weak or no password requirements are too-easy targets.\n\nIn too many organizations, attackers don’t even need elevated credentials to harvest data – the average employee has access to far more data\nthan they require. Lockdown sensitive data so that only the right accounts have access, and then monitor file systems for unusual access and\nchange events.\n\n**More lights please especially on stuff that matters**\n\n\n-----\n\nO ga at o s t co p e e s e o to g so ut o s detect a d est gate attac s e t ese o e qu c y you a e b d spots o co e\ndata stores, in Active Directory, DNS, remote access systems, or in web connections, you’ll struggle to determine which systems were\ncompromised and whether sensitive data was stolen.\n\n**If you detect a breach, let Active Directory triangulate the blast radius**\n\nActive Directory events can help you quickly identify compromised accounts and devices. Instead of focusing on one endpoint at a time, once\none compromised account or system has been identified, query Active Directory for signs of lateral movement by that account or accounts\nused on that system.\n\nIf you have any reason to believe you’ve been targeted by Darkside or any other group, please don’t hesitate to reach out for incident response\n[and forensics help via https://www.varonis.com/help.](https://www.varonis.com/help?hsLang=en)\n\nA special thanks to Rotem Tzadok for leading our Darkside investigations and analysis.\n\nSnir Ben Shimol\n\nDirector of Cyber Security, Varonis Snir is the Head of Cyber Security at Varonis, a software company specializing in data security and insider\nthreat detection. Snir began his career in the IDF Technology and Intelligence Unit and continued as a Security Researcher in the Israeli Prime\nMinister’s Office. Since then he has worked in the Advanced Security Center of EY as the Cyber Security Advisory Leader, managing red-team\noperations and risk assessments. He has advised major international corporations and high-profile individuals to build their security resilience\nand protect their organization. Prior to his current role, he led Radware’s Cyber Security Research Division, responsible for innovation and\nsecurity solution capabilities.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-03-18 - Return of the Darkside- Analysis of a Large-Scale Data Theft Campaign.pdf"
    ],
    "report_names": [
        "2021-03-18 - Return of the Darkside- Analysis of a Large-Scale Data Theft Campaign.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536108,
    "ts_updated_at": 1743041358,
    "ts_creation_date": 1653766226,
    "ts_modification_date": 1653766226,
    "files": {
        "pdf": "https://archive.orkl.eu/261589a1f941a304d09ae3750953d94ddb474c44.pdf",
        "text": "https://archive.orkl.eu/261589a1f941a304d09ae3750953d94ddb474c44.txt",
        "img": "https://archive.orkl.eu/261589a1f941a304d09ae3750953d94ddb474c44.jpg"
    }
}