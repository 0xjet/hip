{
    "id": "59b674b5-b1f9-4a23-bb8a-bef05be0c4a4",
    "created_at": "2022-10-25T16:48:22.339971Z",
    "updated_at": "2025-03-27T02:16:28.812402Z",
    "deleted_at": null,
    "sha1_hash": "2b11ea5b0277264f527bfaff62e4ae5510b7521a",
    "title": "",
    "authors": "",
    "file_creation_date": "2019-06-21T06:35:00Z",
    "file_modification_date": "2019-06-21T06:35:00Z",
    "file_size": 1498366,
    "plain_text": "# 奇安信威胁情报中⼼\n\n**ti.qianxin.com/blog/articles/english-version-of-new-approaches-utilized-by-oceanLotus-to-target-**\nvietnamese-environmentalist\n\nThe OceanLotus, an APT group said to have a Vietnamese background, was first\nexposed and named by SkyEye Labs (the predecessor of the RedDrip team of QiAnXin\nThreat Intelligence Center) in May 2015. Its attack activities can be traced back to April\n2012 with initial targets including Chinese maritime institutions, maritime construction,\nscientific research institutes and shipping enterprises. Their targets expanded to almost\nall important organizations afterwards and related activities are still active now.\n\nThe RedDrip Team (@RedDrip7) keeps a close eye on activities made by OceanLotus.\nLast month we released an in-depth analysis report: OceanLotus’ Attacks to Indochinese\nPeninsula: Evolution of Targets, Techniques and Procedure. Currently we capture\nanother attack incident targeting a Vietnamese environmentalist with new malware\npayload and hope the revealed details could lead to more findings in the future.\n\n## Bait Analysis\n\nThe bait sample is a zip archive in Vietnamese: Thông tin về chuyên đề môi\ntrường_Nhờ anh Đặng Vũ Lượng tư vấn thêm.zip\n\nFrom the contents of the compressed package, the three pictures named in Vietnamese\nmeaning \"illustration\" respectively show that there is garbage in the rivers in Vietnam,\nthe factories are exhausting smoke everywhere, and the stinking ditch is all garbage. All\nthese pictures make people feel disgusting. At the same time, it shows the importance of\nmandatory waste classification.\n\nIn addition to the picture, the main attack sample is an hta script named as Van nan moi\ntruong Viet Nam hien nay va giai phap khac phuc hau qua_Phuong huong trong thoi\ngian toi.\n\n\n-----\n\nIt can be seen that both the bait name from the compressed package and the bait name\nas the attack sample are consistent with the scene of attacking the person in charge of\nthe environmental protection organization.\n\nTherefore, we will characterize this attack as: Oceanlotus attacked the head of an\nenvironmental protection organization in Vietnam.\n\n## Sample Analysis\n\nExecution process of the sample used by OceanLotus this time is roughly as follows:\n\n1. The hta sample decrypts and loads subsequent additional data.\n\n2. Utilize DLL Side-Loading to take advantage of adobe reader to load the payload\n\nand then connects to the C2.\n\n## Payload Analysis\n\nThe hta script has been obfuscated and will replace \",\", \".\", \" \" with \"+\", \"/\", \"=\" first:\n\nFigure 2.1 The confused hta script\nThe script is generated by using the cactusTorch framework\n(https://github.com/mdsecactivebreach/CACTUSTORCH), which first decrypts the\nLoader module, then decrypts the attached data through the Loader module, and finally\nexecutes the decrypted shellcode in memory:\n\nFigure 2.2 Loading Loader in Memory\nThe parameters passed to the Loader's \"X\" function are as follows:\n\nWinShusWenTun.X ( 1632689155,31529,194,1292962 )\n\nThe meaning of each parameter is as follows:\n\n\n-----\n\nName Value Description\n\n\nParame‐\nter 1\n\nParame‐\nter 2\n\nParame‐\nter 3\n\nParame‐\nter 4\n\n\n163268915\n0x6150DC03）\n\n\n4-byte key, just use the first 3 bytes (0x03, 0xdc, 0x50)\n\n\n31529 The position at the end of the script, which points to the\nappended data.\n\n194 The length of the name of the released docx file\n\n1292962 Size of the appended data\n\n\nThe second parameter is the beginning of the appended data:\n\nFigure 2.3 Append data behind the hta file\n\n## Loader Analysis\n\nThe decrypted Loader module is named L.dll. The function of the dll is mainly to decrypt\nand load the appended data behind the hta:\n\n\n-----\n\nFigure 2.4 Some functions of Loader\nThe X function is mainly to encrypt and load the shellcode; the decoding algorithm is\nbase64 and then performs XOR decryption with the key in single byte, and the key is\npassed by the parameter:\n\nFigure 2.5 X function of L.dll\nThe key here is 1632689155 (0x6150DC03). From the algorithm, only the first 3 bytes\n(0x03, 0xdc, 0x50) are used in while performing XOR decryption:\n\nFigure 2.6 L.dll decryption function\nThen the decrypted data is executed in memory:\n\n\n-----\n\nFigure 2.7 function B of L.dll\nThe function of the shellcode executed by Loader is mainly to release the file and\nachieve persistence. As can be seen from the code features, OceanLotus often uses the\nshellcode to perform attacks.\n\nFigure 2.8 Shellcode frequently used by OceanLotus\nAfter shellcode is loaded in memory, it will load the dll file in memory after execution.\n\n\n-----\n\nFigure 2.9 Loading Dll into memory by shellcode\nSubsequently released files are stored in the resource, and the PE file to be released is\nextracted from the resource data through RtlDecompressBuffer:\n\nFigure 2.10 Get the address of the decompression API\nThe resource names are 0x65 and 0x66. As shown in the figure, if the 0x65 resource\ndoes not exist, it will get 0x66 resource instead.\n\nFigure 2.11 Obtaining resource data\nThe obtained resource data is as follows, including the file name, file size, and\ncompressed data:\n\nFigure 2.12 Raw data in the resource\n\n\n-----\n\nThen get the exe and dll file names in system32, Program File and Windows directory,\ninsert them into the array, then randomly generate a random number, randomly select a\nfile in the array, get the file name and file description of the file as the name of the\ndropped exe file and related folder name respectively:\n\nFigure 2.13 Get the file name of the specified directory\nIf rasman.dll is randomly selected, it will get the file description as the name of the folder\nwhere the malicious code was released. Here is the Create Remote Access Connection\nManger folder for placing malicious code.\n\n\n-----\n\nFigure 2.14 File description of rasman.dll\nIf the File Description field of the selected file is empty, this will use the default folder\nname \"NLS_000001\":\n\nFigure 2.15 handling the case when the field is empty\nIn the following 2 folders (\"Program Files\", \"%appdata%\"), it creates a subdirectory (the\nname is a randomly selected \"file description\" content). If there is no permission to\ncreate a directory under \"Program Files\", it will be under %appdata%\":\n\n\n-----\n\nFigure 2.16 Creating a subdirectory\nThen release the 10 files decrypted in the resource to the newly created directory; in our\ncase the released directory name is: \"C:Program FilesRemote Access Connection\nManager\", which is based on the description of the file randomly selected.\n\nThe name of the exe file is the name of the randomly selected file.\n\nRasman.db3 is the shellcode to be loaded.\n\nFigure 2.17 Released file\nThen it will be written into the registry run item to achieve persistence.\n\nAt the same time, an empty docx file will be created under temp folder and then opened,\nso that the victim thinks that it is a docx file:\n\nThong tin chi tiet nhung san pham can dat hang qua shop zero waste_Bao gia chi tiet\nsan pham.docx\n\nFigure 2.18 The created docx file\nEnglish translation of the file name: The details information about products need order\nshop zero waste details price list\n\n## Dropper Analysis\n\nThe released rasman.exe is a legitimate file: Adobe 3D Utility:\n\n\n-----\n\nFigure 3.1 Version information of rasman.exe\nRasman.exe will load dlls in the same directory by default, including AGM.dll, BIB.dll,\nCoolType.dll and ACE.dll, which could lead to DLL Side-Loading:\n\nFigure 3.2 Import table information of rasman.exe\nThe code of the 4 dlls is the same, is the hijacked dll, will be loaded by rasman.exe\nprogram by default. Although 4 dlls have the opportunity to execute dllmain, the only dll\nthat loads the next stage payload is CoolType.dll because the attacker designed a flag\nvariable to control whether the next stage payload needs to be loaded:\n\nMD5 File Name Size flag Comment\n\n\n9ca638ae‐\nb4ce87936b1a993ef8e285fa\n\n\nACE.dll 11441Kb 0x8F Loader filled with use‐\nless data\n\n\n-----\n\n0a9d3fff‐\nf6083a015ab72117cba84fe0\n\n840c754098c473faff6fd22d‐\ndb8163b7\n\na8ff3e6abe26c4ce72267154‐\nca604ce3\n\ne84927bc7e4be‐\nf6af8daf8640d95325e\n\nd7c72d9394dc6e519d‐\nbce21830eb37cb\n\nf5220efbe14b98ac06bc2‐\ncadef5c0f23\n\n321c4d24‐\nda35f39c4ab145b6cfc4da19\n\n\nAGM.dll 11441Kb 0x8F Loader filled with use‐\nless data\n\nBIB.dll 11441Kb 0x6D Loader filled with use‐\nless data\n\nrasman.db3 910Kb Shellcode file with\nrandom name\n\nrasman.exe 246Kb Legitimate executable\nwith random name\n\nCoolType.dll 11441Kb 0x27 Loader filled with use‐\nless data, load\nshellcode\n\nMSVCP80.dll 11441Kb Library functions pop‐\nulated with useless\ndata\n\nMSVCR80.dll 11441Kb Library functions pop‐\nulated with useless\ndata\n\n\nThe code at the entrance of AGM.dll indicates the two if judgments will not enter,\nbecause the value of flag is 0x8f, which is greater than the first two judgments, so the\nsubsequent payload will not be loaded:\n\nFigure 3.3 DllMain function of AGM.dll\nThe code of the CoolType.dll code is 0x27, which is less than 0x46, so it will enter the\nfirst if condition and execute fun_LoadExportFun:\n\nFigure 3.4 DllMain function of CoolType.dll\n\n\n-----\n\nThe function of fun_LoadExportFun is mainly to cover large code at the entrance of exe,\nloop into the garbage code appearing in the configuration, the size is 0x20610 bytes,\nthen add the code 0xff, 0x15 at the end, and finally connect the address of the export\nfunction of AGM_5, only In order to finally execute the code that loads the shellcode:\n\nFigure 3.5 fun_LoadExportFun\nWhen the program returns to the exe process space, it will jump back to the code range\ncovered by fun_LoadExportFun to continue running, and finally execute the AGM_5\nfunction, mainly to avoid being traced back to the execution flow:\n\nFigure 3.6 A lot of padding code\nWhen AGM_5 is executed, it first hides all the child windows of the process, then reads\nthe file with the suffix of db3 (here rasman.db3) with the same file name in the same\ndirectory, and finally performs execution:\n\n\n-----\n\nFigure 3.7 Loading shellcode for rasman.db3\nThe loaded shellcode is a variant of the Denis family used by OceanLotus:\n\nFigure 3.8 Contents of rasman.db3\nThen it connects to udt.sophiahoule.com and establish C2 communication, which\neventually causes the computer to be controlled:\n\nFigure 3.9 Captured network packets\nThe characteristics of this malicious code:\n\n1. Insert the encrypted data to the end of the hta script to avoid the existence of\n\nmultiple files.\n\n2. The released files are randomly named according to the file name and file\n\ndescription selected from the compromised computer, so as to avoid being easily\nacquired in forensics.\n\n\n-----\n\n3. Only select one of the dll files while performing DLL Side-Loading, and fill the exe\n\nentry point with junk code and then do a jump operation to avoid stack traceback.\n\n4. Enlarge the file size to avoid being uploaded automatically.\n\n## Conclusion\n\nThe OceanLotus reflects a very strong confrontational ability and willing to attack by\nkeep evolving their techniques, including approaches to deliver bait documents, changes\nof the payloads, measures in circumvention, as well as domain assets, no matter the\ntarget is domestic or overseas. Due to the transnational nature of most APT groups, it is\ndifficult to eliminate threats from the root cause. Therefore, tracking these APT attacks\nand adopting confrontation measures will exist for a long time. All we can do is to\ncontinuously improve our own discovery and containment capabilities, then will be able\nto overwhelming opponents technically.\n\nAt present, all QiAnXin products can protect users from this new attack carried out by\nOceanLotus.\n\n## IOC\n\n**Bait Document**\n\n0dd468ee3a4ec0f6f84473bd8428a1e1\n\n**Loader**\n\nb28c80ca9a3b7deb09b275af1076eb55\n\n**C2**\n\nudt.sophiahoule.com\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2019/2019.06.20.OceanLotus_New_Approaches/OceanLotus.pdf"
    ],
    "report_names": [
        "OceanLotus"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "870f6f62-84f5-48ca-a18e-cf2902cd6924",
            "created_at": "2022-10-25T15:50:23.303818Z",
            "updated_at": "2025-03-27T02:00:55.435309Z",
            "deleted_at": null,
            "main_name": "APT32",
            "aliases": [
                "APT32",
                "SeaLotus",
                "OceanLotus",
                "APT-C-00",
                "Canvas Cyclone"
            ],
            "source_name": "MITRE:APT32",
            "tools": [
                "Mimikatz",
                "ipconfig",
                "Kerrdown",
                "Cobalt Strike",
                "SOUNDBITE",
                "OSX_OCEANLOTUS.D",
                "KOMPROGO",
                "netsh",
                "RotaJakiro",
                "PHOREAL",
                "Arp",
                "Denis",
                "Goopy"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "af509bbb-8d18-4903-a9bd-9e94099c6b30",
            "created_at": "2023-01-06T13:46:38.585525Z",
            "updated_at": "2025-03-27T02:00:02.866727Z",
            "deleted_at": null,
            "main_name": "APT32",
            "aliases": [
                "TIN WOODLAWN",
                "OceanLotus Group",
                "OceanLotus",
                "Sea Lotus",
                "G0050",
                "Cobalt Kitty",
                "SeaLotus",
                "ATK17",
                "Ocean Lotus",
                "Ocean Buffalo",
                "POND LOACH",
                "Canvas Cyclone",
                "APT-C-00",
                "APT-32",
                "APT 32"
            ],
            "source_name": "MISPGALAXY:APT32",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f1518ac1-4710-4dd1-a422-e3801e4806cb",
            "created_at": "2024-05-01T02:03:08.147856Z",
            "updated_at": "2025-03-27T02:05:17.421275Z",
            "deleted_at": null,
            "main_name": "TIN WOODLAWN",
            "aliases": [
                "Cobalt Kitty",
                "OceanLotus",
                "WOODLAWN ",
                "APT32 "
            ],
            "source_name": "Secureworks:TIN WOODLAWN",
            "tools": [
                " Denis",
                " Goopy",
                " JEShell",
                " KerrDown",
                " Mimikatz",
                " Ratsnif",
                " Remy",
                " Rizzo",
                " RolandRAT",
                "Cobalt Strike"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "2439ad53-39cc-4fff-8fdf-4028d65803c0",
            "created_at": "2022-10-25T16:07:23.353204Z",
            "updated_at": "2025-03-27T02:02:09.749502Z",
            "deleted_at": null,
            "main_name": "APT 32",
            "aliases": [
                "APT 32",
                "APT-C-00",
                "APT-LY-100",
                "ATK 17",
                "Lotus Bane",
                "Ocean Buffalo",
                "OceanLotus",
                "Operation Cobalt Kitty",
                "Operation PhantomLance",
                "Pond Loach",
                "SeaLotus",
                "SectorF01",
                "Tin Woodlawn"
            ],
            "source_name": "ETDA:APT 32",
            "tools": [
                "Agentemis",
                "Android.Backdoor.736.origin",
                "AtNow",
                "Backdoor.MacOS.OCEANLOTUS.F",
                "BadCake",
                "CACTUSTORCH",
                "CamCapture Plugin",
                "CinaRAT",
                "Cobalt Strike",
                "CobaltStrike",
                "Cuegoe",
                "DKMC",
                "Denis",
                "Goopy",
                "HiddenLotus",
                "KOMPROGO",
                "KerrDown",
                "METALJACK",
                "MSFvenom",
                "Mimikatz",
                "Nishang",
                "OSX_OCEANLOTUS.D",
                "OceanLotus",
                "PHOREAL",
                "PWNDROID1",
                "PhantomLance",
                "PowerSploit",
                "Quasar RAT",
                "QuasarRAT",
                "RatSnif",
                "Remy",
                "Remy RAT",
                "Rizzo",
                "Roland",
                "Roland RAT",
                "SOUNDBITE",
                "Salgorea",
                "Splinter RAT",
                "Terracotta VPN",
                "Yggdrasil",
                "cobeacon",
                "denesRAT",
                "fingerprintjs2"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716502,
    "ts_updated_at": 1743041788,
    "ts_creation_date": 1561098900,
    "ts_modification_date": 1561098900,
    "files": {
        "pdf": "https://archive.orkl.eu/2b11ea5b0277264f527bfaff62e4ae5510b7521a.pdf",
        "text": "https://archive.orkl.eu/2b11ea5b0277264f527bfaff62e4ae5510b7521a.txt",
        "img": "https://archive.orkl.eu/2b11ea5b0277264f527bfaff62e4ae5510b7521a.jpg"
    }
}