{
    "id": "99cff928-3bef-4d13-ae38-439587db2871",
    "created_at": "2023-01-12T15:04:00.68148Z",
    "updated_at": "2025-03-27T02:05:25.300709Z",
    "deleted_at": null,
    "sha1_hash": "f2d815a9b560bc23258616b7aba7cc54a2d5d405",
    "title": "2021-05-17 - DarkSide Ransomware- Splunk Threat Update and Detections",
    "authors": "",
    "file_creation_date": "2022-05-28T23:11:53Z",
    "file_modification_date": "2022-05-28T23:11:53Z",
    "file_size": 143150,
    "plain_text": "# DarkSide Ransomware: Splunk Threat Update and Detections\n\n**[splunk.com/en_us/blog/security/darkside-ransomware-splunk-threat-update-and-detections.html](https://www.splunk.com/en_us/blog/security/darkside-ransomware-splunk-threat-update-and-detections.html)**\n\nMay 17, 2021\n\nBy [Splunk Threat Research Team May 17,](https://www.splunk.com/en_us/blog/author/secmrkt-research.html)\n\n2021\nThe ransomware campaign against\nthe [Colonial Pipeline highlights the](https://www.foxbusiness.com/technology/colonial-pipeline-ceo-warns-of-fuel-shortages-following-cyberattack)\ndangers and real-life consequences\nof cyberattacks. If you want to\nunderstand how to use Splunk to find\nactivity related to the DarkSide\nRansomware, we highly recommend\nyou first read “The DarkSide of the\nRansomware Pipeline” from Splunk’s\nSecurity Strategist team. In short,\n[according to the FBI, the actors](https://www.nytimes.com/2021/05/10/us/politics/dark-side-hack.html)\nbehind this campaign are part of the\n“DarkSide” group. The effects of this\ncampaign against Colonial Pipeline\nare remarkable. Colonial Pipeline voluntarily shut down its operations, and some estimates\n[indicate around 45% of the East Coast of the United States fuel supply is affected.](https://nypost.com/2021/05/08/cyberattack-shuts-down-pipeline-that-supplies-east-coast-with-fuel/)\n\n[A regional state of emergency has been declared, it is important to note that this pipeline](https://www.axios.com/fuel-pipeline-cyberattack-us-state-of-emergency-dda2e776-f0f0-45cc-ae38-4fea47e014ec.html)\nnot only supplies automotive vehicles fuel but jet fuel as well, so not only land transportation\nis affected but air transportation as well Another possible effect of this cyberattack is the\n\n\n-----\n\nincrease of fuel prices all along the chain of affected goods and services.\n\n[https://twitter.com/GasBuddy/status/1392107671889850370](https://twitter.com/GasBuddy/status/1392107671889850370)\n\n## Replicating the DarkSide Ransomware Attack\n\nThe [Splunk Threat Research Team (STRT) has addressed this threat and produced an](https://www.splunk.com/en_us/blog/author/secmrkt-research.html)\nAnalytic Story with several detection searches directed at community shared IOCs. STRT\n[was able to replicate the execution of this payload via the attack range. The following](https://github.com/splunk/attack_range/)\nscreens show the initial execution of this malicious payload.\n\n\n-----\n\nThe execution of this file as many other ransomware payloads creates a note where it\nexplains to the victim what happened, demands a ransom payment, and also threatens to\npublish sensitive information extracted during the attack in what is known as double\nextortion.\n\n\n-----\n\nThe ransomware note also presents a personal leak page where partial exfiltrated\ninformation is shown and presents a web page to input a key to receive further instructions.\n\n\n-----\n\nThis ransomware payload also includes a log that shows current execution items as the\nfollowing screenshot shows.\n\n\n-----\n\nOne of the TOR URI addresses presented in the note appears to be targeted to the victim,\nwe found that the site to input key was similar in different samples. The DarkSide group had\na website on the dark web accessible via TOR or TOR Proxy. Several company logos were\nfound on this site and in what appears to be sensitive information made public from their\ncampaigns.\n\n\n-----\n\n### File Encryption:\n\nThis ransomware is capable of encrypting files in the network shares and local drive of the\ncompromised host.\n\nEnumerates network shares\n\n\n-----\n\nEnumerates local and removable drives\n\n\n-----\n\n### Whitelisted Folders, Files, and File Extension\n\nThis ransomware payload has a configuration feature consisting of a list of folder names,\nfiles, and file extensions it skips during encryption.\n\nFolder names skipped during the encryption process\n\n\n-----\n\nFiles and File Extensions skipped during the encryption process\n\n\n-----\n\n### Terminating Processes and Services\n\nSimilar to other ransomware payloads it also tries to kill processes or services that may\ncause access failure to the files targeted for encryption. Below is the decrypted list of strings\nrelated to the process name and service name targeted for termination.\n\nProcess names list targeted for termination\n\n\n-----\n\n-----\n\nService name it terminates:\n\n\n-----\n\n-----\n\n### Privilege Escalation\n\nThis ransomware checks if its process instance is running under admin privileges, if not, it\n[will try to elevate privileges by using cmstplua.dll COM OBJECT CLSID to elevate its](https://attack.mitre.org/techniques/T1218/003/)\nprivileges.\n\n\n-----\n\nAside from encrypting files, killing processes, services, and elevating privileges it will also\ndelete files in the recycle bin, as seen in the following screenshot.\n\n\n-----\n\n-----\n\nIt also has a feature where it runs a hex-encoded PowerShell script to delete the shadow\ncopy in the compromised machine. Below is the screen capture of the decrypted\nPowerShell command.\n\n\n-----\n\n-----\n\n[The DarkSide Ransomware also used the machine guid of the compromised host to](https://en.wikipedia.org/wiki/Universally_unique_identifier)\ngenerate a (4 rounds) crc32 checksum that will be used as a file extension of the encrypted\nfiles.\n\n\n-----\n\n## Using the DarkSide Ransomware Analytic Story\n\n[As seen above in the replication of this threat via the attack range, we used a specific](https://github.com/splunk/attack_range/)\n[sysmon configuration to get the data needed to create these detections. The new Analytic](https://github.com/splunk/attack_range/blob/develop/ansible/roles/sysmon/templates/AttackRangeSysmon.xml.j2)\nStory “DarkSide Ransomware” is composed of the following searches from current\nanalytical stories and new detection searches:\n\nModified Ransomware Notes Bulk Creation\n\n\n-----\n\n```\n sysmon EventCode 11 file_name IN ( \\.txt, \\.html, \\.hta ) |bin _time\n span=10s | stats min(_time) as firstTime max(_time) as lastTime dc(TargetFilename)\n as unique_readme_path_count values(TargetFilename) as list_of_readme_path by\nComputer\n Image file_name | where unique_readme_path_count >= 15 |\n`security_content_ctime(firstTime)`\n | `security_content_ctime(lastTime)`\n\n### New detections:\n\n```\nDelete Shadow copy with Powershell (Detects deletion of shadow copy)\n```\npowershell` EventCode=4104 Message= \"*ShadowCopy*\" Message = \"*Delete*\" \n stats count min(_time) as firstTime max(_time) as lastTime by EventCode Message\nComputerName User\n | `security_content_ctime(firstTime)`\n | `security content ctime(lastTime)`\n\n```\n\n-----\n\nCMLUA or CMSTPLUA UAC bypass (Detects privilege escalation)\n```\n`sysmon` EventCode=7 ImageLoaded IN (\"*\\\\CMLUA.dll\", \"*\\\\CMSTPLUA.dll\",\n\"*\\\\CMLUAUTIL.dll\") NOT(process_name IN(\"CMSTP.exe\", \"CMMGR32.exe\")) \n NOT(Image IN(\"*\\\\windows\\\\*\", \"*\\\\program files*\"))\n | stats count min(_time) as firstTime max(_time) as lastTime by Image ImageLoaded\nprocess_name Computer EventCode Signed ProcessId \n | `security_content_ctime(firstTime)`\n | `security_content_ctime(lastTime)`\n\n```\n\n-----\n\nDetect RClone Command-Line Usage\n```\n| tstats `security_content_summariesonly` count min(_time) as firstTime\n max(_time) as lastTime from datamodel=Endpoint.Processes where Processes.process\nIN (\"*copy*\", \"*mega*\", \"*pcloud*\", \"*ftp*\", \"*--config*\", \"*--progress*\", \"*--nocheck-certificate*\", \"*--ignore-existing*\", \"*--auto-confirm*\", \"*--transfers*\", \"*-multi-thread-streams*\") by Processes.dest Processes.user Processes.parent_process\nProcesses.process_name\n Processes.process  Processes.process_id Processes.parent_process_id\n | `drop_dm_object_name(Processes)` | `security_content_ctime(firstTime)`| \n`security_content_ctime(lastTime)`\n\n```\n\n-----\n\nDetect Renamed RClone\n```\n`sysmon` EventID=1 OriginalFileName=rclone.exe NOT process_name=rclone.exe | stats\n count min(_time) as firstTime max(_time) as lastTime by Computer, User,\nparent_process_name,\n process_name, OriginalFileName, process_path, CommandLine | rename Computer as\ndest\n | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)`\n\n```\n\n-----\n\nExtract SAM from Registry\n```\n| tstats `security_content_summariesonly` count min(_time) as firstTime max(_time)\n as lastTime from datamodel=Endpoint.Processes where Processes.process_name=reg.exe\n(Processes.process=*save* OR Processes.process=*export*) AND\n(Processes.process=*sam* OR Processes.process=*system* OR\nProcesses.process=*security*) by Processes.dest Processes.user\nProcesses.parent_process Processes.process_name Processes.process\nProcesses.process_id Processes.parent_process_id\n | `drop_dm_object_name(Processes)` \n | `security_content_ctime(firstTime)`\n | `security_content_ctime(lastTime)`\n\n```\n\n-----\n\nSLUI RunAs Elevated\n```\n| tstats `security_content_summariesonly` count min(_time) as firstTime max(_time)\n as lastTime from datamodel=Endpoint.Processes where\nProcesses.process_name=slui.exe\n (Processes.process=*-verb* Processes.process=*runas*) by Processes.dest\n Processes.user Processes.parent_process Processes.process_name Processes.process\n Processes.process_id Processes.parent_process_id |\n`drop_dm_object_name(Processes)`\n | `security_content_ctime(firstTime)`| `security_content_ctime(lastTime)`\n\n```\n\n-----\n\nSLUI Spawning a Process\n```\n| tstats `security_content_summariesonly` count min(_time) as firstTime max(_time)\n as lastTime from datamodel=Endpoint.Processes where\nProcesses.parent_process_name=slui.exe\n (Processes.process_name!=*slui* OR Processes.process_name=!firefox.exe OR\nProcesses.process_name!=chrome.exe OR Processes.process_name!=iexplore.exe OR\nProcesses.process_name!=msedge.exe) by Processes.dest\n Processes.user Processes.parent_process Processes.process_name Processes.process\n Processes.process_id Processes.parent_process_id |\n`drop_dm_object_name(Processes)`\n | `security_content_ctime(firstTime)`| `security_content_ctime(lastTime)`\n\n```\n\n-----\n\n**Detection** **Technique**\n**ID**\n\n\n**Tactic(s)** **Notes**\n\n\nRansomware Notes bulk\ncreation\n\nHigh Process Termination\nFrequency\n\n\n[T1486](https://attack.mitre.org/techniques/T1486/) Impact Detects bulk creation of\nransomware notes\n\n[T1486](https://attack.mitre.org/techniques/T1486/) Impact Detects high frequency of process\ntermination, associated with\nransomware execution\n\n\n-----\n\nCertUtil Download With\n[URLCache and Split](https://github.com/splunk/security_content/blob/develop/detections/endpoint/certutil_download_with_urlcache_and_split_arguments.yml)\nArguments\n\nAny Powershell\nDownloadFile\n\nMalicious PowerShell\n[Process - Execution](https://github.com/splunk/security_content/blob/develop/detections/endpoint/malicious_powershell_process___execution_policy_bypass.yml)\nPolicy Bypass\n\nProcess Deleting Its\nProcess File Path\n\nCMLUA Or CMSTPLUA\nUAC Bypass (New)\n\nExtract SAM from\nRegistry (New)\n\n[SLUI RunAs Elevated](https://github.com/splunk/security_content/blob/develop/detections/endpoint/slui_runas_elevated.yml)\n(New)\n\nSLUI Spawning a\nProcess (New)\n\n[Detect Renamed RClone](https://github.com/splunk/security_content/blob/develop/detections/endpoint/detect_renamed_rclone.yml)\n(New)\n\nDetect RClone\nCommand-Line Usage\n(New)\n\n\n[T1105](https://attack.mitre.org/techniques/T1105/) Command\nAnd\nControl\n\n\nDetects Download files by using\nCertutils\n\n\n[T1059.001](https://attack.mitre.org/techniques/T1059/001/) Execution Detects download file using\nPowerShell\n\n[T1059.001](https://attack.mitre.org/techniques/T1059/001/) Execution Detects PowerShell processes\nstarted with parameters used\n\nto bypass the local execution\npolicy for scripts.\n\n[T1070.004](https://attack.mitre.org/techniques/T1070/004/) Impact Detects process deleting its\nrelated process file path.\n\n\n[T1218.003](https://attack.mitre.org/techniques/T1218/003/) Defense\nEvasion\n\nT1003.002 Credential\nDumping\n\nT1548.002 Privilege\nEscalation\n\nT1548.002 Privilege\nEscalation\n\n\nDetects a UAC Bypassed using\ncmstp and cmlua com object.\n\nDetections the use of reg.exe\nextracting SAM from the registry.\n\nDetects the usage of SLUI.exe\nwith the verb RunAs used to\nelevate permissions.\n\nDetects SLUI.exe spawning a\nprocess, indicative of UAC\nBypass.\n\n\nT1020 Exfiltration Detects the usage of rclone.exe\nrenamed.\n\nT1020 Exfiltration Detects common command-line\narguments used by Rclone.exe.\n\n\n[Cobalt Strike (Story)](https://github.com/splunk/security_content/blob/develop/stories/cobalt_strike.yml) Several Several\n\n\n-----\n\n**Hashes:**\n\nSample A:\nSha1: 03c1f7458f3983c03a0f8124a01891242c3cc5df\nSha256: 6931b124d38d52bd7cdef48121fda457d407b63b59bb4e6ead4ce548f4bbb971\n\nSample B:\nSha1: d1dfe82775c1d698dd7861d6dfa1352a74551d35\nSha256: 9cee5522a7ca2bfca7cd3d9daba23e9a30deb6205f56c12045839075f7627297\n\n### About the Splunk Threat Research Team\n\nThe Splunk Threat Research Team will continue updating our detection content and\naddressing the threat of ransomware payloads as these campaigns continue affecting\ndifferent verticals, especially those involving critical infrastructure. For our newest content\n[please download Splunk Security Essentials,](https://www.splunk.com/en_us/software/cyber-security-essentials.html) [Splunk ES Content Update application, or visit](https://splunkbase.splunk.com/app/3449/)\n[Splunk Threat Research page.](https://www.splunk.com/en_us/cyber-security/threat-research.html)\n\nPosted by\n\n**[Splunk Threat Research Team](https://www.splunk.com/en_us/blog/author/secmrkt-research.html)**\n\nThe Splunk Threat Research Team is an active part of a customer’s overall defense\nstrategy by enhancing Splunk security offerings with verified research and security content\nsuch as use cases, detection searches, and playbooks. We help security teams around the\nglobe strengthen operations by providing tactical guidance and insights to detect,\ninvestigate and respond against the latest threats. The Splunk Threat Research Team\nfocuses on understanding how threats, actors, and vulnerabilities work, and the team\n\n\n-----\n\n[replicates attacks which are stored as datasets in the Attack Data repository.](https://github.com/splunk/attack_data/)\n\nOur goal is to provide security teams with research they can leverage in their day to day\noperations and to become the industry standard for SIEM detections. We are a team of\nindustry-recognized experts who are encouraged to improve the security industry by\nsharing our work with the community via conference talks, open-sourcing projects, and\nwriting white papers or blogs. You will also find us presenting our research at conferences\nsuch as Defcon, Blackhat, RSA, and many more.\n\n[Read more Splunk Security Content.](https://github.com/splunk/security_content)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-05-17 - DarkSide Ransomware- Splunk Threat Update and Detections.pdf"
    ],
    "report_names": [
        "2021-05-17 - DarkSide Ransomware- Splunk Threat Update and Detections.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535840,
    "ts_updated_at": 1743041125,
    "ts_creation_date": 1653779513,
    "ts_modification_date": 1653779513,
    "files": {
        "pdf": "https://archive.orkl.eu/f2d815a9b560bc23258616b7aba7cc54a2d5d405.pdf",
        "text": "https://archive.orkl.eu/f2d815a9b560bc23258616b7aba7cc54a2d5d405.txt",
        "img": "https://archive.orkl.eu/f2d815a9b560bc23258616b7aba7cc54a2d5d405.jpg"
    }
}