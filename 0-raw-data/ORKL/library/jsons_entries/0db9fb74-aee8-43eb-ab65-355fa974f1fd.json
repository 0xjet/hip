{
    "id": "0db9fb74-aee8-43eb-ab65-355fa974f1fd",
    "created_at": "2022-10-25T16:48:21.076311Z",
    "updated_at": "2025-03-27T02:09:29.658147Z",
    "deleted_at": null,
    "sha1_hash": "6cd792ea3c97a0caf403b3697bb9cb069b04fd7c",
    "title": "Macintosh HD:Users:Shared:dd:4work:Bitdefender-PR-Whitepaper-Metamorfo-creat4500-en_EN:Bitdefender-PR-Whitepaper-Metamorfo-creat4500-en_EN.indd",
    "authors": "",
    "file_creation_date": "2020-05-22T11:12:08Z",
    "file_modification_date": "2020-05-22T11:12:12Z",
    "file_size": 5596282,
    "plain_text": "##### Security\n# Loading DLLs for illicit profit. A story about a Metamorfo distribution campaign\n\nwww.bitdefender.com\n\n\n-----\n\n#### Contents\n\nIntroduction.................................................................................................................................................... 3\nDLL Hijacking as a method to defeat defenses .......................................................................................... 3\nA primer to hijacking DLLs....................................................................................................................... 3\nBrief technical analysis of a Metamorfo infection....................................................................................... 6\nInitial access............................................................................................................................................. 6\nExecution flow.......................................................................................................................................... 6\nAvira.SystrayStartTrigger.................................................................................................................................6\nAvira.OE.NativeCore.dll.....................................................................................................................................7\nStartup Script.....................................................................................................................................................8\nDecrypted Strings..............................................................................................................................................8\nOther Legitimate Components Abused..................................................................................................... 10\nImpact..................................................................................................................................................... 11\nCampaign distribution and evolution.......................................................................................................... 12\nRegion Distribution................................................................................................................................. 12\nEvolution Over Time............................................................................................................................... 12\nOk, I did all this, is the problem solved now?........................................................................................ 14\nConclusion.................................................................................................................................................... 15\nBibliography.................................................................................................................................................. 16\nMITRE Techniques....................................................................................................................................... 17\nAppendix 1. Indicators of Compromise...................................................................................................... 18\nHashes.................................................................................................................................................... 18\nURL.......................................................................................................................................................... 18\nIP Address............................................................................................................................................... 18\nFiles dropped.......................................................................................................................................... 18\nMutex....................................................................................................................................................... 18\nAppendix 2. The malicious IP’s previous DNS resolutions........................................................................ 19\nAppendix 3. Decrypted Resources.............................................................................................................. 19\n\n\n**Authors:**\n\n\n-----\n\nLoading DLLs for illicit profit. A story about a Metamorfo distribution campaign\n\n## DLL Hijacking as a method to defeat defenses\n\nSpecial conditions such as the POSIX subsystem or\nWindows Subsystem for Linux aside, a constant for all\nWindows applications is that they need to interact with\nDLLs for most of their actions.\n\nEven the simplest program needs to link ntdll.dll, the\nnative system library, to merely start. If the program\nis not a native application (written by Microsoft\ndevelopers or some AV company), chances are that\nthe process needs to use kernel32.dll, advapi32.dll,\n_user32.dll and a plethora of other libraries built by_\nMicrosoft or other independent software vendors.\nIt’s common practice for companies to structure\ntheir applications using custom implemented DLLs.\nFor instance, Bitdefender has a few dozen different\nDLLs developed by teams spread across multiple\ndevelopment locations. This reliance on DLLs exposes\napplications to different classes of vulnerabilities. DLL\nSearch-Order Hijacking, DLL Hijacking, DLL pre-loading\n(aka. binary planting), DLL side-loading are all “Thorns\nin the Side of the Anti-Virus Industry”[7].\n\nWe won’t dive deeper into any of these techniques, as\nthey have been thoroughly studied and documented\nelsewhere.\n\n### A primer to hijacking DLLs\n\nA digital signature, as implemented by Authenticode\nis considered a token of trust. Among other factors,\nan Authenticode-signed executable file looks less\nalarming to users when requesting elevated privileges.\nSubsequently, if the User Account Control (UAC)\nprompts users that their trusted anti-virus vendor\nwants to make changes to the system, they likely won’t\nquestion it.\n\nOrganizations sometimes (mis)configure their\nintrusion detection system to allow digitally signed\napplications to run undisturbed, ignoring their\nmalicious behavior. Some antimalware solutions likely\n\n\n-----\n\nLoading DLLs for illicit profit. A story about a Metamorfo distribution campaign\n\nLast, what even is a DLL to the average PC user? Will they ever look up DLLs on VirusTotal?\n\nDuring the time we monitored the Metamorfo campaign, we’ve seen 5 different software components, manufactured\nby respected software vendors, abused in the attack. They come from Avira, AVG and Avast, Damon Tools, Steam and\n_NVIDIA. Are any of these software companies at fault? Well, they only have the misfortune of developing popular_\nsoftware, as they become more prominent targets than less-known applications.\n\nWe mention the components and their distribution in the campaign in the following table.\n\n###### Component InternalName Count of affected users\n\n\n###### Avira.SystrayStartTrigger 3457\n\n AvDump32 512\n\n DiscSoftBusServicePro 734\n\n SteamErrorReporter 299\n\n NvSmartMaxApp 193\n\n\nLet’s quickly look these files up on VirusTotal to double check whether cyber-security companies consider them\nmalicious.\n\n\n-----\n\nLoading DLLs for illicit profit. A story about a Metamorfo distribution campaign\n\nAs you can see, all these components are clean (and some security solutions don’t like Steam reporting errors). Users\nare not to blame for trusting that processes created by these files are not malicious.\n\n\n-----\n\nLoading DLLs for illicit profit. A story about a Metamorfo distribution campaign\n\n## Brief technical analysis of a Metamorfo infection\n\n### Initial access\n\nThe malware arrives on the system in a MSI installer that seems legitimate to the user. However, the attackers rigged\nthe file to include some legitimate files along with the target executable and the malicious DLL. Upon execution, the\nprogram installs the legitimate component and the malware in a subfolder, either under a Public user’s library folder\n(Documents, Music, Pictures, Videos or Downloads) or under ProgramData. After the installation is complete, it\nexecutes the legitimate binary that automatically loads the malicious DLL.\n\n### Execution flow\n\n**Fig.1 Execution of Avira.SystrayStartTrigger with a random name.exe, as captured by Bitdefender GravityZone**\n\nWhen execution starts, the target process loads its imported DLLs, including the malicious one. Besides executing\nthe code from the DLL’s startup routine, the legitimate application runs as it would in a clean scenario. The malware\nDLL has all of its exported functions pointing to the same address in the code. Thus, a legitimate call from the clean\napplication triggers the execution of the malicious code.\n\n###### Avira.SystrayStartTrigger\nThe most widespread legitimate component used in this campaign is Avira.SystrayStartTrigger.\n\n_Version Info:_\n\n**Company Name:** **Avira Operations GmbH & Co. KG**\n\n\nProduct Name: Avira\n\nInternal Name: Avira.SystrayStartTrigger\n\nFile Description: Avira\n\n\n_Digital Signature:_\n\n**Issuer Name:** **Symantec Class 3 Extended Validation Code Signing CA - G2**\n\n\nSubject: Avira Operations GmbH & Co. KG\n\n\n**Serial Number:** 2482b97529c45783c6c2e0b95654eb1f\nOur analysis of this component reveals that it is normally used to check for the existence of another Avira\n\n\n-----\n\nLoading DLLs for illicit profit. A story about a Metamorfo distribution campaign\n\n_ExternalCommunicationTaskPipe to signal the Avira.ServiceHost.exe process to launch Avira.Systray.exe._\n\n**Fig. 2 Avira.ExternalCommunicationTaskPipe Signal**\n\nIf Avira.ServiceHost.exe fails to respond, it is responsible for launching Avira.Systray.exe. Based on the previous\nobservation, we can state that this component can launch any executable named Avira.Systray.exe in the current\nworking directory. As of yet, we have found no indication that attackers abuse the application in this manner.\n\n**Fig. 3 Launching a powershell executable renamed to Avira.Systray.exe**\n\n###### Avira.OE.NativeCore.dll\nThe theory that we’re dealing with a DLL hijacking is confirmed by looking at the modules used by this process. Avira.\n_OE.NativeCore.dll stands out. The DLL dropped next to the legitimate Avira component immediately raises suspicion,_\nas the former is more than 20 MB. The version info of the file corresponds to the legitimate DLL developed by Avira.\nHowever, the first significant difference is that the larger one was compiled in Delphi instead of Visual C/C++. Malware\nauthors frequently use Delphi, as this allows for rapid prototyping of a GUI for their executable, so it has lots of\nstandard libraries, easily embeddable in a single executable file. The advantage of having all malicious code in a DLL is\nthat the malicious actions appear to be performed by the legitimate process. Thus, the attacker might evade behavioral\ndetection if binaries with a trusted digital signature are whitelisted.\n\nThe Version Info of the malicious DLL mimics that of the clean one.\n\n**Company Name:** **Avira Operations GmbH & Co. KG**\n\n\nProduct Name: Avira\n\nInternal Name: Avira.OE.NativeCore\n\n\nFile Description: Avira.OE.NativeCore\nThe DLL has a verification mechanism so that it does not execute unless the computer is configured with Brazilian\nlocales. After checking the requirements of the Brazilian environment, the malware creates a mutex with a seemingly\nrandom name (holexrel), to ensure that it does not run the same malicious code every time the clean process calls one\nof the exported functions. It then creates a copy of the original, legitimate executable file, in the same folder where it\nis running from but under another random name with an .EXE, .SCR or .PIF extension. Next, it writes a VBS script into\n_AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\ with a random name to secure persistence. If_\nthere is already a script file in that location, the malware deletes it.\n\n\n-----\n\nLoading DLLs for illicit profit. A story about a Metamorfo distribution campaign\n\nThe script is responsible for launching the legitimate executable, executing the malicious DLL next to it every time\nthe computer starts. The script instantiates the COM object WScript.Shell, with CLSID {72c24dd5-d70a-438b-8a42**98424b88afb8}, as well as FileSystemObject with CLSID {0d43fe01-f093-11cf-8940-00a0c9054228}. The method of**\nreferring COM objects instead of interacting directly with the file system and processes through built-in functions helps\nevade classic detection mechanisms.\n\nThe contents of the dropped VBS are similar to the one below, and only the variable names are randomized. The script\nchecks if the side-loaded DLL is present in the same folder as the executable, then it starts the EXE.\n\n###### Startup Script\n```\non error resume next\nSet ZIMJAS = CreateObject(“WScript.Shell”)\n\n```\nset XWRWSY = createobject(“scripting.filesystemobject”)\n```\nCOJNZE = “cmd /k c: & cd\\ & cd C:\\Users\\Ion Testalescu\\Documents\\x8rehgrg5\\ & msdgghwiux.exe”\n\n```\nif XWRWSY.fileexists (“C:\\Users\\Ion Testalescu\\Documents\\x8rehgrg5\\Avira.OE.NativeCore.\n```\ndll”) then\nZIMJAS.run(COJNZE),0\nEnd If\n\n```\nThe malware searches for some banking-related software on the system and it waits for the user to access banking\npages. It monitors them by looking at window titles and comparing them with the following set of strings:\n\n###### Decrypted Strings\n\n**Applications:**\nAplicativo sicoob; sicoob; AplicativoBradesco.exe; Aplicativo bradesco; Banco Bradesco; NavegadorExclusivoBradesco.\nexe; core.exe; C0R3; RapportService.exe; R4pp0rt\n\n**Banking Pages**\n\n[bb.com.br]; Banco do Brasil; Banco Bradesco | Pessoa Física, Exclusive, Prime e Private; Bradesco; Pessoa jurídica\n| Bradesco; Bradesco JuJu; Banco Itaú; Banco Itáu; Santander; Banco Santander; sicredi; Banco Sicredi; Mercantil;\ninternetbanking; Caixa Economica; Banco Sicoob; Unicred Portal; Unicred; Internet Banking BNB; Banco BNB; Banco\nInter; Banco Intermedium; Banco MUFG Brasil S.A.; Banestes - Internet Banking; Banestes; Internet Banking; Bancos\nGeral; Banco do Estado do Pará S/A; Cetelem | Login; Cetelem; Cooperativa de Crédito; Nova Home | Internet;\nBanco Safra; SafraNet; BANCO PAULISTA; UniprimeCentral; Uniprime; Bem vindo ao seu BMG; BMG; Portal - Banco\nVotorantim; Votorantim; Pine Online; NBC BANK; Tribanco Online; Tribanco; Banco Alfa; Banco Indusval & Partners;\nBanco Indusval; Portal Internet Banrisul; Banrisul; Banco Original; Acesse sua conta Celcoin; Celcoin; Login - Nubank;\nNubank; BRB Banknet; Banco de Brasília; Banco da Amazônia; Banese; BancoTopazioInternetBanking; Banco Topazio;\nBancoIndustrial; Banco Industrial; Daycoval; bradesco; CIDETRAN; Viacredi; PagueVeloz Serviços de Pagamentos;\nPague Veloz; Banco Safra - Internet Banking Pessoa Jurídica; Pessoa Jurídica | Internet; Safra Jurídica; Pessoa Física\n| Internet; Safra Física; Bradesco Exclusive; Bradesco Prime; Prime; Banco Bradesco S/A; Bradesco Private Bank;\nBradesco Private\n\nIt then attempts to connect to buleva[.]webcindario[.]com, which translates to the IP 5.57.226.202. This IP has been\nused for various name resolutions before, as shown in Appendix 2. These domain names mislead users as they seem\nlegitimate, except for the webcindario[.]com part (e.g. bankofamerica[.]webcindario[.]com, disney[.]webcindario[.]com).\n\nThe malware is also capable of downloading files from the C&C server in the same folder under random names.\nFinally, the executable keeps running in the background, waiting for commands from the server. It is capable of logging\nkeypresses on the system when the user fills in a password on one of the banking pages. It can also disable the\nautocomplete feature of browsers so the user has to retype the password manually.\n\n\n-----\n\nLoading DLLs for illicit profit. A story about a Metamorfo distribution campaign\n\nThe malware also has the capability of capturing screenshots with the help of the Windows Magnifying API, imported\nfrom Magnification.dll. We have captured some of the commands along with application names searched, file names\nand web resources by decrypting the malware’s resources, as shown in Appendix 3.\n\nThe resource directory of the DLL contains some images that mimic security notifications from various Brazilian banks,\ntricking the user into believing that something happened with their bank account. This panic can then be used to the\nattacker’s advantage to steal sensitive information.\n\nExample images:\n\n\n-----\n\nLoading DLLs for illicit profit. A story about a Metamorfo distribution campaign\n\nThe authors of the DLL also repurposed several public libraries available on the internet. One of them is DCPCrypt\n\n[9], a library responsible for encrypting buffers with various algorithms. Each of these algorithm classes have string\nidentifiers starting with DCP (e.g. ‘DCP_blockcipher128’). The libraries facilitate the encrypted communication with the\nC2 server via https.\n\n###### Other Legitimate Components Abused\nThere are some more executables susceptible to DLL hijacking, and we observed that attackers abuse them the same\nway they did with those from Avira. Naturally, they are delivered with a different DLL name, with Version Info specific to\neach one, but with the same functionality.\n\n**AvDump32 from AVG**\n\n**Version Info:**\n\n**Company Name:** **AVG Technologies CZ, s.r.o.**\n\n\nProduct Name: AVG Internet Security System\n\nInternal Name: AvDump32\n\nFile Description: AVG Dump Process\n\n\n**Digital Signature:**\n\n**Issuer Name:** **Symantec Class 3 SHA256 Code Signing CA**\n\n\nSubject: AVG Technologies CZ, s.r.o.\n\n\nSerial Number: 34f34f4b5727a1636c768808abf89e96\n\nThe variant abusing this component has slightly different behavior at the start of its execution. It first checks whether it\nruns in the context of AvDump32 and, if so, it injects itself into wmplayer.exe or dllhost.exe.\nIf loaded into wmplayer.exe/dllhost.exe, it executes the rest of its code [3]. With this, the malware introduces another\nlayer of defense evasion as another well-known process performs malicious actions, and an AV might not detect them.\nAnother difference we observed is the persistence mechanism of this variant. Instead of a script written to the startup\nfolder, the malware schedules a task to execute AvDump32 at every restart.\n\n\n-----\n\nLoading DLLs for illicit profit. A story about a Metamorfo distribution campaign\n\n\n**DiscSoftBusServicePro from Daemon Tools**\n\n**Version Info:**\n\n\n**Company Name:** **Disc Soft Ltd**\n\nProduct Name: DAEMON Tools Pro\n\nInternal Name: DiscSoftBusServicePro\n\nFile Description: Disc Soft Bus Service Pro\n\n\n**Digital Signature:**\n\n\n**Issuer Name:** **COMODO RSA Code Signing CA**\n\nSubject: Disc Soft Ltd\n\nSerial Number: 00f6e3d0098bf4e24d22bbb9550c55343e\n\n\n**SteamErrorReporter from Steam**\n\n**Version Info:**\n\n\n**Company Name:** **Valve Corporation**\n\nProduct Name: Steam\n```\n              steamerrorreporter.exe (buildbot_steam\n```\nInternal Name: `relclient-win32-builder_steam_rel_client_`\n```\n              win32@steam-relclient-win32-builder)\n\n```\nFile Description: `steamerrorreporter.exe`\n\n\n**Digital Signature:**\n\n\n**Issuer Name:** **DigiCert SHA2 Assured ID Code Signing CA**\n\nSubject: Valve\n\nSerial Number: 054f466ceccbe9d6bee81f5435e64d47\n\n\n**NvSmartMaxapp from NVIDIA**\n\n**Version Info:**\n\n\n**Company Name:**\n\nProduct Name: NVIDIA Smart Maximise Helper Host version 100.03\n\nInternal Name: NvSmartMaxapp\n\nFile Description: NVIDIA Smart Maximise Helper Host\n\n\n**Digital Signature:**\n\n\n**Issuer Name:** **Symantec Class 3 SHA256 Code Signing CA**\n\nSubject: NVIDIA Corporation\n\n\nSerial Number: 7bc15af21367d0758beddcca118642de\n### Impact\n\nMetamorfo is a potent piece of malware, whose primary capability is theft of banking information and other personal\ndata from the user and exfiltration of it to the C2 server. We also noticed that the malware tries to download other files\nfrom the C2 server, suggesting that it could download an updated version of itself with an extended command set as\nwell.\n\n\n-----\n\nLoading DLLs for illicit profit. A story about a Metamorfo distribution campaign\n\n### Campaign distribution and evolution\n\n Region Distribution\n\nThe campaign mostly targets Brazilian users, but we also traced infections back to Switzerland and Argentina as well.\n\n**Region** **Count**\n\n\nBrazil 5188\n\nSwitzerland 7\n\nArgentina 1\n\n\n### Evolution Over Time\n\n**Month** **Detection Count**\n\n2019-05 14\n\n2019-06 71\n\n2019-07 230\n\n2019-08 56\n\n2019-09 105\n\n2019-10 784\n\n2019-11 853\n\n2019-12 629\n\n2020-01 469\n\n2020-02 557\n\n2020-03 775\n\n2020-04 536\n\n\n-----\n\nLoading DLLs for illicit profit. A story about a Metamorfo distribution campaign\n\n### Hardening software to increase the cost of an attack\n\nDLL hijacking attacks have been around for as long as the Windows operating system has been. At this point, many\ndevelopers are thinking along the lines of “But this is a Windows issue! Can I, as a software developer, fix it?”\n\nYes, you can. You surely can, but it’s not easy.\n\nThe essence of the problem is the way Windows searches for DLLs that are required to load a program[8]. When\nloading DLLs by name (as opposed to the full path) the default DLL search path is:\n\n- The system directory (returned by the GetSystemDirectory function).\n\n- The 16-bit system directory.\n\n- The Windows directory (returned by the GetWindowsDirectory function).\n\n- The current directory for the process.\n\n- The directories listed in the PATH environment variable.\n\nThere are two exceptions to the rule, KnownDLLs (DLLs listed in the registry under HKEY_LOCAL_MACHINE\\System\\\n_CurrentControlSet\\Control\\Session Manager\\KnownDLLs and their dependencies) and DLLs already loaded in the_\nprocess.\n\nThe solution should be simple, namely to never load DLLs by name. However, this is not enough. Windows loads\nDLLs when a developer explicitly asks for a DLL through _LoadLibrary* function calls and implicitly for compile-time_\nlinked DLLs. Compile-time DLLs are resolved by DLL name alone before execution even begins, so they are beyond\nthe programmer’s control. Fortunately, all operating systems starting with Windows 7 Service Pack 1 and above offer\nmitigations for the DLL hijacking problem.\n\nOn modern Windows systems, the correct way to explicitly load a DLL is by using LoadLibraryEx and using a full\npath or passing the LOAD_LIBRARY_SEARCH_SYSTEM32 flag. This is, sadly, not enough because DLLs may implicitly\nor explicitly load other DLLs. To solve the problem completely, a programmer must call the SetDefaultDllDirectories\nfunction at the start of the executable and pass in the LOAD_LIBRARY_SEARCH_SYSTEM32 flag.\n\nFixing the problems caused by compile-time DLLs is a bit more challenging. As stated in the introduction, a Windows\napplication needs DLLs to function, and you can’t ask programmers to load all DLLs by hand using LoadLibraryEx with\nfull paths all the time.\n\nFor DLLs that are part of the software packages bundled with the application, developers can create manifests within\n\n\n-----\n\nLoading DLLs for illicit profit. A story about a Metamorfo distribution campaign\n\n<file name=”dllname.dll” hash=”DA39A3EE5E6B4B0D3255BFEF95601890AFD80709” hashalg=”SHA1”>\nThe elegant solution is to make sure your application has regular compile-time dependencies only to DLLs listed in\n_KnownDLLs (since they are not vulnerable to hijack). Also change all other library dependencies for delay loading at_\nlink-time (using /DELAYLOAD:<dllname>.dll if you compile and link using the Microsoft tool-set). For delayed loads,\nthe loader defers loading a DLL until the first function inside it is called. This gives programmers a chance to call\n_SetDefaultDllDirectories before dangerous implicit loading._\n\n### Ok, I did all this, is the problem solved now?\n\nAs our friends at AVG said in an e-mail when discussing the problem, sadly you don’t have a time machine. Once you\ndelivered digitally signed and vulnerable versions of a component, you can never take it back. The internet holds all\nthings, and you can never truly get rid of something after it reaches the aether.\n\nIn a perfect world, all software vendors would immediately revoke all certificates of vulnerable applications, Microsoft\nwould force Windows to not start applications with revoked certificates and cyber-security solutions would be able to\ndetect and block the tainted binaries.\n\nThe entire process would probably cost millions of dollars in development time, re-signing of all binaries and\ndeployment of all updates. We don’t live in that world. Instead, all defenders should probably stop trusting digital\nsignatures. The main executable, as well as any of the loaded DLLs, needs to be scanned by security solutions. Users\nand security specialists alike should configure exceptions only in the most extreme cases and, even then, they should\nbe as explicit as possible. Exceptions should specify the full path of the executable, the certificate and, if possible, even\nthe DLLs loaded and the actions an application is allowed to perform.\n\n\n-----\n\nLoading DLLs for illicit profit. A story about a Metamorfo distribution campaign\n\n## Conclusion\n\nMetamorfo is a known piece of Banker malware that resurfaced at the end of last year and almost exclusively focuses\non Brazilian victims. Novelty aside, the exciting aspect of this malware is the way it employs various techniques to\nevade malware defenses and the tremendous work put into finding executables from various well-known software\nvendors that are susceptible to DLL side-loading.\n\nBut why would an actor put so much effort into finding these legitimate vulnerable executables when attackers could\nlaunch rundll32.exe or regsvr32.exe to load any DLL? The answer is that, this way, attackers increase their chances of\nevading user-suspicious detection. Anti-malware solutions generally monitor actions performed by Windows binaries\nlike rundll32.exe or regsvr32.exe as they are the go-to tools for mainstream attackers. Also, executing their malware\nDLL with the help of these processes would raise a red flag for incident responders and threat hunters. Therefore, by\nchoosing prominent software vendors to mask their actions, attackers can remain undetected. A digital signature and\nfamiliar name in Version Info might seem benign to casual users as well. The usage of COM objects for starting up the\nexecutables and loading the DLLs also helps actions go under the radar if the AV does not monitor them.\nSome variants have a second layer of defense evasion consisting of DLL injection into legitimate processes like\n_wmplayer.exe or dllhost.exe, making the injection from a trusted AV component seem plausible, then masking malicious_\nactions behind a seemingly benign Windows process.\n\nMetamorfo bypasses detection of AV vendors that whitelist applications based on trusted digital signatures.\nBitdefender products employ advanced algorithms to monitor process behavior, and therefore are unaffected by\nwhitelists.\n\nWe hope software developers reading our article understand the problems caused by digitally signed components\nvulnerable to DLL Hijacks and attempt to mitigate them by loading DLLs in a safe manner.\n\n\n-----\n\nLoading DLLs for illicit profit. A story about a Metamorfo distribution campaign\n\n## Bibliography\n\n[[1] https://attack.mitre.org/techniques/T1073/](https://attack.mitre.org/techniques/T1073/)\n\n[[2] https://lolbas-project.github.io/](https://lolbas-project.github.io/)\n\n[[3] https://blog.trendmicro.com/trendlabs-security-intelligence/analysis-abuse-of-custom-actions-in-windows-installer-](https://blog.trendmicro.com/trendlabs-security-intelligence/analysis-abuse-of-custom-actions-in-windows-installer-msi-to-run-malicious-javascript-vbscript-and-powershell-scripts/)\n[msi-to-run-malicious-javascript-vbscript-and-powershell-scripts/](https://blog.trendmicro.com/trendlabs-security-intelligence/analysis-abuse-of-custom-actions-in-windows-installer-msi-to-run-malicious-javascript-vbscript-and-powershell-scripts/)\n\n[[4] https://securityintelligence.com/posts/taking-over-the-overlay-reverse-engineering-a-brazilian-remote-access-trojan-](https://securityintelligence.com/posts/taking-over-the-overlay-reverse-engineering-a-brazilian-remote-access-trojan-rat/)\n[rat/](https://securityintelligence.com/posts/taking-over-the-overlay-reverse-engineering-a-brazilian-remote-access-trojan-rat/)\n\n[[5] https://medium.com/@chenerlich/the-avast-abuser-metamorfo-banking-malware-hides-by-abusing-avast-](https://medium.com/@chenerlich/the-avast-abuser-metamorfo-banking-malware-hides-by-abusing-avast-executable-ac9b8b392767)\n[executable-ac9b8b392767](https://medium.com/@chenerlich/the-avast-abuser-metamorfo-banking-malware-hides-by-abusing-avast-executable-ac9b8b392767)\n\n[[6] https://www.cybereason.com/blog/brazilian-financial-malware-banking-europe-south-america](https://www.cybereason.com/blog/brazilian-financial-malware-banking-europe-south-america)\n\n[[7] https://www.fireeye.com/content/dam/fireeye-www/global/en/current-threats/pdfs/rpt-dll-sideloading.pdf](https://www.fireeye.com/content/dam/fireeye-www/global/en/current-threats/pdfs/rpt-dll-sideloading.pdf)\n\n[[8] https://docs.microsoft.com/en-us/windows/win32/dlls/dynamic-link-library-search-order](https://docs.microsoft.com/en-us/windows/win32/dlls/dynamic-link-library-search-order)\n\n[[9] https://bitbucket.org/wpostma/dcpcrypt2010/src/default/](https://bitbucket.org/wpostma/dcpcrypt2010/src/default/)\n\n\n-----\n\nLoading DLLs for illicit profit. A story about a Metamorfo distribution campaign\n\n## MITRE Techniques\n\n**Privilege** **Credential** **Command**\n**Execution** **Persistence** **Defense Evasion** **Discovery** **Collection** **Exfiltration**\n**Escalation** **Access** **and Control**\n\n[Exfiltration](https://attack.mitre.org/techniques/T1041)\n\n[Execution](https://attack.mitre.org/techniques/T1129) [DLL Search](https://attack.mitre.org/techniques/T1038) [DLL Search](https://attack.mitre.org/techniques/T1038) [Application](https://attack.mitre.org/techniques/T1010) [Over](https://attack.mitre.org/techniques/T1041)\n\n[DLL Search](https://attack.mitre.org/techniques/T1038) [Commonly](https://attack.mitre.org/techniques/T1043)\n\n[through](https://attack.mitre.org/techniques/T1129) [Order](https://attack.mitre.org/techniques/T1038) [Order](https://attack.mitre.org/techniques/T1038) [Input Capture](https://attack.mitre.org/techniques/T1056) [Window](https://attack.mitre.org/techniques/T1010) [Input Capture](https://attack.mitre.org/techniques/T1056) [Command](https://attack.mitre.org/techniques/T1041)\n\n[Order Hijacking](https://attack.mitre.org/techniques/T1038) [Used Port](https://attack.mitre.org/techniques/T1043)\n\n[Module Load](https://attack.mitre.org/techniques/T1129) [Hijacking](https://attack.mitre.org/techniques/T1038) [Hijacking](https://attack.mitre.org/techniques/T1038) [Discovery](https://attack.mitre.org/techniques/T1010) [and Control](https://attack.mitre.org/techniques/T1041)\n\n[Channel](https://attack.mitre.org/techniques/T1041)\n\n[Component](https://attack.mitre.org/techniques/T1175)\n\n[Registry](https://attack.mitre.org/techniques/T1060)\n\n[Object](https://attack.mitre.org/techniques/T1175) [File and](https://attack.mitre.org/techniques/T1083)\n\n[Run Keys](https://attack.mitre.org/techniques/T1060) [DLL Side-](https://attack.mitre.org/techniques/T1073) [Screen](https://attack.mitre.org/techniques/T1113)\n\n[Model and](https://attack.mitre.org/techniques/T1175) [Directory](https://attack.mitre.org/techniques/T1083)\n\n[/ Startup](https://attack.mitre.org/techniques/T1060) [Loading](https://attack.mitre.org/techniques/T1073) [Capture](https://attack.mitre.org/techniques/T1113)\n\n[Distributed](https://attack.mitre.org/techniques/T1175) [Discovery](https://attack.mitre.org/techniques/T1083)\n\n[Folder](https://attack.mitre.org/techniques/T1060)\n\n[COM](https://attack.mitre.org/techniques/T1175)\n\n[Software](https://attack.mitre.org/techniques/T1518)\n[Masquerading](https://attack.mitre.org/techniques/T1036)\n[Discovery](https://attack.mitre.org/techniques/T1518)\n\n[Process Injection](https://attack.mitre.org/techniques/T1055)\n\n\n-----\n\nLoading DLLs for illicit profit. A story about a Metamorfo distribution campaign\n\n## Appendix 1. Indicators of Compromise\n\n### Hashes\n\n###### A list of hashes is available in this Github project maintained by Bitdefender.\n### URL\n\nhxxp://buleva[.]webcindario[.]com/my/\n\n### IP Address\n\n5.57.226.202\n\n### Files dropped\n\nThe names of the dropped .vbs files are random, for example:\n\n_\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\shzvmmraec.vbs_\n\n### Mutex\n\nCreates a named mutex, “holexrel”\n\n\n-----\n\nLoading DLLs for illicit profit. A story about a Metamorfo distribution campaign\n\n## Appendix 2. The malicious IP’s previous DNS resolutions\n\n[A list of domains is available in this Github project maintained by Bitdefender.](https://github.com/bitdefender/malware-ioc/blob/master/metamorfo_malware/domains.txt)\n\n## Appendix 3. Decrypted Resources\n\n[A list of decrypted strings is available in this Github project maintained by Bitdefender.](https://github.com/bitdefender/malware-ioc/blob/master/metamorfo_malware/decrypted_strings.txt)\n\nAn up-to-date list of indicators of compromise is available to Bitdefender Advanced Threat Intelligence users. More\ninformation about the program is available at https://www.bitdefender.com/oem/advanced-threat-intelligence.html.\n\n\n-----\n\n###### Proudly Serving Our Customers Dedicated To Our +20.000 Worldwide Partners\nBitdefender provides solutions and services for small business and A channel-exclusive vendor, Bitdefender is proud to share success with tens of\nmedium enterprises, service providers and technology integrators. We take thousands of resellers and distributors worldwide.\npride in the trust that enterprises such as Mentor, Honeywell, Yamaha,\n**Speedway, Esurance or Safe Systems place in us.** _CRN 5-Star Partner, 4th Year in a Row. Recognized on CRN’s Security 100 List. CRN Cloud_\n\n_Partner, 2nd year in a Row_\n\n_Leader in Forrester’s inaugural Wave™ for Cloud Workload Security_\n\n_More MSP-integrated solutions than any other security vendor_\n\n_NSS Labs “Recommended” Rating in the NSS Labs AEP Group Test_\n\n_3 Bitdefender Partner Programs - to enable all our partners – resellers, service providers_\n\n_SC Media Industry Innovator Award for Hypervisor Introspection, 2nd Year in_ _and hybrid partners – to focus on selling Bitdefender solutions that match their own_\n_a Row_ _specializations_\n\n_Gartner® Representative Vendor of Cloud-Workload Protection Platforms_\n\n###### Trusted Security Authority\nBitdefender is a proud technology alliance partner to major virtualization vendors, directly contributing to the development of secure ecosystems with\n**VMware, Nutanix, Citrix, Linux Foundation, Microsoft, AWS, and Pivotal.**\n\nThrough its leading forensics team, Bitdefender is also actively engaged in countering international cybercrime together with major law enforcement agencies\nsuch as FBI and Europol, in initiatives such as NoMoreRansom and TechAccord, as well as the takedown of black markets such as Hansa. Starting in 2019,\nBitdefender is also a proudly appointed CVE Numbering Authority in MITRE Partnership.\n\n**RECOGNIZED BY LEADING ANALYSTS AND INDEPENDENT TESTING ORGANIZATIONS** **TECHNOLOGY ALLIANCES**\n\n###### UNDER THE SIGN OF THE WOLF\n\n**Founded 2001, Romania** A trade of brilliance, data security is an industry where only the clearest view, sharpest mind and deepest insight can\n**Number of employees 1800+** win — a game with zero margin of error. Our job is to win every single time, one thousand times out of one thousand,\n\nand one million times out of one million.\n\n**Headquarters**\nEnterprise HQ – Santa Clara, CA, United States And we do. We outsmart the industry not only by having the clearest view, the sharpest mind and the deepest insight,\nTechnology HQ – Bucharest, Romania but by staying one step ahead of everybody else, be they black hats or fellow security experts. The brilliance of our\n\ncollective mind is like a luminous Dragon-Wolf on your side, powered by engineered intuition, created to guard against\n\n**WORLDWIDE OFFICES** all dangers hidden in the arcane intricacies of the digital realm.\n**USA & Canada: Ft. Lauderdale, FL | Santa Clara, CA | San Antonio, TX |**\nToronto, CA This brilliance is our superpower and we put it at the core of all our game-changing products and solutions.\n**Europe: Copenhagen, DENMARK | Paris, FRANCE | München, GERMANY**\n| Milan, ITALY | Bucharest, Iasi, Cluj, Timisoara, ROMANIA | Barcelona,\nSPAIN | Dubai, UAE | London, UK | Hague, NETHERLANDS\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        }
    ],
    "references": [
        "https://www.bitdefender.com/files/News/CaseStudies/study/333/Bitdefender-PR-Whitepaper-Metamorfo-creat4500-en-EN-GenericUse.pdf"
    ],
    "report_names": [
        "Bitdefender-PR-Whitepaper-Metamorfo-creat4500-en-EN-GenericUse.pdf"
    ],
    "threat_actors": [
        {
            "id": "67bf0462-41a3-4da5-b876-187e9ef7c375",
            "created_at": "2022-10-25T16:07:23.44832Z",
            "updated_at": "2025-03-27T02:02:09.806007Z",
            "deleted_at": null,
            "main_name": "Careto",
            "aliases": [
                "Careto",
                "The Mask",
                "Ugly Face"
            ],
            "source_name": "ETDA:Careto",
            "tools": [
                "Careto"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716501,
    "ts_updated_at": 1743041369,
    "ts_creation_date": 1590145928,
    "ts_modification_date": 1590145932,
    "files": {
        "pdf": "https://archive.orkl.eu/6cd792ea3c97a0caf403b3697bb9cb069b04fd7c.pdf",
        "text": "https://archive.orkl.eu/6cd792ea3c97a0caf403b3697bb9cb069b04fd7c.txt",
        "img": "https://archive.orkl.eu/6cd792ea3c97a0caf403b3697bb9cb069b04fd7c.jpg"
    }
}