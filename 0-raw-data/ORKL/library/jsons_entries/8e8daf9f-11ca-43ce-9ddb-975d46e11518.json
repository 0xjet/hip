{
    "id": "8e8daf9f-11ca-43ce-9ddb-975d46e11518",
    "created_at": "2023-01-12T15:04:37.363736Z",
    "updated_at": "2025-03-27T02:05:24.757056Z",
    "deleted_at": null,
    "sha1_hash": "7934aac63f93601f45023c4fbb8f2f6975181500",
    "title": "2021-07-14 - Microsoft delivers comprehensive solution to battle rise in consent phishing emails",
    "authors": "",
    "file_creation_date": "2022-05-28T16:15:00Z",
    "file_modification_date": "2022-05-28T16:15:00Z",
    "file_size": 569763,
    "plain_text": "# Microsoft delivers comprehensive solution to battle rise in consent phishing emails\n\n**microsoft.com/security/blog/2021/07/14/microsoft-delivers-comprehensive-solution-to-battle-rise-in-consent-phishing-**\nemails/\n\nJuly 14, 2021\n\nMicrosoft threat analysts are tracking a continued increase in consent phishing emails, also\n[called illicit consent grants, that abuse OAuth request links in an attempt to trick recipients](https://docs.microsoft.com/en-us/microsoft-365/security/office-365-security/detect-and-remediate-illicit-consent-grants?view=o365-worldwide)\ninto granting attacker-owned apps permissions to access sensitive data.\n\nThis blog offers a look into the current state of consent phishing emails as an initial attack\nvector and what security administrators can do to prevent, detect, and respond to these\nthreats using advanced solutions like Microsoft Defender for Office 365. Consent phishing\nattacks aim to trick users into granting permissions to malicious cloud apps in order to gain\naccess to user’s legitimate cloud services. The consent screen displays all permissions the\napp receives; and because the cloud services are legitimate, unsuspecting users accept the\nterms or hit ‘enter,’ which grants the malicious app those requested permissions.\n\nConsent phishing attacks are a specialized form of phishing, so they require a\ncomprehensive, multi-layer defense. It’s important for system administrators to gain visibility\nand control over apps and the permissions these apps have in their environment. User\nconsent settings with consent policies in Azure Active Directory enable administrators to\nmanage when end users can grant consent to apps. A new app governance add-on feature\nin Microsoft Defender for Cloud Apps (previously Microsoft Cloud App Security) provides\norganizations the visibility to enable them to quickly identify when an app exhibits anomalous\nbehavior.\n\n[Microsoft has previously warned against these application-based attacks as many](https://www.microsoft.com/security/blog/2020/07/08/protecting-remote-workforce-application-attacks-consent-phishing/)\norganizations shifted to remote work force at the onset of the COVID-19 pandemic.\nMicrosoft’s Digital Crimes Unit (DCU) has in the past also taken steps to disrupt\ncybercriminal infrastructure used for a particular consent phishing campaign.\n\n## The state of consent phishing attacks\n\nConsent phishing attacks abuse legitimate cloud service providers, including Microsoft,\nGoogle, and Facebook, that use OAuth 2.0 authorization—a widely used industry protocol\nthat allows third-party apps to access a user’s account and perform actions on their behalf.\n\nThe goal of these attacks is to trick unsuspecting users into granting permissions (consent)\nto malicious attacker-owned applications. This is different from a typical credential harvesting\nattack, where an attacker looking to steal credentials would craft a convincing email, host a\n\n\n-----\n\nfake landing page, and expect users to fall for the lure. If the attempt is successful, user\ncredentials are then passed on to the attacker.\n\nIn a consent phishing attack, the user sign-in takes place at a legitimate identity provider,\nrather than a fake sign-in page, in an attempt to trick users into granting permissions to\nmalicious attacker-controlled applications. Attackers use the obtained access tokens to\nretrieve users’ account data from the API resource, without any further action by the user.\nTargeted users who grant the permissions allow attackers to make API calls on their behalf\nthrough the attacker-controlled app. Depending on the permissions granted, the access\ntoken can also be used to access other data, such as files, contacts, and other profile details.\n\nMicrosoft Defender for Office 365 data shows an increasing use of this technique in recent\nmonths.\n\n_Figure 1. OAuth phishing URL trend from October 2020_\n\nIn most cases, consent phishing attacks do not involve password theft, as access tokens\ndon’t require knowledge of the user’s password, yet attackers are still able to steal\nconfidential data and other sensitive information. Attackers can then maintain persistence in\nthe target organization and perform reconnaissance to further compromise the network.\n\nA typical consent phishing attack follows this attack chain:\n\n\n-----\n\n_Figure 2. Consent phishing attack flow_\n\nAttackers typically configure apps so that they appear trustworthy, registering them using\nnames like “Enable4Calc”, “SettingsEnabler”, or “Settings4Enabler,” which resemble\nlegitimate business productivity app integrations. Attackers then distribute OAuth 2.0 URLs\nvia conventional email-based phishing attacks, among other possible techniques.\n\nClicking the URL triggers an authentic consent prompt, asking users to grant the malicious\napp permissions. Other cloud providers, such as Google, Facebook, or Twitter, display\nconsent prompts or dialog boxes that request for users’ permissions on behalf of third-party\napps. The permissions requested vary depending on the app.\n\n\n-----\n\n_Figure 3. OAuth apps gain permission by displaying a “Permissions requested” dialog that_\n_shows what permissions the third-party is requesting_\n\nWhen users click “accept” or “allow”, the app obtains an authorization code that it redeems\nfor an access token. This access token is then used to make API calls on behalf of the user,\ngiving attackers access to the user’s email, forwarding rules, files, contacts, and other\nsensitive data and resources.\n\n## Consent phishing campaign: A case study\n\n\n-----\n\nA recent consent phishing attack we tracked employed social engineering techniques to craft\nan email that impersonates a business growth solutions company. The message falsely\nclaims to instruct users to review and sign a document, signaling a sense of urgency for the\nuser—a tactic that is apparent in most phishing emails.\n\n_Figure 4. Sample email campaign with a Review Doc(s) & Sign link pointing to an OAuth_\n_URL_\n\nThere are several phishing techniques in this email campaign: brand impersonation,\npersonalized email text specific to the recipient or organization, and a recognizable sense of\nurgency as a social engineering lure.\n\nWhat differentiates this attack from others is how the OAuth URL serves malicious content.\nTo the email recipient, the “Review Doc(s) & Sign” OAuth URL appears legitimate, while URL\nis formatted with the identity provider URL as well.\n\nThe pattern we observed in this instance displays the the OAuth URL as\n“login.microsoftonline.com.” Other providers, such as Google, also format OAuth URLs in a\nsimilar manner.\n\n\n-----\n\n_Figure 5. Observed patterns in OAuth URLs pointing to attacker’s domain_\n\nGiven the recent trend in OAuth abuse, we encourage organizations to look into and prevent\nthis critical threat, beyond what traditional security measures offer.\n\n## How Microsoft delivers comprehensive, coordinated defense against consent phishing\n\nThe sophisticated and dynamic threat landscape exemplified by consent phishing attacks\n[demonstrates the importance of employing a Zero Trust security model with a multi-layer](https://www.microsoft.com/en-us/itshowcase/implementing-a-zero-trust-security-model-at-microsoft)\ndefense architecture.\n\n[Microsoft 365 Defender provides comprehensive protection against consent phishing by](https://www.microsoft.com/en-us/security/business/threat-protection/microsoft-365-defender)\ncoordinating defense across domains using multiple solutions: Microsoft Defender for Office\n365, [Microsoft Defender for Cloud Apps, and](https://www.microsoft.com/en-us/security/business/cloud-app-security) [Azure Active Directory.](https://azure.microsoft.com/en-us/services/active-directory/)\n\n### Prevent consent for illegitimate apps with Azure AD user consent settings\n\nThe Microsoft identity platform helps prevent consent phishing in a few ways.\n\nWith risk-based step-up consent, Azure Active Directory (Azure AD) blocks end users from\nbeing able to grant consent to apps that are considered potentially risky. For example, a\nnewly-registered multi-tenant app that has not been publisher-verified might be considered\nrisky, and end users would not be allowed to grant consent, even if they visit the OAuth\nphishing URL.\n\n\n-----\n\nAzure AD puts admins in control over when users are allowed to grant consent to apps. This\nis a powerful mechanism for preventing the threat in the first place, and Microsoft\n[recommends that organizations review settings for when users can grant consent. Microsoft](https://docs.microsoft.com/azure/active-directory/manage-apps/configure-user-consent?tabs=azure-portal)\nrecommends choosing the out-of-the-box option where users are only allowed to consent to\napps from verified publishers, and only for chosen, lower risk permissions. For additional\n[granularity, admins can also create custom consent policies, which dictate the conditions for](https://aka.ms/consent.policies-create-powershell)\nallowing users to grant consent, including for specific apps, publishers, or permissions.\n\n### Blocking consent phishing emails with Microsoft Defender for Office 365\n\nMicrosoft Defender for Office 365 uses advanced filtering technologies backed by machine\nlearning, IP and URL reputation systems, and unparalleled breadth of signals to provide\ndurable protection against phishing and other malicious emails, helping to block consent\nphishing campaigns out of the gate. Anti-phishing policies in Defender for Office 365 help\n[protect organizations against impersonation-based phishing attacks.](https://docs.microsoft.com/en-us/microsoft-365/security/office-365-security/set-up-anti-phishing-policies?view=o365-worldwide#impersonation-settings-in-anti-phishing-policies-in-microsoft-defender-for-office-365)\n\nMicrosoft researchers are constantly tracking OAuth 2.0 URL techniques and use this\nknowledge to provide feedback to email filtering systems. This helps ensure that Microsoft\nDefender for Office 365 is providing protection against the latest OAuth phishing attacks and\nother threats. Signals from Microsoft Defender Office 365 helps identify malicious apps and\nprevent users from accessing them, and provides rich threat data that organizations can\n[query and investigate using advanced hunting capabilities.](https://docs.microsoft.com/en-us/microsoft-365/security/defender/advanced-hunting-overview?view=o365-worldwide)\n\n### Identifying malicious apps with Microsoft Defender for Cloud Apps\n\n[Microsoft Defender for Cloud Apps policies such as activity policies,](https://docs.microsoft.com/en-us/cloud-app-security/user-activity-policies) [anomaly detection, and](https://docs.microsoft.com/en-us/cloud-app-security/anomaly-detection-policy)\n[OAuth app policies help organizations manage apps connected to their environment. The](https://docs.microsoft.com/en-us/cloud-app-security/app-permission-policy)\n[new app governance add-on feature to Microsoft Defender for Cloud Apps helps](https://aka.ms/appgovernancedocs)\norganizations:\n\nDefine appropriate Microsoft 365 app behavior with data, users, and other apps\nQuickly detect unusual app behavior activity that varies from the baseline, and\nDisable an app when it behaves differently than expected\n\n\n-----\n\n_Figure 6. App governance in Microsoft 365 Compliance_\n\nTo give organizations and users confidence in using apps in the Microsoft 365 ecosystem,\nthe [Microsoft 365 App Compliance Program enables app developers to establish authenticity](https://docs.microsoft.com/en-us/microsoft-365-app-certification/overview)\n[of their applications. The program includes publisher verification, publisher attestation, and](https://techcommunity.microsoft.com/t5/azure-active-directory-identity/publisher-verification-and-app-consent-policies-are-now/ba-p/1257374)\nMicrosoft 365 certification.\n\n### Investigating and hunting for consent phishing attacks\n\n[Security operations teams can use advanced hunting capabilities in Microsoft 365 Defender](https://docs.microsoft.com/en-us/microsoft-365/security/defender/advanced-hunting-overview?view=o365-worldwide)\nto locate consent phishing emails and other threats. Microsoft 365 Defender consolidates\nand correlates email threat data from Microsoft Defender for Office 365, app signals from\nMicrosoft Defender for Cloud Apps, and intelligence from other Microsoft services to provide\na comprehensive end-to-end view of attacks. Security operations teams can then use the\nrich tools in Microsoft 365 Defender to investigate and remediate attacks.\n\n**OAuth URL pattern redirects to domain with unusual TLD**\n\nThe consent phishing campaigns we described in this blog used a variety of unusual TLDs\nfor communication with the attacker infrastructure. Use query below to find inbound emails\nwith suspicious OAuth patterns. The suggested TLDs are based on our investigations.\nSecurity teams can modify the TLDs to expand the search. Run query in Microsoft 365\nDefender.\n```\nlet UnusualTlds =\npack_array('.uno','.host','.site','.tech','.website','.space','.online');\nEmailUrlInfo\n\n```\n\n-----\n\n```\n| where Url startswith https://login.windows.net/common/oauth2\nor Url startswith \"https://login.microsoftonline.com/consumers/oauth2\"\n| where Url has \"redirect_uri\"\n| where Url has_any(UnusualTlds)\n| join EmailEvents on $left.NetworkMessageId == $right.NetworkMessageId\n| where EmailDirection == \"Inbound\"\n\n### Best practices for protecting organizations against consent phishing\n\n```\nIn addition to taking full advantage of the tools available to them in Microsoft 365 and\nMicrosoft Azure, administrators can further strengthen defenses against consent phishing by\nfollowing these measures:\n\n[Configure user consent settings to only allow user consent for apps from verified](https://docs.microsoft.com/azure/active-directory/manage-apps/configure-user-consent)\npublishers, for specific low-risk permissions.\nIncrease end user awareness on consent phishing tactics as part of security training.\nTraining should include checking for poor spelling and grammar in phishing mails or the\napplication’s consent screen as well as spoofed app names and domain URLs that are\nmade to appear to come from legitimate applications or companies.\nEducate the organization on how permissions and consent frameworks work.\nUnderstand the data and permissions an application is asking for and understand\nhow [permissions and consent work within our platform. Ensure administrators know](https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-permissions-and-consent)\n[how to manage and evaluate consent requests and](https://docs.microsoft.com/en-us/azure/active-directory/manage-apps/manage-consent-requests) investigate and remediate risky\nOAuth applications.\n[Audit apps and consented permissions in your organization to ensure applications](https://docs.microsoft.com/en-us/azure/security/fundamentals/steps-secure-identity#audit-apps-and-consented-permissions)\nbeing used are accessing only the data they need and adhering to the principles of\nleast privilege.\n[Create proactive app governance policies to monitor third party app behavior on the](https://aka.ms/appgovernancedocs)\nMicrosoft 365 platform since policy driven and machine-learning initiated remediations\naddress app behaviors both for common and emerging threat scenarios.\n\n### Additional resources\n\nApp governance add-on feature for Microsoft Defender for Cloud Apps is initially available as\na public preview to existing Microsoft Defender for Cloud Apps customers in North America\nand Europe with other regions being added gradually the next few months.\n\n[To get started with app governance, visit our quick start guide. To learn more about app](https://aka.ms/appgovernancepreview)\n[governance, visit our documentation. To launch app governance portal in Microsoft 365](https://aka.ms/appgovernancedocs)\nCompliance center, go to [https://aka.ms/appgovernance.](https://aka.ms/appgovernance)\n\nRefer to our documentation for reference on configuring and managing user consent and app\npermissions in Azure AD. For more information on Microsoft Defender for Cloud Apps refer\nto our [blog and](https://aka.ms/MCASMarch2021) [Microsoft Defender for Cloud Apps explainer video.](https://aka.ms/MCASExplainers)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-07-14 - Microsoft delivers comprehensive solution to battle rise in consent phishing emails.pdf"
    ],
    "report_names": [
        "2021-07-14 - Microsoft delivers comprehensive solution to battle rise in consent phishing emails.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535877,
    "ts_updated_at": 1743041124,
    "ts_creation_date": 1653754500,
    "ts_modification_date": 1653754500,
    "files": {
        "pdf": "https://archive.orkl.eu/7934aac63f93601f45023c4fbb8f2f6975181500.pdf",
        "text": "https://archive.orkl.eu/7934aac63f93601f45023c4fbb8f2f6975181500.txt",
        "img": "https://archive.orkl.eu/7934aac63f93601f45023c4fbb8f2f6975181500.jpg"
    }
}