{
    "id": "7db22042-20ac-4a4a-917d-cd1b4bbc5435",
    "created_at": "2023-01-12T15:09:00.044135Z",
    "updated_at": "2025-03-27T02:08:40.474418Z",
    "deleted_at": null,
    "sha1_hash": "45b78b2a579e0fd96d58deb984de715503b30f58",
    "title": "2021-08-09 - Cinobi Banking Trojan Targets Cryptocurrency Exchange Users via Malvertising",
    "authors": "",
    "file_creation_date": "2022-05-28T02:43:11Z",
    "file_modification_date": "2022-05-28T02:43:11Z",
    "file_size": 1838776,
    "plain_text": "# Cinobi Banking Trojan Targets Cryptocurrency Exchange Users via Malvertising\n\n**[trendmicro.com/en_us/research/21/h/cinobi-banking-trojan-targets-users-of-cryptocurrency-exchanges-.html](https://www.trendmicro.com/en_us/research/21/h/cinobi-banking-trojan-targets-users-of-cryptocurrency-exchanges-.html)**\n\nCyber Threats\n\n\nAugust 9, 2021\n\n\nWe found a new social engineering-based malvertising campaign targeting Japan that delivered a malicious application. The malicious\napplication abused sideloading vulnerabilities to load and start the Cinobi banking trojan.\n\nBy: Jaromir Horejsi, Joseph C Chen August 09, 2021 Read time: ( words)\n\nIn a [previous blog entry, we reported on a campaign, which we labeled “Operation Overtrap,” that targeted Japan with a new banking trojan](https://www.trendmicro.com/en_us/research/20/c/this-week-in-security-news-operation-overtrap-targets-japanese-online-banking-users-and-everything-you-need-to-know-about-tax-scams.html)\ncalled Cinobi. The campaign, which was perpetrated by a group we named “Water Kappa,” delivered Cinobi via spam. It also delivered the\n[trojan using the Bottle exploit kit, which included newer Internet Explorer exploits CVE-2020-1380 and](https://twitter.com/nao_sec/status/1381100024919035908) [CVE-2021-26411 and was used for](https://twitter.com/nao_sec/status/1384065957585248266)\n[malvertising attacks that was distributed only to Microsoft Internet Explorer users. Throughout 2020 and the first half of 2021, we observed](https://www.trendmicro.com/vinfo/tmr?/us/security/news/cybercrime-and-digital-threats/malvertising-when-online-ads-attack)\nlimited activity from the Bottle exploit kit, with traffic decreasing during the middle of June — possibly indicating that the group was turning to\nnew tools and techniques.\n\nMeanwhile, we found a new social engineering-based malvertising campaign targeting Japan that delivered a malicious application disguised\nas either a free porn game, a reward points application, or a video streaming application. The malicious application abused sideloading\nvulnerabilities to load and start the Cinobi banking trojan. We consider this to be a new campaign from Water Kappa that is aimed at users of\nweb browsers other than Internet Explorer.\n\nLooking into the Cinobi sample, we found that the overall functionality remained relatively the same, but the configuration had been updated to\ninclude several Japanese cryptocurrency exchange websites as part of the target list. The group started to use Cinobi to steal the credentials\nof its victim’s cryptocurrency account.\n\nFigure 1. Timeline of Water Kappa’s activities\nInfection Routine\n\n\n-----\n\ne ca pa g s ect o out e beg s e a use ece ed a e t se e ts t at a e d sgu sed as ad e t se e ts o e t e Japa ese\nanimated porn games, reward points applications, or video streaming applications. While we have observed five different themes of their\nmalvertisements, all of them attempt to trick victims into downloading the same archive with the same malware.\n\nFigure 2. The landing page for downloading the malicious archive, disguised as a streaming application\nThese malvertisements are likely cloned from legitimate websites by the malicious actor. Minor modifications are then applied, such as the\nremoval of some buttons and the changing of certain information sections. The only buttons that are left lead to the new page — created by the\nmalicious actor — that instructs the victims how to download and execute the application.\n\nAfter clicking on the button with the text “index.clientdownload.windows” (as shown in figure 2), the landing page starts downloading the ZIP\narchive, which is followed by instructions for the victim on how to open, extract, and execute the main executable file. The other four malicious\nads look visually different, but their behavior and landing page is similar.\n\n\n-----\n\nFigure 3. Instructions for executing the streaming application\nIt is important to note that the access to the website is filtered based on the IP address. Non-Japanese IP addresses will see the following error\nmessage from Cloudflare.\n\nFigure 4. Error shown when the application or game website\n\nis accessed from a non-Japanese IP address\nAnalysis of the malware\n\nAfter extracting the ZIP archive, we noticed the listing seen in Figure 5. The files that we decided were interesting enough to be analyzed are\nmarked in red.\n\n\n-----\n\nFigure 5. Contents of the ZIP\n\narchive containing the game; malicious files are marked in red\n[Most files are legitimate ones taken from an older version of the “Logitech Capture” application, dated 2018. The legitimate and signed](https://www.logitech.com/en-us/product/capture)\nLogiCapture.exe (08FB68EB741BF68F3CFC29A4AD3033D75AD57798ED826D926344015BDB8B0EBB) is instructed in\n[LogiCapture.exe.config via custom application settings to load the Xjs.dll library. Xjs.dll loads the format.cfg file, decrypts the shellcode, and](https://docs.microsoft.com/en-us/dotnet/framework/configure-apps/file-schema/appsettings/appsettings-element-for-configuration)\nexecutes it.\n\nFigure 7. The encrypted format.cfg shellcode\n\nFigure 7. The encrypted format.cfg shellcode\n\nFigure 8. The decrypted format.cfg shellcode; strings with file names and\n\nrundll32 command are visible\n\n\n-----\n\ne s e code e bedded to o at c g cop es co g d a d c g co g to t e te po a y d ecto y % %, e a es t ese es to a d a d\n1.txt, and executes the export function named “a” of the a.dll library via the following command:\n\nrundll32.exe \"%TEMP%\\a.dll\",a %TEMP%\\1.txt\n\nConfig.dll (renamed to a.dll) resolves necessary APIs, loads the content of cfg.config (which is renamed to 1.txt), decrypts it with a XOR key,\n[and executes the shellcode. The decrypted cfg.config is the first stage of the Cinobi banking trojan (as explained in our initial blogpost from](https://www.trendmicro.com/en_us/research/20/c/this-week-in-security-news-operation-overtrap-targets-japanese-online-banking-users-and-everything-you-need-to-know-about-tax-scams.html)\n2020).\n\nFigure 9. Routine in config.dll that decrypts the cfg.config shellcode\n\nFigure 10. Call instruction in Config.dll that executes the\n\ndecrypted cfg.config shellcode\nThe Cinobi banking trojan is split into four stages, with each stage downloading additional components and possibly performing environment or\nanti-virtual machine (VM) checks. There are two command-and-control (C&C) servers, with one of them returning stages 2 to 4, while the other\none returns the configuration files.\n\nThe malicious actor became more active in summer 2021 — we noticed a few more versions with slight differences from the ones described\nearlier. In addition to the application archive with four added malicious files (as shown in Figure 5), we also notice a refactored version of the\narchive with just three files (xjs.dll, format.cfg, and a file named “ros”), only three stages, and a single C&C server serving the configuration\nfiles.\n\nIn the refactored version, Xjs.dll decrypts and loads format.cfg, which is the first stage of the Cinobi banker. This stage, unlike our description\nfrom last year’s blog entry, does not download Tor and other additional stages from the first C&C server. Instead, it reads and extracts files\nfrom the file called “ros”, which is an encrypted package containing stages 2 and 3, a configuration file containing the C&C server, and an\narchive with Tor.\n\nFigure 11: The refactored Cinobi banker\n\nThe most important of these is the configuration file containing websites targeted by the form-grabbing functionality. At the time of writing, we\nnoticed that the banking trojan targets users of 11 Japanese financial institutions, with at least three of these involved in cryptocurrency trading.\n\nWhen a victim using an infected machine accesses one of the websites mentioned in the configuration file and sends the filled-out form back to\nthe server, the form-grabbing feature of the banker gets activated. In the following screenshots, we show examples of login forms with filled\ndata.\n\nAfter clicking the submit button, a text file with an encrypted request briefly appears in the folder with the installed banking trojan. After the\ndecryption of the temporary created text file, the highlighted stolen credentials can be seen.\n\n\n-----\n\nFigure 12. The targeted websites of companies dealing with cryptocurrencies\n\n\n-----\n\nFigure 13. The decrypted requests; login credentials are highlighted\n\nin blue\nConclusion\n\nThe new malvertising campaign shows that Water Kappa is still active and continuously evolving their tools and techniques for greater financial\ngain — this one also aims to steal cryptocurrency. In order to minimize the chances of being infected, users need to be wary of suspicious\nadvertisements on shady websites, and as much as possible, download applications only from trusted sources.\n\nTrend Micro solutions that offer [a multilayered defense system can help organizations protect their employees from these kinds of campaigns](https://www.trendmicro.com/en_us/business/products/user-protection.html)\nby detecting, scanning, and blocking malicious URLs.\n\nIndicators of Compromise\n\n[The complete indicators for this attack can also be found in this appendix.](https://www.trendmicro.com/content/dam/trendmicro/global/en/research/21/h/cinobi-banking-trojan-targets-users-of-cryptocurrency-exchanges-with-new-malvertising-campaign/IOCs-Cinobi%20Banking%20Trojan%20Targets%20Cryptocurrency%20Exchange%20Users%20via%20Malvertising.txt)\n\nURLs\n\nSHA256 File name Note Analysis\n\n\n124FE26D53E2702B42AE07F8AEC5EE4E79E7424BCE6ECDA608536BBF0A7A2377 oneroom_setup.zip Malicious\ngame\narchive\n\nE667F9C109E20900CC8BADD09EDE6CDCE0BDC77164CFD035ACE95498E90D45E7 oneroom_game.zip Malicious\ngame\narchive\n\n93FFE7CF56FEB3FB541AEF91D3FC04A5CF22DF428DC0B7E5FEB8EDDDC2C72699 Magicalgirl.zip Malicious\ngame\narchive\n\nAD13BB18465D259ACC6E4CEBA24BEFF42D50843C8FD92633C569E493A075FDDC kiplayer.zip Malicious\nstreaming\narchive\n\nA9EF18B012BD20945BB3533DEEC69D82437BF0117F83B2E9F9E7FACC5AA81255 oneroom_game_v7.zip Malicious\ngame\narchive\n\n6C1F4FFA63EE7094573B0F6D1BD51255F603BC8958757405C8C998416537D587 Xjs.dll First\nshellcode\nloader\n\n1366E2AC6365E4B76595A19760438D876E01DB40C60EC3F42849F0218B724F1B Xjs.dll First\nshellcode\nloader\n\n0B3E5E2406490DF17A198A8340B103BB331A5277461234F3F90ED257E418C1F8 Xjs.dll First\nshellcode\nloader\n\n3E0FAEE93F6EF572537735C7F2D82D151C5A21EB30EACC576B3B66320C74FD34 format.cfg Encrypted\nshellcode\n\nDB6CBE4EE82F87008B34D1D4E9AA6EE3C9CCD21CB7A0B60925D5DA8D1295A269 format.cfg Encrypted\nshellcode\n\n3B7FB5EC8180AD74871EB9F5B59E6E98A188CE84BA3BD6ADD9B4BCFCCB80C137 format.cfg Encrypted\nshellcode\n\n\nTrojan.Win32.S\n\nTrojan.Win32.S\n\nTrojan.Win32.S\n\nTrojan.Win32.S\n\nTrojan.Win32.S\n\nTrojan.Win32.S\n\nTrojan.Win32.S\n\nTrojan.Win32.S\n\nTrojan.Win32.S\n\nTrojan.Win32.S\n\nTrojan.Win32.S\n\n\n-----\n\n52E2B9CBA4E1BEE1EB3ED9D03BC33EADB6C8D6AAC8598679AA95690E587BE7C4 config.dll Cinobi\n1st stage\nloader;\n32bit\n\nF5AD9E32A84DF617ABA3786F19BA7DAB4B4BD8A27627232D3AACE760511AEDF7 config.dll Cinobi\n1st stage\nloader;\n32bit\n\n45C7C36E7E8B832815D8B03651EDC14F864B52E1C599E5336A1AAA0BD47FF3E3 cfg.config Encrypted\n1st stage\nof Cinobi;\n32bit\n\n522C59BACE844A3D76B674842373DDBF959FC5B352317B024DBF225F536A641E cfg.config Encrypted\n1st stage\nof Cinobi;\n32bit\n\n16AB933AD01D73120EE5B764C12057FF7F6DC3063BBC377CDB87419A30532323 N/A 2nd and\n3rd stage\nloader;\n32bit\n\n9D10AC2A2C7C58F1E1D4B745746AA5F0CE699C0DB87CCCA43418435FAA03AD1B N/A 2nd stage\nencrypted;\n32bit\n\nC4039CD7DB24158BE51DA9010E6A367F5253F40F007B656407FB69D279732784 N/A 3nd stage\nencrypted;\n32bit\n\n2A6FE431326ACCAF31EA7CA7CD1214AD5EFCA891619859BCF60671A62C8D81F4 N/A Cinobi\n4th stage\n(last);\n32bit\n\n258EDBBAC7E78B4F51433807B237FC0ED7F76031795EA48A4FEFB38949F9B3B6 N/A 2nd and\n3rd stage\nloader;\n64bit\n\nA3010F206656752FAD70EF7637947933152E7ADC883B43D0832B2234C8E6F968 N/A 2nd stage\nencrypted;\n64bit\n\nE037839A3DACC3153754A156136E9EAD2F4C52939FE869B3981C4BB5114202C8 N/A 3rd stage\nencrypted;\n64bit\n\nF8B80978D4548139E824863DD661E40AF4C2523C3E93547E4F167A749E108280 N/A Cinobi\n4th stage\n(last);\n64bit\n\nB157BEAC5516D05A014527B3F0FE4B01683CAAC9FFF6608B67A8BA62DF5EF838 N/A 2nd and\n3rd stage\nloader;\n32bit\n\n2384FDA35A293B5F5B32B09E8DC455E7CE40A92D25CD9BACEEAB494785426B46 N/A 2nd stage\nencrypted;\n32bit\n\n\nTrojan.Win32.C\n\nTrojan.Win32.C\n\nTrojan.Win32.C\n\nTrojan.Win32.C\n\nTrojan.Win32.C\n\nTrojan.Win32.C\n\nTrojan.Win32.C\n\nTrojanSpy.Win3\n\nTrojan.Win64.C\n\nTrojan.Win64.C\n\nTrojan.Win64.C\n\nTrojanSpy.Win6\n\nTrojan.Win32.C\n\nTrojan.Win32.C\n\n\n-----\n\n9FF65052FE93A884D7BCE36E87F4DE104839F72F26AF66785B2D98EAB706C816 N/A 3nd stage\nencrypted;\n32bit\n\n31C936D08E9BA8FDA86844F67363223BDB6A917F530571ABCB3F584874909FEA N/A Cinobi\n4th stage\n(last);\n32bit\n\n00F24AC0AD19DC3EE05A112F7650AABA16041020263EA851C90F3C0A61C7EC57 N/A 2nd and\n3rd stage\nloader;\n64bit\n\nB0E5BB79CDFAD284D88BC26DB4289A51F114CC71C928E8A9951DC8C498A243B9 N/A 2nd stage\nencrypted;\n64bit\n\n095E85EBE2155798FB3A5FBD57196CF377B56FB2176CFF3A776302DCB806237D N/A 3rd stage\nencrypted;\n64bit\n\nB36BFF265EE47D31E4C70EE78BADCFCC0DE89643DA61C1BF16BA2D6F36A62936 N/A Cinobi\n4th stage\n(last);\n64bit\n\nE41AB2DE9CCFFE3AADDB32C224114D88D2E61C02D52F89829B544F49B672D74D N/A 2nd stage\nloader;\n32bit\n\n59DF3B32A0D3FEFB15C6AAB7D9254E597484A486156CBC1F403A376A8A0C25FB N/A 2nd stage\nencrypted;\n32bit\n\n043720F493CA7A2B2E18CCD7AEC8CB8D577F544AAE02975BFE313046E839F107 N/A 2nd stage\nloader;\n64bit\n\n83F7D60D172628E421EF038566F449E8708573201C8F23398F0F06B5F33123DA N/A 2nd stage\nencrypted;\n64bit\n\n58C60164AAA23777E5A8DBBA25C4466A5B1ECA54EF8CF02BA2CD1AB7084753BE N/A Cinobi\n3rd stage\n(last);\n32bit\n\nF3DA0C082EB271A2F0DD54F2A3260BFC02BDF311EBCB1C619D479FCBB1E9F6F5 N/A Cinobi\n3rd stage\n(last);\n64bit\n\nIP Address/Domain/URL Note\n\nwww[.]chirigame[.]com Malvertising domain\n\nwww[.]supapureigemu[.]com Malvertising domain\n\nwww[.]getkiplayer[.]com Malvertising domain\n\nwww[.]magicalgirlonlive[.]com Malvertising domain\n\n\nTrojan.Win32.C\n\nTrojanSpy.Win\n\nTrojan.Win64.C\n\nTrojan.Win64.C\n\nTrojan.Win64.C\n\nTrojanSpy.Win6\n\nTrojan.Win32.C\n\nTrojan.Win32.C\n\nTrojan.Win64.C\n\nTrojan.Win64.C\n\nTrojanSpy.Win\n\nTrojanSpy.Win6\n\n\n-----\n\na7q5adiilsjkujxk[.]onion Cinobi banker s C&C serving stages 2-4\n\n5lmt6t4kaymuwvm5[.]onion Cinobi banker’s C&C serving configuration files\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-08-09 - Cinobi Banking Trojan Targets Cryptocurrency Exchange Users via Malvertising.pdf"
    ],
    "report_names": [
        "2021-08-09 - Cinobi Banking Trojan Targets Cryptocurrency Exchange Users via Malvertising.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536140,
    "ts_updated_at": 1743041320,
    "ts_creation_date": 1653705791,
    "ts_modification_date": 1653705791,
    "files": {
        "pdf": "https://archive.orkl.eu/45b78b2a579e0fd96d58deb984de715503b30f58.pdf",
        "text": "https://archive.orkl.eu/45b78b2a579e0fd96d58deb984de715503b30f58.txt",
        "img": "https://archive.orkl.eu/45b78b2a579e0fd96d58deb984de715503b30f58.jpg"
    }
}