{
    "id": "c22ffa69-93e6-47fb-a0b1-1ad09bc75213",
    "created_at": "2023-01-12T15:06:17.434424Z",
    "updated_at": "2025-03-27T02:16:34.74233Z",
    "deleted_at": null,
    "sha1_hash": "673e3b5dde471200ec3de3573976c4d535dd405b",
    "title": "2020-12-18 - Analyzing Solorigate, the compromised DLL file that started a sophisticated cyberattack, and how Microsoft Defender helps protect customers",
    "authors": "",
    "file_creation_date": "2022-05-28T22:10:06Z",
    "file_modification_date": "2022-05-28T22:10:06Z",
    "file_size": 2158773,
    "plain_text": "# Analyzing Solorigate, the compromised DLL file that started a sophisticated cyberattack, and how Microsoft Defender helps protect customers\n\n**microsoft.com/security/blog/2020/12/18/analyzing-solorigate-the-compromised-dll-file-that-started-a-sophisticated-**\ncyberattack-and-how-microsoft-defender-helps-protect/\n\nDecember 18, 2020\n\n**UPDATE: Microsoft continues to work with partners and customers to expand our**\nknowledge of the threat actor behind the nation-state cyberattacks that compromised\nthe supply chain of SolarWinds and impacted multiple other organizations. Microsoft\npreviously used ‘Solorigate’ as the primary designation for the actor, but moving\nforward, we want to place appropriate focus on the actors behind the sophisticated\nattacks, rather than one of the examples of malware used by the actors. Microsoft\nThreat Intelligence Center (MSTIC) has named the actor behind the attack against\nSolarWinds, the SUNBURST backdoor, TEARDROP malware, and related\n[components as NOBELIUM. As we release new content and analysis, we will use](https://www.microsoft.com/security/blog/2021/03/04/goldmax-goldfinder-sibot-analyzing-nobelium-malware/)\nNOBELIUM to refer to the actor and the campaign of attacks.\n\nWe, along with the security industry and our partners, continue to investigate the extent of\nthe Solorigate attack. While investigations are underway, we want to provide the defender\ncommunity with intelligence to understand the scope, impact, remediation guidance, and\nproduct detections and protections we have built in as a result. We have established a\nresource center that is constantly updated as more information becomes available at\n[https://aka.ms/solorigate.](https://aka.ms/solorigate)\n\n\n-----\n\nWhile the full extent of the compromise is still being investigated by the security industry as a\nwhole, in this blog we are sharing insights into the compromised SolarWinds Orion Platform\nDLL that led to this sophisticated attack. The addition of a few benign-looking lines of code\ninto a single DLL file spelled a serious threat to organizations using the affected product, a\nwidely used IT administration software used across verticals, including government and the\nsecurity industry. The discreet malicious codes inserted into the DLL called a backdoor\ncomposed of almost 4,000 lines of code that allowed the threat actor behind the attack to\noperate unfettered in compromised networks.\n\nThe fact that the compromised file is digitally signed suggests the attackers were able to\naccess the company’s software development or distribution pipeline. Evidence suggests that\nas early as October 2019, these attackers have been testing their ability to insert code by\nadding empty classes. Therefore, insertion of malicious code into the\n_SolarWinds.Orion.Core.BusinessLayer.dll likely occurred at an early stage, before the final_\nstages of the software build, which would include digitally signing the compiled code. As a\nresult, the DLL containing the malicious code is also digitally signed, which enhances its\nability to run privileged actions—and keep a low profile.\n\nIn many of their actions, the attackers took steps to maintain a low profile. For example, the\ninserted malicious code is lightweight and only has the task of running a malware-added\nmethod in a parallel thread such that the DLL’s normal operations are not altered or\ninterrupted. This method is part of a class, which the attackers named\n_OrionImprovementBusinessLayer to blend in with the rest of the code. The class contains all_\nthe backdoor capabilities, comprising 13 subclasses and 16 methods, with strings\nobfuscated to further hide malicious code.\n\nOnce loaded, the backdoor goes through an extensive list of checks to make sure it’s\nrunning in an actual enterprise network and not on an analyst’s machines. It then contacts a\ncommand-and-control (C2) server using a subdomain generated partly from information\ngathered from the affected device, which means a unique subdomain for each affected\ndomain. This is another way the attackers try to evade detection.\n\nWith a lengthy list of functions and capabilities, this backdoor allows hands-on-keyboard\nattackers to perform a wide range of actions. As we’ve seen in past human-operated attacks,\nonce operating inside a network, adversaries can perform reconnaissance on the network,\nelevate privileges, and move laterally. Attackers progressively move across the network until\nthey can achieve their goal, whether that’s cyberespionage or financial gain.\n\n\n-----\n\n_Figure 1. Solorigate malware infection chain_\n\nThe challenge in detecting these kinds of attacks means organizations should focus on\nsolutions that can look at different facets of network operations to detect ongoing attacks\nalready inside the network, in addition to strong preventative protection.\n\n[We have previously provided guidance and](https://msrc-blog.microsoft.com/2020/12/13/customer-guidance-on-recent-nation-state-cyber-attacks/) [remediation steps to help ensure that customers](https://www.microsoft.com/security/blog/2020/12/15/ensuring-customers-are-protected-from-solorigate/)\nare empowered to address this threat. In this blog, we’ll share our in-depth analysis of the\nbackdoor’s behavior and functions, and show why it represents a high risk for business\nenvironments. We’ll also share details of the comprehensive endpoint protection provided by\n[Microsoft Defender for Endpoint. In another blog, we discuss protections across the broader](https://www.microsoft.com/en-us/microsoft-365/security/endpoint-defender)\n[Microsoft 365 Defender, which integrates signals from endpoints with other domains –](https://www.microsoft.com/en-us/security/business/threat-protection/integrated-threat-protection)\nidentities, data, cloud – to provide coordinated detection, investigation, and remediation\n[capabilities. Read: Using Microsoft 365 Defender to protect against Solorigate.](https://www.microsoft.com/security/blog/2020/12/28/using-microsoft-365-defender-to-coordinate-protection-against-solorigate/)\n\n## Where it all starts: A poisoned code library\n\nThe attackers inserted malicious code into SolarWinds.Orion.Core.BusinessLayer.dll, a code\nlibrary belonging to the SolarWinds Orion Platform. The attackers had to find a suitable place\nin this DLL component to insert their code. Ideally, they would choose a place in a method\n\n\n-----\n\nthat gets invoked periodically, ensuring both execution and persistence, so that the malicious\ncode is guaranteed to be always up and running. Such a suitable location turns out to be a\nmethod named RefreshInternal.\n\n_Figure 2: The method infected with the bootstrapper for the backdoor_\n\n_Figure 3: What the original method looks like_\n\nThe modification to this function is very lightweight and could be easily overlooked—all it\ndoes is to execute the method OrionImprovementBusinessLayer.Initialize within a parallel\nthread, so that the normal execution flow of RefreshInternal is not altered.\n\nWhy was this method chosen rather than other ones? A quick look at the architecture of this\nDLL shows that RefreshInternal is part of the class\n_SolarWinds.Orion.Core.BusinessLayer.BackgroundInventory.InventoryManager and is_\ninvoked by a sequence of methods that can be traced back to the CoreBusinessLayerPlugin\nclass The purpose of this class which initiates its execution with a method named Start\n\n\n-----\n\n(likely at an early stage when the DLL is loaded), is to initialize various other components\nand schedule the execution of several tasks. Among those tasks is Background Inventory,\nwhich ultimately starts the malicious code.\n\n_Figure 4. The inserted malicious code runs within a parallel thread_\n\nThe functionality of the backdoor resides entirely in the class\n_OrionImprovementBusinessLayer, comprising 13 subclasses and 16 methods. Its name_\nblends in with the rest of the legitimate code. The threat actors were savvy enough to avoid\ngive-away terminology like “backdoor”, “keylogger”, etc., and instead opted for a more\nneutral jargon. At first glance, the code in this DLL looks normal and doesn’t raise\nsuspicions, which could be part of the reason why the insertion of malicious code was\nundetected for months, especially if the code for this DLL was not frequently updated.\n\nTo have some minimal form of obfuscation from prying eyes, the strings in the backdoor are\ncompressed and encoded in Base64, or their hashes are used instead.\n\n\n-----\n\n_Figure 5: Example of obfuscated strings_\n\n## Initial reconnaissance\n\nThe Initialize method is the de facto execution entry point of the backdoor. It carries out\nseveral checks to verify that it is running in a real victim’s environment:\n\nIt verifies that the process hosting the malicious DLL is named\n_solarwinds.businesslayerhost.exe_\nIt checks that the last write-time of the malicious DLL is at least 12 to 14 days earlier\nIt delays execution by random amounts of time\nIt verifies that the domain name of the current device meets the following conditions:\n\nThe domain must not contain certain strings; the check for these strings is\nimplemented via hashes, so at this time the domain names that are block-listed\nare unknown\nThe domain must not contain “solarwinds”\nThe domain must not match the regular expression (?i)([^a-z]|^)(test)([^a-z]|$), or\nin simpler terms, it must not look like a test domain\nIt checks that there are no running processes related to security-related software (e.g.,\n_Windbg, Autoruns, Wireshark)_\nIt checks that there are no drivers loaded from security-related software (e.g.,\n_groundling32.sys)_\nIt checks that the status of certain services belonging to security-related software\nmeets certain conditions (e.g., windefend, sense, cavp)\nIt checks that the host “api.solarwinds.com” resolves to an expected IP address\n\nIf any of these checks fail, the backdoor terminates. All these inspections are carried out to\navoid exposing the malicious functionality to unwanted environments, such as test networks\nor machines belonging to SolarWinds.\n\n## The backdoor\n\nAfter the extensive validation described above, the backdoor enters its main execution stage.\nAt its core, the backdoor is a very standard one that receives instructions from the C2 server,\nexecutes those instructions, and sends back information. The type of commands that can be\nexecuted range from manipulating of registry keys, to creating processes, and deleting files,\netc., effectively providing the attackers with full access to the device, especially since it’s\nexecuting from a trusted, signed binary.\n\nIn its first step, the backdoor initiates a connection to a predefined C2 server to report some\nbasic information about the compromised system and receive the first commands. The C2\ndomain is composed of four different parts: three come from strings that are hardcoded in the\nbackdoor, and one component is generated dynamically based on some unique information\n\n\n-----\n\nextracted from the device. This means that every affected device generates a different\nsubdomain to contact (and possibly more than one). Here’s an example of a generated\ndomain:\n\n_Figure 6: Dynamically generated C2 domain_\n\nThe dynamically generated portion of the domain is the interesting part. It is computed by\nhashing the following data:\n\nThe physical address of the network interface\nThe domain name of the device\nThe content of the MachineGuid registry value from the key\n_HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Cryptography_\n\nThe backdoor also generates a pseudo-random URI that is requested on the C2 domain.\nLike the domain, the URI is composed using a set of hardcoded keywords and paths, which\nare chosen partly at random and partly based on the type of HTTP request that is being sent\nout. Possible URIs that can be generated follow these formats:\n\npki/crl/<random components>.crl, where <random components> can be numbers and\none of the following strings:\n\n“-root”\n“-cert”\n“-universal_ca”\n“-ca”\n“-primary_ca”\n“-timestamp”\n“-global”\n“-secureca”\n\n\n-----\n\nfonts/woff/<random components>-webfont<random component>.woff2 or\nfonts/woff/<random components>.woff2, where the <random components> can be\nnumbers and one or more of the following strings:\n\n“Bold”\n“BoldItalic”\n“ExtraBold”\n“ExtraBoldItalic”\n“Italic”,\n“Light”\n“LightItalic”\n“Regular”\n“SemiBold”\n“SemiBoldItalic”\n“opensans”\n“noto”\n“freefont”\n“SourceCodePro”\n“SourceSerifPro”\n“SourceHanSans”\n“SourceHanSerif”\nswip/upd/<random components>, where <random components> can be one or more of\nthe following strings:\n\n“SolarWinds”\n“.CortexPlugin”\n“.Orion”\n“Wireless”\n“UI”\n“Widgets”\n“NPM”\n“Apollo”\n“CloudMonitoring”\n“Nodes”,\n“Volumes”,\n“Interfaces”,\n“Components”\nswip/Upload.ashx\nswip/Events\n\nHere are examples of final URLs generated by the backdoor:\n\n_hxxps://3mu76044hgf7shjf[.]appsync-api[.]eu-west-1[.]avsvmcloud[.]com_\n_/swip/upd/Orion[.]Wireless[.]xml_\n\n\n-----\n\n_hxxps://3mu76044hgf7shjf[.]appsync-api[.]us-east-2[.]avsvmcloud[.]com /pki/crl/492-_\n_ca[.]crl_\n_hxxps://3mu76044hgf7shjf[.]appsync-api[.]us-east-1[.]avsvmcloud[.]com_\n_/fonts/woff/6047-freefont-ExtraBold[.]woff2_\n\nFinally, the backdoor composes a JSON document into which it adds the unique user ID\ndescribed earlier, a session ID, and a set of other non-relevant data fields. It then sends this\nJSON document to the C2 server.\n\n_Figure 7: Example of data generated by the malware_\n\nIf the communication is successful, the C2 responds with an encoded, compressed buffer of\ndata containing commands for the backdoor to execute. The C2 might also respond with\ninformation about an additional C2 address to report to. The backdoor accepts the following\ncommands:\n\nIdle\nExit\nSetTime\nCollectSystemDescription\nUploadSystemDescription\nRunTask\nGetProcessByDescription\nKillTask\nGetFileSystemEntries\nWriteFile\nFileExists\n\n\n-----\n\nDeleteFile\nGetFileHash\nReadRegistryValue\nSetRegistryValue\nDeleteRegistryValue\nGetRegistrySubKeyAndValueNames\nReboot\nNone\n\nIn a nutshell, these commands allow the attackers to run, stop, and enumerate processes;\nread, write, and enumerate files and registry keys; collect and upload information about the\ndevice; and restart the device, wait, or exit. The command CollectSystemDescription\nretrieves the following information:\n\nLocal Computer Domain name\nAdministrator Account SID\nHostName\nUsername\nOS Version\nSystem Directory\nDevice uptime\nInformation about the network interfaces\n\n## Resulting hands-on-keyboard attack\n\nOnce backdoor access is obtained, the attackers follow the standard playbook of privilege\nescalation exploration, credential theft, and lateral movement hunting for high-value accounts\nand assets. To avoid detection, attackers renamed Windows administrative tools like\n_adfind.exe which were then used for domain enumeration._\n\n_C:\\Windows\\system32\\cmd.exe /C csrss.exe -h breached.contoso.com -f (name=”Domain_\n_Admins”) member -list | csrss.exe -h breached.contoso.com -f objectcategory=* >_\n_.\\Mod\\mod1.log_\n\n[Lateral movement was observed via PowerShell remote task creation, as detailed by FireEye](https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html)\n[and Volexity:](https://www.volexity.com/blog/2020/12/14/dark-halo-leverages-solarwinds-compromise-to-breach-organizations/)\n\n_$scheduler = New-Object -ComObject_\n_(“Schedule.Service”);$scheduler.Connect($env:COMPUTERNAME);$folder =_\n_$scheduler.GetFolder(“\\Microsoft\\Windows\\SoftwareProtectionPlatform”);$task =_\n_$folder.GetTask(“EventCacheManager”);$definition =_\n_$task.Definition;$definition.Settings.ExecutionTimeLimit =_\n_“PT0S”;$folder.RegisterTaskDefinition($task.Name,$definition,6,”System”,$null,5);echo_\n_“Done” C:\\Windows\\system32\\cmd.exe /C schtasks /create /F /tn_\n\n\n-----\n\n_\\Microsoft\\Windows\\SoftwareProtectionPlatform\\EventCacheManager /tr_\n_“C:\\Windows\\SoftwareDistribution\\EventCacheManager.exe” /sc ONSTART /ru system /S_\n\n_[machine_name]_\n\nPersistence is achieved via backdoors deployed via various techniques:\n\n1. PowerShell:\n\n_Powershell -nop -exec bypass -EncodedCommand_\n\nThe –EncodedCommand, once decoded, would resemble:\n\n_Invoke-WMIMethod win32_process -name create -argumentlist ‘rundll32_\n_c:\\windows\\idmu\\common\\ypprop.dll _XInitImageFuncPtrs’ -ComputerName WORKSTATION_\n\n1. Rundll32:\n\n_C:\\Windows\\System32\\rundll32.exe C:\\Windows\\Microsoft.NET\\Framework64\\[malicious .dll_\n_file], [various exports]_\n\nWith Rundll32, each compromised device receives a unique binary hash, unique local\nfilesystem path, pseudo-unique export, and unique C2 domain.\n\nThe backdoor also allows the attackers to deliver second-stage payloads, which are part of\nthe Cobalt Strike software suite. We continue to investigate these payloads, which are\ndetected as Trojan:Win32/Solorigate.A!dha, as the situation continues to unfold.\n\n## Microsoft Defender for Endpoint product and hardening guidance\n\n[Supply chain compromise continues to be a growing concern in the security industry. The](https://i.blackhat.com/USA-19/Thursday/us-19-Doerr-The-Enemy-Within-Modern-Supply-Chain-Attacks.pdf)\nSolorigate incident is a grave reminder that these kinds of attacks can achieve the harmful\ncombination of widespread impact and deep consequences for successfully compromised\n[networks. We continue to urge customers to:](https://www.microsoft.com/security/blog/2020/12/15/ensuring-customers-are-protected-from-solorigate/)\n\nIsolate and investigate devices where these malicious binaries have been detected\nIdentify accounts that have been used on the affected device and consider them\ncompromised\nInvestigate how those endpoints might have been compromised\nInvestigate the timeline of device compromise for indications of lateral movement\n\nHardening networks by reducing attack surfaces and building strong preventative protection\nare baseline requirements for defending organizations. On top of that, comprehensive\nvisibility into system and network activities drive the early detection of anomalous behaviors\nand potential signs of compromise. More importantly, the ability to correlate signals through\nAI could surface more evasive attacker activity.\n\n\n-----\n\n[Microsoft Defender for Endpoint has comprehensive detection coverage across the](https://www.microsoft.com/en-us/microsoft-365/security/endpoint-defender)\nSolorigate attack chain. These detections raise alerts that inform security operations teams\nabout the presence of activities and artifacts related to this incident. Given that this attack\ninvolves the compromise of legitimate software, automatic remediation is not enabled to\nprevent service interruption. The detections, however, provide visibility into the attack activity.\nAnalysts can then use investigation and remediation tools in Microsoft Defender Endpoint to\nperform deep investigation and additional hunting.\n\n[Microsoft 365 Defender provides visibility beyond endpoints by consolidating threat data from](https://www.microsoft.com/en-us/security/business/threat-protection/integrated-threat-protection)\nacross domains – identities, data, cloud apps, as well as endpoints – delivering coordinated\ndefense against this threat. This cross-domain visibility allows Microsoft 365 Defender to\ncorrelate signals and comprehensively resolve whole attack chains. Security operations\nteams can then hunt using this rich threat data and gain insights for hardening networks from\ncompromise. **[Read: Using Microsoft 365 Defender to protect against Solorigate.](https://www.microsoft.com/security/blog/2020/12/28/using-microsoft-365-defender-to-coordinate-protection-against-solorigate/)**\n\n_Figure 8. Microsoft Defender for Endpoint detections across the Solorigate attack chain_\n\nSeveral Microsoft Defender for Endpoint capabilities are relevant to the Solorigate attack:\n\n### Next generation protection\n\n\n-----\n\nMicrosoft Defender Antivirus, the default antimalware solution on Windows 10, detects and\nblocks the malicious DLL and its behaviors. It quarantines malware, even if the process is\nrunning.\n\nDetection for backdoored SolarWinds.Orion.Core.BusinessLayer.dll files:\n\n[Trojan:MSIL/Solorigate.BR!dha](https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?Name=Trojan:MSIL/Solorigate.BR!dha)\n\nDetection for Cobalt Strike fragments in process memory and stops the process:\n\n[Trojan:Win32/Solorigate.A!dha](https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?Name=Trojan:Win32/Solorigate.A!dha&threatId=-2147196107)\n[Behavior:Win32/Solorigate.A!dha](https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?Name=Behavior:Win32/Solorigate.A!dha&threatId=-2147196108)\n\nDetection for the second-stage payload, a cobalt strike beacon that might connect to\ninfinitysoftwares[.]com.\n\n[Trojan:Win64/Solorigate.SA!dha](https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?Name=Trojan:Win64/Solorigate.SA!dha)\n\nDetection for the PowerShell payload that grabs hashes and SolarWinds passwords from the\ndatabase along with machine information:\n\n[Trojan:PowerShell/Solorigate.H!dha](https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?Name=Trojan:PowerShell/Solorigate.H!dha&threatId=-2147196089)\n\n_Figure 9. Microsoft Defender for Endpoint prevented malicious binaries_\n\n### Endpoint detection and response (EDR)\n\nAlerts with the following titles in the Microsoft Defender Security Center and Microsoft 365\nsecurity center can indicate threat activity on your network:\n\n\n-----\n\nSolarWinds Malicious binaries associated with a supply chain attack\nSolarWinds Compromised binaries associated with a supply chain attack\nNetwork traffic to domains associated with a supply chain attack\n\nAlerts with the following titles in the Microsoft Defender Security Center and Microsoft 365\nsecurity center can indicate the possibility that the threat activity in this report occurred or\nmight occur later. These alerts can also be associated with other malicious threats.\n\nADFS private key extraction attempt\nMasquerading Active Directory exploration tool\nSuspicious mailbox export or access modification\nPossible attempt to access ADFS key material\nSuspicious ADFS adapter process created\n\n_Figure 10. Microsoft Defender for Endpoint detections of suspicious LDAP query being_\n_launched and attempted ADFS private key extraction_\n\n\n-----\n\n_Figure 11. Microsoft Defender for Endpoint alert description and recommended actions for_\n_possible attempt to access ADFS key material_\n\nOur ability to deliver these protections through our security technologies is backed by our\nsecurity experts who immediately investigated this attack and continue to look into the\nincident as it develops. Careful monitoring by experts is critical in this case because we’re\ndealing with a highly motivated and highly sophisticated threat actor. In the same way that\nour products integrate with each other to consolidate and correlate signals, security experts\nand threat researchers across Microsoft are working together to address this advanced\nattack and ensure our customers are protected.\n\n### Threat analytics report\n\n\n-----\n\n[We published a comprehensive threat analytics report on this incident. Threat analytics](https://techcommunity.microsoft.com/t5/microsoft-365-defender/new-threat-analytics-report-shares-the-latest-intelligence-on/ba-p/2001095)\nreports provide technical information, detection details, and recommended mitigations\ndesigned to empower defenders to understand attacks, assess its impact, and review\ndefenses.\n\n_Figure 12. Threat analytics report on the Solorigate attack_\n\n### Advanced hunting\n\nMicrosoft 365 Defender and Microsoft Defender for Endpoint customers can run advanced\nhunting queries to hunt for similar TTPs used in this attack.\n\n**Malicious DLLs loaded into memory**\n\nTo locate the presence or distribution of malicious DLLs loaded into memory, run the\nfollowing query\n\n\n-----\n\n```\nDeviceImageLoadEvents \n| where SHA1 in (\"d130bd75645c2433f88ac03e73395fba172ef676\",\n\"1acf3108bf1e376c8848fbb25dc87424f2c2a39c\",\"e257236206e99f5a5c62035c9c59c57206728b28\",\n\"6fdd82b7ca1c1f0ec67c05b36d14c9517065353b\",\"2f1a5a7411d015d01aaee4535835400191645023\",\n\"bcb5a4dcbc60d26a5f619518f2cfc1b4bb4e4387\",\"16505d0b929d80ad1680f993c02954cfd3772207\",\n\"d8938528d68aabe1e31df485eb3f75c8a925b5d9\",\"395da6d4f3c890295f7584132ea73d759bd9d094\",\n\"c8b7f28230ea8fbf441c64fdd3feeba88607069e\",\"2841391dfbffa02341333dd34f5298071730366a\",\n\"2546b0e82aecfe987c318c7ad1d00f9fa11cd305\",\"e2152737bed988c0939c900037890d1244d9a30e\")\nor SHA256 in (\"ce77d116a074dab7a22a0fd4f2c1ab475f16eec42e1ded3c0b0aa8211fe858d6\",\n\"dab758bf98d9b36fa057a66cd0284737abf89857b73ca89280267ee7caf62f3b\",\n\"eb6fab5a2964c5817fb239a7a5079cabca0a00464fb3e07155f28b0a57a2c0ed\",\n\"ac1b2b89e60707a20e9eb1ca480bc3410ead40643b386d624c5d21b47c02917c\",\n\"019085a76ba7126fff22770d71bd901c325fc68ac55aa743327984e89f4b0134\",\n\"c09040d35630d75dfef0f804f320f8b3d16a481071076918e9b236a321c1ea77\",\n\"0f5d7e6dfdd62c83eb096ba193b5ae394001bac036745495674156ead6557589\",\n\"e0b9eda35f01c1540134aba9195e7e6393286dde3e001fce36fb661cc346b91d\",\n\"20e35055113dac104d2bb02d4e7e33413fae0e5a426e0eea0dfd2c1dce692fd9\",\n\"2b3445e42d64c85a5475bdbc88a50ba8c013febb53ea97119a11604b7595e53d\",\n\"a3efbc07068606ba1c19a7ef21f4de15d15b41ef680832d7bcba485143668f2d\",\n\"92bd1c3d2a11fc4aba2735d9547bd0261560fb20f36a0e7ca2f2d451f1b62690\",\n\"a58d02465e26bdd3a839fd90e4b317eece431d28cab203bbdde569e11247d9e2\",\n\"cc082d21b9e880ceb6c96db1c48a0375aaf06a5f444cb0144b70e01dc69048e6\")\n\n```\n**Malicious DLLs created in the system or locally**\n\nTo locate the presence or distribution of malicious DLLs created in the system or locally, run\nthe following query\n\n\n-----\n\n```\nDeviceFileEvents \n| where SHA1 in (\"d130bd75645c2433f88ac03e73395fba172ef676\",\n\"1acf3108bf1e376c8848fbb25dc87424f2c2a39c\",\"e257236206e99f5a5c62035c9c59c57206728b28\",\n\"6fdd82b7ca1c1f0ec67c05b36d14c9517065353b\",\"2f1a5a7411d015d01aaee4535835400191645023\",\n\"bcb5a4dcbc60d26a5f619518f2cfc1b4bb4e4387\",\"16505d0b929d80ad1680f993c02954cfd3772207\",\n\"d8938528d68aabe1e31df485eb3f75c8a925b5d9\",\"395da6d4f3c890295f7584132ea73d759bd9d094\",\n\"c8b7f28230ea8fbf441c64fdd3feeba88607069e\",\"2841391dfbffa02341333dd34f5298071730366a\",\n\"2546b0e82aecfe987c318c7ad1d00f9fa11cd305\",\"e2152737bed988c0939c900037890d1244d9a30e\")\nor SHA256 in (\"ce77d116a074dab7a22a0fd4f2c1ab475f16eec42e1ded3c0b0aa8211fe858d6\",\n\"dab758bf98d9b36fa057a66cd0284737abf89857b73ca89280267ee7caf62f3b\",\n\"eb6fab5a2964c5817fb239a7a5079cabca0a00464fb3e07155f28b0a57a2c0ed\",\n\"ac1b2b89e60707a20e9eb1ca480bc3410ead40643b386d624c5d21b47c02917c\",\n\"019085a76ba7126fff22770d71bd901c325fc68ac55aa743327984e89f4b0134\",\n\"c09040d35630d75dfef0f804f320f8b3d16a481071076918e9b236a321c1ea77\",\n\"0f5d7e6dfdd62c83eb096ba193b5ae394001bac036745495674156ead6557589\",\n\"e0b9eda35f01c1540134aba9195e7e6393286dde3e001fce36fb661cc346b91d\",\n\"20e35055113dac104d2bb02d4e7e33413fae0e5a426e0eea0dfd2c1dce692fd9\",\n\"2b3445e42d64c85a5475bdbc88a50ba8c013febb53ea97119a11604b7595e53d\",\n\"a3efbc07068606ba1c19a7ef21f4de15d15b41ef680832d7bcba485143668f2d\",\n\"92bd1c3d2a11fc4aba2735d9547bd0261560fb20f36a0e7ca2f2d451f1b62690\",\n\"a58d02465e26bdd3a839fd90e4b317eece431d28cab203bbdde569e11247d9e2\",\n\"cc082d21b9e880ceb6c96db1c48a0375aaf06a5f444cb0144b70e01dc69048e6\")\n\n```\n**SolarWinds processes launching PowerShell with Base64**\n\nTo locate SolarWinds processes spawning suspected Base64-encoded PowerShell\n[commands, run the following query](https://securitycenter.windows.com/hunting?query=H4sIAAAAAAAEAK1TXUsCQRQ9z0H_YfHF3VKzkqAHoW8KJIIegkpEdxeVdlV2TO3zt3fu3VHcsloohpm5d-ac-zlzghAT9OFzv0KCoUqG45TnIQYYU17HGl7hYIoezxJOBxe86_O2j7auA3Q_WTjjaUT5kohYOXW8cy3gmqiIpwlulBkQXcERHrmLnvIbRDypv3PiDb1UqM04Cysj-t7fiPyp4oziI46srS0OhznP6CUh3-fuoEPJELOHGjWphk9LAaWAulFsmnnJ3hvmkEYzITfibfDFTqTILtm9RR6heg61Fll8y97No0p91xec-bmLIucdDlHGLc_KeEaV6z42mVsTL9ihXsIbMXXVRdul7pEp8W_rmu3hMeWYo62RNWx3vD_FLTXqZKrn_sqUyKq6upaZVvF3pkeO9Lam0oaV8sQvfV7ut8QuvR3p25UKuThg7e4ZWVrBot2lXg-8b_2Y5bL9FnFD_RGJvvo8eXk2D3m7q_7DgBYFGzPicU6bju10nl7G-vN99WhsbbqKlErMX2KT8n9aTd-0WP0AdbkD_LwEAAA&runQuery=true&timeRangeId=month)\n```\nDeviceProcessEvents\n| where InitiatingProcessFileName =~ \"SolarWinds.BusinessLayerHost.exe\"\n| where FileName =~ \"powershell.exe\"// Extract base64 encoded string, ensure valid\nbase64 length| extend base64_extracted = extract('([A-Za-z0-9+/]{20,}[=]{0,3})', 1,\nProcessCommandLine)| extend base64_extracted = substring(base64_extracted, 0,\n(strlen(base64_extracted) / 4) * 4)| extend base64_decoded = replace(@'\\0', '',\nmake_string(base64_decode_toarray(base64_extracted)))//\n| where notempty(base64_extracted) and base64_extracted matches regex '[A-Z]' and\nbase64_extracted matches regex '[0-9]'\n\n```\n**SolarWinds processes launching CMD with echo**\n\n[To locate SolarWinds processes launching CMD with echo, run the following query](https://securitycenter.windows.com/hunting?query=H4sIAAAAAAAEAG2OSwrCQBBEay14h2EOkBtk4w-FIIIL1yEZzEASIfEL4tl9M3EhITT9requXsnpLq-CfFCnS6x6bM3cqdWVeq6Z3jJ6qGLW4UY7MA_qlcfY6jy6sGFaU-9hNHEn1YdodYRVM-10ipsl7EQL3cihH_YzGK-ot4Xfo5LQPXE7-dGUXhr1Cvryb9vACKpm9PGSusEGNPv9YtDIQcMlB7eCZfUF5AwwqToBAAA&runQuery=true&timeRangeId=month)\n```\nDeviceProcessEvents\n| where InitiatingProcessFileName =~ \"SolarWinds.BusinessLayerHost.exe\"\n| where FileName == \"cmd.exe\" and ProcessCommandLine has \"echo\"\n\n```\n**C2 communications**\n\n\n-----\n\n[To locate DNS lookups to a malicious actor s domain, run the following query](https://securitycenter.windows.com/hunting?query=H4sIAAAAAAAEAGWOSwrCQBQEay14hyEH0BO4EKJLwc8FghkwEI2YZCTg4S1noQtpHt00Bf1KIomGs74xRW4M9MyZ8SLw5GL38AJrqUG2kzkxcc_tSgUKStuePWPmJw56L9PlPkoElqpkx9H8I8Mf-1mvzHVerVXzXa5o2ZqjXksHP6yyFyxMyZy4-msrP8oUvAEb21tt5gAAAA&runQuery=true&timeRangeId=month)\n```\nDeviceEvents\n| where ActionType == \"DnsQueryResponse\" //DNS Query Responseand AdditionalFields has\n\".avsvmcloud\"\n\n```\n[To locate DNS lookups to a malicious actor’s domain, run the following query](https://securitycenter.windows.com/hunting?query=H4sIAAAAAAAEALWQPQ6CQBCFX23iHZDGjhvYqYmNMSYegCA_G4E1gEDh4f12KgtLCZmd3TfvZ5e9co1yyuhnatAkr04PHcBztSC9Iq210ps-qQLtqEhX1gb2QL-B1WAZ56BJ8WxNuWU_shvhZnC8XrorMWbD9JfzCa3DxaEdzKnUhZm3e_Z8R9Da7pziEjQb7VhjGJUxA5pQMxX_PaVhmvOOctEUZ85P-2vdokkFk-BSwJ4XzPG8JvikXxkfdzmn1oQCAAA&runQuery=true&timeRangeId=month)\n```\nDeviceNetworkEvents\n| where RemoteUrl contains 'avsvmcloud.com'\n| where InitiatingProcessFileName != \"chrome.exe\"\n| where InitiatingProcessFileName != \"msedge.exe\"\n| where InitiatingProcessFileName != \"iexplore.exe\"\n| where InitiatingProcessFileName != \"firefox.exe\"\n| where InitiatingProcessFileName != \"opera.exe\"\n\n```\n**Find SolarWinds Orion software in your enterprise**\n\nTo search for Threat and Vulnerability Management data to find SolarWinds Orion software\norganized by product name and ordered by how many devices the software is installed\non, [run the following query](https://securitycenter.windows.com/hunting?query=H4sIAAAAAAAEAI2QywrCMBBF71rwH7pTP8JdN27cKN1KH5EKfUATLYof78lAsYiChGQmd2ZOJpPK6aaLSuwRr9VBvc4KGpVrQN2pQ3ecgciguzJd1XB33HIVVDfswHbySrTUQk_sqNpyHP4nNTNiZcREW1aiFdU9rJgxQotxj_oPb49tLeJRoxbwRuurNnZ86cLZzYien7Ss3GIPq6-YRY8e_7tWOpvP9MaGrII5_O7ize-tkyl_zj59ZcecOMVSL39fnZCaAQAA&runQuery=true&timeRangeId=month)\n```\nDeviceTvmSoftwareInventoryVulnerabilities\n| where SoftwareVendor == 'solarwinds'\n| where SoftwareName startswith 'orion'\n| summarize dcount(DeviceName) by SoftwareName\n| sort by dcount_DeviceName desc\n\n```\n**ADFS adapter process spawning**\n```\nDeviceProcessEvents\n| where InitiatingProcessFileName =~\"Microsoft.IdentityServer.ServiceHost.exe\"\n| where FileName in~(\"werfault.exe\", \"csc.exe\")\n| where ProcessCommandLine !contains (\"nameId\")\n\n## Appendix\n\n### MITRE ATT&CK techniques observed\n\n```\n[This threat makes use of attacker techniques documented in the MITRE ATT&CK framework.](https://attack.mitre.org/)\n\nInitial Access\n\n[T1195.001 Supply Chain Compromise](https://attack.mitre.org/techniques/T1195/001/)\n\nExecution\n\n[T1072 Software Deployment Tools](https://attack.mitre.org/techniques/T1072/)\n\nCommand and Control\n\n\n-----\n\n[T1071.004 Application Layer Protocol: DNS](https://attack.mitre.org/techniques/T1071/004/)\n\n[T1071.001 Application Layer Protocol: Web Protocols](https://attack.mitre.org/techniques/T1071/001/)\n\n[T1568.002 Dynamic Resolution: Domain Generation Algorithms](https://attack.mitre.org/techniques/T1568/002/)\n\n[T1132 Data Encoding](https://attack.mitre.org/techniques/T1132/)\n\nPersistence\n\n[T1078 Valid Accounts](https://attack.mitre.org/techniques/T1071/001/)\n\nDefense Evasion\n\n[T1480.001 Execution Guardrails: Environmental Keying](https://attack.mitre.org/techniques/T1480/001/)\n\n[T1562.001 Impair Defenses: Disable or Modify Tools](https://attack.mitre.org/techniques/T1562/001/)\n\nCollection\n\n[T1005 Data From Local System](https://attack.mitre.org/techniques/T1005/)\n\n### Additional malware discovered\n\nIn an interesting turn of events, the investigation of the whole SolarWinds compromise led to\nthe discovery of an additional malware that also affects the SolarWinds Orion product but\nhas been determined to be likely unrelated to this compromise and used by a different threat\nactor. The malware consists of a small persistence backdoor in the form of a DLL file named\n_App_Web_logoimagehandler.ashx.b6031896.dll, which is programmed to allow remote code_\nexecution through SolarWinds web application server when installed in the folder\n“inetpub\\SolarWinds\\bin\\”. Unlike Solorigate, this malicious DLL does not have a digital\nsignature, which suggests that this may be unrelated to the supply chain compromise.\nNonetheless, the infected DLL contains just one method (named DynamicRun), that can\nreceive a C# script from a web request, compile it on the fly, and execute it.\n\n\n-----\n\n_Figure 13: Original DLL_\n\n_Figure 14: The malicious addition that calls the DynamicRun method_\n\nThis code provides an attacker the ability to send and execute any arbitrary C# program on\nthe victim’s device. Microsoft Defender Antivirus detects this compromised DLL as\nTrojan:MSIL/Solorigate.G!dha.\n\n\n-----\n\n### Talk to us\n\nQuestions, concerns, or insights on this story? Join discussions at the Microsoft 365\nDefender tech community.\n\n[Read all Microsoft security intelligence blog posts.](https://www.microsoft.com/security/blog/microsoft-security-intelligence/)\n\nFollow us on Twitter **[@MsftSecIntel.](https://twitter.com/MsftSecIntel)**\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-12-18 - Analyzing Solorigate, the compromised DLL file that started a sophisticated cyberattack, and how Microsoft Defender helps protect customers.pdf"
    ],
    "report_names": [
        "2020-12-18 - Analyzing Solorigate, the compromised DLL file that started a sophisticated cyberattack, and how Microsoft Defender helps protect customers.pdf"
    ],
    "threat_actors": [
        {
            "id": "b43e5ea9-d8c8-4efa-b5bf-f1efb37174ba",
            "created_at": "2022-10-25T16:07:24.36191Z",
            "updated_at": "2025-03-27T02:02:10.1909Z",
            "deleted_at": null,
            "main_name": "UNC2452",
            "aliases": [
                "Dark Halo",
                "Nobelium",
                "SolarStorm",
                "StellarParticle",
                "UNC2452"
            ],
            "source_name": "ETDA:UNC2452",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "70872c3a-e788-4b55-a7d6-b2df52001ad0",
            "created_at": "2023-01-06T13:46:39.18401Z",
            "updated_at": "2025-03-27T02:00:03.01553Z",
            "deleted_at": null,
            "main_name": "UNC2452",
            "aliases": [
                "DarkHalo",
                "StellarParticle",
                "NOBELIUM",
                "Solar Phoenix",
                "Midnight Blizzard"
            ],
            "source_name": "MISPGALAXY:UNC2452",
            "tools": [
                "SNOWYAMBER",
                "HALFRIG",
                "QUARTERRIG"
            ],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "1d3f9dec-b033-48a5-8b1e-f67a29429e89",
            "created_at": "2022-10-25T15:50:23.739197Z",
            "updated_at": "2025-03-27T02:00:55.536417Z",
            "deleted_at": null,
            "main_name": "UNC2452",
            "aliases": [
                "UNC2452",
                "NOBELIUM",
                "StellarParticle",
                "Dark Halo"
            ],
            "source_name": "MITRE:UNC2452",
            "tools": [
                "Sibot",
                "Mimikatz",
                "Cobalt Strike",
                "AdFind",
                "GoldMax"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "a241a1ca-2bc9-450b-a07b-aae747ee2710",
            "created_at": "2024-06-19T02:03:08.150052Z",
            "updated_at": "2025-03-27T02:05:17.409596Z",
            "deleted_at": null,
            "main_name": "IRON RITUAL",
            "aliases": [
                "Blue Dev 5 ",
                "BlueBravo ",
                "Cloaked Ursa ",
                "CozyLarch ",
                "Dark Halo ",
                "Midnight Blizzard ",
                "NOBELIUM ",
                "StellarParticle ",
                "UNC2452 ",
                "APT29"
            ],
            "source_name": "Secureworks:IRON RITUAL",
            "tools": [
                " Cobalt Strike",
                " EnvyScout",
                " GoldFinder",
                " GoldMax",
                " NativeZone",
                " RAINDROP",
                " SUNBURST",
                " Sibot",
                " TEARDROP",
                " VaporRage",
                "Brute Ratel C4"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "20d3a08a-3b97-4b2f-90b8-92a89089a57a",
            "created_at": "2022-10-25T15:50:23.548494Z",
            "updated_at": "2025-03-27T02:00:55.49688Z",
            "deleted_at": null,
            "main_name": "APT29",
            "aliases": [
                "APT29",
                "IRON RITUAL",
                "IRON HEMLOCK",
                "NobleBaron",
                "Dark Halo",
                "NOBELIUM",
                "UNC2452",
                "YTTRIUM",
                "The Dukes",
                "Cozy Bear",
                "CozyDuke",
                "SolarStorm",
                "Blue Kitsune",
                "UNC3524",
                "Midnight Blizzard"
            ],
            "source_name": "MITRE:APT29",
            "tools": [
                "PinchDuke",
                "ROADTools",
                "WellMail",
                "CozyCar",
                "Mimikatz",
                "Tasklist",
                "OnionDuke",
                "FatDuke",
                "POSHSPY",
                "EnvyScout",
                "SoreFang",
                "GeminiDuke",
                "GoldMax",
                "FoggyWeb",
                "SDelete",
                "PolyglotDuke",
                "AADInternals",
                "MiniDuke",
                "SeaDuke",
                "Sibot",
                "RegDuke",
                "CloudDuke",
                "GoldFinder",
                "AdFind",
                "PsExec",
                "NativeZone",
                "Systeminfo",
                "ipconfig",
                "Impacket",
                "Cobalt Strike",
                "PowerDuke",
                "QUIETEXIT",
                "HAMMERTOSS",
                "BoomBox",
                "CosmicDuke",
                "WellMess",
                "VaporRage",
                "LiteDuke"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "46b3c0fc-fa0c-4d63-a38a-b33a524561fb",
            "created_at": "2023-01-06T13:46:38.393409Z",
            "updated_at": "2025-03-27T02:00:02.822155Z",
            "deleted_at": null,
            "main_name": "APT29",
            "aliases": [
                "The Dukes",
                "Minidionis",
                "Grizzly Steppe",
                "G0016",
                "Blue Kitsune",
                "BlueBravo",
                "SeaDuke",
                "Cloaked Ursa",
                "YTTRIUM",
                "ATK7",
                "Nobelium",
                "UAC-0029",
                "Group 100",
                "COZY BEAR",
                "IRON HEMLOCK",
                "TA421",
                "ITG11"
            ],
            "source_name": "MISPGALAXY:APT29",
            "tools": [
                "QUARTERRIG",
                "SNOWYAMBER",
                "HALFRIG"
            ],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f27790ff-4ee0-40a5-9c84-2b523a9d3270",
            "created_at": "2022-10-25T16:07:23.341684Z",
            "updated_at": "2025-03-27T02:02:09.74554Z",
            "deleted_at": null,
            "main_name": "APT 29",
            "aliases": [
                "APT 29",
                "ATK 7",
                "Blue Dev 5",
                "BlueBravo",
                "Cloaked Ursa",
                "CloudLook",
                "Cozy Bear",
                "Dark Halo",
                "Earth Koshchei",
                "Grizzly Steppe",
                "Group 100",
                "ITG11",
                "Iron Hemlock",
                "Iron Ritual",
                "Midnight Blizzard",
                "Minidionis",
                "Nobelium",
                "NobleBaron",
                "Operation Ghost",
                "Operation Office monkeys",
                "Operation StellarParticle",
                "SilverFish",
                "Solar Phoenix",
                "SolarStorm",
                "StellarParticle",
                "TEMP.Monkeys",
                "The Dukes",
                "UNC2452",
                "UNC3524",
                "Yttrium"
            ],
            "source_name": "ETDA:APT 29",
            "tools": [
                "7-Zip",
                "ATI-Agent",
                "AdFind",
                "Agentemis",
                "AtNow",
                "BEATDROP",
                "BotgenStudios",
                "CEELOADER",
                "Cloud Duke",
                "CloudDuke",
                "CloudLook",
                "Cobalt Strike",
                "CobaltStrike",
                "CosmicDuke",
                "Cozer",
                "CozyBear",
                "CozyCar",
                "CozyDuke",
                "Danfuan",
                "EnvyScout",
                "EuroAPT",
                "FatDuke",
                "FoggyWeb",
                "GeminiDuke",
                "Geppei",
                "GoldFinder",
                "GoldMax",
                "GraphDrop",
                "GraphicalNeutrino",
                "GraphicalProton",
                "HAMMERTOSS",
                "HammerDuke",
                "LOLBAS",
                "LOLBins",
                "LiteDuke",
                "Living off the Land",
                "MagicWeb",
                "Mimikatz",
                "MiniDionis",
                "MiniDuke",
                "NemesisGemina",
                "NetDuke",
                "OnionDuke",
                "POSHSPY",
                "PinchDuke",
                "PolyglotDuke",
                "PowerDuke",
                "QUIETEXIT",
                "ROOTSAW",
                "RegDuke",
                "Rubeus",
                "SNOWYAMBER",
                "SPICYBEAT",
                "SUNSHUTTLE",
                "SeaDaddy",
                "SeaDask",
                "SeaDesk",
                "SeaDuke",
                "Sharp-SMBExec",
                "SharpView",
                "Sibot",
                "Solorigate",
                "SoreFang",
                "TinyBaron",
                "WINELOADER",
                "WellMail",
                "WellMess",
                "cobeacon",
                "elf.wellmess",
                "reGeorg",
                "tDiscoverer"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535977,
    "ts_updated_at": 1743041794,
    "ts_creation_date": 1653775806,
    "ts_modification_date": 1653775806,
    "files": {
        "pdf": "https://archive.orkl.eu/673e3b5dde471200ec3de3573976c4d535dd405b.pdf",
        "text": "https://archive.orkl.eu/673e3b5dde471200ec3de3573976c4d535dd405b.txt",
        "img": "https://archive.orkl.eu/673e3b5dde471200ec3de3573976c4d535dd405b.jpg"
    }
}