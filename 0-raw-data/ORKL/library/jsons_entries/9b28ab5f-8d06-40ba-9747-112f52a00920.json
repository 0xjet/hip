{
    "id": "9b28ab5f-8d06-40ba-9747-112f52a00920",
    "created_at": "2023-01-12T15:06:32.17526Z",
    "updated_at": "2025-03-27T02:16:53.065551Z",
    "deleted_at": null,
    "sha1_hash": "520663ea69f1e13664686077570fdc37742e6bcc",
    "title": "2021-05-14 - Analysis Report (AR21-134A)- Eviction Guidance for Networks Affected by the SolarWinds and Active Directory-M365 Compromise",
    "authors": "",
    "file_creation_date": "2022-05-29T01:06:54Z",
    "file_modification_date": "2022-05-29T01:06:54Z",
    "file_size": 119178,
    "plain_text": "# Eviction Guidance for Networks Affected by the SolarWinds and Active Directory/M365 Compromise\n\n**us-cert.cisa.gov/ncas/analysis-reports/ar21-134a**\n\n## Summary\n\nSince December 2020, the Cybersecurity and Infrastructure Security Agency (CISA) has\nbeen responding to a significant cyber incident. An advanced persistent threat (APT) actor\nadded malicious code to multiple versions of SolarWinds Orion and, in some instances,\nleveraged it for initial access to enterprise networks of multiple U.S. government agencies,\ncritical infrastructure entities, and private sector organizations. Once inside the network, the\nthreat actor bypassed multi-factor authentication (MFA) and moved laterally to Microsoft\nCloud systems by compromising federated identity solutions. Note: on April 15, 2021, the\nU.S. Government attributed this activity to the Russian Foreign Intelligence Service (SVR).\nSee the [statement from the White House for additional details.](https://www.whitehouse.gov/briefing-room/statements-releases/2021/04/15/fact-sheet-imposing-costs-for-harmful-foreign-activities-by-the-russian-government/)\n\nFor more information and resources on this activity, refer to us-cert.cisa.gov/remediating-apt\ncompromised-networks.\n\nFor more information on CISA’s response to this activity, refer to cisa.gov/supply-chaincompromise.\n\nCISA has provided this guidance to federal agencies with networks that used affected\nversions of SolarWinds Orion and have evidence of follow-on threat actor activity—CISA\nAlert AA20-352A: Advanced Persistent Threat Compromise of Government Agencies,\nCritical Infrastructure, and Private Sector Organizations labels these as Category 3 agencies.\nThis guidance is intended to support Category 3 agencies in crafting their eviction plans in\n[accordance with ED 21-01: Supplemental Direction Version 4. Note: agencies should refer to](https://cyber.dhs.gov/ed/21-01/#supplemental-direction-v4)\nCISA Alert [AA20-352A for guidance on determining if they are Category 3. CISA is aware of](https://us-cert.cisa.gov/ncas/alerts/aa20-352a)\nother initial access vectors; agencies should not assume they are not compromised by this\nAPT actor solely because they have never used affected versions of SolarWinds Orion.\n\nThose agencies should investigate to confirm they have not observed related threat actor\ntactics, techniques, and procedures (TTPs). CISA recommends any agency that detects\n[related activity review this guidance as well as CISA Alert AA20-352A, and contact CISA for](https://us-cert.cisa.gov/ncas/alerts/aa20-352a)\nfurther assistance.\n\nAlthough this guidance is tailored to federal agencies, CISA encourages critical infrastructure\nentities; state, local, territorial, and tribal government organizations; and private sector\norganizations to review and apply it, as appropriate.\n\n\n-----\n\nThe steps provided in this guidance are resource-intensive and highly complex and will\nrequire the enterprise network to be disconnected from the internet for 3–5 days. In order to\nhave fully informed senior-level support, CISA recommends that agency senior leadership\nconduct planning sessions throughout this process to understand the resources needed and\nany potential disruption in business operations. CISA encourages agency leadership to\nreview [CISA Insights: SolarWinds and AD/M365 Compromise Risk Decisions for Leaders for](https://www.cisa.gov/publication/solarwinds-and-ad-m365-compromise-risk-decisions-leaders)\nmore information.\n\nBy taking steps to evict this adversary from compromised on-premises and cloud\nenvironments, agencies will position themselves for long-term actions to build more secure,\nresilient networks.\n\nFor a PDF copy of this report, [click here.](https://us-cert.cisa.gov/sites/default/files/publications/AR21-134A_Remediating_Networks_Affected_by_the_SolarWinds_and_Active_Directory_M365_Compromise.pdf)\n\n## Description\n\nImportant: Category 3 organizations should use out-of-band communications for all\nmitigation and remediation communications and documentation, i.e., do not use any\ncompromised systems to internally or externally communicate remediation plans or actions.\n\nRemediation plans for dealing with malicious compromises are necessarily unique to every\norganization, and success requires careful consideration. There are three phases for evicting\nthe actor:\n\n**Phase 1: Pre-Eviction. Actions to detect and identify APT activity and prepare the**\nnetwork for eviction. Note: for the purposes of this guidance, a network is defined as\nany computer network with hosts that share either a logical trust or any account\ncredentials with affected versions of SolarWinds Orion.\n**Phase 2: Eviction. Actions to remove the APT actor from on-premises and cloud**\nenvironments. This phase includes rebuilding devices and systems.\n**Phase 3: Post-Eviction. Actions to ensure eviction was successful and the network**\nhas good cyber posture.\n\nConducting each step in this guidance is necessary to fully evict the adversary from\nCategory 3 networks. Failure to perform comprehensive and thorough remediation activity\nwill expose enterprise networks and cloud environments to substantial risk for long-term\nundetected APT activity, and compromised organizations will risk further loss of sensitive\ndata and erosion of public trust in their networks.\n\nAlthough this guidance provides a level of detail that describes actions to be completed, it\ndoes not describe how these actions should be completed. To successfully evict the threat\nactor, these actions need to be conducted in the order specified. Additionally, this guidance\nclearly notes caveats and provides references to help agencies develop their plan.\n\n## Pre-Eviction Phase\n\n\n-----\n\n1. Define the true scope by identifying trust boundaries (including between Active\n\nDirectory [AD] forests and domains) and determining the enterprise assets to which this\nguidance applies (i.e., determine what assets are within the trust boundary).\n\n1. For example, the organization needs to determine the identity provider (IdP)\n\nsources (such as Okta, Microsoft Active Directory Federation Services [ADFS],\nDuo) that it uses to issue single-sign on (SSO) credentials and it needs to identify\nassets that rely on the SSO credentials to allow access (i.e., what controlled data\nsources are accessible via that credential).\n2. Investigate suspicious account activity associated with your SolarWinds servers,\n\nespecially service accounts used by SolarWinds Orion. Additionally, enumerate and\ninvestigate any credentials stored or used on the SolarWinds server, including network\nadministration and device credentials. This can be conducted, for example, using a\ntransitive mapping of all potentially compromised credentials to the systems that those\ncredentials accessed. If—as a Category 3 agency—you cannot confirm that all your\ncredential activity is benign, you should proceed as if the highest administrative level of\ncredentials on your affected SolarWinds server has been compromised. In many cases,\nthe adversary may have had this access for months. Refer to the following resources\nfor more information.\n\n1. FireEye: Highly Evasive Attacker Leverages SolarWinds Supply Chain to\n\nCompromise Multiple Global Victims With SUNBURST Backdoor\n2. CISA Alert AA20-352A: Advanced Persistent Threat Compromise of Government\n\nAgencies, Critical Infrastructure, and Private Sector Organization\n3. Investigate potential Security Assertion Markup Language (SAML) abuse in your\n\nenvironment. Refer to the following resources.\n\n1. CISA Alert AA21-008A: Detecting Post-Compromise Threat Activity in Microsoft\n\nCloud Environments\n[2. National Security Agency: Detecting Abuse of Authentication Mechanisms](https://media.defense.gov/2020/Dec/17/2002554125/-1/-1/0/AUTHENTICATION_MECHANISMS_CSA_U_OO_198854_20.PDF)\n3. FireEye: Remediation and Hardening Strategies for Microsoft 365 to Defend\n\nAgainst UNC2452\n4. Microsoft: Understanding \"Solorigate\"'s Identity IOCs - for Identity Vendors and\n\ntheir customers\n\n\n-----\n\n4. Scope the intrusion.\n\n1. Look for the artifacts from known TTPs associated with this activity. Refer to\n\nSolarWinds and Active Directory/M365 Compromise: Detecting Advanced\nPersistent Threat Activity from Known Tactics, Techniques, and Procedures for\nTTPs and corresponding detection artifacts. Prioritize these by biggest value for\nthe investment (e.g., prioritize these by techniques or technologies that cover\nmultiple tactics or that provide visibility into shared data sources). After identifying\nthe TTPs for which your organization has security controls to detect/stop/mitigate,\nyou can make risk-based decisions on how to address visibility and protection\nstrategies for the remaining MITRE Adversarial Tactics, Techniques, and\nCommon Knowledge (ATT&CK)-based paths.\n2. Audit all network device configurations stored or managed on the SolarWinds\n\nmonitoring server for signs of unauthorized or malicious configuration changes.\nOrganizations should audit the current network device running configuration and\nany local configurations that could be loaded at boot time.\n3. Assess the current endpoint telemetry collection level and configure endpoint\n\nforensics and detection solutions for aggressive collection; prioritize this by value\nof asset and account.\n\n\n-----\n\n5. Harden the enterprise attack surface.\n\n1. Review and validate perimeter firewall rulesets. Remove all allow rules for which\n\nthe organization does not have a clearly defined, understood, and documented\nneed. “Deny all” statements that identify necessary connections and allow them\nas exceptions are the standard for perimeter devices.\n\n1. Reduce the number of systems that are able to access the internet directly.\n\n**Note: this action may require analysis by network engineers with**\nfundamental knowledge of (1) how network data communicates through\nagency trust boundaries and (2) the IP routing in the enterprise.\n\nFor example, domain controllers should never be used for—or\ncapable of— browsing the internet. (Microsoft’s [analysis of domain](https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/plan/security-best-practices/securing-domain-controllers-against-attack)\ncontrollers identified that privileged users often use Internet Explorer\nto browse the intranet or internet.\nFor more information on designing networks where critical or securityrelated appliances and servers do not have access to the internet,\nrefer to the United Kingdom’s National Cyber Security Centre (NCSC):\n[Security Architecture Anti-Patterns.](https://www.ncsc.gov.uk/whitepaper/security-architecture-anti-patterns)\n2. Reduce the number of egress ports at the enterprise perimeter. This\n\nrequires a review of all perimeter firewall rulesets (rulesets may differ\namong firewalls).\n2. Implement host-based firewalls to make the work of moving laterally more\n\nchallenging for the adversary, disrupting the ability to move from compromised\nworkstations to domain resources. Consider blocking or closely monitoring\nworkstation-to-workstation communications as much as possible, using Privileged\nAccess Workstations (PAWs) and servers for administrative functions. Firewalls\nand endpoint detection and response functions may have similar capability, but\nboth need to feature (1) filtering of allowed connections and (2) visibility/detection\nfor connections.\n3. Close and/or monitor high-risk ports (e.g., Remote Desktop Protocol [RDP],\n\nServer Message Block [SMB], File Transfer Protocol [FTP], Trivial File Transfer\nProtocol [TFTP], Secure Shell [SSH], and WebDAV).\n4. Carefully employ application execution control (allowlisting), especially for\n\nsystems providing remote access to the enterprise.\n5. Enforce enterprise Domain Name System (DNS) resolution for all systems. Do\n\nnot allow internal systems to directly access internet DNS servers.\n\n\n-----\n\n6. Ensure that all endpoints that will need to be updated are powered on for as long\n\nas possible during the eviction phase. Note: this action is necessary for all vital\nchanges to AD to be pushed to all systems in the environment prior to\nreconnection and also to verify that all systems are rebooted. This action is\nespecially tricky given that many user endpoints are not connected 24/7 due to\nremote work. Organizations may want to look at “jailing” systems that connect in\nthis way into minimal virtual local area networks (VLANs) until they can be\nverified to have received and implemented updates and any other mitigations\n(endpoint detection and response [EDR] agents, patches, antivirus definitions,\nspecific scans, etc.) decided on by the organization.\n7. Agencies using Microsoft Defender for Endpoint or Microsoft 365 Defender\n\nshould refer to Microsoft: Use attack surface reduction rules to prevent malware\ninfection for more information on hardening the enterprise attack surface.\n6. Identify federation model for on-premises resources to cloud trust relationship\n\n**and identify adversary activity in Microsoft 365 (M365)/Azure environment.**\n\n1. Identify the Source Anchor for Azure AD Connect in the current Azure Tenant, if\n\nused. (This is required in order to sever the connection and restore later).\n2. Run Sparrow or similar tools to identify permission and credential changes to\n\napplications and service principals. Identify overly permissive applications,\nunusual credentials in applications, or modifications to federation trust settings.\nRefer to CISA Alert AA21-008A: Detecting Post-Compromise Threat Activity in\nMicrosoft Cloud Environments for more information.\n3. Review M365 tenant configuration and perform a cloud security assessment for\n\nadministrative accounts and applications. Specifically, review all accounts with\nprivileged access and each application to determine if the rights and credentials\nare as intended and still necessary. This assessment should include shared trusts\nor identity relationships with third-party cloud service providers (CSPs) in which\nthe identity is a resident on the CSP’s tenant but is also capable of performing\nactions in the organization’s M365 environment.\n\n## Eviction Phase\n\n**Note: to effectively the APT actor, the following steps should be completed fully and in the**\norder listed. These steps may affect operations of critical business functions. CISA\nrecommends agencies conduct a thorough risk assessment prior to starting eviction so that\npotential impacts on critical business functions are documented and understood. Given that\nthese steps are complex, CISA also encourages agencies to use third-party help to support\neviction efforts if needed.\n\n1. Sever the enterprise network from the internet.\n\n**Note: this step requires the agency to understand its internal and external connections.**\nWhen making the decision to sever internet access, knowledge of connections must be\ncombined with care to avoid disrupting critical functions.\n\n\n-----\n\n2. Reset the Kerberos Ticket Granting Ticket account (krbtgt).\n\n**Note: krbtgt must be reset twice; the second time after the first has finished. The resets**\nmay take a long time to propagate fully on large AD environments. For more\ninformation, refer to Microsoft guidance: AD Forest Recovery - Resetting the krbtgt\npassword.\n\n3. Eradicate known malware/backdoors/implants discovered during pre-eviction\n\n**steps.**\n\n**Note: this can be done while waiting for the krbtgt resets to complete.**\n\n4. Apply network device mitigations identified in CISA Alert AA20-352A: Advanced\n\n[Persistent Threat Compromise of Government Agencies, Critical Infrastructure, and](https://us-cert.cisa.gov/ncas/alerts/aa20-352a)\nPrivate Sector Organization.\n\nFor network devices managed by the SolarWinds monitoring server, the running\nfirmware/software should be checked against known good hash values from the\nnetwork vendor. CISA recommends that, if possible, organizations re-upload known\ngood firmware/software to managed network devices and perform a reboot.\n\n**Note: be sure to wait until krbtgt reset completes to avoid interrupting the reset.**\n\n5. Unenroll any suspicious MFA Tokens. Audit all MFA tokens configured in your\n\nenvironment, especially those used for remote access. Unenroll any tokens that cannot\nbe accounted for or are suspicious.\n\n6. Rebuild and reimage systems.\n\n**Note: agencies should do an impact assessment for endpoints to determine if they**\nneed to be reimaged. An agency should identify (1) credentials observed on\ncompromised machines as at risk and (2) any subsequent system accessed from the\ncorresponding accounts as compromised. Consider:\n\n1. Was the endpoint altered by a known malicious actor action? If yes, reimage the\n\nsystem.\n2. Was data on the endpoint accessed but the endpoint shows no sign of being\n\naltered? If yes, you may not need to reimage the system.\n\n\n-----\n\n7. Regain control of the AD and ADFS, by instituting Local Administrator Password\n\nSolution (LAPS), PAWs, and modified administrative accounts.\n\n1. Re-establish control of the ecosystem items that were most easily manipulated by\n\nthe attacker. Start with the “lowest hanging fruit,” i.e., items that are low risk to\noperations, low administrative overhead, that do not require new skill sets to\ncontrol. These actions block the most frequently used attack methods on a\nnetwork. Refer to the Microsoft and Center for Internet Security joint presentation\n[Critical Hygiene for Preventing Major Breaches for more information on](https://published-prd.lanyonevents.com/published/rsaus17/sessionsFiles/3774/CXO-F02-Critical-Hygiene-for-Preventing-Major-Breaches.pdf)\nprioritizing controls with the largest return on investment.\n\n1. Audit the privilege levels of accounts that were utilized on affected\n\nSolarWinds Orion servers. Consider only granting the minimal rights and\naccounts needed to function, following Just Enough Administration (JEA)\n[principles. (Refer to Microsoft: Just Enough Administration for more](https://docs.microsoft.com/en-us/powershell/scripting/learn/remoting/jea/overview?view=powershell-7.1)\ninformation.)\n2. Ensure there are unique and distinct administrative accounts for each set of\n\nadministrative tasks. Enforce the principle of least privilege. Remove all\naccounts that are unnecessary; remove privileges not expressly required by\nan account’s function or role. Institute a group policy that disables remote\ninteractive logins, and use Domain Protected Users Group.\n3. Enforce MFA for all administrative accounts and functions.\n4. Create and establish PAWs for administrative accounts and mandate use\n\nfor administrative functions (AD Administrators first, at minimum).\n5. Enable unique local administrative accounts (e.g., LAPS) and a\n\nmanagement function for those accounts. Note: for LAPS, if the endpoints\nare cloned, each individual endpoint’s local administrative account\npassword needs to be changed afterward to enforce uniqueness.\n\n\n-----\n\n8. Rotate all the Secrets.\n\n1. Rotate secrets associated with remote access MFA token generation.\n2. Reset passwords for:\n\n1. All AD accounts with elevated privileges (such as administrators)\n2. All AD service accounts\n3. Directory Services Restore Mode (DSRM) account on domain controllers\n4. All AD accounts\n5. Accounts with suspicious activity or whose credentials existed on\n\ncompromised systems, such as affected SolarWinds servers\n6. Any account where Smartcard/Personal Identity Verification (PIV) is not\n\nenforced (which are on an exception or similar exemption)\n**Note: the New Technology LAN Manager (NTLM) hashes of smartcard/PIV-**\nenabled accounts can be used in pass-the-hash attacks and should be\nrefreshed regularly. For more information, including guidance and scripts on\nrolling over these hashes, refer to the National Security Agency (NSA)\nInformation Assurance Advisory: Long-Lived Hashes for AD Smartcard\nRequired Accounts, NSA Cyber’s GitHub page on Pass the-Hash\nGuidance, and Microsoft: [Passwordless Strategy.](https://docs.microsoft.com/en-us/windows/security/identity-protection/hello-for-business/passwordless-strategy#configure-user-accounts-to-disallow-password-authentication)\n\n7. All AD user accounts\n8. All Windows local administrative accounts (including those that are\n\nrenamed, especially those not managed by LAPS in environment)\n9. Non-AD application privileged accounts (e.g., elevated accounts on\n\nsystems that are not joined to AD; some high value assets (HVAs) may fall\ninto this category)\n10. Network device administrative accounts\n\n11. Non-AD HVA user accounts\n3. Change all credentials being used to manage network devices, including keys\n\nand strings used to secure network device functions (Simple Network\nManagement Protocol [SNMP] strings/user credentials, IPsec/IKE preshared\nkeys, routing secrets, TACACS/RADIUS secrets, RSA keys/certificates, etc.).\nMonitor for failed logins resulting from these resets.\n\n\n-----\n\n9. Sever Azure environment from on-premises, and conduct M365/Azure\n\n**remediation.**\n\n1. Evaluate IdP sources. Harden SSO features. (See FireEye’s white paper,\n\nRemediation and Hardening Strategies for Microsoft 365 to Defend Against\nUNC2452). Turn on advanced logging and establish a privileged access\nmanagement (PAM) baseline (expected privileged account state) for cloud\nenvironments.\n2. Harden the Azure AD Connect Service. (See Trimarc Security’s post, Securing\n\nMicrosoft Azure AD Connect).\n3. Review and adjust federation trust relationships.Note: Microsoft recommends\n\nsevering federation trusts between on-premises networks and the cloud;\norganizations should migrate to an external IdP or use Azure AD to manage\nusers and, if the latter, users should be “mastered” from Azure AD. Revoke\nunauthorized or unnecessary federation trusts if maintaining a federated identity\nsolution. (CISA recommends avoiding federated enterprise environments\nwhenever possible.) For more information review the following resources.\n\nMicrosoft: [Protecting Microsoft 365 from on-premises attacks](https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/protect-m365-from-on-premises-attacks)\nCrowdStrike: CrowdStrike Launches Free Tool to Identify and Help Mitigate\nRisks in Azure Active Directory\n4. Fully isolate your M365 admin accounts. Activities in this step include, but are not\n\nlimited to (1) creating cloud-only administrators, controlled appropriately with role\nbased access control (RBAC) and MFA, and (2) monitoring, in an automated\nfashion, any changes to the established baseline or unusual use. See the\nfollowing resources for more information (Note: CISA will be releasing guidance\non cloud remediation and hardening following dissemination of this guidance).\n\nMicrosoft: Advice for incident responders on recovery from systemic identity\ncompromises\nMicrosoft: [Protecting Microsoft 365 from on-premises attacks](https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/protect-m365-from-on-premises-attacks)\n5. After remediating privileged identities (step d), revoke all existing M365 tokens.\n6. Double check to ensure no on-premises accounts have administrative privileges\n\nin M365.\n7. Review and sanitize (i.e., remove unwelcome actions) compromised mailboxes\n\nusing industry standard tooling and service portal manual review.\n8. Review, and adjust accordingly, Tenant settings and configurations. Use publicly\n\navailable or open-source tools such as CrowdStrike Reporting Tool for Azure\n(CRT) and Hawk to review Tenant settings. Refer to CISA Alert AA21-008A:\nDetecting Post-Compromise Threat Activity in Microsoft Cloud Environments.\n9. Use tools—such as Sparrow or Azure AD Investigator—to review existing Azure\n\napplications. Remediate applications that have been compromised. Refer to CISA\nAlert AA21-008A: Detecting Post-Compromise Threat Activity in Microsoft Cloud\nEnvironments.\n10. Perform IdP review and eviction.\n\n\n-----\n\n10. Clear DNS cache on all servers, workstations, and non-Windows systems.\n\n1. Reduce the “Domain member: Maximum machine account password age” in\n\nGroup Policy to 2–3 days during eviction; it can be set back to the default 30 days\nafter eviction is complete. This will hasten the resetting of the Computer object\npasswords. For more information, refer to Microsoft: Machine Account Password\nProcess.\n2. Reboot all servers and workstations, especially those joined to the AD.\n11. Verify eviction steps have been properly completed.\n\n1. Have all the tasks above been completed on all applicable systems and\n\naccounts? Note: CISA highly recommends implementing a process to verify you\nhave completed each task.\n2. Have the endpoints that were not completely mitigated been removed from\n\nnetwork communication, pending their completion?\n3. Have you applied all critical and high patches to the endpoints that lack them,\n\nespecially any that needed re-imaging?\n4. Have you added enhanced visibility and monitoring capabilities for cloud\n\nenvironments—such as telemetry for cloud environments—into existing agency\nsecurity information and event management (SIEM) technology?\n5. Have you implemented monitoring capability for highly privileged cloud identities\n\nand Service Principals?\n\n## Post Eviction\n\n1. Report to your senior leadership completed pre-eviction and eviction actions as\n\nwell as those remaining to be completed; provide leadership an assessment of the risk\nremaining, including assumed residual risk.\n2. Reconnect to the internet. Note: the decision to reconnect to the internet depends on\n\nsenior leadership’s confidence in the actions taken. It is possible—depending on the\nenvironment—that new information discovered during pre-eviction and eviction steps\ncould add additional eviction tasks.\n3. Create an actionable and accountable plan for integrating the next 60 days of\n\n**Active Directory privilege credential baselining guidance (i.e., completing the next**\nstep). Note: this next step has high overhead and will likely disrupt business\noperations; agencies must have a plan for testing breaks associated with the changes\nto administrative control schemes and will need to alter their policies and procedures to\naccommodate these disruptions.\n\n\n-----\n\n4. Establish and control baseline mechanisms for administrators. Note: this step\n\nshould be completed over the next 60 days. While completing this task, agencies\nshould move on to the next step.\n\n1. Implement PAWs for remaining administrative accounts.\n2. Perform additional hardening of administrative accounts.\n\n1. Implement Credential Guard. (Refer to Microsoft: Manage Windows\n\nDefender Credential Guard for more information). Introducing Credential\nGuard as an endpoint tool can be challenging for organizations due to\nhardware restrictions, but the impact on privileged identity credential\nmanagement is significant. Chief information security officers (CISOs)\nshould prioritize identity-focused solutions for immediate action.\n2. Restrict RDP usage to an exclusive list of necessary administrators and\n\nfrom only dedicated administrative workstations (such as PAWs) and\nidentified necessary alternative locations. RDP access should be judiciously\nand carefully scoped and monitored.\n3. Establish time bound and temporal escalated Domain Privileges (require\n\nsecond factor for elevation and that access expires).\n3. Implement JEA for domain controller access and maintenance.\n4. Harden/reduce attack surface of domain controllers. Remove connection to the\n\ninternet whenever possible, and remove all unnecessary protocols, services, and\naccounts (in accordance with the principle of least functionality). Consider\nimplementing Windows Server Core for all domain controllers.\n5. Integrate detection mechanisms that focus on endpoints and changes to privileged\n\nidentity sources. Solutions include pervasive use of endpoint security (such as the\nMicrosoft Defender Suite of services, including Endpoint and Identity) as well as high\nvalue identity monitoring solutions. The view of user behavior should be unified across\nall platforms and behavioral analytics should be enabled. Note: behavioral analytics\n(with an understanding of what traditional administrative activity consists of, and what\ntools are used for it) combined with frequency analysis of activity is often the only\navenue for network defenders to detect anomalous activity.\n6. Report to CISA. Post-eviction, all Category 3 agencies should report to CISA actions\n\ntaken, any actions left incomplete, and their assessments of the residual risk. Following\ndissemination of this guidance, CISA will release a checklist to the Homeland Security\nInformation Network (HSIN) for agencies to use to complete the steps in this guidance.\nAgencies should fill out and submit the checklist to CISA.\n\n\n-----\n\n7. Maintain vigilance. In the hours, days, and weeks after the network s internet\n\nconnection is restored, the agency’s detection capability will be important in verifying\nthat all threat actor activity within the enterprise has stopped. Extended vigilance is\nnecessary because this threat actor has demonstrated extreme patience with follow-on\nactivity.\n\n1. Agencies should ensure their security operations center (SOC) has capabilities\n\nfor enhanced visibility and monitoring of enterprise network and cloud\nenvironments. Refer to SolarWinds and Active Directory/M365 Compromise:\nDetecting APT Activity from Known Tactics, Techniques, and Procedures for\nknown TTPs that agencies should look out for as part of network and\nenvironment monitoring.\n2. Configure endpoint forensics and detection solutions for aggressive collection;\n\nprioritize this by value of asset and account.\n\n## Frequently Asked Questions\n\n**Does my organization have to complete all the steps in this eviction guidance?**\n\n[In accordance with ED 21-01: Supplemental Direction Version 4, agencies with networks that](https://cyber.dhs.gov/ed/21-01/#supplemental-direction-v4)\nused affected versions of SolarWinds Orion and have evidence of follow-on threat actor\nactivity, such as binary beaconing to `avsvmcloud[.]com and secondary command and`\ncontrol (C2) activity to a separate domain or IP address, must execute and complete the preeviction phase of this guidance. Agencies that find additional adversarial activities must\nexecute and complete the eviction and post eviction phases of this guidance. Conducting all\nof the steps in this guidance is necessary to fully evict the adversary from applicable\nnetworks. Failure to perform comprehensive and thorough remediation activity will expose\nenterprise networks and cloud environments to substantial risk for long-term undetected APT\nactivity.\n\n**Is there a time limit to completing the eviction activities?**\n\n[In accordance with ED 21-01: Supplemental Direction Version 4, agencies subject to the](https://cyber.dhs.gov/ed/21-01/#supplemental-direction-v4)\nrequirements must complete the applicable phases in this eviction guidance by July 16,\n2021, or within 90 days of discovery of follow-on threat activity after issuance of ED 21-01\nSupplemental Direction Version 4.\n\n**Given that severing the enterprise network from the internet will have significant**\n**operational impact, does the organization need to take all its endpoints offline?**\n\nIf the affected organization can authoritatively and comprehensively identify compromised\ninternet-connected endpoints, identities, and systems and is able to take those offline without\naffecting uncompromised or non-internet connected systems, then the agency does not need\nto disconnect non-compromised endpoints or non-internet-connected systems. This will still\n\n\n-----\n\ndisrupt C2 activities while allowing the agency to keep as much of the system up as possible.\nNote: access to environments with pervasively compromised credentials will frequently\nappear to be standard user activity, as it will use “native” services and identities.\n\n**Will CISA provide agencies new TTPs in the event of a reinfection?**\n\nRefer to SolarWinds and Active Directory/M365 Compromise: Detecting Advanced Persistent\nThreat Activity from Known Tactics, Techniques, and Procedures for reinfection TTPs and\ncorresponding detection artifacts.\n\n**Will CISA provide architectural recommendations for future rebuilds?**\n\nThis current guidance is tailored to provide short-term remediation steps for agencies to evict\nthis adversary from compromised on-premises and cloud environments and protect networks\nagainst additional compromise. CISA will be releasing long-term enterprise architecture and\nsecurity operations guidance that incorporates updated credential/access management,\nmonitoring, and detection guidance for a more secure, resilient federal enterprise.\n\n## Contact Information\n\nRecipients of this report are encouraged to contribute any additional information that they\nmay have related to this threat. For any questions related to this report, please contact CISA\nat:\n\nPhone: (888) 282-0870\nEmail: [central@cisa.gov](http://10.10.0.46/mailto:central@cisa.gov)\n\n## Revisions\n\nMay 14, 2021: Initial Version\n\n[This product is provided subject to this Notification and this](https://us-cert.cisa.gov/privacy/notification) [Privacy & Use policy.](https://www.dhs.gov/privacy-policy)\n\n**Please share your thoughts.**\n\n[We recently updated our anonymous product survey; we'd welcome your feedback.](https://www.surveymonkey.com/r/CISA-cyber-survey?product=https://us-cert.cisa.gov/ncas/analysis-reports/ar21-134a)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-05-14 - Analysis Report (AR21-134A)- Eviction Guidance for Networks Affected by the SolarWinds and Active Directory-M365 Compromise.pdf"
    ],
    "report_names": [
        "2021-05-14 - Analysis Report (AR21-134A)- Eviction Guidance for Networks Affected by the SolarWinds and Active Directory-M365 Compromise.pdf"
    ],
    "threat_actors": [
        {
            "id": "b43e5ea9-d8c8-4efa-b5bf-f1efb37174ba",
            "created_at": "2022-10-25T16:07:24.36191Z",
            "updated_at": "2025-03-27T02:02:10.1909Z",
            "deleted_at": null,
            "main_name": "UNC2452",
            "aliases": [
                "Dark Halo",
                "Nobelium",
                "SolarStorm",
                "StellarParticle",
                "UNC2452"
            ],
            "source_name": "ETDA:UNC2452",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "70872c3a-e788-4b55-a7d6-b2df52001ad0",
            "created_at": "2023-01-06T13:46:39.18401Z",
            "updated_at": "2025-03-27T02:00:03.01553Z",
            "deleted_at": null,
            "main_name": "UNC2452",
            "aliases": [
                "DarkHalo",
                "StellarParticle",
                "NOBELIUM",
                "Solar Phoenix",
                "Midnight Blizzard"
            ],
            "source_name": "MISPGALAXY:UNC2452",
            "tools": [
                "SNOWYAMBER",
                "HALFRIG",
                "QUARTERRIG"
            ],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "1d3f9dec-b033-48a5-8b1e-f67a29429e89",
            "created_at": "2022-10-25T15:50:23.739197Z",
            "updated_at": "2025-03-27T02:00:55.536417Z",
            "deleted_at": null,
            "main_name": "UNC2452",
            "aliases": [
                "UNC2452",
                "NOBELIUM",
                "StellarParticle",
                "Dark Halo"
            ],
            "source_name": "MITRE:UNC2452",
            "tools": [
                "Sibot",
                "Mimikatz",
                "Cobalt Strike",
                "AdFind",
                "GoldMax"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "cf7fc640-acfe-41c4-9f3d-5515d53a3ffb",
            "created_at": "2023-01-06T13:46:38.228042Z",
            "updated_at": "2025-03-27T02:00:02.775905Z",
            "deleted_at": null,
            "main_name": "APT1",
            "aliases": [
                "GIF89a",
                "G0006",
                "PLA Unit 61398",
                "Group 3",
                "TG-8223",
                "Comment Group",
                "ShadyRAT",
                "COMMENT PANDA",
                "Comment Crew",
                "Byzantine Candor",
                "Brown Fox"
            ],
            "source_name": "MISPGALAXY:APT1",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "5b748f86-ac32-4715-be9f-6cf25ae48a4e",
            "created_at": "2024-06-04T02:03:07.956135Z",
            "updated_at": "2025-03-27T02:05:17.407352Z",
            "deleted_at": null,
            "main_name": "IRON HEMLOCK",
            "aliases": [
                "ATK7 ",
                "Blue Kitsune ",
                "Cozy Bear ",
                "The Dukes",
                "UNC2452 ",
                "YTTRIUM ",
                "APT29 "
            ],
            "source_name": "Secureworks:IRON HEMLOCK",
            "tools": [
                " CozyCar",
                " CozyDuke",
                " DiefenDuke",
                " FatDuke",
                " HAMMERTOSS",
                " LiteDuke",
                " MiniDuke",
                " OnionDuke",
                " PolyglotDuke",
                " RegDuke",
                " RegDuke Loader",
                " SeaDuke",
                " Sliver",
                "CosmicDuke"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "a241a1ca-2bc9-450b-a07b-aae747ee2710",
            "created_at": "2024-06-19T02:03:08.150052Z",
            "updated_at": "2025-03-27T02:05:17.409596Z",
            "deleted_at": null,
            "main_name": "IRON RITUAL",
            "aliases": [
                "Blue Dev 5 ",
                "BlueBravo ",
                "Cloaked Ursa ",
                "CozyLarch ",
                "Dark Halo ",
                "Midnight Blizzard ",
                "NOBELIUM ",
                "StellarParticle ",
                "UNC2452 ",
                "APT29"
            ],
            "source_name": "Secureworks:IRON RITUAL",
            "tools": [
                " Cobalt Strike",
                " EnvyScout",
                " GoldFinder",
                " GoldMax",
                " NativeZone",
                " RAINDROP",
                " SUNBURST",
                " Sibot",
                " TEARDROP",
                " VaporRage",
                "Brute Ratel C4"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "20d3a08a-3b97-4b2f-90b8-92a89089a57a",
            "created_at": "2022-10-25T15:50:23.548494Z",
            "updated_at": "2025-03-27T02:00:55.49688Z",
            "deleted_at": null,
            "main_name": "APT29",
            "aliases": [
                "APT29",
                "IRON RITUAL",
                "IRON HEMLOCK",
                "NobleBaron",
                "Dark Halo",
                "NOBELIUM",
                "UNC2452",
                "YTTRIUM",
                "The Dukes",
                "Cozy Bear",
                "CozyDuke",
                "SolarStorm",
                "Blue Kitsune",
                "UNC3524",
                "Midnight Blizzard"
            ],
            "source_name": "MITRE:APT29",
            "tools": [
                "PinchDuke",
                "ROADTools",
                "WellMail",
                "CozyCar",
                "Mimikatz",
                "Tasklist",
                "OnionDuke",
                "FatDuke",
                "POSHSPY",
                "EnvyScout",
                "SoreFang",
                "GeminiDuke",
                "GoldMax",
                "FoggyWeb",
                "SDelete",
                "PolyglotDuke",
                "AADInternals",
                "MiniDuke",
                "SeaDuke",
                "Sibot",
                "RegDuke",
                "CloudDuke",
                "GoldFinder",
                "AdFind",
                "PsExec",
                "NativeZone",
                "Systeminfo",
                "ipconfig",
                "Impacket",
                "Cobalt Strike",
                "PowerDuke",
                "QUIETEXIT",
                "HAMMERTOSS",
                "BoomBox",
                "CosmicDuke",
                "WellMess",
                "VaporRage",
                "LiteDuke"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "f27790ff-4ee0-40a5-9c84-2b523a9d3270",
            "created_at": "2022-10-25T16:07:23.341684Z",
            "updated_at": "2025-03-27T02:02:09.74554Z",
            "deleted_at": null,
            "main_name": "APT 29",
            "aliases": [
                "APT 29",
                "ATK 7",
                "Blue Dev 5",
                "BlueBravo",
                "Cloaked Ursa",
                "CloudLook",
                "Cozy Bear",
                "Dark Halo",
                "Earth Koshchei",
                "Grizzly Steppe",
                "Group 100",
                "ITG11",
                "Iron Hemlock",
                "Iron Ritual",
                "Midnight Blizzard",
                "Minidionis",
                "Nobelium",
                "NobleBaron",
                "Operation Ghost",
                "Operation Office monkeys",
                "Operation StellarParticle",
                "SilverFish",
                "Solar Phoenix",
                "SolarStorm",
                "StellarParticle",
                "TEMP.Monkeys",
                "The Dukes",
                "UNC2452",
                "UNC3524",
                "Yttrium"
            ],
            "source_name": "ETDA:APT 29",
            "tools": [
                "7-Zip",
                "ATI-Agent",
                "AdFind",
                "Agentemis",
                "AtNow",
                "BEATDROP",
                "BotgenStudios",
                "CEELOADER",
                "Cloud Duke",
                "CloudDuke",
                "CloudLook",
                "Cobalt Strike",
                "CobaltStrike",
                "CosmicDuke",
                "Cozer",
                "CozyBear",
                "CozyCar",
                "CozyDuke",
                "Danfuan",
                "EnvyScout",
                "EuroAPT",
                "FatDuke",
                "FoggyWeb",
                "GeminiDuke",
                "Geppei",
                "GoldFinder",
                "GoldMax",
                "GraphDrop",
                "GraphicalNeutrino",
                "GraphicalProton",
                "HAMMERTOSS",
                "HammerDuke",
                "LOLBAS",
                "LOLBins",
                "LiteDuke",
                "Living off the Land",
                "MagicWeb",
                "Mimikatz",
                "MiniDionis",
                "MiniDuke",
                "NemesisGemina",
                "NetDuke",
                "OnionDuke",
                "POSHSPY",
                "PinchDuke",
                "PolyglotDuke",
                "PowerDuke",
                "QUIETEXIT",
                "ROOTSAW",
                "RegDuke",
                "Rubeus",
                "SNOWYAMBER",
                "SPICYBEAT",
                "SUNSHUTTLE",
                "SeaDaddy",
                "SeaDask",
                "SeaDesk",
                "SeaDuke",
                "Sharp-SMBExec",
                "SharpView",
                "Sibot",
                "Solorigate",
                "SoreFang",
                "TinyBaron",
                "WINELOADER",
                "WellMail",
                "WellMess",
                "cobeacon",
                "elf.wellmess",
                "reGeorg",
                "tDiscoverer"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "3aaf0755-5c9b-4612-9f0e-e266ef1bdb4b",
            "created_at": "2022-10-25T16:07:23.480196Z",
            "updated_at": "2025-03-27T02:02:09.826059Z",
            "deleted_at": null,
            "main_name": "Comment Crew",
            "aliases": [
                "APT 1",
                "BrownFox",
                "Byzantine Candor",
                "Byzantine Hades",
                "Comment Crew",
                "Comment Panda",
                "GIF89a",
                "Group 3",
                "Operation Oceansalt",
                "Operation Seasalt",
                "Operation Siesta",
                "Shanghai Group",
                "TG-8223"
            ],
            "source_name": "ETDA:Comment Crew",
            "tools": [
                "Auriga",
                "Cachedump",
                "Chymine",
                "CookieBag",
                "Darkmoon",
                "GDOCUPLOAD",
                "GLOOXMAIL",
                "GREENCAT",
                "Gen:Trojan.Heur.PT",
                "GetMail",
                "Hackfase",
                "Hacksfase",
                "Helauto",
                "Kurton",
                "LETSGO",
                "LIGHTBOLT",
                "LIGHTDART",
                "LOLBAS",
                "LOLBins",
                "LONGRUN",
                "Living off the Land",
                "Lslsass",
                "MAPIget",
                "ManItsMe",
                "Mimikatz",
                "MiniASP",
                "Oceansalt",
                "Pass-The-Hash Toolkit",
                "Poison Ivy",
                "ProcDump",
                "Riodrv",
                "SPIVY",
                "Seasalt",
                "ShadyRAT",
                "StarsyPound",
                "TROJAN.COOKIES",
                "TROJAN.FOXY",
                "TabMsgSQL",
                "Tarsip",
                "Trojan.GTALK",
                "WebC2",
                "WebC2-AdSpace",
                "WebC2-Ausov",
                "WebC2-Bolid",
                "WebC2-Cson",
                "WebC2-DIV",
                "WebC2-GreenCat",
                "WebC2-Head",
                "WebC2-Kt3",
                "WebC2-Qbp",
                "WebC2-Rave",
                "WebC2-Table",
                "WebC2-UGX",
                "WebC2-Yahoo",
                "Wordpress Bruteforcer",
                "bangat",
                "gsecdump",
                "pivy",
                "poisonivy",
                "pwdump",
                "zxdosml"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535992,
    "ts_updated_at": 1743041813,
    "ts_creation_date": 1653786414,
    "ts_modification_date": 1653786414,
    "files": {
        "pdf": "https://archive.orkl.eu/520663ea69f1e13664686077570fdc37742e6bcc.pdf",
        "text": "https://archive.orkl.eu/520663ea69f1e13664686077570fdc37742e6bcc.txt",
        "img": "https://archive.orkl.eu/520663ea69f1e13664686077570fdc37742e6bcc.jpg"
    }
}