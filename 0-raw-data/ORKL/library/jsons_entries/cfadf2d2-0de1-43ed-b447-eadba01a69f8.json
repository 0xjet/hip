{
    "id": "cfadf2d2-0de1-43ed-b447-eadba01a69f8",
    "created_at": "2023-01-12T15:02:53.905697Z",
    "updated_at": "2025-03-27T02:13:12.20404Z",
    "deleted_at": null,
    "sha1_hash": "572da6b9974916ae9ca7e6887dc4add938f17642",
    "title": "2013-09-24 - OSX-Leverage.a Analysis",
    "authors": "",
    "file_creation_date": "2022-05-27T19:11:44Z",
    "file_modification_date": "2022-05-27T19:11:44Z",
    "file_size": 360117,
    "plain_text": "# OSX/Leverage.a Analysis\n\n**[alienvault.com/blogs/labs-research/osx-leveragea-analysis](https://www.alienvault.com/blogs/labs-research/osx-leveragea-analysis)**\n\n[1. AT&T Cybersecurity](https://cybersecurity.att.com/)\n[2. Blog](https://cybersecurity.att.com/blogs)\n\nSeptember 24, 2013 | [Eduardo De la Arada](https://www.alienvault.com/blogs/author/earada)\nA few days ago, a new OSX malware was detected in the wild. It looks like a picture and\nbehaves like it when you click on it. Everything looks fine when the clicked picture is opened\non the screen, but the malware also performs some other actions.\n\nAfter the first look, we saw that the malware copies itself to /Users/Shared/UserEvent.app\nwith the [ditto command, and creates a LaunchAgent to load itself when the computer starts](https://developer.apple.com/library/mac/documentation/Darwin/Reference/ManPages/man1/ditto.1.html)\nwith these shell commands:\n\nmkdir ~/Library/LaunchAgents\n\necho ' p://www.apple.com/DTDs/PropertyList-1.0.dtd\">RunAtLoad\ney>KeepAliveLabelUserEvent.SystemProgramArguments\n\n/Users/Shared/UserEvent.app/Contents/MacOS/UserEvent' >\n~/Library/LaunchAgents/UserEvent.System.plist\n\nFinally, the malware deletes the icon from\n/Users/Shared/UserEvent.app/Contents/Resources/UserEvent.icns so it doesn't look like a\npicture anymore, avoiding opening the picture again when the user starts-up.\n\nAfter that, it runs a hidden app to send and receive information from his C&C. It tries to\nconnect to servicesmsc.sytes.net on port 7777 and send information about the device:\n\nosx@VMware7,1\n\n|Mac OS X 10.8.3 12D78\n\n|2 GB RAM\n\n|25Gi/40Gi free (38% used)\n\n|VMWVk2PAxDQT42sMNEtz3YFhg\n\nIt picks the information from these shell commands:\n\nlogname\n\nioreg -l | grep \"product-name\" | awk -F\" '{print $4}'\n\nsw_vers | awk -F': ' '{print $2}' | paste -d ' ' - - -;\n\nsysctl -n hw.memsize | awk '{print $0/1073741824\" GB RAM\"}';\n\ndf -hl | grep 'disk0s2' | awk '{print $4\"/\"$2\" free (\"$5\" used)\"}'\n\nioreg -l | grep \"IOPlatformSerialNumber\" | awk -F\" '{print $4}'\n\n\n-----\n\nThe domain name servicesmsc.sytes.net is not resolving to an IP address anymore but it\nused to resolv to the IP address 199.127.102.242.\n\nIf we take a deeper look at the disassembled code, we can see that the virus is written in\nRealbasic, which makes the work a bit tough. The strings are not referenced from the code.\nInstead of that, Realbasic uses an indirect table level. So redefining each group of bytes as a\nstructure, we could get the xref of each string and we could locate them in the code.\n\nIn the function names we could see two interesting groups: the network ones and the\nWindow1 ones. Let's take a look at the Window1 group. If we see a Window1 in the code it is\nbecause the app has a graphical interface, right? So let's search for the visible boolean and\nchange it.\n\nWe could find the value 0 next to the string serverVisible. You could change it with this\nRadare oneliner:\n\necho 'wx 01 @ 0x001c8769' | r2 -w DSC00117.app/Contents/MacOS/UserEvent\n\nThen, when the app has started, it shows this server Window:\n\nWhen the button is clicked a msgbox is shown with the output of the folder '/':\n\n\n-----\n\nOn the other side, if we continue looking at the network functions, we can realize that they\nuse the easytcpsocket wrapper from Realbasic. This wrapper uses a private protocol with the\nfollowing structure:\n\n[package size ] [package number ] [msg]\n\nWith this structure we can send specific crafted packages to talk with the bot.\n\nSo, listing the strings with the xref pointing to the easytcpsocket receiver we can figure out\nwhich are the available commands from the C&C.\n\n\n-----\n\nps -x | awk {print $1|$4}\nrm\nkill\nwhoami\ncat\nosascript -e 'input volume of (get volume settings)'\nosascript -e 'tell Application 'System Events' to set volume input volume ',0\nosascript -e 'tell application \"System Events\" to get the hidden of every login item'\nosascript -e 'tell application \"System Events\" to get the name of every login item'\nosascript -e 'tell application \"System Events\" to get the path of every login item'\nosascript -e 'tell application \"System Events\" to delete login item '\nosascript -e 'tell application \"System Events\" to make new login item with properties {path:,\nhidden:true} at end'\n\nWe can observe some Osascript commands to modify loginItems. The attacker is able to\ncreate a specific hidden loginItem to load his software at the start (not only with the launch\nagent), modify and delete them. Also it's able to get the current volume of the target and\nchange it to the level it wants to, list processes and their pids, kill them, get file info and\nremove files.\n\nTo finish this analysis, I would like to clarify that Realbasic provides the possibility of building\nthe code to Windows and Linux platforms, so itâ€™s not so weird to see this malware or this\nC&C running in other platforms, changing the scripts to focus the targeted platform,\nobviously.\n\nIf you suspect that you have been infected with this malware, you can check if there is an\nUserEvent app in /Users/Shared/ folder and remove it. This avoids the malware to start on\nnew computer starts-up. On the other hand, right now the C&C is down, so you can start a\nservice listening on port 7777 and verify if the malware is already running in your box.\n\nFrom AlienVault we want to provide you a snort rule to detect the network behavior and a\nYara rules to detect the executable file. You can download the rules from our GitHub\naccount.\n\n\n-----\n\n## Share this with others\n\nTags: [macosx,](https://www.alienvault.com/blogs/tag/macosx) [sea,](https://www.alienvault.com/blogs/tag/sea) [osxleverage.a](https://www.alienvault.com/blogs/tag/osxleverage.a)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2013/2013-09-24 - OSX-Leverage.a Analysis.pdf"
    ],
    "report_names": [
        "2013-09-24 - OSX-Leverage.a Analysis.pdf"
    ],
    "threat_actors": [
        {
            "id": "1f6ae238-765f-4495-9d54-6a7883d7a319",
            "created_at": "2022-10-25T16:07:24.573456Z",
            "updated_at": "2025-03-27T02:02:10.284644Z",
            "deleted_at": null,
            "main_name": "TA511",
            "aliases": [
                "MAN1",
                "Moskalvzapoe"
            ],
            "source_name": "ETDA:TA511",
            "tools": [
                "Agentemis",
                "Chanitor",
                "Cobalt Strike",
                "CobaltStrike",
                "Ficker Stealer",
                "Hancitor",
                "NetSupport",
                "NetSupport Manager",
                "NetSupport Manager RAT",
                "NetSupport RAT",
                "NetSupportManager RAT",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "542cf9d0-9c68-428c-aff8-81b6f59dc985",
            "created_at": "2023-02-15T02:01:49.554105Z",
            "updated_at": "2025-03-27T02:00:03.110991Z",
            "deleted_at": null,
            "main_name": "Moskalvzapoe",
            "aliases": [
                "MAN1",
                "TA511"
            ],
            "source_name": "MISPGALAXY:Moskalvzapoe",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535773,
    "ts_updated_at": 1743041592,
    "ts_creation_date": 1653678704,
    "ts_modification_date": 1653678704,
    "files": {
        "pdf": "https://archive.orkl.eu/572da6b9974916ae9ca7e6887dc4add938f17642.pdf",
        "text": "https://archive.orkl.eu/572da6b9974916ae9ca7e6887dc4add938f17642.txt",
        "img": "https://archive.orkl.eu/572da6b9974916ae9ca7e6887dc4add938f17642.jpg"
    }
}