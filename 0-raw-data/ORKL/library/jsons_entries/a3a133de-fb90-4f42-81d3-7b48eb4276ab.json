{
    "id": "a3a133de-fb90-4f42-81d3-7b48eb4276ab",
    "created_at": "2023-02-02T02:07:58.059525Z",
    "updated_at": "2025-03-27T02:14:04.058178Z",
    "deleted_at": null,
    "sha1_hash": "9561a5ca9310ab06b8bf6d49b0db7b607402154a",
    "title": "2022-11-16 - A Comprehensive Look at Emotet Virus’ Fall 2022 Return",
    "authors": "",
    "file_creation_date": "2023-02-01T07:38:39Z",
    "file_modification_date": "2023-02-01T07:38:39Z",
    "file_size": 2708715,
    "plain_text": "# Emotet's Return in Fall 2022 - The Virus Is Back\n\n**[proofpoint.com/us/blog/threat-insight/comprehensive-look-emotets-fall-2022-return](https://www.proofpoint.com/us/blog/threat-insight/comprehensive-look-emotets-fall-2022-return)**\n\n[Blog](https://www.proofpoint.com/us/blog)\n[Threat Insight](https://www.proofpoint.com/us/blog/threat-insight)\nA Comprehensive Look at Emotet Virus’ Fall 2022 Return\n\n\nNovember 15, 2022\n\n\n-----\n\n## A Comprehensive Look at Emotet Virus’ Fall 2022 Return\n\nNovember 16, 2022\nPim Trouerbach and Axel F\n\n### Key Takeaways\n\nEmotet returned to the email threat landscape in early November for the first time since July 2022.\nIt is once again one of the most high-volume actors observed by Proofpoint, distributing hundreds\nof thousands of emails per day.\nProofpoint observed multiple changes to Emotet and its payloads including the lures used, and\nchanges to the Emotet modules, loader, and packer.\n[Emotet malware was observed dropping IcedID.](https://www.proofpoint.com/us/blog/threat-protection/threat-week-icedid-malware-trend)\nThe new activity suggests that Emotet’s return is back to its full functionality acting as a delivery\nnetwork for major [malware families.](https://www.proofpoint.com/us/threat-reference/malware)\n[New operators or management might be involved as the botnet has some key differences with](https://www.proofpoint.com/us/threat-reference/botnet)\nprevious deployments.\n\n### Overview\n\n[TA542, an actor that distributes Emotet malware, has once again returned from an extensive break from](https://www.proofpoint.com/us/threat-insight/post/threat-actor-profile-ta542-banker-malware-distribution-service)\n[delivering malicious emails. The actor was absent from the landscape for nearly four months, last seen](https://www.proofpoint.com/us/threat-reference/malicious-email-attachments)\non July 13, 2022 before returning on November 2, 2022. Proofpoint has tracked the delivery methods,\nregional targeting, and done an analysis of the Emotet malware and the IcedID loader payload.\n\nOverall, this activity is similar to July campaigns and many previously observed tactics remain the same,\nhowever new changes and improvements include:\n\nNew Excel attachment visual lures\nChanges to the Emotet binary\nIcedID loader dropped by Emotet is a light new version of the loader\n[Reports of Bumblebee dropped in addition to IcedID](https://twitter.com/Unit42_Intel/status/1590002190298804225)\n\nNow that they are back, TA542’s email campaigns are once again among the leaders by email volume.\nProofpoint has already blocked hundreds of thousands of messages each day.\n\n\n-----\n\nProofpoint expects that the actor will continue to evolve, with potential for higher email volumes, more\ngeographies targeted, and new variants or techniques of attached or linked threats. Additionally, given\nthe observed changes to the Emotet binary, it is likely to continue adapting as well.\n\n### Campaigns\n\nThe volume of emails that Emotet sending bots attempt to deliver each day is in the hundreds of\nthousands. These numbers are comparable to historic averages. Hence, it does not appear that the\nEmotet botnet lost any significant spamming capability during the inactive period. For additional context,\nhistoric highs observed by Proofpoint were millions of emails, with the last such spike in April 2022. The\nchart below shows an indexed volume of emails in the last 5 years. The spike at the bottom right of the\nchart represents November 2022 activity.\n\n_Figure 1: Indexed volume of email messages containing Emotet, TA542’s signature payload (from April_\n_19, 2017 – November 10, 2022)_\n\n**Delivery**\n\nProofpoint continues to see a significant volume of thread hijacking and language localization in emails.\nThe actor continues to use generic lures. The Emotet virus used an IRS-themed lure briefly on\nNovember 8, which may correspond with US-based businesses quarterly tax requirements. While no\nother current events and holiday-based lures have been observed yet, it is likely they will be used soon.\n\nAt the time of writing Proofpoint observed campaigns on nearly every weekday since November 2, more\nspecifically on the following dates: November 2, November 3, November 4, November 7, November 8,\nNovember 9, November 10, and November 11, 2022. However, after being active daily for over a week,\nthe Emotet malware activity stopped. Proofpoint anticipates TA542 will return again soon.\n\n**Geographies Targeted**\n\n\n-----\n\nThe actor continues to target a similar set of countries to those targeted before the break. Proofpoint\nconsistently observed targeting of following countries with high volumes of emails: United States, United\nKingdom, Japan, Germany, Italy, France, Spain, Mexico, Brazil (this is not a complete list). For these\nlisted examples Proofpoint confirmed the targeting not only by location of recipients but additionally via\nappropriate local language use in email bodies, subjects, and filenames.\n\nHonorable mention: Proofpoint observed Greece targeting with attachment names such as τιμολόγιο.xls,\nέγγραφο.xls and τραπεζικούς λογαριασμούς.xls. Greece is not a commonly targeted country by TA542.\n\n_Figure 2: English language email targeting United States and German language email targeting Germany_\n\n_Figure 3: Italian language email targeting Italy & Spanish language email targeting Mexico_\n\n\n-----\n\n_Figure 4: French language email targeting France and Portuguese language email targeting Brazil_\n\n_Figure 5: Japanese language email targeting Japan_\n\n**Attachments**\n\nThe malicious content included in the emails sent by TA542 since the return on November 2 is typically\nan Excel attachment or a password-protected zip attachment with an Excel file inside. The Excel files\ncontain XL4 macros that download the Emotet payload from several (typically four) built-in URLs.\n\n\n-----\n\nThese are the same type of macro-laden Excel sheets that the actor used before the period of inactivity,\nin July 2022. However, what's new is that the Excel file now contains instructions for potential victims to\ncopy the file to a Microsoft Office Template location and run it from there instead. This is a trusted\nlocation and opening a document located in this folder will cause immediate execution of the macros\nwithout any warnings or interactions from the user needed. However, while moving a file to a template\nlocation, the operating system asks users to confirm and that administrator permissions are required to\ndo such a move.\n\nIt remains unclear how effective this technique is. While there is no longer a need for users to enable\nmacros with an extra click, there is instead a need to perform a file move, acknowledge the dialog, and\nthe user must have Administrator privileges.\n\n_Figure 6: Dialog displayed to the users when moving files to Template folders_\n\n\n-----\n\n_Figure 7: Screenshot of the typical Excel attachment observed since November 2_\n\n_Figure 8: Since November 9, the actor switched to a slight variation of the Excel lure, with green_\n_background instead of yellow used on the “Relaunch Required” rectangle_\n\n### Malware Analysis\n\n**XMRig**\n\nAs previously mentioned, TA542 was absent from the landscape for nearly four months, last seen\nsending malicious emails on July 13. However, during the period of inactivity, there were still a couple\nmajor events indicating that someone, or some group, was working on the botnet. On September 16,\n[XMRig, the most common Monero (XMR) miner, was installed by Emotet using command 2 which is just](https://www.proofpoint.com/us/threat-insight/post/smominru-monero-mining-botnet-making-millions-operators)\nfor loading modules. This sample was packed in the same way that other Emotet modules are packed.\nTherefore, it effectively worked just like the other Emotet modules but dropped and executed XMRig.\nGenerally, this is only done when the development team commits to delivering the module long term (like\nthe credit card stealer). XMRig contains a configuration that specifies the mining pool and the wallet\naddress. From the botnet there were two specific wallet IDs that were used. These can be seen below:\n\n\n-----\n\n_Figure 9: XMRig config 1_\n\n\n-----\n\n_Figure 10: XMRig config 2_\n\n**Hardware Module**\n\nAround this time, in September 2022, there was still no spam from the botnet, but modules were being\nsent to the botnet every 24 hours. These modules were the standard information stealers and email\nstealers. Then, on October 10, module ID 2381 was delivered to all E4 bots. This new module showed\nsome new features that eventually would make their way into the actual Emotet loader. This module\ngathers hardware information from the host and sends it to a dedicated list of command and control (C2)\nservers. The following fields are sent in the packet in the given order:\n\nHostname\nUsername\nProcess name\nOS (Operating System) information\nSession ID\nCPU identifier\nTotal size of memory\nUsed memory\n\nAt the end of this packet there is a value that is used to weed out the real bots from the fake bots. There\nis a table within the main function of this module that corresponds to 64 different functions that each\nreturn a 4-byte integer. When the module is sent to the bot, a job ID is sent along with it that is a unique\n\n\n-----\n\nID to that module and bot. This job ID is then used to compute a value between 0-63 and select one of\nthese functions that returns an integer. That integer needs to be placed at the end of the packet. If this\nvalue is left out or not the expected result the operators know the bot is fake and will be banned. To date\nthis has been the most challenging evasion technique the botnet has implemented to stop researchers\nfrom analyzing it.\n\n_Figure 11: Function table containing the 64 callbacks_\n\nTo make these values even more difficult to extract, the integer values are calculated dynamically rather\nthan just returning a hardcoded value. In the screenshot below, the final value returned is going to be\n0x523EC8.\n\n\n-----\n\n_Figure 12: Obfuscated arithmetic to return a constant value_\n\n### Emotet Loader Updates\n\nHaving not seen a loader update since mid-July, when Emotet returned there were quite a few\ndifferences in the botnet.\n\nNew commands\nNew implementation of the communication loop\nNew check-in packet format\nNew packer used\n\nThe Emotet virus supports a variety of commands. When it first returned in November 2021, there were\nseven total commands that were denoted by values 1-7. Eventually commands 4 and upwards were\nremoved until the return in November 2022. Currently there are 5 commands that the Emotet virus\nsupports:\n\n1 – Update bot\n2 - Load module\n3 - Load executable\n4 - Load executable via regsvr32.exe\n16343 – invoke rundll32.exe with a random named DLL and the export PluginInit\n\nCommands 4 and 16343 were added with this latest version of the botnet. 16343 stands out due to it\nbeing a break in the pattern of commands as well as having a specific export. That export is also\ncommonly used for IcedID infections. Notably, Proofpoint has observed Emotet malware delivering\nIcedID as a second stage payload in recent campaigns.\n\n\n-----\n\nThe original packet format of Emotet contained what we suspect to be two version numbers. One that\nwas specific to the loader and one that was specific to the protocol. These values have been replaced in\nthe packet with a singular version number that was set to 4000 with the latest return.\n\nOne of the biggest changes made to the unpacked loader itself was the reimplementation of the\ncommunications loop. The old version used a sleep to determine how often requests were made to the\nC2 servers. The new version utilizes the windows API CreateTimerQueueEx. This API takes a callback\nfunction which is called after an initial duration and then after a set period in a loop. This also meant\nchanges were made to the response parsing of the bots. If the bots receive a twelve-byte value back\nfrom the C2, then the bot reads the last 4 bytes, turns that into an integer and multiplies it by 250 which\nwill be the number of milliseconds to sleep. For long sleeps, Emotet malware defaults to 150 seconds\nand for short sleeps its either 30 seconds or 7.5 seconds.\n\nFinally, the packer used with the loader itself has been updated. Pre-November 2, the packed sample\nwould contain an encrypted resource that would be XOR decrypted with a randomized plaintext string\nwithin the sample. This new packer being used has the encrypted payload inside the .data section\naround offset 20. Once the payload is found within the sample it can be decrypted with the same process\nof finding the random plaintext string and XOR decrypting to get the unpacked sample.\n\n### Command & Control Mishaps\n\nHistorically the Emotet virus has had three major pools of C2s per botnet (E4 and E5). These pools are\nthe loader, the generic modules, then finally the spam modules. These pools do not overlap and\ngenerally what is in one module for the generic pool will be an exact match of what is in another. So, if\nthe process list module has six C2s in it, the mail stealer module will have those exact same six C2s in it\nas well. This is where things start to deviate from previous iterations of Emotet. There are now cases\nwhere IPs are missing from some modules and the developers have left localhost as part of the valid\nC2s. The following graphs show the modules and their IDs as the green nodes and the C2s as the red\nnodes. For module 1444 they seem to have left localhost within the C2 table.\n\n\n-----\n\n_Figure 13: Generic Emotet modules (green) linked to their C2s_\n\nFor the spam C2s, they have some C2s in the modules that do not exist in others, which historically has\nnever been the case. Generally, every module that is part of the group will contain all the C2s in the C2\nlist.\n\n\n-----\n\n_Figure 14: Spam Emotet modules (green) linked to their C2s_\n\nThese mistakes highlight that the botnet might be under new management or potentially new operators\nhave been hired to set up the infrastructure.\n\n### Post Infection Activity\n\nOne of the first payloads that was delivered to the Emotet bots was a new variant of the IcedID loader.\nThis variant is brand new or still in development as it contains a legitimate PDB path.\n\n_Figure 15: IcedID payload with “anubis” PDB path_\n\n\n-----\n\nFrom analysis done on the Conti Leaks from February 2022 in which a researcher with access to Conti s\ninternal operations began leaking data from the cybercriminal organization, researchers have learned\nthat Anubis is the internal name for IcedID and this new variant of the IcedID loader.\n\nIcedID is a two-stage malware. The first stage is the loader which makes a request to download the\nsecond stage (the bot). Standard IcedID that is delivered via malspam exfiltrates system information\nthrough cookies in the request to the loader C2. The C2 then uses that information to determine whether\nthe loader will receive the IcedID bot payload. With the system information generated, the C2 server can\n[easily identify sandboxes which is the reason most sandboxes don’t see the second stage of IcedID.](https://www.proofpoint.com/us/threat-reference/sandbox)\n\nThis new loader forgoes all of that system information exfiltration. Proofpoint researchers believe this is\nbecause the loader is being delivered to already infected machines and therefore there is no need to do\na check on the system profile. The loader starts by resolving the APIs needed to execute properly then it\nmakes up to two HTTP requests to download the encrypted next stage.\n\n_Figure 16: Main function of the loader delivered to Emotet showing the C2 decryption and response_\n_parsing_\n\n\n-----\n\n_Figure 17: Code showing this new loader trying to download the bot via port 443 over HTTPS then over_\n_HTTP on port 80_\n\nIn this case, the malware has a hardcoded URI and domain that are concatenated to create the full\npayload path; bayernbadabum[.]com/botpack.dat. Unlike the standard IcedID loader, this loader tries first\non port 443 over HTTPS then if that fails will try again on 80 over standard HTTP. If the response is over\n0x400 bytes, the loader tries to decrypt and inject the second stage. The second stage can be decrypted\nvia the following Python code.\n\n\n-----\n\n_Figure 18: IcedID’s decryption routine used consistently throughout the bot_\n\nWith the botpack decrypted, it has a similar format to the GZIP response that the malspam IcedID loader\ngets. The format is as follows:\n\n_Figure 19: The structure definition of the botpack format used by IcedID_\n\n\n-----\n\nThe decrypted data needs to start with a 2, which most likely is a version. Next there is a boolean value\nwhich determines if the loader is invoked via the export name or just the ordinal value #1. Following that\nare two sizes which relate to the cleartext custom bot loader, and the encrypted bot. The bot itself is\n[encrypted so needs to be decrypted in the same manner that botpack.dat was decrypted.](https://www.proofpoint.com/us/threat-reference/encryption)\n\n_Figure 20: decrypting botpack and parsing out the DLL loader and the encrypted bot_\n\nCode wise, the IcedID bot here is the exact same as the standard bot delivered to IcedID malspam\ncampaigns but there is a slight difference in how the bot is initialized. When standard IcedID gets\ncommands from the C2, it comes in a list. These commands differ when looking at the IcedID being\ndelivered to Emotet infected hosts.\n\n_Figure 21: Standard IcedID Commands_\n\n\n-----\n\nThe integers in the response correspond to commands within the bot. So, for the above response the bot\nwould execute the following commands in this specific order.\n\n54897577 – update C2 list\n36609609 – start beaconing\n61593029 – get desktop info\n46731293 – get running processes\n24258075 – get system information\n45055027 – get browser cookies\n95350285 – get stored browser credentials\n\nThe bot sent to the Emotet infected machines get the above commands as well as the following:\n\n58139018 – send internal IcedID log\n13707473 – read a file and send contents to C2\n72842329 – search for file and send contents to C2\n\nThis could indicate that more priority is being placed on the IcedID bots running on Emotet machines or\nthat the group managing IcedID bots from malspam is different than the group managing the bots\nsourced from Emotet malware.\n\n### Outlook/Conclusion\n\nOverall, these modifications made to the client indicate the developers are trying to deter researchers\nand reduce the number of fake or captive bots that exist within the botnet. The addition of commands\nrelated to IcedID and the widespread drop of a new IcedID loader might mean a change of ownership or\nat least the start of a relationship between IcedID and Emotet.\n\nEmotet dropping IcedID marks Emotet as being in full functionality again, by acting as a delivery network\nfor other malware families. Emotet malware has not demonstrated full functionality and consistent followon payload delivery (that’s not [Cobalt Strike) since 2021, when it was observed distributing The Trick and](https://www.proofpoint.com/us/blog/threat-insight/cobalt-strike-favorite-tool-apt-crimeware)\nQbot. TA542’s return coinciding with the delivery of IcedID is concerning. IcedID has previously been\nobserved as a follow-on payload to Emotet infections. In many cases, these infections can lead to\n[ransomware.](https://www.proofpoint.com/us/threat-reference/ransomware)\n\n**Indicator** **Description** **First Seen**\n\n\n05a3a84096bcdc2a5cf87d07ede96aff7fd5037679f9585fee9a227c0d9cbf51 IcedID\nSHA256\nObserved\non Emotet\nE4\n\nBayernbadabum[.]com IcedID\ndomain\ncontaining\nthe\nencrypted\nbot\n\n\n3\nNovember\n2022\n\n3\nNovember\n2022\n\n\n-----\n\n99580385a4fef0ebba70134a3d0cb143ebe0946df148d84f9e43334ec506e301 XMRig\nmodule\nSHA256\ndelivered to\nE4\n\nSubscribe to the Proofpoint Blog\n\n\n13\nSeptember\n2022\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-11-16 - A Comprehensive Look at Emotet Virus’ Fall 2022 Return.pdf"
    ],
    "report_names": [
        "2022-11-16 - A Comprehensive Look at Emotet Virus’ Fall 2022 Return.pdf"
    ],
    "threat_actors": [
        {
            "id": "e8e18067-f64b-4e54-9493-6d450b7d40df",
            "created_at": "2022-10-25T16:07:24.515213Z",
            "updated_at": "2025-03-27T02:02:10.267637Z",
            "deleted_at": null,
            "main_name": "Mummy Spider",
            "aliases": [
                "ATK 104",
                "Gold Crestwood",
                "Mummy Spider",
                "TA542"
            ],
            "source_name": "ETDA:Mummy Spider",
            "tools": [
                "Emotet",
                "Geodo",
                "Heodo"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "506404b2-82fb-4b7e-b40d-57c2e9b59f40",
            "created_at": "2023-01-06T13:46:38.870883Z",
            "updated_at": "2025-03-27T02:00:02.939775Z",
            "deleted_at": null,
            "main_name": "MUMMY SPIDER",
            "aliases": [
                "TA542",
                "GOLD CRESTWOOD"
            ],
            "source_name": "MISPGALAXY:MUMMY SPIDER",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "2ac83159-1d9d-4db4-a176-97be6b7b07c9",
            "created_at": "2024-06-19T02:03:08.024653Z",
            "updated_at": "2025-03-27T02:05:17.348806Z",
            "deleted_at": null,
            "main_name": "GOLD CRESTWOOD",
            "aliases": [
                "TA542 ",
                "Mummy Spider "
            ],
            "source_name": "Secureworks:GOLD CRESTWOOD",
            "tools": [
                "Emotet"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1675303678,
    "ts_updated_at": 1743041644,
    "ts_creation_date": 1675237119,
    "ts_modification_date": 1675237119,
    "files": {
        "pdf": "https://archive.orkl.eu/9561a5ca9310ab06b8bf6d49b0db7b607402154a.pdf",
        "text": "https://archive.orkl.eu/9561a5ca9310ab06b8bf6d49b0db7b607402154a.txt",
        "img": "https://archive.orkl.eu/9561a5ca9310ab06b8bf6d49b0db7b607402154a.jpg"
    }
}