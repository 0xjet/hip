{
    "id": "2c28f6b9-03a5-4b20-bb1d-908b4db53516",
    "created_at": "2023-01-12T15:03:59.329701Z",
    "updated_at": "2025-03-27T02:05:53.294699Z",
    "deleted_at": null,
    "sha1_hash": "2b414cdaffbb4a4231d7d34ab1769e76d7a5fdc0",
    "title": "2019-11-26 - Stantinko botnet adds cryptomining to its pool of criminal activities",
    "authors": "",
    "file_creation_date": "2022-05-28T02:45:31Z",
    "file_modification_date": "2022-05-28T02:45:31Z",
    "file_size": 261387,
    "plain_text": "# Stantinko botnet adds cryptomining to its pool of criminal activities\n\n**welivesecurity.com/2019/11/26/stantinko-botnet-adds-cryptomining-criminal-activities/**\n\nNovember 26, 2019\n\nESET researchers have discovered that the criminals behind the Stantinko botnet are distributing a cryptomining module to the computers\nthey control\n\n[Vladislav Hrčka](https://www.welivesecurity.com/author/vhrcka/)\n26 Nov 2019 - 11:30AM\n\nESET researchers have discovered that the criminals behind the Stantinko botnet are distributing a cryptomining module to the computers\nthey control\n\n[The operators of the Stantinko botnet have expanded their toolset with a new means of profiting from the computers under their control. The](https://www.welivesecurity.com/2017/07/20/stantinko-massive-adware-campaign-operating-covertly-since-2012/)\nroughly half-million-strong botnet – known to have been active since at least 2012 and mainly targeting users in Russia, Ukraine, Belarus and\nKazakhstan – now distributes a cryptomining module. Mining Monero, a cryptocurrency whose exchange rate has oscillated in 2019 between\nUS$50 and US$110, has been the botnet’s monetizing functionality since at least August 2018. Before that, the botnet performed click fraud,\nad injection, social network fraud and password stealing attacks.\n\nIn this article, we describe Stantinko’s cryptomining module and provide an analysis of its functionality.\n\nThis module’s most notable feature is the way it is obfuscated to thwart analysis and avoid detection. Due to the use of source level\nobfuscations with a grain of randomness and the fact that Stantinko’s operators compile this module for each new victim, each sample of the\nmodule is unique.\n\n\n-----\n\ne desc be t e odu e s ob uscat o tec ques a d o e, a sepa ate a t c e o e o a a e a a ysts, a poss b e app oac to dea\nwith some of them.\n\nSince Stantinko is constantly developing new and improving its existing custom obfuscators and modules, which are heavily obfuscated, it\nwould be backbreaking to track each minor improvement and change that it introduces. Therefore, we decided to mention and describe only\nwhat we believe are significant adjustments in comparison with earlier samples relative to the state in which the module is to be described.\nAfter all, we intend just to describe the module as it currently is in this article.\n\n## Modified open-source cryptominer\n\nStantinko’s cryptomining module, which exhausts most of the resources of the compromised machine by mining a cryptocurrency, is a highly\n[modified version of the xmr-stak open-source cryptominer. All unnecessary strings and even whole functionalities were removed in attempts](https://github.com/fireice-uk/xmr-stak)\nto evade detection. The remaining strings and functions are heavily obfuscated. ESET security products detect this malware as\nWin{32,64}/CoinMiner.Stantinko.\n\n## Use of mining proxies\n\n[CoinMiner.Stantinko doesn’t communicate with its mining pool directly, but via proxies whose IP addresses are acquired from the description](https://en.wikipedia.org/wiki/Mining_pool)\n[text of YouTube videos. A similar technique to hide data in descriptions of YouTube videos is used by the banking malware Casbaneiro.](https://www.welivesecurity.com/2019/10/03/casbaneiro-trojan-dangerous-cooking/)\nCasbaneiro uses much more legitimate-looking channels and descriptions, but for much the same purpose: storing encrypted C&Cs.\n\nThe description of such a video consists of a string composed of mining proxy IP addresses in hexadecimal format. For example, the\nYouTube video seen in Figure 1 has the description “03101f1712dec626“, which corresponds to two IP addresses in hexadecimal format –\n03101f17 corresponds to 3.16.31[.]23 in decimal dotted-quad format, and 12dec626 is 18.222.198[.]38. As of the time of writing, the format\nhas been slightly adjusted. The IP addresses are currently enclosed in “!!!!”, which simplifies the very process of parsing and prevents\npossible changes of the YouTube video HTML structure turning the parser dysfunctional.\n\n_Figure 1. Example YouTube video whose description provides an IP address for the module’s communication with the mining pool_\n\nIn earlier versions, the YouTube URL was hardcoded in the CoinMiner.Stantinko binary. Currently the module receives a video identifier as a\ncommand line parameter instead. This parameter is then used to construct the YouTube URL, in the form https://www.youtube.com/watch?\nv=%PARAM%. The cryptomining module is executed either by Stantinko’s [BEDS component, or by rundll32.exe via a batch file that we have](https://www.welivesecurity.com/wp-content/uploads/2017/07/Stantinko.pdf)\nnot captured, with the module loaded from a local file system location of the form %TEMP%\\%RANDOM%\\%RANDOM_GUID%.dll.\n\nWe informed YouTube of this abuse; all the channels containing these videos were taken down.\n\n## Cryptomining capabilities\n\nWe have divided the cryptomining module into four logical parts, which represent distinct sets of capabilities. The main part performs the\nactual cryptomining; the other parts of the module are responsible for additional functions:\n\nsuspending other (i.e. competing) cryptomining applications\ndetecting security software\n\n\n-----\n\nsuspe d g t e c ypto g u ct o t e C s o batte y po e o e a tas a age s detected, to p e e t be g e ea ed by\nthe user\n\n### Cryptomining\n\nAt the very core of the cryptomining function lies the process of hashing, and communication with the proxy. The method of obtaining the list\nof mining proxies is described above; CoinMiner.Stantinko sets the communication with the first mining proxy it finds alive.\n\nIts communication takes place over TCP and is encrypted by RC4 with a key consisting of the first 26 characters of the number pi (including\nthe decimal separator, hardcoded in the string “3,141592653589793238462643“) and then base64 encoded; the same key is used in all\nsamples we have seen.\n\nThe code of the hashing algorithm is downloaded from the mining proxy at the beginning of the communication and loaded into memory –\neither directly or, in earlier versions, from the library libcr64.dll that is first dropped onto the disk.\n\nDownloading the hashing code with each execution enables the Stantinko group to change this code on the fly. This change makes it\npossible, for example, to adapt to adjustments of algorithms in existing currencies and to switch to mining other cryptocurrencies in order,\nperhaps, to mine the most profitable cryptocurrency at the moment of execution. The main benefit of downloading the core part of the module\nfrom a remote server and loading it directly into memory is that this part of the code is never stored on disk. This additional adjustment, which\nis not present in earlier version, is aimed at complicating detection because patterns in these algorithms are trivial for security products to\ndetect.\n\nAll instances of Stantinko’s cryptomining module we’ve analyzed mine Monero. We deduced this from the jobs provided by the mining proxy\nand the hashing algorithm. For example, Figure 2 is a job sent by one of the proxies.\n\n{“error”:null,”result”:{“status”:”OK”}}\n\n{“method”:”job”,”params”:”blob”:”0b0bbfdee1e50567042dcfdfe96018227f25672544521f8ee2564cf8b4c3139a6a88c5f0b32664000000a1c8ee5c18\n\n_Figure 2. Example mining job received from a mining pool proxy_\n[We analyzed the hashing algorithm used and found that it was CryptoNight R. Since there are multiple cryptocurrencies that use this](https://github.com/SChernykh/CryptonightR)\n[algorithm, its recognition alone isn’t sufficient; it just shortens the list. One can see in the provided job that the height of the blockchain was](https://coinguides.org/block-height/)\n[1815711 at the time, so we had to find currencies using CryptoNight R with this height on dedicated block explorers which lead us to Monero.](https://marketbusinessnews.com/financial-glossary/block-explorer/)\nDissecting the string\n0b0bbfdee1e50567042dcfdfe96018227f25672544521f8ee2564cf8b4c3139a6a88c5f0b32664000000a1c8ee5c185ed2661daab9d0c454fd40e9f53\nreveals that the hash of the previous block (67042dcfdfe96018227f25672544521f8ee2564cf8b4c3139a6a88c5f0b32664) and timestamp\n[(1555590859) indeed fits into Monero’s blockchain at the height of 1815711. One can find the structure of the blob by examining its generator](https://xmrchain.net/search?value=1815711)\n[function in the source code of Monero . The generator function exposes another structure called a block header which contains both the hash](https://github.com/monero-project/monero/blob/a48ef0a65afd2d89b9a81479f587b5b516a31c9c/src/cryptonote_basic/cryptonote_basic.h#L446)\nof the previous block and timestamp.\n\nUnlike the rest of CoinMiner.Stantinko, the hashing algorithm isn’t obfuscated, since obfuscation would significantly impair the speed of hash\ncalculation and hence overall performance and profitability. However, the authors still made sure not to leave any meaningful strings or\nartifacts behind.\n\n### Suspension of other cryptominers\n\nThe malware enumerates running processes searching for other cryptominers. If any competitors are found, Stantinko suspends all their\nthreads.\n\nCoinMiner.Stantinko considers a process to be a cryptominer if its command line contains a particular string, or a combination, which vary\nfrom sample to sample; for example:\n\nminerd\nminergate\nxmr\ncpservice\nvidservice and stratum+tcp://\nstratum://\n-u and pool\n“-u and pool\n“-u and xmr\n-u and xmr\n-u and mining\n“-u and mining\n-encodedcommand and exe\n–donate-level\nwindows and -c and cfgi\nregsvr32 and /n and /s and /q\n\n\n-----\n\napp cat o data a d e e\nappdata and exe\n\n[These strings refer to the following legitimate cryptominers: https://github.com/pooler/cpuminer,](https://github.com/pooler/cpuminer) [https://minergate.com/,](https://minergate.com/)\n[https://github.com/xmrig, and even https://github.com/fireice-uk/xmr-stak – which, interestingly, is the very miner this Stantinko module is](https://github.com/xmrig)\nbased on. The strings also lead to various uninteresting malware samples containing cryptomining functionality.\n\n[Of interest is that the Stantinko operators are known to have tried to get rid of competing code in the past. However, they relied on the](https://www.welivesecurity.com/2017/07/20/stantinko-massive-adware-campaign-operating-covertly-since-2012/)\nlegitimate AVZ Antiviral Toolkit fed with a script written in its built-in scripting language for this task.\n\n### Detection prevention\n\nCoinMiner.Stantinko temporarily suspends mining if it detects there’s no power supply connected to the machine. This measure, evidently\naimed at portable computers, prevents fast battery draining … which might raise the user’s suspicion.\n\nAlso, it temporarily suspends mining if a task manager application (a process named procexp64.exe, procexp.exe or taskmgr.exe) is detected\nrunning.\n\nThe malware also scans running processes to find security software and again task managers. It calculates the CRC-32 of the process’s\nname and then checks it against a hardcoded list of CRC-32 checksums, which is included in the Appendix. In general this technique can\nhelp evade detection, since the process names of those security products are not included in the binary – adding a bit more stealth by not\ncontaining the process names directly. It also makes it harder for analysts to find out what the malware authors are after because one has to\n[crack these hashes, which is technically the same problem as password cracking. However, using a list of known process names is usually](https://en.wikipedia.org/wiki/Password_cracking)\nsufficient to determine the exact names.\n\nShould a CRC-32 match be found, the CRC is written to a log file (api-ms-win-crt-io-l1-1-0.dll). The log file is presumably exfiltrated later by\nsome Stantinko component that we have not seen, since there’s no other functionality related to it in this module.\n\n## Obfuscation\n\nBesides its cryptomining features, CoinMiner.Stantinko is notable also for its obfuscation techniques aimed at avoiding detection and\nthwarting analysis. Some of those techniques are unique and we will describe them in detail in a follow-up article.\n\n## Conclusion\n\nOur discovery shows that the criminals behind Stantinko continue to expand the ways they leverage the botnet they control. Their previous\ninnovations were distributed dictionary-based attacks on Joomla and WordPress web sites aimed at harvesting server credentials, probably\nwith the goal of selling them to other criminals.\n\nThis remotely configured cryptomining module, distributed since at least August of 2018 and still active at the time of writing, shows this group\ncontinues to innovate and extend its money-making capabilities. Besides its standard cryptomining functionality, the module employs some\ninteresting obfuscation techniques that we will disclose, along with some possible countermeasures, in an upcoming article.\n\n## Indicators of Compromise (IoCs)\n\n### ESET detection names\n\nWin32/CoinMiner.Stantinko\n\nWin64/CoinMiner.Stantinko\n\n### SHA-1\n\n[A full list of more than 1,000 hashes is available from our GitHub repository.](https://github.com/eset/malware-ioc/tree/master/stantinko)\n\n00F0AED42011C9DB7807383868AF82EF5454FDD8\n\n01504C2CE8180D3F136DC3C8D6DDDDBD2662A4BF\n\n0177DDD5C60E9A808DB4626AB3161794E08DEF74\n\n01A53BAC150E5727F12E96BE5AAB782CDEF36713\n\n01BFAD430CFA034B039AC9ACC98098EB53A1A703\n\n01FE45376349628ED402D8D74868E463F9047C30\n\n### Filenames\n\napi-ms-win-crt-io-l1-1-0.dll\n\nlibcr64.dll\n\nC:\\Windows\\TEMP\\%RANDOM%\\%RANDOM_GUID%.dll\n\n## M t d RC4 k\n\n\n-----\n\n“3,141592653589793238462643”\n\n## YouTube URLs with mining proxy configuration data\n\n IP addresses of mining proxies\n\n- 3.16.150[.]123\n\n- 3.16.152[.]201\n\n- 3.16.152[.]64\n\n- 3.16.167[.]92\n\n- 3.16.30[.]155\n\n- 3.16.31[.]23\n\n- 3.17.167[.]43\n\n- 3.17.23[.]144\n\n- 3.17.25[.]11\n\n- 3.17.59[.]6\n\n- 3.17.61[.]161\n\n- 3.18.108[.]152\n\n- 3.18.223[.]195\n\n- 13.58.182[.]92\n\n- 13.58.22[.]81\n\n- 13.58.77[.]225\n\n- 13.59.31[.]61\n\n- 18.188.122[.]218\n\n- 18.188.126[.]190\n\n- 18.188.249[.]210\n\n- 18.188.47[.]132\n\n- 18.188.93[.]252\n\n- 18.191.104[.]117\n\n- 18.191.173[.]48\n\n- 18.191.216[.]242\n\n- 18.191.230[.]253\n\n- 18.191.241[.]159\n\n- 18.191.47[.]76\n\n- 18.216.127[.]143\n\n- 18.216.37[.]78\n\n- 18.216.55[.]205\n\n- 18.216.71[.]102\n\n- 18.217.146[.]44\n\n- 18.217.177[.]214\n\n- 18.218.20[.]166\n\n- 18.220.29[.]72\n\n- 18.221.25[.]98\n\n- 18.221.46[.]136\n\n- 18.222.10[.]104\n\n- 18.222.187[.]174\n\n- 18.222.198[.]38\n\n- 18.222.213[.]203\n\n- 18.222.253[.]209\n\n- 18.222.56[.]98\n\n- 18.223.111[.]224\n\n- 18.223.112[.]155\n\n- 18.223.131[.]52\n\n- 18.223.136[.]87\n\n- 18.225.31[.]210\n\n- 18.225.32[.]44\n\n- 18.225.7[.]128\n\n- 18.225.8[.]249\n\n- 52.14.103[.]72\n\n- 52.14.221[.]47\n\n- 52.15.184[.]25\n\n- 52.15.222[.]174\n\n\n-----\n\n## MITRE ATT&CK techniques\n\n**Tactic** **ID** **Name** **Description**\n\nExecution [T1085](https://attack.mitre.org/techniques/T1085/) Rundll32 The module can be executed by\nrundll32.exe.\n\n[T1035](https://attack.mitre.org/techniques/T1035/) Service Execution The malware can be executed as a service.\n\n\nDefense\nEvasion\n\n\n[T1140](https://attack.mitre.org/techniques/T1140/) Deobfuscate/Decode Files or Information The module deobfuscates strings in its\ncode during the execution process.\n\n\n[T1027](https://attack.mitre.org/techniques/T1027/) Obfuscated Files or\nInformation\n\n\nThe module obfuscates its code and strings in an\napparent attempt to make analysis and detection difficult.\n\n\n[T1102](https://attack.mitre.org/techniques/T1102/) Web Service The malware acquires configuration data from description\nof YouTube videos.\n\nDiscovery [T1063](https://attack.mitre.org/techniques/T1063/) Security Software Discovery The malware acquires a list of running\nsecurity products.\n\n\nCommand\nand\nControl\n\n\n[T1090](https://attack.mitre.org/techniques/T1090/) Connection Proxy The module uses proxies between itself\nand the mining pool.\n\n\n[T1008](https://attack.mitre.org/techniques/T1008/) Fallback Channels The module connects to another mining proxy if the initial\none is inaccessible.\n\n\n[T1095](https://attack.mitre.org/techniques/T1095/) Standard NonApplication Layer\nProtocol\n\n\nThe malware uses TCP for its communications.\n\n\n[T1043](https://attack.mitre.org/techniques/T1043/) Commonly Used Port The malware communicates over port 443.\n\n[T1132](https://attack.mitre.org/techniques/T1132/) Data Encoding The module encrypts then base64 encodes some network\ntraffic.\n\n\n[T1032](https://attack.mitre.org/techniques/T1032/) Standard\nCryptographic\nProtocol\n\n[T1071](https://attack.mitre.org/techniques/T1071/) Standard Application\nLayer Protocol\n\n\nThe module encrypts traffic with RC4.\n\nAcquires configuration data from description of YouTube\nvideos via HTTPS.\n\n\nImpact [T1496](https://attack.mitre.org/techniques/T1496/) Resource Hijacking The module mines cryptocurrency.\n\n## Appendix\n\nCRC-32 checksums checked by CoinMiner.Stantinko and the filenames they equate to are listed below.\n\n0xB18362C7 afwserv.exe\n\n0x05838A63 ashdisp.exe\n\n0x36C5019C ashwebsv.exe\n\n0xB3C17664 aswidsagent.exe\n\n0x648E8307 avastsvc.exe\n\n0x281AC78F avastui.exe\n\n0xAA0D8BF4 avgcsrva.exe\n\n0x71B621D6 avgcsrvx.exe\n\n0x7D6D668A avgfws.exe\n\n0x1EF12475 avgidsagent.exe\n\n0x010B6C80 avgmfapx.exe\n\n0x6E691216 avgnsa.exe\n\n0xB5D2B834 avgnsx.exe\n\n0x36602D00 avgnt.exe\n\n\n-----\n\n0x222EBF57 avgrsa.exe\n\n0xF9951575 avgrsx.exe\n\n0x2377F90C avgsvc.exe\n\n0x37FAB74F avgsvca.exe\n\n0xEC411D6D avgsvcx.exe\n\n0x0BED9FA2 avgtray.exe\n\n0x168022D0 avguard.exe\n\n0x99BA6EAA avgui.exe\n\n0x7A77BA28 avguix.exe\n\n0x0D22F74A avgwdsvc.exe\n\n0x98313E09 avira.servicehost.exe\n\n0x507E7C15 avira.systray.exe\n\n0xFF934F08 avp.exe\n\n0x9AC5F806 avpui.exe\n\n0xBD07F203 avshadow.exe\n\n0x64FDC22A avwebg7.exe\n\n0x0BC69161 avwebgrd.exe\n\n0xBACF2EAC cureit.exe\n\n0x8FDEA9A9 drwagntd.exe\n\n0xE1856E76 drwagnui.exe\n\n0xF9BF908E drwcsd.exe\n\n0xC84AB1DA drwebcom.exe\n\n0x183AA5AC drwebupw.exe\n\n0xAC255C5E drwupsrv.exe\n\n0x23B9BE14 dwantispam.exe\n\n0xDAC9F2B7 dwarkdaemon.exe\n\n0x7400E3CB dwengine.exe\n\n0x73982213 dwnetfilter.exe\n\n0x1C6830BC dwscanner.exe\n\n0x86D81873 dwservice.exe\n\n0xB1D6E120 dwwatcher.exe\n\n0xD56C1E6F egui.exe\n\n0x69DD7DB4 ekrn.exe\n\n0xFB1C0526 guardgui.exe\n\n0x5BC1D859 ipmgui.exe\n\n0x07711AAE ksde.exe\n\n0x479CB9C4 ksdeui.exe\n\n0x6B026A91 nod32cc.exe\n\n0xCFFC2DBB nod32krn.exe\n\n0x59B8DF4D nod32kui.exe\n\n\n-----\n\n0x998B5896 procexp.exe\n\n0xF3EEEFA8 procexp64.exe\n\n0x81C16803 sched.exe\n\n0x31F6B864 spideragent.exe\n\n0x822C2BA2 taskmgr.exe\n\n0x092E6ADA updrgui.exe\n\n0x09375DFF wsctool.exe\n\n26 Nov 2019 - 11:30AM\n\n### Sign up to receive an email update whenever a new article is published in our Ukraine Crisis – Digital Security Resource Center\n\n Newsletter\n\n Discussion\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-11-26 - Stantinko botnet adds cryptomining to its pool of criminal activities.pdf"
    ],
    "report_names": [
        "2019-11-26 - Stantinko botnet adds cryptomining to its pool of criminal activities.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535839,
    "ts_updated_at": 1743041153,
    "ts_creation_date": 1653705931,
    "ts_modification_date": 1653705931,
    "files": {
        "pdf": "https://archive.orkl.eu/2b414cdaffbb4a4231d7d34ab1769e76d7a5fdc0.pdf",
        "text": "https://archive.orkl.eu/2b414cdaffbb4a4231d7d34ab1769e76d7a5fdc0.txt",
        "img": "https://archive.orkl.eu/2b414cdaffbb4a4231d7d34ab1769e76d7a5fdc0.jpg"
    }
}