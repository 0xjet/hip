{
    "id": "6186fa47-b63b-4cfe-bff6-408e8a9e9c4a",
    "created_at": "2023-06-05T02:06:51.577321Z",
    "updated_at": "2025-03-27T02:09:34.565762Z",
    "deleted_at": null,
    "sha1_hash": "87f33fe2a3e883f4536fab0afa7baa322b4afd03",
    "title": "2023-05-05 - Deep Dive Into PIPEDREAM’s OPC UA Module, MOUSEHOLE",
    "authors": "",
    "file_creation_date": "2023-06-04T12:28:47Z",
    "file_modification_date": "2023-06-04T12:28:47Z",
    "file_size": 700231,
    "plain_text": "# Deep Dive Into PIPEDREAM’s OPC UA Module, MOUSEHOLE\n\n**dragos.com/blog/pipedream-mousehole-opcua-module/**\n\nBlog Post\n\nBy Sam Hanson\n\n05.05.23\n\n\nMay 5, 2023\n\n\n-----\n\n[In April of 2022, Dragos published a whitepaper and hosted a](https://hub.dragos.com/whitepaper/chernovite-pipedream) [webinar discussing](https://hub.dragos.com/on-demand/pipedream-malware-chernovite-activity-group)\nPIPEDREAM, the seventh known industrial control systems (ICS)-specific malware\n[developed by the CHERNOVITE threat group. Dragos followed up with a blog titled,](https://www.dragos.com/threat/chernovite/)\n[“Analyzing PIPEDREAM: Results from Runtime Testing.” Continuing this research, Dragos](https://www.dragos.com/blog/analyzing-pipedream-results-from-runtime-testing/)\nis releasing additional information on the Open Platform Communications Unified\nArchitecture (OPC UA) module nicknamed MOUSEHOLE, focusing on further analysis and\nruntime testing results.\n\nIn the first post of this two-part blog, Dragos analysts briefly provide background on OPC\nUA fundamentals, then dive into a high-level overview of MOUSEHOLE’s capabilities,\ndiscuss the open-source Python library utilized by MOUSEHOLE, and finally highlight other\nlibraries that an adversary could abuse in a similar way. In part two, Dragos analysts\ndiscuss the static and dynamic analysis of MOUSEHOLE, an experiment we conducted to\nshowcase MOUSEHOLE’s capabilities, and what industrial control system (ICS) asset\nowners and security practitioners can do to protect against rogue OPC UA clients.\n\n## What is OPC UA?\n\nOpen Platform Communications Unified Architecture (OPC UA) is a popular industrial\nprotocol allowing for data communication between various devices and systems. OPC UA\nwas created to better address the needs of the growing industrial automation market,\nmoving away from its predecessor, OPC Classic’s reliance on Windows and COM/DCOM\ntechnology. OPC UA is platform independent, meaning it can be used on Windows, Linux,\n\n\n-----\n\nor MacOS hosts, and includes all functionalities found in the OPC Classic specification.\nOPC UA was released in 2008 by the OPC Foundation and later added as an IEC standard\n(IEC 62541).\n\nSimply put, OPC UA is an industrial and Internet of things (IoT) communication standard\nand can directly impact how critical systems function. For example, logic running a\nprogrammable logic controller (PLC) could use variables set and modified by a separate\ndevice through the OPC UA protocol.\n\nIt is important to remember that while MOUSEHOLE abuses the OPC UA protocol, there’s\nnothing inherently insecure about OPC UA. In fact, the protocol provides a variety of\nimpressive security settings and configurations.2, 3, 4 While vendors who produce OPC UA\nserver software may not require strong security settings to be configured by the user, that5\nis a vendor implementation issue and not an OPC UA problem.\n\n\nFor more information on the technical details of the OPC UA specification, please see the\n[OPC Foundation’s online reference.](https://reference.opcfoundation.org/)\n\n## What Is MOUSEHOLE?\n\nMOUSEHOLE is one of five modules in PIPEDREAM, the seventh known industrial control\nsystems (ICS)-specific malware. MOUSEHOLE is a Python program that functions as an\nOPC UA client application. It is designed for easy interaction with OPC UA servers from the\ncommand line and contains various capabilities, including:\n\nScanning a network for an OPC UA server\nBrute forcing the authentication mechanism\nReading the structure of a server\nReading and writing to specific node attributes\nSetting various security settings such as security mode, policies, certificates, and\nprivate keys\n\n\n-----\n\nAn adversary with an understanding of a victim s operational technology (OT) environment\ncould modify a node’s value attribute on a poorly secured OPC UA server, causing a direct\nimpact on operations, including the possibility of Loss of Control to connected control\nsystems.\n\nMOUSEHOLE leverages the open-source Python library, python-opcua, which significantly\nreduces the complexity of interacting directly with the protocol, thus lowering the bar of\nsophistication required to impact operations successfully.\n\n## MOUSEHOLE and the Python-OPCUA Library\n\n[The python-opcua library, while deprecated, is available on GitHub for anyone to download](https://github.com/FreeOpcUa/python-opcua)\nand use. This API makes it incredibly easy for a programmer to connect, authenticate, and\nsend requests to an OPC UA server with only a few API calls. The library exposes various\nservices to the programmer, such as the read or write attribute service, which can be called\nupon by the client and executed by the server. The library achieves this by implementing\n[internal Python classes and objects that comply with the OPC UA Service Set protocol](https://reference.opcfoundation.org/Core/Part4/v105/docs/5)\nspecification. These Python objects are sent in binary format, interpreted, and executed by\nthe server.\n\nLet’s walk through an example client application to demonstrate how simple it is to connect\nto and manipulate an OPC UA server. We will discuss the get_value function (which reads a\nnode’s value attribute) to demonstrate how the API works under the hood. Our script will\nconnect to a poorly secured server (anonymous authentication enabled), read a node value\nattribute, and finally, write a value to the node. In total, the final script looks like the\nfollowing:\n\n\n-----\n\n_Figure 1: A Simple OPC UA Client Application_\nOnly six lines of code are needed to connect, receive, and send data to the server, which\nare the foundational components of MOUSEHOLE’s functionality. However, a lot is\nhappening under the hood that the programmer may be blissfully unaware of.\n\nFor example, the get_value method executes a series of functions that populate a Python\n_[ReadRequest object representing the OPC UA read service. This ReadRequest object is](https://reference.opcfoundation.org/Core/Part4/v105/docs/5.10.2)_\nbinarized and sent to the server, which is then interpreted and executed, as shown in Figure\n2. The value is sent back to the client and, in our example script, stored in the node_value\nvariable seen in Figure 1.\n\n_Figure 2: Screenshot of Python-OPC UA library, Read Command Being Sent to Server_\n\n\n-----\n\nThe set_value method works similarly but instead sends a WriteRequest object\n[representing the write service to the server. The API makes it as simple as possible to](https://reference.opcfoundation.org/Core/Part4/v105/docs/5.10.4)\ninteract with the OPC UA server without exposing the programmer to the complexities of\nOPC UA or its internal structures.\n\n## Open-Source Industrial Protocol Libraries\n\nFrom a programming perspective, MOUSEHOLE is not a sophisticated tool. Most of the\ncode is a simple command line interface for the python-opcua library, where much of the\ncomplexity is hidden. The programmer must understand only the highest-level function calls\nand objects. This abstraction of knowledge is a double-edged sword; it simplifies the job of\na legitimate developer while allowing adversaries to quickly develop programs that can\ncause serious industrial impact with little required expertise in the technology and protocols.\n\nThere are dozens of open-source industrial protocol libraries and APIs on GitHub that could\nbe abused in a similar fashion, including Modbus, BACnet, DNP3, IEC 104, IEC 61850\nEthernet/IP and CIP, Ethercat, and many more. Some of these libraries and APIs are6\nincredibly advanced and provide significant capabilities to the user. For example, the opensource PyModbus implementation is a full-featured server and client application with a\ncommand line interface. An adversary could download this tool and have a significantly\nmore capable Modbus equivalent to MOUSEHOLE. Dragos has no evidence that these\nlibraries have been leveraged to create malicious tools. Nonetheless, these libraries could\nbe abused in the future.\n\n## In Summary\n\nCHERNOVITE’s creation of a malicious OPC UA tool is more indicative of OPC UA’s\nubiquity than the protocol’s security. CHERNOVITE could have easily used any number of\nopen-source libraries that implement common industrial protocols, many of which are less\nsecure than OPC UA. As the proliferation of ICS tools and knowledge expands, it is\nparamount that defenders understand what emerging threats may exist and take action to\nmitigate the risk.\n\nPart two of our blog covers the runtime experiments we conducted with MOUSEHOLE and\nbest practices for OPC UA server security. Stay tuned! In the meantime, be sure to check\nout other PIPEDREAM-related content on our blog:\n\n\n-----\n\n### Get the Complete Analysis\n\nLearn more about the discovery and capabilities of CHERNOVITE’s PIPEDREAM malware\nin our whitepaper.\n\n[Download Whitepaper](https://hub.dragos.com/whitepaper/chernovite-pipedream)\n\n**Source:**\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2023/2023-05-05 - Deep Dive Into PIPEDREAM’s OPC UA Module, MOUSEHOLE.pdf"
    ],
    "report_names": [
        "2023-05-05 - Deep Dive Into PIPEDREAM’s OPC UA Module, MOUSEHOLE.pdf"
    ],
    "threat_actors": [
        {
            "id": "091dc6fb-2650-4646-894a-41de0d463f94",
            "created_at": "2023-11-17T02:00:07.594612Z",
            "updated_at": "2025-03-27T02:00:03.230461Z",
            "deleted_at": null,
            "main_name": "Chernovite",
            "aliases": [],
            "source_name": "MISPGALAXY:Chernovite",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1685930811,
    "ts_updated_at": 1743041374,
    "ts_creation_date": 1685881727,
    "ts_modification_date": 1685881727,
    "files": {
        "pdf": "https://archive.orkl.eu/87f33fe2a3e883f4536fab0afa7baa322b4afd03.pdf",
        "text": "https://archive.orkl.eu/87f33fe2a3e883f4536fab0afa7baa322b4afd03.txt",
        "img": "https://archive.orkl.eu/87f33fe2a3e883f4536fab0afa7baa322b4afd03.jpg"
    }
}