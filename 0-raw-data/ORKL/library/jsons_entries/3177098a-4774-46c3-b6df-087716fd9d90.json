{
    "id": "3177098a-4774-46c3-b6df-087716fd9d90",
    "created_at": "2023-01-12T15:07:56.054677Z",
    "updated_at": "2025-03-27T02:06:06.458654Z",
    "deleted_at": null,
    "sha1_hash": "bd2fb8c1bb8e0999cd6fd8fc1ee61702a10dde99",
    "title": "2019-10-08 - Một sample nhắm vào Bank ở VN",
    "authors": "",
    "file_creation_date": "2022-05-28T15:23:08Z",
    "file_modification_date": "2022-05-28T15:23:08Z",
    "file_size": 143408,
    "plain_text": "# Một sample nhắm vào Bank ở VN\n\n**tradahacking.vn/đợt-rồi-tôi-có-đăng-một-status-xin-dạo-trên-fb-may-quá-cũng-có-vài-bạn-nhiệt-tình-gửi-cho-**\n537b19ee3468\n\nm4n0w4r October 10, 2019\n\nm4\nn0w4r\n[m4n0w4r](https://kienbigmummy.medium.com/?source=post_page-----537b19ee3468--------------------------------)\n[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F3d670b41fa5f&operation=register&redirect=https%3A%2F%2Ftradahacking.vn%2F%C4%91%E1%BB%A3t-r%E1%BB%93i-t%C3%B4i-c%C3%B3-%C4%91%C4%83ng-m%E1%BB%99t-status-xin-d%E1%BA%A1o-tr%C3%AAn-fb-may-qu%C3%A1-c%C5%A9ng-c%C3%B3-v%C3%A0i-b%E1%BA%A1n-nhi%E1%BB%87t-t%C3%ACnh-g%E1%BB%ADi-cho-537b19ee3468&user=m4n0w4r&userId=3d670b41fa5f&source=post_page-3d670b41fa5f----537b19ee3468---------------------follow_byline-----------)\nOct 8, 2019\n\n\n4 min read\n\nĐợt rồi, sau khi tôi có đăng status xin dạo trên FB, may quá cũng có vài bạn nhiệt tình gửi cho.\nMẫu này theo nhận định thì target thẳng vào bộ phân nhân sự của Bank. Sample có tên dạng:\n**CV_<ten_ung_vien>_ChuyenVienKhachHangCaNhan**\n\n\n-----\n\n## 1. Phân tích XML file\n\nFile nhận được có phần mở rộng là .doc nhưng khi kiểm tra bằng HxD thì thấy đây là một XML\nfile, không phải là OLE file:\n\n\n-----\n\nTa có thể sử dụng oledump [(https://github.com/DidierStevens/DidierStevensSuite) của tác giả](https://github.com/DidierStevens/DidierStevensSuite)\n**Didier Stevens để kiểm tra thông tin liên quan:**\n\n\n-----\n\nNhư trên hình thì file này có hai stream chính là A: oledata.mso và B: editdata.mso. Trong đó\ntại stream B, oledump phát hiện stream B3 là một macro stream. Hoàn toàn có thể dùng\noledump để dump ra VBA code:\n\n\n-----\n\nNgoài ra, cũng có thể sử dụng olevba [(https://github.com/decalage2/oletools/wiki/olevba) của](https://github.com/decalage2/oletools/wiki/olevba)\ntác giả Philippe Lagadec để dump VBA code:\n\n\n-----\n\n**olevba còn cung cấp thêm các thông tin tổng hợp rất hữu ích trong quá trình parse VBA code:**\n\n\n-----\n\nCác bạn có thể đọc code chay để hiểu xem VBA làm gì, nhưng tôi thích dùng tính năng Debug\nVBA code của Office.\n\n\n-----\n\nVBA code thực hiện trigger người dùng khi họ đóng tài liệu, nó sẽ gọi tới đoạn code sau:\n\n\n-----\n\nĐầu tiên sẽ gọi hàm Extract(), hàm này thực hiện nhiệm vụ drop ra một file dll có tên là\n**propsys.dll (a9483fffb2cc476837d42832df2d79c5) và copy file control.exe (là Windows**\n_Control Panel của hệ thống) vào thư mục %LOCALAPPDATA%:_\n\n\n-----\n\nThực hiện thành công hàm Extract() sẽ gọi tiếp hàm Create()để cấu thành một VBScript và\nlưu toàn bộ nội dung của script này vào file abi.vbs (612f6862f823a16736b1334daad3e810) tại\nthư mục %APPDATA%. Sau đó, sử dụng cscript để thực thi file abi.vbs vừa tạo:\n\n\n-----\n\n-----\n\nPhân tích file abi.vbs thì thấy định nghĩa một task để thực thi file control.exe đã được copy\nvào thư mục %LOCALAPPDATA%:\n\nTạo thư mục tại\nKhai báo một task mới và cung cấp các thông tin liên quan:\n\n\n-----\n\nThiết lập trigger cho việc thực thi và tạo ra một file là có định dạng XML để lưu thông tin\nvề task:\n\n\n-----\n\n-----\n\nScheduled task sau khi được tạo thành công sẽ tương tự như sau:\n\n\n-----\n\n## 2. Phân tích sơ bộ propsys.dll (32-bit dll)\n\nDll này export một hàm duy nhất là PSCreateMemoryPropertyStore:\n\n\n-----\n\nCó Import các hàm từ hai thư viện kernel32.dll (67 funcs) và wininet.dll (4 funcs). Để ý các\nhàm được import từ thư viện wininet.dll ta thấy rằng dll này sẽ thực hiện kết nối tới Internet để\nđọc file nào đó:\n\n\n-----\n\nTập trung vào hàm được export là PSCreateMemoryPropertyStore, ta thấy từ hàm này gọi tới\ncác sub function là sub_10001B90; sub_10001250; sub_10001770; sub_10001390. Trong\nđó, đáng chú ý là sub_10001250 vì nó gọi tới các hàm có truy xuất tới Internet:\n\n\n-----\n\n**sub_10001B90 làm nhiệm vụ cấu thành chuỗi URL (hxxps://sub[.]journeywiki[.]com/nancy.ico)**\ntrong memory:\n\n\n-----\n\nHàm sub_10001250 làm nhiệm vụ kết nối tới URL trên với user agent là “Mozilla/5.0\n**(Windows NT 10.0; Win64; x64; rv:59.0) Gecko/20100101 Firefox/59.0” để đọc file và lưu**\nvào vùng buf có kích thước là 0x400 bytes:\n\n\n-----\n\nRất tiếc tại thời điểm hiện tại thì C2 đã chết nên không thể phân tích được gì thêm. Rất cảm ơn\ncác bạn trong friend list đã chia sẻ cho tôi!\n\nSharing is caring!! :pray:\n\nP/S: Bạn nào có thêm thông tin khác thì vui lòng để lại comment !\n\n\n-----",
    "language": "VI",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-10-08 - Một sample nhắm vào Bank ở VN.pdf"
    ],
    "report_names": [
        "2019-10-08 - Một sample nhắm vào Bank ở VN.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536076,
    "ts_updated_at": 1743041166,
    "ts_creation_date": 1653751388,
    "ts_modification_date": 1653751388,
    "files": {
        "pdf": "https://archive.orkl.eu/bd2fb8c1bb8e0999cd6fd8fc1ee61702a10dde99.pdf",
        "text": "https://archive.orkl.eu/bd2fb8c1bb8e0999cd6fd8fc1ee61702a10dde99.txt",
        "img": "https://archive.orkl.eu/bd2fb8c1bb8e0999cd6fd8fc1ee61702a10dde99.jpg"
    }
}