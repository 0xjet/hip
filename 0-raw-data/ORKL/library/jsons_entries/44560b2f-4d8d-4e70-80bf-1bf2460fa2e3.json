{
    "id": "44560b2f-4d8d-4e70-80bf-1bf2460fa2e3",
    "created_at": "2023-01-12T14:58:55.195553Z",
    "updated_at": "2025-03-27T02:08:40.217816Z",
    "deleted_at": null,
    "sha1_hash": "d19e697769d7c51e575278600d4ddfa53ad4be28",
    "title": "2015-08-05 - Who’s Behind Your Proxy- Uncovering Bunitu’s Secrets",
    "authors": "",
    "file_creation_date": "2022-05-28T04:55:19Z",
    "file_modification_date": "2022-05-28T04:55:19Z",
    "file_size": 992989,
    "plain_text": "# Who’s Behind Your Proxy? Uncovering Bunitu’s Secrets\n\n**[blog.malwarebytes.com/threat-analysis/2015/08/whos-behind-your-proxy-uncovering-bunitus-secrets/](https://blog.malwarebytes.com/threat-analysis/2015/08/whos-behind-your-proxy-uncovering-bunitus-secrets/)**\n\nMalwarebytes Labs August 5, 2015\n\n## Disclaimer\n\n[The following research is the result of a collaboration with ad-fraud fighting firm Sentrant.](http://sentrant.com/)\n[Analysts from both the Sentrant and Malwarebytes teams have been working on the Bunitu](https://blog.malwarebytes.org/intelligence/2015/07/revisiting-the-bunitu-trojan/)\nmalware and we decided to combine our efforts to provide a more complete study.\n\n## Executive summary\n\nIn our [previous analysis we showed how the Bunitu Trojan was distributed via the](https://blog.malwarebytes.org/intelligence/2015/07/revisiting-the-bunitu-trojan/)\nNeutrino exploit kit in various malvertising campaigns. After spending more time analyzing\nthe proxy, we realized that the requests we were receiving were not related to ad-fraud\nactivity (as we initially suspected) but instead appeared to be for some sort of VPN service.\n\nWe believe that the operators of the Bunitu botnet are selling access to infected proxy bots\nas a way to monetize their botnet. People using certain VPN service providers to protect their\nprivacy are completely unaware that the backend uses a criminal infrastructure of infected\ncomputers worldwide.\n\n\n-----\n\n_Number of Bunitu infections in July based on telemetry data from Malwarebytes Anti-Malware._\n\nNot only that, but all traffic is also unencrypted – ironic for a VPN service – and could be\nintercepted via a Man-In-The-Middle attack. Malicious actions such as data theft or traffic\nredirection could therefore easily be performed.\n\nDuring our research we noticed that a VPN service called VIP72 was heavily involved with\nthe Bunitu botnet and its proxies. VIP72 appears to be a top choice for cybercriminals, as\nreferenced on many underground forums. A recent [report from FireEye on Nigerian](https://www2.fireeye.com/rs/%20848-DID-%20242/images/rpt_nigerian-scammers.pdf)\nscammers also mentions VIP72.\n\nIn this article we will review the proxy mechanism and expose the underlying infrastructure\nused by the Bunitu botnet. We are also sharing indicators of compromise so that end users\nare able to clean up their computers and no longer help to provide free exit nodes\nfor dubious VPN services.\n\n## Technical details\n\n### Experiments performed\n\nIn order to confirm our hypothesis regarding the Bunitu proxies we developed our own Bunitu\n“honeypot”. We reverse engineered the Bunitu command and control (C2) protocol and\ndeveloped a script that mimicked the proxy registration request.\n\n\n-----\n\nWe then used the script to register our honeypot to the Bunitu C2 and recorded the URLs of\nall the requests that were subsequently sent to our honeypot. A copy of the honeypot\n[registration script can be found on our GitHub here: bunitu_tests.](https://github.com/hasherezade/bunitu_tests)\n\n### Findings\n\nAlmost immediately after registering our honeypot we realized that many of the requests we\nwere receiving came from a VPN service known as VIP72.\n\nSince the clients were already connected through a proxy it seemed strange that they would\nbe visiting a second proxy, so we decided to investigate further. We also shut down the\nhoneypot as we did not want to accidentally intercept legitimate requests from people who\nwere unaware that they were using a botnet as a proxy.\n\nWe registered an account and logged into VIP72 and were surprised to see our honeypot\nproxy listed as one of their available exit IP address. Of course this in of itself is not proof\nthat VPIP72 is knowingly using Bunitu botnet proxies.\n\nIt could be the case that they were scanning the Internet for open proxies (proxies that are\nlistening on the Internet without requiring authentication) and using them to route traffic.\nHowever, we noticed a bug in the proxy registration system. The IP address that the proxy is\ninitially registered from will be maintained in the VIP72 database as the “HOST” and\nassociated with the proxy, even if the proxy moves to a new IP address.\n\nTo prove that VIP72 is using Bunitu proxies as their exit points, we registered a Bunitu proxy\nfrom one IP (Honeypot #1) then moved it to another IP (Honeypot #2) and registered it again\nusing the same bot ID.\n\n\n-----\n\nAs you can see in the VIP72 proxy list, the IP for Honeypot #1 is still listed as the proxy\n“HOST” with the new IP for Honeypot #2 listed as the current IP.\n\nIf VIP72 was simply scanning the Internet for open proxies it is possible that they would have\nidentified both our proxies (old and new IP) at different times. However, without having\naccess to the Bunitu C2 server and bot ID there is no way that they could have associated\nthose IPs to the same proxy as shown in the screenshot above.\n\nThis is proof that the operators of VIP72 also have direct access to the Bunitu botnet server\nand use Bunitu infected hosts as proxies for their service.\n\n### Distributors\n\nOur experiment lead us to the conclusion that distributors are different based on\nthe geolocation of Bunitu infected machines.\n\nIn the US. and Canada, the VPN provider is VIP72, but in Central and Eastern Europe\ncharacteristics of the traffic are entirely different and suggest another VPN provider which we\nhave not been able to pinpoint yet.\n\n\n-----\n\nOur hypothesis is that the botnet is operated by a middleman who resells a pool of bots to\nvarious providers. Then, the bots are assigned to particular VPN networks according to their\ngeolocation.\n\n### Proxy analysis\n\nTwo types of proxies are created on an infected machine:\n\n1. Standard, by opening ports and passing traffic through them which works if the\n\nmachine has a public IP address.\n2. Tunneled, by connecting to C&C #2 and receiving commands through and passing the\n\nresults back which works even if the infected machine has no public IP address.\n\nViewing connections by tcpview, we can see:\n\nFirst 2 connections belong to standard proxies – HTTP and SOCKS (listening at 2\n**randomly chosen ports).**\nSecond connection belongs to C&C#2 (in this case: 95.211.15.37) at remote port 53\n(tunnel).\n\n**Connection initialization process:**\n\nAs we mentioned in the previous post about Bunitu, during installation of the Trojan, a unique\nID is generated and stored in the registry:\n\n\n-----\n\nThis is an important value sent to the C&Cs and used to identify the particular bot (bot ID). It\noccurs in each and every packet exchanged between the bot and C&C, often in its truncated\nversion containing only the first 4 byes, i.e.: fb 1b 70 67 for the above case.\n\nIn short, presence of the relevant key in the packet can be used as proof that the packet\nbelongs to the Bunitu protocol.\n\n**Standard proxy registration (packet sent to C&C#1):**\n\nDetails:\n\n\n-----\n\n```\n00 01 01 00 00 01 00 00 00 00 00 00 header (hard coded)\n67 ab = socks proxy port (little endian -> 0xab67 = 43879)\na0 32 = http proxy port (little endian -> 0x32ab = 12971)\n05 00 = hard coded value\n3a = minutes since last reboot\n02 = hours since last reboot\nfb 1b 70 67 d6 6f c0 9d ad df = bot ID\n8d f0 = hard coded unique to each version of the malware\n\n```\n**Tunneling proxy registration (packet sent to C&C#2):**\n\nDetails:\n```\n0e 00 = Length of the message (little endian) -> 0x00e0 -> 14\nfb 1b 70 67 d6 6f c0 9d = bot ID, truncated (without last WORD)\n21 04 00 00 = command (0x0421) \"start the proxy\"\n\n```\n**Communication models: standard proxy vs tunnel:**\n\n**C&C#1 is used to register standard proxies when the clients have a public IP address.**\n\nTo keep the connection with C&C#1, the client periodically sends the above registration\npacket. Due to the fact that the infected machine has a public IP, the role of the C&C is\nsimple: To make sure that the bot is ready to receive commands.\n\n[To emulate the bot’s behavior, we have implemented the following script: cnc1_test.py. The](https://github.com/hasherezade/bunitu_tests/blob/master/cnc1_test.py)\nserver is just used to receive data from the client, and does not send any special response\nback and that’s why it is not possible to verify whether the given host is a Bunitu C&C#1.\n\n**C&C#2 (tunnel) is used when the clients don’t have a public IP**\n\nCommunication with the tunnel and keeping the connection alive is more complex, as it\ninvolves a custom protocol. In this case, the server plays an active and important role: Its\nresponses can be used to test whether a particular host is a Bunitu C&C#2. For such a\n[verification, we have created following script: cnc2_test.py](https://github.com/hasherezade/bunitu_tests/blob/master/cnc1_test.py)\n\nAfter receiving the registration packet, C&C#2 tests the bot by asking it to execute a DNS\nquery:\n\n\n-----\n\n1. C&C#2 (IP: 95.211.178.145) sends a command to test the connection by\n\nquerying google.com\n2. The bot executes the request by making the DNS query and then testing the\n\nconnection with the queried IP 216.58.209.70 that belongs to google.com\n3. The bot reports success (or failure) to C&C#2 (IP: 95.211.178.145)\n4. C&C#2 confirms receiving the report\n\nPackets exchanged between C&C#2 (blue) and bot (red) during this test:\n\nEvery packet exchanged between C&C#2 and a bot is prompted by a DWORD containing\nthe length of the data that follows it (little endian). After that, there is the bot ID (truncated to\nfirst 4 bytes).\n\nThe 6-th DWORD **_(marked red) packet can have the following meanings:_**\n\n**01 00 00 01: “test the given domain”**\n**01 00 02 01: “bot reporting: domain tested”**\n**04 00 02 00: “report accepted”**\n\nThe 8-th DWORD **_(marked purple) is the socket number via which the bot performed a_**\nrequest (to google)\n\n\n-----\n\nThe 9-th DWORD **_(marked yellow) is a unique value generated by the C&C#2_**\n\nThe bot tests the connection with google, and then builds the response for the C&C#2\n(based on the request and changing the appropriate fields):\n\n### Tunneling communication process for the client\n\n\n-----\n\n**REQUEST (C&C#2 to bot)**\nThe tunneled C&C receives the requests from the connected clients. It wraps them in the\ninternal protocol and sends them to an infected machine.\n\n1. C&C#2 (IP: 95.211.178.145) gives an order to make a particular request (demanded by\n\nthe proxy user)\n2. The bot performs the request\n\n\n-----\n\n**RESPONSE (bot to C&C#2)**\nThe infected machine carries out the requested operations and its IP address is visible from\nthe outside. After fetching the results, it packs them in the internal protocol and sends them\nback to the C&C (tunnel).\n\n1. The bot gets the response from the appropriate server\n2. The bot passes the response to C&C#2 (IP: 95.211.178.145), wrapped in the internal\n\nprotocol and then C&C#2 passes it to the proxy user\n\nDuring the communication process, C&C#2 may request the bot to connect to additional IPs.\n\nHere is a command from C&C#2 instructing the bot to connect to a new IP and setup the\ntunnel SOCKS proxy:\n\n\n-----\n\nDetails:\n```\n15 00 00 00 - message size\n33 - command for “connect to new IP”\n42 c7 e5 fb - new IP address (little endian)\n\n## Conclusion\n\n```\nBunitu shows us how versatile malware can be, especially when compromised systems are\ntied together towards the same goal. While we have analyzed its main components, there is\nstill much more that is unknown about this threat and in particular the extent of its reach or\nthe list of VPN providers using it.\n\nWe hope that this research will help others to identify Bunitu related infections and eventually\nreduce the size of the botnet. We also invite security firms and law enforcement to get in\ntouch with us via the contacts provided below so we can share with them additional\nintelligence.\n\n## Analyzed samples:\n\n[Original sample (installer) md5=542f7b96990de6cd3b04b599c25ebe57 ; payload](https://www.virustotal.com/en/file/14cf87a14700a36d19e4fb98034437adc054417facb45356f296fe0cfe5d28f4/analysis/)\n[(ynfucvu.dll) md5=1bf287bf6cbe4d405983d1431c468de7](https://www.virustotal.com/en/file/a5090acf84510573ac48de030cf59400813a54cd4af42d1de4bcee9d6ee44cb0/analysis/)\n[Original sample (installer) md5=ac4e05a013705fd268e02a97c15d6f79 ; payload](https://www.virustotal.com/en/file/9c25ce1b5e36926919b29383d4fdde1b71e441254318e790429f684f0cfe2ecd/analysis/)\n[(lyhbyjo.dll) md5=b71832a8326b598208f49bf13e5b961f](https://www.virustotal.com/en/file/6e662bb0f8831d487e386338916f4b5fdba19f76c98c20908ac812d290f654ee/analysis/)\n\n## Acknowledgements/contacts\n\nWe would like to thank the following contributors to this report:\n\nSentrant: Sergei Frankoff\n\nMalwarebytes: [hasherezade](https://blog.malwarebytes.org/author/hasherezade/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2015/2015-08-05 - Who’s Behind Your Proxy- Uncovering Bunitu’s Secrets.pdf"
    ],
    "report_names": [
        "2015-08-05 - Who’s Behind Your Proxy- Uncovering Bunitu’s Secrets.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535535,
    "ts_updated_at": 1743041320,
    "ts_creation_date": 1653713719,
    "ts_modification_date": 1653713719,
    "files": {
        "pdf": "https://archive.orkl.eu/d19e697769d7c51e575278600d4ddfa53ad4be28.pdf",
        "text": "https://archive.orkl.eu/d19e697769d7c51e575278600d4ddfa53ad4be28.txt",
        "img": "https://archive.orkl.eu/d19e697769d7c51e575278600d4ddfa53ad4be28.jpg"
    }
}