{
    "id": "7ae64e86-71fc-40c7-b76b-0139a7ee107e",
    "created_at": "2023-01-12T15:08:08.821298Z",
    "updated_at": "2025-03-27T02:05:37.480245Z",
    "deleted_at": null,
    "sha1_hash": "e8cc218ef7ccadf2dfbcaa1d89421be89686af63",
    "title": "2018-04-17 - Recent findings from CCleaner APT investigation reveal that attackers entered the Piriform network via TeamViewer",
    "authors": "",
    "file_creation_date": "2022-05-29T01:17:32Z",
    "file_modification_date": "2022-05-29T01:17:32Z",
    "file_size": 596829,
    "plain_text": "# Recent findings from CCleaner APT investigation reveal that attackers entered the Piriform network via TeamViewer\n\n**[blog.avast.com/update-ccleaner-attackers-entered-via-teamviewer](https://blog.avast.com/update-ccleaner-attackers-entered-via-teamviewer)**\n\n[Ondrej Vlcek 18 Apr 2018](https://blog.avast.com/author/ondrej-vlcek)\n\nUnrelated to the CCleaner attack, Avast also found ShadowPad samples active in South\nKorea and Russia, logging a financial transaction\n\nToday, I shared new findings from Avast’s continued investigations of the CCleaner APT\n[(Advanced Persistent Threat) at RSA.](https://www.rsaconference.com/events/us18/agenda/sessions/10593-ccleaner-apt-attack-a-technical-look-inside)\n\nLast September, we [disclosed that CCleaner had been targeted by cybercriminals, in order](https://blog.avast.com/progress-on-ccleaner-investigation)\n[to distribute malware via the CCleaner installation file. The modified installation file was](https://www.avast.com/c-malware)\ndownloaded by 2.27 million CCleaner customers worldwide. Thereafter, our threat\nintelligence team has been investigating what happened.\n\n[Since the update we gave at SAS last month, we have made further discoveries about how](https://blog.avast.com/new-investigations-in-ccleaner-incident-point-to-a-possible-third-stage-that-had-keylogger-capacities)\nthe attackers infiltrated the Piriform network and the tactics they used to fly under the radar.\nAs we looked for similarities with other attacks, we also analyzed older versions of\n\n\n-----\n\nShadowPad, the cyber attack platform we had found on four Piriform computers. Our\ninvestigation revealed that ShadowPad had been previously used in South Korea, and in\nRussia, where attackers intruded a computer, observing a money transfer.\n\n## CCleaner attack: How the threat actors got into the Piriform network\n\nTo initiate the CCleaner attack, the threat actors first accessed Piriform’s network on March\n11, 2017, four months before Avast acquired the company, using TeamViewer on a\ndeveloper workstation to infiltrate. They successfully gained access with a single sign-in,\nwhich means they knew the login credentials. While we don’t know how the attackers got\ntheir hands on the credentials, we can only speculate that the threat actors used credentials\nthe Piriform workstation user utilized for another service, which may have been leaked, to\naccess the TeamViewer account.\n\nAccording to the log files, TeamViewer was accessed at 5 AM local time, when the PC was\nunattended, but running. The attackers tried to install two malicious dlls, however, the\nattempts were unsuccessful due to lack of admin rights to the system. On the third try, the\nattackers succeeded to drop the payload, using VBScript, the scripting language developed\nby Microsoft.\n\n_How attackers tried to get into the 1st computer_\n\nThe next day, March 12, 2017, the attackers moved laterally onto a second computer, again\ntargeting an unattended computer outside of work hours (4 AM local time). The attackers\nopened a backdoor through Microsoft’s Remote Desktop Service, delivering a binary and\npayload to the computer’s registry. The payload delivered was an older version of the second\nstage malware, which was delivered to 40 CCleaner users.\n\n_Lateral movement to second computer on March 12_\n\n\n-----\n\nTwo days later, the attackers went back to the first computer, also infecting it with the older\nversion of the second stage malware.\n\n_The_\n\n_attackers moved back to the first computer, infecting it with older version_\n\n_of the second stage malware_\n\nAfter several weeks of apparent inactivity, the next stage of the payload was delivered to the\nfirst infected computer. We believe that the threat actors prepared the malicious binaries\nduring the period of inactivity. The attackers applied several techniques to infiltrate other\ncomputers in the internal network, including using passwords gathered by the keylogger, and\nlogging in with administrative privileges through the Windows Remote Desktop application.\nThe payload delivered was the infamous ShadowPad, which we believe was intended as the\nthird stage of the CCleaner attack. It was delivered as a mscoree.dll library to four computers\nin the Piriform network, including a build server, masking as a .NET runtime library to go\nunnoticed. This library, which was stored on the disk, had a time stamp on it, revealing that\nthe version of ShadowPad we found was compiled on April 4, 2017. This was just eight days\nbefore it was installed on the Piriform computers, meaning it was customized for the attack,\n[which we also described in earlier blog posts in March and](https://blog.avast.com/new-investigations-in-ccleaner-incident-point-to-a-possible-third-stage-that-had-keylogger-capacities) [September.](https://blog.avast.com/additional-information-regarding-the-recent-ccleaner-apt-security-incident)\n\nThe attackers were in the Piriform network five months before they snuck the malicious\npayload into the CCleaner build. Avast acquired Piriform on July 18, 2017 and the first\nCCleaner build with the malicious payload appeared on August 2, 2017. It’s interesting it took\nthem so long before they initiated their attack on CCleaner users.\n\n## ShadowPad active in South Korea and Russia\n\nAfter analyzing the ShadowPad executable from the Piriform network, we looked for similar\nfiles on VirusTotal. We found two samples, one that appeared in South Korea and the other\nin Russia.\n\nThe sample that was uploaded to VirusTotal from South Korea was uploaded on December\n27, 2017. It was created to communicate with CnC servers hosted by Konkuk University in\nSouth Korea, probably on a hacked PC. Based on how the sample was uploaded and the\ninformation included, we think a user uploaded it to VirusTotal, rather than a security\ncompany.\n\n\n-----\n\n**_left: decrypted configuration of the virus showing the IP address used in the attack; image_**\n_credit: Avast_\n\n**_right: Images from Internet search engine Shodan.io, showing the services available on the_**\n_CnC server’s IP address;_ _image credit: Shodan_\n\nThe second ShadowPad executable we found on VirusTotal targeted a computer in Russia\nthat was operated by an organization involved with the distribution of public budgets. One\nsubmission was uploaded with a file name and the second submission was uploaded to\n\n\n-----\n\nVirusTotal from China. The first file was submitted on November 3, 2017, and the second\nthree days later on November 6, 2017.\n\nIn the second submission, we found a 7ZIP file that contained further files, including the\nprevious submission, along with an encrypted log from the keylogger module. We decrypted\nthe log file and found keypresses in various processes, such as from Microsoft Word, Firefox,\nWindows Explorer, and КриптоПро CSP (CryptoPro CSP). The most interesting were logs\nfrom Firefox, where the user completed financial transactions. We also found a contract,\nwhich is also public record, and names of employees involved in these processes.\n\nAn interesting takeaway from the analysis of the ShadowPad version from Russia was that\nShadowPad hasn’t always been modular. In the version from Russia, all modules were\nbundled in one executable, rather than separately stored in the Windows registry, as was the\ncase with the version used for the Piriform attack. The bundled version gave us insights into\na more thorough range of modules the attackers programmed. The attackers didn’t even\nbother to download some of them to the Piriform network; only three of the plugins that were\nused in the attack in Russia were also used for the Piriform attack.\n\n\n-----\n\n_ShadowPad modules used in the Russian attack_\n\nThe oldest malicious executable used in the Russian attack was built in 2014, which means\nthe group behind it might have been spying for years. The specific payment information we\nfound traced by the key logger is public record, however it is likely that the attackers also\naccessed sensitive information.\n\n\n-----\n\n## Cybersecurity needs to become a core part of M&A due diligence\n\nThe examples of ShadowPad in South Korea and Russia re-emphasize that ShadowPad has\nbeen active for a long time, and it is frightening to see how ShadowPad can spy on\ninstitutions and organizations so thoroughly.\n\nIn terms of CCleaner, up to 2.27 million CCleaner consumers and businesses downloaded\nthe infected CCleaner product. The attackers then installed the malicious second stage on\njust 40 PCs operated by high-tech and telecommunications companies. We don’t have proof\nthat a possible third stage with ShadowPad was distributed via CCleaner to any of the 40\nPCs.\n\nFor Avast, there are two key takeaways from the CCleaner attack. First, M&A due diligence\nhas to go beyond just legal and financial matters. Companies need to strongly focus on\ncybersecurity, and for us this has now become one of the key areas that require attention\nduring an acquisition process. Second, the supply chain hasn’t been a key priority for\nbusinesses, but this needs to change. Attackers will always try to find the weakest link, and if\na product is downloaded by millions of users it is an attractive target for them. Companies\nneed to increase their attention and investment in keeping the supply chain secure.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-04-17 - Recent findings from CCleaner APT investigation reveal that attackers entered the Piriform network via TeamViewer.pdf"
    ],
    "report_names": [
        "2018-04-17 - Recent findings from CCleaner APT investigation reveal that attackers entered the Piriform network via TeamViewer.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536088,
    "ts_updated_at": 1743041137,
    "ts_creation_date": 1653787052,
    "ts_modification_date": 1653787052,
    "files": {
        "pdf": "https://archive.orkl.eu/e8cc218ef7ccadf2dfbcaa1d89421be89686af63.pdf",
        "text": "https://archive.orkl.eu/e8cc218ef7ccadf2dfbcaa1d89421be89686af63.txt",
        "img": "https://archive.orkl.eu/e8cc218ef7ccadf2dfbcaa1d89421be89686af63.jpg"
    }
}