{
    "id": "5413d3a0-4b2f-4c0e-8ca5-85c1d0aaade4",
    "created_at": "2023-01-12T15:07:23.882513Z",
    "updated_at": "2025-03-27T02:16:26.124548Z",
    "deleted_at": null,
    "sha1_hash": "ceab67e7e45d3af1b7a79f773a28d4d7ebf75917",
    "title": "2021-12-23 - New Rook Ransomware Feeds Off the Code of Babuk",
    "authors": "",
    "file_creation_date": "2022-05-29T01:20:19Z",
    "file_modification_date": "2022-05-29T01:20:19Z",
    "file_size": 1443733,
    "plain_text": "# New Rook Ransomware Feeds Off the Code of Babuk\n\n**[sentinelone.com/labs/new-rook-ransomware-feeds-off-the-code-of-babuk/](https://www.sentinelone.com/labs/new-rook-ransomware-feeds-off-the-code-of-babuk/)**\n\nJim Walter\n\n**By Jim Walter and Niranjan Jayanand**\n\n[First noticed on VirusTotal on November 26th by researcher Zack Allen, Rook Ransomware](https://twitter.com/teachemtechy/status/1464317136944435209?s=20)\ninitially attracted attention for the operators’ rather unorthodox self-introduction, which stated\nthat “We desperately need a lot of money” and “We will stare at the internet”.\n\n\n-----\n\nThese odd pronouncements prompted some mirth on social media, but they were followed a\nfew days later by more serious news. On November 30th, Rook claimed its first victim: a\nKazkh financial institution from which the Rook operators had stolen 1123 GB of data,\naccording to the gang’s victim website. Further victims have been claimed since then.\n\nIn this post, we offer the first technical write up of the Rook ransomware family, covering both\nits main high-level features and its ties to the Babuk codebase.\n\n## Technical Details\n\nRook ransomware is primarily delivered via a third-party framework, for example Cobalt\nStrike; however, delivery via phishing email has also been reported in the wild.\n\n\n-----\n\nIndividual samples are typically UPX packed, although alternate packers/crypters have been\nobserved such as VMProtect.\n\nUpon execution, Rook samples pop a command window, with differing output displayed. For\nexample, some versions show the output path for `kph.sys (a component of Process`\nHacker), while others display inaccurate information around the use of ADS (Alternate Data\nStreams).\n\nFalse ADS message\n\nRook\n\ndropping kph.sys\nThe ransomware attempts to terminate any process that may interfere with encryption.\nInterestingly, we see the `kph.sys driver from Process Hacker come into play in process`\ntermination in some cases but not others. This likely reflects the attacker’s need to leverage\nthe driver to disable certain local security solutions on specific engagements.\n\nThere are numerous process names, service names and folder names included in each\nsample’s configuration. For example, in sample\n```\n19CE538B2597DA454ABF835CFF676C28B8EB66F7, the following processes, services and\n\n```\nfolders are excluded from the encryption process:\n\n**Processes names skipped:**\n\n\n-----\n\n```\nsql.exe\noracle.exe\nocssd.exe\ndbsnmp.exe\nvisio.exe\nwinword.exe\nwordpad.exe\nnotepad.exe\nexcel.exe\nonenote.exe\noutlook.exe\nsynctime.exe\nagntsvc.exe\nisqlplussvc.exe\nxfssvccon.exe\nmydesktopservice.exe\nocautoupds.exe\nencsvc.exe\nfirefox.exe\ntbirdconfig.exe\nmydesktopqos.exe\nocomm.exe\ndbeng50.exe\nsqbcoreservice.exe\ninfopath.exe\nmsaccess.exe\nmspub.exe\npowerpnt.exe\nsteam.exe\nthebat.exe\nthunderbird.exe\n\n```\n**Service names terminated:**\n\n\n-----\n\n```\nmemtas\nmepocs\nveeam\nbackup\nGxVss\nGxBlr\nGxFWD\nGxCVD\nGxCIMgr\nDefWatch\nccEvtMgr\nccSetMgr\nSavRoam\nRTVscan\nQBFCService\nQBIDPService\nIntuit.QuickBooks.FCS\nQBCFMonitorService\nAcrSch2Svc\nAcronisAgent\nCASAD2DWebSvc\nCAARCUpdateSvc\n\n```\n**Folders names skipped:**\n```\nProgram Files\nProgram Files (x86)\nAppData\nWindows\nWindows.old\nTor Browser\nInternet Explorer\nGoogle\nOpera\nOpera Software\nMozilla\n\n```\n**File names skipped:**\n```\nautorun.inf\nboot.ini\nbootfont.bin\nbootsect.bak\nbootmgr\nbootmgr.efi\nbootmgfw.efi\ndesktop.ini\niconcache.db\nntldr\nntuser.dat\nntuser.dat.log\nntuser.ini\nthumbs.db\n\n```\n\n-----\n\nAs with most modern ransomware families, Rook will also attempt to delete volume shadow\ncopies to prevent victims from restoring from backup. This is achieved via `vssadmin.exe .`\n\nRook & vssadmin.exe as seen in SentinelOne console\n\nThe following syntax is used:\n```\nvssadmin.exe delete shadows /all /quiet\n\n```\nEarly variants of Rook were reported to have used a `.TOWER extension. All current variants`\nseen by SentinelLabs use the `.ROOK extension.`\n```\n.ROOK extension on affected files\n\n```\nIn the samples we analyzed, no persistence mechanisms were observed, and after the\nmalware runs through its execution, it cleans up by deleting itself.\n\n## Babuk Overlaps\n\nThere are a number of code similarities between Rook and Babuk. Based on the samples\navailable so far, this appears to be an opportunistic result of the various Babuk source-code\nleaks we have seen over 2021, including leaks of both the compiled builders as well as the\n\n\n-----\n\nactual source. On this basis, we surmise that Rook is just the latest example of an apparent\nnovel ransomware capitalizing on the ready availability of Babuk source-code.\n\nBabuk and Rook use `EnumDependentServicesA API to retrieve the name and status of`\neach service that depends on the specified service before terminating. They enumerate all\nservices in the system and stop all of those which exist in a hardcoded list in the malware.\nUsing `OpenSCManagerA API, the code gets the Service Control Manager, gets the handle`\nand then enumerates all services in the system.\n\n\n-----\n\nRook enumerates all\n\n\nservices\n\n\n-----\n\n```\nVeeam\nBackup\nGxVss\nGxBlr\nGxFWD\nGxCVD\nGXCIMgr\nDefWatch\nccEvtMgr\nccSetMgr\nSavRoam\nRTVscan\nQBFCService\nQBIDPService\nIntuit.QuickBooks.FCS\nQBFCMonitorService\nYooBAckup\nYooIT\nZhudongfangyu\nSophos\nStc_raw_agent\nVSNAPVSS\nVeeamTransportSvc\nVeeamDeploymentService\nVeeamNFSSvc\nVeeam\nPDVFSService\nBackupExecVSSProvider\nBackupExecAgentAccelerator\nBackupExecAgentBrowser\nBackupExecDiveciMediaService\nBackupExecJobEngine\nBackupExecManagementService\nBackupExecRPCServiceAcrSch25vc\nAcronisAgent\nCASAD2DWebSvc\nCAARCUpdateSvc\n\n```\n\n-----\n\nRook service termination\n\nIn addition, both Rook and Babuk use the functions `CreateToolhelp32Snapshot,`\n```\nProcess32FirstW, Process32NextW, OpenProcess, and TerminateProcess to\n\n```\nenumerate running processes and kill any found to match those in a hardcoded list.\n\n\n-----\n\nBabuk and Rook share the same process exclusion list\nAlso similar is the use of the Windows Restart Manager API to aid with process termination,\nwhich includes processes related to MS Office products and the popular gaming platform\nSteam.\n\n\n-----\n\nBabuk\n\nProcess termination\nWe also noted overlap with regards to some of the environmental checks and subsequent\nbehaviors, including the removal of Volume Shadow Copies.\n\nBoth Babuk and Rook check if the sample is executed in a 64-bit OS, then delete the\nshadow volumes of the user machine. The code flows to\n```\nWow64DisableWow64FsRedirection to disable file system redirection before calling\nShellExecuteW to delete shadow copies.\n\n```\nBabuk VSS deletion (similar to Rook)\nBabuk and Rook implement similar code for enumerating local drives. Rook checks for the\nlocal drives alphabetically as shown below.\n\n\n-----\n\nEnumerating local drives\n\n## The Rook Victim Website\n\nLike other recent ransomware varieties, Rook embraces a dual-pronged extortion approach:\nan initial demand for payment to unlock encrypted files, followed by public threats via the\noperators’ website to leak exfiltrated data should the victim fail to comply with the ransom\ndemand.\n\n\n-----\n\nRook’s welcome\n\nmessage (TOR-based website)\nThis TOR-based site is used to name victims and host any data should the victim decide not\nto cooperate. Rook also uses the site to openly boast of having the “latest vulnerability\ndatabase” and “we can always penetrate the target system” as well as their desire for\nsuccess: “We desperately need a lot of money”.\n\nThese statements appear under the heading of “why us?” and could be intended to attract\naffiliates as well as convince victims that they mean business.\n\n\n-----\n\nAbout Rook (TOR-based website)\n\nAt the time of writing, three companies have been listed on the Rook blog, spanning different\nindustries.\n\n\n-----\n\nExpanded victim data\n\n## Conclusion\n\nGiven the [economics of ransomware – high reward for low risk – and the ready availability of](https://www.sentinelone.com/blog/6-reasons-why-ransomware-is-not-going-to-be-stopped/)\nsource code from leaks like Babuk, it’s inevitable that the proliferation of new ransomware\ngroups we’re seeing now is only going to continue. Rook may be here today and gone\ntomorrow, or it could stick around until the actors behind it decide they’ve had enough (or\nmade enough), but what is certain is that Rook won’t be the last malware we see feeding off\nthe leaked Babuk code.\n\n\n-----\n\n[Add that to the incentive provided by recent vulnerabilities such as log4j2 that can allow](https://www.sentinelone.com/blog/cve-2021-44228-staying-secure-apache-log4j-vulnerability/)\ninitial access without great technical skill, and enterprise security teams have a recipe for a\nbusy year ahead. Prevention is critical, along with well-documented and tested DRP and\nBCP procedures. All SentinelOne customers are protected from Rook ransomware.\n\n## Indicators of Compromise\n\n**SHA1**\n\n104d9e31e34ba8517f701552594f1fc167550964\n\n19ce538b2597da454abf835cff676c28b8eb66f7\n\n36de7997949ac3b9b456023fb072b9a8cd84ade8\n\n**SHA256**\n\nf87be226e26e873275bde549539f70210ffe5e3a129448ae807a319cbdcf7789\n\nc2d46d256b8f9490c9599eea11ecef19fde7d4fdd2dea93604cee3cea8e172ac\n\n96f7df1c984c1753289600f7f373f3a98a4f09f82acc1be8ecfd5790763a355b\n\n**MITRE ATT&CK**\n\n[T1027.002 – Obfuscated Files or Information: Software Packing](https://attack.mitre.org/techniques/T1027/002/)\n\n[T1007 – System Service Discovery](https://attack.mitre.org/techniques/T1007/)\n\n[T1059 – Command and Scripting Interpreter](https://attack.mitre.org/techniques/T1059/)\n\n[TA0010 – Exfiltration](https://attack.mitre.org/tactics/TA0010/)\n\n[T1082 – System Information Discovery](https://attack.mitre.org/techniques/T1082/)\n\n[T1490 – Inhibit System Recovery](https://attack.mitre.org/techniques/T1490/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-12-23 - New Rook Ransomware Feeds Off the Code of Babuk.pdf"
    ],
    "report_names": [
        "2021-12-23 - New Rook Ransomware Feeds Off the Code of Babuk.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673536043,
    "ts_updated_at": 1743041786,
    "ts_creation_date": 1653787219,
    "ts_modification_date": 1653787219,
    "files": {
        "pdf": "https://archive.orkl.eu/ceab67e7e45d3af1b7a79f773a28d4d7ebf75917.pdf",
        "text": "https://archive.orkl.eu/ceab67e7e45d3af1b7a79f773a28d4d7ebf75917.txt",
        "img": "https://archive.orkl.eu/ceab67e7e45d3af1b7a79f773a28d4d7ebf75917.jpg"
    }
}