{
    "id": "a89ffd31-6b07-48ed-85c1-fa681b805af7",
    "created_at": "2022-10-25T16:48:16.262767Z",
    "updated_at": "2025-03-27T02:17:17.138489Z",
    "deleted_at": null,
    "sha1_hash": "d46f8f9f955dae7486b9c9b96c533ebb56a739b9",
    "title": "“绿斑”行动——持续多年的攻击",
    "authors": "",
    "file_creation_date": "2018-09-21T09:43:54Z",
    "file_modification_date": "2018-09-21T09:43:54Z",
    "file_size": 3824429,
    "plain_text": "# “绿斑”行动——持续多年的攻击\n\n安天安全研究与应急处理中心（Antiy CERT）\n\n初稿完成时间：2014 年 **09 月** **15 日** **08 时** **00 分**\n\n首次发布时间：2018 年 **09 月** **19 日** **18 时** **30 分**\n\n本版更新时间：2018 年 **09 月** **19 日** **01 时** **05 分**\n\n\n扫二维码获取最新版报告\n\n\n-----\n\n# 目 录\n\n**概述 ...................................................................................................................................................................................... 1**\n\n1.1 疑似的早期（2007 年）攻击活动 ......................................................................................................................... 1\n\n1.2 2011-2015 年攻击活动 ............................................................................................................................................. 2\n\n1.3 近期的部分攻击活动（2017 年） ......................................................................................................................... 4\n\n**2** **攻击手法分析：通过定向社工邮件传送攻击载荷 ....................................................................................................... 6**\n\n2.1 典型案例 .................................................................................................................................................................. 6\n\n2.2 社工技巧分析 ........................................................................................................................................................ 10\n\n**3** **攻击载荷分析：漏洞、后门及可执行文件 ................................................................................................................. 10**\n\n3.1 CVE-2012-0158 漏洞利用 ..................................................................................................................................... 10\n\n3.2 CVE-2014-4114 漏洞利用 ..................................................................................................................................... 14\n\n3.3 CVE-2017-8759 漏洞利用 ..................................................................................................................................... 15\n\n3.4 相关载荷分析 ........................................................................................................................................................ 18\n\n**4** **样本关联性分析 ............................................................................................................................................................ 29**\n\n4.1 多案例横向关联 .................................................................................................................................................... 29\n\n4.2 域名关联 ................................................................................................................................................................ 31\n\n4.3 IP 地址关联 ............................................................................................................................................................ 32\n\n4.4 恶意代码之间关联性 ............................................................................................................................................ 32\n\n**5** **组织关联性分析 ............................................................................................................................................................ 35**\n\n5.1 代码相似性 ............................................................................................................................................................ 35\n\n5.2 域名使用偏好 ........................................................................................................................................................ 35\n\n5.3 C2 的 IP 地址关联性 .............................................................................................................................................. 36\n\n5.4 地理位置特性 ........................................................................................................................................................ 36\n\n**6** **小结 ................................................................................................................................................................................ 36**\n\n**附录一：关于安天 ............................................................................................................................................................ 39**\n\n\n-----\n\n**绿斑** **行动——持续多年的攻击**\n\n## 概述\n\n在过去的数年时间里，安天始终警惕地监测、分析、跟踪着各种针对中国的 APT 攻击活动，并谨慎地\n\n披露了“海莲花”(APT-TOCS)、“白象”（White Elephant）、“方程式”（Equation）等攻击组织的活动或攻击\n\n装备分析，同时也对更多的攻击组织和行动形成了持续监测分析成果。本报告主要分析了某地缘性攻击组织\n\n在 2015 年前的攻击活动，安天以与该地区有一定关联的海洋生物作为了该攻击组织的名字——“绿斑”\n\n（GreenSpot）。为提升中国用户的安全意识，推动网络安全与信息化建设，安天公布这份报告。\n\n综合来看，“绿斑”组织的攻击以互联网暴露目标和资产为攻击入口，采用社工邮件结合漏洞进行攻击，\n\n其活跃周期可能长达十年以上。\n\n### 1.1 疑似的早期（2007 年）攻击活动\n\n在 2007 年，安天对来自该地区的网络入侵活动进行了应急响应，表 1-1 是在相关被攻击的服务器系统\n\n上所提取到的相关攻击载荷的主要行为和功能列表。\n\n表 0-1 早期“绿斑”组织攻击活动相关载荷及功能列表\n\n**原始文件名** **主要行为** **功能描述**\n\nnc.exe 开放端口，接收远程指令在本地执行。 使用TCP 或UDP 协议的网络连接建立一个shell，通过\n\n网络发送命令对主机进行控制。\n\nmt1.exe 根据输入参数完成各类系统管理功 综合行命令工具，如获取系统信息、进程服务管理、账户\n\n能。 管理、网络信息查看等。\n\nhttp.exe 开放80 端口，提供HTTP 服务。 提供HTTP 访问服务，为攻击者提供收集的文件下载的服\n\n务。\n\nh.exe 与http.exe 类似，提供http 服务。 一款名为Tiny HTTP Server 的公开工具，可以隐藏的提\n\n供HTTP 服务。\n\nrar.exe 根据输入命令参数，遍历磁盘文件打 即RAR 压缩软件的绿色版本，通过命令行将文件压缩打\n\n包指定的文件。 包，方便攻击者披露收集文件。\n\nhport.exe 添加服务启动项，完成载荷的自启动。 释放衍生恶意载荷并完成对目标主机的持久化驻留。\n\nkeylog.exe 收集键盘输入并写入指定文件。 一款通用键盘记录工具。\n\nspooler.exe 以服务方式自启动，监控系统磁盘文 监控硬盘文件列表的工具。\n\n件列表变化。\n\n这些工具多数为开源或免费工具，从而形成了攻击方鲜明的 DIY 式的作业风格。由于这些工具多数不\n\n是专门为恶意意图所编写的恶意代码，有的还是常见的网管工具，因此反而起到了一定的“免杀”效果。但\n\n**©安天版权所有** **欢迎无损转载** **第1 页**\n\n|原始文件名 主要行为 功能描述|Col2|Col3|\n|---|---|---|\n|nc.exe|开放端口，接收远程指令在本地执行。|使用TCP 或UDP 协议的网络连接建立一个shell，通过 网络发送命令对主机进行控制。|\n|mt1.exe|根据输入参数完成各类系统管理功 能。|综合行命令工具，如获取系统信息、进程服务管理、账户 管理、网络信息查看等。|\n|http.exe|开放80 端口，提供HTTP 服务。|提供HTTP 访问服务，为攻击者提供收集的文件下载的服 务。|\n|h.exe|与http.exe 类似，提供http 服务。|一款名为Tiny HTTP Server 的公开工具，可以隐藏的提 供HTTP 服务。|\n|rar.exe|根据输入命令参数，遍历磁盘文件打 包指定的文件。|即 RAR 压缩软件的绿色版本，通过命令行将文件压缩打 包，方便攻击者披露收集文件。|\n|hport.exe|添加服务启动项，完成载荷的自启动。|释放衍生恶意载荷并完成对目标主机的持久化驻留。|\n|keylog.exe|收集键盘输入并写入指定文件。|一款通用键盘记录工具。|\n|spooler.exe|以服务方式自启动，监控系统磁盘文 件列表变化。|监控硬盘文件列表的工具。|\n\n\n-----\n\n**绿斑** **行动——持续多年的攻击**\n\n同时，这种 DIY 作业，并无 Rootkit 技术的掩护，给系统环境带来的变化较为明显，作业粒度也较为粗糙。\n\n同时只能用于控制可以被攻击跳板直接链接的节点，而无法反向链接。和其他一些 APT 攻击中出现的自研\n\n木马、商用木马相比，是一种相对低成本、更多依靠作业者技巧的攻击方式。\n\n图 0-1 早期“绿斑”组织攻击活动相关载荷调用关系图\n\n这些工具可以在被入侵环境中形成一个作业闭环。攻击者使用网络渗透手段进入目标主机后，向目标主\n\n机上传表 1-1 中的多种攻击载荷，利用持久化工具达成开机启动效果，实现长期驻留；通过 NC 开启远程\n\nShell 实现对目标主机远程命令控制；调用 Mt1.exe 获取系统基本信息和进一步的管理；同时攻击者可以通\n\n过 Spooler.exe 形成磁盘文件列表并记录、通过 keylog.exe 收集键盘输入并记录、通过 Rar.exe 收集指定的文\n\n件并打包、通过 HTTP.exe 开启 HTTP 服务，即可远程获取全盘文件列表，获取用户击键记录，回传要收集\n\n的文件和日志。\n\n我们倾向认为，2007 年前后，相关攻击组织总体上自研能力有限，对开源和免费工具比较依赖，喜好\n\n行命令作业。同时，作业风格受到类似 Coolfire 式的早期网络渗透攻击教程的影响较大。目前我们无法确认\n\n这一攻击事件与我们后面命名的“绿斑”组织是同一个组织，但可以确定其来自同一个来源方向。\n\n### 1.2 2011-2015 年攻击活动\n\n从时间上来看，自 2010 年以后，该地区组织攻击能力已经有所提升，善于改良 1day 和陈旧漏洞进行利\n\n用，能够对公开的网络攻击程序进行定制修改，也出现了自研的网络攻击装备。2010 年以后相关活动明显\n\n增多、攻击能力提升较快。\n\n**©安天版权所有** **欢迎无损转载** **第2 页**\n\n\n-----\n\n**绿斑** **行动——持续多年的攻击**\n\n“绿斑”组织主要针对中国政府部门和航空、军事相关的科研机构进行攻击。该组织通过鱼叉式钓鱼邮\n\n件附加漏洞文档或捆绑可执行文件进行传播，主要投放 RAT（Remote Administration Tool，远程管理工具）\n\n程序对目标主机进行控制和信息窃取，其典型攻击手法和流程是以邮件为载体进行传播，邮件附件中包含恶\n\n意文档，文档以 MHT 格式居多（MHT 是 MIME HTML 的缩写，是一种用来保存 HTML 文件的格式），该\n\n文档打开后会释放并执行可执行载荷。作为迷惑用户的一种方法，嵌入在 MHT 中的一份起到欺骗作用的正\n\n常的文档文件也会被打开显示，攻击过程图 1-2 所示：\n\n图 0-2“绿斑”组织活动攻击流程\n\n通过人工分析结合安天追影威胁分析系统及安天分析平台进行关联分析，我们对其攻击目标、攻击者采\n\n用的 IP 和常见的手法进行了梳理。该组织利用漏洞的文件是不常见的附件文件格式，相关攻击技术和手法\n\n也是经过长期准备和试验的。安天基于原始线索对该组织进行了全面跟踪、关联、分析，最终获得了近百条\n\nIoC（信标）数据。通过对事件和样本的整体分析，我们梳理了该组织在 2011-2014 年的部分活动时间轴。\n\n**©安天版权所有** **欢迎无损转载** **第3 页**\n\n\n-----\n\n**绿斑** **行动——持续多年的攻击**\n\n图 0-3 “绿斑”组织 **2011-2014 攻击活动时间轴**\n\n### 1.3 近期的部分攻击活动（2017 年）\n\n“绿斑”组织在 2015 年后继续活跃，我们在 2017 年监测到该组织建立了一个新的传播源，该次活动的\n\n载荷都存储在同一个 WEB 服务器上，每一个攻击流程内的载荷都按照目录存放，其攻击流程是首先传播含\n\n有漏洞的 Office 文档，通过漏洞文档下载执行恶意载荷（EXE），随后通过 C2 对目标主机进行远程控制，\n\n具体攻击流程参见图 1-4。\n\n**©安天版权所有** **欢迎无损转载** **第4 页**\n\n\n-----\n\n**绿斑** **行动——持续多年的攻击**\n\n开始\n\n传播包含漏洞OFFICE文档，文档打开远程\n\nTXT文件(SOAP XML)，解析时漏洞触发。\n\nTXT文件解析URL，下载并执行指定hta文件\n\nhta文件嵌入了VBScript脚本，利用\nPowerShell，下载执行指定exe可执行文件\n\nEXE文件从指定网址下载shellcode(PI)，\n并对shellcode进行解密，然后再创建线程\n\n运行此shellcode\n\n接收控制指令\n\n远程服务器\n\n图 0-4 最新活动攻击流程\n\n该 WEB 服务器上存放了多个不同配置的恶意脚本和可执行文件，一个目录下是一组攻击样本，最终运\n\n行的 Poison Ivy ShellCode（Poison Ivy 是一个远程管理工具）都会连接一个单独 C2 地址，图 1-5 中红色的\n\n域名（pps.*.com）是与 2011-2015 年活动相关联的 C2 域名。\n\n**©安天版权所有** **欢迎无损转载** **第5 页**\n\n\n-----\n\n**绿斑** **行动——持续多年的攻击**\n\n图 0-5 传播源服务器样本部署及 **C&C 关系图**\n\n## 2 攻击手法分析：通过定向社工邮件传送攻击载荷\n\n### 2.1 典型案例\n\n针对“绿斑”组织 2011-2015 年间的攻击活动中，安天通过监测发现和关联分析，梳理出了数十起事件\n\n和载荷的关联关系。通过对典型案例的基本信息和诱饵文件等进行分析，我们可以看出“绿斑”组织多采用\n\n通过定向社工邮件传送攻击载荷，攻击载荷有两种：一种是捆绑型 PE 恶意代码，在被攻击者打开执行后，\n\n其会打开嵌入在 PE 中的欺骗收件人的“正常”文档文件；另一种是格式攻击文档，利用漏洞 CVE-2012-0158\n\n来释放并执行可执行文件，同时打开欺骗收件人的“正常”文档文件。但在两种攻击方式中，所释放的可执\n\n行文件路径和名称相同，除部分案例采用%TEMP%路径外，其他均为 C:\\Documents and Settings\\All Users\\\n\n「开始」菜单\\程序\\启动\\update.exe，来达成开机执行的持久化效果，从释放路径、文件名称可以看出这些样\n\n本是具有关联性的（具体分析参见 4.4 节）。从时间上来看，使用捆绑型 PE 恶意代码的攻击晚于漏洞文档，\n\n这有可能是在利用漏洞文档攻击无效后，才使用了这种虽然简单粗暴但可能最有效的方式。\n\n**©安天版权所有** **欢迎无损转载** **第6 页**\n\n\n-----\n\n**2.1.1** **案例** **1**\n\n**标签**\n\n**恶意文档**\n\n**释放载荷**\n\n序\n\n**2.1.2** **案例** **2**\n\n**标签**\n\n国家\n\n**恶意文档** 2012\n\n告\n\n**释放载荷** Users\\\n\n单\n\n**2.1.3** **案例** **3**\n\n|标签|文件名|病毒名|\n|---|---|---|\n|恶意文档|通知.doc|Trojan[Exploit]/MSWord.CVE- 2012-0158|\n|释放载荷|C:\\Documents and Settings\\All Users\\ 「开始」菜单\\程 序 \\ 启 动 \\update.exe|Trojan[Backdoor]/Win32.Poison|\n\n\n表 2-1 文件基本信息\n\n**病毒名**\n\n****** 局\n\n5 号公\n\n2012-0158\n\nC:\\Documents and\n\n「开始」菜\n\n\\ 启动 \\\n\n表 2-2 文件基本信息\n\n\n**绿斑** **行动——持续多年的攻击**\n\n图 2-1 释放的欺骗文档（乱码）\n\n图 2-2 释放的欺骗文档\n\n|标签|文件名|病毒名|\n|---|---|---|\n|恶意文档|国 家 ****** 局 2012 年第5 号公 告.doc|Trojan[Exploit]/MSWord.CVE- 2012-0158|\n|释放载荷|C:\\Documents and Settings\\All Users\\「开始」菜 单\\ 程序\\ 启动\\ update.exe|Trojan[Backdoor]/Win32.Poison|\n\n|标签|文件名|病毒名|\n|---|---|---|\n|恶意文档|两会重要发布报告.doc 海底观测网试验系统项目第 四次工作会会议纪要.doc 安全重大问题咨询会议纪要 0206.doc|Trojan[Exploit]/MSW ord.CVE-2012-0158|\n|释放载荷|C:\\Documents and Settings\\All Users\\「开始」菜 单\\程序\\启动\\update.exe|Trojan[Backdoor]/Wi n32.Poison|\n\n\n表 2-3 文件基本信息 图 2-3 释放的欺骗文档\n\n**©安天版权所有** **欢迎无损转载** **第7 页**\n\n\n-----\n\n**绿斑** **行动——持续多年的攻击**\n\n另外值得注意的地方是图 2-3 中相关文字内容为从“全国人民代表大会网站”（文档内容出处：\n\n“http://www.npc.gov.cn/npc/xinwen/node_12435.htm”2013 年的网页内容，目前网页内容已更新。）页面直接\n\n复制粘贴的内容。\n\n**2.1.4** **案例** **4**\n\n|标签|文件名|病毒名|\n|---|---|---|\n|恶意文档|重要通知.doc|Trojan[Exploit]/MSWord.CVE-2012- 0158|\n|释放载荷|C:\\Documents and Settings\\All Users\\「开始」 菜单\\程序\\启 动\\update.exe|Trojan[Backdoor]/Win32.Gh0st|\n\n\n**2.1.5** **案例** **5**\n\n\n表 2-4 文件基本信息\n\n**病毒名**\n\n关于推荐第十\n\n三届中国青年\n\nTrojan/Win32.Agent\n\n科技奖候选人\n\n.exe\n\nC:\\Documents\n\nand Settings\\All\n\n「开始」\n\n程序\\启动\n\n表 2-5 文件基本信息\n\n\n图 2-4 释放的欺骗文档\n\n图 2-5 释放的欺骗文档\n\n|标签|文件名|病毒名|\n|---|---|---|\n|捆绑型PE 恶意代码|关于推荐第十 三届中国青年 科技奖候选人 的通知.exe|Trojan/Win32.Agent|\n|释放载荷|C:\\Documents and Settings\\All Users\\「开始」 菜单\\程序\\启动 \\update.exe|Trojan[Backdoor]/Win32.HttpBots|\n\n\n**©安天版权所有** **欢迎无损转载** **第8 页**\n\n\n-----\n\n**2.1.6** **案例** **6**\n\n**标签**\n\n件\n\n**恶意文档**\n\n**释放载荷**\n\n**2.1.7** **案例** **7**\n\n**标签**\n\n**捆绑型** **P**\n\n**E 恶意代**\n\n**码**\n\n**释放载荷**\n\nexe\n\n**2.1.8** **案例** **8**\n\n\n**绿斑** **行动——持续多年的攻击**\n\n**病毒名**\n\n中国亚洲太平洋学会年会文\n\nTrojan[Exploit]/\n\nMSWord.CVE\n年工作会第一轮通知及相关\n\n2012-0158\n\nV2.0.doc\n\nC:\\Documents and Settings\\All\n\nTrojan[Backdoor]\n\n「开始」菜单 \\ 程序 \\ 启动\n\n/Win32.ZXShell\n\n表 2-6 文件基本信息 图 2-6 释放的欺骗文档（出错）\n\n**病毒名**\n\n年学术年会\n\nTrojan/Win32.Agent\n\n.exe\n\nC:\\Documents an\n\nd Settings\\<USE\n\nR>~1\\LOCALS~1 Trojan[Backdoor]/Win32.ZXShell\n\n\\Temp\\windowsvc.\n\n图 2-7 释放的欺骗文档（出错）\n\n表 2-7 文件基本信息\n\n|标签|文件名|病毒名|\n|---|---|---|\n|恶意文档|2013 中国亚洲太平洋学会年会文 件.doc 2014 年工作会第一轮通知及相关 工作要求V2.0.doc|Trojan[Exploit]/ MSWord.CVE- 2012-0158|\n|释放载荷|C:\\Documents and Settings\\All Users\\「开始」菜单\\程序\\启动 \\update.exe|Trojan[Backdoor] /Win32.ZXShell|\n\n|标签|文件名|病毒名|\n|---|---|---|\n|捆绑型 P E 恶意代 码|2014 年学术年会 征集论文.exe|Trojan/Win32.Agent|\n|释放载荷|C:\\Documents an d Settings\\<USE R>~1\\LOCALS~1 \\Temp\\windowsvc. exe|Trojan[Backdoor]/Win32.ZXShell|\n\n|标签|文件名|病毒名|\n|---|---|---|\n|捆绑型 P E 恶意代 码|中国国际问题研 究学会推荐表.ex e|Trojan/Win32.Agent|\n|释放载荷|C:\\Documents an d Settings\\<USE R>~1\\LOCALS~1 \\Temp\\explories.e xe|Trojan[Backdoor]/Win32.ZXShell|\n\n\n表 2-8 文件基本信息\n\n\n图 2-8 释放的欺骗文档信息\n\n\n**©安天版权所有** **欢迎无损转载** **第9 页**\n\n\n-----\n\n**2.1.9** **案例** **9**\n\n\n**绿斑** **行动——持续多年的攻击**\n\n图 2-9 释放的欺骗文档信息\n\n|标签|文件名|病毒名|\n|---|---|---|\n|捆绑型 P E 恶意代 码|科研项目经费 自查.exe|Trojan/Win32.Agent|\n|释放载荷|C:\\Documents and Settings\\All Users「\\ 开始」菜 单\\ 程序\\ 启动 \\update.exe|Trojan[Backdoor]/Win32. Poison|\n\n\n表 2-9 文件基本信息\n\n### 2.2 社工技巧分析\n\n“绿斑”攻击组织主要针对被攻击者的职业、岗位、身份等定制文档内容，伪装成中国政府的公告、学\n\n会组织的年会文件、相关单位的通知、以及被攻击者可能感兴趣的政治、经济、军事、科研、地缘安全等内\n\n容，其所使用的欺骗性文档多数下载自中国相关部委机构、学会的网站。\n\n## 3 攻击载荷分析：漏洞、后门及可执行文件\n\n### 3.1 CVE-2012-0158 漏洞利用\n\nCVE-2012-0158 是一个文档格式溢出漏洞，格式溢出漏洞的利用方式是在正常的文档中插入精心构造\n\n的恶意代码，从表面上看其是一个正常的文档，很难引起用户的怀疑，因此经常被用于 APT 攻击。CVE\n2012-0158 漏洞是各种 APT 攻击中迄今为止使用频度最高的。利用该漏洞的载体通常是 RTF 格式的文件，\n\n其内部数据以十六进制字符串形式保存。\n\n**3.1.1** **由** **RTF 到** **MHT 的高级对抗**\n\n传统的 CVE-2012-0158 漏洞利用格式主要以 RTF 为主，而该组织则使用了 MHT 格式，这种格式同样\n\n可以触发漏洞，而且在当时一段时间内可以躲避多种杀毒软件的查杀。\n\n**©安天版权所有** **欢迎无损转载** **第10 页**\n\n\n-----\n\n**绿斑** **行动——持续多年的攻击**\n\n图 3-1 RTF 与 **MHT 文件格式对比**\n\n如果使用 RTF 文件格式构造可触发漏洞的文件，在解码后会在文件中出现 CLSID（CLSID 是指 Windows\n\n系统对于不同的应用程序、文件类型、OLE 对象、特殊文件夹以及各种系统组件分配一个唯一表示它的 ID\n\n代码），而新的利用方式使用 MHT 文件格式，CLSID 会出现在 MHT 文件中，由于之前的 RTF 溢出格式嵌\n\n套 DOC 文档（如图 3-2，红框中是 DOC 文档文件头），CLSID 存放于嵌套的 DOC 文档里（如图 3-3，红框\n\n中是 CLSID，部分采用了网络字节序，部分采用了主机字节序）。\n\n**©安天版权所有** **欢迎无损转载** **第11 页**\n\n\n-----\n\n**绿斑** **行动——持续多年的攻击**\n\n图 3-2 以 **RTF 为载体的溢出文件**\n\n图 3-3 以 **RTF 为载体的溢出文件**\n\nMHT 文件格式的 CLSID 不会存放在嵌套的 DOC 里，而是直接在 MHT 文件中（如图 3-4，红框中所\n\n示），这样可以逃避大部分安全软件的检测，而且在 MHT 中编码格式也发生了变化，因此如果使用以前根\n\n据 RTF 文件编写的 CVE-2012-0158 检测程序则会失效。\n\n**©安天版权所有** **欢迎无损转载** **第12 页**\n\n\n-----\n\n**绿斑** **行动——持续多年的攻击**\n\n图 3-4 案例 **6 涉及的** **MHT 文件**\n\nMHT 文件的主要功能是将一个离线网页的所有文件保存在一个文件中，方便浏览。将文件后缀修改\n\n为.doc 后，Microsoft Word 是可以正常打开的。\n\n该文件可以分为三个部分：第一部分是一个网页；第二部分是一个 base64 编码的数据文件，名为\n\n“ocxstg001.mso”，该文件解码后为一个复合式文档即 DOC 文档；第三部分的数据是二进制文件。\n\n在第一部分我们发现了一段这样的代码，该代码描述了第一部分和第二部分的关系也是导致漏洞触发\n\n的关键：\n\n\n<p class=3DMsoNormal><span lang=3DEN-US><object\n\nclassid=3D\"CLSID:*********-11D1-B16A-00C0F0283628\" id=3DShockwaveFlash1\n\nwidth=3D9 height=3D9 data=3D\"Doc1.files/ocxstg001.mso\"></object></span></p>\n\n\n这段代码大致表示当网页加载的时候同时加载一个 COM 控件去解释第二部分的数据。该控件的 CLSID\n\n是{**********-11D1-B16A-00C0F0283628}，经过查询该控件便是 MSCOMCTL.OCX.。当时已知的与该控\n\n**©安天版权所有** **欢迎无损转载** **第13 页**\n\n\n-----\n\n**绿斑** **行动——持续多年的攻击**\n\n件有关的最新漏洞是 CVE-2012-0158，因此可以确定这三个案例是通过精心构造 MHT 文件，利用漏洞 CVE\n2012-0158 来执行，从而实现可执行文件的释放和执行。\n\n**3.1.2** **值得关注漏洞载荷免杀技巧的利用**\n\n“绿斑”组织高频使用 MHT 漏洞格式文档的传播利用时间主要在 2013 年 5 月之前，这是一个高度值\n\n得关注的信息。我们基于对某个著名的第三方威胁情报源利用 CVE-2012-0158 漏洞并采用 MHT 文件格式\n\n的恶意代码数据进行了相关统计。\n\n1202013年1月2013年2月2013年3月2013年4月2013年5月2013年6月2013年7月2013年8月2013年9月2013年10月\n\n100\n\n80\n\n60\n\n40\n\n20\n\n0\n\n图 3-5 安天捕获部分“绿斑”免杀样本（红色）与 **MHT 漏洞格式文档（黄色）大量出现时间的对比**\n\n从图 3-5 中我们可以看到，2013 年 3 月前，MHT 文件格式的 CVE-2012-0158 漏洞相关文件并未出现在\n\n该威胁情报源当中，但已经被“绿斑”组织使用。我们尚不能认为“绿斑”组织是这种免杀方式的发明者，\n\n但至少其是这种方式的早期使用者。而对于一个 2012 年 1 月的陈旧漏洞，“绿斑”组织则较早使用了可以\n\n延续其攻击窗口的方法。并不是所有 APT 攻击都会使用 0day 漏洞，这取决于攻击者的资源储备和突破被攻\n\n击方的防御的必要性等因素，部分 APT 攻击组织并没有能力去挖掘 0day 漏洞，但其同样试图采购获得商业\n\n的 0day 漏洞，针对 1day 漏洞快速跟进，并尝试使用免杀方式来使陈旧漏洞形成新的攻击能力。这些问题和\n\n0day 漏洞检测防御一样值得关注。\n\n### 3.2 CVE-2014-4114 漏洞利用\n\n我们有一定的分析证据表明，“绿斑”组织在 2014 年 10 月前曾使用 CVE-2014-4114 漏洞。这可能表示\n\n该组织与地下漏洞交易有相应的渠道联系。\n\n**©安天版权所有** **欢迎无损转载** **第14 页**\n\n\n-----\n\n**绿斑** **行动——持续多年的攻击**\n\n### 3.3 CVE-2017-8759 漏洞利用\n\n安天 2017 年针对“绿斑”组织的一个新的前导攻击文档进行了分析，该文档利用最新的 CVE-2017-8759\n\n漏洞下载恶意代码到目标主机执行。样本采用 RTF 格式而非之前的宏代码方式，在无须用户交互的情况下\n\n就可以直接下载并执行远程文件，攻击效果更好。\n\nCVE-2017-8759 漏洞是由一个换行符引发的漏洞，该漏洞影响所有主流的.NET Framework 版本。在. NET\n\n库中的 SOAP WSDL 解析模块 IsValidUrl 函数没有正确处理包含回车换行符的情况，导致调用者函数\n\nPrintClientProxy 存在代码注入执行漏洞，目前该漏洞主要被用于 Office 文档高级威胁攻击。\n\n图 3-6 通过 **objautlink 和** **objupdate 控制字段自动更新链接**\n\n图 3-7 嵌入的链接实际上是一个 **WSDL 文件（见下一节** **TXT 文件）**\n\n**3.3.1** **漏洞触发文件：TXT 文件**\n\n该类文件是 WSDL 文件，是导致漏洞触发的文件。触发漏洞会导致执行其中的代码即利用 msHTA.exe\n\n执行指定的 HTA 文件，使用 HTA 文件得到解析和运行。以样本 jin2.txt 为例分析，关键代码如下：\n\n**©安天版权所有** **欢迎无损转载** **第15 页**\n\n\n-----\n\n**绿斑** **行动——持续多年的攻击**\n\n图 3-8 WSDL 文件调用 **msHTA 执行** **HTA 文件**\n\n每个 txt 文件的不同之处在于包含的 HTA 文件链接不同，具体请看表 3-1：\n\n表 3-1 txt 调用 **hta 列表**\n\n**样本名称** **样本中包含的下载地址**\n\n**ding1.txt** [http://updateinfo.***.org/ding1/ding1.HTA](http://updateinfo.servegame.org/ding1/ding1.hta)\n\n**ding2.txt** [http://updateinfo.***.org/ding2/ding2.HTA](http://updateinfo.servegame.org/ding2/ding2.hta)\n\n**tiny1.txt** [http://updateinfo.***.org/tiny1/tiny1.HTA](http://updateinfo.servegame.org/tiny1/tiny1.hta)\n\n**tiny2.txt** [http://updateinfo.***.org/tiny1/tiny2.HTA](http://updateinfo.servegame.org/tiny1/tiny2.hta)\n\n**tony1.txt** [http://updateinfo.***.org/tiny1/tony1.HTA](http://updateinfo.servegame.org/tiny1/tony1.hta)\n\n**tony2.txt** [http://updateinfo.***.org/tiny1/tony2.HTA](http://updateinfo.servegame.org/tiny1/tony2.hta)\n\n**bing.txt** [http://updateinfo.***.org/bing/bing.HTA](http://updateinfo.servegame.org/bing/bing.hta)\n\n**jin1.txt** [http://updateinfo.***.org/jin1/jin1.HTA](http://updateinfo.servegame.org/jin1/jin1.hta)\n\n**jin2.txt** [http://updateinfo.***.org/jin2/jin2.HTA](http://updateinfo.servegame.org/jin2/jin2.hta)\n\n**3.3.2** **下载指定** **EXE 文件：HTA 文件**\n\nHTA 文件是 html 页面文件，嵌入了 VBScript 脚本，该脚本的主要功能是利用 PowerShell 下载指定的 E\n\nXE 文件，保存为 officeupdate.exe 并执行该程序。图 3-9 为样本 jin2.HTA 的内容：\n\n**©安天版权所有** **欢迎无损转载** **第16 页**\n\n|样本名称|样本中包含的下载地址|\n|---|---|\n|ding1.txt|http://updateinfo.***.org/ding1/ding1.HTA|\n|ding2.txt|http://updateinfo.***.org/ding2/ding2.HTA|\n|tiny1.txt|http://updateinfo.***.org/tiny1/tiny1.HTA|\n|tiny2.txt|http://updateinfo.***.org/tiny1/tiny2.HTA|\n|tony1.txt|http://updateinfo.***.org/tiny1/tony1.HTA|\n|tony2.txt|http://updateinfo.***.org/tiny1/tony2.HTA|\n|bing.txt|http://updateinfo.***.org/bing/bing.HTA|\n|jin1.txt|http://updateinfo.***.org/jin1/jin1.HTA|\n|jin2.txt|http://updateinfo.***.org/jin2/jin2.HTA|\n\n\n-----\n\n**绿斑** **行动——持续多年的攻击**\n\n图 3-9 HTA 文件调用 **powershell 下载执行文件**\n\n每个 HTA 文件的不同之处是下载地址不相同，攻击者利用漏洞触发 HTA 下载并执行最终的可执行文\n\n件载荷，具体对应关系请看表 3-2：\n\n表 3-2 HTA 对应 **EXE 下载地址**\n\n**样本名称** **样本中包含的下载地址**\n\n**ding1.HTA** [http://updateinfo.***.org/ding1/ding1.exe](http://updateinfo.servegame.org/ding1/ding1.exe)\n\n**ding2.HTA** [http://updateinfo.***.org/ding2/ding2.exe](http://updateinfo.servegame.org/ding2/ding2.exe)\n\n**tiny1.HTA** [http://updateinfo.***.org/tiny1/tiny1.exe](http://updateinfo.servegame.org/tiny1/tiny1.exe)\n\n**tiny2.HTA** [http://updateinfo.***.org/tiny2/tiny2.exe](http://updateinfo.servegame.org/tiny2/tiny2.exe)\n\n**tony1.HTA** [http://updateinfo.***.org/tony1/tony1.exe](http://updateinfo.servegame.org/tony1/tony1.exe)\n\n**tony2.HTA** [http://updateinfo.***.org/tony2/tony2.exe](http://updateinfo.servegame.org/tony2/tony2.exe)\n\n**bing.HTA** [http://updateinfo.***.org/bing/bing.exe](http://updateinfo.servegame.org/bing/bing.exe)\n\n**jin1.HTA** [http://updateinfo.***.org/jin1/jin1.exe](http://updateinfo.servegame.org/jin1/jin1.exe)\n\n**jin2.HTA** [http://updateinfo.***.org/jin2/jin2.exe](http://updateinfo.servegame.org/jin2/jin2.exe)\n\n**©安天版权所有** **欢迎无损转载** **第17 页**\n\n|样本名称|样本中包含的下载地址|\n|---|---|\n|ding1.HTA|http://updateinfo.***.org/ding1/ding1.exe|\n|ding2.HTA|http://updateinfo.***.org/ding2/ding2.exe|\n|tiny1.HTA|http://updateinfo.***.org/tiny1/tiny1.exe|\n|tiny2.HTA|http://updateinfo.***.org/tiny2/tiny2.exe|\n|tony1.HTA|http://updateinfo.***.org/tony1/tony1.exe|\n|tony2.HTA|http://updateinfo.***.org/tony2/tony2.exe|\n|bing.HTA|http://updateinfo.***.org/bing/bing.exe|\n|jin1.HTA|http://updateinfo.***.org/jin1/jin1.exe|\n|jin2.HTA|http://updateinfo.***.org/jin2/jin2.exe|\n\n\n-----\n\n**绿斑** **行动——持续多年的攻击**\n\n### 3.4 相关载荷分析\n\n**3.4.1** **Poison Ivy RAT 后门**\n\n我们经过分析，发现案例 1、案例 2、案例 3、案例 9 中所释放的 update.exe，均为 Poison Ivy RAT 后门\n\n程序，Poison Ivy 是一款已经公开的、著名的 RAT 程序，功能强大，生成的载荷小巧易于加密和对抗检测。\n\n正因 Poison Ivy 有这些优点，因此也被其他攻击组织使用在其他攻击事件中。以下为部分 Poison Ivy 后门的\n\n功能：\n\n 可以获取系统基本信息；\n\n 可以进行全盘文件管理，包括查看所有文件，下载文件，上传文件等；\n\n 获取系统进程信息，结束进程，挂起进程等；\n\n 获取系统服务程序信息；\n\n 查看系统安装的软件，可进行卸载；\n\n 获取系统打开的端口号；\n\n 可执行远程shell，执行任意命令；\n\n 可获取密码Hash 值；\n\n 可进行键盘记录；\n\n 可获取屏幕截图；\n\n 可打开摄像头进行监控；\n\n图 3-10、3-11 为这四个案例涉及的样本（update.exe）文件中互斥量和域名相关的信息：\n\n图 3-10 多案例样本互斥量对比\n\n**©安天版权所有** **欢迎无损转载** **第18 页**\n\n\n-----\n\n**绿斑** **行动——持续多年的攻击**\n\n图 3-11 多案例样本连接域名对比\n\n同时，我们将四个案例涉及样本的版本信息、时间戳、连接域名等相关信息整理如表 3-3：\n\n表 3-3 Poison Ivy RAT 后门版本信息对比\n\n**案例** **1** **案例** **2** **案例** **3** **案例** **9**\n\n**文件版本** 10.0.3.1 2.0.0.1\n\n**描述** WSC Helper Tool ConnectHttp\n\nCopyright ? 2000 - 2010 Avira GmbH. All rights\n\n**版权** Copyright ? 2012\n\nreserved.\n\n**产品版本** 10.00.03.01 2, 0, 0, 1\n\n**产品名称** AntiVir Desktop Connect the http\n\n**公司** Avira GmbH none\n\nAntiVir® is a registered trademark of Avira\n\n**合法商标**\n\nGmbH, Germany.\n\n**内部名称** avwsc Https\n\n**文件版本** 10.00.03.01\n\n**语言** 中文(简体) (中华人民共和国) 中文(中国)\n\n**源文件名** avwsc.exe Http.exe\n\n**文件大小** 32768 字节 11264 字节 24576 字节\n\n**互斥量** )!VoqA.I4 l2(q~&hE= )!VoqA.I4\n\n2013-02-06 2014-03-13\n\n**时间戳** 2012-08-06 10:00:16\n\n09:12:32 10:09:27\n\n**域名** waterfall.xxx.org mp3.xxx.com mp3.xxx.com ssy.xxx.org\n\n**©安天版权所有** **欢迎无损转载** **第19 页**\n\n|Col1|案例1|案例2|案例3|案例9|\n|---|---|---|---|---|\n|文件版本|10.0.3.1|||2.0.0.1|\n|描述|WSC Helper Tool|||ConnectHttp|\n|版权|Copyright ? 2000 - 2010 Avira GmbH. All rights reserved.|||Copyright ? 2012|\n|产品版本|10.00.03.01|||2, 0, 0, 1|\n|产品名称|AntiVir Desktop|||Connect the http|\n|公司|Avira GmbH|||none|\n|合法商标|AntiVir® is a registered trademark of Avira GmbH, Germany.||||\n|内部名称|avwsc|||Https|\n|文件版本|10.00.03.01||||\n|语言|中文(简体) (中华人民共和国)|||中文(中国)|\n|源文件名|avwsc.exe|||Http.exe|\n|文件大小|32768 字节||11264 字节|24576 字节|\n|互斥量|)!VoqA.I4||l2(q~&hE=|)!VoqA.I4|\n|时间戳|2012-08-06 10:00:16||2013-02-06 09:12:32|2014-03-13 10:09:27|\n|域名|waterfall.xxx.org|mp3.xxx.com|mp3.xxx.com|ssy.xxx.org|\n\n\n-----\n\n**绿斑** **行动——持续多年的攻击**\n\n**IP** 27.105.xxx.xxx 123.254.xxx.xxx 123.254.xxx.xxx 114.42.xxx.xxx\n\n通过上面的信息，我们可以看出，在这四个案例中，虽然均为 Poison Ivy RAT 的后门，但是还可以分为\n\n三类：\n\n第一类是案例 1 和案例 2，它们之间除域名外，其它信息均相同，通过对案例 1 和案例 2 中 update.exe\n\n二进制的对比，发现它们之间 90%的二进制是相同的，不同之处是加密的二进制代码，它们的不同是由于\n\n加密密钥的不同。\n\n图 3-12 案例 **1、2 涉及样本的解密算法**\n\n第二类是案例 3，第三类是案例 9，这两类样本的加密算法与第一类不同，但解密后的代码，除了相关\n\n配置不同，其功能部分几乎完全相同。\n\n图 3-13 案例 **3 涉及样本的解密算法**\n\n图 3-14 案例 **9 涉及样本的解密算法**\n\n根据案例 3 中 update.exe 的时间戳，我们可以判断该样本出现于 2013 年 2 月 6 日，虽然时间戳是可以\n\n被修改的，但是结合案例 3 释放的欺骗文档的内容（请参见第 2 章，doc 中内容的时间），我们相信它具有\n\n一定的参考价值。\n\n**©安天版权所有** **欢迎无损转载** **第20 页**\n\n|IP|27.105.xxx.xxx|123.254.xxx.xxx|123.254.xxx.xxx|114.42.xxx.xxx|\n|---|---|---|---|---|\n\n\n-----\n\n**绿斑** **行动——持续多年的攻击**\n\n**3.4.2** **Gh0st 后门**\n\n通过我们对于案例 4 中 update.exe 的分析，得到该样本所使用的互斥量为“chinaheikee__inderjns”，该\n\n互斥量与我们分析过的 gh0st 样本的互斥量一致，是默认配置，而且上线数据包与 gh0st 3.75 版本非常一致，\n\n因此我们可以判定该 update.exe 为 gh0st 后门。\n\n图 3-15Gh0st RAT 后门界面\n\n**3.4.3** **HttpBots 后门**\n\n通过我们对于案例 5 中 svchost.exe 的分析，可以确定该样本实际是一个 BOT 后门程序。svchost.exe 通\n\n过 Web 端来控制安装有该后门程序的机器，图 3-16 为具体指令信息截图。\n\n图 3-16 httpbots 后门控制指令\n\n**©安天版权所有** **欢迎无损转载** **第21 页**\n\n\n-----\n\n**绿斑** **行动——持续多年的攻击**\n\n\n表 3-4 指令说明\n\n**指令** **指令说明**\n\n**.quit** 控制指令：退出\n\n**.uptime** 控制指令：获取运行时间（不确定）\n\n**.upload** 控制指令：上传文件\n\n**.download** 控制指令：下载文件\n\n**.exec** 控制指令：执行文件\n\n**.shell** 控制指令：执行脚本\n\n**3.4.4** **ZXSHELL 后门（针对性）**\n\n经过安天分析，案例 6、7、8 中释放的 PE 文件确定为 ZXShell 后门家族（分别为 3 个不同版本），是\n\n使用 ZXShell 源码修改后编译的，具有 ZXShell 后门常规功能：系统信息获取、文件管理、进程查看等。\n\n很特别的一点是作者将版本修改为 V3.6（ZXShell 最后更新版本为 3.0），并新增了窃密功能：样本收集\n\n*.doc*、*.xls*、*.ppt*等文档文件（案例 6 只收集网络磁盘、U 盘、CDROM 中的文件，案例 7-8 则收集全\n\n盘文件），且为保证收集的文档具有价值，只收集半年内修改过的文档文件并使用 RAR 打包，以日期加磁\n\n盘卷序列号命名（案例 6 以磁盘卷序列号命名），后缀名和压缩包密码各不相同。\n\n图 3-17 案例 **6 只收集** **U 盘、CD、网络磁盘中的文件**\n\n**©安天版权所有** **欢迎无损转载** **第22 页**\n\n|指令|指令说明|\n|---|---|\n|.quit|控制指令：退出|\n|.uptime|控制指令：获取运行时间（不确定）|\n|.upload|控制指令：上传文件|\n|.download|控制指令：下载文件|\n|.exec|控制指令：执行文件|\n|.shell|控制指令：执行脚本|\n\n\n-----\n\n**绿斑** **行动——持续多年的攻击**\n\n图 3-18 打包收集到的文档\n\n根据已有样本分析配置后，我们统计出样本搜集文档的类型：*.doc*、*.xls*、*.ppt*、*.wps*、*.pdf。\n\n经分析，我们发现了样本新增的功能：\n\n1. 获取 IE 自动保存的邮箱账户密码和对应网址，对 IE6 和 IE6 以上的版本采取不同的方法。\n\n2. 收集网络信息、主机信息、进程信息，记录在如下目录中：\n\n%Application Data%\\Microsoft\\Windows\\Profiles.log\n\n3. 样本根据各自的配置，收集全盘包含指定关键字的文件路径、C 盘 Program Files 目录下的 EXE\n\n文件路径，将收集到的文件路径信息同样记录在\n\n%Application Data\\Microsoft\\Windows\\Profiles.log\n\n图 3-19 收集指定关键文件列表\n\n根据目前已捕获样本，我们发现每个样本都硬编码了三个关键字，根据关键字对攻击目标进行敏感资料\n\n收集，去重后的具体关键字为十二个，包括“战”、“军”、“航”等，通过这些关键字我们可以清晰的了解“绿\n\n斑”组织的作业意图：\n\n4. 样本存在一个额外域名，自动回传 Profiles.log 文件和 RAR 打包文件。\n\n5. 后门发包：***_IP-计算机名^^//@@&&***（“***”部分各个样本不同）\n\n**©安天版权所有** **欢迎无损转载** **第23 页**\n\n\n-----\n\n**绿斑** **行动——持续多年的攻击**\n\n6. 监听回应：kwo（口令）\n\n7. 后门发包：IP-计算机名-2014010106.tmpp19769（年月日小时.tmpp 文件大小）\n\n8. 监听回应：任意（支持以指定偏移读取文件）\n\n9. 后门发包：Profiles.log 文件内容（参见图 3-20）\n\n图 3-20 Profiles.log 文件内容\n\n10. 案例 6 样本中，指令的帮助提示为正常中文，而案例 8 样本是乱码，经过分析，发现新样本其实\n\n对这部分中文是其他编码，而在编译程序时候却将这部分转换为 GB2312 编码，导致显示乱码。\n\n图 3-21 案例 **6 样本指令提示**\n\n图 3-22 案例 **8 样本指令提示**\n\n11. 案例 7 样本对中国安全厂商产品的相关进程的判断，根据安装不同的杀软，采取退出、正常运\n\n行、添加特殊启动项等不同的行为，可以看出这是针对中国用户专门设计的恶意程序。\n\n表 3-5 是该组织使用的样本与 ZXShell 原版功能的对比，可以发现这批样本只保留了必要的远控功能，\n\n并添加了 ZXShell 原本没有的窃密相关功能，具体功能对比如表 3-5 所示：\n\n**©安天版权所有** **欢迎无损转载** **第24 页**\n\n\n-----\n\n**绿斑** **行动——持续多年的攻击**\n\n表 3-5 案例 **6、7、8 样本与 ZXShell RAT 原版后门对比**\n\n**功能** **案例** **6** **案例** **7** **案例** **8** **ZXShell**\n\n**清除系统日志** √ √ √ √\n\n**结束本程序** √ √ √ √\n\n**运行一个程序** √ √ √ √\n\n**文件管理** √ √ √ √\n\n**显示帮助** √ √ √ √\n\n**进程管理** √ √ √ √\n\n**共享一个** **Shell 给别人.** √ √ √ √\n\n**查看系统详细信息** √ √ √ √\n\n**从指定网址下载文件或上传文件到指定服务器** √ √ √ √\n\n**NC** √ √ √ √\n\n**获取** **IE 保存的邮箱的账号密码信息** √ √ √\n\n**收集文档文件（*.doc*、*.xls*、*.ppt*、*.wps*）** √ √ √\n\n**收集特定关键字文件、Program Files 目录** **EXE 文件列表** √ √\n\n**自动回传收集的文件和列表** √ √\n\n**加密配置数据** √\n\n**对不同系版本的、杀毒软件进程的采取不同的行为** √\n\n**克隆系统账号** √\n\n**暂时关闭** **Windows 自带防火墙** √\n\n**克隆一个文件的时间信息** √\n\n**加载一个** **DLL 或插入到指定的进程** √\n\n**端口扫描** √\n\n**以其他进程或用户的身份运行程序** √\n\n**服务管理** √\n\n**注销||重启||关闭系统** √\n\n**配置终端服务** √\n\n**卸载** √\n\n**系统帐户管理** √\n\n**HTTP 代理服务器** √\n\n**HTTP 服务器** √\n\n**插件功能,可添加自定义命令** √\n\n**Socks4&5 代理** √\n\n**©安天版权所有** **欢迎无损转载** **第25 页**\n\n|功能|案例6|案例7|案例8|ZXShell|\n|---|---|---|---|---|\n|清除系统日志|√|√|√|√|\n|结束本程序|√|√|√|√|\n|运行一个程序|√|√|√|√|\n|文件管理|√|√|√|√|\n|显示帮助|√|√|√|√|\n|进程管理|√|√|√|√|\n|共享一个Shell 给别人.|√|√|√|√|\n|查看系统详细信息|√|√|√|√|\n|从指定网址下载文件或上传文件到指定服务器|√|√|√|√|\n|NC|√|√|√|√|\n|获取IE 保存的邮箱的账号密码信息|√|√|√||\n|收集文档文件（*.doc*、*.xls*、*.ppt*、*.wps*）|√|√|√||\n|收集特定关键字文件、Program Files 目录EXE 文件列表||√|√||\n|自动回传收集的文件和列表||√|√||\n|加密配置数据||√|||\n|对不同系版本的、杀毒软件进程的采取不同的行为||√|||\n|克隆系统账号||||√|\n|暂时关闭Windows 自带防火墙||||√|\n|克隆一个文件的时间信息||||√|\n|加载一个DLL 或插入到指定的进程||||√|\n|端口扫描||||√|\n|以其他进程或用户的身份运行程序||||√|\n|服务管理||||√|\n|注销||重启||关闭系统||||√|\n|配置终端服务||||√|\n|卸载||||√|\n|系统帐户管理||||√|\n|HTTP 代理服务器||||√|\n|HTTP 服务器||||√|\n|插件功能,可添加自定义命令||||√|\n|Socks4&5 代理||||√|\n\n\n-----\n\n**绿斑** **行动——持续多年的攻击**\n\n**3.4.5** **检出率（持续性）3.4.5 攻击期间部分样本的检出情况**\n\n事件中的后门样本均是互联网公开的 RAT 程序，一般而言安全厂商对这些程序都会重点关注，基本主\n\n流安全厂商都可以检测和查杀，但是该组织对这些公开的 RAT 程序进行修改和加密使用，使这些样本在其\n\n行动的一段时间内的整体检出率不到 8%，一些个别样本甚至只有 1-2 家安全厂商检出，可见这批样本是针\n\n对杀软做了针对性的免杀处理的，可以在目标主机持续化驻留。\n\n图 3-23 部分样本检出率\n\n**3.4.6** **近期捕获样本分析**\n\n**EXE 文件**\n\nEXE 文件是 3.3.2 章节中提到的由 HTA 文件下载并执行的最终载荷，该类文件主要功能是从指定网址\n\n下载 ShellCode，解密之后，创建线程执行此 ShellCode。以 jin2.exe 为例分析，样本关键代码如下：\n\n图 3-24 连接指定网址下载 **ShellCode**\n\n**©安天版权所有** **欢迎无损转载** **第26 页**\n\n\n-----\n\n**绿斑** **行动——持续多年的攻击**\n\n图 3-25 解密 **shellcode 函数**\n\n从指定网址下载完 ShellCode 后，样本对 ShellCode 进行解密，然后分配内存将解密后的 ShellCode 复\n\n制过去。随后创建一个线程，将 ShellCode 的首地址作为参数传给线程函数从而运行 ShellCode。\n\n图 3-26 分配内存，创建线程执行 **ShellCode**\n\n每个 EXE 文件功能代码基本相同，只有下载 ShellCode 的地址不同的，各个地址如下表所示：\n\n表 3-6 EXE 文件下载 **shellcode 对应列表**\n\n**文件名** **样本中包含的** **URL**\n\n**bing.exe** http://updateinfo. ***.org/bingpolkji9ds.tmp\n\n**ding1.exe** http://updateinfo.***.org/ding1loilmkjh.tmp\n\n**ding2.exe** http://updateinfo.***.org/ding23edfgtrd.tmp\n\n**jin1.exe** http://updateinfo.***.org/jin1asdwe2123.tmp\n\n**jin2.exe** http://updateinfo.***.org/jin2sdweqsdas.tmp\n\n**tiny1.exe** http://updateinfo.***.org/tiny1detvghrt.tmp\n\n**tiny2.exe** http://updateinfo.***.org/tiny2lrmkoiju.tmp\n\n**tony1.exe** http://updateinfo.***.org/tony1loik,lpo.tmp\n\n**tony2.exe** http://updateinfo.***.org/tony2fsdfdcsf.tmp\n\n**©安天版权所有** **欢迎无损转载** **第27 页**\n\n|文件名|样本中包含的URL|\n|---|---|\n|bing.exe|http://updateinfo. ***.org/bingpolkji9ds.tmp|\n|ding1.exe|http://updateinfo.***.org/ding1loilmkjh.tmp|\n|ding2.exe|http://updateinfo.***.org/ding23edfgtrd.tmp|\n|jin1.exe|http://updateinfo.***.org/jin1asdwe2123.tmp|\n|jin2.exe|http://updateinfo.***.org/jin2sdweqsdas.tmp|\n|tiny1.exe|http://updateinfo.***.org/tiny1detvghrt.tmp|\n|tiny2.exe|http://updateinfo.***.org/tiny2lrmkoiju.tmp|\n|tony1.exe|http://updateinfo.***.org/tony1loik,lpo.tmp|\n|tony2.exe|http://updateinfo.***.org/tony2fsdfdcsf.tmp|\n\n\n-----\n\n**绿斑** **行动——持续多年的攻击**\n\n**ShellCode（Poison Ivy）**\n\n我们对解密后的 ShellCode 进行分析，发现其 ShellCode 为 Poison Ivy 程序生成，与 3.4.1 章节的样本来\n\n自同一远控程序。在传播源放置的不同 ShellCode 中所连接的 IP 地址如表 3-7 所示：\n\n表 3-7 shellcode 连接 **c2 对应列表**\n\n**ShellCode** **C2** **IP 地址和端口号**\n\n**bingpolkji9ds.tmp** zxcv201789.***.com 131.213.**.**:8088\n\n**ding1loilmkjh.tmp** microsoftword.***.com 45.77.**.**:53\n\n**ding23edfgtrd.tmp** uswebmail163.***.com 45.77.**.**:53\n\nhy-zhqopin.***.org\n\n**jin1asdwe2123.tmp** 45.76.**.**:80\n\n**jin2sdweqsdas.tmp** bearingonly.***.net 45.76.**.**:53\n\n**tiny1detvghrt.tmp** fevupdate.***.com 45.76.**.**:80\n\n**tiny2lrmkoiju.tmp** wmiaprp.***.com 45.76.**.**:53\n\n**tony1loik,lpo.tmp** winsysupdate.***.net 188.166.**.**:80\n\n**tony2fsdfdcsf.tmp** officepatch.***.com 188.166.**.**:53\n\n我们通过本地劫持的方式，将 C2 地址重定向到本地计算机，通过配置好的 Poison Ivy 客户端可以与样\n\n本建立连接，确定攻击者使用的 Poison Ivy 版本为 2.3.1，具体信息如图 3-27 所示：\n\n**©安天版权所有** **欢迎无损转载** **第28 页**\n\n|ShellCode|C2|IP 地址和端口号|\n|---|---|---|\n|bingpolkji9ds.tmp|zxcv201789.***.com|131.213.**.**:8088|\n|ding1loilmkjh.tmp|microsoftword.***.com|45.77.**.**:53|\n|ding23edfgtrd.tmp|uswebmail163.***.com|45.77.**.**:53|\n|jin1asdwe2123.tmp|hy-zhqopin.***.org|45.76.**.**:80|\n|jin2sdweqsdas.tmp|bearingonly.***.net|45.76.**.**:53|\n|tiny1detvghrt.tmp|fevupdate.***.com|45.76.**.**:80|\n|tiny2lrmkoiju.tmp|wmiaprp.***.com|45.76.**.**:53|\n|tony1loik,lpo.tmp|winsysupdate.***.net|188.166.**.**:80|\n|tony2fsdfdcsf.tmp|officepatch.***.com|188.166.**.**:53|\n\n\n-----\n\n**绿斑** **行动——持续多年的攻击**\n\n\n图 3-27 重定向 **C2 成功连接分析的样本**\n\n## 4 样本关联性分析\n\n### 4.1 多案例横向关联\n\n安天 CERT 对典型案例中的前 6 个案例的相关信息进行了关联分析，主要涉及文件名、互斥量、文件版\n\n本信息等，通过横向关联（参见图 4-1）以及之前提到的 doc 文件内容、漏洞利用方式、可执行文件的相关\n\n信息，我们初步判定这些事件之间是存在关联的。\n\n图 4-1 多案例横向关联\n\n**©安天版权所有** **欢迎无损转载** **第29 页**\n\n\n-----\n\n**4.1.1** **ShellCode 部分（CVE-2012-0158）对比**\n\n表 4-1 ShellCode 部分（CVE-2012-0158）对比\n\n**对比项** **案例** **1** **案例** **4**\n\n**导致溢出的数据大小** 0x8282 0x8282\n\n0x7FFA4512 0x7FFA4512\n\n**溢出后跳转指令的地址**\n\n(对应 JMP ESP 指令) (对应 JMP ESP 指令)\n\n**第一部分** **SHELLCODE**\n\n指令完全相同\n\n**指令**\n\n**第二部分** **SHELLCODE** 偏移:0x3BA7 偏移:0x3BA7\n\n**的偏移和大小** 大小:0x11C50 大小: 0x1604F\n\n**第二部分** **SHELLCODE**\n\n指令完全相同\n\n**的指令**\n\n**第三部分** **SHELLCODE** 偏移:0x3DFE 偏移:0x3DFE\n\n**的偏移位置和大小** 大小: 0x119DE 大小:0x15DE\n\n**第三部分** **SHELLCODE**\n\n指令功能完全相同\n\n**指令**\n\n\"%USERPROFILE%\\\n\n\"%USERPROFILE%\\\n\n重要通知.doc\"\n\n通知.doc\"\n\n\"%USERPROFILE%\\t\n\n**解密出来的路径字符串** \"%USERPROFILE%\\t\n\naskmgr.exe\"\n\naskmgr.exe\"\n\n被标记为共有 0x38 大\n\n被标记为 0x38 大小\n\n小。\n\nC:\\Documents and C:\\Documents and\n\nSettings\\All Users\\「开 Settings\\All Users\\「开\n\n**释放出来的** **PE 文件路径**\n\n始」菜单 \\程序 \\启动 始」菜单 \\程序 \\启动\n\n**和大小**\n\n\\update.exe. \\update.exe.\n\n大小:32768 字节 大小:256000 字节\n\nC:\\Documents and C:\\Documents and\n\n**释放出来的** **DOC 路径，** Settings\\admin\\ 通 Settings\\admin\\重要通\n\n**大小和** **MD5** 知.doc 知.doc\n\n大小:34304 字节 大小: 26624 字节\n\n**4.1.2** **释放的** **PE 文件对比**\n\n\n**绿斑** **行动——持续多年的攻击**\n\n**案例** **6**\n\n0x8282\n\n0x7FFA4512\n\n(对应 JMP ESP 指令)\n\n偏移:0x3BA7\n\n大小:0x39C4F\n\n偏移:0x3DFE\n\n大小:0x399EC\n\n\"%USERPROFILE%\\1\n\n23.doc\"\n\n\"%USERPROFILE%\\t\n\naskmgr.exe\"\n\n被标记为 0x38 大小\n\nC:\\Documents and\n\n|对比项|案例1|案例4|案例6|\n|---|---|---|---|\n|导致溢出的数据大小|0x8282|0x8282|0x8282|\n|溢出后跳转指令的地址|0x7FFA4512 (对应JMP ESP 指令)|0x7FFA4512 (对应JMP ESP 指令)|0x7FFA4512 (对应JMP ESP 指令)|\n|第一部分 SHELLCODE 指令|指令完全相同|||\n|第二部分 SHELLCODE 的偏移和大小|偏移:0x3BA7 大小:0x11C50|偏移:0x3BA7 大小: 0x1604F|偏移:0x3BA7 大小:0x39C4F|\n|第二部分 SHELLCODE 的指令|指令完全相同|||\n|第三部分 SHELLCODE 的偏移位置和大小|偏移:0x3DFE 大小: 0x119DE|偏移:0x3DFE 大小:0x15DE|偏移:0x3DFE 大小:0x399EC|\n|第三部分 SHELLCODE 指令|指令功能完全相同|||\n|解密出来的路径字符串|\"%USERPROFILE%\\ 通知.doc\" \"%USERPROFILE%\\t askmgr.exe\" 被标记为0x38 大小|\"%USERPROFILE%\\ 重要通知.doc\" \"%USERPROFILE%\\t askmgr.exe\" 被标记为共有0x38 大 小。|\"%USERPROFILE%\\1 23.doc\" \"%USERPROFILE%\\t askmgr.exe\" 被标记为0x38 大小|\n|释放出来的PE 文件路径 和大小|C:\\Documents and Settings\\All Users\\「开 始」菜单\\程序\\启动 \\update.exe. 大小:32768 字节|C:\\Documents and Settings\\All Users\\「开 始」菜单\\程序\\启动 \\update.exe. 大小:256000 字节|C:\\Documents and Settings\\All Users\\「开 始」菜单\\程序\\启动 \\update.exe. 大小:172032 字节|\n|释放出来的DOC 路径， 大小和MD5|C:\\Documents and Settings\\admin\\ 通 知.doc 大小:34304 字节|C:\\Documents and Settings\\admin\\重要通 知.doc 大小: 26624 字节|C:\\Documents and Settings\\admin\\123.doc 大小:58880 字节|\n\n\n**©安天版权所有** **欢迎无损转载** **第30 页**\n\n\n-----\n\n**绿斑** **行动——持续多年的攻击**\n\n\n表 4-2 释放的 **PE 文件对比**\n\n**相关点** **案例** **1、2、3、4、5、9** **案例** **6、7、8**\n\n**采用** **MIME 免杀（MHT）** √\n\n**利用** **CVE-2012-0158 漏洞** √\n\n**针对中国地区政府部门** √\n\n**释放** **PE 路径和文件名**\n\n**（** **C:\\Documents and Settings\\All**\n\n√基本相同\n\n**Users\\** **「开始」菜单** **\\** **程序** **\\** **启动**\n\n**\\update.exe）**\n\n**版本信息伪装** 伪装 Avira 或其他\n\nPoison Ivy\n\n**RAT** Gh0st ZXShell\n\nhttpbots\n\n**PE 文件版本信息相关项名称（数**\n\n**量一样），如：备注、产品版本、公** √\n\n**司等**\n\n**C&C 的** **IP 地理位置是** **XXX** √\n\n**C&C 域名均为动态域名** √\n\n**窃取文档格式文件，如：*.doc*、**\n\n× √\n\n***.ppt*、*.wps*、*.xls***\n\n### 4.2 域名关联\n\n通过提取和整理十几个有关联样本中的域名信息（参见图 4-2），我们可以很清晰地看出，所有域名均\n\n为动态域名，且服务提供商均处于境外，同时大部分域名都是通过 changeip.com 和 no-ip.com 注册的，我们\n\n认为这些域名并非单一散乱注册的，而是属于同一来源的、有组织的进行注册。\n\n**©安天版权所有** **欢迎无损转载** **第31 页**\n\n|相关点|案例1、2、3、4、5、9|案例6、7、8|\n|---|---|---|\n|采用MIME 免杀（MHT）|√||\n|利用CVE-2012-0158 漏洞|√||\n|针对中国地区政府部门|√||\n|释放PE 路径和文件名 （C:\\Documents and Settings\\All Users\\「开始」菜单\\程序\\启动 \\update.exe）|√基本相同||\n|版本信息伪装|伪装Avira 或其他||\n|RAT|Poison Ivy Gh0st httpbots|ZXShell|\n|PE 文件版本信息相关项名称（数 量一样），如：备注、产品版本、公 司等|√||\n|C&C 的IP 地理位置是XXX|√||\n|C&C 域名均为动态域名|√||\n|窃取文档格式文件，如：*.doc*、 *.ppt*、*.wps*、*.xls*|×|√|\n\n\n-----\n\n**绿斑** **行动——持续多年的攻击**\n\n\n图 4-2 行动涉及域名信息\n\n### 4.3 IP 地址关联\n\n通过提取和整理十几个有关联样本中域名的曾跳转 IP 和现跳转 IP，我们可以很清晰地看出，在所有\n\n的 IP 地址中，绝大多数的 IP 地址都属于同一地区，并且这些 IP 多数来自两个互联网地址分派机构\n\nAS3462、和 AS18182，每个互联网地址分派机构管理现实中的一个区域，这也同时说明了这是一组有相同\n\n来源的攻击事件。\n\n### 4.4 恶意代码之间关联性\n\n为了方便呈现和理解，我们对典型案例中所有的样本、C2 的关联性进行了关系梳理（参见图 4-3）。\n\n**©安天版权所有** **欢迎无损转载** **第32 页**\n\n\n-----\n\n**绿斑** **行动——持续多年的攻击**\n\n图 4-3 恶意代码之间关联图（2011-2015 年活动）\n\n通过研究发现，虽然“绿斑”组织使用了多种不同的后门程序，但是它们之间共用了 C2 服务器，这很\n\n有可能是为了方便管理与控制，这一点从表 4-3 的后门 ID 与上线密码也可以发现不同后门类型之间的对应\n\n关系。\n\n图 4-4 不同事件/恶意载荷（PE）共用基础设施 **C2**\n\n通过对 Poison Ivy RAT 相关样本分析，我们得出其上线 ID 和密码。我们可以看到其中有不同的样本均\n\n采用了同样的 ID 和密码。\n\n**©安天版权所有** **欢迎无损转载** **第33 页**\n\n\n-----\n\n**绿斑** **行动——持续多年的攻击**\n\n表 4-3 Poison Ivy RAT 上线 **ID 和密码**\n\n**ID** **密码**\n\n**14** 0926\n\n**14** 8613\n\n**90518** kkbox55\n\n**90518** kkbox55\n\n**zhan** ftp1234\n\n**zhan2** ftp1234\n\n**120707** hook32wins\n\n**netlink.VizVaz.com** hook32wins\n\n**avex** admin\n\n**w6U900** admin\n\n**motices** ps135790\n\n**1013** @1234@\n\n**wu** 45002931\n\n**bs21** b53s\n\n通过对已捕获的 ZXShell RAT 相关样本进行分析，我们统计出样本的上线密码和压缩包加密密码。可\n\n以看出 ZXShell 样本中也有很多采用了相同的密码，同时这些密码与表 4-3（Poison Ivy RAT 上线 ID 和密\n\n码）中的密码也有一些相同或者相似，再通过域名、IP 等其他信息可以认为这些样本为同一攻击组织所为。\n\n表 4-4 ZXShell RAT 上线密码和压缩配置\n\n**上线密码** **压缩密码、后缀名**\n\n**admin** fish1111、.bin\n\n**8613** 8613、.ttf\n\n**8613** 8613、.mib\n\n**95279527** 95279527、.bin\n\n**95279527** asusgo、.bin\n\n**goapple** goapple、.bin\n\n**1507** 1507、.bin\n\n**cma1998** kvkv2012、.bin\n\n**iphone5** abcd123++、.bin\n\n**success** qwer4321、.bin\n\n**hook32wins** hook32wins2w、.tmp\n\n**987** zxcvasdf、.ocx\n\n**ftp533** ftp1234、.dat\n\n**Qwer!2#$** zxcvfdsa、.bin\n\n**qwer1234** kano918、.bin\n\n**©安天版权所有** **欢迎无损转载** **第34 页**\n\n|ID|密码|\n|---|---|\n|14|0926|\n|14|8613|\n|90518|kkbox55|\n|90518|kkbox55|\n|zhan|ftp1234|\n|zhan2|ftp1234|\n|120707|hook32wins|\n|netlink.VizVaz.com|hook32wins|\n|avex|admin|\n|w6U900|admin|\n|motices|ps135790|\n|1013|@1234@|\n|wu|45002931|\n|bs21|b53s|\n\n|上线密码|压缩密码、后缀名|\n|---|---|\n|admin|fish1111、.bin|\n|8613|8613、.ttf|\n|8613|8613、.mib|\n|95279527|95279527、.bin|\n|95279527|asusgo、.bin|\n|goapple|goapple、.bin|\n|1507|1507、.bin|\n|cma1998|kvkv2012、.bin|\n|iphone5|abcd123++、.bin|\n|success|qwer4321、.bin|\n|hook32wins|hook32wins2w、.tmp|\n|987|zxcvasdf、.ocx|\n|ftp533|ftp1234、.dat|\n|Qwer!2#$|zxcvfdsa、.bin|\n|qwer1234|kano918、.bin|\n\n\n-----\n\n**绿斑** **行动——持续多年的攻击**\n\n**qwer1234** dank1234、.bin\n\n**qwer1234** ftp1234、.bin\n\n**661566** 661566、.bin\n\n## 5 组织关联性分析\n\n除以上样本分析中所呈现的较为直接的多起事件的关联性外，安天 CERT 还进行了对比分析，从代码\n\n相似性、域名使用偏好、C2 的 IP 地址关联性及地理位置特性等方面得出了这些载荷均来自“绿斑”攻击组\n\n织的结论。\n\n### 5.1 代码相似性\n\n在 2011-2015 的行动中，攻击组织使用了 4 类远程控制程序，其中主要使用 ZXShell 和 Poison Ivy。在\n\n对于 Poison Ivy 的使用中，攻击组织首先生成 Poison Ivy 的 ShellCode，然后对 ShellCode 异或加密硬编码\n\n到 Loader 中，在 Loader 投放到目标主机后解密执行 ShellCode。这种手法与 2017 年所发现行动中的样本完\n\n全相同，且都是采用三次异或加密，样本解密算法代码对比参见图 5-1。\n\n图 5-1 左图为 **2011-2015 年行动中样本解密算法，右图为** **2017 年行动样本解密算法**\n\n### 5.2 域名使用偏好\n\n在 2017 年发现的行动中全部使用了动态域名商（共计 14 个），而在 2011-2015 年的行动中则使用了 35\n\n个动态域名商。可以发现两起行动的攻击者都偏好使用动态域名，同时本次行动中有 7 个动态域名商与历\n\n史行动涉及的域名商相同。\n\n**©安天版权所有** **欢迎无损转载** **第35 页**\n\n|qwer1234|dank1234、.bin|\n|---|---|\n|qwer1234|ftp1234、.bin|\n|661566|661566、.bin|\n\n\n-----\n\n**绿斑** **行动——持续多年的攻击**\n\n另外，在此次事件中的一个域名“geiwoaaa.xxx.com”与 2013 年事件中的域名“givemea.xxx.com”释\n\n义相似度较高，我们猜测很可能是同一组织注册。\n\n### 5.3 C2 的 IP 地址关联性\n\n通过对两次行动中 C2 的 IP 地址进行关联分析，我们发现在 2017 年行动中的样本的 C2（uswebmail16\n\n3.xxx.com 和 l63service.xxx.com）解析到同一个 IP：45.77.xxx.xxx，而在 2011-2015 年行动中涉及的 pps.xx\n\nx.com 这个域名也曾指向这个 IP。\n\n图 5-2 关联到 **2013 年行动中的** **C2 域名**\n\n### 5.4 地理位置特性\n\n在 2017 年行动中的一个域名“geiwoaaa.xxx.com”与 2011-2015 年行动可能存在某种关联，因为该域名\n\n解析的 IP（114.42.XXX.XXX）地理位置与早期活动涉及的地理位置相同（其他 IP 地址多为美国），这可能\n\n是攻击者早期测试遗留的，而这个 IP 与 2013 年行动都属于亚洲某地区电信的 114.42 段，在我们的监控中\n\n发现 2013 年行动中 C2 地址多为这个 IP 段内，这表示两起行动的攻击组织可能存在密切联系。同时该地区\n\n电信相关网站资料显示：“114.32.XXX.XXX - 114.47.XXX.XXX 非固定浮动 IP”，这说明该段内 IP 地址为\n\n动态分配 IP，一定区域内在此电信运营商办理网络业务的用户都可能被分配到该 IP 地址，这表示可能两次\n\n行动的攻击者所在位置相近或者采用的跳板位置相近。\n\n图 5-3 指向 **2011-2015 年行动的** **C2 域名**\n\n## 6 小结\n\n“绿斑”攻击组织主要针对中国政府部门和航空、军事、科研等相关的机构和人员进行网络攻击，试图\n\n窃取机密文件或数据。这是一组时间跨度非常漫长的攻击行动，目前可以确定该攻击组织的活跃时间超过 7\n\n年，甚至可能达到 11 年以上。该攻击组织主要采用的手法是鱼叉式网络钓鱼攻击，即以邮件作为攻击前导，\n\n**©安天版权所有** **欢迎无损转载** **第36 页**\n\n\n-----\n\n**绿斑** **行动——持续多年的攻击**\n\n邮件附件使用有社工技巧的格式溢出文档或伪装过 EXE 可执行文件，进行定向投放，该组织对开源后门程\n\n序进行了大量改造，使其符合作业需要，并绕过主机防护软件。在该组织的攻击中，罕有使用 0day 攻击的\n\n情况，而反复使用陈旧漏洞，但其对漏洞免杀技巧的应用是熟练的，甚至是抢先的。在侵入主机后，通过加\n\n密和动态加载等技术手段，试图达成进入目标并在目标机器内长期潜伏而不被发现的效果。这些攻击手段看\n\n起来并无华丽复杂的攻击装备组合，但其反复地重复使用，恰恰说明这种攻击是可能达成目的的。我们在此\n\n前反复强调，APT 攻击组织使用相关漏洞的攻击窗口期，如果与可能被攻击目标的未进行对应漏洞修复的\n\n攻击窗口期重叠，就不是简单的漏洞修复问题，而是深入的排查和量损、止损问题。\n\n网络入侵相对与传统空间的各种信息窃取破坏行为，无疑是一种成本更低，隐蔽性更强、更难以追踪溯\n\n源的方式。尽管“绿斑”组织不代表 APT 攻击的最高水准，但其威胁依然值得高度警惕。APT 的核心从来\n\n不是 A（高级），而是 P（持续），因为 P 体现的是攻击方的意图和意志。面对拥有坚定的攻击意志、对高昂\n\n攻击成本的承受力、团队体系化作业的攻击组织来说，不会有“一招鲜、吃遍天”的防御秘诀，而必须建立\n\n扎实的系统安全能力。以“绿斑”攻击组织常用的攻击入口邮件为例，不仅要做好身份认证、通讯加密等工\n\n作，附件动态检测分析，邮件收发者所使用终端的安全加固和主动防御等工作也需要深入到位。对于重要的\n\n政府、军队、科研人员，更需要在公私邮件使用上、收发公私邮件的不同场景环境安全方面都有明确的规定\n\n与要求。邮件只是众多的动机入口之一，所有信息交换的入口，所有开放服务的暴露面，都有可能成为 APT\n\n攻击者在漫长窥视和守候过程中，首发命中的机会。\n\n面对具有中高能力水平且组织严密的网空威胁行为体，重要信息系统、关键信息基础设施运营者应根据\n\n网络与信息系统的国家安全、社会安全和业务安全属性，客观判断必须能够有效对抗哪些层级的网络空间威\n\n胁，并据此驱动网络空间安全防御需求。\n\n当前，网络安全对抗已经是大国博弈和地缘安全中的常态化对抗，网络安全工作者必须“树立正确网络\n\n安全观”，直面真实的敌情想定，建立动态综合的网络安全防御体系。并以“关口前移”对网络安全防护方\n\n法的重要要求为指引，落实安全能力的重要控制点，有效解决安全能力“结合面”和“覆盖面”的问题，将\n\n网络安全防御能力深度结合信息系统“物理和环境、网络和通信、设备和计算、应用和数据”等逻辑层次，\n\n并全面覆盖信息系统的各个组成实体和全生命周期，包括桌面终端、服务器系统、通信链路、网络设备、安\n\n全设备以及供应链、物流链、信息出入乃至人员等，避免由于存在局部的安全盲区或者安全短板而导致整个\n\n网络安全防御体系的失效。重要的是，在网络安全体系建设实施的过程中，必须在投资预算和资源配备等方\n\n面予以充分保障，以确保将“关口前移”要求落到实处，在此基础上进一步建设实现有效的态势感知体系。\n\n**©安天版权所有** **欢迎无损转载** **第37 页**\n\n\n-----\n\n**绿斑** **行动——持续多年的攻击**\n\n在未来工作中，安天将继续根据总书记的工作要求，努力实现“全天候全方位感知”、“有效防护”和“关\n\n口前移”，在实践中，不断提升网络安全能力与信息技术的“结合面”和“覆盖面”问题。更多深入参与用\n\n户的信息系统规划建设，将安全管理与防护措施落实前移至规划与建设等系统生命周期的早期阶段，将态势\n\n感知驱动的实时防护机制融入系统运行维护过程，协助客户实现常态化的威胁发现与响应处置工作，逐步实\n\n现“防患于未然”。安天将直面敌情，不断完善能力体系，协助用户应对高级网空威胁行为体的挑战。\n\n**©安天版权所有** **欢迎无损转载** **第38 页**\n\n\n-----\n\n**绿斑** **行动——持续多年的攻击**\n\n## 附录一：关于安天\n\n安天是引领威胁检测与防御能力发展的网络安全国家队，始终坚持自主先进能力导向，依托下一代威胁\n\n检测引擎等先进技术和工程能力积累，研发了智甲、镇关、探海、捕风、追影、拓痕等系列产品，为客户构\n\n建端点防护、边界防护、流量监测、导流捕获、深度分析、应急处置的安全基石。安天致力于为客户建设实\n\n战化的态势感知体系，依托全面持续监测能力，建立系统与人员协同作业机制，指挥网内各种防御机制联合\n\n响应威胁，实现从基础结构安全、纵深防御、态势感知与积极防御到威胁情报有机结合，推动客户整体安全\n\n能力建设的叠加演进。安天为网信主管部门、军队、保密、部委行业和关键信息基础设施等高安全需求客户，\n\n提供整体安全解决方案，产品与服务为载人航天、探月工程、空间站对接、大飞机首飞、主力舰护航、南极\n\n科考等提供了安全保障。\n\n安天是全球基础安全供应链的核心赋能方，全球近百家著名安全厂商、IT 厂商选择安天作为检测能力\n\n合作伙伴，安天的威胁检测引擎为全球超过三十万台网络设备和网络安全设备、超过十四亿部智能终端设备\n\n提供了安全检测能力。\n\n安天技术实力得到行业管理机构、客户和伙伴的认可，已连续五届蝉联国家级安全应急服务支撑单位。\n\n安天是中国应急响应体系中重要的企业节点，在“红色代码”、“口令蠕虫”、“心脏出血”、“破壳”、“魔窟”\n\n等重大安全威胁和病毒疫情方面，实现了先发预警和全面应急响应。安天针对“方程式”、“白象”、“海莲花”、\n\n“绿斑”等几十个高级网空威胁行为体及其攻击行动，进行持续监测和深度解析，协助客户在“敌情想定”\n\n下形成有效防护，为捍卫国家主权、安全和发展利益提供了有力支撑。\n\n安天实验室更多信息请访问： _[http://www.antiy.com（中文）](http://www.antiy.com/)_\n\n_[http://www.antiy.net](http://www.antiy.net/)_ （英文）\n\n安天企业安全公司更多信息请访问： _[http://www.antiy.cn](http://www.antiy.cn/)_\n\n安天移动安全公司（AVL TEAM）更多信息请访问： _[http://www.avlsec.com](http://www.avlsec.com/)_\n\n**©安天版权所有** **欢迎无损转载** **第39 页**\n\n\n-----",
    "language": "ZH",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2018/2018.09.19.Green_Spot_APT/20180919.pdf"
    ],
    "report_names": [
        "20180919"
    ],
    "threat_actors": [
        {
            "id": "b740943a-da51-4133-855b-df29822531ea",
            "created_at": "2022-10-25T15:50:23.604126Z",
            "updated_at": "2025-03-27T02:00:55.505366Z",
            "deleted_at": null,
            "main_name": "Equation",
            "aliases": [
                "Equation"
            ],
            "source_name": "MITRE:Equation",
            "tools": null,
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "b9695d1c-08bf-4cb9-b408-f9275bbe47e7",
            "created_at": "2025-03-07T02:00:03.802302Z",
            "updated_at": "2025-03-27T02:00:03.492235Z",
            "deleted_at": null,
            "main_name": "GreenSpot",
            "aliases": [],
            "source_name": "MISPGALAXY:GreenSpot",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1666716496,
    "ts_updated_at": 1743041837,
    "ts_creation_date": 1537523034,
    "ts_modification_date": 1537523034,
    "files": {
        "pdf": "https://archive.orkl.eu/d46f8f9f955dae7486b9c9b96c533ebb56a739b9.pdf",
        "text": "https://archive.orkl.eu/d46f8f9f955dae7486b9c9b96c533ebb56a739b9.txt",
        "img": "https://archive.orkl.eu/d46f8f9f955dae7486b9c9b96c533ebb56a739b9.jpg"
    }
}