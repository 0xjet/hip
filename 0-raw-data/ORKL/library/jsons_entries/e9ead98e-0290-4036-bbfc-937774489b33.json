{
    "id": "e9ead98e-0290-4036-bbfc-937774489b33",
    "created_at": "2022-10-25T16:48:22.752303Z",
    "updated_at": "2025-03-27T02:06:07.809305Z",
    "deleted_at": null,
    "sha1_hash": "8804946664547376b49229749d7c162df44e80e6",
    "title": "The shadow knows: Malvertising campaigns use domain shadowing to pull in Angler EK | Proofpoint - Enterprise Email Security, Email Archiving, and Privacy Protection Solutions",
    "authors": "",
    "file_creation_date": "2015-12-22T16:37:16Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 1508032,
    "plain_text": "# The shadow knows: Malvertising campaigns use domain shadowing to pull in Angler EK\n\n**Most online ads are displayed as a result of a chain of trust, from the publishers to the malicious**\n**advertiser via ad agencies and/or ad networks.**\n\n**For “traffers” (that is, actors bringing traffic to a malicious destination; for example, exploit kits) that rely�**\n**on malvertising, one of the goals is to gain access to a high-profile ad network such as DoubleClick,�**\n**Bing Ads, AdTech or AppNexus. A reputable, high-profile ad network provides traffers with access to�**\n**higher-quality traffic, and the more reputable an ad network appears, the easier it is for traffers to reach�**\n**this target traffic.�**\n\n**Uncovering domain shadowing**\n\n**In early November, one of those high-profile ad agencies appeared in Proofpoint sensors as “referrer”�**\n**to Angler exploit kit. Further investigation by Proofpoint researchers determined that the creative in**\n**question (ad banners) was pointing to content from https://ads.mikeholt[.]com and landing at**\n**www.mikeholt[.]com.\".**\n\n**_Figure 1 Creative served by the abused ad agency (click to enlarge)_**\n\n\n-----\n\n**_Figure 2 A fake online ad for an authentic Website, displayed using a shadowed domain of that Website_**\n\n**A disparity in the SSL certificate used by both servers is the first hint that something is suspicious about�**\n**this ad.**\n\n**_Figure 3 Shadowed domain SSL certificate vs legitimate site owner's domain SSL certificate�_**\n\n**Comparison of the SSL certificates for two domains is a clue that this could be a case of “domain�**\n**shadowing” [3].**\n\n**Domain shadowing is a technique for generating malicious subdomains from a legitimate domain,**\n**typically using stolen registration credentials for the domain owner. With the stolen credentials, the**\n**threat actor can create a large number of fraudulent subdomains (for example, ads.mikeholt[.]com)**\n**below the legitimate domain mikeholt[.]com. (The domain owners for these examples were contacted**\n\n\n-----\n\n**and redirection actions that pull in their preferred exploit kit.**\n\n**Multiple parallel campaigns**\n\n**Further investigation identified other campaigns employing other compromised domains and abused ad�**\n**agencies. For example:**\n\n**adv.mtcharlestonlodge[.]com**\n\n**_Figure 4: Example of ad with stolen creative linking to malicious domain_**\n\n\n-----\n\n**media.healthy-homemakers[.]com**\n\n**promo.loopnetworksllc[.]com**\n\n**An exploit kit out of nowhere**\n\n**Researchers who have the opportunity to replay this attack in a controlled environment will not be able**\n**to see much without SSL man-in-the-middle capabilities (Fig 6); instead the attack will appear to be**\n**Angler EK materializing ‘out of thin air’.**\n\n**_Figure 6: Traffic captured on the 2015-11-21 without MITM capabilities�_**\n\n**A look in the SSL tunnel**\n\n**One of the reasons that malvertising is appealing to threat actors is that the ad agency / network itself**\n**performs a significant portion of the targeting including geo browser and other options However the�**\n\n\n-----\n\n**_Figure 7: Harmless code served by the server if the client does not match the filtering options or if the�_**\n**_campaign is on hold_**\n\n**When a targeted client visits a site served by the infected content delivery network (CDN), the attack**\n**follows these steps:**\n\n**1. Send a post to filter proxied traffic.�**\n**2. A global JavaScript reads the results of the filtering;�**\n**3. If the reply is as expected, decode a bogus GIF (Fig. 8).**\n**4. Check the system using two information disclosure bugs in Microsoft Internet Explorer to avoid**\n\n**researchers, sandboxes and some security products.**\n**5. Abuse an HTTPS open redirect by DoubleClick. [2]**\n**6. Land the browser on Angler EK without a referrer.**\n\n\n-----\n\n**_Figure 8: Malicious code sent by the fake ad server, including fake GIF image file�_**\n\n**Decoding the fake GIF produces a JavaScript function (Fig. 9).**\n\n\n-----\n\n**_Figure 9: Encoded JavaScript function inside a \"GIF\"_**\n\n**Client filtering�**\n\n**The decoded JavaScript function leverages two information disclosure bugs in Internet Explorer in**\n**order to filtering potential victims. (Fig. 10)�**\n\n\n-----\n\n**_Figure 10: Decoded fake GIF showing redirect and additional filtering�_**\n\n**In order, these checks are:**\n\n**A variation of a technique used by Magnitude and Angler EKs and is used to filter the client by�**\n**certain security products.**\n**A MimeType check in order to filter certain shellex associations, including .py, .pcap and .saz�**\n**(Fig. 10).**\n\n**Both of these bugs were reported to Microsoft in May.**\n\n**All replay attempts of this threat revealed fileless Angler EK [4] [5] threads loading Bedep in memory.�**\n**The Bedep in action is \"buildId\" 1926. Over the course of November, Proofpoint researchers have**\n**observed this Bedep version loading a variety of malware payloads including Fileless Ursnif [4],**\n**Ramnit, Blowcrypt, some Vawtrak campaigns 13 and 60 [7], and most recently Reactor Bot.**\n\n**Conclusion**\n\n\n-----\n\n**however, threat actors are also evolving their techniques, using more sophisticated attack chains that**\n**make it more difficult for even diligent ad agencies and ad network operators to detect malvertising in�**\n**their ad streams. These adaptations will enable malvertising to remain an effective malware distribution**\n**method for months to come.**\n\n**References**\n\n**[[1] https://en.wikipedia.org/wiki/Online_advertising](https://en.wikipedia.org/wiki/Online_advertising)**\n\n**[[2] http://malware.dontneedcoffee.com/2015/10/a-doubleclick-https-open-redirect-used.html](http://malware.dontneedcoffee.com/2015/10/a-doubleclick-https-open-redirect-used.html)**\n\n**[[3] http://blogs.cisco.com/security/talos/angler-domain-shadowing](http://blogs.cisco.com/security/talos/angler-domain-shadowing)**\n\n**[[4] http://malware.dontneedcoffee.com/2014/08/angler-ek-now-capable-of-fileless.html�](http://malware.dontneedcoffee.com/2014/08/angler-ek-now-capable-of-fileless.html)**\n\n**[[5] https://hiddencodes.wordpress.com/2014/10/01/digging-deep-into-angler-fileless-exploit-delivery-2/�](https://hiddencodes.wordpress.com/2014/10/01/digging-deep-into-angler-fileless-exploit-delivery-2/)**\n\n**[[6] http://malware.dontneedcoffee.com/2015/07/a-fileless-ursnif-doing-some-pos.html�](http://malware.dontneedcoffee.com/2015/07/a-fileless-ursnif-doing-some-pos.html)**\n\n**[[7] https://www.proofpoint.com/us/threat-insight/post/In-The-Shadows](https://www.proofpoint.com/us/threat-insight/post/In-The-Shadows)**\n\n**Indicators of Compromise (IOC’s)**\n\n**Shadowed**\n**ads.mikeholt[.]com** **209.126.110.7**\n**domain**\n\n**Shadowed**\n**adv.mtcharlestonlodge[.]com** **209.126.118.13**\n**domain**\n\n**Shadowed**\n**media.healthy-homemakers[.]com** **209.126.118.11**\n**domain**\n\n**Shadowed**\n**promo.loopnetworksllc[.]com** **209.126.118.18**\n**domain**\n\n**Shadowed**\n**delivery.dpis[.]com** **209.126.118.18**\n**domain**\n\n**Shadowed**\n**promo.socialmagnetmarketing[.]com** **209.126.118.14**\n**domain**\n**POS Reco “Fileless” Ursnif** **c1bc86552e558cc37ee7df3a16ef8ac7 2015-11-22**\n**Ramnit** **2839b5e418adc25b0d3a2b9bd04efb992015-11-21**\n\n**Blocrypt** **d37994ac8bb0df034d942c10ae4710942015-11-07**\n**Vawtrak 13** **2408e9df8cb82e575002176a4dcd69a52015-11-15**\n**Vawtrak 60** **d3670b3a2bba2ff92f2e7cbfc63be941** **2015-11-21**\n**Reactor Bot** **b37717d09b61cbfe5c023e8d5fd968ed 2015-11-23**\n**ninthclub[.]com** **81.177.22.179** **Vawtrak C&C**\n**atlasbeta[.]com** **176.9.188.147** **Vawtrak C&C**\n**alutqlyzoxglge7s[.]com** **95.211.205.229** **Bedep Domain**\n\n**browneyandrebun[.]net** **107.170.83.113** **Ursnif C&C**\n**zwietrzyla1morinaga.efloridacoupons[.]com�** **8.26.21.113** **Angler EK**\n**cloud75[.].eu** **51.255.59.117** **Reactor Bot C&C**\n\n**_ET signatures:_**\n\n|ads.mikeholt[.]com|209.126.110.7|Shadowed domain|\n|---|---|---|\n|adv.mtcharlestonlodge[.]com|209.126.118.13|Shadowed domain|\n|media.healthy-homemakers[.]com|209.126.118.11|Shadowed domain|\n|promo.loopnetworksllc[.]com|209.126.118.18|Shadowed domain|\n|delivery.dpis[.]com|209.126.118.18|Shadowed domain|\n|promo.socialmagnetmarketing[.]com|209.126.118.14|Shadowed domain|\n|POS Reco “Fileless” Ursnif|c1bc86552e558cc37ee7df3a16ef8ac7|2015-11-22|\n|Ramnit|2839b5e418adc25b0d3a2b9bd04efb99|2015-11-21|\n|Blocrypt|d37994ac8bb0df034d942c10ae471094|2015-11-07|\n|Vawtrak 13|2408e9df8cb82e575002176a4dcd69a5|2015-11-15|\n|Vawtrak 60|d3670b3a2bba2ff92f2e7cbfc63be941|2015-11-21|\n|Reactor Bot|b37717d09b61cbfe5c023e8d5fd968ed|2015-11-23|\n|ninthclub[.]com|81.177.22.179|Vawtrak C&C|\n|atlasbeta[.]com|176.9.188.147|Vawtrak C&C|\n|alutqlyzoxglge7s[.]com|95.211.205.229|Bedep Domain|\n|browneyandrebun[.]net|107.170.83.113|Ursnif C&C|\n|zwietrzyla1morinaga.efloridacoupons[.]com�|8.26.21.113|Angler EK|\n|cloud75[.].eu|51.255.59.117|Reactor Bot C&C|\n\n\n-----\n\n**2019678 || ET TROJAN Ursnif Checkin**\n\n**2019400 || ET TROJAN Possible Bedep Connectivity Check**\n\n**2021418 || ET TROJAN Bedep HTTP POST CnC Beacon**\n\n**2022141 || ET CURRENT_EVENTS Angler encrypted payload Nov 23**\n\n**2811284 || ETPRO CURRENT_EVENTS Angler or Nuclear EK Flash Exploit M2**\n\n**2814948 || ETPRO CURRENT_EVENTS Possible EK Redir SSL Cert**\n\n**2815003 || ETPRO CURRENT_EVENTS Angler EK Landing Nov 18 2015**\n\n**2815071 || ETPRO CURRENT_EVENTS Possible Angler EK Payload Nov 23 2015**\n\n**2814630 || ETPRO CURRENT_EVENTS Possible Angler EK IE DHE Post M2**\n\n**2807957 || ETPRO TROJAN Win32/TrojanDownloader.Blocrypt Checkin**\n\n**2814112 || ETPRO TROJAN Vawtrak HTTP CnC Beacon**\n\n**2813060 || ETPRO TROJAN Vawtrak Retrieving Module**\n\n**Tuesday, December 15, 2015 - 11:15**\n\n**Malvertising** **Angler EK** **Domain shadowing**\n\n**Proofpoint Staff**\n\n## Related Links\n\n**[Press Releases >](https://www.proofpoint.com/us/news/press-releases)**\n**[Proofpoint in the News >](https://www.proofpoint.com/us/news/in-the-news)**\n**[Proofpoint Blog >](https://www.proofpoint.com/us/news/blog)**\n**[Threat Insights blog >](https://www.proofpoint.com/us/threat-insight)**\n**[Events >](https://www.proofpoint.com/us/events)**\n**[Media Contacts >](https://www.proofpoint.com/us/contact-us)**\n\n### ADD NEW COMMENT\n\n**Your name**\n\n\n-----\n\n**Comment ***\n\n**[原始原始[碼][碼]](javascript:void('???'))**\n\n**格式格式**\n\n**[Switch to plain text editor](javascript:void(0);)**\n\n**More information about text formats**\n\n**Text format**\n\n**Filtered HTML**\n\n**<ol> <u> <a> <p> <br /> <img>**\n\n**Save** **Preview**\n\n### PRODUCTS\n\n**Enterprise Protection**\n\n**Threat Response**\n\n**Targeted Attack Protection**\n\n**Social Media Security**\n\n**Malvertising Protection**\n\n**Privacy, DLP and Encryption**\n\n**Archive**\n\n**Governance**\n\n\n**[原始原始[碼][碼]](javascript:void('???'))**\n\n**格式格式**\n\n\n**More information about text formats**\n\n**Text format**\n\n**Filtered HTML**\n\n**Allowed HTML tags: <em> <strong> <cite> <blockquote> <s> <sub> <sup> <i> <b> <li> <ul>**\n**<ol> <u> <a> <p> <br /> <img>**\n\n\n**Save**\n\n\n**BACK TO TOP**\n\n\n**More information about text formats**\n\n**Text format**\n\n**Filtered HTML**\n\n**Allowed HTML tags: <em> <strong> <cite> <blockquote> <s> <sub> <sup> <i> <b> <li> <ul>**\n**<ol> <u> <a> <p> <br /> <img>**\n\n\n-----\n\n**Sentrion Sendmail**\n\n**TAP Mobile Defense**\n\n## REGIONS\n\n**United States**\n\n**United Kingdom**\n\n**France**\n\n**Germany**\n\n**Spain**\n\n**Japan**\n\n**Taiwan**\n\n**Australia**\n\n\n**PARTNER LOG-IN**\n\n\n**[SENDMAIL SUPPORT LOG-IN](https://www.sendmail.com/cfusion/CFIDE/smi/support/)**\n\n\n**[SUPPORT LOG-IN](https://support.proofpoint.com/)**\n\n\n**© 2015 PROOFPOINT, INC.**\n\n**PRIVACY POLICY**\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2015/2015.09.16.The-Shadow-Knows/The-Shadow-Knows.pdf"
    ],
    "report_names": [
        "The-Shadow-Knows"
    ],
    "threat_actors": [],
    "ts_created_at": 1666716502,
    "ts_updated_at": 1743041167,
    "ts_creation_date": 1450802236,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/8804946664547376b49229749d7c162df44e80e6.pdf",
        "text": "https://archive.orkl.eu/8804946664547376b49229749d7c162df44e80e6.txt",
        "img": "https://archive.orkl.eu/8804946664547376b49229749d7c162df44e80e6.jpg"
    }
}