{
    "id": "31ae4c2b-9021-40b2-a6ee-082f2d150bbb",
    "created_at": "2023-01-12T14:59:15.713799Z",
    "updated_at": "2025-03-27T02:05:24.975354Z",
    "deleted_at": null,
    "sha1_hash": "73229b4b02e2a0093982e7a5c17eba1d224154d8",
    "title": "2021-11-30 - The Re-Emergence of Emotet",
    "authors": "",
    "file_creation_date": "2022-08-18T03:21:35Z",
    "file_modification_date": "2022-08-18T03:21:35Z",
    "file_size": 1036841,
    "plain_text": "# The Re-Emergence of Emotet\n\n**deepinstinct.com/blog/the-re-emergence-of-emotet**\n\nNovember 30, 2021\n\n## Unit 221B Validates >99% Zero-Day and <0.1% False Positive\n Threat Prevention Accuracy\n\n[Learn more](https://www.deepinstinct.com/blog/qa-with-unit-221b-ceo-lance-james)\n\nNovember 30, 2021 | [Ron Ben Yizhak](https://www.deepinstinct.com/author/ron-ben-yizhak)\n\n[Emotet, the malware botnet, has resurfaced after almost 10 months. The operation was](https://www.deepinstinct.com/glossary/emotet-malware)\noriginally taken down by multiple international law enforcement agencies this past January.\nThese agencies took control of the infrastructure and scheduled an un-installation of the\nmalware on April 25.\n\n\n-----\n\nSo what does the re-emergence of Emotet mean, and how can cyber professionals prepare\nfor new threats? This blog will analyze the new DLL, break down a new unpacking technique\nand new features, and review similarities in the new variant with the previous version.\n\nWe will also explore a novel tool called “DeMotet” that automates the analysis of Emotet\nsamples on a large scale and includes an unpacker for the latest loader and decryption\nscripts for the payload. It is used to detect any modification in the malware, and it is now\npublicly available.\n\n**Static Analysis**\n\nFor this analysis, the following sample will be used:\n\n76816ba1a506eba7151bce38b3e6d673362355063c8fd92444b6bec5ad106c21\n\n[As shown in our previous blog posts, the execution flow of Emotet consists of multiple stages](https://www.deepinstinct.com/blog/emotet-malware-2020)\nthat are unpacked in succession. As expected, this is still the case with the new variant. The\nDLL that is written to disk isn’t the actual payload that communicates with the C2 servers.\nThis can be seen by a review of the static information of the resources.\n\nThe entropy of the bitmap resource is high, and it most likely contains encrypted information.\nTo unpack the next stage, the decryption routine needs to be found.\n\nThis resource will be accessed before decryption starts. A breakpoint can be set on the\n“FindResourceA” function to reach this point.\n**Extracting the Next Stage**\n\nThe malware reaches the breakpoint and then returns to the address 0x10005701.\n\nThe parameters for “FindResourceA” match the suspicious resource. This API is called\nthrough a register because it isn’t imported. The address is located in runtime to hinder static\nanalysis. The function then allocates memory based on the size of the resource and goes\n\n\n-----\n\nthrough some decryption loops.\n\nThe return value is the next stage. The size of the file is specified in the code, which makes\nthe extraction from memory even easier.\n\n**Comparing Variants**\n\nIn the past, there was a middle stage between the loader and the payload. Based on our\n[previous analysis of the Emotet payload, the file extracted is the payload itself and not a](https://www.deepinstinct.com/blog/why-emotets-latest-wave-is-harder-to-catch-than-ever-before-part-2)\nmiddle stage.\n\n1. The PE file has no imported API functions.\n2. There are barely any strings present.\n3. The malware utilizes the same code obfuscation techniques.\n\n\n-----\n\nOn the left: the new payload. On the\nright: a payload from January 2021\n\nThe payload conceals its capabilities by hiding information that is used for static analysis.\nThe names of the API functions are stored in the code after they were hashed. Their address\nis located in run-time instead of using the Import Address Table. The strings are encrypted\ninside the file.\n[The code is obfuscated using Control Flow Flattening, which works as follows:](https://hex-rays.com/blog/hex-rays-microcode-api-vs-obfuscating-compiler/)\n\n1. A number is assigned to each basic block.\n2. The obfuscator introduces a block number variable, indicating which block should\n\nexecute.\n3. Each block, instead of transferring control to a successor with a branch instruction, as\n\nusual, updates the block number variable to its chosen successor.\n4. The ordinary control flow is replaced with a switch statement over the block number\n\nvariable, wrapped inside of a loop.\n\nNew imported functions from bcrypt.dll were added to the payload. The strings that represent\nconstants for those functions were also added, such as “ECDH_P256” and “Microsoft\nPrimitive Provider.” This is probably due to Emotet changing its communication protocol from\nHTTP to HTTPS.\n\nThe name hashing and strings decryption algorithms were kept. This means that “DeMotet”\nis still able to discover this information.\n\n**Introducing “DeMotet”**\n\nDeep Instinct has been closely following Emotet for some time. “DeMotet” was developed to\nautomate the research performed on the malware. The tool is a static unpacker for the latest\nvariant of the Emotet loader. It can extract the encrypted payload from the resource without\nexecuting the malware. Python scripts are also included in this tool. They reveal the hidden\n\n\n-----\n\nstrings and API calls the payload uses. The first one is a standalone script that can be used\nto extract this information from a large number of payloads. The second one is an IDA plugin.\nIt adds this information as comments in the code.\n\n\"DeMotet” can be used to track new variants of the malware. New samples of Emotet can be\ndownloaded and unpacked regularly. Once the unpacking process of the malware is\nmodified, the tool will fail.\n\nThis is an indication of a new variant. The variant will then be manually analyzed to update\nthe tool so the automation can be restored. Finding new strings and imported functions in the\npayload is also indicative of a new feature.\n\n[The tool is available in this GitHub repository.](https://github.com/deepinstinct/DeMotet)\n\n**Summary**\n\nThe notorious botnet Emotet is back, and we can expect that new tricks and evasion\ntechniques will be implemented in the malware as the operation progresses, perhaps even\nreturning to being a significant global threat. However, by using the techniques and tools\npresented in this article, the analysis of the malware can be simplified and automated.\n\nDeep Instinct takes a prevention-first approach to stopping ransomware and other malware\nusing the world’s first and only purpose built, deep learning cybersecurity framework. We\npredict and prevent known, unknown, and zero-day threats in <20 milliseconds, 750X faster\nthan the fastest ransomware can encrypt.\n\n\n-----\n\n[If you d like to learn more about our malware, ransomware, and zero-day prevention](https://www.deepinstinct.com/zero-day-attacks)\ncapabilities – including our industry best $3M no-ransomware guarantee – we’d be delighted\nto [give you a demo.](https://www.deepinstinct.com/request-demo/)\n\nIOC\n\nLoaders SHA256\n\n3b3b65d42e44bcc0df291ddab72f1351784f7e66357a4ec75ee5c982ef556149\n\n6b477d63b3504c6eab3c35057b99d467039995783f5f14714ae6af4f83b9dcb3\n\n442ff2de8a19c3f6cf793f9209ffd21da18aa7eb5b4c4c280222eb9f10a2c68a\n\n9ac36258c63a5edfd29e3ed1882c61487ef2c70637192108cc84eb4ea27f7502\n\n00ceb55abdb43042c6f7fabd327e6e1a6cdefed723dea6c4e90d159b9466518c\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-11-30 - The Re-Emergence of Emotet.pdf"
    ],
    "report_names": [
        "2021-11-30 - The Re-Emergence of Emotet.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535555,
    "ts_updated_at": 1743041124,
    "ts_creation_date": 1660792895,
    "ts_modification_date": 1660792895,
    "files": {
        "pdf": "https://archive.orkl.eu/73229b4b02e2a0093982e7a5c17eba1d224154d8.pdf",
        "text": "https://archive.orkl.eu/73229b4b02e2a0093982e7a5c17eba1d224154d8.txt",
        "img": "https://archive.orkl.eu/73229b4b02e2a0093982e7a5c17eba1d224154d8.jpg"
    }
}