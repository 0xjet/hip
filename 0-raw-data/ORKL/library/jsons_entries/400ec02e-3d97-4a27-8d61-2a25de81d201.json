{
    "id": "400ec02e-3d97-4a27-8d61-2a25de81d201",
    "created_at": "2023-01-12T15:03:52.126058Z",
    "updated_at": "2025-03-27T02:12:03.941271Z",
    "deleted_at": null,
    "sha1_hash": "cc9b5ae8ff756f759e86034d0ad3cb1b69c8476a",
    "title": "2021-03-15 - DearCry ransomware attacks exploit Exchange server vulnerabilities",
    "authors": "",
    "file_creation_date": "2022-05-28T15:18:48Z",
    "file_modification_date": "2022-05-28T15:18:48Z",
    "file_size": 1905387,
    "plain_text": "# DearCry ransomware attacks exploit Exchange server vulnerabilities\n\n**[news.sophos.com/en-us/2021/03/15/dearcry-ransomware-attacks-exploit-exchange-server-vulnerabilities/](https://news.sophos.com/en-us/2021/03/15/dearcry-ransomware-attacks-exploit-exchange-server-vulnerabilities/)**\n\nMark Loman March 15, 2021\n\nA recently-patched set of vulnerabilities in on-premises versions of Microsoft Exchange\nServer has been actively exploited for over two months. The exploit, initially attributed to a\nChinese state-sponsored actor, has now been adopted for a range of cybercrime activities—\nthe latest being a ransomware called DearCry. Sophos recently detected and stopped a\nDearCry attack using the exploit, and obtained samples for analysis.\n\nThe DearCry ransomware appears to be created by a beginner—it is unsophisticated, and\ndoes little to hide itself from detection. Its most notable feature is that the encryption header\nthat DearCry adds to the attacked files looks similar to the header used by the notorious\nWannaCry ransomware, which seems more than a coincidence.\n\n## The exploit\n\nThe bugs leveraged in the exploit—CVE-2021-26855 and CVE-2021-27065—were\n[uncovered and reported to Microsoft in December by researchers at DEVCORE. On New](https://devco.re/)\nYear’s Day, the DEVCORE researchers chained the bugs together and created a workable\npre-authentication remote code execution exploit they dubbed “ProxyLogon,” as it exploits\nbugs in Exchange’s proxy architecture and logon mechanism .\n\n\n-----\n\nDEVCORE contacted the Microsoft Security Response Center through its MSRC portal on\nJanuary 5, 2021, with a 120-day public disclosure deadline. On February 18, MSRC\nconfirmed the bug would be fixed in the March 9 “Patch Tuesday” release. But Microsoft was\nprompted to make an out-of-band patch release on March 3 after the memory analysis and\nincident response company Volexity reported in-the-wild exploitation.\n\nAccording to Volexity, in-the-wild exploitation appears to have started as early as January 6,\n2021—the day after the proof-of-concept was submitted to Microsoft. Volexity observed the\nattacker writing webshells (ASPX files) to disk and conducting further operations to dump\ncredentials, add user accounts, steal copies of the Active Directory database, and move\nlaterally to other systems and environments. Microsoft Threat Intelligence Center (MSTIC)\nattributed this campaign with high confidence to HAFNIUM, a group assessed to be statesponsored and operating out of China, based on observed victimology, tactics and\nprocedures.\n\nAfter investigation, DEVCORE confirmed that the in-the-wild exploit observed by Volexity\nwas the same one DEVCORE submitted to Microsoft. The exploited path in the exploit\nattacks is similar (/ecp/<single char>.js) and the webshell password is “orange” (hardcoded\nby DEVCORE exploit developer Orange Tsai @orange_8361).\n\nSophos first detected and blocked a DearCry attack on a customer’s network in Austria on\nMarch 13. A few days earlier, on March 11, the same Exchange server was hit with a\nwebshell, which was also blocked.\n\n## DearCry\n\nThe anti-ransomware team within SophosLabs evaluated two samples of DearCry for this\nanalysis. In both cases, the binaries were unsigned, and showed no evidence of version\ncontrol or other professional development practices. The binaries had no defense against\nanti-virus signatures—they were not packed or obfuscated, so all ransomware text strings\nare in plain sight for detection by analysts and signature-based malware protection. The\nabsence of these characteristics leads us to believe that the ransomware author is a\nbeginner, or that this is an early prototype.\n\nBoth samples contained an identical PDB reference to the machine and source file used to\ncompile the malware binary:\n```\nC:\\Users\\john\\Documents\\Visual Studio 2008\\Projects\\EncryptFile svcV2\\Release\\EncryptFile.exe.pdb\n\n```\nEach binary appeared to be created specially to be delivered to the victim. DearCry uses a\nfully standalone encryption method, with the public key embedded within the ransomware\nbinary, so it does not have to contact a C2 server in order to begin encrypting files. The two\nsamples we studied were sent to different victims, and had different unique identifiers in their\nransom notes, and used different keys.\n\n\n-----\n\n## Crypto combo\n\nBefore encrypting a file, DearCry first creates a new file with a filename based on the name\nof the document it attacks, but adds a .CRYPT file extension. Once created, DearCry starts\nreading contents of the original file and writes it back, encrypted, into the .CRYPT file.\n\nThere are two different encryption methods used by DearCry. Files are encrypted using the\nAES-256 symmetric encryption algorithm, using an OpenSSL library embedded in the\nransomware.\n\nOpenSSL code embedded in the DearCry binary\nBut the AES key itself is encrypted by the attacker with an RSA public-key algorithm. A\npublic key for decrypting the AES key is embedded in the code, but the private key is\nretained by the attacker. Using the RSA encryption of the AES key allows the actor to deploy\nthe ransomware without needing a command and control server to deploy the key. And the\nDearCry actor can create a ransomware binary for each victim, with a unique, victim-specific\npublic encryption key. However, based on our findings, the actor has attempted to deliver the\nsame binary to multiple victims.\n\nInterestingly, the list of file-types the ransomware targets can differ per victim. For example,\npopular image files (like JPG), CAD drawings, programs (EXE) and dynamic link libraries\n(DLL) were not targeted in sample 1, which seems earlier distributed according to the\ncompiler timestamp. Most other ransomware families exclude programs and DLLs from their\nlist of encryption targets, because encrypting the wrong files can result in the computer\nbecoming unbootable, which makes it much harder for the victim to read the ransom note.\n\n\n-----\n\nLooking at these file types, DearCry also targets ASPX files. This would mean the attacker\ncould encrypt an Exchange webshell that allowed hands-on-keyboard from remote. This\nleads us to believe that the ransomware may not be deployed via a webshell, or that the\nattacker has no interest in keeping webshell-access. The later variant (sample 2) also targets\ninstalled software, i.e., EXE and DLL files, effectively making the machine useless:\n\nDearCry ransomware encrypting applications and DLLs, preventing them from running.\n\n## DearCry and WannaCry\n\nIntriguingly, the encryption header that DearCry adds to the attacked files looks similar to the\nheader used by the notorious WannaCry – a ransomware worm that shook the cyber-realm\nin May 2017.\n\n\n-----\n\nCompare the encryption header and file type and size codes added by DearCry ransomware\nto a file…\n\n…\n\nto a version of the same file, encrypted by WannaCry ransomware\n\n\n-----\n\nThe above two images compare an encrypted file Desert.jpg, a sample picture from a default\nWindows 7 machine. Both DearCry and WannaCry add their name at the beginning of the\nfile. Furthermore, in WannaCry the highlighted parts represent file type and the size of the\noriginal unencrypted file. File type at offset 0x010C and file size at offset 0x0110.\n\n\n-----\n\nCode in DearCry writing the header in format similar to WannaCry (with comments added for\nclarification).\n\n## The hybrid approach\n\n\n-----\n\nFrom an anti-ransomware perspective, looking at DearCry s file system behaviors reveals\nmore interesting details. The following table illustrates its behavior for each file DearCry\nattacks (these can be observed using Process Monitor):\n\nFile system behavior of DearCry. Step 8 = Copy. Step 10 = In-Place.\nFrom this behavior, DearCry is what we’d normally call a Copy ransomware. It creates\nencrypted copies of the attacked files and deletes the originals. This causes the encrypted\nfiles to be stored on different logical sectors, normally allowing victims to recover maybe\nsome data – depending on whether Windows reuses the freed logical sectors.\n\nCompared to DearCry, more notorious human-operated ransomware like Ryuk, REvil,\nBitPaymer, Maze and Clop, are In-Place ransomware, where the attack immediately causes\nthe encrypted file to be stored on logically the same sectors as the original document,\nmaking recovery via undelete tools impossible.\n\nBut DearCry has an added trick to make recovery impossible. Before deleting the original\ndocument and after closing the encrypted copy, it also overwrites the original document. This\nmeans DearCry has a hybrid encryption approach: it performs both a Copy and In-Place\nencryption attack.\n\n\n-----\n\nDearCry overwriting the original document after making its encrypted copy.\n\n\n-----\n\nOriginal Desert.jpg overwritten by DearCry\nThis approach is not common. It is so uncommon, the only ransomware that comes to mind\nthat also employed a hybrid approach was WannaCry. It also first created an encrypted copy\nand then overwrote the original file to prevent recovery:\n\n\n-----\n\nFile system behavior of WannaCry. Step 8 = Copy. Step 13 = In-Place.\nDetails about file system behaviors of notorious ransomware, including WannaCry, are\n[documented in our How Ransomware Attacks whitepaper.](https://www.sophos.com/en-us/medialibrary/PDFs/technical-papers/sophoslabs-ransomware-behavior-report.pdf)\n\nThese attributes don’t directly link DearCry to WannaCry’s creator. DearCry’s code, approach\nand abilities differ significantly from WannaCry: it does not use a command-and-control (C2)\nserver, has an embedded RSA encryption key, shows no user interface with a timer and –\nmost importantly – does not spread itself to other machines on the network. And the\nDearCry ransomware binary itself does not delete volume shadow copies.\n\n## Ransom notes\n\nTo inform victims about what happened and who they must contact, a file ‘readme.txt’ is\ndropped in every folder containing the word ‘desktop’ and in the root folder of the system\ndisk. This ransom note contains two e-mail addresses and a hash. This hash is an identifier,\n\n\n-----\n\nso the attacker knows what decryption key is associated with the specific attack.\n\nDearCry ransom note.\n\n## Detections\n\nSophos customers may see DearCry detected as Troj/Ransom-GFE. In some\ncircumstances, the endpoint protection tools on affected Exchange servers also detected a\nweb shell dropped a couple of days before the ransomware; Those components will be\nreported as Troj/WShell-A.\n\nSpecific indicators for the samples described herein have been published to the SophosLabs\nGithub.\n\n## Acknowledgments\n\nSophosLabs would like to acknowledge the contributions of Alex Vermaning and Fraser\nHoward to this report.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-03-15 - DearCry ransomware attacks exploit Exchange server vulnerabilities.pdf"
    ],
    "report_names": [
        "2021-03-15 - DearCry ransomware attacks exploit Exchange server vulnerabilities.pdf"
    ],
    "threat_actors": [
        {
            "id": "529c1ae9-4579-4245-86a6-20f4563a695d",
            "created_at": "2022-10-25T16:07:23.702006Z",
            "updated_at": "2025-03-27T02:02:09.93109Z",
            "deleted_at": null,
            "main_name": "Hafnium",
            "aliases": [
                "Red Dev 13",
                "Silk Typhoon"
            ],
            "source_name": "ETDA:Hafnium",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "7c969685-459b-4c93-a788-74108eab6f47",
            "created_at": "2023-01-06T13:46:39.189751Z",
            "updated_at": "2025-03-27T02:00:03.017103Z",
            "deleted_at": null,
            "main_name": "HAFNIUM",
            "aliases": [
                "ATK233",
                "G0125",
                "Operation Exchange Marauder",
                "Red Dev 13",
                "Silk Typhoon"
            ],
            "source_name": "MISPGALAXY:HAFNIUM",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "2704d770-43b4-4bc4-8a5a-05df87416848",
            "created_at": "2022-10-25T15:50:23.306305Z",
            "updated_at": "2025-03-27T02:00:55.43633Z",
            "deleted_at": null,
            "main_name": "HAFNIUM",
            "aliases": [
                "HAFNIUM",
                "Operation Exchange Marauder",
                "Silk Typhoon"
            ],
            "source_name": "MITRE:HAFNIUM",
            "tools": [
                "Tarrask",
                "ASPXSpy",
                "Impacket",
                "PsExec",
                "China Chopper"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535832,
    "ts_updated_at": 1743041523,
    "ts_creation_date": 1653751128,
    "ts_modification_date": 1653751128,
    "files": {
        "pdf": "https://archive.orkl.eu/cc9b5ae8ff756f759e86034d0ad3cb1b69c8476a.pdf",
        "text": "https://archive.orkl.eu/cc9b5ae8ff756f759e86034d0ad3cb1b69c8476a.txt",
        "img": "https://archive.orkl.eu/cc9b5ae8ff756f759e86034d0ad3cb1b69c8476a.jpg"
    }
}