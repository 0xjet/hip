{
    "id": "e61cef3a-78fc-4413-8e48-3367a5597de4",
    "created_at": "2023-01-12T15:10:24.152518Z",
    "updated_at": "2025-03-27T02:06:06.004408Z",
    "deleted_at": null,
    "sha1_hash": "c180510f5d82a838bfe120e87211120df44839d7",
    "title": "2021-05-10 - Dissecting a RAT. Analysis of the HawkShaw.",
    "authors": "",
    "file_creation_date": "2022-05-27T21:07:25Z",
    "file_modification_date": "2022-05-27T21:07:25Z",
    "file_size": 2309010,
    "plain_text": "# Dissecting a RAT. Analysis of the HawkShaw.\n\n**[stratosphereips.org/blog/2021/5/6/dissecting-a-rat-analysis-of-the-hawkshaw](https://www.stratosphereips.org/blog/2021/5/6/dissecting-a-rat-analysis-of-the-hawkshaw)**\n\nKamila Babayeva May 10, 2021\n\n**_This blog post was authored by Kamila Babayeva (@_kamifai_) and Sebastian Garcia_**\n**_(@eldracote)._**\n\n_The RAT analysis research is part of the Civilsphere Project_\n_[(https://www.civilsphereproject.org/), which aims to protect the civil society at risk by](https://www.civilsphereproject.org/)_\n_understanding how the attacks work and how we can stop them. Check the webpage for_\n_more information._\n\nThis is the sixth blog of a series analyzing the network traffic of Android RATs from our\n[Android Mischief Dataset [more information here], a dataset of network traffic from Android](https://www.stratosphereips.org/android-mischief-dataset)\nphones infected with Remote Access Trojans (RAT). In this blog post we provide the\n[analysis of the network traffic of the RAT03-HawkShaw [download here]. The previous](https://mcfp.felk.cvut.cz/publicDatasets/Android-Mischief-Dataset/AndroidMischiefDataset_v2/RAT03_HawkShaw.zip)\n[blogs analyzed Android Tester RAT,](https://www.stratosphereips.org/blog/2020/12/14/ngwqj0h060yv40w1afp51fg7wo9ijy-pzlhk) [DroidJack RAT,](https://www.stratosphereips.org/blog/2021/1/22/analysis-of-droidjack-v44-rat-network-traffic) [SpyMax RAT,](https://www.stratosphereips.org/blog/2021/2/26/dissecting-a-rat-analysis-of-the-spymax) [AndroRAT RAT and](https://www.stratosphereips.org/blog/2021/3/29/dissecting-a-rat-analysis-of-the-androrat)\n[AhMyth RAT.](https://www.stratosphereips.org/blog/2021/5/6/dissecting-a-rat-analysis-of-the-ahmyth)\n\n## RAT Details and Execution Setup\n\nThe goal of each of our RAT experiments is to configure and execute the RAT software and\nto do every possible action while capturing all traffic and storing all logs. These RAT\ncaptures are functional and used as in real attacks.\n\nThe HawkShaw RAT is the only RAT in our Android Mischief dataset that has the controller\nand the builder hosted in the cloud. The controller is the main program that allows an\nattacker to control the targeted device. Usually, this main program comes with a graphical\nuser interface to make the RAT main program more interactive. The builder is a program\nthat buildы the APK for a targeted device. The HawkShaw RAT service in the cloud is\nbased on the Firebase platform. Firebase is a platform developed by Google for creating\nmobile and web applications. We executed the online service of the HawkShaw RAT on\nUbuntu 20.04 Virtualbox virtual machine with Ubuntu 20.04 as a host. The Android\nApplication Package (APK) built by the online RAT builder was installed in a real Nokia\nphone with Android version 10.\n\nWhile performing different actions on the RAT controller (e.g. upload a file, get GPS\nlocation, monitor files), we captured the network traffic of the RAT controller on the Android\nvirtual emulator. The network traffic of the phone was captured using Emergency VPN.\n\n\n-----\n\nThe details about the network traffic capture are:\n\nThe controller IP address: 35.201.97.85 (provided by the creator of the RAT)\n\nThe phone IP address: 10.8.0.249\n\nUTC time of the start of the infection in the capture: 2020-07-24 07:20:03 UTС\n\n## Analysis Problem\n\nThe HawkShaw RAT online service was created using the Firebase platform. It means that\nthe malicious APK communicates with the RAT service using various Firebase suite\nproducts such as Firebase Authentication, Cloud Messaging, Cloud Storage, Realtime\nDatabase, Analytics, Installations, etc. The Firebase platform provides secure\ncommunication, so all the connections going from the victim’s phone to the HawkShaw\nonline service are encrypted. Considering that, our analysis is performed on the flow level,\ni.e. we analyze only the connections as flows going from the victim to the C&C (not packet\nby packet).\n\n## Infection and Initial Communication\n\nOnce the APK was installed in the phone, it tries to connect to the IP address\n216.58.201.106 by using the server name firebaseinstallations.googleapis.com (Figure 1).\nThis server name indicates a Firebase installation service (FIS) that provides a Firebase\ninstallation unique identifier and auth token for this malicious APK instance.\n\n**_Figure 1. The victim phone starts by connecting to the IP 216.58.201.106 with the server_**\nname firebaseinstallations.googleapis.com that indicates a Firebase installation service\n(FIS).\n\nWith the retrieved auth token and the unique identifier, the phone established a connection\nto the online HawkShaw RAT service. The victim successfully connected to the Firebase\nplatform (35.201.97.85) with the server name hawkshaw-cae48.firebaseio.com (Figure 2).\nThroughout the whole communication, the server name of hawkshaw-cae48.firebaseio.com\nis changed to s-usc1c-nss-283.firebaseio.com due to the Firebase policy of decreasing the\nload.\n\n\n-----\n\n**_Figure 2. The victim connects to the Firebase platform (35.201.97.89) with the HawkShaw_**\nRAT service to the server name hawkshaw-cae48.firebaseio.com.\n\nAfter the successful infection and connection to the C&C online service, the infected phone\nconnects to two services: api.ipify.org and api6.ipify.org to retrieve the IPv4 and IPv6\naddresses of the device. The connections to api.ipify.org and api6.ipify.org are invoked by\nthe APK code shown in Figure 3. This part of the code belongs to a function called after\nreceiving the C&C command ‘Device Information’. It might mean that the controller\nautomatically calls the command ‘Device Information’ that aims to retrieve details about the\ntargeted device hardware, software, settings, etc. Figure 4 shows the screenshot from the\nC&C interface with all the data retrieved from the phone from the command ‘Device\nInformation’.\n\n**_Figure 3. Code from the RAT in the infected device that takes care of connecting to the_**\nservices api.ipify.org and api6.ipify.org to retrieve the IPv4 and IPv6 IP addresses. This\nfunction gets executed after the C&C command sends the command ‘Device Information’.\n\n\n-----\n\n**_Figure 4. The C&C interface after the controller sends the command ‘Device Information’ to_**\nthe victim, that aims to retrieve the details of the victim’s device.\n\nSimultaneously with the connections to api.ipify.org and api6.ipify.org, the phone connects\nto the IP address 216.58.201.74 with the server name firebasestorage.googleapis.com\n(Figure 5). This server name indicates Firebase Storage to store the data. The phone sends\nall retrieved data from the C&C command ‘Device Information’ to store in the Firebase\nstorage.\n\n**_Figure 5. The victim connects to the IP 216.58.201.74 with the server name_**\n_firebasestorage.googleapis.com that indicates Firebase Storage._\n\n## Example of C&C Commands\n\nCompared to other RATs in the Android Mischief Dataset, Hawkshaw RAT is the most\nsophisticated in its functionality. Like other RATs, HawkShaw was able to control victim’s\ncalls, SMS, camera, location, system files, and device’s settings, but also it was able to\ninterfere social media conversations (Figure 6), and its keylogger worked perfectly (Figure\n7).\n\n\n-----\n\n**_Figure 6. HawkShaw controller interferes Instagram conversation of the victim’s device._**\nThe C&C can send and receive messages in the chat.\n\n**_Figure 7. Keylogger C&C command. The C&C captures all the keys clicked on a_**\ncompromised device.\n\n## Complete communication between the C&C and victim phone\n\nThrough the whole infection, 17 malicious connections to the Firebase platform were\nperformed: 10 connections to Firebase App, 3 connections to Firebase Cloud Storage, 2\nconnections to Firebase installation service, and 2 connections to api.ipify.org and\napi6.ipify.org. Due to the poor quality of code, the connections between the victim’s phone\nand the C&C were interrupted often and had very short duration of the connections (Figure\n\n\n-----\n\n8). The phone was connected to the Firebase storage in order to send large files such as\nvideo, photos, documents, and audio. The connections to the Firebase Installation service\nmight be explained with the initializing or updating instance ID and auth token.\n\n**_Figure 8. The duration of the connections between the victims and the HawkShaw online_**\nservice is short, no more than approx. 13 minutes (785 seconds).\n\nAfter a careful analysis of each malicious connection, we found no heartbeat performed in\nany of them. Even though there were 10 connections established between the HawkShaw\nC&C service and the victim, there were no simultaneous connections performed between\nthe C&C and the victim.\n\n## Conclusion\n\nIn this blog we have analyzed the network traffic from a phone infected with the HawkShaw\nRAT that uses Firebase platform to operate and control devices. All the retrieved data from\nthe devices is stored in the Firebase database to which the creator of the HawkShaw RAT\nprobably has access. We were not able to decode its connection due to Firebase secure\nconnection. The HawkShaw RAT seems to be complex in its communication protocol, and it\nis sophisticated in its work.\n\nTo summarize, the details found in the network traffic of this RAT are:\n\nThe RAT is hosted on the cloud with the use of Firebase platform.\n\nFirebase provides an encrypted connection between the HawkShaw online service\nand the victim.\n\nThe targeted device connects to api.ipify.org and api6.ipify.org to retrieve and send its\nIPv4 and IPv6 addresses.\n\nThere is no heartbeat in the communication between the C&C and the phone.\n\nThere are no simultaneous connections established to the C&C.\n\nThere are a lot of connections to the Firebase platform but of a very small size\n\n\n-----\n\n## Biographies\n\nKAMILA BABAYEVA\n\nSebastian Garcia is a malware researcher and security teacher with experience in applied\nmachine learning on network traffic. He founded the Stratosphere Lab, aiming to do\nimpactful security research to help others using machine learning. He believes that free\nsoftware and machine learning tools can help better protect users from abuse of our digital\nrights. He researches on machine learning for security, honeypots, malware traffic\ndetection, social networks security detection, distributed scanning (dnmap), keystroke\ndynamics, fake news, Bluetooth analysis, privacy protection, intruder detection, and\nmicrophone detection with SDR (Salamandra). He co-founded the MatesLab hackspace in\nArgentina and co-founded the Independent Fund for Women in Tech. @eldracote.\nhttps://www.researchgate.net/profile/Sebastian_Garcia6\n\nKamila Babayeva is a 20 years old and third-year bachelor student in the Computer\nScience and Electrical Engineering program at the Czech Technical University in Prague.\nShe is a researcher in the Civilsphere project, a project dedicated to protecting civil\norganizations and individuals from targeted attacks. Her research focuses on helping\npeople and protecting their digital rights by developing free software based on machine\nlearning. Initially, she worked as a junior Malware Reverser. Currently, Kamila leads the\ndevelopment of the Stratosphere Linux Intrusion Prevent System (Slips), which is used to\nprotect the civil society in the Civilsphere lab.\n\n\n-----\n\nSEBASTIAN GARCIA\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-05-10 - Dissecting a RAT. Analysis of the HawkShaw..pdf"
    ],
    "report_names": [
        "2021-05-10 - Dissecting a RAT. Analysis of the HawkShaw..pdf"
    ],
    "threat_actors": [
        {
            "id": "c91f7778-69aa-45fa-be0e-4ee33daf8fbd",
            "created_at": "2023-01-06T13:46:39.110148Z",
            "updated_at": "2025-03-27T02:00:02.998873Z",
            "deleted_at": null,
            "main_name": "NARWHAL SPIDER",
            "aliases": [
                "GOLD ESSEX",
                "TA544"
            ],
            "source_name": "MISPGALAXY:NARWHAL SPIDER",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "1f679d2e-c5c9-49e9-b854-2eca06a870e4",
            "created_at": "2022-10-25T16:07:24.453427Z",
            "updated_at": "2025-03-27T02:02:10.237233Z",
            "deleted_at": null,
            "main_name": "Bamboo Spider",
            "aliases": [
                "Bamboo Spider",
                "TA544"
            ],
            "source_name": "ETDA:Bamboo Spider",
            "tools": [
                "AndroKINS",
                "Bebloh",
                "Chthonic",
                "DELoader",
                "Dofoil",
                "GozNym",
                "Gozi ISFB",
                "ISFB",
                "Nymaim",
                "PandaBanker",
                "Pandemyia",
                "Sharik",
                "Shiotob",
                "Smoke Loader",
                "SmokeLoader",
                "Terdot",
                "URLZone",
                "XSphinx",
                "ZLoader",
                "Zeus OpenSSL",
                "Zeus Panda",
                "Zeus Sphinx",
                "ZeusPanda",
                "nymain"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536224,
    "ts_updated_at": 1743041166,
    "ts_creation_date": 1653685645,
    "ts_modification_date": 1653685645,
    "files": {
        "pdf": "https://archive.orkl.eu/c180510f5d82a838bfe120e87211120df44839d7.pdf",
        "text": "https://archive.orkl.eu/c180510f5d82a838bfe120e87211120df44839d7.txt",
        "img": "https://archive.orkl.eu/c180510f5d82a838bfe120e87211120df44839d7.jpg"
    }
}