{
    "id": "0fd51908-f9fe-4c54-9f56-585e83b1a3e6",
    "created_at": "2023-01-12T15:04:34.696182Z",
    "updated_at": "2025-03-27T02:09:18.183563Z",
    "deleted_at": null,
    "sha1_hash": "e1112c562ba9fdb17fd40c31985639d3a2a0ca12",
    "title": "2021-04-05 - Thwarting Loaders- From SocGholish to BLISTER’s LockBit Payload",
    "authors": "",
    "file_creation_date": "2022-05-28T00:24:45Z",
    "file_modification_date": "2022-05-28T00:24:45Z",
    "file_size": 920678,
    "plain_text": "# Thwarting Loaders: From SocGholish to BLISTER’s LockBit Payload\n\n**[trendmicro.com/en_no/research/22/d/Thwarting-Loaders-From-SocGholish-to-BLISTERs-LockBit-Payload.html](https://www.trendmicro.com/en_no/research/22/d/Thwarting-Loaders-From-SocGholish-to-BLISTERs-LockBit-Payload.html)**\n\nApril 5, 2022\n\nCyber Threats\n\nBoth BLISTER and SocGholish are loaders known for their evasion tactics. Our report details\nwhat these loaders are capable of and our investigation into a campaign that uses both to\ndeliver the LockBit ransomware.\n\nBy: Earle Maui Earnshaw, Mohamed Fahmy, Ian Kenefick, Ryan Maglaque, Abdelrhman\nSharshar, Lucas Silva April 05, 2022 Read time: ( words)\n\nThe Trend MicroTM Managed XDR team has made a series of discoveries involving the\nBLISTER loader and SocGholish. We observed SocGholish’s discreet activity despite its low\ndetections and a BLISTER loader sample used by threat actors to drop a LockBit payload.\nClose monitoring of and prompt response to both cases prevented their respective payloads\nfrom being delivered.\n\nBoth [BLISTER and](https://www.elastic.co/blog/elastic-security-uncovers-blister-malware-campaign) [SocGholish are known for their stealth and evasion tactics in order to](https://digital.nhs.uk/cyber-alerts/2021/cc-3917#:~:text=SocGholish%20is%20an%20advanced%20delivery,malware%2C%20including%20ransomware%20and%20RATs.)\n[deliver damaging payloads. Notably, these two have been used in campaigns together, with](https://redcanary.com/blog/intelligence-insights-january-2022/)\nSocGholish dropping BLISTER as a second-stage loader. Combined, these two loaders aim\n\n\n-----\n\nto evade detection and suspicion to drop and execute payloads, specifically LockBit in this\ncase. Our investigation follows what these loaders are capable of if they not stopped from\nthe outset.\n\nSocGholish infrastructure\n\nSocGholish has been around longer than BLISTER, having already established itself well\n[among threat actors for its advanced delivery framework. Reports show that its framework of](https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/wastedlocker-ransomware-us)\nattack has previously been used by threat actors from as early as 2020.\n\nOur investigation began when the Trend Micro Managed XDR threat hunting team flagged\nactivity from one endpoint. Further investigation uncovered more beneath the surface.\n\nIn this case, the user had unknowingly accessed a compromised legitimate website, which\nprompted a drive-by download of a malicious file into their system. This method of\ndistributing malicious files is a distinct marker of SocGholish.\n\nThe download zip file (C:\\Users\\victim\\Downloads\\download.1313a9.zip) contained the\nmalicious JavaScript Chrome.Update.1313a9.js, which masquerades as an update for the\nbrowser. The contained script here is obfuscated. Thankfully, user execution is still required\nfor this threat to proceed.\n\n\n-----\n\nFigure 1. Code snippet of the JavaScript\nWe investigated what would happen if the script were executed and learned that this allows\nthe malware to proceed with connecting to its command-and-control (C&C) domain and\ndeploy several discovery commands to gather information regarding the system. Afterward, it\nlogs the information into to files with .tmp extensions.\n\n\n-----\n\nFigure 2. PRCA of the discovery commands execution as seen in Trend Micro Vision One™\n\n\n-----\n\nThe executed commands as seen in Figure 2 are as follows:\n\n\"C:\\Windows\\System32\\cmd.exe\" /C net group \"domain admins\" /domain\n>> \"C:\\Users\\victim\\AppData\\Local\\Temp\\rad613A2.tmp\"\n\"C:\\Windows\\System32\\cmd.exe\" /C cmdkey /list >>\n\"C:\\Users\\victim\\AppData\\Local\\Temp\\radF9A30.tmp\"\n\"C:\\Windows\\System32\\cmd.exe\" /C net user victim /domain >>\n\"C:\\Users\\victim\\AppData\\Local\\Temp\\rad6FDE0.tmp\"\n\"C:\\Windows\\System32\\cmd.exe\" /C nltest /domain_trusts >>\n\"C:\\Users\\victim\\AppData\\Local\\Temp\\rad8B102.tmp\"\n\"C:\\Windows\\System32\\cmd.exe\" /C cmdkey /list >>\n\"C:\\Users\\victim\\AppData\\Local\\Temp\\rad2A57D.tmp\"\n\"C:\\Windows\\System32\\cmd.exe\" /C nltest /dclist: >>\n\"C:\\Users\\victim\\AppData\\Local\\Temp\\rad3FBC3.tmp\"\n\"C:\\Windows\\System32\\cmd.exe\" /C whoami /all >>\n\"C:\\Users\\victim\\AppData\\Local\\Temp\\rad95E90.tmp\"\n\nThe malware then drops an additional .js file that executes a few other discovery commands.\nFinally, it downloads and executes the Cobalt Strike beacon, which is used to execute\nremote commands. Aside from the aforementioned scripts, a few others were also dropped\nbut were immediately mitigated by the product.\n\nFigure 3. Vision One showing the deployment of JavaScript and Cobalt Strike\nLow detections of Cobalt Strike and the BLISTER connection\n\nThe Cobalt Strike file was particularly interesting, because at the time of this investigation, it\nhad a low detection rate. We wanted to see why that was and what evasion tactics it\nemployed.\n\n**Date** **Detection**\n\nJan 19, 2022 2\n\nJan 20, 2022 3\n\n\n-----\n\nJan 26, 2022 3\n\nJan 31, 2022 2\n\nFeb 7, 2022 2\n\nFeb 10, 2022 2\n\nTable 1. VirusTotal detection history\n\n[Indeed, further investigation showed that the Cobalt Strike file was a tampered version of a](https://www.virustotal.com/gui/file/53941f5be6753cbdd535b7608e852ea34f04cd7d57cccf800f0203235f8b9bf3/details)\nlegitimate DLL where an export function was modified to contain the Cobalt Strike. This is the\nfirst time we have observed this in the SocGholish infrastructure.\n\nFigure 4. Comparison of the original DLL to the patched DLL\nThe sample, wimgapi.dll, will create a thread that will essentially put itself to sleep for 10\nminutes before decrypting and executing its shell code. It also pauses operations in order to\n[evade detection — a well-documented defense evasion technique.](https://attack.mitre.org/techniques/T1497/003/)\n\n\n-----\n\nIt also performs additional commands before decrypting and executing the shell code as an\nadded evasion tactic. These commands are the following:\n\nIt creates the folder C:\\\\ProgramData\\\\TermSvc.\nIt then drops drops the files C:\\\\ProgramData\\\\TermSvc\\TermSvc.exe, which is the copy\nof the file (Rundll32.exe in this case ) that executes the sample wimgapi.dll and the file\n%User Startup%\\\\TermSvc.lnk, which executes the aforementioned dropped copy\n(Rundll32.exe).\n\nIt then proceeds to decrypt, load, and execute the shell code that connects to the URL\nsikescomposite[.]com. It utilizes VirtualAlloc, VirtualProtect, and CreateThread to decrypt the\nshell code and execute in memory.\n\nWe also observed the harvesting of API functions, which are called only when needed as\nseen in their shell code (Figure 5). This is another tactic that obscures the shell code.\n\nFigure 5. The code for harvesting of API functions and calling them when needed\nAs a malleable Cobalt Strike C&C stager, the behavior of wimgapi.dll might be dependent on\nwhat is downloaded from the accessed URL. With regard to this incident, we have observed\nthe following after its deployment\n\nAccount discovery\nPass-the-hash for privilege escalation\nSpawned WerFault.exe process that generates the following activity: Network sniffing\nof port 135\n\n\n-----\n\nCopying of browser login data\nLateral movement via dropping Cobalt Strike copies into remote machines\n\nFigure 6. Dropping of Cobalt Strike to remote machines as seen in Vision One\nAside from the malicious behavior demonstrated by Cobalt Strike, one of the C&C IP\naddresses (198[.]71[.]233[.]254) can be linked to Emotet and Dridex attacks. This IP\naddress, which is used by multiple JavaScript C&C domains, was found hosting and\ndropping Emotet and Dridex samples from the end of 2021 to this year.\n\nThe way Cobalt Strike was used in this scenario (masking tampered DLLs as legitimate) is\ninteresting, because we have yet to observe it in other SocGholish campaigns. This indicates\nthat the threat actors behind SocGholish are selling access to or are joining forces with a\nthird party. Interestingly, another case investigated by the Trend Micro Managed XDR seems\nto show the third party to be the threat actors behind BLISTER.\n\nFrom SocGholish to BLISTER and LockBit\n\nWe also discovered the use of BLISTER loader a newer type of malware that was first\n[identified in December 2021, in deploying the LockBit ransomware. The delivery of BLISTER](https://www.trendmicro.com/vinfo/us/security/definition/ransomware)\nloader might be through malicious installers, specifically the SocGholish framework. It can\nalso have an embedded Cobalt Strike or BitRat payload in its resource section.\n\n[LockBit is a](https://www.trendmicro.com/vinfo/us/security/news/ransomware-spotlight/ransomware-spotlight-lockbit) [ransomware-as-a-service (RaaS) cartel that has one of the most active](https://www.trendmicro.com/vinfo/us/security/definition/ransomware-as-a-service-raas)\nransomware operations today. The gang is infamous for its sophisticated malware\ncapabilities and strong affiliate network. It typically infects systems using unauthorized\n\n\n-----\n\naccess to internet facing infrastructure.\n\nCuriously, the MDR team found that recent detections used BLISTER, which employs\nSocGholish’s tactic of using fake browser updates to drop malicious files. It also uses several\ntechniques such as the following to avoid detection:\n\nUse of valid code signing certificates to persist in the system\nUse of direct system calls to avoid hooks of the antivirus Userland\nDelay of code execution for 10 minutes to evade sandbox detection\n[Injection of the payload into a legitimate process such as werfault.exe and renaming](https://answers.microsoft.com/en-us/windows/forum/all/werfaultexe-application-error/5c92f613-c691-4cf1-99cd-c3f74591d0c0#:~:text=The%20werfault.exe%20is%20used,to%20receive%20information%20about%20solutions.)\n[legitimate DLLs like Rundll32.exe to stay under the radar.](https://docs.microsoft.com/en-us/troubleshoot/windows-client/deployment/dynamic-link-library)\n\nLikely, through the drive-by download scheme of SocGholish, the file called ssql.exe was\ndropped. This file serves as a dropper that was created with NullSoft, an open-source\nsystem for creating Windows installers, as seen in Figure 7.\n\nFigure 7. The ssql.exe dropper created through NullSoft\nOnce ssql.exe is executed, it drops a BLISTER loader sample to\n%Temp%\\wimgapi_64\\wimgapi.dll. The file wimgapi.dll is then loaded in memory and the\nexport WIMDeleteImageMounts is executed.\n\n\n-----\n\nFigure 8. BLISTER is dropped.\n\nFigure 9. WIMDeleteImageMounts\n\nis executed.\nThe DLL decodes the shell code found in its RCData resource and executes it. Similarly, the\nshellcode sleeps for 10 minutes and then decrypts and decompresses the Cobalt Strike\nbeacon.\n\nVision Onegenerated an image (Figure 10) to show the infection chain based on our\nsamples.\n\nFigure 10. Image of BLISTER loader’s infection chain generated through Vision One\nAfter the execution of the Cobalt Strike payload, the threat actors dropped and executed\nbatch scripts to stop antivirus agents (KillAV) running in the environment and critical services\n(SQL, Veeam, Exchange, and others). The script will also update the Group Policy Object\n(GPO) in the machine, add the computer host name to a centralized text file, and creates\nscheduled task “updater” to execute the batch file on startup and finally clear the Windows\nEvents logs.\n\n\n-----\n\nFigure 11. KillAV used by the LockBit ransomware group to try to stop antivirus agents\n\nFigure 12. Batch script used by the LockBit ransomware group to stop critical services and\nthird-party antivirus software\nAfter successfully reaching this point, the LockBit sample would ultimately be executed. Our\ndetections of the domains that were created and the SocGholish certificates that were used\nsuggest the likelihood that the campaign began in November 2021 and has persisted up to\nthe present.\n\nConclusion\n\nThese investigations gave us the opportunity to learn more about SocGholish and BLISTER\nloader. These cases highlight the continued evolution of threats that are made to evade\ndetection. Notably, we observed evasive tactics like masking a tampered DLL as legitimate\nand placing shell code temporarily to sleep. Organizations should also take note of the\ncontinuing trend of using Cobalt Strike in targeting victim entities and living-off-the-land\nbinaries (LOLBins) to blend in with the environment.\n\nFor these cases, close monitoring and prompt detection prevented all that was described\nhere from coming to pass. Early containment and mitigation are essential to cut off more\ndamaging attacks that compromise environments, steal data, or deploy ransomware.\n\nOrganizations should remain vigilant and ensure that they have solid cybersecurity measures\nin place. These additional security recommendations can also help them protect their assets\nfrom modern ransomware threats like LockBit:\n\n\n-----\n\nEnabling multifactor authentication (MFA) can prevent malicious actors from\ncompromising user accounts as part of their infiltration process.\nUsers should be wary of opening unverified emails. Embedded links should never be\nclicked and attached files should never be opened without the proper precautions and\nverification as these can kickstart the ransomware installation process.\nOrganizations should always adhere to the [3-2-1 rule: Create three backup copies on](https://www.trendmicro.com/vinfo/us/security/news/virtualization-and-cloud/best-practices-backing-up-data)\ntwo different file formats, with one of the backups in a separate location.\nPatching and updating software and other systems at the soonest possible time can\naddress exploitable vulnerabilities that can lead to a ransomware infection.\nOrganizations can better protect themselves from ransomware attacks by implementing\nmultilayered security setups that combine elements such as the automated detection of\nfiles and other indicators with constant monitoring for the presence of weaponized\nlegitimate tools in their IT environment.\n\nNew malware techniques are bound to emerge as threat actors attempt to breach more\nsystems. Organizations can defend themselves against such threats by using multilayered\ndetection and response solutions such as [Trend Micro Vision One™, a purpose-built threat](https://www.trendmicro.com/en_no/business/products/detection-response.html)\ndefense platform that provides added value and new benefits beyond extended detection\nand response (XDR) solutions. This technology provides powerful XDR capabilities that\ncollect and automatically correlate data across multiple security layers — email, endpoints,\nservers, cloud workloads, and networks — to prevent attacks via automated protection while\nalso ensuring that no significant incidents go unnoticed.\n\n[A list of the indicators of compromise (IOCs) can be found here.](https://www.trendmicro.com/content/dam/trendmicro/global/en/research/22/d/thwarting-loaders-from-socgholish-to-blisters-lockbit-payload/iocs-thwarting-loaders-socgholish-blister.txt)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-04-05 - Thwarting Loaders- From SocGholish to BLISTER’s LockBit Payload.pdf"
    ],
    "report_names": [
        "2021-04-05 - Thwarting Loaders- From SocGholish to BLISTER’s LockBit Payload.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535874,
    "ts_updated_at": 1743041358,
    "ts_creation_date": 1653697485,
    "ts_modification_date": 1653697485,
    "files": {
        "pdf": "https://archive.orkl.eu/e1112c562ba9fdb17fd40c31985639d3a2a0ca12.pdf",
        "text": "https://archive.orkl.eu/e1112c562ba9fdb17fd40c31985639d3a2a0ca12.txt",
        "img": "https://archive.orkl.eu/e1112c562ba9fdb17fd40c31985639d3a2a0ca12.jpg"
    }
}