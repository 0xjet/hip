{
    "id": "3dd0930b-c2f1-4962-8b97-8c4c3851b0b8",
    "created_at": "2023-01-12T15:08:16.833844Z",
    "updated_at": "2025-03-27T02:17:00.819741Z",
    "deleted_at": null,
    "sha1_hash": "f5e61cafafecc409dad33c2e5c7258ac28839fba",
    "title": "2022-01-20 - Threat Brief- Ongoing Russia and Ukraine Cyber Conflict",
    "authors": "",
    "file_creation_date": "2022-05-28T00:36:42Z",
    "file_modification_date": "2022-05-28T00:36:42Z",
    "file_size": 1880621,
    "plain_text": "# Threat Brief: Ongoing Russia and Ukraine Cyber Conflict\n\n**[unit42.paloaltonetworks.com/ukraine-cyber-conflict-cve-2021-32648-whispergate/](https://unit42.paloaltonetworks.com/ukraine-cyber-conflict-cve-2021-32648-whispergate/)**\n\nRobert Falcone, Mike Harbison, Josh Grunzweig January 20, 2022\n\nBy [Robert Falcone,](https://unit42.paloaltonetworks.com/author/robertfalcone/) [Mike Harbison and](https://unit42.paloaltonetworks.com/author/mike-harbison/) [Josh Grunzweig](https://unit42.paloaltonetworks.com/author/joshgruznweig/)\n\nJanuary 20, 2022 at 12:30 PM\n\n[Category: Government,](https://unit42.paloaltonetworks.com/category/government/) [Malware,](https://unit42.paloaltonetworks.com/category/malware-2/) [Threat Brief](https://unit42.paloaltonetworks.com/category/threat-briefs-assessments/threat-brief/)\n\nTags: [Cortex,](https://unit42.paloaltonetworks.com/tag/cortex/) [CVE-2021-32648,](https://unit42.paloaltonetworks.com/tag/cve-2021-32648/) [next-generation firewall,](https://unit42.paloaltonetworks.com/tag/next-generation-firewall/) [OctoberCMS,](https://unit42.paloaltonetworks.com/tag/octobercms/) [Russia,](https://unit42.paloaltonetworks.com/tag/russia/) [threat brief,](https://unit42.paloaltonetworks.com/tag/threat-brief/)\n[threat prevention,](https://unit42.paloaltonetworks.com/tag/threat-prevention/) [Ukraine,](https://unit42.paloaltonetworks.com/tag/ukraine/) [vulnerabilities,](https://unit42.paloaltonetworks.com/tag/vulnerability/) [WhisperGate,](https://unit42.paloaltonetworks.com/tag/whispergate/) [WildFire,](https://unit42.paloaltonetworks.com/tag/wildfire/) [Windows](https://unit42.paloaltonetworks.com/tag/windows/)\n\nThis post is also available in: 日本語 [(Japanese)](https://unit42.paloaltonetworks.jp/ukraine-cyber-conflict-cve-2021-32648-whispergate/)\n\n## Executive Summary\n\nBeginning on Jan. 14, 2022, reports began emerging about a series of attacks targeting\nnumerous Ukrainian government websites. As a result of these attacks, numerous government\nwebsites were found to be either defaced or inaccessible. As a result of this, the government of\n[Ukraine formally accused Russia of masterminding these attacks against their websites.](https://thehackernews.com/2022/01/ukrainian-government-officially-accuses.html)\n\n[A day later, public reporting outlined new malware called WhisperGate that originally was](https://www.microsoft.com/security/blog/2022/01/15/destructive-malware-targeting-ukrainian-organizations/)\nobserved on Jan. 13, 2022. This malware disables Windows Defender Threat Protection, is\ndestructive in nature and was discovered to have targeted multiple organizations in Ukraine.\nMicrosoft has publicly attributed the use of this custom malware to a threat actor they refer to as\nDEV-0586.\n\n\n-----\n\nThough both attacks have targeted Ukrainian organizations, the two threats have so far been\nimplemented in separate situations.\n\nAs a result of these events, Palo Alto Networks researchers took immediate action to ensure that\ncustomers anywhere in the world can be appropriately protected against these reported threats,\nhowever they may be exploited. These attacks ultimately resulted in the investigation of the\nfollowing two threats:\n\n[1. CVE-2021-32648, a vulnerability in the OctoberCMS content management system (CMS)](https://nvd.nist.gov/vuln/detail/CVE-2021-32648)\n\nplatform, which is believed to be behind the attacks against Ukrainian government\nwebsites.\n2. The WhisperGate malware, attributed to the DEV-0586 threat actor.\n\n[Palo Alto Networks customers can use Xpanse or](https://www.paloaltonetworks.com/cortex/cortex-xpanse) [Threat Prevention for the Next-Generation](https://www.paloaltonetworks.com/products/secure-the-network/subscriptions/threat-prevention)\nFirewall to identify vulnerable and/or internet-facing instances of OctoberCMS. Protections\n[against WhisperGate malware have been included in Cortex XDR, as well as in the WildFire and](https://www.paloaltonetworks.com/cortex/cortex-xdr)\n[Advanced URL Filtering subscriptions for the Next-Generation Firewall. There is a](https://www.paloaltonetworks.com/network-security/security-subscriptions) Cortex\nXSOAR pack available to assist with detecting and mitigating both threats.\n\n\n**Threats targeting Ukraine**\n**discussed**\n\nAttacks against Ukrainian\ngovernment websites\n\nAttacks against multiple\norganizations in Ukraine\n\n## Table of Contents\n\nCVE-2021-32648 Vulnerability\n\nWhisperGate Malware Family\n\nMitigation Actions\n\nHunting for WhisperGate\n\nConclusion\n\nAdditional Resources\n\n## CVE-2021-32648 Vulnerability\n\n\n**Relevant CVEs/malware/affected software**\n\n[CVE-2021-32648, affecting OctoberCMS](https://nvd.nist.gov/vuln/detail/CVE-2021-32648)\n\n[WhisperGate malware, disabling Windows Defender](https://www.microsoft.com/security/blog/2022/01/15/destructive-malware-targeting-ukrainian-organizations/)\nThreat Protection\n\n\nThe CVE-2021-32648 vulnerability lies within the OctoberCMS platform prior to version 1.0.472\nand results in an attacker gaining access to any account via a specially crafted account password\nreset request. This vulnerability is believed to have allowed threat actors to gain access to the\nunderlying websites leveraged by the Ukraine government.\n\nOnce the vulnerability was discovered, Palo Alto Networks threat researchers quickly began\nreverse-engineering the patch that remediated this vulnerability and were able to produce a\nworking proof of concept (PoC) in a very short time. Later that day, a [public PoC surfaced,](https://github.com/Immersive-Labs-Sec/CVE-2021-32648/blob/main/cve-2021-32648.py)\n\n\n-----\n\nallowing organizations to better understand this vulnerability and how it is exploited. Using our\nPoC, we created the following demonstration video of how a malicious actor would exploit the\nCVE-2021-32648 vulnerability, log into the compromised OctoberCMS account and to deface a\nweb page hosted by the server:\n\nWatch Video At:\n\nhttps://youtu.be/0hDxZWGWZrM\n\nTo determine how this vulnerability was exploited, we analyzed the patch that developers added\nto OctoberCMS version 1.0.472 to mitigate the CVE-2021-32648 vulnerability. We discovered\n[that the vulnerable code existed in the Auth/Models/User.php file within the](https://github.com/octobercms/library/blob/v1.0.471/src/Auth/Models/User.php) [October Rain library](https://github.com/octobercms/library)\nof OctoberCMS. The code that exposes this vulnerability is within a function named\n[checkResetPasswordCode, specifically, line 281 in User.php. The following line of code attempts](https://github.com/octobercms/library/blob/v1.0.471/src/Auth/Models/User.php#L281)\nto validate the inbound password reset request by comparing the reset code submitted within the\nHTTP request with the reset code generated by OctoberCMS during a legitimate reset process:\n\nTo exploit this vulnerability, the actor would simply supply a boolean true value as the reset code\nwithin a custom-crafted HTTP request to reset the password of an account. By supplying the\nboolean true, the comparison between boolean true and the reset code string results in a\nboolean true, even though the two variables have different types. This effectively validates the\nactor’s inbound password reset request, which allows the actor to then change the password\n\nTo fix this vulnerability in version 1.0.472, the OctoberCMS developer changed the line of code\nabove to use === instead of == when comparing the values of the reset code provided by the\nuser via an HTTP POST request. The difference between === and == involves the ===\ncomparing the value and type of value of the variable, not just the value, as happens when using\n\n\n-----\n\n==. To demonstrate the difference, the following two commands run PHP code to show that a\ncomparison of the string code with boolean true using == results in a boolean true, while the\nsame comparison using === results in a boolean false:\n\nAs a result of the analysis of the CVE-2021-32648 vulnerability, various product protections were\ncreated or enhanced. More information about these protections can be found within the Mitigation\nActions section of the briefing.\n\n## WhisperGate Malware\n\n[First observed by Microsoft on Jan. 13, 2022, WhisperGate malware is computer network attack](https://www.microsoft.com/security/blog/2022/01/15/destructive-malware-targeting-ukrainian-organizations/)\n(CNA) malware aimed at deleting Microsoft Windows Defender and corrupting files on the target.\nIt consists of two samples: One appears as ransomware while the other is a beaconing implant\nused to deliver an in-memory Microsoft Intermediate Language (MSIL) payload. The in-memory\ncode uses Living Off the Land Binaries (LOLBINs) to evade detection and also performs antianalysis techniques, as it will fail to detonate when certain monitoring tools exist. At the time of\nwriting, there are two known samples identified as WhisperGate: Stage1.exe and Stage2.exe.\nStage1.exe purports to be ransomware, as it overwrites the target’s master boot record with 512\nbytes and upon reboot displays the following ransom note:\n\nFigure 1. Stage 1 ransom note.\nStage2.exe is a beaconing implant that performs an HTTPS connection to download a JPG file\nhosted on Discord’s content delivery network (CDN). Discord’s CDN is a user-created service\nthat allows users to host attachments and is not malicious. The hosted file is retrieved from the\nfollowing URL:\n\nhxxps://cdn.discordapp[.]com/attachments/928503440139771947/930108637681184768/Tbopbh.jpg\n\nFile Tbopbh.jpg is the malicious payload that is in-memory loaded and kicks off the destructive\ncapabilities. The following patterns of activities are associated with this payload:\n\n\n-----\n\n1. File InstallUtil.exe is copied to the host s %TEMP% directory, e.g. C:\\Users\\\n\n[USERNAME]\\AppData\\Local\\Temp. This file is a legitimate Microsoft Windows binary.\n\n2. Two instances of PowerShell are spawned with an encoded command to sleep for 10 seconds,\ne.g. C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\" -enc\nUwB0AGEAcgB0AC0AUwBsAGUAZQBwACAALQBzACAAMQAwAA==\n\n3. A Visual Basic Script (VBS) is created in C:\\Users\\[USERNAME]\\AppData\\Local\\Temp named:\nNmddfrqqrbyjeygggda.vbs\n\n4. Process wscript.exe is used to execute the VBS script in step 3. The VBS script is used to call\nPowerShell to set Windows Defender exclusion path to C:\\ e.g.\nC:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\" Set-MpPreference ExclusionPath 'C:\\'\n\n5. [AdvancedRun.exe is created and written to the C:\\Users\\[USERNAME]\\AppData\\Local\\Temp](https://www.nirsoft.net/utils/advanced_run.html)\ndirectory.\n\n6. AdvancedRun.exe is used to execute PowerShell.exe to delete and stop Windows Defender.\nThe following command parameters are passed to AdvancedRun:\n\n\"C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\" /WindowState 0\n/CommandLine \"rmdir 'C:\\ProgramData\\Microsoft\\Windows Defender' -Recurse\" /StartDirectory \"\"\n/RunAs 8 /Run\n\n\"C:\\Users\\USERNAME]AppData\\Local\\Temp\\AdvancedRun.exe\" /EXEFilename\n\"C:\\Windows\\System32\\sc.exe\" /WindowState 0 /CommandLine \"stop WinDefend\"\n/StartDirectory \"\" /RunAs 8 /Run\n\n7. PowerShell process used to delete Windows Defender, e.g.\nC:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe rmdir\n'C:\\ProgramData\\Microsoft\\Windows Defender' -Recurse\n\n8. File InstallUtil.exe running from C:\\Users\\[USERNAME]\\AppData\\Local\\Temp directory. The inmemory payload (Tbopbh.jpg) is running within the context of the InstallUtil.exe process\n\n9. Multiple instances of cmd.exe calling Ping.exe to delete file InstallUtil.exe, e.g. cmd.exe /min\n/C ping 111.111.111[.]111 -n 5 -w 10 > Nul & Del /f /q %TEMP%\\InstallUtil.exe\n\n10. File AdvancedRun.exe is deleted from the C:\\Users\\[USERNAME]\\AppData\\Local\\Temp\ndirectory by the stage2.exe binary.\n\n11. ICMP traffic to host: 111.111.111[.]111\n\n12. All files and directories, including those on mounted USB drives, excluding the floppy drive\n(A:) are targeted. The following file extensions are overwritten with a one-byte value of 0xCC.\n\n\n-----\n\nFigure 2. Targeted file extensions.\n13. Targeted files greater than one megabyte are truncated to one megabyte when overwritten.\n\n14. Virus & Threat protection is no longer available from Windows Security.\n\nFigure 3. Virus & Threat Protection removed.\n\n## Mitigation Actions\n\nOrganizations running OctoberCMS prior to Build 472 and v1.1.5 are encouraged to update to\nthe latest version. Additionally, in order for this vulnerability to be exploited, the web server must\nbe running PHP below 7.4.\n\nPalo Alto Networks customers receive protections against the OctoberCMS vulnerability in the\nfollowing ways:\n\nThreat ID [92199 was released to identify this vulnerability](https://threatvault.paloaltonetworks.com/?query=92199)\nXpanse has a policy that customers can enable to detect internet-facing instances of\nOctoberCMS\n\nPalo Alto Networks customers receive protections against WhisperGate malware in the following\nways:\n\n[WildFire appropriately identifies WhisperGate samples as malicious.](https://www.paloaltonetworks.com/products/secure-the-network/wildfire)\nAll observed malicious Discord URLs have been flagged as malicious.\n\n\n-----\n\n[Cortex XDR prevents this malware from executing using machine learning-based local](https://www.paloaltonetworks.com/cortex/cortex-xdr)\nanalysis, the Behavioral Threat Protection module and the ransomware protection module.\n\nThe Cortex XSOAR \"WhisperGate & CVE-2021-32648'' pack can help automatically detect and\n[mitigate the two threats. Read more on the XSOAR marketplace.](https://xsoar.pan.dev/marketplace/details/WhisperGateCVE202132648)\n\nIf you think you may have been compromised or have an urgent matter, get in touch with the Unit\n42 Incident Response team or call North America Toll-Free: 866.486.4842 (866.4.UNIT42),\nEMEA: +31.20.299.3130, APAC: +65.6983.8730, or Japan: +81.50.1790.0200.\n\n## Hunting for WhisperGate\n\nPalo Alto Networks Cortex XDR customers may leverage the following XQL queries, written by\nthe Cortex Managed Threat Hunting service experts, to hunt their datasets for indicators related\nto WhisperGate malware:\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\n// Description: WhisperGate - Self Delete\nconfig case_sensitive = false\n|dataset = xdr_data\n|filter event_type = ENUM.PROCESS and event_sub_type = ENUM.PROCESS_START\n|filter (action_process_image_name = \"cmd.exe\" OR action_process_image_name =\n\"ping.exe\") and action_process_image_command_line contains \"111.111.111.111 -n 5 -w\n10\"\n|fields _time, agent_hostname, actor_effective_username, actor_process_image_path,\nactor_process_image_sha256,action_process_image_path,\naction_process_image_command_line, action_process_image_sha256\n\n// Description: WhisperGate - PowerShell Sleep\nconfig case_sensitive = false\n|dataset = xdr_data\n|filter event_type = ENUM.PROCESS and event_sub_type = ENUM.PROCESS_START\n|filter action_process_image_name = \"powershell.exe\" and\naction_process_image_command_line contains\n\"UwB0AGEAcgB0AC0AUwBsAGUAZQBwACAALQBzACAAMQAwAA==\"\n|fields _time, agent_hostname, actor_effective_username, actor_process_image_path,\nactor_process_image_sha256,action_process_image_path,\naction_process_image_command_line, action_process_image_sha256\n\n// Description: WhisperGate - InstallUtil (Wiper)\nconfig case_sensitive = false\n|dataset = xdr_data\n|filter (event_type = FILE and (event_sub_type = ENUM.FILE_WRITE or event_sub_type\n= ENUM.FILE_CREATE_NEW) and (action_file_name = \"installutil.exe\" AND\naction_file_path contains \"\\appdata\\local\\temp\\installutil.exe\")) or ((event_type =\nENUM.PROCESS and event_sub_type = ENUM.PROCESS_START) and\naction_process_image_name = \"installutil.exe\" and action_process_image_path contains\n\"\\appdata\\local\\temp\\installutil.exe\")\n|dedup agent_id, actor_process_image_command_line, actor_process_image_sha256,\naction_file_path, action_file_sha256, action_process_image_sha256,\naction_process_image_command_line\n\n\n-----\n\n|fields _time, agent_id,agent_hostname, actor_effective_username, action_file_name,\naction_file_path, action_file_sha256, actor_process_image_path,\nactor_process_image_command_line,\nactor_process_image_sha256, action_process_image_path,\naction_process_image_command_line, action_process_image_sha256\n\n// Description: WhisperGate - Disable Defender\nconfig case_sensitive = false\n|dataset = xdr_data\n|filter ((event_type = ENUM.PROCESS and event_sub_type = ENUM.PROCESS_START)\nand (action_process_image_name = \"advancedrun.exe\" and\n(action_process_image_command_line contains \"stop windefend\" OR\naction_process_image_command_line contains \"mdir 'c:\\programdata\\microsoft\\windows\ndefender\")) or (action_process_image_name = \"wscript.exe\" and\naction_process_image_command_line contains \"nmddfrqqrbyjeygggda.vbs\")) or\n(event_type = FILE and (event_sub_type = ENUM.FILE_WRITE or event_sub_type =\nENUM.FILE_CREATE_NEW) and (action_file_name = \"nmddfrqqrbyjeygggda.vbs\"))\n|dedup agent_id, actor_process_image_command_line, actor_process_image_sha256,\naction_file_path, action_file_sha256, action_process_image_sha256,\naction_process_image_command_line\n|fields _time, agent_id,agent_hostname, actor_effective_username, action_file_name,\naction_file_path, action_file_sha256, actor_process_image_path,\nactor_process_image_command_line,\nactor_process_image_sha256, action_process_image_path,\naction_process_image_command_line, action_process_image_sha256\n\n## Conclusion\n\nThe Unit 42 Threat Intelligence team remains vigilant in monitoring this evolving situation, is\nactively hunting for known indicators from recent events and is ready to put protections in place\nto thwart attacks against our customers.\n\nProduct-specific protections have been implemented as a result of research performed in recent\ndays, and those protections will be augmented as needed as more details come to light. Palo\nAlto Networks will update this Threat Brief with new information and recommendations as they\nbecome available.\n\n## Additional Resources\n\n### CVE-2021-32648 Information\n\n WhisperGate Information\n\n_Updated March 4, 2022, at 6:15 a.m. PT._\n\n**Get updates from**\n\n**Palo Alto**\n\n**Networks!**\n\nSign up to receive the latest news, cyber threat intelligence and research from us\n\n\n-----\n\n[By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement.](https://www.paloaltonetworks.com/legal-notices/terms-of-use)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-01-20 - Threat Brief- Ongoing Russia and Ukraine Cyber Conflict.pdf"
    ],
    "report_names": [
        "2022-01-20 - Threat Brief- Ongoing Russia and Ukraine Cyber Conflict.pdf"
    ],
    "threat_actors": [
        {
            "id": "025b7171-98f8-4391-adc2-66333629c715",
            "created_at": "2023-06-23T02:04:34.120175Z",
            "updated_at": "2025-03-27T02:02:09.797581Z",
            "deleted_at": null,
            "main_name": "Cadet Blizzard",
            "aliases": [
                "DEV-0586",
                "Operation Bleeding Bear",
                "Ruinous Ursa"
            ],
            "source_name": "ETDA:Cadet Blizzard",
            "tools": [
                "GO Simple Tunnel",
                "GOST",
                "Impacket",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "P0wnyshell",
                "PAYWIPE",
                "Ponyshell",
                "Pownyshell",
                "WhisperGate",
                "WhisperKill",
                "netcat",
                "reGeorg"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "c28760b2-5ec6-42ad-852f-be00372a7ce4",
            "created_at": "2022-10-27T08:27:13.172734Z",
            "updated_at": "2025-03-27T02:00:55.511386Z",
            "deleted_at": null,
            "main_name": "Ember Bear",
            "aliases": [
                "Ember Bear",
                "UNC2589",
                "Bleeding Bear",
                "DEV-0586",
                "Cadet Blizzard",
                "Frozenvista",
                "UAC-0056"
            ],
            "source_name": "MITRE:Ember Bear",
            "tools": [
                "P.A.S. Webshell",
                "CrackMapExec",
                "ngrok",
                "WhisperGate",
                "Saint Bot",
                "PsExec",
                "Rclone",
                "Impacket",
                "OutSteel"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "bdbf873a-048d-4c5d-9d92-922327cc83a8",
            "created_at": "2023-01-06T13:46:39.387696Z",
            "updated_at": "2025-03-27T02:00:03.071819Z",
            "deleted_at": null,
            "main_name": "DEV-0586",
            "aliases": [
                "Ruinous Ursa",
                "Cadet Blizzard"
            ],
            "source_name": "MISPGALAXY:DEV-0586",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536096,
    "ts_updated_at": 1743041820,
    "ts_creation_date": 1653698202,
    "ts_modification_date": 1653698202,
    "files": {
        "pdf": "https://archive.orkl.eu/f5e61cafafecc409dad33c2e5c7258ac28839fba.pdf",
        "text": "https://archive.orkl.eu/f5e61cafafecc409dad33c2e5c7258ac28839fba.txt",
        "img": "https://archive.orkl.eu/f5e61cafafecc409dad33c2e5c7258ac28839fba.jpg"
    }
}