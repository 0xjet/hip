{
    "id": "64562f8d-4a9c-4def-90a0-ea34cea0ddb6",
    "created_at": "2022-10-25T16:48:16.474749Z",
    "updated_at": "2025-03-27T02:13:29.341127Z",
    "deleted_at": null,
    "sha1_hash": "8b025c4aa9726bfddea650b0a6d28c38ad5b1648",
    "title": "Detecting and Analyzing Network Threats With NetFlow",
    "authors": "",
    "file_creation_date": "2016-02-03T03:16:01Z",
    "file_modification_date": "2016-02-03T00:57:05Z",
    "file_size": 1912279,
    "plain_text": "# Detecting and Analyzing Network Threats With NetFlow\n\nThis document contains information about and instructions for detecting and analyzing network threats such\nas denial of service attacks (DoS) through the use of the following NetFlow features:\n\n  - NetFlow Layer 2 and Security Monitoring Exports--This feature improves your ability to detect and\nanalyze network threats such as denial of service attacks (DoS) by adding 9 fields that NetFlow can\ncapture the values from.A few examples are:\n\n     - IP Time-to-Live field\n\n     - Packet length field\n\n     - ICMP type and code fields\n\n  - NetFlow Dynamic Top Talkers CLI--This feature gives you an overview of the highest volume traffic\nin your network by aggregating flows on a common field. For example, you can aggregate all of the\nflows for a destination network by aggregating them on the destination prefix. There are over 20 fields\nfrom flows that you can aggregate the highest volume traffic on. A few examples are:\n\n     - Source or destination IP address\n\n     - Source or destination prefix\n\n     - Source or destination port\n\n     - ICMP type and code\n\n  - NetFlow Top Talkers--This feature gives you a more detailed view of the traffic in your network than\nthe NetFlow Dynamic Top Talkers CLI feature because it looks at individual flows. You use the\nNetFlow Dynamic Top Talkers CLI feature to quickly identify high volume traffic of interest. You use\nthe NetFlow Top Talkers feature to obtain more detailed information on each of the flows in the high\nvolume traffic.\n\n  - NetFlow Input Filters--This feature tracks a specific subset of NetFlow traffic for the purpose of\nclass-based traffic analysis and monitoring. This feature is used in conjunction with the Top Talkers\nfeature to help you focus your analysis on the traffic that might be a network threat such as a DoS\nattack.\n\n  - Random Sampled NetFlow--This feature is typically used for statistical sampling of network traffic\nfor traffic engineering or capacity planning purposes. It is used in the context of monitoring and\n\n\n-----\n\nanalyzing network threats because it can be used to reduce the impact on the router using NetFlow to\nmonitor traffic that might be a network threat, such as a DoS attack.\n\n            - Finding Feature Information, page 2\n\n            - Prerequisites for Detecting and Analyzing Network Threats With NetFlow, page 2\n\n            - Information About Detecting and Analyzing Network Threats With NetFlow, page 3\n\n            - How to Configure and Use NetFlow to Detect and Analyze Network Threats, page 22\n\n            - Configuration Examples for Detecting and Analyzing Network Threats With NetFlow, page 44\n\n           - Where to Go Next, page 57\n\n            - Additional References, page 57\n\n            - Feature Information for Detecting and Analyzing Network Threats With NetFlow, page 59\n\n           - Glossary, page 60\n\n## Finding Feature Information\n\nYour software release may not support all the features documented in this module. For the latest caveats and\n[feature information, see Bug Search Tool and the release notes for your platform and software release. To](http://www.cisco.com/cisco/psn/bssprt/bss)\nfind information about the features documented in this module, and to see a list of the releases in which each\nfeature is supported, see the feature information table at the end of this module.\n\nUse Cisco Feature Navigator to find information about platform support and Cisco software image support.\n[To access Cisco Feature Navigator, go to www.cisco.com/go/cfn. An account on Cisco.com is not required.](http://www.cisco.com/go/cfn)\n\n## Prerequisites for Detecting and Analyzing Network Threats With NetFlow\n\nBefore you can use NetFlow for detecting and analyzing network threats you need to understand NetFlow\nand how to configure your router to capture IP traffic status and statistics using NetFlow. See the Cisco IOS\nNetFlow Overview and Configuring NetFlow and NetFlow Data Export modules for more details.\n\nNetFlow and Cisco Express Forwarding (CEF) or distributed CEF (dCEF) must be configured on your system\nbefore you enable NetFlow.\n\n\n-----\n\n## Information About Detecting and Analyzing Network Threats With NetFlow\n\n### NetFlow Layer 2 and Security Monitoring\n\nThe Layer 2 and Layer 3 fields supported by the NetFlow Layer 2 and Security Monitoring Exports feature\nincrease the amount of information that can be obtained by NetFlow about the traffic in your network. You\ncan use the network traffic information for applications such as traffic engineering and usage-based billing.\n\nLayer 3 fields captured by the NetFlow Layer 2 and Security Monitoring Exports feature improve the capabilities\nof NetFlow for identifying DoS attacks. Layer 2 IP header fields help identify the path that the DoS attack is\ntaking through the network.\n\nLayer 2 and Layer 3 fields are not key fields. They provide additional information about the traffic in an\nexisting flow. Changes in the values of NetFlow key fields, such as the source IP address, from one packet\nto the next packet results in the creation of a new flow. For example, if the first packet captured by NetFlow\nhas a source IP address of 10.34.0.2 and the second packet captured has a source IP address of 172.16.213.65,\nNetFlow will create two separate flows.\n\nMost DoS attacks consist of an attacker sending the same type of IP datagram repeatedly, in an attempt to\noverwhelm target systems. In such cases, the incoming traffic often has similar characteristics, such as the\nsame values in each datagram for one or more fields that the NetFlow Layer 2 and Security Monitoring Exports\nfeature can capture.\n\nThe originator of DoS attacks cannot be easily identified because the IP source address of the device sending\nthe traffic is usually forged. However, you can easily trace the traffic back through the network to the router\non which it is arriving by using the NetFlow Layer 2 and Security Monitoring Exports feature to capture the\nMAC address and VLAN-ID fields. If the router on which traffic is arriving supports NetFlow, you can\n\n\n-----\n\nconfigure the NetFlow Layer 2 and Security Monitoring Exports feature on it to identify the interface on\nwhich the traffic is arriving. The figure below shows an example of an attack in progress.\n\n**Figure 1: DoS Attack Arriving over the Internet**\n\n**Note** You can analyze the data captured by NetFlow directly from the router by using the show ip cache verbose\n**flow command or by the Cisco Network Services (CNS) NetFlow Collector Engine.**\n\nOnce you have concluded that a DoS attack is taking place by analyzing the Layer 3 fields in the NetFlow\nflows, you can analyze the Layer 2 fields in the flows to discover the path that the DoS attack is taking through\nthe network.\n\nAn analysis of the data captured by the NetFlow Layer 2 and Security Monitoring Exports feature, for the\nscenario shown in the above figure, indicates that the DoS attack is arriving on Router C, because the upstream\nMAC address is from the interface that connects Router C to Switch A. It is also evident that there are no\nrouters between the target host (the e-mail server) and the NetFlow router, because the destination MAC\naddress of the DoS traffic that the NetFlow router is forwarding to the e-mail server is the MAC address of\nthe e-mail server.\n\nYou can learn the MAC address that Host C is using to send traffic to Router C by configuring the NetFlow\nLayer 2 and Security Monitoring Exports feature on Router C. The source MAC address will be from Host\nC. The destination MAC address will be for the interface on the NetFlow router.\n\nOnce you know the MAC address that Host C is using and the interface on Router C on which Host C’s DoS\nattack is arriving, you can mitigate the attack by reconfiguring Router C to block Host C’s traffic. If Host C\nis on a dedicated interface, you can disable the interface. If Host C is using an interface that carries traffic\nfrom other users, you must configure your firewall to block Host C’s traffic, but still allow the traffic from\nthe other users to flow through Router C.\n\n\n-----\n\n#### Layer 3 Information Capture Using NetFlow Layer 2 and Security Monitoring Exports\n\nThe five fields that the NetFlow Layer 2 and Security Monitoring Exports feature captures from Layer 3 IP\ntraffic in a flow are the following:\n\n          - Internet Control Message Protocol (ICMP) type and code\n\n            - ID field\n\n           - Fragment offset\n\n           - Packet length field\n\n           - Time-to-live field\n\nFigure 5 shows the fields in an IP packet header.\n\n**Figure 2: IP Packet Header Fields**\n\nTable 4 describes the header fields in Figure 5.\n\n**Table 1: IP Packet Header Fields**\n\n|Field|Description|\n|---|---|\n|Version|The version of the IP protocol. If this field is set to 4, it is an IPv4 datagram. If this field is set to 6, it is an IPv6 datagram. Note IPv4 and IPv6 headers have different structures.|\n|IHL (Internet Header Length)|Internet Header Length is the length of the Internet header in 32-bit word format and thus points to the beginning of the data. Note The minimum value for the correct header length is 5.|\n|ToS|Type of service (ToS) provides an indication of the abstract parameters of the quality of service desired. These parameters are to be used to guide the selection of the actual service parameters when a networking device transmits a datagram through a particular network.|\n|Total Length|Total length is the length of the datagram, measured in octets, including Internet header and data.|\n\n\n-----\n\n|Field|Description|\n|---|---|\n|Identification (ID)|The value in the ID field is entered by the sender. All the fragments of an IP datagram have the same value in the ID field. Subsequent IP datagrams from the same sender will have different values in the ID field. Frequently, a host receives fragmented IP datagrams from several senders concurrently. Also, frequently a host receives multiple IP datagrams from the same sender concurrently. The value in the ID field is used by the destination host to ensure that the fragments of an IP datagram are assigned to the same packet buffer during the IP datagram reassembly process. The unique value in the ID field is used to prevent the receiving host from mixing together IP datagram fragments of different IP datagrams from the same sender during the IP datagram reassembly process.|\n|Flags|A sequence of three bits is used to set and track IP datagram fragmentation parameters. The bits are: • 001—The IP datagram can be fragmented. More fragments of the current IP datagram are in transit. • 000—The IP datagram can be fragmented. This is the last fragment of the current IP datagram. • 010—The IP datagram cannot be fragmented. This is the entire IP datagram.|\n|Fragment Offset|This field indicates where in the datagram this fragment belongs.|\n|TTL (Time-to-Live)|This field indicates the maximum time the datagram is allowed to remain in the Internet system. If this field contains the value 0, then the datagram must be destroyed. This field is modified in Internet header processing. The TTL is measured in units of seconds, but because every module that processes a datagram must decrease the TTL by at least 1 even if it processes the datagram in less than a second, the TTL must be thought of only as an upper bound on the time a datagram can exist. The intention is to discard undeliverable datagrams and bound the maximum datagram lifetime.|\n|Protocol|Indicates the type of transport packet included in the data portion of the IP datagram. Common values are: • 1—ICMP • 6—TCP • 17—UDP|\n|Header checksum|A checksum on the header only. Because some header fields, such as the TTL field, change every time an IP datagram is forwarded, this value is recomputed and verified at each point that the Internet header is processed.|\n\n\n-----\n\n|Field|Description|\n|---|---|\n|Source IP Address|IP address of the sending station.|\n|Destination IP Address|IP address of the destination station.|\n|Options and Padding|The options and padding may appear in datagrams. If they do appear, they must be implemented by all IP modules (host and gateways). Options and padding are always implemented in any particular datagram; transmissions are not.|\n\n\nFigure 6 shows the fields in an ICMP datagram.\n\n**Figure 3: ICMP Datagram**\n\nTable 5 interprets the packet format in the figure seen above. ICMP datagrams are carried in the data area of\nan IP datagram, after the IP header.\n\n**Table 2: ICMP Packet Format**\n\n|Type|Name|Codes|\n|---|---|---|\n|0|Echo reply|0—None.|\n|1|Unassigned|—|\n|2|Unassigned|—|\n\n\n-----\n\n|Type|Name|Codes|\n|---|---|---|\n|3|Destination unreachable|0—Network unreachable. 1—Host unreachable. 2—Protocol unreachable. 3—Port unreachable. 4—Fragmentation needed and don't fragment (DF) bit set. 5—Source route failed. 6—Destination network unknown. 7—Destination host unknown. 8—Source host isolated. 9—Communication with the destination network is administratively prohibited. 10—Communication with the destination host is administratively prohibited. 11—Destination network unreachable for ToS. 12—Destination host unreachable for ToS.|\n|4|Source quench|0—None.|\n|5|Redirect|0—None. 0—Redirect datagram for the network. 1—Redirect datagram for the host. 2—Redirect datagram for the ToS and network. 3—Redirect datagram for the ToS and host.|\n|6|Alternate host address|0—Alternate address for the host.|\n|7|Unassigned|—|\n|8|Echo|0—None.|\n|9|Router advertisement|0—None.|\n|10|Router selection|0—None.|\n|11|Time exceeded|0—Time to live exceeded in transit.|\n|12|Parameter problem|0—Pointer indicates the error. 1—Missing a required option. 2—Inappropriate length.|\n\n\n-----\n\n|Type|Name|Codes|\n|---|---|---|\n|13|Timestamp|0—None.|\n|14|Timestamp reply|0—None.|\n|15|Information request|0—None.|\n|16|Information reply|0—None.|\n|17|Address mask request|0—None.|\n|18|Address mask reply|0—None.|\n|19|Reserved (for security)|—|\n|20–29|Reserved (for robustness experiment)|—|\n|30|Trace route|—|\n|31|Datagram conversion error|—|\n|32|Mobile host redirect|—|\n|33|IPv6 where-are-you|—|\n|34|IPv6 I-am-here|—|\n|35|Mobile registration request|—|\n|36|Mobile registration reply|—|\n|37–255|Reserved|—|\n\n\n#### Layer 2 Information Capture Using NetFlow Layer 2 and Security Monitoring Exports\n\nThe NetFlow Layer 2 and Security Monitoring Exports feature can capture the values of the MAC address\nand VLAN ID fields from flows. The two supported VLAN types are 802.1q and the Cisco Inter-Switch Link\n(ISL) protocol.\n\n**Layer 2 MAC Address Fields**\n\nThe Layer 2 fields for which the NetFlow Layer 2 and Security Monitoring Exports feature captures the values\nare as follows:\n\n           - The source MAC address field from frames that are received by the NetFlow router.\n\n           - The destination MAC address field from frames that are transmitted by the NetFlow router.\n\n\n-----\n\n  - The VLAN ID field from frames that are received by the NetFlow router.\n\n  - The VLAN ID field from frames that are transmitted by the NetFlow router.\n\nFigure 2 shows the Ethernet Type II and Ethernet 802.3 frame formats. The destination address field and the\nsource address field in the frame formats are the MAC address values that are captured by NetFlow.\n\n**Figure 4: Ethernet Type II and 802.3 Frame Formats**\n\nTable 1 explains the fields for the Ethernet frame formats.\n\n**Table 3: Ethernet Type II and 802.3 Frame Fields**\n\n|Field|Description|\n|---|---|\n|Preamble|The entry in the Preamble field is an alternating pattern of 0s and 1s that communicates to receiving stations about an incoming frame. It also provides a means for the receiving stations to synchronize their clocks with the incoming bit stream.|\n|SOF (Start of frame)|The SOF field holds an alternating pattern of 0s and 1s, ending with two consecutive 1s, indicating that the next bit is the first bit of the first byte of the destination MAC address.|\n|Destination Address|The 48-bit destination address identifies which station on the LAN should receive the frame. The first two bits of the destination MAC address are reserved for the following special functions: • The first bit in the destination address field indicates whether the address is an individual address (0) or a group address (1). • The second bit indicates whether the destination address is globally administered (0) or locally administered (1). The remaining 46 bits form a uniquely assigned value that identifies a single station, a defined group of stations, or all stations on the network.|\n|Source Address|The 48-bit source address identifies which station transmitted the frame. The source address is always an individual address, and the leftmost bit in the Source Address field is always 0.|\n\n\n-----\n\n|Field|Description|\n|---|---|\n|Type or Length|Type—In an Ethernet Type II frame, a part of the frame is used for the Type field. The Type field is used to identify the next layer protocol in the frame. Length—In an 802.3 Ethernet frame, a part of the frame is used for the Length field. The Length field is used to indicate the length of the Ethernet frame. The value can be from 46 to 1500 bytes.|\n|Data or 802.2 header and data|Ethernet Type II—46 to 1500 bytes of data or 802.3/802.2—8 bytes of header and 38 to 1492 bytes of data.|\n|FCS (Frame Check Sequence)|This field contains a 32-bit cyclic redundancy check (CRC) value, which is created by the sending station and is recalculated by the receiving station, to check for damaged frames. The FCS is generated for the destination address, source address, Type, and Data fields of the frame. The FCS does not include the data portion of the frame.|\n\n\n**Layer 2 VLAN ID Fields**\n\nNetFlow can capture the value in the VLAN ID field for 802.1q tagged VLANs and Cisco ISL encapsulated\nVLANs. This section describes the two types of VLANs, 802.1q and ISL.\n\n**Note** ISL and 802.1q are commonly called VLAN encapsulation protocols.\n\n\n-----\n\n**Understanding 802.1q VLANs**\n\nDevices that use 802.1q insert a four-byte tag into the original frame before it is transmitted. Figure 3 shows\nthe format of an 802.1q tagged Ethernet frame.\n\n**Figure 5: 802.1q Tagged Ethernet Type II or 802.3 Frame**\n\nTable 2 describes the fields for 802.1q VLANs.\n\n**Table 4: 802.1q VLAN Encapsulation Fields**\n\n|Field|Description|\n|---|---|\n|Destination Address|The 48-bit destination address identifies which stations on the LAN should receive the frame. The first two bits of the destination MAC address are reserved for the following special functions: • The first bit in the destination address field indicates whether the address is an individual address (0) or a group address (1). • The second bit indicates whether the destination address is globally administered (0) or locally administered (1). The remaining 46 bits form a uniquely assigned value that identifies a single station, a defined group of stations, or all stations on the network.|\n|Source Address|The 48-bit source address identifies which station transmitted the frame. The source address is always an individual address, and the leftmost bit in the Source Address field is always 0.|\n\n\n-----\n\n|Field|Description|\n|---|---|\n|Type or Length|Type—In an Ethernet Type II frame, a part of the frame is used for the Type field. The Type field is used to identify the next layer protocol in the frame. Length—In an 802.3 Ethernet frame, a part of the frame is used for the Length field. The Length field is used to indicate the length of the Ethernet frame. The value can be from 46 to 1500 bytes.|\n|Data or 802.2 header and data|Ethernet Type II—46 to 1500 bytes of data or 802.3/802.2—8 bytes of header and 38 to 1492 bytes of data.|\n|FCS (Frame Check Sequence)|This field contains a 32-bit cyclic redundancy check (CRC) value, which is created by the sending station and is recalculated by the receiving station, to check for damaged frames. The FCS is generated for the destination address, source address, Type, and Data fields of the frame. The FCS does not include the data portion of the frame.|\n|Tag Protocol ID (TPID)|This 16-bit field is set to a value of 0x8100 to identify the frame as an IEEE 802.1q tagged frame.|\n|Priority|This 3-bit field refers to the 802.1p priority. It is also known as user priority. It indicates the frame priority level used for prioritizing traffic and can represent levels 0–7.|\n|Tag Control Information|This 2-byte Tag Control Information field consists of the following two subfields: • Canonical Format Indentifier (CFI)—If the value of this 1-bit field is 1, the MAC address is in noncanonical format. If the value of this field is 0, the MAC address is in canonical format. • VLAN ID—This 12-bit field uniquely identifies the VLAN to which the frame belongs. It can have a value from 0 to 4095.|\n\n\n**Cisco ISL VLANs**\n\nISL is a Cisco-proprietary protocol for encapsulating frames on a VLAN trunk. Devices that use ISL add an\nISL header to the frame. This process is known as VLAN encapsulation. 802.1Q is the IEEE standard for\ntagging frames on a VLAN trunk. Figure 4 shows the format of a Cisco ISL-encapsulated Ethernet frame.\n\n**Figure 6: Cisco ISL Tagged Ethernet Frame**\n\n\n-----\n\nTable 3 describes the fields for 802.1q VLANs.\n\n**Table 5: ISL VLAN Encapsulation**\n\n|Field|Description|\n|---|---|\n|DA (destination address)|This 40-bit field is a multicast address and is set at 0n01-00-0c-00-00 or 0n03-00-0c-00-00. The receiving host determines that the frame is encapsulated in ISL by reading the 40-bit DA field and matching it with one of the two ISL multicast addresses.|\n|TYPE|This 4-bit field indicates the type of frame that is encapsulated and to indicate alternative encapsulations. TYPE codes: • 0000—Ethernet • 0001—Token Ring • 0010—FDDI • 0011—ATM|\n|USER|This 4-bit field is used to extend the meaning of the Frame TYPE field. The default USER field value is 0000. For Ethernet frames, the USER field bits 0 and 1 indicate the priority of the packet as it passes through the switch. Whenever traffic can be handled more quickly, the packets with this bit set should take advantage of the quicker path. However, such paths are not required. USER codes: • xx00—Normal priority • xx01—Priority 1 • xx10—Priority 2 • xx11—Highest priority|\n|SA|This 48-bit field is the source address field of the ISL packet. It should be set to the 802.3 MAC address of the switch port transmitting the frame. The receiving device can ignore the SA field of the frame.|\n\n\n-----\n\n|Field|Description|\n|---|---|\n|LEN|This 16-bit value field stores the actual packet size of the original packet. The LEN field represents the length of the packet in bytes, excluding the DA, TYPE, USER, SA, LEN, and FCS fields. The total length of the excluded fields is 18 bytes, so the LEN field represents the total length minus 18 bytes.|\n|AAAA03(SNAP)|The AAAA03 Subnetwork Access Protocol (SNAP) field is a 24-bit constant value of 0xAAAA03.|\n|HSA|This 24-bit field represents the upper three bytes (the manufacturer’s ID portion) of the SA field. It must contain the value 0x00-00-0C.|\n|VLAN|This 15-bit field is the virtual LAN ID of the packet. This value is used to mark frames on different VLANs.|\n|BPDU|The bit in the bridge protocol data unit (BPDU) field is set for all BPDU packets that are encapsulated by the ISL frame. The BPDUs are used by the spanning tree algorithm to learn information about the topology of the network. This bit is also set for Cisco Discovery Protocol and VLAN Trunk Protocol (VTP) frames that are encapsulated.|\n|INDEX|This 16-bit field indicates the port index of the source of the packet as it exits the switch. It is used for diagnostic purposes only, and may be set to any value by other devices. It is ignored in received packets.|\n|RES|This 16-bit field is used when Token Ring or FDDI packets are encapsulated with an ISL frame.|\n|Encapsulated FRAME|This field contains the encapsulated Layer 2 frame.|\n|FCS|The FCS field consists of 4 bytes. It includes a 32-bit CRC value, which is created by the sending station and is recalculated by the receiving station, to check for damaged frames. The FCS covers the DA, SA, Length/Type, and Data fields. When an ISL header is attached to a Layer 2 frame, a new FCS is calculated over the entire ISL packet and added to the end of the frame. Note The addition of the new FCS does not alter the original FCS that is contained within the encapsulated frame.|\n\n\n-----\n\n### NetFlow Top Talkers\n\nThe usual implementation of NetFlow exports NetFlow data to a collector. The NetFlow Top Talkers features\ncan be used for security monitoring or accounting purposes for top talkers, and matching and identifying key\ntraffic in your network. These features are also useful for a network location where a traditional NetFlow\nexport operation is not possible. The NetFlow Top Talkers features do not require a collector to obtain\ninformation regarding flows. Instead, the NetFlow data is displayed on the router when the NetFlow Dynamic\nTop Talkers CLI show ip flow top command, or the NetFlow Top Talkers show ip flow top-talkersis used.\n\n#### Comparison of the NetFlow Dynamic Top Talkers CLI and NetFlow Top Talkers Features\n\nThere are two very similar NetFlow features that can be used for monitoring the highest volume traffic in\nyour network. The feature names are:\n\n**NetFlow Dynamic Top Talkers CLI**\n\nThis feature was introduced in 12.4(4)T. The NetFlow Dynamic Top Talkers CLI feature is used to obtain an\noverview of the highest volume traffic (top talkers) in your network. It provides an overview of the traffic by\naggregating the flows in the cache based on the aggregation field that you select when you use the NetFlow\nDynamic Top Talkers CLI feature.\n\nThe NetFlow Dynamic Top Talkers CLI feature does not require modifications to the configuration of the\nrouter. The show ip flow top command is the only command that you need to use for the NetFlow Dynamic\nTop Talkers CLI feature. You can invoke any of the NetFlow Dynamic Top Talkers CLI options directly from\nthe show ip flow top command whenever you need them.\n\n\n**Note**\n\n\nThe information that you want to use the NetFlow Dynamic Top Talkers CLI feature to analyze must be\navailable in the cache. For example, if you want to be able to identify the MAC address in the flows, you\nmust configure the ip flow-capture mac-addresses command in order to capture the values from the\nMAC address fields in the traffic first.\n\nThe NetFlow Dynamic Top Talkers CLI feature aggregates flows and allows them to be sorted so that they\ncan be viewed. The flows can be aggregated on fields in the cache such as source or destination IP address,\nICMP type and code values, and so forth. For a full list of the fields that you can aggregate the flows on, refer\nto the show ip flow topcommand in the Cisco IOS NetFlow command reference documentation.\n\nThe aggregated top talker flows can be sorted by any of the following criteria:\n\n  - The aggregated field in the display data\n\n  - The number of bytes in the display data\n\n  - The number of flows in the display data\n\n  - The by number of packets in the display data\n\n  - In ascending or descending order (to find the least used Top talker)\n\nIn addition to sorting top talkers, you can further organize your output by specifying criteria that the top talkers\nmust match, such as source or destination IP address or port. The match keyword is used to specify this\n\n\n-----\n\ncriterion. For a full list of the matching criterion that you can select, refer to the show ip flow topcommand\nin the Cisco IOS NetFlow command reference documentation.\n\nThe NetFlow Dynamic Top Talkers CLI feature can help you quickly identify traffic that is associated with\nsecurity threats such as DoS attacks because it does not require configuration modifications. You can change\nthe NetFlow Dynamic Top Talkers CLI options for identifying and analyzing network threats in the aggregated\nflows on-the-fly as you learn more about the traffic that is of interest. For example, after you have identified\nthat there is a lot of ICMP traffic in your network by using the show ip flow top 10 aggregate icmp command\nyou can learn what IP networks the traffic is being sent to by using the show ip flow top 10 aggregate icmp\n**match destination-prefix 172.0.0.0/8 command.**\n\n**Note** A high volume of ICMP traffic might indicate that an ICMP-based DoS attack is in progress.\n\nThe show ip flow top command:\n\n      - Does not require additional NetFlow configuration commands to display top talkers. Therefore you do\nnot need to supply the configuration mode password to the administrators who use the he show ip flow\n**top command to monitor network traffic. The only prerequisite for using the show ip flow top command**\nis that you have configured NetFlow on at least one interface on the router.\n\n      - Aggregates flows automatically based on the aggregation method that you select, and independently of\nany netflow aggregation cache(s).\n\n      - Allows you to change the parameters of the command, such as the number of flows to display, the display\norder, and match criterion, on-the-fly every time that you use the command without having to change\nthe router’s configuration.\n\n      - Allows you to sort the display output in ascending or descending order based on:\n\n         - The aggregated field\n\n        - The number of bytes\n\n        - The number of flows,\n\n        - The number of packets\n\n**show ip flow top and show ip cache verbose flow**\n\nMany of the values shown in the display output of the show ip cache verbose flow command are in\nhexadecimal. If you want to match these values using the show ip flow top command with the match keyword,\nyou must enter the field value that you want to match in hexadecimal. For example, to match on the destination\nport of 00DC in the following except from the show ip cache verbose flow command, you would use the\n**match destination-port 0x00DC keywords and argument for the show ip flow top command.**\n\n```\nSrcIf SrcIPaddress DstIf DstIPaddress Pr TOS Flgs Pkts\nPort Msk AS Port Msk AS NextHop B/Pk Active\nEt0/0.1 10.10.11.4 Et1/0.1 172.16.10.8 06 00 00 209\n00DC /0 0 00DC\n /0 0 0.0.0.0 40 281.4\nMAC: (VLAN id) aaaa.bbbb.cc03 (005) aaaa.bbbb.cc06 (006)\nMin plen: 40 Max plen: 40\nMin TTL: 59 Max TTL: 59\nIP id: 0\n\n```\n\n-----\n\n**Match Criteria with the show ip flow top command**\n\nYou can limit the top talkers that are displayed by the show ip flow top command by using the match keyword\nand arguments. For example, you can display the IP destination address top talkers that have a prefix of\n224.0.0.0 using the show ip flow top 10 aggregate destination-address match destination-prefix 224.0.0.0/3\ncommand.\n\nFor a full list of the matching criterion that you can select, refer to the show ip flow topcommand in the Cisco\n_IOS NetFlow Command Reference . If you do not configure match criteria all of the flows are considered as_\ncandidates for aggregation as top talkers based on the volume of traffic they represent.\n\n**The Order That Aggregation Occurs in**\n\nWith the exception of the flows keyword, all matches are performed prior to aggregation, and only matching\nflows are aggregated. For example, the show ip flow top5aggregate destination-address match\n**destination-prefix 172.16.0.0/16 command analyzes all of the available flows looking for any flows that**\nhave destination addresses that match the destination-prefix value of 172.16.0.0/16. If it finds any matches\nit aggregates them, and then displays the number of aggregated destination-address flows that is equal to\nthe number of top talkers that were requested in the command-in this case five.\n\nThe flows keyword matches the number of aggregated flows post-aggregation. For example, the show ip flow\n**top 2 aggregate destination-address match 6 command aggregates all of the flows on the values in their**\ndestination IP address field, and then displays the top talkers that have 6 aggregated flows.\n\n**Number of Flows Matched**\n\nIf you do not specify match criteria and there is traffic in the flows that includes the field that you used to\naggregate the flows on, all of the flows will match. For example, if your router has 20 flows with IP traffic\nand you enter the show ip flow top 10 aggregate destination-address command the display will indicate\nthat 20 of 20 flows matched, and the 10 top talkers will be displayed.\n\nIf you use the match keyword to limit the flows that are aggregated to the flows with a destination prefix of\n224.0.0.0/3, and only one flow matches this criterion the output will indicate that one out of six flows matched.\nFor example, if your router has 6 flows with IP traffic, but only one of them has a destination prefix of\n224.0.0.0/3, and you enter the show ip flow top 10 aggregate destination-address match destination-prefix\n_224.0.0.0/3 command, the display will indicate that 1 of 6 flows matched._\n\nIf the total number of top talkers is less than the number of top talkers that were requested in the command,\nthe total number of top talkers is displayed. For example, if you enter a value of five for the number of top\ntalkers to display and there are only three top talkers that match the criteria that you used, the display will\nonly include three top talkers.\n\nWhen a match criterion is included with the show ip flow top command, the display output will indicate \"N\nof M flows matched\" where N <= M, N = matched flows, and M = total flows seen. The numbers of flows\nseen could potentially be more than the total number of flows in the cache if some of the analyzed flows were\nremoved from the cache and new flows were created ahead of the current point, as the top talkers feature\nsweeps through the cache. Therefore, M is NOT the total number of flows in the cache, but rather, the number\nof observed flows.\n\nIf you attempt to display the top talkers by aggregating them on a field that is not in the cache you will see\nthe \"% aggregation-field\" is not available for this cache\" message. For example, if you use the show ip flow\n**top 5 aggregate s ource-vlan command, and you have not enabled the capture of VLAN IDs from the flows,**\nyou will see the \"% VLAN id is not available for this cache\" message.\n\n\n-----\n\n**NetFlow Top Talkers**\n\nThis feature was introduced in 12.3(11)T. NetFlow Top Talkers is used to obtain information about individual\nflows in the cache. It does not aggregate the flows like the NetFlow Dynamic Top Talkers CLI feature.\n\nThe NetFlow Top Talkers feature compares all of the flows and displays information about each of the flows\nthat have the heaviest traffic volumes (top talkers). The show ip flow top-talkerscommand requires you to\npre-configure the router using the NetFlow Top Talkers configuration commands:\n\n              - ip flow-top-talkers --Enters the NetFlow Top Talkers configuration mode.\n\n               - sort-by --Selects the sort order for the flows in the display output.\n\n                 - bytes--Sort the flows based on the numbers of bytes in each flow.\n\n                 - packets--Sort the flows based on the numbers of packets in each flow.\n\n              - top --Specifies the number of top talkers to monitor.\n\n              - match (optional)--Specifies additional criteria, such as IP addresses, port numbers, and so forth, that\nmust be matched in the flow to qualify as a candidate for top talker status.\n\nFor a full list of the matching criterion that you can select, refer to the ip flow top-talkerscommand in the\n_Cisco IOS NetFlow Command Reference . If you do not configure match criteria all of the flows are considered_\nas candidates as top talkers based on the volume of traffic they represent.\n\n              - show ip flow top talkers [verbose]--Displays the flows.\n\nFor more information on the NetFlow Top Talkers feature, refer to Configuring NetFlow Top Talkers using\nCisco IOS CLI Commands or SNMP Commands.\n\n### Filtering and Sampling of NetFlow Traffic\n\nNetFlow provides highly granular per-flow traffic statistics in a Cisco router. A flow is a unidirectional stream\nof packets that arrive at the router on the same subinterface, have the same source and destination IP addresses,\nLayer 4 protocol, TCP/UDP source and destination ports, and the same ToS (type of service) byte in the IP\nheaders. The router accumulates NetFlow statistics in a NetFlow cache and can export them to an external\ndevice (such as the Cisco Networking Services (CNS) NetFlow Collection Engine) for further processing.\n\nFull NetFlow accounts for all traffic entering the subinterface on which it is enabled. But in some cases, you\nmight gather NetFlow data on only a subset of this traffic. The Random Sampled NetFlow feature and the\nNetFlow Input Filters feature each provide ways to limit incoming traffic to only traffic of interest for NetFlow\nprocessing. Random Sampled NetFlow provides NetFlow data for a subset of traffic in a Cisco router by\nprocessing only one randomly selected packet out of n sequential packets. The NetFlow Input Filters feature\nprovides the capability to gather NetFlow data on only a specific user-defined subset of traffic.\n\n\n-----\n\n**Note**\n\n\nRandom Sampled NetFlow is more statistically accurate than Sampled NetFlow. NetFlow's ability to\nsample packets was first provided by a feature named Sampled NetFlow. The methodology that the\nSampled NetFlow feature uses is deterministic sampling, which selects every nth packet for NetFlow\nprocessing on a per-interface basis. For example, if you set the sampling rate to 1 out of 100 packets, then\nSampled NetFlow samples the 1st, 101st, 201st, 301st, and so on packets. Sampled NetFlow does not\nallow random sampling and thus can make statistics inaccurate when traffic arrives in fixed patterns.\n\n\n**Note** The Random Sampled NetFlow algorithms are applied after input filtering.\n\nThe table below compares the NetFlow Input Filters feature and the NetFlow Random Sampled feature.\n\n**Table 6: Comparison of the NetFlow Input Filters Feature and the Random Sampled NetFlow Feature**\n\n|Comparison Category|NetFlow Input Filters Feature|Random Sampled NetFlow Feature|\n|---|---|---|\n|Brief description|This feature enables you to gather NetFlow data on only a specific subset of traffic. You do this by creating filters to select flows for NetFlow processing. For example, you can select flows from a specific group of hosts. This feature also lets you select various sampling rates for selected flows.|This feature provides NetFlow data for a subset of traffic in a Cisco router by processing only one randomly selected packet out of n sequential packets (n is a user-configurable parameter). Packets are sampled as they arrive (before any NetFlow cache entries are made for those packets).|\n|Main uses|You can use this feature for class-based traffic analysis and monitoring on-network or off-network traffic. This feature is also useful if you have too much traffic and you want to limit the traffic that is analyzed.|You can use this feature for traffic engineering, capacity planning, and applications where full NetFlow is not needed for an accurate view of network traffic. This feature is also useful if you have too much traffic and you want to limit the traffic that is analyzed.|\n|Export format support|This feature is supported in the Version 5 and Version 9 NetFlow export formats.|This feature is supported in the Version 5 and Version 9 NetFlow export formats.|\n|Cisco IOS release support|12.3(4)T.|12.3(2)T, 12.2(18)S, and 12.0(26)S.|\n\n\n-----\n\n|Comparison Category|NetFlow Input Filters Feature|Random Sampled NetFlow Feature|\n|---|---|---|\n|Subinterface support|You can configure NetFlow Input Filters per subinterface as well as per physical interface. You can select more than one filter per subinterface and have all of the filters run simultaneously.|You can configure the Random Sampled NetFlow feature per subinterface as well as per physical interface. You can not run Full NetFlow and Random Sampled NetFlow concurrently on the same subinterface. You must disable full NetFlow on the subinterface before Random Sampled NetFlow will take effect. Traffic is collected only on the subinterfaces on which Random Sampled NetFlow is configured. As with full NetFlow, enabling Random Sampled NetFlow on a physical interface does not enable Random Sampled NetFlow on subinterfaces automatically--you must explicitly configure it on the subinterfaces.|\n|Memory impact|This feature requires no additional memory. It allows you to use a smaller NetFlow cache than full NetFlow, because it significantly reduces the number of flows. This feature requires an insignificant amount of memory for each configured NetFlow filter.|This feature can create a smaller NetFlow cache than full NetFlow if by reducing the number of packets being analyzed the numbers of flows in the cache is also reduced. This feature requires an insignificant amount of memory for each configured NetFlow sampler.|\n|Performance impact|Accounting of classified traffic saves router resources by reducing the number of flows being processed and exported. The amount of bandwidth saved depends on the usage and the class-map criteria. However, performance might degrade depending on the number and complexity of class maps configured in a policy.|Statistical traffic sampling substantially reduces consumption of router resources (especially CPU resources) while providing valuable NetFlow data. This feature substantially reduces the impact of NetFlow data export on interface traffic. For example, a sampling rate of 1 out of 100 packets reduces the export of NetFlow data by about 99% percent.|\n\n\n#### NetFlow Input Filters Flow Classification\n\nFor the NetFlow Input Filters feature, classification of packets can be based on any of the following: IP source\nand destination addresses, Layer 4 protocol and port numbers, incoming interface, MAC address, IP Precedence,\nDSCP value, Layer 2 information (such as Frame-Relay DE bits or Ethernet 802.1p bits), and Network-Based\nApplication Recognition (NBAR) information. The packets are classified (filtered) on the above criteria, and\nflow accounting is applied to them on subinterfaces.\n\nThe filtering mechanism uses the Modular QoS Command-Line Interface (MQC) to classify flows. You can\ncreate multiple filters with matching samplers on a per-subinterface basis. For example, you can subdivide\nsubinterface traffic into multiple classes based on type of service (ToS) values or destination prefixes (or\n\n\n-----\n\nboth). For each class, you can also configure sampling at a different rate, using higher rates for higher-priority\nclasses of traffic and lower rates for lower-priority ones.\n\nMQC has many policies (actions) such as bandwidth rate and queuing management. These policies are applied\nonly if a packet matches a criterion in a class map that is applied to the subinterface. A class map contains a\nset of match clauses and instructions on how to evaluate the clauses and acts as a filter for the policies, which\nare applied only if a packet’s content satisfies the match clause. The NetFlow Input Filters feature adds NetFlow\naccounting to the MQC infrastructure, which means that flow accounting is done on a packet only if it satisfies\nthe match clauses.\n\nTwo types of filter are available:\n\n             - ACL-based flow-mask filters\n\n               - Fields of filter (source IP address, destination IP address, source application port, destination application\nport, port protocol, ToS bits, and TCP flags)\n\nFor more information on Modular QoS Command-Line Interface (MQC) refer to the Cisco IOS Quality of\n_Service Solutions Configuration Guide ._\n\n#### Random Sampled NetFlow Sampling Mode\n\nSampling mode makes use of an algorithm that selects a subset of traffic for NetFlow processing. In the\nrandom sampling mode that the Random Sampled NetFlow feature uses, incoming packets are randomly\nselected on average one out of each n sequential packets is selected for NetFlow processing. For example, if\nyou set the sampling rate to 1 out of 100 packets, then NetFlow might sample the 5th packet and then the\n120th, 230th, 302nd, and so on. This sample configuration provides NetFlow data on 1 percent of total traffic.\nThe n value is a parameter that you can configure from 1 to 65535 packets.\n\n#### Random Sampled NetFlow The NetFlow Sampler Map\n\nRandom Sampled NetFlow is useful if you have too much traffic and you want to limit the traffic that is\nanalyzed. A NetFlow sampler map is created with the flow-sampler-map sampler-map-name command. The\nsampling mode for the sampler map is configured with the mode random one-out-of sampling-rate command.\nThe range of values for the sampling-rate argument is 1 to 65535. Each NetFlow sampler map can be applied\nto one or many subinterfaces as well as physical interfaces. The sampler map is applied to an interface or\nsubinterface with the flow-sampler sampler-map-name command. You can define up to eight NetFlow sampler\nmaps.\n\n## How to Configure and Use NetFlow to Detect and Analyze Network Threats\n\nUsing NetFlow to detect and analyze network threats requires a combination of configuration commands and\nshow commands. You start by configuring the NetFlow Layer 2 and Security Monitoring Exports feature to\ncapture values of the additional non-key fields from the flows so that they can be displayed in the cache by\nthe NetFlow show commands. Capturing the values in the additional non-key fields is required so that you\ncan identify the path the traffic is taking through the network and other characteristics of the traffic such as\nTTL values and packet length values.\n\n\n-----\n\n### Prerequisites\n\n\nAfter you configure the NetFlow Layer 2 and Security Monitoring Exports feature, you use the NetFlow\nDynamic Top Talkers CLI command to obtain an overview of the traffic flows the router is forwarding. The\noverview displays information such as the protocol distribution in the flows, the source ip addresses that are\nsending the flows, and the networks the flows are being sent to.\n\nAfter you identify the type of flows that you want to focus, on such as ICMP traffic, and other characteristics\nsuch as source IP addresses and destination network prefixes, you use the NetFlow Top Talkers feature to\nobtain more focused and detailed information on the individual flows. The NetFlow Top Talkers feature is\nconfigured with match criteria that focuses it on the types of traffic that you have identified. If your router is\nkeeping track of several flows and you are only interested in analyzing a subset of them you, can configure\nNetFlow Input Filters to limit the flows that NetFlow is tracking.\n\nCEF or dCEF must be configured globally, and on the interface that you want to run NetFlow on, before you\nconfigure NetFlow Layer 2 and Security Monitoring Exports.\n\nYou must have NetFlow enabled on at least one interface in the router before you configure NetFlow Layer\n2 and Security Monitoring Exports.\n\nIf you want to capture the values of the Layer 3 IP fragment offset field from the IP headers in your IP traffic\nusing the ip flow-capture fragment-offset command, your router must be running Cisco IOS 12.4(2)T or\nlater.\n\nThis section contains the following procedures:\n\n\n### Configuring NetFlow Layer 2 and Security Monitoring Exports\n\nPerform the following task to configure the NetFlow Layer 2 and Security Monitoring Exports feature.\n\n**Before You Begin**\n\nTo export the data captured with the NetFlow Layer 2 and Security Monitoring feature, you must configure\nNetFlow to use the NetFlow Version 9 data export format.\n\n**SUMMARY STEPS**\n\n**1. enable**\n\n**2. configure terminal**\n\n**3. ip flow-capture fragment-offset**\n\n**4. ip flow-capture icmp**\n\n**5. ip flow-capture ip-id**\n\n**6. ip flow-capture mac-addresses**\n\n**7. ip flow-capture packet-length**\n\n**8. ip flow-capture ttl**\n\n**9. ip flow-capture vlan-id**\n\n**10. interface type interface-type interface-number ]**\n\n**11. ip flow ingress**\n\n**12. end**\n\n\n-----\n\n**DETAILED STEPS**\n\n|Col1|Command or Action|Purpose|\n|---|---|---|\n|Step 1|enable Example: Router> enable|Enables privileged EXEC mode. • Enter your password if prompted.|\n|Step 2|configure terminal Example: Router# configure terminal|Enters global configuration mode.|\n|Step 3|ip flow-capture fragment-offset Example: Router(config)# ip flow-capture fragment-offset|Enables capturing the value of the IP fragment offset field from the first fragmented IP datagram in a flow.|\n|Step 4|ip flow-capture icmp Example: Router(config)# ip flow-capture icmp|Enables you to capture the value of the ICMP type and code fields from the first ICMP datagram in a flow.|\n|Step 5|ip flow-capture ip-id Example: Router(config)# ip flow-capture ip-id|Enables you to capture the value of the IP-ID field from the first IP datagram in a flow.|\n|Step 6|ip flow-capture mac-addresses Example: Router(config)# ip flow-capture mac-addresses|Enables you to capture the values of the source and destination MAC addresses from the first Layer 2 frame in a flow.|\n|Step 7|ip flow-capture packet-length Example: Router(config)# ip flow-capture packet-length|Enables you to capture the minimum and maximum values of the packet length field from IP datagrams in a flow.|\n|Step 8|ip flow-capture ttl Example: Router(config)# ip flow-capture ttl|Enables you to capture the minimum and maximum values of the Time-to-Live (TTL) field from IP datagrams in a flow.|\n\n\n-----\n\n|Col1|Command or Action|Purpose|\n|---|---|---|\n|Step 9|ip flow-capture vlan-id Example: Router(config)# ip flow-capture vlan-id|Enables you to capture the 802.1q or ISL VLAN-ID field from first VLAN encapsulated Layer 2 frame in a flow that is received or transmitted on a trunk port.|\n|Step 10|interface type interface-type interface-number ] Example: Router(config)# interface ethernet 0/0|Enters interface configuration mode for the type of interface specified in the command.|\n|Step 11|ip flow ingress Example: and/or Example: ip flow egress Example: Router(config-if)# ip flow ingress Example: and/or Example: Router(config-if)# ip flow egress|Enables ingress NetFlow data collection on the interface. and/or Enables egress NetFlow data collection on the interface.|\n|Step 12|end Example: Router(config)# end|Returns to privileged EXEC mode.|\n\n\n### Verifying NetFlow Layer 2 and Security Monitoring Exports\n\nThis task verifies that NetFlow Layer 2 and Security Monitoring Exports is configured correctly. The show\n**ip cache verbose flowcommand gives a detailed view of the status and statistics for flows in the NetFlow**\nmain cache. The values for the NetFlow non-key fields that you have configured with the NetFlow Layer 2\nand Security Monitoring Exports feature are included for each flow.\n\n\n-----\n\n#### Restrictions\n\n**SUMMARY STEPS**\n\n\nTo see the values of the fields that you have configured the NetFlow Layer 2 and Security Monitoring Exports\nfeature to capture, your router must be forwarding IP traffic that meets the criteria for these fields. For example,\nif you configure the ip flow-capture vlan-id command, your router must be forwarding IP datagrams over\ninterfaces that are configured as VLAN trunks to capture the VLAN-ID values from the layer-two frames\ncarrying the IP datagrams in the flow.\n\n**Displaying Detailed NetFlow Cache Information on Platforms Running Distributed Cisco Express**\n**Forwarding**\n\nOn platforms running dCEF, NetFlow cache information is maintained on each line card or Versatile Interface\nProcessor. If you want to use the show ip cache verbose flow command to display this information on a\ndistributed platform, you must enter the command at a line card prompt.\n\n**Cisco 7500 Series Platform**\n\nTo display detailed NetFlow cache information on a Cisco 7500 series router that is running distributed dCEF,\nenter the following sequence of commands:\n\n```\nslot-number\nLCslot-number\n# show ip cache verbose\n flow\n\n```\nFor Cisco IOS Releases 12.3(4)T, 12.3(6), and 12.2(20)S and later, enter the following command to display\ndetailed NetFlow cache information:\n\nRouter# execute-on slot-number show ip cache verbose flow\n\nTo verify the configuration of NetFlow Layer 2 and Security Monitoring Exports use the following step.\n\n**1. show ip cache verbose flow**\n\n```\nRouter# if-con\n\n```\n```\nslot-number\nLCslot-number\n# show ip cache verbose\n flow\n\n```\nFor Cisco IOS Releases 12.3(4)T, 12.3(6), and 12.2(20)S and later, enter the following command to display\ndetailed NetFlow cache information:\n\n```\nRouter# execute-on\nslot-number\nshow ip cache verbose\n flow\n\n```\n\n**Cisco 12000 Series Platform**\n\nTo display detailed NetFlow cache information on a Cisco 12000 Series Internet Router, enter the following\nsequence of commands:\n\n```\nRouter# attach\n\n```\n\n-----\n\n**DETAILED STEPS**\n\n**show ip cache verbose flow**\nThis example shows that NetFlow Layer 2 and Security Monitoring Exports is working properly because the values have\nbeen captured from the non-key Layer 3 and Layer 2 fields in the flows. The values captured in the flows are shown in\n**bold text.**\n\n**Example:**\n\n```\nRouter# show ip cache verbose flow\nIP packet size distribution (33978 total packets):\n1-32 64 96 128 160 192 224 256 288 320 352 384 416 448 480\n.856 .143 .000 .000 .000 .000 .000 .000 .000 .000 .000 .000 .000 .000 .000\n512 544 576 1024 1536 2048 2560 3072 3584 4096 4608\n.000 .000 .000 .000 .000 .000 .000 .000 .000 .000 .000\nIP Flow Switching Cache, 278544 bytes\n14 active, 4082 inactive, 59 added\n12452 ager polls, 0 flow alloc failures\nActive flows timeout in 10 minutes\nInactive flows timeout in 15 seconds\nIP Sub Flow Cache, 25736 bytes\n28 active, 996 inactive, 148 added, 59 added to flow\n0 alloc failures, 0 force free\n1 chunk, 1 chunk added\nlast clearing of statistics never\nProtocol Total Flows Packets Bytes Packets Active(Sec) Idle(Sec)\n-------- Flows /Sec /Flow /Pkt /Sec /Flow /Flow\nTCP-SMTP 2 0.0 1730 40 3.6 600.7 0.2\nUDP-other 31 0.0 1 54 0.0 3.6 16.8\nICMP 12 0.0 1728 28 22.0 600.1 0.1\nTotal: 45 0.0 538 29 25.7 189.2 11.6\nSrcIf SrcIPaddress DstIf DstIPaddress Pr TOS Flgs Pkts\nPort Msk AS Port Msk AS NextHop B/Pk Active\n.\n.\n.\nEt0/0.1 10.71.200.138 Et1/0.1 172.16.10.2 01 00 10 696\n0000 /0 0 0C01 /0 0 0.0.0.0 28 241.4\nMAC: (VLAN id) aaaa.bbbb.cc03 (005) aaaa.bbbb.cc06 (006)\nMin plen: 28 Max plen: 28\nMin TTL: 59 Max TTL: 59\nICMP type: 12 ICMP code: 1\nIP id: 0\n\n```\n\n### Using NetFlow Dynamic Top Talkers CLI to Display the Protocol Distribution\n\nYou can obtain a quick overview of the traffic in your network by viewing the protocol distribution. Use this\ntask to display the top talkers (aggregated flows) for these three IPv4 protocol types:\n\n            - 1--ICMP\n\n            - 6--TCP\n\n            - 17--UDP\n\n\n-----\n\n**SUMMARY STEPS**\n\n**DETAILED STEPS**\n\n\n**1. show ip flow top number aggregate aggregate-field sorted-by packets descending**\n\n\n**show ip flow top number aggregate aggregate-field sorted-by packets descending**\nThe following example looks for up to three top talkers, aggregates them on the protocol field, sorts them by packets,\nand displays the output in descending order:\n\n**Example:**\n\n```\nRouter# show ip flow top 3 aggregate protocol sorted-by packets descending\nThere are 3 top talkers:\nIPV4 PROT bytes pkts flows\n========= ========== ========== ==========\n     1 406196 14507 12\n     6 96560 2414 2\n    17 52 1 1\n15 of 15 flows matched.\n\n```\n\nThe table below describes the significant fields shown in the display output.\n\n**Table 7: show ip flow top 3 aggregate protocol sorted-by packets descending Field Descriptions**\n\n|Field|Description|\n|---|---|\n|There are 3 top talkers|The number of top talkers is displayed.|\n|IPV4 PROT|This position in the display output is used to show the field that you selected to aggregate the flows on. The protocol keyword aggregates IPv4 traffic in the flows based on the IPv4 protocol type. In this example there are three IPv4 protocol types in the flows: • 1--ICMP • 6--TCP • 17--UDP|\n|bytes|Displays the numbers of bytes in the aggregated flows for each top talker.|\n|pkts|Displays the numbers of packets in the aggregated flows for each top talker.|\n|flows|Displays the numbers of aggregated flows for each top talker.|\n|15 of 15 flows matched.|Displays the number of flows that matched the command.|\n\n\n-----\n\nAll 15 flows in the router are aggregated into three top talkers. In this example all of the flow traffic is top talker traffic.\n\nThe majority of the traffic is ICMP traffic (IP protocol type 1). This might indicate an ICMP DoS attack is in progress.\n\n### Using NetFlow Dynamic Top Talkers CLI to Display the Source IP Address Top Talkers Sending ICMP Traffic\n\nThe display output from the show ip flow top 10 aggregate protocol sorted-by packets descending used\nin Using NetFlow Dynamic Top Talkers CLI to Display the Protocol Distribution, on page 27 section indicates\nthat there is a possible ICMP-based DoS attack in progress. The next step to take is to identify the flows that\nare sending the ICMP traffic. In this case the flows will be aggregated on the source IP addresses.\n\n**SUMMARY STEPS**\n\n**1. show ip flow top number aggregate aggregate-field sorted-by packets match match-field**\n_match-value_\n\n**DETAILED STEPS**\n\n**show ip flow top number aggregate aggregate-field sorted-by packets match match-field match-value**\nThe following command looks for up to 20 top talkers, aggregates them on the source IP address, sorts them by packets,\nand matches on the protocol icmp:\n\n**Example:**\n\n```\nRouter# show ip flow top 20 aggregate source-address sorted-by packets match protocol icmp\nThere are 6 top talkers:\nIPV4 SRC-ADDR bytes pkts flows\n=============== ========== ========== ==========\n10.132.221.111 90440 3230 1\n10.10.12.1 90440 3230 1\n10.251.138.218 90440 3230 1\n10.71.200.138 90384 3228 1\n10.231.185.254 90384 3228 1\n10.106.1.1 90356 3227 1\n6 of 15 flows matched.\nRouter\n\n```\n\nThe table below describes the significant fields shown in the display.\n\n\n-----\n\n**Table 8: show ip flow top 20 aggregate source-address sorted-by packets match protocol icmp Field Descriptions**\n\n**Field** **Description**\n\nThere are 6 top talkers The number of top talkers is displayed.\n\n**Note** Only 6 top talkers are displayed, even though you\n\nasked for 20, because only 6 of the 15 flows in\nthe cache matched the criteria you specified. The\nnumber 20 is an upper limit that will be applied\nin the event that there are over 20 top talkers.\n\nIPV4 SRC-ADDR This position in the display output is used to show the field\n\nthat you selected to aggregate the flows on.\n\nThe source-addresskeyword aggregates flows based on\nthe source IP address. In this example there are 6 IP source\naddresses with aggregated flows. Each of the IP addresses\nhas 1 flow, therefore no aggregation was performed:\n\n                               - 10.132.221.111\n\n                                - 10.10.12.1\n\n                              - 10.251.138.218\n\n                               - 10.71.200.138\n\n                              - 10.231.185.254\n\n                                - 10.106.1.1\n\nbytes Displays the numbers of bytes in the aggregated flows for\neach top talker.\n\npkts Displays the numbers of packets in the aggregated flows\nfor each top talker.\n\nflows Displays the numbers of aggregated flows for each top\ntalker.\n\n6 of 15flows matched. Displays the number of flows that matched the command.\n\nThe ICMP traffic is aggregated into six top talkers (source IP addresses). Each top talker has one flow. No aggregation\nis performed on this traffic because there is a 1-to-1 correlation of IP source addresses and flows.\n\n|Field|Description|\n|---|---|\n|There are 6 top talkers|The number of top talkers is displayed. Note Only 6 top talkers are displayed, even though you asked for 20, because only 6 of the 15 flows in the cache matched the criteria you specified. The number 20 is an upper limit that will be applied in the event that there are over 20 top talkers.|\n|IPV4 SRC-ADDR|This position in the display output is used to show the field that you selected to aggregate the flows on. The source-addresskeyword aggregates flows based on the source IP address. In this example there are 6 IP source addresses with aggregated flows. Each of the IP addresses has 1 flow, therefore no aggregation was performed: • 10.132.221.111 • 10.10.12.1 • 10.251.138.218 • 10.71.200.138 • 10.231.185.254 • 10.106.1.1|\n|bytes|Displays the numbers of bytes in the aggregated flows for each top talker.|\n|pkts|Displays the numbers of packets in the aggregated flows for each top talker.|\n|flows|Displays the numbers of aggregated flows for each top talker.|\n|6 of 15flows matched.|Displays the number of flows that matched the command.|\n\n\n-----\n\n### Using NetFlow Dynamic Top Talkers CLI to Display the Destination IP Address Top Talkers Receiving ICMP Traffic\n\nThe display output from the show ip flow top 5 aggregate source-address sorted-by packets match protocol\n**icmp command used in Using NetFlow Dynamic Top Talkers CLI to Display the Source IP Address Top**\nTalkers Sending ICMP Traffic, on page 29 section showed the six top talkers (IP source addresses) that are\nsending the 12 ICMP traffic flows. The next step to take is to identify the flows that are the target of the ICMP\ntraffic. In this case the flows will be aggregated on the destination IP addresses.\n\n**SUMMARY STEPS**\n\n**1. show ip flow top number aggregate aggregate-field sorted-by packets match match-field**\n_match-value_\n\n**DETAILED STEPS**\n\n**show ip flow top number aggregate aggregate-field sorted-by packets match match-field match-value**\nThe following command looks for up to 20 top talkers, aggregates them on the destination IP address, sorts them by\npackets, and matches on the protocol icmp\n\n**Example:**\n\n```\nRouter# show ip flow top 20 aggregate destination-address sorted-by packets match protocol icmp\nThere is 1 top talker:\nIPV4 DST-ADDR bytes pkts flows\n=============== ========== ========== ==========\n172.16.10.2 407456 14552 6\n6 of 14 flows matched.\nRouter\n\n```\n\nThe table below describes the significant fields shown in the display.\n\n**Table 9: show ip flow top 20 aggregate destination-address sorted-by packets match protocol icmp Field Descriptions**\n\n|Field|Description|\n|---|---|\n|There is 1 top talker|The number of top talkers is displayed. • The ICMP traffic is aggregated into 6 flows for one destination IP addresses.|\n|IPV4 DST-ADDR|This position in the display output is used to show the field that you selected to aggregate the flows on. The destination-addresskeyword aggregates flows based on the destination IP address. In this example there are 3 IP destination address with aggregated flows. The IP addresses has 8 aggregated flows: • 172.16.10.2|\n\n\n-----\n\n|Field|Description|\n|---|---|\n|bytes|Displays the numbers of bytes in the aggregated flows for each top talker.|\n|pkts|Displays the numbers of packets in the aggregated flows for each top talker.|\n|flows|Displays the numbers of aggregated flows for each top talker.|\n|6 of 14 flows matched.|Displays the number of flows that matched the command.|\n\n\nThe previous task identified six ICMP top talkers based on source IP addresses that each had one flow. This task identified\nthat there is one ICMP top talker based on destination IP addresses that is the target for 6 individual flows. There is a\n1-to-1 correlation between the number of ICMP flows in the top talkers aggregated on the source IP address and the\nnumber of ICMP flows in the top talkers aggregated on the destination IP address. There is a high probability that an\nICMP-based DoS attack on the host with the IP address of 172.16.10.2 is in progress.\n\n### Configuring NetFlow Top Talkers to Monitor Network Threats\n\nThe previous task (Using NetFlow Dynamic Top Talkers CLI to Display the Destination IP Address Top\nTalkers Receiving ICMP Traffic) identified a probable ICMP-based DoS attack on the host with the IP address\n172.16.10.2. This task uses the NetFlow Top Talkers feature to configure the router to monitor the DoS attack\nby tracking the individual ICMP flows. After you have configured the NetFlow Top Talkers feature to focus\non the DoS attack traffic, you can use the show ip flow top-talkers verbose command to identify the path\nthe DoS traffic is taking through the network.\n\nPerform the following task to configure the NetFlow Top Talkers feature.\n\n**SUMMARY STEPS**\n\n**1. enable**\n\n**2. configure terminal**\n\n**3. ip flow-top-talkers**\n\n**4. match destination address ip-address /prefix-mask**\n\n**5. top number**\n\n**6. sort-by [bytes | packets**\n\n**7. end**\n\n\n-----\n\n**DETAILED STEPS**\n\n**Command or Action** **Purpose**\n\n**Step 1** **enable** Enables privileged EXEC mode.\n\n                                      - Enter your password if prompted.\n\n**Example:**\n```\n         Router> enable\n\n```\n**Step 2** **configure terminal** Enters global configuration mode.\n\n**Example:**\n```\n         Router# configure terminal\n\n```\n**Step 3** **ip flow-top-talkers** Enters NetFlow top talkers configuration mode.\n\n**Example:**\n```\n         Router(config)# ip flow-top-talkers\n\n```\n**Step 4** **match destination address ip-address /prefix-mask** Specifies the destination IP addresses to match.\n\n**Example:**\n```\n         Router(config-flow-top-talkers)\n         # match destination address 172.16.10.2/32\n\n```\n**Step 5** **top number** Specifies the maximum number of top talkers that will be\n\nretrieved by a NetFlow top talkers query.\n\n**Example:**\n```\n         Router(config-flow-top-talkers)# top 50\n\n```\n**Step 6** **sort-by [bytes | packets** Specifies the sort criterion for the top talkers.\n\n                                         - The top talkers can be sorted either by the total\n\n**Example:**\n\n`Router(config-flow-top-talkers)# sort-by` number of bytes of each top talker.\n```\n         packets\n\n```\n**Step 7** **end** Exits to privileged EXEC mode.\n\n**Example:**\n```\n         Router(config-flow-top-talkers)# end\n\n### Monitoring and Analyzing the NetFlow Top Talkers Flows\n\n```\nTo monitor and analyze the NetFlow Top Talkers flows, use the following step.\n\n|Col1|Command or Action|Purpose|\n|---|---|---|\n|Step 1|enable Example: Router> enable|Enables privileged EXEC mode. • Enter your password if prompted.|\n|Step 2|configure terminal Example: Router# configure terminal|Enters global configuration mode.|\n|Step 3|ip flow-top-talkers Example: Router(config)# ip flow-top-talkers|Enters NetFlow top talkers configuration mode.|\n|Step 4|match destination address ip-address /prefix-mask Example: Router(config-flow-top-talkers) # match destination address 172.16.10.2/32|Specifies the destination IP addresses to match.|\n|Step 5|top number Example: Router(config-flow-top-talkers)# top 50|Specifies the maximum number of top talkers that will be retrieved by a NetFlow top talkers query.|\n|Step 6|sort-by [bytes | packets Example: Router(config-flow-top-talkers)# sort-by packets|Specifies the sort criterion for the top talkers. • The top talkers can be sorted either by the total number of packets of each top talker or the total number of bytes of each top talker.|\n|Step 7|end Example: Router(config-flow-top-talkers)# end|Exits to privileged EXEC mode.|\n\n\n-----\n\n**SUMMARY STEPS**\n\n**DETAILED STEPS**\n\n\n**1. show ip flow top-talkers verbose**\n\n\n**show ip flow top-talkers verbose**\nThe following sample shows details for the six traffic flows that are being sent to the host with IP address 172.16.10.2.\n\n**Example:**\n\n```\nRouter# show ip flow top-talkers verbose\nSrcIf SrcIPaddress DstIf DstIPaddress Pr TOS Flgs Bytes\nPort Msk AS Port Msk AS NextHop B/Pk Active\nEt0/0.1 10.106.1.1 Et1/0.1 172.16.10.2 01 00 10 9408\n0000 /0 0 0800 /0 0 0.0.0.0 28 116.3\nMAC: (VLAN id) aaaa.bbbb.cc03 (005) aaaa.bbbb.cc06 (006)\nMin plen: 28 Max plen: 28\nMin TTL: 59 Max TTL: 59\nICMP type: 8 ICMP code: 0\nIP id: 0\nEt0/0.1 10.132.221.111 Et1/0.1 172.16.10.2 01 00 10 9408\n0000 /0 0 0800 /0 0 0.0.0.0 28 116.4\nMAC: (VLAN id) aaaa.bbbb.cc03 (005) aaaa.bbbb.cc06 (006)\nMin plen: 28 Max plen: 28\nMin TTL: 59 Max TTL: 59\nICMP type: 8 ICMP code: 0\nIP id: 0\nEt0/0.1 10.10.12.1 Et1/0.1 172.16.10.2 01 00 10 9408\n0000 /0 0 0C01 /0 0 0.0.0.0 28 116.4\nMAC: (VLAN id) aaaa.bbbb.cc03 (005) aaaa.bbbb.cc06 (006)\nMin plen: 28 Max plen: 28\nMin TTL: 59 Max TTL: 59\nICMP type: 12 ICMP code: 1\nIP id: 0\nEt0/0.1 10.251.138.218 Et1/0.1 172.16.10.2 01 00 10 9408\n0000 /0 0 0C01 /0 0 0.0.0.0 28 116.4\nMAC: (VLAN id) aaaa.bbbb.cc03 (005) aaaa.bbbb.cc06 (006)\nMin plen: 28 Max plen: 28\nMin TTL: 59 Max TTL: 59\nICMP type: 12 ICMP code: 1\nIP id: 0\nEt0/0.1 10.71.200.138 Et1/0.1 172.16.10.2 01 00 10 9408\n0000 /0 0 0C01 /0 0 0.0.0.0 28 116.5\nMAC: (VLAN id) aaaa.bbbb.cc03 (005) aaaa.bbbb.cc06 (006)\nMin plen: 28 Max plen: 28\nMin TTL: 59 Max TTL: 59\nICMP type: 12 ICMP code: 1\nIP id: 0\nEt0/0.1 10.231.185.254 Et1/0.1 172.16.10.2 01 00 10 9408\n0000 /0 0 0C01 /0 0 0.0.0.0 28 116.5\nMAC: (VLAN id) aaaa.bbbb.cc03 (005) aaaa.bbbb.cc06 (006)\nMin plen: 28 Max plen: 28\nMin TTL: 59 Max TTL: 59\nICMP type: 12 ICMP code: 1\nIP id: 0\n6 of 50 top talkers shown. 6 of 8 flows matched.\n\n```\n\n**Note** Only six of the eight flows matched because the rest of the flows are not top talker flows.\n\n**Note** The top 50 flows were requested, however there are only eight flows in the cache.\n\nThis display output contains the information required for determining the path that the DoS attack traffic is taking through\nthe network. This information will be used to react to the DoS attack by adding security measures such as access-lists\n\n\n-----\n\nto the affected interfaces. The table below describes the significant fields in the display from the show ip flow top-talkers\n**verbose command for determining the network path the DoS traffic is taking.**\n\n**Table 10: Significant Field Descriptions for show ip flow top-talkers verbose**\n\n|Field|Description|\n|---|---|\n|SrcIf|Interface on which the packet was received. • All of the ICMP DoS traffic is being received on Et0/0.1|\n|SrcIPaddress|This is the source IP address of the traffic in the six top talkers. The traffic is using 6 different IP source addresses • 10.132.221.111 • 10.10.12.1 • 10.251.138.218 • 10.71.200.138 • 10.231.185.254 • 10.106.1.1|\n|DstIf|Interface from which the packet was transmitted. • All of the ICMP DoS traffic is being transmitted over Et1/0.1 Note If an asterisk (*) immediately follows the DstIf field, the flow being shown is an egress flow.|\n|ICMP Type|The ICMP datagram types • 8--Echo • 12--Parameter Problem|\n|ICMP Code|The ICMP codes • 0--None (not applicable) • 1--Depends on the ICMP Type • A code value of 1 for ICMP type 12 indicates that a required option is missing|\n|DstIPaddress|This is the destination IP address of the traffic. Note 172.17.10.2 is the IP address that is being attacked.|\n\n\n-----\n\n|Field|Description|\n|---|---|\n|MAC|These are the source and destination MAC addresses from the traffic. The source and destination MAC address are read from left to right in the output. • The traffic is being received from MAC address aaa.bbb.cc03. Note This MAC address is interface 1/0.1 on router R2. • The traffic is being transmitted to MAC address aaa.bbb.cc06. Note This MAC address is interface 1/0.1 on router R4.|\n|VLAN id|These are the source and destination VLAN IDs. The source and destination VLAN IDs are read from left to right in the output. • The traffic is being received from VLAN 5. • The traffic is being transmitted to VLAN 6.|\n\n\nThe flows in this example show only the ICMP DoS attack traffic that is destined for the host with IP address 172.16.10.2.\nThese flows were created specifically for documenting this task. In a real network, the host under attack might be\ncommunicating with other hosts that are using legitimate applications such as e-mail and web sites. In this case, the Top\nTalkers match filter on the destination IP address (match destination address 172.16.10.2/32) that was configured in\nthe Configuring NetFlow Top Talkers to Monitor Network Threats, on page 32 will not limit the display of the show\n**ip flow top-talkers command to the ICMP DoS attack traffic.**\n**Note** For more information on the fields in the display output of the show ip cache verbose flow command, refer to\nthe Cisco IOS NetFlow Command Reference .\n\nIf you are using the Top Talkers feature to analyze a network threat and you are not able to use the basic match filters\nto limit the display of the show ip flow top-talkers command to the traffic that you are analyzing, you can use NetFlow\nfiltering and sampling to limit the traffic that shows up in the display of the show ip flow top-talkers command. The\nprocess for configuring NetFlow filtering and sampling is explained in the Configuring NetFlow Filtering and Sampling,\non page 36.\n\n### Configuring NetFlow Filtering and Sampling\n\nIf you use the show ip cache flow command or the show ip cache verbose flow command to display the\nflows in the cache, you will see the ICMP flows that are selected by NetFlow filtering and sampling on\ninterface Ethernet0/0.1, and flows for all NetFlow supported traffic types on any other interfaces that NetFlow\nis running on. The show ip flow top-talkers [verbose] command is used to display the flow status and statistics\nfor the traffic type you configured with the match criteria over interfaces to which you applied the service\n\n\n-----\n\n**Note**\n\n\npolicy. For example, in this case you configured top talkers to match on ICMP traffic sent from any host that\nis arriving on Ethernet0/0.1 and destined for 172.16.10.2.\n\nIn this task the Top Talkers feature is being used more as a flow filter to separate flows of interest from all of\nthe flows the router is seeing, rather than a filter to display the flows with the highest traffic volumes. Top\ntalkers is used in this manner because in this example all of the ICMP DoS attack flows are of interest, not\njust the flows with the highest volumes. This is why a large value is assigned to the top keyword in the top\ntalkers configuration. Setting the value for the top keyword to 50 when the largest number of ICMP DoS\nattack flows tracked by the router is 12 ensures that all of the ICMP DoS attack flows will be tracked.\n\nIf your router sees a significant number of flows involved in a DoS attack, you might want to set the value\nfor the top keyword to a number that is less than the total number of flows to limit the number of flows that\nyou see in the display when you use the show ip flow top-talkerscommand. This will ensure that you are\nseeing the flows that have the highest volume of DoS attack traffic. However, if all of the flows have the same\ntraffic volume, the show ip flow top-talkerscommand will not be able to differentiate between them. It\ndisplays the number of flows that you set the value of the top keyword to, starting from the first flow in the\ncache.\n\nPerform the following task to configure NetFlow Filtering and sampling.\n\n**Restrictions for NetFlow Input Filters**\n\nOn Cisco 7500 platforms, the NetFlow Input Filters feature is supported only in distributed mode.\n\n**Restrictions for Random Sampled NetFlow**\n\nIf full NetFlow is enabled on an interface, it takes precedence over Random Sampled NetFlow (which\nwill thus have no effect). Disable full NetFlow on an interface before enabling Random Sampled NetFlow\non that interface.\n\nEnabling Random Sampled NetFlow on a physical interface does not automatically enable Random\nSampled NetFlow on subinterfaces; you must explicitly configure it on subinterfaces. Also, disabling\nRandom Sampled NetFlow on a physical interface (or a subinterface) does not enable full NetFlow. This\nrestriction prevents the transition to full NetFlow from overwhelming the physical interface (or subinterface).\nIf you want full NetFlow, you must explicitly enable it.\n\nYou must use NetFlow Version 9 if you want to use sampler option templates or view NetFlow sampler\nIDs.\n\n\n-----\n\n**SUMMARY STEPS**\n\n**DETAILED STEPS**\n\n\n**1. enable**\n\n**2. configure terminal**\n\n**3. flow-sampler-map sampler-map-name**\n\n**4. mode random one-out-of** **packet-interval**\n\n**5. exit**\n\n**6. class-map class-map-name** [match-all | match-any]\n\n**7. match access-group access-group**\n\n**8. exit**\n\n**9. policy-map policy-map-name**\n\n**10. class { class-name** **| class-default}**\n\n**11. netflow-sampler sampler-map-name**\n\n**12. exit**\n\n**13. exit**\n\n**14. interface interface-type interface-number [.subinterface number]**\n\n**15. no [ip route-cache flow | ip flow ingress]**\n\n**16. service-policy {input | output} policy-map-name**\n\n**17. exit**\n\n**18. ip flow-top-talkers**\n\n**19. top number**\n\n**20. sort-by packets**\n\n**21. match class-map claas-name**\n\n**22. no match destination address ip-address /prefix-mask**\n\n**23. exit**\n\n**24. access-list access-list-number permit icmp source destination**\n\n**25. end**\n\n|Col1|Command or Action|Purpose|\n|---|---|---|\n|Step 1|enable Example: Router> enable|Enables privileged EXEC mode. • Enter your password if prompted.|\n|Step 2|configure terminal Example: Router# configure terminal|Enters global configuration mode.|\n|Step 3|flow-sampler-map sampler-map-name|Defines a statistical sampling NetFlow export flow sampler map.|\n\n\n-----\n\n|Col1|Command or Action|Purpose|\n|---|---|---|\n||Example: Router(config)# flow-sampler-map icmp-dos-fs-map|• The sampler-map-name argument is the name of the flow sampler map to be defined. Entering the flow-sampler-map command enables the flow sampler configuration mode.|\n|Step 4|mode random one-out-of packet-interval Example: Router(config-sampler-map)# mode random one-out-of 2|Specifies a statistical sampling NetFlow export random sampling mode and a packet interval. • The random keyword specifies that sampling uses the random sampling mode. • The one-out-of packet-interval argument-keyword pair specifies the packet interval (one out of every npackets) from which to sample. For n, you can specify from 1 to 65535 (packets).|\n|Step 5|exit Example: Router(config-sampler-map)# exit|Exits back to global configuration mode.|\n|Step 6|class-map class-map-name [match-all | match-any] Example: Router(config)# class-map match-any icmp-dos-class-map|Creates a class map to be used for matching packets to a specified class. • The class-map-name argument is the name of the class for the class map. The name can be a maximum of 40 alphanumeric characters. The class name is used for both the class map and for configuring policy for the class in the policy map. • The match-all | match-anykeywords determine how packets are evaluated when multiple match criteria exist. Packets must either meet all of the match criteria (match-all) or only one of the match criteria (match-any) to be considered a member of the class. Entering the class-mapcommand enables class-map configuration mode, in which you can enter one of the match commands to configure the match criteria for this class.|\n|Step 7|match access-group access-group Example: Router(config-cmap)# match access-group 101|Configures the match criteria for a class map on the basis of the specified access control list (ACL). • The access-group argument is a numbered ACL whose contents are used as the match criteria against which packets are checked to determine if they belong to this class. An ACL number can be a number from 1 to 2699.|\n|Step 8|exit Example: Router(config-cmap)# exit|Exits back to global configuration mode.|\n\n\n-----\n\n|Col1|Command or Action|Purpose|\n|---|---|---|\n|Step 9|policy-map policy-map-name Example: Router(config)# policy-map icmp-dos-policy-map|Creates or modifies a policy map that can be attached to one or more interfaces to specify a service policy. • The policy-map-name argument is the name of the policy map. The name can be a maximum of 40 alphanumeric characters. Entering the policy-mapcommand enables quality of service (QoS) policy-map configuration mode, in which you can configure or modify the class policies for that policy map|\n|Step 10|class { class-name | class-default} Example: Router(config-pmap)# class icmp-dos-class-map|Specifies the name of the class whose policy you want to create or change or specifies the default class (commonly known as the class-default class) before you configure its policy. • The class-name argument is the name of the class for which you want to configure or modify policy. • The class-default keyword specifies the default class so that you can configure or modify its policy. Entering the class command enables QoS policy-map class configuration mode.|\n|Step 11|netflow-sampler sampler-map-name Example: Router(config-pmap-c)# netflow-sampler icmp-dos-fs-map|Enables a NetFlow input filter sampler. • The sampler-map-name argument is the name of the NetFlow sampler map to apply to the class. You can assign only one NetFlow input filter sampler to a class. Assigning another NetFlow input filter sampler to a class overwrites the previous one.|\n|Step 12|exit Example: Router(config-pmap-c)# exit|Exits back to policy-map configuration mode.|\n|Step 13|exit Example: Router(config-pmap# exit|Exits back to global configuration mode.|\n|Step 14|interface interface-type interface-number [.subinterface number] Example: Router(config)# interface Ethernet0/0.1|Specifies the interface and enters subinterface configuration mode. • The interface-type argument is the type of interface to be configured. • The interface-numberargument is the number of the interface. Refer to the appropriate hardware manual for slot and port information.|\n\n\n-----\n\n|Col1|Command or Action|Purpose|\n|---|---|---|\n|Step 15|no [ip route-cache flow | ip flow ingress] Example: Router(config-subif)# no ip flow ingress|Removes the existing NetFlow command from the interface. Note NetFlow sampling and filtering can not start if there is another command on the interface that is enabling NetFlow.|\n|Step 16|service-policy {input | output} policy-map-name Example: Router(config-subif)# service-policy input icmp-dos-policy-map|Attaches a policy map to an input interface or virtual circuit (VC), or an output interface or VC, to be used as the service policy for that interface or VC. • The input keyword attaches the specified policy map to the input interface or input VC. • The output keyword attaches the specified policy map to the output interface or output VC. • The policy-map-name is the name of a service policy map (created through use of the policy-map command) to be attached. The name can be a maximum of 40 alphanumeric characters.|\n|Step 17|exit Example: Router(config-subif)# exit|Exits back to global configuration mode.|\n|Step 18|ip flow-top-talkers Example: Router(config)# ip flow-top-talkers|Enters NetFlow top talkers configuration mode.|\n|Step 19|top number Example: Router(config-flow-top-talkers)# top 50|Specifies the maximum number of top talkers that will be retrieved by a NetFlow top talkers query.|\n|Step 20|sort-by packets Example: Router(config-flow-top-talkers)# sort-by packets|Specifies the sort criterion for the top talkers. • The top talkers can be sorted either by the total number of packets of each top talker or the total number of bytes of each top talker.|\n|Step 21|match class-map claas-name Example: Router(config-flow-top-talkers)# match class-map icmp-dos-class-map|Specifies that the match criteria should be obtained from the class-map.|\n\n\n-----\n\n|Col1|Command or Action|Purpose|\n|---|---|---|\n|Step 22|no match destination address ip-address /prefix-mask Example: Router(config-flow-top-talkers)# no match destination address 172.16.10.2/32|(Optional) If you still have a match entry for the destination address you should remove it so that only the class-name match criteria is used.|\n|Step 23|exit Example: Router(config-sampler-map)# exit|Exits back to global configuration mode.|\n|Step 24|access-list access-list-number permit icmp source destination Example: Router(config)# access-list 101 permit icmp any host 172.16.10.2|Creates an extended access list that is used to track any host that is sending ICMP traffic to 172.16.10.2.|\n|Step 25|end Example: Router(config)# end|Exits to privileged EXEC mode.|\n\n\n### Verify NetFlow Filtering and Sampling\n\nTo verify that filtering and sampling is working properly, use the following step.\n\n**SUMMARY STEPS**\n\n**1. show flow-sampler**\n\n**DETAILED STEPS**\n\n**show flow-sampler**\nAny non-zero value in the display output below indicates that Filtering and sampling is active.\n\n**Example:**\n\n```\nRouter# show flow-sampler\n\n```\n\n-----\n\n```\n      Sampler : icmp-dos-fs-map, id : 1, packets matched : 63226, mode : random sampling mode\n        sampling interval is : 2\n      Router\n\n### Monitoring and Analyzing the Sampled and Filtered NetFlow Top Talkers Flows\n\n```\nTo monitor and analyze the filtered and sampled NetFlow top talkers flows use the following step.\n\n**SUMMARY STEPS**\n\n**1. show ip flow top-talkers**\n\n**2. show ip flow top-talkers verbose**\n\n**DETAILED STEPS**\n\n**Step 1** **show ip flow top-talkers**\nThe following sample output shows the six traffic flows that are being sent to the host with IP address 172.16.10.2.\n\n**Example:**\n\n```\nRouter# show ip flow top-talkers\nSrcIf SrcIPaddress DstIf DstIPaddress Pr SrcP DstP Bytes\nEt0/0.1 10.231.185.254 Et1/0.1 172.16.10.2 01 0000 0C01 5460\nEt0/0.1 10.106.1.1 Et1/0.1 172.16.10.2 01 0000 0800 5124\nEt0/0.1 10.132.221.111 Et1/0.1 172.16.10.2 01 0000 0800 5012\nEt0/0.1 10.251.138.218 Et1/0.1 172.16.10.2 01 0000 0C01 4844\nEt0/0.1 10.10.12.1 Et1/0.1 172.16.10.2 01 0000 0C01 4704\nEt0/0.1 10.71.200.138 Et1/0.1 172.16.10.2 01 0000 0C01 4396\n6 of 50 top talkers shown. 6 of 7 flows matched.\n\n```\n\n**Step 2** **show ip flow top-talkers verbose**\nThe following sample output below shows the details for the six traffic flows that are being sent to the host with IP\naddress 172.16.10.2.\n\n**Example:**\n\n```\nRouter# show ip flow top-talkers verbose\nSrcIf SrcIPaddress DstIf DstIPaddress Pr TOS Flgs Bytes\nPort Msk AS Port Msk AS NextHop B/Pk Active\nEt0/0.1 10.106.1.1 Et1/0.1 172.16.10.2 01 00 10 2884\n0000 /0 0 0800 /0 0 0.0.0.0 28 64.6\nSampler: 1 Class: 1\nMAC: (VLAN id) aaaa.bbbb.cc03 (005) aaaa.bbbb.cc06 (006)\nMin plen: 28 Max plen: 28\nMin TTL: 59 Max TTL: 59\nICMP type: 8 ICMP code: 0\nIP id: 0\nEt0/0.1 10.132.221.111 Et1/0.1 172.16.10.2 01 00 10 2828\n0000 /0 0 0800 /0 0 0.0.0.0 28 64.6\nSampler: 1 Class: 1\n\n```\n\n-----\n\n```\n      MAC: (VLAN id) aaaa.bbbb.cc03 (005) aaaa.bbbb.cc06 (006)\n      Min plen: 28 Max plen: 28\n      Min TTL: 59 Max TTL: 59\n      ICMP type: 8 ICMP code: 0\n      IP id: 0\n      Et0/0.1 10.231.185.254 Et1/0.1 172.16.10.2 01 00 10 2716\n      0000 /0 0 0C01 /0 0 0.0.0.0 28 64.6\n      Sampler: 1 Class: 1\n      MAC: (VLAN id) aaaa.bbbb.cc03 (005) aaaa.bbbb.cc06 (006)\n      Min plen: 28 Max plen: 28\n      Min TTL: 59 Max TTL: 59\n      ICMP type: 12 ICMP code: 1\n      IP id: 0\n      Et0/0.1 10.71.200.138 Et1/0.1 172.16.10.2 01 00 10 2548\n      0000 /0 0 0C01 /0 0 0.0.0.0 28 58.0\n      Sampler: 1 Class: 1\n      MAC: (VLAN id) aaaa.bbbb.cc03 (005) aaaa.bbbb.cc06 (006)\n      Min plen: 28 Max plen: 28\n      Min TTL: 59 Max TTL: 59\n      ICMP type: 12 ICMP code: 1\n      IP id: 0\n      Et0/0.1 10.251.138.218 Et1/0.1 172.16.10.2 01 00 10 2436\n      0000 /0 0 0C01 /0 0 0.0.0.0 28 64.6\n      Sampler: 1 Class: 1\n      MAC: (VLAN id) aaaa.bbbb.cc03 (005) aaaa.bbbb.cc06 (006)\n      Min plen: 28 Max plen: 28\n      Min TTL: 59 Max TTL: 59\n      ICMP type: 12 ICMP code: 1\n      IP id: 0\n      Et0/0.1 10.10.12.1 Et1/0.1 172.16.10.2 01 00 10 2352\n      0000 /0 0 0C01 /0 0 0.0.0.0 28 57.7\n      Sampler: 1 Class: 1\n      MAC: (VLAN id) aaaa.bbbb.cc03 (005) aaaa.bbbb.cc06 (006)\n      Min plen: 28 Max plen: 28\n      Min TTL: 59 Max TTL: 59\n      ICMP type: 12 ICMP code: 1\n      IP id: 0\n      6 of 50 top talkers shown. 6 of 7 flows matched.\n\n## Configuration Examples for Detecting and Analyzing Network Threats With NetFlow\n\n### Configuring NetFlow Layer 2 and Sec Mon Exports to Capture Traffic From a Simulated FTP Attack Example\n\n```\nThe following example shows how to use the NetFlow Layer 2 and Security Monitoring Exports feature to\nfind out whether your network is being attacked by a host that is sending fake FTP traffic in an attempt to\noverwhelm the FTP server. This attack might cause end users to see a degradation in the ability of the FTP\nserver to accept new connections or to service existing connections.\n\nThis example uses the network shown in the figure below. Host A is sending fake FTP packets to the FTP\nserver.\n\n\n-----\n\nThis example also shows you how to use the Layer 2 data captured by the NetFlow Layer 2 and Security\nMonitoring Exports feature to learn where the traffic is originating and what path it is taking through the\nnetwork.\n\n**Figure 7: Test Network**\n\n**Tip** Keep track of the MAC addresses and IP addresses of the devices in your network. You can use them to\nanalyze attacks and to resolve problems.\n\n\n**Note**\n\n\nThis example does not include the ip flow-capture icmpcommand that captures the value of the ICMP\ntype and code fields. The use of the ip flow-capture icmp command is described in \"Configuring NetFlow\nLayer 2 and Sec Mon Exports to Capture Traffic From a Simulated ICMP Attack Example, on page 50.\"\n\n**R2**\n\n```\n!\nhostname R2\n!\ninterface Ethernet0/0\n mac-address aaaa.bbbb.cc02\n ip address 172.16.1.2 255.255.255.0\n!\ninterface Ethernet1/0\n mac-address aaaa.bbbb.cc03\n no ip address\n!\ninterface Ethernet1/0.1\n encapsulation dot1Q 5\n ip address 172.16.6.1 255.255.255.0\n!\n!\nrouter rip\n version 2\n network 172.16.0.0\n no auto-summary\n!\n\n```\n\n-----\n\n**R3**\n\n```\n!\nhostname R3\n!\nip flow-capture fragment-offset\nip flow-capture packet-length\nip flow-capture ttl\nip flow-capture vlan-id\nip flow-capture ip-id\nip flow-capture mac-addresses\n!\ninterface Ethernet0/0\n mac-address aaaa.bbbb.cc04\n no ip address\n!\ninterface Ethernet0/0.1\n encapsulation dot1Q 5\n ip address 172.16.6.2 255.255.255.0\n ip accounting output-packets\n ip flow ingress\n!\ninterface Ethernet1/0\n mac-address aaaa.bbbb.cc05\n no ip address\n!\ninterface Ethernet1/0.1\n encapsulation dot1Q 6\n ip address 172.16.7.1 255.255.255.0\n ip accounting output-packets\n ip flow egress\n!\nrouter rip\n version 2\n network 172.16.0.0\n no auto-summary\n!\n\n```\n\n**R4**\n\n```\n!\nhostname R4\n!\ninterface Ethernet0/0\n mac-address aaaa.bbbb.cc07\n ip address 172.16.10.1 255.255.255.0\n!\ninterface Ethernet1/0\n mac-address aaaa.bbbb.cc06\n no ip address\n!\ninterface Ethernet1/0.1\n encapsulation dot1Q 6\n ip address 172.16.7.2 255.255.255.0\n!\nrouter rip\n version 2\n network 172.16.0.0\n no auto-summary\n!\n\n```\n\n-----\n\n### Analyze an FTP DoS Attack Using the show ip cache verbose flow command Example\n\nThe show ip cache verbose flow command displays the NetFlow flows. You can use this display output to\nidentify the path that the FTP traffic from Host A is taking as it is received and transmitted by R3.\n\n**Note** To reduce the space required to display the output from the show ip flow cache verbose flowcommand\nonly the FTP flows are shown.\n\n**Tip** Look for the flows that have FTP in them and make a note of the interfaces, MAC addresses, and VLANs\n(if applicable) for the flows.\n\n```\nR3# show ip cache verbose flow\nIP packet size distribution (189118 total packets):\n  1-32 64 96 128 160 192 224 256 288 320 352 384 416 448 480\n  .043 .610 .000 .000 .000 .000 .000 .000 .000 .000 .000 .000 .000 .000 .000\n  512 544 576 1024 1536 2048 2560 3072 3584 4096 4608\n  .000 .000 .173 .000 .173 .000 .000 .000 .000 .000 .000\nIP Flow Switching Cache, 278544 bytes\n 25 active, 4071 inactive, 615 added\n 263794 ager polls, 0 flow alloc failures\n Active flows timeout in 30 minutes\n Inactive flows timeout in 15 seconds\nIP Sub Flow Cache, 25736 bytes\n 50 active, 974 inactive, 1648 added, 615 added to flow\n 0 alloc failures, 0 force free\n 1 chunk, 1 chunk added\n last clearing of statistics never\nProtocol Total Flows Packets Bytes Packets Active(Sec) Idle(Sec)\n-------- Flows /Sec /Flow /Pkt /Sec /Flow /Flow\nTCP-FTP 12 0.0 895 40 0.9 1363.8 5.5\nTCP-FTPD 12 0.0 895 40 0.9 1363.8 5.6\nTotal: 590 0.0 317 383 16.1 430.1 12.4\nEt0/0.1 192.168.87.200 Et1/0.1 172.16.10.2 06 00 00 63\n0015 /0 0 0015\n /0 0 0.0.0.0 40 94.5\nMAC: (VLAN id) aaaa.bbbb.cc03 (005) aaaa.bbbb.cc06 (006)\nMin plen: 40 Max plen: 40\nMin TTL: 59 Max TTL: 59\nIP id: 0\nEt0/0.1 192.168.87.200 Et1/0.1 172.16.10.2 06 00 00 63\n0014 /0 0 0014\n /0 0 0.0.0.0 40 94.5\nMAC: (VLAN id) aaaa.bbbb.cc03 (005) aaaa.bbbb.cc06 (006)\nMin plen: 40 Max plen: 40\nMin TTL: 59 Max TTL: 59\nIP id: 0\nEt0/0.1 10.10.10.2 Et1/0.1 172.16.10.2 06 00 00 64\n0015 /0 0 0015\n /0 0 0.0.0.0 40 96.0\nMAC: (VLAN id) aaaa.bbbb.cc03 (005) aaaa.bbbb.cc06 (006)\nMin plen: 40 Max plen: 40\nMin TTL: 59 Max TTL: 59\nIP id: 0\nEt0/0.1 10.10.10.2 Et1/0.1 172.16.10.2 06 00 00 64\n0014 /0 0 0014\n /0 0 0.0.0.0 40 96.0\nMAC: (VLAN id) aaaa.bbbb.cc03 (005) aaaa.bbbb.cc06 (006)\n\n```\n\n-----\n\n```\n            Min plen: 40 Max plen: 40\n            Min TTL: 59 Max TTL: 59\n            IP id: 0\n            Et0/0.1 10.234.53.1 Et1/0.1 172.16.10.2 06 00 00 63\n            0015 /0 0 0015\n            /0 0 0.0.0.0 40 94.5\n            MAC: (VLAN id) aaaa.bbbb.cc03 (005) aaaa.bbbb.cc06 (006)\n            Min plen: 40 Max plen: 40\n            Min TTL: 59 Max TTL: 59\n            IP id: 0\n            Et0/0.1 10.234.53.1 Et1/0.1 172.16.10.2 06 00 00 63\n            0014 /0 0 0014\n            /0 0 0.0.0.0 40 94.5\n            MAC: (VLAN id) aaaa.bbbb.cc03 (005) aaaa.bbbb.cc06 (006)\n            Min plen: 40 Max plen: 40\n            Min TTL: 59 Max TTL: 59\n            IP id: 0\n            Et0/0.1 172.30.231.193 Et1/0.1 172.16.10.2 06 00 00 63\n            0015 /0 0 0015\n            /0 0 0.0.0.0 40 94.5\n            MAC: (VLAN id) aaaa.bbbb.cc03 (005) aaaa.bbbb.cc06 (006)\n            Min plen: 40 Max plen: 40\n            Min TTL: 59 Max TTL: 59\n            IP id: 0\n            Et0/0.1 172.30.231.193 Et1/0.1 172.16.10.2 06 00 00 63\n            0014 /0 0 0014\n            /0 0 0.0.0.0 40 94.5\n            MAC: (VLAN id) aaaa.bbbb.cc03 (005) aaaa.bbbb.cc06 (006)\n            Min plen: 40 Max plen: 40\n            Min TTL: 59 Max TTL: 59\n            IP id: 0\n\n```\nThere are 8 FTP flows shown in the output. You can use the Layer 2 information in the flows that is captured\nby the ip flow-capture command to identify the path the traffic is taking through the network. In this example,\nthe traffic is being sent to R3 on VLAN 5 by R2. You can demonstrate that R2 is transmitting the traffic over\ninterface 1/0.1 because the source MAC address (aaaa.bbb.cc03) belongs to 1/0.1 on R2. You can demonstrate\nthat R3 is transmitting the traffic using VLAN 6 on interface 1/0.1 to interface 1/0.1 on R4, because the\ndestination MAC address (aaaa.bbbb.cc06) belongs to interface 1/0.1 on R4.\n\n**Note** For more information on the ip flow-capture command, and the fields in the display output of the show\n**ip cache verbose flow command, refer to the Cisco IOS NetFlow Command Reference .**\n\nYou can use this information to mitigate this attack. One possible way to mitigate this attack is by configuring\nan extended IP access list that blocks all FTP traffic from the source IP addresses that Host A is spoofing and\napplying it Ethernet 0/0 on R2.\n\n### Analyze an FTP DoS Attack Using NetFlow Dynamic Top Talkers CLI Example\n\nYou can use the NetFlow Dynamic Top Talkers CLI feature to quickly identify the FTP top talkers in the\nnetwork traffic that might be sending the traffic. This will show you the IP source addresses that Host A is\nusing as it sends the DoS attack traffic.\n\n```\nR3# show ip flow top 50 aggregate source-address sorted-by bytes descending match\ndestination-port min 20 max 21\nThere are 5 top talkers:\nIPV4 SRC-ADDR bytes pkts flows\n=============== ========== ========== ==========\n10.231.185.254 5640 141 2\n10.132.221.111 3680 92 2\n10.10.12.1 3640 91 2\n10.251.138.218 3600 90 2\n\n```\n\n-----\n\n```\n    10.71.200.138 1880 47 1\n    9 of 34 flows matched.\n\n```\n**Note** Only source IP addresses from FTP traffic are shown because of the match destination-port min 20 max\n_21 criteria. The source addresses are aggregated together so only the most relevant sources are shown._\n\n**Note** Only nine of the 34 flows matched because the rest of the flows are not FTP flows, therefore they do not\nmeet the match criteria (match destination-port min 20 max 21).\n\n**Tip** The top talkers are displayed in descending order of the aggregated field by default.\n\n**Tip** You can enter the port numbers in their decimal values as shown, or in their hexadecimal equivalents of\n0x14 and 0x15.\n\nAfter you have identified FTP top talkers traffic you need to identify the source IP addresses of IP traffic that\nis being sent to the host that you believe is under attack.\n\n```\nR3# show ip flow top 50 aggregate source-address match destination-prefix 172.16.10.2/32\nThere are 6 top talkers:\nIPV4 SRC-ADDR bytes pkts flows\n=============== ========== ========== ==========\n10.251.138.218 6642 18 4\n10.231.185.254 5068 28 4\n10.132.221.111 14818 25 4\n10.106.1.1 12324 12 2\n10.71.200.138 12564 18 3\n10.10.12.1 560 14 2\n19 of 33 flows matched.\n\n```\n\n**Tip** You can specify the host that you believe is under attack by using a prefix value of 32 with the match\n**destination-prefix command.**\n\n\n**Note**\n\n\nOnly 19 of the 33 flows matched because the rest of the flows do not contain traffic that is destined for\nthe host with the IP address of 172.16.10.2, therefore they do not meet the match criteria (match\n**destination-prefix 172.16.10.2/32).**\n\nThe final step is to cross reference the source IP addresses of any hosts that are sending any IP traffic to the\nhost under attack with the list of source IP addresses from the FTP top talkers. This is required because the\n**show ip flow top command does not support multiple match criteria. Therefore you cannot limit the top talkers**\nto FTP traffic being sent to a specific host with a single show ip flow top command (match destination-port\n**min 20 max 21 <and> match destination-prefix 172.16.10.2/32).**\n\nThe host with the IP address of 10.106.1.1 is apparently not involved in this DoS attack because it is not in\nthe display output from the show ip flow top 50 aggregate source-address sorted-by bytes descending\n**match destination-port min 20 max 21 command. This means that it is not sending FTP traffic to the host**\nthat is under attack.\n\n\n-----\n\nTherefore the host IP addressees involved in this FTP DoS attack are likely to be:\n\n             - 10.231.185.254\n\n             - 10.132.221.111\n\n              - 10.10.12.1\n\n             - 10.251.138.218\n\n             - 10.71.200.138\n\nNow that you know the source addresses of the FTP traffic you can configure an extended access list that\nblocks FTP traffic from these address, and apply it to the interface that is closest to the point the traffic is\nentering your network.\n\n**Note** Unless you recognize that some of the source IP addresses are not legitimate IP addresses for your network\nit might not be possible to identify legitimate FTP traffic from FTP DoS attack traffic.\n\n### Configuring NetFlow Layer 2 and Sec Mon Exports to Capture Traffic From a Simulated ICMP Attack Example\n\nThe following example shows how to use the NetFlow Layer 2 and Security Monitoring Exports feature to\nfind out that your network is being attacked by ICMP traffic. It uses the network shown in the figure below.\nHost A is sending ICMP ping packets to the FTP server.\n\n**Figure 8: Test Network**\n\n**Tip** Keep track of the MAC addresses and IP addresses of the devices in your network. You can use them to\nanalyze attacks and to resolve problems.\n\n\n-----\n\n**R2**\n\n```\n!\nhostname R2\n!\ninterface Ethernet0/0\n mac-address aaaa.bbbb.cc02\n ip address 172.16.1.2 255.255.255.0\n!\ninterface Ethernet1/0\n mac-address aaaa.bbbb.cc03\n no ip address\n!\ninterface Ethernet1/0.1\n encapsulation dot1Q 5\n ip address 172.16.6.1 255.255.255.0\n!\n!\nrouter rip\n version 2\n network 172.16.0.0\n no auto-summary\n!\n\n```\n\n**R3**\n\n```\n!\nhostname R3\n!\nip flow-capture fragment-offset\nip flow-capture packet-length\nip flow-capture ttl\nip flow-capture vlan-id\nip flow-capture icmp\nip flow-capture ip-id\nip flow-capture mac-addresses\n!\ninterface Ethernet0/0\n mac-address aaaa.bbbb.cc04\n no ip address\n!\ninterface Ethernet0/0.1\n encapsulation dot1Q 5\n ip address 172.16.6.2 255.255.255.0\n ip accounting output-packets\n ip flow ingress\n!\ninterface Ethernet1/0\n mac-address aaaa.bbbb.cc05\n no ip address\n!\ninterface Ethernet1/0.1\n encapsulation dot1Q 6\n ip address 172.16.7.1 255.255.255.0\n ip accounting output-packets\n ip flow egress\n!\nrouter rip\n version 2\n network 172.16.0.0\n no auto-summary\n!\n\n```\n\n**R4**\n\n```\n!\nhostname R4\n!\n\n```\n\n-----\n\n```\n            interface Ethernet0/0\n            mac-address aaaa.bbbb.cc07\n            ip address 172.16.10.1 255.255.255.0\n            !\n            interface Ethernet1/0\n            mac-address aaaa.bbbb.cc06\n            no ip address\n            !\n            interface Ethernet1/0.1\n            encapsulation dot1Q 6\n            ip address 172.16.7.2 255.255.255.0\n            !\n            router rip\n            version 2\n            network 172.16.0.0\n            no auto-summary\n            !\n\n### Analyze an ICMP Ping DoS Attack Using the show ip cache verbose flow command Example\n\n```\nThe show ip cache verbose flow command displays the NetFlow flows. You can use this display output to\nidentify the path that the ICMP traffic from Host A is taking as it is received and transmitted by R3.\n\n**Note** To reduce the space required to display the output from the show ip flow cache verbose flowcommand\nonly the ICMP flows are shown.\n\n**Tip** Look for the flows that have ICMP in them and make a note of the interfaces, MAC addresses, and VLANs\n(if applicable) for the flows.\n\n```\nR3# show ip cache verbose flow\nIP packet size distribution (122369 total packets):\n  1-32 64 96 128 160 192 224 256 288 320 352 384 416 448 480\n  .065 .665 .000 .000 .000 .000 .000 .000 .000 .000 .000 .000 .000 .000 .000\n  512 544 576 1024 1536 2048 2560 3072 3584 4096 4608\n  .000 .000 .134 .000 .134 .000 .000 .000 .000 .000 .000\nIP Flow Switching Cache, 278544 bytes\n 24 active, 4072 inactive, 404 added\n 176657 ager polls, 0 flow alloc failures\n Active flows timeout in 30 minutes\n Inactive flows timeout in 15 seconds\nIP Sub Flow Cache, 25736 bytes\n 48 active, 976 inactive, 1088 added, 404 added to flow\n 0 alloc failures, 0 force free\n 1 chunk, 1 chunk added\n last clearing of statistics never\nProtocol Total Flows Packets Bytes Packets Active(Sec) Idle(Sec)\n-------- Flows /Sec /Flow /Pkt /Sec /Flow /Flow\nICMP 27 0.0 1131 763 3.9 1557.4 3.6\nTotal: 380 0.0 267 257 13.0 382.8 12.6\nSrcIf SrcIPaddress DstIf DstIPaddress Pr TOS Flgs Pkts\nPort Msk AS Port Msk AS NextHop B/Pk Active\nEt0/0.1 10.106.1.1 Et1/0.1 172.16.10.2 01 00 10 864\n0000 /0 0 0800 /0 0 0.0.0.0 1500 1089.9\nMAC: (VLAN id) aaaa.bbbb.cc03 (005) aaaa.bbbb.cc06 (006)\nMin plen: 1500 Max plen: 1500\nMin TTL: 59 Max TTL: 59\nICMP type: 8 ICMP code: 0\nIP id: 0\n\n```\n\n-----\n\n```\nEt0/0.1 10.71.200.138 Et1/0.1 172.16.10.2 01 00 00 864\n0000 /0 0 0000 /0 0 0.0.0.0 554 1090.0\nMAC: (VLAN id) aaaa.bbbb.cc03 (005) aaaa.bbbb.cc06 (006)\nMin plen: 554 Max plen: 554\nMin TTL: 59 Max TTL: 59\nICMP type: 0 ICMP code: 0\nIP id: 0 FO: 185\nEt0/0.1 10.231.185.254 Et1/0.1 172.16.10.2 01 00 00 864\n0000 /0 0 0000 /0 0 0.0.0.0 554 1090.0\nMAC: (VLAN id) aaaa.bbbb.cc03 (005) aaaa.bbbb.cc06 (006)\nMin plen: 554 Max plen: 554\nMin TTL: 59 Max TTL: 59\nICMP type: 0 ICMP code: 0\nIP id: 0 FO: 185\nEt0/0.1 10.10.12.1 Et1/0.1 172.16.10.200 01 00 00 864\n0000 /0 0 0000 /0 0 0.0.0.0 554 1090.0\nMAC: (VLAN id) aaaa.bbbb.cc03 (005) aaaa.bbbb.cc06 (006)\nMin plen: 554 Max plen: 554\nMin TTL: 59 Max TTL: 59\nICMP type: 0 ICMP code: 0\nIP id: 0 FO: 185\nEt0/0.1 10.132.221.111 Et1/0.1 172.16.10.2 01 00 10 864\n0000 /0 0 0800 /0 0 0.0.0.0 1500 1089.9\nMAC: (VLAN id) aaaa.bbbb.cc03 (005) aaaa.bbbb.cc06 (006)\nMin plen: 1500 Max plen: 1500\nMin TTL: 59 Max TTL: 59\nICMP type: 8 ICMP code: 0\nIP id: 0\nEt0/0.1 10.251.138.218 Et1/0.1 172.16.10.2 01 00 00 864\n0000 /0 0 0000 /0 0 0.0.0.0 554 1089.9\nMAC: (VLAN id) aaaa.bbbb.cc03 (005) aaaa.bbbb.cc06 (006)\nMin plen: 554 Max plen: 554\nMin TTL: 59 Max TTL: 59\nICMP type: 0 ICMP code: 0\nIP id: 0 FO: 185\nEt0/0.1 10.10.12.1 Et1/0.1 172.16.10.200 01 00 10 864\n0000 /0 0 0C01 /0 0 0.0.0.0 1500 1090.0\nMAC: (VLAN id) aaaa.bbbb.cc03 (005) aaaa.bbbb.cc06 (006)\nMin plen: 1500 Max plen: 1500\nMin TTL: 59 Max TTL: 59\nICMP type: 12 ICMP code: 1\nIP id: 0\nEt0/0.1 10.106.1.1 Et1/0.1 172.16.10.2 01 00 00 864\n0000 /0 0 0000 /0 0 0.0.0.0 554 1089.9\nMAC: (VLAN id) aaaa.bbbb.cc03 (005) aaaa.bbbb.cc06 (006)\nMin plen: 554 Max plen: 554\nMin TTL: 59 Max TTL: 59\nICMP type: 0 ICMP code: 0\nIP id: 0 FO: 185\nEt0/0.1 10.251.138.218 Et1/0.1 172.16.10.2 01 00 10 864\n0000 /0 0 0C01 /0 0 0.0.0.0 1500 1089.9\nMAC: (VLAN id) aaaa.bbbb.cc03 (005) aaaa.bbbb.cc06 (006)\nMin plen: 1500 Max plen: 1500\nMin TTL: 59 Max TTL: 59\nICMP type: 12 ICMP code: 1\nIP id: 0\nEt0/0.1 10.71.200.138 Et1/0.1 172.16.10.2 01 00 10 864\n0000 /0 0 0C01 /0 0 0.0.0.0 1500 1090.0\nMAC: (VLAN id) aaaa.bbbb.cc03 (005) aaaa.bbbb.cc06 (006)\nMin plen: 1500 Max plen: 1500\nMin TTL: 59 Max TTL: 59\nICMP type: 12 ICMP code: 1\nIP id: 0\nEt0/0.1 10.132.221.111 Et1/0.1 172.16.10.2 01 00 00 864\n0000 /0 0 0000 /0 0 0.0.0.0 554 1089.9\nMAC: (VLAN id) aaaa.bbbb.cc03 (005) aaaa.bbbb.cc06 (006)\nMin plen: 554 Max plen: 554\nMin TTL: 59 Max TTL: 59\nICMP type: 0 ICMP code: 0\nIP id: 0 FO: 185\nEt0/0.1 10.231.185.254 Et1/0.1 172.16.10.2 01 00 10 864\n0000 /0 0 0C01 /0 0 0.0.0.0 1500 1090.0\nMAC: (VLAN id) aaaa.bbbb.cc03 (005) aaaa.bbbb.cc06 (006)\n\n```\n\n-----\n\n```\n            Min plen: 1500 Max plen: 1500\n            Min TTL: 59 Max TTL: 59\n            ICMP type: 12 ICMP code: 1\n            IP id: 0\n\n```\nThere are 12 ICMP flows shown in the output. You can use the Layer 2 information in the flows that is captured\nby the ip flow-capture command to identify the path the traffic is taking through the network. In this example,\nthe traffic is being sent to R3 on VLAN 5 by R2. You can demonstrate that R2 is transmitting the traffic over\ninterface 1/0.1 because the source MAC address (aaaa.bbb.cc03) belongs to 1/0.1 on R2. You can demonstrate\nthat R3 is transmitting the traffic using VLAN 6 on interface 1/0.1 to interface 1/0.1 on R4, because the\ndestination MAC address (aaaa.bbbb.cc06) belongs to interface 1/0.1 on R4.\n\n**Note** For more information on the ip flow-capture command, and the fields in the display output of the show\n**ip cache verbose flow command, refer to the Cisco IOS NetFlow Command Reference .**\n\nYou can use this information to mitigate this attack. One possible way to mitigate this attack is by configuring\nan extended IP access list that blocks all ICMP traffic from the source IP addresses that Host A is spoofing\nand applying it Ethernet 0/0 on R2.\n\n### Analyze an ICMP Ping DoS Attack Using NetFlow Dynamic Top Talkers CLI Example\n\nYou can use the NetFlow Dynamic Top Talkers CLI feature to quickly identify the ICMP top talkers in the\nnetwork traffic that might be sending the traffic. This will show you the IP source addresses that Host A is\nusing as it sends the DoS attack traffic.\n\n```\nR3# show ip flow top 50 aggregate icmp\nThere are 3 top talkers:\nICMP TYPE ICMP CODE bytes pkts flows\n========= ========= ========== ========== ==========\n    12 1 2466000 1644 4\n     8 0 1233000 822 2\n     0 0 1366164 2466 6\n12 of 25 flows matched.\n\n```\n\n**Note** Only 12 of the 25 flows matched because the rest of the flows are not ICMP flows.\n\n**Tip** The top talkers are displayed in descending order of the aggregated field by default.\n\nAfter you have identified the ICMP types and code values in the network traffic, you need to determine the\nsource IP addresses for the ICMP traffic that being sent to the FTP server.\n\n```\nR3# show ip flow top 50 aggregate source-address match icmp type 12 code 1\nThere are 4 top talkers:\nIPV4 SRC-ADDR bytes pkts flows\n=============== ========== ========== ==========\n10.251.138.218 867000 578 1\n10.231.185.254 865500 577 1\n10.71.200.138 865500 577 1\n10.10.12.1 867000 578 1\n4 of 24 flows matched.\n\n```\n\n-----\n\n**Note** Only source IP addresses from ICMP traffic are shown because of the match icmp type 12 code 1 criteria.\nNo aggregation is performed on the source IP addresses because there is only one flow for IP each address.\n\n**Note** Only four of the 24 flows matched because the rest of the flows did not meet the match criteria (match\n**icmp type 12 code 1).**\n\n```\nR3# show ip flow top 50 aggregate source-address match icmp type 8 code 0\nThere are 2 top talkers:\nIPV4 SRC-ADDR bytes pkts flows\n=============== ========== ========== ==========\n10.132.221.111 1095000 730 1\n10.106.1.1 1095000 730 1\n2 of 24 flows matched.\n\n```\n\n**Note** Only source IP addresses from ICMP traffic are shown because of the match icmp type 8 code 0 criteria.\nNo aggregation is performed on the source IP addresses because there is only one flow for IP each address.\n\n**Note** Only two of the 24 flows matched because the rest of the flows did not meet the match criteria (match\n**icmp type 8 code 0).**\n\n```\nR3# show ip flow top 50 aggregate source-address match icmp type 0 code 0\nThere are 6 top talkers:\nIPV4 SRC-ADDR bytes pkts flows\n=============== ========== ========== ==========\n10.251.138.218 416608 752 1\n10.231.185.254 416608 752 1\n10.132.221.111 416608 752 1\n10.106.1.1 416608 752 1\n10.71.200.138 416608 752 1\n10.10.12.1 416608 752 1\n6 of 24 flows matched.\n\n```\n\n**Note** Only source IP addresses from ICMP traffic are shown because of the match icmp type 0 code 0 criteria.\nNo aggregation is performed on the source IP addresses because there is only one flow for IP each address.\n\n**Note** Only six of the 24 flows matched because the rest of the flows did not meet the match criteria (match\n**icmp type 0 code 0).**\n\nThe next step is to create a list of the source IP addresses that Host A is using.\n\n      - 10.251.138.218\n\n      - 10.231.185.254\n\n      - 10.71.200.138\n\n      - 10.10.12.1\n\n\n-----\n\n             - 10.132.221.111\n\n              - 10.106.1.1.\n\nNow that you know the source addresses of the ICMP DoS attack traffic, you can mitigate this attack by\nconfiguring an extended access list that blocks ICMP traffic from these address and applying it to the interface\nthat is closest to the point that the traffic is entering your network.\n\n### Configure NetFlow Filtering and Sampling Example\n\nThis example configuration contains the configuration commands required to use NetFlow filtering and\nsampling on the NetFlow router.\n\n```\n!\nhostname Router\n!\nip cef\n!\nflow-sampler-map icmp-dos-fs-map\n mode random one-out-of 2\n!\n!\nclass-map match-any icmp-dos-class-map\n match access-group 101\n!\n!\npolicy-map icmp-dos-policy-map\n class icmp-dos-class-map\n  netflow-sampler icmp-dos-fs-map\n!\ninterface Ethernet0/0\n mac-address aaaa.bbbb.cc04\n no ip address\n!\ninterface Ethernet0/0.1\n encapsulation dot1Q 5\n ip address 172.16.6.2 255.255.255.0\n service-policy input icmp-dos-policy-map\n!\ninterface Ethernet1/0.1\n encapsulation dot1Q 6\n ip address 172.16.7.1 255.255.255.0\n ip flow egress\n!\nip flow-capture fragment-offset\nip flow-capture packet-length\nip flow-capture ttl\nip flow-capture vlan-id\nip flow-capture icmp\nip flow-capture ip-id\nip flow-capture mac-addresses\n!\nip flow-top-talkers\n top 5\n sort-by bytes\n match class-map icmp-dos-class-map\n!\naccess-list 101 permit icmp any host 172.16.10.2\n!\nend\n\n```\n\n-----\n\n## Where to Go Next\n\nSee the \"Additional References\" section for links to configuration information about additional NetFlow\nfeatures and services.\n\n## Additional References\n\n|Related Documents|Col2|\n|---|---|\n|Related Topic|Document Title|\n|Overview of Cisco IOS NetFlow|\"Cisco IOS NetFlow Overview\"|\n|The minimum information about and tasks required for configuring NetFlow and NetFlow Data Export|\"Getting Started with Configuring NetFlow and NetFlow Data Export\"|\n|Tasks for configuring NetFlow to capture and export network traffic data|\"Configuring NetFlow and NetFlow Data Export\"|\n|Tasks for configuring Configuring MPLS Aware NetFlow|Configuring MPLS Aware NetFlow|\n|Tasks for configuring MPLS egress NetFlow accounting|Configuring MPLS Egress NetFlow Accounting and Analysis|\n|Tasks for configuring NetFlow input filters|\"Using NetFlow Filtering or Sampling to Select the Network Traffic to Track\"|\n|Tasks for configuring Random Sampled NetFlow|\"Using NetFlow Filtering or Sampling to Select the Network Traffic to Track\"|\n|Tasks for configuring NetFlow aggregation caches|\"Configuring NetFlow Aggregation Caches\"|\n|Tasks for configuring NetFlow BGP next hop support|\"Configuring NetFlow BGP Next Hop Support for Accounting and Analysis\"|\n|Tasks for configuring NetFlow multicast support|\"Configuring NetFlow Multicast Accounting\"|\n|Tasks for configuring NetFlow Reliable Export With SCTP|NetFlow Reliable Export With SCTP|\n|Tasks for configuring NetFlow Layer 2 and Security Monitoring Exports|\"NetFlow Layer 2 and Security Monitoring Exports\"|\n|Tasks for configuring the SNMP NetFlow MIB|\"Configuring SNMP and using the NetFlow MIB to Monitor NetFlow Data\"|\n\n\n-----\n\n|Related Topic|Document Title|\n|---|---|\n|Tasks for configuring the NetFlow MIB and Top Talkers feature|\"Configuring NetFlow Top Talkers using Cisco IOS CLI Commands or SNMP Commands\"|\n|Information for installing, starting, and configuring the CNS NetFlow Collection Engine|\"Cisco CNS NetFlow Collection Engine Documentation\"|\n\n|Standards|Col2|\n|---|---|\n|Standards|Title|\n|There are no new or modified standards associated with this feature|--|\n\n|MIBs|Col2|\n|---|---|\n|MIBs|MIBs Link|\n|There are no new or modified MIBs associated with this feature.|To locate and download MIBs for selected platforms, Cisco IOS releases, and feature sets, use Cisco MIB Locator found at the following URL: http://www.cisco.com/go/mibs|\n\n|RFCs|Col2|\n|---|---|\n|RFCs|Title|\n|There are no new or modified RFCs associated with this feature.|--|\n\n|Technical Assistance|Col2|\n|---|---|\n|Description|Link|\n|The Cisco Technical Support website contains thousands of pages of searchable technical content, including links to products, technologies, solutions, technical tips, and tools. Registered Cisco.com users can log in from this page to access even more content.|http://www.cisco.com/techsupport|\n\n\n-----\n\n## Feature Information for Detecting and Analyzing Network Threats With NetFlow\n\nThe following table provides release information about the feature or features described in this module. This\ntable lists only the software release that introduced support for a given feature in a given software release\ntrain. Unless noted otherwise, subsequent releases of that software release train also support that feature.\n\nUse Cisco Feature Navigator to find information about platform support and Cisco software image support.\nTo access Cisco Feature Navigator, go to . An account on Cisco.com is not required.\n\n**Table 11: Feature Information for NetFlow Layer 2 and Security Monitoring Exports**\n\n|Feature Name|Releases|Feature Configuration Information|\n|---|---|---|\n|NetFlow Layer 2 and Security Monitoring Exports|12.3(14)T|The NetFlow Layer 2 and Security Monitoring Exports feature enables the capture of values from fields in Layer 3 and Layer 2 of IP traffic for accounting and security analysis. The following commands were modified by this feature: ip flow-capture, ip flow-export and show ip cache verbose flow.|\n|Support for capturing the value from the fragment offset field of IP headers added to NetFlow Layer 2 and Security Monitoring Exports1|12.4(2)T|The fragment-offset keyword for the ip flow-capture command enables capturing the value of the IP fragment offset field from the first fragmented IP datagram in a flow.|\n|NetFlow Top Talkers|12.3(11)T, 12.2(25)S|This document references the Top Talkers feature from the NetFlow MIB and Top Talkers feature documentation. Top Talkers uses NetFlow functionality to obtain information regarding heaviest traffic patterns and most-used applications in the network. The following commands were introduced by this feature: cache-timeout, ip flow-top-talkers, match, show ip flow top-talkers, sort-by, and top.|\n\n\n-----\n\n|Feature Name|Releases|Feature Configuration Information|\n|---|---|---|\n|NetFlow Dynamic Top Talkers CLI|12.4(4)T|The NetFlow Dynamic Top Talkers CLI allows you to se an overview of the traffic characteristics on your router by aggregating flows based on the fields such as source IP address, destination prefix, and so forth.|\n|NetFlow Input Filters|12.3(4)T, 12.2(25)S|This document references the NetFlow Input Filters feature from the NetFlow Filtering and Sampling feature documentation.|\n|Random Sampled NetFlow|12.3(4)T, 12.2(18)S, 12.0(26)S|This document references the Random Sampled NetFlow feature from the NetFlow Filtering and Sampling feature documentation.|\n\n\n1 This is a minor enhancement. Minor enhancements are not typically listed in Feature Navigator.\n\n## Glossary\n\n**data flowset --A collection of data records that are grouped in an export packet.**\n\n**export packet --A type of packet built by a device (for example, a router) with NetFlow services enabled.**\nThe packet is addressed to another device (for example, the NetFlow Collection Engine). The packet contains\nNetFlow statistics. The other device processes the packet (parses, aggregates, and stores information about\nIP flows).\n\n**flow --A set of packets with the same source IP address, destination IP address, protocol, source/destination**\nports, and type-of-service, and the same interface on which flow is monitored. Ingress flows are associated\nwith the input interface, and egress flows are associated with the output interface.\n\n**flowset --A collection of flow records that follow the packet header in an export packet. A flowset contains**\ninformation that must be parsed and interpreted by the NetFlow Collection Engine. There are two types of\nflowsets: template flowsets and data flowsets. An export packet contains one or more flowsets, and both\ntemplate and data flowsets can be mixed in the same export packet.\n\n**NetFlow --Cisco IOS accounting feature that maintains per-flow information.**\n\n**NetFlow Aggregation --A NetFlow feature that lets you summarize NetFlow export data on an IOS router**\nbefore the data is exported to a NetFlow data collection system such as the NetFlow Collection Engine. This\nfeature lowers bandwidth requirements for NetFlow export data and reduces platform requirements for NetFlow\ndata collection devices.\n\n**NetFlow Collection Engine (formerly NetFlow FlowCollector)--Cisco application that is used with NetFlow**\non Cisco routers and Catalyst series switches. The NetFlow Collection Engine collects packets from the router\nthat is running NetFlow and decodes, aggregates, and stores them. You can generate reports on various\naggregations that can be set up on the NetFlow Collection Engine.\n\n\n-----\n\n**NetFlow v9 --NetFlow export format Version 9. A flexible and extensible means of carrying NetFlow records**\nfrom a network node to a collector. NetFlow Version 9 has definable record types and is self-describing for\neasier NetFlow Collection Engine configuration.\n\n**template --Describes the layout of a data flowset.**\n\n**template flowset --A collection of template records that are grouped in an export packet.**\n\n\n-----\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "99fdc3ef-333d-48f5-a4a1-becd788c7b80",
            "created_at": "2022-10-25T15:28:29.802983Z",
            "updated_at": "2022-10-25T15:28:29.802983Z",
            "deleted_at": null,
            "name": "MITRE",
            "url": "https://github.com/mitre-attack/attack-stix-data",
            "description": "MITRE ATT&CK STIX Data",
            "reports": null
        }
    ],
    "references": [
        "https://www.cisco.com/c/en/us/td/docs/ios-xml/ios/netflow/configuration/15-mt/nf-15-mt-book/nf-detct-analy-thrts.pdf"
    ],
    "report_names": [
        "nf-detct-analy-thrts.pdf"
    ],
    "threat_actors": [
        {
            "id": "67bf0462-41a3-4da5-b876-187e9ef7c375",
            "created_at": "2022-10-25T16:07:23.44832Z",
            "updated_at": "2025-03-27T02:02:09.806007Z",
            "deleted_at": null,
            "main_name": "Careto",
            "aliases": [
                "Careto",
                "The Mask",
                "Ugly Face"
            ],
            "source_name": "ETDA:Careto",
            "tools": [
                "Careto"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "4b076dcb-516e-42fb-9c8f-f153902cd5e9",
            "created_at": "2022-10-25T16:07:23.708745Z",
            "updated_at": "2025-03-27T02:02:09.935617Z",
            "deleted_at": null,
            "main_name": "Hidden Lynx",
            "aliases": [
                "Aurora Panda",
                "Group 8",
                "Hidden Lynx",
                "Operation SMN"
            ],
            "source_name": "ETDA:Hidden Lynx",
            "tools": [
                "AGENT.ABQMR",
                "AGENT.AQUP.DROPPER",
                "AGENT.BMZA",
                "AGENT.GUNZ",
                "BlackCoffee",
                "HiKit",
                "MCRAT.A",
                "Mdmbot.E",
                "Moudoor",
                "Naid",
                "PNGRAT",
                "Trojan.Naid",
                "ZoxPNG",
                "gresim"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "a7aefdda-98f1-4790-a32d-14cc99de2d60",
            "created_at": "2023-01-06T13:46:38.281844Z",
            "updated_at": "2025-03-27T02:00:02.792526Z",
            "deleted_at": null,
            "main_name": "APT17",
            "aliases": [
                "G0025",
                "AURORA PANDA",
                "Group 72",
                "G0001",
                "HELIUM",
                "Group 8",
                "Hidden Lynx",
                "Tailgater Team",
                "BRONZE KEYSTONE"
            ],
            "source_name": "MISPGALAXY:APT17",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f4f16213-7a22-4527-aecb-b964c64c2c46",
            "created_at": "2024-06-19T02:03:08.090932Z",
            "updated_at": "2025-03-27T02:05:17.387119Z",
            "deleted_at": null,
            "main_name": "GOLD NIAGARA",
            "aliases": [
                "Carbanak",
                "Carbon Spider ",
                "FIN7 ",
                "Navigator ",
                "Sangria Tempest ",
                "TelePort Crew ",
                "Calcium "
            ],
            "source_name": "Secureworks:GOLD NIAGARA",
            "tools": [
                " Carbanak",
                " Cobalt Strike",
                " DICELOADER",
                " DRIFTPIN",
                " GGLDR",
                " GRIFFON",
                " JSSLoader",
                " Meterpreter",
                " OFFTRACK",
                " PILLOWMINT",
                " POWERTRASH",
                " SUPERSOFT",
                " TAKEOUT",
                " TinyMet",
                "Bateleur"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "d85adfe3-e1c3-40b0-b8bb-d1bacadc4d82",
            "created_at": "2022-10-25T16:07:23.619566Z",
            "updated_at": "2025-03-27T02:02:09.890982Z",
            "deleted_at": null,
            "main_name": "FIN7",
            "aliases": [
                "APT-C-11",
                "ATK 32",
                "Gold Niagara",
                "ITG14",
                "TAG-CR1"
            ],
            "source_name": "ETDA:FIN7",
            "tools": [
                "7Logger",
                "Agentemis",
                "Anunak",
                "Astra",
                "BIOLOAD",
                "BIRDWATCH",
                "Bateleur",
                "Boostwrite",
                "CROWVIEW",
                "Carbanak",
                "Cobalt Strike",
                "CobaltStrike",
                "DICELOADER",
                "DNSMessenger",
                "FOWLGAZE",
                "HALFBAKED",
                "JSSLoader",
                "KillACK",
                "LOADOUT",
                "Lizar",
                "Meterpreter",
                "Mimikatz",
                "POWERPLANT",
                "POWERSOURCE",
                "RDFSNIFFER",
                "SQLRAT",
                "Sekur",
                "Sekur RAT",
                "TEXTMATE",
                "Tirion",
                "VB Flash",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716496,
    "ts_updated_at": 1743041609,
    "ts_creation_date": 1454469361,
    "ts_modification_date": 1454461025,
    "files": {
        "pdf": "https://archive.orkl.eu/8b025c4aa9726bfddea650b0a6d28c38ad5b1648.pdf",
        "text": "https://archive.orkl.eu/8b025c4aa9726bfddea650b0a6d28c38ad5b1648.txt",
        "img": "https://archive.orkl.eu/8b025c4aa9726bfddea650b0a6d28c38ad5b1648.jpg"
    }
}