{
    "id": "a9add68e-36d5-4fd0-82ad-9502a4ff5ebc",
    "created_at": "2023-01-12T15:06:54.864015Z",
    "updated_at": "2025-03-27T02:05:24.934808Z",
    "deleted_at": null,
    "sha1_hash": "5720a7edc6f5c50ad87ecbb0e81a4b00464764df",
    "title": "2018-09-18 - A taste of our own medicine- How SmokeLoader is deceiving configuration extraction by using binary code as bait",
    "authors": "",
    "file_creation_date": "2022-05-27T21:30:39Z",
    "file_modification_date": "2022-05-27T21:30:39Z",
    "file_size": 150350,
    "plain_text": "# A taste of our own medicine : How SmokeLoader is deceiving configuration extraction by using binary code as bait\n\n**int0xcc.svbtle.com/a-taste-of-our-own-medicine-how-smokeloader-is-deceiving-dynamic-configuration-extraction-by-**\nusing-binary-code-as-bait\n\nSeptember 18, 2018\nA taste of our own medicine : How smokeloader is deceiving dynamic configuration\nextraction by using binary code as bait\n\nRecently an interesting smoke loader sample caught my eye,and moreover I had to put\nsmoke loader monitoring under scrutiny, as my monitoring script found it hard to locate a live\nc2 . Then suddenly something strange I noticed on the dashboard, the output c2’s from the\nconfiguration extraction script and the generated pcap were different\n\n_Output From config extraction_\n\n_Pcap generated output_\n\nNotice the subtle difference between two outputs ?\n\nA configuration extraction script is essentially an instrumenting script ( using windbg or a\nmemory acquisition tool) to extract configuration ( c2’s, keys, campaigns, etc ) from a\nrunning malware binary . It’s sole purpose is to capture a pattern in a binary to extract certain\nparameters like DWORD’s, constants or pointers to memory region . Generally there is a\nlong sleep call between consecutive attempts to connects multiple c2’s, which is essentially\na way though which it keeps its secondary c2’s hidden, as mostly only one of the few c2’s\ngets listed in a sandbox report .\n\nThe smoke loader configuration happens to be a list of c2’s and encryption keys ( DWORD )\n\n\n-----\n\nThis subroutine that generates a hidden c2, roughly translates to following stream in opcode\n.\n\n\n33 C0 83 F9 02 0F 44 C8 89 0D 80 6C 00 10 8B 0C 8D E8 12 00 10\n\n\nExtracting Numc2 and C2BufferArray ( encoded c2 list buffer) would be a matter of creating a\nregex\n\n```\nRegEx = \\x33\\xC0\\x83\\xF9(.)\\x0F\\x44\\xC8\\x89\\x0D.{4}\\x8B\\x0C\\x8D(.{4})\n\n```\n\n-----\n\nBut unpacking a particular sample mentioned earlier, revealed another side of the story .\nAlthough the code to load encoded c2 buffer was there, but the coding routine was a clever\nchoice of deception, which feeds a fake encoded c2 buffer, though decoded buffer is a valid\nhttp resource, but instead chooses to take the c2 buffer from a plain text value in between\nthe subroutine\n\nBut the fact to notice is, not only it would fools scripts, but difference between the real and\nthe fake c2 is so subtle, that it deceives the eyes of the beholder as well.\n\nSmokeLoader has suffered considerably a lot due to immediate c2 takedown, its no surprise\nthat they were looking for a quick and a smart way to tackle this problem, but seldom it goes\nunnoticed\n\n17\n\nKudos\n\n17\n\nKudos\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-09-18 - A taste of our own medicine- How SmokeLoader is deceiving configuration extraction by using binary code as bait.pdf"
    ],
    "report_names": [
        "2018-09-18 - A taste of our own medicine- How SmokeLoader is deceiving configuration extraction by using binary code as bait.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536014,
    "ts_updated_at": 1743041124,
    "ts_creation_date": 1653687039,
    "ts_modification_date": 1653687039,
    "files": {
        "pdf": "https://archive.orkl.eu/5720a7edc6f5c50ad87ecbb0e81a4b00464764df.pdf",
        "text": "https://archive.orkl.eu/5720a7edc6f5c50ad87ecbb0e81a4b00464764df.txt",
        "img": "https://archive.orkl.eu/5720a7edc6f5c50ad87ecbb0e81a4b00464764df.jpg"
    }
}