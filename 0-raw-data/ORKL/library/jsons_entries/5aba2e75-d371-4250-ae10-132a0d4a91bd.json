{
    "id": "5aba2e75-d371-4250-ae10-132a0d4a91bd",
    "created_at": "2022-10-25T16:48:19.655316Z",
    "updated_at": "2025-03-27T02:09:18.342141Z",
    "deleted_at": null,
    "sha1_hash": "34c0983b58ba25a4a3066ae9871b12b2958af506",
    "title": "ANALYSIS ON APT-TO-BE ATTACK THAT FOCUSING ON CHINA’S GOVERNMENT AGENCY",
    "authors": "",
    "file_creation_date": "2018-09-28T02:25:33Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 1184920,
    "plain_text": "# ANALYSIS ON APT-TO-BE ATTACK THAT FOCUSING ON CHINA’S GOVERNMENT AGENCY\n\n**[antiy.net/p/analysis-on-apt-to-be-attack-that-focusing-on-chinas-government-agency/](http://www.antiy.net/p/analysis-on-apt-to-be-attack-that-focusing-on-chinas-government-agency/)**\n\n# Analysis on APT-to-be Attack That Focusing on China’s Government Agency\n\n### Antiy CERT\n\n Download\n\n First release time: 14:32, May 27, 2015\n\n Updated time of this version: 14:32, May 27, 2015\n\n**Contents**\n\n[1    Background](http://www.antiy.net/p/analysis-on-apt-to-be-attack-that-focusing-on-chinas-government-agency/#_Toc420575223)\n\n[2    Analysis on incident sample](http://www.antiy.net/p/analysis-on-apt-to-be-attack-that-focusing-on-chinas-government-agency/#_Toc420575224)\n\n[2.1     Leading files and sample downloading](http://www.antiy.net/p/analysis-on-apt-to-be-attack-that-focusing-on-chinas-government-agency/#_Toc420575225)\n\n\n-----\n\n[2.3     Analysis on the major sample (Sample B) of APT-TOCS](http://www.antiy.net/p/analysis-on-apt-to-be-attack-that-focusing-on-chinas-government-agency/#_Toc420575227)\n\n[2.4     Analysis on script](http://www.antiy.net/p/analysis-on-apt-to-be-attack-that-focusing-on-chinas-government-agency/#_Toc420575228)\n\n[2.5     Analysis on module](http://www.antiy.net/p/analysis-on-apt-to-be-attack-that-focusing-on-chinas-government-agency/#_Toc420575229)\n\n[2.6     Analysis on module](http://www.antiy.net/p/analysis-on-apt-to-be-attack-that-focusing-on-chinas-government-agency/#_Toc420575230)\n\n[2.7     Analysis on module](http://www.antiy.net/p/analysis-on-apt-to-be-attack-that-focusing-on-chinas-government-agency/#_Toc420575231)\n\n[3    The authentication analysis on the technology sources of this attack](http://www.antiy.net/p/analysis-on-apt-to-be-attack-that-focusing-on-chinas-government-agency/#_Toc420575232)\n\n[3.1     Comparison of Module](http://www.antiy.net/p/analysis-on-apt-to-be-attack-that-focusing-on-chinas-government-agency/#_Toc420575233)\n\n[3.2     Comparison of disassembling commands of module](http://www.antiy.net/p/analysis-on-apt-to-be-attack-that-focusing-on-chinas-government-agency/#_Toc420575234)\n\n[3.3     Comparison analysis on module 3 data package](http://www.antiy.net/p/analysis-on-apt-to-be-attack-that-focusing-on-chinas-government-agency/#_Toc420575235)\n\n[3.4     Characteristics of Cobalt Strike](http://www.antiy.net/p/analysis-on-apt-to-be-attack-that-focusing-on-chinas-government-agency/#_Toc420575236)\n\n[4    Conclusion](http://www.antiy.net/p/analysis-on-apt-to-be-attack-that-focusing-on-chinas-government-agency/#_Toc420575237)\n\n[Appendix 1 References of Cobalt Strike and the author](http://www.antiy.net/p/analysis-on-apt-to-be-attack-that-focusing-on-chinas-government-agency/#_Toc420575238)\n\n[Appendix 2 About Antiy](http://www.antiy.net/p/analysis-on-apt-to-be-attack-that-focusing-on-chinas-government-agency/#_Toc420575239)\n\n# 1     Background\n\nRecently, ANTIY Labs detected an APT attack targeting some government agency in\nChina. The Shellcode for communication is conducted depending on Beacon mode which\nis generated on the basis of automatic attack detection platform-Cobalt Strike. This kind of\nattack pattern disguising as non-malicious real file in the host of its target, it sending a\nnetwork heartbeat package every 60 seconds, and it also send data information via the\nCookie field, all these features of this attack pattern are designed to evade the detection of\nsecurity software and the interception of firewall on the targeted host. Considering the\nrelationship between this attack and Cobalt Strike platform, we name it as APT-TOCS\n(TOCS refers to Threat on Cobalt Strike.) for now.\n\nThe core step of APT-TOCS is downloading the script functionalities of Shellcode, which\ndownloads a field of data into memory for operation by calling powershell.exe.The\ndecrypted data is a field of executable Shellcode that is generated by Cobalt Strike (An\nautomatic attack testing platform). After loading the script of Shellcode, the Analysis Group\nof ANTIY did a series of correlation analysis, then we found a PE program that maybe act\nas a guiding executable file in similar attacks. The loaded Shellcode script can be used to\ncall command line to add a certain field of encrypted date into memory and run it. The\ndecrypted date turns out to be executable Shellcode which is generated by Cobalt Strike.\nThe related script can be loaded via the guiding PE program or vulnerability. This kind of\n\n\n-----\n\nseveral Beacons can work simultaneously. Such attack can be launched without the\nsupport of vector file, in fact it depends on network projection and laterally move in the\ninternal network as required conducting an attack. So, it will bring great difficulties to the\nforensic work. It is important to note that, all the Sandboxes we know are disabling to fight\nagainst this kind of attack.\n\nIt seems that the attack capability of APT-TOCS is close to that of APT-level. However, it\nrelied on automatic attack testing platform instead of abilities of the attack team.\n\n# 2     Analysis on incident sample\n\n## 2.1   Leading files and sample downloading\n\nAPT-TOCS used “powershell.exe” to execute Shellcode scripts to realize remote control on\ntargeted system. The analysts of Antiy thought that the attacker might know several remote\ninjection methods of script downloading privilege, such as directly making the scrip be\nexecuted on the host by using security vulnerabilities. Meanwhile, we found the following\nbinary leading attack files (hereinafter referred to as Sample A) were used in similar attacks\nbefore:\n\nThe functionality code of the scripts embedded in this PE sample is completely the same\nwith the one of Shellcode script Antiy has acquired, while the encryption data of them\ndiffers from each other. This PE sample was firstly uploaded to Virustotal on May 2, 2015:\n\n\n-----\n\nFigure 1 Downloading encryption data using powershell.exe embedded in PE files\n\nThe PE sample used WinExec to operate embedded malware:\n\nFigure 2 Using function WinExec to call powershell.exe to download leading data\n\nTherefore, we can see that the “leading file” can be regarded as the leading part of attack.\nHowever, the execution and control still can be made depending on system and application\nvulnerabilities without this leading file.\n\nAccording to above information, we cannot make sure this leading sample has relationship\nwith this APT incident.\n\n## 2.2   Key mechanism\n\nThe core part of APT-TOCS relies on the encrypted data scripts (hereinafter referred to as\nSample B) downloaded by PowerShell. Figure 1 consists of various derivation relationships\nand major module functionalities:\n\n\n-----\n\nFigure 3 Various derivation relationships and major module functionalities\n\n## 2.3   Analysis on the major sample (Sample B) of APT-TOCS\n\nThe content (Here omitted the content of base64.) of Sample B is as follows:\n\nFigure 4 Content of Sample B\n\nThe functionality of this part of script is: decrypting the encrypted content of base64,\ndecompressing with Gzip, resulting in module 1 and using PowerShell to download and\nexecute.\n\n## 2.4   Analysis on script 1\n\nThe content of script 1 is as follows:\n\n\n-----\n\nFigure 5 Content of script 1\n\nThe functionality of this part is: decrypting data with base64 encryption and getting module\n1, then writing to process powershell.exe, and executing and operating.\n\n## 2.5   Analysis on module 1\n\nThe functionality of this module is as follows: calling the function of wininet module,\nconnecting the network, downloading operations of module 2; and executing by\ndownloading to the memory.\n\nFi 6 R f HTTP GET\n\n\n-----\n\n## 2.6   Analysis on module 2\n\nModule 2 established and listed system process rundll32.exe:\n\nFigure 7 Establishing and listing process rundll32.exe\n\nData that has been written into module 3:\n\nFigure 8 Data that has been written into module 3\n\nThough the data of module 3 started with “MZ”, it does not belong to PE files. Instead, it is\nthe Shellcode with backdoor functionality.\n\n\n-----\n\nFigure 9 Shellcode that started with MZ（4D 5A）\n\n## 2.7   Analysis on module 3\n\nThe module might connect the following 2 addresses with port 80:\n\n146.0.***.*** (Romania)\n\ndc.******69.info (146.0.***.***) (Romania)\n\nSending request data and receiving return data.\n\nFigure 10 Sending request data\n\nThe decryption to above IP, domains and accessing addresses is “XOR 0x69”.\n\nJudging from the module strings and the system functions, the module belongs to backdoor\nprogram that can send GET request to designated addresses and heartbeat packages by\nusing Cookie fields with 60 seconds’ interval. The heartbeat package data includes: check\ncode, process ID, system version, IP address, computer name, account, whether it is 64 bit\nprocess. Then it transmits by making use of both RSA and BASE64 encryption.\n\n\n-----\n\nAs the process ID and check code are different, the transmitted heartbeat package data are\ndifferent each time. The check code is calculated through using process ID and the\nmillisecond process during system startup. The algorithm is as follows:\n\nFigure 12 Algorithm of check code\n\nThe encrypted heartbeat package used Cookie field to transmit:\n\nFigure 13 Content of the data package\n\n# 3     The authentication analysis on the technology sources of this attack\n\nThe leading PE files, Sample_A and Sample B, associated by analysts of Antiy CERT used\nthe exactly same method of PowerShell. However, we cannot eliminate the possibility that\nSample_A has no positive connection with this attack due to the high standardization of\nrelevant scripts. We still consider it as a series of attack incidents based on other\ncomprehensive analysis. The attacker might exploit the following ways to control the target\nhost, such as social engineering e-mails, file bundling, exploiting system and application\nvulneratbilities, lateral movement of intranet and so on.\n\n\n-----\n\nStrike. Therefore, our analysts carried out comparison analysis on Beacon generated by\nCobalt Strike, and authenticated the relationships between them.\n\nCobalt Strike is the GUI framework penetration tool based on metasploit. The business\nversion of it integrates the following characteristics: service scan, automatic overflow, multimode port espionage, various Trojan generation, phishing attack, site clone, target\ninformation obtaining, automatic browser attack and so on.\n\n## 3.1   Comparison of Module 1\n\nWe compared module 1 and the payload generated by using Beacon, and found only the\nfollowing different data: the Head data, request file name and IP address.\n\nFigure 14 Comparison of Module 1\n\nThe left is sample module 1, while the right is the module generated by Beacon. We can\nlead to the conclusion from the comparison: module 1 is generated by Beacon.\n\nThe screenshot of data package in request is as follows:\n\nFigure 15 The data package comparison of module 1\n\n\n-----\n\nOur analysts compared sample module 2 and relevant files of Beacon, and found that the\ndisassembling commands between them are exactly the same with exception of\nfunctionality code, including XOR encryption at the entry, downloading system DLL,\nobtaining function address, function calling modes and so on. The following lists three\npoints.\n\n\n-----\n\nThe following figure is the GET request comparison of the module generated by sample\nmodule 3 and Beacon. Here we can see both of them use Cookie to transmit information\nthat has been encrypted, and send requests actively every 60 seconds. The data package\nis heartbeat.\n\nFigure 16 Comparison of module 3 data package\n\n## 3.4   Characteristics of Cobalt Strike\n\nUsing Cobalt Strike attack can execute various operations in the targeted systems, such as\ndownloading and uploading files, executing designated programs, injecting keyboard\nrecorder, executing commands via PowerShell, importing PowerShell script, executing\ncommands via CMD, accessing system passwords and so on.\n\nCobalt Strike has the following characteristics:\n\nPenetrating sandbox\nAvoiding whitelist mechanism and cloud detection\nIntranet penetration\nPersistent attacks\nAttacking various platforms\n\n# 4     Conclusion\n\nWith an automated test platform Cobalt Strike, the attack penetration can penetrate firewall,\n\n\n-----\n\nadversary to Trusted Computing, Cloud Detection, Sandbox Detection and so on.\nAccording to the traces in the past, we believe that the threat has been active for 5 years;\nunfortunately, there isn’t any powerful detection production and methods to defeat the\nmalicious attack till now.\n\nThe reason why the CERT Analysis Team of ANTIY classified APT-TOCS into APT\nincidents is that it’s a kind of targeted attack (one of the features of APT attack), it has antidetection functions and also it can conceal itself. Compared with APT incidents in the past,\nthe APT attack in this case doesn’t cost too much, and the attackers aren’t responsible for\ncoding. With the application of commercial attack platform, the attackers saved the cost of\nan attack, also the vulnerability built joint function provided by relevant attack platform\nmake the attackers easy to do injection. As a result, nations and organizations which\nwithout its own elite hacker groups and abundant capital can also launch some kind of APT\nattack via the attack pattern mentioned in this case. Meanwhile, it’s more difficult for us to\ntracing when facing such modeled attack.\n\nOne of the leaders in Information Security area-Bruce Schiner said, “when big events on\ninformation security happened, people tend to treat it as an example of cyber warfare. It’s\nridiculous. From my point of view, what’s happening and going to happen is: more and\nmore tactics in physical warfare are applied to cyber warfare. It’s important to note that,\nattack capabilities can be widely distributed if attackers take full advantages of certain\ntechnology, especially computer technology can make attack more powerful and\nautomated.” Obviously, highly automated commercial platform realized a high speed of\nspread of this attack capability (exceeded our anticipation).\n\nWe have to remind all relevant parties that we are confronting with the risk of large scale\ndiffusion of network armaments which is led by the low cost of the attack capability. The\ncommercial penetration attack detecting platform has two sides, on one hand, it can check\nthe network environment of systems effectively, on the other hand, for nations,\norganizations and industries which has limited budget, it costs too much. Given the\nsituation, all related parties should conduct more communication with each other,\nadditionally, there is no doubt that both offensive party and defensive party are supported\nby superpowers, these superpowers should prevent the attack technique from widely\ndistributing.\n\nThe incident mentioned there has no difference with other cases we detected in the past, it\nshows that, on the way to realize national informatizaion, we must fight against serious\nsecurity challenges as we confronting now; it’s also a good opportunity for our Chinese\npeople and enterprises to demonstrate our faith and the efforts we made to conquer the\nchallenge.\n\n# Appendix 1 References of Cobalt Strike and the author\n\nCobalt Strike is the business version of Armitage which is the penetration testing software\nof Metasploit figure interface written by Java Armitage can carry out automatic attacks by\n\n\n-----\n\nunder bt5 and kali linx, and the most powerful functionality is adding the Payload of\nBeacon.\n\nThe first release time of Cobalt Strike is June, 2012.\n\n**Author of Cobalt Strike: Raphael Mudge**\n\nRaphael Mudge is the founder of Strategic Cyber LLC, a Washington, DC based company\nthat creates software for red teams. He created Armitage for Metasploit, the Sleep\nprogramming language, and the IRC client jIRCii. Previously, Raphael worked as a security\nresearcher for the US Air Force, a penetration tester, and he even invented a grammar\nchecker that was sold to Automattic. His work has appeared in Hakin9, USENIX ;login:, Dr.\nDobb’s Journal, on the cover of the Linux Journal, and the Fox sitcom Breaking In. Raphael\nregularly speaks on security topics and provides red team support to many cyber defense\ncompetitions.\n\n**Education background: Syracuse University,**\nMichigan Technological University\n\n**Current position: Strategic Cyber LLC, Delaware**\nAir National Guard\n\n**Skills: software development, information security,**\nobject-oriented design, distributed system, figure\ninterface, computer network design, blog system,\nsocial engineering, security research and so on.\n\n\n-----\n\n**Supported organizations:**\n\nCollegiate Cyber Defense Competition (CCDC)\n\nNorth East CCDC 2008-2015\n\nMid Atlantic CCDC 2011-2015\n\nPacific Rim CCDC 2012, 2014\n\nSouth East CCDC – 2014\n\nWestern Regional CCDC – 2013\n\nNational CCDC 2012-2014\n\n**Projects:**\n\nSleep Scripting Language\n\nAn extensible general purpose language with Perl inspired syntax for the Java platform.\nSleep is open source, licensed under the LGPL.\n\njIRCii\n\nScriptable Internet Relay Chat client for Windows, MacOS X, and Linux. jIRCii is open\nsource, licensed under the artistic license.\n\n**Published works:**\n\nLive-fire Security Testing with Armitage and Metasploit\n\nGet in through the backdoor: Post exploitation with Armitage\n\nTutorial: Hacking Linux with Armitage\n\nThe Design of a Proofreading Software Service\n\n\n-----\n\ncortana-scripts\n\nmetasploit-loader\n\nmalleable-c2-profiles\n\nlayer2-privoting-client\n\narmitage\n\n**Projects:**\n\nEnterprise-level business cooperation\n\nAfter the Deadline\n\nFeedback Army\n\nCobalt Strike\n\nOpen source software\n\nArmitage\n\nFar East\n\njIRCii\n\nMoconti\n\nOne Hand Army Man s\n\nphPERL Same Game\n\nSleep\n\n**Reference linking:**\n\nhttps://plus.google.com/116899857642591292745/posts （google+）\n\nhttps://github.com/rsmudge  (GitHub)\n\nhttps://www.youtube.com/channel/UCJU2r634VNPeCRug7Y7qdcw (youtube)\n\nhttp://www.oldschoolirc.com/\n\nhttps://twitter.com/rsmudge\n\nhttp://www.hick.org/~raffi/index.html\n\nhttp://www.blackhat.com/html/bh-us-12/speakers/Raphael-Mudge.html\n\nhttp://www.linkedin.com/in/rsmudge\n\n\n-----\n\nAntiy Labs is a professional next-generation security-testing engine R&D enterprise. Antiy’s\nengines provide the ability to detect various viruses and malware for network security\nproducts and mobile devices, which are used by more than ten well known security\nvendors. Antiy’s engines are embedded in tens of thousands of firewalls and tens of\nmillions of mobile phones all over the world. Antiy Labs is awarded the “Best Protection”\nprize by AV-TEST in 2013. Based on engines, sandboxes and background systems, Antiy\nLabs will continue to provide traffic-based anti-APT solutions for enterprises.\n\nMore information about antivirus engine, [http://www.antiy.com (Chinese)](http://www.antiy.com/)\n\n[http://www.antiy.net (English)More information about anti-APT products of](http://www.antiy.net/)\n[Antiy,http://www.antiy.cn](http://www.antiy.cn/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2015/2015.05.27.APT_to_be/antiy.net-ANALYSIS%20ON%20APT-TO-BE%20ATTACK%20THAT%20FOCUSING%20ON%20CHINAS%20GOVERNMENT%20AGENCY.pdf"
    ],
    "report_names": [
        "antiy.net-ANALYSIS ON APT-TO-BE ATTACK THAT FOCUSING ON CHINAS GOVERNMENT AGENCY"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "c39b0fe6-5642-4717-9a05-9e94265e3e3a",
            "created_at": "2022-10-25T16:07:24.332084Z",
            "updated_at": "2025-03-27T02:02:10.175452Z",
            "deleted_at": null,
            "main_name": "Tonto Team",
            "aliases": [
                "Bronze Huntley",
                "CactusPete",
                "Earth Akhlut",
                "HartBeat",
                "Karma Panda",
                "LoneRanger",
                "Operation Bitter Biscuit",
                "TAG-74",
                "Tonto Team"
            ],
            "source_name": "ETDA:Tonto Team",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "Bioazih",
                "Bisonal",
                "CONIME",
                "Dexbia",
                "Korlia",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Mimikatz",
                "POISONPLUG.SHADOW",
                "RoyalRoad",
                "ShadowPad Winnti",
                "XShellGhost"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716499,
    "ts_updated_at": 1743041358,
    "ts_creation_date": 1538101533,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/34c0983b58ba25a4a3066ae9871b12b2958af506.pdf",
        "text": "https://archive.orkl.eu/34c0983b58ba25a4a3066ae9871b12b2958af506.txt",
        "img": "https://archive.orkl.eu/34c0983b58ba25a4a3066ae9871b12b2958af506.jpg"
    }
}