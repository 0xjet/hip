{
    "id": "cea8c48d-587b-4e73-9a4a-88c2a8c81c08",
    "created_at": "2023-01-12T15:02:59.33435Z",
    "updated_at": "2025-03-27T02:05:31.819044Z",
    "deleted_at": null,
    "sha1_hash": "9399379865132aa58b0aa3e145556177e0d55ece",
    "title": "2021-09-10 - Hive Ransomware- Actively Targeting Hospitals",
    "authors": "",
    "file_creation_date": "2022-05-28T17:12:54Z",
    "file_modification_date": "2022-05-28T17:12:54Z",
    "file_size": 1151510,
    "plain_text": "# Hive Ransomware: Actively Targeting Hospitals\n\n**[netskope.com/blog/hive-ransomware-actively-targeting-hospitals](https://www.netskope.com/blog/hive-ransomware-actively-targeting-hospitals)**\n\nGustavo Palazolo September 10, 2021\n\n## Summary\n\nMost ransomware groups operating in the RaaS (Ransomware-as-a-Service) model have an\ninternal code of ethics that includes avoiding breaching some specific sectors, such as\nhospitals or critical infrastructure, thus avoiding great harm to society and consequently\n[drawing less attention from law enforcement. For example, the BlackMatter ransomware](https://www.netskope.com/blog/netskope-threat-coverage-blackmatter)\nstates they are not willing to attack hospitals, critical infrastructure, defense industry, nonprofit companies, and oil and gas industry targets, having learned from the mistakes of other\ngroups, such as [DarkSide, who shut down its operations after the Colonial Pipeline attack.](https://www.netskope.com/blog/netskope-threat-coverage-darkside)\n\nHowever, this code of ethics is not always adopted by attackers, as is the case with Hive, a\n[new family of ransomware discovered in June 2021. On August 15, 2021, Hive ransomware](https://twitter.com/fbgwls245/status/1408632067181604865)\n[was responsible for an attack against the Memorial Health System, a non-profit integrated](https://www.bleepingcomputer.com/news/security/hive-ransomware-attacks-memorial-health-system-steals-patient-data/)\nhealth system with three hospitals in Ohio and West Virginia (Marietta Memorial Hospital,\nSelby General Hospital, and Sistersville General Hospital), causing radiology exams and\nsurgical cases to be canceled. According to the [FBI, the group uses phishing emails with](https://www.ic3.gov/Media/News/2021/210825.pdf)\nmalicious attachments to gain access into networks, allowing the attackers to move laterally\nover the network to steal data and infect more machines.\n\n## HiveLeaks\n\n\n-----\n\nIn addition to encrypting files, Hive also steals sensitive data from networks, threatening to\npublish everything in their HiveLeak website, hosted on the deep web, which is a common\npractice among ransomware working in this double extortion scheme.\n\nThere are two websites maintained by the group, the first one is protected by username and\npassword, accessible only by the victims who obtain the credentials in the ransom note.\n\nFigure\n\n01. Hive ransomware private website\nOnce authenticated, the victim can see:\n\n1. The name of the infected organization;\n2. A live chat, where the victim can interact with the attackers;\n3. A file upload system, where the victim can send files to the attackers;\n4. A link to Hive’s decryption software, if the ransom is paid by the victims.\n\n\n-----\n\nFigure 02. Victim’s private website by Hive ransomware\nThe second website, “HiveLeaks,” is where the attackers publish data about their targets and\nis publicly accessible.\n\nFigure 03. “HiveLeaks” logo.\n\nFor each target, you can see the name, a small description, the website, the revenue, and\nthe number of employees at the company. Also, you can see two dates, when the files were\nencrypted and when the attack was made public. Curiously enough, there are also two social\nmedia buttons where you can share this information.\n\n\n-----\n\nFigure 04. Information about the infected company on the “HiveLeaks” website.\nIf any data is published by the attackers, you will also find a link where the files can be\ndownloaded. Hive uses common file-sharing services for this purpose, such as PrivatLab,\nAnonFiles, MEGA, UFile, SendSpace, and Exploit.in, as shown in Figure 05.\n\nFigure 05. Links to download stolen data by Hive.\n\n## Memorial Health System Attack\n\n[The Hive ransomware infected the Memorial Health System (MHS) on August 15, 2021. The](https://www.mhs.net/)\nattackers claim to have stolen patient data including names, social security numbers, dates\nof birth, addresses and phone numbers, and medical histories for 200,000 patients, and an\nadditional 1.2 TB of other data.\n\nMHS tried to appeal to the attackers to provide the decrypter for free but ultimately ended up\npaying 1.8M, divided equally into two Bitcoin wallets. The attackers moved the Bitcoins to\nanother wallet just a few minutes after the transaction was made by MHS.\n\nAside from the decryptor, the attackers also promise a security report, a file tree describing\nall stolen data, and the logs proving that they had erased everything from their servers.\n\n## Analysis\n\n\n-----\n\nThe ransomware was written in Go, an open-source programming language that allows\ncross-compilation, meaning that the same source code can be compiled to different OS,\nsuch as Linux, Windows, and macOS.\n\nAlthough we have only seen Windows versions in the wild at this point, we have strong\nindications that the group is able to infect other systems such as Linux, as well as the\nHypervisor ESXi, as we will demonstrate later in the analysis.\n\nWe have analyzed two different samples, being 32 and 64-bit Windows versions of the\n[malware. Both of them are packed with UPX, which is an open-source executable packer.](https://upx.github.io/)\n\nFigure 06. Main Hive ransomware payload, packed with UPX.\nThe first thing we noticed is that both samples we analyzed had a command line interface\n(CLI), accepting parameters and also showing log messages throughout the malware\nexecution.\n\nThe 64-bit sample accepts two parameters:\n\n**kill: Kill processes specified as value (case insensitive regex)**\n**stop: Stop services specified as value (case insensitive regex)**\n\n\n-----\n\nFigure 07. Parameters accepted by the 64-bit sample of Hive.\nOn the other hand, the 32-bit sample offers three more options:\n\n**kill: Kill processes specified as value (case insensitive regex)**\n**no-clean: Do not clean disk space (described later in this analysis)**\n**skip: Files that the attacker doesn’t want to encrypt (case insensitive regex)**\n**skip-before: Skips files created before the specified date.**\n\n**stop: Stop services specified as value (case insensitive regex)**\n\nFigure 08. Parameters accepted by the 32-bit sample of Hive.\nAside from the parameters above, the attacker can also specify the path containing the files\nthat need to be encrypted. If this path isn’t specified, the ransomware will list all the files in\nthe machine, skipping the ones specified in the “-skip” and “-skip-before” parameters.\n\nFor analysis purposes, we have created a folder named “C:\\to_encrypt”, containing three\ndifferent pictures. Once executed, the ransomware starts printing out log messages\nthroughout the whole encryption process.\n\n\n-----\n\nFigure 09. 32\nbit Hive ransomware execution.\nThe log messages show pretty much everything the malware is doing, however, let’s take a\nlook at each one of the aspects being printed out.\n\nAnalyzing this 32-bit sample closely, we can see some of the function names parsed by the\ndisassembler, from a package the attackers named as “google.com”, perhaps as an attempt\nto deceive the analyst.\n\n\n-----\n\nFigure 10. 32-bit Hive function names.\n\nFirst, the malware calls a function encryptor.NewApp().\n\nFigure 11. “NewApp” Hive function.\n\nSimply put, this function initializes some important data used by the ransomware, such as\nthe primary key.\n\n\n-----\n\nFigure 12. “NewApp” function flow.\nThe function keys.NewPrimaryKey() generates a 10 MB random key used in the encryption\nprocess.\n\nFigure 13. 10 MB key generated by Hive.\n\nOnce the key is generated, the ransom note and a batch script are loaded into memory,\nwhich will be eventually saved to the disk during the process.\n\nAfter this setup is completed, the ransomware calls a function named App.Run(), which\nstarts the flow we saw in the log messages.\n\nFigure 14. Hive “Run” function.\n\n\n-----\n\nThe first function called inside App.Run() is App.ExportKey().\n\nFigure 15. “ExportKey”\n\nfunction.\nThis function is responsible for encrypting the 10 MB key generated by\n**keys.NewPrimaryKey().**\n\nFigure\n\n16. Main flow of “ExportKey” function.\nHive contains 100 public RSA keys embedded in the binary, which are used to encrypt the\nkey generated previously. They are all parsed through the function ParsePKCS1PublicKey\nfrom the [pkcs1.go library.](https://golang.org/src/crypto/x509/pkcs1.go)\n\nFigure 17. Hive ransomware loading\n\npublic RSA keys.\nThe malware then encrypts the data using the EncryptOAEP function from the [rsa.go library.](https://golang.org/src/crypto/rsa/rsa.go)\n\n\n-----\n\nFigure 18. Hive encrypting the key using RSA.\n\nThe encrypted key is then saved into a file that ends with “.key.hive” extension (or “key.\n<random>” for the 64-bit version). This is the file that is eventually loaded by the decryptor to\nretrieve the encryption key used in the process.\n\nFigure 19. Key file saved by Hive during the process.\n\nAfter creating the encrypted key, the malware calls two functions named\n**App.KillProcesses() and App.StopServices().**\n\nFigure 20. Hive functions to kill processes and stop services.\nThe name of these functions are self-explanatory, and the full list of default values for\n[stopped processes and services can be found in our GitHub repository.](https://github.com/netskopeoss/NetskopeThreatLabsIOCs/tree/main/Hive/IOCs)\n\nNext, Hive executes the functions App.RemoveItself() and App.RemoveShadowCopies().\n\nFigure 21. Next\n\ntwo functions executed by the “Run”.\nThe first one is responsible for creating a batch script that was loaded into memory by the\nfunction encryptor.NewApp(). The purpose of this script is to delete the ransomware\npayload once this process is done.\n\nFigure 22. Batch script created by Hive to\n\ndelete the payload from disk\nThe second function creates another batch script in disk that is responsible for deleting\nWindows Shadow Copies, to prevent any file restoration.\n\n\n-----\n\nFigure 23. “shadow.bat” script created by\n\nthe 32-bit Hive.\nHere, we have a big difference between the two samples we have analyzed. Instead of\ncreating a batch script, the 64-bit version we found uses several commands to delete not\nonly the Windows Shadow Copies, but also to stop services, including Windows Defender.\n\nFigure 24. Commands executed by the 64-bit Hive sample we analyzed.\nThe full list of commands executed by the 64-bit version can be found in our GitHub\nrepository.\n\nNext in the flow, we have two important functions:\n\nFigure 30.\n\n“ScanFiles” and “EncryptFiles” functions of Hive.\n**App.ScanFiles() is responsible for fetching all the files that will be encrypted by the**\nransomware. Also, this function creates the ransom note in disk, which was already loaded in\nmemory previously.\n\n**App.EncryptFiles() does exactly what the name describes. Within that function, the code is**\ncalling another two, respectively encryptFilesGroup() and EncryptFile(), loading the\ncontents of the targeted file in memory, encrypting the data with what seems to be a custom\nalgorithm created by Hive developers. Then, the encrypted file is written into disk, using the\nextension “.hive”.\n\nFigure 26. Files encrypted by Hive ransomware.\nFollowing the file encryption, we have another two functions executed by App.Run().\n\n\n-----\n\nFigure 27.\n\n“EraseKey” and “Notify” functions.\nThe function App.EraseKey() accesses the memory location where the 10 MB primary key\nwas stored by Hive and replaces all its bytes with random data.\n\nFigure 28. Before and after the “EraseKey” function\n**App.Notify() creates the ransom note in disk, which is redundant since this file is also**\ncreated by the function App.ScanFiles().\n\nLast but not least, we have a curious function executed by the ransomware if the flag “-no**clean” wasn’t specified, named App.CleanSpace().**\n\nFigure 29. “CleanSpace”\n\nfunction.\nSimply put, if executed, this code creates several files with 1GB+ each until the disk is full.\nThen, these newly created files are deleted.\n\n\n-----\n\nFigure 30. Files created by\n\nthe “CleanSpace” function.\nSince Hive deletes files that have been encrypted, this process is likely performed to\noverwrite any bytes on disk that could potentially be restored to their original state, creating\nnew files to replace deleted ones.\n\nFigure 31. Disk space while the “CleanSpace” function is being executed.\nDifferent from other ransomware families, Hive doesn’t change the user background, the only\nmessage available to the victim is the ransom note.\n\n\n-----\n\nFigure 32. Hive ransom note.\nAccording to the note, if the user deletes the file that has the “.key” extension, the data will\nbe undecryptable, which leads us to the next part of this blog.\n\n## Decryptor\n\nHive provides decryptors for ESXi, Linux, and Windows (32 / 64-bit).\n\nFigure 33. Hive ransomware\n\ndecryptors for MHS.\n\n\n-----\n\nAlthough we only found Windows versions of Hive in the wild, this is a strong indication that\nthey have payloads for other systems, aligning with the fact that the whole code was built in\nGo language, which is multi-platform.\n\nWhen it comes to the decryption process, the file first loads the encrypted key from disk,\nwhich is why the ransom note states that you can’t delete this file.\n\nFigure 34. Hive decryption process\nOnce the key is loaded and decrypted, Hive scans all directories searching for encrypted\nfiles, and then proceeds with the decryption process.\n\n## Conclusion\n\nHive is yet another ransomware group that is likely operating in the RaaS model. However,\nthe process used to encrypt the files is quite unusual.\n\nUsually, the encryption process implemented by ransomware in the wild is to generate a\nunique symmetric key for each file, that is eventually encrypted and stored along with the\nencrypted data, so it can be recovered later. Instead, Hive creates a unique key that is\neventually encrypted and written into disk, making the decryption process irreversible if this\nfile is deleted by accident. Furthermore, this ransomware contains functionalities that make\nthe execution slow, such as “wiping” the disk until it’s full to avoid file restoration.\n\nRegardless of these points, we consider Hive a dangerous threat, as it’s already causing\ndamage to people and organizations, combined with the fact that the threat is multi-platform.\n\n## Protection\n\nNetskope Threat Labs is actively monitoring this campaign and has ensured coverage for all\nknown threat indicators and payloads.\n\n**Netskope Threat Protection**\n\nGen:Variant.Ransom.Hive.2\nTrojan.GenericKD.37237769\n\n\n-----\n\n**Netskope Advanced Threat Protection provides proactive coverage against this**\nthreat.\n```\n      Gen.Malware.Detect.By.StHeur indicates a sample that was detected using\n\n```\nstatic analysis\n```\n      Gen.Malware.Detect.By.Sandbox indicates a sample that was detected by\n\n```\nour cloud sandbox\n\n## IOCs\n\n**SHA256**\n\nhive_x86 1e21c8e27a97de1796ca47a9613477cf7aec335a783469c5ca3a09d4f07db0ff\n\nhive_x64 321d0c4f1bbb44c53cd02186107a18b7a44c840a9a5f0a78bdac06868136b72c\n\n[A full list of IOCs is available in our Git repo.](https://github.com/netskopeoss/NetskopeThreatLabsIOCs/tree/main/Hive/IOCs)\n\nAbout the author\n\nGustavo Palazolo is an expert in malware analysis, reverse engineering and security\nresearch, working many years in projects related to electronic fraud protection. He is\ncurrently working on the Netskope Research Team, discovering and analyzing new malware\nthreats.\n\nGustavo Palazolo is an expert in malware analysis, reverse engineering and security\nresearch, working many years in projects related to electronic fraud protection. He is\ncurrently working on the Netskope Research Team, discovering and analyzing new malware\nthreats.\n\n[Read Gustavo Palazolo's full Bio >](https://www.netskope.com/blog/author/gpalazolo)\n[More Articles by Gustavo Palazolo >](https://www.netskope.com/blog/author/gpalazolo#author_articles)\n[Read full Bio >](https://www.netskope.com/blog/author/gpalazolo)\n[More articles](https://www.netskope.com/blog/author/gpalazolo#author_articles) \n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-09-10 - Hive Ransomware- Actively Targeting Hospitals.pdf"
    ],
    "report_names": [
        "2021-09-10 - Hive Ransomware- Actively Targeting Hospitals.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535779,
    "ts_updated_at": 1743041131,
    "ts_creation_date": 1653757974,
    "ts_modification_date": 1653757974,
    "files": {
        "pdf": "https://archive.orkl.eu/9399379865132aa58b0aa3e145556177e0d55ece.pdf",
        "text": "https://archive.orkl.eu/9399379865132aa58b0aa3e145556177e0d55ece.txt",
        "img": "https://archive.orkl.eu/9399379865132aa58b0aa3e145556177e0d55ece.jpg"
    }
}