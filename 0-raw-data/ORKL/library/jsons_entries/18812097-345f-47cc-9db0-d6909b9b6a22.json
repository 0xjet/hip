{
    "id": "18812097-345f-47cc-9db0-d6909b9b6a22",
    "created_at": "2023-01-12T15:04:41.803789Z",
    "updated_at": "2025-03-27T02:09:18.289024Z",
    "deleted_at": null,
    "sha1_hash": "2e0a79d7ad2de932be454d442d75e7fbe3a0ea0f",
    "title": "2021-08-27 - Cobalt Strike Configuration Extractor and Parser",
    "authors": "",
    "file_creation_date": "2022-05-28T18:57:41Z",
    "file_modification_date": "2022-05-28T18:57:41Z",
    "file_size": 97415,
    "plain_text": "# Cobalt Strike Configuration Extractor and Parser\n\n**[aon.com/cyber-solutions/aon_cyber_labs/cobalt-strike-configuration-extractor-and-parser/](https://www.aon.com/cyber-solutions/aon_cyber_labs/cobalt-strike-configuration-extractor-and-parser/)**\n\nWith each passing month and each new ransomware case, the consultants at Stroz\n[Friedberg Incident Response are finding Cobalt Strike Beacons to be the norm for](https://www.cobaltstrike.com/help-beacon)\npersistence, lateral movement, and exfiltration rather than the exception. Finding command\nand control (“C2”) servers and shutting off those connections is imperative before starting the\nrebuilding phase to help ensure threat actors can’t regain entry into the network. Due to the\nlarge volume of Beacons in our casework, and given the opportunity to dive deep into this\nadvanced post-exploitation framework, we set out to write a high-quality library and\nassociated set of command line tools for extracting and parsing configuration data from\nCobalt Strike Beacons to aid in accelerating response times. Today we are open sourcing\n[the library and scripts, as well as extensive Beacon and library documentation, for the](https://github.com/strozfriedberg/cobaltstrike-config-extractor)\nbroader DFIR community to use and collaborate on with us!\n\n## Getting Started\n\nThe [README contains detailed instructions for using pip to install the package from PyPI.](https://github.com/strozfriedberg/cobaltstrike-config-extractor)\nThere are two command line scripts that come bundled with the package:\n\n1. csce: Parse Beacon configuration data to JSON\n2. list-cs-settings: Attempt to discover, extract, and parse all possible Beacon\n\nconfiguration data by brute force\n\nThe first script, csce (Cobalt Strike Configuration Extractor), is intended for daily use to\nextract and parse Beacon configuration data and is the one most will likely be interested in.\nlist-cs-settings is designed for those who want to conduct research on Beacon configurations\nby attempting to detect setting types by brute force. Both the library and (thus) the scripts\ncurrently support parsing Beacon PE files (EXE/DLL) and memory dumps from systems\nrunning a Beacon. As an example, you can parse a Beacon DLL sample using csce like this:\n\n```\n> csce --pretty path/to/beacon.{exe,dll,bin,dmp}\n\n```\n\nThis will pretty-print Beacon configuration data as JSON (assuming the input file is a\n[Beacon) in a structure that closely mimics the Malleable C2 Profile of the Team Server the](https://cobaltstrike.com/help-malleable-c2)\nBeacon was generated from. The output shown below is from an HTTP Beacon we\nrecovered during one of our cases (with all sensitive IOCs redacted/replaced):\n\n\n-----\n\n```\n> csce pretty path/to/beacon.dll\n{\n \"beacontype\": [\n  \"HTTPS\"\n ],\n \"sleeptime\": 60000,\n \"jitter\": 0,\n \"maxgetsize\": 1048576,\n \"spawnto\": \"AAAAAAAAAAAAAAAAAAAAAA==\",\n \"license_id\": 1111111111,\n \"cfg_caution\": false,\n \"kill_date\": null,\n \"server\": {\n  \"hostname\": \"55.55.55.55\",\n  \"port\": 443,\n  \"publickey\": \"REDACTED\"\n },\n \"host_header\": null,\n \"useragent_header\": \"Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.2; WOW64;\nTrident/6.0; Touch)\",\n \"http-get\": {\n  \"uri\": \"/aa\",\n  \"verb\": \"GET\",\n  \"client\": {\n   \"headers\": [],\n   \"metadata\": [\n    \"base64\",\n    \"header 'Cookie'\"\n   ]\n  },\n  \"server\": {\n   \"output\": [\n    \"print\"\n   ]\n  }\n },\n \"http-post\": {\n  \"uri\": \"/endpoint.php\",\n  \"verb\": \"POST\",\n  \"client\": {\n   \"headers\": [\n    \"Content-Type: application/octet-stream\"\n   ],\n   \"id\": [\n    \"parameter 'id'\"\n   ],\n   \"output\": [\n    \"print\"\n   ]\n  }\n },\n \"tcp_frame_header\": null,\n \"crypto_scheme\": 0,\n \"proxy\": {\n  \"type\": null,\n\n```\n\n-----\n\n```\n  username : null,\n  \"password\": null,\n  \"behavior\": \"Use IE settings\"\n },\n \"http_post_chunk\": 0,\n \"uses_cookies\": true,\n \"post-ex\": {\n  \"spawnto_x86\": \"%windir%\\\\syswow64\\\\rundll32.exe\",\n  \"spawnto_x64\": \"%windir%\\\\sysnative\\\\rundll32.exe\"\n },\n \"process-inject\": {\n  \"allocator\": \"VirtualAllocEx\",\n  \"execute\": [\n   \"CreateThread\",\n   \"SetThreadContext\",\n   \"CreateRemoteThread\",\n   \"RtlCreateUserThread\"\n  ],\n  \"min_alloc\": 0,\n  \"startrwx\": true,\n  \"stub\": \"REDACTED\",\n  \"transform-x86\": null,\n  \"transform-x64\": null,\n  \"userwx\": true\n },\n \"dns-beacon\": {\n  \"dns_idle\": \"0.0.0.0\",\n  \"dns_sleep\": 0,\n  \"maxdns\": 255,\n  \"beacon\": null,\n  \"get_A\": null,\n  \"get_AAAA\": null,\n  \"get_TXT\": null,\n  \"put_metadata\": null,\n  \"put_output\": null\n },\n \"pipename\": \"\",\n \"smb_frame_header\": null,\n \"stage\": {\n  \"cleanup\": false\n },\n \"ssh\": {\n  \"hostname\": null,\n  \"port\": null,\n  \"username\": null,\n  \"password\": null,\n  \"privatekey\": null\n }\n}\n\n```\nBeacons do not contain full Malleable C2 Profiles for space and OPSEC reasons, but as is\nshown above critical sections can be reconstructed from Beacon configuration data including\nC2 IP addresses and domains, beaconing behavior and payload settings, and more. These\n\n\n-----\n\ndata points can be very important during the containment phase of an investigation. For\nBeacon-specific settings that aren’t specified in the Malleable C2 Profile, we did our best to\ngroup items together where it makes sense (i.e., the ssh section).\n\n## Why Use It?\n\nThere are few primary reasons why we recommend the use of this library and these scripts\nover other open source options:\n\n1. Fairly well tested against generated samples and samples discovered in the wild.\n2. Relatively fast and will likely get faster over time.\n3. To our knowledge, the only library/scripts that attempt to reconstruct the Malleable C2\n\nProfile from Beacon configuration data.\n\n## Where are the Tests?\n\nYou might be thinking “they said it’s fairly well tested, but I don’t see any test samples in the\nGitHub repository. What Gives?” Many of the samples we use for testing were gathered from\nclient environments, and thus we cannot publish them to GitHub. Moreover, we think it’s\ngenerally a bad idea to publish malware to a repository others may download to computers\nnot configured for malware sandboxing. However, we will likely add unit tests for the core\nparser logic in the future, and we currently test all the examples present in the\n[documentation for correctness (shoutout to doctest).](https://docs.pytest.org/en/6.2.x/doctest.html)\n\n## Our Hope and Vision\n\nThese tools have helped speed up our own investigations, and our hope is that by sharing\nthem with the community they will do the same for others. Our long-term vision is to work\ncollectively with DFIR practitioners and researchers to help make these tools the best\navailable for parsing Cobalt Strike Beacons, and raise the bar for threat actors going forward.\n\n## Honorable Mentions\n\nMany others in the DFIR community have performed in-depth research on Cobalt Strike\nBeacons. We want to recognize those who published findings that helped us, directly or\nindirectly, along the way:\n\n[1. SentinelOne: Cobalt Strike Beacon parser](https://github.com/Sentinel-One/CobaltStrikeParser)\n[2. RomanEmelyanov: Cobalt Strike forensics scripts](https://github.com/RomanEmelyanov/CobaltStrikeForensic)\n[3. Apr4h: Scan Windows processes for Cobalt Strike Beacons](https://github.com/Apr4h/CobaltStrikeScan)\n[4. JPCert: Cobalt Strike Volatility plugin](https://blogs.jpcert.or.jp/en/2018/08/volatility-plugin-for-detecting-cobalt-strike-beacon.html)\n[5. Didier Stevens: Cobalt Strike Beacon parser](https://blog.didierstevens.com/2020/11/07/1768-k/)\n\n\n-----\n\nAuthor: Noah Rubin\nAugust 27, 2021\nCopyright 2021 Aon Plc\n\n_This material has been prepared for informational purposes only and should not be relied on for any other purpose. You should_\n_consult with your own professional advisors or IT Department before implementing any recommendation or following the guidance_\n_provided herein. The companies referenced in this article and/or links provided have no affiliation with our firm and we do not_\n_represent any opinions or support any studies by these third party sources. Further, the information provided and the statements_\n_expressed are not intended to address the circumstances of any particular individual or entity. Although we endeavor to provide_\n_accurate and timely information and use sources that we consider reliable, there can be no guarantee that such information is_\n_accurate as of the date it is received or that it will continue to be accurate in the future._\n\nCyber security services offered by Stroz Friedberg Inc. and its affiliates. Insurance products\nand services offered by Aon Risk Insurance Services West, Inc., Aon Risk Services Central,\nInc., Aon Risk Services Northeast, Inc., Aon Risk Services Southwest, Inc., and Aon Risk\nServices, Inc. of Florida and their licensed affiliates. Aon UK Limited is authorised and\nregulated by the Financial Conduct Authority in respect of insurance distribution services.\nFP.AGRC.238.JJ The following products or services are not regulated by the Financial\nConduct Authority:\n\n- Cyber risk services provided by Aon UK Limited and its affiliates\n\n- Cyber security services provided by Stroz Friedberg Limited and its affiliates.\n\nCopyright 2021 Aon plc. All Rights Reserved.\nCyber security services offered by Stroz Friedberg Inc. and its affiliates. Insurance products\nand services offered by Aon Risk Insurance Services West, Inc., Aon Risk Services Central,\nInc., Aon Risk Services Northeast, Inc., Aon Risk Services Southwest, Inc., and Aon Risk\nServices, Inc. of Florida and their licensed affiliates. Aon UK Limited is authorised and\nregulated by the Financial Conduct Authority in respect of insurance distribution services.\nFP.AGRC.238.JJ The following products or services are not regulated by the Financial\nConduct Authority:\n\n- Cyber risk services provided by Aon UK Limited and its affiliates\n\n- Cyber security services provided by Stroz Friedberg Limited and its affiliates.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-08-27 - Cobalt Strike Configuration Extractor and Parser.pdf"
    ],
    "report_names": [
        "2021-08-27 - Cobalt Strike Configuration Extractor and Parser.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535881,
    "ts_updated_at": 1743041358,
    "ts_creation_date": 1653764261,
    "ts_modification_date": 1653764261,
    "files": {
        "pdf": "https://archive.orkl.eu/2e0a79d7ad2de932be454d442d75e7fbe3a0ea0f.pdf",
        "text": "https://archive.orkl.eu/2e0a79d7ad2de932be454d442d75e7fbe3a0ea0f.txt",
        "img": "https://archive.orkl.eu/2e0a79d7ad2de932be454d442d75e7fbe3a0ea0f.jpg"
    }
}