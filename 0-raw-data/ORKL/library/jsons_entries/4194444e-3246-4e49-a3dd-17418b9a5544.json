{
    "id": "4194444e-3246-4e49-a3dd-17418b9a5544",
    "created_at": "2023-01-12T15:10:11.626999Z",
    "updated_at": "2025-03-27T02:06:00.78094Z",
    "deleted_at": null,
    "sha1_hash": "7350be8748e51cad30c07c064f87a209a976bd58",
    "title": "2017-10-31 - Expiro Malware Is Back and Even Harder to Remove",
    "authors": "",
    "file_creation_date": "2022-05-28T15:14:34Z",
    "file_modification_date": "2022-05-28T15:14:34Z",
    "file_size": 1036898,
    "plain_text": "# Expiro Malware Is Back and Even Harder to Remove\n\n**[mcafee.com/blogs/other-blogs/mcafee-labs/expiro-infects-encrypts-files-to-complicate-repair/](https://www.mcafee.com/blogs/other-blogs/mcafee-labs/expiro-infects-encrypts-files-to-complicate-repair/)**\n\nOctober 31, 2017\n\n[Xiaobing Lin](https://www.mcafee.com/blogs/author/xiaobing-lin/)\nOct 31, 2017\n\n5 MIN READ\n\nFile infector malware adds malicious code to current files. This makes removal tricky\nbecause deleting infections results in the loss of legitimate files. Although file infectors were\nmore popular in the 1990s and early 2000s, they still pose a significant threat. The complex\ndisinfection process is usually leveraged by malware authors to ensure systems stay infected\nfor a long period. This may explain why complex file infectors such as W32/VirRansom,\nW32/Sality, W32/Xpaj, and Expiro are still active today.\n\nThe Expiro virus is has been around for more than a decade, and the authors continue to\nupdate it with more features. Expiro is unique in that it infiltrates executable files on both 32and 64-bit Windows systems by appending its viral code to the host. It can be used to install\nmalicious browser extensions, lower browser security settings, and steal account credentials.\n\nRecently we discovered a new variant of Expiro with a significant change in its infection\nroutine. In previous variants, Expiro modified and stole code at the entry point and appended\nthe viral payload only at the end of the original file, typical of an appender virus.\n\nThe new variant, however, changes the size of the base relocation table and encrypts the\naddresses inside, causing traditional appender virus repair routines to corrupt files unless\nthey correctly restore the original base relocation table. By adding the encryption, Expiro\nincreases the complexity of analysis and requires a customized repair routine, which makes\nit hard to combat.\n\nThe following screenshots demonstrate this point: The base relocation table of a file infected\nby the old variant of Expiro is unaffected and the contents are untouched.\n\n\n-----\n\n_Figure 1: The relocation table remains intact when infected by the old Expiro variant._\n\n_Figure 2: The relocation table contents are not modified by the old Expiro variant._\n\nThe new variant reduces the size of the base relocation table and encrypts portions of it\n(outlined in red).\n\n\n-----\n\n_Figure 3: The latest Expiro variant reduces the size of the relocation table._\n\n_Figure 4: The relocation table encrypted by the latest Expiro variant._\n\nTo fix relocations prior to the execution of the original file’s code, the Expiro virus first\nexecutes its own malicious payload. It then decrypts the relocation table and dynamically\nreloads all addresses to make sure the original file can run correctly.\n\nDecryption involves a simple XOR operation with a key hardcoded within the sample.\n\n\n-----\n\n_Figure 5: Relocation table being decrypted using a hardcoded XOR key._\n\nAfter the decryption, the rest of original base relocation table is recovered.\n\n_Figure 6: The EDI register now contains decrypted relocation data._\n\nIn recovery step 2, Expiro computes the address that contains the relocation address using\nthe formula Relocation_Address = NewImageBase + Offset + VirtualAddress.\n\n_Figure 7: Calculation of the address to be relocated in Expiro’s code._\n\nAs we see in the following screenshot, the formula leads to Relocation_Address = 0x950000\n+ 0x354 + 0x1000, so the address in 0x951354 should be relocated (stored in eax).\n\n\n-----\n\n_Figure 8: Relocation address being calculated._\n\nIn recovery step 3, Expiro computes the relocation value using the formula Relocation_Value\n= OldValue + (NewImageBase – OldImagebase).\n\n_Figure 9: Relocation value being computed by Expiro._\n\nIn this case, the formula is Relocation _Value = 0x01001354 + (0x00950000 – 0x01000000),\nso the relocation value is 0x00951354.\n\n_Figure 10: Expiro performing relocations on its own._\n\nUsing this technique, we can decrypt and repair the entire relocation table of the files\ninfected by Expiro. This also helps us to calculate and replace the relocation table size in an\nexecutable’s optional header with the correct values. These changes ensure the infected\nfiles can run properly after removing the malicious payload.\n\nMcAfee products detect Expiro as W32/Expiro.gen.rd and W64/Expiro.d and repair infected\nfiles from DAT Version 8665. Users can find additional information at this McAfee Labs\nThreat Advisory.\n\n## SHA-256 hash\n\nf15b8fc3ca117ab38e3074adc6208666b2189259e447db8202ef85b9bbfc4537\n\n[Xiaobing Lin](https://www.mcafee.com/blogs/author/xiaobing-lin/)\n\n## More from McAfee Labs\n\n[Crypto Scammers Exploit: Elon Musk Speaks on Cryptocurrency](https://www.mcafee.com/blogs/other-blogs/mcafee-labs/crypto-scammers-exploit-talk-on-cryptocurrency/%20)\n\nBy Oliver Devane Update: In the past 24 hours (from time of publication) McAfee has\nidentified 15...\n\nMay 05, 2022 |  4 MIN READ\n\n[Instagram Credentials Stealer: Disguised as Mod App](https://www.mcafee.com/blogs/other-blogs/mcafee-labs/instagram-credentials-stealer-disguised-as-mod-app/%20)\n\n\n-----\n\nAuthored by Dexter Shin McAfee s Mobile Research Team introduced a new Android\nmalware targeting Instagram users who...\n\nMay 03, 2022 |  4 MIN READ\n\n[Instagram Credentials Stealers: Free Followers or Free Likes](https://www.mcafee.com/blogs/other-blogs/mcafee-labs/instagram-credentials-stealers-free-followers-or-free-likes/%20)\n\nAuthored by Dexter Shin Instagram has become a platform with over a billion monthly active\nusers. Many...\n\nMay 03, 2022 |  6 MIN READ\n\n[Scammers are Exploiting Ukraine Donations](https://www.mcafee.com/blogs/other-blogs/mcafee-labs/scammers-are-exploiting-ukraine-donations/%20)\n\nAuthored by Vallabh Chole and Oliver Devane Scammers are very quick at reacting to\ncurrent events, so...\n\nApr 01, 2022 |  7 MIN READ\n\n[Imposter Netflix Chrome Extension Dupes 100k Users](https://www.mcafee.com/blogs/other-blogs/mcafee-labs/imposter-netflix-chrome-extension-dupes-100k-users/%20)\n\nAuthored by Oliver Devane, Vallabh Chole, and Aayush Tyagi McAfee has recently\nobserved several malicious Chrome Extensions...\n\nMar 10, 2022 |  8 MIN READ\n\n\n-----\n\n[Why Am I Getting All These Notifications on my Phone?](https://www.mcafee.com/blogs/other-blogs/mcafee-labs/why-am-i-getting-all-these-notifications-on-my-phone/%20)\n\nAuthored by Oliver Devane and Vallabh Chole  Notifications on Chrome and Edge, both\ndesktop browsers, are commonplace,...\n\nFeb 25, 2022 |  5 MIN READ\n\n[Emotet’s Uncommon Approach of Masking IP Addresses](https://www.mcafee.com/blogs/other-blogs/mcafee-labs/emotets-uncommon-approach-of-masking-ip-addresses/%20)\n\nIn a recent campaign of Emotet, McAfee Researchers observed a change in techniques. The\nEmotet maldoc was...\n\nFeb 04, 2022 |  4 MIN READ\n\n[HANCITOR DOC drops via CLIPBOARD](https://www.mcafee.com/blogs/other-blogs/mcafee-labs/hancitor-doc-drops-via-clipboard/%20)\n\nHancitor, a loader that provides Malware as a Service, has been observed distributing\nmalware such as FickerStealer,...\n\nDec 13, 2021 |  6 MIN READ\n\n\n-----\n\n[‘Tis the Season for Scams](https://www.mcafee.com/blogs/other-blogs/mcafee-labs/tis-the-season-for-scams/%20)\n\n‘Tis the Season for Scams\n\nNov 29, 2021 |  18 MIN READ\n\n[The Newest Malicious Actor: “Squirrelwaffle” Malicious Doc.](https://www.mcafee.com/blogs/other-blogs/mcafee-labs/the-newest-malicious-actor-squirrelwaffle-malicious-doc/%20)\n\nAuthored By Kiran Raj Due to their widespread use, Office Documents are commonly used\nby Malicious actors...\n\nNov 10, 2021 |  4 MIN READ\n\n[Social Network Account Stealers Hidden in Android Gaming Hacking Tool](https://www.mcafee.com/blogs/other-blogs/mcafee-labs/social-networks-account-stealer-hidden-in-android-gaming-hacking-tool/%20)\n\nAuthored by: Wenfeng Yu McAfee Mobile Research team recently discovered a new piece of\nmalware that specifically...\n\nOct 19, 2021 |  6 MIN READ\n\n\n-----\n\n[Malicious PowerPoint Documents on the Rise](https://www.mcafee.com/blogs/other-blogs/mcafee-labs/malicious-powerpoint-documents-on-the-rise/%20)\n\nAuthored by Anuradha M McAfee Labs have observed a new phishing campaign that utilizes\nmacro capabilities available...\n\nSep 21, 2021 |  6 MIN READ\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-10-31 - Expiro Malware Is Back and Even Harder to Remove.pdf"
    ],
    "report_names": [
        "2017-10-31 - Expiro Malware Is Back and Even Harder to Remove.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536211,
    "ts_updated_at": 1743041160,
    "ts_creation_date": 1653750874,
    "ts_modification_date": 1653750874,
    "files": {
        "pdf": "https://archive.orkl.eu/7350be8748e51cad30c07c064f87a209a976bd58.pdf",
        "text": "https://archive.orkl.eu/7350be8748e51cad30c07c064f87a209a976bd58.txt",
        "img": "https://archive.orkl.eu/7350be8748e51cad30c07c064f87a209a976bd58.jpg"
    }
}