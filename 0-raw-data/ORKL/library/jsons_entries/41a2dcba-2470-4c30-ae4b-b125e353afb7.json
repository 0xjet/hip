{
    "id": "41a2dcba-2470-4c30-ae4b-b125e353afb7",
    "created_at": "2022-10-25T16:48:23.6076Z",
    "updated_at": "2025-03-27T02:05:51.493515Z",
    "deleted_at": null,
    "sha1_hash": "49ff7bd8d2e3b6ea2618ac706f06d884dfb19975",
    "title": "",
    "authors": "",
    "file_creation_date": "2022-07-22T15:22:58Z",
    "file_modification_date": "2022-07-22T15:22:58Z",
    "file_size": 2114503,
    "plain_text": "# ON THE FOOTSTEPS OF HIVE RANSOMWARE\n\n 22/07/2022\n\n\n-----\n\n2\n\n\n-----\n\n## DEFENCE BELONGS TO HUMANS….\n\n3\n\n\n-----\n\n22/07/2022 Report delivery Luigi Martire, Carmelo Ragusa\n\n|Date|Activity|Author|\n|---|---|---|\n|22/07/2022|Report delivery|Luigi Martire, Carmelo Ragusa|\n||||\n||||\n||||\n||||\n\n\n4\n\n\n-----\n\n## Table of Content\n\nTable of Content ........................................................................................................................................................................ 5\n\nIntroduction ............................................................................................................................................................................... 6\n\nAbout Hive .................................................................................................................................................................................. 6\n\nTimeline of the development of Hive Ransomware .............................................................................................................. 7\n\nVictimology ................................................................................................................................................................................. 9\n\nHive v1 ...................................................................................................................................................................................... 11\n\nHive v2 ...................................................................................................................................................................................... 14\n\nHive v3 ...................................................................................................................................................................................... 17\n\nLinux/FreeBSD version ........................................................................................................................................................... 17\n\nHive v3 ESXI .............................................................................................................................................................................. 19\n\nHive v4 ...................................................................................................................................................................................... 21\n\nHive v5 ...................................................................................................................................................................................... 21\n\nConclusion ................................................................................................................................................................................ 26\n\nAppendix .................................................................................................................................................................................. 27\n\nIndicators of Compromise .................................................................................................................................................. 27\n\nYara Rules ............................................................................................................................................................................. 28\n\n5\n\n\n-----\n\n## Introduction\n\nHive ransomware is one of the most active financially motivated threat actors of this period, adopting the current\n\nDouble Extorsion model. They started their malicious activities in June of the past year, and just in a year of activity\n\nthey collected a big number of victims, demonstrating the capability to hit even critical infrastructures.\n\nThe criminal group distinguished from other ones also for attacking healthcare organization during the 2021 when\n\n[we had to face off the Covid-19 pandemic. It was emblematic that one of the first victims was the Memorial Health](https://therecord.media/hive-ransomware-shuts-down-california-health-care-organization/)\n\nSystem in August 2021.\n\nFor these reasons, Yoroi’s Malware ZLab decided to keep track of this infamous threat actor and observe any\n\nmodification of its modus operandi, in order to provide a guideline focusing on the evolution of the locker sample\n\nof the cyber gang.\n\n## About Hive\n\nHive (TH-313) is a Ransomware group firstly spotted in June 2021 and it gathered a big popularity inside the\n\ncybersecurity community because it was able to attack a large variety of sectors, starting from healthcare facilities\n\nand arriving to critical infrastructures, passing through manufacturers during just a year of activity.\n\nIn addition, the group was able to refine its toolkit and then its TTPs with a surprising speed: the business model is\n\nthe Double-Extorsion and Ransomware-as-a-Service, with a self-made ransomware payload.\n\nFigure 1: Hive (TH-313)\n\n6\n\n\n-----\n\nSo, in this report we have decided to focus our attention on the ransomware payload evolution, providing a\ntimeline of the development of Hive Ransomware Payloads.\n\n## Timeline of the development of Hive Ransomware\n\nInside the criminal group, there is surely a high-profile development team, with deep knowledge of programming\n\nin both newer and older programming languages. The first versions of the encryptor payload are written in Golang,\n\nthen, starting from the v5 version, the dev team of Hive switched into Rust.\n\nFigure 2: Leak site\n\nIn the following timeline, we provide a quick overview of the evolution of the malware and how the cyber gang\n\nadopted an incremental development process on its TTPs:\n\n7\n\n\n-----\n\nFigure 3: Hive Timeline\n\nIn the same way, even the Ransom Note changed during the evolution: first, the credentials were hardcoded inside\n\nthe sample, but now the operators pass them as a parameter when the locker process is launched. Below a\n\ncomparison between an earlier version and a later one:\n\nFigure 4: Ransom note comparison\n\n8\n\n\n-----\n\n## Victimology\n\nDuring its activity, Hive Group hit a large number of victims and during that period some of them paid the ransom,\n\nafter that the victims were removed from the “walk of shame”. We tracked a total of 130 victims listed on their leak\n\nsite, the affected companies belong to different sectors and nations. However, we have evidence that occasionally\n\nsome victims of the group, despite being attacked by the threat actor, are never reported onto the site.\n\nMoreover, the group does not exclude hospitals, companies that provide medical equipment and non-profit\n\norganizations. An example is the attack on the \"Memorial Health System\" in August 2021 or more recently on the\n\n\"Partnership HealthPlan of California\", a non-profit organization.\n\nThe following graph shows the total progress of the victims so far, indicating that the group is consolidating its role\n\nas one of the principal threats in the panorama.\n\nFigure 5: Hive Ransomware Victims Progress over time\n\nAnother view of the same information is represented in the following graph, where the focus is pointed to highlight\n\nthe month in which most victims were published on their leak site, which turns out to be July 2021, shortly after the\n\ngroup started. So, it means that the ransomware operators gathered a consistent number of victims during the\n\nstartup phase, in order to create a solid placement inside the threat landscape. After that phase, the gang\n\ncontinued to threaten with huge aggression.\n\n9\n\n\n-----\n\nFigure 6: Hive Victims Per Month\n\n\n10\n\n\n-----\n\n## Hive v1\n\nHash 88f7544a29a2ceb175a135d9fa221cbfd3e8c71f32dd6b09399717f85ea9afd1\n\nThreat Ransomware\n\nBrief Description Hive Ransomware v1\n\nSSDEEP 12288:CinNFNkY/yU97ppM4NSBG81Np2C9H4S3iDjlLtc4wCIITIQaOI6NrwacVYV+4MsT:CinN3n/y67\n\njM4v4kCSPDjlLtbwt8IQLH\n\nTable 1: Hive v1\n\nThe first version, written in Golang, was a sophisticated encryptor program, but, due to the newness of the\n\nmalicious activity, there is no track of obfuscation, and the strings can be easily seen, the following figure shows\n\nsome of the available parameters:\n\nFigure 7: Available parameters\n\nThe initial effort of the gang was to make a product quite customizable according to the infection and the\n\nencryption process to perform. In this way, the malware writers provided a series of parameters to launch an ad\nhoc infection profile.\n\nThe following table describes all the available parameters found in this version:\n\n11\n\n|BERSECURITY Hive v1|Y ANNUAL REPORT|\n|---|---|\n|Hash|88f7544a29a2ceb175a135d9fa221cbfd3e8c71f32dd6b09399717f85ea9afd1|\n|Threat|Ransomware|\n|Brief Description|Hive Ransomware v1|\n|SSDEEP|12288:CinNFNkY/yU97ppM4NSBG81Np2C9H4S3iDjlLtc4wCIITIQaOI6NrwacVYV+4MsT:CinN3n/y67 jM4v4kCSPDjlLtbwt8IQLH|\n\n\n-----\n\n|Parameter|Description|\n|---|---|\n|-kill|Regex, names of the processes to kill. Default values: “mspub|msdesktop”|\n|-no-clean|Skip clean disk space stage|\n|-skip|Regex, names of the files to skip. Default values: “\\\\.lnk”|\n|-skip-before|Skip files before a specific date. Defaut value: “03.09.2016”|\n|-stop|Regex, names of the services to stop. Default values: \"bmr|sql|oracle|postgres|redis|vss|backup|sstp\"|\n|-t|Number of threads|\n\n\nTable 2: Hive v1 Parameters\n\nOnce the parameters are parsed, creating the desired infection profile, the control flow passes to the core\n\nmalicious operations.\n\nFigure 8: Hive core function\n\nThe locker sample proceeds to export the key, to kill the processes and services specified and to remove the\n\nshadow copies then it iterates the directories and starts encrypting the files.\n\n\n12\n\n\n-----\n\nThe core of the encryption scheme of Hive ransomware is a union of XOR+RSA algorithms. In the figure below we\n\ncan see the XOR related routine:\n\nFigure 9: Usage of XOR algorithm\n\nThen, in this first version, it uses “.hive” as extension to the encrypted files, later it is used a unique ID instead.\n\nMoreover, the RemoveItself routine drops “hive.bat” to remove itself. But, since the second version of the\n\nmalware calls the related function after the encryption is complete:\n\nFigure 10: hive.bat\n\n**RemoveShadowCopies drops “shadow.bat” to remove the shadow copies, from the second version will directly**\n\nexecute the command instead of dropping a .bat:\n\nFigure 11: shadow.bat\n\n13\n\n\n-----\n\n## Hive v2\n\nHash 25bfec0c3c81ab55cf85a57367c14cc6803a03e2e9b4afd72e7bbca9420fe7c5\n\nThreat Ransomware\n\nBrief Description Hive Ransomware v2\n\nSSDEEP 12288:Sw41dVZvThPCsM18GLHe7wlDdkPAQEtxr0fflvRmhEBWtdUJiAUtP/T/kAfMvgV:dod1HDmlD\n\ndkZ4YXPpaTTXMw\n\nTable 3: Hive v2\n\nWith the second version of Hive, the malware writers started to complicate the code in order to make the analysis\n\nmore difficult for the analyst. The initial step is to obfuscate the “Go Build ID” header present in all golang- written\n\nbinaries.\n\nFigure 12: Strings comparison\n\nThe simple trick causes that, when opening a disassembler, like IDA, the analyst can immediately see Golang not\n\nbeing recognized. However, a simple fix provides the overwriting of the build-id with a legit one.\n\nFigure 13: “Go Build ID” patch\n\nIn addition, now the strings are obfuscated, and the names of the functions present inside the main are not visible\n\nin cleartext:\n\n14\n\n|BERSECURITY Hive v2|Y ANNUAL REPORT|\n|---|---|\n|Hash|25bfec0c3c81ab55cf85a57367c14cc6803a03e2e9b4afd72e7bbca9420fe7c5|\n|Threat|Ransomware|\n|Brief Description|Hive Ransomware v2|\n|SSDEEP|12288:Sw41dVZvThPCsM18GLHe7wlDdkPAQEtxr0fflvRmhEBWtdUJiAUtP/T/kAfMvgV:dod1HDmlD dkZ4YXPpaTTXMw|\n\n\n-----\n\nFigure 14: Obfuscated parameters\n\nIn the following screen two different routines for the strings obfuscation is provided:\n\nFigure 15: Strings decryption routines\n\n\n15\n\n\n-----\n\nThe help command has also changed, it has more default values, the “-t” and “-skip” parameters have been\n\nremoved, “-grant” has been added and “-no-clean” renamed to “-no-wipe”\n\n**Parameter** **Description**\n\n-grant Grant permissions to all files\n\n-kill Regex, names of the processes to kill. Default values:\n\n\"agntsvc|sql|CNTAoSMgr|dbeng50|dbsnmp|encsvc|excel|firefoxconfig|infopath|mbamtray|msaccess\n\n|mspub|mydesktop|Ntrtscan|ocautoupds|ocomm|ocssd|onenote|oracle|outlook|PccNTMon|powerp\n\nnt|sqbcoreservice|steam|synctime|tbirdconfig|thebat|thunderbird|tmlisten|visio|word|xfssvccon|zo\n\nolz\"\n\n-no-wipe Skip wipe of free space\n\n-stop Regex, names of the services to stop. Default values:\n\n\"acronis|AcrSch2Svc|Antivirus|ARSM|AVP|backup|bedbg|CAARCUpdateSvc|CASAD2DWebSvc|ccEvtMg\n\nr|ccSetMgr|Culserver|dbeng8|dbsrv12|DCAgent|DefWatch|EhttpSrv|ekrn|Enterprise Client\n\nService|EPSecurityService|EPUpdateService|EraserSvc11710|EsgShKernel|ESHASRV|FA_Scheduler|fireb\n\nird|IISAdmin|IMAP4Svc|Intuit|KAVFS|KAVFSGT|kavfsslp|klnagent|macmnsvc|masvc|MBAMService|MB\n\nEndpointAgent|McAfee|McShield|McTaskManager|memtas|mepocs|mfefire\n\n|mfemms|mfevtp|MMS|MsDtsServer|MsDtsServer100|MsDtsServer110|msexchange|msmdsrv|MSOL\n\nAP|MVArmor|MVarmor64|NetMsmqActivator|ntrtscan|oracle|PDVFSService|POP3Svc|postgres|QBCF\n\nMonitorService|QBFCService|QBIDPService|redis|report|RESvc|RTVscan|sacsvr|SamSs|SAVAdminServi\n\nce|SavRoam|SAVService|SDRSVC|SepMasterService|ShMonitor|Smcinst|SmcService|SMTPSvc|SNAC|S\n\nntpService|sophos|sql|SstpSvc|stc_raw_agent|^svc|swi_|Symantec|TmCCSF|tmlisten|tomcat|TrueKey\n\n|UI0Detect|veeam|vmware|vss|W3Svc|wbengine|WebClient|wrapper|WRSVC|WSBExchange|YooIT|z\n\nhudongfangyu|Zoolz\"\n\nTable 4: Hive v2 parameters\n\nThe string obfuscation process does not impact the structure of the main function, following a comparison of these\n\ntwo versions.\n\nFigure 16: Functions name comparison\n\n16\n\n|Parameter|Description|\n|---|---|\n|-grant|Grant permissions to all files|\n|-kill|Regex, names of the processes to kill. Default values: \"agntsvc|sql|CNTAoSMgr|dbeng50|dbsnmp|encsvc|excel|firefoxconfig|infopath|mbamtray|msaccess |mspub|mydesktop|Ntrtscan|ocautoupds|ocomm|ocssd|onenote|oracle|outlook|PccNTMon|powerp nt|sqbcoreservice|steam|synctime|tbirdconfig|thebat|thunderbird|tmlisten|visio|word|xfssvccon|zo olz\"|\n|-no-wipe|Skip wipe of free space|\n|-stop|Regex, names of the services to stop. Default values: \"acronis|AcrSch2Svc|Antivirus|ARSM|AVP|backup|bedbg|CAARCUpdateSvc|CASAD2DWebSvc|ccEvtMg r|ccSetMgr|Culserver|dbeng8|dbsrv12|DCAgent|DefWatch|EhttpSrv|ekrn|Enterprise Client Service|EPSecurityService|EPUpdateService|EraserSvc11710|EsgShKernel|ESHASRV|FA_Scheduler|fireb ird|IISAdmin|IMAP4Svc|Intuit|KAVFS|KAVFSGT|kavfsslp|klnagent|macmnsvc|masvc|MBAMService|MB EndpointAgent|McAfee|McShield|McTaskManager|memtas|mepocs|mfefire |mfemms|mfevtp|MMS|MsDtsServer|MsDtsServer100|MsDtsServer110|msexchange|msmdsrv|MSOL AP|MVArmor|MVarmor64|NetMsmqActivator|ntrtscan|oracle|PDVFSService|POP3Svc|postgres|QBCF MonitorService|QBFCService|QBIDPService|redis|report|RESvc|RTVscan|sacsvr|SamSs|SAVAdminServi ce|SavRoam|SAVService|SDRSVC|SepMasterService|ShMonitor|Smcinst|SmcService|SMTPSvc|SNAC|S ntpService|sophos|sql|SstpSvc|stc_raw_agent|^svc|swi_|Symantec|TmCCSF|tmlisten|tomcat|TrueKey |UI0Detect|veeam|vmware|vss|W3Svc|wbengine|WebClient|wrapper|WRSVC|WSBExchange|YooIT|z hudongfangyu|Zoolz\"|\n\n\n-----\n\n## Hive v3\n\nHash 8a461e66ae8a53ffe98d1e2e1dc52d015c11d67bd9ed09eb4be2124efd73ccd5\n\nThreat Ransomware\n\nBrief Description Hive Ransomware v3\n\nSSDEEP 49152:gWVNVvSGbjmrb/T6vO90dL3BmAFd4A64nsfJuhQ8jmp4S3C5CEg+eNgiQJfOqAD:gWYQjPhQC\n\nmppnMfO\n\nTable 5: Hive v3\n\nIn this version the “-skip” parameter has been restored and, in another sample\n\n(3858e95bcf18c692f8321e3f8380c39684edb90bb622f37911144950602cea21), we found a new parameter named\n\n“scan”:\n\n**Parameter** **Description**\n\n-scan Scan local network for shares\n\nTable 6: Hive v3 Additional parameters\n\nComparing the logs from the v1 we can spot the following differences:\n\n  - The key name is longer and it has a random extension\n\n  - It shows the time elapsed for the encryption of each file\n\nFigure 17: Comparison of logs\n\n## Linux/FreeBSD version\n\nThe third version of the development of Hive ransomware saw the porting of the codebase for other operating\n\nsystems, such as Linux/FreeBSD and ESXi.\n\nThe Linux (12389b8af28307fd09fe080fd89802b4e616ed4c961f464f95fdb4b3f0aaf185) and FreeBSD\n\n(bdf3d5f4f1b7c90dfc526340e917da9e188f04238e772049b2a97b4f88f711e3) versions are almost identical to the\n\nWindows one, despite the obvious OS differences. One of those differences is the following function “KillNonRoot”\n\naimed at killing all non-root processes:\n\n17\n\n|BERSECURIT Hive v3|TY ANNUAL REPORT|\n|---|---|\n|Hash|8a461e66ae8a53ffe98d1e2e1dc52d015c11d67bd9ed09eb4be2124efd73ccd5|\n|Threat|Ransomware|\n|Brief Description|Hive Ransomware v3|\n|SSDEEP|49152:gWVNVvSGbjmrb/T6vO90dL3BmAFd4A64nsfJuhQ8jmp4S3C5CEg+eNgiQJfOqAD:gWYQjPhQC mppnMfO|\n\n|Parameter|Description|\n|---|---|\n|-scan|Scan local network for shares|\n\n\n-----\n\nFigure 18: “KillNonRoot” Function\n\n\n18\n\n\n-----\n\n## Hive v3 ESXI\n\nHash 822d89e7917d41a90f5f65bee75cad31fe13995e43f47ea9ea536862884efc25\n\nThreat Ransomware\n\nBrief Description Hive Ransomware v3\n\nSSDEEP 3072:3Zp7gZzdfvjRCMj1Yk36ioyJ1zgjIlOhXYopNL+V7o0xvvkB/37Nt7xhew8A2Mz:P7g\n\nDj8S1Hlx14+opNClvk977ew8A2M\n\nTable 7: Hive v3 ESXI\n\nIn this case, the malware is written in C/C++, in order to have a better compatibility with the target operating\n\nsystem, the strings are not obfuscated, and we have found some new parameters:\n\n**Parameter** **Description**\n\n-no-stop Don’t stop virtual machines\n\n-low-cpu Single thread encryption\n\nTable 8: Hive v3 ESXI Parameters\n\nAfter the routine of exporting the keys already seen in the previous paragraphs, the sample stops all the running\n\nvirtual machines in order to encrypt them without problems:\n\nFigure 19: “Stopping virtual machines\n\nThe ransom note contains also a reference to not delete or reinstall the virtual machines:\n\n19\n\n|Hash|822d89e7917d41a90f5f65bee75cad31fe13995e43f47ea9ea536862884efc25|\n|---|---|\n|Threat|Ransomware|\n|Brief Description|Hive Ransomware v3|\n|SSDEEP|3072:3Zp7gZzdfvjRCMj1Yk36ioyJ1zgjIlOhXYopNL+V7o0xvvkB/37Nt7xhew8A2Mz:P7g Dj8S1Hlx14+opNClvk977ew8A2M|\n\n|Parameter|Description|\n|---|---|\n|-no-stop|Don’t stop virtual machines|\n|-low-cpu|Single thread encryption|\n\n\n-----\n\nFigure 20: Ransom note\n\nAs said, the objective of this version is to encrypt the virtual machines hosted on the ESXi server, so, the malware\n\ngoes to find the virtual machines deployed on the server, by using a custom regex aimed at finding the words “vm”\n\nor “vs”.\n\nFigure 21: Regex for ESXI version\n\n20\n\n\n-----\n\n## Hive v4\n\nHash 33aceb3dc0681a56226d4cfce32eee7a431e66f5c746a4d6dc7506a72b317277\n\nThreat Ransomware\n\nBrief Description Hive Ransomware v4\n\nSSDEEP 49152:e2NiZPNNirb/T2vO90dL3BmAFd4A64nsfJk0NuXCdmTQb0/6VCrrPrsbg11VgWA:e2ANB04yIa0h\n\nsirubO\n\nTable 9: Hive v4\n\nThe fourth version of Hive locker is an effort to obfuscate also the code. We haven’t noticed new features or\n\nupgrades except for a more serious obfuscation of the code and changes in the details of the key generation and\n\nencryption.\n\nIn detail, this version adopts the control flow flattering obfuscation technique, which is largely adopted by many\n\nattackers, thanks to its actual effectiveness. Below an example of that technique:\n\nFigure 22: Control flattening obfuscation\n\n## Hive v5\n\nThe fifth version of hive represents a sort of revolution inside the entire codebase. In this version, the major\n\ndifferences include the changing of the base programming language and the refinement encryption algorithm.\n\nHash b6b1ea26464c92c3d25956815c301caf6fa0da9723a2ef847e2bb9cd11563d8b\n\nThreat Ransomware\n\nBrief Description Hive Ransomware v5.2\n\nSSDEEP 12288:BLF6OtM1z8JLbA689tSfvTvFSYIzp4yzhrWbttQfaa4Gxjzgdlo/AhwN/eh9z/E:BLF6\n\ngb0xqx9z/EO3BxhR\n\nTable 10: Hive v5\n\nHive is now written in Rust and for this reason the difficulty has increased, along with a complex encryption scheme\n\nmakes the analysis harder even for experienced analysts.\n\nThe refinement of the encryption process considers the passing from “XOR+RSA” of the previous versions, arriving\n\nto “ECDH+Curve25519+XChaCha20-Poly1305”\n\n21\n\n|BERSECURIT Hive v4|TY ANNUAL REPORT|\n|---|---|\n|Hash|33aceb3dc0681a56226d4cfce32eee7a431e66f5c746a4d6dc7506a72b317277|\n|Threat|Ransomware|\n|Brief Description|Hive Ransomware v4|\n|SSDEEP|49152:e2NiZPNNirb/T2vO90dL3BmAFd4A64nsfJk0NuXCdmTQb0/6VCrrPrsbg11VgWA:e2ANB04yIa0h sirubO|\n\n|Hash|b6b1ea26464c92c3d25956815c301caf6fa0da9723a2ef847e2bb9cd11563d8b|\n|---|---|\n|Threat|Ransomware|\n|Brief Description|Hive Ransomware v5.2|\n|SSDEEP|12288:BLF6OtM1z8JLbA689tSfvTvFSYIzp4yzhrWbttQfaa4Gxjzgdlo/AhwN/eh9z/E:BLF6 gb0xqx9z/EO3BxhR|\n\n\n-----\n\nFor this version we found the following parameters:\n\n**Parameter** **Description**\n\n-no-local Don’t encrypt local files\n\n-no-mounted Don’t encrypt on mounted network volumes\n\n-no-discovery Don’t discover network volumes\n\n-local-only Encrypt only local files\n\n-network-only Encrypt only network volumes\n\n-explicit-only Encrypt specified folders\n\n-min-size Minimum file size\n\n-timerze-only N/A\n\n-da N/A\n\nTable 11: Hive v5 parameters\n\nOnce executed, the sample checks for the parameter “-u”, which should contain the “username:password” used as\n\ncredentials for the victim and written in the ransom note, if this unique parameter is missing, the program exits.\n\n+\n\nFigure 23: -u parameter\n\nEven the routine to decrypt the ransom note changed. In this case, the protection of the ransom note relies on a\n\nXOR key.\n\nFigure 24: Decrypted Ransom Note\n\n22\n\n|Parameter|Description|\n|---|---|\n|-no-local|Don’t encrypt local files|\n|-no-mounted|Don’t encrypt on mounted network volumes|\n|-no-discovery|Don’t discover network volumes|\n|-local-only|Encrypt only local files|\n|-network-only|Encrypt only network volumes|\n|-explicit-only|Encrypt specified folders|\n|-min-size|Minimum file size|\n|-timerze-only|N/A|\n|-da|N/A|\n\n\n-----\n\nAnother update is the expansion on the other drives. The sample generates an array of drive labels and uses\n\n**GetDriveTypeW to check if the path is invalid:**\n\nFigure 25: Finding of logical drives\n\nOnce the attached volumes are found, it calls FindFirstVolumeW and SetVolumeMountPointW to mount\n\neventual unmounted volumes:\n\nFigure 26: Mounting available volumes\n\n\n23\n\n\n-----\n\nAfter that, the operation of privilege escalation is performed though abusing the “TrustedInstaller” service to\n\nrecover its access token. In this way, the malware is able to read and write files with the same privileges of\n\nTrustedInstaller Group.\n\nFigure 27: Retrieving TrustedInstaller access token\n\nMoreover, in the previous versions, we saw bat files and other escamotages for the erasing of the backup\n\nmechanisms provided by the Microsoft Environment.\n\nIn the fifth version analyzed, there are the following tricks:\n\n  - vssadmin.exe delete shadows /all /quiet\n\nFigure 28: vssadmin\n\n  - bcedit /set {default} bootstatuspolicy ignoreallfailures\n\nFigure 29: bcedit\n\n  - wbadmin delete systemstatebackup –keepversions:3\n\n\n24\n\n\n-----\n\nFigure 30: wbadmin\n\n\n25\n\n\n-----\n\n## Conclusion\n\nHive threat actor is one of the most sophisticated active threats. It does not care about the target, the only\n\nobjective is to maximize the illicit profits, even by causing the interruption of critical services. The continuous\n\ndevelopment of the ransomware payload should not be underestimated, and in the same way organizations must\n\nupgrade their cyber protections.\n\nWe at Yoroi ZLab believe that collaboration and sharing more information possible about attackers is the right way\n\nto pursue to defend these entities. We know that having to deal with these threats is challenging, so we are\n\npointing to create the best expertise needed to handle such incidents whether they happen.\n\nIn conclusion, we need to create a solid and reliable strategy to defend our customers. we encourage our\n\ncustomers to make assessments and awareness campaigns for their employees. The goal of the Defence Center of\n\nYoroi is to guarantee the best protection in every phase of the attack, starting from the continuous monitoring\n\narriving to the Incident Response engagements.\n\n26\n\n\n-----\n\n## Appendix\n\n### Indicators of Compromise\n\nHive v1\n\n  - 88f7544a29a2ceb175a135d9fa221cbfd3e8c71f32dd6b09399717f85ea9afd1 (Sample)\n\n  - d158f9d53e7c37eadd3b5cc1b82d095f61484e47eda2c36d9d35f31c0b4d3ff8 (shadow.bat)\n\nHive v2:\n\n  - 25bfec0c3c81ab55cf85a57367c14cc6803a03e2e9b4afd72e7bbca9420fe7c5\n\nHive v3\n\n  - 8a461e66ae8a53ffe98d1e2e1dc52d015c11d67bd9ed09eb4be2124efd73ccd5\n\nHive v3 Linux/FreeBSD\n\n  - 12389b8af28307fd09fe080fd89802b4e616ed4c961f464f95fdb4b3f0aaf185 (Linux)\n\n  - Bdf3d5f4f1b7c90dfc526340e917da9e188f04238e772049b2a97b4f88f711e3 (FreeBSD)\n\nHive v3 ESXI\n\n  - 822d89e7917d41a90f5f65bee75cad31fe13995e43f47ea9ea536862884efc25\n\nHive v4\n\n  - 33aceb3dc0681a56226d4cfce32eee7a431e66f5c746a4d6dc7506a72b317277\n\nHive v5.2\n\n  - b6b1ea26464c92c3d25956815c301caf6fa0da9723a2ef847e2bb9cd11563d8b\n\n\n27\n\n\n-----\n\n### Yara Rules\n\nrule hive_v1_32_win\n{\nstrings:\n$1 =\n{648b0d140000008b89000000003b61080f86e401000083ec40e8?2f?feff8b04248b4c240485c90f8556010000b941000000\n31d231db8d2d?4??6300eb0341d1e883f95a0f8f29010000a90100000074ed895c2434896c243c894c242489542430894424\n288d44242c}\ncondition:\n$1 and uint16(0) == 0x5A4D\n}\nrule hive_v1_64_win\n{\nstrings:\n$1 = { 65 4? 8b 0c ?5 28 00 00 00 4? 8b 89 00 00 00 00 4? 3b 61 10 0f 86 ?? ?? ?? ?? 4? 83 ec 40 4? 89 6c ?4 38 4? 8d 6c ?4\n38 4? 8b 44 ?4 48 4? 89 04 ?4 e8 ?? ?? ?? ?? 4? 8b 44 ?4 08 4? 8b 4c ?4 10 4? 83 7c ?4 08 00 0f 85 ?? ?? ?? ?? 4? 89 44 ?4 20 4?\n89 4c ?4 18 4? 8b 44 ?4 48 4? 89 04 ?4 90 e8 ?? ?? ?? ?? 4? 8b 44 ?4 48 4? 89 04 ?4 e8 ?? ?? ?? ?? 4? 8b 44 ?4 48 4? 89 04 ?4 0f\n1f 40 00 e8 ?? ?? ?? ?? 4? 8b 44 ?4 48 4? 89 04 ?4 e8 ?? ?? ?? ?? 4? 8b 44 ?4 48 4? 89 04 ?4 0f 1f 40 00 e8 ?? ?? ?? ?? 4? 8b 44 ?4\n48 4? 89 04 ?4 e8 ?? ?? ?? ?? 4? 8b 44 ?4 48 4? 89 04 ?4 0f 1f 40 00 e8 ?? ?? ?? ?? 4? 8b 44 ?4 48 4? 89 04 ?4 e8 ?? ?? ?? ?? 4? 8b\n44 ?4 48 4? 89 04 ?4 0f 1f 40 00 e8 ?? ?? ?? ?? 4? 8b 44 ?4 48 80 78 48 00 74 ?? 90 0f 57 c0 0f 11 44 ?4 28 4? 8d 05 ?? ?? ?? ??\n4? 89 ?? ?4 28 4? 8d 05 ?? ?? ?? ?? 4? 89 ?? ?4 30 4? 8d 44 ?4 28 4? 89 04 ?4 4? c7 44 ?4 08 01 00 00 00 4? c7 44 ?4 10 01 00\n00 00 e8 ?? ?? ?? ?? 4? 8b 44 ?4 20 4? 89 44 ?4 50 4? 8b 44 ?4 18 4? 89 44 ?4 58 4? 8b 6c ?4 38 4? 83 c4 40 c3 4? 89 04 ?4\ne8 ?? ?? ?? ?? eb ?? 4? 89 44 ?4 50 4? 89 4c ?4 58 4? 8b 6c ?4 38 4? 83 c4 40 c3 }\n\ncondition:\n$1 and uint16(0) == 0x5A4D\n}\n\nrule hive_v2_v3_32_win\n{\nstrings:\n//prenotify routine\n$1 = { 64 8b 0d 14 00 00 00 8b 89 00 00 00 00 3b 61 08 0f 86 ?? ?? ?? ?? 83 ec ?? c7 44 ?4 04 ?? ?? ?? ?? c7 04 ?4 ?? ?? ?? ??\ne8 ?? ?? ?? ?? e8 ?? ?? ?? ?? 8b 04 ?4 8b 4c ?4 04 c7 44 ?4 4c 00 00 00 00 c7 44 ?4 50 00 00 00 00 89 04 ?4 89 4c ?4 04\ne8 ?? ?? ?? ?? 8b 44 ?4 08 8d 0d ?? ?? ?? ?? 89 4c ?4 4c 89 44 ?4 50 8d 44 ?4 4c 89 04 ?4 c7 44 ?4 04 01 00 00 00 c7 44 ?4 08\n01 00 00 00 e8 ?? ?? ?? ?? 8b 44 ?4 68 89 04 ?4 e8 ?? ?? ?? ?? 8b 44 ?4 04 89 44 ?4 48 8b 4c ?4 08 89 4c ?4 38 31 d2 eb ?? }\ncondition:\n$1 and uint16(0) == 0x5A4D\n}\n\nrule hive_v2_64_win\n{\nstrings:\n$1 =\n{654?8b0c?5280000004?8b89000000004?8d44????4?3b41100f86????????4?81ec????????4?89ac??????????4?8dac??????????4?\nb8????????????????4?8904?4e8????????e8????????4?8b04?44?8b4c?4080f57c00f1184??????????4?8904?44?894c?408e8????????\n4?8b44?4104?8d0d????????4?898c??????????4?8984??????????4?8d84??????????4?8904?44?c744?408010000004?c744?410010\n00000e8????????4?8b84??????????4?8904?40f1f440000e8????????4?8b44?4084?8b4c?4104?85c97e??4?89?c}\ncondition:\n$1 and uint16(0) == 0x5A4D\n}\n\n28\n\n\n-----\n\nrule hive_v3_v4_64_win\n{\nstrings:\n$1 = {4? 3b 66 10 0f 86 ?? ?? ?? ?? 4? 83 ec 30 4? 89 6c ?4 28 4? 8d 6c ?4 28 4? 89 44 ?4 20 0f 1f 00 e8 ?? ?? ?? ?? 4? 85 c0 0f\n85 ?? ?? ?? ?? 4? 8b 44 ?4 20 e8 ?? ?? ?? ?? 4? 85 c0 74 ?? 4? 8b 6c ?4 28 4? 83 c4 30 c3 4? 89 44 ?4 10 4? 89 5c ?4 18 4? 8b\n44 ?4 20 e8 ?? ?? ?? ?? 4? 8b 44 ?4 20 e8 ?? ?? ?? ?? 4? 8b 44 ?4 20 e8 ?? ?? ?? ?? 4? 89 c3 4? 8b 44 ?4 20 e8 ?? ?? ?? ?? 4? 8b\n44 ?4 20 e8 ?? ?? ?? ?? 4? 8b 44 ?4 20 e8 ?? ?? ?? ?? 4? 8b 44 ?4 20 e8 ?? ?? ?? ?? 4? 8b 44 ?4 20 90 e8 ?? ?? ?? ?? 4? 8b 44 ?4 10\n4? 8b 5c ?4 18 4? 8b 6c ?4 28 4? 83 c4 30 c3 4? 8b 6c ?4 28 4? 83 c4 30 c3}\ncondition:\n$1 and uint16(0) == 0x5A4D\n}\n\nrule hive_v5_32_win\n{\nstrings:\n$1 =\n{5589e553575681ec440400008b75108b7d0c89d3894dc88d85b0fbffff68000400006a0050e8????????83c40c0fbec3b9abaa\naaaa8b0485c0b949008945e889f0f7e1d1ea8d045229c683f60389f0f7e131c9d1ea8d04528d570229c68b45148955cc8975e\n48b00}\ncondition:\n$1 and uint16(0) == 0x5A4D\n}\n\nrule hive_v5_64_win\n{\nstrings:\n$1 =\n{4157415641554154565755534881ec880400004c89cd448844243789d648894c2450488b9c24f0040000488bbc24f804000\n0488d8c248800000041b80004000031d2e8??????00480fbec6488d0d??????004c8b24c148b9abaaaaaaaaaaaaaa4889d848f\n7e148d1ea488d04524989de4929c64983f6034c89f048f7e148d1ea488d04524929c6488b07}\ncondition:\n$1 and uint16(0) == 0x5A4D\n}\n\nrule hive_v3_esxi\n{\nstrings:\n$s1 = \"+ prenotify %s\"\n$s2 = \"Stopping VMs\"\n$s3 = \"(.+)\\\\.(.+?)\\\\.%s$\"\n$s4 = \"\\\\.(vm|vs)\\\\w+$\"\n\n$c = {f3 0f 1e fa 55 4? 89 e5 4? 83 ec 20 4? 89 7? ?? 4? 8b 4? ?? 4? 89 c7 e8 ?? ?? ?? ?? 89 4? ?? 83 7? ?? 00 74 ?? 8b 4? ??\neb ?? 4? 8b 4? ?? 4? 89 c7 e8 ?? ?? ?? ?? 89 4? ?? 83 7? ?? 00 74 ?? 4? 8d 3d ?? ?? ?? ?? e8 ?? ?? ?? ?? 8b 4? ?? eb ?? 4? 8b 4? ?? 4?\n89 c7 e8 ?? ?? ?? ?? 4? 8b 4? ?? 4? 89 c7 e8 ?? ?? ?? ?? 4? 8b 4? ?? 4? 89 c7 e8 ?? ?? ?? ?? 4? 8b 4? ?? 4? 89 c7 e8 ?? ?? ?? ?? 4? 8b\n4? ?? 4? 89 c7 e8 ?? ?? ?? ?? b8 00 00 00 00 c9 c3}\n\ncondition:\n(all of ($s*) or $c) and uint32(0) == 0x464C457F\n}\n\n29\n\n\n-----\n\n**Yoroi S.r.l.**\n**www.yoroi.company -** **[info@yoroi.company](mailto:info@yoroi.company)**\n\n**Piazza Sallustio, 9**\n00187 – Roma (RM)\n\n+39 (051) 0301005\n\nYoroi S.r.l. ® 2014-2021 – Tutti i diritti riservati\n\n\nYoroi S.r.l. società soggetta ad attività di direzione e coordinamento esercitata dalla Tinexta S.p.A.\n\n\nYoroi ® è un marchio registrato Registrazione N°: 016792947\n\n\n30\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        }
    ],
    "references": [
        "https://yoroi.company/wp-content/uploads/2022/07/Yoroi-On-The-Footsteps-of-Hive-Ransomware.pdf"
    ],
    "report_names": [
        "Yoroi-On-The-Footsteps-of-Hive-Ransomware.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1666716503,
    "ts_updated_at": 1743041151,
    "ts_creation_date": 1658503378,
    "ts_modification_date": 1658503378,
    "files": {
        "pdf": "https://archive.orkl.eu/49ff7bd8d2e3b6ea2618ac706f06d884dfb19975.pdf",
        "text": "https://archive.orkl.eu/49ff7bd8d2e3b6ea2618ac706f06d884dfb19975.txt",
        "img": "https://archive.orkl.eu/49ff7bd8d2e3b6ea2618ac706f06d884dfb19975.jpg"
    }
}