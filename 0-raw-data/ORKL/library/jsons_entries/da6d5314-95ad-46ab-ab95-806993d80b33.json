{
    "id": "da6d5314-95ad-46ab-ab95-806993d80b33",
    "created_at": "2022-10-25T16:48:16.245085Z",
    "updated_at": "2025-03-27T02:14:48.545777Z",
    "deleted_at": null,
    "sha1_hash": "917691a4f8af50a09926f97bf1be2e0cb71f8c68",
    "title": "Uroburos Highly Complex Espionage Software With Russian Roots",
    "authors": "Gdata",
    "file_creation_date": "2014-02-28T17:03:48Z",
    "file_modification_date": "2014-02-28T17:05:38Z",
    "file_size": 558883,
    "plain_text": "# G Data Red Paper 2014\n Uroburos Highly complex espionage software with Russian roots\n\n\n## G Data discovers alleged intelligence agency software\n\n##### G Data SecurityLabs\n\n\nContact:\nintelligence@gdata.de\n\n\n-----\n\n### Contents\n\n**Executive Summary ............................................................................................................................. 2**\n\n**What is Uroburos? ................................................................................................................................ 2**\n\nTechnical complexity suggests connections to intelligence agencies ...................................................... 2\n\nRelation to Russian attack against U.S. suspected ............................................................................................ 2\n\nProbably undiscovered for at least three years .................................................................................................. 3\n\nInfection vector still unknown .................................................................................................................................. 3\n\n**Analysis ................................................................................................................................................. 4**\n\nUroburos’ name ............................................................................................................................................................. 4\n\nRootkit framework ........................................................................................................................................................ 5\n\nHiding malicious activities with the help of hooks ........................................................................................... 5\n\nVirtual file systems ........................................................................................................................................................ 6\n\nThe NTFS file system .................................................................................................................................................... 6\n\nThird party tools ............................................................................................................................................................ 7\n\nInjected libraries - controlling the activities ........................................................................................................ 8\n\nNetwork capabilities .................................................................................................................................................... 9\n\nVictims and attribution ............................................................................................................................................ 10\n\n**Conclusion .......................................................................................................................................... 11**\n\n**Technical details ................................................................................................................................. 11**\n\n\n-----\n\n#### Executive Summary\n\nG Data Security experts have analyzed a very complex and sophisticated piece of malware, designed\nto steal confidential data. G Data refers to it as Uroburos, in correspondence with a string found in\nthe malware's code and following an ancient symbol depicting a serpent or dragon eating its own\ntail.\n\n##### What is Uroburos?\n\nUroburos is a rootkit, composed of two files, a driver and an encrypted virtual file system. The rootkit\nis able to take control of an infected machine, execute arbitrary commands and hide system\nactivities. It can steal information (most notably: files) and it is also able to capture network traffic. Its\nmodular structure allows extending it with new features easily, which makes it not only highly\nsophisticated but also highly flexible and dangerous. Uroburos' driver part is extremely complex and\nis designed to be very discrete and very difficult to identify.\n\n##### Technical complexity suggests connections to intelligence agencies\n\nThe development of a framework like Uroburos is a huge investment. The development team\nbehind this malware obviously comprises highly skilled computer experts, as you can infer from the\nstructure and the advanced design of the rootkit. We believe that the team behind Uroburos has\ncontinued working on even more advanced variants, which are still to be discovered.\n\nUroburos is designed to work in peer-to-peer mode, meaning that infected machines communicate\namong each other, commanded by the remote attackers. By commanding one infected machine\nthat has Internet connection, the malware is able to infect further machines within the network,\neven the ones without Internet connection. It can spy on each and every infected machine and\nmanages to send the exfiltrated information back to the attackers, by relaying this exfiltrated data\nthrough infected machines to one machine with Internet connection. This malware behavior is\ntypical for propagation in networks of huge companies or public authorities. The attackers expect\nthat their target does have computers cut off from the Internet and uses this technique as a kind of\nworkaround to achieve their goal.\n\nUroburos supports 32-bit and 64-bit Microsoft Windows systems. Due to the complexity of this\nmalware and the supposed spying techniques used by it, we assume that this rootkit targets\ngovernments, research institutes, or/and big companies.\n\n##### Relation to Russian attack against U.S. suspected\n\nDue to many technical details (file name, encryption keys, behavior and more details mentioned in\nthis report), we assume that the group behind Uroburos is the same group that performed a\ncyberattack against the United States of America in 2008 with a malware called Agent.BTZ. Uroburos\nchecks for the presence of Agent.BTZ and remains inactive if it is installed. It appears that the\nauthors of Uroburos speak Russian (the language appears in a sample), which corroborates the\nrelation to Agent.BTZ. Furthermore, according to public newspaper articles, this fact, the usage of\nRussian, also applied for the authors of Agent.BTZ.\n\nAccording to all indications we gathered from the malware analyses and the research, we are sure of\nthe fact that attacks carried out with Uroburos are not targeting John Doe but high profile\nenterprises, nation states, intelligence agencies and similar targets.\n\n\n-----\n\n##### Probably undiscovered for at least three years\n\nThe Uroburos rootkit is one of the most advanced rootkits we have ever analyzed in this\nenvironment. The oldest driver we identified was compiled in 2011, which means that the campaign\nremained undiscovered for at least three years.\n\n##### Infection vector still unknown\n\nAt the current stage of the investigations it is unknown how Uroburos initially infiltrates high profile\nnetworks. Many infection vectors are conceivable. E.g. spear phishing, drive-by-infections, USB\nsticks, or social engineering attacks.\n\n\n-----\n\n#### Analysis\n\nThe G Data SecurityLabs discovered the rootkit dubbed Uroburos during 2013. We decided to\ninvestigate in depth soon after we identified the following three interesting aspects:\n\n the usage of virtual file systems\n the complexity of the framework\n the advanced network capabilities\n\n##### Uroburos’ name\n\nUroburos is a direct reference to the Greek word Ouroboros (Οὐροβόρος). The Ouroboros is an\nancient symbol depicting a serpent or dragon eating its own tail. The name of this rootkit is inspired\nby a plain text string available in several driver files: Ur0bUr()sGotyOu#\n\n**_Figure 1: Uroburos name string within the driver’s code_**\n\nFurthermore, we identified other references to the ancient serpent/dragon symbol within the\nrootkit’s code, for example the following strings:\n\n inj_snake_Win32.dll\n inj_snake_Win64.dll\n snake_alloc\n snake_free\n snake_modules_command\n\nAnother interesting notion: The exact spelling,\nUroburos, can even be found in a webcomic called\nHomestuck. In this interactive webcomic, the\nreader/player needs two codes to receive virtual\nmagic objects (called juju). Those two codes are in\nfact uROBuROS and UrobUros. We can notice that\nthe uppercase and lowercase character order\nmatches the string found within the malware\ncode.\n\n\n**_Figure 1: Uroburos name string within the driver’s code_**\n\n\n-----\n\n##### Rootkit framework\n\nThe rootkit is basically composed of two files:\n\n a driver (.sys file);\n a virtual file system (.dat file).\n\nWe identified several file names for the driver, for example: Ultra3.sys, msw32.sys, vstor32.sys. We\nhave encountered 32-bit and 64-bit driver versions. The two binaries may be installed\nsimultaneously on one system.\nThe file containing the virtual file system has a random name, followed by the extension .dat.\nFurthermore, this file is located in the same directory as the driver file. The installation directory does\nchange, but we were able to identify the following pattern:\n\n %SYSTEMROOT%\\$Ntuninstall[Random_ID]$\n\nThe malware’s persistence is established by the creation of a service which automatically executes\nduring each startup of the system. The service is located in\n\n HKLM\\System\\CurrentControlSet\\Services\\Ultra3\n\nThe driver is needed to\n\n decrypt the virtual file systems\n create several hooks to hide its activities\n inject libraries in the users land\n establish and manage some communication channels\n\n##### Hiding malicious activities with the help of hooks\n\nA rootkit naturally tries to hide its activities from the user and so does Uroburos. The driver uses\ninline patching to perform the hooks, which is a common way to perform this task. Inline patching is\ncarried out by modifying the beginning of a targeted system’s function in order to redirect the\nexecution flow to a custom code before jumping back to the original function.\n\nIn the current case, the inline patching\nadds a new interrupt instruction (int 0xc3)\nat the beginning of the hooked function.\nDoing this, the malware adds malicious\nbehavior to legitimate functions.\n\n**_Figure 3: Hook function is called and calls, in turn, the_**\n\n_legitimate function_\n\n\n-----\n\nThe main hooked functions are:\n\n `ZwQueryKey(), ZwEnumerateKey(),`\n```\n   ZwCreateKey() and ZwSaveKey()\n\n```\ntheir purpose is to hide the persistence keys\nin the registry\n `ZwReadFile()`\nits purpose is to hide the driver and file\nsystem files\n `ZwQuerySystemInformation()`\nits purpose is to hide rootkit handles\n `ZwTerminateProcess()` **_Figure 4: ZwQueryKey() hook creation_**\nits purpose is to terminate cleanly the rootkit\nduring the shutdown of the operating system\n `ObOpenObjectByName()`\nits purpose is to hide the rootkit’s virtual file systems\n\n##### Virtual file systems\n\nThe Uroburos rootkit uses two virtual file systems – one NTFS file system and one FAT file system.\nThey are stored locally, on the infected machine. This means that the victim’s computer contains an\nencrypted file, which, in reality, hosts another file system.\n\nThe virtual file systems are used as a work space by the attackers. They can store third party tools,\npost-exploitation tools, temporary files and binary output. The virtual file systems can be accessed\nthrough the devices \\Device\\RawDisk1 and \\Device\\RawDisk2 and the volume \\\\.\\Hd1 and \\\\.\\Hd2.\n\n##### The NTFS file system\n\nThe encryption used for the file systems is CAST-128[1]. The respective encryption key is hardcoded\nwithin the driver file. Once decrypted, the virtual file system is a classic NTFS volume, which can be\nsimply accessed through the standard Microsoft file system APIs. During our analysis, we identified\nseveral files the file systems contained:\n\n .bat scripts used by the attackers\n .log files with the output of the execution of the .bat files\n third party tools\n queue files\n\nThe .bat scripts contain some net use commands to map a remote file server, netstat commands to\nhave network information, system info commands to get a complete view of the system\nconfiguration.\n\n**_Figure 5: Example of one of the .bat scripts_**\n\n1 http://en.wikipedia.org/wiki/CAST-128\n\n\n**_Figure 5: Example of one of the .bat scripts_**\n\n\n-----\n\nThe queue file is the most interesting and complex part of the virtual file system. Each message in\nthe queue contains a unique ID, a type, a timestamp and content. The content is also encrypted\nusing the CAST-128 algorithm and the respective key is stored in a message, too. The messages can\ncontain the following information:\n\n a key to decrypt other messages\n a configuration\n a file (or library injected in user land)\n …\n\n##### Third party tools\n\nWe found classic post-exploitation tools, used by a lot of different APT actors. The following list\nprovides an overview of the tools found in the virtual file system:\n\n Dumper for NTLM (hash of a user’s password). This information can be used to perform “pass\nthe hash”[2] attacks, to compromise new systems within the infrastructure\n information gathering tools, to get information on the infected system\n RAR tools, to create archives of stolen documents\n Microsoft Office document stealer\n …\n\n**_Figure 6:_** _Information gathering example_\n\n2 http://en.wikipedia.org/wiki/Pass_the_hash\n\n\n-----\n\n##### Injected libraries - controlling the activities\n\nThe driver injects several libraries into user land. These libraries are stored in encrypted form in the\nqueue file. These files are used to create a kind of “proxy” between the kernel land and the user land.\nThe driver injects two noteworthy libraries:\n\n inj_services_Win32.dll\n inj_snake_Win32.dll\n\nIf the infected system is a 64-bit system, Win32 is replaced by Win64. The libraries are very huge\n(more than 150 functions) and contain a lot of features. They are able to manipulate the queue file\nfrom the user land. Following, a list of functions dedicated to the queue management (qm):\n\n\n `qm_create()`\n `qm_enum()`\n `qm_find_first()`\n `qm_free()`\n `qm_move()`\n `qm_pop()`\n `qm_push()`\n `qm_read()`\n\n\n `qm_read_hdr()`\n `qm_reset_len()`\n `qm_rm()`\n `qm_rm_list()`\n `qm_set_dates()`\n `qm_set_parem()`\n `qm_write()`\n\n\nThe libraries have the capability to create and manage a pcap[3] capture. The purpose of this feature is\nto generate a snapshot of the network traffic.\n\nThe libraries are furthermore used to exfiltrate data to the outside world, namely the attackers. We\nidentified several protocols to perform this task: generally, the configuration needed for each\nprotocol is stored in the queue file and not within the library itself.\n\n HTTP protocol\nthe attackers can choose to use a website to exfiltrate data. The rootkit supports GET and\nPOST requests and proxy authentication, too. The default URI is http://%s/default.asp but it\nis configurable. The media type of the request is chosen from the following list:\n\n      - application/vnd.ms-powerpoint\n\n      - application/vnd.ms-excel\n\n      - application/msword\n\n      - image/gif\n\n      - image/x-bitmap\n\n      - image/jpeg\n\n      - image/pjpeg\n\n      - application/x-shockwave-flash\n\n      - or */*\n\n3 http://en.wikipedia.org/wiki/Pcap\n\n\n-----\n\n ICMP protocol\nthe attackers can choose to use ICMP (ping) to exfiltrate data\n SMTP protocol\nthe attackers can send exfiltrated data by email\n Named pipe\nthe attackers can use Microsoft’s named pipe to communicate to another infected machine.\nThis case will be described in the next chapter\n\n**_Figure 7: HTTP media type list_**\n\nThe design chosen by the developers is truly efficient: to add a new protocol and a new capability,\nthe attackers do not need to recompile (or reinstall) the entire rootkit. They simply need to adjust\nthe library and replace the library in the queue file with the adjusted one. The library usage results in\nmodularity well thought out.\n\n##### Network capabilities\n\nThanks to the protocol described previously, the attacker can even target victims not directly\nconnected to the Internet. The following figure shows an example of a network scheme we\ndiscovered in 2013:\n\n**_Figure 8: Uroburos‘ communication capabilities_**\n\nThe targeted machine (A) is a machine with access to sensitive data, e.g. a server. The rootkit\ninstalled on the system opens a Microsoft named pipe and waits for an incoming connection. This\nmachine can be named “spied-on node”.\n\n\n**_Figure 7: HTTP media type list_**\n\n\n-----\n\nThe second machine (B) is an office machine with the capability to connect to the Internet. The\nrootkit is configured to connect to system (A), with the help of the named pipe, and administrate the\nmachine remotely. Finally, machine (B) is able to pass on all data received from machine (A) to the\nInternet. This machine (B) could be named “proxy node”.\n\nThis peer-to-peer design is really efficient, scalable and resilient. In case a “proxy node” is not\navailable/detected, the attackers can use another infected one. The advantage for the attackers:\neven if a security specialist finds one “spied-on node”, he cannot easily find the “proxy node”, due to\nthe fact that this node is a passive node. Furthermore, the analyst does not automatically have the\ncommand and control URL. In case of incident response, this design is complicated to apprehend\nand it is hard to contain the infection.\n\n##### Victims and attribution\n\nDue to the complexity of the Uroburos rootkit, we estimate that it was designed to target\ngovernment institutions, research institutions or companies dealing with sensitive information as\nwell as similar high-profile targets.\nConcerning the attribution, we found some technical information which allows us to link the\nUroburos rootkit to a cyber-attack against the United States of America, carried out in 2008[4] and,\nparticularly, to the worm used by the attackers, called Agent.BTZ. During this 2008 campaign, a USB\nstick was deliberately \"lost\" in the parking lot of the United States Department of Defense. This USB\nstick contained malicious code and infected the military’s network.\n\nThe following leads make us link what we discovered during our analysis with the cyber-attack\ncarried out in 2008:\n\n the usage of the same obfuscation key in Uroburos and Agent.BTZ\n(1dM3uu4j7Fw4sjnbcwlDqet4m5Imnxl1pzxI6as80cbLnmz54cs5Ldn4ri3do5L6gs923HL34x2f\n5cvd0fk6c1a0s)\n the usage of the same file name to store logs: winview.ocx\n Uroburos actually checks whether Agent.BTZ is already present on the attacked system,\nbefore its installation. In case Agent.BTZ is installed, Uroburos will not be installed on the\nsystem.\n the usage of Russian language in both codes\n\nIn an article published by Reuters, in 2011, the journalist mentioned that “U.S. government strongly\nsuspects that the original attack was crafted by Russian Intelligence.”[5] We found Uroburos samples\nwith a resource in Russian language:\n\n**_Figure 9: Resource with Russian language_**\n\nIn case someone from the audience of this report notices an infection caused by the Uroburos\nrootkit and needs help, would like to receive further technical information or would like to\ncontribute any information about this case, please feel free to contact us by email using the\n[following mailbox: intelligence@gdata.de](mailto:intelligence@gdata.de)\n\n4 http://en.wikipedia.org/wiki/2008_cyberattack_on_United_States\n5 http://www.reuters.com/article/2011/06/17/us-usa-cybersecurity-worm-idUSTRE75F5TB20110617\n\n\n-----\n\n#### Conclusion\n\nThe Uroburos rootkit is one of the most advanced rootkits we have ever analyzed. The oldest driver\nwe identified was compiled in 2011, which means that the campaign remained undiscovered for at\nleast three years.\n\nThe investment to develop a complete framework such as Uroburos is extremely high. The\ndeveloper team behind the development and the design of such an enhanced framework is really\nskilled. We believe that, until today, the team behind Uroburos has developed an even more\nsophisticated framework, which still remains undiscovered.\n\nThe design is highly professional; the fact the attackers use a driver and a virtual file system in two\nseparate files which can only work in combination, makes the analysis really complicated. One needs\nto have the two components to correctly analyze the framework. The driver contains all of the\nnecessary functionality and the file system alone simply cannot be decrypted.\n\nThe network design is extraordinarily efficient, too; for an incident response team, it is always\ncomplicated to deal with peer-to-peer infrastructure. It is also hard to handle passive nodes, because\none cannot quickly identify the link between the different infected machines.\n\nThis kind of data stealing software is too expensive to be used as common spyware. We assume that\nthe attackers reserve the Uroburos framework for dedicated and critical targets. This is the main\nreason why the rootkit was only detected many years after the suspected first infection.\nFurthermore, we assume that the framework is designed to perform cyber espionage within\ngovernments and high profile enterprises but, due to its modularity, it can be easily extended to\ngain new features and perform further attacks as long as it remains undetected within its target.\n\nThere are some strong indications which suggest that the group behind Uroburos is the same as the\none behind Agent.BTZ, which allegedly was part of an intelligence agency cyberattack targeting US\nmilitary bases in 2008. Notable hints include the usage of the exact same encryption key then and\nnow, as well as the presence of Russian language in both cases.\n\n#### Technical details\n\nSHA256: BF1CFC65B78F5222D35DC3BD2F0A87C9798BCE5A48348649DD271CE395656341\n\nMD5: 320F4E6EE421C1616BD058E73CFEA282\n\nFilesize: 210944\n\nFor further information contact [intelligence@gdata.de](mailto:intelligence@gdata.de)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        },
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        },
        {
            "id": "6fc23d14-23a6-4870-8fad-b291b182596f",
            "created_at": "2022-10-25T16:07:18.480113Z",
            "updated_at": "2022-10-25T16:07:18.480113Z",
            "deleted_at": null,
            "name": "ETDA",
            "url": "https://apt.etda.or.th",
            "description": "Threat Group Cards: A Threat Actor Encyclopedia",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/dokswmrkrxmipfmdpsvelnq18w4ypogw",
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2014/2014.02.28.Uroburos/GData_Uroburos_RedPaper_EN_v1.pdf",
        "https://public.gdatasoftware.com/Web/Content/INT/Blog/2014/02_2014/documents/GData_Uroburos_RedPaper_EN_v1.pdf"
    ],
    "report_names": [
        "GData_Uroburos_RedPaper_EN_v1",
        "GData_Uroburos_RedPaper_EN_v1.pdf"
    ],
    "threat_actors": [
        {
            "id": "a97fee0d-af4b-4661-ae17-858925438fc4",
            "created_at": "2023-01-06T13:46:38.396415Z",
            "updated_at": "2025-03-27T02:00:02.823045Z",
            "deleted_at": null,
            "main_name": "Turla",
            "aliases": [
                "Uroburos",
                "Hippo Team",
                "Pacifier APT",
                "MAKERSMARK",
                "ATK13",
                "UAC-0003",
                "IRON HUNTER",
                "Waterbug",
                "TAG_0530",
                "KRYPTON",
                "Popeye",
                "SIG23",
                "UAC-0144",
                "G0010",
                "Blue Python",
                "VENOMOUS Bear",
                "Group 88",
                "Pfinet",
                "ITG12",
                "UNC4210",
                "Secret Blizzard",
                "UAC-0024"
            ],
            "source_name": "MISPGALAXY:Turla",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1666716496,
    "ts_updated_at": 1743041688,
    "ts_creation_date": 1393607028,
    "ts_modification_date": 1393607138,
    "files": {
        "pdf": "https://archive.orkl.eu/917691a4f8af50a09926f97bf1be2e0cb71f8c68.pdf",
        "text": "https://archive.orkl.eu/917691a4f8af50a09926f97bf1be2e0cb71f8c68.txt",
        "img": "https://archive.orkl.eu/917691a4f8af50a09926f97bf1be2e0cb71f8c68.jpg"
    }
}