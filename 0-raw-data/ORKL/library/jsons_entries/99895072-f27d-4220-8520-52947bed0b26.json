{
    "id": "99895072-f27d-4220-8520-52947bed0b26",
    "created_at": "2023-01-12T15:06:52.174773Z",
    "updated_at": "2025-03-27T02:10:20.851171Z",
    "deleted_at": null,
    "sha1_hash": "21442b2a3c63edef19668b19d6f2285d2bb6fdc6",
    "title": "2022-10-12 - WIP19 Espionage - New Chinese APT Targets IT Service Providers and Telcos With Signed Malware",
    "authors": "",
    "file_creation_date": "2022-11-28T18:53:05Z",
    "file_modification_date": "2022-11-28T18:53:05Z",
    "file_size": 1685520,
    "plain_text": "# WIP19 Espionage | New Chinese APT Targets IT Service Providers and Telcos With Signed Malware\n\n**[sentinelone.com/labs/wip19-espionage-new-chinese-apt-targets-it-service-providers-and-telcos-with-signed-malware/](https://www.sentinelone.com/labs/wip19-espionage-new-chinese-apt-targets-it-service-providers-and-telcos-with-signed-malware/)**\n\nJoey Chen\n\n**By Joey Chen and Amitai Ben Shushan Ehrlich, with additional insights from QGroup**\n\n## Executive Summary\n\nA new threat cluster we track as WIP19 has been targeting telecommunications and IT\nservice providers in the Middle East and Asia.\nWe assess it is highly likely this activity is espionage-related and that WIP19 is a\nChinese-speaking threat group.\nThe threat cluster has some overlap with Operation Shadow Force but utilizes new\nmalware and techniques.\nWIP19 utilizes a legitimate, stolen certificate to sign novel malware, including\nSQLMaggie, ScreenCap and a credential dumper.\n\n## Overview\n\nSentinelLabs has been monitoring a threat cluster we track as WIP19, a group characterized\nby the usage of a legitimate, stolen digital certificate issued by a company called\n“DEEPSoft”. Based on our investigations, WIP19 has been targeting telecommunications\nand IT service providers in the Middle East and Asia.\n\n\n-----\n\nThroughout this activity, the threat actor abused the certificate to sign several malicious\ncomponents. Almost all operations performed by the threat actor were completed in a\n“hands-on keyboard” fashion, during an interactive session with compromised machines.\nThis meant the attacker gave up on a stable C2 channel in exchange for stealth.\n\nOur analysis of the backdoors utilized, in conjunction with pivoting on the certificate, suggest\nportions of the components used by WIP19 were authored by WinEggDrop, a well-known\nChinese-speaking malware author who has created tools for a variety of groups and has\nbeen active since 2014.\n\nThe use of WinEggDrop-authored malware, stolen certificates and correlating TTPs indicate\n[possible links to Operation Shadow Force, as reported by TrendMicro and](http://documents.trendmicro.com/assets/pdf/shadow-force-technical-brief.pdf) [AhnLab. As the](https://download.ahnlab.com/global/brochure/%5BAnalysis_Report%5DOperation_Shadow_Force(1).pdf)\ntoolset itself appears to be shared among several actors, it is unclear whether this is a new\niteration of operation “Shadow Force” or simply a different actor utilizing similar TTPs. The\nactivity we observed, however, represents a more mature actor, utilizing new malware and\ntechniques.\n\n[We linked an implant dubbed “SQLMaggie”, recently described by DCSO CyTec, to this set](https://medium.com/@DCSO_CyTec/mssql-meet-maggie-898773df3b01)\nof activity. SQLMaggie appears to be actively maintained and provides insights into the\ndevelopment timeline with hardcoded version names. In addition, we identified a number of\nother pieces of malware utilized by this threat actor.\n\nThis report focuses on detailing the set of activity we track as WIP19 and provides further\ncontext around the usage of these new tools.\n\n\n-----\n\nRelationship between the malware, certificates, and creators\n\n## Abusing Valid Digital Certificates\n\nWIP19 has been observed signing malware with a valid digital certificate issued for\nDEEPSoft Co., Ltd., a Korean company specializing in messaging solutions. The threat actor\nused the certificate to sign several malware components, some of which were tailor-made for\nspecific targets. We assess that it is highly likely the certificate was stolen, as it was also\nused to sign legitimate software used by DEEPSoft in the past.\n\n\n-----\n\nDEEPSoft digital\n\ncertificate\nActivity involving toolsets authored by WingEggDrop and signed with both legitimate and\n[fake certificates has been previously reported on by AhnLab. It’s commonly understood that](https://download.ahnlab.com/global/brochure/%5BAnalysis_Report%5DOperation_Shadow_Force(1).pdf)\nmalware created by WinEggDrop is shared among several threat clusters, making it possible\nthat these associated toolsets could also be in use by the WIP19 threat actor.\n\n## Dumper Analysis\n\nLike many components utilized by WIP19, all their credential harvesting tools – consisting\nmainly of password dumpers – were signed using the DEEPSoft certificate. The main\ndumper used by the threat actor utilized open source projects to load an SSP to LSASS and\nthen dump the process.\n\nWIP19’s password dumper consists of two components, one used as a loader, and the other\nas a dumper. On many of the instances observed, the dumper was executed using\nWMIEXEC.\n\n### Loader Analysis\n\n\n-----\n\nThe dumper loader component is a signed EXE file, internally dubbed `ssp_rpc_loader, as`\nindicated from the PDB path embedded within the file. As the name suggests, the loader\nuses RPC to load a malicious DLL file as an SSP (Security Support Provider), given as an\n[argument. The loader appears to be taken from an open source project available on GitHub.](https://github.com/jas502n/mimikat_ssp)\n```\nD:\\source\\dump_lsass-main\\ssp_rpc_loader\\x64\\Release\\ssp_rpc_loader.pdb\n\n\n### SSP Analysis\n\n```\n[The actual SSP loaded is NanoDump, which is loaded into LSASS and creates a minidump](https://github.com/helpsystems/nanodump)\nof the process. Loading NanoDump as an SSP is a built-in function embedded within\n[NanoDump. This is done utilizing the MiniDumpWriteDump API. The dump will be created in](https://docs.microsoft.com/en-us/windows/win32/api/minidumpapiset/nf-minidumpapiset-minidumpwritedump)\nthe following path:\n```\nC:\\\\windows\\\\temp\\\\1.bin\n\n\n```\nMuch like the loader, the threat actor did not bother to remove the PDB path for the DLL\ndumper.\n```\nD:\\source\\dump_lsass-main\\dll1\\x64\\release\\dll1.pdb\n\n\n```\nCombining both components, a full execution of the dumper will look like this:\n```\nC:\\attacker\\loader.exe c:\\attacker\\ssp.dll\n\n\n## Keylogger & Screen Recording (ScreenCap)\n\n### Loading Mechanism\n\n```\n[WIP19 has been observed utilizing a less-common (although documented) DLL search order](https://www.elastic.co/cn/blog/ten-process-injection-techniques-technical-survey-common-and-trending-process)\nhijacking of `explorer.exe to load a keylogging and screen recording component internally`\nnamed `ScreenCapDll_x64 .`\n\nThe keylogging and screen recording components\n\n\n-----\n\nThe threat actor dropped the malicious, signed DLL, in the path\n```\nc:\\windows\\linkinfo.dll . Dropping the file in this specific path triggers the loading of\n\n```\nthe DLL into `explorer.exe the next time it is executed. The threat actor may manually kill`\nand restart the `explorer.exe process to initiate the screen recording and keylogging`\nfunctionality.\n\nThe ScreenCap malware performs checks involving the victim’s machine name, indicating it\nis specially crafted for each deployment. This does not prevent the actor from re-signing\neach of the payloads with the DEEPSoft certificate, proving the actors have direct access to\nthe stolen certificate.\n\nAfter verifying it is executed on the correct machine, the ScreenCap malware drops a RAR\nCLI binary in one of the following paths, according to the target’s operating system:\n```\nC:\\Documents and Settings\\All Users\\Application Data\\dwmgr.exe\n\nC:\\Users\\Public\\AppData\\MsTemp\\dwmgr.exe\n\n\n```\nRAR executable drop file path\n\n### Keylogging\n\nThe keylogging functionality mainly focuses on the user’s browser. The malware detects the\nuser’s browser and logs all keystrokes to `.ax files stored in its current working directory. By`\ndefault, it will keylog Internet Explorer activity, but it also supports keylogging of other popular\nbrowsers including Chrome and Opera.\n\n\n-----\n\nKeylogger drop file path and the browser it targets\n\n### Screen Recording\n\nA relatively unique TTP observed in this activity is the recording of the user’s screen. Much\nlike keylogging, this helps the actor harvest credentials and access sensitive information.\nThe malware will record the screen for 1,296,000 milliseconds at a time, 30 times, and store\nthe output as `.avi files in its current working directory.`\n\nUsing Windows Multimedia (vfw.h) to record the user’s screen\nDuring our analysis of the ScreenCap malware, we identified a number of samples that\ncontained hardcoded victim IDs. This indicates that some of the intrusions are well\nresearched and highly targeted.\n\n\n-----\n\nHardcoded victim host identity number “DESKTOP-xxxxxxx\n\n## ExtendedProcedure SQL (SQLMaggie)\n\nWhilst we did not observe the initial infection vector in this intrusion, the SQLmaggie malware\ndropped on victim networks targets Windows systems and has to be executed in an MSSQL\nserver. This provided us a foundation from which to investigate further.\n\nWe found that SQLMaggie masquerades as a legitimate DLL containing extended stored\nprocedure functions for an MSSQL Server. The [executed methodology uses the](https://docs.microsoft.com/en-us/sql/relational-databases/extended-stored-procedures-programming/adding-an-extended-stored-procedure-to-sql-server?view=sql-server-ver16)\n```\nsp_addextendedproc function to register an external DLL in a MSSQL server. After\n\n```\nregistering the DLL into the MSSQL server, the threat actor is able to fully control the server\nmachine and use this backdoor to conduct reconnaissance in the internal network. For\ninstance:\n```\nsp_addextendedproc 'malicious', 'c:\\Program Files\\Microsoft SQL\nServer\\MSSQL13.0.MSSQLSERVER\\MSSQL\\Binn\\malicious.dll';\n\n\n```\nReproduced SQLMaggie backdoor command\nOur analysis showed that this backdoor was authored by WinEggDrop.\n\nFrom the timestamp of the sample, we can confirm the first version of this backdoor variant\nwas developed in or before 2019. Available commands in each version vary according to the\ntarget environment. Unlike some of the other components which can be found on public,\nopen-source repositories, neither the source code nor the executable for SQLMaggie appear\nto be publicly available. This suggests that the tool is either sold or used privately, or is in\nexclusive use by WinEggDrop.\n\n\n-----\n\nThe author’s\n\npurported signature in SQLMaggie\nBelow we detail SQLMaggie backdoor commands and capabilities. The following commands\nappear in all versions of SQLMaggie.\n\n**Command** **Description**\n\nSysInfo Show system information and detected is it in the VM or not\n\nFileAccess Modify file permissions\n\nls List DIR\n\nExec Create process\n\nRShell Reverse Shell\n\nType Open file and print the strings inside\n\nDownload Download files\n\nAdditionally, the following commands appear variously in different versions of SQLMaggie\ncoded for specific targets.\n\n**Command** **Description**\n\nStopSocks5 Stop Socks5 tunnel stopped\n\nStartHook Start WinSock socket hook\n\nStopHook Stop Winsock socket Hook\n\nResetClientData Attacker input information\n\nViewClientData Show client data, attacker input information\n\nTS Checking regkey about TermService and its port\n\nListIP Get host name, IP\n\n\n-----\n\nCheckPath Get data path\n\nStartSocks5 Create Socks5 tunnel\n\nSetClient Set client data, include hook winsock and allow ip, port\n\nInstallTS Install TermService\n\nDelFile Delete file\n\nSetFile Set file attributes\n\nGetUser Using ROOT\\\\CIMV2 to get host account\n\nGetModule Print out the execute module file path\n\nScanStatus Scan the victim’s environment machines\n\nStopScan Terminate all scan threads\n\nGetAdmin Get domain admin account\n\nSqlCheck Check SQL server is running and list username & password\n\nSqlScan Create a thread to scan for SQL server\n\nExploit Run Use exploit to execute process\n\nExploit AddUser Use exploit to add user\n\nExploit Clone Use exploit to clone user\n\nExploit TS Use exploit to install TermService on a machine\n\nStartHook Hook WinSock socket and show client data, attacker input\ninformation\n\nPort Check if port is open\n\nWriteAll MSSQLServer Write permission\n\nAccessAll MSSQLServer Access permission\n\n## Attribution Analysis\n\nWe assess it is highly likely this activity is espionage-related and that WIP19 is a Chinesespeaking threat group. The Work-In-Progress (WIPxx) designation is used for unattributed\nclusters of activity. A WIP may represent activity that fits under the umbrella of an existing –\nbut thus far unknown – actor or ultimately represent the activity of a new threat actor.\n\n\n-----\n\nThe intrusions we have observed involved precision targeting and were low in volume.\nSpecific user machines were hardcoded as identifiers in the malware deployed, and the\nmalware was not widely proliferated. Further, the targeting of telecommunications and IT\nservice providers in the Middle East and Asia suggest the motive behind this activity is\nespionage-related. Communications providers are frequent targets of espionage activity due\nto the kinds and amount of sensitive data they hold.\n\nThe overlap with Operation Shadow Force through a possible common developer in\nWinEggDrop, and the fact their tooling has been observed in other Chinese espionagerelated activity, supports the assessment that this activity is likely being carried out by a thus\nfar unidentified Chinese-speaking threat group. The hardcoding of machine identifiers and\nthe usage of malware to log keystrokes and screenshot specific user machines, suggests\nthat WIP19 is after very specific information.\n\n## Conclusion\n\nWIP19 is an example of the greater breadth of Chinese espionage activity experienced in\ncritical infrastructure industries. The existence of reliable quartermasters and common\ndevelopers enables a landscape of hard-to-identify threat groups that are using similar\ntooling, making threat clusters difficult to distinguish from the defenders point of view. We\nhope this report helps move the needle forward in the effort to continue identifying threat\ngroups engaged in spying on industries critical to society.\n\nSentinelLabs continues to track this activity to provide further insight into their evolution and\nfuture activity.\n\n## Indicators of Compromise\n\n**SQLMaggie SHA1** **Real File Name**\n\n4AABB34B447758A2C676D8AD49338C9E0F74A330 sqlmaggieAntivirus_32.dll\n\n5796068CFD79FBA65394114BA0EDC8CC93EAE151 sqlmaggieVS2008new_64.dll\n\n13BA1CFD66197B69A0519686C23BDEF17955C52E sqlmaggieVS2008new_32.dll\n\nCA25FCBA11B3B42D9E637132B5753C9B708BE6F0 sqlmaggieVS2008new_64.dll\n\n26cbd3588b10cabc7c63492c82808104829e9ac0 sqlmaggieAntiVirus_64.dll\n\n5e0291928e29db46386fd0bd85f269e967758897 sqlmaggieVS2008new_64.dll\n\n96099015981559237a52a7d50a07143870728fd0 sqlmaggieAntiVirus_64.dll\n\n7eb6e7d4e5bd5a34c602879cad0a26b35a3ca4fb sqlmaggieVS2008new_32.dll\n\n\n-----\n\nfe2e7c663913e0744822d1469be0c3655d24178d sqlmaggieAntivirus_32.dll\n\nb15bae6a8379a951582fc7767fa8490722af6762 sqlmaggieAntiVirus_64.dll\n\nc81de9a27f7e8890d30bd9f7ec0f705029b74170 sql_epX64_MD.dll\n\n829df7b229220c56eedc5660e8f0e7f366fa271f sqlmaggieAntivirus_32.dll\n\nd02fce5d87ea1fe9fabe7ac52cae2439e8215121 sqlmaggieAntivirus_32.dll\n\n1c6d0e8920af9139a8a9fe3d60b15cf01fb85461 sqlmaggieAntiVirus_64.dll\n\n2cad0328863cb09a6b27414d5158075d69bfb387 sqlmaggieAntiVirus_64.dll\n\n26c0722a1d16641d85b97594deea2a65399daef7 sqlbackupAntiVirus_64.dll\n\n17ff9fc9ee72baaf8d66ef9b3ab6411c47384968 sqlmaggieAntiVirus_64.dll\n\n5be50453f6e941c5c1dd20e0ba53e9abb6d00b68 sqlmaggieVS2008new_32.dll\n\n56d326dfe7dcb1ce7cae2cb4c13819510fc9945c sqlmaggieAntiVirus_64.dll\n\n253e702ff8201eec6fdf9630a39f5a8c28b132ed xp_OAreateX64.dll\n\nb91ab391a4e26e4ff0717cd989ad5ce7f6af235c xp_OAreateX64.dll\n\n4d2eb6e03be068f364e8e3f3c9645e03e1052e66 xp_OAreate.dll\n\nb91ab391a4e26e4ff0717cd989ad5ce7f6af235c xp_OAreateX64.dll\n\n4d2eb6e03be068f364e8e3f3c9645e03e1052e66 xp_OAreate.dll\n\n8941d889cb199a234d99c90ce78a96411b6dedb6 sqlmaggieAntivirus_32.dll\n\n5aa9a9299865b0cb81fcad5f42424d79c67c403b sqlmaggieVS2008new_64.dll\n\n5182e0a5f075317171ad0e01e52d32937ec2fa01 sqlmaggieVS2008new_64.dll\n\nbfccf57e173b8233d35928956022bae85fc5d722 sqlmaggieAntiVirus_64.dll\n\n18d3ac848955295381f769b923a86871e01bfa1c sqlmaggieVS2008new_64.dll\n\n2bf1b6163af5685824c2d7ecda4f3f65f3ca4723 sqlmaggieAntiVirus_64.dll\n\n9577a2c15494edc2f7f4a59ecfb3ee90dd1df9d7 sqlmaggieAntiVirus_64.dll\n\n32e96ef4754c8f357e2366078387750e7f6add43 sqlmaggieAntiVirus_64.dll\n\n11678237dfccc88f257acca2b66b578713deaca8 sqlmaggieVS2008new_64.dll\n\n327bedce44160ebccc7d465c673d3464e23292b9 sqlmaggieVS2008new_32.dll\n\n\n-----\n\n7d58e51aee7da91dc93025854712cee47ed03101 sqldoorVS2005_64.dll\n\n4a6cf3d5b005e97ef6f2be09f8ab19c2755cae39 sqlmaggieAntiVirus_64.dll\n\nf37d9ce547894ab5449e5632188a3a3bb9e91fed sqlbackupAntiVirus_64.dll\n\na347aaf152d8ddcd299d86d7839d4ffa369ef2ef sqlmaggieVS2008new_32.dll\n\nf2c64108cb670e82908e5f41c58f1aab97ee7786 sqlmaggieVS2008new_64.dll\n\na34bda87bd253eda794462c20074baed19e1c01c sqlmaggieAntiVirus_64.dll\n\ndf1a7c13a3ec612a10819353ba0d34348a404bc8 sqlmaggieAntiVirus_64.dll\n\nb3249b6f05eeeb2cf5f74931aa990fbc92027b54 sqlmaggieAntiVirus_64.dll\n\nd3eeb9db89f0b21dc945f5410be9a9532e0c951e sqlmaggieAntiVirus_64.dll\n\n**ScreenCap SHA1** **Real File Name**\n\nc6cb7ec82ee55ccb56a4cc8b91c64e9b4f4e14da ScreenCapDll_x64.dll\n\n19f2a546a76458dda6eab6e2fae07d0942759b84 ScreenCapDll_x64.dll\n\n693e4ed784279bc47a013dc56f87cbd103e1db2e x\n\nad72aa442ff2c357b48ae8b4f8ba9b04b63c698b ScreenCapDll.dll\n\n**Hacking Tool SHA1** **Description**\n\nda876cd6e3528f95aafb158713d3b21db5fc780b Browser credential stealer\n\n1121324a15e6714e4313dfa18c8b03a6da381ba1 Credential dumper loader\n\n9bedb5810536879fae95c70a918eb90ac628953e Network scanning tool\n\n539d87139de6d5136b6d45dbc33a1aae69926eee Credential dumper\n\nafe25455804a7afb7639cb4e356cb089105be82d Port relay tool\n\n37cca724227a8e77671ecde3d295f5b98531705b Credential dumper loader\n\n2eeb46d538c486f8591a78a65dde250b0bf62f89 Windows domain tool\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-10-12 - WIP19 Espionage - New Chinese APT Targets IT Service Providers and Telcos With Signed Malware.pdf"
    ],
    "report_names": [
        "2022-10-12 - WIP19 Espionage - New Chinese APT Targets IT Service Providers and Telcos With Signed Malware.pdf"
    ],
    "threat_actors": [
        {
            "id": "1d4e09da-fc00-4b5b-ac1a-f08813e611d4",
            "created_at": "2023-01-06T13:46:39.125711Z",
            "updated_at": "2025-03-27T02:00:03.002463Z",
            "deleted_at": null,
            "main_name": "Operation Shadow Force",
            "aliases": [],
            "source_name": "MISPGALAXY:Operation Shadow Force",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "0cf4cd05-46f5-41cc-82b2-2bb74edd0e8e",
            "created_at": "2023-12-08T02:00:05.743414Z",
            "updated_at": "2025-03-27T02:00:03.264336Z",
            "deleted_at": null,
            "main_name": "WIP19",
            "aliases": [],
            "source_name": "MISPGALAXY:WIP19",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536012,
    "ts_updated_at": 1743041420,
    "ts_creation_date": 1669661585,
    "ts_modification_date": 1669661585,
    "files": {
        "pdf": "https://archive.orkl.eu/21442b2a3c63edef19668b19d6f2285d2bb6fdc6.pdf",
        "text": "https://archive.orkl.eu/21442b2a3c63edef19668b19d6f2285d2bb6fdc6.txt",
        "img": "https://archive.orkl.eu/21442b2a3c63edef19668b19d6f2285d2bb6fdc6.jpg"
    }
}