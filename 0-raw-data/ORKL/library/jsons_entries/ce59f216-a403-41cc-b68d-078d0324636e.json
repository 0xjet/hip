{
    "id": "ce59f216-a403-41cc-b68d-078d0324636e",
    "created_at": "2023-01-12T15:08:33.648028Z",
    "updated_at": "2025-03-27T02:16:25.757964Z",
    "deleted_at": null,
    "sha1_hash": "6526ac1f27405444074cf084b01d65b81131c05a",
    "title": "2019-08-08 - Varenyky- Spambot à la Française",
    "authors": "",
    "file_creation_date": "2022-05-28T18:07:18Z",
    "file_modification_date": "2022-05-28T18:07:18Z",
    "file_size": 2742300,
    "plain_text": "# Varenyky: Spambot à la Française\n\n**[welivesecurity.com/2019/08/08/varenyky-spambot-campaigns-france/](https://www.welivesecurity.com/2019/08/08/varenyky-spambot-campaigns-france/)**\n\nAugust 8, 2019\n\nESET researchers document malware-distributing spam campaigns targeting people in\nFrance\n\n[ESET Research](https://www.welivesecurity.com/author/esetresearch/)\n8 Aug 2019 - 11:30AM\n\nESET researchers document malware-distributing spam campaigns targeting people in\nFrance\n\n## Introduction\n\n\n-----\n\nIn May 2019, ESET researchers observed a spike in ESET telemetry data regarding\nmalware targeting France. After further investigations, we identified malware that distributes\nvarious types of spam. One of them is leading to a survey that redirects to a dodgy\nsmartphone promotion while the other is a sextortion campaign. The spam targets the users\nof Orange S.A., a French ISP. We notified them before the release of this publication.\n\nWe believe the spambot is under heavy development and it has changed a lot since the first\ntime we saw it. A mention about this threat was posted on Twitter by [AnyRun; however, to](https://twitter.com/anyrun_app/status/1135822497839013888)\nthe best of our knowledge no one has published a detailed analysis of it. We named this\nnew malware Varenyky, and on July 22nd, ESET researchers saw it launch its first sextortion\nscam campaign.\n\nThis spambot is interesting because it can steal passwords, spy on its victims’ screen using\n[FFmpeg when they watch pornographic content online, and communication to the C&C](https://en.wikipedia.org/wiki/FFmpeg)\nserver is done through Tor, while spam is sent as regular internet traffic. This article\ndescribes the functionality of the malware.\n\n# Distribution and targets\n\n## Distribution\n\nVarenyky was seen for the first time early in May 2019. At this time, we unfortunately cannot\ntell how it was distributed, but the more recent email phishing distribution and context\nsuggest that the operator has been using this technique since the beginning.\n\nOne month later, in June 2019, we saw the first malicious document that initiates the\ninfection of the victim’s computer, attached to an email message (Figure 1).\n\n\n-----\n\n_Figure 1. Screenshot of email distributing Varenyky downloader_\n\nThat email states that a bill of €491.27 is available and attached. The Microsoft Word\ndocument filename contains the word “facture” which is a French word for “bill”. Also, when\nthe victim opens the document, it states that the document is protected by Microsoft Word\nand “requires human verification”.\n\n\n-----\n\n_Figure 2. Malicious document_\n\nThe content of the document (Figure 2) explains how to enable the “human verification”,\nwhich, in fact, is how to enable macros. For security purposes, Word macros are not\nenabled by default and need user interaction to execute.\n\nOverall, the email text content, the document’s filename and the “protected” content of the\ndocument emphasize to the recipients that they are dealing with a real bill and that they\nshould open it. The quality of the French is very good; overall, the document is convincing.\n\n## Targets\n\n\n-----\n\nVarenyky targets the French. The macro (Figure 3) contained in the Word document has two\npurposes: the first is to filter out non-French victims based on their computers’ locale and the\nsecond is to download and execute the malware.\n\n_Figure 3. Word macro_\n\nThe macro uses the function Application.LanguageSettings.LanguageID() to get the\nlanguage ID of the victim’s computer. This ID contains the country and the language set by\nthe user. The script checks if the value returned is 1036 in decimal (or 0x40C in\n[hexadecimal) and according to the Microsoft documentation this value corresponds to](https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-lcid/70feba9f-294e-491e-b6eb-56532684c37f)\nFrance and the French language (Figure 4).\n\n_Figure 4. Language ID table_\n\nThis is a good trick to fool automatic sample analyzers and to avoid drawing attention\nbecause of the limited number of computer configurations on which this malware will be\ninstalled.\n\nIt’s worth noting that by using this specific locale identifier, it excludes French-speaking\ncountries other than France such as Belgium and Canada, which have their own identifiers.\n\nThere is also an additional language check in the downloaded executable regarding the\nkeyboard layout. This check is done at the very beginning of the executable that is\ndownloaded and run by the macro (Figure 5).\n\n\n-----\n\n_Figure 5. Hex-Rays output of keyboard layout check_\n\nOnce again, a verification is done to filter out people with a keyboard layout in English or\nRussian. If it matches, it displays the following message box (Figure 6) and exits.\n\nFigure 6. Message box for English and Russian keyboard layouts\n\nLet’s describe the malware’s functionality once it’s running on a system it targets.\n\n## Technical analysis & functionality\n\nOlder variants of Varenyky used the UPX packer, but recent samples use a custom packer.\nThe custom unpacker will first XOR its payload with a 32 character-long alphanumeric string\n[and then decompress it using the LZNT1 algorithm, which is a variant of LZ77. The](https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-xca/5655f4a3-6ba4-489b-959f-e1f407c52f15)\nunpacked malware is never written to disk.\n\nIf the malware has not yet been installed, it will create a directory in %APPDATA% with a\nspecific name. It’s an upper-case hash made of the machine’s GUID, user name, computer\nname and CPU name: see Figure 7. It creates a mutex named with this same hash to avoid\ntwo instances running at the same time.\n\n\n-----\n\n_Figure 7. Functions that gather information used to compute the hash_\n\nThe malicious payload will then extract multiple libraries and the Tor executable, which are\nembedded inside of itself, to the directory it just created. These libraries include zlib and\ndependencies for programs compiled with MinGW. The malware’s executable is finally\ncopied to this directory and the original is deleted from the temporary directory where it was\ndownloaded via the macro.\n\nIt also makes itself persistent by adding an entry to\nHKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run in the Windows Registry. The\nmutex is released and the malware restarts itself from its directory in %AppData%.\n\nOn the second run, the malware notices that it is already installed. It will execute Tor and\nfetch its external IP address using AWS’ checkip.amazonaws.com service.\n\nIt will start two threads: one that’s in charge of sending spam and another one that can\nexecute commands coming from its C&C server. This is where versions of the malware\ndiffer. Some variants have more threads that are sending spam at the same time and some\nhave different functionalities when it comes to the commands that the C&C server can have\nit execute. All communication to the C&C is done through Tor at\njg4rli4xoagvvmw47fr2bnnfu7t2epj6owrgyoee7daoh4gxvbt3bhyd.onion using the HTTP\nprotocol.\n\nEarly versions of the malware could receive a command to download a file and execute it.\nThe malware was able to handle executable files, batch files and PowerShell scripts.\nSupport for the last was later removed. The malware could also be instructed to update itself\nwith an executable that had to be downloaded from a specific URL. There is another\ncommand that will uninstall the malware from the computer, although it doesn’t remove the\nchange that it made to the registry.\n\n\n-----\n\n[A new command was later added, allowing the malware to deploy NirSoft s](https://www.nirsoft.net/)\nWebBrowserPassView and Mail PassView tools. These are password recovery tools for web\nbrowser and email client passwords. They are routinely abused by malware and thus\ndetected by ESET as potentially unsafe applications. Both are LZNT1‑compressed\nexecutable files embedded inside the malware. They are extracted, injected into another\nexecutable and run once to steal the victim’s passwords, which are then exfiltrated to the\nC&C server.\n\nThe most recently added command will create a hidden desktop on the victim’s computer.\nThe malware can be directed to start various applications that have a graphical interface,\nsuch as web browsers and the Windows Run dialog on this invisible desktop. It has the\nability to accomplish various tasks, such as navigating menus, reading text, taking\nscreenshots, clicking on the screen, and also minimizing, restoring and maximizing\nwindows.\n\nThe C&C commands are summarized in Table 1.\n\n**Table 1. List of commands**\n**that can be sent by the C&C**\n**server**\n\n**Command name** **Description**\n\nDL_EXEC Downloads a file (.exe or .bat) that the malware will\nexecute\n\nUPDATE Downloads an executable to replace the malware’s\nexecutable\n\nUNINSTALL Removes the malware from the computer’s disk\n\nNIRSOFT Extracts NirSoft’s WebBrowserPassView and Mail\nPassView, runs them once and sends the results to the\nC&C server\n\nHIDDEN_DESK Creates a hidden desktop to accomplish various tasks\n\nA feature that made an appearance and was modified in subsequent versions finally to be\nremoved was a function that made the malware scan the title of the open windows on the\ncomputer. If the malware found a porn-related word in French or the word “bitcoin” in the title\nof a window, it sent the window’s title to its C&C server.\n\n_Figure 8. Words that the malware looked for_\n\n\n-----\n\nThis feature was later changed so that when encountering the word sexe, the malware\nwould record the computer’s screen using an FFmpeg executable that it previously would\nhave downloaded through the Tor network. The video was uploaded to the C&C server after\nit was recorded.\n\nThese videos could have been used for convincing sexual blackmail; a practice called\nsextortion. It’s unknown if these videos were recorded out of curiosity by the author(s) of the\nspambot or with an intention to monetize them through sextortion. Different versions of this\nmalware used different strings to identify itself to the C&C server. One of them was\n[“Bataysk”, which is a Russian city known to have a “monument that shows a man’s hand](https://en.wikipedia.org/wiki/Bataysk)\ngripping a nubile female breast”. Another sample identified with “PH”, which probably stands\nfor the initials of a popular pornography website. And another version identified with the\nstring “Gamiani_MON”; Gamiani is a French erotic novel and “MON” probably means\n“monitoring”.\n\n## C&C server home page\n\nOver time, many changes were made to what appears to be the C&C server’s login panel.\nAt first (Figure 9), it displayed the VADE RETRO SATANA verse in Latin and a red-eyed\nstatue of Marianne, a national personification of the French Republic. On the upper-right, the\nsign in German reads “Stop – State border – No entry”. The word “войти” on the button\nbelow the keypad means “login” in Russian and Ukrainian.\n\n\n-----\n\n_Figure 9. First version of the login panel_\n\nIt was later updated to play the song “F*ck them all” by Mylène Farmer when viewing the\nweb page (Figure 10).\n\n\n-----\n\n_Figure 10. C&C server login panel with song player added_\n\nIn the last update that added content, seen in Figure 11, the C&C login panel displays\ndancing parrots with a Serbian flag. It makes a reference to OCaml, a programming\nlanguage created by French people. Ricard is a reference to the 1963 movie The Pink\nPanther. On the lower-right, it says, in French “Alcohol abuse is dangerous for your health,\ndrink with moderation”, which is the official warning on alcohol advertisements in France.\nThe picture above the warning shows a Jelen pivo pale lager from a Serbian brewery. The\nsong that plays is now “Opa!” by the Russian band Diskoteka Avariya.\n\n\n-----\n\n_Figure 11. Screenshot of the login panel of the C&C server_\n\nAt the time of publication of this blogpost, the login panel has been uncluttered and only the\nkeypad remains.\n\n## “You’ve got mail”\n\nThis spambot will send emails using the SMTP protocol through port 25 and only targets the\ncustomers of the French ISP Orange. Each bot receives instructions from the C&C server in\norder to craft an email, including the body of the message, a list of email addresses to spam\nand the server to use to send the emails. The mail servers used to relay the spam don’t look\nlike they belong to the malicious actors; they look like servers that have not been properly\nsecured and they don’t require authentication.\n\n_Figure 12. Two different spam emails_\n\n\n-----\n\nSpam messages sent by this spambot are as simple as If this message doesn t show up\ncorrectly, click here” or “Please follow the link: <URL>” (Figure 12). There are also emails\nwith attachments. These links lead to a scam, which is a survey (Figure 13) where the victim\nalways “wins” a promotion for a recent smartphone.\n\n_Figure 13. Survey where the victim always wins a smartphone_\n\nThe link takes victims to a site where they apparently have a chance to “win” a prize such as\nan iPhone X, a Galaxy S9 or S10+ for €2 or less (Figure 14). To win, they need “only” enter\ntheir personal information; name, address, city, email and phone number. The email address\nthat is entered may not work if it’s not what the web page expects, but if successful, the\nvictims will be asked to enter their credit card information including its validation numbers.\n\nPeople should avoid providing their credit card information to websites they don’t know for\ndeals that are too good to be true. Such deals are often a scheme to get unwitting users’\ncredit card information in order to charge them monthly fees, which the user can sometimes\nlearn about by scrutinizing the fine prints. Legitimate contests don’t charge winners a fee so\nthey can claim their prize.\n\n_Figure 14. Scam pages with smartphones_\n\nAlthough Varenyky has the ability to record a video of the display while the computer’s user\nis probably viewing pornography, so far we have seen no evidence of the malware operator\nleveraging such video. However, coincidentally, on July 22nd we saw Varenyky start a\nsextortion scam campaign. It is important to note that this campaign is an example of the\n[common sextortion scam that has been widely documented and does not appear to be](https://www.welivesecurity.com/2019/03/21/sextortion-scams/)\n\n\n-----\n\nrelated to Varenyky s partial ability to carry out the functions of the fictitious malware\ndescribed in these scam emails. Figure 15 depicts the scam message we saw Varenyky\nsending. These emails consist of three JPG images that are used to bypass text-based\nspam filters.\n\n_Figure 15. Screenshot of the sextortion’s email_\n\n\n-----\n\nThis email claims that the author, who is a hacker, has gained access to the victim s\ncomputer through a virus that was caught while visiting an adult website (the translation of\n[this is much like that in the English version documented here). It says that the victim has](https://www.welivesecurity.com/2019/03/19/i-didnt-see-what-you-did-redux/)\nparticular tastes in pornography and that the hacker has gained remote control over the\nvictim’s computer. The email also says a video has been made where on one half of the\nscreen is a recording of the victim’s browser and the other half is a recording from the\nwebcam of “you having… fun”.\n\nFurthermore, the email says a copy has been made of the victim’s contact list, pictures,\npasswords, bank account data and more. It promises that the recipient of this email is not\nthe only victim and that the victim will be left alone once €750 are paid in bitcoin to the BTC\naddress 1PBpawAYJG7FfAxmTagU34CfEFoNobb1Re\n\nThe email says the victim has 72 hours to pay before the video is sent to family, colleagues,\nposted on Facebook, Twitter and elsewhere. It is said that changing passwords, deleting the\nvirus, sending the computer for repair or cleaning the computer will be useless because the\nvictim’s data is on a remote server (“Don’t think I’m a fool”). For proof, the victim can answer\n“Yes” to the email so the video is sent to six of their most valuable contacts.\n\nThe email ends with “This offer is non-negotiable, do not waste my time and yours, think\nabout the consequences of your actions”.\n\nAll the email addresses that were seen being targeted are on the domains wanadoo.fr and\norange.fr; both are operated by the French ISP Orange S.A. A single bot can send as many\nas 1500 emails an hour.\n\nAt the time of publication, the bitcoin address in the scam email had received four payments.\n[The bitcoin address has been already reported on bitcoinabuse.com for sextortion (Figure](https://www.bitcoinabuse.com/)\n16).\n\n\n-----\n\n_Figure 16. Screenshot of the bitcoin address reported on BitcoinAbuse_\n\n## Conclusion\n\nThis spambot is not very advanced, but the context and story around it make it interesting.\nWe can assume from the fact that it targets France could indicate that the operator has\nsome French understanding, reading or speaking the language, or maybe both. However,\nthe Word document showed us a lack of attention in the operator’s work. In the macro, the\noperator forgot to change the value of the test_debug variable, which means that the\nmalware will be downloaded whatever the language ID is (French or not French).\n\nThere are many functions related to possible extortion or blackmail of victims watching\npornographic content, but despite having sent unrelated sextortion scam emails, the\noperator has not leveraged these as far as we can tell. Many functions have been added\n\n\n-----\n\nand then quickly removed across many different versions in a short period of time (two\nmonths). This shows that the operators are actively working on their botnet and are inclined\nto experiment with new features that could bring a better monetization of their work.\n\nWe recommend that people be careful when they open attachments from unknown sources.\nKeep system as well as security software up to date.\n\n## Acknowledgments\n\nThanks to Alexandre-Xavier Labonté-Lamoureux for the technical analysis.\n\nThanks to our peers at proofpoint.com for allowing us to use a screenshot of the phishing\nemail.\n\n## Indicators of Compromise (IoCs)\n\n**Hashes (SHA-1)** **ESET detection names**\n\n0970BDE765CB8F183CF68226460CDD930A596088 Win32/Varenyky.A\n\n09EFD54E3014A7E67F0FCAA543F826AC06BBE155 Win32/Varenyky.A\n\n1C27359023B7195AC739641BBC53789A0BA4A244 Win32/Varenyky.A\n\n1D52D26FC2E7E24FA68F36FA04B36D9516DF036F Win32/Varenyky.A\n\n21128D4E7124FD8F1D1A62FCC01F5D5F6C653811 Win32/Varenyky.A\n\n25FF8154F1CEB0C8E13A3F0F72D855B40819D26B Win32/Varenyky.A\n\n36D9AEF26D9B7E40F1140BB62FF6C76110791FAD Win32/Varenyky.A\n\n6A9213A89708D2D304371A00678755F2C6AFE42B Win32/Varenyky.A\n\n722FE03B7ECA8C11C73CF7206EF0E9A11E857182 Win32/Varenyky.A\n\n7F04B6418E31967C12D30150D1CAE7F48980ED08 Win32/Varenyky.A\n\n93D51AC86C5ED207DD6E77B2E767CDEB23106925 Win32/Varenyky.A\n\n9987B0072EF9850CAB869981B05B85284FDDEE92 Win32/Varenyky.A\n\nA9B04941548917BD67CAA533F5078B75D65DD1EE Win32/Varenyky.A\n\nABF3AC24BE92ABE3425379418CF53AA65F370279 VBA/TrojanDownloader.Agent.OAW\n\nAC1EB847A456B851B900F6899A9FD13FD6FBEC7D Win32/Varenyky.A\n\nB855C03A47901C52C901FFF606F90BC1C262EB87 Win32/Varenyky.A\n\n\n-----\n\n**Hashes (SHA-1)** **ESET detection names**\n\nC32552EFEDAC932AD53DB4569569780782B04704 Win32/Varenyky.A\n\n**PDB paths**\n\nC:\\NoCy\\Release\\Varenyky.pdb\n\nC:\\Users\\lenovo\\Desktop\\NoCy\\Release\\Varenyky.pdb\n\nC:\\UnTroueCunTroueKhouya\\Release\\UnTroueCunTroueKhouya.pdb\n\n**Network**\n\nartisticday[.]icu\n\nastonishingwill[.]icu\n\ndirectfood[.]icu\n\ngradualrain[.]icu\n\nproapp[.]icu\n\nprovincialwake[.]icu\n\nshrek[.]icu\n\nthinstop[.]icu\n\njg4rli4xoagvvmw47fr2bnnfu7t2epj6owrgyoee7daoh4gxvbt3bhyd[.]onion\n\n8 Aug 2019 - 11:30AM\n\n### Sign up to receive an email update whenever a new article is published in our Ukraine Crisis – Digital Security Resource Center\n\n Newsletter\n\n Discussion\n\n\n-----\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-08-08 - Varenyky- Spambot à la Française.pdf"
    ],
    "report_names": [
        "2019-08-08 - Varenyky- Spambot à la Française.pdf"
    ],
    "threat_actors": [
        {
            "id": "3fad11c6-4336-4b28-a606-f510eca5452e",
            "created_at": "2022-10-25T16:07:24.346573Z",
            "updated_at": "2025-03-27T02:02:10.183211Z",
            "deleted_at": null,
            "main_name": "Turbine Panda",
            "aliases": [
                "APT 26",
                "Black Vine",
                "Bronze Express",
                "Group 13",
                "JerseyMikes",
                "KungFu Kittens",
                "PinkPanther",
                "Shell Crew",
                "Turbine Panda",
                "WebMasters"
            ],
            "source_name": "ETDA:Turbine Panda",
            "tools": [
                "Agent.dhwf",
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "Derusbi",
                "Destroy RAT",
                "DestroyRAT",
                "FF-RAT",
                "FormerFirstRAT",
                "Hurix",
                "Kaba",
                "Korplug",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Mivast",
                "PlugX",
                "RbDoor",
                "RedDelta",
                "RibDoor",
                "Sakula",
                "Sakula RAT",
                "Sakurel",
                "Sogu",
                "StreamEx",
                "TIGERPLUG",
                "TVT",
                "Thoper",
                "Winnti",
                "Xamtrav",
                "cobeacon",
                "ffrat"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "64ca1755-3883-4173-8e0a-6e5cf92faafd",
            "created_at": "2022-10-25T15:50:23.636456Z",
            "updated_at": "2025-03-27T02:00:55.51077Z",
            "deleted_at": null,
            "main_name": "Deep Panda",
            "aliases": [
                "Deep Panda",
                "Shell Crew",
                "KungFu Kittens",
                "PinkPanther",
                "Black Vine"
            ],
            "source_name": "MITRE:Deep Panda",
            "tools": [
                "Mivast",
                "StreamEx",
                "Sakula",
                "Tasklist",
                "Derusbi"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "46a151bd-e4c2-46f9-aee9-ee6942b01098",
            "created_at": "2023-01-06T13:46:38.288168Z",
            "updated_at": "2025-03-27T02:00:02.794118Z",
            "deleted_at": null,
            "main_name": "APT19",
            "aliases": [
                "Black Vine",
                "TEMP.Avengers",
                "PinkPanther",
                "G0073",
                "KungFu Kittens",
                "Group 13",
                "Shell Crew",
                "BRONZE FIRESTONE",
                "G0009",
                "Sunshop Group",
                "DEEP PANDA",
                "Codoso"
            ],
            "source_name": "MISPGALAXY:APT19",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673536113,
    "ts_updated_at": 1743041785,
    "ts_creation_date": 1653761238,
    "ts_modification_date": 1653761238,
    "files": {
        "pdf": "https://archive.orkl.eu/6526ac1f27405444074cf084b01d65b81131c05a.pdf",
        "text": "https://archive.orkl.eu/6526ac1f27405444074cf084b01d65b81131c05a.txt",
        "img": "https://archive.orkl.eu/6526ac1f27405444074cf084b01d65b81131c05a.jpg"
    }
}