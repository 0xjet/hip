{
    "id": "26f4b100-a0f2-4710-8958-ccfeaac79ac7",
    "created_at": "2022-10-25T16:48:20.142788Z",
    "updated_at": "2025-03-27T02:09:52.311044Z",
    "deleted_at": null,
    "sha1_hash": "18f110cc5441d442f5aa14b9b456fce56e59d8f4",
    "title": "BlackOasis APT and new targeted attacks leveraging zero-day exploit",
    "authors": "Kaspersky",
    "file_creation_date": "2017-10-17T01:27:16Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 720933,
    "plain_text": "# g g g day exploit\n\n**[securelist.com /blackoasis-apt-and-new-targeted-attacks-leveraging-zero-day-exploit/82732/](https://securelist.com/blackoasis-apt-and-new-targeted-attacks-leveraging-zero-day-exploit/82732/)**\n\nBy GReAT\n\nMore information about BlackOasis APT is available to customers of Kaspersky Intelligence Reporting Service.\n[Contact: intelreports@kaspersky.com](mailto:intelreports@kaspersky.com)\n\n## Introduction\n\nKaspersky Lab has always worked closely with vendors to protect users. As soon as we find new vulnerabilities we\nimmediately inform the vendor in a responsible manner and provide all the details required for a fix.\n\nOn October 10, 2017, Kaspersky Lab’s advanced exploit prevention systems identified a new Adobe Flash zero day\nexploit used in the wild against our customers. The exploit was delivered through a Microsoft Office document and\nthe final payload was the latest version of FinSpy malware. We have reported the bug to Adobe who assigned it\n[CVE-2017-11292 and released a patch earlier today:](https://helpx.adobe.com/security/products/flash-player/apsb17-32.html)\n\nSo far only one attack has been observed in our customer base, leading us to believe the number of attacks are\nminimal and highly targeted.\n\nAnalysis of the payload allowed us to confidently link this attack to an actor we track as “BlackOasis”. We are also\nhighly confident that BlackOasis was also responsible for another zero day exploit (CVE-2017-8759) discovered by\n[FireEye in September 2017. The FinSpy payload used in the current attacks (CVE-2017-11292) shares the same](https://www.fireeye.com/blog/threat-research/2017/09/zero-day-used-to-distribute-finspy.html)\ncommand and control (C2) server as the payload used with CVE-2017-8759 uncovered by FireEye.\n\n## BlackOasis Background\n\nWe first became aware of BlackOasis’ activities in May 2016, while investigating another Adobe Flash zero day. On\n[May 10, 2016, Adobe warned of a vulnerability (CVE-2016-4117) affecting Flash Player 21.0.0.226 and earlier](https://helpx.adobe.com/security/products/flash-player/apsa16-02.html)\nversions for Windows, Macintosh, Linux, and Chrome OS. The vulnerability was actively being exploited in the wild.\n\nKaspersky Lab was able to identify a sample exploiting this vulnerability that was uploaded to a multi scanner\n\n\n-----\n\nsame server was hosting multiple FinSpy installation packages.\n\nLeveraging data from Kaspersky Security Network, we identified two other similar exploit chains used by BlackOasis\nin June 2015 which were zero days at the time. Those include CVE-2015-5119 and CVE-2016-0984, which were\npatched in July 2015 and February 2016 respectively. These exploit chains also delivered FinSpy installation\npackages.\n\nSince the discovery of BlackOasis’ exploitation network, we’ve been tracking this threat actor with the purpose of\nbetter understanding their operations and targeting and have seen a couple dozen new attacks. Some lure\ndocuments used in these attacks are shown below:\n\n\n-----\n\nDecoy documents used in BlackOasis attacks\n\nTo summarize, we have seen BlackOasis utilizing at least five zero days since June 2015:\n\nCVE-2015-5119 – June 2015\n\nCVE-2016-0984 – June 2015\n\nCVE-2016-4117 – May 2016\n\nCVE-2017-8759 – Sept 2017\n\nCVE-2017-11292 – Oct 2017\n\n## Attacks Leveraging CVE-2017-11292\n\n\n-----\n\n**Flash object in the .docx file, stored in uncompressed format**\n\nThe Flash object contains an ActionScript which is responsible for extracting the exploit using a custom packer seen\nin other FinSpy exploits.\n\n\n-----\n\n**Unpacking routine for SWF exploit**\n\nThe exploit is a memory corruption vulnerability that exists in the\n“com.adobe.tvsdk.mediacore.BufferControlParameters” class. If the exploit is successful, it will gain arbitrary\nread / write operations within memory, thus allowing it to execute a second stage shellcode.\n\nThe first stage shellcode contains an interesting NOP sled with alternative instructions, which was most likely\ndesigned in such a way to avoid detection by antivirus products looking for large NOP blocks inside flash files:\n\nNOP sled composed of 0x90 and 0x91 opcodes\n\nThe main purpose of the initial shellcode is to download second stage shellcode from\nhxxp://89.45.67[.]107/rss/5uzosoff0u.iaf.\n\n\n-----\n\n**Second stage shellcode**\n\nThe second stage shellcode will then perform the following actions:\n\n1. Download the final payload (FinSpy) from hxxp://89.45.67[.]107/rss/mo.exe\n\n2. Download a lure document to display to the victim from the same IP\n\n3. Execute the payload and display the lure document\n\n### Payload – mo.exe\n\nAs mentioned earlier, the “mo.exe” payload (MD5: 4a49135d2ecc07085a8b7c5925a36c0a) is the newest version of\nGamma International’s FinSpy malware, typically sold to nation states and other law enforcement agencies to use in\nlawful surveillance operations. This newer variant has made it especially difficult for researchers to analyze the\nmalware due to many added anti-analysis techniques, to include a custom packer and virtual machine to execute\ncode.\n\n\n-----\n\n**Part of packed VM PCODE**\n\nAfter unpacking, the PCODE it will look like the following:\n\n**Unpacked PCODE**\n\nAfter unpacking the virtual machine PCODE is then decrypted:\n\n\n-----\n\n**Decrypted VM PCODE**\n\nThe custom virtual machine supports a total of 34 instructions:\n\n**Example of parsed PCODE**\n\nIn this example, the “1b” instruction is responsible for executing native code that is specified in parameter field.\n\nOnce the payload is successfully executed, it will proceed to copy files to the following locations:\n\nC:\\ProgramData\\ManagerApp\\AdapterTroubleshooter.exe\n\nC:\\ProgramData\\ManagerApp\\15b937.cab\n\nC:\\ProgramData\\ManagerApp\\install.cab\n\nC:\\ProgramData\\ManagerApp\\msvcr90.dll\n\nC:\\ProgramData\\ManagerApp\\d3d9.dll\n\nThe “AdapterTroubleshooter.exe” file is a legitimate binary which is leveraged to use the famous DLL search order\nhijacking technique. The “d3d9.dll” file is malicious and is loaded into memory by the legit binary upon execution.\nOnce loaded, the DLL will then inject FinSpy into the Winlogon process.\n\n\n-----\n\n**Part of injected code in winlogon process**\n\nThe payload calls out to three C2 servers for further control and exfiltration of data. We have observed two of them\nused in the past with other FinSpy payloads. Most recently one of these C2 servers was used together with CVE2017-8759 in the attacks reported by FireEye in September 2017. These IPs and other previous samples tie closely\nto the BlackOasis APT cluster of FinSpy activity.\n\n## Targeting and Victims\n\nBlackOasis’ interests span a wide gamut of figures involved in Middle Eastern politics and verticals\ndisproportionately relevant to the region. This includes prominent figures in the United Nations, opposition bloggers\nand activists, and regional news correspondents. During 2016, we observed a heavy interest in Angola, exemplified\nby lure documents indicating targets with suspected ties to oil, money laundering, and other illicit activities. There is\nalso an interest in international activists and think tanks.\n\nVictims of BlackOasis have been observed in the following countries: Russia, Iraq, Afghanistan, Nigeria, Libya,\nJordan, Tunisia, Saudi Arabia, Iran, Netherlands, Bahrain, United Kingdom and Angola.\n\n## Conclusions\n\nWe estimate that the attack on HackingTeam in mid-2015 left a gap on the market for surveillance tools, which is\nnow being filled by other companies. One of these is Gamma International with their FinFisher suite of tools.\nAlthough Gamma International itself was hacked by Phineas Fisher in 2014, the breach was not as serious as it\nwas in the case of HackingTeam. Additionally, Gamma had two years to recover from the attack and pick up the\npace.\n\nWe believe the number of attacks relying on FinFisher software, supported by zero day exploits such as the ones\ndescribed here will continue to grow.\n\nWhat does it mean for everyone and how to defend against such attacks, including zero-day exploits?\n\n[For CVE-2017-11292 and other similar vulnerabilities, one can use the killbit for Flash within their organizations to](https://answers.microsoft.com/en-us/windows/forum/windows_8-update/flashplayer-updates/cd258a3f-cd87-4ea9-bdb6-074d06ad491e?auth=1)\ndisable it in any applications that respect it. Unfortunately, doing this system-wide is not easily done, as Flash\nobjects can be loaded in applications that potentially do not follow the killbit. Additionally, this may break any other\nnecessary resources that rely on Flash and of course, it will not protect against exploits for other third party\nsoftware.\n\nDeploying a multi-layered approach including access policies, anti-virus, network monitoring and whitelisting can\nhelp ensure customers are protected against threats such as this. Users of Kaspersky products are protected as\nwell against this threat by one of the following detections:</p style=”margin-bottom:0!important”>\n\n\n-----\n\nHEUR:Exploit.MSOffice.Generic\n\nMore information about BlackOasis APT is available to customers of Kaspersky Intelligence Reporting Service.\n[Contact: intelreports@kaspersky.com](mailto:intelreports@kaspersky.com)\n\n## Acknowledgements\n\nWe would like to thank the Adobe Product Security Incident Response Team (PSIRT) for working with us to identify\nand patch this vulnerability.\n\n## References\n\n[1. Adobe Bulletin https://helpx.adobe.com/security/products/flash-player/apsb17-32.html](https://helpx.adobe.com/security/products/flash-player/apsb17-32.html)\n\n## Indicators of compromise\n\n4a49135d2ecc07085a8b7c5925a36c0a\n89.45.67[.]107\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/8ydblix231swgmjochzrvchwxcedis8z"
    ],
    "report_names": [
        "Kaspersky_BlackOasis-APT-zero-day(10-16-2017)"
    ],
    "threat_actors": [
        {
            "id": "10ad5c1d-5030-4300-be4e-6d24b40a6330",
            "created_at": "2022-10-25T16:07:23.400966Z",
            "updated_at": "2025-03-27T02:02:09.780076Z",
            "deleted_at": null,
            "main_name": "BlackOasis",
            "aliases": [],
            "source_name": "ETDA:BlackOasis",
            "tools": [
                "FinFisher",
                "FinFisher RAT",
                "FinSpy",
                "Wingbird"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "a3687241-9876-477b-aa13-a7c368ffda58",
            "created_at": "2022-10-25T16:07:24.496902Z",
            "updated_at": "2025-03-27T02:02:10.256629Z",
            "deleted_at": null,
            "main_name": "Hacking Team",
            "aliases": [],
            "source_name": "ETDA:Hacking Team",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "5200f27d-0d0a-49e9-a9de-9612971126c2",
            "created_at": "2023-01-06T13:46:38.959648Z",
            "updated_at": "2025-03-27T02:00:02.96312Z",
            "deleted_at": null,
            "main_name": "BlackOasis",
            "aliases": [
                "G0063"
            ],
            "source_name": "MISPGALAXY:BlackOasis",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "1ba9c064-34d2-48b5-a08c-04d241b00ebe",
            "created_at": "2022-10-25T15:50:23.734241Z",
            "updated_at": "2025-03-27T02:00:55.535726Z",
            "deleted_at": null,
            "main_name": "BlackOasis",
            "aliases": [
                "BlackOasis"
            ],
            "source_name": "MITRE:BlackOasis",
            "tools": null,
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "e90c06e4-e3e0-4f46-a3b5-17b84b31da62",
            "created_at": "2023-01-06T13:46:39.018236Z",
            "updated_at": "2025-03-27T02:00:02.978356Z",
            "deleted_at": null,
            "main_name": "Hacking Team",
            "aliases": [],
            "source_name": "MISPGALAXY:Hacking Team",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1666716500,
    "ts_updated_at": 1743041392,
    "ts_creation_date": 1508203636,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/18f110cc5441d442f5aa14b9b456fce56e59d8f4.pdf",
        "text": "https://archive.orkl.eu/18f110cc5441d442f5aa14b9b456fce56e59d8f4.txt",
        "img": "https://archive.orkl.eu/18f110cc5441d442f5aa14b9b456fce56e59d8f4.jpg"
    }
}