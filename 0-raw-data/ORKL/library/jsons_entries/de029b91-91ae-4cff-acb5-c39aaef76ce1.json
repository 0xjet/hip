{
    "id": "de029b91-91ae-4cff-acb5-c39aaef76ce1",
    "created_at": "2022-10-25T16:48:14.718871Z",
    "updated_at": "2025-03-27T02:05:25.013796Z",
    "deleted_at": null,
    "sha1_hash": "576d1f3a8cc11502f54fd86fd4a1d22dd47b176a",
    "title": "",
    "authors": "",
    "file_creation_date": "2017-07-18T08:58:17Z",
    "file_modification_date": "2017-07-18T08:58:17Z",
    "file_size": 494594,
    "plain_text": "# G Data Whitepaper 11/07/2017\n\n\n# Analysis of\n Rurktar\n\n MSIL.Backdoor.Rurktar.A\n\n##### Analysis by: Nathan Stern\n\n G DATA Software AG | Application Development | July 2017\n\n\n-----\n\nG Data Whitepaper 07/2017: Description for Rurktar\n\n## Contents\n\nRurktar ............................................................................................................................... 3\n\n1. Introduction ................................................................................................................................ 3\n\n2. General structure ........................................................................................................................ 3\n\n3. Debug path ................................................................................................................................. 3\n\n4. Configuration .............................................................................................................................. 3\n\n5. Persistence ................................................................................................................................. 5\n\n6. Commands ................................................................................................................................. 6\n\n7. Communication .......................................................................................................................... 7\n\n8. Evolution of Rurktar .................................................................................................................... 9\n\nSnow ............................................................................................................................... 10\n\n9. Evolution of Rurktar within Snow ............................................................................................. 10\n\n10. Getting administrator privileges ............................................................................................... 10\n\n11. Persistence ............................................................................................................................... 11\n\nCase 1(folder exists): ................................................................................................................. 11\n\nCase 2(folder doesn’t exist): ...................................................................................................... 11\n\n12. Conclusion: ............................................................................................................................... 12\n\n13. Additional YARA rule for Rurktar ............................................................................................... 12\n\nFile hashes: ....................................................................................................................... 14\n\n\n-----\n\nG Data Whitepaper 07/2017: Description for Rurktar\n\n## Rurktar\n\n 1. Introduction\n\nThere is a new malware called Rurktar[2]. It’s a trojan spy which is installed as service called RCSU.\nThe service connects back to the attacker machine and waits for commands which will be given by\nthe attacker. The file size of the malware is mostly around ~50Kb, as you can see from the list of\nsample hashes at the end of this report. Currently, the trojan spy is still in development and is not\nspotted in-the-wild yet. This could change once the trojan spy has fully developed.\n\n## 2. General structure\n\nThe malware contains 7 namespaces with one or more classes inside.\n\n“Conn” -> Core functionalities like connecting back to the attacker by using a list of multiple IP’s\nand listening for commands and executing them.\n\n“Ini” -> Used to read and write information from and to the .ini configuration file for the malware.\n\n“Prefs” -> The default configuration settings of the malware are hardcoded here.\n\n“RCS” -> With administrator privileges, the malware installs itself as a windows service called\n\n“RCSU” -> Inside is the main class, which gets executed first and calls all the other classes.\n\n“RCSUConn” -> A helper class for the “Conn” namespace with a method to read incoming\ncommands.\n\n“Trinet.Networking” -> Used to enumerate local and remote network shares. The code used from\nhttps://www.codeproject.com/Articles/2939/Network-Shares-and-UNC-paths\n\n## 3. Debug path\n\nWhen viewing the strings of the malware, the debug path becomes visible and reveals some\ninteresting information like the username “Alex” and also, that the user stores the malware in his\nDropbox folder.\n\nFull debug path: “c:\\Users\\Alex\\Dropbox\\Projects\\RCS\\RCSU\\obj\\Release\\RCSU.pdb”\n\n## 4. Configuration\n\nThe configuration file “C:\\WINDOWS\\system32\\R_C_S.ini” is loaded and stored into the attribute\nthis.prefs, if the file “C:\\WINDOWS\\system32\\RCS.ini” doesn’t exist.\n\nIf “C:\\WINDOWS\\system32\\RCS.ini” does exist, it will read the configuration details and store them\ninto “this.prefs”. After that, Rurktar deletes the “RCS.ini” file. All configuration details are listed\nbelow.\n\n\n-----\n\nG Data Whitepaper 07/2017: Description for Rurktar\n\n**Configuration** **Functionality**\n\nDebug If enabled, a logfile “RCS.log” gets written to the hard drive.\n\nPort The port which the malware connects to\n\nIP The IP which the malware connects to\n\nFriendlyID Default return value which is being used if no UUID could be\nenumerated.\n\nCaptureMode Not implemented yet\n\nCaptureStart Not implemented yet\n\nCaptureMonikerString Not implemented yet\n\nACaptureMonikerString Not implemented yet\n\nVideoCap Not implemented yet\n\nSkipFrames Not implemented yet\n\nSkipDetectionFrames Not implemented yet\n\nSkipTakeFrames Not implemented yet\n\nDetectionPreBuffer Not implemented yet\n\nNetworkImageQ Sets the quality of the to be delivered image\n\nCaptureDirectory Checks whether a directory exists or not\n\nDefPass Not implemented yet\n\nCaptureStopProcess1 Not implemented yet\n\nCaptureStopProcess2 Not implemented yet\n\nDetectPorog Not implemented yet\n\nMaxCaptureFrames Not implemented yet\n\nWatchFiles Not implemented yet\n\nAutoSendPreviews Not implemented yet\n\nSendOriginPreviews Not implemented yet\n\n\n-----\n\nG Data Whitepaper 07/2017: Description for Rurktar\n\nCopyOriginsToCaptureDir Not implemented yet\n\nControlExt Not implemented yet\n\nMaxCaptureFolderSize Not implemented yet\n\nWatchProc Not implemented yet\n\nScreenshotAutoCapture Not implemented yet\n\nScreenshotAutoStartProcess Not implemented yet\n\nScreenshotExt Sets the extension type for all screenshots\n\nScreenshotPause Not implemented yet\n\nProxyEnabled Not implemented yet\n\n## 5. Persistence\n\nThe malware isn’t placing a registry key into\n“HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run” like most of the\nmalware out there does. Instead, it installs a new service called RCSU. This service will be started\non a reboot just like any other service.\n\nFigure 1. Rurktar service installation\n\n\n-----\n\nG Data Whitepaper 07/2017: Description for Rurktar\n\n## 6. Commands\n\nBelow you can see a list of all possible commands the attacker might use, to execute actions at the\nvictim computer.\n\n**Command** **Functionality**\n\nShares Enumerates IPv4/IPv6 address, subnets and the default gateway.\n\nShare Enumerates all network shares available on the system.\n\nFind Enumerates files with the handover parameters directory, recursive\nsearch, filetype and filesize.\n\nUser Enumerates Username, UserDomainName, MachineName and the\nOSVersion.\n\nPing Determines whether a computer is accessible\n\nPrefs Gets the current preferences the malware is actively using.\n\nType Not implemented\n\nReceive Saves a file to the disk\n\nid Enumerates the UUID\n\nLs List hard disks and information about them (Name,type, label,\nformat, available free space, total free space and the total size)\n\nGet Saves a large file to disk\n\nGetfolder Not implemented\n\nSetparam Sets a specific parameter to the configuration\n\nCmd Executes a command via the command prompt\n\nProc List current running processes on the computer\n\nKill Terminates a running process by ID\n\nKillname Terminates a running process by name\n\nLsdev Returns the DeviceName\n\nScreenshot Makes a screenshot from the current screen\n\nPreview Creates a preview image (500x500) of the current screen\n\n\n-----\n\nG Data Whitepaper 07/2017: Description for Rurktar\n\nDelete Deletes a file\n\nDelfolder Deletes a folder\n\n## 7. Communication\n\nBelow is a table of the communication format from the commands.\n\n**Command** **Server/Client communication**\n\nShares Returns Mac address, IPAddr, IPv6addr, IPSubnet, IPSubnet mask,\nDefaultIPGateway, DNSServerSearchOrder as String\n\nShare Returns the error message “Share Cant resolve”\n\nFind Returns “find Cant find” + error message, if the file is not found.\n\nUser Returns\nuser?user*USERNAME*DOMAIN*USERINTERACTIVE*MACHINENAME*OSVERSION\n\nPing Returns “ping Ping start error” if the command fails and “ping PingStarted” if the\ncommand was successful\n\nPrefs Should return the preferences, returns nothing at all instead.\n\nType Returns “type?type*abstract”\n\nReceive Server: sends “file fileiwanttohave.txt”\n\n\nClient: returns “recieveCannot save file” if there was an error. Returns “recieve FILE\nSAVED”+ FILENAME if it was successful.\n\n\nid Server: sends “id”\n\n\nClient: returns “id?id*”+UUID”?FriendlyID*” + Prefs.FriendlyID\n\n\n-----\n\nG Data Whitepaper 07/2017: Description for Rurktar\n\n\nLs Server: sends “ls;root”\n\n\nClient: returns\n“ls;root?disc*”+LABEL+”*”+DRIVEFORMAT+”*”+AVAILABLEFREESPACE+”*”+TOTALF\nREESPACE+”*”+TOTALSIZE+”?disc… If it was successful. If there is an error “ls;root\nCannot read drives” +ERRORMESSAGE is shown.\n\nServer: sends “ls;C:\\” or “ls;D:\\” etc\n\nClient returns with all files and folders in the format\n“ls;C:\\?dir*”+SOMEFOLDER+”*”+”file*”+SOMEFILE…\n\n\nGet Server: sends “get;”+FILENAME\n\n\nClient: returns “get;”+FILENAME+”Cannot read file” if the file wasn’t found.\n\nClient: sends the file, if it was found.\n\n\nGetfolder Server: sends “getfolder”\n\n\nClient: returns “getfolderCannot read file”\n\n(Method not implemented)\n\n\nSetparam Server: sends “setparam”\n\n\nClient: sends “setparamCannot set param”\n\nServer: sends “setparam;Debug;true”\n\nClient: sends “setparam;Debug;true OK”\n\n\nCmd Server: sends “cmd”\n\n\nClient: sends “cmdCannot start cmd”\n\nServer: sends “cmd;calc.exe”\n\nClient: sends “cmd?cmd*out\n\ncmd?cmd*err\n\ncmd;calc.exe Ok”\n\n\nProc Server: sends “proc”\n\n\nClient: sends “proc?proc*”+PROCESSNAME+”*”+PROCESSID+”?proc….\n\n\nKill Server: sends “kill;”+PID\n\n\nClient: sends “kill;”+PID+PROCESSNAME”+”killed”\n\nServer: sends “kill;”\n\nClient: sends “killCannot get list of processes”\n\n\n-----\n\nG Data Whitepaper 07/2017: Description for Rurktar\n\n\nKillname Server: sends “killname;”+PROCESSNAME\n\n\nClient: sends “killname;”+PROCESSNAME+PROCESSNAME+” killed”\n\nServer: sends “killname;”\n\nClient: sends “killname; process not finded”\n\n\nLsdev Enumarates the DeviceName\n\nScreenshot Makes a screenshot from the current screen\n\nPreview Creates a preview image (500x500) of the current screen\n\nDelete Server:sends “delete;”+FILENAME\n\n\nClient:sends “delete;”+FILENAME+ “DELETED”\n\nServer:sends “delete;”\n\nClient: sends “delete; Cannot delete”\n\n\nDelfolder Server: sends “delfolder;”\n\n\nClient: sends “delfolder; Cannot delete”\n\nServer: sends “delfolder;”+FOLDERNAME\n\nClient:sends “delfolder;”+FOLDERNAME+” DELETED”\n\n\n## 8. Evolution of Rurktar\n\nThe first submission of Rurktar[1] was on the 2017-02-13 20:36:11, while the first submission of\nRurktar[2] was on the 2017-06-11 19:12:52 UTC. Both samples were submitted on VirusTotal. Now\nthis doesn’t specifically say, that the Rurktar malware is evolving, but when decompiling the\nprojects with Dnspy and comparing the two project structures with WinMerge, it becomes clear,\nthat parts of the code were changed. The older submission had 3 useless commands(fuu, fu2, fu3)\nwhich were a copy of the “delfolder” command. Those cases were taken out of the switch-case\nstatement, as well as their functionality.\n\nFigure 2. Rurktar file comparison\n\n\n-----\n\nG Data Whitepaper 07/2017: Description for Rurktar\n\n## Snow\n\nThe malicious application called snow[4] is a wrapper to the Rurktar[3] malware. It checks if the\ncurrent user has admin privileges or not. Then it stores the Rurktar malware on the disk and uses a\npersistence technique, so that it will get started when the computer is rebooted in future.\n\n## 9. Evolution of Rurktar within Snow\n\nSnow has stored Rurktar in its resources. When grabbing Rurktar from snow, it becomes clear, that\nthe Rurktar malware has further “developed”. An additional case “fuck” has been added. The main\ndifference of Case 25 (fuck) and the “delfolder” command, are the error messages – the\nfunctionality stays the same.\n\nFigure 3. Extracted Rurktar from Snow(Case25)\n\n## 10. Getting administrator privileges\n\nSo Snow.exe checks if the current application is run with administration privileges. If it is, it will\nexecute the main part of dropping Rurktar. Otherwise, it will try to execute a new process of itself\nwhich is asking the user to execute the application as admin.\n\nFigure 4. Snow.exe asks for admin privileges\n\n\n-----\n\nG Data Whitepaper 07/2017: Description for Rurktar\n\n## 11. Persistence\n\nAt first, Snow checks whether the registry key “SOFTWARE\\Microsoft\\NET Framework\nSetup\\NDP\\v3.5” exists. If it doesn’t, the directory string is set to\n“C:\\Windows\\Microsoft.NET\\Framework\\v3.5\\”. If the key does exist, the “InstallPath” value from\nthe “SOFTWARE\\Microsoft\\NET Framework Setup\\NDP\\v3.5” key gets used as an installation\ndirectory for the malware.\n\nIn both cases, the string “RCS\\\\” will get appended to the directory string.\n\nDepending on the previous directory string, snow will now either use the “InstallPath” value +\n“RCS\\\\” as directory or use “C:\\Windows\\Microsoft.NET\\Framework\\v3.5\\RCS” for further actions.\n\n#### Case 1 (folder exists):\n\nnet.exe gets started with the arguments “stop rcsu”, to stop the current rcsu service.\n\nIf net.exe has finished, sc.exe gets started with the arguments “delete rcsu”, to delete the service.\n\nIf sc.exe has finished, the file RCSU.exe and iu.exe(InstallUtil) in the folder are getting deleted.\n\nAfter the cleanup phase, the new RCSU.exe and iu.exe are written from the Snow file resources to\nthe folder. Once this process has finished, iu.exe installs RCSU.exe as a service and net.exe gets\nexecuted with the parameters “start rcsu”, to run the service.\n\n#### Case 2 (folder doesn’t exist):\n\nThe folder will be created and RCSU.exe and iu.exe will be read from the resources and written to\nthe folder. Then, the same procedure as above will get executed.\n\nAfter the procedure, a message is getting shown in figure 5. This is a hint, that the Snow malware is\nmade by Russians.\n\nFigure 5. Snow.exe error message\n\n\n-----\n\nG Data Whitepaper 07/2017: Description for Rurktar\n\n## 12. Conclusion:\n\nThe Rurktar malware is yet not been found that often, but has the potential to be more popular in\nthe coming months because of the amount of options an attacker has with this malware. Right\nnow, most of the attacker IP’s (80.78.251.138, 80.78.251.148) come from Russia since the malware\nseem to be developed by a Russian because the exception messages within the malware are\nmostly in Russian. But as always, people in other countries can get the malware in their hands, so\nmore diversity in attacker countries IP’s will be seen.\n\n## 13. Additional YARA rule for Rurktar\n\nrule Rurktar\n\n{\n\nmeta:\n\nauthor = \"Nathan Stern\"\n\ndescription = \"Rurktar detection rule\"\n\nstrings:\n\n$a = \"FriendlyID\" wide ascii nocase\n\n$a2 = \"CaptureMode\" wide ascii nocase\n\n$a3 = \"CaptureStart\" wide ascii nocase\n\n$a4 = \"CaptureMonikerString\" wide ascii nocase\n\n$a5 = \"ACaptureMonikerString\" wide ascii nocase\n\n$a6 = \"VideoCap\" wide ascii nocase\n\n$a7 = \"SkipFrames\" wide ascii nocase\n\n$a8 = \"SkipDetectionFrames\" wide ascii nocase\n\n$a9 = \"SkipTakeFrames\" wide ascii nocase\n\n$a10 = \"DetectionPreBuffer\" wide ascii nocase\n\n$a11 = \"MaxCaptureFrames\" wide ascii nocase\n\n$a12 = \"MaxCaptureFolderSize\" wide ascii nocase\n\n$a13 = \"NetworkImageQ\" wide ascii nocase\n\n$a14 = \"CaptureDirectory\" wide ascii nocase\n\n$a15 = \"DefPass\" wide ascii nocase\n\n$a16 = \"CaptureStopProcess1\" wide ascii nocase\n\n$a17 = \"CaptureStopProcess2\" wide ascii nocase\n\n\n-----\n\nG Data Whitepaper 07/2017: Description for Rurktar\n\n\n$a18 = \"DetectPorog\" wide ascii nocase\n\n$a19 = \"WatchFiles\" wide ascii nocase\n\n$a20 = \"AutoSendPreviews\" wide ascii nocase\n\n$a21 = \"ControlExt\" wide ascii nocase\n\n$a22 = \"SendOriginPreviews\" wide ascii nocase\n\n$a23 = \"CopyOriginsToCaptureDir\" wide ascii nocase\n\n$a24 = \"WatchProc\" wide ascii nocase\n\n$a25 = \"ScreenshotExt\" wide ascii nocase\n\n$a26 = \"ScreenshotAutoCapture\" wide ascii nocase\n\n$a27 = \"ScreenshotAutoStartProcess\" wide ascii nocase\n\n$a28 = \"ScreenshotPause\" wide ascii nocase\n\n$a29 = \"ProxyEnabled\" wide ascii nocase\n\n$b = \"\\\\R_C_S.ini\" wide ascii nocase\n\n$b2 = \"\\\\RCS.ini\" wide ascii nocase\n\n$b3 = \"RCS.log\" wide ascii nocase\n\n$b4 = \"RCSU.exe\" wide ascii nocase\n\n$b5 = \"RCS.log\" wide ascii nocase\n\n$c = \"?share*\" wide ascii nocase\n\n$c2 = \"?find*\" wide ascii nocase\n\n$c3 = \"user?\" wide ascii nocase\n\n$c4 = \"?prefs*\" wide ascii nocase\n\n$c5 = \"?type*abstract\" wide ascii nocase\n\n$c6 = \"?FriendlyID*\" wide ascii nocase\n\n$c7 = \"?disc*\" wide ascii nocase\n\ncondition:\n\n5 of ($a*) or\n\n3 of ($b*) or\n\n4 of ($c*)\n\n}\n\n\n-----\n\nG Data Whitepaper 07/2017: Description for Rurktar\n\n## File hashes:\n\n[1] MSIL.Backdoor.Rurktar.A\nb4b75bda475ea58f2a5cf3329e311a70fa56745ba6cb2785523fa53139d4e37f\n\n[2] MSIL.Backdoor.Rurktar.A\n54f25a6820b8a0e3fc26bdf4599e7db695ef7aefb7dcefaa2c2581bb58426a40\n\n[3] MSIL.Backdoor.Rurktar.A\n89110710eddd0da23ea206a6047c252bf1e16a2d1957729973d77a58219e614b\n\n[4] MSIL.Backdoor.Rurktar.A\n618908e3d368301a323ee8ae7df867db8d7f5a98b513cfb8c961fb945e62a9b6\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5910e58f-4bc9-4e4e-9dbb-887804094a01",
            "created_at": "2022-10-25T16:32:58.457399Z",
            "updated_at": "2022-10-25T16:32:58.457399Z",
            "deleted_at": null,
            "name": "OTX",
            "url": "https://otx.alienvault.com",
            "description": "Alienvault Open Threat Exchange (OTX)",
            "reports": null
        }
    ],
    "references": [
        "https://file.gdatasoftware.com/web/en/documents/whitepaper/Rurktar.pdf"
    ],
    "report_names": [
        "Rurktar.pdf"
    ],
    "threat_actors": [
        {
            "id": "67bf0462-41a3-4da5-b876-187e9ef7c375",
            "created_at": "2022-10-25T16:07:23.44832Z",
            "updated_at": "2025-03-27T02:02:09.806007Z",
            "deleted_at": null,
            "main_name": "Careto",
            "aliases": [
                "Careto",
                "The Mask",
                "Ugly Face"
            ],
            "source_name": "ETDA:Careto",
            "tools": [
                "Careto"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716494,
    "ts_updated_at": 1743041125,
    "ts_creation_date": 1500368297,
    "ts_modification_date": 1500368297,
    "files": {
        "pdf": "https://archive.orkl.eu/576d1f3a8cc11502f54fd86fd4a1d22dd47b176a.pdf",
        "text": "https://archive.orkl.eu/576d1f3a8cc11502f54fd86fd4a1d22dd47b176a.txt",
        "img": "https://archive.orkl.eu/576d1f3a8cc11502f54fd86fd4a1d22dd47b176a.jpg"
    }
}