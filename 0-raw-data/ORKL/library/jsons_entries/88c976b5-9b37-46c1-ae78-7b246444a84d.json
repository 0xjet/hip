{
    "id": "88c976b5-9b37-46c1-ae78-7b246444a84d",
    "created_at": "2023-01-12T14:59:56.779784Z",
    "updated_at": "2025-03-27T02:09:07.935574Z",
    "deleted_at": null,
    "sha1_hash": "f7e0c9dbf84c98461b3408a827a59e42afc46230",
    "title": "2021-03-05 - QNAP NAS users, make sure you check your system",
    "authors": "",
    "file_creation_date": "2022-05-28T15:24:59Z",
    "file_modification_date": "2022-05-28T15:24:59Z",
    "file_size": 355763,
    "plain_text": "# QNAP NAS users, make sure you check your system\n\n**[blog.netlab.360.com/qnap-nas-users-make-sure-you-check-your-system/](https://blog.netlab.360.com/qnap-nas-users-make-sure-you-check-your-system/)**\n\nMa Yanlong March 5, 2021\n\n5 March 2021 / [QNAP](https://blog.netlab.360.com/tag/qnap/)\n\n## Background\n\nOn March 2, 2021, 360Netlab Threat Detection System started to report attacks targeting the\nwidely used QNAP NAS devices via the unauthorized remote command execution\n[vulnerability (CVE-2020-2506 & CVE-2020-2507)[1], upon successful attack, the attacker will](https://www.qnap.com.cn/en/security-advisory/qsa-20-08)\ngain root privilege on the device and perform malicious mining activities.\n\nDue to the possible big impact, we contacted and informed the vendor on March 3, and\ndecided to share some information with this quick blog.\n\nNote 1, there is currently no public available PoC for CVE-2020-2506 & CVE-2020-2507,\nalso according to the vendor’s request, we are not disclosing the technical details of the\nvulnerability in order to protect QNAP NAS users, we speculate that there are still hundreds\nof thousands of online QNAP NAS devices with the vulnerability.\n\nWe named the mining program UnityMiner, we noticed the attacker customized the program\nby hiding the mining process and the real CPU memory resource usage information, so\nwhen the QNAP users check the system usage via the WEB management interface, they\ncannot see the abnormal system behavior.\n\n[Previously We have disclosed another QNAP NAS in-the-wild vulnerability attack here[2].](https://blog.netlab.360.com/in-the-wild-qnap-nas-attacks/)\n\n## Vulnerability impact\n\nOur 360 FirmwareTotal system shows that the following models are affected by the\nvulnerabilities. The QNAP NAS installed Helpdesk app prior to August 2020 is affected. The\nfollowing is the list of known models that could be vulnerable.\n\n\n-----\n\n```\nTVS X73\nTVS-X71U\nTVS-X71\nTVS-X63\nTS-XA82\nTS-XA73\nTS-XA28A\nTS-X89U\nTS-X88\nTS-X85U\nTS-X85\nTS-X83XU\nTS-X82U\nTS-X82S\nTS-X82\nTS-X80U\nTS-X80\nTS-X77U\nTS-X77\nTS-X73U\nTS-X72U\nTS-X72\nTS-X63U\nTS-X53U\nTS-X53S\nTS-X53D\nTS-X53BU\nTS-X53B\nTS-X53A\nTS-X53\nTS-X51U\nTS-X51DU\nTS-X51B\nTS-X51A\nTS-X51\nTS-X35A\nTS-X28A\nTS-KVM\nTS-879U\nTS-879\nTS-870U\nTS-870\nTS-869U\nTS-869\nTS-859U\nTS-859\nTS-809U\nTS-809\nTS-670\nTS-669\nTS-659\nTS-639\nTS-569\nTS-559\nTS-509\n\n```\n\n-----\n\n```\nTS 470\nTS-469U\nTS-469\nTS-459U\nTS-459\nTS-439U\nTS-439PROII\nTS-439\nTS-421U\nTS-421\nTS-420U\nTS-420\nTS-419U\nTS-419P\nTS-412U\nTS-412\nTS-410\nTS-269\nTS-259\nTS-239PROII\nTS-239H\nTS-239\nTS-221\nTS-220\nTS-219\nTS-212\nTS-210\nTS-1679U\nTS-1279U\nTS-1270U\nTS-1269U\nTS-121\nTS-120\nTS-119\nTS-112\nTS-110\nTS-1079\nSS-839\nSS-439\nSS-2479U\nSS-1879U\nSS-1279U\nQGD-1600\nMustang-200\nIS-400\nHS-251\nHS-210\n\n```\nAnd the following is the Geo breakdown of the devices online by using the 360 Quake\ncyberspace mapping system, all togetherthere are 4,297,426 QNAP NAS, with 951,486\nunique IPs.\n\n\n-----\n\n## Brief analysis of the mining kit\n\n**1. Overview**\n\nThe mining program consists of `unity_install.sh and` `Quick.tar.gz .`\n```\nunity_install.sh is used to download & set up & start the mining program and hijack the\nmanaRequest.cgi program in the original device;\nQuick.tar.gz contains the miner program, the miner configuration file, the miner startup\n\n```\nscript and the forged `manaRequest.cgi .`\n\nUnity is the XMRig miner program\n```\nQuick\n├── config.json\n├── manaRequest.cgi\n├── start.sh\n└── unity\n\n```\n**2. unity_install.sh**\n\n**Core functions：**\n\nCheck if unity process exists, kill if it exists\nCheck the CPU architecture of the device and download the mining kit for the\ncorresponding architecture, currently it only supports ARM64 and AMD64\nSet the mining parameters in `config.json based on the number of CPU cores, the`\nprogram makes sure it only uses half of the cores for mining.\nUnpack the mining program, set cron and execute the mining script start.sh (once\nevery minute, time interval is set directly to `* * * * * * )`\n\n**3. start.sh**\n\n**Core function：**\n\n\n-----\n\nChecking for unity process and starting it if it does not exist.\nRename the system file `/home/httpd/cgi-bin/management/manaRequest.cgi to`\n```\n   manaRequests.cgi (this file is responsible for viewing and modifying the system\n\n```\ninformation of the device)\nCopy the `manaRequest.cgi file from` `Quick.tar.gz to the` `/home/httpd/cgi-`\n```\n   bin/management/ directory, replacing the system's own file with the same name.\n\n```\n**4. config.json**\n\nThe group uses its own Pool(Proxy), so the real XMR Wallet cannot be seen. There are 3\ngroups of mining configurations, user are \"xmr2\", pass are \"x\", Pool(Proxy) are as follows.\n```\naquamangts.tk:12933\na.aquamangts.tk:12933\nb.aquamangts.tk:12933\n\n```\n**5. manaRequest.cgi**\n\n**Core function：**\n\nHijack the system's original file of the same name, after receiving HTTP requests, first\ndetect whether there is a unity mining process in the system, if not, then directly\ntransfer the HTTP request to the system's original file of the same name (has been\nrenamed to `manaRequests.cgi ) to process, and then end the execution of.`\n```\ncount=`ps -fe | grep unity | grep -v \"grep\"`\nif [ \"\" == \"$count\" ];then\n  /home/httpd/cgi-bin/management/manaRequests.cgi\n  exit 0\nfi\n\n```\nIf the unity mining process exists on the system, after forwarding the HTTP request to\nthe system's original file of the same name for execution, log the results of the\nexecution (to the `.log.log file) and then tamper with the execution results by`\n\n1. Subtract 50 from the CPU status data\n2. Delete the unity process information from the execution result\n\nSo when the user suspects something going on with the device and checks the usage, he\nwill see pretty normal CPU usage and tempc, and all the system processes will look normal.\n\n## Suggestions\n\nQNAP NAS users should check and update their firmware promptly.\n\nWe recommend that readers monitor and block relevant IPs and URLs mentioned in this\nblog.\n\n## Contact us\n\n\n-----\n\n[Readers are always welcomed to reach us on twitter, or email to netlab at 360](https://twitter.com/360Netlab)\ndot cn.\n\n## IoC\n\nIP:\n```\n210.201.136.170    Taiwan        ASN9311        HITRON\nTECHNOLOGY INC.\n\n```\nMiner Proxy:\n```\naquamangts.tk:12933\na.aquamangts.tk:12933\nb.aquamangts.tk:12933\n\n```\nURL:\n```\nhttp://c.aquamangts.tk:8080/QFS/install/unity_install.sh\nhttp://c.aquamangts.tk:8080/QFS/arm64/Quick.tar.gz\nhttp://c.aquamangts.tk:8080/QFS/amd64/Quick.tar.gz\n\n```\nMD5:\n```\n0f40086c9e96c9c11232a9175b26c644\n1eb01a23a122d077540f83b005abdbfc\n97015323b4fd840a40a9d40d2ad4e7af\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-03-05 - QNAP NAS users, make sure you check your system.pdf"
    ],
    "report_names": [
        "2021-03-05 - QNAP NAS users, make sure you check your system.pdf"
    ],
    "threat_actors": [
        {
            "id": "eb3f4e4d-2573-494d-9739-1be5141cf7b2",
            "created_at": "2022-10-25T16:07:24.471018Z",
            "updated_at": "2025-03-27T02:02:10.24394Z",
            "deleted_at": null,
            "main_name": "Cron",
            "aliases": [],
            "source_name": "ETDA:Cron",
            "tools": [
                "Catelites",
                "Catelites Bot",
                "CronBot",
                "TinyZBot"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535596,
    "ts_updated_at": 1743041347,
    "ts_creation_date": 1653751499,
    "ts_modification_date": 1653751499,
    "files": {
        "pdf": "https://archive.orkl.eu/f7e0c9dbf84c98461b3408a827a59e42afc46230.pdf",
        "text": "https://archive.orkl.eu/f7e0c9dbf84c98461b3408a827a59e42afc46230.txt",
        "img": "https://archive.orkl.eu/f7e0c9dbf84c98461b3408a827a59e42afc46230.jpg"
    }
}