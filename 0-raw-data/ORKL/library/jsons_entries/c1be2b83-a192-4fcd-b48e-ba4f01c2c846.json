{
    "id": "c1be2b83-a192-4fcd-b48e-ba4f01c2c846",
    "created_at": "2023-01-12T15:08:47.596448Z",
    "updated_at": "2025-03-27T02:08:41.320572Z",
    "deleted_at": null,
    "sha1_hash": "7d194ae9f4ceae2d8acd050847217fe296969dc2",
    "title": "2013-03-13 - How Theola malware uses a Chrome plugin for banking fraud",
    "authors": "",
    "file_creation_date": "2022-05-28T15:45:38Z",
    "file_modification_date": "2022-05-28T15:45:38Z",
    "file_size": 805988,
    "plain_text": "# How Theola malware uses a Chrome plugin for banking fraud\n\n**[welivesecurity.com/2013/03/13/how-theola-malware-uses-a-chrome-plugin-for-banking-fraud/](https://www.welivesecurity.com/2013/03/13/how-theola-malware-uses-a-chrome-plugin-for-banking-fraud/)**\n\nMarch 13, 2013\n\nA deep dive into Win32/Theola, one of the most malicious components of the notorious\nbootkit family, Win32/Mebroot.FX. Theola uses malicious Chrome browser plugins to steal\nmoney.\n\n13 Mar 2013 - 02:50PM\n\nA deep dive into Win32/Theola, one of the most malicious components of the notorious\nbootkit family, Win32/Mebroot.FX. Theola uses malicious Chrome browser plugins to steal\nmoney.\n\n**Win32/Theola is one of the most malicious components of the notorious bootkit**\n**family,** **[Win32/Mebroot.FX (known since 2007). The Theola family encompasses](http://www.virusradar.com/en/Win32_Mebroot/detail)**\n**malicious browser plugins installed by Mebroot for banking fraud operations.**\n\n\n-----\n\nWe have been tracking an increase in detections of these plugins since the end of January\n2013. The countries where Theola is most commonly detected are the Netherlands,\nNorway, Italy, Denmark and Czech Republic. ESET Virus Radar statistics show the regions\nmost affected by Theola infection during the last week in the map below.\n\nWin32/Mebroot.FX uses typical MBR infection techniques, with a malicious int13 handler\nused for access to the hard drive components. Malicious components are loaded in the\nfollowing order:\n\nIn this blog post I’m concentrating on the analysis of malicious browser plugins and on\nanswering the question of how money is stolen from a user’s infected machine.\n\n## Chrome plugin\n\nWin32/Theola.F is a Google Chrome plugin based on the NPAPI interface (Netscape Plugin\nApplication Programming Interface). The malicious plugin has a native module and is\n[packed by CRX format (CRX Package Format). The CRX container contains the following](http://developer.chrome.com/extensions/crx.html)\n[manifest file with the permissions shown:](http://developer.chrome.com/extensions/manifest.html)\n\nThe most interesting string in the manifest is “permissions”, describing the activity allowed\nfor this plugin. This set of permissions is enough to allow fraudulent, malicious operations.\nWin32/Theola loads in the Google Chrome browser like this:\n\n\n-----\n\nAfter deobfuscation the first JavaScript method loads the native module as default-plugin for\nGoogle Chrome:\n\nThis JavaScript module modifies the POST tracking method for all web forms on the loaded\nweb page. And by making password input fields visible this method makes (for the attacker)\na useful combination with the embedded video recording functionality described below.\n\nThe plugin loaded in the browser extensions panel looks like this:\n\n\n-----\n\nThe routine NP_GetEntryPoints() calls the plugin load process and gets the pointers to\nother functions needed for working with the plugin within the browser. The decompiled code\nof NP_GetEntryPoints() is presented here, with the Theola plugin interface:\n\nThe image directly below shows the the reconstructed virtual method table (vtable) as seen\nin Win32/Theola’s main functionality. Theola has video recording functionality based on the\nopen source x264 library for recording video in MPEG format.\n\n\n-----\n\nWhen the plugin has already started up the function addListners() loads the JavaScript\ncode for tracking web activity on the infected machine.\n\nThe JavaScript code for manipulating URLs is presented here:\n\n\n-----\n\nThe method beforeNavigate() in the native module is presented here:\n\n\n-----\n\nIf activity is detected on the banking web page, then Win32/Theola sends all sensitive\ninformation (passwords, credit card numbers and etc) to the special named pipe. The name\nof the pipe is generated by the following algorithm:\n\n\n-----\n\nAll communications with the kernel-mode module and other user-mode modules are\nimplemented with special named pipe handlers in the plugin. Each handler is responsible\nfor the execution of specified type of events in the execution process.\n\n## Conclusion\n\nGoogle Chrome is one of the most popular browsers in the world and its popularity\namong malware developers is also growing. Win32/Theola provides its malicious module as\na Chrome plugin: this is more difficult to detect because the plugin uses only documented\nAPI methods for controlling web activity. This documented API is adequate for\nmanipulating sensitive data submitted into web forms. Much banking malware uses usermode hooks for intercepting network activity, but Win32/Theola uses documented and\nlegitimate methods just as effectively and by doing so is better able to bypass detection by\nsecurity software.\n\n_Special thanks to my colleague Anton Cherepanov_\n\n\n-----\n\n**Aleksandr Matrosov, Security Intelligence Team Lead**\n\n**SHA1 hashes for analyzed samples:**\nWin32/Theola.F (CRX plugin): 0a74c1897a8a3a56cbc4bd433e100e63f448c136\nWin32/Theola.D (dll module): 5591d013f38f64f2695366ff4cb4727c94a266e9\n\n13 Mar 2013 - 02:50PM\n\n## Sign up to receive an email update whenever a new article is published in our Ukraine Crisis – Digital Security Resource Center\n\n Newsletter\n\n Discussion\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2013/2013-03-13 - How Theola malware uses a Chrome plugin for banking fraud.pdf"
    ],
    "report_names": [
        "2013-03-13 - How Theola malware uses a Chrome plugin for banking fraud.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536127,
    "ts_updated_at": 1743041321,
    "ts_creation_date": 1653752738,
    "ts_modification_date": 1653752738,
    "files": {
        "pdf": "https://archive.orkl.eu/7d194ae9f4ceae2d8acd050847217fe296969dc2.pdf",
        "text": "https://archive.orkl.eu/7d194ae9f4ceae2d8acd050847217fe296969dc2.txt",
        "img": "https://archive.orkl.eu/7d194ae9f4ceae2d8acd050847217fe296969dc2.jpg"
    }
}