{
    "id": "7db4cbf6-b7fa-45b0-aa73-2e352af8d402",
    "created_at": "2023-01-12T15:08:55.343585Z",
    "updated_at": "2025-03-27T02:05:26.64367Z",
    "deleted_at": null,
    "sha1_hash": "f167c5143cdee7f5a269885a9f9f3da492eb4756",
    "title": "2020-08-19 - Chantay‚Äôs Resume- Investigating a CV-Themed ZLoader Malware",
    "authors": "",
    "file_creation_date": "2022-05-27T23:02:24Z",
    "file_modification_date": "2022-05-27T23:02:24Z",
    "file_size": 708727,
    "plain_text": "# Chantay‚Äôs Resume: Investigating a CV-Themed ZLoader Malware Campaign\n\n**[securityliterate.com/chantays-resume-investigating-a-cv-themed-zloader-malware-campaign/](https://securityliterate.com/chantays-resume-investigating-a-cv-themed-zloader-malware-campaign/)**\n\nAugust 19, 2020\n\nOne beautiful and sunny evening, I happened to be poking around VirusTotal ‚Äì because\nthat‚Äôs what I do with sunny evenings ‚Äì and I happened to come across an interesting CVthemed document. It was an Excel document entitled ‚ÄúChantay‚Äôs Resume.xlsm‚Äù. This caught\nmy eye mostly because resume‚Äôs should almost never be in Excel format. Unless you are\napplying for an accountant role, perhaps ‚Äì I‚Äôm not sure what those people do.\n\nI decided to poke around at this file a bit:\n\n\n-----\n\nUpon opening this document in Excel, I received a helpful message from the job applicant.\nGood thing Chantay provided instructions for his resume file, otherwise I wouldn‚Äôt be able to\nsee his prior work experience and educational credentials somewhere embedded in this CV.\n\nI pressed the Enable Macros button at the top, as Chantay nicely instructed, and I received\nthis popup error message:\n\nIt looks as if Chantay‚Äôs resume attempts to download a DLL file from the Internet and then\nexecutes it . However, my malware analysis virtual machine is not connected to the Internet,\nso this process failed. Capturing this download request in a web proxy, such as Fiddler,\nproved this to be correct:\n\nA connection attempt was made to ‚Äúhxxp://205.185.125[.]104/7kWZLZ‚Äù. This URL is likely\nhosting Chantay‚Äôs malicious DLL.\n\nI also captured this activity in ProcMon (ProcessMonitor). Let‚Äôs inspect this activity:\n\n\n-----\n\nIt seems that Excel is attempting to download this DLL from 205.185.125.104, write the file\n(WriteFile) to a directory in my C: drive, and then load the file using rundll32.exe\n(ProcessCreate). This is a fairly common method of downloading and executing a payload\nfrom the Internet.\n\nHow is Excel doing all this, you may ask? I have no idea. There appears to be no VBA macro\ncode in this document, nor p-code, or any other sneaky ways of obfuscating code in Office\ndocuments. But let‚Äôs dig a bit deeper.\n\nThe objects within this Excel document, like many Office documents, can be extracted simply\nby using a Zip utility such as 7zip. I used 7zip to extract all the embedded objects and one\nitem specifically stood out:\n\n‚Äúsheet1.xml‚Äù is 481kb, which is a substantial size given that this Excel document appears to\nonly have one page of text and not much else. Inspecting this file a bit more revealed some\ncode, which is likely hidden in the Excel spreadsheet itself:\n\n\n-----\n\nWhat we know now is that there is hidden code in this document somewhere, we are just not\nsure where. [Olevba, my go-to tool for Microsoft Office document analysis, displays the](https://github.com/decalage2/oletools/wiki/olevba)\nfollowing:\n\nSo we know that this is an OpenXML formatted document and it contains no typical VBA\nmacros. Let‚Äôs open Excel back up and see if we can find the hidden code.\n\nIf we navigate to the ‚ÄúFormulas‚Äù menu in Excel, there is an option for ‚ÄúName Manager‚Äù. The\nName Manager holds information relating to MS Excel formulas. I suspect this document is\nutilizing formulas for code execution, since this is what we observed when inspecting the\nXML files above. Name Manger will allow us to see the values of these formulas.\n\nThe Name Manager definitely contains some interesting strings worth investigating:\n\nWe can see a file path to a DLL, several Windows API functions (CreateDirectoryA,\nDownload File, ‚Ä¶), and a URL. Finally, there is an Auto_Open function. This function will\nexecute when Excel is opened on the victim machine and after macros are enabled. We can\njump to this location in the Excel workbook by double-clicking this Auto_Open entry in the\nlist.\n\n\n-----\n\nThese functions are obfuscated ‚Äì Excel needs to ‚Äúcalculate‚Äù these values before they can be\nseen in cleartext. When this Excel document is opened by a victim, the formulas will be\ncalculated and the malicious code will execute.\n\nLuckily for us, the built-in Excel debugger can be utilized to inspect this code. We can do this\nby right-clicking an interesting cell, selecting ‚ÄúRun‚Äù, and then ‚ÄúStep Into‚Äù, which will allow us\nto step into the formula and inspect its output:\n\nAfter stepping though some of the code, we can see interesting strings such as a file being\ndownloaded and saved to the C: drive as a DLL file.\n\nTo save time, and because I‚Äôm such as nice guy, I de-obfuscated the code for you, using the\nmethods I outlined earlier. This Excel document:\n\n1. Loads kernel32.dll and invokes CreateDirectoryA to create a new directory under the\n\nC: drive in format C:<random>\\<random>.\n2. Loads URLMON.dll and invokes DownloadToFileA to download the payload DLL file\n\nfrom hxxp://205.185.125[.]104/kWZLZ.\n3. Starts rundll32.exe to execute the downloaded DLL.\n\nLet‚Äôs grab this DLL from the web server and look into it a bit further.\n\n\n-----\n\nBullocks. We are presented with a ‚Äúdefault campaign not found‚Äù message, and the payloads\nappear to be no longer hosted here. Unfortunately, we won‚Äôt be able to grab this payload in\nthis manner.\n\nI turned instead to my friend VirusTotal. A brief search on VirusTotal shows that there are (or\nwere, at one point) several DLL files hosted on this IP address:\n\nIn addition, there appears to be many other ‚Äúresume‚Äù files that point to this same IP, including\n‚ÄúYing Rume.xlsm‚Äù, ‚ÄúRose Carron CV.doc‚Äù, ‚ÄúFederico CV.xls‚Äù, among others:\n\n\n-----\n\nCircling back to the DLL files, let‚Äôs inspect a few of these. Many of these DLL‚ÄôS have\ninteresting properties. Let‚Äôs choose one that looks interesting:\n\nThis DLL is called ‚ÄúGoogle ipdate‚Äù, a very legitimate-sounding DLL file, likely straight from\nGoogle.\n\nLet‚Äôs take a look at the static properties of this DLL file:\n\n\n-----\n\nA few interesting things about this sample are that it is coded in Borland Delphi, which is a bit\nstrange for a DLL file. Also, as we already saw previously, we have the classic ‚ÄúGoogle Inc.‚Äù\nand ‚ÄúGoogle ipdate‚Äù meta data.\n\nThe original DLL being dropped and executed by the resume Excel document was executed\nwith the parameter of ‚ÄúDllRegisterServer‚Äù. I know this because I saw this in the ProcMon\noutput. So, to execute this DLL file in, say, x64dbg, we can run it with the command:\n```\nrundll32.exe <dll_file.dll>,DllRegisterServer\n\n```\n\n-----\n\nAfter about 1 minute of execution time, msiexec.exe is spawned.\n\nIf we attach to the new MSI process in x64dbg and dump its process memory, we can better\nunderstand what malware family this sample resides in. Strings are a good place to start with\nthis. We are able to see here some interesting URL strings in memory:\n\nLeveraging Fiddler (or any other web proxy), I was able to confirm that this malware sample\nis attempting to contact the URLs I saw in memory.\n\n\n-----\n\nThese are likely C2 addresses. After a bit of research on the format of these URLs, there\nappears to be one malware family that is notorious for using a URI of ‚Äúpost.php‚Äù. Dum dum\ndum‚Ä¶ Zloader.\n\n[ZLoader is a form of Downloader malware that establishes a connection with one or multiple](https://www.proofpoint.com/us/blog/threat-insight/zloader-loads-again-new-zloader-variant-returns)\nC2‚Äôs, and then attempts to drop additional modules, implants, and other malware. So, it\nseems that at least one of the DLL‚Äôs being delivered in this campaign is ZLoader. Below, we\ncan see part of this infrastructure, mapped out in VirusTotal:\n\n\n-----\n\n## Summary\n\nWell, there you have it. To summarize, Chantay‚Äôs nice resume utilizes hidden XLM macros in\norder to download and execute a DLL payload. The DLL payload, in my case, was a ZLoader\nvariant. Very tricky, Chantay. Hope you at least got that job you were applying for.\n\n_Key takeaways: Be careful with resume files sent directly to you, and even more careful if_\n_they are in a non-standard format. Resume‚Äôs should almost always be in .doc, .docx, .rtf, or_\n_possible .pdf‚Ä¶ But almost never in .xls/.xlsx fromat üôÇ_\n\n[As always, thanks for reading! If you enjoyed this post, follow me on Twitter (@d4rksystem).](https://twitter.com/d4rksystem)\n\n## Malware Samples Used\n\n**Resume document**\n```\nb87f733efc95172621e267293ea60c41758ddcd9e005028df22af7e0a199cca8\n\n```\n**DLL File**\n```\nd36366666b407fe5527b96696377ee7ba9b609c8ef4561fa76af218ddd764dec\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-08-19 - Chantay‚Äôs Resume- Investigating a CV-Themed ZLoader Malware.pdf"
    ],
    "report_names": [
        "2020-08-19 - Chantay‚Äôs Resume- Investigating a CV-Themed ZLoader Malware.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536135,
    "ts_updated_at": 1743041126,
    "ts_creation_date": 1653692544,
    "ts_modification_date": 1653692544,
    "files": {
        "pdf": "https://archive.orkl.eu/f167c5143cdee7f5a269885a9f9f3da492eb4756.pdf",
        "text": "https://archive.orkl.eu/f167c5143cdee7f5a269885a9f9f3da492eb4756.txt",
        "img": "https://archive.orkl.eu/f167c5143cdee7f5a269885a9f9f3da492eb4756.jpg"
    }
}