{
    "id": "bf634b80-42d3-4a8b-bef1-64003da05193",
    "created_at": "2023-01-12T15:00:07.802727Z",
    "updated_at": "2025-03-27T02:05:41.281406Z",
    "deleted_at": null,
    "sha1_hash": "6eb73da3f647a8627d1ee17a7c86430cc22916c3",
    "title": "2020-01-21 - sLoad launches version 2.0, Starslord",
    "authors": "",
    "file_creation_date": "2022-05-28T22:03:04Z",
    "file_modification_date": "2022-05-28T22:03:04Z",
    "file_size": 647844,
    "plain_text": "# sLoad launches version 2.0, Starslord\n\n**[microsoft.com/security/blog/2020/01/21/sload-launches-version-2-0-starslord/](https://www.microsoft.com/security/blog/2020/01/21/sload-launches-version-2-0-starslord/)**\n\nJanuary 21, 2020\n\nsLoad, the PowerShell-based Trojan downloader notable for its almost exclusive use of the\nBackground Intelligent Transfer Service (BITS) for malicious activities, has launched version\n[2.0. The new version comes on the heels of a comprehensive blog we published detailing](https://www.microsoft.com/security/blog/2019/12/12/multi-stage-downloader-trojan-sload-abuses-bits-almost-exclusively-for-malicious-activities/)\nthe malware’s multi-stage nature and use of BITS as alternative protocol for data exfiltration\nand other behaviors.\n\nWith the new version, sLoad has added the ability to track the stage of infection on every\naffected machine. Version 2.0 also packs an anti-analysis trick that could identify and isolate\nanalyst machines vis-à-vis actual infected machines.\n\nWe’re calling the new version “Starslord” based on strings in the malware code, which has\nclues indicating that the name “sLoad” may have been derived from a popular comic book\nsuperhero.\n\nWe discovered the new sLoad version over the holidays, in our continuous monitoring of the\nmalware. New sLoad campaigns that use version 2.0 follow an attack chain similar to the\nprevious version, with some updates, including dropping the dynamic list of command-andcontrol (C2) servers and upload of screenshots.\n\n\n-----\n\n## Tracking the stage of infection\n\nWith the ability to track the stage of infection, malware operators with access to the Starslord\nbackend could build a detailed view of infections across affected machines and segregate\nthese machines into different groups.\n\nThe tracking mechanism exists in the final-stage, which, as with the old version, loops\ninfinitely (with sleep interval of 2400 seconds, higher than the 1200 seconds in version 1.0).\nIn line with the previous version, at every iteration of the final stage, the malware uses a\ndownload BITS job to exfiltrate stolen system information and receive additional payloads\nfrom the active C2 server.\n\nAs we noted in our previous blog, creating a BITS job with an extremely large RemoteURL\nparameter that includes non-encrypted system information, as the old sLoad version did,\nstands out and is relatively easy to detect. However, with Starslord, the system information is\nencoded into Base64 data before being exfiltrated.\n\n\n-----\n\nThe file received by Starslord in response to the exfiltration BITS job contains a tuple of three\nvalues separated by an asterisk (*):\n\nValue #1 is a URL to download additional payload using a download BITS job\nValue #2 specifies the action, which can be any of the following, to be taken on the\npayload downloaded from the URL in value#1:\n\n“eval” – Run (possibly very large) PowerShell scripts\n“iex” – Load and invoke (possibly small) PowerShell code\n“run” – Download encoded PE file, decode using exe, and run the decoded\nexecutable\nValue #3 is an integer that can signify the stage of infection for the machine\n\nSupplying the payload URL as part of value #1 allows the malware infrastructure to house\nadditional payloads on different servers from the active C2 servers responding to the\nexfiltration BITS jobs.\n\nValue#3 is the most noteworthy component in this setup. If the final stage succeeds in\ndownloading additional payload using the URL provided in value #1 and executing it as\nspecified by the command in value #2, then a variable is used to form the string\n_“td”:”<value#3>”,”tds”:”3”. However, if the final stage fails to download and execute the_\npayload, then the string formed is “td”:”<value #3>”,”tds”:”4”.\n\n\n-----\n\nThe infinite loop ensures that the exfiltration BITS jobs are created at a fixed interval. The\nbackend infrastructure can then pick up the pulse from each infected machine. However,\nunlike the previous version, Starslord includes the said string in succeeding iterations of data\nexfiltration. This means that the malware infrastructure is always aware of the exact stage of\nthe infection for a specific affected machine. In addition, since the numeric value for value #3\nin the tuple is always governed by the malware infrastructure, malware operators can\ncompartmentalize infected hosts and could potentially set off individual groups on unique\ninfection paths. For example, when responding to exfiltration BITS jobs, malware operators\ncan specify a different URL (value #1) and action (value #2) for each numeric value for value\n#3 of the tuple, essentially deploying a different malware payload for different groups.\n\n## Anti-analysis trap\n\nStarslord comes built-in with a function named checkUniverse, which is in-fact an antianalysis trap.\n\nAs mentioned in our previous blog post, the final stage of sLoad is a piece of PowerShell\ncode obtained by decoding one of the dropped .ini files. The PowerShell code appears in the\nmemory as a value assigned to a variable that is then executed using the Invoke-Expression\n\n\n-----\n\ncmdlet. Because this is a huge piece of decrypted PowerShell code that never hits the disk,\nsecurity researchers would typically dump it into a file on the disk for further analysis.\n\nThe sLoad dropper PowerShell script drops four files:\n\na randomly named .tmp file\na randomly named .ps1 file\na ini file\na ini file\n\nIt then creates a scheduled task to run the .tmp file every 3 minutes, similar to the previous\nversion. The .tmp file is a proxy that does nothing but run the .ps1 file, which decrypts the\ncontents of main.ini into the final stage. The final stage then decrypts contents of domain.ini\nto obtain active C2 and perform other activities as documented.\n\nAs a unique anti-analysis trap, Starslord ensures that the .tmp and.ps1 files have the same\nrandom name. When an analyst dumps the decrypted code of the final stage into a file in the\nsame folder as the .tmp and .ps1 files, the analyst could end up naming it something other\nthan the original random name. When this dumped code is run from such differently named\nfile on the disk, a function named checkUniverse returns the value 1, and the analyst gets\ntrapped:\n\nWhat comes next is not very desirable for a security researcher: being profiled by the\nmalware operator.\n\nIf the host belongs to a trapped analyst, the file downloaded from the backend in response to\nthe exfiltration BITS job, if any, is discarded and overwritten by the following new tuple:\n\n_hxxps://<active C2>/doc/updx2401.jpg*eval*-1_\n\nIn this case, the value #1 of the tuple is a URL that’s known to the backend for being\nassociated with trapped hosts. BITS jobs from trapped hosts don’t always get a response. If\nthey do, it’s a copy of the dropper PowerShell script. This could be to create an illusion that\n\n\n-----\n\nthe framework is being updated as the URL in value #1 of the tuple suggests (hxxps://<active\n_C2>/doc/updx2401.jpg)._\n\nHowever, the string that is included in all successive exfiltration BITS jobs from such host is\n_“td”:”-1”,”tds”:”3”, eventually leading to all such hosts getting grouped under value “td”:”-1”._\nThis forms the group of all trapped machines that are never delivered a payload. For the rest,\nso far, evidence suggests that it has been delivering the file infector Ramnit intermittently.\n\n## Durable protection against evolving malware\n\nsLoad’s multi-stage attack chain, use of mutated intermediate scripts and BITS as an\nalternative protocol, and its polymorphic nature in general make it a piece malware that can\nbe quite tricky to detect. Now, it has evolved into a new and polished version Starlord, which\nretains sLoads most basic capabilities but does away with spyware capabilities in favor of\nnew and more powerful features, posing even higher risk.\n\nStarslord can track and group affected machines based on the stage of infection, which can\nallow for unique infection paths. Interestingly, given the distinct reference to a fictional\nsuperhero, these groups can be thought of as universes in a multiverse. In fact, the malware\nuses a function called checkUniverse to determine if a host is an analyst machine.\n\n[Microsoft Threat Protection defends customers from sophisticated and continuously evolving](https://www.microsoft.com/en-us/security/technology/threat-protection)\nthreats like sLoad using multiple industry-leading security technologies that protect various\nattack surfaces. Through signal-sharing across multiple Microsoft services, Microsoft Threat\nProtection delivers comprehensive protection for identities, endpoints, data, apps, and\ninfrastructure.\n\nOn endpoints, [behavioral blocking and containment capabilities in Microsoft Defender](https://www.microsoft.com/security/blog/2019/10/08/in-hot-pursuit-of-elusive-threats-ai-driven-behavior-based-blocking-stops-attacks-in-their-tracks/)\n[Advanced Threat Protection (Microsoft Defender ATP) ensure durable protection against](https://www.microsoft.com/en-us/WindowsForBusiness/windows-atp)\nevolving threats. Through cloud-based machine learning and data science informed by threat\nresearch, Microsoft Defender ATP can spot and stop malicious behaviors from threats, both\nold and new, in real-time.\n\n**_Sujit Magar_**\n\n_Microsoft Defender ATP Research Team_\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-01-21 - sLoad launches version 2.0, Starslord.pdf"
    ],
    "report_names": [
        "2020-01-21 - sLoad launches version 2.0, Starslord.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535607,
    "ts_updated_at": 1743041141,
    "ts_creation_date": 1653775384,
    "ts_modification_date": 1653775384,
    "files": {
        "pdf": "https://archive.orkl.eu/6eb73da3f647a8627d1ee17a7c86430cc22916c3.pdf",
        "text": "https://archive.orkl.eu/6eb73da3f647a8627d1ee17a7c86430cc22916c3.txt",
        "img": "https://archive.orkl.eu/6eb73da3f647a8627d1ee17a7c86430cc22916c3.jpg"
    }
}