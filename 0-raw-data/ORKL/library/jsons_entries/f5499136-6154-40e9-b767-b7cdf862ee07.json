{
    "id": "f5499136-6154-40e9-b767-b7cdf862ee07",
    "created_at": "2023-01-12T15:07:38.770007Z",
    "updated_at": "2025-03-27T02:12:13.86416Z",
    "deleted_at": null,
    "sha1_hash": "87ef51726ff2f45fcbc0f9a96470b217c8a0b9b5",
    "title": "2020-11-27 - Aggah Campaign’s Latest Tactics- Victimology, PowerPoint Dropper and Cryptocurrency Stealer",
    "authors": "",
    "file_creation_date": "2022-05-28T02:44:21Z",
    "file_modification_date": "2022-05-28T02:44:21Z",
    "file_size": 3363880,
    "plain_text": "# Recent Posts\n\n**[threatresearch.ext.hp.com/aggah-campaigns-latest-tactics-victimology-powerpoint-dropper-and-cryptocurrency-stealer/](https://threatresearch.ext.hp.com/aggah-campaigns-latest-tactics-victimology-powerpoint-dropper-and-cryptocurrency-stealer/)**\n\n[HP Threat Research Blog • Aggah Campaign’s Latest Tactics: Victimology, PowerPoint Dropper and Cryptocurrency Stealer](https://threatresearch.ext.hp.com/blog/)\n\n\nJuly 1, 2020\n\n\n## Aggah Campaign’s Latest Tactics: Victimology, PowerPoint Dropper and Cryptocurrency Stealer\n\nA notable PowerPoint malicious spam campaign we investigated recently was detected by HP Sure Click in May 2020. Its tactics,\ntechniques and procedures (TTPs) suggest that the activity is linked to threat actors behind a string of similar campaigns, known\n[collectively as the Aggah campaign. In this campaign, malicious PowerPoint Add-in files were used to deliver Agent Tesla and](https://unit42.paloaltonetworks.com/aggah-campaign-bit-ly-blogspot-and-pastebin-used-for-c2-in-large-scale-campaign/)\nPowerShell cryptocurrency-stealing malware.\n\nThe use of PowerPoint malware is significant because it’s uncommon. Of the office document malware isolated by HP Sure Click in\n2020 so far, only 1% was PowerPoint malware (Figure 1). Most (65%) of the office document malware seen in the wild uses Microsoft\nWord file formats, such as DOC, DOCX and DOCM, followed by Excel formats.\n\n[Although aspects of the May 2020 Aggah campaign have been analysed elsewhere, information about the attacker’s email infrastructure](https://yoroi.company/research/cyber-criminal-espionage-operation-insists-on-italian-manufacturing/)\nand campaign victimology is difficult to find. HP Sure Click telemetry suggests that the sectors and countries targeted by the threat actor\nbehind this latest campaign are broader than previously thought. We also analysed the differences from previous Aggah campaigns. The\nmost significant alterations found were the use of a PowerPoint-based dropper instead of Word- or Excel-based droppers, and the new\ninclusion of a PowerShell Bitcoin stealer.\n\n\n-----\n\nFigure 1 – Proportion of office document threats by type, based on HP Sure Click telemetry.\n\n**Targeting and Victimology**\n\nHP Sure Click isolated PowerPoint presentations tied to the May 2020 Aggah campaign that were named according to the regular\nexpressions below. All the files shared the same hash value (SHA-256\n7eafb57e7fc301fabb0ce3b98092860aaac47b7118804bb8d84ddb89b9ee38f3).\n\nMoglix Purchase Order \\d{6}\\.(pps|ppt)\nPO – \\d{6}\\.(pps|ppt)\nBank details\\.ppt\nPayment Details\\.pps\nNew order GLT srl_\\d{7}_\\d{2}\\.\\d{2}.\\d{4}\\.ppt\nScan emco Bautechni specifications\\.pps\n\nFigure 2 – Some of the detected samples shown in HP Sure Controller.\n\nAn analysis of the organisations that were targeted by the campaign shows that the targets belonged to six sectors, the most common\nbeing manufacturing. From HP Sure Click telemetry, the targets were located in eight countries, predominantly in Europe (Figure 3).\n\n\n-----\n\nFigure 3 – Observed Aggah campaign infrastructure and targets in May 2020.\n\nTo make the phishing emails look more legitimate, the attacker spoofed the domains of five business-to-business (B2B) companies in\nthe same or a related industry as the targets. The industries and locations of the spoofed organisations indicate that the attacker likely\nsought to target businesses instead of individuals across many sectors. The organisations that were impersonated are based in the\nfollowing countries, indicating a large geographic spread:\n\nFrance\nGermany\nUnited Arab Emirates\nIndia\n\n[Some of the recipient mail servers reported that the emails failed Sender Policy Framework (SPF) validation, meaning they detected that](https://en.wikipedia.org/wiki/Sender_Policy_Framework)\nthe sender domains in the Return-Path field were spoofed. However, in several cases the emails were still delivered to employees’\nmailboxes, which suggests that some of the target organisations had not implemented a policy of rejecting mail if it failed an SPF check.\nWe observed emails being sent from the following mail servers:\n\nhwsrv-721609.hostwindsdns[.]com (192.119.91[.]236)\nhwsrv-722288.hostwindsdns[.]com (192.119.106[.]136)\n172.241.27[.]218\n172.93.201[.]103\n172.93.201[.]113\n\n**PowerPoint Dropper – Using Errors to Run Malware**\n\nThe dropper used in this campaign was noteworthy because its execution relied on intentionally triggering a PowerPoint application error\nwhen the presentation was opened. The error caused PowerPoint to close the presentation, generating an Auto_Close event that was\nused to run a malicious Visual Basic for Applications (VBA) macro.\n\nTo achieve this, the dropper was implemented as a PowerPoint 97-2003 Add-in (.PPA) that had been renamed to use .PPS (PowerPoint\n97-2003 Slide Show) or .PPT (PowerPoint 97-2003 Presentation) file extensions. The advantage of using the PPA format is that unlike\n[other PowerPoint formats Auto Open and Auto Close VBA subroutines are available meaning an attacker can trigger the execution of](http://skp.mvps.org/autoevents.htm)\n\n\n-----\n\na malicious macro when a user opens or closes the presentation.\n\nIn this case, when the presentation is closed, a subroutine called “Page” is executed (Figure 4).\n\nFigure 4 – Auto_Close and “Page” subroutines.\n\nWhen opened, PowerPoint raises an error saying that the file cannot be read (Figure 5). Clicking the OK or Close button closes the\npresentation, causing the macro to run in the background before closing PowerPoint. Using this error as a way of running the macro was\nlikely intended by the attacker because the presentation does not contain any decoy content.\n\nFigure 5 – Error raised by PowerPoint when opening the dropper.\n\nThe VBA code used to download the next stage of malware is implemented in the “Page” subroutine (Figure 6). The subroutine is\nminimally obfuscated and does not contain any sandbox detection. When run, it creates a WScript.Shell object and then uses the Run\n[method to execute a remotely hosted VBScript loader using Mshta (T1170). Mshta is a Microsoft utility that is used to run HTML](https://attack.mitre.org/techniques/T1170/)\nApplications and interpreted languages such as VBScript and JScript. The VBScript was hosted on Pastebin\n(hxxps://pastebin[.]com/raw/Bnv7ruYp) and accessed via a URL redirect (hxxp://j[.]mp/dmdmcrcrcryctcgufyguhmd) that was created\nusing the j[.]mp URL shortening service.\n\nFigure 6 – “Page” subroutine that uses Mshta to run VBScript hosted on Pastebin.\n\n**Cryptocurrency Stealer – BitcoinClipboardMalware**\n\nA new addition to the Aggah campaign is the inclusion of a cryptocurrency stealer. This is implemented in a PowerShell script that is\ndownloaded and run after the target computer has been compromised (Figure 7). The script monitors the victim’s clipboard for Bitcoin\naddresses and replaces them with the attacker’s address in the hope that the victim inadvertently transfers Bitcoin to the attacker. The\n[script was possibly copied from a deleted GitHub project called BitcoinClipboardMalware, which matches the script used in the](https://webcache.googleusercontent.com/search?q=cache:hu92_isXojwJ:https://github.com/BlankShare/BitcoinClipboardMalware/blob/master/BitcoinClipboardMalware.ps1+&cd=1&hl=en&ct=clnk&gl=uk)\ncampaign (Figure 7). In this case, attacker’s address was 19kCcdbttTAX1mLU3Hk9S2BW5cKLFD1z1W.\n\n\n-----\n\nFigure 7 – Deobfuscated Bitcoin stealer PowerShell script.\n\nOn 18 May, 0.00311321 Bitcoin was transferred into the attacker’s address, possibly from a victim. Fortunately, the amount transferred\nwas small, worth approximately $28 USD. Since Bitcoin transactions are public, it is possible to trace this transaction back to a\ncryptocurrency exchange. On 16 June, the balance in the attacker’s wallet [transferred to another Bitcoin address](https://www.walletexplorer.com/txid/523ab4ebf16052f730b85ab1495183a8488a0f2e090f6d9d9db07d81fc9a9197)\n(1PGRpP14sSBER6x2choH31wkML1hXqykNj), likely an intermediary wallet (Figure 8).\n\nFigure 8 – Transfer of the Bitcoin from the attacker’s wallet to an intermediary address.\n\n[On 17 June, the balance was transferred to a Bitcoin address associated with Binance (1NDyJtNTjmwk5xPNhjgAMu4HDHigtobu1s), a](https://twitter.com/binance/status/961666467325358081)\ncryptocurrency exchange that allows users to buy and sell cryptocurrencies (Figure 9).\n\n\n-----\n\nFigure 9 – Transaction showing a transfer of Bitcoin to an address associated with Binance.\n\n**Conclusion**\n\n[Since first being documented in 2019, Aggah has undergone several changes while still maintaining some consistent TTPs, such as a](https://unit42.paloaltonetworks.com/aggah-campaign-bit-ly-blogspot-and-pastebin-used-for-c2-in-large-scale-campaign/)\npreference for hosting scripts and payloads on Pastebin, obfuscating URLs using URL shortening services, and using Mshta.exe for\ncode execution. The move to a PowerPoint dropper and the inclusion of a Bitcoin stealer is another evolution of Aggah. In this latest\ncampaign, the attacker chose to impersonate B2B companies in Europe, the Middle East and Asia which suggests they did not intend to\ncompromise organisations in a specific region. The sectors and locations of the victims also indicates that the attacker sought to\ncompromise businesses in a variety of industries from manufacturing to agriculture.\n\n**Indicators of Compromise**\n\n**Indicator** **SHA-256 Hash** **Purpose**\n\n\nPowerPoint attachment (PPS and PPT file\nextensions)\n\n\n7eafb57e7fc301fabb0ce3b98092860aaac47b7118804bb8d84ddb89b9ee38f3 Dropper\n\n\nhxxp://j[.]mp/dmdmcrcrcryctcgufyguhmd URL\nredirect\nleading\nto\nVBScript\nloader\n\nhxxps://pastebin[.]com/raw/Bnv7ruYp VBScript\nloader\n\n19kCcdbttTAX1mLU3Hk9S2BW5cKLFD1z1W Aggah\nBitcoin\naddress\n\n\nhwsrv-721609.hostwindsdns[.]com\n(192.119.91[.]236)\n\n\nAggah\nmail\nserver\n\n\n-----\n\nhwsrv-722288.hostwindsdns[.]com\n(192.119.106[.]136)\n\n\nAggah\nmail\nserver\n\n\n172.241.27[.]218 Aggah\nmail\nserver\n\n172.93.201[.]103 Aggah\nmail\nserver\n\n172.93.201[.]113 Aggah\nmail\nserver\n\nTags\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-11-27 - Aggah Campaign’s Latest Tactics- Victimology, PowerPoint Dropper and Cryptocurrency Stealer.pdf"
    ],
    "report_names": [
        "2020-11-27 - Aggah Campaign’s Latest Tactics- Victimology, PowerPoint Dropper and Cryptocurrency Stealer.pdf"
    ],
    "threat_actors": [
        {
            "id": "28851008-77b4-47eb-abcd-1bb5b3f19fc2",
            "created_at": "2023-06-20T02:02:10.254614Z",
            "updated_at": "2025-03-27T02:00:03.130853Z",
            "deleted_at": null,
            "main_name": "Hagga",
            "aliases": [
                "TH-157",
                "Aggah"
            ],
            "source_name": "MISPGALAXY:Hagga",
            "tools": [
                "Agent Tesla"
            ],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "b0d34dd6-ee90-483b-bb6c-441332274160",
            "created_at": "2022-10-25T16:07:23.296754Z",
            "updated_at": "2025-03-27T02:02:09.724313Z",
            "deleted_at": null,
            "main_name": "Aggah",
            "aliases": [
                "Operation Red Deer",
                "Operation Roma225"
            ],
            "source_name": "ETDA:Aggah",
            "tools": [
                "AgenTesla",
                "Agent Tesla",
                "AgentTesla",
                "Aggah",
                "Atros2.CKPN",
                "Bladabindi",
                "Jorik",
                "Nancrat",
                "NanoCore",
                "NanoCore RAT",
                "Negasteal",
                "Origin Logger",
                "Revenge RAT",
                "RevengeRAT",
                "Revetrat",
                "Warzone",
                "Warzone RAT",
                "ZPAQ",
                "Zurten",
                "njRAT"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536058,
    "ts_updated_at": 1743041533,
    "ts_creation_date": 1653705861,
    "ts_modification_date": 1653705861,
    "files": {
        "pdf": "https://archive.orkl.eu/87ef51726ff2f45fcbc0f9a96470b217c8a0b9b5.pdf",
        "text": "https://archive.orkl.eu/87ef51726ff2f45fcbc0f9a96470b217c8a0b9b5.txt",
        "img": "https://archive.orkl.eu/87ef51726ff2f45fcbc0f9a96470b217c8a0b9b5.jpg"
    }
}