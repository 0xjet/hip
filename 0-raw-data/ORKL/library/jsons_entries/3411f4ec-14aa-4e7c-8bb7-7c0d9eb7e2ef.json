{
    "id": "3411f4ec-14aa-4e7c-8bb7-7c0d9eb7e2ef",
    "created_at": "2023-01-12T15:09:17.322504Z",
    "updated_at": "2025-03-27T02:13:58.32549Z",
    "deleted_at": null,
    "sha1_hash": "b2ef496418776d53b0976a9f53e6bdab06cd5ec1",
    "title": "2021-06-20 - From Word to Lateral Movement in 1 Hour",
    "authors": "",
    "file_creation_date": "2022-05-28T18:03:56Z",
    "file_modification_date": "2022-05-28T18:03:56Z",
    "file_size": 1328483,
    "plain_text": "# From Word to Lateral Movement in 1 Hour\n\n**[thedfirreport.com/2021/06/20/from-word-to-lateral-movement-in-1-hour/](https://thedfirreport.com/2021/06/20/from-word-to-lateral-movement-in-1-hour/)**\n\n### Introduction\n\n\nJune 20, 2021\n\n\nIn May 2021, we observed a threat actor conducting an intrusion utilizing the IcedID\npayloads for initial access. They later performed a number of techniques from host discovery\nto lateral movement, using RDP and SMB to access the file servers within an enterprise\ndomain.\n\nIcedID (known as BokBot) first observed in 2017, continues to be an active and capable\n[threat against both individuals and organizations. The IcedID malware utilizes a modular](https://www.binarydefense.com/icedid-gziploader-analysis/)\nmalware framework and incorporates a number of anti-forensic and defense evasion\ncapabilities. This malware has like others before it moved into the initial access broker\nmarket being used as an entry point for follow on activity like Cobalt Strike, and has lead to\n[multiple domain wide ransomware deployments such as Revil and](https://thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware/) [Conti.](https://thedfirreport.com/2021/05/12/conti-ransomware/)\n\n### Summary\n\nWe assess with medium confidence that the initial IcedID infection was delivered via a\nmalspam campaign, which included an attachment with a password protected zip archive.\nOnce extracted, the user would find a Word document with a macro, which upon execution,\n\n\n-----\n\nwould deliver the initial DLL loader. Discovered in 2017, what started as a commodity\nmalware, IcedID is now currently being deployed as an initial access broker by ransomware\nthreat actors.\n\nIn this case, the threat actor appeared to have specific goals, and did not waste any time.\nWithin 35 minutes after the initial infection, they made their way in to the network via a Cobalt\nStrike Beacon deployed from the IcedID infected host.\n\nThe first task of the threat actor was to enumerate the network by establishing a list of the\ndomain admins using living off the land techniques, such as net.exe. A freely available tool\nAdfind.exe was also utilized to further enumerate the domain. The threat actor was also\nobserved stealing credentials from the lsass.exe process.\n\nFive minutes after the above discovery activity, we observed the actors moving laterally to\nother hosts on the network with the credentials of a domain administrator account. In this\ncase, Cobalt Strike was also used to create the administrative token, and attempted to install\na service using a windows service executable. The service was tasked to run an encoded\nPowerShell command which would download and execute the Cobalt Strike beacon over\nHTTP.\n\nBased on the name of the hosts that the threat actors decided to pivot, we judge that they\nwere able to digest the ‘AdFind’ results and focus on, what they believed to be, important\ntargets – critical assets such as file servers, domain controllers, etc. It is also worth\nmentioning that even after the unsuccessful remote execution attempt against a few servers\ndue to AV, the actors decided to connect via RDP and spend over an hour looking for\nvaluable data before disconnecting and leaving the network.\n\nNo exfiltration of data or impact to the systems was observed but at least one command and\ncontrol. It is unclear why the actors decided not to continue with their operation. No attempt\nwas made to clean up the intrusion by the actors – artifacts that were deployed were still in\noperation, including C2 implants.\n\n### Services\n\nWe offer multiple services including a Threat Feed service which tracks Command and\nControl frameworks such as Cobalt Strike, Metasploit, Empire, PoshC2, etc. More\n[information on this service and others can be found here. The Cobalt Strike server used in](https://thedfirreport.com/services/)\nthis attack was added to our Threat Feed on 5/7/21.\n\nWe also have artifacts available from this case such as pcaps, memory captures, files, Kape\n[packages, and more, under our Security Researcher and Organization services.](https://www.patreon.com/thedfirreport)\n\n### Timeline\n\n\n-----\n\n-----\n\n[Analysis and reporting completed by @kostastsale and](https://twitter.com/Kostastsale) **[@_pete_0](https://twitter.com/_pete_0)**\n\n[Reviewed by @tas_kmanager and](https://twitter.com/tas_kmanager) [@v3t0_](https://twitter.com/v3t0_)\n\n### MITRE ATT&CK v9\n\n Initial Access\n\nThe first stage of the IcedID malware that was executed on the host was dropped via a\nmacro enabled Word document – as seen by Unit42.\n\n[2021-05-10 (Monday) – #TA551](https://twitter.com/hashtag/TA551?src=hash&ref_src=twsrc%5Etfw) [(#Shathak) pushes #IcedID](https://twitter.com/hashtag/Shathak?src=hash&ref_src=twsrc%5Etfw) [(#Bokbot) –](https://twitter.com/hashtag/Bokbot?src=hash&ref_src=twsrc%5Etfw)\n\n[List of indicators available at:https://t.co/yIz8LhFkYT](https://t.co/yIz8LhFkYT)\n\n[– includes download link for malware samples pic.twitter.com/APNK6sqYYs](https://t.co/APNK6sqYYs)\n\n[— Unit 42 (@Unit42_Intel) May 10, 2021](https://twitter.com/Unit42_Intel/status/1391860350388260871?ref_src=twsrc%5Etfw)\n\nIOCs from Brad [here.](https://github.com/pan-unit42/tweets/blob/master/2021-05-10-IOCs-for-TA551-pushing-IcedID.txt)\n\nIn our case, the [IcedID dll loader was manually executed using regsvr32.](https://tria.ge/210507-zp3p14f6le)\n\n### Persistence\n\nFrom the initial access, a scheduled task was created. This can be observed by EventID\n106: New task registered:\n\n\n-----\n\nInspection of the task file located under ‘c:\\windows\\system32\\tasks’:\n\n‘License.dat’ is an encrypted binary file and is a tell-tale indication of an IcedID compromise.\nThe corresponding DLL (upefkuin4.dll) is used with license.dat to maintain persistence using\nthe Task Scheduler. After decrypting License.dat using Binary Defense’s [decryption tool, we](https://github.com/BinaryDefense/IcedDecrypt)\ncan see some information stealing functionality:\n\n\n-----\n\nEventID 200: Task executed shows the persistent IcedID core being executed, on average\nevery 1 hour via Rundll32.exe.\n\n### Credential Access\n\nThe LSASS process was accessed by an unusual process “wuauclt.exe” on the beachhead\nhost. This was the Cobalt Strike Beacon and was used to access the credentials.\n\n\n-----\n\n```\nEventID: 10\nDescription: Process Access \nSourceImage: \"C:\\Windows\\system32\\WUAUCLT.exe\" \nTargetImage: “C:\\Windows\\system32\\lsass.exe”\nGrantedAccess: 0x1FFFFF\nCallTrace:\nC:\\Windows\\SYSTEM32\\ntdll.dll+9c584|C:\\Windows\\System32\\KERNELBASE.dll+2730e|UNKNOWN(0\n\n```\nThis is not the first time we have observed this process (wuauclt.exe) being used. In our\n[previous report with another IcedID infection leading to Sodinokibi ransomware we also](https://thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware/)\nobserved the same process being used.\n\nThe same process was also observed invoking PowerShell scripts:\n\n“Wuauclt.exe” is normally used for the Microsoft Windows Update Service and this was an\nattempt to blend into the OS environment.\n\n### Discovery\n\nDiscovery commands were run by IcedID during the initial execution on the beachhead.\nThese commands use the Microsoft Windows built-in commands and utilities, such as\nWMIC, ipconfig, etc. The aim was to determine the installed Anti-virus software, network\nconfiguration, domain configuration and user accounts. The following are the commands that\nwere executed:\n\n\n-----\n\n```\nWMIC /Node: localhost /Namespace: \\\\root \\SecurityCenter2 Path AntiVirusProduct Get \n/Format: List \nipconfig /all \nsysteminfo \nnet config workstation \nnltest /domain_trusts \nnltest /domain_trusts /all_trusts \nnet view /all /domain\nnet view /all\n\n```\nUsing the information gathered, the IcedID operator was able to focus on specific targets,\nobtaining access to the privileged accounts and the high value hosts.\n\nOnce the IcedID operators were able to establish a C2 session to the initial compromised\nhost, the operators were observed executing the following command:\n```\nnet group \"domain admins\" /DOMAIN\n\n```\nInterestingly, we observed the operator deploying and utilizing AdFind to collect information\nabout the hosts on the network. AdFind is an Active Directory query tool developed by\n[JoeWare, a useful utility for system administrators, but also popular among threat actors.](https://thedfirreport.com/2020/05/08/adfind-recon/)\n```\ncmd.exe /C C:\\Recovery\\AdFind.exe -f objectcategory=computer -csv name cn\nOperatingSystem dNSHostName > C:\\Recovery\\DOMAIN.csv\n\n```\nAdFind was transferred and executed on the beachhead host. The threat actor placed the\nAdFind binary and the results in the ‘C:\\Recovery’ folder. We assess this folder location was\nchosen to avoid raising suspicion, as compared to executing from a user or temporary folder\nlocation.\n\n### Lateral Movement\n\nThe threat actors attempted and successfully managed to pivot laterally to various hosts on\nthe domain. This was achieved by connecting via SMB and starting a service that would\nexecute an encrypted PowerShell command with embedded Cobalt Strike SMB beacons.\n\n\n-----\n\nThe PowerShell is base64 encoded. Decoding the PowerShell shows that the SMB pipe is\nnamed \\\\.\\pipe\\halfduplux_9e.\n\nUsing the ‘Administrator’ account, SMB sessions were established to the hosts, primarily\nusing ADMIN$, but IPC$ was also observed.\n\nThis activity triggered two Emerging Threat (ET) alerts related to RPC access and binary\nexecution, “ET RPC DCERPC SVCCTL – Remote Service Control Manager Access” and\n“ET POLICY SMB2 NT Create AndX Request For an Executable File”.\n\n### Command and Control\n\n**IcedID:**\n\nThroughout the intrusion the threat actor used a mix of Port 80 and 443 for C2. Port 80 was\nobserved in the communication to testsubnet[.]com which contains a HTTP Cookie in the\nformat: wordpress_<Base64EncodedString>. This activity was observed at a rate of every 24 seconds.\n\nallnezokila[.]cyou\n\n2tothepollo[.]top\n\ndaserekolut[.]top\n\n194.5.249[.]81\n\ndsedertyhuiokle[.]top\n\n5.149.252[.]179\n\n**JA3: a0e9f5d64349fb13191bc781f81f42e1**\n\n**JA3s: ec74a5c51106f0419184d0dd08fb05bc**\n\n\n-----\n\n**Certificate:** [9b:84:ff:5d:0a:27:25:f6:a3:b3:b8:83:bd:36:50:88:4b:c7:20:06 ]\n\n**Not Before:** 2021/04/28 15:18:08\n\n**Not After:** 2022/04/28 15:18:08\n\n**Issuer Org:** Internet Widgits Pty Ltd\n\n**Subject Common:** localhost\n\n**Subject Org:** Internet Widgits Pty Ltd\n\n**Public Algorithm:** rsaEncryption\n\n**Cobalt Strike:**\n\ntestsubnet.com\n\n82.117.252.32\n\n**JA3: a0e9f5d64349fb13191bc781f81f42e1**\n\n**Ja3s: ae4edc6faf64d08308082ad26be60767**\n\n**Certificate:** [92:da:38:08:d9:a0:67:2f:e5:67:2e:f0:40:d6:06:21:89:2c:54:cc ]\n\n**Not Before:** 2021/04/22 07:13:54\n\n**Not After:** 2021/07/21 07:13:54\n\n**Issuer Org:** Let’s Encrypt\n\n**Subject Common:** testsubnet.com [ns1.testsubnet.com,ns2.testsubnet.com\n,ns3.testsubnet.com,ns4.testsubnet.com,testsubnet.com ]\n\n**Public Algorithm** rsaEncryption\n\nCobalt Strike Beacon Config\n\n\n-----\n\n```\nPort 80\n{ \n  \"x64\":{\n   \"time\":1621059211662.0,\n   \"md5\":\"a30f7a3d511ddb7e2f856f6b4c9ea7be\",\n   \"config\":{ \n     \"Polling\":58302,\n     \"C2 Server\":\"testsubnet.com,\\/ky\",\n     \"Method 1\":\"GET\",\n     \"Method 2\":\"POST\",\n     \"Beacon Type\":\"0 (HTTP)\",\n     \"Jitter\":37,\n     \"Port\":80,\n     \"Spawn To x86\":\"%windir%\\\\syswow64\\\\WUAUCLT.exe\",\n     \"Spawn To x64\":\"%windir%\\\\sysnative\\\\WUAUCLT.exe\",\n     \"HTTP Method Path 2\":\"\\/ky\"\n   },\n   \"sha256\":\"1636859125648337be180f36ca54bce1f64e20d3a5d0a22ab5d0a99860e268cd\",\n   \"sha1\":\"8686f6b651ce3869bdb67f766215b5b030b75cf6\"\n  },\n  \"x86\":{\n   \"time\":1621059210330.3,\n   \"md5\":\"c86cc90291ab6807eda6dc23c53a57c7\",\n   \"config\":{\n     \"Polling\":58302,\n     \"C2 Server\":\"testsubnet.com,\\/ky\",\n     \"Method 1\":\"GET\",\n     \"Method 2\":\"POST\",\n     \"Beacon Type\":\"0 (HTTP)\",\n     \"Jitter\":37,\n     \"Port\":80,\n     \"Spawn To x86\":\"%windir%\\\\syswow64\\\\WUAUCLT.exe\",\n     \"Spawn To x64\":\"%windir%\\\\sysnative\\\\WUAUCLT.exe\",\n     \"HTTP Method Path 2\":\"\\/ky\"\n   },\n   \"sha256\":\"d1057cc0a144418ee3ae350fe1a1f70705df03d6455997751773e260568e8651\",\n   \"sha1\":\"03f57b0356467a54c4e6537fff4756cbb52a729e\"\n  }\nPort 443\n        {\n  \"x64\":{\n   \"time\":1621059212744.4,\n   \"md5\":\"95d0a4208e72b4015d7cc18e7bcffe77\",\n   \"config\":{\n     \"Polling\":58302,\n     \"C2 Server\":\"testsubnet.com,\\/ur\",\n     \"Method 1\":\"GET\",\n     \"Method 2\":\"POST\",\n     \"Beacon Type\":\"8 (HTTPS)\",\n     \"Jitter\":37,\n     \"Port\":443,\n\n```\n\n-----\n\n```\n     Spawn To x86 : %windir%\\\\syswow64\\\\WUAUCLT.exe,\n     \"Spawn To x64\":\"%windir%\\\\sysnative\\\\WUAUCLT.exe\",\n     \"HTTP Method Path 2\":\"\\/ky\"\n   },\n   \"sha256\":\"6f2a49796f4ea603bb63e31ac24579af2eacd937ecfe335ea2437745462a8d5d\",\n   \"sha1\":\"84c1e6d042a6c4fb38f2083ea1ce0591a3162aec\"\n  },\n  \"x86\":{\n   \"time\":1621059209510.8,\n   \"md5\":\"f218b1297cd3d9d567dd2e6cbc6c7afe\",\n   \"config\":{\n     \"Polling\":58302,\n     \"C2 Server\":\"testsubnet.com,\\/ur\",\n     \"Method 1\":\"GET\",\n     \"Method 2\":\"POST\",\n     \"Beacon Type\":\"8 (HTTPS)\",\n     \"Jitter\":37,\n     \"Port\":443,\n     \"Spawn To x86\":\"%windir%\\\\syswow64\\\\WUAUCLT.exe\",\n     \"Spawn To x64\":\"%windir%\\\\sysnative\\\\WUAUCLT.exe\",\n     \"HTTP Method Path 2\":\"\\/ky\"\n   },\n   \"sha256\":\"4875c6abfa0d5658ec2f6f082300380f983d9505cddd0e81627470d3d941f2e4\",\n   \"sha1\":\"9fde1a8103b7a19e617681555ecc4d27b9fb2492\"\n  }\n}\n\n```\n**Exfiltration**\n\nNo exfiltration was observed; however, we were able to determine that access to the File\nserver was achieved, with multiple access attempts and successes.\n\n**Impact**\n\nNo impact was observed nor any follow-on activities to deny, disrupt or destroy data or\nsystems.\n\n### IOCs\n\n Network\n\n**IcedID C2**\n```\nallnezokila[.]cyou\n2tothepollo[.]top\ndaserekolut[.]top \n194.5.249[.]81|443\ndsedertyhuiokle[.]top \n5.149.252[.]179|443\n\n```\n**CobaltStrike C2**\n\n\n-----\n\n```\ntestsubnet[.]com\n82.117.252[.]32|80\n82.117.252[.]32|443\n\n### Files\nupefkuin4.dll\n332cd0a48e0f7be3e132858877430c90\nc63f98d65e809a8f461ca5c825f056b93ccc1eb0\n666570229dd5af87fede86b9191fb1e8352d276a8a32c42e4bf4128a4f7e8138\nlicense.dat\n3c6263a9c4117c78d26fc4380af014f2\neca410dd57af16227220e08067c1895c258eb92b\n29d2a8344bd725d7a8b43cc77a82b3db57a5226ce792ac4b37e7f73ec468510e\nAdFind.exe\n12011c44955fd6631113f68a99447515\n4f4f8cf0f9b47d0ad95d159201fe7e72fbc8448d\nc92c158d7c37fea795114fa6491fe5f145ad2f8c08776b18ae79db811e8e36a3\n\n## Detections\n\n### Network\n\n```\nET RPC DCERPC SVCCTL – Remote Service Control Manager Access\n\nET POLICY SMB2 NT Create AndX Request For an Executable File\n\nET DNS Query to a *.top domain – Likely Hostile\n\nET INFO HTTP Request to a *.top domain\n\nET TROJAN W32/Photoloader.Downloader Request Cookie\n\nET POLICY OpenSSL Demo CA – Internet Widgits Pty (O)\n\n### Sigma\n\n**YARA**\n\n\n-----\n\n```\n/\nYARA Rule Set\nAuthor: The DFIR Report\nDate: 2021-06-09\nIdentifier: 3930\nReference: https://thedfirreport.com\n*/\n/* Rule Set ----------------------------------------------------------------- */\nimport \"pe\"\nrule icedid_upefkuin4_3930 {\nmeta:\ndescription = \"3930 - file upefkuin4.dll\"\nauthor = \"The DFIR Report\"\nreference = \"https://thedfirreport.com\"\ndate = \"2021-06-09\"\nhash1 = \"666570229dd5af87fede86b9191fb1e8352d276a8a32c42e4bf4128a4f7e8138\"\nstrings:\n$s1 = \"UAWAVAUATVWSH\" fullword ascii\n$s2 = \"AWAVAUATVWUSH\" fullword ascii\n$s3 = \"AWAVATVWUSH\" fullword ascii\n$s4 = \"update\" fullword ascii /* Goodware String - occured 207 times */\n$s5 = \"[email protected]@YAHXZ\" fullword ascii\n$s6 = \"[email protected]@YAHXZ\" fullword ascii\n$s7 = \"[email protected]@YAHXZ\" fullword ascii\n$s8 = \"[email protected]@YAHXZ\" fullword ascii\n$s9 = \"*=UUUUr#L\" fullword ascii\n$s10 = \"*=UUUUr!\" fullword ascii\n$s11 = \"PluginInit\" fullword ascii\n$s12 = \"*=UUUUr\\\"\" fullword ascii\n$s13 = \"AVVWSH\" fullword ascii\n$s14 = \"D$4iL$ \" fullword ascii\n$s15 = \"X[]_^A\\\\A]A^A_\" fullword ascii\n$s16 = \"D$4iT$ \" fullword ascii\n$s17 = \"H[]_^A\\\\A]A^A_\" fullword ascii\n$s18 = \"L94iL$ \" fullword ascii\n$s19 = \"D$ iD$ \" fullword ascii\n$s20 = \"*=UUUUr \" fullword ascii\ncondition:\nuint16(0) == 0x5a4d and filesize < 700KB and\n( pe.imphash() == \"87bed5a7cba00c7e1f4015f1bdae2183\" and ( pe.exports(\"\n[email protected]@YAHXZ\") and pe.exports(\"[email protected]@YAHXZ\") and pe.exports(\"\n[email protected]@YAHXZ\") and pe.exports(\"[email protected]@YAHXZ\") and\npe.exports(\"PluginInit\") and pe.exports(\"update\") ) or 8 of them )\n}\nrule icedid_license_3930 {\nmeta:\ndescription = \"3930 - file license.dat\"\nauthor = \"The DFIR Report\"\nreference = \"https://thedfirreport.com\"\ndate = \"2021-06-09\"\nhash1 = \"29d2a8344bd725d7a8b43cc77a82b3db57a5226ce792ac4b37e7f73ec468510e\"\n\n```\n\n-----\n\n```\nstrings:\n$s1 = \"iEQc- A1h\" fullword ascii\n$s2 = \"%n%DLj\" fullword ascii\n$s3 = \"n{[email protected]#5\\\"~\" fullword ascii\n$s4 = \"(5N&#jUBE\\\"0\" fullword ascii\n$s5 = \"~JCyP+Av\" fullword ascii\n$s6 = \"iLVIy\\\\\" fullword ascii\n$s7 = \"RemwDVL\" fullword ascii\n$s8 = \"EQiH^,>A\" fullword ascii\n$s9 = \"#wmski;H\" fullword ascii\n$s10 = \"aHVAh}X\" fullword ascii\n$s11 = \"GEKK/no\" fullword ascii\n$s12 = \"focbZjQ\" fullword ascii\n$s13 = \"wHsJJX>e\" fullword ascii\n$s14 = \"cYRS:F#\" fullword ascii\n$s15 = \"EfNO\\\"h{\" fullword ascii\n$s16 = \"akCevJ]\" fullword ascii\n$s17 = \"8IMwwm}!\" fullword ascii\n$s18 = \"NrzMP?<>\" fullword ascii\n$s19 = \".ZNrzLrU\" fullword ascii\n$s20 = \"sJlCJP[\" fullword ascii\ncondition:\nuint16(0) == 0x02ee and filesize < 1000KB and\n8 of them\n}\nrule icedid_win_01 {\nmeta:\ndescription = \"Detects Icedid\"\nauthor = \"The DFIR Report\"\ndate = \"15/05/2021\"\ndescription = \"Detects Icedid functionality. incl. credential access, OS cmds.\"\nsha1 = \"3F06392AF1687BD0BF9DB2B8B73076CAB8B1CBBA\"\nscore = 100\nstrings:\n$s1 = \"DllRegisterServer\" wide ascii fullword\n$x1 = \"passff.tar\" wide ascii fullword\n$x2 = \"vaultcli.dll\" wide ascii fullword\n$x3 = \"cookie.tar\" wide ascii fullword\n$y1 = \"powershell.exe\" wide ascii fullword\n$y2 = \"cmd.exe\" wide ascii fullword\ncondition:\n( uint16(0) == 0x5a4d and int32(uint32(0x3c)) == 0x00004550 and filesize < 500KB and\n$s1 and ( 2 of ($x*) and 2 of ($y*)))\n}\nrule fake_gzip_bokbot_202104 {\nmeta:\n\n```\n\n-----\n\n```\nauthor Thomas Barabosch, Telekom Security \ndate = \"2021-04-20\"\ndescription = \"fake gzip provided by CC\"\nstrings:\n$gzip = {1f 8b 08 08 00 00 00 00 00 00 75 70 64 61 74 65}\ncondition:\n$gzip at 0\n}\nrule win_iceid_gzip_ldr_202104 {\nmeta:\nauthor = \"Thomas Barabosch, Telekom Security\"\ndate = \"2021-04-12\"\ndescription = \"2021 initial Bokbot / Icedid loader for fake GZIP payloads\"\nstrings:\n$internal_name = \"loader_dll_64.dll\" fullword\n$string0 = \"_gat=\" wide\n$string1 = \"_ga=\" wide\n$string2 = \"_gid=\" wide\n$string3 = \"_u=\" wide\n$string4 = \"_io=\" wide\n$string5 = \"GetAdaptersInfo\" fullword\n$string6 = \"WINHTTP.dll\" fullword\n$string7 = \"DllRegisterServer\" fullword\n$string8 = \"PluginInit\" fullword\n$string9 = \"POST\" wide fullword\n$string10 = \"aws.amazon.com\" wide fullword\ncondition:\nuint16(0) == 0x5a4d and\nfilesize < 5000KB and\n( $internal_name or all of ($s*) )\nor all of them\n}\nrule win_iceid_core_ldr_202104 {\nmeta:\nauthor = \"Thomas Barabosch, Telekom Security\"\ndate = \"2021-04-13\"\ndescription = \"2021 loader for Bokbot / Icedid core (license.dat)\"\n\n```\n\n-----\n\n```\nstrings:\n$internal_name = \"sadl_64.dll\" fullword\n$string0 = \"GetCommandLineA\" fullword\n$string1 = \"LoadLibraryA\" fullword\n$string2 = \"ProgramData\" fullword\n$string3 = \"SHLWAPI.dll\" fullword\n$string4 = \"SHGetFolderPathA\" fullword\n$string5 = \"DllRegisterServer\" fullword\n$string6 = \"update\" fullword\n$string7 = \"SHELL32.dll\" fullword\n$string8 = \"CreateThread\" fullword\ncondition:\nuint16(0) == 0x5a4d and\nfilesize < 5000KB and\n( $internal_name or all of ($s*) )\nor all of them\n}\nrule win_iceid_core_202104 {\nmeta:\nauthor = \"Thomas Barabosch, Telekom Security\"\ndate = \"2021-04-12\"\ndescription = \"2021 Bokbot / Icedid core\"\nstrings:\n$internal_name = \"fixed_loader64.dll\" fullword\n$string0 = \"mail_vault\" wide fullword\n$string1 = \"ie_reg\" wide fullword\n$string2 = \"outlook\" wide fullword\n$string3 = \"user_num\" wide fullword\n$string4 = \"cred\" wide fullword\n$string5 = \"Authorization: Basic\" fullword\n$string6 = \"VaultOpenVault\" fullword\n$string7 = \"sqlite3_free\" fullword\n$string8 = \"cookie.tar\" fullword\n$string9 = \"DllRegisterServer\" fullword\n$string10 = \"PT0S\" wide\ncondition:\nuint16(0) == 0x5a4d and\nfilesize < 5000KB and\n( $internal_name or all of ($s*) )\nor all of them\n}\n\n```\n**MITRE ATT&CK Techniques**\n\n\n-----\n\nRemote System Discovery – T1018\nSecurity Software Discovery – T1518.001\nSystem Information Discovery – T1082\nSystem Network Configuration Discovery – T1016\nDomain Account – T1087.002\nDomain Trust Discovery – T1482\nApplication Layer Protocol – T1071\nIngress Tool Transfer – T1105\nPowerShell – T1059.001\nScheduled Task/Job – T1053\nProcess Injection – T1055\nRundll32 – T1218.011\nLSASS Memory – T1003.001\nSMB/Windows Admin Shares – T1021.002\nRemote Desktop Protocol – T1021.001\n\n**References**\n\nIcedID GZIPLOADER Analysis, Binary Defense –\n[https://www.binarydefense.com/icedid-gziploader-analysis/](https://www.binarydefense.com/icedid-gziploader-analysis/)\n[IcedDecrypt, Binary Defense – https://github.com/BinaryDefense/IcedDecrypt](https://github.com/BinaryDefense/IcedDecrypt)\nSecurity Primer – IcedID, Center for Internet Security, https://www.cisecurity.org/whitepapers/security-primer-icedid/\n\nIcedID YARA Rules, Thomas Barabosch – https://github.com/telekomsecurity/icedid_analysis\nTA551 Pushing IcedID IoCs, Unit42, https://github.com/panunit42/tweets/blob/master/2021-05-10-IOCs-for-TA551-pushing-IcedID.txt\n[AdFind – http://www.joeware.net/freetools/tools/adfind/](http://www.joeware.net/freetools/tools/adfind/)\nNMap NSE Grab CobaltStrike Configuration, Whickey-R7 – https://github.com/whickeyr7/grab_beacon_config\n\nInternal case 3930\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-06-20 - From Word to Lateral Movement in 1 Hour.pdf"
    ],
    "report_names": [
        "2021-06-20 - From Word to Lateral Movement in 1 Hour.pdf"
    ],
    "threat_actors": [
        {
            "id": "26a04131-2b8c-4e5d-8f38-5c58b86f5e7f",
            "created_at": "2022-10-25T15:50:23.579601Z",
            "updated_at": "2025-03-27T02:00:55.50292Z",
            "deleted_at": null,
            "main_name": "TA551",
            "aliases": [
                "TA551",
                "GOLD CABIN",
                "Shathak"
            ],
            "source_name": "MITRE:TA551",
            "tools": [
                "QakBot",
                "IcedID",
                "Valak",
                "Ursnif"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "04e34cab-3ee4-4f06-a6f6-5cdd7eccfd68",
            "created_at": "2022-10-25T16:07:24.578896Z",
            "updated_at": "2025-03-27T02:02:10.286803Z",
            "deleted_at": null,
            "main_name": "TA551",
            "aliases": [
                "Gold Cabin",
                "Monster Libra",
                "Shathak",
                "TA551"
            ],
            "source_name": "ETDA:TA551",
            "tools": [
                "BokBot",
                "CRM",
                "Gozi",
                "Gozi CRM",
                "IceID",
                "IcedID",
                "Papras",
                "Snifula",
                "Ursnif",
                "Valak",
                "Valek"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "90f216f2-4897-46fc-bb76-3acae9d112ca",
            "created_at": "2023-01-06T13:46:39.248936Z",
            "updated_at": "2025-03-27T02:00:03.031127Z",
            "deleted_at": null,
            "main_name": "GOLD CABIN",
            "aliases": [
                "Shakthak",
                "TA551",
                "ATK236",
                "G0127",
                "Monster Libra"
            ],
            "source_name": "MISPGALAXY:GOLD CABIN",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "40b623c7-b621-48db-b55b-dd4f6746fbc6",
            "created_at": "2024-06-19T02:03:08.017681Z",
            "updated_at": "2025-03-27T02:05:17.342829Z",
            "deleted_at": null,
            "main_name": "GOLD CABIN",
            "aliases": [
                "TA551 ",
                "Shathak"
            ],
            "source_name": "Secureworks:GOLD CABIN",
            "tools": [
                ""
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673536157,
    "ts_updated_at": 1743041638,
    "ts_creation_date": 1653761036,
    "ts_modification_date": 1653761036,
    "files": {
        "pdf": "https://archive.orkl.eu/b2ef496418776d53b0976a9f53e6bdab06cd5ec1.pdf",
        "text": "https://archive.orkl.eu/b2ef496418776d53b0976a9f53e6bdab06cd5ec1.txt",
        "img": "https://archive.orkl.eu/b2ef496418776d53b0976a9f53e6bdab06cd5ec1.jpg"
    }
}