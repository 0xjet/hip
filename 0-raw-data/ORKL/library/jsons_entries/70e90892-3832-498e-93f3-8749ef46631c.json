{
    "id": "70e90892-3832-498e-93f3-8749ef46631c",
    "created_at": "2023-01-12T15:07:38.239378Z",
    "updated_at": "2025-03-27T02:06:09.454743Z",
    "deleted_at": null,
    "sha1_hash": "302e7020a91ad808c64c71b96fae4ac3066b23d7",
    "title": "2022-05-06 - macOS Malware Is More Reality Than Myth- Popular Threats and Challenges in Analysis",
    "authors": "",
    "file_creation_date": "2022-05-29T01:03:31Z",
    "file_modification_date": "2022-05-29T01:03:31Z",
    "file_size": 497609,
    "plain_text": "# How CrowdStrike Analyzes macOS Malware to Optimize Automated Detection\n\n**[crowdstrike.com/blog/how-crowdstrike-analyzes-macos-malware-to-optimize-automated-detection-capabilities/](https://www.crowdstrike.com/blog/how-crowdstrike-analyzes-macos-malware-to-optimize-automated-detection-capabilities/)**\n\nPaul-Danut Urian May 6, 2022\n\nRansomware (43% of analyzed threat data), backdoors (35%) and trojans (17%) were the\nmost popular macOS malware categories spotted by CrowdStrike researchers in 2021\nOSX.EvilQuest (ransomware), OSX.FlashBack (backdoor) and OSX.Lador (trojan) were the\nmost prevalent threats in their respective categories\nTo strengthen customer protection, CrowdStrike researchers continuously build better\nautomated detection capabilities by analyzing and understanding how macOS threats\nbehave\n\nUnderstanding the threat landscape and how threats behave is the first step CrowdStrike\nresearchers take toward strengthening customer protection. They based the following threat\nlandscape analysis on internal and open source data, which revealed that in 2021 the most\ncommonly encountered macOS malware types were ransomware (43%), backdoors (35%) and\ntrojans (17%). Each category is powered by a different motive: ransomware by money, backdoors\nby remote access and trojans by data theft.\n\n\n-----\n\nFigure 1. macOS Threat Landscape in 2021\n\nOSX.EvilQuest was the most prevalent macOS ransomware family in 2021, accounting for 98% of\nransomware in the researchers’ analysis, while OSX.Flashback accounted for 31% of macOS\nbackdoor threats and OSX.Lador accounted for 47% of macOS trojans.\n\nImproving the CrowdStrike Falcon® platform’s ability to detect macOS threats is a continuous\nprocess. CrowdStrike researchers constantly hunt, analyze and gain understanding of any\nmacOS artifact that looks even remotely suspicious to improve CrowdStrike’s automated machine\nlearning and behavior-based protection capabilities.\n\nThe fallacies that macOS cannot be harmed by threats or is targeted by less-sophisticated\nmalware still linger. This blog addresses some of the challenges and requirements our\nresearchers must meet when analyzing macOS threats. The deep understanding and knowledge\nthey gain is used both to create new features for structural parsing that augments our machine\nlearning detection capabilities and to improve the proficiency of our behavior-based protection.\n\n## Biting Into the Apple\n\nmacOS malware research starts with the fundamentals, such as classifying macOS malware by\n[file type; continues with the capabilities, intended targets and general behavior of malware; and](https://www.crowdstrike.com/cybersecurity-101/malware/)\nends with obstacles researchers encounter when analyzing macOS malware.\n\nThreats that target macOS systems have the same goals as those targeting any other operating\nsystems; they range from spying and reconnaissance to cryptocurrency mining, file encryption,\nremote access, and adware-related hijack and injection.\n\n### File Type Classification for macOS Threats\n\nMalware developers often try to hide or mask file types in an attempt to trick users into executing\nthem. File-type identification also helps in establishing the tools required in the analysis. Figure 2\noffers an overview of macOS malware file types.\n\n\n-----\n\nFigure 2. macOS malware by file types\n\nEven though most malware are compiled binaries, many non-binary file types are commonly\nencountered while analyzing macOS malware; each has its own advantages and disadvantages\nfor the adversaries that use them. Examples include:\n\nApple Disk Images (.dmg) are favored because they’re automatically mounted on execution;\n[both OSX.EvilQuest (Figure 3) and OSX.Shlayer malware typically use this file type.](https://www.crowdstrike.com/blog/shlayer-malvertising-campaigns-still-using-flash-update-disguise/)\nPackages (.pkg, .mpkg) are another common file type abused by malware as they allow\nmalware developers to define preinstall and postinstall scripts that automatically run through\nthe installation process. For example, OSX.EvilQuest uses a malicious package — after\nmounting the .dmg file — that has a postinstall script that copies the malicious\nOSX.EvilQuest binary to /Library/mixednkey/ under the name toolroomd.\n\n\n-----\n\nAppleScripts or AppleScript variants like Run-only that are used for automating repetitive\ntasks are often abused by macOS threats such as OSX.OSAMiner, a popular\ncryptocurrency miner.\n\n### Delivery and Infection Vectors\n\n[One of the most common methods of spreading malware involves using social engineering tactics](https://www.crowdstrike.com/cybersecurity-101/social-engineering-attacks/)\nin an attempt to trick the user into manually infecting their macOS. Fake updates, fake\napplications, trojanized applications and tainted versions of legitimate applications are the most\ncommon methods used to trick users into installing malicious software.\n\nFor example, OSX.EvilQuest ransomware has been known to impersonate popular sound mixing\napplications (as seen in Figure 3), while trojans like OSX.Lador are distributed via spam emails\nthat contain malicious add-ons, cracked applications, free programs and fake updates.\n\nFigure 3. OSX.EvilQuest ransomware installing as fake Mixed In Key DJ application\n\nOther malware variants, such as OSX.XCSSET, are distributed via either malicious documents or\nsupply chain attacks targeting legitimate software development tools such as Xcode, Apple’s IDE.\nMore complex attacks use exploits in different applications or in compromised OS kernels or\naccounts. For example, older OSX.FlashBack backdoor variants were known to use Java exploits\nto compromise targets.\n\nBy understanding delivery and infection vectors, researchers can take a layered approach to\nsecurity, building protection capabilities to stop breaches.\n\n\n-----\n\n### Persistence and Tactics\n\nMost threats, including macOS malware, attempt to ensure persistence to survive system reboots.\nAnalyzing and understanding persistence tactics enables researchers to build behavior-based\ndetections and train automated machine learning (ML) detections.\n\nWhile one of the most common persistence mechanisms involves abusing Login Items in macOS,\nother popular persistence tactics include abusing Launch Items, adding malware to scheduled\ntasks, or using cronjobs to execute tasks sometime in the future.\n\nThe hijacking of dylibs was once one of the stealthiest persistence mechanisms, especially in\nbinaries. For example, some 2012 variants of the OSX.FlashBlack backdoor used malicious\nlibraries injected at load time into a process via the DYLD_INSERT_LIBRARIES environment\nvariable (i.e., at load time the dynamic loader will examine the DYLD_INSERT_LIBRARIES\nvariable and load all specified libraries); others used the dylib hijacking technique of planting a\nmalicious dylib for an application that tries to load dynamic libraries from multiple locations.\nHowever, Apple has long since improved security and reduced the number of use cases for\nabusing DYLD_INSERT_LIBRARIES.\n\n### Challenges in Malware Analysis\n\nMost malware, regardless of the targeted platform, make analysis difficult from the start by using\nanti-static analysis methods, such as string-based obfuscation or code obfuscation and\nencryption. Scripts usually use obfuscation tools that randomize function and variable names and\ninsert junk and useless code, while binaries make use of packers or encryption.\n\nmacOS malware also commonly uses debugger detection tactics, making analysis a challenge for\nresearchers. Such tactics include using the sysctl API to check if the process is under debugging;\ncalling the ptrace system call to prevent a debugger from attaching to the process; or even using\nbuilt-in macOS commands to extract information about the machine.\n\n**On a Quest to Understand EvilQuest**\n\nLet’s take a closer look at a mid-2020 OSX.EvilQuest ransomware sample and see how it\nimplemented various anti-analysis methods to avoid virtual machines and debugging.\n\nUpon executing, OSX.EvilQuest first checked to see if it was running in a virtual machine, in\nparticular a sandboxed environment, by looking at the is_virtual_mchn function starting at address\n_0x0000000100007BC0. OSX.EvilQuest performed this check by using a sleep function and_\ncalling the time function twice; the difference between the two time functions should return the\ntime the malware used to sleep, yet because sandboxes usually patch sleep functions to quicken\nanalysis, the differences between the two timestamps would be different and the malware would\nknow it is running in a sandboxed environment.\n\nBefore the malware tries to ensure its persistence — as a launch daemon or a launch agent,\ndepending on the –noroot argument passed to the binary — it implements another two antianalysis methods. The first one (is_debugging function starting at address 0000000100007AA0)\n\n\n-----\n\nis to check if the malware is debugged, and the second one (prevent_trace function starting at\naddress 0000000100007C20) is to prevent debugging using a ptrace call with the flag\nPT_DENY_ATTACH.\n\nUsing the ptrace function call, OSX.EvilQuest uses different logics to make it more difficult for the\nanalyst to spot the function call or to bypass the mechanism by patching the binary in the\ndebugger.\n\n## CrowdStrike Protection for macOS\n\nContinuous research into the trends and behavior of macOS malware is turned into expert input\nand knowledge that’s used to augment CrowdStrike’s automated detection capabilities and build\nbetter protection for customers.\n\nIdentifying the file type, understanding the behavior, targets and potential persistence\nmechanisms of possible threats, and knowing the possible obstacles an analyst may encounter in\nanalyzing potential malware is crucial for building a solution that provides comprehensive\nprotection and visibility against threats.\n\nFig 3. – CrowdStrike Falcon detection for OSX.EvilQuest malware sample (sha256:\n```\n 5a024ffabefa6082031dccdb1e74a7fec9f60f257cd0b1ab0f698ba2a5baca6b ) using cloud-based machine\n\n```\nlearning (Click to enlarge)\n\nThe CrowdStrike Falcon platform protects macOS workloads using machine learning and\nbehavior-based indicators of attack (IOAs) to defend macOS systems against malware and\nsophisticated threats, while delivering complete visibility and context into attacks.\n\n## Indicators of Compromise (IOCs)\n\n\n-----\n\n**File** **SHA256**\n\nOSX.EvilQuest b34738e181a6119f23e930476ae949fc0c7c4ded6efa003019fa946c4e5b287a;\n5a024ffabefa6082031dccdb1e74a7fec9f60f257cd0b1ab0f698ba2a5baca6b\n\nOSX.Shlayer 852ff1b97c1155fc28b14f5633a17de02dcace17bdc5aadf42e2f60226479eaf\n\nOSX.Lador 30ca6a13a85ac1ea7858e8163d9c08d8bbd8ed8bc6e97498b5b02d6de042b51e;\n33ee40b89ee505bced8caaa4226223a0b9622b944e790fb5a704ffe6fce3eaa6\n\nOSX.XCSSET a6141dfb0b6a242246d26afecfea00ed04dee24209f7d8d9bfef82042accd0f0;\n6614978ab256f922d7b6dbd7cc15c6136819f4bcfb5a0fead480561f0df54ca6;\n\nceb023a95b8ee954c31bc6aa47a8f1461e246fea939a57fc59bc4b457ccb61ff\n\nOSX.FlashBack 8d56d09650ebc019209a788b2d2be7c7c8b865780eee53856bafceffaf71502c\n\n**Additional Resources**\n\n_[Learn more about how CrowdStrike Falcon extends protection for macOS here.](https://www.crowdstrike.com/falcon-endpoint-security-for-macos/)_\n_[Download the CrowdStrike Falcon for macOS data sheet here.](https://www.crowdstrike.com/resources/data-sheets/falcon-for-mac-os/)_\n_Learn what others are saying about CrowdStrike — visit the CrowdStrike Industry_\n_Recognition and Technology Validation webpage._\n_[Learn about the powerful, cloud-native CrowdStrike Falcon® platform.](https://www.crowdstrike.com/endpoint-security-products/)_\n_[Get a full-featured free trial of CrowdStrike Falcon Prevent™ and see for yourself how true](https://go.crowdstrike.com/try-falcon-prevent.html)_\n_next-gen AV performs against today’s most sophisticated threats._\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-05-06 - macOS Malware Is More Reality Than Myth- Popular Threats and Challenges in Analysis.pdf"
    ],
    "report_names": [
        "2022-05-06 - macOS Malware Is More Reality Than Myth- Popular Threats and Challenges in Analysis.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536058,
    "ts_updated_at": 1743041169,
    "ts_creation_date": 1653786211,
    "ts_modification_date": 1653786211,
    "files": {
        "pdf": "https://archive.orkl.eu/302e7020a91ad808c64c71b96fae4ac3066b23d7.pdf",
        "text": "https://archive.orkl.eu/302e7020a91ad808c64c71b96fae4ac3066b23d7.txt",
        "img": "https://archive.orkl.eu/302e7020a91ad808c64c71b96fae4ac3066b23d7.jpg"
    }
}