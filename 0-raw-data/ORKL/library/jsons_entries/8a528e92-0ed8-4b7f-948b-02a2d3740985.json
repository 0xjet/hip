{
    "id": "8a528e92-0ed8-4b7f-948b-02a2d3740985",
    "created_at": "2024-07-26T02:05:45.804663Z",
    "updated_at": "2025-03-27T02:16:55.403372Z",
    "deleted_at": null,
    "sha1_hash": "b409b56d8ac0e2a4a72b934b45fb288dbaffec04",
    "title": "DodgeBox | ThreatLabz",
    "authors": "",
    "file_creation_date": "2024-07-25T13:30:21Z",
    "file_modification_date": "2024-07-25T13:30:21Z",
    "file_size": 9353923,
    "plain_text": "### Zscaler Blog\n\n**Get the latest Zscaler blog updates in your inbox**\n**Subscribe**\n\n\n[Security Research](https://www.zscaler.com/blogs?type=security-research)\n\n## DodgeBox: A deep dive into the updated arsenal of APT41 | Part 1\n\n**[YIN HONG CHANG,](https://www.zscaler.com/author/yinhongchang)**\n\n**[SUDEEP SINGH](https://www.zscaler.com/author/sudeepsingh)**\nJULY 10, 2024 - 19 MIN READ\n\n**[THREATLABZ RESEARCH](https://www.zscaler.com/blogs?topic=threatlabz-research)**\n\n\n-----\n\n### Introduction\n\n###### This is Part 1 of our two-part technical deep dive into APT41’s new tooling, which includes DodgeBox and MoonWalk. For details about MoonWalk, go toPart 2.\n\n In April 2024, Zscaler ThreatLabz uncovered a previously unknown loader called DodgeBox. Upon further analysis, striking similarities were found between DodgeBox and variants of StealthVector, a tool associated with the China-based advanced persistent threat (APT) actor APT41 / Earth Baku. DodgeBox is a loader that proceeds to load a new backdoor named MoonWalk. MoonWalk shares many evasion techniques implemented in DodgeBox and utilizes Google Drive for command-and-control (C2) communication.\n\n This two-part blog series aims to provide detailed technical analysis of both the DodgeBox loader and the MoonWalk backdoor. The goal is to assist blue teams in comprehending this emerging threat and offer insights into our attribution of the threat. Part 1 will offer an in-depth examination of the DodgeBox loader, highlighting its distinct characteristics and resemblances to StealthVector while Part 2 will delve into the intricacies of the MoonWalk backdoor.\n\n### Key Takeaways\n\n###### APT41, a China-based nation state threat actor known for its campaigns in Southeast Asian countries, has recently been observed deploying an advanced and upgraded version of StealthVector. We have named this new variant DodgeBox. DodgeBox incorporates various evasive techniques such as call stack spoofing, DLL sideloading, DLL hollowing and environmental guardrails. These techniques work together to significantly decrease the chances of detection by security defenses. Upon analyzing DodgeBox, we discovered significant resemblances to the well-known StealthVector loader used by APT41. These similarities, combined with the distinct utilization of DLL side loading and the acquisition of telemetry data from targeted countries, have led us to attribute this new loader to APT41 / Earth Baku with a moderate level of confidence\n\n\n-----\n\n### y\n\n#### Attack chain\n\n###### APT41 employs DLL sideloading as a means of executing DodgeBox. They utilize a legitimate executable (taskhost.exe), signed by Sandboxie, to sideload a malicious DLL (sbiedll.dll). This malicious DLL, DodgeBox, serves as a loader and is responsible for decrypting a second stage payload from an encrypted DAT file (sbiedll.dat). The decrypted payload, MoonWalk functions as a backdoor that abuses Google Drive for command-and-control (C2) communication. The figure below illustrates the attack chain at a high level.\n\n Figure 1: Attack chain used to deploy the DodgeBox loader and MoonWalk backdoor.\n\n#### DodgeBox analysis\n\n###### DodgeBox, a reflective DLL loader written in C, showcases similarities to\n\n\n-----\n\n###### embedded DLLs, conducting environment checks and bindings, and executing cleanup procedures. What sets DodgeBox apart from other malware is its unique algorithms and techniques.\n\n During our threat hunting activities, we came across two DodgeBox samples that were designed to be sideloaded by signed legitimate executables. One of these executables was developed by Sandboxie ( SandboxieWUAU.exe ), while the\n\n other was developed by AhnLab. All exports within the DLL point to a single function that primarily invokes the main function of the malware, as illustrated below:\n\n```\nvoid SbieDll_Hook()\n{\n if ( dwExportCalled )\n {\n  Sleep(0xFFFFFFFF);\n }\n else\n {\n  hSbieDll_ = hSbieDll;\n  dwExportCalled = 1;\n  MalwareMain();\n }\n}\n\n```\n```\nMalwareMain implements the main functionality of DodgeBox, and can be\n\n###### broken down into three main phases:\n\n 1. Decryption of DodgeBox’s configuration\n\n DodgeBox employs AES Cipher Feedback (AES-CFB) mode for encrypting its configuration. AES-CFB transforms AES from a block cipher into a stream cipher, allowing for the encryption of data with different lengths without requiring padding. The encrypted configuration is embedded within the .data section of\n\n the binary. To ensure the integrity of the configuration, DodgeBox utilizes hard- coded MD5 hashes to validate both the embedded AES keys and the encrypted configuration. For reference, a sample of DodgeBox's decrypted configuration can\n\n```\n\n###### con\n\n\n-----\n\n###### configuration using the variable Config in the following sections.\n\n 2. Execution guardrails and environment setup\n\n After decrypting its configuration, DodgeBox performs several environment checks to ensure it is running on its intended target.\n\n Execution guardrail: Argument check\n\n DodgeBox starts by verifying that the process was launched with the correct arguments. It scans the argv parameter for a specific string defined\n in Config.szArgFlag . Next, it calculates the MD5 hash of the subsequent\n\n argument and compares it to the hash specified in Config.rgbArgFlagValueMD5 . In this case, DodgeBox expects the\n arguments to include --type driver . If this verification check fails, the process\n\n is terminated.\n\n Environment setup: API Resolution\n\n Afterwards, DodgeBox proceeds to resolve multiple APIs that are utilized for additional environment checks and setup. Notably, DodgeBox employs a salted FNV1a hash for DLL and function names. This salted hash mechanism aids DodgeBox in evading static detections that typically search for hashes of DLL or function names. Additionally, it enables different samples of DodgeBox to use distinct values for the same DLL and function, all while preserving the integrity of the core hashing algorithm.\n\n The following code shows DodgeBox calling its ResolveImport function to\n resolve the address of LdrLoadDll, and populating its import table.\n```\n // ResolveImport takes in (wszDllName, dwDllNameHash, dwFuncNa\n sImportTable->ntdll_LdrLoadDll = ResolveImport(L\"ntdll\", 0xFE0\n\n Inside the ResolveImport function, DodgeBox utilizes the FNV1a hashing\n\n function in a two-step process. First, it hashes the input string, which represents a DLL or function name. Then, it hashes a salt value separately. This two-step hashing procedure is equivalent to hashing the concatenation of the input string\n\n```\n\n-----\n\n###### hash:\n\n```\ndwHash = 0x811C9DC5;   // Standard initial seed for FNV1a\npwszInputString_Char = pwszInputString;\ncchInputString = -1LL;\ndo\n ++cchInputString;\nwhile ( pwszInputString[cchInputString] );\npwszInputStringEnd = (pwszInputString + 2 * cchInputString);\nif ( pwszInputString < pwszInputStringEnd )\n{\n do // Inlined FNV1a hash\n {\n  chChar = *pwszInputString_Char;\n  pwszInputString_Char = (pwszInputString_Char + 1);\n  dwHash = 0x1000193 * (dwHash ^ chChar);\n }\n while ( pwszInputString_Char < pwszInputStringEnd );\n}\nv17 = &g_HashSaltPostfix;  // Salt value: CB 24 B4 BA\ndo // Inlined FNV1a hash, use previous hash as seed\n{\n v18 = *v17;\n v17 = (v17 + 1);\n dwHash = 0x1000193 * (dwHash ^ v18);\n}\nwhile ( v17 < g_HashSaltPostfix_End );\n\n```\n\n###### A Python script to generate the salted hashes is included in the Appendix.\n\n In addition to the salted hash implementation, DodgeBox incorporates another noteworthy feature in its ResolveImport function. This function accepts both\n\n the DLL name as a string and its hash value as arguments. This redundancy appears to be designed to provide flexibility, allowing DodgeBox to handle scenarios where the target DLL has not yet been loaded. In such cases, DodgeBox invokes the LoadLibraryW function with the provided string to load the DLL\n\n\n-----\n\n###### ordinals. It utilizes ntdll!LdrLoadDll\n and ntdll!LdrGetProcedureAddressEx when necessary to resolve the\n\n address of the exported function. This approach ensures that DodgeBox can successfully resolve and utilize the desired functions, regardless of the export method used.\n\n Environment setup: DLL unhooking\n\n Once DodgeBox has resolved the necessary functions, it proceeds to scan and unhook DLLs that are loaded from the System32 directory. This process involves iterating through the .pdata section of each DLL, retrieving each function’s start\n\n and end addresses, and calculating an FNV1a hash for the bytes of each function. DodgeBox then computes a corresponding hash for the same function's bytes as stored on disk. If the two hashes differ, potential tampering can be detected, and DodgeBox will replace the in-memory function with the original version from the disk.\n\n For each DLL that has been successfully scanned, DodgeBox marks the corresponding LDR_DATA_TABLE_ENTRY by clearing the ReservedFlags6 field\n\n and setting the upper bit to 1. This marking allows DodgeBox to avoid scanning the same DLL twice.\n\n Environment setup: Disabling CFG\n\n Following that, DodgeBox checks if the operating system is Windows 8 or newer. If so, the code verifies whether Control Flow Guard (CFG) is enabled by calling GetProcessMitigationPolicy with\n the ProcessControlFlowGuardPolicy parameter. If CFG is active, the\n\n malware attempts to disable it.\n\n To achieve this, DodgeBox locates the LdrpHandleInvalidUserCallTarget\n function within ntdll.dll by searching for a specific byte sequence. Once\n found, the malware patches this function with a simple jmp rax instruction:\n\n```\nntdll!LdrpHandleInvalidUserCallTarget:\n00007ffe`fc8cf070 48ffe0     jmp   rax\n00007ffe`fc8cf073 cc       int   3\n00007ffe`fc8cf074 90 nop\n\n```\n```\n  00\n\n```\n\n-----\n\n###### fails, LdrpHandleInvalidUserCallTarget is invoked, typically raising an\n\n interrupt. At this point, the rax register contains the invalid target address. The patch modifies this behavior, calling the target directly instead of raising an interrupt, thus bypassing CFG protection.\n\n In addition, DodgeBox replaces msvcrt!_guard_check_icall_fptr\n with msvcrt!_DebugMallocator<int>::~_DebugMallocator<int>, a\n function that returns 0 to disable the CFG check performed by msvcrt .\n\n Execution guardrail: MAC, computer name, and user name checks\n\n Finally, DodgeBox performs a series of checks to verify if it is configured to run on the current machine. The malware compares the machine’s MAC address against Config.rgbTargetMac, and compares the computer name\n against Config.wszTargetComputerName . Depending on\n the Config.fDoCheckIsSystem flag, DodgeBox checks whether it is running\n with SYSTEM privileges. If any of these checks fail, the malware terminates\n\n execution.\n\n 3. Payload decryption and environment keying\n\n Payload decryption\n\n In the final phase, DodgeBox commences the decryption process for the MoonWalk payload DAT file. The code starts by inspecting the first four bytes of the file. If these bytes are non-zero, it signifies that the DAT file has been tied to a particular machine, (which is described below). However, if the DAT file is not machine-specific, DodgeBox proceeds to decrypt the file using AES-CFB encryption, utilizing the key parameters stored in the configuration file. In the samples analyzed by ThreatLabz, this decrypted DAT file corresponds to a DLL, which is the MoonWalk backdoor.\n\n Environment keying of the payload\n\n After the decryption process, DodgeBox takes the additional step of keying the payload to the current machine. It accomplishes this by re-encrypting the payload using the Config.rgbAESKeyForDatFile key. However, in this specific scenario, the process deviates from the configuration file's IV (Initialization Vector). Instead, it utilizes the MD5 hash of the current machine's GUID as the AES IV. This approach\n\n\n###### utili\n\n\n-----\n\n###### machine, thus enhancing the payload's security.\n\n Loading the payload using DLL hollowing\n\n Next, DodgeBox reflectively loads the payload using a DLL hollowing technique. At a high level, the process begins with the random selection of a host DLL from the System32 directory, ensuring it is not on a blocklist (DLL blocklist available in\n\n the Appendix section) and has a sufficiently large .text section. A copy of this DLL is then created at C:\\Windows\\Microsoft.NET\\assembly\\GAC_MSIL\\System.Data.Trace\n\n```\n\\v4.0_4.0.0.0__<random bytes from pcrt4!UuidCreate>\\<name of\n\n```\n```\nchosen DLL>.dll . DodgeBox modifies this copy by disabling the NX flag,\n\n###### removing the reloc and TLS sections, and patching its entry point with a\n simple return 1 .\n\n Following the preparation of the host DLL for injection, DodgeBox proceeds by zeroing the PE headers, and the IMAGE_DATA_DIRECTORY structures\n corresponding to the import, reloc, and debug directories of the payload\n\n DLL. This modified payload DLL is then inserted into the previously selected host DLL. The resulting copy of the modified host DLL is loaded into memory using the NtCreateSection and NtMapViewOfSection APIs.\n\n Once the DLL is successfully loaded, DodgeBox updates the relevant entries in the Process Environment Block (PEB) to reflect the newly loaded DLL. To further conceal its activities, DodgeBox overwrites the modified copy of the host DLL with its original contents, making it appear as a legitimate, signed DLL on disk. Finally, the malware calls the entrypoint of the payload DLL.\n\n Interestingly, if the function responsible for DLL hollowing fails to load the payload DLL, DodgeBox employs a fallback mechanism. This fallback function implements a traditional form of reflective DLL loading using NtAllocateVirtualMemory\n and NtProtectVirtualMemory .\n\n At this stage, the payload DLL has been successfully loaded, and control is transferred to the payload DLL by invoking the first exported function.\n\n Call stack spoofing\n\n```\n\n-----\n\n###### discussed above: call stack spoofing. Call stack spoofing is employed to obscure the origins of API calls, making it more challenging for EDRs and antivirus systems to detect malicious activity. By manipulating the call stack, DodgeBox makes API calls appear as if they originate from trusted binaries rather than the malware itself. This prevents security solutions from gaining contextual information about the true source of the API calls.\n\n DodgeBox specifically utilizes call stack spoofing when invoking Windows APIs that are more likely to be monitored. As an example, it directly calls RtlInitUnicodeString, a Windows API that only performs string\n\n manipulation, instead of using stack spoofing.\n\n```\n(sImportTable->ntdll_RtlInitUnicodeString)(v25, v26);\n\n```\n\n###### However, call stack spoofing is used when calling NtAllocateVirtualMemory,\n\n an API known to be abused by malware, as shown below:\n\n```\nCallFunction(\n  sImportTable->ntdll_NtAllocateVirtualMemory, // API to ca\n  0,  // Unused\n  6LL, // Number of parameters\n  // Parameters to the API\n  -1LL, &pAllocBase, 0LL, &dwSizeOfImage, 0x3000, PAGE_READWR\n\n```\n\n###### The technique mentioned above can be observed in the figures below. In the first figure, we can see a typical call stack when explorer.exe invokes the CreateFileW function. The system monitoring tool, SysMon, effectively walks the call stack, enabling us to understand the purpose behind this API call and examine the modules and functions involved in the process.\n\n\n-----\n\n###### Figure 2: Normal example of stack trace from explorer.exe\n calling CreateFileW .\n\n In contrast, the next figure shows the call stack recorded by SysMon when DodgeBox uses stack spoofing to call the CreateFileW function. Notice that there is no indication of DodgeBox’s modules that triggered the API call. Instead, the modules involved all appear to be legitimate Windows modules.\n\n\n-----\n\n###### Figure 3: Stack trace of DodgeBox calling CreateFileW using the stack spoofing\n\n technique.\n\n There is an excellent writeup of this technique, so we will only highlight some implementation details specific to DodgeBox:\n\n When the CallFunction is invoked, DodgeBox uses a random jmp\n```\n  qword ptr [rbp+48h] gadget residing within the .text section\n\n of K ernelBase .\n DodgeBox analyzes the unwind codes within the .pdata section to extract\n\n the unwind size for the function that includes the selected gadget. DodgeBox obtains the addresses of RtlUserThreadStart + 0x21\n and BaseThreadInitThunk + 0x14, along with their respective unwind\n\n sizes. DodgeBox sets up the stack by inserting the addresses of RtlUserThreadStart + 0x21, BaseThreadInitThunk + 0x14,\n\n and the address of the gadget at the right positions, utilizing the unwind sizes retrieved. Following that, DodgeBox proceeds to insert the appropriate return address at [rbp+48h] and prepares the registers and stack with the necessary\n\n argument values to be passed to the API. This preparation ensures that the API is called correctly and with the intended parameters. Finally, DodgeBox executes a jmp instruction to redirect the control flow to\n\n the targeted API.\n### Threat Attribution\n\n```\n\n-----\n\n###### that were utilized as indicators during our threat attribution process. Through the identification of these overlapping TTPs, we attribute this activity to a China- based threat actor known as APT41. Our confidence level in this attribution is medium.\n\n#### Abuse of DLL sideloading\n\n###### DLL sideloading is a technique commonly utilized by APT groups with links to China. Typically, this method involves three essential components: a legitimate executable (EXE) file that is signed, a malicious DLL file, and an encrypted data file. While the specific combination of the EXE and DLL files mentioned here has not been publicly documented as being associated with APT41, the presence of these three components could indicate the involvement of a group linked to China.\n\n#### Targeted regions\n\n###### Analysis of the telemetry available in VirusTotal reveals that DodgeBox samples have been submitted from both Thailand and Taiwan. This observation aligns with previous instances of APT41 employing StealthVector in campaigns primarily targeting users in the Southeast Asian (SEA) region.\n\n Furthermore, during the monitoring of the attacker-controlled Google Drive account utilized for C2 communication, a spreadsheet containing the personal details of individuals from India was discovered. This spreadsheet is publicly available from other sources, suggesting that the threat actor may have leveraged it to identify potential additional targets.\n\n#### Similarities between DodgeBox and StealthVector\n\n###### During our analysis of DodgeBox, we noted a number of similarities with StealthVector. In this section, we compare the code between variants of StealthVector uploaded to VirusTotal in 2021 and 2024, along with DodgeBox.\n\n Similarities in checksum and configuration decryption\n\n Both StealthVector and DodgeBox perform an integrity check on their encrypted configurations. This verification process consists of two essential steps. First, the hard-coded size of the configuration is validated, ensuring it matches the\n t d i S d th h h f th fi ti i ifi d t it\n\n\n-----\n\n###### with decrypting the configuration.\n\n**StealthVector (2021)**\n\n###### Figure 4: StealthVector uses the CRC32 hashing algorithm and the ChaCha20 algorithm for decryption (screenshot from TrendMicro).\n\n Old variants of StealthVector use a CRC32 hashing algorithm for integrity checks and ChaCha20 for decryption of the configuration.\n\n**StealthVector (2024)**\n\n###### Figure 5: StealthVector uses the CRC32 hashing algorithm and AES-CBC\n algorithm for decryption.\n\n Newer variants of StealthVector use a CRC32 hashing algorithm, and AES-CBC for decryption.\n\n**DodgeBox**\n\n\n-----\n\n###### Figure 6: DodgeBox uses the MD5 hashing algorithm and AES-CFB algorithm for decryption.\n\n DodgeBox uses an MD5 hashing algorithm for integrity checks, and AES-CFB for decryption of the configuration.\n\n Similarities in decrypted configuration format\n\n These similarities encompass various aspects such as guardrails, payload filenames, sizes and offsets, as well as cryptographic secrets. Both the original StealthVector and DodgeBox configurations also incorporate checksums for their encrypted payloads.\n\n**StealthVector (2021)**\n\n###### Figure 7: Configuration extracted from the 2021 variant of StealthVector.\n\n\n-----\n\n###### similarities with the 2024 variant of StealthVector and DodgeBox.\n\n**StealthVector (2024)**\n\n###### Figure 8: Configuration extracted from the 2024 variant of StealthVector.\n\n The configuration extracted from the 2024 variant of StealthVector reveals several similarities with the 2021 variant of StealthVector and DodgeBox.\n\n**DodgeBox**\n\n\n-----\n\n###### The configuration extracted from DodgeBox reveals several similarities with the 2024 and 2021 variant of StealthVector.\n\n Similarities in environment keying\n\n Both StealthVector and DodgeBox perform environment keying by decrypting then re-encrypting the bundled payload.\n\n**StealthVector (2021)**\n\n###### TrendMicro’s report did not document StealthVector utilizing environment keying.\n\n**StealthVector (2024)**\n\n###### Figure 10: 2024 variant of StealthVector performing environment keying, using a rolling XOR against the computer name.\n\n The updated version of StealthVector employs the first four bytes of the payload ( rgbDecryptedData_In_Out ) to check whether the payload has been keyed. If\n\n the payload has not been previously keyed, StealthVector proceeds to key it using the computer name of the target machine.\n\n This keying process involves a rolling XOR operation to encode the payload, followed by re-encryption using AES. In the analyzed sample, StealthVector sets the first four bytes of the payload to 0x90909090, serving as an indicator that\n\n the payload has been successfully keyed\n\n\n-----\n\n###### Figure 11: DodgeBox uses a technique called environment keying, where it uses the hash of the machine's GUID as the AES Initialization Vector (IV).\n\n DodgeBox employs the first four bytes of the payload ( pFileData ) to determine\n\n whether it has been keyed. If the payload has not been previously keyed, DodgeBox decrypts the payload using the AES IV from its configuration.\n DodgeBox then proceeds to re-encrypt it using the MD5 hash of the target machine's MachineGUID as the new AES IV.\n\n In the given sample, DodgeBox sets the first four bytes of the payload to 0x000000ED . This non-zero value serves as an indicator that the payload has\n\n indeed been keyed and should be decrypted with the new AES IV.\n\n Similarities in disabling CFG\n\n All three samples exhibit remarkably similar logic in their approach to patching CFG. This similarity extends to the use of identical byte patterns for locating the LdrpHandleInvalidUserCallTarget function, as well as applying the same patch in this function.\n\n**StealthVector (2021)**\n\n\n-----\n\n###### Figure 12: Code from the 2021 variant of StealthVector disabling CFG (screenshot from TrendMicro).\n\n The code extracted from the 2021 variant of StealthVector showcases the disabling of CFG with striking similarity to all three samples.\n\n**StealthVector (2024)**\n\n###### Figure 13: Code from the 2024 variant of StealthVector, disabling CFG.\n\n The code extracted from the 2024 variant of StealthVector showcases the disabling of CFG with striking similarity to all three samples.\n\n**DodgeBox**\n\n\n-----\n\n###### Figure 14: Code from DodgeBox disabling CFG.\n\n The code extracted from DodgeBox showcases the disabling of CFG with striking similarity to all three samples.\n\n Similarities in the use of DLL Hollowing\n\n All three samples exhibit the capability to load bundled payloads through DLL hollowing. Notably, the 2024 version of StealthVector shares an identical list of blocklisted DLLs with DodgeBox.\n### To Be Continued\n\n###### DodgeBox is a newly identified malware loader that employs multiple techniques to evade both static and behavioral detection. Based on a combination of known TTPs, potential countries targeted, and similarities with StealthVector, we have attributed this activity to the China-based nation state threat actor APT41 with moderate confidence. In our journey through Part 1 of this series, we analyzed the technical details surrounding DodgeBox, and its similarities with StealthVector. In Part 2, we will analyze the MoonWalk backdoor - which is dropped by DodgeBox.\n\n### Zscaler Coverage\n\n###### Zscaler’s multilayered cloud security platform detects indicators related to DodgeBox at various levels with the following threat names\n\n\n-----\n\n###### Win64.Backdoor.Moonwalk Win32.Backdoor.APT41 Win64.Backdoor.APT41\n### Indicators Of Compromise (IOCs)\n\n###### MD5 Filename\n\n 0d068b6d0523f069d\n```\n              Music.zip 1ada59c12891c4a\n\n b3067f382d70705d4\n              taskhost.exe c8f6977a7d7bee4\n\n d72f202c1d684c9a19f\n              Sbiedll.dll 075290a60920f\n\n 294cc02db5a122e3a1\n              Sbiedll.dat bc4f07997956da\n\n 393065ef9754e3f39b\n              Atstrust.dll 24b2d1051eab61\n\n bcac2cbda36019776d\n              Atstrust.dat 7861f12d9b59c4\n\n f062183da590aba5e9\n              AppRouted.dll 11d2392bc29181\n\n 4141c4b827ff67c180\n              AppRouteing.dll 096ff5f2cc1474\n\n```\n|MD5|Filename|Description|\n|---|---|---|\n|0d068b6d0523f069d 1ada59c12891c4a|Music.zip|ZIP archive containing DodgeBox samples.|\n|b3067f382d70705d4 c8f6977a7d7bee4|taskhost.exe|Original Sandboxie signed binary.|\n|d72f202c1d684c9a19f 075290a60920f|Sbiedll.dll|DodgeBox DLL sideloaded by taskhost.exe.|\n|294cc02db5a122e3a1 bc4f07997956da|Sbiedll.dat|Encrypted payload DLL that decrypts to the MoonWalk backdoor.|\n|393065ef9754e3f39b 24b2d1051eab61|Atstrust.dll|DodgeBox DLL which is sideloaded by an undetermined AhnLab executable.|\n|bcac2cbda36019776d 7861f12d9b59c4|Atstrust.dat|Encrypted payload DLL that decrypts the MoonWalk backdoor.|\n|f062183da590aba5e9 11d2392bc29181|AppRouted.dll|2024 StealthVector loader.|\n\n\n###### Encrypted shellcode and payload DLL that decrypts to CobaltStrike.\n\n\n-----\n\n|MD5|Filename|Description|\n|---|---|---|\n|bc85062de0f70afd4 4bb072b0b71a8cc|N/A|2024 StealthVector loader|\n|72070b165d1f11bd4d 009a81bf28a3e5|mscms.dll|2024 StealthVector loader|\n|f0953ed4a679b987a2 da955788737602|roboform-x64.dll|2024 StealthVector loader|\n\n\n### MITRE ATT&CK Framework\n\n|Tactic|ID|Technique|Description|\n|---|---|---|---|\n|Defense Evasion|T1574.002|Hijack Execution Flow: DLL Side-Loading|DodgeBox samples are designed to be executed by DLL sideloading.|\n\n\n###### Defense Evasion\n\n\n###### T1480 Execution Guardrails\n\n\n###### DodgeBox terminates execution if specific arguments are not provided.\n DodgeBox contains capabilities to restrict execution to machines with specific MAC\n\n\n-----\n\n|Tactic|ID|Technique|Description|\n|---|---|---|---|\n||||computer names, and user names.|\n|Defense Evasion|T1480.001|Execution Guardrails: Environmental Keying|DodgeBox keys the encrypted payload to a machine, using a machine’s GUID.|\n|Defense Evasion|T1027|Obfuscated Files or Information|DodgeBox uses AES-CFB to encrypt strings, confgi urations, and bundled payloads.|\n|Defense Evasion|T1027.007|Obfuscated Files or Information: Dynamic API Resolution|DodgeBox uses salted FNV1a hashes to dynamically resolve APIs.|\n|Defense Evasion|T1620|Reflective Code Loading|DodgeBox reflectively loads payload DLLs, utilizing DLL hollowing.|\n\n\n###### Defense Evasion\n\n\n###### T1106 Native API DodgeBox uses Windows Native APIs like NtCreate\n```\n                   File, LdrLoa\n                   dDll,\n\n```\n\n-----\n\n###### Tactic ID Technique Description\n\n|Col1|Col2|Col3|teVirtualMe mory, as opposed to their Win32 counterparts.|\n|---|---|---|---|\n\n\n###### DodgeBox utilizes stack spoofing when calling APIs to evade security software monitoring.\n DodgeBox performs a scan within its own address space to detect any alterations, such as hooks or debugger breakpoints. If it identifies any signs of modification, DodgeBox takes action to restore the original code from disk, effectively undoing any unauthorized changes made to its code.\n\n\n###### Defense T1562.001 Evasion\n\n\n###### Impair Defenses: Disable or Modify Tools\n\n\n-----\n\n###### An example decrypted configuration of DodgeBox is shown in the figure below.\n\n\n-----\n\n```\ndef fnv1a_salted(data, salt, seed_value=0x811c9dc5):\n  _data = data + salt\n  _hash = seed_value\n  prime = 0x01000193\n  for byte in _data:\n    _hash ^= byte\n    _hash *= prime\n    _hash &= 0xFFFFFFFF\n  return _hash\n# ntdll in utf-16\nntdll = b\"n\\x00t\\x00d\\x00l\\x00l\\x00\"\nsalt = b\"\\xba\\xb4\\x24\\xcb\"\nprint(hex(fnv1a_salted(ntdll, salt))) # 0xfe0b07b0\nldrloaddll = b\"LdrLoadDll\"\nprint(hex(fnv1a_salted(ldrloaddll, salt))) # 0xca7bb6ac\n\n```\n\n###### DodgeBox’s list of blocklisted DLLs is shown below.\n\n```\nadvapi32.dll\n\n```\n```\nbcrypt.dll\n\n```\n```\nbcryptprimitives.dll\n\n```\n```\ncfgmgr32.dll\n\n```\n```\ncombase.dll\n\n```\n```\ncryptbase.dll\n\n```\n```\ncryptsp.dll\n\n```\n```\ndhcpcsvc.dll\n\n```\n```\ndhcpcsvc6.dll\n\n```\n```\ndnsapi.dll\n\n```\n```\nFWPUCLNT.DLL\n\n```\n```\ngdi32.dll\n\n```\n```\ngdi32full.dll\n\n```\n```\niertutil.dll\n\n```\n```\nimm32.dll\n\n```\n```\nIPHLPAPI.DLL\n\n```\n```\nkernel appcore dll\n\n```\n\n-----\n\n```\nKernelBase.dll\n\n```\n```\nlocale.nls\n\n```\n```\nmsvcp_win.dll\n\n```\n```\nmsvcrt.dll\n\n```\n```\nmswsock.dll\nNapiNSP.dll\n\n```\n```\nnlaapi.dll\n\n```\n```\nnsi.dll\n\n```\n```\nntdll.dll\n\n```\n```\nntmarta.dll\n\n```\n```\noleaut32.dll\n\n```\n```\nOnDemandConnRouteHelper.dll\n\n```\n```\npnrpnsp.dll\n\n```\n```\npowrprof.dll\n\n```\n```\napphelp.dll\nprofapi.dll\n\n```\n```\nrasadhlp.dll\n\n```\n```\nrpcrt4.dll\nrsaenh.dll\n\n```\n```\nsechost.dll\n\n```\n```\nSHCore.dll\n\n```\n```\nshell32.dll\nshlwapi.dll\nsspicli.dll\n\n```\n```\nucrtbase.dll\n\n```\n```\nurlmon.dll\nuser32.dll\n\n```\n```\nuserenv.dll\n\n```\n```\nwebio.dll\n\n```\n```\nwin32u.dll\n\n```\n```\nwindows.storage.dll\n\n```\n```\nwinhttp.dll\nwininet.dll\n\n```\n```\nwinnlsres.dll\n\n```\n```\nwinnsi.dll\n\n```\n```\ninrnr dll\n\n```\n\n-----\n\n```\nws2_32.dll\nwshbth.dll\n\n```\n```\nwtsapi32.dll\n\n```\n\nNot really\n\n\n### Explore more Zscaler blogs\n\n\n##### Kimsuky deploys TRANSLATEXT to target South Korean academia\n\n\n##### The Return of the Higaisa APT\n\n\nYes, very!\n\n\n-----\n\n# Get the latest Zscaler blog\n updates in your inbox\n\n\n**T H E Z S C A L E R E X P E R I E N C E**\n\n**P R O D U C T S & S O LU T I O N S**\n\n**P L AT F O R M**\n\n**R E S O U R C E S**\n\n\n**P O P U L A R L I N K S**\n\n**English**\n\nZscaler is universally recognized as the leader in zero trust. Leveraging the largest security cloud on the planet, Zscaler anticipates, secures,\nand simplifies the experience of doing business for the world's most established companies.\n\nPlease enter your email to subscribe **→**\n\n\n-----\n\n[Sitemap](https://www.zscaler.com/sitemap.xml) [Privacy](https://www.zscaler.com/privacy/overview) [Legal](https://www.zscaler.com/legal/overview) [Security](https://www.zscaler.com/security/vulnerability-disclosure-program)\n\n\n**© 2024 Zscaler, Inc.** All rights reserved. Zscaler™ and other trademarks listed at zscaler.com/legal/trademarks are either (i) registered\n\ntrademarks or service marks or (ii) trademarks or service marks of Zscaler, Inc. in the United States and/or other countries. Any other\ntrademarks are the properties of their respective owners.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2024/2024.07.10.A_deep_dive_into_the_updated_arsenal_of_APT41/DodgeBox_A_deep_dive_into_the_updated_arsenal_of_APT41.pdf"
    ],
    "report_names": [
        "DodgeBox_A_deep_dive_into_the_updated_arsenal_of_APT41"
    ],
    "threat_actors": [
        {
            "id": "873919c0-bc6a-4c19-b18d-c107e4aa3d20",
            "created_at": "2023-01-06T13:46:39.138138Z",
            "updated_at": "2025-03-27T02:00:03.005534Z",
            "deleted_at": null,
            "main_name": "Higaisa",
            "aliases": [],
            "source_name": "MISPGALAXY:Higaisa",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "dc78f675-b309-431d-8160-b8dcff037d4f",
            "created_at": "2024-05-01T02:03:08.142224Z",
            "updated_at": "2025-03-27T02:05:17.417972Z",
            "deleted_at": null,
            "main_name": "NICKEL KIMBALL",
            "aliases": [
                "Black Banshee ",
                "Crooked Pisces ",
                "Emerald Sleet ",
                "Kimsuky ",
                "Opal Sleet ",
                "SharpTongue ",
                "TA427 ",
                "THALLIUM ",
                "Velvet Chollima ",
                "APT43 "
            ],
            "source_name": "Secureworks:NICKEL KIMBALL",
            "tools": [
                " KONNI",
                " KimJongRAT",
                " Kimsuky",
                "BabyShark"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "30c9c492-afc6-4aa1-8fe6-cecffed946e0",
            "created_at": "2022-10-25T15:50:23.400822Z",
            "updated_at": "2025-03-27T02:00:55.461334Z",
            "deleted_at": null,
            "main_name": "Higaisa",
            "aliases": [
                "Higaisa"
            ],
            "source_name": "MITRE:Higaisa",
            "tools": [
                "PlugX",
                "certutil",
                "gh0st RAT"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "4c68ccd0-caba-4189-9ead-86ac4c2d9b70",
            "created_at": "2024-05-01T02:03:07.930196Z",
            "updated_at": "2025-03-27T02:05:17.251237Z",
            "deleted_at": null,
            "main_name": "BRONZE ATLAS",
            "aliases": [
                "Axiom",
                "BARIUM ",
                "Blackfly ",
                "CTG-2633",
                "GREF",
                "Group 72 ",
                "Red Kelpie ",
                "TG-2633 ",
                "Wicked Panda ",
                "Winnti",
                "APT41 "
            ],
            "source_name": "Secureworks:BRONZE ATLAS",
            "tools": [
                " CCleaner v5.33 backdoor",
                " ChinaChopper",
                " Cobalt Strike",
                " Dicey MSDN",
                " ForkPlayground",
                " HUC Proxy Malware (Htran)",
                " Mimikatz",
                " PipeMon",
                " PlugX",
                " PortReuse",
                " Powershell Empire",
                " RCMD",
                " RbDoor",
                " SPEEDBOAT",
                " ShadowPad",
                " Sidewalk",
                " Speculoos",
                " TeamViewer",
                " Winnkit",
                " Winnti",
                " reg save",
                " vssadmin",
                "Acehash"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "760f2827-1718-4eed-8234-4027c1346145",
            "created_at": "2023-01-06T13:46:38.670947Z",
            "updated_at": "2025-03-27T02:00:02.888195Z",
            "deleted_at": null,
            "main_name": "Kimsuky",
            "aliases": [
                "Thallium",
                "G0086",
                "APT43",
                "Springtail",
                "Sparkling Pisces",
                "Velvet Chollima",
                "Black Banshee",
                "Operation Stolen Pencil",
                "Emerald Sleet",
                "THALLIUM"
            ],
            "source_name": "MISPGALAXY:Kimsuky",
            "tools": [
                "RevClient",
                "xrat",
                "QUASARRAT",
                "RDP Wrapper",
                "TightVNC",
                "BabyShark"
            ],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "191d7f9a-8c3c-442a-9f13-debe259d4cc2",
            "created_at": "2022-10-25T15:50:23.280374Z",
            "updated_at": "2025-03-27T02:00:55.423485Z",
            "deleted_at": null,
            "main_name": "Kimsuky",
            "aliases": [
                "Kimsuky",
                "Black Banshee",
                "Velvet Chollima",
                "Emerald Sleet",
                "THALLIUM",
                "APT43",
                "TA427"
            ],
            "source_name": "MITRE:Kimsuky",
            "tools": [
                "schtasks",
                "Amadey",
                "Brave Prince",
                "CSPY Downloader",
                "gh0st RAT",
                "AppleSeed",
                "NOKKI",
                "QuasarRAT",
                "Gold Dragon",
                "PsExec",
                "KGH_SPY",
                "Mimikatz",
                "BabyShark"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "c0cedde3-5a9b-430f-9b77-e6568307205e",
            "created_at": "2022-10-25T16:07:23.528994Z",
            "updated_at": "2025-03-27T02:02:09.847683Z",
            "deleted_at": null,
            "main_name": "DarkHotel",
            "aliases": [
                "APT-C-06",
                "ATK 52",
                "CTG-1948",
                "Dubnium",
                "Fallout Team",
                "Higaisa",
                "Luder",
                "Operation DarkHotel",
                "Operation Daybreak",
                "Operation Inexsmar",
                "Operation PowerFall",
                "Operation The Gh0st Remains the Same",
                "SIG25",
                "Shadow Crane",
                "T-APT-02",
                "Tungsten Bridge",
                "Zigzag Hail"
            ],
            "source_name": "ETDA:DarkHotel",
            "tools": [
                "Asruex",
                "DarkHotel",
                "DmaUp3.exe",
                "GreezeBackdoor",
                "Karba",
                "Nemain",
                "Nemim",
                "Ramsay",
                "Retro",
                "Tapaoux",
                "Trojan.Win32.Karba.e",
                "Virus.Win32.Pioneer.dx",
                "igfxext.exe",
                "msieckc.exe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "c7d9878a-e691-4c6f-81ae-84fb115a1345",
            "created_at": "2022-10-25T16:07:23.359506Z",
            "updated_at": "2025-03-27T02:02:09.752427Z",
            "deleted_at": null,
            "main_name": "APT 41",
            "aliases": [
                "BrazenBamboo",
                "Bronze Atlas",
                "Double Dragon",
                "Earth Baku",
                "Grayfly",
                "Operation ColunmTK",
                "Operation CuckooBees",
                "Operation ShadowHammer",
                "Red Kelpie",
                "SparklingGoblin",
                "TA415",
                "TG-2633"
            ],
            "source_name": "ETDA:APT 41",
            "tools": [
                "9002 RAT",
                "ADORE.XSEC",
                "ASPXSpy",
                "ASPXTool",
                "AceHash",
                "Agent.dhwf",
                "Agentemis",
                "AndroidControl",
                "AngryRebel",
                "AntSword",
                "BIOPASS",
                "BIOPASS RAT",
                "BLUEBEAM",
                "Barlaiy",
                "BlackCoffee",
                "Bladabindi",
                "BleDoor",
                "CCleaner Backdoor",
                "CHINACHOPPER",
                "COLDJAVA",
                "China Chopper",
                "ChyNode",
                "Cobalt Strike",
                "CobaltStrike",
                "Crackshot",
                "CrossWalk",
                "CurveLast",
                "CurveLoad",
                "DAYJOB",
                "DBoxAgent",
                "DEADEYE",
                "DEADEYE.APPEND",
                "DEADEYE.EMBED",
                "DEPLOYLOG",
                "DIRTCLEANER",
                "DUSTTRAP",
                "Derusbi",
                "Destroy RAT",
                "DestroyRAT",
                "DodgeBox",
                "DragonEgg",
                "ELFSHELF",
                "EasyNight",
                "Farfli",
                "FunnySwitch",
                "Gh0st RAT",
                "Ghost RAT",
                "HDD Rootkit",
                "HDRoot",
                "HKDOOR",
                "HOMEUNIX",
                "HUI Loader",
                "HidraQ",
                "HighNoon",
                "HighNote",
                "Homux",
                "Hydraq",
                "Jorik",
                "Jumpall",
                "KEYPLUG",
                "Kaba",
                "Korplug",
                "LATELUNCH",
                "LOLBAS",
                "LOLBins",
                "LightSpy",
                "Living off the Land",
                "Lowkey",
                "McRAT",
                "MdmBot",
                "MessageTap",
                "Meterpreter",
                "Mimikatz",
                "MoonBounce",
                "MoonWalk",
                "Motnug",
                "Moudour",
                "Mydoor",
                "NTDSDump",
                "PACMAN",
                "PCRat",
                "PINEGROVE",
                "PNGRAT",
                "POISONPLUG",
                "POISONPLUG.SHADOW",
                "POTROAST",
                "PRIVATELOG",
                "PipeMon",
                "PlugX",
                "PortReuse",
                "ProxIP",
                "ROCKBOOT",
                "RbDoor",
                "RedDelta",
                "RedXOR",
                "RibDoor",
                "Roarur",
                "RouterGod",
                "SAGEHIRE",
                "SPARKLOG",
                "SQLULDR2",
                "STASHLOG",
                "SWEETCANDLE",
                "ScrambleCross",
                "Sensocode",
                "SerialVlogger",
                "ShadowHammer",
                "ShadowPad Winnti",
                "SinoChopper",
                "Skip-2.0",
                "SneakCross",
                "Sogu",
                "Speculoos",
                "Spyder",
                "StealthReacher",
                "StealthVector",
                "TERA",
                "TIDYELF",
                "TIGERPLUG",
                "TOMMYGUN",
                "TVT",
                "Thoper",
                "Voldemort",
                "WIDETONE",
                "WINNKIT",
                "WINTERLOVE",
                "Winnti",
                "WyrmSpy",
                "X-Door",
                "XDOOR",
                "XMRig",
                "XShellGhost",
                "Xamtrav",
                "ZXShell",
                "ZoxPNG",
                "certutil",
                "certutil.exe",
                "cobeacon",
                "gresim",
                "njRAT",
                "pwdump",
                "xDll"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "4d5f939b-aea9-4a0e-8bff-003079a261ea",
            "created_at": "2023-01-06T13:46:39.04841Z",
            "updated_at": "2025-03-27T02:00:02.985296Z",
            "deleted_at": null,
            "main_name": "APT41",
            "aliases": [
                "G0096",
                "Grayfly",
                "BARIUM",
                "BRONZE ATLAS",
                "BRONZE EXPORT",
                "Red Kelpie",
                "HOODOO",
                "Brass Typhoon",
                "TA415",
                "WICKED SPIDER",
                "WICKED PANDA",
                "G0044",
                "Earth Baku"
            ],
            "source_name": "MISPGALAXY:APT41",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "e698860d-57e8-4780-b7c3-41e5a8314ec0",
            "created_at": "2022-10-25T15:50:23.287929Z",
            "updated_at": "2025-03-27T02:00:55.43005Z",
            "deleted_at": null,
            "main_name": "APT41",
            "aliases": [
                "APT41",
                "Wicked Panda",
                "Brass Typhoon",
                "BARIUM"
            ],
            "source_name": "MITRE:APT41",
            "tools": [
                "ASPXSpy",
                "BITSAdmin",
                "PlugX",
                "Impacket",
                "gh0st RAT",
                "netstat",
                "PowerSploit",
                "ZxShell",
                "KEYPLUG",
                "ipconfig",
                "sqlmap",
                "China Chopper",
                "ShadowPad",
                "MESSAGETAP",
                "Mimikatz",
                "certutil",
                "njRAT",
                "Cobalt Strike",
                "pwdump",
                "BLACKCOFFEE",
                "ROCKBOOT",
                "dsquery",
                "Winnti for Linux",
                "DUSTTRAP",
                "Derusbi",
                "ftp"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "71a1e16c-3ba6-4193-be62-be53527817bc",
            "created_at": "2022-10-25T16:07:23.753455Z",
            "updated_at": "2025-03-27T02:02:09.963016Z",
            "deleted_at": null,
            "main_name": "Kimsuky",
            "aliases": [
                "APT 43",
                "Black Banshee",
                "Emerald Sleet",
                "ITG16",
                "KTA082",
                "Kimsuky",
                "Larva-24005",
                "Operation Baby Coin",
                "Operation Covert Stalker",
                "Operation DEEP#DRIVE",
                "Operation DEEP#GOSU",
                "Operation Kabar Cobra",
                "Operation Mystery Baby",
                "Operation Red Salt",
                "Operation Smoke Screen",
                "Operation Stealth Power",
                "Operation Stolen Pencil",
                "SharpTongue",
                "Sparkling Pisces",
                "Springtail",
                "TA406",
                "TA427",
                "Thallium",
                "UAT-5394",
                "Velvet Chollima"
            ],
            "source_name": "ETDA:Kimsuky",
            "tools": [
                "AngryRebel",
                "AppleSeed",
                "BITTERSWEET",
                "BabyShark",
                "BoBoStealer",
                "CSPY Downloader",
                "Farfli",
                "FlowerPower",
                "Gh0st RAT",
                "Ghost RAT",
                "Gold Dragon",
                "GoldDragon",
                "GoldStamp",
                "JamBog",
                "KGH Spyware Suite",
                "KGH_SPY",
                "KPortScan",
                "KimJongRAT",
                "Kimsuky",
                "LATEOP",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Lovexxx",
                "MailPassView",
                "Mechanical",
                "Mimikatz",
                "MoonPeak",
                "Moudour",
                "MyDogs",
                "Mydoor",
                "Network Password Recovery",
                "PCRat",
                "ProcDump",
                "PsExec",
                "ReconShark",
                "Remote Desktop PassView",
                "SHARPEXT",
                "SWEETDROP",
                "SmallTiger",
                "SniffPass",
                "TODDLERSHARK",
                "TRANSLATEXT",
                "Troll Stealer",
                "TrollAgent",
                "VENOMBITE",
                "WebBrowserPassView",
                "xRAT"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1721959545,
    "ts_updated_at": 1743041815,
    "ts_creation_date": 1721914221,
    "ts_modification_date": 1721914221,
    "files": {
        "pdf": "https://archive.orkl.eu/b409b56d8ac0e2a4a72b934b45fb288dbaffec04.pdf",
        "text": "https://archive.orkl.eu/b409b56d8ac0e2a4a72b934b45fb288dbaffec04.txt",
        "img": "https://archive.orkl.eu/b409b56d8ac0e2a4a72b934b45fb288dbaffec04.jpg"
    }
}