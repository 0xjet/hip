{
    "id": "60d8a41a-9a1e-4319-a248-fbe8a1fbb664",
    "created_at": "2023-01-12T15:09:02.252077Z",
    "updated_at": "2025-03-27T02:09:18.011015Z",
    "deleted_at": null,
    "sha1_hash": "15491d0540a73f0088dee5b474464eadb1f5ca20",
    "title": "2022-07-14 - BlackCat ransomware attacks not merely a byproduct of bad luck",
    "authors": "",
    "file_creation_date": "2022-08-18T03:25:16Z",
    "file_modification_date": "2022-08-18T03:25:16Z",
    "file_size": 690881,
    "plain_text": "# BlackCat ransomware attacks not merely a byproduct of bad luck\n\n**[news.sophos.com/en-us/2022/07/14/blackcat-ransomware-attacks-not-merely-a-byproduct-of-bad-luck/](https://news.sophos.com/en-us/2022/07/14/blackcat-ransomware-attacks-not-merely-a-byproduct-of-bad-luck/)**\n\nAndrew Brandt July 14, 2022\n\nA ransomware group attacking large organizations with malware called BlackCat has\nfollowed a consistent pattern over the past several months: The threat actors break in to\nenterprise networks by exploiting vulnerabilities in unpatched or outdated firewall/VPN\ndevices, then pivot to internal systems after establishing a foothold from the firewall.\n\nSince December 2021, Sophos has been called in to investigate at least five attacks\ninvolving this ransomware. In two of the cases, the attackers made their initial access to the\ntarget’s network by exploiting a vulnerability that was first disclosed in 2018 and affected a\nparticular firewall vendor’s product. In two others, the attackers targeted a different firewall\nvendor’s product with a vulnerability that was disclosed last year.\n\nIn all but one of the incidents we investigated, the vulnerabilities permitted the attackers to\nobtain VPN credentials from memory on the firewall devices, which they could then use to\nlog in to the VPN as if they were an authorized user. None of the targets used multifactor\nauthentication for these VPNs. The one outlier appears to have been a spearphishing attack\nthat revealed an internal user’s VPN login credentials to the attackers.\n\n\n-----\n\nOnce inside the network, the attackers predominantly used RDP to move laterally between\ncomputers, conducting brute-force attacks over the VPN connection against the\nAdministrator account on machines inside the network. The ransomware executable has\nfunctionality to spread itself laterally to Windows machines, as well as specific capabilities\ndesigned to target VMware ESXi hypervisor servers.\n\nThe command flags that can be used with BlackCat\nIn one case, when Sophos incident responders removed the compromised VPN accounts\nfrom the firewall and created new username/password combinations, the attacker just ran\nthe same exploit a second time and was able to extract newly created passwords that were\nbeing used in the incident response, and carry on attempting to encrypt machines.\n\n### Wide Range of Remote Access Tools\n\nOnce they had gained a foothold on an internal computer, the attackers installed various\nremote access utilities to give themselves backup methods of remotely connecting to the\ntargets’ networks. Attackers used the commercial tools AnyDesk and TeamViewer, and also\ninstalled a remote access tool called ngrok.\n\nA portion of the PowerShell script used by threat actors to install commercial remote access\n\n\n-----\n\ntool AnyDesk on targeted systems, and assign a password of Password123X to the client\nThe attackers also used PowerShell commands to download and execute Cobalt Strike\nbeacons on some machines, and a tool called Brute Ratel, which is a more recent\npentesting suite with Cobalt Strike-like remote access features. The attackers had installed\nthe Brute Ratel binary as a Windows service named wewe on at least one affected machine.\n\nThe Brute Ratel configuration file, decrypted\nInvestigating the ransomware cases were complicated by the fact that some of the targeted\norganizations were running servers that had previously been compromised using the Log4j\nvulnerability; Some servers were discovered to have been running a variety of cryptominers\nand other nuisance malware that were unrelated to the ransomware incident.\n\nComplicating the analysis, the ransomware binary itself requires that whoever deploys it\nadds an “access token” (a 64-byte hexadecimal string) to the command line that launches\nthe executable, or else it won’t run. During test executions of the ransomware, it engages in\nan attempt to discover Windows network shares and copy itself to those locations. When run\nin a Windows virtual machine, the ransomware mounted several shares as new drive letters\nand duplicated itself to the root of those drives.\n\nIn addition to ransoming computers on the network, the threat actors spent some time\nsearching around for, collecting, and then exfiltrating large volumes of sensitive data from the\ntargets, uploading them to the cloud storage provider Mega. The attackers used a third-party\ntool called DirLister to create a list of accessible directories and files, or in some cases used\na PowerShell script from a pentester toolkit, called PowerView.ps1, to enumerate the\nmachines on the network, and in some cases they used a tool called LaZagne to extract\npasswords saved on various devices.\n\nOnce the attackers had collected the files they planned to exfiltrate, they used the WinRAR\ncompression utility to compress the files into .rar archives. They used a tool called rsync to\nupload the stolen data from some networks, but also used Mega’s own MEGASync\nsoftware, or in some cases, just the Chrome browser.\n\n\n-----\n\nDuring the data collection process, the attackers ran various PowerShell scripts that could\nfind and extract saved credentials. For instance, an attacker in the February attack left\nbehind a file named Veeam-Get-Creds.ps1, which can extract saved passwords used by\nVeeam software to connect to remote hosts.\n\nAside from the abuse of vulnerable firewalls as a point of entry, and the fact the targets had\nlots of vulnerable machines inside their network, there weren’t any consistent characteristics\nof the victims who were attacked. Two of the targeted companies are based in Asia, one in\nEurope. The industry segment in which each of the targets do business is distinct from the\nothers.\n\n### Getting Inside Was the Easy Part\n\nThe initial break-ins in each case took place before the target engaged Sophos for incident\nresponse. In the earliest case, where we began working with the target in early December,\nwe found evidence that the attackers had penetrated the network as much as a month prior\nto when we began the investigation and had installed cryptominer software on 16 servers\ninside the company network in early November.\n\nThe BlackCat ransom note\nThe attackers in this incident (and in several others as well) dumped the LSASS password\nstore to obtain valid credentials on a domain controller, then used those to create a new\naccount with administrative privileges. The attackers ran a tool called netscan_portable.exe\n\n\n-----\n\nto find additional targets, then used that newly created account to RDP from machine to\nmachine within the network.\n\nIn an attack that took place in February, the attackers had previously exploited the VPN\nvulnerability to obtain valid credentials, then used them to log in to the enterprise network.\nFive days after obtaining the VPN credentials, the attackers connected to the VPN and\nconducted a brute-force password spray attack against a domain controller. They then\ncreated a new domain admin account, installed AnyDesk on the DC (presumably as a\nbackup), and used RDP to pivot from machine to machine.\n\nThe attackers also installed a tool called rclone, which Sophos has observed other threat\nactors using to upload data to cloud storage providers. Two weeks after that initial flurry of\nactivity, the attacker installed a second data uploading tool, MEGASync, from another user’s\ncompromised account, and began to exfiltrate sensitive data. This suggests that the attacker\nuploaded data more than once, from two or more servers, using at least these two methods.\n\nIn an attack that took place in March, our analysts discovered that the BlackCat attackers\nhad run through a similar game plan to the prior attacks: They exploited a firewall\nvulnerability, gained remote access through the VPN, and then pivoted internally to target\ndomain controllers and other servers. The team found evidence of Cobalt Strike\nbeacons/Brute Ratel executables, scripts for performing reconnaissance, and evidence of\nstaging data for exfiltration, but no evidence that it had been uploaded anywhere.\n\n## Custom Malware for Each Target\n\nAs seems to be commonplace in ransomware attacks in 2022, the attackers crafted a\ncustom ransomware binary for each target. The executable contained the ransom note\ncustomized to each targeted organization with a link to the BlackCat TOR server where the\nthreat actors would publish examples of stolen data.\n\nThe ransomware, when executed, appended a seven-letter file suffix to every encrypted file.\nThe suffix was unique to each targeted organization, applied consistently wherever the\nattackers could opportunistically launch it.\n\nThe attack in December 2021 mainly targeted ESXi servers and encrypted the virtual hard\ndisks for VMs hosted in the hypervisor, rendering those machines inaccessible. During the\ninvestigation, Sophos found that more than half the organization’s computers were running\nWindows 7, for which Microsoft ended support in January 2020.\n\n\n-----\n\nBlackCat attempts to stop a wide range of programs and services before encrypting, such as\nIIS, Microsoft’s web service\nAs in the December attack, the attack that took place in March also involved hypervisors:\nThe attackers targeted a Hyper-V server and encrypted the virtual disk files for VMs running\non that server. But that attack also targeted desktops and laptops as widely as possible on\nthe enterprise network. The attack in February targeted both servers and other endpoints. An\nattack that took place in May involved a Citrix server.\n\n### Environmental Issues\n\nWe found significant number of systems that had fallen outside of the availability of security\npatches. The networks at each target were flat, with every machine able to see every other\nmachine in the network – something that made it extremely easy for the attackers to scan for\nand identify targets of greatest value. Segregating portions of the network from one another\nusing VLANs would have helped.\n\nThe firewall bugs were old, and there was evidence that VPN credentials for one of the\nfirewalls had been leaked in a public distribution of VPN username/password combinations\nseveral years ago. Had the target applied the available patches to those firewalls in a more\ntimely manner, things would have been much more complicated for the attackers.\n\nNone of the targets were using multifactor authentication for their VPN logins, which would\nhave stopped the attackers cold.\n\nFirewall and user account permissions that provide the least-possible access would also\nhave gone a long way to limiting the damage from the attackers.\n\nThe presence of ngrok, a legitimate remote-access tool often abused by attackers, could\nalso have provided an alert to watchful sysadmins. Sophos has an incident response\nplaybook available for those looking to understand how ngrok is abused in cases such as\nthis and how ngrok misuse can be investigated and mitigated on the network.\n\n### Acknowledgments\n\n\n-----\n\nSophosLabs wishes to acknowledge the contributions of Sergio Bestulic, Harinder Bhathal,\nAndy French, Bill Kearney, Lee Kirkpatrick, Elida Leite, Peter Mackenzie, and Robert\nWeiland, for their help with this report. IOCs relating to the tools used in this attack are\nposted to the SophosLabs Github, with the exception of the file hashes of the ransomware\nitself, which could identify the targets.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-07-14 - BlackCat ransomware attacks not merely a byproduct of bad luck.pdf"
    ],
    "report_names": [
        "2022-07-14 - BlackCat ransomware attacks not merely a byproduct of bad luck.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536142,
    "ts_updated_at": 1743041358,
    "ts_creation_date": 1660793116,
    "ts_modification_date": 1660793116,
    "files": {
        "pdf": "https://archive.orkl.eu/15491d0540a73f0088dee5b474464eadb1f5ca20.pdf",
        "text": "https://archive.orkl.eu/15491d0540a73f0088dee5b474464eadb1f5ca20.txt",
        "img": "https://archive.orkl.eu/15491d0540a73f0088dee5b474464eadb1f5ca20.jpg"
    }
}