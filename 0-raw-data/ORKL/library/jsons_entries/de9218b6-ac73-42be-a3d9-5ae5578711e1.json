{
    "id": "de9218b6-ac73-42be-a3d9-5ae5578711e1",
    "created_at": "2023-01-12T15:04:55.969749Z",
    "updated_at": "2025-03-27T02:16:47.053309Z",
    "deleted_at": null,
    "sha1_hash": "4633c1e222caba054f61e04c6bafefc1fef1cbb4",
    "title": "2021-01-27 - CrimsonIAS- Listening for an 3v1l User",
    "authors": "",
    "file_creation_date": "2022-05-28T23:08:15Z",
    "file_modification_date": "2022-05-28T23:08:15Z",
    "file_size": 1530010,
    "plain_text": "# Cyber Threat Intelligence Research\n\n**threatconnect.com/blog/crimsonias-listening-for-an-3v1l-user/**\n\n## Executive Summary\n\n\nJanuary 27, 2021\n\n\n[CrimsonIAS is a Delphi-written backdoor dating back to at least 2017 that enables operators to run command line tools, exfiltrate files, and](https://app.threatconnect.com/auth/threat/threat.xhtml?threat=4628848921#/)\nupload files to the infected machine. CrimsonIAS is notable as it listens for incoming connections only; making it different from typical Windows\n[backdoors that beacons out. The characteristics found in CrimsonIAS’s execution flow suggest a connection to Mustang Panda (aka BRONZE](https://threatconnect.com/blog/research-roundup-mustang-panda-and-reddelta-plugx-using-same-c2/)\nPRESIDENT, RedDelta) PlugX samples. Based on those non-unique characteristics, ThreatConnect assesses with low confidence that\nCrimsonIAS is an additional tool in Mustang Panda’s repertoire. Industry reporting assesses with varying levels of confidence that Mustang\n[Panda is a Chinese espionage actor that has conducted operations in Mongolia,](https://www.crowdstrike.com/blog/meet-crowdstrikes-adversary-of-the-month-for-june-mustang-panda/) [Vietnam, and Hong Kong among other locations. According](https://www.avira.com/en/blog/new-wave-of-plugx-targets-hong-kong)\nto [fellow researchers, Mustang Panda targets non-government organizations (NGOs), law enforcement organizations, and political entities.](https://www.secureworks.com/research/bronze-president-targets-ngos)\n\n## Discovery\n\nThreatConnect identified CrimsonIAS while hunting for XOR encrypted PlugX binaries. The CrimsonIAS backdoor is encrypted similarly to\nrecent MustangPanda PlugX samples, which piqued our interest.\n\nEncrypted SHA256: acfd58369c0a7dbc866ad4ca9cb0fe69d017587af88297f1eaf62a9a8b1b74b4\n\nDecrypted SHA256: 891ece4c40a7bf31f414200c8c2c31192fd159c1316012724f3013bd0ab2a68e\n\n## CrimsonIAS Analysis\n\nThe developers behind CrimsonIAS wrote this backdoor using Delphi. They also added some features that changed the normal execution flow\nstarting with shell code embedded in the MZ header. Windows executables are not designed to execute code from the MZ header; they have a\ndedicated section (outside of the MZ header) for executable code. The actor is able to work around this design choice to start execution in the\nMZ header based on how we suspect the binary is loaded. This shell code calls a reflective loader function which resolves additional library\nfunctions needed before jumping to the malware’s actual entrypoint. The binary was also XOR encrypted with a 10 byte XOR key prepended to\n[the binary (T1140: Deobfuscate/Decode Files or Information). All of these are also seen in Mustang Panda’s PlugX samples.](https://attack.mitre.org/techniques/T1140/)\n\nThis backdoor spins up a listener and awaits the operator’s commands to run command line tools, exfiltrate files, and upload files to the\ninfected machine. Prior to spinning up the network listener, CrimsonIAS launches netsh.exe to open a port on the local machine (T1562.004:\nImpair Defenses: Disable or Modify System Firewall). This sample opens port 80.\n\n\n-----\n\n## Command and Control\n\n[When receiving network traffic, the listener’s handler first checks for the presence of the marker 0x33669966 (T1205: Traffic Signaling). If it](https://attack.mitre.org/techniques/T1205/)\nmatches, then the handler proceeds to parse the first 24 bytes.\n\nThe first 24 bytes make up the command header; however, only the first three DWORDs appear to be used.\n\nThe command buffer starts at offset 24 (0x18) and its content differs based upon the command code specified.\n\nThe three command codes are:\n\n[0x6600 : Run Command (T1059.003: Command and Scripting Interpreter: Windows Command Shell)](https://attack.mitre.org/techniques/T1059/003/)\n[0x7701 : Receive File (T1105: Ingress Tool Transfer)](https://attack.mitre.org/techniques/T1105/)\n[0x7702 : Send File (T1041: Exfiltration Over C2 Channel)](https://attack.mitre.org/techniques/T1041/)\n\n[A null preserving XOR encryption algorithm is used to hide the buffer’s contents (T1573.001: Encrypted Channel: Symmetric Cryptography).](https://attack.mitre.org/techniques/T1573/001/)\nAll of the samples found use the same single byte XOR key 0x85.\n\n\n-----\n\n## Command and Control Recreation\n\nAfter reversing the backdoor’s network byte parser, we recreated parts of the command and control (C2) server to elicit responses from it. Here\nthe backdoor responds to our command telling it to execute “net user evil 3v1l /add”.\n\nNotice both the sent and received responses start with 0x33669966 (0x66996633 on the network); enabling fingerprinting of the network traffic.\nThe response buffer reads: “The command completed successfully.”\n\n\n-----\n\n## Mustang Panda Connection\n\nWe assess with low confidence that CrimsonIAS is associated with Mustang Panda. The similarities with how the binary was packaged along\nwith how it’s launched are the basis for this connection.\n\nInspecting [Mustang Panda PlugX samples identified last year, we observed these three pertinent characteristics:](https://app.threatconnect.com/auth/threat/threat.xhtml?threat=3385723985#/)\n\n**1 – Encrypted with a 10 byte XOR key prepended to the encrypted binary**\n\nFigure 7 and 8 show a prepended XOR key separated by a null byte from the encrypted payload. Over the past 8 months we’ve been\nmonitoring this technique and, outside of this one CrimsonIAS sample, all the other uploaded samples have been the PlugX associated with\nMustang Panda. We acknowledge during the last two months of 2020 that two samples deviated from the 10 byte XOR key length; however,\nthe overwhelming majority used a 10 byte prepended XOR key.\n\n**2 – Matching shell code at the start of the MZ header (minus the offset value)**\n\n[Shell code in the MZ header is not exclusive to Mustang Panda, as tools like Cobalt Strike make use of this; however this set of bytes (shown](https://www.virustotal.com/gui/search/content%253A%257B4d%25205a%2520e8%252000%252000%252000%252000%25205B%252052%252045%252055%25208B%2520EC%252081%2520C3%2520%253F%253F%2520%253F%253F%2520%253F%253F%2520%253F%253F%2520FF%2520D3%2520C9%2520C3%2520%257D%25400/files)\nin figures 9 and 10) we’ve only seen in files related to Mustang Panda over the past few months.\n\n**3 – Exported Loader function**\n\n\n-----\n\not sa p es a so a e use o a e ect e oade tec que c t ey e po t u de t e a e oade Sea c g o t s e po ted\nfunction leads to a fair number of results not tied to Mustang Panda samples; so the presence of this export is not unique enough.\n\nFinally, we successfully launched CrimsonIAS by taking a Mustang Panda PlugX archive (complete with the DLL sideloading executable and\nthe sideloaded DLL) and swapping out the encrypted PlugX DLL with the encrypted CrimsonIAS DLL (T1574.002: Hijack Execution Flow: DLL\nSide-Loading).\n\nGrouping these characteristics together is the basis for the CrimsonIAS connection with Mustang Panda. The reasoning behind the low\nconfidence is the fact that the first two techniques should be trivial to implement/copy and that the third is not unique to Mustang Panda;\nincreasing the likelihood it could be a copycat, false flag, or inadvertent consistency. Additional information on organizations targeted, affected\nregions, the complete payload, inbound communications, or any associated incidents would potentially help us reassess our confidence in\nCrimsonIAS’ association to Mustang Panda.\n\n## Evolution\n\nVirusTotal shows that the first sample was uploaded back in 2018.\n\n\n**DLL**\n**Name** **Exports**\n\nDll.dll 0x42662c:\ndbkFCallWrapperAddr\n(1)\n\n0x40bb34:\n__dbk_fcall_wrapper\n(2)\n\n0x41d100:\nServiceMain (3)\n\n0x41d224: CPlApplet\n(4)\n\nDll.dll 0x42662c:\ndbkFCallWrapperAddr\n(1)\n\n0x40bb34:\n__dbk_fcall_wrapper\n(2)\n\n0x41d108:\nServiceMain (3)\n\n0x41d22c: CPlApplet\n(4)\n\nDll.dll 0x42662c:\ndbkFCallWrapperAddr\n(1)\n\n0x40bb34:\n__dbk_fcall_wrapper\n(2)\n\n0x41d108:\nServiceMain (3)\n\n0x41d22c: CPlApplet\n(4)\n\nDll.dll 0x42662c:\ndbkFCallWrapperAddr\n(1)\n\n0x40bb34:\n__dbk_fcall_wrapper\n(2)\n\n0x41d108:\nServiceMain (3)\n\n0x41d22c: CPlApplet\n(4)\n\nDll.dll 0x42662c:\ndbkFCallWrapperAddr\n(1)\n\n0x40bb34:\n__dbk_fcall_wrapper\n(2)\n\n0x41d108:\nServiceMain (3)\n\n0x41d22c: CPlApplet\n(4)\n\n\n**L**\n**O**\n**P**\n\n6\n\n6\n\n1\n\n5\n\n1\n\n\n**SHA256**\n\n\n**Compile**\n**Time**\n\n\n3bc96b4cce0dd550eeb3a563f7ef203614e36fbbbf990726e1afd5d3dcec33e1 1511835471\n(2017-11-28\n02:17:51)\n\nbde63cd5c3aefed249d2610ca2ee834bde0c0ec06193119363972e3761fb3c63 1527218355\n(2018-05-25\n03:19:15)\n\n194c0f6c5001b929080d700362e8d8e8009973c82d9409094af2a7ad33506228 1527218355\n(2018-05-25\n03:19:15)\n\n5021a19f439d31946e61b7529f8e930ebc9829b1ab1f2274b281b23124113cb1 1527218355\n(2018-05-25\n03:19:15)\n\n306175ffc59091515a8a0b211c356843f09fcb65395decd9fe72c9807c17288a 1528707090\n(2018-06-11\n08:51:30)\n\n\n**VT First**\n**Submission**\n\n2018-05-29\n08:35:59\n\n2019-04-28\n07:50:41\n\n2018-12-11\n03:16:46\n\n2018-07-23\n01:02:09\n\n2019-05-16\n10:21:16\n\n\n-----\n\n**DLL**\n**Name** **Exports**\n\nDll.dll 0x42562c:\ndbkFCallWrapperAddr\n(1)\n\n0x40bb34:\n__dbk_fcall_wrapper\n(2)\n\n0x41cb80: CPlApplet\n(3)\n\nDll.dll 0x42662c:\ndbkFCallWrapperAddr\n(1)\n\n0x40bb34:\n__dbk_fcall_wrapper\n(2)\n\n0x41ccc8:\nServiceMain (3)\n\n0x41cdec: CPlApplet\n(4)\n\nDll.dll 0x42662c:\ndbkFCallWrapperAddr\n(1)\n\n0x40bb34:\n__dbk_fcall_wrapper\n(2)\n\n0x41cbc4: Loader (3)\n\n\n**L**\n**O**\n**P**\n\n1\n\n6\n\n8\n\n\n**SHA256**\n\n\n**Compile**\n**Time**\n\n\n63e144fbe0377e0c365c126d2c03ee5da215db275c5376e78187f0611234c9b0 1531455240\n(2018-07-13\n04:14:00)\n\nb19fea36cb7ea1cf1663d59b6dcf51a14e207918c228b8b76f9a79ff3a8de36c 1539848755\n(2018-10-18\n07:45:55)\n\n891ece4c40a7bf31f414200c8c2c31192fd159c1316012724f3013bd0ab2a68e 1582792200\n(2020-02-27\n08:30:00)\n\n\n**VT First**\n**Submission**\n\n2018-08-04\n07:57:02\n\n2019-03-30\n13:00:05\n\n2020-08-09\n06:29:04\n\n\nThe earliest compile time found suggests this backdoor has been around since at least 2017. The three samples with the compile time 201805-25 03:19:15 are the same sample with just the listen on port number changed; probably after compilation.\n\nOverall CrimsonIAS’s primary functionality remains consistent over the years. The primary difference lies in how the malicious code is\nexecuted. The earlier samples relied on calling the exported function CPlApplet that would register and launch a Windows service that then\n[executes the backdoor functionality (T1569.002: System Services: Service Execution). The file](https://attack.mitre.org/techniques/T1569/002/)\n63e144fbe0377e0c365c126d2c03ee5da215db275c5376e78187f0611234c9b0 is an exception as the exported function CPIApplet does not\ncreate a service but it immediately starts up the backdoor.\n\n\n-----\n\nThe latest sample moved away from this technique and it now makes use of a reflective loader technique that is seen across different malware\nfamilies. This change along with the prepended XOR key and the shellcode provide hints to who might be behind this backdoor.\n\n## Conclusion\n\nThreatConnect believes that Mustang Panda will continue to be active and adapt their toolset as needed to meet their objectives against\nlargely near-abroad targets. The backdoor, CrimsonIAS, passively awaits commands, implying that the actor has some means of\nproxying/accessing the target’s network or, more likely, that the machine targeted is exposed to the public Internet. We encourage entities who\nthink they might have been targeted by Mustang Panda to check for the presence of programs listening for external inbound connections and\ninspect further if something is found. Verify carefully as the presence of programs listening for inbound connections does not necessarily mean\nthat the machine is compromised.\n\n_Naming Convention Note_\n\nWe generally abstain from adding a new name for malware and threats where other industry reporting has already done so. Two exceptions\nwhere we may use our own naming convention:\n\nWhen we are unsure whether our findings are consistent with activity sets other organizations have described and named. In this case,\nwe will attempt to describe the overlap and differences between those previously named sets and the activity we’re describing.\nWhen we are describing a previously unnamed malware or threat.\n\nThe latter is the case here. Our naming convention is intended to help describe the assessed origin of the threat or malware, along with\nanother identifier that is specific to the entity. In this case, we are using Crimson to refer to the malware’s assessed Chinese origin, and IAS to\nrefer to the Internet Authentication Service (IAS) binary string previously described.\n\nThese cookies are strictly necessary to provide you with services available through our website and to use some of its features.\n\nBecause these cookies are strictly necessary to deliver the website, refuseing them will have impact how our site functions. You always can\nblock or delete cookies by changing your browser settings and force blocking all cookies on this website. But this will always prompt you to\naccept/refuse cookies when revisiting our site.\n\nWe fully respect if you want to refuse cookies but to avoid asking you again and again kindly allow us to store a cookie for that. You are free to\nopt out any time or opt in for other cookies to get a better experience. If you refuse cookies we will remove all set cookies in our domain.\n\nWe provide you with a list of stored cookies on your computer in our domain so you can check what we stored. Due to security reasons we are\nnot able to show or modify cookies from other domains. You can check these in your browser security settings.\n\nWe may request cookies to be set on your device. We use cookies to let us know when you visit our websites, how you interact with us, to\nenrich your user experience, and to customize your relationship with our website.\n\nClick on the different category headings to find out more. You can also change some of your preferences. Note that blocking some types of\ncookies may impact your experience on our websites and the services we are able to offer.\n\nWe also use different external services like Google Webfonts, Google Maps, and external Video providers. Since these providers may collect\npersonal data like your IP address we allow you to block them here. Please be aware that this might heavily reduce the functionality and\nappearance of our site. Changes will take effect once you reload the page.\n\nGoogle Webfont Settings:\n\nGoogle Map Settings:\n\nGoogle reCaptcha Settings:\n\n\n-----\n\neo a d outube deo e beds\n\nCrimsonIAS: Listening for an 3v1l User\n\nBy ThreatConnect Research Team\n\nThreatConnect | Risk-Threat-Response\n\n### Cookie and Privacy Settings\n\nHow we use cookies\n\nEssential Website Cookies\n\nOther external services\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-01-27 - CrimsonIAS- Listening for an 3v1l User.pdf"
    ],
    "report_names": [
        "2021-01-27 - CrimsonIAS- Listening for an 3v1l User.pdf"
    ],
    "threat_actors": [
        {
            "id": "b5449533-0ff1-4048-999d-7d4bfd8e6da6",
            "created_at": "2022-10-25T16:07:24.114365Z",
            "updated_at": "2025-03-27T02:02:10.111256Z",
            "deleted_at": null,
            "main_name": "RedDelta",
            "aliases": [
                "Operation Dianxun",
                "TA416"
            ],
            "source_name": "ETDA:RedDelta",
            "tools": [
                "Agent.dhwf",
                "Agentemis",
                "Chymine",
                "Cobalt Strike",
                "CobaltStrike",
                "Darkmoon",
                "Destroy RAT",
                "DestroyRAT",
                "Gen:Trojan.Heur.PT",
                "Kaba",
                "Korplug",
                "PlugX",
                "Poison Ivy",
                "RedDelta",
                "SPIVY",
                "Sogu",
                "TIGERPLUG",
                "TVT",
                "Thoper",
                "Xamtrav",
                "cobeacon",
                "pivy",
                "poisonivy"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "aa90ad17-8852-4732-9dba-72ffb64db493",
            "created_at": "2023-07-11T02:00:10.067957Z",
            "updated_at": "2025-03-27T02:00:03.134199Z",
            "deleted_at": null,
            "main_name": "RedDelta",
            "aliases": [],
            "source_name": "MISPGALAXY:RedDelta",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "1691c25f-1aa4-4168-8ce2-7aa8f23246e7",
            "created_at": "2024-06-04T02:03:07.724221Z",
            "updated_at": "2025-03-27T02:05:17.284601Z",
            "deleted_at": null,
            "main_name": "BRONZE PRESIDENT",
            "aliases": [
                "Mustang Panda ",
                "Red Lich ",
                "Temp.Hex ",
                "HoneyMyte "
            ],
            "source_name": "Secureworks:BRONZE PRESIDENT",
            "tools": [
                " Cobalt Strike",
                " ORat",
                " PlugX",
                " RCSession",
                "China Chopper"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "b69037ec-2605-4de4-bb32-a20d780a8406",
            "created_at": "2023-01-06T13:46:38.790766Z",
            "updated_at": "2025-03-27T02:00:02.919758Z",
            "deleted_at": null,
            "main_name": "MUSTANG PANDA",
            "aliases": [
                "TEMP.HEX",
                "TA416",
                "TANTALUM",
                "Twill Typhoon",
                "Earth Preta",
                "Stately Taurus",
                "LuminousMoth",
                "Polaris",
                "BRONZE PRESIDENT",
                "HoneyMyte",
                "Red Lich"
            ],
            "source_name": "MISPGALAXY:MUSTANG PANDA",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "9baa7519-772a-4862-b412-6f0463691b89",
            "created_at": "2022-10-25T15:50:23.354429Z",
            "updated_at": "2025-03-27T02:00:55.45162Z",
            "deleted_at": null,
            "main_name": "Mustang Panda",
            "aliases": [
                "Mustang Panda",
                "TA416",
                "RedDelta",
                "BRONZE PRESIDENT"
            ],
            "source_name": "MITRE:Mustang Panda",
            "tools": [
                "Cobalt Strike",
                "RCSession",
                "NBTscan",
                "PoisonIvy",
                "PlugX"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "2ee03999-5432-4a65-a850-c543b4fefc3d",
            "created_at": "2022-10-25T16:07:23.882813Z",
            "updated_at": "2025-03-27T02:02:10.0116Z",
            "deleted_at": null,
            "main_name": "Mustang Panda",
            "aliases": [
                "Bronze President",
                "Camaro Dragon",
                "Earth Preta",
                "HoneyMyte",
                "Mustang Panda",
                "Operation SMUGX",
                "Operation SmugX",
                "PKPLUG",
                "Red Lich",
                "Stately Taurus",
                "TEMP.Hex"
            ],
            "source_name": "ETDA:Mustang Panda",
            "tools": [
                "9002 RAT",
                "AdFind",
                "Agent.dhwf",
                "Agentemis",
                "CHINACHOPPER",
                "China Chopper",
                "Chymine",
                "ClaimLoader",
                "Cobalt Strike",
                "CobaltStrike",
                "DCSync",
                "DOPLUGS",
                "Darkmoon",
                "Destroy RAT",
                "DestroyRAT",
                "Farseer",
                "Gen:Trojan.Heur.PT",
                "HOMEUNIX",
                "Hdump",
                "HenBox",
                "HidraQ",
                "Hodur",
                "Homux",
                "HopperTick",
                "Hydraq",
                "Impacket",
                "Kaba",
                "Korplug",
                "LadonGo",
                "MQsTTang",
                "McRAT",
                "MdmBot",
                "Mimikatz",
                "NBTscan",
                "NetSess",
                "Netview",
                "Orat",
                "POISONPLUG.SHADOW",
                "PUBLOAD",
                "PVE Find AD Users",
                "PlugX",
                "Poison Ivy",
                "PowerView",
                "QMAGENT",
                "RCSession",
                "RedDelta",
                "Roarur",
                "SPIVY",
                "ShadowPad Winnti",
                "SinoChopper",
                "Sogu",
                "TIGERPLUG",
                "TONEINS",
                "TONESHELL",
                "TVT",
                "TeamViewer",
                "Thoper",
                "TinyNote",
                "WispRider",
                "WmiExec",
                "XShellGhost",
                "Xamtrav",
                "Zupdax",
                "cobeacon",
                "nbtscan",
                "nmap",
                "pivy",
                "poisonivy"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535895,
    "ts_updated_at": 1743041807,
    "ts_creation_date": 1653779295,
    "ts_modification_date": 1653779295,
    "files": {
        "pdf": "https://archive.orkl.eu/4633c1e222caba054f61e04c6bafefc1fef1cbb4.pdf",
        "text": "https://archive.orkl.eu/4633c1e222caba054f61e04c6bafefc1fef1cbb4.txt",
        "img": "https://archive.orkl.eu/4633c1e222caba054f61e04c6bafefc1fef1cbb4.jpg"
    }
}