{
    "id": "af7bf904-ce66-40ac-89db-1194caf951b6",
    "created_at": "2023-01-12T15:07:27.808807Z",
    "updated_at": "2025-03-27T02:06:12.20087Z",
    "deleted_at": null,
    "sha1_hash": "e09d15b177384f21cffde01e36fd85a6f1b1e9ee",
    "title": "2021-06-15 - Insights Into an Excel 4.0 Macro Attack using Qakbot Malware",
    "authors": "",
    "file_creation_date": "2022-05-28T01:55:16Z",
    "file_modification_date": "2022-05-28T01:55:16Z",
    "file_size": 1469224,
    "plain_text": "# Insights Into an Excel 4.0 Macro Attack using Qakbot Malware\n\n**[perception-point.io/insights-into-an-excel-4-0-macro-attack-using-qakbot-malware](https://perception-point.io/insights-into-an-excel-4-0-macro-attack-using-qakbot-malware)**\n\nJune 15, 2021\n\n## Overview.\n\n[In this article, we will present an extensive email security attack that uses Excel 4.0 macros](https://perception-point.io/channel-coverage/email/)\n(XLM) to deliver [Qakbot](https://malpedia.caad.fkie.fraunhofer.de/details/win.qakbot) [malware. Qakbot is a modular information stealer whose original](https://perception-point.io/detection-technology/malware/)\npurpose was primarily as a banking Trojan but currently serves as a loader for other\ncrimeware.\n\nIn this campaign, the attacker conceals the malicious payload by embedding it deeply with\nother pieces of content. The attacker sends a malicious email containing a URL, which\nretrieves a zip file with the target’s name as the file name. This zip archive contains a\nmalicious Excel document (xls) that, when opened, runs an Excel 4.0 macro code that\ndownloads and executes a malicious DLL/Qakbot malware to the user’s machine.\n\n## Campaign Details.\n\n\n-----\n\nThe attacker impersonates a person the user knows in an attempt to gain trust and deceive\nhim. He sends an email in the native language of the user, with a URL ending with the user’s\nname + .zip extension. In order to make the email look more authentic, the attacker may add\n**real email conversations between the user and the person impersonated by the**\n**attacker.**\n\nThe link is non-clickable, which means the user has to copy and paste it into his browser.\nThis is an evasion technique used against email security solutions.\n\n_An example of the attack email concealing the malicious content_\nThe emails have been sent in many different languages, which indicates a widespread attack\nto different geolocations.\n\nOnce the user browses to the link, a zip file with the user’s name is generated and\ndownloaded.\n\n## How is the zip name generated?\n\n\n-----\n\nFirst, let’s take the following URL as an example:\n```\nhttp[:]//microlinsmmn[.]carajasnutricaoanimal[.]com[.]br/mr--simeon-labadie/dan.zip\n\n```\nAfter browsing to this link, we get redirected to:\n\nhttp[:]//microlinsmmn[.]carajasnutricaoanimal[.]com[.]br/mr–simeon-labadie/documents.zip\n\nAnd then a zip file is downloaded automatically with the name ‘dan.zip’. The malicious excel,\ncontaining hidden XLM code, is found inside the zip file.\n\n## Campaign DevSecOps.\n\nIf the same user will try to download the file again, they will receive the following error:\n\nThis happens because the server stores all the IP addresses that already accessed the link,\nand prevents more than one download per IP which is an evasion technique from the\nattacker.\n\n\n-----\n\nHowever, while investigating the URL, it was discovered that the malicious server was\naccessible without any authentication.\n\nThe server log files contains all of the infected computers’ IP addresses.\n\n## The Malware.\n\nWe downloaded more than 30 samples of malicious zip files from one of the malicious URLs\nand have found that the hashes were different for each file. When comparing between the\nfiles, we saw that the differences were minimal.\n\n**Changing the hash of each individual file is a technique used by the attacker to evade**\n**signature/ioc based detection.**\n\n\n-----\n\nThe embedded Excel 4.0 macro code itself is similar to previous attacks we have previously\n[reported – it downloads and executes a malicious DLL. This time, the DLL payload is the](https://perception-point.io/the-salesforce-loophole/)\n[Qakbot Trojan, also known as QBOT.](https://seguranca-informatica.pt/a-taste-of-the-latest-release-of-qakbot/#.YLjD56gzaUk)\n\nThe malware uses a process injection method known as process hollowing, thereby injecting\nitself into explorer.exe process, where it creates a scheduled task in order to achieve\npersistence, and later connects to a C&C server.\n\n## Perception Point Approach.\n\n[This attack was detected using the multiple protection layers in the Perception Point](https://perception-point.io/detection-technology/)\nplatform.\n\nThe Recursive Unpacker, an anti-evasion layer, instantaneously extracted all files\nStatic engines detected the utilization of malicious Excel 4.0 macros\nThe [HAP engine, a dynamic engine that combines CPU-level data with advanced](https://perception-point.io/detection-technology/zero-days-n-days/)\nsoftware algorithms, identified the malicious behavior of the spreadsheet and its\ncontent.\n\nIn addition, the platform searches for and scrapes non-clickable links which enables the\ndetection of the URLs in the scanned emails.\n\n## Recommendations.\n\n[Educate your employees about email security and on the risk of browsing to unknown](https://perception-point.io/channel-coverage/email/)\nURLs and downloading files from unknown sources.\nAlways check the authenticity of the sender by checking if the display name and the\nemail address match.\n[Use an advanced email security solution with dynamic scanning and anti-evasion](https://perception-point.io/channel-coverage/email/)\nmechanisms to reduce the risks of cyber-attacks.\n\n## IOCs.\n\n**List of initial zip download URLs:**\n\nhttp[:]//luno-offer-rewards[.]greekspeek[.]com/minerva-heathcote/documents[.]zip\nhttp[:]//forum[.]ennov8[.]com[.]ng/mr–torrey-satterfield/documents[.]zip\nhttp[:]//rrestetica[.]com/ffJWg/documents[.]zip\nhttp[:]//microlinsmmn[.]carajasnutricaoanimal[.]com[.]br/mr–simeonlabadie/documents[.]zip\nhttp[:]//shopifytest[.]recyclemymachine[.]com/mrs–hermina-welch-phd/documents[.]zip\nhttp[:]//backend[.]southernbellatl[.]co/prof–flossie-kuhn-jr-/documents[.]zip\nhttp[:]//appsolzone[.]com/chadrick-marvin/documents[.]zip\n\n\n-----\n\nhttp[:]//ulumequran[.]com/kasey-botsford/documents[.]zip\nhttp[:]//orgaproducts[.]com/deontae-mayer/documents[.]zip\nhttp[:]//stage1[.]artisanenterprisellc[.]com/dr–era-skiles/documents[.]zip\nhttp[:]//portal2[.]aladhwa-sch[.]com/nestor-dare/documents[.]zip\nhttp[:]//covid19[.]iqwasithealth[.]com/jillian-ratke-iii/documents[.]zip\nhttp[:]//catalogue[.]queensbridgenigeria[.]com/prof–leland-jaskolski-i/documents[.]zip\nhttp[:]//pavanalakecamping[.]com/mrs–jessika-sporer/documents[.]zip\nhttp[:]//bengheng-engrg[.]com/carmelo-metz-iii/documents[.]zip\nhttp[:]//seremanis[.]com/gregg-beier/documents[.]zip\nhttp[:]//inmobaperu[.]com/letitia-wintheiser/documents[.]zip\nhttp[:]//ayurskinclinic[.]com/elroy-emard/documents[.]zip\nhttp[:]//controlling2014[.]erp-corp[.]com/arvid-abbott/documents[.]zip\nhttp[:]//najihojeily[.]com/mr–kale-ebert-i/documents[.]zip\nhttp[:]//radiocakrabandung[.]com/prof–tremaine-gerlach-v/documents[.]zip\nhttp[:]//offlinesharks[.]com/prof–clark-hessel-md/documents[.]zip\nhttp[:]//connectavet[.]com/efren-crooks-iii/documents[.]zip\nhttp[:]//infotrekkingnepal[.]com/dr–dahlia-wisoky-phd/documents[.]zip\nhttp[:]//lookatmemarketing[.]com/EVzBd/documents[.]zip\nhttp[:]//calvano[.]com/prof–emil-rolfson/documents[.]zip\nhttp[:]//allyoulovetrading[.]com/emmanuelle-zemlak/documents[.]zip\nhttp[:]//viewmediads[.]com/dr–lucie-little/documents[.]zip\nhttp[:]//integrityadvisory[.]in/dedrick-osinski/documents[.]zip\nhttp[:]//enaruci[.]qwerty[.]ba/prof–dan-denesik-iii/documents[.]zip\nhttp[:]//slsviews[.]magicways[.]in/mrs–margie-morissette/documents[.]zip\nhttp[:]//leonandsigourney[.]com/phoebe-wisozk/documents[.]zip\nhttp[:]//marketbling[.]com/daphne-hamill-phd/documents[.]zip\nhttp[:]//cac-itc[.]com/lola-wehner/documents[.]zip\nhttp[:]//germiterra[.]com/hanna-kuphal/documents[.]zip\nhttp[:]//tracking-centre-redelivery[.]idealnepaltours[.]com/lelia-jones-i/documents[.]zip\n\n**List of DLL payload download URLs:**\n\nhttps[:]//dharamdiwan[.]in/njipkUcz/ork[.]html\nhttps[:]//lenoirramosjr[.]com/7r9JyFLo/ork[.]html\nhttps[:]//dev[.]favterest[.]com/VBPFHU4UdmdT/filter[.]html\nhttps[:]//ethioshare[.]com/q22UgZzM3PV7/filter[.]html\nhttps[:]//nws[.]visionconsulting[.]ro/N1G1KCXA/dot[.]html\nhttps[:]//royalpalm[.]sparkblue[.]lk/vCNhYrq3Yg8/dot[.]html\nhttps[:]//arpanetwifi[.]com/6PJHScezZV/lora[.]html\nhttps[:]//victoriaholidays[.]co[.]in/JRO9RjMm/lora[.]html\n\n**List of malicious DLL hashes (SHA256):**\n\ne6c043cd93e28feb16362ebb329f26f5c323f5c2389ad1bcec55fe033533dbf0\n\n\n-----\n\ndbdccafd2ef3a6eeb6b11c684698df279ba843e5a23fae8d92dd2317cc6db3ee\nc2535e800d505cb51e9c3e161e958162ede306a15d30f9316a31e16159187ac3\nc110315c3b81bb6027c78dff280e5f1b2d3cd8a8dcf2ce0724941a8a40abf1ad\n\n**List of C&C Servers:**\n\n24.95.61.62:443\n24.229.150.54:995\n45.77.117.108:8443\n76.94.200.148:995\n106.250.150.98:443\n184.185.103.157\n187.250.238.164:995\n195.6.1.154:2222\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-06-15 - Insights Into an Excel 4.0 Macro Attack using Qakbot Malware.pdf"
    ],
    "report_names": [
        "2021-06-15 - Insights Into an Excel 4.0 Macro Attack using Qakbot Malware.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536047,
    "ts_updated_at": 1743041172,
    "ts_creation_date": 1653702916,
    "ts_modification_date": 1653702916,
    "files": {
        "pdf": "https://archive.orkl.eu/e09d15b177384f21cffde01e36fd85a6f1b1e9ee.pdf",
        "text": "https://archive.orkl.eu/e09d15b177384f21cffde01e36fd85a6f1b1e9ee.txt",
        "img": "https://archive.orkl.eu/e09d15b177384f21cffde01e36fd85a6f1b1e9ee.jpg"
    }
}