{
    "id": "8131cd22-9d95-4523-a27f-129968028afe",
    "created_at": "2023-01-12T15:07:48.713041Z",
    "updated_at": "2025-03-27T02:05:33.206961Z",
    "deleted_at": null,
    "sha1_hash": "18660a088166b79f7cb96b88ad17235ff39e444d",
    "title": "2018-01-01 - Analyzing Ramnit used in Seamless campaign",
    "authors": "",
    "file_creation_date": "2022-05-28T16:50:46Z",
    "file_modification_date": "2022-05-28T16:50:46Z",
    "file_size": 275527,
    "plain_text": "# Analyzing Ramnit used in Seamless campaign\n\n**[nao-sec.org/2018/01/analyzing-ramnit-used-in-seamless.html](http://www.nao-sec.org/2018/01/analyzing-ramnit-used-in-seamless.html)**\n\n2018-01-01\n\n## First\n\nSeamless campaign which is a Drive-by Download attack campaign uses Ramnit banking\n[trojan. Many articles about Seamless campaign are published. For example, Cisco Umbrella,](https://umbrella.cisco.com/blog/2017/03/29/seamless-campaign-delivers-ramnit-via-rig-ek/)\n[Malware-Traffic-Analysis and](http://malware-traffic-analysis.net/2017/12/28/index.html) [traffic.moe. Seamless has been using Ramnit since it began to](https://traffic.moe/2017/12/25/index.html)\n\n\n-----\n\nbe observed. Once run, Ramnit injects code into the web page to steal information such as\ncredit cards. Ramnit is a previously reported banking trojan, but since I didn't know much\nabout it, so I investigated about it.\n\n## Seamless Campaign Traffic\n\nFirst, about Seamless campaign. Seamless campaign consists of the following traffic.\n\nWhen reaching Seamless's Pre-Gate from the ad network, Pre-Gate gets the user's time\nzone information and sends it to the server. If the user belongs to the target time zone, PreGate redirects the user to Gate via several redirectors. The user reads the landing page of\nthe RIG Exploit Kit at Gate, which attacks and sends Ramnit.\n\nSeamless is sensitive to the user's geolocation. Pre-Gate exists for each target country. For\nexample, Pre-Gate for USA redirect to Gate for USA and Ramnit for USA is sent.\n\n## Ramnit Traffic\n\nRamnit uses the original protocol when communicating with C2. Following this protocol, I try\nto extract the configs and modules from the traffic of Ramnit and C2.\n\nThis protocol uses port 443. But, not https. A simple mechanism is on tcp. Packet consists of\nmultiple commands and data. The structure is as follows.\n\nmagic number is a fixed value. Packets start with this bytes. length is the length of command\nand data. In other words, strlen(command + data). command is 1 byte. There are various\nkinds of this.\n\nData has three structures.\n\nThe encryption key of RC4 seems to be stable. In my environment `fenquyidh` is the key.\n\n\n-----\n\nLet s look at the data using actual traffic. If you have Ramnit traffic, use it. If you do not have\nit, look for Ramnit and move it, or look for pcap etc. For example, if you look at the #Ramnit\ntag on Twitter, you will find many Tweets. You will surely get Ramnit or its traffic.\n\nRamnit is banking trojan. It depends on the target country/region. For example, Ramnit used\nin attack campaign targeting Japan doesn't work with IP addresses of countries other than\nJapan. The configs and modules that Ramnit acquires from C2 also change. This time, let's\nsee the traffic of Ramnit for Japan. If you are not able to get the traffic of Ramnit for Japan,\nplease refer to this link. It seems that someone kindly released pcap ;)\n\n[https://gist.github.com/anonymous/2d7eef0c0ffba19338afd74823d7a8c9](https://gist.github.com/anonymous/2d7eef0c0ffba19338afd74823d7a8c9)\n\nLet's open pcap and look at the first packet.\n\nWhen parsing this according to the protocol, it becomes as follows.\n\nThis data is encoded with RC4. So I decode it. RC 4 is a simple algorithm, write the code.\n\nThe results are as follows. Ramnit is sending two MD5 values to C2. Registration is done to\nbot by this.\n\nstring(32) \"d5ad437b032fd239616c1d0d97a6b6eb\"\nstring(32) \"e4b7a6323fab5960363d771a124b6079\"\n\nThis is what automates these processes.\n\n[https://github.com/nao-sec/ramnit_traffic_parser](https://github.com/nao-sec/ramnit_traffic_parser)\n\nThis script uses tshark. If not installed, please install and set environment variables. Now,\nlet's run the script.\n\nFiles are created in the output directory. Let's look at `064_21.bin`.\n\nThis file says \"Antivirus Trusted Module v2.0 (AVG, Avast, Nod32, Norton, Bitdefender)\". You\ncan see that there is MZ header below 0x120 and it is a PE file. Cutting out 0x120 or later\nresult in the following.\n\nIt is unpacked because packed by UPX.\n\nLooking at this DLL with IDA, you can see that it is a program that interferes with Anti-Virus\nsoftware.\n\nSeveral DLL modules (067_21.bin, 070_21.bin, 073_21.bin) are downloaded like this.\n\nNext, let's see 106_15.bin. This file seems to be zip. Looking inside it was IE's cookies.\nThere was a DLL module that zipped the cookie, so it might be related.\n\n\n-----\n\nFinally, look at 139_13.bin. This is the config of the injecting code for the web page.\n\nLooking at this configuration, URLs of many credit card companies and related companies\nexist. It was localized for Japan.\n\n## Ramnit Modules\n\nI analyzed the modules that Ramnit downloads. All modules had data added at the beginning\nof the PE format.\n\nAlso, its PE file is a DLL, packed with UPX.\n\nAt the beginning of the module there is a comment like a description of the role. Most of them\nare similar to the information already analyzed by analysts.\n\n[https://www.cert.pl/en/news/single/ramnit-in-depth-analysis/](https://www.cert.pl/en/news/single/ramnit-in-depth-analysis/)\n[http://www.vkremez.com/2017/08/8-10-2017-rig-exploit-kit-leads-to.html](http://www.vkremez.com/2017/08/8-10-2017-rig-exploit-kit-leads-to.html)\n[https://www.s21sec.com/en/blog/2017/07/ramnit-and-its-pony-module/](https://www.s21sec.com/en/blog/2017/07/ramnit-and-its-pony-module/)\n\n## For Japan\n\n[module 1]\n\n\n-----\n\nAvTrust\nAntivirus Trusted Module v2.0 (AVG, Avast, Nod32, Norton, Bitdefender)\n\nAdd to antivirus software exception list\n\n[module 2]\n\nCookieGrabber\nCookie Grabber v0.2 (no mask)\n\nCompress and send cookies of browsers (firefox, chorome, opera, IE) to zip.\n\n[module 3]\n\nHooker\nIE & Chrome & FF injector\n\n[module 4]\nBrowser communication hook\n\nVNC IFSB\nVNC IFSB x64-x86\n\nI think it is similar to this code.\n[https://github.com/gbrindisi/malware/blob/master/windows/gozi-isfb/AcDll/activdll.c](https://github.com/gbrindisi/malware/blob/master/windows/gozi-isfb/AcDll/activdll.c)\n\n[module 5]\n\nFFCH\nFF&Chrome reinstall x64-x86 [silent]\n\n## For USA\n\nmodule 1~4 is the same. module5 had the following functions instead.\n\nFtpGrabber2\nFtp Grabber v2.0\n\nAnd In US IP, AZORult has been downloaded.\n\nhttps://www.hybrid[analysis.com/sample/37b66f9117a2140fa11badad967c09142860d04af9a3564bfe58527d7d7](https://www.hybrid-analysis.com/sample/37b66f9117a2140fa11badad967c09142860d04af9a3564bfe58527d7d7e9270)\ne9270\n\n## IOCs\n\n\n-----\n\nhttps://github.com/nao-sec/ioc/blob/master/nao_sec/5a34bc94-1eb8-4213-9ab834dbc0a8010a.json\n\n## Finally\n\nThe Ramnit has not changed very much for a long time. It was consistent with Symantec's\ncontents published in 2014.\n\nhttps://www.symantec.com/content/dam/symantec/docs/security-center/white-papers/w32ramnit-analysis-15-en.pdf\n\nThe configuration changes depending on the IP address, but the same module was\ndownloaded.\n\nRamnit traffic is interesting ;)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-01-01 - Analyzing Ramnit used in Seamless campaign.pdf"
    ],
    "report_names": [
        "2018-01-01 - Analyzing Ramnit used in Seamless campaign.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536068,
    "ts_updated_at": 1743041133,
    "ts_creation_date": 1653756646,
    "ts_modification_date": 1653756646,
    "files": {
        "pdf": "https://archive.orkl.eu/18660a088166b79f7cb96b88ad17235ff39e444d.pdf",
        "text": "https://archive.orkl.eu/18660a088166b79f7cb96b88ad17235ff39e444d.txt",
        "img": "https://archive.orkl.eu/18660a088166b79f7cb96b88ad17235ff39e444d.jpg"
    }
}