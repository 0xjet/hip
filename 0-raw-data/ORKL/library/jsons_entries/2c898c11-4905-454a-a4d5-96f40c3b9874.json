{
    "id": "2c898c11-4905-454a-a4d5-96f40c3b9874",
    "created_at": "2023-01-12T15:04:48.672261Z",
    "updated_at": "2025-03-27T02:09:18.112121Z",
    "deleted_at": null,
    "sha1_hash": "63869e366ab959b9b9f2fcd7a73403d80dfd96f2",
    "title": "2020-12-09 - Recent Qakbot (Qbot) activity",
    "authors": "",
    "file_creation_date": "2022-05-28T00:21:46Z",
    "file_modification_date": "2022-05-28T00:21:46Z",
    "file_size": 5176524,
    "plain_text": "# SANS ISC: InfoSec Handlers Diary Blog - SANS Internet Storm Center SANS Site Network Current Site SANS Internet Storm Center Other SANS Sites Help Graduate Degree Programs Security Training Security Certification Security Awareness Training Penetration Testing Industrial Control Systems Cyber Defense Foundations DFIR Software Security Government OnSite Training InfoSec Handlers Diary Blog\n\n**isc.sans.edu/diary/rss/26862**\n\n## Recent Qakbot (Qbot) activity\n\n**Published: 2020-12-09**\n\n**Last Updated: 2020-12-09 04:51:14 UTC**\n\n**by** [Brad Duncan (Version: 1)](https://isc.sans.edu/handler_list.html#brad-duncan)\n\n[0 comment(s)](https://isc.sans.edu/forums/diary/Recent+Qakbot+Qbot+activity/26862/#comments)\n**_Introduction_**\n\n[Today's diary is a review of a Qakbot (Qbot) infection I generated on Tuesday 2020-12-08.](https://malpedia.caad.fkie.fraunhofer.de/details/win.qakbot)\n\n[Qakbot generally includes follow-up malware like Cobalt Strike (such as](https://malpedia.caad.fkie.fraunhofer.de/details/win.cobalt_strike) [this example), but](https://www.malware-traffic-analysis.net/2020/12/07/index.html)\nmy infection on Tuesday 2020-12-08 was a basic Qakbot infection that didn't run long\nenough for follow-up malware or other activity.\n\nOf note, in late-November 2020, Qakbot underwent a version update. I've noticed this in my\nday-to-day research, but nothing comprehensive has been published yet. A few tweets\nabout it:\n\nI'll review some of the changes I've noticed about the update in today's diary.\n\n\n-----\n\n_Shown above: Chain of events for the Qakbot infection we're reviewing today._\n\n**_The malspam_**\n\nMalspam examples I found from Tuesday 2020-12-08 were fake replies to legitimate email\nchains, although the example shown below might be a Qakbot-generated reply for an\nunsolicited spam message.\n\n_Shown above: An example of Qakbot malspam from Tuesday 2020-12-08._\n\n\n-----\n\nThe attached ZIP archive has an Excel spreadsheet with macros designed to infect a\nvulnerable Windows host with Qakbot malware. Even with the version update, these\nspreadsheets distributing Qakbot have the same template we've seen for the past several\nmonths.\n\n_Shown above: Excel spreadsheet extracted from the ZIP attachment._\n\n**_Infection activity_**\n\nTypical for Qakbot, we see an HTTP GET request for a URL ending in .jpg that returned a\nWindows binary (in this case a DLL). This often is an HTTPS URL, where we would not see\nthe Windows binary in a pcap. In recent moths, I've seen as many HTTPS URLs for this as I\nhave regular HTTP URLs.\n\n\n-----\n\n_Shown above: HTTP traffic that returned a Windows DLL file for Qakbot._\n\nFiltering the traffic in Wireshark, we find typical Qakbot post-infection activity. But\napproximately 3 hours after the initial infection, I also saw web traffic to wellsfargo[.]com,\nwhich was unusual--especially since no browser had opened on the desktop of the infected\nWindows host.\n\n\n-----\n\n_Shown above: Traffic from the infection filtered in Wireshark._\n\nThe user-agent string in HTTP traffic to wellsfargo[.]com indicated it may have been caused\nby Google Chrome. Keep in mind the user-agent string is often spoofed during malware\ninfections. I also saw web traffic associated with the Firefox web browser. This traffic is\nlikely related to one of the Qakbot modules; however, I could not find any modules saved to\ndisk on my infected host.\n\n\n-----\n\n_Shown above: Filtering the traffic in Wireshark to show Firefox traffic, and other web traffic_\n_to wellsfargo[.]com from the infected host._\n\n_Shown above: Traffic to wellsfargo[.]com appears to be from Chrome, if the user-agent string_\n_is correct._\n\n\n-----\n\n**_Qakbot malware version update_**\n\nSometime in late-November 2020, Qakbot malware was updated. I know of at least 3\nrelated things that are noticeably different than before.\n\n1) The Qakbot binary retrieved by Microsoft Office macros changed from an EXE to a DLL.\n\nPrior to the update, the initial Qakbot binary was an EXE made persistent through a\nWindows registry update at\n**_HKCU\\SOFTWARE\\Microsoft\\WIndows\\CurrentVersion\\Run._**\nAfter the update, the initial Qakbot binary has been a DLL file, and there is no longer a\nWindows registry update at\n**_HKCU\\SOFTWARE\\Microsoft\\WIndows\\CurrentVersion\\Run._**\n\n2) Qakbot now creates other Windows registry updates. These updates are located at\n**_HKCU\\SOFTWARE\\Microsoft under a key that consists of a unique alphabetical string for_**\neach infected host. It consists of several entries containing encoded binary data as shown in\nthe example below.\n\n_Shown above: An example of Windows registry update caused by the newest version of_\n_Qakbot._\n\n3) The directory for Qakbot artifacts under C:\\Users\\\n\n**_[username]\\AppData\\Roaming\\Microsoft now has fewer files. Before the version update,_**\nwe saw a Windows EXE for Qakbot in this directory, and it was kept persistent in the\n\n\n-----\n\nWindows registry (see item 1 above). Now, the folder no longer has an EXE and some other\nfiles are missing. Compare the two images below.\n\n_Shown above: An example of artifact caused by the old version of Qakbot._\n\n_Shown above: Artifacts stores to the same type of directory after the late-November 2020_\n_version update of Qakbot._\n\nQakbot's version update has resulted in other characteristics of the malware, and I'm certain\nsomeone will publish a more detailed write-up about it. These three changes are the one's\nI've noticed, but I focus mostly on dynamic analysis (not code analysis or reverse\nengineering).\n\n**_Indicators of Compromise (IoC)_**\n\nThe following are IoCs from my Qakbot infection from Tuesday 2020-12-08.\n\n\n-----\n\nZIP archives from 4 malspam examples:\n\n[2ccc14f2bab2e9eb1d7228e225afda558fd4b52ed670303a912ace1984b35b06](https://bazaar.abuse.ch/sample/2ccc14f2bab2e9eb1d7228e225afda558fd4b52ed670303a912ace1984b35b06/)\nDocument_1204350147-Copy.zip\n[fa9935e6cda06866cb5aa062c16a73fdc85bd4146dca67202d22e225ddd3193b](https://bazaar.abuse.ch/sample/fa9935e6cda06866cb5aa062c16a73fdc85bd4146dca67202d22e225ddd3193b/)\nDocument_1356928040-Copy.zip\n[0a3a6163a5e8e372fa96efbef3feb793463f4e39bd2c4d6ea03afce045f90636](https://bazaar.abuse.ch/sample/0a3a6163a5e8e372fa96efbef3feb793463f4e39bd2c4d6ea03afce045f90636/)\nDocument_1495694596-Copy.zip\n[66036cf566386c159e49191125497c77c13c75778492519000b9f61a4afdedad](https://bazaar.abuse.ch/sample/0a3a6163a5e8e372fa96efbef3feb793463f4e39bd2c4d6ea03afce045f90636/)\nDocument_501487929-Copy.zip\n\nExcel spreadsheets extracted from the above ZIP archives:\n\n[adad807fa22f398e0a40396ed65d0827f9f14baf7e1281b713dfb17e2683d743](https://bazaar.abuse.ch/sample/adad807fa22f398e0a40396ed65d0827f9f14baf7e1281b713dfb17e2683d743/)\nDocument_1204350147-Copy.xls\n[e14f6ab34e3506d6985816af85935932fb6faf8bad9d2c7dd96d6011d7c21a33](https://bazaar.abuse.ch/sample/e14f6ab34e3506d6985816af85935932fb6faf8bad9d2c7dd96d6011d7c21a33/)\nDocument_1356928040-Copy.xls\n[4e2f37d4228e78faa1f34121ee934f58e1a9862ad6f183edf4c24e08cda20363](https://bazaar.abuse.ch/sample/4e2f37d4228e78faa1f34121ee934f58e1a9862ad6f183edf4c24e08cda20363/)\nDocument_1495694596-Copy.xls\n[94d759f43bcc647f7233e19ddc160a6b43458dcde6d2ea4274c8c06b2890def2](http://94d759f43bcc647f7233e19ddc160a6b43458dcde6d2ea4274c8c06b2890def2/)\nDocument_501487929-Copy.xls\n\nHTTP traffic after enabling that returned a Qakbot DLL file:\n\n35.208.146[.]4 port 80 - supyouryoga[.]com - GET /svgqcnjto/590906.jpg\n\nQakbot post-infection traffic:\n\n62.38.114[.]12 port 2222 - HTTPS traffic caused by Qakbot\n197.45.110[.]165 port 995 - HTTPS traffic caused by Qakbot\nport 443 - www.openssl[.]org - connectivity check caused by Qakbot\n54.36.108[.]120 port 65400 - TCP traffic caused by Qakbot\n\nUnusual (to me) activity from Qakbot-infected host:\n\nport 80 - wellsfargo[.]com - GET /\nvarious IP addresses over TCP port 443 - Wells Fargo-related domains - traffic caused\nby viewing wellsfargo[.[com\n_Firefox-related HTTP and HTTPS web traffic_\n\nMalware from an infected Windows host:\n\nSHA256 hash:\n[5060806228d3f2c1afd09566d0d2fa6b2e56f844cd044c4c4e6e7ade9fef3a22](https://bazaar.abuse.ch/sample/5060806228d3f2c1afd09566d0d2fa6b2e56f844cd044c4c4e6e7ade9fef3a22/)\nFile size: 350,928 bytes\n\n\n-----\n\nFile retrieved from: hxxp://supyouryoga[.]com/svgqcnjto/590906.jpg\nFile saved to victim as: C:\\Users\\[username]\\AppData\\Kipofe.mmaallaauu\nFile description: DLL file for Qakbot retrieved by macro from Document_1495694596Copy.xls\nRun method: Rundll32.exe [filename],DllRegisterServer\n\n**_Final words_**\n\nQakbot been active for several years, and it continues to evolve. The latest version update\nhas some significant changes, but infection traffic on vulnerable Windows hosts remains\nsimilar to what we've seen before with Qakbot.\n\nA pcap of the infection traffic reviewed in this dairy and 4 examples of Qakbot malspam are\n[available here.](https://www.malware-traffic-analysis.net/2020/12/08/index.html)\n\n--Brad Duncan\nbrad [at] malware-traffic-analysis.net\n\n[Keywords: Excel](https://isc.sans.edu/tag.html?tag=Excel) [macros](https://isc.sans.edu/tag.html?tag=macros) [malspam](https://isc.sans.edu/tag.html?tag=malspam) [Qakbot](https://isc.sans.edu/tag.html?tag=Qakbot) [Qbot](https://isc.sans.edu/tag.html?tag=Qbot)\n[0 comment(s)](https://isc.sans.edu/forums/diary/Recent+Qakbot+Qbot+activity/26862/)\n\nJoin us at SANS! Attend [with Brad Duncan in starting](https://isc.sans.edu/diary/rss/26862)\n\nTop of page\n√ó\n\n[Diary Archives](https://isc.sans.edu/diaryarchive.html)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-12-09 - Recent Qakbot (Qbot) activity.pdf"
    ],
    "report_names": [
        "2020-12-09 - Recent Qakbot (Qbot) activity.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535888,
    "ts_updated_at": 1743041358,
    "ts_creation_date": 1653697306,
    "ts_modification_date": 1653697306,
    "files": {
        "pdf": "https://archive.orkl.eu/63869e366ab959b9b9f2fcd7a73403d80dfd96f2.pdf",
        "text": "https://archive.orkl.eu/63869e366ab959b9b9f2fcd7a73403d80dfd96f2.txt",
        "img": "https://archive.orkl.eu/63869e366ab959b9b9f2fcd7a73403d80dfd96f2.jpg"
    }
}