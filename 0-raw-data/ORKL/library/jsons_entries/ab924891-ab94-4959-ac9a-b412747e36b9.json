{
    "id": "ab924891-ab94-4959-ac9a-b412747e36b9",
    "created_at": "2023-01-12T15:07:08.036633Z",
    "updated_at": "2025-03-27T02:09:30.36035Z",
    "deleted_at": null,
    "sha1_hash": "5338d38fb137f961c84a4d6cf8d3482805f3b828",
    "title": "2021-10-21 - How to- Threat hunting and threat intelligence",
    "authors": "",
    "file_creation_date": "2022-05-28T19:27:15Z",
    "file_modification_date": "2022-05-28T19:27:15Z",
    "file_size": 533063,
    "plain_text": "# How to: Threat hunting and threat intelligence\n\n**[blog.apnic.net/2021/10/21/how-to-threat-hunting-and-threat-intelligence/](https://blog.apnic.net/2021/10/21/how-to-threat-hunting-and-threat-intelligence/)**\n\nJames Shank October 21, 2021\n\nThis APNIC [network security series on threat hunting has so far covered a range of great](https://blog.apnic.net/tag/network-security-week/)\nand necessary tools/rules to help you with your threat hunt — it is hard to consider a hunt\ncomplete without using at least one of these techniques.\n\nBut what does a complete hunt look like? And how does a successful hunt get incorporated\ninto a completed intelligence product? In this post, I’m going to introduce these lofty topics\nand show some examples.\n\n[First, let’s define our target. Finished intelligence is the product of intelligence processes, the](https://dps.iowa.gov/divisions/intelligence/intel-cycle)\nend game, the goal. It leverages assessments of data by subject matter experts (SMEs) to\nhelp provide context to inform decisions. These are delivered via a report, which contains\njudgments on possible decisions, including how they were determined and whether they are\ntrusted.\n\n\n-----\n\nFigure 1 — The intelligence cycle is the process of developing raw information into finished\nintelligence for consumers, including policymakers, law enforcement executives,\n[investigators, and patrol officers. (Source)](https://dps.iowa.gov/divisions/intelligence/intel-cycle)\nCreating completed intelligence that serves a useful purpose requires well-defined\nintelligence requirements. The end output then informs decision makers on relevant topics.\nThis is what threat hunting should aim to do — find threats of concern and provide data that\ninforms decisions.\n\n## What are intelligence requirements?\n\nIntelligence requirements could get their own blog post! Good requirements help the analyst\nunderstand their objective and ensure the objective aligns with business needs. To illustrate\nintelligence requirements, consider the following two examples.\n\n**BAD: ‘Alert management each time advanced actors target us using zero-days.’**\n\nThis is a poorly defined requirement. It is too vague, poorly scoped, and unlikely to inform\ndecisions in a meaningful way.\n\n\n-----\n\n**GOOD: Provide a report to management within three days of a detected incident. The report**\nshould include details of when and how an attack happened. Include an assessment of the\nimpact of the attack. Include suggestions on what changes may improve detection and\nprevention of similar attacks in the future.’\n\nThis provides a clear scope and clear expectations. It is specific and the output will help to\ninform decisions. It sets an expectation for the SMEs to guide the audience by asking for\nsuggested changes.\n\nRequirements should be clear in scope and objective and be possible! They should be\norientated towards improving the understanding of a topic, situation, or concern.\n\n## Before we hunt\n\nTo start a hunt, you’ll require four things: data, a hypothesis, a why (intelligence\nrequirements), and a time limit.\n\nData can be many different things — system logs, proxy logs, application logs, binary files,\nDNS — the list goes on and on. Without data, you do not have anything to hunt.\n\nA hypothesis needs to be clear and testable. It should start with something concrete. This\ncould be a vulnerability, a bit of intelligence, odd behaviour, or anything that might lead to\nfinding unknown threats. This is broad in what it can be but needs to be well defined.\n\nAll threat intelligence work requires intelligence requirements. These will help align the\noutput to a business objective or something your organization finds valuable. Hunters may\nneed to extrapolate a purpose from the higher scope requirements. Make sure you can\njustify the extrapolation, though, or you may end up with a hunt that does not add any value!\n\nAll experienced hunters will be very familiar with wasted time and effort. This is part of threat\nhunting. To ensure things do not run unbounded, set a time limit on your activity. If a hunter\nthinks success is around the corner and runs out of time, they should discuss it with their\npeers. A second opinion often helps.\n\n## Beginning our example hunt\n\n[To take a recent example, Apache 2.4.49 had a vulnerability described by CVE 2021 41773.](https://nvd.nist.gov/vuln/detail/CVE-2021-41773)\n[Team Cymru published a blog about the total number of systems running this version.](https://team-cymru.com/blog/2021/10/07/apache-vulnerability-allows-rce-and-path-traversal/)\n\n**Our data for this hunt will be Twitter, GitHub, Shodan, and system logs.**\n\nThis vulnerability is trivial to exploit. It requires a simple GET or POST request that can\nexfiltrate data or allow remote code execution.\n\n\n-----\n\n**Our hypothesis will be: Our organization has compromised systems and needs to start**\nDigital Forensics and Incident Response (DFIR)’.\n\nGiven that the data for this hunt is at our fingertips, we can set our time limit to one day. For\nthis hunt, our intelligence requirement — our why — is to answer a simple set of\nquestions. Please spend one day to create a report that answers the following questions, to\nthe degree possible given a one-day time constraint:\n\nIs there reason to believe we have been impacted by the CVE-2021-41773\nvulnerability?\nShould we start DFIR activities?\nWhat defensive actions should, if any, should we take in response to CVE 2021 41773?\n\n### Twitter search\n\nTwitter often provides useful near real-time information as researchers discover things about\nsoftware bugs. For this search, we can use ‘CVE 2021 41773’.\n\nWe find a clear and simple example of a one-line command to exploit this vulnerability:\n\nFigure 2\n\n— Tweet showing method to scan hosts and determine vulnerability to CVE 2021 41773.\n[(Source)](https://twitter.com/HackerGautam/status/1445666357920428036)\nWe find several other tweets showing similar easy-to-use commands for this vulnerability.\nWe also see a US CISA post tying CVE 2021 41773 to CVE 2021 42013. The following tweet\nlinks to an article explaining that the v2.4.50 patch introduces another vulnerability:\n\n\n-----\n\n[Figure 3 — Tweet linking CVE 2021 41773 and CVE 2021 42013. (Source)](https://twitter.com/USCERT_gov/status/1446208533356236805)\nWe also find a tweet showing a Shodan screenshot. This shows 112,756 worldwide service\nports listening with this version.\n\n\n-----\n\n[Figure 4 — Tweet showing Shodan search for Apache 2.4.49. (Source)](https://twitter.com/CDyn999/status/1445508308698218511)\n\n### Shodan search\n\nOur first search is for Apache/2.4.49. This shows a count of 67,891 services listening as of\n11 October 2021. Previous counts seen in tweets were higher! This is a good sign of\npatching progress worldwide. Shodan counts represent listening services counts, not host\ncounts. The number of affected systems is less than this count, as many systems running\nApache listen on 80 and 443, with some listening on several other ports.\n\nShodan presents an interface to query different host details exposed across the Internet. We\nwill use this to assess the general scope of concern.\n\nNext, we can search for ‘Apache/2.4.50’ and get a count of 13,568 listening services. These\nservices are vulnerable to the second vulnerability, CVE 2021 42013.\n\n\n-----\n\nFigure 5\n\n— Shodan search for Apache/2.4.50 from 11 October 2021.\n**NOTE: These counts are for worldwide services that are vulnerable. Paid Shodan allows**\nfiltering to a specific network.\n\n### GitHub search\n\nGitHub is often the place researchers share code that demonstrates vulnerabilities. We’ll\nsearch GitHub for ‘CVE 2021 41773’. We can then sort by ‘Least recently updated’. This\nshould give us an idea of when public Proof of Concept (POC) code became available.\n\n\n-----\n\nFigure 6 — GitHub search showing results of searching for the CVE.\nWe learn that the first POCs became available ‘six days ago’, or 5 October 2021. This is the\nsame day CVE 2021 41773 became public. Wow! These were available very shortly after the\nCVE!\n\nFor brevity, we will not show the specific code. Please search for CVE 2021 41773 on GitHub\nif you are interested in seeing the code.\n\n### System logs\n\nSystem logs provide our internal ‘source of truth’. These are hopefully available via central\nlogging systems or Security Information and Event Management (SEIM) systems. If not,\nchecking individual systems may be necessary.\n\nWe can see from Twitter and GitHub that the string %2e/%2e appears in all examples.\nSearching our Apache access and error logs for this string will help us understand our\nexposure.\n\nWe first see some strings that appear to show exploit attempts against us:\n\nFigure 7 — Log image showing successful fetches of /etc/passwd.\nSearching further back, we see attempts as early as 18 September 2021! This vulnerability is\nin use for about a month.\n\nFigure 8 — Log image showing successful fetches from 18 September 2021.\n\n\n-----\n\n**Note: In our environment, we were not vulnerable to this flaw. These logs simulate how a**\nsuccessful retrieval of /etc/passwd would look.\n\n## Time to report\n\nWe’ve so far shown how to perform the hunt. This alone does not get us to a finished\nintelligence state. We have refined data now that helps us to form conclusions.\n\nWe now need to create a finished intelligence product. For this, use a template to match your\nintended audience. The example report included offers a simplified format suitable for\nexecutives and technicians.\n\n[Example_Threat_Intelligence_Report for CVE-2021-41773Download](https://blog.apnic.net/wp-content/uploads/2021/10/Example_Threat_Intelligence_Report.pdf)\nOrganizations today are struggling to keep up with the modern-day threat environment. It\ntakes time, it takes talent, and it takes tools to be successful. We covered some tools and\ntechniques here that can get you started. Happy hunting and stay safe out there!\n\n_James Shank is Chief Architect of Community Services and Senior Security Evangelist at_\n_Team Cymru._\n\nRate this article\n\nThe views expressed by the authors of this blog are their own and do not necessarily reflect\n[the views of APNIC. Please note a Code of Conduct applies to this blog.](https://blog.apnic.net/?p=395)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-10-21 - How to- Threat hunting and threat intelligence.pdf"
    ],
    "report_names": [
        "2021-10-21 - How to- Threat hunting and threat intelligence.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536028,
    "ts_updated_at": 1743041370,
    "ts_creation_date": 1653766035,
    "ts_modification_date": 1653766035,
    "files": {
        "pdf": "https://archive.orkl.eu/5338d38fb137f961c84a4d6cf8d3482805f3b828.pdf",
        "text": "https://archive.orkl.eu/5338d38fb137f961c84a4d6cf8d3482805f3b828.txt",
        "img": "https://archive.orkl.eu/5338d38fb137f961c84a4d6cf8d3482805f3b828.jpg"
    }
}