{
    "id": "d20b5b6f-21c8-4545-bcce-20f44a9a5cb9",
    "created_at": "2023-01-12T15:00:16.164733Z",
    "updated_at": "2025-03-27T02:13:25.096587Z",
    "deleted_at": null,
    "sha1_hash": "7bc99f006fd7c42f8416f5d729d704533cca372e",
    "title": "2021-02-18 - nccTrojan used in targeted attack by TA428 group against defense and aviation organizations",
    "authors": "",
    "file_creation_date": "2022-05-28T02:19:02Z",
    "file_modification_date": "2022-05-28T02:19:02Z",
    "file_size": 335005,
    "plain_text": "# 標的型攻撃グループTA428が防衛・航空関連組織に対して使用したマ ルウェアnccTrojanについて\n\n**insight-jp.nttsecurity.com/post/102gr6l/ta428ncctrojan**\n\nHiroki Hada\n\n本日の記事は、SOC アナリスト 小澤 文生、小池 倫太郎の記事です。\n\n--\nこれまでのブログ[1][2][3] でTmangerとそれに関連するマルウェアについて紹介しました。Tmangerは私達\nが2020年2月に、TA428のOperation LagTime ITについて行ったリサーチ で観測したマルウェアです。詳細\nはVB2020 localhostでの発表資料[4]を参照していただきたいと思いますが、そのリサーチではTmanger以外\n\n\n-----\n\nにも未知のマルウェアを観測しました。私達はそのマルウェアをnccTrojanと呼んでおり、これまでに4つの\nバージョンを確認しています。今回はnccTrojanについて、解析結果を共有します。\n\n## nccTrojan\n\nnccTrojan（あるいはMsmRATとも呼ばれる）はTmangerと同様に、TA428が使用するRATです。私達はロ\nシアやモンゴルといった東アジアの防衛・航空関連組織に対する攻撃でnccTrojanが使用されていることを\n複数観測しています。\n\nnccTrojanは攻撃の初期段階（Royal Road RTF Weaponizerによって生成されたRTFを開くこと）で実行さ\nれることもありますし、より攻撃が進行した横展開後に実行されることもあります。しかし、TA428が使う\n他のRAT（SPIVYやCotx RAT）とは異なり、観測数は極めて少なく、これまでほとんど知られていません\nでした。私達の調査では、少なくとも2019年3月頃には開発されており、2020年11月にも使用が確認されて\nいます。\n\nnccTrojanにはv1とv2の2つのメジャーバージョンが存在すると考えられます。それぞれの中ではより細かく\nマイナーバージョンが区切られており、例えばv1はv1.6やv1.7が存在しますが、それらの実装にはそれほど\n大きな差は存在しません。しかし、v1とv2の実装はかなり異なっており、一見すると同一のマルウェアフ\nァミリであるとは考えられません。私達は「同一の攻撃グループ（TA428）、攻撃キャンペーン\n（Operation LagTime IT）で使用されていること」「PDBパスの共通点」からv1とv2を同一のマルウェアフ\nァミリとして扱っていますが、v2が登場してからもv1が使用されることがあり、v1とv2は独立した関係に\nあるのかもしれません。そのため、以下ではv1とv2のそれぞれの機能・特徴について、解析結果を示しま\nす。\n\n## Analysis Result\n\n### Version 1\n\n私達が発見した最も古いnccTrojanは2019年3月頃のv1.6です。その後、2020年11月にもv1の使用を観測し\nました。その際の検体はバージョン情報が含まれていないものの、v1.6と極めて類似しており、ほとんどの\n機能は同一でした。そのため、以下ではv1.6について扱います。\n\nファイル名 **PDBパス**\n\nOSE.EXE C:\\Users\\abc\\Desktop\\cTrojan\\1.6\\HK\\Release\\Microsoft Synchronization Manager.pdb\n\nOSE.EXEは起動すると、まずMutexのチェックを行います。msm_1.6_Mutex というMutexが既に作成され\nている場合、その時点で終了します。存在しない場合、新たに作成し、処理を継続します。このMutexの値\nはバージョンによって異なっており、例えばv1.7の場合は msm_1.7_Mutex というMutexが作成されます。\nmsm というのはPDBパスに含まれている Microsoft Synchronization Manager の略であると考えています。\nMutexを作成しない検体もあり、例えば2020年11月に観測された検体はMutexを作成しません。\n\nその後、C&Cサーバーと通信を行い、コマンド操作を受け付けます。トラフィックは0x28でXORされてい\nます。\n\n\n-----\n\nv1には以下のようにファイル操作やリモートシェル、プロセス操作など、RATとしての基本的なコマンドが\n実装されていることを確認しています。\n\n**Command** **Function**\n\n\"0000\" 何もしない\n\n\"1000\" ディスク情報の送信\n\n\"1001\" ファイル情報の送信\n\n\"1002\" ファイルの削除\n\n\"1003\" プログラムの実行\n\n\"2000\" リモートシェルの起動\n\n\"2001\", \"2002\" リモートシェル上でのOSコマンドの実行\n\n\"3000\" ファイル転送用接続の確立\n\n\"3001\" ファイル転送用接続の切断\n\n\"3002\" ファイル転送用接続上での感染端末へのファイルのアップロード\n\n\"3003\" ファイル転送用接続上での感染端末からのファイルのダウンロード\n\n\"4000\" プロセスリストの送信\n\n\"4001\" プロセスの停止\n\n### Version 2\n\nv2はv1とは異なり、攻撃がさらに進行した段階（横展開後でシステム権限を既に持っている状態）で使用\nされます。また、起動の方法もv1とは異なっており、v2はインストーラによってサービスに登録されるこ\nとで動作します。\n\n\n-----\n\n私達が観測したnccTrojanはInstsrv.exeとWindowsResKits.dllの2つのファイルから成ります。\n\nファイル名 **PDBパス**\n\nInstsrv.exe C:\\Users\\abc\\Desktop\\Service\\Release\\Instsrv.pdb\n\nWindowsResKits.dll C:\\Users\\abc\\Desktop\\cTrojan\\2.1\\HK\\Release\\Client.pdb\n\nInstsrv.exeはその名のとおりインストーラで、WindowsResKits.dllをシステムディレクトリにコピーし、サ\nービスとして登録します。\n\nサービス名 イメージパス\n\n\nMicrosoft Windows\nResource Kits\n\n\n%SYSTEMROOT%\\System32\\svchost.exe -k WindowsResKits\n\n\nWindowsResKits.dllはServiceMainから起動されると、DLL 内部にある暗号化されたConfigを復号します。\n\n項目 値\n\nC&Cサーバー 45.77.129.213:443\n\nバージョン v2.1[exe]\n\nアクティベーションコード ncc\n\nその後、C&Cサーバーにアクセスし、 C&Cサーバーから受信したコマンドが14（コマンド制御のアクティ\nベート）で、さらにそのコンテンツがConfigデータのアクティベーションコードと一致している場合、バッ\nクドアとしてのコマンド受信処理が有効化されます。 C&Cサーバーとのアクセスは独自のTCP通信を行\nい、TCPペイロードは以下のような形式になっています。\n\nTCPペイロードは、8バイトのSIZEフィールドと暗号化されたDATAフィールドで構成されています。SIZE\nフィールドは、DATAフィールドの長さを10進数の文字で記載し、無効な桁数は文字「x」で表した、ユニ\nークな値となっています。\n\nDATAフィールドはAESによって暗号化されています。鍵とIVは以下のとおりです。\n\n\n-----\n\n項目 値\n\n鍵 981511371412780969AFC3AB20720187\n09A83A3332466A8B56FF3FAB8E6C3DAA\n\nIV 2042123224315117031B1A0A3CCDA53F\n\n暗号化されたDATAフィールドを復号すると、以下のような構造になっています。\n\n復号されたDATAフィールドには、C&Cサーバーからのコマンドとそのコマンドに関連するコンテンツが含\nまれています。AESはブロック暗号方式であるため、コンテンツの長さに応じて末尾にPaddingは追記され\nています。また、先頭8バイトはコマンドとコンテンツの長さを表していますが、TCPペイロードのSIZEフ\nィールドと同じ表記方式が使用されています。\n\n実装・観測されているコマンドとその機能は以下のとおりです。使用されるコマンドの値はv1と大きく異な\nっていますが、コマンドの機能は概ね同じ内容で構成されています。\n\n**Command** **Function**\n\n2, 29 リモートシェルの起動\n\n3 リモートシェル上でのOSコマンドの実行（マルチバイト）\n\n4 リモートシェル上でのOSコマンドの実行（ASCII）\n\n5 ディスク情報の送信\n\n6 ファイルリストの送信\n\n8 プログラムの実行\n\n10 ファイルやフォルダの削除\n\n12 感染端末からのファイルのダウンロード\n\n14 コマンド制御のアクティベート\n\n\n-----\n\n15, 17 感染端末へのファイルのアップロード\n\n19 プロセスリストの送信\n\n21 プロセスの停止\n\n22 何もしない\n\n23 ファイルのコピー\n\n26 ファイルの移動\n\n## ツール\n\nnccTrojanはv1でもv2でも、C&Cサーバーと通信する際のデータはエンコードされています。v1は単純な\nXORであるため復号は容易ですが、v2は多少複雑な構造となっています。そこで、私達はv2のトラフィッ\nクをデコードして内容をパースするツールを作成しました。関連するマルウェアの解析やインシデント調査\nにご活用ください。\n\n[ダウンロード](https://www.nttsecurity.com/ja-jp/Resources) ページの「C&C Traffic Decryption Tools for Tmanger/nccTrojan」からダウンロードいただけ\nます。\n\n## さいごに\n\nnccTrojanはv1もv2も両方とも、現在でも継続して開発が続いており、使用されているRATです。ロシアや\nモンゴルなどの航空・軍事組織に対する攻撃で多用されていますが、Tmangerのように他の攻撃グループと\n共有する可能性があります。今後も引き続き警戒していく必要があるでしょう。\n\n## IOC\n\n### C&Cサーバー\n\ncustom.songuulcomiss[.]com (103[.]106.250.239)\n95[.]179.131.29\n45[.]77.129.213\nnews.niiriip[.]com (51[.]89.133.251)\n\n### ファイル情報\n\n**Version** **SHA256** **PDB**\n\n\nN/A 21d1324c4ff4d68453d6745a1467ef3a\n\ncf8a853052e3425d12ad85c9b631f968\n\n\nN/A\n\n\n-----\n\n1.6 4c22eb33aa1d10511eaf8d13098e2687\n\ne44eaebc5af8112473e28acedac34bea\n\n2.1 4651c51c86e4fc1a2bcad81936970ea5\n\n49742a89316fa28e26433e94a8f13b66\n\n2.2 3be516735bafbb02ba71d56d35aee8ce\n\n2ef403d08a4dc47b46d5be96ac342bc9\n\n## 参考文献\n\n\nC:\\Users\\abc\\Desktop\\cTrojan\\1.6\\HK\\Release\\Microsoft\nSynchronization Manager.pdb\n\nC:\\Users\\abc\\Desktop\\cTrojan\\2.1\\HK\\Release\\Client.pdb\n\nC:\\Users\\abc\\Desktop\\cTrojan\\2.2\\HK\\Release\\Client.pdb\n\n\n\n[1] [NTT Security Japan, Panda’s New Arsenal: Part 1 Tmanger](https://insight-jp.nttsecurity.com/post/102gi9b/pandas-new-arsenal-part-1-tmanger)\n\n[2] [NTT Security Japan, Panda’s New Arsenal: Part 2 Albaniiutas](https://insight-jp.nttsecurity.com/post/102gkfp/pandas-new-arsenal-part-2-albaniiutas)\n\n[3] [NTT Security Japan, Panda’s New Arsenal: Part 3 Smanager](https://insight-jp.nttsecurity.com/post/102glv5/pandas-new-arsenal-part-3-smanager)\n\n[4] [VB2020 localhost, Operation LagTime IT: colorful Panda footprint](https://vblocalhost.com/conference/presentations/operation-lagtime-it-colourful-panda-footprint/)\n\n\n-----",
    "language": "JA",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-02-18 - nccTrojan used in targeted attack by TA428 group against defense and aviation organizations.pdf"
    ],
    "report_names": [
        "2021-02-18 - nccTrojan used in targeted attack by TA428 group against defense and aviation organizations.pdf"
    ],
    "threat_actors": [
        {
            "id": "a4aca3ca-9e04-42d1-b037-f7fb3fbab0b1",
            "created_at": "2023-01-06T13:46:39.042499Z",
            "updated_at": "2025-03-27T02:00:02.984002Z",
            "deleted_at": null,
            "main_name": "TA428",
            "aliases": [
                "Colourful Panda",
                "BRONZE DUDLEY"
            ],
            "source_name": "MISPGALAXY:TA428",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "2f07a03f-eb1f-47c8-a8e9-a1a00f2ec253",
            "created_at": "2022-10-25T16:07:24.277669Z",
            "updated_at": "2025-03-27T02:02:10.157972Z",
            "deleted_at": null,
            "main_name": "TA428",
            "aliases": [
                "Operation LagTime IT",
                "Operation StealthyTrident",
                "ThunderCats"
            ],
            "source_name": "ETDA:TA428",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "Agent.dhwf",
                "Albaniiutas",
                "BlueTraveller",
                "Chymine",
                "Cotx RAT",
                "CoughingDown",
                "Darkmoon",
                "Destroy RAT",
                "DestroyRAT",
                "Gen:Trojan.Heur.PT",
                "Kaba",
                "Korplug",
                "LuckyBack",
                "PhantomNet",
                "PlugX",
                "Poison Ivy",
                "RedDelta",
                "RoyalRoad",
                "SManager",
                "SPIVY",
                "Sogu",
                "TIGERPLUG",
                "TManger",
                "TVT",
                "Thoper",
                "Xamtrav",
                "pivy",
                "poisonivy"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "c416260c-7ff6-4a74-a5ba-a15f40d3543f",
            "created_at": "2024-05-01T02:03:07.939268Z",
            "updated_at": "2025-03-27T02:05:17.25652Z",
            "deleted_at": null,
            "main_name": "BRONZE DUDLEY",
            "aliases": [
                "Temp.Hex ",
                "Vicious Panda ",
                "TA428 "
            ],
            "source_name": "Secureworks:BRONZE DUDLEY",
            "tools": [
                "PoisonIvy"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673535616,
    "ts_updated_at": 1743041605,
    "ts_creation_date": 1653704342,
    "ts_modification_date": 1653704342,
    "files": {
        "pdf": "https://archive.orkl.eu/7bc99f006fd7c42f8416f5d729d704533cca372e.pdf",
        "text": "https://archive.orkl.eu/7bc99f006fd7c42f8416f5d729d704533cca372e.txt",
        "img": "https://archive.orkl.eu/7bc99f006fd7c42f8416f5d729d704533cca372e.jpg"
    }
}