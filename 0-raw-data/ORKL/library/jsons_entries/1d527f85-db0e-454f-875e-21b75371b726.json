{
    "id": "1d527f85-db0e-454f-875e-21b75371b726",
    "created_at": "2023-01-12T15:04:09.978996Z",
    "updated_at": "2025-03-27T02:06:01.613257Z",
    "deleted_at": null,
    "sha1_hash": "3b16fcd2210b41ea60eb27e9f326c5eb675dbb4f",
    "title": "2014-05-06 - Rovnix new “evolution”",
    "authors": "",
    "file_creation_date": "2022-05-28T15:34:56Z",
    "file_modification_date": "2022-05-28T15:34:56Z",
    "file_size": 277893,
    "plain_text": "# Related Posts\n\n**malwaretech.com/2014/05/rovnix-new-evolution.html**\n\nMalwareTech May 6, 2014\n\nRovnix is an advanced VBR (Volume Boot Record) rootkit best known for being the bootkit\ncomponent of Carberp. The kit operates in kernel mode, uses a custom TCP/IP stack to\nbypass firewalls, and stores components on a virtual filesystem outside of the partition.\n[Yesterday Microsoft posted an update explaining a new “evolution” to rovnix that had been](http://blogs.technet.com/b/mmpc/archive/2014/05/05/the-evolution-of-rovnix-new-virtual-file-system-vfs.aspx)\nfound.\n\n“evolution”\n\n## The so-called Evolution\n\n**I’m Melting**\nThe first thing i noticed was the file “melts” (delete’s itself once run (well, tries to)), this is\ndone by a lot of malware to prevent future forensics, but how this sample does it is a little\nless than elegant.\n\nSo advanced\n\n\n-----\n\nThe bot drops a non-hidden batch file to the location it s run from (in my case the desktop),\nthe batch file just uses the “DEL” command on an infinite loop, which uses all of the CPU,\nuntil the file is deleted. On my test system, the batch file actually fails because the\nexecutable locks the file, meaning it can only be deleted once the executable stops (the\nsystem reboots), when the system reboots windows stops the batch file before the\nexecutable, thus it’s never deleted.\n**Initial Infection**\nAfter executing the packed binary it unpacks itself and continues running, the above batch\nfile is deployed to delete the dropper after run. For stealth reasons, the kit sits idle for an\nundefined amount of time (I’m yet to find out how this is done), then the system is\nautomatically rebooted. NtShutdownSystem is hooked to receive notifications of shutdowns /\nreboots, so rebooting the computer will result in intimidate infection and save you a wait.\nAmusingly the packed dropper doesn’t exit until reboot and the delay is long enough to\nattach a debugger, dump the unpacked code from memory, then move it to another\ncomputer.\nThe entire kit is packed inside the dropper, about 13 files total (32-bit and 64-bit) and during\nthe reboot delay everything exists in one continuous block of memory and once dumped; the\ncomponents can be split up by byte signature “0x4D 0x5A 0x90” (DOS header).\n**No VBR**\nThe first thing i noticed after infection is that the first 16 sectors of the disk are blank (where\nthe VBR should be located). To anyone familiar with rovnix this is a common sign of infection,\nas it uses the kernel driver to hide infected sectors (which is probably just as suspicious as\nshowing them).\n\nErmahgerd\n\n**Stability**\nThe kit appears to run ok on Windows XP 32-bit, but on Windows 7 64-bit it causes the PC to\nBSOD about every 20 minutes (Sometimes the system can even get stuck in an infinite\nBSOD loop)\n\n\n-----\n\n**Anti Reversing**\nI can’t tell if I’m going crazy or the anti reversing protection is what I think it is. The driver\nappears to check for a wide variety of reversing tools (vbox, vmaware, wireshark, ollydbg,\nida, lordpe, etc), then disregards the results and exits the thread. My tests appear to confirm\nthis as I’ve infected a VM with multiple blacklisted tools running and the malware still\ncontinues the infection.\n\nThe return value will be non-zero if any blacklisted tools are found\n\nDisregard everything?\n\nI’ve checked through the ASM multiple time, but can’t seem to find anything that would result\nin the bot being any wiser about the environment after the execution of this thread.\n**Virtual File System**\nRemember the old rovnix filesystem? It used raw disk access to store components outside of\nthe filesystem in non-allocated disk space, making it near impossible for the AV to find or\nremove? Well that has been “upgraded”. The virtual filesystem is now stored inside a file in\n“C:system32”, free for the AV to delete at any point (Coder couldn’t figure how to access\nvirtual filesystem from usermode?). The file-name ends in “.bin” and is a 64-bit hex value\ngenerated using the time stamp counter (“rdtsc” instruction), all files are encrypted with RC6.\n\n\n-----\n\nExample File-name Generation\n\nBecause the file system is now vulnerable due to it being saved as a standard windows file,\nthe coders have added a high level (and fairly useless) kernel mode rootkit to the driver. The\nrootkit places SSDT hooks on the following functions:\n\nNtQueryDirectoryFile – Hides the file.\nNtCreateFile – Prevents file from being opened by all except bot.\nNtOpenFile – Same as above.\nNtClose – No idea.\nNtSetInformationFile – Prevents rename / delete.\nNtDeleteFile – Prevents delete.\nNtQueryInformationFile – Hides the file.\n\nAdditionally the rootkit also hooks some registry functions to hide keys, I can’t see any sane\nreason why.\n\n\n-----\n\nEach hook entry is an array of 16 bytes (4 double words)\n\nAlthough this won’t protect against antiviruses, it may stop usermode malware and beginner\nsecurity researchers from tampering with the filesystem.\n**Usermode Component**\nThis entire bootkit + kernel mode rootkit all serves to protect a small trojan which appears to\nrun as a service and do nothing other than log keys and ammyy id’s to a command and\ncontrol server. The MD5 has is: 5e5f3ced234c6f7c91457a875cf4a570.\n**Conclusion**\nThis isn’t the work of common scriptkiddies, it’s likely the coder has a moderate knowledge of\nkernel mode programming; however, the code is not experience with malware (using SSDT\nhooks and filters in a bootkit, having to move the virtual filesystem into a real file to access it\nfrom usermode, using batch file to delete melt exe). This clearly isn’t an “evolution” of rovnix\nas Microsoft claim, it’s just some random coders trying to make the bootkit compatible with\ntheir bot.\nThanks to Poopsmith for bringing the sample to my attention and Xylitol for retrieving it for\nme.\n\nFinally, something to reverse.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2014/2014-05-06 - Rovnix new “evolution”.pdf"
    ],
    "report_names": [
        "2014-05-06 - Rovnix new “evolution”.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535849,
    "ts_updated_at": 1743041161,
    "ts_creation_date": 1653752096,
    "ts_modification_date": 1653752096,
    "files": {
        "pdf": "https://archive.orkl.eu/3b16fcd2210b41ea60eb27e9f326c5eb675dbb4f.pdf",
        "text": "https://archive.orkl.eu/3b16fcd2210b41ea60eb27e9f326c5eb675dbb4f.txt",
        "img": "https://archive.orkl.eu/3b16fcd2210b41ea60eb27e9f326c5eb675dbb4f.jpg"
    }
}