{
    "id": "a402a7e6-69b6-4be0-bacf-4b34431f0dff",
    "created_at": "2023-01-12T15:06:22.765056Z",
    "updated_at": "2025-03-27T02:06:09.069929Z",
    "deleted_at": null,
    "sha1_hash": "e86f4dd7f77185f51087d488dca6d1ca097c8e32",
    "title": "2022-03-06 - AvosLocker Ransomware Behavior Examined on Windows & Linux",
    "authors": "",
    "file_creation_date": "2022-05-28T16:13:30Z",
    "file_modification_date": "2022-05-28T16:13:30Z",
    "file_size": 1184164,
    "plain_text": "# AvosLocker Ransomware Behavior Examined on Windows & Linux\n\n**blog.qualys.com/vulnerabilities-threat-research/2022/03/06/avoslocker-ransomware-behavior-examined-on-windows-**\nlinux\n\nGhanshyam More March 6, 2022\n\n_AvosLocker is a ransomware group that was identified in 2021, specifically targeting_\n_Windows machines. Now a new variant of AvosLocker malware is also targeting Linux_\n_environments. In this blog, we examine the behavior of these two AvosLocker Ransomware_\n_in detail._\n\nAvosLocker is a relatively new ransomware-as-a-service that was first spotted in late June\n2021. The attackers use spam email campaigns as initial infection vectors for the delivery of\nthe ransomware payload. During the encryption, process files are appended with the “.avos”\nextension. An updated variant appends with the extension “.avos2”. Similarly, the Linux\nversion appends with the extension “.avoslinux”.\n\nAfter every successful attack, the AvosLocker gang releases the names of their victims on\nthe Dark Leak website hosted on the TOR network and provides exfiltrated data for sale.\nURL structure: `hxxp://avosxxx…xxx[.]onion`\n\nThe AvosLocker gang also advertises their latest ransomware variants on the Dark Leak\nwebsite. URL structure: `hxxp://avosjonxxx…xxx[.]onion`\n\nThe gang has claimed, “The AvosLocker’s latest Windows variant is one of the fastest in the\nmarket with highly scalable threading and selective ciphers.” They offer an affiliate program\nthat provides ransomware-as-a-service (RaaS) for potential partners in crime.\n\n\n-----\n\nRecently they have added support for encrypting Linux systems, specifically targeting\nVMware ESXi virtual machines. This allows the gang to target a wider range of\norganizations. It also possesses the ability to kill ESXi VMs, making it particularly nasty.\n\nAccording to [deepweb research by Cyble Research Labs, the Threats Actors of AvosLocker](https://blog.cyble.com/2022/01/17/avoslocker-ransomware-linux-version-targets-vmware-esxi-servers/)\nransomware groups are exploiting Microsoft Exchange Server vulnerabilities using\nProxyshell, compromising the victim’s network.\n\nCVEs involved in these exploits are CVE-2021-34473, CVE-2021-31206, CVE-2021-34523,\nand CVE-2021-31207.\n\n## Technical Analysis of AvosLocker Windows Variant\n\n**Command-Line Options**\n\nThe following figure shows a sample of Command-Line Options.\n\nFig. 1: Command Line Option\nThe available options allow for control over items like enabling/disabling SMB brute force,\nmutex creation, or control over the concurrent number of threads.\n\nIf no options are given, the malware runs with default options as shown in figure 2, where it\nignores encryption of network drives and SMB share. It runs 200 threads concurrently of its\nfile encryption routine.\n\nFig. 2: Execution with Default Parameter\nWhile execution, the malware console displays detailed information about its progress on the\nscreen (fig. 3).\n\n\n-----\n\nFig. 3: Progress Details\nMost of the strings in the malware are kept in the XOR encrypted format. The decryption\nroutines are similar, only registers and keys are different (fig. 4). Strings are decrypted just\nbefore their use.\n\nFig. 4: Commonly Used Decryption Routine\nInitially, the malware collects the command line options provided while launching the\napplication (fig. 5).\n\nFig. 5: Get command-line Options\nThen it decrypts the mutex name “Cheic0WaZie6zeiy” and checks whether it is already\nrunning or not to avoid multiple instances (fig. 6).\n\nFig. 6: Mutex Creation\nAs shown in figure 7, AvosLocker uses multi-threaded tactics. It calls the below APIs to\ncreate multiple instances of worker threads into memory and share file paths among multiple\nthreads. Smartly utilizing the computing power of multi-core CPUs.\n\nAPIs called:\n\nCreateIoCompletionPort()\nPostQueuedCompletionStatus()\nGetQueuedCompletionPort()\n\n\n-----\n\nFig. 7: Use of CreateIoCompletionPort\nThe code creates multiple threads in a loop (fig. 8). The threads are set to the highest priority\nfor encrypting data quickly.\n\nFig. 8: Create Thread In-Loop and Set Priority\nAvosLocker ransomware performs a recursive sweep through the file system (fig. 9),\nsearches for attached drives, and enumerates network resources using API\nWNetOpenEnum() and WnetEnumResource().\n\nFig. 9: Search Network Share\nBefore selecting the file for encryption, it checks for file attributes and skips it if\n“FILE_ATTRIBUTE_HIDDEN” or “FILE_ATTRIBUTE_SYSTEM” as shown in figure 10.\n\nFig. 10: Check File Attribute\nOnce the file attribute check is passed, it performs the file extension check. It skips files from\nencryption if its extension gets matched with one of the extensions shown in figure 11.\n\n\n-----\n\nFig. 11: Skip Extension List\nIt also contains the list of files and folders that need to be skipped from the encryption (fig.\n12).\n\nFig. 12: Skip File Folder List\nAvosLocker uses RSA encryption, and it comes with a fixed hardcoded ID and RSA Public\nKey of the attacker (fig. 13).\n\nFig. 13: Hardcoded Public Key\nAfter file encryption using RSA, it uses the ChaCha20 algorithm to encrypt encryption-related\ninformation (fig. 14).\n\n\n-----\n\nFig. 14: Use of ChaCha20\nIt appends this encryption-related information (fig. 15) at the end of the file with Base64\nencoded format.\n\nFig.15: Encryption Related Information\nThen it appends the “avo2” extension to the file using MoveFileWithprogressW (fig. 16).\n\n\n-----\n\nFig. 16: Add Extension Using Move File\nAs seen in figure 17, it has appended “avos2” extensions.\n\nFig. 17: File with Updated Extension\nIt writes a ransom note (fig. 18) named “GET_YOUR_FILES_BACK.txt” to each encrypted\ndirectory before encryption of the file.\n\nFig. 18: Ransom Note\nThe ransom note instructs the user to not to shut down the system in case encryption is in\nprogress to avoid file corruption. It asks the victim to visit the onion address with the TOR\nbrowser to pay the ransom and to obtain the decryption key to decrypt the application or\nfiles.\n\n**AvosLocker Payment System**\n\nAfter submitting the “ID” mentioned on the ransom note to AvosLocker’s website (fig. 19), the\nvictim will be redirected to the “payment” page.\n\n\n-----\n\nFig. 19: AvosLocker’s Website\nIf the victim fails to pay the ransom, the attacker then puts the victim’s data up for sale.\nFigure 20 shows the list of victims (redacted for obvious reasons) mentioned on the site.\n\nFig. 20: List of Victims\nAvosLocker also offers an affiliate program that provides ransomware-as-a-service (RaaS).\nThey provide “helpful” services to clients such as:\n\nSupports Windows, Linux & ESXi.\nAffiliate panel\nNegotiation panel with push & sound notifications\n\n\n-----\n\nAssistance in negotiations\nConsultations on operations\nAutomatic builds\nAutomatic decryption tests\nEncryption of network resources\nKilling of processes and services with open handles to files\nHighly configurable builds\nRemoval of shadow copies\nData storage\nDDoS attacks\nCalling services\nDiverse network of penetration testers, access brokers and other contacts\n\nFig. 21: Partnership Program\n\n## Technical Analysis of AvosLocker Linux Variant\n\nIn this case, the AvosLocker malware arrives as an elf file. As shown in figure 22, the\nanalyzed file is x64 based Linux executable file.\n\n\n-----\n\nFig. 22: File Details\nIt’s a command-line application having some command-line options (fig. 23).\n\nFig. 23: Command-Line Options\nThe `<Thread count> parameter as shown above represents the number of threads that`\ncan be created to encrypt files simultaneously. It possesses the capability to kill ESXi VMs\nbased on the parameter provided while executing.\n\nUpon execution, the malware first collects information about the number of threads that need\nto be created. Then it checks for string “vmfs” in the file path provided as a command-line\nargument (fig. 24).\n\nFig. 24: Checks for “vmfs”\nAfter that, it also checks for string “ESXi” in the file path provided as a command-line\nargument (fig. 25).\n\n\n-----\n\nFig. 25: Checks for “ESXi”\nIf this parameter is found, then it calls a routine to kill the running ESXi virtual machine (fig.\n26).\n\nFig. 26: Code to Kill ESXi Virtual Machine\nThe command used for killing the ESXi virtual machine is as shown in figure 27.\n\nFig. 27: Command to Kill Running ESXi Virtual Machine\nFurther, AvosLocker drops a ransom note file (fig. 28) at the targeted directory.\n\nFig. 28: Create ransom note\nAfter that, it starts creating a list of files that must be encrypted. Before adding a file path to\nthe list, it checks whether it is a regular file or not (fig. 29). Only regular files are added to the\nencryption list.\n\nFig. 29: Checks File Info\n\n\n-----\n\nAvosLocker skips the ransom note file and any files with the extension avoslinux from\nadding into the encryption list (fig. 30).\n\nFig. 30: Skip “avoslinux” Extension File\nThen it calls the mutex lock/unlock API for thread synchronization as shown in figure 31.\n\nFig. 31: Lock-Unlock Mutex for Thread Synchronization\nBased on the number of threads specified, it creates concurrent CPU threads (fig. 32). This\nhelps in encrypting different files simultaneously at a very fast speed.\n\nFig. 32: Create Threads in Loop\nAvosLocker’s Linux variant makes use of Advanced Encryption Standard (AES) and ellipticcurve cryptography (ECC) algorithms for data encryption.\n\nFile-related information along with the encryption key used might be encrypted and then\nencoded with base 64 formats. This encoded information is added at the end of each\nencrypted file (fig. 33).\n\nFig. 33: File-related Info added at the end\n\n\n-----\n\nFigure 34 shows the malware appending the extension .avoslinux to the encrypted file\nnames.\n\nFig. 34: Append file extension “.avoslinux” after encryption\nBefore starting file encryption, it creates a ransom note named “README_FOR_RESTORE\n“. The content of this ransom note is shown in figure 35.\n\nFig. 35: Ransom Note\nThe ransom note instructs the victim not to shut down the system in case encryption is in\nprogress to avoid file corruption. It asks the victim to visit the onion address with a TOR\nbrowser to pay the ransom and to obtain the decryption key and decryption application.\n\n## Indicators of Compromise (IOCs):\n```\nWindows: C0A42741EEF72991D9D0EE8B6C0531FC19151457A8B59BDCF7B6373D1FE56E02\nLinux: 7C935DCD672C4854495F41008120288E8E1C144089F1F06A23BD0A0F52A544B1\nURL:\nhxxp://avosjon4pfh3y7ew3jdwz6ofw7lljcxlbk7hcxxmnxlh5kvf2akcqjad[.]onion.\nhxxp://avosqxh72b5ia23dl5fgwcpndkctuzqvh2iefk5imp3pi5gfhel5klad[.]onion\n\n TTP Map:\n\n```\n**Initial**\n**Access** **Execution** **Defense Evasion** **Discovery** **Impact**\n\n\nPhishing\n(T1566)\n\n\nUser\nExecution\n\n(T1204)\n\n\nObfuscated Files or\nInformation (T1027)\n\n\nSystem Information\nDiscovery (T1082)\n\n\nData\nEncrypted for\nImpact\n\n(T1486)\n\n\n-----\n\n**Initial**\n**Access** **Execution** **Defense Evasion** **Discovery** **Impact**\n\n\nFile and Directory\nDiscovery (T1083)\n\n\nInhibit System\nRecovery\n\n(T1490)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-03-06 - AvosLocker Ransomware Behavior Examined on Windows & Linux.pdf"
    ],
    "report_names": [
        "2022-03-06 - AvosLocker Ransomware Behavior Examined on Windows & Linux.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535982,
    "ts_updated_at": 1743041169,
    "ts_creation_date": 1653754410,
    "ts_modification_date": 1653754410,
    "files": {
        "pdf": "https://archive.orkl.eu/e86f4dd7f77185f51087d488dca6d1ca097c8e32.pdf",
        "text": "https://archive.orkl.eu/e86f4dd7f77185f51087d488dca6d1ca097c8e32.txt",
        "img": "https://archive.orkl.eu/e86f4dd7f77185f51087d488dca6d1ca097c8e32.jpg"
    }
}