{
    "id": "ca63e579-b94d-4fda-9d5f-f3db2795e340",
    "created_at": "2023-01-12T15:01:37.815904Z",
    "updated_at": "2025-03-27T02:06:06.121026Z",
    "deleted_at": null,
    "sha1_hash": "a61b1c91d646adec21cc1ecfb49e1c7448b8e052",
    "title": "2021-06-04 - Analysis of Ragnar Locker Ransomware (Acronis)",
    "authors": "",
    "file_creation_date": "2022-05-28T19:19:54Z",
    "file_modification_date": "2022-05-28T19:19:54Z",
    "file_size": 102195,
    "plain_text": "# Analysis of Ragnar Locker Ransomware\n\n**acronis.com/en-sg/articles/ragnar-locker/**\n\n## Summary\n\nFirst discovered in April 2020.\nUses the increasingly popular “double extortion” tactic, in which the attacker first exfiltrates sensitive data, then triggers the encryption\nattack, threatening to leak the stolen data if the target refuses to pay the ransom.\nHas 10 known victims to date whose data have been published on the data leak site.\nUses a specially-crafted virtual machine image for its payload execution in order to evade anti-malware detection.\nUses the Salsa20 encryption algorithm (which to strong to decrypt using brute-force methods) for file encryption and RSA-2048 to\nencrypt file keys.\nUses CVE-2017-0213 vulnerability to elevate privileges via COM objects\n\n## Delivery of Ragnar Locker\n\nThe threat actor begin the attack by compromising the company’s network via RDP service, using brute force to guess weak passwords or\nwith stolen credentials bought on the Dark Web. Next, the attacker performs second-stage reconnaissance. To elevate privileges, the attacker\nexploits the CVE-2017-0213 vulnerability in the Windows COM Aggregate Marshaler to run arbitrary code with elevated privileges. Having\nachieved privilege escalation, the attacker sometimes deploys a VirtualBox virtual machine (VM) with a Windows XP image to evade\ndetection: an early use of a virtual machine image in this manner to run the ransomware encryption attack. The technique has been adopted\nsince by the Maze family of ransomware operators.\n\nThe specially-crafted VM image is loaded to the VirtualBox VM, mapping all local drives as read/writable into the virtual machine. This allows\nthe ransomware process running inside the VM to encrypt all files. To the host files, the encryption appears to be a trusted VirtualBox process\nand thus will be ignored by many security products.\n\nNext, the Ragnar Locker operator deletes any extant shadow copies, disables any detected antivirus countermeasures, and uses a\nPowerShell script to move from one company network asset to another one. Finally, before launching Ragnar Locker ransomware, the\nattacker steals sensitive files and uploads them to one or more servers to publish them if the victim refuses to pay the ransom.\n\n## Obfuscation\n\nThe ransomware code is protected with obfuscation techniques that include adding junk code as well as encryption. The sample code snippet\nbelow shows such junk arithmetic instructions, the results of which are not used:\n\nAfter performing its most resource-intensive operations, Ragnar Locker allocates 7680 (1E00) bytes of free memory space in the current\nprocess via VirtualAllocEx().\n\nIt then fills the memory space with shellcode to run it.\n\nThe shellcode’s main goal is to allocate the ransomware executable in memory and call it.\n\nThe first call of VirtualAlloc() allocates 9218 bytes of memory to store the encrypted payload.\n\nThe second call of VirtualAlloc() allocates 48640 (BE00) bytes of memory to store the decrypted payload (PE file).\n\nThe hashes of the decrypted payload are as follows:\n\nMD5: 6360B252B21FE015D667B093F6497E33\n\nSHA256: 1DE475E958D7A49EBF4DC342F772781A97AE49C834D9D7235546737150C56A9C\n\nAfter resolving the address of the .text section, the ransomware jumps to the original entry point (OEP) of the unpacked sample.\n\n\n-----\n\n## Locale check\n\nRagnar Locker checks the locale info to avoid CIS countries from being infected. It identifies the following languages for exclusion:\n\nIt uses GetLocaleInfoW() with LANG_SYSTEM_DEFAULT and LOCALE_SENGLISHLANGUAGENAME to retrieve the operating system\ndefault language of the victim’s machine.\n\nIf the machine’s default language matches one on the CIS list, the ransomware process is terminated with the “666” exit code.\n\n## Command-line arguments\n\nRagnar Locker can be run with ‘-list’ or ‘-force’ command-line options. The “-list” argument is passed with a file containing the list of files to be\nencrypted.\n\nThe ‘-force’ argument is passed with a path pointing to where the encryption should start.\n\nBy default, the ransomware is run without any command-line options, thereby encrypting the whole system.\n\n## Ragnar Locker encryption\n\nThe payload PE file contains a section with the name “.keys” in which the crypto keys and obfuscated configuration strings are stored.\n\nThe ransomware uses hardcoded obfuscated strings, decrypted in runtime.\n\nThe first decrypted value is a unique sample ID.\n\nNext, it references a list of services to be terminated by Ragnar Locker that include strings related to backup and antivirus solutions (such as\n‘sophos’ and ‘veeam’), as well as remote management software (RMM) tools like ConnectWise and Kaseya that are typically used by\nmanaged service providers (MSPs).\n\nThe blacklist of processes includes text, database, and email processors. As a result, after terminating the processes, valuable target files\nsuch as documents, documents, and emails are released and available for encryption.\n\nThe embedded master RSA-2048 public key uses the PEM format.\n\nThe hardcoded ransom note includes the name of the target organization.\n\nRagnar Locker generates two key data arrays of 40 bytes and 32 bytes for use by Salsa20 cipher.\n\nA custom-named GenKey function uses CryptGenRandom(), then manually initializes a SHA-512 hash with corresponding constants and\neffects some permutation to encrypt using randomly-generated keys.\n\nThese keys are encrypted by the master RSA-2048 public key and added to the footer of a file.\n\nTo import a RSA-2048 key, the ransomware decodes it from Base64, then executes CryptDecodeObjectEx() to decode the structure of the\nRSA-2048 key.\n\nAfter getting the value ‘1.2.840.113549.1.1.1’ -- which stands for RSAES-PKCS1-v1_5 encryption scheme -- Ragnar Locker imports the public\nkey by using CryptImportPublicKeyInfo().\n\nWith the keys for encryption in hand, the malware next deletes any extant shadow copies by running processes with the following commands:\n\n_Wmic.exe shadowcopy delete_\n\n_Vssadmin delete shadows /all /quiet_\n\nRagnar Locker then commences the encryption process in 64 simultaneous threads.\n\nA whitelist includes the following folders, files and extensions to skip during encryption:\n\nThe file names:\n\nThe file extensions:\n\nRagnar Locker uses the Salsa20 encryption algorithm with a custom matrix, which is filled in with generated keys placed in rearranged order.\nThe matrix used for Salsa20 is 64 bytes in size, where 8 bytes defines the stream position, so the ransomware removes 16 bytes from the\nsecond key to be matched with the matrix size, and leaves the stream position values with zero bytes.\n\nRagnar Locker randomizes file extensions per user by retrieving the computername value and passing it to the next piece of code.\n\nAs output from the code above, ransomware gets 8 bytes and creates the ‘ragnar_{computer_id}’ string to append it to the filename.\n\n\n-----\n\nThe encrypted file contains the encrypted Salsa20 key data (40 32 bytes) with the signature _RAGNAR_ added to the footer at the very end.\n\nTo complete the ransom note, Ragnar Locker adds a hardcoded company_id encoded with Base64.\n\nThe ransom note file is named RGNR_{computer_id}.txt:\n\n*****************************************************************************************************************\n\nHELLO EDP.com !\n\nIf you reading this message, then your network was PENETRATED and all of your files and data has been ENCRYPTED\n\nby RAGNAR_LOCKER !\n\n*****************************************************************************************************************\n\n!!!!! WARNING !!!!!\n\nDO NOT Modify, rename, copy or move any files or you can DAMAGE them and decryption will be impossible.\n\nDO NOT use any third party or public decryption software, it also may damage files.\n\nDO NOT Shutdown or reset your system\n\n------------------------------------\nThere is ONLY ONE possible way to get back your files - contact us and pay for our special decryption key !\n\nFor your GUARANTEE we will decrypt 2 of your files FOR FREE, as a proof of our capabilities\n\nDon't waste your TIME, the link for contacting us will be deleted if there is no contact made in closest future and you will never restore your\nDATA.\n\nHOWEVER if you will contact us within 2 day since get penetrated - you can get a very SPECIAL PRICE.\n\nATTENTION !\n\nWe had downloaded more than 10TB of data from your fileservers and if you don't contact us for payment, we will publish it or sell to\ninterested parties.\n\nHere is just a small part of your files that we have, for a proof (use Tor Browser for open the link) : http://p6o7m73ujalhgkiv.onion/?p=171\n\nWe gathered the most sensitive and confidential information about your transactions, billing, contracts, clients and partners. And be assure\nthat if you wouldn't pay,\n\nall files and documents would be publicated for everyones view and also we would notify all your clients and partners about this leakage with\ndirect links.\n\nSo if you want to avoid such a harm for your reputation, better pay the amount that we asking for.\n\n==============================================================================================================\n\n! HERE IS THE SIMPLE MANUAL HOW TO GET CONTACT WITH US VIA LIVE CHAT !\n\n!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n\na) Download and install TOR browser from this site : https://torproject.org\n\nb) For contact us via LIVE CHAT open our website : http://mykgoj7uvqtgl367.onion/client/?\n6bECA2b2AFFfBC1Dff0aa0EaaAd468bec0903b5e4Ea58ecde3C264bC55c7389E\n\nc) For visit our NEWS PORTAL with your data, open this website : http://p6o7m73ujalhgkiv.onion/?page_id=171\n\nd) If Tor is restricted in your area, use VPN\n\nWhen you open LIVE CHAT website follow rules :\n\nFollow the instructions on the website.\n\nAt the top you will find CHAT tab.\n\nSend your message there and wait for response (we are not online 24/7, So you have to wait for your turn).\n\n\n-----\n\n---RAGNAR SECRET--\nNmJFQ0EyYjJBRkZmQkMxRGZmMGFhMEVhYUFkNDY4YmVjMDkwM2I1ZTRFYTU4ZWNkZTNDMjY0YkM1NWM3Mzg5RQ==\n\n---RAGNAR SECRET--\n***********************************************************************************\n\n## Ragnar Locker decryption service\n\nIt is not possible to decrypt files without having the master key or decrypter.\n\nThe ransom note provides the address of the leak site, live chat and Ragnar Secret. The Ragnar Secret described above as ‘company_id’\nencoded with Base64.\n\nThe data leak site is created to publish sensitive data stolen from the corporate network before running Ragnar Locker, because the\nransomware has no network communication.\n\nThe mirrors of the data leak site:       http://p6o7m73ujalhgkiv.onion/?page_id=171\n\nhttp://rgleaktxuey67yrgspmhvtnrqtgogur35lwdrup4d3igtbm3pupc4lyd.onion/ http://rgleak7op734elep.onion/\n\nThe Live chat no longer works once the negotiation phase between the Ragnar Locker operators and attacked organization has been\nfinished.\n\nhttp://mykgoj7uvqtgl367.onion/client/?6bECA2b2AFFfBC1Dff0aa0EaaAd468bec0903b5e4Ea58ecde3C264bC55c7389E\n\n## Detection of Ragnar Locker by Acronis Cyber Protect\n\nRagnar Locker ransomware is detected and blocked by Acronis Cyber Protection products in multiple layers, for example by signatures as\nwell as by behavior detection.\n\n## Conclusion\n\nRagnar Locker employs advanced defense-evasion techniques to bypass antivirus protection. It uses a small Windows XP virtual machine\nimage to launch its payload and encrypt the files on a user’s drive connected as a network drive. It poses a significant risk to organizations\neven with anti-malware solutions installed.\n\n## IoCs\n\nMD5(packed): 6d122b4bfab5e75f3ae903805cbbc641\n\nSHA256(packed): 68eb2d2d7866775d6bf106a914281491d23769a9eda88fc078328150b8432bb3\n\nMD5: 6360b252b21fe015d667b093f6497e33\n\nSHA256: 1de475e958d7a49ebf4dc342f772781a97ae49c834d9d7235546737150c56a9c\n\nragnar_{computer_id}\n\n.keys\n\nRGNR_{computer_id}.txt\n\nhttp://mykgoj7uvqtgl367.onion/client/?6bECA2b2AFFfBC1Dff0aa0EaaAd468bec0903b5e4Ea58ecde3C264bC55c7389E\n\nhttp://p6o7m73ujalhgkiv.onion/?page_id=171\n\nhttp://rgleaktxuey67yrgspmhvtnrqtgogur35lwdrup4d3igtbm3pupc4lyd.onion/ http://rgleak7op734elep.onion/\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-06-04 - Analysis of Ragnar Locker Ransomware (Acronis).pdf"
    ],
    "report_names": [
        "2021-06-04 - Analysis of Ragnar Locker Ransomware (Acronis).pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535697,
    "ts_updated_at": 1743041166,
    "ts_creation_date": 1653765594,
    "ts_modification_date": 1653765594,
    "files": {
        "pdf": "https://archive.orkl.eu/a61b1c91d646adec21cc1ecfb49e1c7448b8e052.pdf",
        "text": "https://archive.orkl.eu/a61b1c91d646adec21cc1ecfb49e1c7448b8e052.txt",
        "img": "https://archive.orkl.eu/a61b1c91d646adec21cc1ecfb49e1c7448b8e052.jpg"
    }
}