{
    "id": "9a7092d8-fa06-4d7e-88a4-49a0c7a52e20",
    "created_at": "2023-01-12T15:02:24.466939Z",
    "updated_at": "2025-03-27T02:06:01.677081Z",
    "deleted_at": null,
    "sha1_hash": "d5cb05f773765917fbab224bec6bb2165c5587cb",
    "title": "2021-09-08 - Muhstik Takes Aim at Confluence CVE 2021-26084",
    "authors": "",
    "file_creation_date": "2022-05-28T05:01:17Z",
    "file_modification_date": "2022-05-28T05:01:17Z",
    "file_size": 1944427,
    "plain_text": "# Muhstik Takes Aim at Confluence CVE 2021-26084\n\n**[lacework.com/blog/muhstik-takes-aim-at-confluence-cve-2021-26084/](https://www.lacework.com/blog/muhstik-takes-aim-at-confluence-cve-2021-26084/)**\n\n**Key Takeaways**\n\n\nSeptember 8, 2021\n\n\nIn line with USCYBERCOM’s warning, publicly available Confluence exploit scripts are being\nintegrated into opportunistic attackers’ toolkits.\nMuhstik, a known threat actor targeting cloud and IoT, is one of these opportunistic attackers\ntargeting vulnerable Confluence servers to spread their botnet.\nLacework Labs observed bash droppers with zero detections on VirusTotal being used in\nconjunction with CVE 2021-26084.\n\n**Background**\n\n[Early on Sept. 3, 2021, the USCYBERCOM Twitter account alerted followers to urgently patch Atlassian](https://twitter.com/CNMF_CyberAlert/status/1433787671785185283)\n[Confluence CVE-2021-26084 before the labor-day holiday weekend, citing mass exploitation. Since that](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-26084)\nwarning, the Lacework Labs Team has observed a number of exploit attempts using the publicly\navailable exploit code. This blog details the malware, architecture, and infrastructure used in these\nattacks.\n\n**Execution Flow Analysis**\n\n[Publicly available exploit scripts reportedly emerged less than a week following the announcement of](https://www.exploit-db.com/exploits/50243)\nCVE-2021-26084 on Aug. 25, 2021. These scripts enable the attacker to gain shell access on the\nremote server. Simple modifications to this script enabled opportunistic attackers to take a “spray and\n\n\n-----\n\npray approach, attempting to spread their malware to several hosts as quickly as possible. Initial\nexecution was achieved via a specially crafted HTTP post request to a vulnerable instance of\nConfluence.\n\nOn Sept. 4, the following exploit traffic was observed in Lacework honeypots originating from IPs\n213.16.63.201 (ASN 8866 Viacom) & 62.38.35.226 (ASN 3329 Vodafone-panafon Hellenic\nTelecommunications Company SA). Lacework Labs first observed IP 213.16.63.201 on July 16, in Redis\nscanning activity against port 6379. IP 62.38.35.226, and also previously observed in mid-August\nperforming curl requests on port 80.\n\nFigure 1. Honeypot traffic\n\nAfter the initial execution of the CVE-2021-26084 payload, a wget or curl command was executed to\ndownload conf2 from 194.31.52.174. This file contained additional download commands for dk86, dk32,\nand ldm payloads, in addition to changing default iptables policies to be ACCEPT and flushing any\nexisting rules. This behavior can be observed in Figure – 1 below.\n\n\n-----\n\nFigure 2. conf Dropper\n\nThe dk86 and dk32 ELF binaries were packed with a custom UPX utility and have hardcoded string\nreferences to Anime. This aligns to a threat actor group Lacework Labs has previously reported on,\n[Muhstik. Muhstik leveraged well known vulnerabilities in web applications to expand their IoT botnet.](https://www.lacework.com/blog/meet-muhstik-iot-botnet-infecting-cloud-servers/)\nGiven previous behavior by this actor, it appears the latest Confluence vulnerability is another target on\ntheir list.\n\nFigure 3 – Anime String References in Muhstik\n\nThe ldm script hosted on a separate server than conf2 and dk86/dk32 was a more advanced dropper\nscript that performed the following tasks:\n\n[Established persistence via crontab (T1053.003)](https://attack.mitre.org/techniques/T1053/003/)\n[Established persistence via dropped ssh key (T1098.004)](https://attack.mitre.org/techniques/T1098/004/)\nAttempt lateral movement via existing ssh keys, users and host entries in ~/.ssh/known_hosts\n[(T1021.004)](https://attack.mitre.org/techniques/T1021/004/)\n[Downloaded additional dropper scripts for pty payloads. (T1059.004)](https://attack.mitre.org/techniques/T1059/004/)\nDownload additional payloads from .onion sites\n\n\n-----\n\nFigure 4 – Download Script: x3.sh\n\nFigure 5 – Multi Architecture\n\nThe entire execution workflow can be seen in Figure 6 below.\n\nFigure 6 – Confluence RCE Overview\n\n**Bot Analysis**\n\n\n-----\n\nThe pty binaries identified within this campaign are IRC bots that appear to be modified versions of\nTsunami/Katien. All of the identified binaries include modification of the UPX header to prevent easy\nunpacking via the upx utility. These binaries can be patched by replacing the custom header bytes (0a\n00 00 00) with the bytes for the valid UPX! header (55 50 58 21). A [script for patching these files is](https://github.com/lacework/lacework-labs/blob/master/muhstik/patch_Mushtik_UPX.py)\navailable in the Lacework Labs Github repository. After patching the upx utility can be used to unpack\nthese binaries.\n\nThe pty IRC bots are compiled for numerous architectures including ARM, MIPS, x86, and x64. All of\nthe pty IRC bots are statically compiled, while a subset are compiled with OpenSSL drastically\nincreasing the file size. The main functionality of the IRC bots includes DoS commands for various\nprotocols, as well as ssh brute forcing and raw sh command execution. This functionality can be seen in\nthe bot’s help menu listed below.\n\n\n-----\n\nFigure 7 – Bot’s help menu\n\nIn conjunction with the HTTP flooding and brute force attacks, multiple hard coded usernames,\npasswords, and user-agent strings are embedded within the binaries. The image below shows\nembedded User-Agent strings identified within the x86 pty IRC bot variant.\n\n\n-----\n\nFigure 8 – Embedded User-Agents\n\nEach pty sample contains a single byte XOR (key 0x22) encrypted configuration section, which contains\nthe domains/IPs the IRC bots connect to. All variants contained the same decoded configuration:\n\n\n-----\n\n```\n\"listening tun0\n\"165.22.217.181\n\"162.249.2.189\n\"185.62.137.56\n\"68.66.253.100\n\"46.149.233.35\n\"185.61.149.22\n\"45.132.242.233\n\"173.255.240.191\n\"31.131.24.229\n\"i.l33t-ppl.info\n\"i.de-zahlung.eu\n\"i.deutschland-zahlung.net\n\"i.shadow-mods.net\n\"i.deutschland-zahlung.eu\n\"/proc/\n\"/exe\n\"/status\n\"/fd\n\"\\x58\\x4D\\x4E\\x4E\\x43\\x50\\x46\\x22\n\"zollard\n\"muhstik-11052018\n\"eth1\n\"lan0\n\"eth0\n\"inet0\n\"lano\nMost of the IPs in the observed configuration have links to previously observed Muhstik domains,\nwhile others do not. The following tables show these hosts along with historic passive DNS\nresolutions.\n\n```\nIP ASN country Domains from passive DNS\n\n\n162.249.2.189 55293:”A2HOSTING” United\nStates\n\n\nead.fflyy.su\ngrand.fflyy.su\ndead.fflyy.su\npostmaster.fflyy.su\nkei.su\nw.deutschland-zahlung.eu\nfucks.fflyy.su\nwireless.kei.su\nirc.de-zahlung.eu\nfflyy.su\nbutt.fflyy.su\npaypal.com-nl-cgi-bin-webscr-cmd-verifysubmit.fflyy.su\nwired.kei.su\n\n\n-----\n\n165.22.217.181 14061:”DIGITALOCEANASN”\n\n\nIndia pokemoninc.com\nirc.deutschland-zahlung.net\nwww.ancianossupervisados.com\nserver1.pokemoninc.com\nxxx.pokemoninc.com\napi.mahasarkar.co.in\nnctbsolution.com\nirc.de-zahlung.eu\npex.pokemoninc.com\nproceso.pokemoninc.com\nnetexplanations.com\napp.mahasarkar.co.in\nm.mahasarkar.co.in\nwww.netexplanations.com\nancianossupervisados.com\ntelevisa.pokemoninc.com\njorgee3.pokemoninc.com\ndns5.nameservices.com.pokemoninc.com\nshit.pokemoninc.com\naid.pokemoninc.com\nanswergyaan.in\nftp.pokemoninc.com\nromero.pokemoninc.com\nmail.pokemoninc.com\nserver.mahasarkar.co.in\nbnet.pokemoninc.com\n\n\n173.255.240.191 63949:”Linode, LLC” United\nStates\n\n\nli250-191.members.linode.com\nirc.de-zahlung.eu\n\n\n185.61.149.22 43513:”Sia Nano IT” Latvia x.fd6fq54s6df541q23sdxfg.eu\nirc.de-zahlung.eu\nirc.deutschland-zahlung.net\n\n\n185.62.137.56 55293:”A2HOSTING” United\nStates\n\n\njaygame.net\nirc.de-zahlung.eu\n\n\n31.131.24.229 56851:”PE Skurykhin\nMukola Volodumurovuch”\n\n45.132.242.233 47583:”Hostinger\nInternational Limited”\n\n46.149.233.35 52175:”Magellan Telecom\nKuzbass Ltd.”\n\n\nUkraine vaua0055033.online-vm.com\n\nGermany amaismarket.com.br\nns1.amaismarket.com.br\nwebmail.clinicaajudaanimal.com.br\n_dcmx.d88c97daf3cd.comercionarede.com.br\nexposedbotnets.ru\nbcjservice.com.br\nmail.espartana.com.br\nftp.tudodearte.com.br\nclinicaajudaanimal.com.br\n\nRussia emsib.ru\nhost233-35.mgtelecom.ru\n\n\n68.66.253.100 55293:”A2HOSTING” United\nStates\n\n\nirc.de-zahlung.eu\nuranus.kei.su\n\n\n-----\n\nAlso, according to passive DNS, the domains in the configuration with the i subdomains have never\nbeen resolved to any hosts. However, some of these have additional subdomains worth noting.\n\nedsux.i.shadow-mods.net\nhacku.i.shadow-mods.net\nirc.i.shadow-mods.net\nxmr.i.shadow-mods.net\ngoahead.i.deutschland-zahlung.eu\ntomato.i.deutschland-zahlung.eu\nirc7.i.shadow-mods.net\ndasan.i.deutschland-zahlung.eu\nl33t.i.shadow-mods.net\n\n**Recommended Actions**\n\nWhile origins of the vulnerability have not been officially confirmed, Confluence did release a security\nadvisory detailing the specifics. The advisory notes Confluence Server and Data Center versions before\nversion 6.13.23, from version 6.14.0 before 7.4.11, from version 7.5.0 before 7.11.6, and from version\n7.12.0 before 7.12.5 are affected by this vulnerability. Confluence Cloud versions of the products are not\nvulnerable. The vulnerability ultimately allows an unauthenticated user to execute arbitrary code on a\nConfluence Server or Data Center instance, providing a prime opportunity for opportunistic and targeted\nattackers as an entry point into target networks. Some additional background also may be found in an\n[outside vulnerability research blog describing the original bug reporting effort.](https://tradahacking.vn/atlassian-confluence-cve-2021-26084-the-other-side-of-bug-bounty-45ed19c814f6)\n\nSome recommended actions:\n\nFollow the [official Confluence advisory for the most current technical recommendations, including](https://confluence.atlassian.com/doc/confluence-security-advisory-2021-08-25-1077906215.html)\npatching and configuration updates.\nIf your organization was vulnerable over the weekend, perform an incident response effort to\nevaluate any potential compromise with the help of this blog and IOCs below.\n\n**Indicators**\n\nIOCs Context\n\n213.16.63.201 Exploit source\n\n62.38.35.226 Exploit source\n\nbvprzqhoz72jltin.onion C2\n\nbvprzqhoz72jltin.tor2web.su C2\n\nbvprzqhoz72jltin.onion.ly C2\n\nbvprzqhoz72jltin.onion.ws C2\n\n194.31.52.174 Conf2 dropper Hosting\nSite\n\n18.235.127.50 Ldm Malware staging\n\n\n-----\n\n32.221.40.237 Hosting pty payloads\n\na91dffe65048e39dfe1fd8da0b0dac11807718cdd5efedf4206a18af78779b0a File: conf2\n\nb3a6fe5bc3883fd26c682bb6271a700b8a6fe006ad8df6c09cc87530fcd3a778 34.221.40.237/.x/pty8\n\n2a4e636c4077b493868ea696db3be864126d1066cdc95131f522a4c9f5fb3fec 34.221.40.237/.x/pty9\n\nc38f0f809a1d8c50aafc2f13185df1441345f83f6eb4ef9c48270b9bd90c6799 34.221.40.237/.x/pty4\n\n6370939d4ff51b934b7a2674ee7307ed06111ab3b896a8847d16107558f58e5b 34.221.40.237/.x/pty10\n\na3f72a73e146834b43dab8833e0a9cfee6d08843a4c23fdf425295e53517afce 34.221.40.237/.x/pty3\n\nb55ddbaee7abf1c73570d6543dd108df0580b08f730de299579570c23b3078c0 34.221.40.237/.x/1sh\n\n6a8965a0f897539cc06fefe65d1a4c5fa450d002d1a9d5d69d2b48f697ee5c05 34.221.40.237/.x/pty6\n\ne20806791aeae93ec120e728f892a8850f624ce2052205ddb3f104bbbfae7f80 34.221.40.237/.x/pty1\n\n63d43e5b292b806e857470e53412310ad7103432ba3390ecd4f74e432530a8a9 34.221.40.237/.x/pty11\n\n715f1f821d028e165bfa750d73505f1a6136184999411300cc88c18ebfa6e8f7 34.221.40.237/.x/pty2\n\nc154d739cab62e958944bb4ac5ebad6e965a0442a3f1c1d99d56137e3efa8e40 34.221.40.237/.x/pty7\n\n19370ef36f43904a57a667839727c09c50d5e94df43b9cfb3183ba766c4eae3d 34.221.40.237/.x/pty5\n\n5c46098887e488d91f42c6d9b93b17b2736c9f4cb5a4a1e476c87c0d310a3f28 34.221.40.237/.x/3sh\n\n0e574fd30e806fe4298b3cbccb8d1089454f42f52892f87554325cb352646049 194.31.52.174/dk86\n\nfe98548300025a46de1e06b94252af601a215b985dad31353596af3c1813efb0 194.31.52.174/dk32\n\n39db1c54c3cc6ae73a09dd0a9e727873c84217e8f3f00e357785fba710f98129 18.235.127.50/ldm\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-09-08 - Muhstik Takes Aim at Confluence CVE 2021-26084.pdf"
    ],
    "report_names": [
        "2021-09-08 - Muhstik Takes Aim at Confluence CVE 2021-26084.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535744,
    "ts_updated_at": 1743041161,
    "ts_creation_date": 1653714077,
    "ts_modification_date": 1653714077,
    "files": {
        "pdf": "https://archive.orkl.eu/d5cb05f773765917fbab224bec6bb2165c5587cb.pdf",
        "text": "https://archive.orkl.eu/d5cb05f773765917fbab224bec6bb2165c5587cb.txt",
        "img": "https://archive.orkl.eu/d5cb05f773765917fbab224bec6bb2165c5587cb.jpg"
    }
}