{
    "id": "36b84098-953b-4cb7-a15a-8af6333c34ab",
    "created_at": "2023-01-12T15:09:58.58611Z",
    "updated_at": "2025-03-27T02:15:38.105573Z",
    "deleted_at": null,
    "sha1_hash": "00e26fabc4c29b2f6523c95d37ab421eb7b98091",
    "title": "2020-07-09 - ServHelper- Hidden Miners",
    "authors": "",
    "file_creation_date": "2022-05-28T04:51:47Z",
    "file_modification_date": "2022-05-28T04:51:47Z",
    "file_size": 704375,
    "plain_text": "# ServHelper: Hidden Miners\n\n**gdatasoftware.com/blog/2020/07/36122-hidden-miners**\n\nIt is always a good idea to have multiple options when it comes to making a profit. This is\nespecially true for criminals. Having a backdoor is nice, but having the backdoored system\ndirectly make money is even better.\n\nBackdoor malware is a crucial component of most persistent attacks for its capability to carry\nout further damage to an infiltrated system. As it enables the threat actors to have access to\nan infected system, it gives them possibilities for lateral movements throughout the network,\ndeployment of other malicious components, and even direct communication and connection\nwith them.\n\nFirst seen during Q3 of 2018, a backdoor named ServHelper that is associated with the\nhacking group TA505 has been seen targeting financial and retail sectors. With the help of\nthis backdoor, it enabled them to install and deploy other malware like Information Stealers\n(Predator Stealer), and Remote Access Trojans (RAT) (FlawedAmmy, NetSupport). And in\nJanuary 2020, we have encountered a new variant that is readily capable of installing a\nCryptoMiner bundled with it. This Miner is hidden inside the infected system through a\nspawned virtualized environment.\n\n## Arrival and Loader Function\n\n\n-----\n\nInstallation Overview of ServHelper\n\nThis variant is compiled and delivered as an NSIS installer (Nullsoft Scriptable Install\nSystem) that usually arrives to its target as an attachment on an email luring the victim to\nopen it. This attachment serves as a loader for the installers that will be dropped and loaded.\n\nUpon execution, the loader will check if it is running on a virtualized environment. This\nevasion and anti-analysis technique enable it to detect if it is running on sandboxes or\nanalysis tool that usually runs on a virtualized environment. It does this by checking for the\npresence of a file, C:\\aaa_TouchMeNot_.txt, which is a legitimate test file of Windows\nDefender that is present if it is installed on a virtualized environment.\n\nIf the file is present, installation will stop.\n\nVirtual Environment Detection through Window Defender\n\nTest File\n\nString Preparation for PowerShell script file to be\n\nexecuted\nAs it proceeds, it will execute a PowerShell script file named upgrade.ps1 contained on the\nNSIS installer’s temporary directory ($temp).\n\nThe executed PowerShell script will decrypt and invoke the main Installer of ServHelper. The\nPowerShell command was encrypted with a combination of Base64 encoding and Triple DES\nAlgorithm. This provides an added security from viewing the shell commands in plain text\nand contributes to the difficulty in manually decrypting the shell. The technique has also been\nseen used by other Powershell exploits such as PowerSploit.\n\nAfter decrypting, it will use IEX (Invoke Expression) that will enable it to evaluate and\nexecute the command. This command calls the main installer for ServHelper and its bundled\nCryptoMiner.\n\n## ServHelper Installer\n\n\n-----\n\nFirst Layer PowerShell Decryption Algorithm (Click\n\nto enlarge).\nAfter the initial checks done by the loader, it will conduct another set of verification that will\nensure that the target system can cater its full installation. It does this with the following\nchecks:\n\n1. Check if the running instance has Administrator privilege.\n\n1. It does this by checking the WindowsIdentity Class and look for the SID “S-1-5\n32-544”, an ID that indicates that the user is an has Administrator privileges.\n2. If the running instance of PowerShell is not in Administrator level, the installer will\n\ntry to escalate privilege by using DLL hijacking with the use of Fubuki from\nUACME project.\n\nUACME is a collection of tools designed to bypass Window’s User Access Control (UAC)\nand grant the user with local administrator privileges. It is readily available via GitHub and is\ncommonly used by Penetration Testers for research purposes. The escalation of privilege\nenables deployment and installation of its other components.\n\nThe hijack was done through Fubuki together with the vulnerable Windows components\n“Sysprep.exe” and “Wusa.exe”. This vulnerability was first discovered in 2017 on Windows 7\nBuild 7600 and has already been fixed on Windows 10 TH1 Build 10147. Beyond the fixed\nversion, the installation will only proceed if the user has an Administrator privilege.\n\n1. Check if the Read-Only Memory (ROM) size is more than 2MB (Megabytes) in\n\nSMBIOS (System Management BIOS).\n\n1. As there is no ROM in a virtual environment when SMBIOS is checked, this could\n\nbe another anti-virtualization technique.\n\nPrivilege checking using WindowsIdentity (Click to\n\nenlarge)\n\nAnti-VM evasion technique on checking ROM size\n\non SMBIOS (Click to enlarge)\nIf all the checking is satisfied, it will now proceed to install ServHelper and its components.\n\nDuring installation, it will prepare its installation directory, C:\\Program Files\\windows mail\\, by\nadding it on the target scan exclusion of Windows Defender using Add-MpPreference _ExclusionPath. This enables it to evade the scans of Windows Defender._\n\nAfterwards, it will prepare the payload to be dropped by decrypting it using Base64 decoding\nand GZip decompression and saves them to each of its designated directories.\n\n\n-----\n\nInstallation Directories for ServHelper Components\n\nVariables Holding Encrypted binaries of\n\nServHelper and Remote Desktop Components. (Click to enlarge)\nOnce the components are all decrypted and dropped, it will add the installed RDP Wrapper\nLibrary (Remote Desktop Protocol) “appcache.xml” as TermService’s Service DLL as its main\ntarget to be executed. The modified RDP Wrapper Library will then load the ServHelper DLL.\nTermService (Terminal Services) is natively present and related to RDP. It allows multiple\nuses to be connected to a machine as well as the display of desktops and applications to\nremote computers. This modification done by ServHelper will make sure it runs every time\nthe service is started.\n\nIt can also be noticed that this specific variant only targets 64-bit Windows Operating\nSystems, as its variables that it is intended for the 32-bit version of ServHelper and RDP\nwrapper library were empty or insufficient. Variables $rdp and $bot are intended for the 32-Bit\nVersion.\n\nThis completes the installation of ServHelper’s Backdoor Component. Once this installation\nis complete, it enables the threat actors to have backdoor access to the infected system,\ncapable of sending commands and receiving information.\n\n## The Hidden Miner: LoudMiner\n\nServHelper’s Code and the Appended\n\nScript for LoudMiner (click to enlarge)\nPrevious version of ServHelper installers will end once the service of the backdoor is\ninstalled and deployed. But in this variant, we have noticed that its installer was modified to\ndeploy an additional attack, a CryptoMiner dubbed as LoudMiner.\n\nThis CryptoMiner is named “Loud” due to its intensive use of an infected machine’s\nresources. It uses virtualization tool such as VirtualBox where it does the CryptoMining.\nAlthough this technique requires a lot of resource, it is a stealthy approach and does evade a\nlot of AV detection since it runs on a virtualized layer.\n\n\n-----\n\nInitial download form LoudMiner Installer\n\n(Click to enlarge)\nAs installation for the CryptoMiner commence, it will first check if the victim’s system can\ncater a spawned virtualized environment. If it is capable and is allowed, it will proceed by\ndownloading VirtualBox from its official source (hxxp://download.virtualbox.org/virtualbox)\nand download its other components from hxxp://almagel[.]icu/mon[.]zip which is known to\nhost other components related to ServHelper’s previous versions.\n\nLooking inside the downloaded “mon.zip”, we can find the following files:\n```\nNewVirtualDisk1.vdi (Virtual Desktop Infrastructure for the malicious Virtual\nimages)\nnssm.exe (Non-Sucking Service Manager)\ntb.vbox / tbs.vbox (Virtual Image of TinyCore Linux with CryptoMiner)\n\n```\nThere are two VirtualBox Virtual Images available for it to use. If the available physical\nmemory of the infected system is less than 5 GB, it will use tb.vbox virtual image. And if it\nhas more than 5 GB of available physical memory, the virtual image tbs.vbox will be used\ninstead.\n\nChoosing from which image to use depending on victim’s available memory (Click to enlarge)\n\nCreating and Running service using NSSM\n\nLoaded tb.vbox – TinyCore Linux Image\n\n10.1\nIt will then use “nssm.exe” (Non-Sucking Service Manager) to install and run VirtualBox as a\nservice. Non-Sucking Service Manager is a free utility tool that helps manage both\nbackground and foreground services. This provides it with a legitimate way of creating an\ninstance of VirtualBox, providing another layer of stealth.\n\n\n-----\n\nUpon loading the Virtual Box Image (In our test environment during analysis, the tb.vbox), it\nis configured to automatically connect to its server and run the CryptoMiner. This was done\nby modifying the bootlocal.sh.\nTaking a closer look at the “bootlocal.sh”, we can see that it uses XMrig Miner as its\nCryptoMiner. XMRig is an open-source CPU-based CryptoMiner that was released in May\n2017 mainly for mining Monero CryptoCurrency. It is a suitable CryptoMiner to exploit\nbecause it is open-source and it utilizes CPU which should be readily available to all\npotential targets. This completes the installation of the CryptoMining component that enables\nthe infected machine to mine for CryptoCurrency while hiding inside a virtualized\nenvironment improving its chances of evasion and stealth.\n\nAn Infected System with LoudMiner Inside a VirtualBox\n\n## Conclusion\n\nThe ready combination of a backdoor capability and a CryptoMining component in a malware\nenables the threat actors to deliver both an active and a passive means of exploitation. It\nenables them to gain immediate passive benefit for each successful infection through\nCryptoMining, while still having the flexibility and foothold on an active control through the\nbackdoor they have installed.\n\nWhether you are using technology from your home, from your business, or from the\norganization that you are a part of, threats are real and are actively adding additional\nfeatures on their arsenal. That is why it is important to always practice safe and secure use\nof technology because prevention will always be our first line of defense.\n\nThreats escalating its privileges on infected machines is a crucial component in a\ncyberattack. And enforcing security concepts and policies from frameworks such as AAA\n(Authenticate, Authorize, Accounting) can help in ensuring that the highest possible UAC is\nenforced, thus helping to mitigate the risks.\n\n\n-----\n\nAnd on top of that, it is also vital to make sure that we use a reliable security solution that\ncovers multiple layers of protection from e-mail protection, network security, and up to an\nendpoint solution that is capable of cleverly protecting us from these kinds of threats.\n\n## IOC list\n\n### Binaries\n\nSHA256  File  Detection\n\nC0F5375DD4530C7554212E7C8D85EBE41370BE49E1AA40D381F2E34CBF319134\n(NSIS Loader; detection: Gen:Variant.Strictor.239587\n\nA7ECF925427FA07C40FF335E57EE04DCB028A97B4C5A8429CC7ED101CB30B1D0\n(upgrade.ps1; detection: PowerShell.Trojan.Agent.AQX)\n\n26E2794167F5A4F5A1C7E708823B77FD6500290DF4DA225181D55F030B0043EB\n(default_list.xml/ServHelper; detection: Gen:Variant.Ursu.750288)\n\n85A8867844CC43840DB2ADB62153722A994EFEECC0F066A3E0211CAD69D1AA77\n(appcache.xml; detection: Gen:Variant.Ursu.750421)\n\n### URLs\n\nhxxp://rotoscoping[.]xyz[:]3389\n\nhxxp://losos[.]cn[:]7201\n\nhxxp://romashka[.]cn/guga[.]txt\n\nhxxp://safuuf7774[.]pw/iplog/vmt[.]php?hst=vmt_installed_$env:computername\n\nhxxp://almagel.icu/cp.exe\n\nhxxp://almagel.icu/ssh.zip\n\nhxxp://asggh554tgahhr.pw\n\nhxxp://nsggh554tgahhr.pw\n\nhxxp://sggh554tgahhr.pw\n\nhxxp://dfsgu747hugr.pw\n\nhxxp://esggh554tgahhr.pw\n\nhxxp://hsggh554tgahhr.pw\n\nhxxp://kuarela.xyz/1.txt\n\nhxxps://sgahugu4ijgji.xyz/list/b.php\n\nhxxp://asggh554tgahhr.pw/list/b.php\n\nhxxp://gabardina.xyz/log.txt\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-07-09 - ServHelper- Hidden Miners.pdf"
    ],
    "report_names": [
        "2020-07-09 - ServHelper- Hidden Miners.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "99cb4e5b-8071-4f9e-aa1d-45bfbb6197e3",
            "created_at": "2023-01-06T13:46:38.860754Z",
            "updated_at": "2025-03-27T02:00:02.937438Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "SectorJ04 Group",
                "Dudear",
                "G0092",
                "ATK103",
                "Hive0065",
                "Spandex Tempest",
                "GRACEFUL SPIDER",
                "GOLD TAHOE",
                "CHIMBORAZO",
                "SectorJ04"
            ],
            "source_name": "MISPGALAXY:TA505",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "5e6b31a6-80e3-4e7d-8b0a-d94897ce9b59",
            "created_at": "2024-06-19T02:03:08.128175Z",
            "updated_at": "2025-03-27T02:05:17.400394Z",
            "deleted_at": null,
            "main_name": "GOLD TAHOE",
            "aliases": [
                "SectorJ04 ",
                "Spandex Tempest ",
                "TA505 ",
                "FIN11 "
            ],
            "source_name": "Secureworks:GOLD TAHOE",
            "tools": [
                " Cobalt Strike",
                " FlawedAmmy",
                " Get2",
                " GraceWire",
                " Malichus",
                " SDBbot",
                " ServHelper",
                " TrueBot",
                "Clop"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "75d4d6a9-b5d1-4087-a7a0-e4a9587c45f4",
            "created_at": "2022-10-25T15:50:23.5188Z",
            "updated_at": "2025-03-27T02:00:55.489882Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "TA505",
                "Hive0065",
                "Spandex Tempest",
                "CHIMBORAZO"
            ],
            "source_name": "MITRE:TA505",
            "tools": [
                "AdFind",
                "Azorult",
                "FlawedAmmyy",
                "Mimikatz",
                "Dridex",
                "TrickBot",
                "Get2",
                "FlawedGrace",
                "Cobalt Strike",
                "ServHelper",
                "Amadey",
                "SDBbot",
                "PowerSploit"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "e447d393-c259-46e2-9932-19be2ba67149",
            "created_at": "2022-10-25T16:07:24.28282Z",
            "updated_at": "2025-03-27T02:02:10.159466Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "ATK 103",
                "Chimborazo",
                "Gold Evergreen",
                "Gold Tahoe",
                "Graceful Spider",
                "Hive0065",
                "Operation Tovar",
                "Operation Trident Breach",
                "SectorJ04",
                "Spandex Tempest",
                "TA505",
                "TEMP.Warlock"
            ],
            "source_name": "ETDA:TA505",
            "tools": [
                "Amadey",
                "AmmyyRAT",
                "AndroMut",
                "Azer",
                "Bart",
                "Bugat v5",
                "CryptFile2",
                "CryptoLocker",
                "CryptoMix",
                "CryptoShield",
                "Dridex",
                "Dudear",
                "EmailStealer",
                "FRIENDSPEAK",
                "Fake Globe",
                "Fareit",
                "FlawedAmmyy",
                "FlawedGrace",
                "FlowerPippi",
                "GOZ",
                "GameOver Zeus",
                "GazGolder",
                "Gelup",
                "Get2",
                "GetandGo",
                "GlobeImposter",
                "Gorhax",
                "GraceWire",
                "Gussdoor",
                "Jaff",
                "Kasidet",
                "Kegotip",
                "Kneber",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Locky",
                "MINEBRIDGE",
                "MINEBRIDGE RAT",
                "MirrorBlast",
                "Neutrino Bot",
                "Neutrino Exploit Kit",
                "P2P Zeus",
                "Peer-to-Peer Zeus",
                "Philadelphia",
                "Philadephia Ransom",
                "Pony Loader",
                "Rakhni",
                "ReflectiveGnome",
                "Remote Manipulator System",
                "RockLoader",
                "RuRAT",
                "SDBbot",
                "ServHelper",
                "Shifu",
                "Siplog",
                "TeslaGun",
                "TiniMet",
                "TinyMet",
                "Trojan.Zbot",
                "Wsnpoem",
                "Zbot",
                "Zeta",
                "ZeuS",
                "Zeus"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536198,
    "ts_updated_at": 1743041738,
    "ts_creation_date": 1653713507,
    "ts_modification_date": 1653713507,
    "files": {
        "pdf": "https://archive.orkl.eu/00e26fabc4c29b2f6523c95d37ab421eb7b98091.pdf",
        "text": "https://archive.orkl.eu/00e26fabc4c29b2f6523c95d37ab421eb7b98091.txt",
        "img": "https://archive.orkl.eu/00e26fabc4c29b2f6523c95d37ab421eb7b98091.jpg"
    }
}