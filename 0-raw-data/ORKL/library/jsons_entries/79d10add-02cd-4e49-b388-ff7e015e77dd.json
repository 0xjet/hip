{
    "id": "79d10add-02cd-4e49-b388-ff7e015e77dd",
    "created_at": "2023-06-05T02:07:59.744467Z",
    "updated_at": "2025-03-27T02:09:29.250054Z",
    "deleted_at": null,
    "sha1_hash": "15a625b76874addaaa11b515a4abb79d1ec610a6",
    "title": "2022-12-16 - SCL -1- The Dangerous Side Of Safe Senders",
    "authors": "",
    "file_creation_date": "2023-06-04T12:23:57Z",
    "file_modification_date": "2023-06-04T12:23:57Z",
    "file_size": 430580,
    "plain_text": "# SCL -1: The Dangerous Side of Safe Senders\n\n**[aon.com/cyber-solutions/aon_cyber_labs/scl-1-the-dangerous-side-of-safe-senders/](https://www.aon.com/cyber-solutions/aon_cyber_labs/scl-1-the-dangerous-side-of-safe-senders/)**\n\nStroz Friedberg is regularly called upon by clients to perform Business Email Compromise\n(BEC) investigations when their Microsoft 365 (“M365”) tenants are compromised by threat®\nactors. In the past few months, Stroz Friedberg has observed threat actors leveraging Safe\nSenders, a feature built into Outlook, to bypass spam filters and successfully deliver®\nspoofed messages to a targeted user’s mailbox. These spoofed messages are altered to\nappear as if they originated from a specific email address, when the message was not\nactually sent from that address.\n\n\nThis article explores how the Safe Senders feature may be used legitimately, how it can be\nmisused to create more advanced phishing emails, and how cybersecurity professionals can\nhelp to identify its illegitimate use. With the use of real-life scenarios and suggestions for\ntargeted analysis, this article seeks to introduce cybersecurity professionals to this new\ntechnique and provide guidance on how to better recognize it in future incidents.\n\n## Safe Senders Lists\n\nOutlook Safe Senders is a feature that allows a user to add specific senders or domains to a\nlist of senders whose emails “are never treated as junk email, regardless of the content of\nthe message“. In other words, Safe Senders allows messages coming from specific\naddresses or domains to skip spam filtering and land directly into a user’s inbox. You may be\nfamiliar with this after having seen certain companies recommend that you add their address\nto your Safe Senders list. This has been seen as a more common practice among email\nmarketers. When used legitimately, Safe Senders does allow a company to reach their\ncustomers more effectively. However, it can have significant security consequences when\nused illegitimately.\n\nThe ability to let messages bypass spam filtering can expose users to sophisticated phishing\nattacks that would otherwise have landed in their Junk folder. This does not mean that all\n[messages from Safe Senders skip spam filtering; Microsoft documentation states that using](https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/create-safe-sender-lists-in-office-365?view=o365-worldwide)\nSafe Senders “creates a high risk of attackers successfully delivering email to the Inbox that\nwould otherwise be filtered; however, if a message from an entry in the user’s Safe Senders\nor Safe Domains lists is determined to be malware or high confidence phishing, the message\nwill be filtered”. While high-confidence spam will still be filtered even if coming from a Safe\nSender, a threat actor can easily adjust their strategy to ensure that their message does not\nget filtered as high-confidence spam. This has a couple notable implications for the security\nof M365.\n\n\n-----\n\nFirst, it makes BEC more effective. It can allow a threat actor to deliver a spoofed message\nthat appears to be from a trusted partner to a victim’s mailbox.\n\nSecond, any changes made to a victim environment can be leveraged at a later point in time\nby the threat actor if not detected and remediated by the organization. Companies should\naudit Safe Senders lists and the similar functions described below, not only as a part of their\nincident response process, but also as a part of regular audits of their M365 tenant outside\nthe context of an incident. Otherwise, a threat actor that is evicted can regain their access\nusing these methods to send additional spoofed emails that bypass standard spam filtering.\n\n[Other methods of bypassing spam filters are listed in Microsoft documentation. These](https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/create-safe-sender-lists-in-office-365)\nmethods include adding entries to the tenant Allow/Block list, creating tenant-wide transport\nrules, adding IP addresses to the IP Allow List, and adding entries to the allowed\nsender/domain lists. These methods differ from adding to a user’s Safe Senders list because\nthey require administrative permissions within the tenant, while Safe Senders lists are userspecific and only require access to a user’s mailbox.\n\n## Standard BEC Attack Pattern\n\nStandard BEC incidents typically follow a similar pattern:\n\n\n-----\n\nThe use of Safe Senders allows threat actors to change this approach. The following\nscenario explains how this new technique may look to a cybersecurity professional\ninvestigating the incident and how it can change the attack pattern for threat actors\nperforming Business Email Compromise.\n\n## Safe Senders BEC Attack Pattern\n\nImagine you oversee the information security department at your company. You have been\nasked to lead an investigation into a fraudulent wire transfer initiated by someone in the\naccounting department. Everyone at your company has gone through multiple cybersecurity\nawareness trainings, so this comes as a surprise.\n\nYou start analyzing your company’s M365 tenant and the mailbox of the user who initiated\nthe wire transfer. You find that the message relaying fraudulent wire transfer information had\nfailed standard authorization checks but was still successfully delivered to the user’s mailbox.\nBy all accounts, your spam filter should have caught this message. So how did the message\nreach the targeted user?\n\nIn this scenario, the threat actor used Safe Senders to functionally “allowlist” their spoofed\nsender address. The attack pattern of a Business Email Compromise leveraging Outlook\nSafe Senders looks like this:\n\n\n-----\n\nFrom a threat actor s perspective, the difference in attack pattern is obvious. However, a\ncybersecurity professional may need to perform deeper analysis to identify when a threat\nactor has leveraged Safe Senders to bolster their phishing attacks. The following sections\ndescribe sources of information that an examiner should use to determine the use of Safe\nSenders in their next BEC investigation.\n\n## Email Header Analysis\n\nWhen performing email header analysis on suspicious messages, analyze the following\nheaders:\n\nFailed or unknown authentication checks on messages in the user’s inbox such\nas:\n\n_dmarc=none or dmarc=fail_\n_spf=none or spf=fail_\n_dkim=none or dkim=fail_\n_compauth=fail_\nMismatched domains between smtp.mailfrom and header.from\nMismatched X-Sender and Reply-To addresses\n[X-MS-Exchange-Organization-SCL: -1](https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/spam-confidence-levels?view=o365-worldwide)\n\nA Spam Confidence Level (SCL) of -1 indicates that the message bypassed\nspam filtering\nX-Forefront-Antispam-Report: containing the values “SFV:SFE” “SFV:SKA”\n“SFV:SKI” or “SFV:SKN”\n\n[Documentation of these headers can be found here.](https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/anti-spam-message-headers?view=o365-worldwide)\n\nNote that these header values may be present in legitimate emails, but given situational\ncontext they can also be an indication to investigate further.\n\n## Unified Audit Log Analysis\n\nTo help identify the addition of items to the Safe Senders list when analyzing the Unified\nAudit Log, look for Set-MailboxJunkEmailConfiguration events. Stroz Friedberg’s testing has\nidentified slight differences in how these events appear in the logs based on whether the\nSafe Senders list was modified using PowerShell or Outlook on the Web (OWA). When\nadded via PowerShell, the logs showed only the new address. Additions to the Safe Senders\nlist via OWA, however, contained the entire Safe Senders list with the new address at the\nbeginning of the list.\n\n\n-----\n\n_UAL-logged event of Safe Sender addition via PowerShell_\n\n\n-----\n\n_UAL-_\n\n_logged event of Safe Sender addition via OWA_\n\n## Auditing the current state of a tenant\n\nTo audit the current state of your M365 environment using PowerShell, use the following\ncommands:\n\nTo view the Safe Senders and Domains for a given user, you can use the following Exchange\nOnline PowerShell command:\n```\n(Get-MailboxJunkEmailConfiguration [UserID]).TrustedSendersAndDomains\n\n```\n\n-----\n\nTo view the tenant Allow/Block list, you can use the following Exchange Online PowerShell\ncommand:\n```\nGet-TenantAllowBlockListItems\n\n```\nTo view the organization-wide IP Allow list, you can use the following Exchange Online\nPowerShell command:\n```\n(Get-HostedConnectionFilterPolicy).IPAllowList\n\n```\nTo view the allowed sender/domain list along with other organization-wide anti-spam policies,\nyou can use the following Exchange Online PowerShell commands:\n```\n(Get-HostedContentFilterPolicy Default).AllowedSender\n(Get-HostedContentFilterPolicy Default).AllowedSenderDomains\n\n## Spoofed Messages from the User Perspective\n\n```\nStroz Friedberg tested the following three versions of Outlook to observe how they render\nspoofed messages received from Safe Senders:\n\n1. OWA\n2. Outlook 2016\n3. Outlook 2021\n\nIn OWA and Outlook 2021, Microsoft alerts the user when a message is coming from a\nspoofed sender address. The screenshots below show the alerts rendered in OWA and\nOutlook 2021:\n\n_Spoofed message viewed in OWA_\n\n\n-----\n\n_Spoofed message viewed in Outlook 2021_\nHowever, when rendering this same message in Outlook 2016, Microsoft does not alert the\nuser about the spoofed sender address 1:\n\n_Spoofed message viewed in Outlook 2016_\nThose using an old version of Outlook will have a much harder time identifying spoofed\nmessages. Organizations should both encourage and ensure that updates to relevant\nsoftware are done in order to take advantage of the most recent security features.\n\nOrganizations should also establish process controls requiring out-of-band confirmation of\nchanges to payment information. It is possible that using a third-party spam filter in addition\nto Microsoft’s built-in functionality may prevent messages from an address on the Safe\nSenders list from reaching a user’s mailbox 2.\n\nThreat actors are constantly coming up with new ways to abuse existing features on trusted\nplatforms to bolster their attacks — staying aware of these patterns will help you identify and\nstop them as soon as possible.\n\n_Authors: John Ailes, Julia Paluch_\n\nDecember 16, 2022\n\n©Aon plc 2022\n\n\n-----\n\nThis material has been prepared for informational purposes only and should not be relied on for any other purpose. You\nshould consult with your own professional advisors or IT specialists before implementing any recommendation or\nfollowing the guidance provided herein. Further, the information provided and the statements expressed are not intended\nto address the circumstances of any particular individual or entity. Although we endeavor to provide accurate and timely\ninformation and use sources that we consider reliable, there can be no guarantee that such information is accurate as of\nthe date it is received or that it will continue to be accurate in the future. The examples provided in this article are not\nbased upon an actual Stroz/Aon client, but was provided for illustrative purposes only.\n\n**About Cyber Solutions**\n\nCyber security services are offered by Stroz Friedberg Inc., its subsidiaries and affiliates. Stroz Friedberg is part of Aon’s\nCyber Solutions which offers holistic cyber risk management, unsurpassed investigative skills, and proprietary\ntechnologies to help clients uncover and quantify cyber risks, protect critical assets, and recover from cyber incidents.\n\n1 Stroz Friedberg did not perform testing on how to prevent Outlook from displaying these alerts.\n\n2 Stroz Friedberg did not perform testing on third-party spam filters. If a threat actor has sufficient privileges within M365,\nthere may be other methods they could use to bypass third-party spam filtering solutions.\n\nCyber security services offered by Stroz Friedberg Inc. and its affiliates. Insurance products\nand services offered by Aon Risk Insurance Services West, Inc., Aon Risk Services Central,\nInc., Aon Risk Services Northeast, Inc., Aon Risk Services Southwest, Inc., and Aon Risk\nServices, Inc. of Florida and their licensed affiliates. Aon UK Limited is authorised and\nregulated by the Financial Conduct Authority in respect of insurance distribution services.\nFP.AGRC.238.JJ The following products or services are not regulated by the Financial\nConduct Authority:\n\n- Cyber risk services provided by Aon UK Limited and its affiliates\n\n- Cyber security services provided by Stroz Friedberg Limited and its affiliates.\n\nCopyright 2021 Aon plc. All Rights Reserved.\nCyber security services offered by Stroz Friedberg Inc. and its affiliates. Insurance products\nand services offered by Aon Risk Insurance Services West, Inc., Aon Risk Services Central,\nInc., Aon Risk Services Northeast, Inc., Aon Risk Services Southwest, Inc., and Aon Risk\nServices, Inc. of Florida and their licensed affiliates. Aon UK Limited is authorised and\nregulated by the Financial Conduct Authority in respect of insurance distribution services.\nFP.AGRC.238.JJ The following products or services are not regulated by the Financial\nConduct Authority:\n\n- Cyber risk services provided by Aon UK Limited and its affiliates\n\n- Cyber security services provided by Stroz Friedberg Limited and its affiliates.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-12-16 - SCL -1- The Dangerous Side Of Safe Senders.pdf"
    ],
    "report_names": [
        "2022-12-16 - SCL -1- The Dangerous Side Of Safe Senders.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1685930879,
    "ts_updated_at": 1743041369,
    "ts_creation_date": 1685881437,
    "ts_modification_date": 1685881437,
    "files": {
        "pdf": "https://archive.orkl.eu/15a625b76874addaaa11b515a4abb79d1ec610a6.pdf",
        "text": "https://archive.orkl.eu/15a625b76874addaaa11b515a4abb79d1ec610a6.txt",
        "img": "https://archive.orkl.eu/15a625b76874addaaa11b515a4abb79d1ec610a6.jpg"
    }
}