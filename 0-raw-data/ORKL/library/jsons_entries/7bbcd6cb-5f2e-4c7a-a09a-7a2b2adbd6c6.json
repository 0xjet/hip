{
    "id": "7bbcd6cb-5f2e-4c7a-a09a-7a2b2adbd6c6",
    "created_at": "2023-01-12T15:08:30.343371Z",
    "updated_at": "2025-03-27T02:08:04.809212Z",
    "deleted_at": null,
    "sha1_hash": "fec9058186378298db4de86f210a21e7af068fed",
    "title": "2020-05-07 - Introducing Blue Mockingbird",
    "authors": "",
    "file_creation_date": "2022-05-28T05:06:19Z",
    "file_modification_date": "2022-05-28T05:06:19Z",
    "file_size": 193544,
    "plain_text": "# See what it's like to have a partner in the fight.\n\n**redcanary.com/blog/blue-mockingbird-cryptominer/**\n\n**Blue Mockingbird is the name we’ve given to a cluster of similar activity we’ve observed involving Monero cryptocurrency-mining**\npayloads in dynamic-link library (DLL) form on Windows systems. They achieve initial access by exploiting public-facing web\napplications, specifically those that use Telerik UI for ASP.NET, followed by execution and persistence using multiple techniques\n[(check out my colleague Jesse Brown’s new blog for details on Blue Mockingbird’s](https://redcanary.com/blog/cor_profiler-for-persistence) `COR_PROFILER persistence mechanism). During`\nat least one incident, the adversary used proxying software and experimented with different kinds of reverse shell payloads to connect\nto external systems. The earliest Blue Mockingbird tools we’ve observed were created in December 2019.\n\n## Gaining entry\n\nIn at least two incident response (IR) engagements, Blue Mockingbird has exploited public-facing web applications (T1190: Exploit\nPublic-Facing Application) that implemented Telerik UI for ASP.NET AJAX. This suite of user interface components accelerates the\nweb development process, but some versions are susceptible to a deserialization vulnerability, [CVE-2019-18935. The exploitation of](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-18935)\nthis CVE is not unique to Blue Mockingbird, but it has been a common point of entry.\n\nIn exploiting this vulnerability, two DLLs are uploaded to a web application running on a Windows IIS web server. In telemetry,\ninvestigators will notice `w3wp.exe writing the DLLs to disk and then immediately loading them into memory afterward. In some cases,`\nthis will cause `w3wp.exe to temporarily freeze and fail to successfully serve HTTP responses.`\n\nFor a diagnostic to determine whether you are potentially affected by the Telerik CVE, you can search the IIS access logs for the string\n```\n POST Telerik.Web.UI.WebResource.axd . In victim environments, our IR partners found entries similar to these:\n 2020-04-29 02:01:24 10.0.0.1 POST /Telerik.Web.UI.WebResource.axd type=rau 80 - <external IP address> Mozilla/5.0+\n (Windows+NT+10.0;+Win64;+x64;+rv:54.0)+Gecko/20100101+Firefox/54.0 - 200 0 0 625\n 2020-04-29 02:01:27 10.0.0.1 POST /Telerik.Web.UI.WebResource.axd type=rau 80 - <external IP address> Mozilla/5.0+\n (Windows+NT+10.0;+Win64;+x64;+rv:54.0)+Gecko/20100101+Firefox/54.0 - 500 0 0 46\n\n```\nIn the entries, the string `200 refers to HTTP response code 200 where the POST request was successful, and the string` `500 refers`\nto HTTP code 500 where the POST request was not processed successfully by the web server. These code 500 entries happened\nwhen the `w3wp.exe process loaded the uploaded DLLs into memory and temporarily froze.`\n\nSearching the IIS access logs for entries like these is a good idea even if you don’t explicitly know whether you use Telerik UI, as some\nweb applications require the suite as a dependency behind the scenes\n\n\n-----\n\n[If you have endpoint detection and response (EDR) or similar tools, you ll notice](https://redcanary.com/solutions/endpoint-detection-and-response/) `cmd.exe or other suspicious processes spawning`\nfrom `w3wp.exe .`\n\n## Execution and evasion\n\n[The primary payload distributed by Blue Mockingbird is a version of XMRIG packaged as a DLL. XMRIG is a popular, open-source](https://github.com/xmrig/xmrig)\nMonero-mining tool that adversaries can easily compile into custom tooling. During the incidents, we noted three distinct uses.\n\nThe first use was execution with `rundll32.exe explicitly calling the DLL export` `fackaaxv` [(T1218.011: Rundll32). This export](https://attack.mitre.org/beta/techniques/T1218/011/)\nseems unique to this actor’s payloads and doesn’t seem to happen other places in the wild:\n```\nrundll32.exe dialogex.dll,fackaaxv\n\n```\nThe next use was execution using `regsvr32.exe using the` `/s command-line option (T1218.010: Regsvr32). Supplying the` `/s`\nswitch executes the `DllRegisterServer export exposed by the DLL payload. This export ultimately passed control of execution into`\nthe function that `fackaax exported:`\n```\nregsvr32.exe /s dialogex.dll\n\n```\n[The final execution path was with the payload configured as a Windows Service DLL (T1569.002: Service Execution). Once](https://attack.mitre.org/beta/techniques/T1569/002/)\nconfigured, execution of the service invoked the export `ServiceMain, which again passed control to` `fackaaxv .`\n\n## Come for the exploit, stay for the mining\n\nBlue Mockingbird leveraged multiple techniques for persistence during incidents. The most novel technique was the use of a\n```\nCOR_PROFILER COM hijack to execute a malicious DLL and restore items removed by defenders (T1559.001: Component Object\n\n```\nModel). To use `COR_PROFILER, they used` `wmic.exe and Windows Registry modifications to set environment variables and specify`\na DLL payload.\n```\nwmic ENVIRONMENT where \"name='COR_PROFILER'\" delete\nwmic ENVIRONMENT create name=\"COR_ENABLE_PROFILING\",username=\"<system>\",VariableValue=\"1\"\nwmic ENVIRONMENT create name=\"COR_PROFILER\",username=\"<system>\",VariableValue=\"<arbitrary CLSID>\"\nREG.EXE ADD HKEY_LOCAL_MACHINE\\Software\\Classes\\CLSID\\<arbitrary CLSID>\\InProcServer32 /V ThreadingModel /T REG_SZ /D\nApartment /F \nREG.EXE ADD HKEY_LOCAL_MACHINE\\Software\\Classes\\CLSID\\<arbitrary CLSID>\\InProcServer32 /VE /T REG_SZ /D\n\"c:\\windows\\System32\\e0b3489da74f.dll\" /F\n\n```\nThe payload DLL specified as a `COR_PROFILER was simple and gathered few antivirus detections. It executed the following`\ncommand:\n```\ncmd.exe /c sc config wercplsupport start= auto && sc start wercplsupport && copy c:\\windows\\System32\\dialogex.dll\nc:\\windows\\System32\\wercplsupporte.dll /y && schtasks /create /tn \"Windows Problems Collection\" /tr \"regsvr32.exe /s\nc:\\windows\\System32\\wercplsupporte.dll\" /sc DAILY /st 20:02 /F /RU System && start \"\" regsvr32.exe /s\nc:\\windows\\System32\\dialogex.dll\n\n```\nSince `COR_PROFILER was configured, every process that loaded the Microsoft .NET Common Language Runtime would execute the`\ncommand above, re-establishing persistence. The command configured the Windows Problem Reports and Solutions Control Panel\n[Support service to execute automatically at boot (T1543.003: Windows Service). In a separate command, the actor modified the](https://attack.mitre.org/beta/techniques/T1543/003/)\nexisting `wercplsupport service to use the miner DLL instead of the legitimate one:`\n```\nreg add \"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\wercplsupport\\Parameters\" /f /v ServiceDll /t REG_EXPAND_SZ /d\n\"c:\\windows\\System32\\wercplsupporte.dll\"\n\n```\nNote that the actor used the DLL name `wercplsupporte.dll as an attempt to masquerade as the legitimate DLL name, which is`\n\n`wercplsupport.dll` [(T1036.005: Match Legitimate Name or Location). In addition, more masquerading was used to make malicious](https://attack.mitre.org/beta/techniques/T1036/005/)\n[Scheduled Tasks blend in with legitimate ones (T1053.005: Scheduled Task).](https://attack.mitre.org/beta/techniques/T1053/005/)\n\nIn some cases the actor even created a new service to perform the same actions as the COR PROFILER payload:\n\n\n-----\n\n```\nsc create 8995 binPath= \"cmd /c sc config wercplsupport start= auto & sc start wercplsupport & copy\nc:\\windows\\System32\\8995.dll c:\\windows\\System32\\wercplsupporte.dll /y & regsvr32.exe /s c:\\windows\\System32\\8995.dll\" type=\nshare start= auto error= ignore DisplayName= 8995\n\n## Escalating privileges and accessing credentials\n\n```\nIt’s worth noting that Blue Mockingbird’s initial access does not provide the privileges needed to establish the many persistence\nmechanisms used. In one engagement we observed, the adversary using a JuicyPotato exploit to escalate privileges from an IIS\nApplication Pool Identity virtual account to the `NT Authority\\SYSTEM account. JuicyPotato allows an attacker to abuse the`\n```\nSeImpersonate token privilege and Windows DCOM to move from an unprivileged account to the highest level of privilege on a\n\n```\n[system (T1068: Exploitation for Privilege Escalation). During this engagement, the attacker abused a DCOM class and leveraged the](https://attack.mitre.org/beta/techniques/T1068/)\nIIS Application Pool Identity’s `SeImpersonate privilege to perform the escalation:`\n```\nc:\\programdata\\let.exe -t t -p c:\\programdata\\rn.bat -l 1234 -c {8BC3F05E-D86B-11D0-A075-00C04FB68820}\n\n```\nIn another engagement, we observed the adversary using Mimikatz (the official signed version) to access credentials for logon\n[(T1003.001: LSASS Memory).](https://attack.mitre.org/beta/techniques/T1003/001/)\n\n## Free to move around the network\n\nAs with other adversaries that mine cryptocurrency opportunistically, Blue Mockingbird likes to move laterally and distribute mining\npayloads across an enterprise. We observed Blue Mockingbird move laterally using a combination of the Remote Desktop Protocol to\naccess privileged systems and Windows Explorer to then distribute payloads to remote systems (T1021.001 Remote Desktop\nProtocol, [T1021.002 SMB/Windows Admin Shares). In some cases, Scheduled Tasks were created remotely with](https://attack.mitre.org/beta/techniques/T1021/002/) `schtasks.exe /S`\nto ensure execution.\n```\nschtasks /create /tn \"setup service Management\" /tr \"c:\\windows\\temp\\rn.bat\" /sc ONCE /st 00:00 /F /RU System /S remote_host\n\n## A look at command and control\n\n```\nA novel aspect of this adversary is that their toolkit does not appear to be fully defined. In at least one engagement, we observed Blue\n[Mockingbird seemingly experimenting with different tools to create SOCKS proxies (T1090: Proxy) for pivoting. These tools included a](https://attack.mitre.org/beta/techniques/T1090/)\nfast reverse proxy (frp), Secure Socket Funneling (SSF), and Venom. In one instance, the adversary also tinkered with PowerShell\n[reverse TCP shells and a reverse shell in DLL form (T1059.001: PowerShell).](https://attack.mitre.org/beta/techniques/T1059/001/)\n\n## Take action\n\nWe’ve scratched the surface on the XMRIG DLL payload, but we can dive deeper to understand more details (T1496: Resource\nHijacking). First, the export `fackaaxv has been consistently present in the DLLs. Next, each DLL also contains a PE binary section`\n```\n_RANDOMX . This section appears unique to cryptocurrency-mining payloads because it houses the RandomX proof of work algorithm\n\n```\nthat XMRIG may use. The network connections made for mining usually involve a `nanopool[.]org domain.`\n\nWe made the assessment that the payload was actually XMRIG based on several pieces of evidence. First, there were multiple\nreferences to “xmrig”, including version numbers, in the binary strings. These were accompanied by cleartext references to commandline options common to XMRIG:\n\n\n-----\n\nThe final piece of evidence came from a text log written to disk by some versions of the miner DLL. In the text logs, identifying\ninformation for XMRIG was output alongside hardware details for the victim system.\n```\n* ABOUT    XMRig/5.3.0 MSVC/2015\n* LIBS    libuv/1.31.0 OpenSSL/1.1.1c hwloc/2.1.0\n* HUGE PAGES    unavailable\n* 1GB PAGES    unavailable\n* CPU    Intel(R) Core(TM) i7-4770 CPU @ 3.40GHz (1) x64 AES\n         L2:0.3 MB L3:8.0 MB 1C/1T NUMA:1\n* MEMORY    1.3/4.0 GB (33%)\n* DONATE    0%\n* POOL #1    xmr-au1.nanopool.org:14433 coin monero\n* COMMANDS    'h' hashrate, 'p' pause, 'r' resume\n* OPENCL    disabled\n* CUDA    disabled\n[2020-04-16 08:30:26.753] [xmr-au1.nanopool.org:14433] DNS error: \"unknown node or service\"\n\n```\nEach payload comes compiled with a standard list of commonly used Monero-mining domains alongside a Monero wallet address. So\nfar, we’ve identified two wallet addresses used by Blue Mockingbird that are in active circulation. Due to the private nature of Monero,\nwe cannot see the balance of these wallets to estimate their success. We’ve seen mining payloads compiled as early as December\n2019 and as recently as late April 2020. In each compilation, one of the two wallets has been embedded into the binary. The wallet\naddresses could be extracted from the binaries easily in earlier versions using a simple `strings command. In newer versions, the`\nstring is obfuscated.\n\nEven with string obfuscation in the binary, you can observe the wallet addresses in network traffic. During execution of the miner DLLs,\nunique information is passed in cleartext across TCP streams:\n\n\n-----\n\n**g** **y**\n\nProcess is `cmd.exe with command line including` `sc AND` `config AND` `wercplsupporte.dll`\nAny process where command line includes `-t AND` `-c AND` `-l with network connections from` `127.0.0.1 and to`\n```\n   127.0.0.1 on port tcp135 (JuicyPotato)\n\n```\nProcess is `schtasks.exe with command line including` `/create AND` `sc start wercplsupport`\nProcess is `rundll32.exe with command line including` `fackaaxv`\nProcess is `regsvr32.exe with command line including` `/s and having an external network connection`\nProcess is `wmic.exe with command line including` `create AND` `COR_PROFILER`\nProcess is `cmd.exe and parent process is` `services.exe`\n\nFor mitigations, focus on patching web servers, web applications, and dependencies of the applications. Most of the techniques used\nby Blue Mockingbird will bypass whitelisting technologies, so the best route will be to inhibit initial access. Consider establishing a\nbaseline of Windows Scheduled Tasks in your environment to know what is normal across your enterprise.\n\n## Let’s collaborate!\n\n[If you’ve been tracking similar activity, we’d love to hear from you and collaborate. Contact blog@redcanary.com with any observations](http://10.10.0.46/mailto:blog@redcanary.com)\nor questions.\n\nIndicators of compromise for XMRIG miner DLLs\n\n\n**sha256**\n\nsha256:\nd388c309a540d4619169a07a4b64707f4c44953511875b57ad7cfa3e097115af\n\nsha256:\n14e3c16ca940244bea9b6080fa02384ebb4818572cef7092f90d72ae210b330d\n\nsha256:\n5377c69c05817a0e18f7b0ebbeed420f9ab8d1e81b439f439b42917fbe772dfb\n\nsha256:\nc957d007824ee8173c67122a1843c979c818614eeed7db03dea3ba7fede43eba\n\nsha256:\n5d7116f04e10e968de64c4201fc7374fa84b364e90f8e4eba0fbc41afeaf468c\n\nsha256:\n909495884627e2e74d07d729b5e046f3ae01cabd9f0a5a99c74d46046a677f7c\n\nsha256:\nab698a35dc5263f0ca460f09dcbc9f8a4aeb7643365a1e7fa122581ef72c34b6\n\n\n**compile**\n**time** **imphash**\n\n\ncompile\ntime:\n12/19/2019\n17:49:20\n\ncompile\ntime:\n1/4/2020\n12:00:23\n\ncompile\ntime:\n2/6/2020\n10:24:29\n\ncompile\ntime:\n2/6/2020\n10:24:29\n\ncompile\ntime:\n2/19/2020\n13:52:10\n\ncompile\ntime:\n2/22/2020\n14:38:33\n\ncompile\ntime:\n3/8/2020\n16:57:32\n\n\nimphash:\na9d40d5a22948019ae9c5f1b464a1f03\n\nimphash:\naed97d3d2b87ab0b55dab3a3eebe4557\n\nimphash:\n1614f0ce7b6c11bf8bd8a76885c8e21c\n\nimphash:\n1614f0ce7b6c11bf8bd8a76885c8e21c\n\nimphash:\naed97d3d2b87ab0b55dab3a3eebe4557\n\nimphash:\naed97d3d2b87ab0b55dab3a3eebe4557\n\nimphash:\n1614f0ce7b6c11bf8bd8a76885c8e21c\n\n\n-----\n\n**sha256**\n\nsha256:\n60504228b3fc524287bf2a260db933a408639b2f1a29af7538c61b00c4a44c86\n\nsha256:\n1d30d3cafdcc43b2f9a593983ad096c2c3941025fb4e91257e2dcf0919ed24ba\n\nsha256:\n968b324be2b89f1a8ee4743d946723c1ffdca16ccfbbbbb68e5b9f60e0bff4c9\n\nsha256:\n018a02fd0dbc63e54656b8915d71cd8a2ce4409608ae4dff6ec196ffa8743ba1\n\nsha256:\nb31f7152a547fa41c31f9c96177b2cd7131a93f7c328bf6da360dc1586ba18dc\n\nIndicators of compromise for COR_PROFILER DLLs\n\n**sha256**\n\nsha256:\n9a432ea16e74b36c55ec5faa790937fe752ff2561cef83e44856fd1e72398309\n\nsha256:\nde6c061aafc5d86e692bec45f69b2ea18639abd540b59c2c281717a054a48dd5\n\nRelated Articles\n\nDetection and response\n\n### ChromeLoader: a pushy malvertiser\n\nDetection and response\n\n### Intelligence Insights: May 2022\n\nDetection and response\n\n### The Goot cause: Detecting Gootloader and its follow-on activity\n\nDetection and response\n\n\n**compile**\n**time** **imphash**\n\n\ncompile\ntime:\n3/24/2020\n16:15:16\n\ncompile\ntime:\n3/24/2020\n16:15:44\n\ncompile\ntime:\n4/9/2020\n16:05:45\n\ncompile\ntime:\n4/14/2020\n19:00:06\n\ncompile\ntime:\n2020-0426\n14:58:24\n\n\nimphash:\naed97d3d2b87ab0b55dab3a3eebe4557\n\nimphash:\n9ccdf92e630d907101a249f152451dfa\n\nimphash:\naed97d3d2b87ab0b55dab3a3eebe4557\n\nimphash:\naed97d3d2b87ab0b55dab3a3eebe4557\n\nimphash:\naed97d3d2b87ab0b55dab3a3eebe4557\n\n\n**compile**\n**time** **imphash**\n\n\ncompile\ntime:\n2020-0216 9:24:30\n\ncompile\ntime:\n2020-0222\n14:57:17\n\n\nimphash:\n8432f0b0e6fbfe4ac5d53400aa09d6e5\n\nimphash:\n8432f0b0e6fbfe4ac5d53400aa09d6e5\n\n\n-----\n\n### Marshmallows & Kerberoasting\n\n**Subscribe to our blog**\n\n[Our website uses cookies to provide you with a better browsing experience. More information can be found in our Privacy Policy.](https://redcanary.com/privacy-policy)\n\nX\n\n**Privacy Overview**\n\nThis website uses cookies to improve your experience while you navigate through the website. Out of these cookies, the cookies that\nare categorized as necessary are stored on your browser as they are essential for the working of basic functionalities of the website.\nWe also use third-party cookies that help us analyze and understand how you use this website. These cookies will be stored in your\nbrowser only with your consent. You also have the option to opt-out of these cookies. But opting out of some of these cookies may have\nan effect on your browsing experience.\n\nNecessary cookies are absolutely essential for the website to function properly. This category only includes cookies that ensures basic\nfunctionalities and security features of the website. These cookies do not store any personal information.\n\nAny cookies that may not be particularly necessary for the website to function and is used specifically to collect user personal data via\nanalytics, ads, other embedded contents are termed as non-necessary cookies. It is mandatory to procure user consent prior to running\nthese cookies on your website.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-05-07 - Introducing Blue Mockingbird.pdf"
    ],
    "report_names": [
        "2020-05-07 - Introducing Blue Mockingbird.pdf"
    ],
    "threat_actors": [
        {
            "id": "e568e9d7-ae94-4ce5-9039-4fd17c731c1d",
            "created_at": "2022-10-25T15:50:23.491763Z",
            "updated_at": "2025-03-27T02:00:55.483586Z",
            "deleted_at": null,
            "main_name": "Blue Mockingbird",
            "aliases": [
                "Blue Mockingbird"
            ],
            "source_name": "MITRE:Blue Mockingbird",
            "tools": [
                "FRP",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673536110,
    "ts_updated_at": 1743041284,
    "ts_creation_date": 1653714379,
    "ts_modification_date": 1653714379,
    "files": {
        "pdf": "https://archive.orkl.eu/fec9058186378298db4de86f210a21e7af068fed.pdf",
        "text": "https://archive.orkl.eu/fec9058186378298db4de86f210a21e7af068fed.txt",
        "img": "https://archive.orkl.eu/fec9058186378298db4de86f210a21e7af068fed.jpg"
    }
}