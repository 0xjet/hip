{
    "id": "d94d86cf-e327-4e66-8235-c3224f643ccc",
    "created_at": "2023-01-12T15:00:13.352842Z",
    "updated_at": "2025-03-27T02:06:14.02396Z",
    "deleted_at": null,
    "sha1_hash": "c40a0493c51462e9db220f4d7899c360a88561d8",
    "title": "2019-08-15 - Analysis- New Remcos RAT Arrives Via Phishing Email",
    "authors": "",
    "file_creation_date": "2022-05-29T10:36:41Z",
    "file_modification_date": "2022-05-29T10:36:41Z",
    "file_size": 2448288,
    "plain_text": "# Analysis: New Remcos RAT Arrives Via Phishing Email\n\n**[trendmicro.com/en_ca/research/19/h/analysis-new-remcos-rat-arrives-via-phishing-email.html](https://www.trendmicro.com/en_ca/research/19/h/analysis-new-remcos-rat-arrives-via-phishing-email.html)**\n\nAugust 15, 2019\n\nIn July, we came across a phishing email purporting to be a new order notification, which contains a malicious attachment that leads to the\nremote access tool Remcos RAT (detected by Trend Micro as BKDR_SOCMER.SM). This attack delivers Remcos using an AutoIt wrapper\nthat incorporates various obfuscation and anti-debugging techniques to evade detection, which is a common method for distributing known\nmalware.\n\nRemcos RAT emerged in 2016 being peddled as a service in hacking forums — advertised, sold, and offered cracked on various sites and\n[forums. The RAT appears to still be actively pushed by cybercriminals. In 2017, we reported spotting Remcos being delivered via a malicious](https://blog.trendmicro.com/trendlabs-security-intelligence/cve-2017-0199-new-malware-abuses-powerpoint-slide-show/)\nPowerPoint slideshow, embedded with an exploit for CVE-2017-0199. Recently, the RAT has made its way to phishing emails.\n\nThe malicious actor behind the phishing email appears to use the email address rud-division@alkuhaimi[.]com (with a legitimate domain) and\nthe subject \"RE: NEW ORDER 573923\". The email includes the malicious attachment using the ACE compressed file format, Purchase\n_order201900512.ace, which has the loader/wrapper Boom.exe._\n\n## Analyzing the wrapper/loader\n\nAfter converting the executable to AutoIt script, we found that the malicious code was obfuscated with multiple layers, possibly to evade\ndetection and make it difficult for researchers to reverse. The top layer of obfuscation is shown in the following:\n\n\n-----\n\n_Figure 1. Obfuscated core functions_\n\n\n-----\n\n_gu e_ _u ct o s used o deob uscat o_\n\nThe main goal of the Boom.exe file is to achieve persistence, perform anti-analysis detection, and drop/execute Remcos RAT on an affected\nsystem. The above snippet code first calculates the value inside the array and then uses the ChrW() function to convert the Unicode number to\nthe character.\n\n_Figure 3. Sample of string decoding_\n\nIn some cases after decryption, the malware uses the AutoIt function called BinaryToString() to deobfuscate the next layer. The following code\nsnippet demonstrates this behavior:\n\n_Figure 4. AutoIt Binary to String decoding_\n\nAfter deobfuscation, the AutoIt code can be seen containing large amounts of junk code meant to throw analysts off the track.\n\n\n-----\n\n_Figure 5. Sample of junk code_\n\nThe malware then creates a copy of itself in %AppData%\\Roaming\\appidapi\\UevTemplateBaselineGenerator.exe and loads the main payload\n(Remcos RAT) from its resource section. The malware then prepares the environment to execute the main payload. It achieves this by\nexecuting the following Shellcode (frenchy_shellcode version 1).\n\n_Figure 6. Frenchy_ShellCode_001_\n\n\n-----\n\n_Figure 7. Executing and decoding Frenchy Shellcode_\n\n_Figure 8. Frenchy Shellcode Mutant_\n\nDecoding and loading Remcos from resources\n\nThe DecData() function loads the data from its resource then reverses all data and replaces “%$=” with “/”.\n\n_Figure 9. AutoIt decoding the main payload: Code + encoded resource (Remcos RAT)_\n\n_Figure 10. AutoIt decoding the main payload: Code only_\n\nThen it uses the following to decode the base64 PE file, which is the main payload:\n\n**$a_call = DllCall(\"Crypt32.dll\", \"int\", \"CryptStringToBinary\", \"str\", $sData, \"int\", 0, \"int\", 1, \"ptr\", 0, \"ptr\",**\n**DllStructGetPtr($struct, 1), \"ptr\", 0, \"ptr\", 0)**\n\n\n-----\n\n_Figure 11. Decoding Remcos from AutoIt_\n\n## Loader features\n\n_Anti-VM_\n\nThis AutoIt loader is capable of detecting a virtual machine environment by checking vmtoolsd.exe and vbox.exe in the list of running\nprocesses. However, it should be noted that this feature is not invoked in this sample.\n\n_Figure 12. AutoIt loader’s Anti-VM_\n\n_Bypass UAC_\n\nDepending on the Windows version, the malware uses either the built-in Event Viewer utility (eventvwr) or fodhelper to bypass the User\nAccount Control (UAC).\n\n\n-----\n\n_Figure 13. UAC bypass_\n\n_Anti-Debugging_\n\nIf the loader detects IsdebuggerPresent in the system, it will display the message, “This is a third-party compiled AutoIt script.” and exits the\nprogram.\n\n_Figure 14. AutoIt loader checks for a debugger_\n\n## Examining the main payload, Remcos RAT\n\nOriginally marketed as a remote access tool that legitimately lets a user control a system remotely, Remcos RAT has since been used by\ncybercriminals. Once the RAT is executed, a perpetrator gains the ability to run remote commands on the user’s system. In a past campaign,\n[for instance, the tool was seen with a variety of capabilities, which includes downloading and executing commands, logging keys, logging](https://blog.trendmicro.com/trendlabs-security-intelligence/cve-2017-0199-new-malware-abuses-powerpoint-slide-show/)\nscreens, and capturing audio and video using the microphone and webcam.\n\nFor the analysis of this payload, we looked into the sample Remcos Professional version 1.7.\n\n_Figure 15. Remcos version_\n\n\n-----\n\nUpo e ecut o, depe d g o t e co gu at o, t e a a e c eates a copy o tse _% pp ata%\\ e_ _cos\\ e_ _cos e e, uses_ _sta bat to_\nexecute remcos.ex$ from the %APPDATA% directory, and finally deletes itself. It then creates the following Run key in the Registry to maintain\npersistence on the system.\n\n_Figure 16. Install.bat dropped by Remcos_\n\n_Figure 17. Remcos RAT changes the Registry entry to maintain persistence_\n\n_Figure 18. Reflected Remcos RAT change in the Registry_\n\nThe malware retrieves the configuration called “SETTING” from its resource section.\n\n\n-----\n\n_Figure 19. Remcos loads the encrypted settings from its resources_\n\nThe content of the configuration is encrypted using the RC4 algorithm, as seen below:\n\n_Figure 20. Remcos encrypted configuration_\n\nThe following, on the other hand, is the RC4 algorithm used to decrypt the above configuration:\n\n\n-----\n\n_Figure 21. RC4 algorithm to decrypt the configuration_\n\n_Figure 22. Decrypted configuration_\n\nThe malware then creates the following mutex to mark its presence on the system:\n\n_Figure 23. Remcos RAT mutex_\n\nIt then starts to collect system information such as username, computer name, Windows version, etc., which it sends to the command and\ncontrol (C&C) server. The malware encrypts the collected data using the RC4 algorithm with the password “pass” from the configuration data.\n\n\n-----\n\n_Figure 24. Remcos collecting system information_\n\n\n-----\n\n_Figure 25. Clear text data collected by Remcos, where “|cmd|” is the delimiter_\n\n_Figure 26. Data is encrypted and sent to C&C server_\n\n\n-----\n\n_Figure 27. Encrypted data_\n\nThe following list shows some of the commands supported by the malware:\n\n**Commands** **Description**\n\n**Clipboarddata** **Getclipboard** **Setclipboard** **Emptyclipboard** Clipboard manager\n\n**deletefile** Delete file(s)\n\n**downloadfromurltofile** Download a file from specified URL and execute it on an\ninfected system\n\n**execcom** Execute a shell command\n\n**filemgr** File manager\n\n**getproclist** List the running processes\n\n**initremscript** Execute remote script from C&C\n\n**keyinput** Keylogger\n\n**msgbox** Display a message box on an infected system\n\n**openaddress** Open a specified website\n\n**OSpower** Shutdown, restart, etc.\n\n**ping** Ping an infected system (used for network check)\n\n**prockill** Kill a specific process\n\n\n**regopened** **regcreatekey** **regeditval** **regdelkey** **regdelval**\n**regopen** **initregedit**\n\n\nAdd, edit, rename, or delete registry values and keys\n\n\n**scrcap** Screen capture\n\n**sendfiledata** Upload data to C&C server\n\n**uninstall** Uninstall itself from an infected system\n\n_Table 1. Remcos RAT commands_\n\n\n-----\n\ne co so ec d co a d s o t e e t gu e, o sta ce, s used to e ecute s e co a ds o a ected syste\n\n_Figure 28. Some examples of Remcos RAT’s commands_\n\n_Figure 29. Browser/cookie-stealing feature_\n\nAfter analyzing this Remcos variant — its configuration data, communication mechanism, and functionalities — we saw that it had many\nsimilarities with its older variant (detected as Backdoor.Win32.Remcosrat.A). However, this particular campaign delivers Remcos using an\nAutoIt wrapper, which incorporates different obfuscation and anti-debugging techniques to avoid detection.\n\n## Prevention and Trend Micro Solutions\n\n\n-----\n\no de e d aga st t eats e e cos t at use e a based attac s, e ad se use s to e a o ope g u so c ted e a s\nespecially those with attachments — from unknown sources. Users should also exercise caution before clicking on URLs to avoid being\ninfected with malware. For enterprises, if an anomaly is suspected in the system, report the activity to the network administrator immediately.\nWe also recommend these best practices for added protection:\n\n[Learn how to identify phishing emails and spot indicators of unwanted emails (i.e., misspellings, odd vocabulary)](https://www.trendmicro.com/vinfo/us/security/news/cybercrime-and-digital-threats/best-practices-identifying-and-mitigating-phishing-attacks)\nUpdate applications and systems regularly\nApply whitelisting, block unused ports, and disable unused components\nMonitor traffic in the system for any suspicious behavior\n\nImplementing security solutions with anti-spam filtering should weed out spam messages such as the one discussed here. The use of a\n[multilayered solution such as Trend Micro™ Deep Discovery™ will help provide detection, in-depth analysis, and proactive response to today’s](https://www.trendmicro.com/en_ca/business/products/network/advanced-threat-protection/deep-discovery-threat-intelligence-network-analytics.html)\nstealthy malware such as Remcos RAT, and targeted attacks in real-time. It provides a comprehensive defense tailored to protect\n[organizations against targeted attacks and advanced threats through specialized engines, custom sandboxing, and seamless correlation](http://blog.trendmicro.com/trendlabs-security-intelligence/deploying-a-smart-sandbox-for-unknown-threats-and-zero-day-attacks/)\n[across the entire attack lifecycle. Trend Micro™ Deep Discovery™ Inspector prevents malware from reaching end users. For a more](https://www.trendmicro.com/en_ca/business/products/network/advanced-threat-protection/inspector.html)\n[comprehensive security suite, organizations can consider the Trend Micro™ Cloud App Security™ solution, which employs machine learning](https://www.trendmicro.com/en_ca/business/products/hybrid-cloud.html)\n(ML) in web reputation and URL dynamic analysis. The solution can also detect suspicious content in the message body and attachments as\nwell as provide sandbox malware analysis and document exploit detection.\n\n**Indicators of Compromise (IoCs)**\n\n\n**File Name and Email**\n**Address**\n\nPurchase\norder201900512.ace\n\nBoom.exe\n(Loader/Wrapper)\n\n\n**Note** **SHA-256 Hash** **Trend Micro Pattern De**\n\n\nEmail\nattachment\n(ACE)\n\nACE file\ncontent\n(Win32\nEXE)\n\n\ncf624ccc3313f2cb5a55d3a3d7358b4bd59aa8de7c447cdb47b70e954ffa069b Backdoor.Win32.REMC\n\n1108ee1ba08b1d0f4031cda7e5f8ddffdc8883db758ca978a1806dae9aceffd1 Backdoor.Win32.REMC\n\n6cf0a7a74395ee41f35eab1cb9bb6a31f66af237dbe063e97537d949abdc2ae9 BKDR_SOCMER.SM\n\n\nremcos.ex$ Remcos\nRAT\n(Win32\nEXE)\n\n\nruddivision@alkuhaimi[.]com\n\n\nSender ID\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-08-15 - Analysis- New Remcos RAT Arrives Via Phishing Email.pdf"
    ],
    "report_names": [
        "2019-08-15 - Analysis- New Remcos RAT Arrives Via Phishing Email.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535613,
    "ts_updated_at": 1743041174,
    "ts_creation_date": 1653820601,
    "ts_modification_date": 1653820601,
    "files": {
        "pdf": "https://archive.orkl.eu/c40a0493c51462e9db220f4d7899c360a88561d8.pdf",
        "text": "https://archive.orkl.eu/c40a0493c51462e9db220f4d7899c360a88561d8.txt",
        "img": "https://archive.orkl.eu/c40a0493c51462e9db220f4d7899c360a88561d8.jpg"
    }
}