{
    "id": "bb6f9863-a423-40d7-b267-524971759dc0",
    "created_at": "2023-01-12T15:03:02.976125Z",
    "updated_at": "2025-03-27T02:05:42.80507Z",
    "deleted_at": null,
    "sha1_hash": "1a2410d88b7cb10137a8e9dba408eb8969942c54",
    "title": "2012-07-22 - Xtreme RAT analysis",
    "authors": "",
    "file_creation_date": "2022-05-28T15:34:37Z",
    "file_modification_date": "2022-05-28T15:34:37Z",
    "file_size": 337804,
    "plain_text": "# Xtreme RAT analysis\n\n**malware.lu/articles/2012/07/22/xtreme-rat-analysis.html**\n\n#### Published on 2012-07-22 14:00:00. We received an email with an invoice from Apple (in french).\n\n Of course we never bought something from Apple!!!!\n\n The link of the invoice seems to be : http://www.apple.com/clients/download/facture50522231823v.zip\n\n But when we put our mouse on the link we can see the real link: http://editionslabonte.com/plugins/Facture147778.zip\n\n We think that the Website “editionslabonte.com” was compromised and the attacker puts the malware on it. We sent an email to the administrator and we do not have a feedback for the moment.\n\n## Tools\n\n#### A debugger for dynamic analysis (in our case OllyDbg) LordPE in order to dump a memory page Volatility in order to analyse memory dump\n\n## Zip archive\n\n#### The md5 of the archive is e0aa33dc57aa3eee43cb61933eb3241c.\n\n Virustotal score : 5/42\n\n So we downloaded the zip file\n\n\n-----\n\n```\nrootbsd@alien: /Samples$ unzip l Facture147778.zip \nArchive: Facture147778.zip\n Length   Date  Time  Name\n--------- ---------- -----  ---  176128 2012-07-14 03:05  Facture147778.pdf      .scr\n---------           ------  176128           1 file\n\n#### The .zip contains one file. To trick the user, the attacker adds several space before the extension .scr, some users may thought that the file is really a .pdf.\n\n## First binary\nrootbsd@alien:~/Samples$ yara -r packer.yara Facture147778.pdf\\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\\n.scr \njava Facture147778.pdf      .scr\nNETexecutableMicrosoft Facture147778.pdf      .scr\n\n#### The file is a .NET binary.\n\n With the strings command, we find somethink that looks like a base64.\n\n We extract the base64 :\nrootbsd@alien:~/Samples$ cat base64.dmp \nTVqQAAMAAAAEAAAA//8AALgAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAA4AAAAA4fug4AtAnNIbgBTM0hVGhpcyBwcm9ncmFtIGNhbm5vdCBiZSBydW4gaW4gRE9TIG1v\nZGUuDQ0KJAAAAAAAAACZtmjHqtcGlN3XBpTd1waUpssKlNzXBpReywiU3NcGlDXIDJTW1waUNcgC\nlNnXBpQe2FuU1NcGlN3XB5Tg1waUNcgNlNzXBpRl0QCU3NcGlFJpY2jd1waUAAAAAAAAAABQRQAA\nTAEEAKYPc0oAAAAAAAAAAOAADwELAQYAAEIAAACUAAAAAAAAdE8AAAAQAAAAYAAAAABAAAAQAAAA\nAgAABAAAAAAAAAAEAAAAAAAAAAAQAQAABAAAAAAAAAIAAAAAABAAABAAAAAAEAAAEAAAAAAAABAA\n[...]\nW1EPulAAAAIAAQAgAEAAAQABADQBAAAFAAAAAQAEACAgEAABAAQA6AIAAAEAEBAQAAEABAAoAQAA\nAgAgIAAAAQAgAKgQAAADABAQAAABACAAaAQAAAMAUEEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAA=\n\n We decode this file.\nrootbsd@alien:~/Samples$ cat base64.dmp | base64 -d > base64.out\nrootbsd@alien:~/Samples$ file base64.out\nbase64.out: PE32 executable for MS Windows (GUI) Intel 80386 32-bit\n\n This base64 is a PE32 executable.\n\n## Second binary\n\n#### We use yara to identify the binary:\nrootbsd@alien:~/Samples$ yara -r packer.yara base64.out \nrootbsd@alien: /Samples$\n\n```\n\n-----\n\n#### This binary doesn t use a well-known packer. So we decided to unpack it manually.\n\n To unpack it, we use OllyDBG.\n\n We are suprised by a lot of exception when we tried to debug the sample.\n\n In fact this malware volontary uses and traps exceptions to be unpacked.\n\n So as usual, we add breakpoint on VirtualAlloc & VirtualAllocEx calls:\n\n View\n\n Executable modules\n\n right click on kernel32.dll -> View names\n\n F2 on VirtualAlloc & VirtualAllocEx\n\n Now we run the malware with F9\n\n A lot of exception must be pass. Use shift+F9 to pass it.\n\n Now the application is break at kernel32.VirtualAllocEx :\n\n\n-----\n\n#### Execute the binary until the next RET with Ctrl+F9.\n\n Now we can see the allocated address of the memory in the EAX register: 0x40B61B.\n\n Right click on the EAX value, and click on “Follow in dump”.\n\n We can see a PE value in the bottom left. If we scroll we can see the complete MZ :\n\n\n-----\n\n#### Now we can use lordPE to make a partial dump: - launch LordPE\n\n right click on the process\n\n Dump partial\n\n set the start address to 40B51B\n\n set the size to 411000 - 40B51B = 5AE5\n\n Now we have a binary with the md5: 18e5ff1d0610341257f33e6fefe4f9a7\n\n## Third binary\n\n#### We used yara to identify the binary:\n```\nrootbsd@alien:~/Samples$ yara -r packer.yara base64.stage2.dmp \nUPXv20MarkusLaszloReiser base64.stage2.dmp\nUPXV200V290MarkusOberhumerLaszloMolnarJohnReiser base64.stage2.dmp\nUPX20030XMarkusOberhumerLaszloMolnarJohnReiser base64.stage2.dmp\n\n The binary is simply pack with UPX.\nrootbsd@alien:~/Samples$ upx -o base64.stage2.exe -d base64.stage2.dmp \n            Ultimate Packer for eXecutables\n             Copyright (C) 1996 - 2010\nUPX 3.07    Markus Oberhumer, Laszlo Molnar & John Reiser  Sep 08th 2010\n    File size     Ratio   Format   Name\n  --------------------  ------  -----------  ----------   46821 <-   23269  49.70%  win32/pe   base64.stage2.exe\nUnpacked 1 file.\nrootbsd@alien:~/Samples$ file base64.stage2.exe\nbase64.stage2.exe: PE32 executable for MS Windows (GUI) Intel 80386 32-bit\n\n We have got the final binary.\n\n```\n\n-----\n\n## Fourth binary\n\n#### We easily identify a well-known RAT:\n```\nrootbsd@alien:~/Samples$ strings -el base64.stage2.exe | grep RAT\nXtreme RAT SOFTWARE\\XtremeRAT\n\n After a quick search on Google, we discovered that the RAT could be buy here: https://sites.google.com/site/nxtremerat/.\n\n The second interesting think is that fact that the RAT is used in Syria : https://www.eff.org/deeplinks/2012/03/how-find-syrian-government-malware-your-computer- and-remove-it/\n\n We can use 3 methods to analyse the binary: the simple, the semi talented method and the full talented method.\n\n### Simple\n\n#### We execute it, and launch netstat.exe on Windows. The IP of the C&C is 41.103.186.12 and port 2013.\n\n It’s an IP from Alger:\nrootbsd@alien:~/Samples$ whois 41.103.186.12\n% This is the AfriNIC Whois server.\n% Note: this output has been filtered.\n%Information related to '41.103.0.0 - 41.103.255.255'\ninetnum:    41.103.0.0 - 41.103.255.255\nnetname:    RegAlg1\ndescr:     Region Alger 1\ncountry:    DZ\nadmin-c:    SD6-AFRINIC\ntech-c:     SD6-AFRINIC\nstatus:     ASSIGNED PA\nmnt-by:     DJAWEB-MNT\nsource:     AFRINIC # Filtered\nparent:     41.96.0.0 - 41.111.255.255\nperson:     Security Departement\naddress:    Alger\nphone:     +21321922004\nfax-no:     +21321922004\ne-mail:     security@djaweb.dz\nnic-hdl:    SD6-AFRINIC\nsource:     AFRINIC # Filtered\n\n```\n\n-----\n\n#### To be persitent, the malware adds a value (antivirus) in the registry: Software\\Microsoft\\Windows\\CurrentVersion\\Run\n\n The malware is stored in the directory: C:\\Windows\\Browser\\Web.exe\n\n A configuration file is available here: C:\\Documents and Settings\\rootbsd\\Application Data\\Microsoft\\Windows\\S5tVn.cfg\n\n### Semi talented\n\n#### We can use a memory dump to analyse the binary. We use volatility to analyse the binary:\n```\nrootbsd@alien:~/Samples$ volatility/vol.py -f output pslist\nVolatile Systems Volatility Framework 2.0\n Offset(V) Name         PID  PPID  Thds  Hnds  Time \n---------- -------------------- ------ ------ ------ ------ ------------------0x812ed020 System          4   0   54  247 1970-01-01 00:00:00   \n0xffbaeb10 smss.exe        368   4   3   19 2012-05-21 15:20:54   \n0x811248e0 csrss.exe        584  368   10  379 2012-05-21 15:20:54   \n0x81197248 winlogon.exe      608  368   21  514 2012-05-21 15:20:54   \n0x811275a8 services.exe      652  608   16  253 2012-05-21 15:20:54   \n0x8112d7e0 lsass.exe        664  608   23  338 2012-05-21 15:20:54   \n0xffbd7a78 VBoxService.exe     820  652   8  106 2012-05-21 15:20:54   \n0x81180c30 svchost.exe       864  652   19  197 2012-05-21 06:20:56   \n0x811a6b28 svchost.exe       952  652   9  237 2012-05-21 06:20:56   \n0xffac4218 svchost.exe      1044  652   79  1367 2012-05-21 06:20:56   \n0xffabbd08 svchost.exe      1092  652   6   76 2012-05-21 06:20:56   \n0x8116cda0 svchost.exe      1132  652   13  172 2012-05-21 06:20:56   \n0x8112eca8 spoolsv.exe      1544  652   14  111 2012-05-21 06:20:57   \n0xffa93b00 explorer.exe      1556  1504   17  477 2012-05-21 06:20:57   \n0x8112fda0 VBoxTray.exe      1700  1556   6   58 2012-05-21 06:20:57   \n0xffb95da0 svchost.exe      1904  652   4  106 2012-05-21 06:21:05   \n0xffa01a98 alg.exe        1076  652   6  107 2012-05-21 06:21:09   \n0x81178278 wscntfy.exe      1188  1044   1   31 2012-05-21 06:21:11   \n0x81188da0 wuauclt.exe      1956  1044   8  180 2012-05-21 06:21:51   \n0x811323c0 wuauclt.exe       248  1044   4  133 2012-05-21 06:22:05   \n0x8119ada0 svchost.exe      2000  1488   2   41 2012-07-20 19:15:47   \n0x8118b888 svchost.exe      1404  1488   8  188 2012-07-20 19:15:47\n\n The 2 last svchost.exe are stange. The date is not logic.\n\n When you list the dll you can see that the malware change his name to svchost.exe:\n\n```\n\n-----\n\n```\nrootbsd@alien: /Samples$ ../Pentest/volatility/vol.py f output p 2000 dlllist\nVolatile Systems Volatility Framework 2.0\n************************************************************************\nsvchost.exe pid:  2000\nCommand line : svchost.exe\nService Pack 3\nBase     Size     Path\n0x00400000  0x038000   E:\\essai\\svchost.exe\n0x7c900000  0x0b2000   C:\\WINXP\\system32\\ntdll.dll\n0x7c800000  0x0f6000   C:\\WINXP\\system32\\kernel32.dll\n0x7e410000  0x091000   C:\\WINXP\\system32\\user32.dll\n0x77f10000  0x049000   C:\\WINXP\\system32\\GDI32.dll\n0x76390000  0x01d000   C:\\WINXP\\system32\\IMM32.DLL\n0x77dd0000  0x09b000   C:\\WINXP\\system32\\ADVAPI32.dll\n0x77e70000  0x093000   C:\\WINXP\\system32\\RPCRT4.dll\n0x77fe0000  0x011000   C:\\WINXP\\system32\\Secur32.dll\n0x7c9c0000  0x818000   C:\\WINXP\\system32\\shell32.dll\n0x77c10000  0x058000   C:\\WINXP\\system32\\msvcrt.dll\n0x77f60000  0x076000   C:\\WINXP\\system32\\SHLWAPI.dll\n0x773d0000  0x103000   C:\\WINXP\\WinSxS\\x86_Microsoft.Windows.CommonControls_6595b64144ccf1df_6.0.2600.6028_x-ww_61e65202\\comctl32.dll\n0x5d090000  0x09a000   C:\\WINXP\\system32\\comctl32.dll\n\n#### We make a memory dump of the process 1404 :\nrootbsd@alien:~/Samples$ volatility/vol.py -f output -p 1404 memdump -D .\nVolatile Systems Volatility Framework 2.0\n************************************************************************\nWriting svchost.exe [ 1404] to 1404.dmp\n\n In the .dmp we have got all necessary information:\nrootbsd@alien:~/Samples$ strings -a 1404.dmp | grep http://\n[...]\nhttp://baloobadjamel.hopto.org:2013/1234567890.functions\n[...]\nrootbsd@alien:~/Samples$ nslookup baloobadjamel.hopto.org\nServer:     192.168.0.254\nAddress:    192.168.0.254#53\nNon-authoritative answer:\nName:  baloobadjamel.hopto.org\nAddress: 41.103.186.12\n\n And we find the IP.\n\n We hope that Djamel Baloodad is not the real name of the owner of the C&C ;)\n\n### Talented\n\n#### We open the final binary on IDA.\n\n```\n\n-----\n\n#### To help us you can find the .idb here\n\n At loc_C889C9, we find two functions sub_C93B1C (loadConfigResource) and sub_C82914 (decondeConfig).\n\n The fisrt function extracts a resource. This resource is the config file (in this case S5tVn.cfg).\n\n The second function decode the configuration file. Two interesting arguments are passed ton the function: the offset of the config file & the word “CONFIG” (in unicode).\n\n This function is composed of 3 loops. This kind of layout looks like RC4 (RC4) :\n\n 2 loops KSA (KSA)\n\n 1 loop for PRGA (PRGA).\n\n The first loop:\n\n\n-----\n\n#### The second loop:\n\n And the final loop:\n\n\n-----\n\n#### So the config file is crypted with RC4 with the key “CONFIG”.\n\n To perform a RC4 encryption we need the length of the key. To have this size the developer mades his own function sub_C81AF8 (StringLen) but this function does not support unicode, it returns 6 and not 12. So we must implemente this bug in our tool to decrypt the config file.\n\n A script to decode the config file is available here\n\n\n-----\n\n```\nrootbsd@alien: /Samples$ ./xtremerat_config.py xtreme.exe | strings el\nbaloobadjamel.hopto.org\nSpam2013\nteSpam2013\nWeb.exe\nBrowser\nsvchost.exe\nAntivirus\nAntivirus\n P8CWY65J-GY7I-CD3S-7K6Q-BD3A60R037L3\nServer\n3.5 Private\nS5tVn\nS5tVnEXIT\nS5tVnPERSIST\nftp.ftpserver.com\npData\\Local\nftpuser\nftppass\nError\nivateAn unexpected error occurred when starting the program.\nPlease try again later.\n\n#### We can already see the C&C, the port, etc…\n\n We are working on the format on the configuration file, for the moment we identify this format:\nrootbsd@alien:~/Samples$ ./xtremerat_config.py -d xtreme.exe \nname10: 3.5 PrivateS5tV\nname11: stS5tVnEXI �\nname6: Antivirus\nname7: Antivirus\nhost: baloobadjamel.hopto.org\nnum: 101\nname2: teSpam2013\nname3: Web.exe\nport: 2013\nname8: P8CWY65J-GY7I-CD3S-7K6Q-BD3A60R037L3\nname9: Server\nname: Spam2013\nname4: Browser\nname5: svchost.exe\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2012/2012-07-22 - Xtreme RAT analysis.pdf"
    ],
    "report_names": [
        "2012-07-22 - Xtreme RAT analysis.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535782,
    "ts_updated_at": 1743041142,
    "ts_creation_date": 1653752077,
    "ts_modification_date": 1653752077,
    "files": {
        "pdf": "https://archive.orkl.eu/1a2410d88b7cb10137a8e9dba408eb8969942c54.pdf",
        "text": "https://archive.orkl.eu/1a2410d88b7cb10137a8e9dba408eb8969942c54.txt",
        "img": "https://archive.orkl.eu/1a2410d88b7cb10137a8e9dba408eb8969942c54.jpg"
    }
}