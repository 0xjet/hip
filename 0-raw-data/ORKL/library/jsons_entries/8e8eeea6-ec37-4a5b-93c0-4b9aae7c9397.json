{
    "id": "8e8eeea6-ec37-4a5b-93c0-4b9aae7c9397",
    "created_at": "2022-10-25T16:48:21.667714Z",
    "updated_at": "2025-03-27T02:16:58.168416Z",
    "deleted_at": null,
    "sha1_hash": "7de0fbb852cc5be3fce91725a1b0aeb9abe3a43b",
    "title": "CARBANAK Week Part Four: The CARBANAK Desktop Video Player",
    "authors": "FireEye",
    "file_creation_date": "2019-09-18T01:55:19Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 639061,
    "plain_text": "# CARBANAK Week Part Four: The CARBANAK Desktop Video Player\n\n**[fireeye.com/blog/threat-research/2019/04/carbanak-week-part-four-desktop-video-player.html](https://www.fireeye.com/blog/threat-research/2019/04/carbanak-week-part-four-desktop-video-player.html)**\n\n[Part One, Part Two and Part Three of CARBANAK Week are behind us. In this final blog post,](https://www.fireeye.com/blog/threat-research/2019/04/carbanak-week-part-one-a-rare-occurrence.html)\nwe dive into one of the more interesting tools that is part of the CARBANAK toolset. The\nCARBANAK authors wrote their own video player and we happened to come across an\ninteresting video capture from CARBANAK of a network operator preparing for an offensive\nengagement. Can we replay it?\n\n## About the Video Player\n\nThe CARBANAK backdoor is capable of recording video of the victim’s desktop. Attackers\n[reportedly viewed recorded desktop videos to gain an understanding of the operational](https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2018/03/08064518/Carbanak_APT_eng.pdf)\nworkflow of employees working at targeted banks, allowing them to successfully insert\nfraudulent transactions that remained undetected by the banks’ verification processes. As\n[mentioned in a previous blog post announcing the arrest of several FIN7 members, the](https://www.fireeye.com/blog/threat-research/2018/08/fin7-pursuing-an-enigmatic-and-evasive-global-criminal-operation.html)\nvideo data file format and the player used to view the videos appeared to be custom\nwritten. The video player, shown in Figure 1, and the C2 server for the bots were designed\nto work together as a pair.\n\n\n-----\n\nFigure 1: CARBANAK desktop video player\n\nThe C2 server wraps video stream data received from a CARBANAK bot in a custom video\nfile format that the video player understands, and writes these video files to a location on\ndisk based on a convention assumed by the video player. The StreamVideo constructor\nshown in Figure 2 creates a new video file that will be populated with the video capture data\nreceived from a CARBANAK bot, prepending a header that includes the signature TAG,\ntimestamp data, and the IP address of the infected host. This code is part of the C2 server\nproject.\n\n\n-----\n\nFigure 2: carbanak\\server\\Server\\Stream.cs – Code snippet from the C2 server that serializes\nvideo data to file\n\nFigure 3 shows the LoadVideo function that is part of the video player project. It validates\nthe file type by looking for the TAG signature, then reads the timestamp values and IP\naddress just as they were written by the C2 server code in Figure 2.\n\n\n-----\n\nFigure 3: carbanak\\server\\Player\\Video.cs – Player code that loads a video file created by the\nC2 server\n\nVideo files have the extension .frm as shown in Figure 4 and Figure 5. The C2 server’s\nCreateStreamVideo function shown in Figure 4 formats a file path following a convention\ndefined in the MakeStreamFileName function, and then calls the StreamVideo constructor\nfrom Figure 2.\n\nFigure 4: carbanak\\server\\Server\\RecordFromBot.cs – Function in the C2 server that formats\na video file name and adds the extension \"frm\"\n\nThe video player code snippet shown in Figure 5 follows video file path convention,\nsearching all video file directories for files with the extension .frm that have begin and end\ntimestamps that fall within the range of the DateTime variable dt.\n\n\n-----\n\nFigure 5: carbanak\\server\\Player\\Video.cs – Snippet from Player code that searches for\nvideo files with \"frm\" extension\n\n## An Interesting Video\n\nWe came across several video files, but only some were compatible with this video player.\nAfter some analysis, it was discovered that there are at least two different versions of the\nvideo file format, one with compressed video data and the other is raw. After some slight\nadjustments to the video processing code, both formats are now supported and we can\nplay all videos.\n\nFigure 6 shows an image from one of these videos in which the person being watched\nappears to be testing post-exploitation commands and ensuring they remain undetected by\ncertain security monitoring tools.\n\n\n-----\n\nFigure 6: Screenshot of video playback captured by CARBANAK video capability\n\nThe list of commands in the figure centers around persistence, screenshot creation, and\nlaunching various payloads. Red teamers often maintain such generic notes and command\nsnippets for accomplishing various tasks like persisting, escalating, laterally moving, etc. An\n[extreme example of this is Ben Clark’s book RTFM. In advance of an operation, it is](https://www.amazon.com/Rtfm-Red-Team-Field-Manual/dp/1494295504)\ncustomary to tailor the file names, registry value names, directories, and other parameters\nto afford better cover and prevent blue teams from drawing inferences based on\nmethodology. Furthermore, Windows behavior sometimes yields surprises, such as value\nlength limitations, unexpected interactions between payloads and specific persistence\nmechanisms, and so on. It is in the interest of the attacker to perform a dry run and ensure\nthat unanticipated issues do not jeopardize the access that was gained.\n\nThe person being monitored via CARBANAK in this video appears to be a network operator\npreparing for attack. This could either be because the operator was testing CARBANAK, or\nbecause they were being monitored. The CARBANAK builder and other interfaces are never\nshown, and the operator is seen preparing several publicly available tools and tactics. While\npurely speculation, it is possible that this was an employee of the front company Combi\n[Security which we now know was operated by FIN7 to recruit potentially unwitting](https://www.fireeye.com/blog/threat-research/2018/08/fin7-pursuing-an-enigmatic-and-evasive-global-criminal-operation.html)\n\n\n-----\n\noperators. Furthermore, it could be the case that FIN7 used CARBANAK s tinymet command\nto spawn Meterpreter instances and give unwitting operators access to targets using\npublicly available tools under the false premise of a penetration test.\n\n## Conclusion\n\nThis final installment concludes our four-part series, lovingly dubbed CARBANAK Week. To\nrecap, we have shared at length many details concerning our experience as reverse\nengineers who, after spending dozens of hours reverse engineering a large, complex family\nof malware, happened upon the source code and toolset for the malware. This is something\nthat rarely ever happens!\n\nWe hope this week’s lengthy addendum to FireEye’s continued CARBANAK research has\nbeen interesting and helpful to the broader security community in examining the\nfunctionalities of the framework and some of the design considerations that went into its\ndevelopment.\n\nSo far we have received lots of positive feedback about our discovery of the source code\nand our recent exposé of the CARBANAK ecosystem. It is worth highlighting that much of\nwhat we discussed in CARBANAK Week was originally covered in our FireEye’s Cyber Defense\n_[Summit 2018 presentation titled “Hello, Carbanak!”, which is freely available to](https://www.fireeye.com/content/fireeye-summit/en_US/learn/tracks.html#technical-4)_\nwatch online (a must-see for malware and lederhosen enthusiasts alike). You can expect\nsimilar topics and an electrifying array of other malware analysis, incident response,\nforensic investigation and threat intelligence discussions at FireEye’s upcoming Cyber\n_Defense Summit 2019, held Oct. 7 to Oct. 10, 2019, in Washington, D.C._\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/30mizln4f525yv482qqampa8vybjj764"
    ],
    "report_names": [
        "Fireeye_CARBANAK-Week-4-CARBANAK-Desktop-Video-Player(04-25-2019)"
    ],
    "threat_actors": [
        {
            "id": "c9617bb6-45c8-495e-9759-2177e61a8e91",
            "created_at": "2022-10-25T15:50:23.405039Z",
            "updated_at": "2025-03-27T02:00:55.462193Z",
            "deleted_at": null,
            "main_name": "Carbanak",
            "aliases": [
                "Carbanak",
                "Anunak"
            ],
            "source_name": "MITRE:Carbanak",
            "tools": [
                "Carbanak",
                "Mimikatz",
                "PsExec",
                "netsh"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "bfded1cf-be73-44f9-a391-0751c9996f9a",
            "created_at": "2022-10-25T15:50:23.337107Z",
            "updated_at": "2025-03-27T02:00:55.445946Z",
            "deleted_at": null,
            "main_name": "FIN7",
            "aliases": [
                "FIN7",
                "GOLD NIAGARA",
                "ITG14",
                "Carbon Spider",
                "ELBRUS",
                "Sangria Tempest"
            ],
            "source_name": "MITRE:FIN7",
            "tools": [
                "Mimikatz",
                "AdFind",
                "JSS Loader",
                "HALFBAKED",
                "REvil",
                "PowerSploit",
                "CrackMapExec",
                "Carbanak",
                "Pillowmint",
                "Cobalt Strike",
                "POWERSOURCE",
                "RDFSNIFFER",
                "SQLRat",
                "Lizar",
                "TEXTMATE",
                "BOOSTWRITE"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "f4f16213-7a22-4527-aecb-b964c64c2c46",
            "created_at": "2024-06-19T02:03:08.090932Z",
            "updated_at": "2025-03-27T02:05:17.387119Z",
            "deleted_at": null,
            "main_name": "GOLD NIAGARA",
            "aliases": [
                "Carbanak",
                "Carbon Spider ",
                "FIN7 ",
                "Navigator ",
                "Sangria Tempest ",
                "TelePort Crew ",
                "Calcium "
            ],
            "source_name": "Secureworks:GOLD NIAGARA",
            "tools": [
                " Carbanak",
                " Cobalt Strike",
                " DICELOADER",
                " DRIFTPIN",
                " GGLDR",
                " GRIFFON",
                " JSSLoader",
                " Meterpreter",
                " OFFTRACK",
                " PILLOWMINT",
                " POWERTRASH",
                " SUPERSOFT",
                " TAKEOUT",
                " TinyMet",
                "Bateleur"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "bb8702c5-52ac-4359-8409-998a7cc3eeaf",
            "created_at": "2023-01-06T13:46:38.405479Z",
            "updated_at": "2025-03-27T02:00:02.82533Z",
            "deleted_at": null,
            "main_name": "FIN7",
            "aliases": [
                "JokerStash",
                "ATK32",
                "G0046",
                "Coreid",
                "Carbanak",
                "Sangria Tempest",
                "CARBON SPIDER",
                "GOLD NIAGARA",
                "G0008",
                "ELBRUS",
                "Carbon Spider"
            ],
            "source_name": "MISPGALAXY:FIN7",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d85adfe3-e1c3-40b0-b8bb-d1bacadc4d82",
            "created_at": "2022-10-25T16:07:23.619566Z",
            "updated_at": "2025-03-27T02:02:09.890982Z",
            "deleted_at": null,
            "main_name": "FIN7",
            "aliases": [
                "APT-C-11",
                "ATK 32",
                "Gold Niagara",
                "ITG14",
                "TAG-CR1"
            ],
            "source_name": "ETDA:FIN7",
            "tools": [
                "7Logger",
                "Agentemis",
                "Anunak",
                "Astra",
                "BIOLOAD",
                "BIRDWATCH",
                "Bateleur",
                "Boostwrite",
                "CROWVIEW",
                "Carbanak",
                "Cobalt Strike",
                "CobaltStrike",
                "DICELOADER",
                "DNSMessenger",
                "FOWLGAZE",
                "HALFBAKED",
                "JSSLoader",
                "KillACK",
                "LOADOUT",
                "Lizar",
                "Meterpreter",
                "Mimikatz",
                "POWERPLANT",
                "POWERSOURCE",
                "RDFSNIFFER",
                "SQLRAT",
                "Sekur",
                "Sekur RAT",
                "TEXTMATE",
                "Tirion",
                "VB Flash",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "ed3810b7-141a-4ed0-8a01-6a972b80458d",
            "created_at": "2022-10-25T16:07:23.443259Z",
            "updated_at": "2025-03-27T02:02:09.801771Z",
            "deleted_at": null,
            "main_name": "Carbanak",
            "aliases": [
                "Anunak",
                "Carbanak",
                "Carbon Spider",
                "ELBRUS",
                "Gold Waterfall",
                "Sangria Tempest"
            ],
            "source_name": "ETDA:Carbanak",
            "tools": [
                "AVE_MARIA",
                "Agentemis",
                "AmmyyRAT",
                "Antak",
                "Anunak",
                "Ave Maria",
                "AveMariaRAT",
                "BABYMETAL",
                "BIRDDOG",
                "Backdoor Batel",
                "Batel",
                "Bateleur",
                "BlackMatter",
                "Boostwrite",
                "Cain & Abel",
                "Carbanak",
                "Cl0p",
                "Cobalt Strike",
                "CobaltStrike",
                "DNSMessenger",
                "DNSRat",
                "DNSbot",
                "DRIFTPIN",
                "DarkSide",
                "FOXGRABBER",
                "FlawedAmmyy",
                "HALFBAKED",
                "JS Flash",
                "KLRD",
                "MBR Eraser",
                "Mimikatz",
                "Nadrac",
                "Odinaff",
                "POWERPIPE",
                "POWERSOURCE",
                "PsExec",
                "SQLRAT",
                "Sekur",
                "Sekur RAT",
                "SocksBot",
                "SoftPerfect Network Scanner",
                "Spy.Agent.ORM",
                "TEXTMATE",
                "TeamViewer",
                "TiniMet",
                "TinyMet",
                "Toshliph",
                "VB Flash",
                "WARPRISM",
                "avemaria",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716501,
    "ts_updated_at": 1743041818,
    "ts_creation_date": 1568771719,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/7de0fbb852cc5be3fce91725a1b0aeb9abe3a43b.pdf",
        "text": "https://archive.orkl.eu/7de0fbb852cc5be3fce91725a1b0aeb9abe3a43b.txt",
        "img": "https://archive.orkl.eu/7de0fbb852cc5be3fce91725a1b0aeb9abe3a43b.jpg"
    }
}