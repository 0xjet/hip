{
    "id": "5f7cbff2-d425-4a8c-858e-1bc8c658e702",
    "created_at": "2022-10-25T16:48:15.358459Z",
    "updated_at": "2025-03-27T02:14:59.998177Z",
    "deleted_at": null,
    "sha1_hash": "d7a600df1c454ba459d8021752ddde70730b821c",
    "title": "PowerPoint Presentation",
    "authors": "",
    "file_creation_date": "2020-07-26T15:26:50Z",
    "file_modification_date": "2020-07-26T15:26:50Z",
    "file_size": 2651651,
    "plain_text": "# FASTCash and INJX_PURE\n### How Threat Actors Use Public Standards for Financial Fraud\n\n\n-----\n\n#### Technical Threat Intelligence (TechINT)\n\n Previous Research\n\n • SANS DFIR 2016: YARA and VirusTotal\n (w/ Allen Swackhamer)\n\n • SANS DFIR 2017: Tracking Bitcoin Transactions\n\n • BH 2018: Mapping Decentralized Infrastructure\n\n I really like soft pretzels…\n\n\n-----\n\n#### • Understanding financial standards – ISO 8583 and XFS\n\n • Examine how threat actors use these in their malware\n\n • Discuss the advantages and drawbacks threat actors experience\n\n\n-----\n\n#### • What is ISO 8583?\n\n • Critical for card transactions (e.g. ATMs, POS devices)\n\n\n-----\n\n#### 020042000400000000021612345678901234560609173030011456789ABC1000123456 7890123456789012345678901234567890123456789012345678901234567890123456 78901234567890123456789\n\n###### Source: https://www.chileoffshore.com/en/interesting-articles/115-about-iso8583\n *Note: I modified three digits to create a valid Point-of-Service entry mode value\n\n\n-----\n\n#### • Three parts to any ISO 8583 message:\n\n 1. Message Type Identifier – Acts as a “header”\n\n 2. Bitmap – Specifies data elements that are present\n\n 3. Data Elements – Contain transaction-specific information\n\n\n-----\n\n#### • Four subcomponents within the ISO 8583 MTI:\n\n 1. Version\n\n 2. Message Classification (Authorization, financial, chargeback, etc.)\n\n 3. Message Function\n\n 4. Message Source\n\n\n-----\n\n#### 020042000400000000021612345678901234560609173030011456789ABC1000123456 7890123456789012345678901234567890123456789012345678901234567890123456 78901234567890123456789\n\n\n-----\n\n#### 020042000400000000021612345678901234560609173030011456789ABC1000123456 7890123456789012345678901234567890123456789012345678901234567890123456 78901234567890123456789\n\n 0200\n 0 = Version: 1987 2 = Classification: Financial Message 0 = Function: Request 0 = Source: Acquirer\n\n\n-----\n\n#### 020042000400000000021612345678901234560609173030011456789ABC1000123456 7890123456789012345678901234567890123456789012345678901234567890123456 78901234567890123456789\n\n This bitmap indicates the presence of fields 2, 7, 22, 63\n\n###### Open source in-depth bitmap guide: http://www.lytsing.org/downloads/iso8583.pdf Open source bitmap decoder: http://www.fintrnmsgtool.com/decode-iso87-bitmap.html\n\n\n-----\n\n#### 020042000400000000021612345678901234560609173030011456789ABC1000123456 7890123456789012345678901234567890123456789012345678901234567890123456 78901234567890123456789\n\n PAN = 16 digits [1234567890123456]\n\n\n-----\n\n#### 020042000400000000021612345678901234560609173030011456789ABC1000123456 7890123456789012345678901234567890123456789012345678901234567890123456 78901234567890123456789\n\n Transmission Date and Time = 06-09 17:30:30 UTC\n\n\n-----\n\n#### 020042000400000000021612345678901234560609173030011456789ABC1000123456 7890123456789012345678901234567890123456789012345678901234567890123456 78901234567890123456789\n\n POS Entry Mode = 011\n 01 = Manual Entry, 1 = PIN entry available at terminal\n\n###### Source: http://www.fintrnmsgtool.com/iso-point-of-service-entry-mode.html\n\n\n-----\n\n#### • Malware family, intercepts ISO 8583 messages and approves them\n\n • Three types: AIX Type 1, AIX Type 2, Windows\n\n • Files tailored to their environment\n\n\n-----\n\n-----\n\n-----\n\n###### “ld” contents of field to r0 “li” field number to r3\n\n “li” field number to r3\n\n IBM AIX Assembly Instructions: https://www.ibm.com/developerworks/library/l-powasm1/index.html\n\n\n-----\n\n#### Oval = Function Rectangle = Action\n\n\n-----\n\n|Col1|Col2|Col3|\n|---|---|---|\n||||\n|||Comp Set value o|\n\n\n###### Move required IP\n\n Compare current IP to required IP\n\n Set value of 1 if they are the same\n\n\n-----\n\n|Col1|Col2|Col3|\n|---|---|---|\n||||\n|||Grab Field|\n\n\n###### Grab Field 2 (PAN)\n\n Grab Field 3 (Processing Code)\n\n\n-----\n\n|Col1|Three possible workflows: 1. GenerateResponseTransaction1 2. GenerateResponseTransaction2 3. GenerateResponseInquiry1|\n|---|---|\n\n\n###### Three possible workflows:\n 1. GenerateResponseTransaction1 2. GenerateResponseTransaction2 3. GenerateResponseInquiry1\n\n\n-----\n\n-----\n\n###### 1. Copy Fields 2. Set Response Code 3. Create Random Amount\n\n\n-----\n\n#### Fields Copied (Transaction 1) Fields Copied (Transaction 2)\n\n###### • 2 – PAN • 2 – PAN\n • 3 – Processing Code • 3 – Processing Code\n • 4 – Amount, Transaction • 4 – Amount, Transaction\n • 7 – Transaction Date and Time • 7 – Transaction Date and Time\n • 11 – System Trace Audit Number • 11 – System Trace Audit Number\n • 14 – Date, Expiration • 14 – Date, Expiration\n • 19 – Acquiring Country Code • 19 – Acquiring Country Code\n • 22 – POS Entry Mode • 22 – POS Entry Mode\n • 25 – POS Condition Code • 25 – POS Condition Code\n • 32 – Acquiring Identification Code • 32 – Acquiring Identification Code\n • 35 – Track 2 Data • 35 – Track 2 Data\n • 37 – Retrieval Reference Number • 37 – Retrieval Reference Number\n • 41 – Card Acceptor Terminal ID • 41 – Card Acceptor Terminal ID\n • 42 – Card Acceptor ID • 42 – Card Acceptor ID\n • 44 – Additional Response Data • 44 – Additional Response Data\n • 49 – Currency Code, Transaction • 49 – Currency Code, Transaction\n • 62 – INF Data (binary) • 62 – INF Data (binary)\n\n\n-----\n\n#### Fields Copied\n\n###### • 2 – PAN • 32 – Acquiring Identification Code\n • 3 – Processing Code • 35 – Track 2 Data\n • 4 – Amount, Transaction • 37 – Retrieval Reference Number\n • 7 – Transaction Date and Time • 41 – Card Acceptor Terminal ID\n • 11 – System Trace Audit Number • 42 – Card Acceptor ID\n • 14 – Date, Expiration • 44 – Additional Response Data\n • 18 – Merchant Type • 49 – Currency Code, Transaction\n • 19 – Acquiring Country Code • 62 – INF Data (binary)\n • 22 – POS Entry Mode • 63 – Network Data (binary)\n • 25 – POS Condition Code\n\n#### *ResponseInquiry1 only uses Response Code 00 (Approve)\n\n\n-----\n\n###### cc01sssCdddddddddddd\n\n “356”\n\n Field 54 (Additional Amounts)\n\n\n-----\n\n#### • What is actually happening here?\n\n###### Amount Type 01 (ledger balance)\n\n C = Credit Amount\n\n#### • Field 54: Up to six additional account amounts\n cc01356Cdddddddddddd\n\n • Format:\n\n • Account Type (2 Numbers)\n • Amount Type (2 Alphanumeric) Currency Code 356 (Indian Rupee)\n • Currency Code\n • Balance Type Digit (0, C, or D) + Amount (12 digits)\n\n###### Resources: https://stackoverflow.com/questions/26119041/what-is-the-structure-of-field-no-54-p54-in-the-the-iso-8583-standard http://unalarif.com/yazi/iso-8583-field-aciklamalari-f54/ (Turkish)\n\n\n-----\n\n#### 1. Inject Into Process 2. Preliminary Checks (e.g. IP, PAN, Message Type) 3. Decision point:\n 1. Pass Transaction 2. Block + Response 1 3. Block + Response 2 4. Block + Inquiry\n\n\n-----\n\n-----\n\n#### • Consolidated message processing\n\n • Blacklist function (named but no functioning branching logic)\n\n • “Transition” between AIX Type 1 and Windows versions\n\n###### Documented at a high level in open source: https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/fastcash- lazarus-atm-malware\n\n\n-----\n\n-----\n\n|Col1|Results of GetField_Str are moved into EAX and EDI and used below|\n|---|---|\n\n|Col1|Digit Checker Function Push 2 = Check two digits Add EAX, 2 = start two digits in Push “00” = Comparison String Push EAX = Location of String|\n|---|---|\n\n\n###### Get Field 0 (MTI)\n\n Results of GetField_Str\n Get Field 22 (POS Entry Mode) are moved into EAX and\n EDI and used below\n\n Digit Checker Function\n\n Push 2 = Check two digits\n Digits 3 and 4 in MTI are “00”\n Add EAX, 2 = start two digits in Push “00” = Comparison String Push EAX = Location of String\n\n POS Entry Starts With “9”\n\n\n-----\n\n#### 1. Grab MTI + Fields 3, 4, 11, 49\n\n 2. Check that all these fields had data\n\n 3. Exit function if not\n\n\n-----\n\n###### Processing Code First Digit = “3” ?\n\n Processing Code First Digit = “0” ?\n\n\n-----\n\n-----\n\n#### • Processing Code Starts with 3:\n • Return random amount as balance inquiry\n • cc02949Cdddddddddddd\n • 949 = Turkish Lira\n • 02 = Available Balance\n\n • Processing Code Starts with 0:\n • Response 00, return random amount\n\n • Other Processing Codes:\n • Response 55 (Incorrect PIN)\n\n\n-----\n\n#### 1) A lot needs to go right\n\n 2) An awful lot can go wrong\n\n 3) Heavy operational requirements (e.g. programmers, money mules, access)\n\n\n-----\n\n#### • eXtensions for Financial Services\n\n • Standard API for using financial devices such as ATMs\n\n • JXFS – Java version\n\n\n-----\n\n#### • Common in ATM malware\n • MXFS.dll\n • WFSGetInfo\n • WFSExecute\n • WFS_CMD_PIN_GET_DATA\n • WFMOpenKey\n • WFMEnumKey\n • …any many more\n\n###### Kaspersky example: https://securelist.com/atmii-a-small-but-effective-atm-robber/82707/ TrendMicro example: https://blog.trendmicro.com/trendlabs-security-intelligence/untangling-ripper-atm-malware/\n\n\n-----\n\n#### • ATM malware, relies on XFS and proprietary software\n\n • Operators can:\n • Query device information\n • Dispense cash remotely\n • Load and inject additional Java code\n • Execute arbitrary JavaScript\n • Execute arbitrary cmd.exe commands\n\n\n-----\n\n#### • For this presentation, we are only focusing on the cash dispensing actions\n\n • Open source reporting covering some of the other interesting parts:\n • Kaspersky high-level: https://securelist.com/criminals-atms-and-a-cup-of-coffee/91406/\n\n • Yoroi, more detailed: https://yoroi.company/research/java-amt-malware-the-insider-\n###### threat-phantom/\n\n#### • Frank Boldewin, some context: https://github.com/fboldewin/Libertad-y-gloria---A-\n###### Mexican-cyber-heist-story---CyberCrimeCon19-Singapore\n\n\n-----\n\n-----\n\n#### 1. KRunnable() – Reads file named .AgentCli\n 1. If value = 2, add log entry 2. If value = 1, scandyna(), loadconf(), patchall()\n\n 2. loadconf() – Creates an HTTPServ() that accepts commands\n • d – dispense cash or query the device\n • eva – run arbitrary JavaScript\n • mgr – pull running classes\n • core – run a locally stored JAR file\n • [no endpoint] – execute arbitrary shell command\n\n\n-----\n\n|Col1|Col2|Creates an HTTP server|\n|---|---|---|\n||||\n||||\n\n\n###### Creates an HTTP server\n\n\n-----\n\n###### “/d” endpoint check “POST” check\n\n Query function\n\n Dispense function\n\n\n-----\n\n#### • Which of these are XFS?\n\n###### • Peripheral.Dispenser\n • getNumberOfCashUnits\n • getCashUnit\n\n\n-----\n\n-----\n\n###### CEN Documents: https://www.cen.eu/work/areas/ict/ebusiness/pages/ws-j-xfs.aspx\n\n\n-----\n\n-----\n\n###### HUGE credit to Frank Boldewin for finding the source code referenced below on VirusTotal: https://github.com/fboldewin/Libertad-y-gloria---A-Mexican-cyber-heist-story---CyberCrimeCon19-Singapore\n\n\n-----\n\n#### Taking it one step further…\n\n###### • accept • getDeviceStatusString • getRejectBinStatusString\n • disableInsert • getInputShutterStatus • getShutterStatusString\n • eject • getItemsTransportStatusString • getStackerStatus\n • ejectReject • getMaxStackerCapacity • getStackerStatusString\n • ejectStack • getMediaStatus • getVendorInfoError\n • enableInsert • getMediaStatusString • reset\n • enableInsertByNotesType • getNumberOfCashUnits • retract\n • getCanRetract • getNumberOfRejectedNotes • stack\n • getCashUnit • getNumberOfRetractedNotes • waitForEject\n • getCashUnitEx • getNumberOfRetractOperations • waitForEjectReject\n • getCashUnitInfoEx • getOutputStatus • waitForEjectStack\n • getCommandStatus • getOutputStatusString • waitForInsert\n • getDeviceStatus • getRejectBinStatus\n\n\n-----\n\n#### What else could the attackers have done?\n\n###### Screen\n\n • disableKeys • maskWithoutShow\n • enableKeys • setAutoEnter\n • executeCommand • setTimeOut\n • extraCommand • show\n • getTimeOut • waitAction\n • mask • waitActionWithoutPinPadControl\n • maskAndWaitAndTimeOut\n\n Host System Service PinPad\n\n • isOnline • alive • addPinPadListener\n • receive • getDate • encrypt3DesMac\n • reset • getRebootStatus • getSerialNumber\n\n\n-----\n\n#### • Yellow = Likely XFS/Built on XFS\n • Orange = Unclear\n • Red = Likely Proprietary\n\n###### ATM manual in OSINT\n\n Dispense function\n\n\n-----\n\n-----\n\n#### • Possibility of proprietary implementations\n\n • Increased development time\n\n • With INJX_Pure, someone has to: 1) Deploy the malware 2) Be at the ATM at the right time\n\n\n-----\n\n#### • Malicious activity facilitated by legitimate, widely-used financial standards\n\n • Two different approaches to accomplish the same thing\n\n • High operational requirements: money mules, long-term intrusions\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        }
    ],
    "references": [
        "https://i.blackhat.com/USA-20/Wednesday/us-20-Perlow-FASTCash-And-INJX_Pure-How-Threat-Actors-Use-Public-Standards-For-Financial-Fraud.pdf"
    ],
    "report_names": [
        "us-20-Perlow-FASTCash-And-INJX_Pure-How-Threat-Actors-Use-Public-Standards-For-Financial-Fraud.pdf"
    ],
    "threat_actors": [
        {
            "id": "67bf0462-41a3-4da5-b876-187e9ef7c375",
            "created_at": "2022-10-25T16:07:23.44832Z",
            "updated_at": "2025-03-27T02:02:09.806007Z",
            "deleted_at": null,
            "main_name": "Careto",
            "aliases": [
                "Careto",
                "The Mask",
                "Ugly Face"
            ],
            "source_name": "ETDA:Careto",
            "tools": [
                "Careto"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "679e335a-38a4-4db9-8fdf-a48c17a1f5e6",
            "created_at": "2023-01-06T13:46:38.820429Z",
            "updated_at": "2025-03-27T02:00:02.927526Z",
            "deleted_at": null,
            "main_name": "FASTCash",
            "aliases": [],
            "source_name": "MISPGALAXY:FASTCash",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1666716495,
    "ts_updated_at": 1743041699,
    "ts_creation_date": 1595777210,
    "ts_modification_date": 1595777210,
    "files": {
        "pdf": "https://archive.orkl.eu/d7a600df1c454ba459d8021752ddde70730b821c.pdf",
        "text": "https://archive.orkl.eu/d7a600df1c454ba459d8021752ddde70730b821c.txt",
        "img": "https://archive.orkl.eu/d7a600df1c454ba459d8021752ddde70730b821c.jpg"
    }
}