{
    "id": "b48da6f2-1d00-4b4e-be9f-16497a628b0f",
    "created_at": "2023-01-12T14:59:20.953224Z",
    "updated_at": "2025-03-27T02:05:37.289874Z",
    "deleted_at": null,
    "sha1_hash": "ced2ee40aed442a0bdfd5d71296e389ab640752f",
    "title": "2020-01-20 - Linux Rekoobe Operating with New, Undetected Malware Samples",
    "authors": "",
    "file_creation_date": "2022-05-28T19:05:04Z",
    "file_modification_date": "2022-05-28T19:05:04Z",
    "file_size": 1031286,
    "plain_text": "# Linux Rekoobe Operating with New, Undetected Malware Samples\n\n**[intezer.com/blog-linux-rekoobe-operating-with-new-undetected-malware-samples/](https://intezer.com/blog-linux-rekoobe-operating-with-new-undetected-malware-samples/)**\n\nJanuary 20, 2020\n\nWritten by Ignacio Sanmillan - 20 January 2020\n\n## Get Free Account\n\nJoin Now\n\n**Introduction**\n\nOur research team has identified new versions of an old Linux malware known as Rekoobe,\na minimalistic trojan with a complex CNC authentication protocol originally targeting SPARC\nand Intel x86, x86-64 systems back in 2015.\n\nThe new malware samples have lower detection rates than their predecessors. We believe\nthis malware ceased its operation in 2016 after it was reported, however, based on our\nfindings we can estimate the operators behind Rekoobe have resumed their operations\nutilizing a newer version of the malware.\n\n\n-----\n\nBased on our research, we can estimate the new samples have been in the wild since\n2018.\n\nWe will present a brief technical analysis of the new Rekoobe samples and explain why we\nbelieve the new samples have lower detection rates despite previous versions of Rekoobe\nbeing well-detected by different security vendors.\n\n**Technical Analysis**\n\n[Linux Rekoobe was first reported by DrWeb in 2015. We believe this malware resumed its](https://vms.drweb.com/virus/?i=7754026&lng=en)\noperation some time between 2018 and 2019, based on CNC reverse DNS intelligence\nfrom [RiskIQ, along with sample information from VirusTotal concerning the new variants.](https://community.riskiq.com/search/96.45.187.113)\n\nIt’s important to mention that the new variants are statically compiled ELF binaries while\nolder variants were dynamically compiled.\n\nThis undeniably implies that on a code level these two generations of the same malware\nare different. Since the compilation flags used by the GCC compiler differ between\ndynamically and statically linked code, the compiler will generate different code accordingly.\n\nWe have also taken into consideration that if indeed these new implants were generated\nafter a three to four year gap, the GCC compiler version would also differ. Consequently, the\ncompiler will generate different code on an assembly level even though additional\ncompilation flags may not have been explicitly used.\n\nIt’s important to mention that the authors of Linux Rekoobe have removed every attributive\nstring from older variants in their new samples. This explains why string-based signatures\nhave not been able to detect the new version of the malware.\n\n\n-----\n\nIn previous Rekoobe variants, the malware would initially collect some preliminary\nconfiguration saved in disk, masquerading this configuration to be a shared object, as\npreviously reported by DrWeb researchers. However, in the new variants, the need for this\nconfiguration file has been completely removed, having hard-coded the subject artifacts\npreviously dependent on the configuration file.\n\n_Main function comparison between Rekoobe variants_\n\nAmong the hardcoded artifacts we can find the CNC IP and port, in addition to the shared\n‘secret’ used to authenticate the CNC and client.\n\nA new feature was added to the new Rekoobe variants to rewrite argv[0], as an attempt to\nrename the process name (as shown in the picture above) since some forensics tools do\nretrieve the process name from this location.\n\nThe names to rewrite argv[0] chosen by the authors were:\n\n/lib/sys/temd/sys/temd-udevd\n/bin/bash\n\n\n-----\n\n_Shared secret retrieval comparison between different Rekoobe versions_\n\nAnother noticeable difference is that in previous variants a magic value was retrieved from\nthe configuration file and sent to the CNC prior to the handshake mechanism. It seems that\nthe authors removed this preliminary packet on the new Rekoobe variants.\n\nThe remaining code resembles previous variants of Rekoobe. The following is a simplified\noverview of the network protocol used by the new Rekoobe samples, mostly shared with\nolder Rekoobe variants:\n\nThe following is a brief description of the most relevant steps in the authentication\nmechanism:\n\n**1. The client will read a stream of 40-bytes from the server. This packet will be divided into**\ntwo blocks of 20-bytes that will be utilized to initialize two AES128_HMAC_SHA1 contexts.\nThe HMAC SHA1 pair will be generated against each of the 20-byte streams using a given\nshared secret (“idontknow” hardcoded string in newer variants) and they will be used as\nAES128 keys for encryption and decryption of future packets.\n\nThese computed keys will be used throughout the communication process to decrypt the\nreceived packets and to encrypt the packets to be sent by the client with different keys. This\nimplies that if this preliminary packet is not retrieved and the shared secret is not known,\nthen the remaining traffic will unlikely be decryptable.\n\n\n-----\n\n_AES128_HMAC_SHA1 context generation_\n\n**2. After AES128_HMAC_SHA1 context initialization is achieved there will be a CNC**\nauthentication procedure similar to a Challenge-Handshake Authentication Protocol\n(CHAP). The client will read an additional stream of 16-bytes that will then decrypt using\nAES128 with the corresponding and previously generated SHA1 hash as key. It will xor\ndecode the stream to retrieve information of the next packet to be read. This process will be\nrepeated every time the client and server sends an additional packet.\n\n**3. Every other packet will be subject to HMAC integrity checks to verify the integrity of the**\npackets. Two layers of SHA1 will be computed against the subject packet with two\nadditional salts. This computed SHA1 hash will be then compared with the first 20-bytes of\nthe received packet which contains the pre-computed SHA1 of the AES encrypted packet’s\npayload.\n\nIf the computed SHA1 hash does not match with the hardcoded hash delivered in the\npacket, the client will cease execution since it would imply that the integrity of that packet\nhas been compromised; otherwise the client will proceed to AES128 decrypt the packet’s\npayload and then apply an xor layout.\n\n\n-----\n\n_SHA1 scheme applied to encrypted packet and comparison to hardcoded SHA1_\n\n**4. After this packet has been decrypted, the contents will be compared against a hard-**\ncoded byte sequence of 16-bytes in order to verify the integrity of the server.\n\nOnce again, if this sequence does not match, the handshake will fail.\n\n**5. If the sequence is correct, then this byte sequence will be AES128 encrypted with the**\ncorresponding HMAC SHA1 as key, two layers of SHA1 will be computed with its\ncorrespondent salts against the encrypted payload, and this SHA1 hash will be written on\nthe first 20-bytes of the packet itself to then be sent back to the CNC as the last verification\nstep, in this case to verify the integrity of the client.\n\n\n-----\n\n_Hardcoded stream of 16-bytes the CNC and client authentication is based on_\n\nWe assume this field would be an ideal choice for also identifying the campaign ID by the\noperators, although it seems the value of this field was shared with previous variants.\n\n**6. If the handshake was successful, the client will proceed to listen for a command from the**\nCNC. The malware supports the same three different commands as it did in previous\nvariants, those being file upload, file download, and a reverse shell. The following picture\nshows the command management implemented by the client after command packet has\nbeen successfully decrypted:\n\n\n-----\n\n**Conclusion**\n\nWe have provided a brief technical analysis of the new Linux Rekoobe samples,\nhighlighting some of the differences between these variants and previous samples. We\nhave also provided an overview of the network protocol.\n\nWe have provided several reasons for why the malware has gone undetected, even though\nthe code base of these new variants doesn’t appear to have been heavily modified on a\nsource code level from the original Rekoobe samples.\n\nWe do not believe this malware has been consistently operational since late 2015. In\ncontrast, we believe the malware may have operated intermittently over small periods of\ntime, since the newly discovered samples appear to be created in recent years, and there\nappears to be a gap in 2017 where additional Rekoobe samples have not been found.\n\nWe have indexed the code from the new Linux Rekoobe variants in our Genetic Malware\nAnalysiss platform [Intezer Analyze, and we have published a new YARA rule in order to](https://www.intezer.com//intezer-analyze/)\nhelp the community to detect this threat.\n\n\n-----\n\nWe expect [Linux threats to pose a significant challenge to enterprise cloud security in the](https://www.intezer.com/blog/linux/elf-malware-analysis-101-linux-threats-no-longer-an-afterthought/)\n[near future. We have just released our new cloud security product, Intezer Protect, which is](https://www.intezer.com//intezer-protect/)\nbased on our Genetic Malware Analysis technology and provides native cloud protection.\nFor more information, visit [https://www.intezer.com//intezer-protect/.](https://www.intezer.com//intezer-protect/)\n\n**IOCs**\n\n80e5fec19843c32c6c3fc38aabdeb428c339b0dfce28023529144405b9c72b33\nC9eb46d00e11acb354b518f725412b88c69cc511ec8d5bd3cb03c1740f8a2936\n2e2dc0328f6c19b033bb19c24e59e354e519606958afb93fd8049d162a8e3edd\nE63c2e35a41c51e33b246f5b60c5d1b8da0d8c50bf7ec592383b61818217e8d7\n7148ae1ab45e17889915100fdc203fe7941d8e9b946d44a3989ab8baeb6066e1\n1d0591049a65db6508a9517f72954541ef6b5a7fe9153c5edcb1bac1b70b991c\n4B45E601D480124C38BE06A706F7D8F4\nF34119A442651945D5EFB33DB8901D9B\n7xin.bitscan[.]win\nhuawel[.]site\n96.45.187[.]113\n119.3.22[.]174\n\n**Ignacio Sanmillan**\nNacho is a security researcher specializing in reverse engineering and malware analysis.\nNacho plays a key role in Intezer\\'s malware hunting and investigation operations, analyzing\nand documenting new undetected threats. Some of his latest research involves detecting\nnew Linux malware and finding links between different threat actors. Nacho is an adept ELF\nresearcher, having written numerous papers and conducting projects implementing state-ofthe-art obfuscation and anti-analysis techniques in the ELF file format.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-01-20 - Linux Rekoobe Operating with New, Undetected Malware Samples.pdf"
    ],
    "report_names": [
        "2020-01-20 - Linux Rekoobe Operating with New, Undetected Malware Samples.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535560,
    "ts_updated_at": 1743041137,
    "ts_creation_date": 1653764704,
    "ts_modification_date": 1653764704,
    "files": {
        "pdf": "https://archive.orkl.eu/ced2ee40aed442a0bdfd5d71296e389ab640752f.pdf",
        "text": "https://archive.orkl.eu/ced2ee40aed442a0bdfd5d71296e389ab640752f.txt",
        "img": "https://archive.orkl.eu/ced2ee40aed442a0bdfd5d71296e389ab640752f.jpg"
    }
}