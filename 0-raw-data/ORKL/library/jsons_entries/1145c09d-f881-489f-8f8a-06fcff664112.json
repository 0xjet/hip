{
    "id": "1145c09d-f881-489f-8f8a-06fcff664112",
    "created_at": "2023-01-12T15:02:45.749832Z",
    "updated_at": "2025-03-27T02:16:58.043379Z",
    "deleted_at": null,
    "sha1_hash": "067c49a4554f7fafd28c93a733febf208e0c09c1",
    "title": "2017-06-09 - FIN7 Takes Another Bite at the Restaurant Industry",
    "authors": "",
    "file_creation_date": "2022-05-28T01:57:18Z",
    "file_modification_date": "2022-05-28T01:57:18Z",
    "file_size": 1496724,
    "plain_text": "# FIN7 Takes Another Bite at the Restaurant Industry\n\n**blog.morphisec.com/fin7-attacks-restaurant-industry**\n\n[Tweet](https://twitter.com/share)\n\n\n-----\n\n## INTRODUCTION\n\nOn June 7, 2017, Morphisec Lab identified a new, highly sophisticated fileless attack\ntargeting restaurants across the US. The ongoing campaign allows hackers to seize system\ncontrol and install a backdoor to steal financial information at will. It incorporates some never\nbefore seen evasive techniques that allow it to bypass most security solutions – signature\nand behavior based.\n\nAside from these updated techniques, Morphisec’s investigation revealed an almost perfect\nmatch to FIN7 attack methods. Past highly successful and damaging attacks on banks, SEC\npersonnel, large restaurant chains and hospitality organizations have all been attributed to\n[the financially-motivated FIN7 group. FIN7, which is also associated with the Carbanak gang,](https://blog.morphisec.com/fileless-attack-framework-discovery)\nmust be seen as one of the leading threat actor groups operating today.\n\nLike past attacks, the initial infection vector is a malicious Word document attached to a\nphishing email that is well-tailored to the targeted business and its day-to-day operations.\nThe Word document executes a fileless attack that uses DNS queries to deliver the next\nshellcode stage (Meterpreter). However, in this new variant, all the DNS activity is initiated\nand executed solely from memory – unlike previous attacks which used PowerShell\ncommands.\n\nOpenDNS investigate data, shared in coordination with the Cisco Advanced Threat\nResearch & Efficacy Team, shows that this is a large-scale, currently active attack with peaks\nof more than 10K DNS requests per hour.\n\n\n-----\n\nAlarmingly, the detection score on VirusTotal for all of the documents continues to be 0/56\nfrom the time the first documents were uploaded (1.6.2017) up until the date of this\npublication. This means the attackers successfully bypass static analysis by most of the\nsecurity solutions.\n\nBy contrast, [Morphisec’s Moving Target Defense-based technology prevents the attack in its](https://www.morphisec.com/products/?__hstc=182053752.1b163c3a4dd03affa5bab3a75da22fc8.1578295878507.1583307015582.1583313278178.17&__hssc=182053752.70.1583313278178&__hsfp=3981430878)\nearly stages, before any channel to the attacker is opened.\n\n## TECHNICAL ANALYSIS\n\nBelow we describe the full technical details, beginning with the initial email through the final\nMeterpreter session used to hijack the computer.\n\n**PHISHING EMAIL:**\n\nAs seen in the email below, FIN7’s attack campaign targets restaurants. The content of the\nemail is well crafted to avoid suspicion. Some of the email attachments are called menu.rtf,\nothers Olive Garden.rtf or Chick Fil A Order.rtf (all the identified hashes are listed at the end).\n\n\n-----\n\n**WORD DELIVERY:**\n\nThe attached .rtf file uses OLE and has many similarities to previous FIN7 attacks. But this\nattack, instead of activating hta files (mshta.exe) from within the link, executes obfuscated\nJavaScript code. All the victim needs to do is double click on the envelope and press OK.\n\n\n-----\n\n**JAVASCRIPT CODE SNIPPETS:**\n\nThe first stage JavaScript copies additional JavaScript code snippets in txt format from the\nRTF document into a random directory “C:\\Users\\<User Name>\\<Random guid>\\”. The same\ncode snippets are combined into a second stage JavaScript in “C:\\Users\\<User Name>\\”.\nAdditionally, the first stage JavaScript creates a scheduled task that executes the second\nstage code within a minute – this delayed execution helps to bypass behavior analysis since\nthe second stage is not directly executed by the first stage.\n\n**PERSISTENCY:**\n\nIn some cases, an additional scheduled task “AdobeFlashSync” is created for persistency.\nThis task is executed every 25 minutes and will repeat the actions described above –\nrecreating the JavaScript code which later will create and execute a PowerShell script\n(described below).\n\n**SECOND STAGE JAVASCRIPT INTO POWERSHELL:**\n\n\n-----\n\nThe second stage JavaScript creates a PowerShell file with the same name in the same\ndirectory. Afterwards, it deletes its own JavaScript code traces.\n\nThe PowerShell script executes a compressed first stage PowerShell child process, which\nthen performs a second stage PowerShell process. The latter PowerShell injects a shellcode\ninto its own process using well-known CreateThread and VirtualAlloc techniques:\n\n\n-----\n\n**SHELLCODE:**\n\n**The shellcode phase of this attack is unique and demonstrates the constantly**\n**advancing abilities of attackers. The shellcode is the primary differentiating technique**\n**between this campaign and past attacks by FIN7 and other threat actors.**\n\nThis shellcode iterates over process environment block and looks immediately for dnsapi.dll\nname (xor 13) and its DnsQueryA function. Basically, FIN7 implemented a shellcode that\ngets the next stage shellcode using the DNS messaging technique directly from memory.\nThis way they can successfully evade many of the behavior based solutions.\n\nIn the DNS query pattern, it is very clear to see that alphabetical modification of the\nsubdomain prefix is used:\n\n\n-----\n\nEach such DNS query results in an additional snippet of shellcode being appended to a\nreallocated buffer. When, finally, the first stage shellcode receives a special “FF” signal, it\nthen executes the delivered shellcode. (It takes a few minutes for the DNS queries to finish.\nThe last query is to the subdomain ihc[.]stage[.]12019683[.]ns2[.]true-deals[.]com):\n\nThe delivered second stage shellcode is encrypted:\n\n\n-----\n\n**METERPRETER:**\n\nAfter decryption of the second stage shellcode, the shellcode deletes the ‘MZ’ prefix from\nwithin a very important part of the shellcode. This prefix indicates it may be a dll, and its\ndeletion helps the attack to evade memory scanning solutions.\n\nJust before this step executed, we extracted the dll from memory and uploaded it to\nVirusTotal. If this dll was saved on disk, many security solutions would immediately identify it\nas a CobaltStrike Meterpreter, which is used by many attackers and pen testers. Having a\nMeterpreter session on a compromised computer allows for full control of the computer and\nexfiltration of any data, and in some cases lateral movement inside the organization.\n\n\n-----\n\n## CONCLUSIONS:\n\nFIN7 constantly upgrades their attacks and evasion techniques, thus becoming even more\ndangerous and unpredictable. The analysis of this attack shows, how easy it is for them to\nbypass static, dynamic and behavior based solutions. These attacks pose a severe risk to\nenterprises.\n\n[Fileless attacks are on the rise – Carbon Black reports that researchers found a 33% rise in](https://www.carbonblack.com/2016/12/15/carbon-black-threat-report-non-malware-attacks-ransomware-take-center-stage-2016/)\nsevere non-malware attacks in Q4 2016 compared to Q1. Defenders will see more attacks\non their businesses by hacker groups utilizing memory for evasion while keeping executable\nartifacts far away from disk.\n\n\n-----\n\nIn this continuously evolving threat landscape, enterprises need to look for new defenses\nthat are resilient to such changes and are able to prevent fileless attacks. Morphisec\n[Endpoint Threat Prevention specializes in preventing in-memory attacks, using Moving](https://www.morphisec.com/products/advanced-endpoint-threat-protection)\nTarget Defense to make the target itself unpredictable.\n\n## ARTIFACTS:\n\n**Documents:**\n\n2781526f6b302da00661b9a6a625a5a6ecf4ffccafa61202e9b0e9b61b657867\n\nc357396ca82fdcd6b6f46b748f2b6941051dbc81be5326cf9548e6e95507af7c\n\nffebcc4d2e851baecd89bf11103e3c9de86f428fdeaf0f8b33d9ea6f5ef56685\n\n**Domains:**\n\ntrue-deals[.]com; strikes-withlucky[.]com\nEmail account in registration is: isvarawski@yahoo.com\nAttacker email account: adrian.1987clark@yahoo.com\n\n[Contact SalesInquire via Azure](http://10.10.0.46/mailto:sales@morphisec.com)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-06-09 - FIN7 Takes Another Bite at the Restaurant Industry.pdf"
    ],
    "report_names": [
        "2017-06-09 - FIN7 Takes Another Bite at the Restaurant Industry.pdf"
    ],
    "threat_actors": [
        {
            "id": "c9617bb6-45c8-495e-9759-2177e61a8e91",
            "created_at": "2022-10-25T15:50:23.405039Z",
            "updated_at": "2025-03-27T02:00:55.462193Z",
            "deleted_at": null,
            "main_name": "Carbanak",
            "aliases": [
                "Carbanak",
                "Anunak"
            ],
            "source_name": "MITRE:Carbanak",
            "tools": [
                "Carbanak",
                "Mimikatz",
                "PsExec",
                "netsh"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "bfded1cf-be73-44f9-a391-0751c9996f9a",
            "created_at": "2022-10-25T15:50:23.337107Z",
            "updated_at": "2025-03-27T02:00:55.445946Z",
            "deleted_at": null,
            "main_name": "FIN7",
            "aliases": [
                "FIN7",
                "GOLD NIAGARA",
                "ITG14",
                "Carbon Spider",
                "ELBRUS",
                "Sangria Tempest"
            ],
            "source_name": "MITRE:FIN7",
            "tools": [
                "Mimikatz",
                "AdFind",
                "JSS Loader",
                "HALFBAKED",
                "REvil",
                "PowerSploit",
                "CrackMapExec",
                "Carbanak",
                "Pillowmint",
                "Cobalt Strike",
                "POWERSOURCE",
                "RDFSNIFFER",
                "SQLRat",
                "Lizar",
                "TEXTMATE",
                "BOOSTWRITE"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "f4f16213-7a22-4527-aecb-b964c64c2c46",
            "created_at": "2024-06-19T02:03:08.090932Z",
            "updated_at": "2025-03-27T02:05:17.387119Z",
            "deleted_at": null,
            "main_name": "GOLD NIAGARA",
            "aliases": [
                "Carbanak",
                "Carbon Spider ",
                "FIN7 ",
                "Navigator ",
                "Sangria Tempest ",
                "TelePort Crew ",
                "Calcium "
            ],
            "source_name": "Secureworks:GOLD NIAGARA",
            "tools": [
                " Carbanak",
                " Cobalt Strike",
                " DICELOADER",
                " DRIFTPIN",
                " GGLDR",
                " GRIFFON",
                " JSSLoader",
                " Meterpreter",
                " OFFTRACK",
                " PILLOWMINT",
                " POWERTRASH",
                " SUPERSOFT",
                " TAKEOUT",
                " TinyMet",
                "Bateleur"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "bb8702c5-52ac-4359-8409-998a7cc3eeaf",
            "created_at": "2023-01-06T13:46:38.405479Z",
            "updated_at": "2025-03-27T02:00:02.82533Z",
            "deleted_at": null,
            "main_name": "FIN7",
            "aliases": [
                "JokerStash",
                "ATK32",
                "G0046",
                "Coreid",
                "Carbanak",
                "Sangria Tempest",
                "CARBON SPIDER",
                "GOLD NIAGARA",
                "G0008",
                "ELBRUS",
                "Carbon Spider"
            ],
            "source_name": "MISPGALAXY:FIN7",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d85adfe3-e1c3-40b0-b8bb-d1bacadc4d82",
            "created_at": "2022-10-25T16:07:23.619566Z",
            "updated_at": "2025-03-27T02:02:09.890982Z",
            "deleted_at": null,
            "main_name": "FIN7",
            "aliases": [
                "APT-C-11",
                "ATK 32",
                "Gold Niagara",
                "ITG14",
                "TAG-CR1"
            ],
            "source_name": "ETDA:FIN7",
            "tools": [
                "7Logger",
                "Agentemis",
                "Anunak",
                "Astra",
                "BIOLOAD",
                "BIRDWATCH",
                "Bateleur",
                "Boostwrite",
                "CROWVIEW",
                "Carbanak",
                "Cobalt Strike",
                "CobaltStrike",
                "DICELOADER",
                "DNSMessenger",
                "FOWLGAZE",
                "HALFBAKED",
                "JSSLoader",
                "KillACK",
                "LOADOUT",
                "Lizar",
                "Meterpreter",
                "Mimikatz",
                "POWERPLANT",
                "POWERSOURCE",
                "RDFSNIFFER",
                "SQLRAT",
                "Sekur",
                "Sekur RAT",
                "TEXTMATE",
                "Tirion",
                "VB Flash",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "ed3810b7-141a-4ed0-8a01-6a972b80458d",
            "created_at": "2022-10-25T16:07:23.443259Z",
            "updated_at": "2025-03-27T02:02:09.801771Z",
            "deleted_at": null,
            "main_name": "Carbanak",
            "aliases": [
                "Anunak",
                "Carbanak",
                "Carbon Spider",
                "ELBRUS",
                "Gold Waterfall",
                "Sangria Tempest"
            ],
            "source_name": "ETDA:Carbanak",
            "tools": [
                "AVE_MARIA",
                "Agentemis",
                "AmmyyRAT",
                "Antak",
                "Anunak",
                "Ave Maria",
                "AveMariaRAT",
                "BABYMETAL",
                "BIRDDOG",
                "Backdoor Batel",
                "Batel",
                "Bateleur",
                "BlackMatter",
                "Boostwrite",
                "Cain & Abel",
                "Carbanak",
                "Cl0p",
                "Cobalt Strike",
                "CobaltStrike",
                "DNSMessenger",
                "DNSRat",
                "DNSbot",
                "DRIFTPIN",
                "DarkSide",
                "FOXGRABBER",
                "FlawedAmmyy",
                "HALFBAKED",
                "JS Flash",
                "KLRD",
                "MBR Eraser",
                "Mimikatz",
                "Nadrac",
                "Odinaff",
                "POWERPIPE",
                "POWERSOURCE",
                "PsExec",
                "SQLRAT",
                "Sekur",
                "Sekur RAT",
                "SocksBot",
                "SoftPerfect Network Scanner",
                "Spy.Agent.ORM",
                "TEXTMATE",
                "TeamViewer",
                "TiniMet",
                "TinyMet",
                "Toshliph",
                "VB Flash",
                "WARPRISM",
                "avemaria",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535765,
    "ts_updated_at": 1743041818,
    "ts_creation_date": 1653703038,
    "ts_modification_date": 1653703038,
    "files": {
        "pdf": "https://archive.orkl.eu/067c49a4554f7fafd28c93a733febf208e0c09c1.pdf",
        "text": "https://archive.orkl.eu/067c49a4554f7fafd28c93a733febf208e0c09c1.txt",
        "img": "https://archive.orkl.eu/067c49a4554f7fafd28c93a733febf208e0c09c1.jpg"
    }
}