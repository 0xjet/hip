{
    "id": "31126fc7-9002-4b44-ac33-0ebe90fd9220",
    "created_at": "2023-01-12T15:10:09.669791Z",
    "updated_at": "2025-03-27T02:06:14.146106Z",
    "deleted_at": null,
    "sha1_hash": "232dce329dbbfbac4fa1f4082cf1d240b676cd02",
    "title": "2017-11-10 - New Malware with Ties to SunOrcal Discovered",
    "authors": "",
    "file_creation_date": "2022-05-28T02:13:45Z",
    "file_modification_date": "2022-05-28T02:13:45Z",
    "file_size": 558764,
    "plain_text": "# New Malware with Ties to SunOrcal Discovered\n\n**[researchcenter.paloaltonetworks.com/2017/11/unit42-new-malware-with-ties-to-sunorcal-discovered/](https://researchcenter.paloaltonetworks.com/2017/11/unit42-new-malware-with-ties-to-sunorcal-discovered/)**\n\nJosh Grunzweig, Jen Miller-Osborn November 10, 2017\n\nBy [Josh Grunzweig and](https://unit42.paloaltonetworks.com/author/joshgruznweig/) [Jen Miller-Osborn](https://unit42.paloaltonetworks.com/author/jen-miller-osborn/)\n\nNovember 10, 2017 at 1:00 PM\n\n[Category: Unit 42](https://unit42.paloaltonetworks.com/category/unit42/)\n\nTags: [Reaver,](https://unit42.paloaltonetworks.com/tag/reaver/) [SunOrcal](https://unit42.paloaltonetworks.com/tag/sunorcal/)\n\nSummary\n\nUnit 42 has discovered a new malware family we’ve named “Reaver” with ties to attackers\n[who use SunOrcal malware. SunOrcal activity has been documented to at least 2013, and](http://pwc.blogs.com/cyber_security_updates/2016/03/index.html)\nbased on metadata surrounding some of the C2s, may have been active as early as 2010.\nThe new family appears to have been in the wild since late 2016 and to date we have only\nidentified 10 unique samples, indicating it may be sparingly used. Reaver is also somewhat\nunique in the fact that its final payload is in the form of a Control panel item, or CPL file. To\ndate, only 0.006% of all malware seen by Palo Alto Networks employs this technique,\nindicating that it is in fact fairly rare.\n\nWhile we don’t have information on the intended targets in this case, previous reports on this\nactivity have identified targeting primarily among the “Five Poisons” which are movements\nthe Chinese government perceives as dangerous. They are:\n\nUyghurs, particularly those supporting East Turkestan independence\nTibetans, particularly those supportive of Tibetan independence\n\n\n-----\n\nFalun Gong practitioners\nSupporters of Taiwan independence\nSupporters of Chinese democracy\n\nThe attackers used both families concurrently from late last year through November 2017\nand there is some C2 infrastructure overlap between the two families, as well as links to\nhistorical reporting. We explore those ties and provide an in-depth analysis of the new\nmalware below.\n\nReaver Malware Analysis\nTo date, Palo Alto Networks Unit 42 has identified 10 unique samples and three distinct\nvariants of a new malware family we have named “Reaver”. As such, we identify each variant\nas Reaver.v1, Reaver.v2, and Reaver.v3.\nReaver.v1 has been observed delivering a payload that uses HTTP for network\ncommunication, while versions 2 and 3 use a payload that uses raw TCP connections for this\ncommunication.\nThe flow for Reaver is as shown:\n\n_Figure 1 Reaver execution flow diagram_\n\n\n-----\n\nReaver.v1\nThe earliest variant of Reaver begins by attempting to enable the SeDebugPrivilege privilege\nfor the running process. In the event this is successful the malware will use the following path\nto store any dropped files:\n\n%COMMONPROGRAMFILES%\\services\\\n\nIn the event it is not successful, this alternative path will be used instead:\n\n%APPDATA%\\microsoft\\mmc\\\n\nIt proceeds to load and decrypt and embedded bitmap resource file. This decrypted data is\nwritten to the following location:\n\n%TEMP%\\WUpdate.~tmp\n\nThis ‘WUpdate.~tmp’ file is then copied to a filename of ‘Applet.cpl’, which is placed in the\npreviously identified file path.\nThe malware proceeds to identify the file path of either the common startup folder, or the\nuser’s startup folder depending on if the SeDebugPrivilege privilege was obtained. In the\nevent this privilege was obtained, the common startup folder is queried by reading the\nfollowing registry key:\n\nHKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Shell Folders\\Common\nStartup\n\nAlternatively, if the privilege was unable to be obtained, Reaver.v2 will obtain the user’s\nstartup folder by querying the following registry key:\n\nHKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Shell Folders\\Startup\n\nReaver proceeds to write a shortcut file to ‘%TEMP%\\~WUpdate.lnk’. This file is then copied\nto a filename of ‘Windows Update.lnk’, which is placed in the startup path previously\nidentified. This shortcut file points to the path of the previously written ‘Applet.cpl’ file. Finally,\nReaver.v1 will execute the ‘~WUpdate.lnk’ file in a new process, thus loading the recently\ndropped malicious CPL file.\n\nReaver.v2\nReaver.v2 begins by attempting to enable the SeDebugPrivilege privilege for the running\nprocess. In the event this is successful, the malware will use the following path to store any\ndropped files:\n\n%COMMONPROGRAMFILES%\\services\\\n\nIn the event it is not successful, this alternative path will be used instead:\n\n%APPDATA%\\microsoft\\mmc\\\n\n\n-----\n\nReaver.v2 proceeds to decrypt an embedded file using a simple XOR obfuscation routine.\nThis file is written to the following file path:\n\n% TEMP%\\Update.~tmp\n\nAfter the file is written, it is then copied to a filename of ’winhelp.cpl’ in the directory that was\ninitially chosen. After this file is copied, the original ‘Update.~tmp’ file is deleted. At this stage\nthe malware will identify the correct startup path using the same technique witnessed in\nearlier variants.\nA shortcut file is generated in the following path:\n\n%TEMP%\\~Update.lnk\n\nThis ‘~Update.lnk’ file is then copied to a filename of ‘Windows help.lnk’, which is placed in\nthe startup path previously identified. This shortcut file points to the path of the previously\nwritten ‘winhelp.cpl’ file. It will specifically load this CPL file via a call to the built-in Microsoft\nWindows ‘control.exe’ utility. Finally, Reaver.v2 will execute the ‘~Update.lnk’ file in a new\nprocess, thus loading the recently dropped malicious CPL file.\n\nReaver.v3\nLike Reaver.v2, Reaver.v3 begins by attempting to enable the SeDebugPrivilege privilege for\nthe running process. In the event this is successful, the malware will use the following path to\nstore any dropped files:\n\n%COMMONPROGRAMFILES%\\services\\\n\nIn the event it is not successful, this alternative path will be used instead:\n\n%APPDATA%\\microsoft\\credentials\\\n\nReaver.v3 proceeds to write an embedded Microsoft Cabinet (CAB) file to the following\nlocation:\n\n%TEMP%\\winhelp.dat\n\nThis cabinet file is then extracted to the previously identified file path. The contents of this\ncabinet file consist of a Microsoft Control Panel item with a filename of ‘winhelp.cpl’.\nMuch like the previous version of Reaver, Reaver.v3 will query the necessary registry keys to\ndetermine the correct startup path to use. Again, a shortcut file is written to the %TEMP%\npath with a name of ‘~Update.lnk’, which is in turn copied to the identified startup path with a\nfilename of ‘Windows help.lnk’. This shortcut file calls the built-in ‘control.exe’ utility to in turn\nload the previously dropped malicious CPL file of ‘winhelp.cpl’.\nFinally, the malware calls the ‘winhelp.cpl’ file in a new process via the following command:\n\ncontrol [path_previously_identified]\\winhelp.cpl\n\n\n-----\n\nReaver HTTP Payload\nThe malicious CPL payload of Reaver has the following two exported functions:\n\nCPlApplet\nDllEntryPoint\n\nWhen the CPlApplet function is loaded, Reaver will initially determine if the\nSeDebugPrivilege privilege is able to be obtained. The malware proceeds to decrypt and\nembedded configuration of 128 bytes using a simple XOR routine. The following example\ndecrypted configuration is as follows:\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n00000000: 77 77 77 2E 74 61 73 68 64 71 64 78 70 2E 63 6F www.tashdqdxp.co\n00000010: 6D 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 m...............\n00000020: 38 30 00 00 00 00 00 00 00 00 00 00 00 00 00 00 80..............\n00000030: 33 30 00 00 00 00 00 00 00 00 00 00 00 00 00 00 30..............\n00000040: 57 69 6E 64 6F 77 73 20 55 70 64 61 74 65 00 00 Windows Update..\n00000050: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\n00000060: 41 70 70 6C 65 74 00 00 00 00 00 00 00 00 00 00 Applet..........\n00000070: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\n\n\nAs we can see, the following information is present within this configuration:\n\nRemote Command and Control (C2) server\nRemote port\nSleep timer\n\nReaver continues to collect various information from the victim machine, including the\nfollowing:\n\nCPU speed\nComputer name\nUsername\nIP Address\nMicrosoft Windows version\nPhysical and virtual memory information\n\nThe malware proceeds to communicate with the remote server via HTTP GET and POST\nrequests. Data that is sent is compressed and then base64-encoded before being included in\nthe requests.\nWe have observed the following capabilities of this payload:\n\nGet drive information\nRead files\nWrite files\nDelete files\n\n\n-----\n\nMove files\nSpawn processes\nCreate directories\n\nReaver TCP Payload\nThe malicious CPL payload of Reaver has the following three exported functions:\n\nServiceMain\nCPlApplet\nDllEntryPoint\n\nWhen the malware is initially loaded, DllEntryPoint will be called, which in turn will call a\nfunction that is responsible for decompressing a blob of data. The decompressed data\nconsists of various key/value pairings that represent important strings used by Reaver. An\nexample of this decompressed data can be seen below:\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nRA@10001=ole32.dll\nRA@10002=CoCreateGuid\nRA@10003=Shlwapi.dll\nRA@10004=SHDeleteKeyA\nRA@10005=wininet.dll\nRA@10006=InternetOpenA\n\n[TRUNCATED]\nRA@10288=%s\\%s\nRA@10289=CMD.EXE\nRA@10290=%s=\nRA@10311=\\%sctr.dll\nRA@10312=\\uc.dat\nRA@10313=ChangeServiceConfig2A\nRA@10314=QueryServiceConfig2A\n\n\nWhen the malware wishes to retrieve one of these decoded strings, it will simply call a\nfunction with an integer argument that is responsible for providing it. For example, calling this\nfunction with an argument of ‘10001’ would retrieve a string of ‘ole32.dll’.\nThe DllEntryPoint function proceeds to attempt to obtain the SeDebugPrivilege privilege, and\nalso calls WSAStartup for future network activity.\nWhen the CPlApplet function is loaded, it will begin by decompressing an embedded\nconfiguration using the same compression algorithm used previously. An example of this\ndecompressed configuration may be seen below:\n\n\n-----\n\n_Figure 2 Decompressed Reaver configuration_\n\nThis configuration contains multiple pieces of information, including the following:\n\nNetwork port\nSleep timer between network requests\nRemote Command and Control (C2)\nService Name\nService Description\nService Display Name\nHardcoded String. This may be either a campaign identifier, or perhaps a malware\nversioning string.\n\nThe malware proceeds to check to see if the original dropped malware file exists. In the\nevent it does, Reaver will move this file to ‘%TEMP%\\~FJIOW.tmp’ and delete this new file.\nThis simply acts as cleanup to ensure original file artifacts no longer reside on the infected\nmachine. Reaver will then install itself as a service in the event it is running with\nSeDebugPrivilege privileges. The service is configured with a name, description, and display\nname that is provided within the configuration.\n\nReaver continues to collect various information from the victim machine, including the\nfollowing:\n\nComputer name\nVolume serial number\nMicrosoft Windows version\nCPU speed\nANSI code page\nOEM code page identifier for the operating system\n\n\n-----\n\nPhysical and virtual memory information\n\nReaver encrypts this data using an incremental XOR key and uploads it to the configured\nremote server on the port specified. The following example Python code shows how this\nencryption takes place:\n\n\n1\n2\n3\n4\n5\n\n\nc = 0\nout = \"\"\nfor d in data:\nout += chr((ord(d) ^ ((c % 256) + 92)) & 0xFF)\nc += 1\n\n\nAfter this data is exfiltrated, the malware expects 8 bytes of data that contains two DWORDs.\nThese DWORDs contain both a major command and a sub-command.\nThe following capabilities have been observed in this payload:\n\nGet drive information\nModify files\nModify directories\nModify registry\nSpawn process\nTerminate process\nModify services\nKill self\n\nTies to SunOrcal\nReaver was used concurrently with SunOrcal over the past year, to include two Reaver\nsamples dropped from zip files hosted on a domain also being used as a SunOrcal C2\n(www.fyoutside[.]com), and there is also passive DNS overlap amongst the C2s. Specifically,\nReaver to date has used www.tashdqdxp[.]com for C2, which overlaps with\nwww.weryhstui[.]com, another C2 used by SunOrcal samples during the same timeframe.\nBoth domains have resolved to 98.126.156[.]210. Several of those same SunOrcal samples\nwere also using www.fyoutside[.]com as an additional C2. This led to further C2 ties within\nSunOrcal samples, to include samples beaconing to www.olinaodi[.]com; all of this is shown\n[below in Figure 3. The latter has been previously reported in activity targeting Hong Kong](https://citizenlab.ca/2016/04/between-hong-kong-and-burma/)\n[democracy activists and that activity is in turn tied to a report targeting Tibetan, Hong Kong,](https://www.arbornetworks.com/blog/asert/wp-content/uploads/2016/04/ASERT-Threat-Intelligence-Report-2016-03-The-Four-Element-Sword-Engagement.pdf)\n[and Taiwanese activists, and another blog about targeting Taiwanese activists.](http://pwc.blogs.com/cyber_security_updates/2016/03/index.html)\n\n\n-----\n\n_Figure 3. Chart showing overlaps between Reaver and SunOrcal. All IOCs are in the_\n_appendix at the end of this blog._\n\nConclusion\n\nThe attackers behind SunOrcal, whose activity dates to at least 2013 and possibly 2010,\nremain active and are still developing new custom malware to use against their targets. The\nnew malware, Reaver, appears to have been in the wild since late 2016 with less than a\ndozen known samples, among which there are three variants. It is also unique in the fact that\nits final payload is in a CPL file, a technique which Palo Alto Networks has seen with only\n0.006% of all malware samples we have analyzed. The attackers used both families\nconcurrently from late last year through November 2017 and there is some C2 infrastructure\noverlap between the two families, as well as links to historical reporting. We will continue to\nmonitor these attackers for new activity and report as appropriate.\n\nPalo Alto Networks customers are protected by the following:\n\nWildfire and Traps identifies both malware families as malicious.\nThe C2 domains are blocked via Threat Prevention.\n\n**Appendix**\n\n**SHA2556 – Reaver.v1**\n\nd560f44188fb56d3abb11d9508e1167329470de19b811163eb1167534722e666\n\n\n-----\n\n**SHA2556 – Reaver.v2**\n98eb5465c6330b9b49df2e7c9ad0b1164aa5b35423d9e80495a178eb510cdc1c\n05ddbd0506ec95fb460b3994e5b21cdb0418ba4aa406374ca1b91249349b7640\n\n**SHA2556 – Reaver.v3**\n18ac3b14300ecfeed4b64a844c16dccb06b0e3513d0954d6c6182f2ea14e4c92\nc0f8bb77284b96e07cab1c3fab8800b1bbd030720c74628c4ee5666694ef903d\n9213f70bce491991c4cbbbd7dc3e67d3a3d535b965d7064973b35c50f265e59b\n26c234c73e2c3448589c7d4a0cf17f615ad3666541a4e611e2d8b77637205bcf\nae9f158e4886cfdbfb4f1b3b25707d05f6fd873d0be9d8e7334a2c28741228ee\n1fcda755e8fa23d27329e4bc0443a82e1c1e9a6c1691639db256a187365e4db1\nc906250e0a4c457663e37119ebe1efa1e4b97eef1d975f383ac3243f9f09908c\n1813f10bcf74beb582c824c64fff63cb150d178bef93af81d875ca84214307a1\n\n**SHA256 – SunOrcal**\n799139b5278dc2ac24279cc6c3db44f4ef0ea78ee7b721b0ace38fd8018c51ac\n81d887fefdbb0219647991c2b7bddf45c2fede4dc6fc18408f1706e0279615b2\n58312fb742ce881e040e1b5b8555f00a402b8dd4fc886acaae2f862040b3bfc5\n38ea33dab0ba2edd16ecd98cba161c550d1036b253c8666c4110d198948329fb\ncb7c0cf1750baaa11783e93369230ee666b9f3da7298e4d1bb9a07af6a439f2f\n\n**C2 domains and IP addresses**\nwww.tashdqdxp[.]com\nwww.weryhstui[.]com\nwww.fyoutside[.]com\n\nwww.olinaodi[.]com\n104.148.70[.]217\n98.126.156[.]210\n\n**Get updates from**\n**Palo Alto**\n**Networks!**\n\nSign up to receive the latest news, cyber threat intelligence and research from us\n\n[By submitting this form, you agree to our Terms of Use and acknowledge our Privacy](https://www.paloaltonetworks.com/legal-notices/terms-of-use)\nStatement.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-11-10 - New Malware with Ties to SunOrcal Discovered.pdf"
    ],
    "report_names": [
        "2017-11-10 - New Malware with Ties to SunOrcal Discovered.pdf"
    ],
    "threat_actors": [
        {
            "id": "870f6f62-84f5-48ca-a18e-cf2902cd6924",
            "created_at": "2022-10-25T15:50:23.303818Z",
            "updated_at": "2025-03-27T02:00:55.435309Z",
            "deleted_at": null,
            "main_name": "APT32",
            "aliases": [
                "APT32",
                "SeaLotus",
                "OceanLotus",
                "APT-C-00",
                "Canvas Cyclone"
            ],
            "source_name": "MITRE:APT32",
            "tools": [
                "Mimikatz",
                "ipconfig",
                "Kerrdown",
                "Cobalt Strike",
                "SOUNDBITE",
                "OSX_OCEANLOTUS.D",
                "KOMPROGO",
                "netsh",
                "RotaJakiro",
                "PHOREAL",
                "Arp",
                "Denis",
                "Goopy"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "af509bbb-8d18-4903-a9bd-9e94099c6b30",
            "created_at": "2023-01-06T13:46:38.585525Z",
            "updated_at": "2025-03-27T02:00:02.866727Z",
            "deleted_at": null,
            "main_name": "APT32",
            "aliases": [
                "TIN WOODLAWN",
                "OceanLotus Group",
                "OceanLotus",
                "Sea Lotus",
                "G0050",
                "Cobalt Kitty",
                "SeaLotus",
                "ATK17",
                "Ocean Lotus",
                "Ocean Buffalo",
                "POND LOACH",
                "Canvas Cyclone",
                "APT-C-00",
                "APT-32",
                "APT 32"
            ],
            "source_name": "MISPGALAXY:APT32",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536209,
    "ts_updated_at": 1743041174,
    "ts_creation_date": 1653704025,
    "ts_modification_date": 1653704025,
    "files": {
        "pdf": "https://archive.orkl.eu/232dce329dbbfbac4fa1f4082cf1d240b676cd02.pdf",
        "text": "https://archive.orkl.eu/232dce329dbbfbac4fa1f4082cf1d240b676cd02.txt",
        "img": "https://archive.orkl.eu/232dce329dbbfbac4fa1f4082cf1d240b676cd02.jpg"
    }
}