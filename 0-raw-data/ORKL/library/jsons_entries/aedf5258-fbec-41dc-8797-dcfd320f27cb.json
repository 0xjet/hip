{
    "id": "aedf5258-fbec-41dc-8797-dcfd320f27cb",
    "created_at": "2023-01-12T15:07:13.201165Z",
    "updated_at": "2025-03-27T02:05:49.321427Z",
    "deleted_at": null,
    "sha1_hash": "4c3515f8b357f4ffdcb324585c81dc6b684443da",
    "title": "2018-02-15 - Olympic Destroyer",
    "authors": "",
    "file_creation_date": "2022-05-29T10:34:18Z",
    "file_modification_date": "2022-05-29T10:34:18Z",
    "file_size": 1568615,
    "plain_text": "# Olympic Destroyerの内部構造を紐解く\n\n**mbsd.jp/blog/20180215.html**\n\n2018.02.15\nコンサルティングサービス事業本部\n\nサイバーレジリエンス事業部\n\nサイバーインテリジェンスグループ\n\n吉川 孝志、菅原 圭\n\n2月8日から韓国で開催されている平昌オリンピックが日々世間を賑わせているさなか、平昌\nオリンピックを狙ったサイバー攻撃に関する情報が水面下で流れています。\n\n2月9日頃から平昌オリンピック組織委員会の内部でシステムトラブルが発生していた問題\nで、2月11日になり平昌オリンピック組織委員会から一連の障害はサイバー攻撃によるもの\nと明らかにされました。\n\nまた、CiscoのTalosはこの攻撃に用いられたとみられるマルウェア「Olympic Destroyer」\n（オリンピック・デストロイヤー）に関する情報を公開しました（※1）。（なお、Talosは\n公開時点で当該情報を中程度の信頼度としています）\n\n(※１：Olympic Destroyer Takes Aim At Winter Olympics：http://blog.talosintelligence.com/2018/02/olympicdestroyer.html)\n\n我々は「Olympic Destroyer」とされている検体の一つを入手し、独自に解析を進めた結\n果、調査時点で新たにいくらかの興味深い解析結果が見えてきたため、以下にマルウェアの\n全体像と共にまとめて共有します。\n\n## 「Olympic Destroyer」の構成図\n\nOlympic Destroyerの本体は実行形式（EXE）ファイルであり、自身の内部（リソースセク\nション）に５つの難読化されたファイルを保有しています。これらのファイルはそれぞれ目\n的をもったEXEファイルであり、必要に応じて復号・使用されます。\n\n\n-----\n\n図１ Olympic Destroyerの構成図\n\nリソースファイルの一部には、昨年度話題となった「NotPetya」と同様に、正規プログラム\nである「PsExec」を横展開時に利用するために難読化して保有しています。\n\n\n-----\n\n図2 リソースセクションに埋め込まれているPsExec\n\n## 「Olympic Destroyer」の挙動\n\nOlympic Destroyerは、実行されると、%temp%フォルダに以下のEXEファイルを作成しま\nす。\n\n%temp%\\<ランダムな文字列>.exe ・・・（１）パスワードダンプツール①（ログイン\n情報用）\n%temp%\\<ランダムな文字列>.exe ・・・（２）パスワードダンプツール②（ブラウザ\n情報等用）\n%temp%\\<ランダムな文字列>.exe ・・・（３）PsExec（正規プログラム／リモート\n実行ツール）\n%temp%\\<ランダムな文字列>.exe ・・・（４）ワーム活動・証拠隠滅・障害活動\n\nまず（１）と（２）のEXEファイルを実行することで、OSのログイン情報および、ブラウ\nザの保存情報などの各種ログイン情報・パスワード情報を取得します。\n\n\n-----\n\n次に、（３）と（４）のEXEファイルを利用してネットワークを介したワーム活動と破壊活\n動を行います。具体的には、GetIPNetTableによりARPテーブル情報を取得し、WMI\n（”SELECT ds_cn FROM ds_computer”クエリ）を利用して得られた端末一覧情報を取得、\nそれらの宛先に対し、自身が上記でドロップしたPsExecを利用することでリモート先への\n自身のコピー及びリモート実行を行う事で横展開（ワーム活動）を行います。その際上記で\n摂取したログイン情報を横展開のアクセス試行に利用します。\n\n（４）のEXEファイルは横展開の動作を終えると、以下の証拠隠滅および破壊活動に関わる\n動作を行います。\n\nボリュームシャドーコピー（システムの復元）の削除\nシステムバックアップの削除（wbadminによる）\nOSのスタートアップ修復の無効化\nイベントログ（SYSTEMおよびSECURITY）の削除\n全てのサービスの無効化\nファイル共有されているファイルの一部を0で上書き破壊\n\nこれらの破壊動作を行った後、強制的に端末をシャットダウンします。\n\n図３ 破壊活動に関連した処理を行うコード領域\n\n\n-----\n\n図４ 全てのサービスを停止させる挙動\n\n以下は、ファイル共有されているファイルを上書きする処理ですが、先頭から一部だけ上書\nきすることでファイルヘッダを破壊しつつ書き込みサイズを抑え効率的にファイルを破損さ\nせていきます。ファイルを破壊する際、ファイルの内容を事前に読み込む処理がないため、\n復元を予定した暗号化等の処理ではなく単純な破壊目的であることがわかります。\n\n図５ ファイルを一部のサイズだけ０で上書きする処理\n\n一方Olympic Destroyer本体は、上記（４）のEXEファイルの動作と並行して自身の隠蔽\n（消滅）を行います。具体的には、正規プログラムである「notepad.exe」を隠し状態で起\n動しWriteProcessMemoryによりコードインジェクションを実施、CreateRemoteThreadで\n「notepad.exe」内に書き込まれたコードを実行します。そのコードにより、Olympic\nDestroyerの本体が削除されます。（なおその際、Olympic Destroyerの本体は意味のないデ\nータで内容を上書きされた上で削除されます。これには、フォレンジックを困難にさせる目\n的があると推測されます。）その後、notepad.exeは終了します。\n\n\n-----\n\n図6 notepad.exeにインジェクションされたコードが本体を削除する部分\n\nOlympic Destroyerの主な挙動は以上であり比較的シンプルなものとなっています。\n\n摂取した情報をC&Cサーバ等へ流出させる動作やバックドアに類似するような挙動などは持\nち合わせていません。また、明確な破壊活動と容易に判断できるようなMBRの破壊や大量\nファイルの暗号化等の挙動なども持ちません。これらのことから、あくまで感染したコンピ\nューターに「システム障害」が発生したと思わせ被害者側を混乱させる目的等があったと推\n測することができます。\n\nなお一連の感染が行われた後、コンピューターは起動させると以下のようにOSの起動画面\nとブルースクリーンが繰り返し表示され正常に使用することが困難となることを確認してい\nます。\n\n図７ Olympic Destroyerに感染しシャットダウンした後のPCの起動様子（Windows7 x86\n\n\n-----\n\n環境）\n\n## 解析で見えた注目すべきポイント１（管理者権限で実行される前提の作 りと侵入経路）\n\nOlympic Destroyerは、LSASSからの認証情報窃取やvssadmin等を利用した破壊活動の挙動\nがありますが、これらの操作の一部は管理者権限でないと実行することができません。また\n一方で、実行された時点で自身のプロセスが管理者権限を持っていない場合UACを表示させ\nるなどの権限昇格を要求する挙動も見られません。つまり一般に確認されているOlympic\nDestroyerの検体ははじめから管理者権限で実行されることを前提とした作りになっている\nようにみえます。本記事執筆時点でOlympic Destroyerの侵入経路は明らかになっていませ\nんが、管理者権限での動作が前提となっていることを考慮すると、Olympic Destroyerには\n管理者権限を持ったさらに一段階上の階層となるドロッパー（親検体）がいたか、脆弱性を\n悪用した権限昇格による攻撃を用いた侵入経路が想定できます。ただし、管理者権限の実行\n権限がなくとも（権限がないことにより一部の処理に失敗しつつ）表面上はエラーなく一部\nの動作（保有しているパスワードを用いた横展開等）は継続できることから、完全に動作し\nないというわけではない点に注意が必要です。\n\n## 解析で見えた注目すべきポイント２（取得したログイン情報の自身への 埋め込みによる利用）\n\n現在一般に入手できるOlympic Destroyerの検体には、複数のログイン情報と思われる文字\n列がバイナリに直接埋め込まれており、その多くが「Pyeongchang2018」というドメイン\n名と思われる文字列を含んでいることがわかっています。\n\n\n-----\n\n図８ 埋め込まれたログイン情報の概念図\n\n図９ 「Pyeongchang2018」という文字列が多くみうけられるログイン情報\n\n我々の調査の結果、Olympic Destroyerは感染時に窃取したログイン情報（ユーザ名とパス\nワード）の文字列を自身のバイナリの中間領域に埋め込んでいく挙動があることを確認しま\nした。\n\n窃取情報の埋め込みがバイナリの末尾ではなく中間領域であることからファイルサイズは変\n化しないため、見逃してしまう可能性がある挙動の一つです。\n\n\n-----\n\n図１０ Olympic Destroyerが感染するたびにログイン情報を埋め込んでいく概念図\n\n以下は、実際に我々の検証環境で感染させた際の実行前後のOlympic Destroyerの差分結果\nですが、パスワードダンプツールにより摂取した情報を自身の内部に追記埋め込みしている\nことがわかります。\n\n\n-----\n\n図１１ Olympic Destroyerが感染するたびにログイン情報を埋め込んでいく実証図\n\nつまり、感染が広まっていくに従いマルウェアのバイナリに埋め込まれたログイン情報が増\nえていくことを意味します。この動作から、当初から一見ハードコーディングされたように\nみえた複数のログイン情報は全て感染を重ねることで窃取され蓄積されたものと推測するこ\nとができます。この推測が正しいとした場合、Olympic Destroyerのバイナリに埋め込まれ\nたログイン情報の数を確認することで、おおよそどの時点の拡散検体なのか、また、初期感\n染時の端末を追う手掛かりになるかもしれません。\n\n## その他の情報\n\n昨年度はWannaCry、NotPetya、BadRabbitなど世界的に混乱を招く大きなマルウェアイン\nシデントが発生しましたが、それらの検体を解析してきた観点でOlympic Destroyerを見て\nみると、BadRabbitおよびNotPetyaに類似する挙動が一部垣間みえます。\n\n例えば、以下は名前付きパイプによるプロセス間通信を用いた子プロセスとの連携に関わる\nコード部分の比較ですが、リソース領域から一時的に必要なEXEを%temp%に復号し、\nGUIDをパイプ名に利用した名前付きパイプによるプロセス間通信により必要な情報のみを\n取得して一時利用するといった処理の流れがほぼ同一です。その他にも、リソースセクショ\nンを用いた必要ファイルの格納および展開利用のテクニックや、PsExecを用いた横展開な\nどいくらか気になる類似点があります。\n\n\n-----\n\n図１２ NotPetya、BadRabbit、Olympic Destroyerのコード比較\n\n当然、挙動やコードを類似させようとして意図的に作り上げることは可能なため、これらを\nもって何かを断言できることではありませんが、興味深い調査結果の一つであるといえるで\nしょう。\n\n※本記事で使用した検体のハッシュ値は以下となります。\n\n**edb1ff2521fb4bf748111f92786d260d40407a2e8463dcd24bb09f908ee13eb9**\n\n吉川 孝志 [の他のブログ記事を読む](https://www.mbsd.jp/blog/yoshikawa_index.html)\n\n菅原 圭 [の他のブログ記事を読む](https://www.mbsd.jp/blog/sugawara_index.html)\n\n\n-----\n\nペ ジトップへ\n\n©2004-2020 Mitsui Bussan Secure Directions, Inc. All rights reserved.\n[ご利用条件 *](https://www.mbsd.jp/terms.html) [個人情報保護方針 *](https://www.mbsd.jp/privacy.html) [情報セキュリティ基本方針](https://www.mbsd.jp/security.html)\n\n\n-----",
    "language": "JA",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-02-15 - Olympic Destroyer.pdf"
    ],
    "report_names": [
        "2018-02-15 - Olympic Destroyer.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536033,
    "ts_updated_at": 1743041149,
    "ts_creation_date": 1653820458,
    "ts_modification_date": 1653820458,
    "files": {
        "pdf": "https://archive.orkl.eu/4c3515f8b357f4ffdcb324585c81dc6b684443da.pdf",
        "text": "https://archive.orkl.eu/4c3515f8b357f4ffdcb324585c81dc6b684443da.txt",
        "img": "https://archive.orkl.eu/4c3515f8b357f4ffdcb324585c81dc6b684443da.jpg"
    }
}