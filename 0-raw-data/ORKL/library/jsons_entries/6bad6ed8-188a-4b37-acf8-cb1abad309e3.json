{
    "id": "6bad6ed8-188a-4b37-acf8-cb1abad309e3",
    "created_at": "2022-10-25T16:48:16.732949Z",
    "updated_at": "2025-03-27T02:15:46.112547Z",
    "deleted_at": null,
    "sha1_hash": "5b6bccee4b358c195ea7d80c118d6e9a793f3ed7",
    "title": "",
    "authors": "",
    "file_creation_date": "2019-09-06T02:24:21Z",
    "file_modification_date": "2019-09-06T02:24:21Z",
    "file_size": 1302426,
    "plain_text": "# UPSynergy: Chinese-American Spy vs. Spy Story\n\n**research.checkpoint.com/upsynergy**\n\nSeptember 5, 2019\nResearch By: Mark Lechtik & Nadav Grossman\n\n**Introduction**\n\n\nSeptember 5, 2019\n\n\n[Earlier this year, our colleagues at Symantec uncovered an interesting story about the use of](https://www.symantec.com/blogs/threat-intelligence/buckeye-windows-zero-day-exploit)\nEquation group exploitation tools by an alleged Chinese group named Buckeye (a.k.a APT3, or\nUPS team). One of the key findings in their publication was that variants of the Equation tools\nwere used by the group prior to ‘The Shadow Brokers’ public leak in 2017. Moreover, it seems\nthat APT3 developed its own in-house capabilities and equipped its attack tool with a 0-day that\ntargeted the Windows operating system.\n\nFollowing these revelations, we decided to expand on Symantec’s findings and take a deeper\nlook at Bemstour, the group’s exploitation tool. In our analysis, we try to understand the\nbackground environment in which it was created, and provide our perspective of how it was\ndeveloped. Our observations from the technical analysis allow us to provide evidence for a\nspeculation that was formerly suggested by Symantec – APT3 recreated its own version of an\nEquation group exploit using captured network traffic. We believe that this artifact was collected\nduring an attack conducted by the Equation group against a network monitored by APT3, allowing\nit to enhance its exploit arsenal with a fraction of the resources required to build the original tool.\n\nAPT3 is known to be a long-standing and sophisticated threat actor, having a record of using\nadvanced TTPs, such as leveraging zero day exploits in its attacks. Such capabilities are\n[consistent with former research by Intrusion Truth and Recorded Future, stating that the entity](https://intrusiontruth.wordpress.com/category/apt3/)\nbehind APT3 is the Chinese Ministry of State Security. That said, it wasn’t very clear so far\n\n\n-----\n\nwhether the group developed its exploits in-house or acquired them elsewhere. In this publication\nwe deliver a glance into one possible modus operandi – the Chinese collect attack tools used\nagainst them, reverse engineer and reconstruct them to create equally strong digital weapons.\n\nFollowing is a summary of our key findings:\n\nThe group’s exploitation tool named Bemstour makes use of a variant of a single Equation\ngroup exploit. Our research shows that the particular equivalent to this exploit is\nEternalRomance. APT3 developed their own implementation, possibly based on their\nanalysis and understanding of EternalRomance’s leveraged vulnerability.\nThe group attempted to develop the exploit in a way that allowed it to target more Windows\nversions, similar to what was done in a parallel Equation group exploit named\nEternalSynergy. This required looking for an additional 0-day that provided them with a\nkernel information leak. All of this activity suggests that the group was not exposed to an\nactual NSA exploitation tool, as they would then not need to create another 0-day exploit.\nWe decided to name APT3’s bundle of exploits UPSynergy, since, much like in the case of\nEquation group, it combines 2 different exploits to expand the support to newer operating\nsystems.\nThe underlying SMB packets used throughout the tool execution were crafted manually by\nthe developers, rather than generated using a third party library. As a lot of these packets\nwere assigned with hardcoded and seemingly arbitrary data, as well as the existence of\nother unique hardcoded SMB artifacts, we can assume that the developers were trying to\nrecreate the exploit based on previously recorded traffic.\nIf network traffic was indeed used by the group as a reference, the traffic was likely\ncollected from a machine controlled by APT3. This means either a Chinese machine that\nwas targeted by the NSA and monitored by the group, or a machine compromised by the\ngroup beforehand on which foreign activity was noticed. We believe the former is more\nlikely, and in that case could be made possible by capturing lateral movement within a\nvictim network targeted by the Equation group.\nFinding a 0-day info leak, recreating the exploit based on the aforementioned vulnerability,\nand utilizing a lot of internal undocumented structures of SMB in the implants, implies that\nthere was a similar expertise with and analysis performed on SMB drivers (with an eye to\nexploiting them) on the Chinese side, roughly at the same time it was widely used by the\nNSA. This, to some extent, suggests a narrative where China and the US are engaged in a\ncyber arms race to develop new exploits.\n\nIn the following sections, we provide the technical basis for our conclusions, by taking a tour\nthrough the tool’s internals, its underlying exploit, and the implant’s nuts and bolts. We also dive\ndeeply into the root cause for the 0-day found by APT3. To the best of our knowledge, this hasn’t\nbeen described anywhere else.\n\n**Overview of the Bemstour Tool**\n\nBesmtour is a tool developed by APT3 to gain remote code execution on a victim’s machine using\nUPSynergy – a combination of an exploit based on EternalRomance and a 0-day found by the\ngroup itself. The goal is to deploy a payload on the victim’s machine which is injected to a running\nprocess using an implant. This implant is highly similar to the Equation group’s DoublePulsar.\n\nThe tool is meant to be run from a command line, and provides 2 modes of operation. In the first,\n\n\n-----\n\nThese functionalities are supported in both 32 and 64 bit versions. According to Symantec, the 64\nbit versions were leveraged solely for executing shell commands, mostly to generate new user\naccounts in the victims’ environments.\n\nFigure 1: The 2 modes of operation provided by Bemstour.\n\nOne thing we noted about Bemstour’s code is the way it generates and sends traffic to the\nvictim’s machine. In particular, we noticed that all packets are built manually, i.e. the developers\ncreated structs to represent the various SMB packets to send to the victim, and issued them over\nplain TCP sockets.\n\nFigure 2: An example of a manually constructed SMB header.\n\nAs part of the manual crafting of SMBs, the developers assigned them with values hardcoded in\nthe binary. Some of these reside within the data section in the form of custom structs, such as the\none depicted in the figure below. When such a hardcoded assignment is required, an allocated\nSMB and the hardcoded structure are issued as arguments to a specific function, which in turn\ntakes the custom struct’s field values and assigns them to the corresponding SMB fields.\n\nFigure 3: A custom structure containing fields to populate SMB headers with hardcoded values.\n\nWhen looking at a structure like this, it’s noteworthy that some of its fields represent unique\n[values that are generated per SMB connection. One such value is the UID, which can be](https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-cifs/a4a70059-d263-47e0-be65-1f773a9b08be)\ndeclared by the client and therefore could be chosen arbitrarily by Bemstour. In this case, there\nare multiple instances where this field is given hardcoded unique values in a particular range\n\n\n-----\n\nFigure 4: Instances of the custom hardcoded SMB header structure.\n\nWe found other hardcoded structures that are actually not used in any place in the code, but\nwhose values and order imply the field they represent. This suggests that these are header\nfragments that were left as residues in the binary from another source. An example of such\nstructs is shown below, where a numeric proximity can be seen to those UIDs that are used in the\ncode.\n\nFigure 5: Unused fragments of SMB header that are left in the binary.\n\nThere are additional hardcoded artifacts that may provide some insight into the tool’s nature For\n\n\n-----\n\nwe can speculate that the project was indeed about repurposing an SMB exploit to target ALL\n(or at least more) versions of Windows.\n\nFigure 6: PDB path hardcoded in the tool’s binary.\n\nFinally, more unused strings show something that looks like a concatenation of a computer name,\nuser name and perhaps domain name. It is unclear where they come from, but again, strengthens\nthe idea that this network entity was part of a referenced traffic capture.\n\nFigure 7: Unused strings that reveal a network entity.\n\n**Overview of the Eternal* Exploits**\n\nBefore we take a further look at the details of APT3’s exploit implementation, we need to\n[understand the various Eternal exploits that were incorporated into the Lost in Translation leak by](https://github.com/misterch0c/shadowbroker)\nThe Shadow Brokers. Back in 2017, when this leak was released, 4 Eternal exploits were\nuncovered: EternalBlue, EternalChampion, EternalRomance and EternalSynergy.\n\nBoth  and EternalRomance targeted mostly Windows 7 systems (as well as lower version of\nWindows NT where SMBv1 is located). One of the problems in adapting EternalRomance to\nhigher Windows versions was a patch introduced in Windows 8 which eliminated the possibility to\nuse an information leak vulnerability leveraged by it.\n\nTo deal with this problem, the Equation group came up with an upgraded version where the\nproblematic info leak was replaced with one that could be exploited on Windows 8. Essentially,\nthere was nothing new there, as the info leak exploit was already used in EternalChampion and\nother parts of EternalRomance remained the same. This new hybrid exploit was named\nEternalSynergy, suggesting the way it was built – a synergy of 2 exploits.\n\nWhen it comes to the exploit in the Bemstour tool, it is evident that there’s an attempt to leverage\nthe same vulnerability exploited by EternalRomance. At the same time, there is the use of a\nwhole new information leak exploit, which was in fact a 0-day found by APT3. As we will see in\nthe upcoming section, this particular information leak is quite robust and allowed the group to\nupgrade their version of EternalRomance to use in versions higher than Windows 7.\n\nIn this sense, APT3 crafted its own exploit from other exploits – a tactic very similar to one used\nby the Equation group. As this threat group also uses the name UPS team, we decided to name\ntheir version of the exploit bundle UPSynergy.\n\n**Root Cause Analysis of CVE 2019-0703**\n\nAccording to Microsoft, CVE-2019-0703 is “an information disclosure vulnerability [that] exists in\n_the way […] the Windows SMB Server handles certain requests. An authenticated attacker who_\n_successfully exploited this vulnerability could craft a special packet, which could lead to_\n_information disclosure from the server._\n\n\n-----\n\nOur analysis shows a slightly different picture. The vulnerability is in fact a logical bug related to\n[querying information from the Windows Named Pipes mechanism, and not a vulnerabilityin the](https://docs.microsoft.com/en-us/windows/desktop/ipc/named-pipes)\nSMB protocol nor its implementation. While it can be triggered using SMB, there are other ways\n[to leverage it, e.g. using the NtQueryInformationFile Windows API call that is unrelated to SMB.](https://docs.microsoft.com/en-us/windows-hardware/drivers/ddi/content/ntifs/nf-ntifs-ntqueryinformationfile)\n\nThe bug resides within npfs.sys (Name Pipe File System driver) in a function named\n_NpQueryInternalInfo. The latter is used to query named pipes and return a value called a file_\nreference number, which according to Microsoft “MUST be assigned by the file system and is\n_unique to the volume on which the file or directory is located.”_\n\nHowever, our analysis shows that the returned value is not a file reference number, but rather a\npointer to a kernel structure named CCB (Client Control Block). This is an undocumented struct\n[defined in npfs.sys, which has a partial definition (named NP_CCB) provided by the ReactOS](https://doxygen.reactos.org/d4/d30/drivers_2filesystems_2npfs_2npfs_8h_source.html)\nproject. Clearly, this is not the intended value to be returned in this case, and the leak of this\nstruct discloses useful information that can be leveraged by attackers.\n\nFigure 8: The leaked object is in fact a CCB struct, as evident from WinDbg.\n\nTo trigger this information disclosure vulnerability, a call with the following arguments is made to\n[the NtQueryInformationFile stub in ntdll.dll:](https://docs.microsoft.com/en-us/windows-hardware/drivers/ddi/content/ntifs/nf-ntifs-ntqueryinformationfile)\n\nFileHandle – Handle to a named pipe (for example “\\\\.\\pipe\\browser”).\n[FileInformationClass – FileInternalInformation (equals 0x6).](https://docs.microsoft.com/en-us/windows-hardware/drivers/ddi/content/ntifs/ns-ntifs-_file_internal_information)\n\nAfter this happens, we get the following call stack:\n\nFigure 9: Kernel mode call stack corresponding to an NtQueryInformationFile call from user\nmode.\n\nAs already mentioned, it is also possible to trigger this vulnerability via SMB, as was used by\nAPT3. The method was used to determine the bitness of the attacked operating system and\noverwrite (using a write primitive) a field in the leaked structure, which eventually provided the\ngroup with remote code execution.\n\nTo leverage the vulnerability, you must first establish an SMB connection to a named pipe on the\nvictim’s machine, as can be seen in the figure below.\n\n\n-----\n\nFigure 10: Network capture of SMB packets that demonstrates an establishment of a connection\nto the \\pipe\\browser named pipe (FID 0x4000).\n\nNext, it’s possible to query information about the opened pipe using the 0x32 SMB command\n[(SMB_COM_TRANSACTION2) and the 0x7 subcommand](https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-smb/714bb6fa-7fab-4dab-8ff8-8a01c273b9ce)\n[(TRANS2_QUERY_FILE_INFORMATION). The latter has a field named InformationLevel which](https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-smb/f4503a0b-f809-477f-8ef6-9633ee90d1cc)\n[describes the types of information that can be retrieved by the server.](https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-cifs/794afe2e-7c11-4a8c-b909-0a397966f6a9)\n\n[Furthermore, if the server declared a capability named Infolevel Passthru in its Negotiate](https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-smb/ab2aca37-6c9e-4505-baa9-9e2bc556c475)\n_Response field as a part of an earlier negotiation (a capability usually provided by default), more_\ntypes of information can be retrieved, namely ones that provide native file information on the\nserver. In this case, the former capability allows it to provide a code number named a Pass-thru\nInformation Level by the client, which maps directly to another Windows NT numerical value\n[called an Information Class on the server. This value corresponds to the FileInformationClass](https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-fscc/4718fc40-e539-4014-8e33-b675af74e3e1)\nparameter of the NtQueryInformationFile API, which specifies what type of file information to\nquery from a server destined file object.\n\nTo use one of the pass-thru Information Levels to request a corresponding Information Class for a\nfile on the server, it is sufficient to add the value 0x3e8 (SMB_INFO_PASSTHROUGH) to the\n[requested Information Class. As an example, if we take the FileInternalInformation Information](https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-fscc/7d796611-2fa5-41ac-8178-b6fea3a017b3)\nClass (which has the value 6) and want to get the corresponding Information Level, we just need\nto add the previously mentioned value to it, resulting in the value 0x3ee.\n\nIn our case, using this very same Information Level by placing it as a parameter of the\n[TRANS2_QUERY_FILE_INFORMATION subcommand, triggers the vulnerability by causing the](https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-cifs/0a96fae0-b183-42b6-92bd-e05b1d92f434)\n[invocation of the NtQueryInformationFile from the srv.sys driver (SMB driver). The latter in turn](https://docs.microsoft.com/en-us/windows-hardware/drivers/ddi/content/ntifs/nf-ntifs-ntqueryinformationfile)\ncalls the vulnerable NpQueryInternalInfo from npfs.sys, as depicted in the stack trace below.\n\nFigure 11: Kernel mode calls stack resulting from execution of the SMB transaction that triggers\nthe bug.\n\nConsequently, when we issue a Trans2 request to query for a file info using the previously\nmentioned Info Level, we get a CCB leaked pointer in the response.\n\nFigure 12: Wireshark’s view of triggering the vulnerability.\n\nTo examine the described root cause for the vulnerability from another angle, we can take a look\n\n\n-----\n\nFigure 13: Patch diff – The vulnerable code can be seen in the upper part.\n\nAs can be seen in the vulnerable code, the out_buffer argument returned to the caller and then to\nthe client contains a pointer to the ClientControlBlock (NP_CCB) argument instead of the file\nreference number. This is fixed in the patched code, where offsets 0xa0 and 0xa4 from\n_ClientControlBlock are written to the out_buffer instead, thus returning the actual intended file_\nreference number to the caller and client.\n\nAs mentioned previously, the information obtained from this info leak can give us the ability to\nexecute code on the victim machine, using another write primitive. To understand how this is\npossible, we need to take a closer look at the CCB structure. One of its members points to yet\nanother undocumented struct, which we will denote as ‘struct x’. This struct contains a pointer to a\nfunction that is called when the connection to the named pipe is terminated, which we’ll refer to as\nthe ‘pipe destructor function’.\n\nIn APT3’s implementation of the exploit, the HAL heap is written with both shellcode and a rogue\ninstance of ‘struct x’. The latter simply contains a pointer to the shellcode in the position of the\n‘pipe destructor function’. Therefore, when we use a write primitive and know the whereabouts of\nthe leaked CCB structure, we can overwrite its pointer to ‘struct x’ so that it points to the rogue\ninstance. After the connection is closed, the shellcode is triggered and the attacker can run\narbitrary code on the victim’s machine.\n\n**Comparison of UPSynergy and Eternal Romance Implementations**\n\nOne of the observations we made during our analysis of Bemstour was that its main exploit\ntargets only a particular vulnerability that overlaps with one used by the Equation group. This\nvulnerability is rooted in a type confusion bug leveraged in a similar fashion in the\nEternalRomance exploit, which was then reused together with other exploits in EternalSynergy.\n\nAs a result of this type confusion between SMB messages, the server considers an unrelated\nSMB message as part of an SMB Transaction of a different type, and activates the wrong type of\nSMB handler. This handler in turn shifts the Transaction struct’s pointer to the incoming data\nbuffer by the amount of data received in the SMB message. Because the pointer value was\nshifted by the wrong handler, data of further SMB messages (which are treated by the correct\n\n\n-----\n\nInstead of going through every detail of APT3 s exploit, the table below compares the underlying\ntechniques used by EternalRomance vs. those used by UPSynergy. Detailed information about\nthe bug (CVE-2017-0143) and how it was exploited in EternalRomance to gain a write-whatwhere and read-what-where primitives is explained very well by Microsoft in their analysis of\n[EternalSynergy.](https://msrc-blog.microsoft.com/2017/07/13/eternal-synergy-exploit-analysis/)\n\n\n**Ex‐**\n**ploita‐**\n**tion**\n**Tech‐**\n**nique**\n\n\n**EternalRomance** **APT3 Exploit (UPSynergy)**\n\n\nDeter‐\nmine the\nOS Type\n\n\nDetermined from the server’s session SetupAndX re‐\nsponse (part of a session negotiation), where the un‐\nderlying target OS is specified.\n\n\nSame technique.\n\n\nDeter‐\nmine the\nOS\nBitness\n\n\nUses a leaked pool header structure that contains\nparameters from which the OS architecture can be\ninferred.\n\n\nUses the address of the leaked\nCCB structure to infer the range\nin which it resides and the un‐\nderlying architecture.\n\n\nGroom‐\ning\nTech‐\nnique\n(Heap\nShap‐\ning)\n\n\nUses 2 types of allocations with different sizes,\nnamed “bride” and “groom.” Another technique is\nused for OS versions prior to Windows 7.\n\n\nUses “bride” allocations only,\nwith a different allocation size.\n\n\nLeaked\nObject\n\n\nLeaks a kernel object named Transaction (corre‐\nsponding to an SMB Transaction).\n\n\nLeaks a kernel object named\nCCB (Client Control Block).\n\n\nOOB\nWrite\nVulnera‐\nbility\n\n\nA result of a type confusion bug, as outlined above. Same vulnerability.\n\n\nWriteWhatWhere\nprimitive\n\n\nCan be achieved by overwriting the input buffer\npointer of a target Transaction structure, as outlined\nabove.\n\n\nSame technique.\n\n\nReadWhatWhere\nprimitive\n\n\nCan be achieved by overwriting the output buffer\npointer of a target Transaction structure, as outlined\nabove.\n\n\nAPT3 doesn’t use this primitive.\n\n\nRWE\nCave\n\n\nUses an RWE page in the srv.sys memory section. Uses HAL’s heap.\n\n\nFirst\nShell‐\ncode\nExecu‐\ntion\n\n\nOverwrites an unimplemented SMB command point‐\ner in the SMB command handler table, and sends an\nSMB transaction for this command to execute a han‐\ndler (which is in fact shellcode).\n\n\nOverwrites a named pipe con‐\nnection handler function which\nexecutes after the connection is\nclosed.\n\n\nIn addition, we conducted a quantitative analysis of various actions performed during both\nexploits, as can be seen in the following table:\n\n\n-----\n\nInfo leak exploit usage 2 times 1 time\n\nUsage of a write-what-where primitive 24 times 3 times\n\nUsage of a read-what-where primitive 4 times Not used\n\n\nNumber of attempts to overwrite a Transaction structure in\ncase of failure on the first try\n\n\n2 attempts 0 attempts\n\n\nFrom this table, we can infer that the UPSynergy information leak significantly eases the\nexploitation process, as the leaked CCB object described earlier contains almost a direct code\nexecution primitive. In EternalRomance, we could see the usage of a read-what-where primitive,\nmainly used for dereferencing child structs of a leaked Transaction struct. In the case of\nUPSynergy, that would be redundant.\n\nHaving said that, there is a slight chance of instability in the grooming implementation of\nUPSynergy, where a write to an unallocated page might lead to an unintended BSOD. This will\nnot happen in EternalRomance (point for the Equation group).\n\n**Comparison of APT3 and Equation Group Implants**\n\nThe last action to take place following the exploitation is the set-up and invocation of an implant\nshellcode. The purpose is to serve as a basic backdoor, allowing the attacker to issue a further\nkernel mode payload and execute it on the target machine. In the case of both APT3 and\nEquation group, an implant named DoublePulsar is used. This implant was leaked by The\nShadow Brokers in 2017.\n\nIn both cases, there is a very similar flow to the implant’s operation – a hook is set up for a\nparticular SMB handler function to handle invalid SMBs. This hook searches for one of 3\ncommands in a particular SMB field and executes a corresponding function for each one. One of\nthe supported commands is responsible for accepting further shellcode and running it – the last\nstage payload. At this point, the attacker may issue an arbitrary piece of code for execution in the\nkernel space.\n\nAs far as APT3’s implant is concerned, it seems likely f the DoublePulsar code was reused as is.\nThe code is not executed directly, but has several layers of obfuscation. Essentially, the Equation\ngroup’s DoublePulsar code is wrapped with an APT3 position independent crypter & loader.\n\nIn the following sections, we take a look at the differences and supplements provided by APT3.\nAs we will see, the main logic flow was preserved in both cases. However, the differences show\nthat APT3 did not want to fully disclose the fact it was using an allegedly American implant.\n\n**1st Stage – DoublePulsar Loader**\n\nThe very first stage of the implant’s code is a custom loader written by APT3, which extracts an\nencrypted version of DoublePulsar code from incoming SMB packets, and decrypts and executes\nit. This is in fact a self-modifying piece of code, i.e. before it actually handles any of the\naforementioned functionalities, it must decrypt subsequent parts of itself. The code is wrapped in\n2 layers using simple crypters, so the first crypter decodes the second, and the latter decodes the\nactual loader code.\n\n\n-----\n\nFigure 14: First and second phase of decoding the loader’s payload.\n\nAfter these phases are completed, the loader starts its operation which is broken down into the\nfollowing steps:\n\n1. Dynamic function resolution.\n2. Determine the OS version.\n3. Locate the SrvTreeConnectList in sys.\n4. Extract the encoded shellcode from a Transaction object list.\n5. Execute the shellcode.\n\nThe figure below summarizes this flow, showing the main code of this loader. We then present a\ndetailed outline of each of these steps, and point out the major differences that set this code apart\nfrom that of the Equation group.\n\n\n-----\n\nFigure 15: The main flow of the 1st stage loader.\n\nStep 1: Dynamic function resolution\n\nAs this is essentially position independent code, we need to resolve some API functions\ndynamically, which are then used during run time. First, we must locate the base address of the\n_ntoskrnl.exe image. We do this by obtaining the KPCR structure from the FS register, and use_\noffset 0x38 which points to KIDTENTRY *IDT (i.e. the interrupt dispatch table). As we know the\nlatter resides within ntoskrnl.exe and is aligned to the beginning of a page, so it is sufficient to\nwalk back in page multiples until the start of the page is equivalent to the magic number of a PE.\n\nAfter that is done, it’s possible to parse the export table of ntoskrnl.exe to achieve several basic\nAPI function addresses. A common technique is to parse the export tables of a relevant loaded\nimage where these functions reside (e.g. ntoskrnl.exe), hash the names of their exports, and\ncompare them to hardcoded ones. The latter represent the names of the functions that require\naddress resolution. In this case, we see that the hashing function differs from that of the Equation\ngroup, resulting in different name hashes.\n\n**Function Name** **APT3 Hash** **Equation Hash**\n\nZwQuerySystemInformaiton 0x8754A7F7 0x0D2515B2E\n\nExAllocatePoolWithTag 0x37F154D9 –\n\nExAllocatePool – 0x0E3690194\n\nExFreePool 0x3F7747DE 0x0F0835485\n\nRtlGetVersion 0x0DDE5CDD –\n\n\n-----\n\nFigure 16: Different name hashing implementations and their resulting string hashes.\n\nWe see that not only  different hashing algorithms are used, but also different API functions. For\ninstance, the Equation group uses a simple pool allocation via the ExAllocatePool API, while\nAPT3 uses a tagged allocation and calls ExAllocatePoolWithTag. In the latter case, the used tag\nrepresents a work context structure.\n\nFigure 17: APT3 tagged allocation.\n\nStep 2: Determining the OS version\n\nNext, the loader invokes the RtlGetVersion function to obtain information about the underlying\nWindows version. It then assigns a numeric value to a field in a particular struct maintained by the\nloader, which corresponds to the OS version. The value is in fact an offset into an undocumented\nSMB struct called CONNECTION, which will result in a field that points to yet another\nundocumented struct called PAGED_CONNECTION. How this struct is used will be evident in\nsubsequent steps.\n\n\n-----\n\nFigure 18: Determining the version of Windows, and choosing a corresponding offset value.\n\nStep 3: Locating sys and SrvTreeConnectList\n\nAt this point, the loader tries to find Srv.sys (the SMB driver’s image) and parse it. This is done to\nlocate a global undocumented list named SrvTreeConnectList. Srv.sys is located using\n_ZwQuerySystemInformation to obtain a list of loaded module information (where a base address_\nof the loaded images is specified), while the struct is found by going through Srv.sys’ .data section\nand looking for several identifying numeric parameters.\n\nStep 4: Extracting encoded shellcode from a Transaction object list.\n\nAfter the list is found, it is used to go through several linked SMB structures to finally obtain a list\nof Transaction structs. The latter allows us to access the data obtained from relevant SMB Trans\npackets which contains the subsequent shellcode.\n\nThe chain of these structures can be seen in the figure below. The main takeaway is that all of\nthese structures are undocumented – i.e. the developers of APT3 must have done quite a bit of\nreverse engineering on Srv.sys to infer them (on more than one Windows version, as evident from\nthe offset to PAGED_CONNECTION). This effort is very similar to the one invested by the NSA to\nfind the various Eternal exploits around the same time.\n\n\n-----\n\nFigure 19: APT3 s code to walk through various undocumented SMB strucures, suggesting that\na considerable analysis was performed and the group’s members have a good understanding of\nthe SMB internals.\n\nStep 5: Executing the shellcode\n\nAfter the shellcode is obtained and decoded, it is finally executed. This leads to the next stage,\nwhich is yet another piece of self-modifying PIC. However, in this case, most of the code that is\nunravelled after 2 layers of decoding is a variant of the original DoublePulsar, as used by the\nEquation group.\n\n**2nd Stage – DoublePulsar Installation & Hook**\n\nIn this stage of the implant’s operation, yet another shellcode runs. As previously mentioned, this\ncode is obfuscated with 2 layers of crypters, the same ones used to wrap the loader in the 1st\nstage. The code that is unpacked was mostly not written by APT3.\n\nThe first part of the resulting PIC seems to be custom-made, and invokes a system thread that\nworks periodically to form paged allocations of various sizes. It can run in rounds indefinitely,\ncreating 256 allocations for each round and counting the number that get an address within the\nrange of 64 bytes from the point in which the first shellcode was written. Only if there are more\nthan 64 ‘faulty’ allocations can this loop terminate. The purpose is not fully clear, but could be an\nattempt to avoid paging out the shellcode buffers from the paged pool.\n\nThe other part of this internal payload installs DoublePulsar. This is done by replacing a function\npointer to point at a hook function instead of the original function named\n_SrvTransactionNotImplemented. The replacement of this pointer happens in a hard-coded table in_\nthe SMB driver (srv.sys) named SrvTransaction2DispatchTable.\n\nIn essence, both APT3 and the Equation group take similar steps to achieve this goal. These are\n[outlined in the figure below, and are more thoroughly explained here and here.](https://zerosum0x0.blogspot.com/2017/04/doublepulsar-initial-smb-backdoor-ring.html)\n\nFigure 20: The general steps taken to install DoublePulsar’s hook, in both implementations of the\nshellcode.\n\nYou can see the similarity in the call flow graph comparison of these hook functions:\n\n\n-----\n\nFigure 21: CFG comparison of the DoublePulsar hook functions.\n\nThis particular hook function anticipates an initial command named “ping” where a XOR key is\nobtained from the attacker. This key can then be used to decode the payload of subsequent\nSMBs carrying additional shellcode. The latter is executed as part of another command called\n“exec”.\n\n\n-----\n\nFigure 22: Commands supported by the 2nd stage hook backdoor.\n\nThere is an addition to the code that was not observed in other variants of DoublePulsar. This\naddition is a common snippet used to disable the WP bit flag of the CR0 register, which allows the\nkernel to write into read only pages. It is not clear if this serves any purpose in the implant’s\noperation, but it is reasonable to assume that it was bundled to a version of DoublePulsar that\nwas captured by APT3 and was simply left as a code residue.\n\nFigure 23: Code snippet from DoublePulsar, used to clear the WP flag in CR0.\n\n**3rd Stage – APC Injector**\n\nThe last stage of the implant is a piece of code that performs APC injection of a hardcoded\n\n\n-----\n\nIt s worth noting that while an arbitrary command can be\nissued by the user, there are several hardcoded\ncommands that the shellcode runs through the invoked\nAPC in the user space. One of these commands adds a\nnew user as local admin with a hardcoded name and\npassword. In the sample analyzed for this publication, this\nusername is cessupport and the password is 1qaz#EDC.\n\nFigure 24: Hardcoded shell command to add a new admin user to the system.\n\nThe implementation of this part doesn’t resemble that of the Equation group (compared to their\nequivalent APC injector). It’s also different from the previous stages of APT3’s implant. For\nexample, function resolution does not use string hashes anymore, but rather makes comparisons\nto strings stored in the stack. The allocations are no longer tagged and the overall choice of API\nfunctions for similar actions looks different. This may mean that there was another entity within\nthe group that was involved in the development of this part, but not of previous ones.\n\n**Conclusion**\n\nIn our research, we analyzed and compared the exploit development efforts done by 2 major\nactors in the APT landscape – the Equation group and APT3. While the former is known for its\nadvanced and almost unparalleled capabilities in the field of vulnerability research, it is interesting\nto observe how other groups focus on similar research objectives, with a considerable degree of\nsuccess.\n\nIt’s not always clear how threat actors achieve their exploitation tools, and it’s commonly assumed\nthat actors can conduct their own research and development or get it from a third party. In this\n\n\n-----\n\nAlthough we can t prove this beyond any doubt, we brought many facts and analysis findings to\nback up our speculations. We will continue our efforts to find the answers to these as well as any\nfuture questions that arise.\n\nCheck Point protects against the exploits issued by the Bemstour tool with the IPS protection\n‘Microsoft SMB Client Transaction Memory Corruption (MS10-020)’.\n\n_We would like to thank Eyal Itkin for assisting in parts of the analysis during this research._\n\n## IOCs\n\n**MD5:**\n\nF595228976CC89FFAC02D831E774CFA6\n\n**SHA1:**\n\n80143E32F887B2583B777DAEC5982FB5C2886FB3\n\n**SHA256:**\n\n0B28433A2B7993DA65E95A45C2ADF7BC37EDBD2A8DB717B85666D6C88140698A\n\n**Yara Rules:**\n\n\n-----\n\nrule apt3_bemstour_strings\n{\nmeta:\n\ndescription = \"Detects strings used by the Bemstour exploitation tool\"\nauthor = \"Mark Lechtik\"\ncompany = \"Check Point Software Technologies LTD.\"\ndate = \"2019-06-25\"\nsha256 = \"0b28433a2b7993da65e95a45c2adf7bc37edbd2a8db717b85666d6c88140698a\"\nstrings:\n\n$dbg_print_1 = \"leaked address is 0x%llx\" ascii wide\n$dbg_print_2 = \"========== %s ==========\" ascii wide\n$dbg_print_3 = \"detailVersion:%d\" ascii wide\n$dbg_print_4 = \"create pipe twice failed\" ascii wide\n$dbg_print_5 = \"WSAStartup function failed with error: %d\" ascii wide\n$dbg_print_6 = \"can't open input file.\" ascii wide\n$dbg_print_7 = \"Allocate Buffer Failed.\" ascii wide\n$dbg_print_8 = \"Connect to target failed.\" ascii wide\n$dbg_print_9 = \"connect successful.\" ascii wide\n$dbg_print_10 = \"not supported Platform\" ascii wide\n$dbg_print_11 = \"Wait several seconds.\" ascii wide\n$dbg_print_12 = \"not set where to write ListEntry .\" ascii wide\n$dbg_print_13 = \"backdoor not installed.\" ascii wide\n$dbg_print_14 = \"REConnect to target failed.\" ascii wide\n$dbg_print_15 = \"Construct TreeConnectAndX Request Failed.\" ascii wide\n$dbg_print_16 = \"Construct NTCreateAndXRequest Failed.\" ascii wide\n$dbg_print_17 = \"Construct Trans2 Failed.\" ascii wide\n$dbg_print_18 = \"Construct ConsWXR Failed.\" ascii wide\n$dbg_print_19 = \"Construct ConsTransSecondary Failed.\" ascii wide\n$dbg_print_20 = \"if you don't want to input password, use server2003 version..\" ascii\nwide\n\n$cmdline_1 = \"Command format %s TargetIp domainname username password 2\" ascii wide\n$cmdline_2 = \"Command format %s TargetIp domainname username password 1\" ascii wide\n$cmdline_3 = \"cmd.exe /c net user test test /add && cmd.exe /c net localgroup\nadministrators test /add\" ascii wide\n$cmdline_4 = \"hello.exe \\\"C:\\\\WINDOWS\\\\DEBUG\\\\test.exe\\\"\" ascii wide\n$cmdline_5 = \"parameter not right\" ascii wide\n\n$smb_param_1 = \"browser\" ascii wide\n$smb_param_2 = \"spoolss\" ascii wide\n$smb_param_3 = \"srvsvc\" ascii wide\n$smb_param_4 = \"\\\\PIPE\\\\LANMAN\" ascii wide\n$smb_param_5 = \"Werttys for Workgroups 3.1a\" ascii wide\n$smb_param_6 = \"PC NETWORK PROGRAM 1.0\" ascii wide\n$smb_param_7 = \"LANMAN1.0\" ascii wide\n$smb_param_8 = \"LM1.2X002\" ascii wide\n$smb_param_9 = \"LANMAN2.1\" ascii wide\n$smb_param_10 = \"NT LM 0.12\" ascii wide\n$smb_param_12 = \"WORKGROUP\" ascii wide\n$smb_param_13 = \"Windows Server 2003 3790 Service Pack 2\" ascii wide\n$smb_param_14 = \"Windows Server 2003 5.2\" ascii wide\n$smb_param_15 = \"Windows 2002 Service Pack 2 2600\" ascii wide\n$smb_param_16 = \"Windows 2002 5.1\" ascii wide\n$smb_param_17 = \"PC NETWORK PROGRAM 1.0\" ascii wide\n$smb_param_18 = \"Windows 2002 5.1\" ascii wide\n$smb_param_19 = \"Windows for Workgroups 3.1a\" ascii wide\n\n\n-----\n\nuint16(0) 0x5a4d and (5 of ($dbg_print*) or 2 of ($cmdline*) or 1 of\n($unique_str*)) and 3 of ($smb_param*)\n}\n\nrule apt3_bemstour_implant_byte_patch\n{\nmeta:\n\ndescription = \"Detects an implant used by Bemstour exploitation tool (APT3)\"\nauthor = \"Mark Lechtik\"\ncompany = \"Check Point Software Technologies LTD.\"\ndate = \"2019-06-25\"\nsha256 = \"0b28433a2b7993da65e95a45c2adf7bc37edbd2a8db717b85666d6c88140698a\"\n\n/*\n\n0x41b7e1L C745B8558BEC83        mov dword ptr [ebp - 0x48], 0x83ec8b55\n0x41b7e8L C745BCEC745356        mov dword ptr [ebp - 0x44], 0x565374ec\n0x41b7efL C745C08B750833        mov dword ptr [ebp - 0x40], 0x3308758b\n0x41b7f6L C745C4C957C745        mov dword ptr [ebp - 0x3c], 0x45c757c9\n0x41b7fdL C745C88C4C6F61        mov dword ptr [ebp - 0x38], 0x616f4c8c\n\n*/\n\nstrings:\n\n$chunk_1 = {\n\nC7 45 ?? 55 8B EC 83\nC7 45 ?? EC 74 53 56\nC7 45 ?? 8B 75 08 33\nC7 45 ?? C9 57 C7 45\nC7 45 ?? 8C 4C 6F 61\n\n}\n\ncondition:\nany of them\n}\n\n\n-----\n\nrule apt3_bemstour_implant_command_stack_variable\n{\nmeta:\n\ndescription = \"Detecs an implant used by Bemstour exploitation tool (APT3)\"\nauthor = \"Mark Lechtik\"\ncompany = \"Check Point Software Technologies LTD.\"\ndate = \"2019-06-25\"\nsha256 = \"0b28433a2b7993da65e95a45c2adf7bc37edbd2a8db717b85666d6c88140698a\"\n\nstrings:\n\n/*\n\n0x41ba18L C78534FFFFFF636D642E     mov dword ptr [ebp - 0xcc], 0x2e646d63\n0x41ba22L C78538FFFFFF65786520     mov dword ptr [ebp - 0xc8], 0x20657865\n0x41ba2cL C7853CFFFFFF2F632063     mov dword ptr [ebp - 0xc4], 0x6320632f\n0x41ba36L C78540FFFFFF6F707920     mov dword ptr [ebp - 0xc0], 0x2079706f\n0x41ba40L C78544FFFFFF2577696E     mov dword ptr [ebp - 0xbc], 0x6e697725\n0x41ba4aL C78548FFFFFF64697225     mov dword ptr [ebp - 0xb8], 0x25726964\n0x41ba54L C7854CFFFFFF5C737973     mov dword ptr [ebp - 0xb4], 0x7379735c\n0x41ba5eL C78550FFFFFF74656D33     mov dword ptr [ebp - 0xb0], 0x336d6574\n0x41ba68L C78554FFFFFF325C636D     mov dword ptr [ebp - 0xac], 0x6d635c32\n0x41ba72L C78558FFFFFF642E6578     mov dword ptr [ebp - 0xa8], 0x78652e64\n0x41ba7cL C7855CFFFFFF65202577     mov dword ptr [ebp - 0xa4], 0x77252065\n0x41ba86L C78560FFFFFF696E6469     mov dword ptr [ebp - 0xa0], 0x69646e69\n0x41ba90L C78564FFFFFF72255C73     mov dword ptr [ebp - 0x9c], 0x735c2572\n0x41ba9aL C78568FFFFFF79737465     mov dword ptr [ebp - 0x98], 0x65747379\n0x41baa4L C7856CFFFFFF6D33325C     mov dword ptr [ebp - 0x94], 0x5c32336d\n0x41baaeL C78570FFFFFF73657468     mov dword ptr [ebp - 0x90], 0x68746573\n0x41bab8L C78574FFFFFF632E6578     mov dword ptr [ebp - 0x8c], 0x78652e63\n0x41bac2L C78578FFFFFF65202F79     mov dword ptr [ebp - 0x88], 0x792f2065\n0x41baccL 83A57CFFFFFF00        and dword ptr [ebp - 0x84], 0\n\n*/\n\n$chunk_1 = {\n\nC7 85 ?? ?? ?? ?? 63 6D 64 2E\nC7 85 ?? ?? ?? ?? 65 78 65 20\nC7 85 ?? ?? ?? ?? 2F 63 20 63\nC7 85 ?? ?? ?? ?? 6F 70 79 20\nC7 85 ?? ?? ?? ?? 25 77 69 6E\nC7 85 ?? ?? ?? ?? 64 69 72 25\nC7 85 ?? ?? ?? ?? 5C 73 79 73\nC7 85 ?? ?? ?? ?? 74 65 6D 33\nC7 85 ?? ?? ?? ?? 32 5C 63 6D\nC7 85 ?? ?? ?? ?? 64 2E 65 78\nC7 85 ?? ?? ?? ?? 65 20 25 77\nC7 85 ?? ?? ?? ?? 69 6E 64 69\nC7 85 ?? ?? ?? ?? 72 25 5C 73\nC7 85 ?? ?? ?? ?? 79 73 74 65\nC7 85 ?? ?? ?? ?? 6D 33 32 5C\nC7 85 ?? ?? ?? ?? 73 65 74 68\nC7 85 ?? ?? ?? ?? 63 2E 65 78\nC7 85 ?? ?? ?? ?? 65 20 2F 79\n83 A5 ?? ?? ?? ?? 00\n\n\n-----\n\n/*\n\n0x41baeeL C785D8FEFFFF636D6420     mov dword ptr [ebp - 0x128], 0x20646d63\n0x41baf8L C785DCFEFFFF2F632022     mov dword ptr [ebp - 0x124], 0x2220632f\n0x41bb02L C785E0FEFFFF6E657420     mov dword ptr [ebp - 0x120], 0x2074656e\n0x41bb0cL C785E4FEFFFF75736572     mov dword ptr [ebp - 0x11c], 0x72657375\n0x41bb16L C785E8FEFFFF20636573     mov dword ptr [ebp - 0x118], 0x73656320\n0x41bb20L C785ECFEFFFF73757070     mov dword ptr [ebp - 0x114], 0x70707573\n0x41bb2aL C785F0FEFFFF6F727420     mov dword ptr [ebp - 0x110], 0x2074726f\n0x41bb34L C785F4FEFFFF3171617A     mov dword ptr [ebp - 0x10c], 0x7a617131\n0x41bb3eL C785F8FEFFFF23454443     mov dword ptr [ebp - 0x108], 0x43444523\n0x41bb48L C785FCFEFFFF202F6164     mov dword ptr [ebp - 0x104], 0x64612f20\n0x41bb52L C78500FFFFFF64202626     mov dword ptr [ebp - 0x100], 0x26262064\n0x41bb5cL C78504FFFFFF206E6574     mov dword ptr [ebp - 0xfc], 0x74656e20\n0x41bb66L C78508FFFFFF206C6F63     mov dword ptr [ebp - 0xf8], 0x636f6c20\n0x41bb70L C7850CFFFFFF616C6772     mov dword ptr [ebp - 0xf4], 0x72676c61\n0x41bb7aL C78510FFFFFF6F757020     mov dword ptr [ebp - 0xf0], 0x2070756f\n0x41bb84L C78514FFFFFF61646D69     mov dword ptr [ebp - 0xec], 0x696d6461\n0x41bb8eL C78518FFFFFF6E697374     mov dword ptr [ebp - 0xe8], 0x7473696e\n0x41bb98L C7851CFFFFFF7261746F     mov dword ptr [ebp - 0xe4], 0x6f746172\n0x41bba2L C78520FFFFFF72732063     mov dword ptr [ebp - 0xe0], 0x63207372\n0x41bbacL C78524FFFFFF65737375     mov dword ptr [ebp - 0xdc], 0x75737365\n0x41bbb6L C78528FFFFFF70706F72     mov dword ptr [ebp - 0xd8], 0x726f7070\n0x41bbc0L C7852CFFFFFF74202F61     mov dword ptr [ebp - 0xd4], 0x612f2074\n0x41bbcaL C78530FFFFFF64642200     mov dword ptr [ebp - 0xd0], 0x226464\n0x41bbd4L 6A5C             push 0x5c\n\n*/\n\n$chunk_2 = {\n\nC7 85 ?? ?? ?? ?? 63 6D 64 20\nC7 85 ?? ?? ?? ?? 2F 63 20 22\nC7 85 ?? ?? ?? ?? 6E 65 74 20\nC7 85 ?? ?? ?? ?? 75 73 65 72\nC7 85 ?? ?? ?? ?? 20 63 65 73\nC7 85 ?? ?? ?? ?? 73 75 70 70\nC7 85 ?? ?? ?? ?? 6F 72 74 20\nC7 85 ?? ?? ?? ?? 31 71 61 7A\nC7 85 ?? ?? ?? ?? 23 45 44 43\nC7 85 ?? ?? ?? ?? 20 2F 61 64\nC7 85 ?? ?? ?? ?? 64 20 26 26\nC7 85 ?? ?? ?? ?? 20 6E 65 74\nC7 85 ?? ?? ?? ?? 20 6C 6F 63\nC7 85 ?? ?? ?? ?? 61 6C 67 72\nC7 85 ?? ?? ?? ?? 6F 75 70 20\nC7 85 ?? ?? ?? ?? 61 64 6D 69\nC7 85 ?? ?? ?? ?? 6E 69 73 74\nC7 85 ?? ?? ?? ?? 72 61 74 6F\nC7 85 ?? ?? ?? ?? 72 73 20 63\nC7 85 ?? ?? ?? ?? 65 73 73 75\nC7 85 ?? ?? ?? ?? 70 70 6F 72\nC7 85 ?? ?? ?? ?? 74 20 2F 61\nC7 85 ?? ?? ?? ?? 64 64 22 00\n6A 5C\n\n}\n\n\n-----\n\n0x41be30L C7459C47657450        mov dword ptr [ebp 0x64], 0x50746547\n0x41be37L C745A0726F6341        mov dword ptr [ebp - 0x60], 0x41636f72\n0x41be3eL C745A464647265        mov dword ptr [ebp - 0x5c], 0x65726464\n0x41be45L C745A873730000        mov dword ptr [ebp - 0x58], 0x7373\n0x41be4cL C745C443726561        mov dword ptr [ebp - 0x3c], 0x61657243\n0x41be53L C745C874654669        mov dword ptr [ebp - 0x38], 0x69466574\n0x41be5aL C745CC6C654100        mov dword ptr [ebp - 0x34], 0x41656c\n0x41be61L C745B857726974        mov dword ptr [ebp - 0x48], 0x74697257\n0x41be68L C745BC6546696C        mov dword ptr [ebp - 0x44], 0x6c694665\n0x41be6fL C745C065000000        mov dword ptr [ebp - 0x40], 0x65\n0x41be76L C745AC436C6F73        mov dword ptr [ebp - 0x54], 0x736f6c43\n0x41be7dL C745B06548616E        mov dword ptr [ebp - 0x50], 0x6e614865\n0x41be84L C745B4646C6500        mov dword ptr [ebp - 0x4c], 0x656c64\n0x41be8bL 894DE8            mov dword ptr [ebp - 0x18], ecx\n\n*/\n\n$chunk_3 = {\n\nC7 45 ?? 57 69 6E 45\nC7 45 ?? 78 65 63 00\nC7 45 ?? 47 65 74 50\nC7 45 ?? 72 6F 63 41\nC7 45 ?? 64 64 72 65\nC7 45 ?? 73 73 00 00\nC7 45 ?? 43 72 65 61\nC7 45 ?? 74 65 46 69\nC7 45 ?? 6C 65 41 00\nC7 45 ?? 57 72 69 74\nC7 45 ?? 65 46 69 6C\nC7 45 ?? 65 00 00 00\nC7 45 ?? 43 6C 6F 73\nC7 45 ?? 65 48 61 6E\nC7 45 ?? 64 6C 65 00\n89 4D ??\n\n}\n\ncondition:\nany of them\n}\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2019/2019.09.05.UPSynergy/UPSynergy_%20Chinese-American%20Spy%20vs.%20Spy%20Story.pdf"
    ],
    "report_names": [
        "UPSynergy_ Chinese-American Spy vs. Spy Story"
    ],
    "threat_actors": [
        {
            "id": "b740943a-da51-4133-855b-df29822531ea",
            "created_at": "2022-10-25T15:50:23.604126Z",
            "updated_at": "2025-03-27T02:00:55.505366Z",
            "deleted_at": null,
            "main_name": "Equation",
            "aliases": [
                "Equation"
            ],
            "source_name": "MITRE:Equation",
            "tools": null,
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "d4f7cf97-9c98-409c-8b95-b80d14c576a5",
            "created_at": "2022-10-25T16:07:24.561104Z",
            "updated_at": "2025-03-27T02:02:10.281202Z",
            "deleted_at": null,
            "main_name": "Shadow Brokers",
            "aliases": [],
            "source_name": "ETDA:Shadow Brokers",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "61c4ddc4-156b-4828-8570-0979da81f3d0",
            "created_at": "2022-10-25T16:47:55.593828Z",
            "updated_at": "2025-03-27T02:05:17.275161Z",
            "deleted_at": null,
            "main_name": "BRONZE MAYFAIR",
            "aliases": [
                "Gothic Panda ",
                "TG-0110 ",
                "APT3 "
            ],
            "source_name": "Secureworks:BRONZE MAYFAIR",
            "tools": [
                " HUC Proxy Malware (Htran)",
                " Pirpi",
                " SplitVPN",
                " ctt",
                " ctx",
                "Cookiecutter"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "761d1fb2-60e3-46f0-9f1c-c8a9715967d4",
            "created_at": "2023-01-06T13:46:38.269054Z",
            "updated_at": "2025-03-27T02:00:02.789278Z",
            "deleted_at": null,
            "main_name": "APT3",
            "aliases": [
                "TG-0110",
                "Group 6",
                "Buckeye",
                "Boyusec",
                "BORON",
                "BRONZE MAYFAIR",
                "Red Sylvan",
                "GOTHIC PANDA"
            ],
            "source_name": "MISPGALAXY:APT3",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "08623296-52be-4977-8622-50efda44e9cc",
            "created_at": "2023-01-06T13:46:38.549387Z",
            "updated_at": "2025-03-27T02:00:02.859535Z",
            "deleted_at": null,
            "main_name": "Equation Group",
            "aliases": [
                "Tilded Team",
                "EQGRP",
                "G0020"
            ],
            "source_name": "MISPGALAXY:Equation Group",
            "tools": [
                "EquationLaser",
                "EquationDrug",
                "DoubleFantasy",
                "TripleFantasy",
                "GrayFish"
            ],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "13354d3f-3f40-44ec-b42a-3cda18809005",
            "created_at": "2022-10-25T15:50:23.275272Z",
            "updated_at": "2025-03-27T02:00:55.418075Z",
            "deleted_at": null,
            "main_name": "APT3",
            "aliases": [
                "APT3",
                "Gothic Panda",
                "Pirpi",
                "UPS Team",
                "Buckeye",
                "Threat Group-0110",
                "TG-0110"
            ],
            "source_name": "MITRE:APT3",
            "tools": [
                "OSInfo",
                "schtasks",
                "PlugX",
                "LaZagne",
                "SHOTPUT",
                "RemoteCMD"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "171b85f2-8f6f-46c0-92e0-c591f61ea167",
            "created_at": "2023-01-06T13:46:38.830188Z",
            "updated_at": "2025-03-27T02:00:02.929729Z",
            "deleted_at": null,
            "main_name": "The Shadow Brokers",
            "aliases": [
                "Shadow Brokers",
                "ShadowBrokers",
                "The ShadowBrokers",
                "TSB"
            ],
            "source_name": "MISPGALAXY:The Shadow Brokers",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "2d9fbbd7-e4c3-40e5-b751-27af27c8610b",
            "created_at": "2024-05-01T02:03:08.144214Z",
            "updated_at": "2025-03-27T02:05:17.419705Z",
            "deleted_at": null,
            "main_name": "PLATINUM COLONY",
            "aliases": [
                "Equation Group "
            ],
            "source_name": "Secureworks:PLATINUM COLONY",
            "tools": [
                " EquationDrug",
                " EquationLaser",
                " Fanny",
                " GrayFish",
                " TripleFantasy",
                "DoubleFantasy"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "06f622cb-3a78-49cf-9a4c-a6007a69325f",
            "created_at": "2022-10-25T16:07:23.315239Z",
            "updated_at": "2025-03-27T02:02:09.733197Z",
            "deleted_at": null,
            "main_name": "APT 3",
            "aliases": [
                "APT 3",
                "Bronze Mayfair",
                "Buckeye",
                "Gothic Panda",
                "Group 6",
                "Operation Clandestine Fox",
                "Operation Clandestine Fox, Part Deux",
                "Operation Clandestine Wolf",
                "Operation Double Tap",
                "Red Sylvan",
                "TG-0110",
                "UPS Team"
            ],
            "source_name": "ETDA:APT 3",
            "tools": [
                "APT3 Keylogger",
                "Agent.dhwf",
                "BKDR_HUPIGON",
                "Backdoor.APT.CookieCutter",
                "Badey",
                "Bemstour",
                "CookieCutter",
                "Destroy RAT",
                "DestroyRAT",
                "DoublePulsar",
                "EXL",
                "EternalBlue",
                "HTran",
                "HUC Packet Transmit Tool",
                "Hupigon",
                "Hupigon RAT",
                "Kaba",
                "Korplug",
                "LaZagne",
                "MFC Huner",
                "OSInfo",
                "Pirpi",
                "PlugX",
                "RedDelta",
                "RemoteCMD",
                "SHOTPUT",
                "Sogu",
                "TIGERPLUG",
                "TTCalc",
                "TVT",
                "Thoper",
                "Xamtrav",
                "remotecmd",
                "shareip",
                "w32times"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "e0fed6e6-a593-4041-80ef-694261825937",
            "created_at": "2022-10-25T16:07:23.593572Z",
            "updated_at": "2025-03-27T02:02:09.879892Z",
            "deleted_at": null,
            "main_name": "Equation Group",
            "aliases": [
                "APT-C-40",
                "Platinum Colony",
                "Tilded Team"
            ],
            "source_name": "ETDA:Equation Group",
            "tools": [
                "Bvp47",
                "DEMENTIAWHEEL",
                "DOUBLEFANTASY",
                "DanderSpritz",
                "DarkPulsar",
                "DoubleFantasy",
                "DoubleFeature",
                "DoublePulsar",
                "Duqu",
                "EQUATIONDRUG",
                "EQUATIONLASER",
                "EQUESTRE",
                "Flamer",
                "GRAYFISH",
                "GROK",
                "OddJob",
                "Plexor",
                "Prax",
                "Regin",
                "Skywiper",
                "TRIPLEFANTASY",
                "Tilded",
                "UNITEDRAKE",
                "WarriorPride",
                "sKyWIper"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716496,
    "ts_updated_at": 1743041746,
    "ts_creation_date": 1567736661,
    "ts_modification_date": 1567736661,
    "files": {
        "pdf": "https://archive.orkl.eu/5b6bccee4b358c195ea7d80c118d6e9a793f3ed7.pdf",
        "text": "https://archive.orkl.eu/5b6bccee4b358c195ea7d80c118d6e9a793f3ed7.txt",
        "img": "https://archive.orkl.eu/5b6bccee4b358c195ea7d80c118d6e9a793f3ed7.jpg"
    }
}