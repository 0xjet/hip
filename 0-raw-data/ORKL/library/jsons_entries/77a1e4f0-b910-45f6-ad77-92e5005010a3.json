{
    "id": "77a1e4f0-b910-45f6-ad77-92e5005010a3",
    "created_at": "2023-01-12T15:00:39.567367Z",
    "updated_at": "2025-03-27T02:05:56.446006Z",
    "deleted_at": null,
    "sha1_hash": "cf0ff48dd24968125de4a7e9edd7b233d6c59939",
    "title": "2020-04-02 - CoViper locking down computers during lockdown",
    "authors": "",
    "file_creation_date": "2022-05-28T18:57:52Z",
    "file_modification_date": "2022-05-28T18:57:52Z",
    "file_size": 1130484,
    "plain_text": "# CoViper locking down computers during lockdown\n\n**[decoded.avast.io/janrubin/coviper-locking-down-computers-during-lockdown/](https://decoded.avast.io/janrubin/coviper-locking-down-computers-during-lockdown/)**\n\nby [Jan RubínApril 2, 202010 min read](https://decoded.avast.io/author/janrubin/)\n\n\nApril 2, 2020\n\n\nCoViper is a new wiper malware family taking advantage of the COVID-19 crisis. Based on what we\ndiscovered during our analysis, we have reason to believe that it is attracting victims by masquerading as a\nfile related to the coronavirus. The wiper breaks an infected computer’s boot operation, by rewriting the\nMaster Boot Record (MBR) located on the computer’s disk. The MBR contains valuable information about\nhow the OS should be booted on the PC. If the MBR is damaged, the PC will most likely remain nonfunctional, because it cannot be booted as usual. A skilled user could reinstall their MBR to recover their\nPC and files, or use other bootable media devices.\n\nThis particular malware family is sometimes also called the “MBR wiper”, or even “MBR locker”. MBR\nlockers are often used in combination with ransomware where the ransom note is displayed to the victim.\nIn this case, however, the MBR is simply destroyed; no ransom is demanded. It’s possible that CoViper\ncould be an early version of malware which will later turn into ransomware, as we will describe further\ndown in the post.\n\n## Analysis\n\nCoViper is distributed as an installer written in PureBasic, with all interesting files packed as resources.\nCoViper is composed of several binaries and scripts. These files are dropped into the computer’s\ntemporary folder ( %TEMP%, usually the absolute path is C:\\Users\\<username>\\AppData\\Local\\Temp\\ ),\ncreated using the `GetTempFileNameA API function.`\n\nWe will describe the purpose of these files later on. As a brief overview, here’s a short summary of the files\nCoViper drops into the temp folder:\n```\n   coronavirus.bat – a stager that installs the malware and secures its persistence\n   end.exe – a wiper written in Delphi. Its purpose is to rewrite the MBR, effectively preventing the PC\n\n```\nfrom booting normally\n```\n   mainWindow.exe – launches a GUI with an image of the (corona)virus\n   run.exe – a binary ensuring persistence, starting mainWindow.exe process. This is performed by\n\n```\nan intermediate script called `run.bat`\n```\n   Update.vbs – currently a non-functional (not yet fully implemented) script, presumably designed to\n\n```\nupdate the malware to a newer version\n```\n   cursor.cur – a cursor file which is set as a new cursor’s appearance\n   wallpaper.jpg – a black wallpaper, set as the default desktop background on the victims’ PC\n\n```\n\n-----\n\n## The Installation – coronavirus.bat\n\nThis simple coronavirus.bat script is used to install the malware onto the victim’s computer. The script also\ncopies all the dropped files from the temporary folder into a new, hidden folder, called COVID-19, in the\nuser’s home directory. Furthermore, the script changes registry keys to ensure persistence on the system,\nand restarts the system with a five second delay once the script is finished running. As we can see from\nthe code below, the restart will effectively execute three files: `Update.vbs,` `run.exe, and` `end.exe .`\n\nNote that the script is a little verbose, informing the user that the “coronavirus Installer” is working and after\nthe script finishes, the “coronavirus sucessfully installed” (not our typo) and “Your computer will restart in 5\nseconds to finish the installation :)” is shown as well. While adding a smiley may be used to ease the pain\nof what’s to come, it’s a little too much for our liking.\n\nThe contents of the `coronavirus.bat script can be found below:`\n\nIn addition to the persistence and disabling the UAC by modifying the `EnableLUA registry key, the`\nmalware also prevents the user from starting the Task Manager, which will become “handy” in the next\nstage, because the user will lose the ability to kill the malware process. However, the Task Manager is the\nonly tool it disables, so using e.g. the Process Explorer would still be possible.\n\nThe `coronavirus.bat script also changes the appearance of the user’s mouse cursor and changes the`\ndesktop wallpaper to black. It prevents the user from changing the wallpaper to any other image (unless\nthe user changes the registry entry back again).\n\n\n-----\n\n_Screen showing coronavirus.bat was successfully installed_\n\n## First Reboot\n\nLet’s now focus on what the other scripts and binaries do after the first reboot.\n\n### Update.vbs\n\nWe suspect the `Update.vbs VisualBasic script is unfinished and will probably serve as an update`\nmechanism for future versions of CoViper. Right now, the script only contains two lines of code, effectively\ndoing nothing:\n\nIn other words, it waits two minutes and then displays a message which tells the user to contact their\nadministrator or fix their internet connection. In fact, this only means that the update mechanism has not\nbeen implemented yet.\n\n### run.exe\n\nThe `run.exe binary is an UPX packed file. Unpacking the file reveals that it is almost the same as the`\ninitial PureBasic installer we got our hands on. The difference is that the file doesn’t contain scripts and\nbinaries that were previously present in the binary and dropped onto the disk afterwards. Instead, it\nexecutes a `run.bat script which performs several additional operations on the victims’ system.`\n\nThe script ensures the malware’s persistence once again (the whole list of changed registry keys can be\nfound at the end of this blogspot in the IoC section). There is no difference between the persistence in this\nbat script and the `coronavirus.bat script, but there is a difference in the infinite run loop which`\nrepeatedly executes the `mainWindow.exe binary every time it is closed by the user. As mentioned before,`\nthe user cannot use Task Manager to kill this process, making it rather annoying.\n\nThe infinite run loop present in the `run.bat script can be found below:`\n\n\n-----\n\n### mainWindow.exe\n```\nmainWindow.exe is a binary written in VisualBasic. It has no apparent purpose other than to annoy the\n\n```\nuser. A window with an image of the (corona)virus is displayed. Also, two buttons are available to the user,\n_“Help” and “Remove virus”. The help button displays a rather “helpful” text informing the user not to “WAST_\n_HIS TIME” (again the typo is included in the program) and that the computer is infected with the_\n“coronavirus” and it cannot be stopped. The “Remove virus” button’s functionality is not currently\nimplemented. It is unclear at this stage whether the malware will possibly become ransomware in the\nfuture, instructing the user to pay up by offering a list of payment methods after clicking this button.\n\n_mainWindow.exe: Help button is rather helpful_\n\n### end.exe\n\nWith such a characteristic name, it’s no surprise that “The End” is near and the malicious process is almost\nfinished. The `end.exe is truly the last stage of CoViper and it holds the wiper’s core functionality. It is`\nwritten in Borland Delphi.\n\nThe purpose of this process is to rewrite the infected computer’s MBR with the attacker’s own code. This\nresults in a non-functional booting mechanism, leading to the inability to start the PC properly and boot the\nsystem\n\n\n-----\n\nHowever, we found something interesting in the assembly. That is, before the MBR is replaced, its backup\nis created. This would indicate that some kind of a failsafe could be implemented further in the code.\n\nThe backup is written after the new MBR, i.e. starting at `0x200 byte offset. Furthermore, we can see that`\nafter the backup, some interesting memory bytes (strings) are copied as well, at the `0x400 offset.`\n\nThe result can be illustrated with this image:\n\n_An_\n\n_illustration of the MBR data structure, created by the malware_\nInstead of a standard MBR, this code is inserted:\n\nDespite the code being short, it is enough to break the regular booting mechanism (a full MBR dump can\n[be downloaded here). This code also prints two strings on the screen (see picture below in the Second](https://github.com/avast/ioc/blob/master/CoViper/extras/7ae5e2be872510a0e2c01bcf61c2e2fb1e680cd9e54891d3751d41f53ac24f84)\nReboot section). As we suspected from the memory copy of strings above, the first string is the author’s\ncredential signature:\n\n\n-----\n\n```\n Created By Angel Castillo. Your Computer Has Been Trashed.\n\n```\nThe second is a Discord server where the victim can reach the author:\n\n```\nDiscord: Windows Vista#3294\n\n```\n\nAfter the execution of the `end.exe, no other action is performed. The user is left helpless and the final`\nact of the tragedy is the user’s final performance.\n\n## Second Reboot\n\nThe Task Manager is a “task managing” tool that most users are familiar with, and the victim most likely\ncannot close the `mainWindow.exe process without it. As we all know, the obvious solution for any IT`\nproblem is to turn the device off and on again. This will, however, “kill” the victim’s computer, making it\nunusable, unless the victim is tech savvy and can reinstall the MBR.\n\nUpon restarting the PC, this message is displayed to the victim:\n\n_A boot screen with the modified MBR_\n\n### The Failsafe\n\nAfter further analysis of the MBR, we have good news! As we suspected, the author did in fact implement a\nfailsafe to the MBR code. We suppose this is implemented in case the malware author accidentally\nexecuted the malware on their own PC and/or in case of a request for advice (on the aforementioned\nDiscord server), for example while demanding ransom. This is, however, only a speculation.\n\n\n-----\n\nFrom this MBR assembly, we can see that the program waits for an input. This expected input is in fact\n```\nCTRL+ALT+ESC . After this key combination, the MBR is replaced with the original one (from the backup\n\n```\nperformed by `end.exe ) and the PC can be restarted and booted normally.`\n\nKeep in mind that after the restart, the malware is executed once again (i.e. the `end.exe binary). Thus,`\nusers should at least first remove the autorun settings, so the whole scenario won’t repeat itself.\n\n## Further Investigation\n\nAs we could see in the previous image, the author of CoViper left a message for us. The aforementioned\nmessages leave us a few clues — the author’s pseudonym and a Discord server that was still online at the\ntime of writing.\n\nFurthermore, we would like to mention that while investigating CoViper, it is clear that this malware was\nactually generated by a custom tool publicly available on the Internet, for free. Because we have come to a\nconclusion that the author of this tool is not actually the author of CoViper itself, we will not disclose his\nname. We will also not disclose the tools’s name so that we don’t bring more attention to it. For further\ninformation regarding this topic and our investigation, you can contact us any time at @AvastThreatLabs\non Twitter.\n\n## Indicators of Compromise (IoC)\n\n**Hash** **Name**\n\n4FD9B85EEC0B49548C462ACB9EC831A0728C0EF9E3DE70E772755834E38AA3B3 coronavirus.bat\n\nC3F11936FE43D62982160A876CC000F906CB34BB589F4E76E54D0A5589B2FDB9 end.exe\n\nB780E24E14885C6AB836AAE84747AA0D975017F5FC5B7F031D51C7469793EABE mainWindow.exe\n\nC46C3D2BEA1E42B628D6988063D247918F3F8B69B5A1C376028A2A0CADD53986 run.exe\n\nA1A8D79508173CF16353E31A236D4A211BDCEDEF53791ACCE3CFBA600B51AAEC Update.vbs\n\nFE22DD2588666974CAE5B5BBDE2D763AFBD94BCCF72D350EC4E801F9354D103D run.exe\nunpacked\n\nDF1F9777FE6BEDE9871E331C76286BAB82DA361B59E44D07C6D977319522BA91 run.bat\n\n13C4423ED872E71990E703A21174847AB58DEC49501B186709B77B772CEEAB52 cursor.cur\n\n\n-----\n\n4A17F58A8BF2B26ECE23B4D553D46B72E0CDA5E8668458A80CE8FE4E6D90C42D wallpaper.jpg\n\n7AE5E2BE872510A0E2C01BCF61C2E2FB1E680CD9E54891D3751D41F53AC24F84 New MBR\n\n**Changed registry key**\n\nHKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System /v disabletaskmgr /t REG_DWORD\n/d 1 /f\n\nHKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System /v EnableLUA /t REG_DWORD\n/d 0 /f\n\nHKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System /v wallpaper /t REG_SZ /d\n%homedrive%\\COVID-19\\wallpaper.jpg /f\n\nHKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\ActiveDesktop /v NoChangingWallPaper\n/t REG_DWORD /d 1 /f\n\nHKCU\\Control Panel\\Cursors /v Arrow /t REG_SZ /d %homedrive%\\COVID-19\\cursor.cur /f\n\nHKCU\\Control Panel\\Cursors /v AppStarting /t REG_SZ /d %homedrive%\\COVID-19\\cursor.cur /f\n\nHKCU\\Control Panel\\Cursors /v Hand /t REG_SZ /d %homedrive%\\COVID-19\\cursor.cur /f\n\nHKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run /v CheckForUpdates /t REG_SZ /d\n%homedrive%\\COVID-19\\Update.vbs /f\n\nHKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run /v explorer.exe /t REG_SZ /d\n%homedrive%\\COVID-19\\run.exe /f\n\nHKLM\\software\\Microsoft\\Windows\\CurrentVersion\\Run /v GoodbyePC! /t REG_SZ /d\n%homedrive%\\COVID-19\\end.exe /f\n\n[Tagged aslocker,](https://decoded.avast.io/tag/locker/) [MBR,](https://decoded.avast.io/tag/mbr/) [wiper](https://decoded.avast.io/tag/wiper/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-04-02 - CoViper locking down computers during lockdown.pdf"
    ],
    "report_names": [
        "2020-04-02 - CoViper locking down computers during lockdown.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535639,
    "ts_updated_at": 1743041156,
    "ts_creation_date": 1653764272,
    "ts_modification_date": 1653764272,
    "files": {
        "pdf": "https://archive.orkl.eu/cf0ff48dd24968125de4a7e9edd7b233d6c59939.pdf",
        "text": "https://archive.orkl.eu/cf0ff48dd24968125de4a7e9edd7b233d6c59939.txt",
        "img": "https://archive.orkl.eu/cf0ff48dd24968125de4a7e9edd7b233d6c59939.jpg"
    }
}