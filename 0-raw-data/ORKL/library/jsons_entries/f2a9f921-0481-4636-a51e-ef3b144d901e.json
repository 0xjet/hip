{
    "id": "f2a9f921-0481-4636-a51e-ef3b144d901e",
    "created_at": "2023-01-12T15:01:24.338082Z",
    "updated_at": "2025-03-27T02:17:00.191772Z",
    "deleted_at": null,
    "sha1_hash": "990c42443437b5386b55f6a4e38732cced427d1d",
    "title": "2021-10-23 - Links to Previous Attacks in UAParserJS Compromise",
    "authors": "",
    "file_creation_date": "2022-05-28T19:19:49Z",
    "file_modification_date": "2022-05-28T19:19:49Z",
    "file_size": 385730,
    "plain_text": "# Links to Previous Attacks in UAParserJS Compromise\n\n**cadosecurity.com/links-to-previous-attacks-in-uaparserjs-compromise/**\n\nBlog\n\nOctober 23, 2021\n\n\nOctober 23, 2021\n\n\n[A very popular npm library called UAParser was](https://www.npmjs.com/package/ua-parser-js) [compromised this week. The author of the library, Faisal Salman, said:](https://therecord.media/malware-found-in-npm-package-with-millions-of-weekly-downloads/)\n\n_“I believe someone was hijacking my npm account and published some compromised packages (0.7.29, 0.8.0, 1.0.0) which will_\n_probably install malware.”_\n\nThe compromised package installs a monero miner on Linux and Windows systems. Advisories are available from the package\n[author,](https://github.com/faisalman/ua-parser-js/issues/536) [GitHub and](https://github.com/advisories/GHSA-pjwm-rvh2-c87w) [CISA.](https://us-cert.cisa.gov/ncas/current-activity/2021/10/22/malware-discovered-popular-npm-package-ua-parser-js)\n\nWhen we analysed the malware – we found that clear links to earlier stages of the attack from an attacker named “wozheqirsplu”,\ndescribed below.\n\n**Malware** **Analysis**\n\nThe attacker compromised Faisal’s npm access and [updated the npm package.json file to run a file called preinstall.js:](https://my.diffend.io/npm/ua-parser-js/0.7.28/0.7.29)\n\nPreinstall.js then determines the operating system:\n\n\n-----\n\n[If it is running on Linux – it then runs preinstall.sh:](https://otx.alienvault.com/indicator/file/23c0163185bdacc9df0f8d7aac4dbbd8a748d98b1715d2a87d3f8a9abbc84f6b)\n\nThis determines the location of the system, and if it is not in one of the following countries continues to execute:\n\nRussia, Ukraine, Belarus or and Kazakhstan\n\nIt then downloads the file http://159.148.186[.]228/download/jsextension and executes it. The file jsextension the crypto-currency\nminer xmrig – set to use the minexmr mining pool with the monero wallet:\n\n49ay9Aq2r3diJtEk3eeKKm7pc5R39AKnbYJZVqAd1UUmew6ZPX1ndfXQCT16v4trWp4erPyXtUQZTHGjbLXWQdBqLMxxYKH\n\n[If it is running Windows – it then runs preinstall.bat:](https://otx.alienvault.com/indicator/file/6d325971c532b184e2aa8a851741d776491f8c79123cfdde6bb1cedba79278b1)\n\n\n-----\n\nSimilarly to the Linux installation – this downloads a copy of xmrig (via curl or certutil) and runs it with the same parameters. The\n[file sdd.dll is detected as a credential theft tool.](https://twitter.com/campuscodi/status/1451960710427258891)\n\n**Setting up the Attack**\n\nThe malicious file deployed on Windows machine is served from:\n\nhttp://159.148.186[.]228/download/jsextension.exe\n\n[And has the SHA256 7f986cd3c946f274cdec73f80b84855a77bc2a3c765d68897fbc42835629a5d5.](https://www.virustotal.com/gui/file/7f986cd3c946f274cdec73f80b84855a77bc2a3c765d68897fbc42835629a5d5)\n\n**_This file has been seen before._**\n\nBack on Wednesday October 20th, Sonatype wrote a blog titled “Newly Found npm Malware Mines Cryptocurrency on Windows,\nLinux, macOS Devices”. They saw the same file – but back then it was being served from a different server:\n\nhttp://185.173.36[.]219/download/jsextension.exe\n\nSonatype spotted a malicious user named wozheqirsplu had first created a npm package called okhsa that started calc.exe\n(Opening the Windows Calculator is a typical first step in testing malicious execution):\n\n\n-----\n\nThey then created a [package named klown that impersonated the (later compromised) ua-parser-js library:](https://archive.is/wip/dNDKz)\n\n[The malicious code in this package is an earlier version of the code actually deployed live – it has a couple of small changes](https://www.diffchecker.com/4bgZFxLj)\nsuch as a different Monero wallet ID:\n\n\n-----\n\n(Earlier prototype of the code on the left. The right hand side shows the code deployed in the attack)\n\nWhen Sonatype published their blog on October 20th (two days before the real attack) they noted that – at that point – it wasn’t\nclear how the attackers intended on deploying their malicious package:\n\nIn hindsight – it’s now clear that this was the user wozheqirsplu preparing for their attack.\n\n**Recommendations**\n\n[Assume that any machine that has run compromised versions is compromised, and rotate and credentials or keys on the](https://github.com/advisories/GHSA-pjwm-rvh2-c87w)\nmachine from a separate machine.\n\nWhen deploying software, check for compromised dependencies as part of any build process.\n\n**Indicators of Compromise**\n\n185.173.36[.]219\n\n159.148.186[.]228\n\ncitationsherbe[.]at – Note this is also referenced in https://unit42.paloaltonetworks.com/matanbuchus-malware-as-a-service/ – we\nhaven’t confirmed the nature of the link yet.\n\nhttp://185.173.36[.]219/download/\n\nhttp://185.173.36[.]219/download/jsextension.exe\n\nhttp://185.173.36[.]219/download/xmrig.exe\n\nhttp://185.173.36[.]219/download/jsextention.exe\n\nhttp://185.173.36[.]219/\n\nhttp://185.173.36[.]219/download/jsextension\n\nhttp://185.173.36[.]219:81/download/lin64\n\nhttp://159.148.186[.]228/download/jsextension\n\nhttp://159.148.186[.]228/download/jsextension.exe\n\nhttps://159.148.186[.]228/sdd.dlll\n\nhttps://159.148.186[.]228/jsextension.exe\n\nhttps://159.148.186[.]228/download/jsextension.exe\n\nhttp://159.148.186[.]228/download/jsextension.exe\n\nhttp://159.148.186[.]228/jsextension.exe\n\nhttp://159.148.186[.]228/download/jsextention.exe\n\nhttp://159.148.186[.]228/download/\n\nhttps://citationsherbe[.]at/sdd.dll\n\nhttps://citationsherbe[.]at/create.dll\n\nhttp://citationsherbe[.]at:8080/sdd.dll\n\n\n-----\n\nhttps://citationsherbe[.]at/dog.dll\nhttps://citationsherbe[.]at/sdd.dl\nhttp://citationsherbe[.]at/sdd.dll\n\n**About Cado Security**\n\nCado Security provides the cloud investigation platform that empowers security teams to respond to threats at cloud speed. By\nautomating data capture and processing across cloud and container environments, Cado Response effortlessly delivers forensiclevel detail and unprecedented context to simplify cloud investigation and response. Backed by Blossom Capital and Ten Eleven\nVentures, Cado Security has offices in the United States and United Kingdom. For more information, please visit\n[https://www.cadosecurity.com/ or follow us on Twitter](https://www.cadosecurity.com/) [@cadosecurity.](https://twitter.com/CadoSecurity)\n\n[Prev Post](https://www.cadosecurity.com/azure-omi-vulnerability-omigod-cve-2021-38647-now-under-exploitation/) [Next Post](https://www.cadosecurity.com/automate-incident-response-with-the-new-tines-and-cado-response-integration/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-10-23 - Links to Previous Attacks in UAParserJS Compromise.pdf"
    ],
    "report_names": [
        "2021-10-23 - Links to Previous Attacks in UAParserJS Compromise.pdf"
    ],
    "threat_actors": [
        {
            "id": "d9b39228-0d9d-4c1e-8e39-2de986120060",
            "created_at": "2023-01-06T13:46:39.293127Z",
            "updated_at": "2025-03-27T02:00:03.042341Z",
            "deleted_at": null,
            "main_name": "BelialDemon",
            "aliases": [
                "Matanbuchus"
            ],
            "source_name": "MISPGALAXY:BelialDemon",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535684,
    "ts_updated_at": 1743041820,
    "ts_creation_date": 1653765589,
    "ts_modification_date": 1653765589,
    "files": {
        "pdf": "https://archive.orkl.eu/990c42443437b5386b55f6a4e38732cced427d1d.pdf",
        "text": "https://archive.orkl.eu/990c42443437b5386b55f6a4e38732cced427d1d.txt",
        "img": "https://archive.orkl.eu/990c42443437b5386b55f6a4e38732cced427d1d.jpg"
    }
}