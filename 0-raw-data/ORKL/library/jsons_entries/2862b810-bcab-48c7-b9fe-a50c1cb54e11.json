{
    "id": "2862b810-bcab-48c7-b9fe-a50c1cb54e11",
    "created_at": "2023-01-12T15:06:27.487698Z",
    "updated_at": "2025-03-27T02:16:41.145732Z",
    "deleted_at": null,
    "sha1_hash": "1fcaf224ad8b3df08ffa40f60aa0600f62af7768",
    "title": "2016-04-13 - Ghosts in the Endpoint",
    "authors": "",
    "file_creation_date": "2022-05-28T18:00:12Z",
    "file_modification_date": "2022-05-28T18:00:12Z",
    "file_size": 3859207,
    "plain_text": "# Ghosts in the Endpoint\n\n**[fireeye.com/blog/threat-research/2016/04/ghosts_in_the_endpoi.html](https://www.fireeye.com/blog/threat-research/2016/04/ghosts_in_the_endpoi.html)**\n\nWe would like to introduce the first of our “Ghosts in the Endpoint” series, a report prepared\nby FireEye Labs that documents malicious software not being detected in the wild by\ntraditional signature-based detections.\n\nIn this study, all the families identified are samples from VirusTotal (VT) with zero detections,\nbut detected as malicious by our Multi-Vector Virtual Execution (MVX) Engine. We also\nadded a few samples with very low detection rates (VT <=3) but with interesting bypass\ntechniques.\n\nOur goal is to share indicators that help the AV community and others improve their detection\ncoverage.\n\n**Scope**\n\nSo far, only samples found in VT with the following file types were included in this\nstudy:\nWin32 binaries\nOffice documents (including Open XML format)\nRTF documents\nHangul Word Processor (HWP)[1] documents\n\n\n-----\n\nThe study includes samples submitted to VT in 2015 that were still found undetected or with\nminimal detection rates as of January 2016 (see VT detection Tables in the Appendix).\n\n**Findings**\n\nThe following samples were identified in our research:\n\n**Suspected APT malware:**\n\n1. GOODTIMES backdoor: Suspected APT; MS Office with Embedded Hacking Team\n\nFlash Exploit\n2. UPS backdoor: Suspected APT3\n3. VBA Macro + Metasploit Shellcode Loader: Suspected Middle Eastern-based APT\n4. Hancom Office HWP Exploit: Possible APT targeting of South Korea.\n\n**Malware without attribution:**\n\n1. OccultAgent: (New) Code hidden in Excel spreadsheet\n2. Spy-Net RAT: Targeting Brazilian victims\n3. VBA Macros + PowerShell scripts: Netcat Backdoor\n4. VBA Macros + Python scripts: Metasploit Shellcode Loader\n5. Office Downloader\n\n**Detailed Sample Analysis**\n\nMalware that remains undetected by more than 56 different AV vendors over a long period of\ntime is worth investigating. This section briefly describes the malware and techniques\nidentified in the undetected samples. A full list of indicators can be found in the IOC section\nat the end.\n\n**1. 4b3858c8b35e964a5eb0e291ff69ced6 - 201507.xlsx**\n\nType: XLSX\nDescription: CVE-2015-5119 (Flash exploit exposed in the Hacking Team leak)\nAttribution: Suspected APT threat group targeting Taiwan\nCurrent detection: 0/53\nFirst Submission: July 13, 2015\nLast Submission: January 27, 2016\nTime undetected in VT: At least 6 months\n\nThis Excel document is PKZIP compressed (following the Open XML Format) with the\nstructure shown in Figure 1:\n\n\n-----\n\nFigure 1: Structure of XLSX document\n\nWhen the spreadsheet is opened, a dialog prompts the victim to allow unknown embedded\ncontent to be played, as shown in Figure 2. In this case, social engineering is needed to\nconvince the victim to execute the malicious Flash object.\n\nFigure 2: Excel document content and prompt\n\n\n-----\n\nWhen the victim allows the embedded content to be played, the activeX1.xml file is read to\nlocate the OLE Control to be used (which corresponds to Macromedia Flash Player, as\nshown in Figure 3) through the ClassID attribute to finally load the Flash Exploit embedded in\nthe activeX1.bin object.\n\nFigure 3: Content of activeX1.xml file\n\nThe embedded Flash exploit corresponds to CVE-2015-5119, one of several zero-day\nexploits identified following the Hacking Team leak in July 2015.[2]\n\nA look at the Flash Action Script (AS) reveals code similar to that from the Hacking Team\nExploit, such as the class name exp1_fla/MainTimeLine, the function name TryExpl() with the\nsame use-after-free technique, and even the same error message “can’t cause UaF” as\nshown in Figure 4.\n\n\n-----\n\nFigure 4: Flash exploit code\n\nThe combination of the class name exp1_fla() and classes ShellMac64, ShellWin32 and\nShellWin64 built into the exploit (see Figure 5) were not observed in the original Hacking\nTeam version of the exploit, suggesting that the group responsible for this malicious Excel file\nmodified the original exploit code.\n\n\n-----\n\nFigure 5: Flash Action Script classes from malicious Excel file\n\nThe exploit drops a variant of the backdoor we call GOODTIMES (also known as Linopid).\nThe backdoor communicates to Taiwan-based IP addresses 220.128.223.75 and\n220.134.47.67 on ports 8080 and 443 via HTTP.\n\nWhile this particular GOODTIMES sample has not been attributed to a specific threat group,\nGOODTIMES has previously been used by suspected APT actors. Based on previously\nidentified targets and the use of Traditional Chinese language and Taiwan-centric themes in\nspear phishing messages and decoy documents, the group appears to focus on Taiwanese\ntargets.\n\n**Potential AV bypassing reason**\n\n\n-----\n\n1.   New delivery mechanism: The leaked CVE-2015-5119 Flash exploit has been used by a\nwide range of threat groups, including other APT groups such as APT3 and APT18[3].\nPrevious delivery methods entailed luring the victim to click on a malicious link (delivered via\na spear phishing message) where the malicious Flash exploit was hosted on a web page. In\nthis case, the suspected APT group responsible for the GOODTIMES backdoor changed the\n**delivery mechanism by embedding the exploit as ActiveX object inside the Excel Open**\nXML Format (PKZIP compressed).\n\n2.   In addition, while an ActiveX object would normally be embedded inside a Compound\nFile Binary Format[4], in this case the uncompressed Flash content is embedded directly in\nthe Excel file, right after the ClassID, as shown at Figure 6.\n\nFigure 6: Embedded Flash object\n\n-   The above steps might be enough to avoid proper parsing of the malicious Flash object.\nThis is the first time we have seen a CVE-2015-5119 sample embedded in an Excel\ndocument this way.\n\n**2. 22da029dd4e018b7c7135a03d0ba9b99**\n\nType: Win32 binary\n\nDescription: A variant of the UPS backdoor\n\nAttribution: suspected APT3\n\nCurrent detection: 0/57\n\nFirst Submission: August 6, 2015\n\nLast Submission: February 2, 2016\n\nTime undetected in VT: At least 6 months\n\nUPS is a backdoor capable of uploading and downloading files, creating a reverse shell,\nreconfiguring itself to use different command and control (CnC) servers, and acting as a\nproxy server. It uses a custom binary protocol to communicate with its CnC server and it\nencrypts this custom protocol using a TLS TCP connection.\n\nWhile this particular UPS sample has not been attributed, UPS is commonly used by the\nChina-based APT3.\n\n**Potential AV bypassing reason**\n\n\n-----\n\n1.   Junk code insertion: Examining this UPS sample, we see a significant amount of junk\ncode” potentially designed to mask the malicious nature of the binary, as well as to\ncomplicate analysis or reverse engineering efforts.\n\nIn Figure 7 we see the backdoor executing a jump to address 0x4043AB by forcing the “jump\nif greater than” comparison to be true by moving a large value (0x4A2E88E4) to the ebx\nregister and then comparing it with a hardcoded lower value (0x6A1E839), after which a\nlarge number of junk instructions are skipped (red square). This strategy can be seen\nthrough several different execution paths.\n\nFigure 7: Decompiled UPS sample showing junk code\n\n**3. aedd5d8446cc12ddfdc426cca3ed8bf0 - S-old.xlsb**\n\nType: XLSB\n\nDescription: VBA Macro + Metasploit Shellcode Loader Backdoor\n\nAttribution: Suspected Middle Eastern-based APT\n\nCurrent detection: 1/52\n\n\n-----\n\nFirst Submission: September 28, 2015\nLast Submission: January 28, 2016\nTime undetected in VT: At least 4 months\n\nThis particular sample, an Excel Binary Workbook file,[5] has only one generic detection on\nVT, so we believe it is still worth mentioning in this report.\n\nWhen the spreadsheet is opened, the victim is shown a table of Israeli holidays and\nprompted to enable macros to view the full list, as shown in Figure 8:\n\nFigure 8: Malicious Excel file showing calendar data\n\nWhen the macro is executed it creates a Windows binary in memory as shown in Figure 9.\nNote the Chr(77) + Chr(90) builds the MS-DOS header magic number “MZ”.\n\nFigure 9: Macro concatenating bytes to form a Windows binary\n\nThe binary is written to the file system with the file name NTUSER.dat{GUID}.exe as shown\nin Figure 10.\n\n\n-----\n\nFigure 10: Creating the Windows binary\n\nIn this case, the GUID selected corresponds to Scriptlet.TypeLib ActiveX object, creating the\nfile name NTUSER.dat{FB9D87AE-8FEA-4583-98AB-2FB396EAB5FC}.exe (md5\n6aab47b18afacbfa7423f09bd1fa6d25) that is later executed via the ShellExecute() API with\nthe SW_HIDE parameter to run silently.\n\nFinally, the executable comes with an embedded Metasploit Shellcode loader that connects\nto 84.11.146.62 on port TCP 13661.\n\nWhile this sample has not been attributed, similar techniques (use of XLSB files with\nembedded, obfuscated macros; creation of the file name NTUSER.dat{GUID}.exe; use of the\nbinary to download additional malware) and the same CnC IP address have been referenced\nin reporting on a suspected Middle Eastern-based APT group known as “Rocket Kitten”,\nprimarily targeting Middle Eastern and European organizations.\n\n**Potential AV bypassing reason**\n\n1.   The byte concatenation inside the VBA Macro, used to build a Win32 binary at runtime,\nhelps to bypass signature-based detection.\n\n**4. 4e51143b01e99afc3bd908794d81d3cb**\n\nType: HWP\n\nDescription: Hancom Office HWP Exploit\n\nAttribution: None\n\nCurrent detection: 3/53\n\nFirst Submission: July 31, 2015\n\nLast Submission: February 2, 2016\n\nTime undetected in VT: At least 6 months with 3 generic detections\n\nThis sample, a Hangul Word Processor (HWP) document, has only three generic detections\non VT, so we found it to be worth analyzing for this report.\n\nWhen opened, the HWP document displays Korean text and some photographs, as shown in\nFigure 11. Behind the scenes the document will exploit vulnerable versions of Hancom\nOffice, dropping and executing a malicious file.\n\n\n-----\n\nFigure 11: Content of malicious HWP document\n\nInternally, the document structure includes three sections, where section 0 will trigger a Type\nConfusion vulnerability while parsing the content of the paragraph located at the data record\nstructure HWPTAG_PARA_TEXT starting at offset 0x1C (see uncompressed section 0 at\nFigure 12). The logic bug will cause the string starting at offset 0x50 to be treated as a\ncontrol structure. This control structure contains a fake object at offset 0x56 pointing to an\naddress (0x0e0a0e0a) filled by a heap spray that eventually will redirect the execution flow to\nthe shellcode.\n\n\n-----\n\nFigure 12: Section0 malformed paragraph\n\nA similar type confusion vulnerability has been previously documented by Ahnlab,[6]\nhowever, the vulnerability trigger is different.\n\nSection 2 has an uncompressed size equal to 112MB, used to perform the heap spray and\nexpecting to place the shellcode at a memory address close to 0x0e040e04. In Figure 13,\nthe beginning of the shellcode can be seen (uncompressed).\n\nFigure 13: Start of shellcode\n\nThe shellcode drops a file on disk and executes it via HncBLXX.HncShellExecute->\nSHELL32.ShellExecute. This generates a connection to a compromised Korean automotive\nwebsite and attempts to retrieve a file with a .JPG extension, which we suspect may be a\nsecond-stage binary. However, the file was no longer available on the website at the time of\nour analysis.\n\nThis particular sample has not been attributed to any threat group. However, the use of\nmalicious HWP documents is notable, as that format is specific to a regional word processing\nprogram used heavily in South Korea and in particular by the South Korean government.\nWhile the use of malicious HWP files could simply indicate regional targeting by unspecified\nthreat actors, similar exploits have been used in the past by suspected APT groups.\n\n**Potential AV bypassing reason**\n\n1.   Heap Spray technique change: Similar exploits used to be created with multiple largesize sections in order to spray the heap. This exploit fulfills the same purpose but with only\none large-size section.\n\n\n-----\n\n2.   Vulnerability triggered in a different format: A similar type confusion vulnerability\ndescribed in this section was seen implemented in the Open XML Format (HWPX extension)\n\n[7], but this time ported to the Compound File Binary Format (HWP extension).\n\n**5. 497eddab53c07f4be1dc4a8c169261a5 - Barclays_Q22015_IMS_excel_tables.xlsm**\n\nType: XLSM\nDescription: VBA Macro + VBScript generated from spreadsheet\nAttribution: None\nCurrent detection: 1/54\nFirst Submission: Julio 08, 2015\nLast Submission: January 27, 2016\nTime undetected in VT: At least 7 months\n\nThis sample, an Excel macro-enabled file, has only one generic detection. The embedded\nmacro creates an encoded Visual Basic (VBE) file that connects to a CnC site and allows\nremote control of the victim’s computer. As we had not previously observed this backdoor, we\nnamed it OccultAgent.\n\nWhen the XLSM file is opened, the user is prompted to enable macros, as shown in Figure\n14. The instructions are displayed in both English and Greek:\n\nFigure 14: Prompt to enable macros\n\n\n-----\n\nThe macro drops an encoded VBScript file named ocagent.vbe\n(69df0c3bab5e681c2e5eb5951a64776e), obtained from the data in a spreadsheet cell (see\nFigure 15), to C:\\octemp001\\ and executes it. The script connects to hxxp://0x5E469BFD,\nwhich is equivalent to hxxp://94.70.155.253, via the victim’s web browser.\n\nFigure 15: Obfuscated script embedded in spreadsheet cell\n\n\n-----\n\nThe first stage Macro source code can be seen in Figure 16.\n\nFigure 16: Embedded VBA macro\n\nThe dropped ocagent.vbe VBScript is essentially a backdoor that connects to the CnC server\nat 94.70.155.253 to register the victim’s computer and to obtain commands to run on the\nvictim’s machine.\n\n\n-----\n\n**Potential AV bypassing reason**\n\nThe following steps may be sufficient to bypass AV detection:\n\n1.   Adding encoded VB script into a spreadsheet cell allows attackers to hide the malicious\ncode.\n\n2.   Representing the IP address in hexadecimal format may be sufficient to bypass regular\nexpressions trying to match standard 32-bit IP addresses (dotted decimal notation).\n\n**6. dc15336e7e4579c9c04c6e4e1f11d3dd - dedinho no cuzinho.rtf**\n\nType: RTF\nDescription: RTF file with embedded executable\nAttribution: None\nCurrent detection: 0/54\nFirst Submission: October 22, 2015\nLast Submission: January 15, 2016\nTime undetected in VT: At least 3 months\n\nIn this attack scenario, the victim receives an RTF document that appears to contain an\nembedded JPG image. The embedded file is actually an executable that attempts to hide its\nfile extension by using a long sequence of underscore characters (e.g., Copy of\n\n\n-----\n\nfoto.jpg<underscores>.exe (see Figure 17).\n\nFigure 17: RTF document with embedded file\n\nThe embedded binary (d409dc7e1ca0c86cb71e090591f16146) is packed with RLPack[8]. It\ndrops a second Borland Delphi binary packed with a customized version of UPX, which will\nthen drop the Spy-Net RAT on the system.\n\nSpy-Net[9] allows an attacker to interact with the victim via a remote shell to\nupload/download files, interact with the registry, run processes and services, capture images\nof the desktop, and record from the webcam and microphone. It also contains functionality to\nextract saved passwords and turn the victim into a proxy server.\n\nA beacon to dennyhacker[.]no-ip.org on TCP port 81 prepended with an ASCII\nrepresentation of the length of the payload (33) and followed by a pipe and a new line\ncharacter confirms Spy-Net activity:\n\n00000000 33 33 7c 0a                   33|.\n\nThe RAT commands are translated to Portuguese to adapt the attack to Brazilian victims;\nsome command examples are shown below (additional commands are listed in the\nAppendix):\n\n\n-----\n\nConfiguracoesdoserver = Server settings\nListarjanelas = List windows\nFinalizarconexao = End connection\nListarchaves = List keys\n\n**Potential AV bypassing reason**\n\n1.   Packers are commonly used to obfuscate code in order to bypass traditional signaturebased detection. The use of multiple files packed with two different packers may be sufficient\nto bypass detection.\n\n**7. b1f43ca11dcf9e60f230b9d6d332c479 – Book2 - Copy.xls**\n\nType: XLSX\nDescription: VBA + Python Shellcode loader\nAttribution: None\nCurrent detection: 0/54\nFirst Submission: September 20, 2015\nLast Submission: January 28, 2016\nTime undetected in VT: At least 6 months\n\nWhen opened, this Excel document appears to be blank but contains the VBA macro shown\nin Figure 18.\n\nFigure 18: VBA Macro with OLE Object\n\nThe macro will instantiate an OLE Object and load it via the xlVerbPrimary verb. The\nembedded OLE object contains two files:\n\npython27.dll (md5 7e6dd0d7cb29103df4a592e364680075) - a legitimate file\nfile.exe (md5 73f16dbf535042bc40e9c663fe01c720) - a binary created with py2exe[10]\n\n\n-----\n\nOnce file.exe is executed it launches a copy of the Windows calculator (calc.exe) as a decoy.\nHowever, behind the scenes it performs a Metasploit reverse TCP Connect to a CnC server.\n\nThe unpacked version of file.exe is obfuscated python that can be seen in Figure 19.\n\nFigure 19: Python Shellcode\n\nThe following steps describe the process in greater detail:\n\nFile.exe spawns a copy of calc.exe.\nBase64-decode and AES-decrypt embedded shellcode.\nVia Python ctypes, the environment is set to run the shellcode loader in memory.\nThe shellcode loader, which has been encoded with the Metasploit Shikata encoder,\n\n[11] is configured to connect to the host 31.168.144.18 on port 443.\nThe malware sleeps for 60 seconds and starts again.\n\n**Potential AV bypassing reason**\n\nMultiple tricks to evade detection can be seen here:\n\n1. The file extension of the document is .xls. However, the file is actually an Open XML\n\nFormat file (.xlsx). This simple trick may bypass extension-based parsers.\n2. The Embedded OLE object contains a legitimate binary (python27.dll) and a py2exe\n\nexecutable may appear to be a legitimate file.\n3. The malicious python script is packed using py2exe.\n4. The Embedded OLE object is extracted from a hidden Sheet3, so the VBA Macro may\n\nnot appear malicious.\n5. The shellcode is Base64 encoded and AES encrypted.\n\n**8. 95e89fd65a63e8442dcf06d4e768e8f1 - Doc1.docm**\n\nType: DOCM\n\nDescription: VBA + PowerShell + Netcat as Backdoor\n\nAttribution: None\n\nCurrent detection: 0/53\n\n\n-----\n\nFirst Submission: June 19, 2015\nLast Submission: January 26, 2016\nTime undetected in VT: At least 7 months\n\nThe word document comes with a simple message shown in Figure 20.\n\nFigure 20: Message distractor\n\nWhen the VBA macro is executed (see Figure 21), PowerShell code is loaded from the\ndocument’s comments (see Figure 22):\n\nFigure 21: Loading malicious code\n\n\n-----\n\nFigure 22: Code embedded in the document comments\n\nThe PowerShell script will act as a backdoor to allow remote access to the compromised\nmachine. The script will download and execute netcat to listen on IP 192.168.52.129 and\nport 3724. Once a connection is received, a PowerShell shell will be sent (via –e\npowershell.exe option) to the client (PowerShell Reverse shell) as shown in Figure 23.\n\nFigure 23: Malicious code content\n\n\n-----\n\nIt is interesting to note that attackers are moving from traditional command prompt shells\n(cmd.exe) to PowerShell shells (powershell.exe), which are actually more powerful. For\nexample, PowerShell allows the use of WMI (Windows Management Instrumentation),\nsomething not readily accessible via the standard command prompt[12].\n\nThe script references a non-routable (RFC1918) IP address, so we suspect that the script\nwas either a proof of concept or meant to be used during the lateral movement phase in a\nspecific internal environment that uses this IP space.\n\n**Potential AV bypassing reason**\n\n1.   Use of the .docm extension may evade extension-based parsers.\n\n2.   Embedding the PowerShell script in the document’s comments and executing it from a\nVB macro adds another layer of complexity. While this is clearly a suspicious behavior, it is\nnot properly identified by signature-based detection.\n\nWe identified several other examples of malware using VBA Macros with PowerShell to\nmainly run shellcode loaders that allow attackers to gain remote access to victims’ machines.\nAnother example is shown below; it has two VT detections, but serves as an example of a\nvery common variant seen in the wild.\n\n**9. 8de1ebacb72f3b23a8235cc66a6b6f68 – Polnoe_raspisanie_igr.xlsm**\n\nType: XLSM\nDescription: VBA Macro + PowerShell – Shellcode Loader\nAttribution: None\nCurrent detection: 2/54\nFirst Submission: October 14, 2015\nLast Submission: January 28, 2016\nTime undetected: 3.5 months with two generic detections\n\nWhen the Excel document is opened, a message is displayed in Russian. The user is even\nprovided with a link to a legitimate article describing how to enable macros (see Figure 24).\n\n\n-----\n\nFigure 24: Excel file with legitimate link\n\nWhen the VBA Macro runs, it executes a PowerShell script that Base64-decodes and\ndecompresses a second-stage PowerShell Script that will be used as the shellcode loader in\nmemory (see Figure 25).\n\nFigure 25: PowerShell script being built on the fly via VB script\n\nPowerShell uses the Invoke-Expression (or IEX) call to execute the decompressed string,\nsimilar to the eval() functionality from other programming languages.\n\nThe Shellcode in this case comes hardcoded in the second stage PowerShell script, loaded\nand executed from memory with the following syntax:\n\n$z=$o::CreateThread(0,0,$x,0,0,0); Start-Sleep -Second 100000\n\n\n-----\n\nWhere $x contains the Shellcode loaded in memory that eventually will connect to the\ndomain spl[.]noip[.]me. Based on DNSDB query, the domain spl[.]noip[.]me previously\nresolved to Russian IP 81.23.177.72.\n\nMost of the VBA Macro + PowerShell scripts we identified were created with the\nmacro_safe.py[13] and unicorn.py[14] scripts, often used for penetration testing.\n\n**Potential AV bypassing reason**\n\n1.   The .xlsm extension may bypass extension-based parsers\n\n2.   Using the VBA Macro in the first stage to build the first PowerShell script via\nconcatenation provides an easy way to bypass signature-based detection\n\n3.   The PowerShell scripts are Base64 encoded and compressed\n\n**10. cda305a6a6c6ace02597881b01a116e3 - CVE-2013-1331-doc.docx**\n\nType: DOCX\nDescription: Office Downloader\nAttribution: None\nCurrent detection: 0/55\nFirst Submission: January 12, 2015\nLast Submission: January 16, 2016\nTime undetected in VT: The whole year and counting!\n\nIn 2013, a stack-based buffer overflow triggered while parsing PNG images was exploited in\nthe wild against MS Office 2003 and Office for Mac. CVE-2013-1331 was assigned to the\nvulnerability.\n\nThe malicious samples did not include the PNG directly embedded in the document; rather,\nthe PNG file was loaded from the Internet by using the INCLUDEPICTURE option[15].\n\nThis new sample uses a different option from the new XML Format called “Relationships” in\norder to download a resource from the Internet, as seen at Figure 26.\n\nFigure 26: XML content loading the PNG image remotely\n\n\n-----\n\nThe same domain was used back in 2013, but now with a different download technique.\nAlthough the vulnerability has been patched by Microsoft, the aforementioned technique can\nbe used to download any resource from the Internet.\n\n**Potential AV bypassing reason**\n\n1.   Use of the XML ‘Relationship’ instead of the original INCLUDEPICTURE method to\ndownload resources from the Internet is a novel technique that may not be recognized.\n\n2.   Based on the code shown above, it is clear that the intention is not to download a .gif\nimage but a .php resource. Signature-based engines should easily detect the unusual\nresource name with multiple dots.\n\n**Conclusion**\n\nThreat actors of all types continue to improve their techniques to compromise organizations\nand remain undetected within an environment. Our study identified a number of techniques\nthat successfully bypassed many AV engines:\n\n1.   Alternate techniques to embed objects within Office documents that may not be\nrecognized by AV engines.\n\n2.   The use of a multi-stage infection approach in order to look unsuspicious at each stage:\n\na.   A document downloading an image from the Internet that cannot be flagged as\nmalicious at that stage\nb.   A VBA Macro script loading malicious content from spreadsheet cells\n\n3.   Multiple techniques to load malicious content from Office documents:\n\na.   Embedded as ActiveX\nb.   Embedded as OLE Binary\nc.   Embedded in the document’s comments\nd.   Embedded in the spreadsheet cell\n\n4.   Standalone packed binaries containing malicious Python scripts.\n\n5.   Multi-layer Packing: RLPack + Custom UPX.\n\n6.   The combination of multiple scripting languages to allow the attackers to obfuscate\nmalicious code, such as VBA Script building malicious PowerShell scripts.\n\nIn several cases we note that the attackers are reusing known exploits (such as CVE-20155119 or CVE-2013-1331), but changing the delivery method; or leveraging obfuscation,\nencoding, encryption, or multiple layers of packing to disguise their malicious scripts or\nbackdoors.\n\n\n-----\n\nFor proper detection, it is essential to monitor an attack through its entire life cycle – not\nsimply when a suspicious document or file first enters a network. This approach is necessary\nto detect and block multi-stage infection strategies. While initial events (such as the delivery\nof a macro-enabled spreadsheet) may appear innocuous, eventually a later stage of the\nattack will trigger detection.\n\nIt is much easier to stop an attack – including a multi-stage attack – when it first occurs, to\ninclude detecting known and unknown exploits (zero days), or even threats that require user\ninteraction such as macros inside documents.\n\nThis detection approach is the core logic behind FireEye Multi-Vector Virtual Execution\n(MVX) technology.\n\n**APPENDIX**\n\n**Indicators of Compromise - IOCs**\n\n**Network Based:**\n\n**4b3858c8b35e964a5eb0e291ff69ced6**\n\nPOST /0000/a242550.asp\nIP: 220.128.223.75\nTCP Port: 8080\n\n**4e51143b01e99afc3bd908794d81d3cb**\n\nGET /bbs/file/machinery/machine_body.jpg\nIP: cncauto.co.kr\nPORT: 80\n\n**8de1ebacb72f3b23a8235cc66a6b6f68**\n\nIP: spl.noip.me\nTCP Port: 80\n\n**b1f43ca11dcf9e60f230b9d6d332c479**\n\nIP: 31.168.144.18\nTCP Port: 443\n\n**aedd5d8446cc12ddfdc426cca3ed8bf0**\n\nIP: 84.11.146.62\nTCP Port: 13661\n\n**497eddab53c07f4be1dc4a8c169261a5**\n\n\n-----\n\nGET /ocagnt/gethooks.asp\nIP: 94.70.155.253\nTCP Port: 80\nGET /ocagnt/enckeys\nIP: 94.70.155.253\nTCP Port: 80\nGET /ocagnt/getstatus.asp\nIP: 94.70.155.253\nTCP Port: 80\n\n**dc15336e7e4579c9c04c6e4e1f11d3dd**\n\nIP: dennyhacker.no-ip.org\nTCP Port: 81\n\n**Host-Based:**\n\ndc15336e7e4579c9c04c6e4e1f11d3dd\n\nC:\\Windows\\System32\\install\\server.exe (copy of dropped binary)\nd409dc7e1ca0c86cb71e090591f16146\n\n%AppData%\\Local\\Temp\\XX--XX--XX.txt\n\nMutex created:\n_x_X_PASSWORDLIST_X_x_\nx_X_BLOCKMOUSE_X_x_\n***MUTEX***\n***MUTEX***_PERSIST\n\n**497eddab53c07f4be1dc4a8c169261a5**\n\nc:\\octemp001\\\nC:\\octemp001\\enccmdresults.txt\nC:\\octemp001\\ikeycharvalue.txt\nC:\\octemp001\\enchostnameres.txt\nC:\\octemp001\\certutil.txt\nC:\\octemp001\\cert.txt\nC:\\octemp001\\commands.txt\nC:\\octemp001\\prevcommands.txt\nC:\\octemp001\\enccmdresults.txt\nC:\\octemp001\\enccmdresults2.txt\nc:\\octemp001\\key.txt\n\nFigure 27 shows the MD5s with zero detection detailed on this report.\n\n\n-----\n\nFigure 27: 2015 samples from VT with zero detections in 2016\n\nSome exceptions to this study were added for samples with low detection rates, but with only\ngeneric detection (that is, not detected as part of any specific code family), that used an\ninteresting technique or that were suspected of being used by an APT group (see Figure 28).\n\n\n-----\n\nFigure 28: Samples with low and / or generic detection\n\n**dc15336e7e4579c9c04c6e4e1f11d3dd – Brazilian RAT**\n\nSome interesting commands from the RAT in Portuguese language:\n\n0002A3A8: pingtest\n\n0002A3BC: tentarnovamente\n\n0002A3E0: mouseposition\n\n0002A3F8: keyboardkey\n\n0002A40C: webcaminactive\n\n0002A424: webcamgetbuffer\n\n0002A43C: webcam\n\n0002A44C: desktop\n\n\n-----\n\n0002A45C: stopsearch\n\n0002A470: listarvalores\n\n0002A488: maininfo\n\n0002A49C: configuracoesdoserver\n\n0002A4BC: disconnect\n\n0002A4D0: uninstall\n\n0002A4E4: renameservidor\n\n0002A4FC: enviarexecnormal\n\n0002A518: enviarexechidden\n\n0002A534: executarcomandos\n\n0002A550: openweb\n\n0002A560: downexec\n\n0002A574: resumetransfer\n\n0002A58C: listardrives\n\n0002A5A4: listararquivos\n\n0002A5BC: execnormal\n\n0002A5D0: execinv\n\n0002A5E0: deletardir\n\n\n-----\n\n[1] Hangul Word Processor is a word processing application developed by South Korean\nsoftware firm Hancom.\n\n[2] http://www.securityweek.com/zero-day-exploits-leaked-hacking-team-breach\n\n[3] https://www.fireeye.com/blog/threat-research/2015/07/demonstrating_hustle.html\n\n[4] https://msdn.microsoft.com/en-us/library/dd942138.aspx\n\n[5] An XLSB file is stored in binary format instead of the normal XML format, allowing the file\nto be read from and written to much faster. See https://technet.microsoft.com/enus/library/dd797428.aspx\n\n[6] http://asec.ahnlab.com/1035\n\n[7] https://www.fireeye.com/content/dam/fireeye-www/global/en/blog/threatresearch/FireEye_HWP_ZeroDay.pdf\n\n[8] http://www.pcworld.com/product/997528/rlpack-basic-edition.html\n\n[9] https://www.fireeye.com/blog/threat-research/2014/07/the-little-signature-that-could-thecurious-case-of-cz-solution.html\n\n[10] Py2Exe is a distutils extension to create standalone windows programs from python\nscripts. See https://sourceforge.net/projects/py2exe/.\n\n[11] https://github.com/rapid7/metasploitframework/blob/master/modules/encoders/x86/shikata_ga_nai.rb\n\n[12] http://www.howtogeek.com/163127/how-powershell-differs-from-the-windows-commandprompt/\n\n[13] https://github.com/khr0x40sh/MacroShop/blob/master/macro_safe.py\n\n[14] https://raw.githubusercontent.com/trustedsec/unicorn/master/unicorn.py\n\n[15] http://blogs.technet.com/b/srd/archive/2013/06/11/ms13-051-get-out-of-my-office.aspx\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2016/2016-04-13 - Ghosts in the Endpoint.pdf"
    ],
    "report_names": [
        "2016-04-13 - Ghosts in the Endpoint.pdf"
    ],
    "threat_actors": [
        {
            "id": "e034b94b-9655-42c4-a72e-a58807dce299",
            "created_at": "2022-10-25T16:07:24.133537Z",
            "updated_at": "2025-03-27T02:02:10.118581Z",
            "deleted_at": null,
            "main_name": "Rocket Kitten",
            "aliases": [
                "Group 83",
                "NewsBeef",
                "Newscaster",
                "Operation Newscaster",
                "Operation Woolen-GoldFish",
                "Parastoo",
                "Rocket Kitten"
            ],
            "source_name": "ETDA:Rocket Kitten",
            "tools": [
                "CoreImpact (Modified)",
                "FireMalv",
                "Ghole",
                "Gholee"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "a3687241-9876-477b-aa13-a7c368ffda58",
            "created_at": "2022-10-25T16:07:24.496902Z",
            "updated_at": "2025-03-27T02:02:10.256629Z",
            "deleted_at": null,
            "main_name": "Hacking Team",
            "aliases": [],
            "source_name": "ETDA:Hacking Team",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "8faa11f5-2a14-479c-9ea8-3779e6de9749",
            "created_at": "2022-10-25T15:50:23.814205Z",
            "updated_at": "2025-03-27T02:00:55.551798Z",
            "deleted_at": null,
            "main_name": "Ajax Security Team",
            "aliases": [
                "Ajax Security Team",
                "Operation Woolen-Goldfish",
                "AjaxTM",
                "Rocket Kitten",
                "Flying Kitten",
                "Operation Saffron Rose"
            ],
            "source_name": "MITRE:Ajax Security Team",
            "tools": [
                "sqlmap",
                "Havij"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "c8aefee7-fb57-409b-857e-23e986cb4a56",
            "created_at": "2023-01-06T13:46:38.285223Z",
            "updated_at": "2025-03-27T02:00:02.79333Z",
            "deleted_at": null,
            "main_name": "APT18",
            "aliases": [
                "TG-0416",
                "SCANDIUM",
                "PLA Navy",
                "Wekby",
                "G0026",
                "DYNAMITE PANDA"
            ],
            "source_name": "MISPGALAXY:APT18",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "61c4ddc4-156b-4828-8570-0979da81f3d0",
            "created_at": "2022-10-25T16:47:55.593828Z",
            "updated_at": "2025-03-27T02:05:17.275161Z",
            "deleted_at": null,
            "main_name": "BRONZE MAYFAIR",
            "aliases": [
                "Gothic Panda ",
                "TG-0110 ",
                "APT3 "
            ],
            "source_name": "Secureworks:BRONZE MAYFAIR",
            "tools": [
                " HUC Proxy Malware (Htran)",
                " Pirpi",
                " SplitVPN",
                " ctt",
                " ctx",
                "Cookiecutter"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "2669aa86-663f-4e72-9362-9e61ff3599f4",
            "created_at": "2022-10-25T15:50:23.344796Z",
            "updated_at": "2025-03-27T02:00:55.448539Z",
            "deleted_at": null,
            "main_name": "APT18",
            "aliases": [
                "APT18",
                "TG-0416",
                "Dynamite Panda",
                "Threat Group-0416"
            ],
            "source_name": "MITRE:APT18",
            "tools": [
                "hcdLoader",
                "gh0st RAT",
                "cmd",
                "Pisloader",
                "HTTPBrowser"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "e90c06e4-e3e0-4f46-a3b5-17b84b31da62",
            "created_at": "2023-01-06T13:46:39.018236Z",
            "updated_at": "2025-03-27T02:00:02.978356Z",
            "deleted_at": null,
            "main_name": "Hacking Team",
            "aliases": [],
            "source_name": "MISPGALAXY:Hacking Team",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "761d1fb2-60e3-46f0-9f1c-c8a9715967d4",
            "created_at": "2023-01-06T13:46:38.269054Z",
            "updated_at": "2025-03-27T02:00:02.789278Z",
            "deleted_at": null,
            "main_name": "APT3",
            "aliases": [
                "TG-0110",
                "Group 6",
                "Buckeye",
                "Boyusec",
                "BORON",
                "BRONZE MAYFAIR",
                "Red Sylvan",
                "GOTHIC PANDA"
            ],
            "source_name": "MISPGALAXY:APT3",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "13354d3f-3f40-44ec-b42a-3cda18809005",
            "created_at": "2022-10-25T15:50:23.275272Z",
            "updated_at": "2025-03-27T02:00:55.418075Z",
            "deleted_at": null,
            "main_name": "APT3",
            "aliases": [
                "APT3",
                "Gothic Panda",
                "Pirpi",
                "UPS Team",
                "Buckeye",
                "Threat Group-0110",
                "TG-0110"
            ],
            "source_name": "MITRE:APT3",
            "tools": [
                "OSInfo",
                "schtasks",
                "PlugX",
                "LaZagne",
                "SHOTPUT",
                "RemoteCMD"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "b0261705-df2e-4156-9839-16314250f88a",
            "created_at": "2023-01-06T13:46:38.373617Z",
            "updated_at": "2025-03-27T02:00:02.817313Z",
            "deleted_at": null,
            "main_name": "Rocket Kitten",
            "aliases": [
                "Operation Woolen-Goldfish",
                "Thamar Reservoir",
                "Timberworm",
                "TEMP.Beanie",
                "Operation Woolen Goldfish"
            ],
            "source_name": "MISPGALAXY:Rocket Kitten",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "6fbff48b-7a3e-4e54-ac22-b10f11e32337",
            "created_at": "2022-10-25T16:07:23.318008Z",
            "updated_at": "2025-03-27T02:02:09.734465Z",
            "deleted_at": null,
            "main_name": "APT 4",
            "aliases": [
                "APT 4",
                "Bronze Edison",
                "Maverick Panda",
                "Salmon Typhoo",
                "Sodium",
                "Sykipot",
                "TG-0623",
                "Wisp Team"
            ],
            "source_name": "ETDA:APT 4",
            "tools": [
                "Getkys",
                "Sykipot",
                "Wkysol",
                "XMRig"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535987,
    "ts_updated_at": 1743041801,
    "ts_creation_date": 1653760812,
    "ts_modification_date": 1653760812,
    "files": {
        "pdf": "https://archive.orkl.eu/1fcaf224ad8b3df08ffa40f60aa0600f62af7768.pdf",
        "text": "https://archive.orkl.eu/1fcaf224ad8b3df08ffa40f60aa0600f62af7768.txt",
        "img": "https://archive.orkl.eu/1fcaf224ad8b3df08ffa40f60aa0600f62af7768.jpg"
    }
}