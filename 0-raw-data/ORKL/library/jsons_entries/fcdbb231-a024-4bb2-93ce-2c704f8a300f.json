{
    "id": "fcdbb231-a024-4bb2-93ce-2c704f8a300f",
    "created_at": "2023-01-12T15:04:09.515555Z",
    "updated_at": "2025-03-27T02:17:16.788532Z",
    "deleted_at": null,
    "sha1_hash": "78d96e5687811446d682835e4e45d9734c2be17d",
    "title": "2020-09-24 - Microsoft Security—detecting empires in the cloud",
    "authors": "",
    "file_creation_date": "2022-05-28T04:02:07Z",
    "file_modification_date": "2022-05-28T04:02:07Z",
    "file_size": 2292508,
    "plain_text": "# Microsoft Security—detecting empires in the cloud\n\n**[microsoft.com/security/blog/2020/09/24/gadolinium-detecting-empires-cloud/](https://www.microsoft.com/security/blog/2020/09/24/gadolinium-detecting-empires-cloud/)**\n\nSeptember 24, 2020\n\nMicrosoft consistently tracks the most advanced threat actors and evolving attack\ntechniques. We use these findings to harden our products and platform and share them with\nthe security community to help defenders everywhere better protect the planet.\n\nRecently, the Microsoft Threat Intelligence Center (MSTIC) observed the evolution of\nattacker techniques by an actor we call GADOLINIUM using cloud services and open source\ntools to enhance weaponization of their malware payload, attempt to gain command and\ncontrol all the way to the server, and to obfuscate detection. These attacks were delivered\nvia spear-phishing emails with malicious attachments and detected and blocked by Microsoft\nDefender, formerly Microsoft Threat Protection (MTP), and able to be detected using Azure\nSentinel.\n\nAs these attacks were detected, Microsoft took proactive steps to prevent attackers from\nusing our cloud infrastructure to execute their attacks and suspended 18 Azure Active\nDirectory applications that we determined to be part of their malicious command & control\ninfrastructure. This action helped transparently protect our customers without requiring\nadditional work on their end.\n\nGADOLINIUM is a nation-state activity group that has been compromising targets for nearly\na decade with a worldwide focus on the maritime and health industries. As with most threat\ngroups, GADOLINIUM tracks the tools and techniques of security practitioners looking for\nnew techniques they can use or modify to create new exploit methods.\n\n\n-----\n\nRecently, MSTIC has observed newly expanded targeting outside of those sectors to include\nthe Asia Pacific region and other targets in higher education and regional government\norganizations. As GADOLINIUM has evolved, MSTIC has continued to monitor its activity\nand work alongside our product security teams to implement customer protections against\nthese attacks.\n\nHistorically, GADOLINIUM used custom-crafted malware families that analysts can identify\nand defend against. In response, over the last year GADOLINIUM has begun to modify\nportions of its toolchain to use open-source toolkits to obfuscate their activity and make it\nmore difficult for analysts to track. Because cloud services frequently offer a free trial or onetime payment (PayGo) account offerings, malicious actors have found ways to take\nadvantage of these legitimate business offerings. By establishing free or PayGo accounts,\nthey can use cloud-based technology to create a malicious infrastructure that can be\nestablished quickly then taken down before detection or given up at little cost.\n\nThe following GADOLINIUM technique profile is designed to give security practitioners who\nmay be targeted by this specific actor’s activity insight and information that will help them\nbetter protect from these attacks.\n\n## 2016: Experimenting in the cloud\n\nGADOLINIUM has been experimenting with using cloud services to deliver their attacks to\nincrease both operation speed and scale for years. The image in Figure 1 is from a\nGADOLINIUM controlled Microsoft TechNet profile established in 2016. This early use of a\nTechNet profiles’ contact widget involved embedding a very small text link that contained an\nencoded command for malware to read.\n\n\n-----\n\n_Figure 1: GADOLINIUM controlled TechNet profile with embedded malware link._\n\n## 2018: Developing attacks in the cloud\n\nIn 2018 GADOLINIUM returned to using Cloud services, but this time it chose to use GitHub\nto host commands. The image in Figure 2 shows GitHub Commit history on a forked\nrepository GADOLINIUM controlled. In this repository, the actors updated markdown text to\nissue new commands to victim computers. MSTIC has worked with our colleagues at GitHub\nto take down the actor accounts and disrupt GADOLINIUM operations on the GitHub\nplatform.\n\n\n-----\n\n_Figure 2: GitHub repository controlled by GADOLINIUM._\n\n## 2019-2020: Hiding in plain sight using open source\n\n**GADOLINIUM’s evolving techniques**\n\nTwo of the most recent attack chains in 2019 and 2020 were delivered from GADOLINIUM\nusing similar tactics and techniques. Below is a summary view of how these attacks\ntechniques have evolved followed by a detailed analysis of each step that security\npractitioners can use to better understand the threat and what defenses to implement to\ncounter the attacks.\n\n\n-----\n\n**Weaponization**\n\nIn the last year, Microsoft has observed GADOLINIUM migrate portions of its toolchain\ntechniques based on open source kits. GADOLINIUM is not alone in this move. MSTIC has\nnoticed a slow trend of several nation-state activity groups migrating to open source tools in\nrecent years. MSTIC assesses this move is an attempt to make discovery and attribution\nmore difficult. The other added benefit to using open-source types of kits is that the\ndevelopment and new feature creation is done and created by someone else at no cost.\nHowever, using open source tools isn’t always a silver bullet for obfuscation and blending\ninto the noise.\n\n**Delivery & Exploitation (2019)**\n\nIn 2019, we discovered GADOLINIUM delivering malicious Access database files to targets.\nThe initial malicious file was an Access 2013 database (.accde format). This dropped a fake\nWord document that was opened along with an Excel spreadsheet and a file\ncalled mm.accdb.core which was subsequently executed. The file mm.accdb.core is a VBA\n[dropper, based on the CactusTorch VBA module, which loads a .NET DLL payload, sets](https://github.com/mdsecactivebreach/CACTUSTORCH/blob/master/CACTUSTORCH.vba)\nconfiguration information, and then runs the payload. Defender for Office 365 detects and\nblocks malicious Microsoft Access database attachments in email. A redacted example of\nthe configuration is displayed below.\n\n\n-----\n\n_Figure 3: VBA setting config and calling the “Run” function of the payload_\n\n**Command and Control (2019)**\n\nHaving gained access to a victim machine the payload then uses attachments to Outlook\nTasks as a mechanism for command and control (C2). It uses a GADOLINIUM-controlled\nOAuth access token with login.microsoftonline.com and uses it to call the Outlook Task API\nto check for tasks. The attacker uses attachments to Outlook tasks as a means of sending\ncommands or .NET payloads to execute; at the victim end, the malware adds the output from\nexecuting these commands as a further attachment to the Outlook task.\n\nInterestingly, the malware had code compiled in a manner that doesn’t seem to be used in\nthe attacks we saw. In addition to the Outlook Tasks API method described above, the extra\ncode contains two other ways of using Office365 as C2, via either the Outlook Contacts API\n(get and add contacts) or the OneDrive API (list directory, get and add a file).\n\n**Actions on Objective (2019)**\n\nGADOLINIUM used several different payloads to achieve its exploitation or intrusion\nobjectives including a range of PowerShell scripts to execute file commands (read/write/list\netc.) to enable C2 or perform SMB commands (upload/download/delete etc.) to potentially\nexfiltrate data.\n\nLazyCat, one of the tools used by GADOLINIUM, includes privilege escalation and credential\ndumping capability to enable lateral movement across a victim network. Microsoft Defender\nfor Endpoint detects the privilege escalation technique used:\n\n\n-----\n\nLazyCat performs credential dumping through usage of the MiniDumpWriteDump Windows\nAPI call, also detected by Microsoft Defender for Endpoint:\n\n**Delivery (2020)**\n\nIn mid-April 2020 GADOLINIUM actors were detected sending spear-phishing emails with\nmalicious attachments. The filenames of these attachments were named to appeal to the\ntarget’s interest in the COVID-19 pandemic. The PowerPoint file (20200423-sitrep-92-covid\n\n-----\n\n_19.ppt), when run, would drop a file, doc1.dotm. Similarly, to the 2019 example, Microsoft_\nDefender for Office detects and blocks emails with these malicious PowerPoint and Word\nattachments.\n\n**Command and Control (2020)**\nThe malicious doc1.dotm had two payloads which run in succession.\n\nThe first payload turns off a type\ncheck DisableActivitySurrogateSelectorTypeCheck which the second stage needs as\ndiscussed in this blog.\nThe second payload loads an embedded .Net binary which downloads, decrypts + runs\na .png file.\n\nThe .png is actually PowerShell which downloads and uploads fake png files using the\nMicrosoft Graph API to\n_[https://graph.microsoft.com/v1.0/drive/root:/onlinework/contact/$($ID)_1.png:/content where](https://graph.microsoft.com/v1.0/drive/root:/onlinework/contact/%24(%24ID)_1.png:/content)_\n$ID is the ID of the malware. The GADOLINIUM PowerShell is a modified version of the\n[opensource PowershellEmpire toolkit.](https://github.com/EmpireProject/)\n\n**Actions on Objectives (2020)**\nThe GADOLINIUM PowerShell Empire toolkit allows the attacker to load additional modules\nto victim computers seamlessly via Microsoft Graph API calls. It provides a command and\ncontrol module that uses the attacker’s Microsoft OneDrive account to execute commands\nand retrieve results between attacker and victim systems. The use of this PowerShell Empire\nmodule is particularly challenging for traditional SOC monitoring to identify. The attacker uses\nan Azure Active Directory application to configure a victim endpoint with the permissions\nneeded to exfiltrate data to the attacker’s own Microsoft OneDrive storage. From an endpoint\nor network monitoring perspective the activity initially appears to be related to trusted\napplications using trusted cloud service APIs and, in this scenario,, no OAuth permissions\nconsent prompts occur. Later in this blog post, we will provide additional information about\nhow Microsoft proactively prevents attackers from using our cloud infrastructure in these\nways.\n\n**Command and Control—Server compromise**\nGADOLINIUM campaigns often involve installing web shells on legitimate web sites for\ncommand and control or traffic redirection. Microsoft Defender for Endpoint detects web\nshells by analyzing web server telemetry such as process creation and file modifications.\n[Microsoft blogged earlier in the year on the use of web shells by multiple groups and how we](https://www.microsoft.com/security/blog/2020/02/04/ghost-in-the-shell-investigating-web-shell-attacks/)\ndetect such activities.\n\n\n-----\n\n_Figure 6: Microsoft Defender for Endpoint alerts of suspicious web shell attacks._\n\nWeb shell alerts from Microsoft Defender for Endpoint can be explored in Azure Sentinel and\nenriched with additional information that can give key insights into the attack. MSTIC’s Azure\nSentinel team recently published a blog outlining how such insights can be derived by\n\n\n-----\n\n[analyzing events from the W3CIISLog.](https://techcommunity.microsoft.com/t5/azure-sentinel/azure-sentinel-performing-additional-security-monitoring-of-high/ba-p/430740)\n\n**Microsoft’s proactive steps to defend customers**\nIn addition to detecting many of the individual components of the attacks through Microsoft’s\nsecurity products and services such as Microsoft Defender for Endpoint and for Microsoft\nDefender for Office as described above, we also take proactive steps to prevent attackers\nfrom using our cloud infrastructure to perpetrate attacks. As a cloud provider, Microsoft is\nuniquely positioned to disrupt this attacker technique. The PowerShell Empire scenario is a\ngood example of this. During April 2020, the Microsoft Identity Security team suspended 18\nAzure Active Directory applications that we determined to be part of GADOLINIUM’s\nPowerShell Empire infrastructure (Application IDs listed in IOC section below). Such action is\nparticularly beneficial to customers as suspending these applications protects all customers\ntransparently without any action being required at their end.)\n\nAs part of Microsoft’s broader work to foster a secure and trustworthy app ecosystem, we\nresearch and develop detection techniques for both known and novel malicious applications.\nApplications exhibiting malicious behavior are quickly suspended to ensure our customers\nare protected.\n\nGADOLINIUM will no doubt evolve their tactics in pursuit of its objectives. As those threats\ntarget Microsoft customers, we will continue to build detections and implement protections to\ndefend against them. For security practitioners looking to expand your own hunting on\nGADOLINIUM, we are sharing the below indicators of compromise (IOCs) associated with\ntheir activity.\n\n## List of related GADOLINIUM indicators\n\n**Hashes from malicious document attachments**\n\nfaebff04d7ca9cca92975e06c4a0e9ce1455860147d8432ff9fc24622b7cf675\n\nf61212ab1362dffd3fa6258116973fb924068217317d2bc562481b037c806a0a\n\n**Actor-owned email addresses**\n\nChris.sukkar@hotmail.com\n\nPhillipAdamsthird@hotmail.com\n\nsdfwfde234sdws@outlook.com\n\njenny1235667@outlook.com\n\nfghfert32423dsa@outlook.com\n\nsroggeveen@outlook.com\n\nRobertFetter.fdmed@hotmail.com\n\nHeather.mayx@outlook.com\n\n**Azure Active Directory App IDs associated with malicious apps**\n\n\n-----\n\nae213805-a6a2-476c-9c82-c37dfc0b6a6c\nafd7a273-982b-4873-984a-063d0d3ca23d\n58e2e113-b4c9-4f1a-927a-ae29e2e1cdeb\n8ba5106c-692d-4a86-ad3f-fc76f01b890d\nbe561020-ba37-47b2-99ab-29dd1a4312c4\n574b7f3b-36da-41ee-86b9-c076f999b1de\n941ec5a5-d5bf-419e-aa93-c5afd0b01eff\nd9404c7d-796d-4500-877e-d1b49f02c9df\n67e2bb25-1f61-47b6-9ae3-c6104e587882\n9085bb9e-9b56-4b84-b21e-bd5d5c7b0de0\n289d71ad-54ee-44a4-8d9a-9294f19b0069\na5ea2576-4191-4e9a-bfed-760fff616fbf\n802172dc-8014-42a9-b765-133c07039f9f\nfb33785b-f3f7-4b2b-b5c1-f688d3de1bde\nc196c17d-1e3c-4049-a989-c62f7afaf7f3\n79128217-d61e-41f9-a165-e06e1d672069\nf4a41d96-2045-4d75-a0ec-9970b0150b52\n88d43534-4128-4969-b5c4-ceefd9b31d02\n\n[To learn more about Microsoft Security solutions visit our website. Bookmark the](https://www.microsoft.com/en-us/security/business/solutions) Security\nblog to keep up with our expert coverage on security matters. Also, follow us\nat [@MSFTSecurity for the latest news and updates on cybersecurity.](https://twitter.com/@MSFTSecurity)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-09-24 - Microsoft Security—detecting empires in the cloud.pdf"
    ],
    "report_names": [
        "2020-09-24 - Microsoft Security—detecting empires in the cloud.pdf"
    ],
    "threat_actors": [
        {
            "id": "16f2436b-5f84-44e3-a306-f1f9e92f7bea",
            "created_at": "2023-01-06T13:46:38.745572Z",
            "updated_at": "2025-03-27T02:00:02.907444Z",
            "deleted_at": null,
            "main_name": "APT40",
            "aliases": [
                "ISLANDDREAMS",
                "TEMP.Jumper",
                "BRONZE MOHAWK",
                "GADOLINIUM",
                "KRYPTONITE PANDA",
                "TA423",
                "MUDCARP",
                "Gingham Typhoon",
                "TEMP.Periscope",
                "G0065",
                "ATK29",
                "Red Ladon",
                "ITG09"
            ],
            "source_name": "MISPGALAXY:APT40",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "59be3740-c8c7-47aa-84c8-e80d0cb7ea3a",
            "created_at": "2022-10-25T15:50:23.481057Z",
            "updated_at": "2025-03-27T02:00:55.480695Z",
            "deleted_at": null,
            "main_name": "Leviathan",
            "aliases": [
                "MUDCARP",
                "Kryptonite Panda",
                "Gadolinium",
                "BRONZE MOHAWK",
                "TEMP.Jumper",
                "APT40",
                "TEMP.Periscope",
                "Gingham Typhoon"
            ],
            "source_name": "MITRE:Leviathan",
            "tools": [
                "Windows Credential Editor",
                "BITSAdmin",
                "HOMEFRY",
                "Derusbi",
                "at",
                "BLACKCOFFEE",
                "BADFLICK",
                "gh0st RAT",
                "PowerSploit",
                "MURKYTOP",
                "NanHaiShu",
                "Orz",
                "Cobalt Strike",
                "China Chopper"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "b9806584-4d82-4f32-ae97-18a2583e8d11",
            "created_at": "2022-10-25T16:07:23.787833Z",
            "updated_at": "2025-03-27T02:02:09.978883Z",
            "deleted_at": null,
            "main_name": "Leviathan",
            "aliases": [
                "APT 40",
                "ATK 29",
                "Bronze Mohawk",
                "Gadolinium",
                "Gingham Typhoon",
                "ISLANDDREAMS",
                "ITG09",
                "Kryptonite Panda",
                "Mudcarp",
                "Red Ladon",
                "TA423",
                "TEMP.Jumper",
                "TEMP.Periscope"
            ],
            "source_name": "ETDA:Leviathan",
            "tools": [
                "AIRBREAK",
                "Agent.dhwf",
                "Agentemis",
                "AngryRebel",
                "BADFLICK",
                "BlackCoffee",
                "CHINACHOPPER",
                "China Chopper",
                "Cobalt Strike",
                "CobaltStrike",
                "DADJOKE",
                "Dadstache",
                "Derusbi",
                "Destroy RAT",
                "DestroyRAT",
                "Farfli",
                "GRILLMARK",
                "Gh0st RAT",
                "Ghost RAT",
                "HOMEFRY",
                "Hellsing Backdoor",
                "Kaba",
                "Korplug",
                "LOLBAS",
                "LOLBins",
                "LUNCHMONEY",
                "Living off the Land",
                "MURKYTOP",
                "Moudour",
                "Mydoor",
                "NanHaiShu",
                "Orz",
                "PCRat",
                "PNGRAT",
                "PlugX",
                "RedDelta",
                "SeDLL",
                "Sensocode",
                "SinoChopper",
                "Sogu",
                "TIGERPLUG",
                "TVT",
                "Thoper",
                "WCE",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "Xamtrav",
                "ZXShell",
                "ZoxPNG",
                "cobeacon",
                "gresim",
                "scanbox"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "83025f5e-302e-46b0-baf6-650a4d313dfc",
            "created_at": "2024-05-01T02:03:07.971863Z",
            "updated_at": "2025-03-27T02:05:17.278721Z",
            "deleted_at": null,
            "main_name": "BRONZE MOHAWK",
            "aliases": [
                "Flaccid Rose ",
                "GADOLINIUM ",
                "Kryptonite Panda ",
                "Leviathan ",
                "Nanhaishu ",
                "Pickleworm ",
                "Temp.Jumper ",
                "Temp.Periscope ",
                "APT40 "
            ],
            "source_name": "Secureworks:BRONZE MOHAWK",
            "tools": [
                " BlackCoffee",
                " China Chopper",
                " Cobalt Strike",
                " Derusbi",
                " Derusbi Trojan",
                " FUSIONBLAZE",
                " GreenCrash",
                " HOMEFRY",
                " MURKYTOP",
                " Metasploit",
                " Metasploit / Meterpreter",
                " Nanhaishu",
                " Orz",
                " ScanBox",
                " SeDll",
                "AIRBREAK"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673535849,
    "ts_updated_at": 1743041836,
    "ts_creation_date": 1653710527,
    "ts_modification_date": 1653710527,
    "files": {
        "pdf": "https://archive.orkl.eu/78d96e5687811446d682835e4e45d9734c2be17d.pdf",
        "text": "https://archive.orkl.eu/78d96e5687811446d682835e4e45d9734c2be17d.txt",
        "img": "https://archive.orkl.eu/78d96e5687811446d682835e4e45d9734c2be17d.jpg"
    }
}