{
    "id": "0034c1e1-0734-472b-a85f-ca40def02176",
    "created_at": "2023-01-12T15:00:27.001023Z",
    "updated_at": "2025-03-27T02:05:53.684636Z",
    "deleted_at": null,
    "sha1_hash": "7805764a46d163e834a919067c9a0bd948c5478a",
    "title": "2016-08-29 - Nightmare on Tor Street- Ursnif variant Dreambot adds Tor functionality",
    "authors": "",
    "file_creation_date": "2022-05-28T19:50:08Z",
    "file_modification_date": "2022-05-28T19:50:08Z",
    "file_size": 2805896,
    "plain_text": "# Nightmare on Tor Street: Ursnif variant Dreambot adds Tor functionality\n\n**proofpoint.com/us/threat-insight/post/ursnif-variant-dreambot-adds-tor-functionality**\n\n\nAugust 29, 2016\n\n\n-----\n\n[Blog](https://www.proofpoint.com/us/blog)\n[Threat Insight](https://www.proofpoint.com/us/blog/threat-insight)\nNightmare on Tor Street: Ursnif variant Dreambot adds Tor functionality\n\nAugust 25, 2016 Proofpoint Staff\n\n\n-----\n\n**t oduct o**\n\nOne of the most active banking Trojans that we have observed recently in email and exploit kits is one often referred to as Ursnif or Gozi ISFB\n\n[6]. Thanks to Frank Ruiz from FoxIT InTELL, we know that the actor developing one of its variants since 2014 has named this variant\nDreambot. The Dreambot malware is actively evolving, and recent samples in particular caught our attention for their addition of Tor\ncommunication capability, as well as peer-to-peer (P2P) functionality. Dreambot is currently spreading via numerous exploit kits as well as\nthrough email attachments and links.\n\nIt should be noted that while Dreambot is one of the most active and prevalent Ursnif variants, there are other active forks including “IAP” [5].\nThe Gozi ISFB source has been leaked, making way for additional development efforts.\n\n**Analysis**\n\nThe Dreambot malware is still in active development and over the last few months we have seen multiple versions of it spreading in the wild.\nThe Tor-enabled version of Dreambot has been active since at least July 2016, when we first observed the malware successfully download the\nTor client and connect to the Tor network. Today, many Dreambot samples include this functionality, but few use it as their primary mode of\ncommunication with their command and control (C&C) infrastructure. However, in the future this feature may be utilized much more frequently,\ncreating additional problems for defenders.\n\nFor this analysis, we looked at version 2.14.845, which has a configuration that differs from the others Dreambot versions in that the domain\ngeneration algorithm (DGA) is not used: therefore, the DGA variables and parameters are missing. The following is an example of decrypted\nconfiguration data with sections of interest highlighted in red.\n\n_Figure 1: Decrypted configuration data used by Dreambot_\n\nThere are three types of URLs present in the decrypted configuration. The first type of URL listed in the configuration data is used for the plain\nHTTP (that is, non-Tor) communication with C&C servers. The bot reports to the C&C server using the typical request pattern: for example, the\ninitial checkin to the C&C server is in the form of: cfg_url + “/images/” + encoded_data + (.jpeg|.gif|.bmp).\n\nThe second type of URL that appears in the configuration data (highlighted in red box in Fig. 1) are the .onion C&C addresses. They are the\ndefault choice for the bot and work in the same way the plain HTTP C&C’s do, except that all communication is encrypted and tunneled over\nTor.\n\nThe third set of URLs is used to download the Tor client. We believe the client is decrypted using the configuration serpent key [7]. When the\nTor client is retrieved, the bot creates a registry key named “TorClient” in the registry subfolder to store its data. This subfolder is located in\nHKCU\\\\Software\\AppDataLow\\Software\\Microsoft\\{random guid}. This key contains the path to the client, which is dropped in the %TMP%\nfolder, with a filename using the pattern [A-F0-9]{4}.bin.\n\n_Figure 2: TorClient registry key_\n\nThe registry key value is easy to decrypt, as the XOR-based algorithm [8] is reused in much of the code (e.g., for decryption of the strings in\nthe .bss section). The 4-byte key is generated at runtime based on the TOKEN_USER value XORed with 0xE8FA7DD7.\n\nFor the two types of POST HTTP requests (Tor and non-Tor), the configuration includes a check of the Tor flag (here at eax+10). If this flag is\nset, Dreambot sends both the C&C checkins and the data upload requests using Tor.\n\n\n-----\n\n_Figure 3: Configuration flags for communicating via Tor_\n\nIn addition to the Dreambot with Tor functionality, we have observed a P2P-enabled versions (e.g. version 2.15.798) that has been around\nconsiderably longer. Spread alongside the other variants this version utilizes the usual DGA or hard-coded addresses as well as what appears\nto be a peer-to-peer protocol to communicate. This functionality needs an additional IP in the configuration that delivers the nodes list. This\nprotocol operates over TCP and UDP and uses a custom packet format. Due to the addition of this functionality, the client code surface is\nalmost twice as big as that of the Tor version. We are still investigating the functionality and will not go into deeper detail at this time.\n\n**Exploit Kit Campaigns**\n\nOne early interesting example of Dreambot delivery came from an instance of the Niteris exploit kit. Several months after that, we spotted the\nsame redirection chain but instead to an undocumented 2-step flash Nuclear Pack. This particular Nuclear Pack behaved similarly to Spartan\nEK from the same coder in which an initial flash payload acted as a filter before sending the exploit and payload to end users. GooNky and\nAdGholas actors also commonly used Angler EK to deliver Dreambot while Angler was still highly active. Figures 4-7 show these infection\nchains.\n\n_Figure 4: 09-11-2015 - Compromised AdAgency with high volume traffic chain to Niteris [4]_\n\n\n-----\n\n_Figure 5: 02-03-2016 - Same redirection chain but instead redirecting to an undocumented 2-step Flash Nuclear Pack [6]_\n\n_Figure 6: 04-11-2016 - Malvertising run by GooNky in Switzerland_\n\n_Figure 7: 05-10-2016 - Malvertising run by AdGholas in Switzerland_\n\nFigure 8 shows Dreambot delivery in a Japan-focused malvertising campaign using Neutrino EK while Figure 9 shows a recent sample of\nDreambot as a secondary payload via the ElTest and the Smokebot Trojan. In the latter example, we can see this instance of Dreambot is\nusing Tor to connect to C&C infrastructure.\n\n_Figure 8: 07-09-2016 - Japan-focused malvertising based on the redirector’s domain_\n\n_Figure 9: 08-15-2016 - EITest infection chain into Smokebot loading an instance of Dreambot using Tor to connect to C&C_\n\n**Email Campaigns**\n\nDreambot has been actively distributed via email in 2016. We have noted campaigns targeting various regions including Australia, Italy,\nSwitzerland, United Kingdom, United States, Poland, and Canada. These campaigns have ranged from thousands to hundreds of thousands\nof malicious email messages. We show few examples of these campaigns using links or document attachments leading to the installation of\n\n\n-----\n\nea bot\n\nIn the first example, the actor used a lure claiming the recipient had been subpoenaed by the Federal Court of Australia. If the user were to\nfollow the link they would be greeted by a web page purporting to be the official court site. If the user then followed the instructions, they would\nbe led to a download of a zipped JavaScript file that, when executed, led to a Dreambot download.\n\n_Figure 10: 07-08-2016 - Message used to distribute Dreambot in Australia_\n\n\n-----\n\n_Figure 11: 07-08-2016 - Fake court website leading to the download of Dreambot_\n\nIn the next example, users in Australia were targeted with an email pretending be associated with Microsoft and Office365. The link in the\nemail led directly to a zipped JavaScript downloader hosted on Microsoft Sharepoint; opening the file would install DreamBot. (Proofpoint\nresearchers notified Microsoft about the hosted malware).\n\n\n-----\n\n_Figure 12: 08-11-2016 - Message used to distribute Dreambot in Australia via Microsoft SharePoint_\n\nIn the following example, users in the United States received messages with attachments purporting to contain a record of a payment. The\nMicrosoft Word document attachment contained malicious macros that, if enabled, downloaded Dreambot.\n\n\n-----\n\n_Figure 13: 06-08-2016 - Message used to distribute Dreambot in the United States_\n\n_Figure 14: 07-08-2016 - Microsoft Word attachment with malicious macros used to deliver Dreambot in the United States_\n\nIn the next campaign, users in Switzerland received personalized messages in German containing their name and company name, claiming to\nattach an invoice for an order. The Microsoft Word attachment contained macros that, if enabled, would download Dreambot.\n\n\n-----\n\n_Figure 15: 08-10-2016 - Message distributing Dreambot in Switzerland_\n\n\n-----\n\n_Figure 16: 08-10-2016 - Microsoft Word attachment used to deliver Dreambot in Switzerland_\n\nIn another example, users in Poland were sent a personalized message using their name with a fake invoice document attachment for one of\ntheir purchases. The Microsoft Word attachments contained macros that, if enabled, would download Dreambot.\n\n\n-----\n\n_Figure 17: 06-22-2016 - Message used to distribute Dreambot in Poland_\n\n\n-----\n\n_Figure 18: 06-22-2016 - Microsoft Word attachment used to distribute Dreambot in Poland_\n\n**Conclusion**\n\nDreambot is one of the most active banking Trojans we have seen recently, with distribution vectors across a variety of exploit kits and both\nmalicious document attachment and URL-based email campaigns. Often referred to as Ursnif and Gozi ISFB, Dreambot is being distributed in\ncountries around the world and is under active development. In particular, we have observed samples with C&C communications enabled over\nboth Tor and P2P. For Tor-enabled versions in particular, Dreambot activity on infected machines can be especially hard to detect at the\nnetwork level, creating new challenges for defenders and IT organizations alike.\n\nWe will continue to monitor Dreambot and its growing list of capabilities as the banking Trojan landscape evolves.\n\n**References**\n\n**Indicators of Compromise (IOC’s)**\n\n**Payloads delivered by Exploit Kits:**\n\n**Hash** **Date** **Description** **Vector**\n\n\na14d9ad2b03dd5f6360139f2772a303066ed292c51b0777cbece7b92d4a9e62c 2015-0911\n\n1448a395e741a419e5e7abb3f3bc2e6c46588823f093c93c695fffe0a69c17ee 2016-0411\n\ne06b753aa98e1b8fdc7c8ee1cbd07f5d46b2bbf88ebc8d450c8f24c6e79520a4 2016-0510\n\n\nDreambot Chain of Compromise to\nNiteris\n\nDreambot GooNky Malvert into Angler\n\nDreambot AdGholas Malvertising into\nAngler\n\n\n-----\n\nbd3c470fc6999212373c2c31b08d9944d4bee3baf79bd75a233743ad64845481 2016-0510\n\n54405a8cfa557b33e5a1e0c5b69433fce900c96a34496949da501c844b0e7919 2016-0603\n\n1dca7b73070679b796a2318c6e11ed0bb65bf66e5cc782b475bb43d735915e6c 2016-0603\n\n0d6014f1d2487230c3bb38f31d2742577f84fd2f2e0d97be5fb9cf28b7ab6de9 2016-0709\n\nf70a7b04a475c7140049ec586eb3f7c7a3480ddaac53c15db4905915e9dea52b 2016-0720\n\n8664c68d5c1ef72f32485c61704ce4fb350c95952a17908908a420443b411414 2016-0720\n\nc25b56c5ea2d0af3cf6057f974f1c3a06845ab41f61c8895aaaad55aafaeed7e 2016-0812\n\n04ea4e0417f1f49bc349efe7ee07c0bdf145a98dd7358610f598395246b4c433 2016-0815\n\n54405a8cfa557b33e5a1e0c5b69433fce900c96a34496949da501c844b0e7919 2016-0815\n\n8aa2442fb7a489d0c7f50a2220e0fd4ead270ff812edc3721a49eec5784a1ad6 2016-0815\n\n446a639371b060de0b4edaa8789f101eaeae9388b6389b4c852cd8323ec6757c 2016-0815\n\n396bd75514ab92e007917c1d136f1993466c0913a532af58386ccb99d5f60ef3 2016-0824\n\n**Payloads delivered by Email:**\n\n**Hash/Link**\n\n0edde27c90bbb55d80b89a2ce0baa21feb69a1420dbb1a15059b6bdfde994fde\n\n[hxxp://easypagemachine[.]com/kshf[.]jpg]\n\n2720d7cc899337adf5f021eeddb313f4317fc46f9c6e83bde9f47458b2d955e7\n\n6e0da9199f10ff5bd6d2f4e5309cde2332d534cbb3364e15cb0f7873455e0eb5\n\n[hxxp//safiidesign[.]com/winword[.]bin]\n\n7e0bf604d3ab673a519feb5d5375f0f88cf46e7cd1d3aa301b1b9fb722e9cef7\n\n\nDreambot EITest chain into Angler\n\nDreambot\n(P2P)\n\nDreambot EITest chain into Angler\n\nDreambot Malvertising to Neutrino\n\nDreambot EITest chain into Neutrino\n\nDreambot Undocumented actor into\nNeutrino\n\nDreambot Undocumented actor into RIG\n\nDreambot Undocumented actor into RIG\n\nDreambot EITest chain into RIG\n\n\nDreambot\n(tor)\n\n\nEITest chain into RIG into\nSmokebot\n\n\nSmokebot EITest chain into RIG\n\nIAP Malvertising into RIG\n\n\n-----\n\n[hxxp://pechat-suveniri[.]com/mam5pcan8wynct/hwd7popy[.]php]\n\n0195bf393584b203334c4ca3934e72e388e8e579cde35fa8db892d2ee306dc16\n\n[hxxp://ue-craft[.]ru/1ryvq8owo/rukdl1[.]exe]\n\n84bc2608707859a0643be642128b351757dc1f43f5b0a88b5448764dfc23487d\n\nb6d6fc672f8b45eed0e88601dea2390e7d0dc01e63840ab840613dd3d6939ad7\n\n[hxxp://one99two[.]com/cgi/office16[.]bin]\n\n85f68545c6d98dd6a6a00859ec136d8a8fd06c20ce189e39ce78f6685da40d4e\n\n[hxxps://searchfinancial-my[.]sharepoint[.]com/personal/tariq_searchfinancial_com_au/_layouts/15/guestaccess[.]aspx?\nguestaccesstoken=4GPoi4OBx0cZ%2bhMi6vHvpfR1vqc9vmqwU6WuwK6%2b7U8%3d&docid=0ec6abef70a134e70978ed191c8364229&rev=1]\n\n414b3cbc230768d9930e069cb0b73173fe9951e82486f0d6524addf49052d5ad\n\n[hxxp://www[.]wizardwebhosting[.]com/css/header[.]css]\n\n3cde892a8faddd4aaf90e8455698719516ab96ea6d116af21353c08375d457b9\n\n_Select ET Signatures that would fire on such traffic:_\n\n2021813 || ET TROJAN Ursnif Variant CnC Beacon\n2021829 || ET TROJAN Ursnif Variant CnC Beacon 4\n2022970 || ET TROJAN Ursnif Variant CnC Beacon 6\n2018789 || ET POLICY TLS possible TOR SSL traffic\nMultiple || ET TOR Known Tor Relay/Router (Not Exit) Node Traffic group **\n\nSubscribe to the Proofpoint Blog\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2016/2016-08-29 - Nightmare on Tor Street- Ursnif variant Dreambot adds Tor functionality.pdf"
    ],
    "report_names": [
        "2016-08-29 - Nightmare on Tor Street- Ursnif variant Dreambot adds Tor functionality.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535627,
    "ts_updated_at": 1743041153,
    "ts_creation_date": 1653767408,
    "ts_modification_date": 1653767408,
    "files": {
        "pdf": "https://archive.orkl.eu/7805764a46d163e834a919067c9a0bd948c5478a.pdf",
        "text": "https://archive.orkl.eu/7805764a46d163e834a919067c9a0bd948c5478a.txt",
        "img": "https://archive.orkl.eu/7805764a46d163e834a919067c9a0bd948c5478a.jpg"
    }
}