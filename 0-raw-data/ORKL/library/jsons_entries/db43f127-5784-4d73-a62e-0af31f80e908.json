{
    "id": "db43f127-5784-4d73-a62e-0af31f80e908",
    "created_at": "2023-01-12T15:03:50.970885Z",
    "updated_at": "2025-03-27T02:05:34.51312Z",
    "deleted_at": null,
    "sha1_hash": "f46fbaf217f25ad042843e0194d3e3977356f66d",
    "title": "2022-01-04 - Extracting Indicators from a Packed Mirai Sample",
    "authors": "",
    "file_creation_date": "2022-05-28T05:06:51Z",
    "file_modification_date": "2022-05-28T05:06:51Z",
    "file_size": 92571,
    "plain_text": "# Extracting Indicators from a Packed Mirai Sample\n\n**[forensicitguy.github.io/extracting-indicators-from-packed-mirai/](https://forensicitguy.github.io/extracting-indicators-from-packed-mirai/)**\n\nBy _[Tony Lambert](https://twitter.com/ForensicITGuy)_\nPosted 2022-01-04 Updated 2022-03-28 4 min read\n\n\nJanuary 4, 2022\n\n\nPacking is really commonly used by adversary to stump analysis, so in this post I’m going to\nlook at a sample that is really easy to unpack and get indicators from. In this case the\nsample is Mirai packed with UPX. If you want to follow along at home, the sample is in\nMalwareBazaar here:\n\nhttps://bazaar.abuse.ch/sample/ef11393108bed5f3753d054514b2dddb1a534f3623244ab48\n5c0ed6e2d5ded9e/\n\n## Why Just Indicators?\n\nMalware analysis should serve a purpose. In my dayjob on the Red Canary Intelligence\nteam I sometimes have to assess malware for indicators as parts of incidents. Not every\nadventure ends in assembly code and not every adventure requires a 50-page report.\n\n## Identifying UPX Packing\n\nFor this Mirai sample, it’s easy to detect the UPX packing with `Detect It Easy .`\n```\n  remnux@remnux:~/cases/mirai$ diec\n  mirai.elf\n  filetype: ELF32\n  arch: 386\n  mode: 32-bit\n  endianess: LE\n  type: EXEC\n   packer: UPX(3.96)[NRV,brute]\n\n```\nTo verify it’s packed with standard UPX, we can look for `UPX! ( 55 50 58 21 ) in the first`\nfew bytes:\n\n\n-----\n\n```\n  remnux@remnux:~/cases/mirai$ hexdump -C mirai.elf | head\n  00000000 7f 45 4c 46 01 01 01 03 00 00 00 00 00 00 00 00 \n  |.ELF............|\n  00000010 02 00 03 00 01 00 00 00 08 ba 04 08 34 00 00 00 \n  |............4...|\n  00000020 00 00 00 00 00 00 00 00 34 00 20 00 03 00 28 00 |........4.\n  ...(.|\n  00000030 00 00 00 00 01 00 00 00 00 00 00 00 00 80 04 08 \n  |................|\n  00000040 00 80 04 08 e6 42 00 00 e6 42 00 00 05 00 00 00 \n  |.....B...B......|\n  00000050 00 10 00 00 01 00 00 00 00 00 00 00 00 d0 04 08 \n  |................|\n  00000060 00 d0 04 08 00 00 00 00 20 3c 00 00 06 00 00 00 |........\n  <......|\n  00000070 00 10 00 00 51 e5 74 64 00 00 00 00 00 00 00 00 \n  |....Q.td........|\n  00000080 00 00 00 00 00 00 00 00 00 00 00 00 06 00 00 00 \n  |................|\n  00000090 04 00 00 00 4c 15 8d 50 55 50 58 21 ec 08 0d 0c \n  |....L..PUPX!....|\n\n```\nAlso, we can verify with YARA:\n```\n  remnux@remnux:~/cases/mirai$ yara-rules -s mirai.elf\n  UPXProtectorv10x2 mirai.elf\n  0x3a2a:$a0: EB 0E 90 90 90 90 8A 06 46 88 07 47 01 DB 75 07 8B 1E 83 EE FC\n  11 DB\n\n```\nIt’s not unheard of for adversaries to overwrite artifacts of UPX packing or use custom\npackers, so when you find a sample with standard UPX it’s always time for celebration!\n\n## Unpacking The Sample\n\nIn this case it’s simple to unpack the sample. We’re using `upx on REMnux, but we also`\nneed to remember that the command will overwrite the original executable. First, we need\nto create a backup copy.\n\n\n-----\n\n```\n  remnux@remnux:~/cases/mirai$ cp mirai.elf mirai.elf.bak \n  remnux@remnux:~/cases/mirai$ upx -d mirai.elf\n             Ultimate Packer for eXecutables\n               Copyright (C) 1996 - 2020\n  UPX 3.96    Markus Oberhumer, Laszlo Molnar & John Reiser  Jan 23rd\n  2020\n      File size     Ratio   Format   Name\n   --------------------  ------  -----------  ----------    30908 <-   17376  56.22%  linux/i386  mirai.elf\n  Unpacked 1 file.\n\n```\nWe can verify the result is executable with `file and then get our hashes to look up in VT`\nor other sources.\n\n\n-----\n\n```\n  remnux@remnux:~/cases/mirai$ file mirai.elf\n  mirai.elf: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), statically\n  linked, stripped\n  remnux@remnux:~/cases/mirai$ diec mirai.elf\n  filetype: ELF32\n  arch: 386\n  mode: 32-bit\n  endianess: LE\n  type: EXEC\n  remnux@remnux:~/cases/mirai$ md5sum mirai.elf\n  3c246e3a6c146dd823268920918c9b48 mirai.elf\n\n## Looking for Indicators\n\n```\nThe quick and easy triage for indicators can happen with `strings . Remember, by default`\nit just looks for ASCII and not Unicode, so you need two passes.\n```\n  remnux@remnux:~/cases/mirai$ strings mirai.elf > mirai-strings.txt\n  remnux@remnux:~/cases/mirai$ strings -eL mirai.elf >> mirai  strings.txt\n\n```\nExamining the strings output, we can find a couple interesting things:\n\n\n-----\n\nFrom here, we can pivot on that IP address as an indicator to see where it leads. We can\nalso possibly look for sandbox reports or execute the malware in a controlled environment.\n[To save some time, I looked into a Joe Sandbox report for the sample. The report included](https://www.joesandbox.com/analysis/547170/0/html)\nthe IP address above plus a few more to try and pivot around. Depending on the\nrequirements for your incident you might also look for obfuscated strings using Ghidra or\nother tools, but we don’t need to for this case.\n\nThanks for reading!\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-01-04 - Extracting Indicators from a Packed Mirai Sample.pdf"
    ],
    "report_names": [
        "2022-01-04 - Extracting Indicators from a Packed Mirai Sample.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535830,
    "ts_updated_at": 1743041134,
    "ts_creation_date": 1653714411,
    "ts_modification_date": 1653714411,
    "files": {
        "pdf": "https://archive.orkl.eu/f46fbaf217f25ad042843e0194d3e3977356f66d.pdf",
        "text": "https://archive.orkl.eu/f46fbaf217f25ad042843e0194d3e3977356f66d.txt",
        "img": "https://archive.orkl.eu/f46fbaf217f25ad042843e0194d3e3977356f66d.jpg"
    }
}