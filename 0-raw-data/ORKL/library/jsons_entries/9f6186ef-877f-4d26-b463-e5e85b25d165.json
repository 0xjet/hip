{
    "id": "9f6186ef-877f-4d26-b463-e5e85b25d165",
    "created_at": "2023-01-12T15:05:27.620467Z",
    "updated_at": "2025-03-27T02:10:08.455282Z",
    "deleted_at": null,
    "sha1_hash": "467bc73169eb6c4e059d941b5eda6b659ca6ef5f",
    "title": "2021-01-28 - Deep into the SunBurst Attack",
    "authors": "",
    "file_creation_date": "2022-05-28T19:45:12Z",
    "file_modification_date": "2022-05-28T19:45:12Z",
    "file_size": 4653755,
    "plain_text": "# Deep into the SunBurst Attack\n\n**[research.checkpoint.com/2021/deep-into-the-sunburst-attack/](https://research.checkpoint.com/2021/deep-into-the-sunburst-attack/)**\n\nJanuary 28, 2021\nBy Lior Sonntag\n\n\nJanuary 28, 2021\n\n\nDuring the week of December 13th, we witnessed what many are calling one of the biggest\ncyberattacks in recent times. SunBurst, the malware installed on SolarWinds’ Orion product,\n[perpetrated what seems like a nation-state sponsored supply chain attack, and as a result](https://www.cisa.gov/news/2021/01/05/joint-statement-federal-bureau-investigation-fbi-cybersecurity-and-infrastructure)\nfeatured prominently in global headlines.\n\n[The attack raised awareness to supply chain based compromises and previous reports](https://blog.checkpoint.com/2020/12/21/best-practice-identifying-and-mitigating-the-impact-of-sunburst/)\noffered best practices on how to identify and mitigate the impact of the attack, provided deep\ndive to [TEARDROP– one of the payloads used, and offered advice on protecting from the](https://research.checkpoint.com/2020/sunburst-teardrop-and-the-netsec-new-normal/)\nattack itself.\n\nThe activity following this supply chain attack included lateral movement and data theft.\n\nIn this blog, we focus on the second phase in the cloud and present some of the key\ntactics and techniques used by the nation-state actors in the malicious campaign. Using the\n[MITRE ATT&CK framework, we provide the most likely technical attack flow.](https://attack.mitre.org/matrices/enterprise/cloud/)\n\nAccording to the [Microsoft article, this is the chain of events from a high-level perspective:](https://techcommunity.microsoft.com/t5/azure-active-directory-identity/understanding-quot-solorigate-quot-s-identity-iocs-for-identity/ba-p/2007610)\n\n\n-----\n\n1. Initial Access (On-Prem) – Use Forged SAML tokens and illegitimate registrations of\n\nSAML Trust Relationships to impersonate a user with administrative credentials (in this\ncase, Azure AD).\n2. Discovery – Enumerate existing applications / service principals (preferably with high\n\ntraffic patterns) .\n3. Credential Access – Add credentials to an existing application or service principal.\n4. Privilege Escalation – Elevate the privileges of the application/service-principal to\n\nallow access to MS Graph APIs Application permissions.\n5. Defense Evasion and Lateral Movement – Acquire OAuth access tokens for\n\napplications to impersonate the applications and obfuscate malicious activity.\n6. Exfiltration – Call MS Graph APIs to exfiltrate sensitive data such as users’ data and\n\nemails.\n\nAs mentioned previously, our focus is on the attack flow in the Cloud Environment after the\ninitial authentication (i.e. steps b-f).\n\nBefore we go into the attack flow, some background on the AzureAD Authentication and\nAuthorization mechanisms.\n\n\n-----\n\nAuthentication is providing proof that you are who you say you are. This is done by the\nIdentity Provider i.e. Azure AD.\nAuthorization is the act of granting an authenticated party permission to do something. This\nis done by the resource the identity is trying to query, utilizing the OAuth 2.0 protocol.\n\n**Discovery**\n\nAfter the threat actors gain an initial foothold in the Cloud Environment by compromising\nprivileged cloud users with administrative access to the Azure AD, they add credentials to an\nexisting application or service principal.\nTo do that, the attackers first need to list all the existing applications:\n\nThe attackers prefer an application with high traffic patterns (e.g. mail archival applications)\nwhich can be used to obfuscate their activity, so they choose “MailApp” (an imaginary\napplication name) and extract its ObjectId and ApplicationId:\n\nIn addition, the attackers extract the account’s tenantId:\n\n\n-----\n\n**Credential Access**\n\nNext, the attackers create new credentials and add them to the application:\n\nAlternatively, they can create new credentials and add them to an existing service principal\nassociated with the MailApp application:\n\nAfter this phase, the attackers now have credentials for the application, which can be used to\nauthenticate to Azure AD on behalf of the application.\n\n**Application/Service-principal Privilege Escalation**\n\nIn this step, the attackers list all the available permissions related to Microsoft Graph APIs:\n\n\n-----\n\nThe attackers add the User.ReadWrite.All permission to the MailApp application:\n\nAfterward, the attackers list all the available permissions related to Mails that are associated\nwith the Microsoft Graph API:\n\nThey also add the Mail.ReadWrite permission to the MailApp application:\n\nThe error in red indicates that an admin consent must be launched to approve this\npermission.\n\nThe admin consent workflow gives admins a secure way to grant access to applications\n\n\n-----\n\nthat require admin approval. When a user tries to access an application but is unable to\nprovide consent, he can send a request for admin approval. The request is sent to admins\nwho are designated as reviewers.\nAs the attackers already have administrative permissions, they can launch an admin consent\non their own:\n\nThe admin consent is successful and the Microsoft Graph APIs permissions are successfully\nadded to the MailApp application!\n\n**Defense Evasion and Lateral Movement**\n\nThe next step for the attackers is to acquire an OAuth access token for the application by\ninitiating a HTTP GET request which includes the tenantId, objectId, appId and the secret\n(credentials) obtained earlier:\n\nThis access token enables the attackers to move laterally, impersonate the MailApp\napplication, and execute actions on its behalf.\n\n**Exfiltration**\n\nIn the final step, the attackers call APIs with permissions assigned to the MailApp\napplication.\n\nThe attackers initiate a HTTP GET request which includes the access token to exfiltrate all\n**users in the tenant and all emails related to a specific user.**\n\n\n-----\n\n**_Users exfiltration_**\n\n\n-----\n\n**_Emails exfiltration_**\n\n**_Emails’ subjects exfiltration_**\n\n**Conclusion**\n\n[The SolarWinds supply-chain attack is one of the most sophisticated attacks of our time. The](https://www.checkpoint.com/protect-your-business-from-solarwinds-sunburst-attack/)\nscope of the attack extends beyond on-prem to the cloud. The attackers used advanced\ntechniques to cover their tracks while they stole sensitive information, and used discovery,\ncredential access, privilege escalation, lateral movement, defense evasion, and exfiltration in\na single attack flow.\n\nMany of the characteristics and operations seen in this type of attack can also apply to other\ncloud providers such as AWS and GCP.\n\nThe number of victims compromised by SunBurst continues to rise since the attack was\ninitially uncovered. We will update with any new information as more details concerning this\nattack emerge.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-01-28 - Deep into the SunBurst Attack.pdf"
    ],
    "report_names": [
        "2021-01-28 - Deep into the SunBurst Attack.pdf"
    ],
    "threat_actors": [
        {
            "id": "80edca9f-dcd6-491e-92f3-87ad1f575631",
            "created_at": "2023-10-14T02:03:14.694988Z",
            "updated_at": "2025-03-27T02:02:10.270247Z",
            "deleted_at": null,
            "main_name": "NetSec",
            "aliases": [
                "NetSec",
                "Operation Data Breach",
                "ScarFace_TheOne",
                "USDoD"
            ],
            "source_name": "ETDA:NetSec",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535927,
    "ts_updated_at": 1743041408,
    "ts_creation_date": 1653767112,
    "ts_modification_date": 1653767112,
    "files": {
        "pdf": "https://archive.orkl.eu/467bc73169eb6c4e059d941b5eda6b659ca6ef5f.pdf",
        "text": "https://archive.orkl.eu/467bc73169eb6c4e059d941b5eda6b659ca6ef5f.txt",
        "img": "https://archive.orkl.eu/467bc73169eb6c4e059d941b5eda6b659ca6ef5f.jpg"
    }
}