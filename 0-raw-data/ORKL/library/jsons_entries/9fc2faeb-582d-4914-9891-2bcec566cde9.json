{
    "id": "9fc2faeb-582d-4914-9891-2bcec566cde9",
    "created_at": "2022-10-25T16:48:17.394075Z",
    "updated_at": "2025-03-27T02:16:26.613882Z",
    "deleted_at": null,
    "sha1_hash": "7c8a47dad5440202660007a31618e4f85d0d86fe",
    "title": "",
    "authors": "",
    "file_creation_date": "2021-04-01T03:56:56Z",
    "file_modification_date": "2021-04-01T03:56:56Z",
    "file_size": 2292501,
    "plain_text": "# APT10: sophisticated multi-layered loader Ecipekac discovered in A41APT campaign\n\n**[securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519](https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/)**\n\nAuthors\n\nGReAT\n\n## Why is the campaign called A41APT?\n\nIn 2019, we observed an APT campaign targeting multiple industries, including the\nJapanese manufacturing industry and its overseas operations, that was designed to steal\ninformation. We named the campaign A41APT (not APT41) which is derived from the\nhost name “DESKTOP-A41UVJV” from the attacker’s system used in the initial infection.\n[The actor leveraged vulnerabilities in Pulse Connect Secure in order to hijack VPN](https://blogs.jpcert.or.jp/en/2020/04/attacks-exploiting-vulnerabilities-in-pulse-connect-secure.html)\nsessions, or took advantage of system credentials that were stolen in previous operations.\n\n\n-----\n\n**_Log of the hijacking VPN session from DESKTOP-A41UVJV_**\n\nA41APT is a long-running campaign with activities detected from March 2019 to the end\nof December 2020. Most of the discovered malware families are fileless malware and they\nhave not been seen before. One particular piece of malware from this campaign is called\nEcipekac (a.k.a DESLoader, SigLoader, and HEAVYHAND). It is a very sophisticated\nmulti-layer loader module used to deliver payloads such as SodaMaster (a.k.a DelfsCake,\ndfls, and DARKTOWN), P8RAT (a.k.a GreetCake, and HEAVYPOT) and FYAnti (a.k.a\nDILLJUICE stage2) which loads QuasarRAT.\n\n[In November and December 2020, Symantec and LAC both published blogposts about](https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/cicada-apt10-japan-espionage)\nthis campaign. A month later, we discovered new activities from A41APT that utilized\nmodified and updated payloads, and that’s what we cover in this blog.\n\nIn February 2021, a GReAT security expert and his friends gave a presentation on the\n[A41APT campaign at the GReAT Ideas event. You can download the slides here. Further](https://zoom.us/rec/play/OLc9FOzXzqmyu82JXC8tcII2hyFkj_cbGEhdYWuALtgCI_Kx2b1bi5t46BLpnVYS9Bi62H-FwWTmTnnm.oZrPBZ-Y1l4SNOUW?continueMode=true&_x_zm_rtaid=hrsjJwhZSKWJCySt73v6iQ.1614733054361.cd430564993be52d83ec0c1f24d6fc38&_x_zm_rhtaid=778)\ninformation about A41APT is available to customers of the Kaspersky Intelligence\nReporting service. Contact intelreports@kaspersky.com\n\n## Technical analysis: Ecipekac\n\nWe observed a multi-layer x64 loader used exclusively by this actor and dubbed Ecipekac\nafter a unique string found in the second layer of the Ecipekac loader. The string is “Cake\npiece” in reverse (with a typo).\n\n\n-----\n\n**_The hardcoded unique string “ecipekac”_**\n\nEcipekac uses a new, complicated loading schema: it uses the four files listed below to\nload and decrypt four fileless loader modules one after the other to eventually load the\nfinal payload in memory.\n\n**_Ecipekac infection flow_**\n\nThe files are:\n\n\n-----\n\n**Filename** **MD5 Hash** **Description**\n\npolicytool.exe 7e2b9e1f651fa5454d45b974d00512fb Legitimate exe for DLL sideloading\n\njli.dll be53764063bb1d054d78f2bf08fb90f3 Ecipekac Layer I loader\n\nvac.dll f60f7a1736840a6149d478b23611d561 Encrypted Ecipekac Layer II\nloader (shellcode)\n\npcasvc.dll 59747955a8874ff74ce415e56d8beb9c Encrypted Ecipekac Layer IV\nloader (shellcode)\n\nPlease note that the Ecipekac Layer III loader module is embedded in the encrypted Layer\nII loader.\n\n### Ecipekac: Layer I loader\n\n**_Layer I of Ecipekac infection flow_**\n\nThe Ecipekac Layer I loader abuses policytool.exe, a legitimate application that is\nnormally packaged in the IBM Development Package for Eclipse, to load a malicious DLL\nnamed ‘jli.dll’ in the current directory via the DLL side-loading technique. The ‘jli.dll’ file\nacts as the first layer of the Ecipekac loader. This DLL file has a number of export\nfunctions; however, all of them refer to a similar function that carries the main loading\nfeature. The loader reads 0x40408 bytes of data from the end of another DLL – ‘vac.dll’\n(where the data section starts at the offset of 0x66240). The data size of 0x40408 is\nderived from a hardcoded value, 0x40405, incremented until it’s divisible by eight.\n\n**MD5** f60f7a1736840a6149d478b23611d561\n\n**SHA1** 5eb69114b2405a6ea0780b627cd68b86954a596b\n\n**SHA256** 3b8ce709fc2cee5e7c037a242ac8c84e2e00bd597711093d7c0e85ec68e14a4c\n\n**Link time** 2033-11-13 08:50:03\n\n**File type** PE32+ executable (DLL) (GUI) x86-64, for MS Windows\n\n**Compiler** Linker Version: 14.13, OS Version: 10.0\n\n**File size** 681544 (666KB)\n\n**File name** vac.dll\n\n\n-----\n\n**Embedded**\n**data at**\n**0x66240**\n\n**(size:0x40405)**\n\n\n00066240: febe d990 66de 1bc9 75b7 dc2c 3e1f 3ef2\n\n00066250: 78d0 0005 5c27 a511 c122 bdf4 15e7 052c\n\n00066260: af72 7e08 064c f7b9 70f0 57bf 250a 3b4d\n\n[..skipped..]\n\n000a6630: ee4b b1f2 294d eea1 290e aba2 6954 130f\n\n000a6640: 1267 9ab3 f800 0000\n\n\nThe ‘vac.dll’ DLL file is signed with a valid, legitimate digital signature, although the file\nhas been tampered with. At first glance, the fact that its digital signature is valid would\nsuggest the file has not been manipulated after being digitally signed.\n\n**_The signed digital certificate of vac.dll_**\n\nHowever, what happened was that the actor resized the Certificate Table in the digitally\nsigned ‘vac.dll’ and inserted their own data in the Certificate Table so it doesn’t affect the\n[digital signature. This technique was published at BlackHat 2016 as MS13-098.](https://www.blackhat.com/docs/us-16/materials/us-16-Nipravsky-Certificate-Bypass-Hiding-And-Executing-Malware-From-A-Digitally-Signed-Executable-wp.pdf)\n\nThe layer I loader decrypts the layer II loader shellcode from the embedded data in\n‘vac.dll’. Several crypto algorithms are used, such as XOR, AES and DES. The order and\ncombination of algorithms, as well as the decryption keys, are different from one sample\nto another.\n\n\n-----\n\n**_Decryption flow in first loader_**\n\nFor example, in the sample shown above, the order of crypto algorithms was a one-byte\nXOR using the hardcoded key of ‘0x9F’, followed by an AES CBC mode decryption with\nthe AES key ’83H4uREKfFClDH8ziYTH8xsBYa32p3wl’ and the IV key\n’83H4uREKfFClDH8z’.\n\nOne interesting characteristic of Ecipekac is that the attackers implemented these\ncryptographic algorithms in their own code instead of using the Windows API. The\nattackers have also made slight modifications compared to the original implementation.\nFor instance, in the function related to the AES algorithm, they intentionally referenced\nthe third byte of the AES key as shown in the following code.\n\n**_A small modification in the AES function_**\n\nApart from the AES algorithm mentioned, the attackers have also modified the DES\nalgorithm.\n\n### Ecipekac: Layer II loader shellcode\n\n**_Layer II of infection flow using Ecipekac_**\n\nThe Ecipekac Layer II loader is a simple shellcode which contains the data of the next\nlayer DLL in disordered parts. At first, this shellcode checks for the magic string\n“ecipekac” in this data set. Then it reconstructs and loads each part of the embedded data\n\n\n-----\n\ninto allocated memory in the correct order to create the original code of the DLL as shown\nbelow.\n\n**_Reconstruction for the divided PE BLOB in memory_**\n\nThen it calls the entry point of the loaded DLL which is the third layer of Ecipekac. Based\non our investigation, the magic string used in this module is not exclusively “ecipekac” in\nall instances. We also observed “9F 8F 7F 6F” and “BF AF BF AF” being used in several\nsamples instead.\n\n### Ecipekac Layer III loader DLL\n\n**_Layer III of infection flow using Ecipekac_**\n\nThe third layer’s method of loading the next layer resembles the first layer. It reads\nencrypted data from the end of ‘pcasvc.dll’, which is signed using a digital certificate as is\nthe case with ‘vac.dll’.\n\n**MD5** 59747955a8874ff74ce415e56d8beb9c\n\n**SHA1** 0543bfebff937039e304146c23bbde7693a67f4e\n\n**SHA256** a04849da674bc8153348301d2ff1103a7537ed2ee55a1588350ededa43ff09f6\n\n**Link time** 2017-02-24 15:47:04\n\n**File type** PE32+ executable (DLL) (console) x86-64, for MS Windows\n\n\n-----\n\n**Compiler** Linker Version: 14.13, OS Version: 10.0\n\n**File size** 733232 (717KB)\n\n**File name** pcasvc.dll\n\n\n**Embedded**\n**data at**\n**0x87408**\n**(size:0x2BC28)**\n\n\n00087408: 98e4 1def 8519 d194 3c70 4e84 458a e34c\n\n00087418: b145 74da c353 8cf8 1d70 d024 8a54 8bde\n\n[..skipped..]\n\n000b3010: 2c1b 6736 8935 d55d 8090 0829 5dfc 7352\n\n000b3020: 44bd c35b 9b23 1cb6 0000 0000 0000 0000\n\n\nThe crypto algorithms are again one-byte XOR and AES CBC mode, this time to decrypt\nthe fourth loader shellcode from the embedded data of ‘pcasvc.dll’. However, the\nsequence of algorithms is in reverse order compared to the first layer. The hardcoded keys\nare also different: “0x5E” is used as the XOR key, while the AES key and IV are\n“K4jcj02QSLWp8lK9gMK9h7W0L9iB2eEW” and “K4jcj02QSLWp8lK9” respectively.\n\n### Ecipekac: Layer IV loader shellcode\n\n**_Layer IV of infection flow using Ecipekac_**\n\nDuring our research, we found three different types of shellcode used as the fourth layer\nof Ecipekac.\n\n**Layer IV loader shellcode – first type**\n\nThe first shellcode type’s procedure acts the same way as the Ecipekac Layer II shellcode,\nwith the only difference being the embedded PE, which is the final payload of Ecipekac in\nthis case. The payload of the first type shellcode is either “P8RAT” or “FYAnti loader”. An\nanalysis of these payloads is provided in the later sections of this report.\n\n**Layer IV loader shellcode – second type**\n\nThe second type of shellcode is totally different from the other loader types. This\nshellcode has a unique data structure shown in the table below.\n\n**Offset** **Example Data** **Description**\n\n0x000 90 90 90 90 90 90 90 90 magic number to check before\nproceeding to data processing.\n\n0x008 0x11600 size of encrypted data\n\n\n-----\n\n0x00C A9 5B 7B 84 9C CB CF E8 B6 79 F1 9F\n05 B6 2B FE\n\n0x01C C7 36 7E 93 D3 07 1E 86 23 75 10 49\nC8 AD 01 9F 6E D0 9F 06 85 97 B2\n\n[skipped]\n\n\n16 bytes RC4 key\n\nEncrypted payload (SodaMaster)\nby RC4\n\n\nThis shellcode confirms the presence of the magic number “90 90 90 90 90 90 90 90” at\nthe beginning of this data structure, before proceeding to decrypt a payload at offset\n0x01C using RC4 with a 16-byte key of “A9 5B 7B 84 9C CB CF E8 B6 79 F1 9F 05 B6 2B\nFE”. The decrypted payload is “SodaMaster”, and is described later in this report.\n\n**Layer IV loader shellcode – third type**\n\nThe last type of shellcode is a Cobalt Strike stager. We have confirmed the use of several\ndifferent Cobalt Strike stager shellcodes since October 2019. In addition, some of the\nobserved Cobalt Strike stager samples included a setting in the HTTP header of their\nmalicious communications to disguise them as common jQuery request in order to evade\ndetection by security products.\n\n**_Hardcoded HTTP header to impersonate jQuery request_**\n\nThe actual hardcoded C2 used in the HTTP header for the C2 communication\nimpersonating JQuery requests was “51.89.88[.]126” with the respective port 443.\n\n## Payloads of Ecipekac\n\n\n-----\n\n**_Payload of Infection flow using Ecipekac_**\n\nAs mentioned previously, apart from the Cobalt Strike stager, we observed three types of\nfinal payload implanted by the Ecipekac loader during this long-running campaign.\n\nP8RAT\nSodaMaster\nFYAnti loader for QuasarRAT\n\nThe following timeline shows samples of the Ecipekac loader together with their\nrespective filename and payload type based on a compilation timestamp of the first layer\nDLL:\n\n**_Timeline of the Ecipekac loader files and payloads_**\n\nCobalt Strike’s stager has been used throughout the research period. FYAntiLoader for\nQuasarRAT was monitored in October 2019, and has not been observed since then.\nInstead of this, SodaMaster and P8RAT were monitored from May 2020.\n\n### P8RAT\n\nOne of Ecipekac’s payloads is a new fileless malware which we call P8RAT (a.k.a\nGreetCake). P8RAT has the following unique data structure used to store the C2\ncommunication configuration. We collected several samples of P8RAT during our\nresearch and found no C2 address of P8RAT that was used more than once. In total we\nfound 10 backdoor commands in all the collected P8RAT samples. The most recent\nP8RAT sample, with the compilation timestamp of December 14, 2020, shows a new\nbackdoor command with the code number of “309” implemented. The command “304”,\nwhich was present in earlier samples and carries similar functionality, was removed.\n\n**Command** **Description** **Compilation time of P8RAT**\n\n**2020-03-30** **2020-08-26** **2020-12-**\n**14**\n\n300 Closing socket Enabled Enabled Enabled\n\n\n-----\n\n301 Creating a thread for\nexecuting/loading a\ndownloaded PE file\n\n\nEnabled Enabled Enabled\n\n\n302 No functionality Enabled Removed Removed\n\n\n303 Sending randomly generated\ndata\n\n304 Executing/loading downloaded\nPE/shellcode\n\n305 Setting value of “Set Online\nTime” (the string was\nhardcoded in the P8RAT\nversion compiled on 2020-0330 and removed from the\nP8RAT version compiled on\n2020-08-26).\n\n306 Setting value of “Set\nReconnect TimeOut” (the\nstring was hardcoded in the\nP8RAT version compiled on\n2020-03-30 and removed from\nthe P8RAT version compiled\non 2020-08-26).\n\n307 Setting value of “Set\nReconnect times” (the string\nwas hardcoded in the P8RAT\nversion compiled on 2020-0330 and removed from the\nP8RAT version compiled on\n2020-08-26).\n\n308 Setting value of “Set Sleep\ntime” (the string was\nhardcoded in the P8RAT\nversion compiled on 2020-0330 and removed from the\nP8RAT version compiled on\n2020-08-26).\n\n309 Creating thread for executing\ndownloaded shellcode was\nimplemented from the P8RAT\nversion compiled on 2020-1214.\n\n\nEnabled Enabled Enabled\n\nEnabled Removed Removed\n\nEnabled Enabled Enabled\n\nEnabled Enabled Enabled\n\nEnabled Enabled Enabled\n\nEnabled Enabled Enabled\n\n\nNot\nimplemented\n\n\nNot\nimplemented\n\n\nEnabled\n\n\nThe main purpose of P8RAT is downloading and executing payloads (consisting of PE\nand shellcode) from its C2 server. However, we were unable to obtain any sample of the\nsubsequent payloads for this malware.\n\n\n-----\n\nIn the P8RAT sample from March 2020, hardcoded strings such as “Set Online Time”,\n“Set Reconnect TimeOut”, “Set Reconnect Times” and “Set Sleep Time” were used in\nregard to backdoor commands “305” to “308”, which point to the possible purpose of\nthese commands. Based on these strings, which were removed from the P8RAT samples\nin August 2020, we speculate that these commands are possibly used to control the\nintervals of the C2 communication by defining sleep time, reconnect time and reconnect\ntimeout in order to blend C2 communication with normal network traffic of the system.\n\nIn another update, the P8RAT sample from August 2020 looks for two process names\n(“VBoxService.exe” and “vmtoolsd.exe”) on the victim’s system, to detect VMware or\nVirtualBox environments at the beginning of its main malicious function.\n\n**_Hardcoded file names to detect VMware and VirtualBox_**\n\nInterestingly the attacker made some modifications to P8RAT in December 2020, shortly\nafter the publication of the two blogposts from Symantec on November 17, 2020, and LAC\non December 1, 2020 (in Japanese). We strongly believe that this actor had examined\nthese security vendors’ publications carefully and then modified P8RAT accordingly.\n\n### SodaMaster\n\nAnother payload of the Ecipekac loader, which we call SodaMaster (a.k.a DelfsCake), is\nalso a new fileless malware. In our research we found more than 10 samples of\nSodaMaster. All the collected samples of this module were almost identical, with the\noffsets and hex patterns of all functions perfectly matching. The only differences were in\nthe configuration data, including a hardcoded C2, an encoded RSA key and additional\ndata for calculating a mutex value.\n\n\n-----\n\n**_Configuration of SodaMaster_**\n\nWhen execution of this malware begins, it creates a mutex with a name in the reverse\norder of the CRC32 checksum calculated from the encoded RSA key and its following\nadditional data. Then the malware randomly generates a value as an RC4 key for C2\ncommunication. The first data block sent to the C2 server includes the user_name, the\nhost_name, PID of the malware module, OS_version, socket_name, the generated RC4\nkey and the malware’s elapsed running time.\n\n**_C2 communication of SodaMaster_**\n\nWe confirmed four backdoor commands, coded as “d”, “f”, “l” and “s”, in the recent\nSodaMaster sample. In addition, we also discovered an old SodaMaster sample which has\nonly two commands. A description of each command is shown in the following table.\n\n**Command** **Description** **Compilation time of**\n**P8RAT**\n\n**2019-01-07** **2019-**\n**06-10**\n\n\n-----\n\nd Create thread for launching downloaded DLL\nand call export function of the DLL.\n\nf Set value as RC4 key for the encrypted C2\ncommunication\n\n\nEnabled Enabled\n\n\nNot\nimplemented\n\n\nEnabled\n\nEnabled\n\n\nl Set value as sleep time Not\nimplemented\n\n\ns Create thread for executing downloaded\nshellcode\n\n\nEnabled Enabled\n\n\nBased on the analysis of the backdoor features of the SodaMaster module, the purpose of\nthis malware is also to download and execute payloads (DLL or shellcode), like P8RAT.\nUnfortunately, we have not been able to obtain these payloads yet.\n\nThe SodaMaster module also shows an anti-VM feature. The malware looks for the\npresence of the registry key\n“HKEY_CLASSES_ROOT\\\\Applications\\\\VMwareHostOpen.exe” on the victim’s system\nbefore proceeding to its main functionality. This registry key is specific to the VMware\nenvironment.\n\n**_SodaMaster anti-VM check_**\n\nAnother characteristic of SodaMaster is the use of a common obfuscation technique\nknown as “stackstrings” to create the registry key in double-byte characters. We observed\nthe same obfuscation technique used for a process name and DLL name in other\nSodaMaster samples.\n\n\n-----\n\n### FYAnti loader for QuasarRAT\n\nThe last observed type of payload deployed by Ecipekac is a loader module named FYAnti\nloader. In the Ecipekac loader malware of the fourth layer, the DLL is loaded into memory\nand an export carrying the name “F**kY**Anti” is called. We named this loader “FYAnti”\nbecause of this distinct string. The execution flow of the FYAnti has two additional layers\nto implement the final stage, which is a QuasarRAT (a.k.a xRAT).\n\n**_Infection flow of FYAnti loader_**\n\nThe first layer of the FYAnti loader decrypts an embedded .NET module and executes it\nusing the CppHostCLR technique. The .NET module is packed using “ConfuserEx v1.0.0”\nand acts as yet another loader that searches for a file in the\n“C:\\Windows\\Microsoft.NET\\” directory with file sizes between 100,000 and 500,000.\nThe unpacked code is shown in the screenshot below.\n\n**_Unpacked code of the second layer loader of FYAnti to search a file_**\n\nIn this instance, an encrypted file named “web_lowtrust.config.uninnstall” is found and\nused as the next stage module. The .NET module loads and decrypts this file using AES\nCBC mode. The decrypted payload is another .NET module named Client.exe which is\nQuasarRAT, a popular open-source remote administration tool. The configuration data is\n\n\n-----\n\nstored in the binary with most of this data being encrypted by AES CFB mode and base64.\nThe AES key is generated using the hardcoded string “KCYcz6PCYZ2VSiFyu2GU”in the\nconfiguration data.\n\n**_Malware configuration of QuasarRAT_**\n\nAll loader modules and payloads are decrypted and executed in memory only.\n\n## Attribution\n\nBased on our investigations, we assess with high confidence that the APT10 threat actor is\nbehind the A41APT campaign. This attribution is based on the following points:\n\nFirst, the hardcoded URL “www.rare-coisns[.]com” from an x86 SodaMaster sample was\n[mentioned in the report from ADEO regarding APT10’s activity targeting the finance and](https://adeo.com.tr/wp-content/uploads/2020/02/APT10_Report.pdf)\ntelecommunication sectors of Turkey, also fitting the geolocation of the VirusTotal\nsubmitter.\n\nSecond, the similarity of the A41APT campaign with APT10 activities described in a\nCylance blogpost. These include the Ecipekac Loader, FYAnti loader’s unique export\nname “F**kY**Anti”, using the CppHostCLR technique and QuasarRAT used as the\n[FYAnti’s final payload. Moreover, as stated in the Symantec blogpost, the FYAnti loader,](https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/cicada-apt10-japan-espionage)\nthe export name “F**kY**Anti”, CppHostCLR technique for injection of .NET loader and\nthe QuasarRAT were similar to the activities of the APT10 group discovered by the\nBlackBerry Cylance threat research team.\n\nLast but not least, there are some similarities and common TTPs to those outlined in our\nprevious TIP report on APT10 activities:\n\nImplementation of the hashing or crypto algorithms done manually by the malware\ndevelopers instead of using Windows APIs, with some modifications;\nUse of calculated hash values (fully or partially) for some features like crypto keys,\npart of the crypto keys, key generation, mutex names and so on;\n\n\n-----\n\nUsing the DLL side-loading technique to run a payload in memory;\nUsing PowerShell scripts for persistence and also for lateral movement;\nUsing exe for removing logs in order to hide their activities;\nSending victim machine data such as username, hostname, PID, current time and\nother specifics – though this point is not unique to APT10 backdoors and is quite\ncommon in most backdoor families;\nModifying implants shortly after security researchers publish their analysis of the\nactor’s activities and TTPs;\nTargeting mainly Japan, alongside associated overseas branches or organizations\nrelated to Japan.\n\nHowever, we observed some interesting differences in the A41APT campaign and\nprevious activities:\n\nP8RAT and SodaMaster did not contain a malware version number as opposed to\nthe previous malware instances used by APT10 such as LilimRAT, Lodeinfo and\nANEL;\nAs for the infection vector, we could not identify any spear-phishing email in this\nA41APT campaign, which is quite common in APT10 attacks.\n\nOverall, APT10 is considered a large APT group running multiple simultaneous\ncampaigns and, understandably, TTPs differ from one campaign to another. We believe\nthe differences mentioned here for the A41APT campaign represent a normal variation of\nTTPs that can be expected in the case of such a large APT group.\n\n## Conclusions\n\nWe consider the A41APT campaign to be one of APT10’s long-running activities. This\ncampaign introduced a very sophisticated multi-layer malware named Ecipekac and its\npayloads, which include different unique fileless malware such as P8RAT and\nSodaMaster.\n\nIn our opinion, the most significant aspect of the Ecipekac malware is that, apart from the\nlarge number of layers, the encrypted shellcodes were being inserted into digitally signed\nDLLs without affecting the validity of the digital signature. When this technique is used,\nsome security solutions cannot detect these implants. Judging from main features of the\nP8RAT and SodaMaster backdoors, we believe that these modules are downloaders\nresponsible for downloading further malware that, unfortunately, we have not been able\nto obtain so far in our investigation.\n\nWe see the activity outlined in this report as a continuation of the activity we previously\nreported in our Threat Intelligence Portal, where, in 2019, this threat actor began\ntargeting overseas offices of Japanese associations or organizations using the ANEL\nmalware. The operations and implants of the campaign described in this report are\n\n\n-----\n\nremarkably stealthy, making it difficult to track the threat actor’s activities. The main\nstealth features are the fileless implants, obfuscation, anti-VM and removal of activity\ntracks.\n\nWe will continue to investigate and track the activities of the APT10 actor, which are\nexpected to keep improving its covertness with each year.\n\n## Appendix I – Indicators of Compromise\n\n**_Note: The indicators in this section are valid at the time of publication. Any future_**\n_changes will be directly updated in the corresponding .ioc file._\n\n### File Hashes (malicious documents, trojans, emails, decoys)\n\n**Ecipekac loader**\n\n[be53764063bb1d054d78f2bf08fb90f3  jli.dll   P8RAT](https://opentip.kaspersky.com/be53764063bb1d054d78f2bf08fb90f3/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n\n[cca46fc64425364774e5d5db782ddf54  vmtools.dll SodaMaster](https://opentip.kaspersky.com/cca46fc64425364774e5d5db782ddf54/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n\n[dd672da5d367fd291d936c8cc03b6467  CCFIPC64.DLL   FYAnti loader](https://opentip.kaspersky.com/dd672da5d367fd291d936c8cc03b6467/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n\n**Encrypted Ecipekac Layer II, IV loader (shellcode)**\n\n**md5  filename  payloads**\n\n[f60f7a1736840a6149d478b23611d561  vac.dll   P8RAT](https://opentip.kaspersky.com/f60f7a1736840a6149d478b23611d561/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n\n[59747955a8874ff74ce415e56d8beb9c  pcasvc.dll P8RAT](https://opentip.kaspersky.com/59747955a8874ff74ce415e56d8beb9c/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n\n[4638220ec2c6bc1406b5725c2d35edc3  wiaky002_CNC1755D.dll  SodaMaster](https://opentip.kaspersky.com/4638220ec2c6bc1406b5725c2d35edc3/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n\n[d37964a9f7f56aad9433676a6df9bd19  c_apo_ipoib6x.dll SodaMaster](https://opentip.kaspersky.com/d37964a9f7f56aad9433676a6df9bd19/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n\n[335ce825da93ed3fdd4470634845dfea  msftedit.prf.cco FYAnti loader](https://opentip.kaspersky.com/335ce825da93ed3fdd4470634845dfea/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n\n[f4c4644e6d248399a12e2c75cf9e4bdf  msdtcuiu.adi.wdb FYAnti loader](https://opentip.kaspersky.com/f4c4644e6d248399a12e2c75cf9e4bdf/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n\n**Encrypted QuasarRAT**\n\n**md5  filename  payloads**\n\n019619318e1e3a77f3071fb297b85cf3  web_lowtrust.config.uninstall QuasarRAT\n\n### Domains and IPs\n\n[151.236.30[.]223](https://opentip.kaspersky.com/151.236.30.223/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n\n[193.235.207[.]59](https://opentip.kaspersky.com/193.235.207.59/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n\n[45.138.157[.]83](https://opentip.kaspersky.com/45.138.157.83/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n\n[88.198.101[.]58](https://opentip.kaspersky.com/88.198.101.58/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n\n[www.rare-coisns[.]com](https://opentip.kaspersky.com/www.rare-coisns.com/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n\n## Appendix II – MITRE ATT&CK Mapping\n\n### This table contains all the TTPs identified in the analysis of the activity described in this report.\n\n**Tactic** **Technique** **Technique Name**\n\n\n-----\n\n**Initial**\n**Access**\n\n\n**T1133** **External Remote Services**\nUses vulnerabilities in Pulse Connect Secure to hijack a\nVPN session.\n\n**T1078** **Valid Accounts**\nUses stolen credentials to connect to the enterprise\nnetwork as initial infection.\n\n\n**Execution** **T1059.001** **Command and Scripting Interpreter: PowerShell**\nUses PowerShell to download implants and remove logs.\n\n**T1053.005** **Scheduled Task/Job: Scheduled Task**\nCreates a task for running a legitimate EXE with Ecipekac\n(malicious DLL) using DLL side-loading technique.\n\n**Persistence** **T1574.001** **Hijack Execution Flow: DLL Search Order Hijacking**\nUses a legitimate EXE file which loads Ecipekac\n(malicious DLL) in the current directory.\n\n**T1574.002** **Hijack Execution Flow: DLL Side-Loading**\nUses a legitimate EXE file which loads Ecipekac\n(malicious DLL) in the current directory.\n\n**T1053.005** **Scheduled Task/Job: Scheduled Task**\nCreates a task for running a legitimate EXE with Ecipekac\n(malicious DLL) using DLL side-loading technique.\n\n**T1078** **Scheduled Task/Job: Scheduled Task**\nUses stolen credentials to connect to the enterprise\nnetwork as initial infection.\n\n\n**Privilege**\n**Escalation**\n\n\n**T1574.001** **Hijack Execution Flow: DLL Search Order Hijacking**\nUses a legitimate EXE file which loads Ecipekac\n(malicious DLL) in the current directory.\n\n**T1574.002** **Hijack Execution Flow: DLL Side-Loading**\nUses a legitimate EXE file which loads Ecipekac\n(malicious DLL) in the current directory.\n\n**T1053.005** **Scheduled Task/Job: Scheduled Task**\nCreates a task for running a legitimate EXE with Ecipekac\n(malicious DLL) using DLL side-loading technique.\n\n\n-----\n\n**Defense**\n**Evasion**\n\n\n**T1078** **Scheduled Task/Job: Scheduled Task**\nUses stolen credentials to connect to the enterprise\nnetwork as initial infection.\n\n**T1574.001** **Hijack Execution Flow: DLL Search Order Hijacking**\nUses a legitimate EXE file which loads Ecipekac\n(malicious DLL) in the current directory.\n\n**T1574.002** **Hijack Execution Flow: DLL Side-Loading**\nUses a legitimate EXE file which loads Ecipekac\n(malicious DLL) in the current directory.\n\n**T1053.005** **Scheduled Task/Job: Scheduled Task**\nCreates a task for running a legitimate EXE with Ecipekac\n(malicious DLL) using DLL side-loading technique.\n\n**T1078** **Scheduled Task/Job: Scheduled Task**\nUses stolen credentials to connect to the enterprise\nnetwork as initial infection.\n\n**T1070.003** **Indicator Removal on Host: Clear Command History**\nRemoves Powershell execution logs using Wevtutil.exe.\n\n**T1036** **Masquerading**\nEncrypted shellcode of Ecipekac was embedded in the\nlegitimate DLL.\n\n**T1497.001** **Virtualization/Sandbox Evasion: System Checks**\nPayloads of Ecipekac check a registry key and process\nnames to identify VM environment.\n\n\n**Discovery** **T1057** **Process Discovery**\nChecks the process of VMware and VirtualBox to identify\nthe VM environment.\n\n**T1082** **System Information Discovery**\nSodaMaster sends system information such as\nuser_name, the host_name, PID of the malware module,\nOS_version, etc.\n\n**T1012** **Query Registry**\nChecks a registry key of VMware to identify the VM\nenvironment.\n\n\n-----\n\n**Lateral**\n**Movement**\n\n**Command**\n**and Control**\n\n\n**T1210** **Exploitation of Remote Services**\nUses vulnerabilities in Pulse Connect Secure to hijack a\nVPN session.\n\n**T1071.001** **Application Layer Protocol: Web Protocols**\nCobalt Strike’s stager uses HTTP protocol for\ncommunication with C2 server to disguise as a common\njQuery.\n\n**T1132.002** **Data Encoding: Non-Standard Encoding**\nSodaMaster uses an original data structure and RSA for\nthe first communication, then uses RC4 for encryption.\n\n\nAPT10: sophisticated multi-layered loader Ecipekac discovered in A41APT campaign\n\nYour email address will not be published. Required fields are marked *\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2021/2021.03.30.APT10/APT10_%20sophisticated%20multi-layered%20loader%20Ecipekac%20discovered%20in%20A41APT%20campaign%20_%20Securelist.pdf"
    ],
    "report_names": [
        "APT10_ sophisticated multi-layered loader Ecipekac discovered in A41APT campaign _ Securelist"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "ec14074c-8517-40e1-b4d7-3897f1254487",
            "created_at": "2023-01-06T13:46:38.300905Z",
            "updated_at": "2025-03-27T02:00:02.799108Z",
            "deleted_at": null,
            "main_name": "APT10",
            "aliases": [
                "TA429",
                "STONE PANDA",
                "POTASSIUM",
                "Red Apollo",
                "HOGFISH",
                "Cloud Hopper",
                "BRONZE RIVERSIDE",
                "ATK41",
                "G0045",
                "Menupass Team",
                "happyyongzi",
                "CVNX",
                "Granite Taurus"
            ],
            "source_name": "MISPGALAXY:APT10",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "ba3fff0c-3ba0-4855-9eeb-1af9ee18136a",
            "created_at": "2022-10-25T15:50:23.298889Z",
            "updated_at": "2025-03-27T02:00:55.433541Z",
            "deleted_at": null,
            "main_name": "menuPass",
            "aliases": [
                "menuPass",
                "POTASSIUM",
                "Stone Panda",
                "APT10",
                "Red Apollo",
                "CVNX",
                "HOGFISH",
                "BRONZE RIVERSIDE"
            ],
            "source_name": "MITRE:menuPass",
            "tools": [
                "certutil",
                "FYAnti",
                "UPPERCUT",
                "SNUGRIDE",
                "P8RAT",
                "RedLeaves",
                "SodaMaster",
                "pwdump",
                "Mimikatz",
                "PlugX",
                "PowerSploit",
                "ChChes",
                "cmd",
                "QuasarRAT",
                "AdFind",
                "Cobalt Strike",
                "PoisonIvy",
                "EvilGrab",
                "esentutl",
                "Impacket",
                "Ecipekac",
                "PsExec",
                "HUI Loader"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "ba9fa308-a29a-4928-9c06-73aafec7624c",
            "created_at": "2024-05-01T02:03:07.981061Z",
            "updated_at": "2025-03-27T02:05:17.28602Z",
            "deleted_at": null,
            "main_name": "BRONZE RIVERSIDE",
            "aliases": [
                "CTG-5938 ",
                "CVNX ",
                "Hogfish ",
                "MenuPass ",
                "POTASSIUM ",
                "Red Apollo ",
                "Stone Panda ",
                "APT10 "
            ],
            "source_name": "Secureworks:BRONZE RIVERSIDE",
            "tools": [
                " ChChes",
                " Cobalt Strike",
                " PlugX",
                " PoisonIvy",
                " QuasarRAT",
                " QuasarRAT Loader",
                " RedLeaves",
                "ANEL"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "4c68ccd0-caba-4189-9ead-86ac4c2d9b70",
            "created_at": "2024-05-01T02:03:07.930196Z",
            "updated_at": "2025-03-27T02:05:17.251237Z",
            "deleted_at": null,
            "main_name": "BRONZE ATLAS",
            "aliases": [
                "Axiom",
                "BARIUM ",
                "Blackfly ",
                "CTG-2633",
                "GREF",
                "Group 72 ",
                "Red Kelpie ",
                "TG-2633 ",
                "Wicked Panda ",
                "Winnti",
                "APT41 "
            ],
            "source_name": "Secureworks:BRONZE ATLAS",
            "tools": [
                " CCleaner v5.33 backdoor",
                " ChinaChopper",
                " Cobalt Strike",
                " Dicey MSDN",
                " ForkPlayground",
                " HUC Proxy Malware (Htran)",
                " Mimikatz",
                " PipeMon",
                " PlugX",
                " PortReuse",
                " Powershell Empire",
                " RCMD",
                " RbDoor",
                " SPEEDBOAT",
                " ShadowPad",
                " Sidewalk",
                " Speculoos",
                " TeamViewer",
                " Winnkit",
                " Winnti",
                " reg save",
                " vssadmin",
                "Acehash"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "4d5f939b-aea9-4a0e-8bff-003079a261ea",
            "created_at": "2023-01-06T13:46:39.04841Z",
            "updated_at": "2025-03-27T02:00:02.985296Z",
            "deleted_at": null,
            "main_name": "APT41",
            "aliases": [
                "G0096",
                "Grayfly",
                "BARIUM",
                "BRONZE ATLAS",
                "BRONZE EXPORT",
                "Red Kelpie",
                "HOODOO",
                "Brass Typhoon",
                "TA415",
                "WICKED SPIDER",
                "WICKED PANDA",
                "G0044",
                "Earth Baku"
            ],
            "source_name": "MISPGALAXY:APT41",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "e698860d-57e8-4780-b7c3-41e5a8314ec0",
            "created_at": "2022-10-25T15:50:23.287929Z",
            "updated_at": "2025-03-27T02:00:55.43005Z",
            "deleted_at": null,
            "main_name": "APT41",
            "aliases": [
                "APT41",
                "Wicked Panda",
                "Brass Typhoon",
                "BARIUM"
            ],
            "source_name": "MITRE:APT41",
            "tools": [
                "ASPXSpy",
                "BITSAdmin",
                "PlugX",
                "Impacket",
                "gh0st RAT",
                "netstat",
                "PowerSploit",
                "ZxShell",
                "KEYPLUG",
                "ipconfig",
                "sqlmap",
                "China Chopper",
                "ShadowPad",
                "MESSAGETAP",
                "Mimikatz",
                "certutil",
                "njRAT",
                "Cobalt Strike",
                "pwdump",
                "BLACKCOFFEE",
                "ROCKBOOT",
                "dsquery",
                "Winnti for Linux",
                "DUSTTRAP",
                "Derusbi",
                "ftp"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "04b07437-41bb-4126-bcbb-def16f19d7c6",
            "created_at": "2022-10-25T16:07:24.232628Z",
            "updated_at": "2025-03-27T02:02:10.146043Z",
            "deleted_at": null,
            "main_name": "Stone Panda",
            "aliases": [
                "APT 10",
                "ATK 41",
                "Bronze Riverside",
                "CTG-5938",
                "CVNX",
                "Cuckoo Spear",
                "Earth Kasha",
                "Granite Taurus",
                "Happyyongzi",
                "Hogfish",
                "ITG01",
                "Operation A41APT",
                "Operation Cache Panda",
                "Operation ChessMaster",
                "Operation Cloud Hopper",
                "Operation Cuckoo Spear",
                "Operation New Battle",
                "Operation Soft Cell",
                "Operation TradeSecret",
                "Potassium",
                "Red Apollo",
                "Stone Panda",
                "TA429",
                "menuPass",
                "menuPass Team"
            ],
            "source_name": "ETDA:Stone Panda",
            "tools": [
                "Agent.dhwf",
                "Agentemis",
                "Anel",
                "AngryRebel",
                "BKDR_EVILOGE",
                "BKDR_HGDER",
                "BKDR_NVICM",
                "BUGJUICE",
                "CHINACHOPPER",
                "ChChes",
                "China Chopper",
                "Chymine",
                "CinaRAT",
                "Cobalt Strike",
                "CobaltStrike",
                "DARKTOWN",
                "DESLoader",
                "DILLJUICE",
                "DILLWEED",
                "Darkmoon",
                "DelfsCake",
                "Derusbi",
                "Destroy RAT",
                "DestroyRAT",
                "Ecipekac",
                "Emdivi",
                "EvilGrab",
                "EvilGrab RAT",
                "FYAnti",
                "Farfli",
                "Gen:Trojan.Heur.PT",
                "Gh0st RAT",
                "Ghost RAT",
                "GreetCake",
                "HAYMAKER",
                "HEAVYHAND",
                "HEAVYPOT",
                "HTran",
                "HUC Packet Transmit Tool",
                "Ham Backdoor",
                "HiddenFace",
                "Impacket",
                "Invoke the Hash",
                "KABOB",
                "Kaba",
                "Korplug",
                "LODEINFO",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "MiS-Type",
                "Mimikatz",
                "Moudour",
                "Mydoor",
                "NBTscan",
                "NOOPDOOR",
                "Newsripper",
                "P8RAT",
                "PCRat",
                "PlugX",
                "Poison Ivy",
                "Poldat",
                "PowerSploit",
                "PowerView",
                "PsExec",
                "PsList",
                "Quarks PwDump",
                "Quasar RAT",
                "QuasarRAT",
                "RedDelta",
                "RedLeaves",
                "Rubeus",
                "SNUGRIDE",
                "SPIVY",
                "SharpSploit",
                "SigLoader",
                "SinoChopper",
                "SodaMaster",
                "Sogu",
                "TIGERPLUG",
                "TVT",
                "Thoper",
                "Trochilus RAT",
                "UpperCut",
                "Vidgrab",
                "WinRAR",
                "WmiExec",
                "Wmonder",
                "Xamtrav",
                "Yggdrasil",
                "Zlib",
                "certutil",
                "certutil.exe",
                "cobeacon",
                "dfls",
                "lena",
                "nbtscan",
                "pivy",
                "poisonivy",
                "pwdump"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716497,
    "ts_updated_at": 1743041786,
    "ts_creation_date": 1617249416,
    "ts_modification_date": 1617249416,
    "files": {
        "pdf": "https://archive.orkl.eu/7c8a47dad5440202660007a31618e4f85d0d86fe.pdf",
        "text": "https://archive.orkl.eu/7c8a47dad5440202660007a31618e4f85d0d86fe.txt",
        "img": "https://archive.orkl.eu/7c8a47dad5440202660007a31618e4f85d0d86fe.jpg"
    }
}