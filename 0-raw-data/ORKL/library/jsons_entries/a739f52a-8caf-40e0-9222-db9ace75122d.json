{
    "id": "a739f52a-8caf-40e0-9222-db9ace75122d",
    "created_at": "2023-01-12T14:58:56.120552Z",
    "updated_at": "2025-03-27T02:15:41.669439Z",
    "deleted_at": null,
    "sha1_hash": "06625ba8f3ad6dc6f4179bfe481c91a8814c221a",
    "title": "2019-08-22 - Asruex Backdoor Variant Infects Word Documents and PDFs Through Old MS Office and Adobe Vulnerabilities",
    "authors": "",
    "file_creation_date": "2022-05-28T15:54:55Z",
    "file_modification_date": "2022-05-28T15:54:55Z",
    "file_size": 198627,
    "plain_text": "# Asruex Backdoor Infects Files Via Old Vulnerabilities\n\n**blog.trendmicro.com/trendlabs-security-intelligence/asruex-backdoor-variant-infects-word-documents-and-pdfs-through-old-ms-office-and-**\nadobe-vulnerabilities/\n\nAugust 22, 2019\n\n[Since it first emerged in 2015, Asruex has been known for its backdoor capabilities and connection to the](https://blogs.jpcert.or.jp/en/2016/06/asruex-malware-infecting-through-shortcut-files.html)\nspyware DarkHotel. However, when we encountered Asruex in a PDF file, we found that a variant of the\n[malware can also act as an infector particularly through the use of old vulnerabilities CVE-2012-0158 and](https://nvd.nist.gov/vuln/detail/CVE-2012-0158)\n[CVE-2010-2883, which inject code in Word and PDF files respectively. The use of old, patched](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2010-2883)\nvulnerabilities could hint that the variant was devised knowing that it can affect targets who have been\nusing older versions of Adobe Reader (versions 9.x up to before 9.4) and Acrobat (versions 8.x up to before\n8.2.5) on Windows and Mac OS X. Because of this unique infection capability, security researchers might\nnot consider checking files for an Asruex infection and continue to watch out for its backdoor abilities\nexclusively. Awareness of this new infection method could help users defend against the malware variant.\n\n## Technical details\n\nAsruex infects a system through a shortcut file that has a PowerShell download script, and spreads through\nremovable drives and network drives. The diagram below illustrates the malware's infection chain.\n\nFigure 1. Infection chain of Asruex\n\n**Infected PDF files We first encountered this variant as a PDF file. Further investigation revealed that the**\nPDF file itself was not a malicious file created by the actors behind this variant. It was simply a file infected\nby the Asruex variant. Infected PDF files would drop and execute the infector in the background if executed\nusing older versions of Adobe Reader and Adobe Acrobat. As it does so it still displays or opens the\ncontent of the original PDF host file. This tricks the user into believing that the PDF had acted normally.\nThis behavior is due to a specially crafted template that takes advantage of the CVE-2010-2883\nvulnerability while appending the host file. The vulnerability is found in the strcat function of Adobe’s\n\n\n-----\n\nCoolType.dll, which is a typography engine. Since this function does not check the length of the font to be\nregistered, it can cause a stack buffer overflow to execute its shellcode. Finally, it decrypts the original PDF\nhost file using XOR. This process is seen in the images below.\n\nFigure 2. Vulnerability being exploited by the variant\n\nFigure 3. Decrypting the original PDF host file\n\nIt will then drop and execute the embedded executable detected as Virus.Win32.ASRUEX.A.orig, as seen\nin figure 4.\n\nFigure 4. The embedded executable dropped by the malware\n\nThis executable is responsible for several anti-debugging and anti-emulation functions. It detects if avast!\nSandbox\\WINDOWS\\system32\\kernel32.dll exists on any root, as an anti-debugging measure. It then\nchecks the following information (listed below), to determine if it is running in a sandbox environment:\n\nComputer names and user names\nExported functions by loaded modules\nFile names\nRunning processes\nModule version of running process\nCertain strings in disk names\n\nThe executable file also injects the DLL c982d2ab066c80f314af80dd5ba37ff9dd99288f (detected as\nVirus.Win32.ASRUEX.A.orig) into a legitimate Windows process memory. This DLL is responsible for the\nmalware's infection and backdoor capabilities. It infects files with file sizes between 42,224 bytes and\n20,971,520 bytes, possibly as a parameter to narrow down host files into which their malware code could\nfit.\n\nFigure 5. Screenshot showing the added process\n\nFigure 6. Template that the infector uses to infect PDF samples; the filename of the executable is\nhighlighted\n\n**Infected Word documents As mentioned earlier, it uses a specially crafted template to exploit the CVE-**\n2012-0158 vulnerability to infect Word documents. The template is highlighted in figure 7.\n\nFigure 7. Template used to infect Word documents\n\nThe CVE-2012-0158 vulnerability allows possible attackers to execute an arbitrary code remotely through a\nWord document or web site. Similar to infected PDFs, it will drop and execute the infector in the\nbackground upon execution of the infected Word document file. At the same time, it will display the original\n\n\n-----\n\nDOC host file, letting users believe that the opened document is normal. The infected file would use XOR to\ndecrypt the original DOC host file, as seen in figure 8. The file would open like normal, with the only\ndifference found in the filename used by the infector. It drops and executes itself as rundll32.exe (figure 9).\n\nFigure 8. Use of an XOR to decrypt the original DOC host file\n\nFigure 9. Use of a different file name to drop and execute the infector\n\n**Infected executables Aside from the Word documents and PDF files, the malware also infects executable**\nfiles. This Asruex variant compresses and encrypts the original executable file or host file and appends it as\nits .EBSS section. This allows the malware to drop the infector, while also executing the host file like\nnormal. For infected executable files, the filename used by the infector when dropped is randomly\nassigned, as illustrated in figure 11.\n\nFigure 10. Code showing the host file being appended to the malware’s .EBSS section\n\nFigure 11. Random filename used for the dropped infector\n\n## Conclusion and security recommendations\n\nAs mentioned earlier, past reports have tagged Asruex for its [backdoor capabilities. The discovery of this](https://blogs.jpcert.or.jp/en/2016/06/asruex-malware-infecting-through-shortcut-files.html)\nparticular infection capability can help create adequate defenses against the malware variant. This case is\nnotable for its use of vulnerabilities that have been discovered (and patched) over five years ago, when\nwe’ve been seeing this malware variant in the wild for only a year. This hints that the cybercriminals behind\nit had devised the variant knowing that users have not yet patched or updated to newer versions of the\nAdobe Acrobat and Adobe Reader software. Understandably, this could pose a challenge for organizations\nas updating widely-used software could result in downtime of critical servers, and it could be costly and time\nconsuming. If patching and updating might not be a present option, organizations can consider security\n[measures like virtual patching to help complement existing security measures and patch management](https://www.trendmicro.com/vinfo/us/security/news/security-technology/security-101-virtual-patching)\nprocesses. In general, users can take the necessary measures to defend against similar threats by\nfollowing security best practices. We list down some of the steps users can take to defend against Asruex\nand similar malware:\n\nAlways scan removable drives before executing any file that may be stored in it.\nAvoid accessing suspicious or unknown URLs.\nBe cautious when opening or downloading email attachments, especially from unknown or unsolicited\nemail.\n\nUsers and enterprises can also benefit from a solution that uses a multilayered approach against threats\n[that are similar to Asruex. We recommend employing endpoint application control that reduces attack](https://blog.trendmicro.com/en_us/business/products/user-protection/sps/endpoint.html)\nexposure by ensuring that only files, documents, and updates associated with whitelisted applications and\n[sites can be installed, downloaded, and viewed. Endpoint solutions powered by XGen™ security such](http://go.trendmicro.com/sem/sem/www.trendmicro.com/us/business/xgen/index.html)\nas [Trend Micro™ Security and](https://blog.trendmicro.com/en_us/forHome/products.html) [Trend Micro Network Defense can detect related malicious files and URLs](https://blog.trendmicro.com/en_us/business/products/network.html)\n\n\n-----\n\nand protect users systems. Trend Micro [Smart Protection Suites and](https://blog.trendmicro.com/en_us/business/products/user-protection/sps.html) Trend Micro Worry-Free\nBusiness Security, which have [behavior monitoring capabilities, can additionally protect from these types of](https://success.trendmicro.com/solution/1122593-configuring-behavior-monitoring-settings-in-apex-one)\nthreats by detecting malicious files, as well as blocking all related malicious URLs.\n\n## Indicators of Compromise (IoCs)\n\n**SHA256** **Detection Name**\n\nb261f49fb6574af0bef16765c3db2900a5d3ca24639e9717bc21eb28e1e6be77 Virus.Win32.ASRUEX.A.orig\n\nCyber Threats\n\nAsruex has been known for its backdoor capabilities. However, when we encountered Asruex in a PDF file,\nwe found that a variant of the malware can also act as an infector particularly through the use of old\nvulnerabilities.\n\nBy: Ian Mercado, Mhica Romero August 22, 2019 Read time: ( words)\n\nContent added to Folio\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-08-22 - Asruex Backdoor Variant Infects Word Documents and PDFs Through Old MS Office and Adobe Vulnerabilities.pdf"
    ],
    "report_names": [
        "2019-08-22 - Asruex Backdoor Variant Infects Word Documents and PDFs Through Old MS Office and Adobe Vulnerabilities.pdf"
    ],
    "threat_actors": [
        {
            "id": "1dadf04e-d725-426f-9f6c-08c5be7da159",
            "created_at": "2022-10-25T15:50:23.624538Z",
            "updated_at": "2025-03-27T02:00:55.508759Z",
            "deleted_at": null,
            "main_name": "Darkhotel",
            "aliases": [
                "Darkhotel",
                "DUBNIUM",
                "Zigzag Hail"
            ],
            "source_name": "MITRE:Darkhotel",
            "tools": null,
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "99cb4e5b-8071-4f9e-aa1d-45bfbb6197e3",
            "created_at": "2023-01-06T13:46:38.860754Z",
            "updated_at": "2025-03-27T02:00:02.937438Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "SectorJ04 Group",
                "Dudear",
                "G0092",
                "ATK103",
                "Hive0065",
                "Spandex Tempest",
                "GRACEFUL SPIDER",
                "GOLD TAHOE",
                "CHIMBORAZO",
                "SectorJ04"
            ],
            "source_name": "MISPGALAXY:TA505",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "b13c19d6-247d-47ba-86ba-15a94accc179",
            "created_at": "2024-05-01T02:03:08.149923Z",
            "updated_at": "2025-03-27T02:05:17.422065Z",
            "deleted_at": null,
            "main_name": "TUNGSTEN BRIDGE",
            "aliases": [
                "DUBNIUM ",
                "DarkHotel ",
                "CTG-1948 "
            ],
            "source_name": "Secureworks:TUNGSTEN BRIDGE",
            "tools": [
                "Nemim"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "2b4eec94-7672-4bee-acb2-b857d0d26d12",
            "created_at": "2023-01-06T13:46:38.272109Z",
            "updated_at": "2025-03-27T02:00:02.790029Z",
            "deleted_at": null,
            "main_name": "DarkHotel",
            "aliases": [
                "DUBNIUM",
                "Fallout Team",
                "Luder",
                "Tapaoux",
                "Shadow Crane",
                "APT-C-06",
                "SIG25",
                "Karba",
                "Nemim",
                "Nemin",
                "G0012",
                "ATK52",
                "T-APT-02",
                "TUNGSTEN BRIDGE",
                "Zigzag Hail"
            ],
            "source_name": "MISPGALAXY:DarkHotel",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "75d4d6a9-b5d1-4087-a7a0-e4a9587c45f4",
            "created_at": "2022-10-25T15:50:23.5188Z",
            "updated_at": "2025-03-27T02:00:55.489882Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "TA505",
                "Hive0065",
                "Spandex Tempest",
                "CHIMBORAZO"
            ],
            "source_name": "MITRE:TA505",
            "tools": [
                "AdFind",
                "Azorult",
                "FlawedAmmyy",
                "Mimikatz",
                "Dridex",
                "TrickBot",
                "Get2",
                "FlawedGrace",
                "Cobalt Strike",
                "ServHelper",
                "Amadey",
                "SDBbot",
                "PowerSploit"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "c0cedde3-5a9b-430f-9b77-e6568307205e",
            "created_at": "2022-10-25T16:07:23.528994Z",
            "updated_at": "2025-03-27T02:02:09.847683Z",
            "deleted_at": null,
            "main_name": "DarkHotel",
            "aliases": [
                "APT-C-06",
                "ATK 52",
                "CTG-1948",
                "Dubnium",
                "Fallout Team",
                "Higaisa",
                "Luder",
                "Operation DarkHotel",
                "Operation Daybreak",
                "Operation Inexsmar",
                "Operation PowerFall",
                "Operation The Gh0st Remains the Same",
                "SIG25",
                "Shadow Crane",
                "T-APT-02",
                "Tungsten Bridge",
                "Zigzag Hail"
            ],
            "source_name": "ETDA:DarkHotel",
            "tools": [
                "Asruex",
                "DarkHotel",
                "DmaUp3.exe",
                "GreezeBackdoor",
                "Karba",
                "Nemain",
                "Nemim",
                "Ramsay",
                "Retro",
                "Tapaoux",
                "Trojan.Win32.Karba.e",
                "Virus.Win32.Pioneer.dx",
                "igfxext.exe",
                "msieckc.exe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "e447d393-c259-46e2-9932-19be2ba67149",
            "created_at": "2022-10-25T16:07:24.28282Z",
            "updated_at": "2025-03-27T02:02:10.159466Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "ATK 103",
                "Chimborazo",
                "Gold Evergreen",
                "Gold Tahoe",
                "Graceful Spider",
                "Hive0065",
                "Operation Tovar",
                "Operation Trident Breach",
                "SectorJ04",
                "Spandex Tempest",
                "TA505",
                "TEMP.Warlock"
            ],
            "source_name": "ETDA:TA505",
            "tools": [
                "Amadey",
                "AmmyyRAT",
                "AndroMut",
                "Azer",
                "Bart",
                "Bugat v5",
                "CryptFile2",
                "CryptoLocker",
                "CryptoMix",
                "CryptoShield",
                "Dridex",
                "Dudear",
                "EmailStealer",
                "FRIENDSPEAK",
                "Fake Globe",
                "Fareit",
                "FlawedAmmyy",
                "FlawedGrace",
                "FlowerPippi",
                "GOZ",
                "GameOver Zeus",
                "GazGolder",
                "Gelup",
                "Get2",
                "GetandGo",
                "GlobeImposter",
                "Gorhax",
                "GraceWire",
                "Gussdoor",
                "Jaff",
                "Kasidet",
                "Kegotip",
                "Kneber",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Locky",
                "MINEBRIDGE",
                "MINEBRIDGE RAT",
                "MirrorBlast",
                "Neutrino Bot",
                "Neutrino Exploit Kit",
                "P2P Zeus",
                "Peer-to-Peer Zeus",
                "Philadelphia",
                "Philadephia Ransom",
                "Pony Loader",
                "Rakhni",
                "ReflectiveGnome",
                "Remote Manipulator System",
                "RockLoader",
                "RuRAT",
                "SDBbot",
                "ServHelper",
                "Shifu",
                "Siplog",
                "TeslaGun",
                "TiniMet",
                "TinyMet",
                "Trojan.Zbot",
                "Wsnpoem",
                "Zbot",
                "Zeta",
                "ZeuS",
                "Zeus"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535536,
    "ts_updated_at": 1743041741,
    "ts_creation_date": 1653753295,
    "ts_modification_date": 1653753295,
    "files": {
        "pdf": "https://archive.orkl.eu/06625ba8f3ad6dc6f4179bfe481c91a8814c221a.pdf",
        "text": "https://archive.orkl.eu/06625ba8f3ad6dc6f4179bfe481c91a8814c221a.txt",
        "img": "https://archive.orkl.eu/06625ba8f3ad6dc6f4179bfe481c91a8814c221a.jpg"
    }
}