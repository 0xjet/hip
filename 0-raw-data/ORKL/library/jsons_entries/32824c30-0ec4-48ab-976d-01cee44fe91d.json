{
    "id": "32824c30-0ec4-48ab-976d-01cee44fe91d",
    "created_at": "2023-01-12T15:03:45.525984Z",
    "updated_at": "2025-03-27T02:15:35.501196Z",
    "deleted_at": null,
    "sha1_hash": "bcf801051a22e3e4470065170e287a0343d4ea43",
    "title": "2022-04-05 - A New Info Stealer Targeting Over 30 Browsers",
    "authors": "",
    "file_creation_date": "2022-05-27T23:06:54Z",
    "file_modification_date": "2022-05-27T23:06:54Z",
    "file_size": 2125171,
    "plain_text": "# Inside Lightning Stealer\n\n**blog.cyble.com/2022/04/05/inside-lightning-stealer/**\n\n## A New Info Stealer Targeting over 30 Browsers\n\n\nApril 5, 2022\n\n\n[Cyble Research Labs recently encountered Lightning Stealer – a new Info Stealer variant. An info](https://twitter.com/3xp0rtblog/status/1509484419354144774?s=20&t=ZPTBthpnHp411ukKLpJ91Q)\nstealer is a type of malware designed specifically to steal data from the victim’s system. This type of\nmalware has emerged as a serious threat as Threat Actors use them to get initial access to corporate\nnetworks.\n\nLightning stealer can target 30+ Firefox and Chromium-based browsers and steal crypto wallets,\nTelegram data, Discord tokens, and Steam user’s data. Unlike other info stealers, Lightning Stealer\nstores all the stolen data in the JSON format for exfiltration.\n\n\n-----\n\nFigure 1: Lightning Stealer C&C Panel\nLightning Stealer is a . NET-based Info Stealer. Figure 2 shows the file details.\n\nFigure 2: File information\n\n## Technical Analysis\n\nThe methods in Main()function of the malware binary (SHA 256:\n_a2a3b6db773b95fa27501f081b03daf2a29bfb800b4efa397cc4fc59ff755368) – which is ultimately_\nresponsible for stealing data have been presented in a sequential manner as per to their execution.\nRefer to Figure 3.\n\n\n-----\n\nFigure 3: Main\n\nfunction\nThe malware first calls Input.GetLogGecko method. This method will return stolen passwords, cookies,\nand history from Firefox-based browsers upon execution.\n\nIt initially identifies the Firefox-based browsers present in a system bypassing the respective browser’s\npath in the “AppData” folder to the Directory.Exists() method. If this returns as “True,” those paths will be\nadded to a new list for stealing data. The figure below shows the Firefox-based browsers targeted by\nthe malware.\n\nFigure 4: Firefox-based browsers targeted by\n\nmalware\nFirefox-based browsers store user data in a Profiles folder under the “AppData\\Browser_name”\ndirectory. Lightning Stealer checks this directory along with the file names mentioned below:\n\nkey4.db: Stores the encryption keys and master password for logins.json.\nlogins.json: These files store the usernames and passwords.\nplaces.sqlite: This file stores the user search history, downloads, and bookmarks data.\n\nIt steals the browser’s data only if the above files are present.\n\nIt first steals the data from the login.json file and looks for mozglue.dll and nss3.dll, which will be used to\ndecrypt the “login.json” file. Figure 5 shows the credential-stealing functionality for Firefox-based\nbrowsers.\n\n\n-----\n\nFigure 5: Stealing login credentials from Firefox based browsers\nThen malware steals the cookies data from moz_cookies table in “cookies.sqlite ” file and stores the\ndata in the following format (refer Figure 6) :\n\nDomain =\nName =\nValue =\nPath =\nExpires =\nIsSecure =\n\nFigure 6: Cookie stealing functionality on Firefox-based browsers\nSimilarly, the malware steals the browser’s history from the moz_places table in the “places.sqlite” file\nand extracts the data in the following format:\n\nUrl =\nTitle =\nVisits =\nTime =\n\nThe figure below shows the browser’s history stealing functionality.\n\n\n-----\n\nFigure 7: Steals history on Firefox-based browsers\nAfter stealing data from Firefox-based browsers, the malware targets Chromium-based browsers. Figure\n8 shows the Chromium-based browsers targeted by the Lightning stealer.\n\nFigure 8: Chromium-based\n\nbrowsers targeted by Lightning Stealer\nThe sensitive user data, such as login credentials and cookies, stored in Chrome-based browsers are\npresent in an encrypted form. The malware enumerates and gets the name of all files present in the\n“Browser-name\\User Data\\” folder and checks for the “Local State” file, which stores the encrypted keys\nused by Chrome to decrypt the login data.\n\n[If this file is present, the malware uses the DPAPI()functionto decrypt the encryption keys in the “Local](https://docs.microsoft.com/en-us/dotnet/standard/security/how-to-use-data-protection)\nState” file by calling Dpapi.CryptUnprotectData() function as can be seen in figure below.\n\n\n-----\n\nFigure 9: Use of DPAPI\n\nChromium browsers store the login data in the “Login Data” file, a .SQLite file. The malware steals the\ndata from the logins table present in this file and extracts the data in the following format:\n\nDomain =\nLogin =\nPassword =\n\nFigure 10: Stealing Login credentials from Chromium-based browsers\nThen malware steals cookies from cookies table present “Cookies” file and stores the data in following\nformat:\n\nDomain =\nName =\nPath =\nExpires =\nIsSecure = isSecure,\nValue = value\n\n\n-----\n\nFigure 11: Stealing cookies from Chromium-based browsers\nIn a similar manner, the malware steals the data from the following “.sqlite” files:\n\ncredit cards data from the logins table in the “Login Data” file.\n\nFilter Data in the format:\n\nNumber =\n\nYear =\n\nMonth =\n\nName =\n\nSearch history from the URLs table in the “History” file.\n\nFilter Data in format:\n\nUrl =\n\nTitle =\n\nVisits =\n\nTime =\n\nAutofill data from autofill table in “Web data” file.\n\nFilter Data in format:\n\nName =\n\nValue =\n\n\n-----\n\nFigure 12: Stealing Credit Cards, History, and Autofill data from Chromium-based browsers\nThis stealer has the capability to steal data from crypto wallets present in the victim’s system. The\nwallets targeted by the stealer can be seen in the figure below. The malware targets the wallet files\nspecific to the crypto applications mentioned in Figure 13. The malware then converts the wallet file’s\ncontent into Base64 and saves them into a list.\n\nFigure 13: Targeted Crypto wallets\n\nThe malware then proceeds to steal the victim’s system info. Figure 14 shows the system info gathered\nby malware.\n\n\n-----\n\nFigure 14: Stealing System Info\n\nThis malware also steals the .txt and .doc files present in the “Desktop” of the victim’s system. The\nmalware reads the content of the file and encodes it using Base64. Then it saves the encoded data and\nfile names on a list.\n\nFigure 15: Stealing files from victim’s desktop\nAfter this, the malware checks for the “Telegram Desktop\\tdata” file in the ApplicationData folder. Instead\nof copying the file to a different directory for exfiltration, it loads its content in memory, encodes it, and\nsaves it to a list.\n\nFigure\n\n16: Stealing Telegram data\nThe Lightning stealer steals the Discord token from the following directory:\n\n“discord\\\\Local Storage\\\\leveldb”\n\nIt retrieves a list of all files present in this directory and then starts stealing data from them.\n\n\n-----\n\nFigure 17: Stealing Discord token\nThe malware steals data from Steam, a video game digital distribution service. The stealer identifies the\nSteam installation path by checking the registry key value at\n“HKEY_LOCAL_MACHINE\\Software\\Valve\\Steam.”\n\nThe malware steals data from all the files present under the “config” folder.\n\nFigure 18: Stealing user data from Steam\nAfter this, the malware takes a screenshot of the victim’s screen and saves it in the “AppData\\Roaming\\”\nfolder named “1.png”. Then, it converts the screenshot into Base64 encoded strings and saves it to a\nlist.\n\n\n-----\n\nFigure 19: Taking a screenshot of the victim’s system\nThe malware stores all the stolen data in the lists shown in the figure below.\n\nFigure 20: Storing stolen data in lists\n\nThen it creates a file named “444.txt” in the “AppData\\Roaming\\” folder. Before writing content to this\nfile, it converts the stolen data into JSON strings using JsonSerializer.Serialize() method.\n\n\n-----\n\nFigure 21: Storing\n\ndata as JSON strings\nAfter this, the malware exfiltrates the data to the following domain:\n\n_hxxp[:]//panelss[.]xyz/Stealer/TSave_\n\nThe body of the request is sent in JSON format, as can be seen in the figure below.\n\nFigure 22: Data exfiltration\n\n## Conclusion\n\nInfo Stealers are adopting new techniques to become more evasive. As the information stolen by such\nmalware is sensitive, organizations should follow good security practices. In the past, Cyble Research\nLabs has observed data breaches of large organizations because of such threats. We have also\nwitnessed ransomware groups leveraging Info Stealers to gain initial network access and, eventually,\nexfiltrating sensitive data. Lightning Stealer is an emerging Info Stealer, and we may see variants of it\nemerge in the future.\n\n\n-----\n\n## Recommendations\n\nAvoid downloading pirated software from warez/torrent websites. The “Hack Tool” present on sites\nsuch as YouTube, torrent sites, etc., mainly contains such malware.\nUse strong passwords and enforce multi-factor authentication wherever possible.\nTurn on the automatic software update feature on your computer, mobile, and other connected\ndevices.\n\nUse a reputed anti-virus and internet security software package on your connected devices,\nincluding PC, laptop, and mobile.\nRefrain from opening untrusted links and email attachments without first verifying their\nauthenticity.\nEducate employees in terms of protecting themselves from threats like phishing’s/untrusted\nURLs.\nBlock URLs that could be used to spread the malware, e.g., Torrent/Warez.\nMonitor the beacon on the network level to block data exfiltration by malware or TAs.\nEnable Data Loss Prevention (DLP) Solution on the employees’ systems.\n\n## MITRE ATT&CK® Techniques \n\n**Tactic** **Technique ID** **Technique Name**\n\n**Execution** [T1204](https://attack.mitre.org/techniques/T1204/) User Execution\n\n\n**Credential Access** [T1555](https://attack.mitre.org/techniques/T1555/)\n\n[T1539](https://attack.mitre.org/techniques/T1539/)\n\n[T1552](https://attack.mitre.org/techniques/T1552/)\n\n[T1528](https://attack.mitre.org/techniques/T1528/)\n\n\nCredentials from Password Stores\n\nSteal Web Session Cookie\n\nUnsecured Credentials\n\nSteal Application Access Token\n\n\n**Collection** [T1113](https://attack.mitre.org/techniques/T1113/) Screen Capture\n\n\n**Discovery** [T1518](https://attack.mitre.org/techniques/T1518/)\n\n[T1124](https://attack.mitre.org/techniques/T1124/)\n\n[T1007](https://attack.mitre.org/techniques/T1007/)\n\n\nSoftware Discovery\n\nSystem Time Discovery\n\nSystem Service Discovery\n\n\n**Command and Control** [T1071](https://attack.mitre.org/techniques/T1071/) Application Layer Protocol\n\n**Exfiltration** [T1041](https://attack.mitre.org/techniques/T1041/) Exfiltration Over C2 Channel\n\n## Indicators of Compromise (IoCs): \n\n**Indicators** **Indicator**\n**type**\n\n\n**Description**\n\n\nhxxps[:]//panelss[.]xyz **URL** **C2 URL**\n\n\n-----\n\n1b922b6d15085da82e20fee0789a6617\n\n231a8e1a06d1673c8922d149af9d8f156dcbe228\n\na2a3b6db773b95fa27501f081b03daf2a29bfb800b4efa397cc4fc59ff755368\n\n473781fe7d820ef805d1aa79ace86816\n\nb7a42714b4e5dd7cfb6a2c8d7eb30d8bcce9a7ba\n\n6e016bcbead2dddb80dd4a592b1f3c042c52dc8a26ee37e0943f1a8c433e4c5f\n\n\n**Md5**\n\n**SHA-1**\n\n**SHA-**\n**256**\n\n**Md5**\n\n**SHA-1**\n\n**SHA-**\n**256**\n\n\n**Stealer**\n**Payload**\n\n**Stealer**\n**Payload**\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-04-05 - A New Info Stealer Targeting Over 30 Browsers.pdf"
    ],
    "report_names": [
        "2022-04-05 - A New Info Stealer Targeting Over 30 Browsers.pdf"
    ],
    "threat_actors": [
        {
            "id": "9f101d9c-05ea-48b9-b6f1-168cd6d06d12",
            "created_at": "2023-01-06T13:46:39.396409Z",
            "updated_at": "2025-03-27T02:00:03.074969Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "CHROMIUM",
                "ControlX",
                "Red Dev 10",
                "RedHotel",
                "Red Scylla",
                "TAG-22",
                "BRONZE UNIVERSITY",
                "AQUATIC PANDA",
                "Charcoal Typhoon",
                "BountyGlad"
            ],
            "source_name": "MISPGALAXY:Earth Lusca",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "6abcc917-035c-4e9b-a53f-eaee636749c3",
            "created_at": "2022-10-25T16:07:23.565337Z",
            "updated_at": "2025-03-27T02:02:09.868522Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Bronze University",
                "Charcoal Typhoon",
                "Chromium",
                "Red Dev 10",
                "Red Scylla"
            ],
            "source_name": "ETDA:Earth Lusca",
            "tools": [
                "Agentemis",
                "AntSword",
                "BIOPASS",
                "BIOPASS RAT",
                "BadPotato",
                "Behinder",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "Doraemon",
                "FRP",
                "Fast Reverse Proxy",
                "FunnySwitch",
                "HUC Port Banner Scanner",
                "KTLVdoor",
                "Mimikatz",
                "NBTscan",
                "POISONPLUG.SHADOW",
                "PipeMon",
                "RbDoor",
                "RibDoor",
                "RouterGod",
                "SAMRID",
                "ShadowPad Winnti",
                "SprySOCKS",
                "WinRAR",
                "Winnti",
                "XShellGhost",
                "cobeacon",
                "fscan",
                "lcx",
                "nbtscan"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "d53593c3-2819-4af3-bf16-0c39edc64920",
            "created_at": "2022-10-27T08:27:13.212301Z",
            "updated_at": "2025-03-27T02:00:55.529662Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Earth Lusca",
                "TAG-22",
                "Charcoal Typhoon",
                "CHROMIUM",
                "ControlX"
            ],
            "source_name": "MITRE:Earth Lusca",
            "tools": [
                "Mimikatz",
                "PowerSploit",
                "Tasklist",
                "certutil",
                "Cobalt Strike",
                "Winnti for Linux",
                "Nltest",
                "NBTscan",
                "ShadowPad"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535825,
    "ts_updated_at": 1743041735,
    "ts_creation_date": 1653692814,
    "ts_modification_date": 1653692814,
    "files": {
        "pdf": "https://archive.orkl.eu/bcf801051a22e3e4470065170e287a0343d4ea43.pdf",
        "text": "https://archive.orkl.eu/bcf801051a22e3e4470065170e287a0343d4ea43.txt",
        "img": "https://archive.orkl.eu/bcf801051a22e3e4470065170e287a0343d4ea43.jpg"
    }
}