{
    "id": "9f81011d-2903-4073-9e1a-45b3395290da",
    "created_at": "2023-01-12T15:02:19.65417Z",
    "updated_at": "2025-03-27T02:11:47.742735Z",
    "deleted_at": null,
    "sha1_hash": "be2b7161d5d54ba6ba17bc57324745f44cb58fe4",
    "title": "2017-05-12 - WannaCry ransomware used in widespread attacks all over the world",
    "authors": "",
    "file_creation_date": "2022-05-28T02:02:29Z",
    "file_modification_date": "2022-05-28T02:02:29Z",
    "file_size": 2655052,
    "plain_text": "# WannaCry ransomware used in widespread attacks all over the world\n\n**[securelist.com/blog/incidents/78351/wannacry-ransomware-used-in-widespread-attacks-all-over-the-world/](https://securelist.com/blog/incidents/78351/wannacry-ransomware-used-in-widespread-attacks-all-over-the-world/)**\n\nAuthors\n\nGReAT\n\nEarlier today, our products detected and successfully blocked a large number of ransomware\nattacks around the world. In these attacks, data is encrypted with the extension “.WCRY” added to\nthe filenames.\n\nOur analysis indicates the attack, dubbed “WannaCry”, is initiated through an SMBv2 remote code\nexecution in Microsoft Windows. This exploit (codenamed “EternalBlue”) has been made available\n[on the internet through the Shadowbrokers dump on April 14th, 2017 and patched by Microsoft on](https://docs.microsoft.com/en-us/security-updates/SecurityBulletins/2017/ms17-010)\nMarch 14.\n\nUnfortunately, it appears that many organizations have not yet installed the patch.\n\n\n-----\n\n_Source: https://support.kaspersky.com/shadowbrokers_\n\n[A few hours ago, Spain’s Computer Emergency Response Team CCN-CERT, posted an alert on](https://www.ccn-cert.cni.es/seguridad-al-dia/comunicados-ccn-cert/4464-ataque-masivo-de-ransomware-que-afecta-a-un-elevado-numero-de-organizaciones-espanolas.html)\ntheir site about a massive ransomware attack affecting several Spanish organizations. The alert\n[recommends the installation of updates in the Microsoft March 2017 Security Bulletin as a means](https://docs.microsoft.com/en-us/security-updates/SecurityBulletinSummaries/2017/ms17-mar)\nof stopping the spread of the attack.\n\n[The National Health Service (NHS) in the U.K. also issued an alert and confirmed infections at 16](https://digital.nhs.uk/article/1491/Statement-on-reported-NHS-cyber-attack)\nmedical institutions. We have confirmed additional infections in several additional countries,\nincluding Russia, Ukraine, and India.\n\nIt’s important to understand that while unpatched Windows computers exposing their SMB\nservices can be remotely attacked with the “EternalBlue” exploit and infected by the WannaCry\nransomware, the lack of existence of this vulnerability doesn’t really prevent the ransomware\ncomponent from working. Nevertheless, the presence of this vulnerability appears to be the most\nsignificant factor that caused the outbreak.\n\n\n-----\n\n_CCN-CERT alert (in Spanish)_\n\n## Analysis of the attack\n\nCurrently, we have recorded more than 45,000 attacks of the WannaCry ransomware in 74\ncountries around the world, mostly in Russia. It’s important to note that our visibility may be limited\nand incomplete and the range of targets and victims is likely much, much higher.\n\n\n-----\n\n_Geographical target distribution according to our telemetry for the first few hours of the attack_\n\nThe malware used in the attacks encrypts the files and also drops and executes a decryptor tool.\nThe request for $600 in Bitcoin is displayed along with the wallet. It’s interesting that the initial\nrequest in this sample is for $600 USD, as the first five payments to that wallet is approximately\n$300 USD. It suggests that the group is increasing the ransom demands.\n\n\n-----\n\nThe tool was designed to address users of multiple countries, with translated messages in\ndifferent languages.\n\n\n-----\n\n_Language list that the malware supports_\n\nNote that the “payment will be raised” after a specific countdown, along with another display\nraising urgency to pay up, threatening that the user will completely lose their files after the set\ntimeout. Not all ransomware provides this timer countdown.\n\nTo make sure that the user doesn’t miss the warning, the tool changes the user’s wallpaper with\ninstructions on how to find the decryptor tool dropped by the malware.\n\n\n-----\n\n_An image used to replace user’s wallpaper_\n\nMalware samples contain no reference to any specific culture or codepage other than universal\nEnglish and Latin codepage CP1252. The files contain version info stolen from random Microsoft\nWindows 7 system tools:\n\n_Properties of malware files used by WannaCry_\n\nFor convenient bitcoin payments, the malware directs to a page with a QR code at btcfrog, which\n[links to their main bitcoin wallet 13AM4VW2dhxYgXeQepoHkHSQuy6NgaEb94. Image metadata](https://blockchain.info/address/13AM4VW2dhxYgXeQepoHkHSQuy6NgaEb94)\ndoes not provide any additional info:\n\n\n-----\n\n[One of the Bitcoin wallets used by the attackers: 13AM4VW2dhxYgXeQepoHkHSQuy6NgaEb94](https://blockchain.info/address/13AM4VW2dhxYgXeQepoHkHSQuy6NgaEb94)\n\n_One of the attacker wallets received 0.88 BTC during the last hours_\n\nAnother Bitcoin wallets included in the attackers’ “readme.txt” from the samples are:\n\n115p7UMMngoj1pMvkpHijcRdfJNXj6LrLn – 0.32 BTC\n\n12t9YDPgwueZ9NyMgw519p7AA8isjr6SMw – 0.16 BTC\n\n1QAc9S5EmycqjzzWDc1yiWzr9jJLC8sLiY\n\nFor command and control, the malware extracts and uses Tor service executable with all\nnecessary dependencies to access the Tor network:\n\n\n-----\n\n_A list of dropped files related to Tor service_\n\nIn terms of targeted files, the ransomware encrypts files with the following extensions:\n```\n.der, .pfx, .key, .crt, .csr, .p12, .pem, .odt, .ott, .sxw, .stw, .uot, .3ds,\n.max, .3dm, .ods, .ots, .sxc, .stc, .dif, .slk, .wb2, .odp, .otp, .sxd, .std,\n.uop, .odg, .otg, .sxm, .mml, .lay, .lay6, .asc, .sqlite3, .sqlitedb, .sql,\n.accdb, .mdb, .dbf, .odb, .frm, .myd, .myi, .ibd, .mdf, .ldf, .sln, .suo, .cpp,\n.pas, .asm, .cmd, .bat, .ps1, .vbs, .dip, .dch, .sch, .brd, .jsp, .php, .asp,\n.java, .jar, .class, .mp3, .wav, .swf, .fla, .wmv, .mpg, .vob, .mpeg, .asf,\n.avi, .mov, .mp4, .3gp, .mkv, .3g2, .flv, .wma, .mid, .m3u, .m4u, .djvu, .svg,\n.psd, .nef, .tiff, .tif, .cgm, .raw, .gif, .png, .bmp, .jpg, .jpeg, .vcd, .iso,\n.backup, .zip, .rar, .tgz, .tar, .bak, .tbk, .bz2, .PAQ, .ARC, .aes, .gpg, .vmx,\n.vmdk, .vdi, .sldm, .sldx, .sti, .sxi, .602, .hwp, .snt, .onetoc2, .dwg, .pdf,\n.wk1, .wks, .123, .rtf, .csv, .txt, .vsdx, .vsd, .edb, .eml, .msg, .ost, .pst,\n.potm, .potx, .ppam, .ppsx, .ppsm, .pps, .pot, .pptm, .pptx, .ppt, .xltm, .xltx,\n.xlc, .xlm, .xlt, .xlw, .xlsb, .xlsm, .xlsx, .xls, .dotx, .dotm, .dot, .docm,\n.docb, .docx, .doc\n\n```\nThe file extensions that the malware is targeting contain certain clusters of formats including:\n\n1. Commonly used office file extensions (.ppt, .doc, .docx, .xlsx, .sxi).\n2. Less common and nation-specific office formats (.sxw, .odt, .hwp).\n3. Archives, media files (.zip, .rar, .tar, .bz2, .mp4, .mkv)\n4. Emails and email databases (.eml, .msg, .ost, .pst, .edb).\n5. Database files (.sql, .accdb, .mdb, .dbf, .odb, .myd).\n6. Developers’ sourcecode and project files (.php, .java, .cpp, .pas, .asm).\n7. Encryption keys and certificates (.key, .pfx, .pem, .p12, .csr, .gpg, .aes).\n8. Graphic designers, artists and photographers files (.vsd, .odg, .raw, .nef, .svg, .psd).\n9. Virtual machine files (.vmx, .vmdk, .vdi).\n\nThe WannaCry dropper drops multiple “user manuals” on different languages:\n\n\n-----\n\n```\nBulgarian, Chinese (simplified), Chinese (traditional), Croatian, Czech,\nDanish, Dutch, English, Filipino, Finnish, French, German, Greek, Indonesian,\nItalian, Japanese, Korean, Latvian, Norwegian, Polish, Portuguese, Romanian,\nRussian, Slovak, Spanish, Swedish, Turkish, Vietnamese\n\n```\nThe example of a “user manual” in English:\n```\nWhat Happened to My Computer?\nYour important files are encrypted.\nMany of your documents, photos, videos, databases and other files are no longer\naccessible because they have been encrypted. Maybe you are busy looking for a\nway to\nrecover your files, but do not waste your time. Nobody can recover your files\nwithout our decryption service.\n\n```\nCan I Recover My Files?\nSure. We guarantee that you can recover all your files safely and easily. But you have not so\nenough time.\nYou can decrypt some of your files for free. Try now by clicking .\nBut if you want to decrypt all your files, you need to pay.\nYou only have 3 days to submit the payment. After that the price will be doubled.\nAlso, if you don’t pay in 7 days, you won’t be able to recover your files forever.\nWe will have free events for users who are so poor that they couldn’t pay in 6 months.\n\nHow Do I Pay?\nPayment is accepted in Bitcoin only. For more information, click .\nPlease check the current price of Bitcoin and buy some bitcoins. For more information, click .\nAnd send the correct amount to the address specified in this window.\nAfter your payment, click . Best time to check: 9:00am – 11:00am GMT from Monday to Friday.\nOnce the payment is checked, you can start decrypting your files immediately.\n\nContact\nIf you need our assistance, send a message by clicking .\n\nWe strongly recommend you to not remove this software, and disable your anti-virus for a while,\nuntil you pay and the payment gets processed. If your anti-virus gets\nupdated and removes this software automatically, it will not be able to recover your files even if\nyou pay!\n\nIt also drops batch and VBS script files, and a “readme” (contents are provided in the appendix).\n\nJust in case the user closed out the bright red dialog box, or doesn’t understand it, the attackers\ndrop a text file to disk with further instruction. An example of their “readme” dropped to disk as\n“@Please_Read_Me@.txt” to many directories on the victim host. Note that the English written\nhere is done well, with the exception of “How can I trust?”. To date, only two transactions appear\nto have been made with this 115p7UMMngoj1pMvkpHijcRdfJNXj6LrLn bitcoin address for almost\n$300:\n\n\n-----\n\n```\nQ: What s wrong with my files?\n\n```\n\nA: Ooops, your important files are encrypted. It means you will not be able to access them\nanymore until they are decrypted.\nIf you follow our instructions, we guarantee that you can decrypt all your files quickly and safely!\nLet’s start decrypting!\n\nQ: What do I do?\n\nA: First, you need to pay service fees for the decryption.\nPlease send $300 worth of bitcoin to this bitcoin address:\n115p7UMMngoj1pMvkpHijcRdfJNXj6LrLn\n\nNext, please find an application file named “@WanaDecryptor@.exe”. It is the decrypt software.\nRun and follow the instructions! (You may need to disable your antivirus for a while.)\n\nQ: How can I trust?\n\nA: Don’t worry about decryption.\nWe will decrypt your files surely because nobody will trust us if we cheat users.\n\n- If you need our assistance, send a message by clicking on the decryptor window.\n\nOnce started it immediately spawns several processes to change file permissions and\ncommunicate with tor hidden c2 servers:\n\nattrib +h .\nicacls . /grant Everyone:F /T /C /Q\nC:\\Users\\xxx\\AppData\\Local\\Temp\\taskdl.exe\n@WanaDecryptor@.exe fi\n300921484251324.bat\nC:\\Users\\xxx\\AppData\\Local\\Temp\\taskdl.exe\nC:\\Users\\xxx\\AppData\\Local\\Temp\\taskdl.exe\n\nThe malware checks the mutexes “Global\\MsWinZonesCacheCounterMutexA” and\n“Global\\MsWinZonesCacheCounterMutexA0” (Update: Thanks Didier Stevens for the correction\non the extra mutex name!) to determine if a system is already infected. It also runs the command:\n```\ncmd.exe /c vssadmin delete shadows /all /quiet & wmic shadowcopy delete &\nbcdedit /set {default} bootstatuspolicy ignoreallfailures & bcdedit /set\n{default} recoveryenabled no & wbadmin delete catalog -quiet\n\n```\nThis results in an UAC popup that user may notice.\n\n\n-----\n\n_UAC popup to disable Volume Shadow Service (System Restore)_\n\nThe malware use TOR hidden services for command and control. The list of .onion domains\ninside is as following:\n\ngx7ekbenv2riucmf.onion\n57g7spgrzlojinas.onion\nXxlvbrloxvriy2c5.onion\n76jdd2ir2embyv47.onion\ncwwnhwhlz52maqm7.onion\nsqjolphimrr7jqw6.onion\n\n## Mitigation and detection information\n\n[Quite essential in stopping these attacks is the Kaspersky System Watcher component. The](https://support.kaspersky.com/11938)\nSystem Watcher component has the ability to rollback the changes done by ransomware in the\nevent that a malicious sample managed to bypass other defenses. This is extremely useful in\ncase a ransomware sample slips past defenses and attempts to encrypt the data on the disk.\n\n\n-----\n\n_System Watcher blocking the WannaCry attacks_\n\n**Mitigation recommendations:**\n\n1. Make sure that all hosts are running and have enabled endpoint security solutions.\n[2. Install the official patch (MS17-010) from Microsoft, which closes the affected SMB Server](https://docs.microsoft.com/en-us/security-updates/SecurityBulletins/2017/ms17-010)\n\nvulnerability used in this attack.\n3. Ensure that Kaspersky Lab products have the System Watcher component enabled.\n4. Scan all systems. After detecting the malware attack as\n\nMEM:Trojan.Win64.EquationDrug.gen, reboot the system. Once again, make sure MS17010 patches are installed.\n\n**Samples observed in attacks so far:**\n\n4fef5e34143e646dbf9907c4374276f5\n5bef35496fcbdbe841c82f4d1ab8b7c2\n775a0631fb8229b2aa3d7621427085ad\n7bf2b57f2a205768755c07f238fb32cc\n7f7ccaa16fb15eb1c7399d422f8363e8\n8495400f199ac77853c53b5a3f278f3e\n84c82835a5d21bbcf75a61706d8ab549\n86721e64ffbd69aa6944b9672bcabb6d\n8dd63adb68ef053e044a5a2f46e0d2cd\nb0ad5902366f860f85b892867e5b1e87\n\n\n-----\n\nd6114ba5f10ad67a4131ab72531f02da\ndb349b97c37d22f5ea1d1841e3c89eb4\ne372d07207b4da75b3434584cd9f3450\nf529f4556a5126bba499c26d67892240\n\n**Kaspersky Lab detection names:**\n\nTrojan-Ransom.Win32.Gen.djd\nTrojan-Ransom.Win32.Scatter.tr\nTrojan-Ransom.Win32.Wanna.b\nTrojan-Ransom.Win32.Wanna.c\nTrojan-Ransom.Win32.Wanna.d\nTrojan-Ransom.Win32.Wanna.f\nTrojan-Ransom.Win32.Zapchast.i\nPDM:Trojan.Win32.Generic\n\nKaspersky Lab experts are currently working on the possibility of creating a decryption tool to help\nvictims. We will provide an update when a tool is available.\n\n## Appendix\n\n**Batch file**\n```\n@echo off\necho SET ow = WScript.CreateObject(\"WScript.Shell\")> m.vbs\necho SET om =\now.CreateShortcut(\"C:\\Users\\ADMINI~1\\AppData\\Local\\Temp\\@WanaDecryptor@.exe.lnk\")>>\nm.vbs\n\n```\necho om.TargetPath = “C:\\Users\\ADMINI~1\\AppData\\Local\\Temp\\@WanaDecryptor@.exe”>>\nm.vbs\n\necho om.Save>> m.vbs\n\ncscript.exe //nologo m.vbs\n\ndel m.vbs\n\ndel /a %0\n\nm.vbs\n```\nSET ow = WScript.CreateObject(\"WScript.Shell\")\nSET om =\now.CreateShortcut(\"C:\\Users\\ADMINI~1\\AppData\\Local\\Temp\\@WanaDecryptor@.exe.lnk\")\nom.TargetPath = \"C:\\Users\\ADMINI~1\\AppData\\Local\\Temp\\@WanaDecryptor@.exe\"\nom.Save\n\n```\n[APT](https://securelist.com/tag/apt/)\n[Encryption](https://securelist.com/tag/encryption/)\n[Malware Descriptions](https://securelist.com/tag/malware-descriptions/)\n\n\n-----\n\n[Ransomware](https://securelist.com/tag/ransomware/)\n[Shadow Brokers](https://securelist.com/tag/shadow-brokers/)\n[Vulnerabilities and exploits](https://securelist.com/tag/vulnerabilities-and-exploits/)\n[WannaCry](https://securelist.com/tag/wannacry/)\n\nAuthors\n\nGReAT\n\nWannaCry ransomware used in widespread attacks all over the world\n\nYour email address will not be published. Required fields are marked *\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-05-12 - WannaCry ransomware used in widespread attacks all over the world.pdf"
    ],
    "report_names": [
        "2017-05-12 - WannaCry ransomware used in widespread attacks all over the world.pdf"
    ],
    "threat_actors": [
        {
            "id": "b740943a-da51-4133-855b-df29822531ea",
            "created_at": "2022-10-25T15:50:23.604126Z",
            "updated_at": "2025-03-27T02:00:55.505366Z",
            "deleted_at": null,
            "main_name": "Equation",
            "aliases": [
                "Equation"
            ],
            "source_name": "MITRE:Equation",
            "tools": null,
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "d4f7cf97-9c98-409c-8b95-b80d14c576a5",
            "created_at": "2022-10-25T16:07:24.561104Z",
            "updated_at": "2025-03-27T02:02:10.281202Z",
            "deleted_at": null,
            "main_name": "Shadow Brokers",
            "aliases": [],
            "source_name": "ETDA:Shadow Brokers",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "171b85f2-8f6f-46c0-92e0-c591f61ea167",
            "created_at": "2023-01-06T13:46:38.830188Z",
            "updated_at": "2025-03-27T02:00:02.929729Z",
            "deleted_at": null,
            "main_name": "The Shadow Brokers",
            "aliases": [
                "Shadow Brokers",
                "ShadowBrokers",
                "The ShadowBrokers",
                "TSB"
            ],
            "source_name": "MISPGALAXY:The Shadow Brokers",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535739,
    "ts_updated_at": 1743041507,
    "ts_creation_date": 1653703349,
    "ts_modification_date": 1653703349,
    "files": {
        "pdf": "https://archive.orkl.eu/be2b7161d5d54ba6ba17bc57324745f44cb58fe4.pdf",
        "text": "https://archive.orkl.eu/be2b7161d5d54ba6ba17bc57324745f44cb58fe4.txt",
        "img": "https://archive.orkl.eu/be2b7161d5d54ba6ba17bc57324745f44cb58fe4.jpg"
    }
}