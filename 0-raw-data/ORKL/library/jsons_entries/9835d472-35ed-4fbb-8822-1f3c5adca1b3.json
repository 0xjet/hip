{
    "id": "9835d472-35ed-4fbb-8822-1f3c5adca1b3",
    "created_at": "2023-01-12T15:06:15.130446Z",
    "updated_at": "2025-03-27T02:05:51.186527Z",
    "deleted_at": null,
    "sha1_hash": "d852160fb5fc2966a048fef134bf3204d608c860",
    "title": "2021-05-18 - Analysis of MountLocker",
    "authors": "",
    "file_creation_date": "2022-05-28T00:40:25Z",
    "file_modification_date": "2022-05-28T00:40:25Z",
    "file_size": 1108433,
    "plain_text": "# Malware-Analysis-Reports/MountLocker at master · Finch4/Malware-Analysis-Reports · GitHub\n\n**[github.com/Finch4/Malware-Analysis-Reports/tree/main/MountLocker](https://github.com/Finch4/Malware-Analysis-Reports/tree/main/MountLocker)**\n\nFinch4\n\n## Analysis of MountLocker\n\nMountLocker is a Ransomware which appeared first on July 2020, in the\nsample there are references to a Public RSA Key and ChaCha20. Lately\nseems an update added also a worm feature.\n\n**Please note, I'm still learning, the analysis is incomplete (and some parts**\n**may be wrong), if you want to read a full analysis read** **[here](https://chuongdong.com/reverse%20engineering/2021/05/23/MountLockerRansomware/)**\n\n## Sample\n\nMalwareBazaar:\nhttps://bazaar.abuse.ch/sample/4a5ac3c6f8383cc33c795804ba5f7f5553c029b\nbb4a6d28f1e4d8fb5107902c1/\n\n## Starting from the start\n\n\n-----\n\nHere is simply passing the the command-line string for the current process to\nthe function I renamed, `mw_main Inside` `mw_main we find two other calls to`\n```\nmw_check_parameters and mw_core\n\n## Diving into mw_check_parameters\n\n```\n\n-----\n\nThe function starts parsing the arguments, the result is then allocated to the\nvariable `command_line_args, if retrieving the arguments is successful the`\nsample will continue otherwise as you can imagine it will return and the if at\n```\nmw_main will never be True and the sample will exit.\n\n```\nWhen entering the if the most interesting functions seems the one which\nreceive as arguments: command_line_args, pNumArgs, {CUSTOM_STRING}, I\nrenamed this function `mw_check_if_contains`\n```\nmw_check_if_contains\n\n```\nstarting from the first two calls to this functions we can see the strings\n```\n\"/LOGIN=\" and \"/PASSWORD=\" stored inside what seems an array, later you\n\n```\nwill se that these arguments are used as part of the worm feature, `\"/LOGIN=\"`\nwill contains the `lpUserName and as you can image` `\"/PASSWORD=\" will`\ncontains `lpPassword the others are more features/options of MountLocker,`\nhere a list:\n```\ncommands = \n[\n \"/LOGIN=\",\n \"/PASSWORD=\",\n \"/CONSOLE\",\n \"/NODEL\",\n \"/NOKILL\",\n \"/NOLOG\",\n \"/SHAREALL\",\n \"/NETWORK\",\n \"/PARAMS=\",\n \"/TARGET=\",\n \"/FAST=\",\n \"/MIN=\",\n \"/MAX=\",\n \"/FULLPD\",\n \"/MARKER=\",\n \"/NOLOCK=\"\n]\n\n```\n\n-----\n\n## Diving into mw_core\n\n**The first two calls are for COM objects, since still I'm learning I didn't**\n**really understood how you use them, so for the moment I will ignore the**\n**calls related to it.**\n\nThe first call is easy understandable, is retrieving the admin status of the\ncurrent user, InitializeCriticalSection acts as Mutex for threads.\n```\ndword_1400137EC is assigned in mw_check_parameters and its value is 0,\n\n```\nso a !0 will return True, now we have two calls to `lstrcpyW,`\n```\n&ExistingFileName is assigned in mw_check_parameters\nmw_check_parameters\n\n```\nHere is checking if the file for the logs has been created, if yes set\n```\nisLogFeatureEnabled to True, same if the command \"/CONSOLE\" is\n\n```\npassed\n\n\n-----\n\ninside `mw_console_log` `isLogFeatureEnabled is checked if is True, if yes,`\ncall another function which will check if to write to file or console, or both\n```\nmw_console_log\nsub_140007454\nmw_collect_sys_informations\n\n```\nNow the function `mw_init_crypto will be called, I renamed this function like`\nthat, because seems importing the RSA Key\n\n\n-----\n\nHere is the RSA Key:\n```\n06 02 00 00 00 A4 00 00 52 53 41 31 00 08 00 00\n01 00 01 00 89 9C 9E 71 D9 2B E9 50 B1 75 DA 27\n07 AA 43 6D FD D7 EA 21 29 7E 8F 07 03 A7 77 57\nE4 7F F2 3D 8F 7C CE 25 51 A9 06 37 79 34 54 C2\nD3 6A 18 65 7F 60 21 13 D0 81 A1 46 AE D3 33 44\n17 21 98 BC 09 62 06 F5 5D 49 D9 37 7D 1E 06 9B\n99 48 2B 7C 75 0B DA DB C4 B6 E3 63 10 E0 FB C6\nFF C8 61 B5 B1 CC D9 F4 8E B9 B7 EE D3 1C EA 1C\n6B E7 99 95 07 34 F5 C0 FC C3 F0 CB 1A 37 86 F8\nD6 61 4D 37 73 BA 9C A7 1A 9D DF 87 B6 B3 76 CD\n85 8E A5 DD E8 E4 BB 42 FB 46 1E D6 E6 9E 89 52\n5D F8 B2 06 B9 6F 05 1D 5C 5A C4 D9 C3 89 05 98\nAD 95 7E FB 46 38 C0 F3 C3 3B 8D 8A 52 DB BD 42\nC9 0C E4 87 E9 8D 42 B0 C0 48 7A 7E 62 27 AE 87\nC8 00 44 89 E8 78 41 AC 79 EB DC 42 D1 97 9D 75\n9E 0D EE 43 33 05 61 F3 5D 65 5C 42 95 69 E8 E5\n34 3B 99 30 B7 CB E6 8F 85 F5 BB E8 33 A7 05 5A\nB6 A0 BE F1 A0 D8 38 F6 38 37 39 35 33 38 65 32\n30 62 38 32 65 38 30 30 35 32 64 64 35 66 37 65\n66 39 61 64 35 30 37 37\n\n```\nThe `CryptEncrypt call seems encrypting the buffer` `&Src with RSA, curios`\nis the fact that `&Src is used in another function which I renamed`\n```\nmw_wrap_chacha because is a wrapper to a function which uses ChaCha\n\n```\n[an help to recognize the ChaCha function is given to CAPA a fantastic tool](https://github.com/fireeye/capa)\n[developed by the FireEye Team](https://www.fireeye.com/)\n\n\n-----\n\nand also if you look carefully to the strings\n\nnext we can see some instructions that have something to do with the\ncommand `\"/NETWORK\" if you pass this argument and the executable isn't`\nstarted as administrator, the function will return\n\nif the `\"/NETWORK\" command isn't passed, we proceed`\n\nhere we check if the command `\"/NOKILL\" has been passed, if yes we`\nproceed to calling `mw_killservices and` `mw_kill_processes, from the`\nnames you can easily understand what it's doing, these are two lists of which\nservices and processes will terminate\n\nIf the service name contains those strings close the service\n\n\n-----\n\n```\nservices_to_close \n[\n \"SQL\",\n \"database\",\n \"msexchange\",\n]\n\n```\nThese are the processes\n\n\n-----\n\n```\nprocesses_to_kill \n[\n\"msftesql.exe\",\n\"sqlagent.exe\",\n\"sqlbrowser.exe\",\n\"sqlwriter.exe\",\n\"oracle.exe\",\n\"ocssd.exe\",\n\"dbsnmp.exe\",\n\"synctime.exe\",\n\"agntsvc.exe\",\n\"isqlplussvc.exe\",\n\"xfssvccon.exe\",\n\"sqlservr.exe\",\n\"mydesktopservice.exe\",\n\"ocautoupds.exe\",\n\"encsvc.exe\",\n\"firefoxconfig.exe\",\n\"tbirdconfig.exe\",\n\"mydesktopqos.exe\",\n\"ocomm.exe\",\n\"mysqld.exe\",\n\"mysqld-nt.exe\",\n\"mysqld-opt.exe\",\n\"dbeng50.exe\",\n\"sqbcoreservice.exe\",\n\"excel.exe\",\n\"infopath.exe\",\n\"msaccess.exe\",\n\"mspub.exe\",\n\"onenote.exe\",\n\"outlook.exe\",\n\"powerpnt.exe\",\n\"sqlservr.exe\",\n\"thebat.exe\",\n\"steam.exe\",\n\"thebat64.exe\",\n\"thunderbird.exe\",\n\"visio.exe\",\n\"winword.exe\",\n\"wordpad.exe\",\n\"QBW32.exe\",\n\"QBW64.exe\",\n\"ipython.exe\",\n\"wpython.exe\",\n\"python.exe\",\n\"dumpcap.exe\",\n\"procmon.exe\",\n\"procmon64.exe\",\n\"procexp.exe\",\n\"procexp64.exe\"\n]\n\n```\nafter killing the processes and the services, the sample checks for the\ncommand \"/TARGET=\"\n\n\n-----\n\nseems to be a command to target specific files, specific drive, specific server\n\nmeanwhile this is the default lock\n\n\n-----\n\n## Overview of the worm feature\n\nSeems the worm feature is divided in two categories:\n\nEnum PC into domain\nEnum PC into network\n\nBoth share the need of\n```\n\"/LOGIN=\" and \"/PASSWORD=\"\n\n```\nAfter getting access to the computer it will drop the same executable passing\nthe command `\"/NOLOG\", you can see also other if statements checking if the`\n```\nservername contains certain strings\n\n```\n\n-----\n\nAfter a service called `\"Update{GetTickCount()}\" will be created`\n\nwith `lpBinaryPathName equal to the path where the sample has been`\ndropped\n\nalso it seems to create a process with WMI\n\n[ROOT\\CIMV2](https://docs.microsoft.com/en-us/windows/win32/winrm/windows-remote-management-and-wmi#constructing-the-uri-prefix-for-wmi-classes)\n\n\n-----\n\n[Create - Win32](https://docs.microsoft.com/en-us/windows/win32/cimwin32prov/create-method-in-class-win32-process)\n\nThe function `mw_create_worm_service will return` `GetLastError()`\n\nif the return value != 1326 `ERROR_LOGON_FAILURE` `\"The user name or`\n\n`password is incorrect.\"` https://docs.microsoft.com/enus/windows/win32/debug/system-error-codes--1300-1699\nit will switch the return value and then write it in the logs\n\nSame for creating a process with the WMI\n\n\n-----\n\n## Conclusion\n\nI spent some time for this analysis, I hope it is correct and useful, please if you\nnotice some errors in the analysis let me know, I want to improve myself. Seen\nthis is my best analysis right now I would like to add some informations about\nmyself; I'm Italian and I'm 17 years old, I would like to get a job as Malware\nAnalyst when I will turn 18, for more information this is my secondary email:\n**[blacXkdog1X7of@XgmaiXl.com (remove all \"X\")](http://10.10.0.46/mailto:blacXkdog1X7of@XgmaiXl.com)**\n\nThank you for reading my analysis!\n\n## Feedbacks\n\nThanks to:\n\n[https://twitter.com/cPeterr [https://chuongdong.com/]](https://twitter.com/cPeterr)\n\n## Useful resources\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-05-18 - Analysis of MountLocker.pdf"
    ],
    "report_names": [
        "2021-05-18 - Analysis of MountLocker.pdf"
    ],
    "threat_actors": [
        {
            "id": "81dde5cc-c29f-430d-8c6e-e5e92d5015e7",
            "created_at": "2022-10-25T16:07:23.704358Z",
            "updated_at": "2025-03-27T02:02:09.932453Z",
            "deleted_at": null,
            "main_name": "Harvester",
            "aliases": [],
            "source_name": "ETDA:Harvester",
            "tools": [
                "Agentemis",
                "Cobalt Strike",
                "CobaltStrike",
                "Graphon",
                "Metasploit",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "f8dddd06-da24-4184-9e24-4c22bdd1cbbf",
            "created_at": "2023-01-06T13:46:38.626906Z",
            "updated_at": "2025-03-27T02:00:02.877001Z",
            "deleted_at": null,
            "main_name": "Tick",
            "aliases": [
                "Stalker Taurus",
                "PLA Unit 61419",
                "Nian",
                "BRONZE BUTLER",
                "REDBALDKNIGHT",
                "STALKER PANDA",
                "G0060"
            ],
            "source_name": "MISPGALAXY:Tick",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d4e7cd9a-2290-4f89-a645-85b9a46d004b",
            "created_at": "2022-10-25T16:07:23.419513Z",
            "updated_at": "2025-03-27T02:02:09.790389Z",
            "deleted_at": null,
            "main_name": "Bronze Butler",
            "aliases": [
                "Bronze Butler",
                "CTG-2006",
                "Operation ENDTRADE",
                "RedBaldNight",
                "Stalker Panda",
                "Stalker Taurus",
                "TEMP.Tick",
                "Tick"
            ],
            "source_name": "ETDA:Bronze Butler",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "9002 RAT",
                "AngryRebel",
                "Blogspot",
                "Daserf",
                "Datper",
                "Elirks",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "HOMEUNIX",
                "HidraQ",
                "HomamDownloader",
                "Homux",
                "Hydraq",
                "Lilith",
                "Lilith RAT",
                "McRAT",
                "MdmBot",
                "Mimikatz",
                "Minzen",
                "Moudour",
                "Muirim",
                "Mydoor",
                "Nioupale",
                "PCRat",
                "POISONPLUG.SHADOW",
                "Roarur",
                "RoyalRoad",
                "ShadowPad Winnti",
                "ShadowWali",
                "ShadowWalker",
                "SymonLoader",
                "WCE",
                "Wali",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "XShellGhost",
                "XXMM",
                "gsecdump",
                "rarstar"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "bf0489c5-1c07-41e6-91c9-855ad96ccc6a",
            "created_at": "2022-10-25T16:47:55.541639Z",
            "updated_at": "2025-03-27T02:05:17.253496Z",
            "deleted_at": null,
            "main_name": "BRONZE BUTLER",
            "aliases": [
                "Daserf",
                "Stalker Panda ",
                "Tick ",
                "CTG-2006 "
            ],
            "source_name": "Secureworks:BRONZE BUTLER",
            "tools": [
                " DGet",
                " Daserf",
                " Datper",
                " Gofarer",
                " MSGet",
                " Mimikatz",
                " RarStar",
                " Screen Capture Tool",
                " ShadowPad",
                " T-SMB",
                " WinRAR",
                " Windows Credential Editor",
                " gsecdump",
                " xmm downloader",
                " xxmm",
                "ABK"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673535975,
    "ts_updated_at": 1743041151,
    "ts_creation_date": 1653698425,
    "ts_modification_date": 1653698425,
    "files": {
        "pdf": "https://archive.orkl.eu/d852160fb5fc2966a048fef134bf3204d608c860.pdf",
        "text": "https://archive.orkl.eu/d852160fb5fc2966a048fef134bf3204d608c860.txt",
        "img": "https://archive.orkl.eu/d852160fb5fc2966a048fef134bf3204d608c860.jpg"
    }
}