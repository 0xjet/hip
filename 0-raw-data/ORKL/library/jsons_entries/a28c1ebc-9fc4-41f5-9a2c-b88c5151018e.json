{
    "id": "a28c1ebc-9fc4-41f5-9a2c-b88c5151018e",
    "created_at": "2023-01-12T15:04:31.725474Z",
    "updated_at": "2025-03-27T02:05:58.590061Z",
    "deleted_at": null,
    "sha1_hash": "fc58ac2f9ed73e7f21c853b9c8ac03e26afbd308",
    "title": "2022-02-25 - Reverse Engineering - Hermetic Wiper",
    "authors": "",
    "file_creation_date": "2022-05-28T00:27:19Z",
    "file_modification_date": "2022-05-28T00:27:19Z",
    "file_size": 1159959,
    "plain_text": "# Reverse Engineering | Hermetic Wiper\n\n**englert.one/hermetic-wiper-reverse-code-engineering**\n\n## von Thomas\n\nErstellt am 25.02.2022\n\n## Hermetic Wiper eine erste Analyse\n\nDer Ukraine-Russland Konflikt wird auch im Internet mittels Attacken auf Computersysteme\n[geführt. Am 23.02 hat ESET, ein Unternehmen für Sicherheitssoftware, eine neue Wiper](https://www.eset.com/us/)\n[Malware entdeckt. ESET hat die Meldung erstmals via Twitter veröffentlicht. In diesem](https://twitter.com/ESETresearch/status/14965819032055111819)\nArtikel möchte ich eine erste Analyse mittels Reverse Engineering der Malware\nbeschreiben. Im Vorhinein ist aber bereits eines klar: die Malware löscht die komplette\nFestplatte. Im Rahmen meiner Studienarbeit, die bis Ende Juni veröffentlicht werden soll,\nwerde ich den Virus genauer analysieren und weitere Erkenntnisse hier ergänzen.\n\n### Was ist ein Wiper Trojaner?\n\nLaut [virustotal.com wird die Schadsoftware als ein Trojaner mit der Untergruppe Wiper](https://www.virustotal.com/gui/file/1bc44eef75779e3ca1eefb8ff5a64807dbc942b1e4a2672d77b9f6928d292591/detection)\nklassifiziert. Trojanische Pferde (oft auch Trojaner) tarnen sich als unbedenkliche Software\noder Dokumente. Nutzer laden diese meist herunter und werden von scheinbar seriösen\nQuellen getäuscht. Die Malware führt später die Schadfunktionen verborgen im Hintergrund\naus. Ziel ist oft andere Malware nachzuinstallieren, um sie für Folgeangriffe verwundbar zu\nmachen.\n\n\n-----\n\n### Namensherkunft vom Hermetic Wiper\n\nLaut [sentinelone.com ist die Malware mit einem Zertifikat von Hermetica Digital Ltd signiert.](https://www.sentinelone.com/labs/hermetic-wiper-ukraine-under-attack/)\nDie Forscher von sentinelone.com gehen davon aus, dass es sich um eine Scheinfirma\nhandelt, da das Zertifikat von April 2021 ist und für die Forscher nie außer im Falle von\nHermetic Wiper in Erscheinung getreten ist.\n\n### Statische Analyse von Hermetic Wiper\n\nDie Datei ist 115 KB groß und als PE32 executable (GUI) Intel 80386, for MS Windows\nidentifiziert. Das bedeutet, dass die Malware ausschließlich für das Betriebssystem\nMicrosoft Windows entworfen und entwickelt wurde.\n\nMit dem Befehl strings unter Linux können alle in der Datei enthaltenen Strings ausgegeben\n[werden. Dabei interessant ist die sogenannte Data Sektion, welche unter Wikipedia](https://en.wikipedia.org/wiki/Portable_Executable)\nausführlich beschrieben ist. Sie ist Bestandteil jeder Portable Executable. Die von mir\nhändisch gefilterte Ausgabe ist in folgendem dargestellt:\n\n\n-----\n\n```\nNTFS\nWow64DisableWow64FsRedirection\nWow64RevertWow64FsRedirection\nIsWow64Process\nGCTL\n.text\n.text$mn\n.idata$5\n.rdata\n.rdata$zzzdbg\n.xdata$x\n.idata$2\n.idata$3\n.idata$4\n.idata$6\n.data\n.bss\n.rsrc$01\n.rsrc$02\nStrStrA\nwnsprintfW\nStrCmpNW\nStrStrIW\nPathAppendW\nPathAddBackslashW\nStrCatBuffW\nPathFileExistsW\nPathFindExtensionW\nPathAddExtensionW\nStrToIntW\nStrChrW\nStrRChrW\nStrStrW\nSHLWAPI.dll\nLZOpenFileW\nLZClose\nLZCopy\nLZ32.dll\nwcsncpy\ntowupper\nmsvcrt.dll\nHeapAlloc\nGetProcessHeap\nDeviceIoControl\nGetLastError\nHeapReAlloc\nHeapFree\nlstrcmpA\nGetSystemTimeAsFileTime\nCreateFileW\nCloseHandle\nSetFilePointerEx\nReadFile\nGetDiskFreeSpaceW\nlstrlenW\n\n```\n\n-----\n\n```\nWriteFile\nFlushFileBuffers\nCreateThread\nWaitForMultipleObjects\nGetModuleHandleW\nGetProcAddress\nGetCurrentProcess\nVerSetConditionMask\nVerifyVersionInfoW\nFindResourceW\nLoadResource\nLockResource\nSizeofResource\nGetSystemDirectoryW\nDeleteFileW\nSleep\nWaitForSingleObject\nSetThreadPriority\nFindFirstFileW\nFindNextFileW\nFindClose\nGetLogicalDriveStringsW\nSetLastError\nGetCommandLineW\nGetModuleFileNameW\nGetFileAttributesW\nCreateEventW\nSetEvent\nExitProcess\nGetCurrentProcessId\nGetFileInformationByHandle\nKERNEL32.dll\nwsprintfW\nCharLowerW\nUSER32.dll\nCryptAcquireContextW\nCryptGenRandom\nCryptReleaseContext\nRegDeleteKeyW\nOpenProcessToken\nLookupPrivilegeValueW\nAdjustTokenPrivileges\nOpenSCManagerW\nOpenServiceW\nCreateServiceW\nQueryServiceStatus\nChangeServiceConfigW\nStartServiceW\nDeleteService\nCloseServiceHandle\nControlService\nInitiateSystemShutdownExW\nRegQueryInfoKeyW\nRegEnumKeyExW\nRegOpenKeyW\n\n```\n\n-----\n\n```\nRegSetValueExW\nRegCloseKey\nADVAPI32.dll\nCommandLineToArgvW\nSHELL32.dll\n_except_handler3\nmemcpy\nmemset\nDigiCert Inc1\nwww.digicert.com1+0)\n\"DigiCert EV Code Signing CA (SHA2)0\n210413000000Z\n220414235959Z0\nPrivate Organization1\n     HE 4194691\nNicosia1\nHermetica Digital Ltd1\nHermetica Digital Ltd0\n1http://crl3.digicert.com/EVCodeSigningSHA2-g1.crl07\n1http://crl4.digicert.com/EVCodeSigningSHA2-g1.crl0J\nhttp://www.digicert.com/CPS0\nhttp://ocsp.digicert.com0H\nhttp://cacerts.digicert.com/DigiCertEVCodeSigningCA-SHA2.crt0\nDigiCert Inc1\nwww.digicert.com1+0)\n\"DigiCert High Assurance EV Root CA0\nDigiCert Inc1\nwww.digicert.com1+0)\n\"DigiCert EV Code Signing CA (SHA2)0\nhttp://ocsp.digicert.com0I\n=http://cacerts.digicert.com/DigiCertHighAssuranceEVRootCA.crt0\n:http://crl3.digicert.com/DigiCertHighAssuranceEVRootCA.crl0@\n:http://crl4.digicert.com/DigiCertHighAssuranceEVRootCA.crl0\n.http://www.digicert.com/ssl-cps-repository.htm0\nDigiCert Inc1\nwww.digicert.com1+0)\n\"DigiCert EV Code Signing CA (SHA2)\n\n```\nDie Analyse zeigt, dass der Wiper wohl für das NTFS Filesystem entwickelt ist. Das lässt\nder Ouput in der ersten Zeile mutmaßen. Zusätzlich sind viele Funktionen in der Executable\n[enthalten. Interessante Funktionen sind Wow64DisableWow64FsRedirection,](https://docs.microsoft.com/en-us/windows/win32/api/wow64apiset/nf-wow64apiset-wow64disablewow64fsredirection)\n[Wow64RevertWow64FsRedirection und](https://docs.microsoft.com/en-us/windows/win32/api/wow64apiset/nf-wow64apiset-wow64revertwow64fsredirection) [IsWow64Process. Diese drei Funktionen werden in](https://docs.microsoft.com/en-us/windows/win32/api/wow64apiset/nf-wow64apiset-iswow64process)\nKombination genutzt, um Weiterleitungen aus dem Dateisystem zu deaktivieren.\n\nDie letzten Zeilen der Ausgabe bestätigen die Annahme von sentinelone.com, dass die\nMalware für Hermetica Digital Ltd signiert ist. In der Ausgabe wird sogar bekannt, dass\nDigiCert der Herausgeber des Zertifikates ist.\n\nMittels des Befehls objdump -d ist es möglich, die Binäre Datei zu disassemblieren. Mit den\nParametern -M Intel ist es möglich die Disassemblierung in der Intel Syntax darzustellen.\nLeider stand mir bisher nicht genügend Zeit zur Verfügung, den Assemblercode zu\n\n\n-----\n\nanalysieren. Ich hoffe ich werde dazu im Rahmen meiner Studienarbeit Zeit finden und den\nAbschnitt entsprechend ergänzen.\n\n**Analyse nach Packern und Crypters**\n\n[Häufig werden oft Packer oder Crypters verwendet, um ein Reverse Code Engineering von](https://www.oreilly.com/library/view/mastering-reverse-engineering/9781788838849/333ca4c9-feec-4d1d-86c1-9c0eb3ecca53.xhtml)\nMalware zu erschweren bzw. unmöglich zu machen. Mittels des Kommandos objdump -D\nkönnen alle Assembler Sektionen einer Datei erzeugt werden. Im Fall von Hermetic Wiper\nsind folgende Sektionen vorhanden:\n```\n$ objdump -D hermeticWiper | grep section\nDisassembly of section .text:\nDisassembly of section .rdata:\nDisassembly of section .data:\nDisassembly of section .rsrc:\nDisassembly of section .reloc:\n\n```\nDie aufgelisteten Sektionen sind übliche Sektionen für Windows Executables. Daher ist\nnicht davon auszugehen, dass ein Packer oder Crypter bei Hermetic Wiper verwendet\nwurde.\n\n**Hashsummen von Hermetic Wiper:**\n\n**md5 - 3f4a16b29f2f0532b7ce3e7656799125**\n**sha1 - 61b25d11392172e587d8da3045812a66c3385451**\n\nMittels dieser Checksummen kann eine statische Analyse auf bekannten Seiten wie\n[virustotal durchgeführt werden. Stand heute (25.02.2022 09:55 Uhr) wird die Malware laut](https://www.virustotal.com/gui/file/1bc44eef75779e3ca1eefb8ff5a64807dbc942b1e4a2672d77b9f6928d292591/detection)\nVirusTotal von 37 Scannern erkannt. Darunter befindet sich auch der Microsoft Defender.\n\n### Dynamische Analyse von Hermetic Wiper\n\n[Die dynamische Analyse erfolgt bei mir im ersten Schnitt mit dem Tool any.run. Bei der](https://any.run/)\nAnalyse stellt sich heraus, dass nach der Ausführung des Hermetic Wiper eine .sys Datei\nunter C:\\WINDOWS\\system32\\Drivers\\ abgelegt wird. Der Name der Datei ist immer vier\nZeichen lang und verfügt über die Dateiendung .sys. Im weiteren Fall bezeichne ich die\nDatei als Treiberdatei. Die erzeugte Datei hat immer die gleiche Hashsumme. Das Tool file\nidentifiziert die Datei PE32+ executable (native) x86-64, for MS Windows. Das weitere\nVerhalten von Hermetic Wiper in der Sandbox von any.run, ist im Bild dargestellt.\n\n\n-----\n\nResultat dynamische Analyse Hermetic Wiper\nNennenswerte besondere Verhalten gibt es in dem Fall nicht weiter zu beschreiben.\n[Hermetic Wiper ist darauf ausgelegt, eine .sys Datei auf der Festplatte abzulegen. In der](https://en.wikipedia.org/wiki/.sys)\nweiteren Analyse werde ich mich nun dieser Datei widmen.\n\n### Statische Analyse der erzeugten Treiberdatei\n\nDa die Datei von Hermetic Wipe komplett neu erzeugt wird, muss eine erneute statische\nAnalyse durchgeführt werden. Die Datei ist 17,48 KB groß und wird, wie im vorherigen\nAbschnitt schon beschrieben, als PE32+ executable (native) x86-64, for MS Windows von\nfile erkannt. Die von mir gefilterte strings Ausgabe hat folgende interessante Inhalte:\n\n\n-----\n\n```\nInvalid parameter passed to C runtime function.\nRSDS\nh:\\epm2.0\\01_projectarea\\00_source\\epm2\\mod.windiskaccessdriver\\windiskaccessdriver\\o\nExAllocatePoolWithTag\nIoGetLowerDeviceObject\nIoBuildDeviceIoControlRequest\nIoDeleteSymbolicLink\nExFreePoolWithTag\nRtlInitUnicodeString\nIoDeleteDevice\nKeSetEvent\nKeInitializeEvent\nIoFreeMdl\nMmMapLockedPagesSpecifyCache\nIoGetDeviceObjectPointer\nIoBuildAsynchronousFsdRequest\nIofCompleteRequest\nKeWaitForSingleObject\nIoFreeIrp\nIoGetAttachedDeviceReference\nRtlCompareUnicodeString\nMmUnlockPages\nObfReferenceObject\nIoCreateSymbolicLink\nObfDereferenceObject\nRtlUnicodeStringToInteger\nIoCreateDevice\nDbgPrint\nObDereferenceObjectDeferDelete\nIofCallDriver\nKeBugCheckEx\nntoskrnl.exe\nRtlAnsiCharToUnicodeChar\nVeriSign, Inc.1\nVeriSign Trust Network1;09\n2Terms of use at https://www.verisign.com/rpa (c)101.0,\n%VeriSign Class 3 Code Signing 2010 CA0\n120423000000Z\n140911235959Z0\nSichuan1\nChengdu100.\n'CHENGDU YIWO Tech Development Co., Ltd.1>0<\n5Digital ID Class 3 - Microsoft Software Validation v2100.\n'CHENGDU YIWO Tech Development Co., Ltd.0\nr*@XD\n!rKl\n90705\n/http://csc3-2010-crl.verisign.com/CSC3-2010.crl0D\n=0;09\n0*0(\nhttps://www.verisign.com/rpa0\ne0c0$\nhttp://ocsp.verisign.com0;\n/http://csc3-2010-aia.verisign.com/CSC3-2010.cer0\n\n```\n\n-----\n\n```\nWashington1\nRedmond1\nMicrosoft Corporation1)0'\n Microsoft Code Verification Root0\n110222192517Z\n210222193517Z0\nVeriSign, Inc.1\nVeriSign Trust Network1:08\n1(c) 2006 VeriSign, Inc. - For authorized use only1E0C\nVeriSign Class 3 Public Primary Certification Authority – G50\nDhttp://crl.microsoft.com/pki/crl/products/MicrosoftCodeVerifRoot.crl0\nhttps://www.verisign.com/cps0*\nhttps://www.verisign.com/rpa0\n\n```\nWie genau die Malware vorgeht, ergibt die statische Analyse natürlich nicht. Dennoch\nlassen sich mögliche Verhaltensweisen bereits identifizieren. Die Analyse mit Strings ergibt,\ndass die [FunktionIoDeleteDevice verwendet wird. Das lässt darauf zurückführen, dass mit](https://docs.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/nf-wdm-iodeletedevice)\nder Treiberdatei ggf. Daten von der Festplatte gelöscht werden sollen.\nInteressant ist, dass VeriSign in dieser Datei ein Rolle spielt. Es ist auch möglich eine Datei\nunter dem Link [http://csc3-2010-crl.verisign.com/CSC3-2010.crl herunterzuladen, die Stand](http://csc3-2010-crl.verisign.com/CSC3-2010.crl)\njetzt mir keine Erkenntnisse liefert.\n\nAuf eine Analyse des Kommandos objdump verzichte ich hier mangels Zeit, wie bei\nHermetic Wiper. Ich hoffe ich kann eine Analyse im Rahmen meiner Studienarbeit\nnachliefern. Interessant ist, dass die Disassemblierung zwei Sektionen erzeugt: .text und\nINIT.\n\n**Checksummen der Teriberdatei**\n\n**md5 - 6106653b08f4f72eeaa7f099e7c408a4**\n**sha1 - 0e84aff18d42fc691cb1104018f44403c325ad21**\n\nDie Checksummen sind bisher (25.02.2022 11:27 Uhr) weitgehend unbekannt. Bei\n[VirusTotal schlagen erst drei von 71 Scannern an. Siehe Bild](https://www.virustotal.com/gui/file/96b77284744f8761c4f2558388e0aee2140618b484ff53fa8b222b340d2a9c84)\n\n\n-----\n\nVirustotal Bekanntheit der erzeugten .sys Datei am 2022-02-25 09:32:49 UTC\n\n### Dynamische Analyse der erzeugten Treiberdatei\n\nDas Verhalten nach der Ausführung der Treiberdatei ist relativ flott erklärt: Das System ist\n[kaputt. Dabei werden vermutlich alle Daten der Festplatte inkl. MBR gelöscht. Eine Analyse](https://de.wikipedia.org/wiki/Master_Boot_Record)\nmittels any.run ist leider nicht möglich, da das System crasht. Ich werde, falls es im Rahmen\nmeiner Studienarbeit mit einer anderen Sandbox anaylsiert wird, die Erkenntnisse teilen.\n\nAny.run crash nach der Ausführung der erzeugten .sys\n\n\n-----",
    "language": "DE",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-02-25 - Reverse Engineering - Hermetic Wiper.pdf"
    ],
    "report_names": [
        "2022-02-25 - Reverse Engineering - Hermetic Wiper.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535871,
    "ts_updated_at": 1743041158,
    "ts_creation_date": 1653697639,
    "ts_modification_date": 1653697639,
    "files": {
        "pdf": "https://archive.orkl.eu/fc58ac2f9ed73e7f21c853b9c8ac03e26afbd308.pdf",
        "text": "https://archive.orkl.eu/fc58ac2f9ed73e7f21c853b9c8ac03e26afbd308.txt",
        "img": "https://archive.orkl.eu/fc58ac2f9ed73e7f21c853b9c8ac03e26afbd308.jpg"
    }
}