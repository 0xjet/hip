{
    "id": "216179d2-69c6-460e-8624-186ac6a801f7",
    "created_at": "2022-10-25T16:48:15.654209Z",
    "updated_at": "2025-03-27T02:17:27.609366Z",
    "deleted_at": null,
    "sha1_hash": "8e2d9ead7e25aea7ce175ae4ce6c753961695de2",
    "title": "Iranian Fileless Attack Infiltrates Israeli Organizations",
    "authors": "",
    "file_creation_date": "2017-04-28T18:01:10Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 1227854,
    "plain_text": "###### MORPHISEC CYBER SECURITY BLOG\n\n# Iranian Fileless Attack Infiltrates Israeli Organizations�\n\n###### Posted by Michael Gorelik on Apr 27, 2017 7:11:43 PM\n\n Find me on:\n\n\n###### Tweet\n\n\n**[ShareShare](javascript:void(0);)** **33**\n\n\n**33**\n\n\n#### INTRODUCTION\n\n\n**[ShareShare](javascript:void(0);)**\n\n\n-----\n\n###### the attacks on April 24 and continue to uncover more details. Initial reports of the attacks, published April 26 (in Hebrew) by the Israel National Cyber Event Readiness Team (CERT-IL) and The Marker, confirm that the attack was delivered� through compromised email accounts at Ben-Gurion University and sent to multiple targets across Israel. Ironically, Ben-Gurion University is home to Israel’s Cyber Security Research Center. Investigators put the origin of the attack as Iranian; Morphisec’s research supports this conclusion and attributes the attacks to the same infamous hacker group responsible for the OilRig malware campaigns.\n\n The attack was delivered via Microsoft Word documents that exploited a former zero-day vulnerability in Word, CVE-2017-0199, to install a fileless variant of the� Helminth Trojan agent. Microsoft released the patch for the vulnerability on April 11, but many organizations have not yet deployed the update. The attackers actually based their attack on an existing Proof-of-Concept method that was published by researchers after the patch release.\n\n By hunting through known malware repositories, Morphisec identified matching� samples uploaded by Israeli high-tech development companies, medical organizations and education organizations, indicating that they were victims of the attack. For security purposes, Morphisec is not revealing these names.\n\n The delivery was executed by compromising the email accounts of a few high- profile individuals at Ben-Gurion University. The Word document was sent as a reply� to legitimate emails sent from those accounts and was propagated to more than 250 individuals in different Israeli companies, according to CERT-IL.\n\n Upon deeper investigation into the installed Helminth fileless agent, we identified a� near perfect match to the OilRig campaign executed by an Iranian hacker group against 140 financial institutions in the Middle East last year, as analyzed by� FireEye, Palo Alto Networks and Logrhythm. This group has become one of the most active threat actors, with noteworthy abilities, resources and infrastructure; speculations indicate the hacking organization to be sponsored by the Iranian government. In other recent attacks (January 2017), the group used a fake Juniper Networks VPN portal and fake University of Oxford websites to deliver malware as described by ClearSky. \n\n Our report presents the technical details of the attack, emphasizing differences from last year’s attack. In particular, there are several enhancements to different evasive mechanisms and some modifications in the communications protocol, which� delivers PowerShell commands from the C&C.\n\n The most important difference is that the use of macros was exchanged with a vulnerability exploit. With their ability to set up the attack in a relatively short time, the threat actors could correctly speculate that their window of opportunity between\n\n\n-----\n\n###### At the time of publication, the C&C servers are still active and will be listed herein as all other signatures and indicators of compromise.\n\n#### TECHNICAL ANALYSIS\n\n##### Word Delivery\n\n###### The different delivered documents, as shown below, are generally named with some random number <random number>.doc.\n\n Morphisec identified the following set of documents: �\n\n|Name|SHA256|\n|---|---|\n|13.doc|a9bbbf5e4797d90d579b2cf6f9d61443dff82ead9d9ffd10f3c31b686ccf81ab|\n|558.doc, 2.doc|2869664d456034a611b90500f0503d7d6a64abf62d9f9dd432a8659fa6659a8|\n|1.doc|832cc791aad6462687e42e40fd9b261f3d2fbe91c5256241264309a5d437e4d|\n\n\n-----\n\n###### 3.doc d4eb4035e11da04841087a181c48cd85f75c620a84832375925e6b03973d8e\n\n##### CVE-2017-0199 Vulnerability Exploit\n\n###### The most notable difference from last year’s OilRig campaign is the way the attack was delivered. In the previous campaign, the Iranian group sent specially crafted Excel and Word files, which contained macros that targeted individuals were� convinced to enable.\n\n In this campaign, no macros were required. Each document utilized the vulnerability by an embedded link that delivers an .hta file (html executable).�\n\n Morphisec identified the following delivered �test<number>.hta file with the same� signature delivered from the following domains:\n\n Name Delivery Server\n\n test4.hta hxxp://comonscar[.]in (82.145.40.46)\n\n test5.hta 80.82.67.42\n\n test1.hta reserved\n\n SHA256: 5ac61ea5142d53412a251eb77f2961e3334a00c83da9087d355a49618220ac43\n\n The .hta file is immediately executed by mshta.exe, the Windows process which� executes html executables. As a result, the user is usually shown a warning message, despite the fact that the HTA is still executed even if the user chooses “No”:\n\n|Name|Delivery Server|\n|---|---|\n|test4.hta|hxxp://comonscar[.]in (82.145.40.46)|\n|test5.hta|80.82.67.42|\n|test1.hta|reserved|\n\n\n-----\n\n###### The .hta file in this attack is much more sophisticated than in previous versions, and� actually disables this message by sending an “Enter” command to the warning window. This is covered in the next section.\n\n##### HTA Execution and Persistency\n\n###### The HTA execution goes through the following steps:\n\n 1. Before installing the agent, the .hta file sends the “Enter” key into the Word�\n application to remove the warning message and minimize any appearance of suspicious execution. It is done by creating and executing a 1.vbs script.\n\n\n-----\n\n###### 2. The next step writes and executes the 0011.ps1 PowerShell script, which is\n described in the following section.\n\n 3. The last step kills the original process that activated the .hta file, to remove any�\n suspicion.\n\n##### Helminth Trojan Installation and Persistency\n\n###### 0011.ps1 script, which is activated by the .hta file, is in charge of �generating the Helminth Trojan PowerShell and VBS files.�\n\n Name SHA256\n\n 0011.ps1 042F60714E9347DB422E1A3A471DC0301D205FFBD053A4015D2B509D\n\n\n-----\n\n###### 1.vbs BE7F1D411CC4160BB221C7181DA4370972B6C867AF110C12850CAD77\n\n Morphisec identified the following structure:�\n\n This structure matches the attack structure from October 2016, as described by Logrhythm:\n\n Aside the unique generation of the files�, the structure and the functionality of the trojan is very similar to the previous campaign:\n\n 1. The PowerShell script ps1 creates similar variants of Helminth trojan\n PowerShell and VBS files �templates (DnS1.Ps1, DnE1.Ps1, backup1.vbs). Those templates are regenerated on the infected computer by replacement of\n ll i bl d f i d i d l d\n\n\n-----\n\n###### 2. All the scripts are installed in the Public\\Libraries\\RecordedTV\\ folder. 3. As in the previous campaign, persistency is achieved by adding a schedule\n task with a similar name to the Google update task (“GoogleUpdateTasksMachineUI”), which executes vbs every 3 minutes:\n\n Note: All the parameters in the 0011.ps1 script can be reconfigured, therefore� some of the names could be different for the tasks and locations.\n\n##### Communication Protocol\n\n###### We will focus here on the DnE1.Ps1 file because all other files are almost identical� to the previous campaign. This file executes some of the same commands executed� by VBS script in the previous campaign, but there are differences as well. The script connects to a C&C server – vpsupdate[.]tk. At the time of this report’s publication, the C&C server is still live; the server was first registered on April 16, 2017. The goal� of the script is to:\n\n Download bat script Execute it and upload the results back to the C&C\n\n\n-----\n\n###### At each new activation (first) activation of the download command (GET request),� the infected computer receives a bat script for activation from the C&C:\n\n vpsupdate[.]tk/index.aspx?id=<random character><randomnumber>[b] (the “b” is for download)\n\n The file name of the bat script is then delivered through the response headers, and� the content of the bat script is delivered through the response. Both of them are encoded in base 64.\n\n The name of the file is default.bat (decoded from Content-Disposition property in the� header) and it is saved temporary in the dn folder (described in the next section).\n\n Note: Morphisec identified several other samples of communication with different� C&C servers (“alenupdate[.]info” and “maralen[.]tk”) in which a more advanced customized version of Mimikatz was sent to specific users, and an additional agent� was installed in the “C:\\Program Files (x86)\\Microsoft Idle\\” directory:\n\n\n-----\n\n###### Back to the popular variant of the protocol: As soon as the file executes and the� result output is written to default.bat.txt (similarly to the previous campaign), the resulting file is uploaded back to the C&C using the following URL command (POST� request):\n\n vpsupdate[.]tk/index.aspx?id=<random character><randomnumber>[u] (the “u” is for upload)\n\n At the same time, the DnE1.Ps1 is executed. The DnS1.Ps1 is also executed and communicates with the C&C using DNS exchange queries (the same as in the previous campaign). This kind of communication is very hard to block since DNS is a basic functionality required in any organization.\n\n\n-----\n\n###### The bat script is a customized version of Mimikatz (with slight modification from the� last campaign). Its goal is to gather information from the computer and the network:\n\n The added commands are chcp to handle non-ASCII characters (e.g. Hebrew) and the validation of the scheduled task (which should have been added by the persistency mechanism).\n\n As mentioned in the previous section, Morphisec identified an advanced version of� the same bat script communicating with the alenupdate[.]info C&C. In that case, the information that is gathered includes A.V., Firewall and AntiSpy product information. The persistent tasks are slightly different as well, “Google Update Core” and “Google Sync Core”.\n\n\n-----\n\n#### Remediation\n\n###### 1. The scheduled task “GoogleUpdateTasksMachineUI” should be removed. Note\n that regular Google update tasks look like GoogleUpdateTask[Machine|User]* without the “s” in Tasks).\n 1. In case “Google Update Core” or “Google Sync Core” exists, those need\n to be removed as well. 2. Access Public\\Libraries\\RecordedTV folder. Note that the Libraries folder in\n Public is hidden, and you should delete the folder and not the RecordedTV icon – if you have only the icon, then the agent is not installed. 3. If the following directory exists, remove it: “Program Files(x86)\\Microsoft Idle” 4. If the following directory contains “WinInit.lnk” or “SyncInit.lnk” files, remove�\n those files: �“%userprofile%\\AppData\\Roaming\\Microsoft\\Windows\\Start� Menu\\Programs\\Startup”\n\n#### Conclusion\n\n###### Every few years, a new “logic bug” CVE in OLE object linking is identified; the�\n\n\n-----\n\n###### CVE-2017-0199) and bypass Microsoft validation of OLE execution without warning. In essence, it is the same as playing animation in PowerPoint.\n\n Such vulnerabilities should be patched immediately.\n\n It is significant to note how the Iranian threat actors advanced their abilities in such� a short time:\n\n Utilizing a vulnerability PoC immediately after its publication Setting up the required infrastructure with multiple domains and delivery servers Increasing the sophistication of the delivered Helminth agent, including regeneration of its signatures on the infected computer Improving the customized information gathering Mimikatz version\n\n With many organizations taking high-risk vulnerabilities seriously and patching them as quickly as possible, attackers can no longer exploit them for an extended period of time. We therefore expect that threat actors will return to macro-based campaigns like Hancitor.\n\n#### Indicators of Compromise (IOCs)\n\n##### Document delivery\n\n###### Name SHA256\n\n 13.doc a9bbbf5e4797d90d579b2cf6f9d61443dff82ead9d9ffd10f3c31b686ccf81ab\n\n 558.doc, 2869664d456034a611b90500f0503d7d6a64abf62d9f9dd432a8659fa6659a8 2.doc\n\n 1.doc 832cc791aad6462687e42e40fd9b261f3d2fbe91c5256241264309a5d437e4d\n\n 3.doc d4eb4035e11da04841087a181c48cd85f75c620a84832375925e6b03973d8e\n\n##### HTA delivery servers:\n\n|Name|SHA256|\n|---|---|\n|13.doc|a9bbbf5e4797d90d579b2cf6f9d61443dff82ead9d9ffd10f3c31b686ccf81ab|\n|558.doc, 2.doc|2869664d456034a611b90500f0503d7d6a64abf62d9f9dd432a8659fa6659a8|\n|1.doc|832cc791aad6462687e42e40fd9b261f3d2fbe91c5256241264309a5d437e4d|\n|3.doc|d4eb4035e11da04841087a181c48cd85f75c620a84832375925e6b03973d8e|\n\n\n-----\n\n###### hxxp://comonscar[.]in (82.145.40.46)\n\n 80.82.67.42\n\n##### HTA files:�\n\n###### Name SHA256\n\n test4.hta, test5.hta [5ac61ea5142d53412a251eb77f2961e3334a00c83da9087d355a49618220a]\n\n##### Helminth Trojan Installers:\n\n###### Name SHA256\n\n 0011.ps1 042F60714E9347DB422E1A3A471DC0301D205FFBD053A4015D2B509D\n\n 1.vbs BE7F1D411CC4160BB221C7181DA4370972B6C867AF110C12850CAD77\n\n##### C&C:\n\n|Name|SHA256|\n|---|---|\n|test4.hta, test5.hta|5ac61ea5142d53412a251eb77f2961e3334a00c83da9087d355a49618220a|\n\n\n-----\n\n###### CERT-IL has listed additional IoCs that are not mentioned in this list, which include the January campaign that involved malicious Juniper Networks VPN and fake Oxford registration form executables and their C&C domain server.\n\n Topics: 0-day exploits, Zero-day, Attack Analysis, fileless attacks�\n\n#### Welcome to our Blog\n\n###### Keeping you in the loop with company updates, industry insight, cyber security trends, and cyber attack information.\n\n### SUBSCRIBE TO THE BLOG\n\n## Morphisec Named a Cool Vendor 2016\n\n###### E h G id ifi C l V d i id i i �\n\n\n-----\n\n###### more....\n\n#### Recent Posts\n\n###### Iranian Fileless Attack Infiltrates Israeli Organizations� Building Security Resiliency Into Critical Infrastructure Cyber Defense Reinvented - Israel Dealmakers Summit 2017 Malware Is a Symptom – Don’t Treat Symptoms Morphisec Discovers New Fileless Attack Framework Andromeda’s Five Star Custom Packer – Hackers’ Tactics Analyzed RSAC 2017: Is the cybersecurity industry about keeping up with the Joneses? New Wave of Cerber Ransomware Sweeps the Globe – Can’t Surge Past Morphisec Ready for RSAC and a New Take on Endpoint Security? Hedge Funds Need to Hedge Against Hackers\n\n#### Most Popular Posts\n\n###### How the EPS File Exploit Works to Bypass EMET (CVE-2015-2545) – A Technical Exploration Morphisec Discovers New Fileless Attack Framework Less is More (Dangerous): A Dissection of Fileless In-Memory Attacks Moving Target Defense: Common Practices Recycling Known Vulnerabilities - Old Cyber Attack Goes Stealth ASLR - What It Is, and What It Isn’t Javascript in IE Overtakes Flash as Number One Target for Angler Exploit Kit New Wave of Fileless Kovter Backdoor Trojan Attacks Via “Targeted” Macro- Based Malspam Campaign\n\n#### Posts by Topic\n\n###### cybersecurity (30) Endpoint Security (28) Attack Analysis (21) Exploits (15) Moving Target Defense (15)\n\n see all\n\n\n-----\n\n**FOLLOW US:**\n\n**© Morphisec Ltd., 2016**\n\n###### | Terms of Use | Privacy Policy|\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2017/2017.04.27.iranian-fileless-cyberattack-on-israel-word-vulnerability/iranian-fileless-cyberattack-on-israel.pdf"
    ],
    "report_names": [
        "iranian-fileless-cyberattack-on-israel"
    ],
    "threat_actors": [
        {
            "id": "cffb3c01-038f-4527-9cfd-57ad5a035c22",
            "created_at": "2022-10-25T15:50:23.38055Z",
            "updated_at": "2025-03-27T02:00:55.459558Z",
            "deleted_at": null,
            "main_name": "OilRig",
            "aliases": [
                "COBALT GYPSY",
                "IRN2",
                "APT34",
                "Helix Kitten",
                "Evasive Serpens",
                "Hazel Sandstorm",
                "EUROPIUM",
                "ITG13"
            ],
            "source_name": "MITRE:OilRig",
            "tools": [
                "ISMInjector",
                "RDAT",
                "Systeminfo",
                "QUADAGENT",
                "OopsIE",
                "Tasklist",
                "certutil",
                "ZeroCleare",
                "POWRUNER",
                "netstat",
                "ipconfig",
                "LaZagne",
                "BONDUPDATER",
                "SideTwist",
                "PsExec",
                "SEASHARPEE",
                "Mimikatz",
                "RGDoor",
                "ftp"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "67709937-2186-4a32-b64c-a5693d40ac77",
            "created_at": "2023-01-06T13:46:38.495593Z",
            "updated_at": "2025-03-27T02:00:02.848206Z",
            "deleted_at": null,
            "main_name": "OilRig",
            "aliases": [
                "IRN2",
                "Hazel Sandstorm",
                "EUROPIUM",
                "TA452",
                "Earth Simnavaz",
                "Cobalt Gypsy",
                "Crambus",
                "Helix Kitten",
                "APT 34",
                "APT34",
                "ATK40",
                "G0049",
                "Evasive Serpens",
                "Twisted Kitten"
            ],
            "source_name": "MISPGALAXY:OilRig",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "8f9c8a6e-f6b6-431b-bedd-94fdeea5474a",
            "created_at": "2024-05-01T02:03:08.022974Z",
            "updated_at": "2025-03-27T02:05:17.310877Z",
            "deleted_at": null,
            "main_name": "COBALT GYPSY",
            "aliases": [
                "CHRYSENE ",
                "Crambus ",
                "EUROPIUM ",
                "Hazel Sandstorm ",
                "Helix Kitten ",
                "ITG13 ",
                "OilRig ",
                "Yellow Maero ",
                "APT34 "
            ],
            "source_name": "Secureworks:COBALT GYPSY",
            "tools": [
                " Helminth",
                " Jason",
                " MacDownloader",
                " PoisonFrog",
                " RGDoor",
                " ThreeDollars",
                " TinyZbot",
                " Toxocara",
                " Trichuris",
                " TwoFace",
                "Glimpse"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "b6436f7b-6012-4969-aed1-d440e2e8b238",
            "created_at": "2022-10-25T16:07:23.91517Z",
            "updated_at": "2025-03-27T02:02:10.027531Z",
            "deleted_at": null,
            "main_name": "OilRig",
            "aliases": [
                "APT 34",
                "ATK 40",
                "Chrysene",
                "Cobalt Gypsy",
                "Crambus",
                "DEV-0861",
                "EUROPIUM",
                "Earth Simnavaz",
                "Evasive Serpens",
                "Hazel Sandstorm",
                "Helix Kitten",
                "IRN2",
                "ITG13",
                "Scarred Manticore",
                "Storm-0861",
                "TA452",
                "Twisted Kitten",
                "UNC1860",
                "Yellow Maero"
            ],
            "source_name": "ETDA:OilRig",
            "tools": [
                "AMATIAS",
                "Agent Drable",
                "Agent Injector",
                "AgentDrable",
                "Alma Communicator",
                "BONDUPDATER",
                "CACTUSPIPE",
                "Clayslide",
                "CypherRat",
                "DNSExfitrator",
                "DNSpionage",
                "DROPSHOT",
                "DistTrack",
                "DropperBackdoor",
                "Fox Panel",
                "GREYSTUFF",
                "GoogleDrive RAT",
                "HighShell",
                "HyperShell",
                "ISMAgent",
                "ISMDoor",
                "ISMInjector",
                "Jason",
                "Karkoff",
                "LIONTAIL",
                "LOLBAS",
                "LOLBins",
                "LONGWATCH",
                "LaZagne",
                "Living off the Land",
                "MailDropper",
                "Mimikatz",
                "MrPerfectInstaller",
                "OILYFACE",
                "OopsIE",
                "POWBAT",
                "POWRUNER",
                "Plink",
                "Poison Frog",
                "PowerExchange",
                "PsList",
                "PuTTY Link",
                "QUADAGENT",
                "RDAT",
                "RGDoor",
                "SEASHARPEE",
                "Saitama",
                "Saitama Backdoor",
                "Shamoon",
                "SideTwist",
                "SpyNote",
                "SpyNote RAT",
                "StoneDrill",
                "TONEDEAF",
                "TONEDEAF 2.0",
                "ThreeDollars",
                "TwoFace",
                "VALUEVAULT",
                "Webmask",
                "WinRAR",
                "ZEROCLEAR",
                "ZeroCleare",
                "certutil",
                "certutil.exe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716495,
    "ts_updated_at": 1743041847,
    "ts_creation_date": 1493402470,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/8e2d9ead7e25aea7ce175ae4ce6c753961695de2.pdf",
        "text": "https://archive.orkl.eu/8e2d9ead7e25aea7ce175ae4ce6c753961695de2.txt",
        "img": "https://archive.orkl.eu/8e2d9ead7e25aea7ce175ae4ce6c753961695de2.jpg"
    }
}