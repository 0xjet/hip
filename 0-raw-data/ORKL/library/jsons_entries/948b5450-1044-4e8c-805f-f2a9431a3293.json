{
    "id": "948b5450-1044-4e8c-805f-f2a9431a3293",
    "created_at": "2023-01-12T15:02:11.343131Z",
    "updated_at": "2025-03-27T02:05:24.554445Z",
    "deleted_at": null,
    "sha1_hash": "625b60ad356960ac20c37453c556a0e7b9dcf8f2",
    "title": "2022-08-29 - Crypto miners’ latest techniques",
    "authors": "",
    "file_creation_date": "2022-09-01T10:30:59Z",
    "file_modification_date": "2022-09-01T10:30:59Z",
    "file_size": 379659,
    "plain_text": "# Crypto miners’ latest techniques\n\n**cybersecurity.att.com/blogs/labs-research/crypto-miners-latest-techniques**\n\n1. [AT&T Cybersecurity](https://cybersecurity.att.com/)\n2. [Blog](https://cybersecurity.att.com/blogs)\n\nAugust 29, 2022 | [Fernando Martinez](https://cybersecurity.att.com/blogs/author/fmartinez)\n\n## Executive summary\n\nCrypto miners are determined in their objective of mining in other people's resources. Proof of this is one of the latest\nsamples identified with AT&T Alien Labs, with at least 100 different loaders and at least 4 different stages to ensure their\nminer and backdoor run smoothly in the infected systems.\n\nKey takeaways:\n\nAttackers have been sending malicious attachments, with a special emphasis on Mexican institutions and citizens.\nThe techniques observed in these samples are known but still effective to keep infecting victims with their miners.\nReviewing them assists in reminding defenders the current trends and how to improve their defenses.\nThe wide variety of loaders in conjunction with the staged delivery of the miner and backdoor malwares, shows\nhow determined the attackers are to successfully deliver their payloads.\n\n### Analysis\n\nCrypto miners have been present in the threat landscape for some years, since an attacker identified the opportunity of\nleveraging victim’s CPUs to mine cryptocurrencies for them. Despite the current rough patch in the world of\ncryptocurrencies, these miners are still present and will be in the foreseeable future.\n\nAs seen in the current analysis, unlike IoT malwares, which also attempt to reach the biggest number of infected devices\nas possible, these miners target victims through phishing samples. The techniques used by these malwares are usually\nfocused on reaching execution, avoiding detection to run under the radar and gaining persistence to survive any reboot.\n\n\n-----\n\nA new miner sample showed up in April on AT&T Alien Labs radar, with a wide range of different loaders aiming to\nexecute it in infected systems up to this day. The loaders were initially delivered to the victims through an executable\ndisguised like a spreadsheet. For example, one of the samples\n(fd5131645025e199caa142c12cef34b344437a0f58306f9b66c35d32618665ba) carries a Microsoft Excel icon, but its file\nextension corresponds to an executable.\n\nA wide range of decoy documents were found associated with this miner, many of them associated with Mexican\ncivilians: exam results, dentist results, Mexican Governmental documents, Mexican Social Security, Tax returns, etc.\nFigure 1 corresponds to one of the spreadsheets observed. The campaign identified in this report materialized most of its\nattacks during the second half of June 2022. For example, the mentioned file above was compiled in late May 2022 and\nwas first observed in the wild a month after, on June 20, 2022.\n\nFigure 1. Decoy spreadsheet ‘ppercepciones anuales.xlsx’.\n\nAt the time of execution, the first activities performed are registry changes to cloak the malware samples. For example,\nby setting ‘HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced\\HideFileExt’ to 1,\nthe attackers are hiding the file extensions and camouflaging the executables as documents. Additionally, the registry\nkey ‘HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced\\Hidden’ is set to 0 to\navoid displaying in explorer the hidden files dropped during execution. Finally ‘\nHKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\ConsentPromptBehaviorAdmin’\nis set to 0 in order to execute any future samples with elevated privileges without explicit consent in the form of a pop up\nor inserting credentials.\n\nThe initial payload drops another executable file while opening the spreadsheet in Figure 1. This additional executable\nattempts to look like a legitimate executable. It is named ‘CmRccService.exe’ and has the same filename as the\nmetadata associated with the product’s name, description and comments. It is probably an attempt to masquerade the\nprocess by making it similar to the legitimate Microsoft process ‘CmRcService.exe’ (Configuration Manager Remote\nControl Service) (T1036.004). However, the legitimate files owned by Microsoft would have been signed with Microsoft\ncertificate, which is not the case for these files - which have not been signed at all.\n\nPivoting by this indicator, returns over a hundred different samples that have been created and delivered during the last\nthree months, most of them in the last weeks. In addition to the product name ‘CmRccService.exe’, a similar decoy name\nwas observed in this campaign ‘RegistryManager.exe’, which showed up in at least 6 different samples. The\nRegistryManager samples even carry a Copyright flag associated with Microsoft Corporation, lacking once again the\ncorresponding file signature. These files are allocated under the folder ‘C:\\Windows\\ImmersiveControlPanel’ in an\nattempt to make the processes look as legitimate as possible.\n\nPersistence of the whole process is attempted during the execution of ‘CmRccService.exe’. A new service is registered\nin the system (T1543.003), to be run with highest privileges each time the user logs on.\n\n\n-----\n\nFigure 2. Persistence mechanism.\n\nThis loader reaches out to several domains hosting the payloads for next stages, configuration files and one-line\ncommands to be executed.\n\nOne of these domains is ‘bekopgznpqe[.]is’. Initially created on February 22, 2022 with the name server 1984 Hosting\nCompany, who offers domain names registration free of charge. However, since this behavior indicator makes the\ndomain look suspicious to security companies, the domain was moved to Cloudflare on April 21 (a different nameserver\nwith a better reputation due to its popularity and absence of free offerings). This technique has historically been used to\nimprove the reputation of domains right before they are used during a campaign.\n\nAdditionally, the malware attempts to contact a supplemental domain ​​’dpwdpqshxux[.]ru,’ which does not yet resolve but\nwas created on February 21, 2022, a day before ‘bekopgznpqe’ domain. There is no historical data of it ever resolving to\nany IP. For this reason, the domain is probably a backup plan, to be used if the first stops working.\n\nThe third and last domain identified during analysis did not follow the above pattern. The domain ‘2vkbjbpvqmoh[.]sh‘\nwas created in January 2022 in the Njalla name server, known and marketed as a great offering for ‘Privacy as a\nService’ for domains and VPNs. After some time operating, the domain was marked for deletion in May 2022.\n\nBefore executing the third stage payload, Cmrcservice performs several modifications to the FireWall to allow inbound\nand outbound connections to the files it will drop afterwards. The executed command for these changes is\n‘'C:\\Windows\\System32\\cmd.exe' /C powershell New-NetFirewallRule -DisplayName 'RegistryManager' -Direction\nInbound -Program 'C:\\Windows\\ImmersiveControlPanel\\RegistryManager.exe' -Action Allow’.\n\nFurthermore, the malware includes exclusions to the Microsoft Windows Defender for the folders from where the\nmalware will be executing or the files it intends to execute (T1562). The command used for this purpose is\n‘powershell.exe $path = 'C:\\Windows\\Branding\\oidz.exe' ; Add-MpPreference -ExclusionPath $path -Force’. The\nexcluded folders and files include:\n\nC:\\Users\nC:\\Windows\nC:\\Windows\\Temp\nC:\\Windows\\ImmersiveControlPanel\nC:\\Windows\\ImmersiveControlPanel\\CmRccService.exe\nC:\\Windows\\Branding\nC:\\Windows\\Branding\\umxn.exe\nC:\\Windows\\Branding\\oidz.exe\nC:\\Windows\\Help\\Windows\nC:\\Windows\\Help\\Windows\\MsMpEng.exe\nC:\\Windows\\IME\n\nThe third stage payload is formed by the ‘p.exe’ executable, which doesn’t hide its contents, since the file’s metadata\nclaims the filename is ‘payload.exe’. During execution, p drops two additional files: ‘oidz.exe‘ and ‘umxn.exe’, which\ncorrespond to the final payloads. Figure 3 recaps the execution flow until this point.\n\n\n-----\n\n[1]\n\nFigure 3. Execution tree.\n\n‘Oidz.exe‘ runs an infinite loop, as seen in Figure 4, that will reach out to the Command & Control (C&C) looking for new\ncommands to execute. After execution, it includes a sleep command to separate the requests for additional commands\nas well as its executions. In other words, this executable corresponds to the backdoor installed in the system.\n\nThe commands to be executed are uploaded by the attackers to the C&C servers, and oidz reaches out to specific files\nin the server and executes them, allowing the attackers to maintain any payload updated or modify its capabilities\n(T1102.003). This file does not aim to be persistent in the system since the grandparent process ‘Cmrcservice.exe’\nalready is. The C&C servers list seen in Figure 5, has a first parameter corresponding to the command to execute, while\nthe second parameter corresponds to the flag of the command to be executed. This list of domains corresponds to the\none used previously by ‘CmRccService’.\n\nFigure 4. Oidz infinite loop.\n\nFigure 5. C&C list.\n\n\n-----\n\nFinally, umxn.exe corresponds to the crypto miner that will run with the configuration pulled from one of the C&C and\nstored in ‘%windir%\\Help\\Windows\\config.json’. All the other files were preparing the environment for the miner, avoiding\nissues with execution, network communications or enabling modifications during the execution with the backdoor.\n\nSince it was first observed in April 2022, some of the executables have changed names or had some variations but have\nbeen excluded throughout the report to avoid confusion. The execution line in this report and observed in Figure 3 is the\nmost common one observed. One of the most remarkable mentioned variations, include file ‘MsMpEng.exe’ or\n‘McMpEng.exe’, which is an additional stage executed by ‘umxn.exe’. This sample claims in its PE metadata to be\n‘Antimalware Service Executable’ to disguise its true nature.\n\nFigure 6. MsMpEng.exe metadata.\n\n## Conclusion\n\nAT&T Alien Labs has provided an overview on an ongoing crypto mining campaign that caught our eye due to the big\nnumber of loaders that have shown up during the month of June, as well as how staged the execution is for a simple\nmalware like a miner. Alien Labs will continue to monitor this campaign and include all the current and future IOCs in the\npulse in Appendix B.\n\n## Associated indicators (IOCs)\n\nThe following technical indicators are associated with the reported intelligence. A list of indicators is also available in the\n[OTX Pulse. Please note, the pulse may include other activities related but out of the scope of the report.](https://otx.alienvault.com/pulse/62cbfaac8ee099f288b68e54)\n\nTYPE INDICATOR DESCRIPTION\n\nSHA256 fd5131645025e199caa142c12cef34b344437a0f58306f9b66c35d32618665ba ppercepciones\nanuales.xlsx\n\nSHA256 00ba928455d7d8a92e5aeed3146925086c2451501e63a0d8ee9b7cbaaf1007de CmRccService.exe\n\nSHA256 8f0dc8c5e23ee42209e222db5a8cf8ee6e5d10b5dde32db5937d4499deef0302 RegistryManager.exe\n\nSHA256 f77522d8476969ae13f8823b62646a9f2cec187e2d0e55298389b8ced60dd0c8 p.exe\n\nSHA256 ec4c48ac55139c6e4f94395aca253d54e9bbc864cc0741f8e051d31cd7545620 umxn.exe\n\nSHA256 c0dc67bfcefa5a74905f0d3a684e7c3214c5b5ca118e942d2f0cc2f53c78e06c oidz.exe\n\n\n-----\n\nSHA256 18493e0492eb276af746e50dee626f4d6a9b0880f063ebb77d8f3b475669bf65 Sample miner\nconfiguration\n\nDOMAIN 2vkbjbpvqmoh[.]sh Malware and config\nserver\n\nDOMAIN bekopgznpqe[.]is Malware and config\nserver\n\nDOMAIN dpwdpqshxux[.]ru Unresolved domain\n\n## Mapped to MITRE ATT&CK\n\n[The findings of this report are mapped to the following MITRE ATT&CK Matrix techniques:](https://attack.mitre.org/)\n\nTA0001: Initial Access\n\nT1566: Phishing\n\nT1566.001: Spearphishing Attachment\nTA0002: Execution\n\nT1059: Command and Scripting Interpreter\n\nT1059.001: PowerShell\nT1059.003: Windows Command Shell\nT1204: User Execution\n\nT1204.002: Malicious File\nT1569: System Services\n\nT1569.002: Service Execution\nTA0003: Persistence\n\nT1543: Create or Modify System Process\n\nT1543.003: Windows Service\nTA0004: Privilege Escalation\n\nT1543: Create or Modify System Process\n\nT1543.003: Windows Service\nTA0005: Defense Evasion\n\nT1027: Obfuscated Files or Information\n\nT1027.002: Software Packing\nT1036: Masquerading\n\nT1036.004: Masquerade Task or Service\nT1562: Impair Defenses\n\nT1562.001: Disable or Modify Tools\nT1562.004: Disable or Modify System Firewall\nTA0011: Command and Control\n\nT1102: Web Service\n\nT1102.003: One-Way Communication\nTA0040: Impact\n\nT1496: Resource Hijacking\nTA0042: Resource Development\n\nT1583: Acquire Infrastructure\n\nT1583.006: Domains\n\n[1]EXE icon by [Icons8;](https://icons8.com/) [Cog icon by](https://icons8.com/icon/iHJqQZMrMJ4W/cog) [Icons8;](https://icons8.com/) [XLS icon by](https://icons8.com/icon/T6U3iKFuStkH/xls) [Icons8](https://icons8.com/)\n\n### Share this with others\n\n\n-----\n\nTags: [alien labs,](https://cybersecurity.att.com/blogs/tag/alien+labs) [otx pulse,](https://cybersecurity.att.com/blogs/tag/otx+pulse) [cryptomining](https://cybersecurity.att.com/blogs/tag/cryptomining)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-08-29 - Crypto miners’ latest techniques.pdf"
    ],
    "report_names": [
        "2022-08-29 - Crypto miners’ latest techniques.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535731,
    "ts_updated_at": 1743041124,
    "ts_creation_date": 1662028259,
    "ts_modification_date": 1662028259,
    "files": {
        "pdf": "https://archive.orkl.eu/625b60ad356960ac20c37453c556a0e7b9dcf8f2.pdf",
        "text": "https://archive.orkl.eu/625b60ad356960ac20c37453c556a0e7b9dcf8f2.txt",
        "img": "https://archive.orkl.eu/625b60ad356960ac20c37453c556a0e7b9dcf8f2.jpg"
    }
}