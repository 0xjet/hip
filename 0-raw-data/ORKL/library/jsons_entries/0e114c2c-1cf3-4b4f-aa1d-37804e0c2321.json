{
    "id": "0e114c2c-1cf3-4b4f-aa1d-37804e0c2321",
    "created_at": "2023-01-12T15:00:31.466853Z",
    "updated_at": "2025-03-27T02:05:50.707918Z",
    "deleted_at": null,
    "sha1_hash": "6887c12b826a3ac038b07dfe388f73eca30b01a1",
    "title": "2018-01-16 - Threat Spotlight- LockPOS Point of Sale Malware",
    "authors": "",
    "file_creation_date": "2022-05-28T21:55:49Z",
    "file_modification_date": "2022-05-28T21:55:49Z",
    "file_size": 117766,
    "plain_text": "# Threat Spotlight: LockPOS Point of Sale Malware\n\n**[cylance.com/en_us/blog/threat-spotlight-lockpos-point-of-sale-malware.html](https://www.cylance.com/en_us/blog/threat-spotlight-lockpos-point-of-sale-malware.html)**\n\nThe BlackBerry Cylance Threat Research Team\n\n[RESEARCH & INTELLIGENCE / 01.16.18 /](https://www.cylance.com/en/category/research-and-intelligence) The BlackBerry Cylance Threat Research\nTeam\nLockPOS is a point-of-sale malware discovered in 2017 that is used to exfiltrate payment\ncard data from targeted point-of-sale systems’ memory. The most recent version of\nLockPOS examined here changed its injection technique to drop the malware directly to the\nkernel to evade detection and bypass traditional antivirus (AV) hooks.\n\nThis evasion technique has been seen before being employed by a similar malware\n[(Flokibot POS Malware). In addition to the injection technique, this new malware variant is](https://threatvector.cylance.com/en_us/home/threat-spotlight-flokibot-pos-malware.html?utm_medium=Blog)\nalso communicating with a new command-and-control (C2) server that hasn’t been seen\nbefore.\n\nThe following a technical overview of this new technique used by LockPOS:\n\n## File Information\n\n**SHA256:1436577b2b111fe299a1321e00543d0e8d49d827abde651faea7403e4bb38644**\n\n**Type: Win32 EXE**\n\n**Size: 140,288 bytes**\n\n**Timestamp: 11/18/2017 12:40:26 PM**\n\n**ITW names: 1e490056bdb537f9492bc72a365537f0.virobj**\n1e490056bdb537f9492bc72a365537f0\n\n## Technical Analysis\n\n\n-----\n\nThe malware has a core resource section that is encrypted:\n\n\n-----\n\n-----\n\n_Figure 1_\n\nWhen it runs, it begins making API calls that are used to decrypt itself, and the APIs are\nobfuscated using API hashing:\n\n\n-----\n\n-----\n\n_Figure 2_\n\nThe decrypted executable with a debugging string shown below is then loaded to memory\nfor execution:\n\n\n-----\n\n-----\n\n_Figure 3_\n\nWhen executed, the malware uses API calls from ntdll.dll to inject itself into explorer.exe as\na persistence mechanism. The API calls are still made using the API hashing, a method\nthat is new for LockPOS which allows the malware to avoid traditional AV detection by\ninjecting the code on-the-fly within memory:\n\n\n-----\n\n-----\n\n_Figure 4_\n\nThe injected code will then try to connect to the C2 server at the following address:\n\n**bbbclearner[dot]at/_x/update[dot]php**\n\nThis is a new C2 server that has never been seen in malware campaigns prior. The C2\nserver also has what seems to be a back-end panel that is similar to the one seen before\nwith the treasurehunter[dot]at C2 server.\n\n\n-----\n\n-----\n\n_Figure 5_\n\nIn addition to the abovementioned C2 server, the malware also reaches out to multiple,\nunregistered domains, most likely as a method used to disrupt any analysis of the file and to\nhide the real C2 server domain (a full list of the domains can be found in IOCs section\n_below)._\n\n\n-----\n\n-----\n\n_Figure 6: String in memory showing domains_\n\n[If you use our endpoint protection product, CylancePROTECT®, you are already protected](https://www.cylance.com/en_us/products/our-products/protect.html?utm_medium=Blog)\nfrom this attack.\n\n## Indicators of Compromise (IOCs)\n\n**Hashes:**\n\n1436577b2b111fe299a1321e00543d0e8d49d827abde651faea7403e4bb38644\n\n**C2:**\n\nbbbclearner[dot]at/_x/update[dot]php\n\n**Domains:**\n\nreportpestgallon[dot]xyz\n\nsiamesefineknowledge[dot]xyz\n\nforkveilfall[dot]xyz\n\ngrillpromotionpressure[dot]xyz\n\ngrandmothernoveloffer[dot]xyz\n\nshampoodebtorguitar[dot]xyz\ncommissionroadwaygirdle[dot]xyz\n\napologytailorpelican[dot]xyz\n\ncostsfelonybumper[dot]xyz\n\nmarketgreat-grandfatherkettle[dot]xyz\n\ndebtdoubleshop[dot]xyz\n\norderareateaching[dot]xyz\n\ncompanyresponsibilityshallot[dot]xyz\n\nequipmentkicksaturday[dot]xyz\n\nhyenadecisionblanket[dot]xyz\n\ncostscousinphysician[dot]xyz\n\nalibitowerrepairs[dot]xyz\n\ngrassarmchairpreparation[dot]xyz\n\nheattomatooffer[dot]xyz\n\ntimenoodlesuggestion[dot]xyz\n\nbudgethardcoverliver[dot]xyz\n\nproductglidinglynx[dot]xyz\n\nobjectiveswordfishorchid[dot]xyz\n\ninstructionsaluminiumroad[dot]xyz\n\ndescriptionbulldozerroast[dot]xyz\n\nauthorizationsharonneck[dot]xyz\n\ndifferencejuicetaste[dot]xyz\n\nmyanmarhoodsignature[dot]xyz\n\ninchpaymentvision[dot]xyz\n\n\n-----\n\npowdergoalship[dot]xyz\nkoreankeycomparison[dot]xyz\npermissionrhythmemery[dot]xyz\nsmokepigeonpromotion[dot]xyz\nbudgetpaultrail[dot]xyz\nptarmiganstockbottle[dot]xyz\ncollarlimitbugle[dot]xyz\nemployerbatvietnam[dot]xyz\ndepartmentmessagewasp[dot]xyz\nruthbudgetnetwork[dot]xyz\nshelfturnoverradish[dot]xyz\ncopyretailerclose[dot]xyz\nmassforestopinion[dot]xyz\ngeminikendocomparison[dot]xyz\nbillburglartablecloth[dot]xyz\ndeliverystaircaseangle[dot]xyz\ndayfatheropinion[dot]xyz\nbillwaterfallsoda[dot]xyz\ngermanquotationconfirmation[dot]xyz\nanteaterimprovementgermany[dot]xyz\nlibraplasticapology[dot]xyz\npossibilityneedjennifer[dot]xyz\ndecisionsnowmancod[dot]xyz\nhandlegumsalary[dot]xyz\ntuneavenuecomparison[dot]xyz\ndonkeybillmexico[dot]xyz\nwhipdifferencerecess[dot]xyz\npancreasreportsnake[dot]xyz\npricemedicinejump[dot]xyz\nbombapologystreetcar[dot]xyz\ndepartmentrussianfall[dot]xyz\namountdebtorromania[dot]xyz\nincreasestationcollar[dot]xyz\nnickelreportaccountant[dot]xyz\nconfirmationhaircutpsychology[dot]xyz\noutputvacuumproperty[dot]xyz\narmyindustrymail[dot]xyz\nsmilejacketemployer[dot]xyz\nschooljapanesecustomer[dot]xyz\nikebanadiscussionapology[dot]xyz\ndanielheightreduction[dot]xyz\ngrowthpumpyacht[dot]xyz\n\n\n-----\n\ncocktailtransportexistence[dot]xyz\npricedogsquash[dot]xyz\nalloyimprovementterritory[dot]xyz\nbadgecupdifference[dot]xyz\nestimatemimosalan[dot]xyz\nsummermosquemistake[dot]xyz\nillegalauthorizationcourt[dot]xyz\nnutobjectiveinvention[dot]xyz\nsupportfaceoperation[dot]xyz\npaymentfilewave[dot]xyz\nadvertiseindonesiahot[dot]xyz\npermissionhandmosque[dot]xyz\ncompetitionweaponjail[dot]xyz\ncolonyarchaeologyinstructions[dot]xyz\nsalespressurelock[dot]xyz\nselfdeliverynail[dot]xyz\nopinionpurchasebathroom[dot]xyz\nstatisticcreekprofit[dot]xyz\nguaranteelistmichael[dot]xyz\ncompetitioncrabquotation[dot]xyz\nisraelseashoregoods[dot]xyz\ncoverapologyfeedback[dot]xyz\nperchinterestdowntown[dot]xyz\narcheologysister-in-lawmarket[dot]xyz\nindexemployeecheese[dot]xyz\nchequeordersale[dot]xyz\ncompetitionstocksister[dot]xyz\nbucketbudgetplot[dot]xyz\nretailerperiodicalsponge[dot]xyz\n\n**References:**\n_https://www.darkreading.com/endpoint/lockpos-malware-sneaks-onto-kernel-via-new-_\n_injection-technique/d/d-id/1330757_\n\nThe BlackBerry Cylance Threat Research Team\n\n## About The BlackBerry Cylance Threat Research Team\n\nThe BlackBerry Cylance Threat Research team examines malware and suspected malware\nto better identify its abilities, function and attack vectors. Threat Research is on the frontline\nof information security and often deeply examines malicious software, which puts us in a\nunique position to discuss never-seen-before threats.\n\n\n-----\n\nBack\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-01-16 - Threat Spotlight- LockPOS Point of Sale Malware.pdf"
    ],
    "report_names": [
        "2018-01-16 - Threat Spotlight- LockPOS Point of Sale Malware.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535631,
    "ts_updated_at": 1743041150,
    "ts_creation_date": 1653774949,
    "ts_modification_date": 1653774949,
    "files": {
        "pdf": "https://archive.orkl.eu/6887c12b826a3ac038b07dfe388f73eca30b01a1.pdf",
        "text": "https://archive.orkl.eu/6887c12b826a3ac038b07dfe388f73eca30b01a1.txt",
        "img": "https://archive.orkl.eu/6887c12b826a3ac038b07dfe388f73eca30b01a1.jpg"
    }
}