{
    "id": "b53c8c20-6959-4dca-893c-4c4003fac844",
    "created_at": "2022-10-25T16:48:23.616973Z",
    "updated_at": "2025-03-27T02:08:00.276612Z",
    "deleted_at": null,
    "sha1_hash": "ebffba8a872949b48dfccc012ab5ddb43e72ec32",
    "title": "",
    "authors": "",
    "file_creation_date": "2019-05-27T08:33:22Z",
    "file_modification_date": "2019-05-27T08:33:22Z",
    "file_size": 1041963,
    "plain_text": "# SectorB06 using Mongolian language in lure document\n\n**[threatrecon.nshc.net/2019/04/30/sectorb06-using-mongolian-language-in-lure-document](https://threatrecon.nshc.net/2019/04/30/sectorb06-using-mongolian-language-in-lure-document/)**\n\nby ThreatRecon Team April 30, 2019\n\n## Overview\n\nSectorB06 is a state sponsored threat actor group active especially within Asia. They\nhave been exploiting vulnerabilities in Microsoft Office’s Equation Editor [1] which\nMicrosoft removed in January 2018 [2], which in this case seems to be a highly\nobfuscated version of CVE-2017-11882. The malware we analyzed in this case are sent\nseemingly only after they already have a basic foothold in their target organizations.\n\nWe came across multiple pieces of their malware used in 2019 which appears to be\ncustom compiled on a per target victim per organization basis, with this particular decoy\ndocument being uploaded from a Singapore IP address.\n\n## Decoy RTF Document\n\nIn this example, SectorB06 made use of a Mongolian decoy document to target their\nvictim.\n\nDecoy document written in Mongolian which references the Ministry of Justice and\nInternal Affairs of Mongolia\n\nIf exploitable, the exploit code drops the first-stage malware DLL at\n“%APPDATA%\\Microsoft\\Word\\STARTUP\\cclerr.wll” and runs it.\n\n## First Stage Malware (RasTls.dll)\n\n\n-----\n\nThe malware starts off by resolving a list of encoded API addresses by accessing the\naddress of kernel32 from the InMemoryOrderModuleList inside the Process Environment\nBlock (PEB) using FS:[0x30]. It then gets the address of kernel32.LoadLibraryA and\nkernel32.GetProcAddress from a function which parses kernel32’s memory block. This is\ndespite the malware already importing LoadLibraryA() and GetProcAddress(), and is\nused presumably to prevent automated systems from detecting massive amounts of\ncalls to those functions.\n\nFrom there, it gets the address of the other libraries it makes use of – Shlwapi.dll,\nShell32.dll, Gdi32.dll, User32.dll, and Advapi32.dll. Once that is done, it calls the\nfunction which parses the various DLLs again close to 100 times in order to resolve all\nthe APIs it uses. In the middle of those calls, it checks CheckRemoteDebuggerPresent\nand does not resolve the APIs from the other DLLs if a debugger is found, which will\ncause the malware to exit later before doing anything malicious.\n\nMalware decrypting the imports it uses via its custom hashing algorithm\n\nIt then starts a thread which polls the result of CheckRemoteDebuggerPresent\nconstantly and exits once a debugger is found.\n\n### Process Name Hashing\n\nThe malware checks for the lower-cased process name it is running under at various\nsteps of execution using a string hashing algorithm. In the first step, it checks against the\nstring hash “0xAB341DFA”, “0x190BC0F1”, “0x639EBCBF”, “0xA6AFB610”,\n“0x4D16CE36”, and “0x64820461”. It only continues execution if the process name hash\nis one of the first five hashes and the process name hash is not the last hash. We wrote\na custom bruteforcing utility and managed to crack the first five hashes, finding the\nprocess names which the attacker expected as “winword.exe”, “excel.exe”,\n“powerpnt.exe”, “acrord32.exe”, and “eqnedt32.exe”. While four of these process names\nare associated with Microsoft Office and the Equation Editor vulnerabilities,\n“acrord32.exe” (Adobe Reader) is also in the expected process name list because the\nmalware will in some situations rename the legitimate signed Symantec executable file\n(described later) to “AcroRd32.exe”.\n\n\n-----\n\nMalware making sure the process name is related to the exploit source or itself\n\nBesides this initial check, it also checks the hashes of process names at three other\npoints of execution. Only the hash 0X84F39C89 is checked against the entire process\nlist and is not a lower-case version of the process name.\n\n**Hash** **Meaning** **Description**\n\n0X0E867CB6 rundll32.exe If process is rundll32.exe, do not continue\n\n0XA54ACF71 explorer.exe If process is not explorer/services.exe, do not continue\n\n0XCD163D44 services.exe If process is not explorer/services.exe, do not continue\n\n0X84F39C89 <unknown> If this process exists, do not inject into dllhost.exe\n\nFrom this we can see there are actually two points from which the malware expects to\nrun from – using the Microsoft Office exploit which injects the second stage malware into\ndllhost.exe or another path which injects into explorer.exe/services.exe.\n\n### Persistence\n\nThis first stage malware mainly decompresses and drops two files being used for\npersistence.\n\n**File Name** **Description**\n\nRasTls.dll Renamed from cclerr.wll\n\n\nIntelGraphicsCon‐\ntroller.exe /\nAcroRd32.exe\n\n\nLegitimate signed Symantec file (real name: dot1xtra.exe) from\nSymantec Network Access Control agent (version 12.1.671.4971)\n\nHash:\n724909ba378a872018a3ae0b68afe4949bc404de31bcb‐\nd65a6239c12b3a7a3ea\n\n\nPublic examples of a different version of this same signed file being abused in the wild\nwas with version 11.0.4010.7, where the filenames used were rastlsc.exe and\niassvcs.exe. Though these files were signed, their certificates have long expired.\n\nThe files used for persistence are stored in either the “%AppData%\\Intel\\Intel(R)\nProcessor Graphic\\” or “%PROGRAMFILES%\\Intel\\Intel(R) Processor Graphics\\”\ndirectories.\n\n\n-----\n\nThe persistence keys used are in\n<HIVE>\\Software\\microsoft\\windows\\currentversion\\run where <HIVE> is either HKLM or\nHKCU depending on whether there is administrative rights. The name of the registry key\nused is “IntelGraphicsController” with the value of\n“<DIRECTORY_TO_INTELGRAPHICSCONTROLLER.EXE> Processid:{0A10C2452190-7215-A3C5-43215926716A}”.\n\n### Commands Ran\n\nThe malware runs CreateProcess from a custom command execution function four\ntimes, with each run executing takeown/icacls/icacls. The first icacls function attempts to\ngive ownership to the administrators group and the second icacls function attempts to\ngive ownership to the users group. The four runs are for the RasTls.dll file in the\n%APPDATA% and %PROGRAMFILE% subdirectories and the\nIntelGraphicsController.exe file in the %APPDATA% and %PROGRAMFILE%\nsubdirectories.\n\nBesides those commands, it also drops two batch files.\n\n<random.bat> – deleting from initial location\n1\n2\n3\nPing 127.0.0.1 -n 10\ndel “C:\\Users\\admin\\AppData\\Roaming\\Microsoft\\Word\\STARTUP\\cclerr.wll” /q /f\ndel %0 /q /f\n\n<random.bat> – attempting to delete winword.exe\n1\n2\n3\nPing 127.0.0.1 -n 10\ndel “C:\\Program Files\\Microsoft Office\\Office14\\WINWORD.EXE” /q /f\ndel %0 /q /f\n\n### Timestomping\n\nThe malware uses kernel32’s GetFileTime() and SetFileTime() to get the Creation Time,\nLast Access Time, and Last Write Time of %windir%\\system32\\kernel32.dll and saves\nthose same times to the RasTls.dll and IntelGraphicsController.exe files. However, these\ntimestamps are only approximate [3] so the fake times will not be an exact match to\nkernel32.dll’s file time.\n\n\n-----\n\nThe main two files dropped by the malware for persistence have the approximate\ntimestamps of kernel32.dll\n\n### Victim Identification\n\nThe malware identifies its victims using <HIVE>\\Software\\Intel\\Java (with <HIVE> being\nHKLM/HKCU again) with the name “user”. Malware “1-a” referenced below is the current\nfirst stage malware we are describing in this post.\n\nMalware “1-a” and “5-a” contain the same victim identifier values, as do “2-a” and “3-a”.\nThis is interesting because of the second stage malware which we describe briefly later.\n\n**Malware** **Victim Identification Value**\n\n1-a 0XdgrHGaayfyBHQ/vCwMP2HE+cNEbzTk\n\n6cZ9bYJOH0R2/z9riKtfcWki36ENBhJ/\n\n2-a W3qNGgEnxwHShISsHqe4WQlLvmX2q0ms\n\ntlCuJVt0/qjwLh7CWXM34rJI66fTyf1u\n\n3-a 4et2q+jmcCeVoPVtVlUeC+Zqq62VN3Q7e7noo8oplXCIv\n\naA22rc7KIYWtv69Nv1rgPeytor20Dv5..oEFQze78uA==\n\n5-a 0XdgrHGaayfyBHQ/vCwMP2HE+cNEbzTk\n\n6cZ9bYJOH0SxvpFWecTmuneM/5p93lQw\n\n### Process Injection\n\nFinally, the malware performs process injection into “%windir%\\system32\\dllhost.exe\n/Processid:{712459B2-3311-54C3-910D-0327080553246}” without the second stage\never touching the disk. The injected process, dllhost.exe, is typically a container process\nfor running COM DLLs. The list of CLSIDs in a system can be seen in\nKEY_CLASSES_ROOT\\CLSID. We are unsure what the hardcoded CLSID value of\n“712459B2-3311-54C3-910D-0327080553246” is supposed to represent, but a likely\nguess is a CLSID used by Symantec since the malware is impersonating their\nexecutable file.\n\n\n-----\n\n## Second Stage Malware\n\nWhile we did not analyze the second stage malware in large detail, we did decode the\nC2 information among other data such as credentials. The samples we analyzed appear\nto connect to two external C2 IP addresses 217[.]69[.]8[.]255 and 1[.]187[.]1[.]187 on\nport 443. It also references an internal IP address, which indicate that these spear\nphishing documents are sent to targeted victims and only after the attacker already has\nbasic access to the victim’s internal network.\n\nOne of the purposes of this second stage malware also appears to be for creating a\nremote command shell.\n\n**Malware** **Internal IPs Referenced**\n\n1-b 192[.]168[.]43[.]234\n\n2-b 192[.]168[.]111[.]111\n\n3-b 192[.]168[.]111[.]111\n\n4-b 192[.]168[.]43[.]234\n\n5-b 192[.]168[.]43[.]234\n\n6-b 192[.]168[.]43[.]234\n\nWith the malware trying to target/use the same internal IP but with different user\nidentification values, we see how the attacker is custom compiling each malware\nexecutable for each victim/attempt in a specific organization.\n\n## Summary\n\nSectorB06 is a threat group with very specific interests and in the case of these malware,\nappears to either already have a basic foothold in the victim network or has already\ngained and then lost access to the network. They are actively developing their toolkit and\nare adept at bypassing security solutions at least statically especially for their exploit\ndocument and second stage malware.\n\n## Indicators of Compromise\n\n### Decoy Hash (SHA-256)\n\n803c25767414c31259e15f058d62b6102dfe09d3cfacece57f527d7fb2a50632\n\n### First Stage Hashes (SHA-256)\n\n304115cef6cc7b81f4409178cd0bcea2b22fd68ca18dfd5432c623cbbb507154\n\n6086b407ed69434fce117bc173f70a2ec147fdf119cf38f6031c1889e19ff8bf\n\n240f2c0cd808991b2c77a978203c661612e250df2b0bad9fd452b6c21d60b324\n\nd0ccb9a277b986f7127199f122023c79a7e0253378a4a78806fbf55a87633532\n\n\n-----\n\n### Second Stage Hashes (SHA-256)\n\n87c4eb8201f9cf92aa5562d112fdd322a01899bcc38ba39e4f6ef92cbf144900\n\nfcb0d071a9384750adf88963eb580690effbe8b29942afa6a8e2566e9a4e94dd\n\ne8446ba200c9d703fab7ddc068b45772585ae782a8bcf4c5f86782d7220405f7\n\n32fbd62a1fde794cdf95a67f22f47b495474cd18419ac4c37fbb5460cdfd1831\n\n85bdd517886e645a3d0e4e4bc16ede5bbb126eaf86c0d14c05a951219f48555a\n\n### IP Addresses\n\n217[.]69[.]8[.]255\n\n1[.]187[.]1[.]187\n\n## MITRE ATT&CK Techniques\n\nThe following is a list of MITRE ATT&CK Techniques we have observed based on our\nanalysis of these malware.\n\n### Initial Access\n\nT1193 Spearphishing Attachment\n\n### Execution\n\nT1059 Command-Line Interface\n\nT1203 Exploitation for Client Execution\n\nT1064 Scripting\n\n\n-----\n\nT1204 User Execution\n\nT1218 Signed Binary Proxy Execution\n\n### Persistence\n\nT1038 DLL Search Order Hijacking\n\nT1060 Registry Run Keys / Startup Folder\n\n### Defense Evasion\n\nT1116 Code Signing\n\nT1038 DLL Search Order Hijacking\n\nT1107 File Deletion\n\nT1055 Process Injection\n\nT1218 Signed Binary Proxy Execution\n\nT1045 Software Packing\n\nT1099 Timestomp\n\n### Discovery\n\nT1057 Process Discovery\n\nT1012 Query Registry\n\nT1063 Security Software Discovery\n\nT1124 System Time Discovery\n\n### Collection\n\nT1119 Automated Collection\n\n### Exfiltration\n\nT1022 Data Encrypted\n\n### Command and Control\n\nT1043 Commonly Used Port\n\nT1071 Standard Application Layer Protocol\n\n## References\n\n[1] Microsoft Office : List of security vulnerabilities\n\nhttps://www.cvedetails.com/vulnerability-list/vendor_id-26/product_id-320/cvssscoremin9/cvssscoremax-/Microsoft-Office.html\n\n[2] CVE-2018-0802 | Microsoft Office Memory Corruption Vulnerability\n\nhttps://portal.msrc.microsoft.com/en-us/security-guidance/advisory/CVE-2018-0802\n\n[3] GetFileTime function\n\nhttps://docs.microsoft.com/en-us/windows/desktop/api/fileapi/nf-fileapi-getfiletime\n\n\n-----\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2019/2019.04.30.SectorB06_Mongolian/SectorB06%20using%20Mongolian%20language%20in%20lure%20document.pdf"
    ],
    "report_names": [
        "SectorB06 using Mongolian language in lure document"
    ],
    "threat_actors": [
        {
            "id": "b740943a-da51-4133-855b-df29822531ea",
            "created_at": "2022-10-25T15:50:23.604126Z",
            "updated_at": "2025-03-27T02:00:55.505366Z",
            "deleted_at": null,
            "main_name": "Equation",
            "aliases": [
                "Equation"
            ],
            "source_name": "MITRE:Equation",
            "tools": null,
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1666716503,
    "ts_updated_at": 1743041280,
    "ts_creation_date": 1558946002,
    "ts_modification_date": 1558946002,
    "files": {
        "pdf": "https://archive.orkl.eu/ebffba8a872949b48dfccc012ab5ddb43e72ec32.pdf",
        "text": "https://archive.orkl.eu/ebffba8a872949b48dfccc012ab5ddb43e72ec32.txt",
        "img": "https://archive.orkl.eu/ebffba8a872949b48dfccc012ab5ddb43e72ec32.jpg"
    }
}