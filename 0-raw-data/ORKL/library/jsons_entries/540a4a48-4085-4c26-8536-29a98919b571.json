{
    "id": "540a4a48-4085-4c26-8536-29a98919b571",
    "created_at": "2023-01-12T15:07:11.992324Z",
    "updated_at": "2025-03-27T02:05:29.990259Z",
    "deleted_at": null,
    "sha1_hash": "6ea8e213ca7b6c7f17915fc7fccd0246cc1d4375",
    "title": "2018-11-07 - Let’s Learn- Introducing Latest TrickBot Point-of-Sale Finder Module",
    "authors": "",
    "file_creation_date": "2022-05-28T04:40:11Z",
    "file_modification_date": "2022-05-28T04:40:11Z",
    "file_size": 360035,
    "plain_text": "# Let’s Learn: Introducing Latest TrickBot Point-of-Sale Finder Module\n\n**[vkremez.com/2018/11/lets-learn-introducing-latest-trickbot.html](https://www.vkremez.com/2018/11/lets-learn-introducing-latest-trickbot.html)**\n\n**Goal: Analyze the latest TrickBot point-of-sale finder“psfin32” reconnaissance module**\nhunting for point of sale related services, software, and machines in Lightweight Directory\nAccess Protocol (LDAP)\n\n**Source:**\n\nUnpacked TrickBot psfin32 Module 32-Bit (x86) (MD5:\n4fce2da754c9a1ac06ad11a46d215d23)\n\n**Outline**\n```\nI. Background\nII. Decoded TrickBot Point-of-Sale Finder “psfin32” Module 32-Bit (x86) \nIII. TrickBot Point-of-Sale Finder Module vs DomainGrabber Module: Code Analysis\nIV. TrickBot Point-of-Sale Finder Module LDAP Analysis\nV. TrickBot Point-of-Sale Finder Module POST Command\nIV. Yara Signature\n\n```\n**I. Background**\n\nThis is not the first time the TrickBot development group leverages LDAP; they also\ndeveloped a DomainGrabber module specifically to harvest sensitive domain controller\ninformation, as detailed earlier. The group behind the TrickBot malware development\nremains to be one of the most resourceful in the e-crime ecosystem continuously releasing\nvarious modules (for example. password grabber “pwgrab32Dll” on October 19, 2018). The\nmodule itself does not steal any point-of-sale data but rather used to profile corporate\nmachines of interest with possible point-of-sale devices. This module arrives just in time for\nthe holiday shopping season highlighting the group interest in exploring possible point-ofsale breaches. The question is: What point-of-sale malware would the group behind TrickBot\ndeploy on identified machines of interest, and/or would they auction this access to another\ngroup? This question is yet to be answered.\n\n**II. Decoded TrickBot Point-of-Sale Finder “psfin32” Module 32-Bit (x86)**\n\n\n-----\n\nThis tiny \"psfin32\" module DLL with the size of 18.13 KB (18568 bytes), compiled on\nMonday, November 5, 09:00:47 2018 UTC, is originally called \"dll[.]dll.\" The module itself\nconsists of only 24 functions.\nThe decoded Trickbot \"pfin32Dll\" module contains the usual Trickbot export functions:\n```\nControl\nFreeBuffer\nRelease\nStart\n\n```\n**III. TrickBot Point-of-Sale Finder Module vs DomainGrabber Module: Code Analysis**\n\nThe latest module consists visually a lot of similarity to their previous DomainGrabber\nmodule. During pseudo source-code level analysis, it is revealed that the code contains 6\npartial function matches (including perfect match and strongly connected components), 17\nunreliable function matches (including same MD index and constants, strongly connected\ncomponents, similar small pseudo-code, strongly connected components small-primesproduct, and loop count). By and large, the pseudo source-code analysis reveals the new\nmodule heavily borrows from the earlier DomainGrabber code and was likely coded by the\nsame developer(s).\n\n\n-----\n\n**IV. TrickBot Point-of-Sale Finder Module LDAP Analysis**\nThis Trickbot module was programmed leveraging Active Directory Service Interfaces (ADSI)\nAPIs to search LDAP for objects possibly linked to point of sale related services, software,\nand machines. To learn more about specific access ADsOpenObject and IADsContainer\ninterface, please refer to the [DomainGrabber post.](https://www.vkremez.com/2017/12/lets-learn-introducing-new-trickbot.html)\nLDAP provider is used to access Active Directory Domain Services. The LDAP binding string\ntakes the following form of \"GC://\" binding to the root of the namespace. \"GC:\" uses the\nLDAP provider to bind to the Global Catalog service to execute queries.\nThe module queries for DOMAIN Global Catalog the following accesses:\n```\nCOMPUTERS\nUSERS\nGROUPS\nSITES\nOUs\n\n```\nThe point-of-sale key terms of interest are as follows:\n```\n*POS*\n*REG*\n*CASH*\n*LANE*\n*STORE*\n*RETAIL*\n*BOH*\n*ALOHA*\n*MICROS*\n*TERM*\n\n```\n**V. TrickBot Point-of-Sale Finder Module POST Command**\nOnce the information is harvested, the \"Log\" file with the information would be posted to the\nTrickBot to \"Dpost\" servers via \"/%s/%s/90\" command.\n\n\n-----\n\nPart of the export \"Control\" function, the module forms and communicates to the next-layer\nnetwork via the module network path ending in .../<GROUP ID>/<CLIENT ID>/90. The /90\nending is leveraged for POST requests with its content in the following three unique formats:\n```\nA. Content-Disposition: form-data; name=\"proclist\"\nB. Content-Disposition: form-data; name=\"sysinfo\"\nC. Content-Type: multipart/form-data; boundary=Arasfjasu7\n\n```\nThe unique value \"Arasfjasu7\" appears to be a marker/separator for the LDAP query\ncollection upload to split the harvested information.\n**IV. Yara Signature**\n\n\n-----\n\n```\nimport pe \nrule crime_win32_trickbot_psfin32_dll {\n  meta:\n   author = \"@VK_Intel\"\n   reference = \"Detects TrickBot Point-of-Sale Finder Module\"\n   date = \"2018-11-07\"\n   hash1 = \"f82d0b87a38792e4572b15fab574c7bf95491bf7c073124530f05cc704c1ee96\"\n  strings:\n   $s0 = \"(&(objectCategory=computer)\n(userAccountControl:1.2.840.113556.1.4.803:=8192))\" fullword wide\n   $s1 = \"Dpost servers unavailable\" fullword ascii\n   $s2 = \"USERS:\" fullword wide\n   $s3 = \"*POS*\" fullword wide\n   $s4 = \"/%s/%s/90\" fullword wide\n   $s5 = \"DOMAIN GC\" fullword wide\n   $s6 = \"*MICROS*\" fullword wide\n   $s7 = \"(&(objectCategory=person)(sAMAccountName=%s))\" fullword wide\n $ldap_gc_pos_queryportion = { 85 f6 0f ?? ?? ?? ?? ?? 8b ?? ?? 8d ?? ?? ?? ?? ?? 6a\n04 c7 ?? ?? ?? ?? ?? ?? ?? ?? ?? c7 ?? ?? ?? ?? ?? ?? ?? ?? ?? c7 ?? ?? ?? ?? ?? ??\n?? ?? ?? c7 ?? ?? ?? ?? ?? ?? ?? ?? ?? c7 ?? ?? ?? ?? ?? ?? ?? ?? ?? c7 ?? ?? ?? ??\n?? ?? ?? ?? ?? c7 ?? ?? ?? ?? ?? ?? ?? ?? ?? c7 ?? ?? ?? ?? ?? ?? ?? ?? ?? c7 ?? ??\n?? ?? ?? ?? ?? ?? ?? c7 ?? ?? ?? ?? ?? ?? ?? ?? ?? c7 ?? ?? ?? ?? ?? ?? ?? ?? ?? c7\n?? ?? ?? ?? ?? ?? ?? ?? ?? 8b ?? 52 50 ff ?? ?? 85 c0 0f ?? ?? ?? ?? ?? 68 84 45 00\n10 57 e8 ?? ?? ?? ?? 68 a0 45 00 10 57 e8 ?? ?? ?? ?? 68 24 46 00 10 57 e8 ?? ?? ??\n?? ba 40 46 00 10 b9 e0 44 00 10 e8 ?? ?? ?? ?? 50 68 4c 46 00 10 57 e8 ?? ?? ?? ??}\n  condition:\n   ( uint16(0) == 0x5a4d and\n     filesize < 50KB and\n     pe.imphash() == \"13c48c2a1eaa564e28ee00ed7cd0fc0f\" and pe.exports(\"Control\")\nand pe.exports(\"Release\") and\n     ( all of them )\n   ) or ( $ldap_gc_pos_queryportion and 5 of ($s*) )\n}\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-11-07 - Let’s Learn- Introducing Latest TrickBot Point-of-Sale Finder Module.pdf"
    ],
    "report_names": [
        "2018-11-07 - Let’s Learn- Introducing Latest TrickBot Point-of-Sale Finder Module.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536031,
    "ts_updated_at": 1743041129,
    "ts_creation_date": 1653712811,
    "ts_modification_date": 1653712811,
    "files": {
        "pdf": "https://archive.orkl.eu/6ea8e213ca7b6c7f17915fc7fccd0246cc1d4375.pdf",
        "text": "https://archive.orkl.eu/6ea8e213ca7b6c7f17915fc7fccd0246cc1d4375.txt",
        "img": "https://archive.orkl.eu/6ea8e213ca7b6c7f17915fc7fccd0246cc1d4375.jpg"
    }
}