{
    "id": "db2c1daa-31c5-4e50-bbe5-646b523390b1",
    "created_at": "2023-01-12T15:06:48.882613Z",
    "updated_at": "2025-03-27T02:06:11.768971Z",
    "deleted_at": null,
    "sha1_hash": "69613030009c23c541d457a3a82697385dbe96b7",
    "title": "2022-04-12 - Malware Campaigns Targeting African Banking Sector",
    "authors": "",
    "file_creation_date": "2022-05-28T19:09:35Z",
    "file_modification_date": "2022-05-28T19:09:35Z",
    "file_size": 2454302,
    "plain_text": "# Recent Posts\n\n**[threatresearch.ext.hp.com/malware-campaigns-targeting-african-banking-sector/](https://threatresearch.ext.hp.com/malware-campaigns-targeting-african-banking-sector/)**\n\n[HP Threat Research Blog • Malware Campaigns Targeting African Banking Sector](https://threatresearch.ext.hp.com/blog/)\n\n## Malware Campaigns Targeting African Banking Sector\n\n\nApril 12, 2022\n\n\n[The top motivation behind cybercrime is financial enrichment and the financial services](https://www.verizon.com/business/resources/reports/dbir/2021/results-and-analysis/)\nindustry is an attractive target for cybercriminals. In early 2022, HP Wolf Security detected a\ntargeted malware campaign against an employee of an African bank. The campaign caught\nour attention because of its targeted nature and how the threat actor attempted to deliver\nmalware using HTML smuggling, a technique for sneaking malicious email attachments past\ngateway security controls. In this article, we describe the campaign, sharing how the attacker\nregistered fake banking domains to build a credible lure, and explain how HTML smuggling\nworks.\n\n## The Campaign\n\nIn early 2022, an employee of a West African bank received an email purporting to be from a\nrecruiter from another African bank with information about job opportunities there. The\ndomain used to send the email was typosquatted and does not belong to the legitimate\nmimicked organization. A WHOIS request reveals the domain was registered in December\n\n\n-----\n\n2021 and visiting the website returned an HTTP 404 Not found response. To make the lure\nmore credible, the threat actor also included a reply-to address of another supposed\nemployee of the recruiting bank.\n\nSearching for other typosquatted domains relating to the mimicked organization revealed two\nmore (Appendix 1) that may be related to the same malware campaign. The second domain\ndisplayed a web page about the bank’s employment application process, which was likely\ncopied from the legitimate website.\n\nFigure 1 – Typosquatted bank website describing the job application process.\n\nThere is no malware hosted on the page itself, and no input form that could be used to elicit\nlogin credentials or sensitive information from visitors.\n\nThe third domain showed the mimicked bank’s homepage, which was also likely copied from\nthe legitimate website, but again we found no malware or signs that the site was being used\nfor phishing.\n\n### Purpose of the Typosquatted Domains\n\n\n-----\n\nOn typosquatted domains 2 and 3 we found had DNS TXT records for Sender Policy\nFramework (SPF) set up, suggesting that they were likely used for sending malicious emails.\nIf the websites were used for phishing or hosting malware, spending time to configure these\nrecords would not serve any purpose. Visiting the websites increases the recipient’s trust in\nthe email lure because they are shown content copied from the legitimate bank, ultimately\nmaking them more likely to act upon the email.\n\nWe weren’t able to link all three domains together conclusively, however, domain 2\nreferences the bank’s job application process – the lure used in the malware campaign – and\nfollows a very similar naming convention to domain 1, so we think the same threat actor\nprobably registered that infrastructure.\n\n## Common Fraud Methods Related to Banks\n\nPhishing Phishing is one of the most common scams targeting bank customers.\nThe attacker creates a website that imitates a bank’s legitimate login\nportal and sends the link to potential victims via email or SMS. If\nsomeone enters their login credentials into the form, the attacker can\nuse them to log into the account. An effective way to defeat simple\nattacks like this is to enforce multi-factor authentication. To circumvent\nthis, the attacker would have to capture the second factor from the\nvictim and log into the banking portal when the phishing takes place.\n\n\nFake\nbank/Investment\nscam\n\nMalware\ndistribution\n\n\nIn the fake bank or investment scam the attacker builds a website\nimitating a legitimate bank or investment platform. The website is used\nto attract victims to register an account, often promising strong returns\nthrough investments. When the victim logs into the website they are\nshown a fund management tool. The attacker convinces the victim to\ntransfer money using the tool, supposedly into their account. The\nmoney is transferred via third-party providers, instead of normal bank\ntransfers that are subject to stricter anti-fraud controls. The victim is\nshown a balance in their fake account, which increases as expected\nwith a good return. However, the money was in fact transferred to\nfraudster’s account and is usually lost for good from the victim.\n\nMalware is sometimes distributed via fake bank websites or emails\npretending to be from banks. This is not exclusively Windows malware.\nThe rise in popularity of smartphone banking apps means that malware\nis often distributed as apps targeting smartphone operating systems.\nUsers should verify they are using the official mobile banking\napplication and in the case of emails and websites, make sure they\nhave accessed to correct domain of their bank.\n\n\n## Malware Analysis\n\nIn this campaign, the threat actor sent an HTML attachment Fiche de dossiers.htm to the\nrecipient. Opening the file in a text editor reveals the source code of the page (Figure 2).\n\n\n-----\n\nFigure 2 – Source code of HTML attachment Fiche de dossiers.htm.\n\nThe file contains encoded data and a decoding function. As can already be seen from the\ncomment in the image above, it is a Base64 encoded ISO file. Further down in the source\ncode, this ISO file is decoded and offered to the user in a web browser download prompt\nusing a JavaScript blob (Figure 3).\n\nFigure 3 – Web browser download prompt offering to save the ISO file to the file system.\n\n### HTML Smuggling\n\n\n-----\n\n[HTML smuggling is a technique that enables attackers to sneak file formats that would](https://attack.mitre.org/techniques/T1027/006/)\notherwise be blocked past email gateways by encoding them in an HTML file. JavaScript\nblobs or HTML5 download attributes can be used to decode and reconstruct the file. When\nthe user opens the HTML attachment using a web browser, they are prompted to download\nthe file, which is already stored on the local system. This way HTML smuggling bypasses\nsecurity controls that block malicious website traffic, such as web proxies. The technique is\ndangerous because HTML email attachments are not typically blocked at gateways and\ndetecting the encoded malware can be challenging. Using this technique, dangerous file\ntypes can be smuggled into an organization and lead to malware infection.\n\nIn Windows 10, double clicking the ISO file causes it to be mounted as disc media, which\nopens a new File Explorer window that shows its contents.\n\nFigure 4 – Contents of ISO file Dossier Bad.iso.\n\nInside there is a Visual Basic Script (VBS) file called Fiche de candidature.vbs which is\nexecuted when double-clicked. One way to prevent the accidental execution of malicious\nVBS scripts is to change the default application of .vbs files to a text editor. This way a direct\nexecution can be prevented. If we now open this file in an editor, we see the following code\n(Figure 5).\n\n\n-----\n\nFigure 5 – VBS code containing variable and data definitions.\n\nThe script contains variables, such as a registry key or a path to PowerShell.exe, and some\nencoded data. When the script is executed, it creates a new Registry key and stores a long\nhexadecimal string in it. Then PowerShell is executed and passing an encoded command.\nThe corresponding code sequences can be seen in Figure 6.\n\nFigure 6 – Visual Basic Script code containing PowerShell execution.\n\nThe PowerShell script uses C# type definitions to call Windows API functions. First the script\n[allocates a memory area with NtAllocateVirtualMemory. Then the previously stored](https://docs.microsoft.com/en-us/windows-hardware/drivers/ddi/ntifs/nf-ntifs-ntallocatevirtualmemory)\nhexadecimal string is read from the Registry and a new byte array is created. The array is\n[copied with RtlMoveMemory into the newly allocated memory area. The copied byte array is](https://docs.microsoft.com/en-us/windows/win32/devnotes/rtlmovememory)\n[shellcode which is executed via an API call to CallWindowProcW. For this purpose, only the](https://en.wikipedia.org/wiki/Shellcode)\nmemory address of the shellcode is passed to the function as the first argument\n[(WNDPROC), which is used as the callback address causing malware to run.](https://docs.microsoft.com/en-us/windows/win32/api/winuser/nc-winuser-wndproc#:~:text=A%20callback%20function%2C%20which%20you,you%20define%20in%20your%20application.)\n\n\n-----\n\nFigure 7 – PowerShell code using C# type definitions to execute malicious code.\n\nAnalyzing the shellcode with a debugger reveals a simple decryption function at the very\nbeginning of the code. The code is then decrypted using an XOR operation, which is located\ndirectly after the decryption function, and then executed.\n\nFigure 8 – Shellcode decryption function.\n\n[The decrypted code is GuLoader. This malware is a loader that downloads and executes](https://malpedia.caad.fkie.fraunhofer.de/details/win.cloudeye)\nother malware families from the web. In this campaign GuLoader was configured to\n[download and run RemcosRAT malware. For this purpose, there are two URLs in](https://malpedia.caad.fkie.fraunhofer.de/details/win.remcos)\nGuLoader’s configuration that lead to the RemcosRAT payload. One payload URL leads to\nOneDrive and the other to Dropbox. We have analyzed other malware campaigns involving\n[GuLoader have also used file sharing services to host malware payloads. Since the payload](https://threatresearch.ext.hp.com/wp-content/uploads/2021/10/HP-Wolf-Security-Threat-Insights-Report-Q3-2021.pdf)\nis also encrypted, it can be challenging for service providers to detect and remove them.\n\n### Delivered Payload\n\n\n-----\n\nRemcos is a commercial Windows remote access tool (RAT) that gives the operator\nsignificant control over the infected system. Its capabilities include running remote\ncommands, downloading and uploading files, taking screenshots, recording keystrokes and\nrecording the user’s webcam and microphone. While we don’t know for certain what the\nattacker would have used their access for, but here are some possibilities:\n\nLong term persistent access with the objective of making fraudulent transactions, for\nexample through the SWIFT payment system. This would require the threat actor to\ndeploy tools to understand the network, move laterally, monitor internal procedures and\ntake advantage of them. The attacker might take advantage of the employee’s position\nin the bank since they would have access to their corporate email account.\nMove laterally with the goal of compromising domain controllers to deploy ransomware.\nThey might also steal sensitive/protected data that could be used to extort the target.\nSell their access to another threat actor.\n\n## Conclusion\n\nHP Wolf Security detected a targeted malware campaign on the banking sector in Africa. The\nattacker sent emails from typosquatted domains of a legitimate bank luring them to apply for\na job by opening a malicious attachment. If the user opens the HTML file, they are prompted\nto download an ISO file, which in turn contains a Visual Basic script that leads to a malware\ninfection when executed. This technique is called HTML smuggling and is dangerous\nbecause it enables attackers to smuggle malicious files past email gateway security.\n\nThe downloader used in the described campaign is GuLoader, which is executed using\nPowerShell via code stored the Registry and is otherwise only run in memory. Detecting such\na chain of infection is not easy, as the malware is only located in memory and the Registry.\nHowever, one simple way of breaking the infection chain is changing the default application\nfor script files from Windows Script Host to something else, for example, Notepad.\nOrganizations should also make sure they have visibility over their network to monitor and\nblock unusual process behavior at an early stage. Beyond this, it is important for employees\nto critically question emails, especially those that appeal to a sense of urgency, curiosity and\nauthority – characteristics that are commonly exploited by attackers.\n\n## Indicators of Compromise\n\n[The files of the following hashes can also be found MalwareBazaar.](https://bazaar.abuse.ch/browse/)\n\nHTML file:\n\n9af5400545853d895f82b0259a7dafd0a9c1465c374b0925cc83f14dd29b29c5\n\nISO file:\n\n\n-----\n\n7079ff76eb4b9d891fd04159008c477f6c7b10357b5bba52907c2eb0645887aa\n\nVBS script:\n\n43aaa7f39e9bb4039f70daf61d84b4cde2b3273112f9d022242f841a4829da03\n\nPowerShell script:\n\n0407eab084e910bdd6368f73b75ba2e951e3b545d0c9477e6971ffe6a52a273a\n\nEncrypted GuLoader shellcode:\n\nd681b39362fae43843b1c6058c0aa8199673052507e5c500b7361c935037e05e\n\nRemcosRAT Payload URLs:\n\nhxxps://onedrive.live[.]com/download?\ncid=50D26408C26A8B34&resid=50D26408C26A8B34%21114&authkey=AGW61DvTRT_FRU\n\nhxxps://www.dropbox[.]com/s/veqimnoofpaqmx1/rmss_umUIGF84.bin?dl=1\n\nEncrypted RemcosRAT payload:\n\n5d45422cf2c38af734cee5a5c9fa2fef005f9409d5d5b74814aea1a5f246835d\n\n## Typosquatted Domains\n\nThe following domains were typosquatted by the threat actor to impersonate a credible and\nlegitimate organization and do not represent a vulnerability affecting the organization.\n\nTyposquatted domain 1 afbd-bad[.]org\n\nTyposquatted domain 2 afdb-bad[.]org\n\nTyposquatted domain 3 afdb-za[.]org\n\nTags\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-04-12 - Malware Campaigns Targeting African Banking Sector.pdf"
    ],
    "report_names": [
        "2022-04-12 - Malware Campaigns Targeting African Banking Sector.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536008,
    "ts_updated_at": 1743041171,
    "ts_creation_date": 1653764975,
    "ts_modification_date": 1653764975,
    "files": {
        "pdf": "https://archive.orkl.eu/69613030009c23c541d457a3a82697385dbe96b7.pdf",
        "text": "https://archive.orkl.eu/69613030009c23c541d457a3a82697385dbe96b7.txt",
        "img": "https://archive.orkl.eu/69613030009c23c541d457a3a82697385dbe96b7.jpg"
    }
}