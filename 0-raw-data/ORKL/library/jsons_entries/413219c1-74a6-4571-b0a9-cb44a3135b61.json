{
    "id": "413219c1-74a6-4571-b0a9-cb44a3135b61",
    "created_at": "2023-01-12T14:59:38.915199Z",
    "updated_at": "2025-03-27T02:12:13.850365Z",
    "deleted_at": null,
    "sha1_hash": "2e2a5bcd407d104fce7aeb82781e189ae668af01",
    "title": "2021-12-17 - Serverless InfoStealer delivered in Est European Countries",
    "authors": "",
    "file_creation_date": "2022-05-28T15:44:26Z",
    "file_modification_date": "2022-05-28T15:44:26Z",
    "file_size": 2493072,
    "plain_text": "# Serverless InfoStealer delivered in Est European Countries\n\n**yoroi.company/research/serverless-infostealer-delivered-in-est-european-countries/**\n\n12/17/2021\n\n## Introduction\n\n\nDecember 17, 2021\n\n\nThreat actors' consistency over time represents an indication of effectiveness and experience, resulting in an increasing risk for targeted\ncompanies.\n\n[The Yoroi Malware ZLAB is tracking the threat actor Aggah (TH-157) since 2019, along with PaloAlto UNIT42,](https://unit42.paloaltonetworks.com/aggah-campaign-bit-ly-blogspot-and-pastebin-used-for-c2-in-large-scale-campaign/) [HP and](https://threatresearch.ext.hp.com/aggah-campaigns-latest-tactics-victimology-powerpoint-dropper-and-cryptocurrency-stealer/) [Juniper Networks, and](https://blogs.juniper.net/en-us/security/aggah-malware-campaign-expands-to-zendesk-and-github-to-host-its-malware)\nthe persistency of its malicious operation over time reveals a structured information stealing\ninfrastructure, a worldwide campaign capable of quickly varying its distribution technique.\n\nWe discovered new data theft and reconnaissance operations targeting multiple victims worldwide, including Ukraine, Lithuania, and Italy. The\nwhole campaign impacted hundreds of victims and lasted for two months. CERT Yoroi was able to track the malware distribution infrastructure\nwhich was abusing the Bitbucket code repository infrastructures to evade detection mechanism, URL and domain reputation security check.\n\nThe following article describes how TH-157 conducted this new wave of attacks along with all the indicators needed by security teams to hunt\ndown active intrusions.\n\n## Technical Analysis\n\nThis TH-157 campaign leverages multi-stage infrastructure decoupling mechanisms to achieve an elevated\nlevel of resilience to survive takedowns. The whole infection process counts 9 steps\nto deliver the final payload, but it is able to achieve persistence on the target machine even earlier.\n\n\n-----\n\nFigure 1: Campaign attack chain\n\n**Hash** 17f3f34d7814338c40153073fed0ed0414ecb4f76ca9d3d337b8b09da85f2a57\n\n**Threat** Aggah Campaign November 2021\n\n**Brief Description** Malicious PPA macro dropper\n\n**SSDEEP** 384:IKyo59LwWOIZlIjlaRKPPYglCLMvu61aUr/clFo39D:J59UWOI3mbkLhHmcjo\n\nDifferently from many other Office-based attacks, the Aggah infection starts with a weaponized powerpoint document. In this case the\nmalicious routine will start upon closing the document using the “autoclose” macro. This routine is commonly used to bypass\nautomated sandboxing execution, because, unlikely from the “autoopen” function, the “autoclose”\nis ran only an instant before the Office application is closing, and not all the automated sandboxes check for this behavior.\n\nFigure 2: Macro execution\n\nAs confirmed by known TTPs, Aggah campaign uses a “bitly” link as medium to redirect the infected host to\na blogspot page containing malicious VBScript code that will be executed abusing a LOLBIN.\n\n\n-----\n\nt e st pa t o t e sua as c sc pt, t e sa p e e p o ts t e C S o do s Sc pt ost S e Object to u t e co a d\nwhich subsequently will create a file named “hulalalMCROSOFT.vbs” .\n\nFigure 3: Malicious Blogspot VBScript code\n\nNext, it gathers another VBscript utility from the BitBucket code repository service, a well-known platform used to develop code in a\ncollaborative way.\n\nThe newly downloaded script is stored in the infected machine filesystem at the path “C:\\Users\\Public\\xxx1.txt” and containstwo layers of\nobfuscation: first the content is reversed and then Base64 decoded, a characteristic TTP of TH-157 obfuscation tools.\n\nFigure 4: File “hulalalMCROSOFT.vbs”\n\nThe second layer of obfuscation is composed by other two distinct modules:\n\nThe first is another piece of Visual Basic script containing a long Base64 dirty buffer, starting with the chars “TVqQ”\ncorresponding to “MZ”, the magic header of the Portable executable files.The second is a powershell snippet instructed to clean\nand execute the dirty PE in the first module.\n\nFigure 5: Powershell snippet\n\n\n-----\n\nt t s po t, t e co t o o t e a c ous p ocess passes to t e o e s e sc pt, a d t e, c actua y\nis a .NET assembly library is immediately loaded in memory, invoking the DLL’s “Run” method.\n\nFigure 6: .NET Library\n\nMoreover, the “Run” method, gather two additional payloads: the first from (hxxp://crypters[.]coolpage[.]biz/rumps/Rumppp[.]txt) and the\nsecond one from (hxxps://bitbucket[.]org/!api/2[.]0/snippets/hogya/KpMMLg/a2975578cff84cf6c198f055b21a7a6e3f14cd15/files/rotyh12)\n\nThe first payload (text) will be loaded in memory and the “Run” method invoked, as in the previous step, but two arguments will be passed, the\nfirst is the path to “aspnet_regbrowsers.exe”, a legit Microsoft tool, and the second the Base64 decoded payload.\n\nFigure 7: .NET Injector\n\nThen, the “Execute” method will perform the process hollowing technique based on\nthe WinAPI primitives CreateProcessW NtUnmapViewOfSection,VirtualAlloxEx, ReadProcessMemory, WriteProcessMemory, GetThreadContext,\npayload is an obfuscated version of the notorious info stealer AgentTesla, capable of exfiltrating sensitive information from victim machine such\nas browser session cookies, keystrokes, saved passwords, and to silently spy on victim screen.\n\n\n-----\n\nFigure 8: AgentTesla Payload\n\nBesides the description of the main infection chain, the Aggah campaign uses a malleable persistence method. Thanks to a scheduled task\npointing to a public blogspot page, the threat actor is able to quickly vary the payload and the delivery infrastructure. The task will start every\n80 minutes and the MSHTA tool will retrieve another blogspot page to initiate another backup dropchain, potentially with additional payload.\n\nFigure 9: Scheduled task evidence\n\n## The Bitbucket Distribution Infrastructure\n\nThe new distribution infrastructure uses BitBucket, a legit website for source code hosting, used to replace for example archive.org in the\n[“WayBack” campaign widely described in our last report about Aggah. In this campaign we found mostly](https://yoroi.company/research/the-wayback-campaign-a-large-scale-operation-hiding-in-plain-sight/)\ntwo accounts operating approximately since October 2021.\n\nhxxps://bitbucket.org/hogya/workspace/snippets/ (hogya - harsh singh)\nhxxps://bitbucket.org/choasknight/workspace/snippets/ (choasknight)\n\nIn detail, these two BitBucket accounts were abused to deliver over 30 distinct agent tesla malware attacks, heavily obfuscated as we\npreviously deepened.\n\n\n-----\n\nFigure 10. Abused bitbucket code snippets\n\n## The Targets\n\nAccessing and dissecting the data inside command-and-control infrastructure of the agent tesla samples delivered during\nthis Aggah campaign, we noticed an interesting polarization on geo-distribution of the campaign targets: an unusual spike in the CIS countries\n(Ukraine, Lithuania, Belarus, Russia), and Indonesia. Now, we have no clear interpretation of such unusual polarization, but many geopolitical\ntensions running across the UE borders are effectively increasing in the last months of 2021 and we can’t exclude TH-157 may be selling its\nservices or partnering with other unknown parties.\n\nFigure 11. Aggah’s targets distribution\n\n## Conclusion\n\nThis TH-157 revealed a renewed capability to abuse high reputation infrastructure all around the world to threaten private companies, conduct\nreconnaissance operations, and steal data from unaware personnel. This new malware\ndelivery mechanism investigated by Yoroi’s Malware ZLAB was abusing the notorious Bitbucket code repository cloud services to\nevade traditional antimalware protection and domain reputation safe checks, recalling us the limits of such defensive approaches.\n\nPreventing industrial property theft and intrusions potentially able to escalate in destructive extortions require advanced detection technologies\nsuch automated malware sandboxes like Yomi Hunter, and constant eyes on both endpoints and network through endpoint agents like\nKanwa EDR solution, armed by constantly up-to-date intelligence coming from high level threat research.\n\n## Indicator of Compromise\n\nBitly Links:\n\n\n-----\n\nps //b t y[ ]co /dg a sgdbs agd\n\nhxxps://bitly[.]com/etwuiqdbshadbsgha\nhxxps://bitly[.]com/etyqwuidgshaja\nhxxps://bitly[.]com/etywuiqdbhsnadg\nhxxps://bitly[.]com/etywuiqdhbsgjj\nhxxps://bitly[.]com/etywuiqdhjkasdnbvh\n\nhxxps://bitly[.]com/eyuiasdbnjkasdhkashd\nhxxps://bitly[.]com/eyuiqwdbhasgdjsha\nhxxps://bitly[.]com/eyuiqwdhjkasdbsadgb\nhxxps://bitly[.]com/eyuiqwdhksbgjsha\nhxxps://bitly[.]com/eyuiqwdhsgaddasvdj\n\nhxxps://bitly[.]com/eyuiqwhdjkasdghj\nhxxps://bitly[.]com/eywuiqdbnamsdgjh\nhxxps://bitly[.]com/eywuiqdhjkasdbgmh\nhxxps://bitly[.]com/eywuiqdhnjkasbdjsghah\nhxxps://bitly[.]com/qywuiehasgdshaj\n\nhxxps://bitly[.]com/twyiqgshagsja\nhxxps://bitly[.]com/yeuioqwhdkjasgd\nhxxps://bitly[.]com/yeuiwqhdbasnvgjha\nhxxps://bitly[.]com/yqweikkajsbdjsgadhasdbg\n[hxxps://1230948%1230948%1230948%1230948%1230948%[email protected]]com/dsasabshjkahsadnjksalhndjksa](https://yoroi.company/cdn-cgi/l/email-protection)\n\nBlogspot Links:\n\nhxxps://madarbloghogya.blogspot.com/p/longdickback1.]html\nhxxps://madarbloghogya.blogspot.com/p/rothwellback.]html\n\nBitbucket Payloads Links:\n\nhxxps://bitbucket.]org/!api/2.0/snippets/hogya/bxkkpz/4118f44550b85bec2ae65d3e55bf77b2101991c8/files/calib111\nhxxps://bitbucket.]org/!api/2.0/snippets/hogya/dxkkpr/2a7b31d0309cf290a0a4c692077fd013669991b2/files/charles11\nhxxps://bitbucket.]org/!api/2.0/snippets/hogya/7XkkMb/3cb71404b16fd36f48bb66d71c61d6055fe8fbd3/files/dark1\nhxxps://bitbucket.]org/!api/2.0/snippets/hogya/qXkkMx/5b19e6bac2c7b95e36211bb737603c38bcc64885/files/ghul1\n\nhxxps://bitbucket.]org/!api/2.0/snippets/hogya/Epgg7x/90823c7b15d8d3c9aa74b74766a264f2cdaff147/files/long11\nhxxps://bitbucket.]org/!api/2.0/snippets/hogya/kxqqjX/1cf020a5bcfd0f3a613b1356558b4e5c67136435/files/mrk\nhxxps://bitbucket.]org/!api/2.0/snippets/hogya/yXEEMa/2c4fbe9f83764ed4c53961886e563861399257d5/files/muti\nhxxps://bitbucket.]org/!api/2.0/snippets/hogya/A9MM7b/b1f5d79e5438016d91d7a42680532aed1cff8657/files/qw2\nhxxps://bitbucket.]org/!api/2.0/snippets/hogya/KpMMLg/a2975578cff84cf6c198f055b21a7a6e3f14cd15/files/rotyh12\n\nhxxps://bitbucket.]org/!api/2.0/snippets/hogya/rXEEgk/81cf1a8c4f8ec324adf7e8729c8c19d6f3191d34/files/van1\nhxxps://bitbucket.]org/!api/2.0/snippets/hogya/7Xkkdr/71b71d4e957ac56cd5bc6d1558b81f44210cd884/files/calib-1\nhxxps://bitbucket.]org/!api/2.0/snippets/hogya/KpMMLe/b4e47bf432d722a20ecd7b8d532de88c5274468e/files/charles123\nhxxps://bitbucket.]org/!api/2.0/snippets/hogya/rXEEgA/236882c179c87120ea611078d65f6af854a3da76/files/dark123\nhxxps://bitbucket.]org/!api/2.0/snippets/hogya/nxkkbx/b985a138bfcc230075309d6393d9a77a013146d2/files/ghul123\n\nhxxps://bitbucket.]org/!api/2.0/snippets/hogya/yXEEdx/fd5b2f66e22535e681f5d9b75f380f15645e8ea5/files/long132\nhxxps://bitbucket.]org/!api/2.0/snippets/hogya/KpMMLk/30b96224276ce0482b9ca6a8e8d51b1a80af06dc/files/mrk123\nhxxps://bitbucket.]org/!api/2.0/snippets/hogya/rXEEgg/947b59abdf17355aa212f65cc26ed3a0a694dd30/files/muti001\nhxxps://bitbucket.]org/!api/2.0/snippets/hogya/nxkkbj/93313de40a32b1c85bf7c5ef52d103808e400c89/files/qwe22\nhxxps://bitbucket.]org/!api/2.0/snippets/hogya/LpMMnx/78c83d16ba68da5bd2cdc3a25e26e367c7b10f05/files/roth123\n\nhxxps://bitbucket.]org/!api/2.0/snippets/hogya/qXkkda/da9c321b635563490e760230601e6da016df6172/files/van123\nhxxps://bitbucket.]org/!api/2.0/snippets/hogya/kxqqay/1b716492745a665eea93dd18261a7a3c9f8ac85f/files/reza\nhxxps://bitbucket.]org/!api/2.0/snippets/hogya/exEE5y/c407ebf390895c289726d38e17ace212689e34f8/files/reza-111\nhxxps://bitbucket.]org/!api/2.0/snippets/choasknight/6XEXAo/6602fb280c0f18337286988b9af658023a7cc994/files/test\nhxxps://bitbucket.]org/!api/2.0/snippets/choasknight/kxqxxA/5864261b6610d863302b06c528fe1a85d4db7072/files/darkhorse\nhxxps://bitbucket.]org/!api/2.0/snippets/choasknight/yXEXXn/2b8cdcdeaa63834b21dba9c15a50226a5629a888/files/darkhorsepart2\n\nHash:\n\n014d5412e803d0abe1bdf1f29d02e389603ad5c30e449920f6995748e9310542\n19451a668953bd2a206283163714425ed75f822b8ac915f1e04b966671a1a23c\n27b7e68d5d728b339dc5d8fbc6a9f4194da0ba1ffc471d58c3cabf2a2ebd426d\n\n\n-----\n\n9a 0 3 ec5 9b59d5babd9 5ceb6c 5 3 50 65d3 e 0e86553c 58 c8\n36f26fffbe92ea0a9fbd25908fd12af52f2dad967a1369c77ef97e76c1638ca3\n414f56a4bbedb067cfa571d107103f705d742d10e2fe7163c97d6925e62ea853\n468f28807ef4d3e8cbd812d808b9573fb87ba83a037503c9c14f032ca08deb2e\n54f8342dec4a0b60e369292eee00cb6b8676ec48973a3a345a217febb0f3488e\n5665e106ce98224e6f1d02a49c86e01778ed630ab53b55f5ed50126bd1666c06\n639f108d6fa7469827be4396f086b95158ee28a7eec6867cedaf2d4007a3784b\n639f108d6fa7469827be4396f086b95158ee28a7eec6867cedaf2d4007a3784b\n639f108d6fa7469827be4396f086b95158ee28a7eec6867cedaf2d4007a3784b\n6d492bbc2e972b9720bb9463733ed550236742341952e0d5a31c0f0220beffdd\n81698424c325e40c1cd537719a228cf99fcacd1b954e717f27c4ba32c5cd83fd\n89d2bfac1aa9427857b229ec9f1acae69a865bb33a88f33e7264e82bd4463b35\n8a17d0e4a4f310a8aeb27a2e30cfc463c2d5a2bfa2772b0a5d5700b4c1e1c3bd\n8ed21a5bfe917fcba312ed2b630deadba0a4d623f4bccf74dd80149b176d414e\n9c3ecaecc2339b973eacaa4da07dae33964c75c7766f36c862c988491d4ecbb0\n9f4a60a9f9c8ac29814bf0e94360ca1502973ad2530bb66f8c4e2b75977d7311\na3d8bc6d455eaeca2f0fbe462f6348c0f61242dc7bde1c48d27b33f1d8cf1d9d\na98f6606e576078f0735d504dfd4c4276fd91d918117a29334ff41107c3d269e\nacd370830c92939272a8503ef834d5892108133de131407d10c7435e1514208b\nbc1254a16b628102bb13c3501d2c52063f16c7857419455790863beec30f31e2\nc4d3db664407cd7dde28b6490dc2cbaafad0b91740bf51b480b1f4c324834fd1\nd0d36b28f2d009efd9ebf8006d5a937bdf61e408166d7d811ed01bc4a6cc61ab\nd3b83d76e76c22b2881a3e5b86afbfd020b631584ed0a40f67d5820a572bc5f2\nd4ee5546b462eb2cf6f88ca39fcc208904d02488782ab0285c06e1e35c1a754e\nFe5811c318713cbdf188b2fae370dd8827715fd9e0e5a1ee367823343d0d5a0f\ne2a2f3d6aae6a4ca060d5f761591f6edb9db80677bdd7bb9ba71f8c88b0dbf38\nbb5bdc809fe22bdc88652c5ca93aba8c90798d55e62d7fc0cbc44740bf6bf1d6\n17f3f34d7814338c40153073fed0ed0414ecb4f76ca9d3d337b8b09da85f2a57\n94ac4b5dc33bd0374952731853642a4eca8bdb9be12b861297d7dd8f0e527c19\n\nC2 Panels (agent tesla):\n\nhxxp://69.174.99.181/webpanel-calib/\nhxxp://69.174.99.181/webpanel-charles/\nhxxp://69.174.99.181/webpanel-dark/\nhxxp://69.174.99.181/webpanel-ghul/\n\nhxxp://69.174.99.181/webpanel-greg/\nhxxp://69.174.99.181/webpanel-long/\nhxxp://69.174.99.181/webpanel-mrk/\nhxxp://69.174.99.181/webpanel-muti/\nhxxp://69.174.99.181/webpanel-reza/\n\nhxxp://69.174.99.181/webpanel-roth/\nhxxp://69.174.99.181/webpanel-trade/\nhxxp://69.174.99.181/webpanel-van/\nhxxp://69.174.99.181/webpanel-zoe/\n\n_This blog post was authored by Luigi Martire, Carmelo Ragusa, and Luca Mella of Yoroi Malware ZLAB_\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-12-17 - Serverless InfoStealer delivered in Est European Countries.pdf"
    ],
    "report_names": [
        "2021-12-17 - Serverless InfoStealer delivered in Est European Countries.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "28851008-77b4-47eb-abcd-1bb5b3f19fc2",
            "created_at": "2023-06-20T02:02:10.254614Z",
            "updated_at": "2025-03-27T02:00:03.130853Z",
            "deleted_at": null,
            "main_name": "Hagga",
            "aliases": [
                "TH-157",
                "Aggah"
            ],
            "source_name": "MISPGALAXY:Hagga",
            "tools": [
                "Agent Tesla"
            ],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "b0d34dd6-ee90-483b-bb6c-441332274160",
            "created_at": "2022-10-25T16:07:23.296754Z",
            "updated_at": "2025-03-27T02:02:09.724313Z",
            "deleted_at": null,
            "main_name": "Aggah",
            "aliases": [
                "Operation Red Deer",
                "Operation Roma225"
            ],
            "source_name": "ETDA:Aggah",
            "tools": [
                "AgenTesla",
                "Agent Tesla",
                "AgentTesla",
                "Aggah",
                "Atros2.CKPN",
                "Bladabindi",
                "Jorik",
                "Nancrat",
                "NanoCore",
                "NanoCore RAT",
                "Negasteal",
                "Origin Logger",
                "Revenge RAT",
                "RevengeRAT",
                "Revetrat",
                "Warzone",
                "Warzone RAT",
                "ZPAQ",
                "Zurten",
                "njRAT"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535578,
    "ts_updated_at": 1743041533,
    "ts_creation_date": 1653752666,
    "ts_modification_date": 1653752666,
    "files": {
        "pdf": "https://archive.orkl.eu/2e2a5bcd407d104fce7aeb82781e189ae668af01.pdf",
        "text": "https://archive.orkl.eu/2e2a5bcd407d104fce7aeb82781e189ae668af01.txt",
        "img": "https://archive.orkl.eu/2e2a5bcd407d104fce7aeb82781e189ae668af01.jpg"
    }
}