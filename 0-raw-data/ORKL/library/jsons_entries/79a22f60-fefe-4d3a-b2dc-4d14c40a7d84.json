{
    "id": "79a22f60-fefe-4d3a-b2dc-4d14c40a7d84",
    "created_at": "2023-01-12T15:05:05.261737Z",
    "updated_at": "2025-03-27T02:09:29.738093Z",
    "deleted_at": null,
    "sha1_hash": "dfe7b9fa73befaf6f5aade94e13c3dc2143e824f",
    "title": "2021-11-11 - Is SquirrelWaffle the New Emotet- How to Detect the Latest MalSpam Loader",
    "authors": "",
    "file_creation_date": "2022-05-28T03:32:21Z",
    "file_modification_date": "2022-05-28T03:32:21Z",
    "file_size": 749241,
    "plain_text": "# Is SquirrelWaffle the New Emotet? How to Detect the Latest MalSpam Loader\n\n**[sentinelone.com/blog/is-squirrelwaffle-the-new-emotet-how-to-detect-the-latest-malspam-loader/](https://www.sentinelone.com/blog/is-squirrelwaffle-the-new-emotet-how-to-detect-the-latest-malspam-loader/)**\n\nNovember 11, 2021\n\nSince early September, [SentinelLabs has been tracking the rapid rise of a new malware](https://www.sentinelone.com/labs/)\n[loader that previous researchers have dubbed “SquirrelWaffle”. The tool has been utilized in](https://blog.talosintelligence.com/2021/10/squirrelwaffle-emerges.html)\n[multiple global attacks since then and is being likened to Emotet in the way it is being used](https://www.sentinelone.com/blog/emotet-story-of-disposable-c2-servers/)\nto conduct massive malspam campaigns.\n\nIn this post, we explain how SquirrelWaffle works, what to look out for and how to protect\nyour business from the latest malspam loader.\n\n\n-----\n\n## What Is SquirrelWaffle Malware?\n\nSquirrelWaffle is a recent malware loader that is distributed through malspam – malicious\nspam mail – with the purpose of infecting a device with second-stage malware such as\n[cracked copies of the red teaming tool Cobalt Strike and QakBot, a well-known malware that](https://www.sentinelone.com/labs/hotcobalt-new-cobalt-strike-dos-vulnerability-that-lets-you-halt-operations/)\nstarted life as a simple banking trojan but has since evolved into a multi-functional framework\nwith RAT (Remote Access Trojan)-like capabilities.\n\n[Researchers have noted how the infection chain may begin with an email reply chain attack,](https://www.sentinelone.com/blog/email-reply-chain-attacks-what-are-they-how-can-you-stay-safe/)\nin which a threat actor neither inserts themselves as a new correspondent nor attempts to\nspoof someone else’s email address. Instead, the attacker sends the malicious\nSquirrelWaffle email from a hijacked account belonging to one of the participants. Since the\nattacker has access to the whole thread, they can tailor their malspam message to fit the\ncontext of an ongoing conversation. Given that the recipient likely already trusts the sender,\nthere’s an increased likelihood of the target opening the maldoc or clicking the link. Email\n[reply chain attacks were a hallmark of Emotet campaigns and contributed a great deal to its](https://www.sentinelone.com/blog/inside-emotet-banking-trojan-malware-distributor/)\nsuccess.\n\nSquirrelWaffle first appeared in early September and defenders have noticed an uptick in\n[incidences of infection since then. SentinelLabs researchers have also noticed that the](https://sentinelone.com/labs)\nmalware drops unique payloads even from the same infection chain and that file path\npatterns are continuing to evolve.\n\n## How Does SquirrelWaffle Infect Devices?\n\n\n-----\n\nInitial delivery of SquirrelWaffle as a first stage loader often comes courtesy of a phishing\nemail with either a malicious MS Word or Excel attachment or embedded link leading to a\nzip-compressed malicious document download. These maldocs contain VBS macros which\n[execute PowerShell to retrieve and launch the SquirrelWaffle loader.](https://www.sentinelone.com/cybersecurity-101/windows-powershell/)\n\nThe initial SquirrelWaffle files are written to disk as prescribed by the malicious PowerShell\nscript responsible for their retrieval. For example, early clusters of malicious documents\ndropped SquirrelWaffle using this set of file names:\n```\nC:\\Datop\\test.test\nC:\\Datop\\test1.test\nC:\\Datop\\test2.test\n\n```\nSquirrelWaffle infection following the launch of a poisoned Excel file\nImportantly, no two runs of the same malicious document will produce the same\nSquirrelWaffle payloads. On each execution, the payloads written to disk will have unique\n[hashes.](https://www.sentinelone.com/blog/what-is-hash-how-does-it-work/)\n```\n\"C:\\Users\\<redact>\\AppData\\Local\\Temp\\Temp1_natusut-1501184.zip\\grade-2086577786.xls\"\nC:\\Datop\\test.test - 8d7089f17bd5706309d7c6986fdd1140d6c5b4b2\nC:\\Datop\\test1.test - 52452f6f0ab73531fe54935372d9c34eb50653d8\n\"C:\\Users\\<redact>\\OneDrive - folder, Inc\\Desktop\\grade-2086577786.xls\"\nC:\\Datop\\test.test - bce0e9e1c6d2e7b12648ef316748191f10ed8582\nC:\\Datop\\test1.test - 8ba7694017d1cea1d4b73f39479726478df88b20\n\"C:\\Users\\\\OneDrive - folder, Inc\\Desktop\\grade-2086577786.xls\"\nC:\\Datop\\test.test - 8aec96029b83d3b226c8c83dd90f48946ee97001\nC:\\Datop\\test1.test - 8262cd7029f943a7b6199b5a6c51ec19e085c3b7\n\n```\nSquirrelWaffle has been observed using more conventional file name patterns as well, such\nas those with `.dll extensions:`\n\n\n-----\n\n```\n     ww1.dll\n     ww2.dll\n     ww3.dll\n     ww4.dll\n     ww5.dll\n\n```\nIn early November, we observed yet another pattern, indicating that the malware authors are\ncontinually iterating:\n```\n     good.good\n     good1.good\n     good2.good\n\n## SquirrelWaffle Shares Code With Other Attack Frameworks\n\n```\nSquirrelWaffle, in common with many other malware samples, uses a custom crypter. Doing\nso is attractive for many reasons, not the least of which are obfuscation and anti-analysis to\nprevent researchers from developing strong indicators of compromise for detection.\n\n\n-----\n\n[Researchers have shown that SquirrelWaffle uses the same custom crypter as other well-](https://elis531989.medium.com/the-squirrel-strikes-back-analysis-of-the-newly-emerged-cobalt-strike-loader-squirrelwaffle-937b73dbd9f9)\nknown attack frameworks including Ursnif, Hancitor and Zloader. This is used, among other\nthings, to hide the malware’s Command and Control (C2) URL.\n\nUpon infection, SquirrelWaffle can download a Cobalt Strike payload with `.txt extension`\nand execute using the `WinExec function. The other likely payload that may be downloaded`\nby current SquirrelWaffle infections is [Qakbot.](https://www.sentinelone.com/blog/the-good-the-bad-and-the-ugly-in-cybersecurity-week-35-2/)\n\nBelow we can see process injection into `explorer.exe from a SquirrelWaffle infection.`\n\nIf infected with Qakbot, the malware will attempt to extract email data from the host.\n\nFrom the above image, we can see the `C:\\Users\\`\n```\n<user>\\EmailStorage_<hostname>_<username>_<timestamp> pattern. The\n\n```\n“collector_log.txt” contains a record of the malware’s enumeration and exfiltration process.\n\n## How To Protect Against SquirrelWaffle\n\nThe [SentinelOne platform detects and protects all customers against SquirrelWaffle infection.](https://www.sentinelone.com/platform/)\nIn the video demonstration below, we set the agent policy to ‘Detect Only’ to observe the\n[infection in action In ordinary circumstances customers would use the Protect policy to](https://www.youtube.com/watch?v=mvzeP0yNVfs)\n\n\n-----\n\nprevent execution.\n\nhttps://youtu.be/vdVfzu9M8G8\n\n## Conclusion\n\n\nWatch Video At:\n\n\nCybercriminals are quick to come up with new loaders to team up with other groups that will\nhelp deliver a variety of payloads to achieve maximum financial gain. SquirrelWaffle is the\nlatest such loader, currently being used to deliver Cobalt Strike and Qakbot but which can\neasily pivot to dropping any payload the operators wish. While SquirrelWaffle is certainly not\nyet anywhere near as prevalent as Emotet in its heyday, all the hallmarks are there of a\ncampaign and infrastructure looking to grow.\n\n[If you would like to know more about how SentinelOne can protect your business against](https://www.sentinelone.com/platform/)\nSquirrelWaffle and other threats, [contact us for more information or request a free demo.](https://www.sentinelone.com/contact/)\n\n## Example SHA1 Hashes\n\n8d7089f17bd5706309d7c6986fdd1140d6c5b4b2\n52452f6f0ab73531fe54935372d9c34eb50653d8\nbce0e9e1c6d2e7b12648ef316748191f10ed8582\n8ba7694017d1cea1d4b73f39479726478df88b20\n8aec96029b83d3b226c8c83dd90f48946ee97001\n8262cd7029f943a7b6199b5a6c51ec19e085c3b7\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-11-11 - Is SquirrelWaffle the New Emotet- How to Detect the Latest MalSpam Loader.pdf"
    ],
    "report_names": [
        "2021-11-11 - Is SquirrelWaffle the New Emotet- How to Detect the Latest MalSpam Loader.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "b69037ec-2605-4de4-bb32-a20d780a8406",
            "created_at": "2023-01-06T13:46:38.790766Z",
            "updated_at": "2025-03-27T02:00:02.919758Z",
            "deleted_at": null,
            "main_name": "MUSTANG PANDA",
            "aliases": [
                "TEMP.HEX",
                "TA416",
                "TANTALUM",
                "Twill Typhoon",
                "Earth Preta",
                "Stately Taurus",
                "LuminousMoth",
                "Polaris",
                "BRONZE PRESIDENT",
                "HoneyMyte",
                "Red Lich"
            ],
            "source_name": "MISPGALAXY:MUSTANG PANDA",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "9baa7519-772a-4862-b412-6f0463691b89",
            "created_at": "2022-10-25T15:50:23.354429Z",
            "updated_at": "2025-03-27T02:00:55.45162Z",
            "deleted_at": null,
            "main_name": "Mustang Panda",
            "aliases": [
                "Mustang Panda",
                "TA416",
                "RedDelta",
                "BRONZE PRESIDENT"
            ],
            "source_name": "MITRE:Mustang Panda",
            "tools": [
                "Cobalt Strike",
                "RCSession",
                "NBTscan",
                "PoisonIvy",
                "PlugX"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "2ee03999-5432-4a65-a850-c543b4fefc3d",
            "created_at": "2022-10-25T16:07:23.882813Z",
            "updated_at": "2025-03-27T02:02:10.0116Z",
            "deleted_at": null,
            "main_name": "Mustang Panda",
            "aliases": [
                "Bronze President",
                "Camaro Dragon",
                "Earth Preta",
                "HoneyMyte",
                "Mustang Panda",
                "Operation SMUGX",
                "Operation SmugX",
                "PKPLUG",
                "Red Lich",
                "Stately Taurus",
                "TEMP.Hex"
            ],
            "source_name": "ETDA:Mustang Panda",
            "tools": [
                "9002 RAT",
                "AdFind",
                "Agent.dhwf",
                "Agentemis",
                "CHINACHOPPER",
                "China Chopper",
                "Chymine",
                "ClaimLoader",
                "Cobalt Strike",
                "CobaltStrike",
                "DCSync",
                "DOPLUGS",
                "Darkmoon",
                "Destroy RAT",
                "DestroyRAT",
                "Farseer",
                "Gen:Trojan.Heur.PT",
                "HOMEUNIX",
                "Hdump",
                "HenBox",
                "HidraQ",
                "Hodur",
                "Homux",
                "HopperTick",
                "Hydraq",
                "Impacket",
                "Kaba",
                "Korplug",
                "LadonGo",
                "MQsTTang",
                "McRAT",
                "MdmBot",
                "Mimikatz",
                "NBTscan",
                "NetSess",
                "Netview",
                "Orat",
                "POISONPLUG.SHADOW",
                "PUBLOAD",
                "PVE Find AD Users",
                "PlugX",
                "Poison Ivy",
                "PowerView",
                "QMAGENT",
                "RCSession",
                "RedDelta",
                "Roarur",
                "SPIVY",
                "ShadowPad Winnti",
                "SinoChopper",
                "Sogu",
                "TIGERPLUG",
                "TONEINS",
                "TONESHELL",
                "TVT",
                "TeamViewer",
                "Thoper",
                "TinyNote",
                "WispRider",
                "WmiExec",
                "XShellGhost",
                "Xamtrav",
                "Zupdax",
                "cobeacon",
                "nbtscan",
                "nmap",
                "pivy",
                "poisonivy"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535905,
    "ts_updated_at": 1743041369,
    "ts_creation_date": 1653708741,
    "ts_modification_date": 1653708741,
    "files": {
        "pdf": "https://archive.orkl.eu/dfe7b9fa73befaf6f5aade94e13c3dc2143e824f.pdf",
        "text": "https://archive.orkl.eu/dfe7b9fa73befaf6f5aade94e13c3dc2143e824f.txt",
        "img": "https://archive.orkl.eu/dfe7b9fa73befaf6f5aade94e13c3dc2143e824f.jpg"
    }
}