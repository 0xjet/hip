{
    "id": "f29f35ff-0c0c-4b9b-a331-b128a0d16f58",
    "created_at": "2023-01-12T15:08:41.468663Z",
    "updated_at": "2025-03-27T02:05:56.230751Z",
    "deleted_at": null,
    "sha1_hash": "a2617ac2b33c4c3527cc2e082c2ebff88b43597a",
    "title": "2020-08-10 - ClipBanker Trojan - A 13-Second Attack",
    "authors": "",
    "file_creation_date": "2022-05-28T15:36:36Z",
    "file_modification_date": "2022-05-28T15:36:36Z",
    "file_size": 5572479,
    "plain_text": "# Threat Research Report: Clipbanker – 13 Second Attack\n\n**[cynet.com/attack-techniques-hands-on/threat-research-report-clipbanker-13-second-attack/](https://www.cynet.com/attack-techniques-hands-on/threat-research-report-clipbanker-13-second-attack/)**\n\nWritten by: Max Malyutin\n\nEXECUTIVE SUMMARY\n\nIn this article, the Cynet Research team reveals a highly complex attack that runs for only 13 seconds by\nusing several malwares and different tactics. From our analysis, the threat that we discovered within our\ninvestigation is name the “ClipBanker” trojan.\n\nThe attack flow contains several stages of LOLBins (Living Off the Land) abuse, masquerading, persistency,\nenumeration techniques, credential thieving, fileless attacks, and finally banking trojan activities.\n\nThis attack is also using Fileless techniques in order to evade from security detections. Fileless attack has\nbeen a growing threat since 2017 and require highly sophisticated detection and prevention tools to detect\nand block. The most common Windows tools used in “Fileless” attacks are PowerShell, JS, VBA and WMI.\nPowerShell is a highly popular tool used for Fileless attack, because PowerShell commands can be executed\nnatively on Windows without writing data to disk.\n\nThe ClipBanker Trojan is known as an information stealer and spy trojan, it aims to steal and record any type\nof sensitive information from the infected environment such as browser history, cookies, Outlook data, Skype,\nTelegram, or cryptocurrency wallet account addresses. The main goal of this threat is to steal confidential\ninformation.\n\nThe ClipBanker uses PowerShell commands for executing malicious activities. The thing that made the\nClipBanker unique is its ability to record various banking actions of the user and manipulate them for its own\nbenefit.\n\n\n-----\n\nThe distribution method of the ClipBanker is through phishing emails or through social media posts that lure\nusers to download malicious content.\n\n**Cynet 360 is protecting your assets against this type of exploit.**\n\nMITRE ATT&CK\n\nThe attack flow that is described below contains several known MITRE tactics and techniques.\n\nThe strategic goal of the attacker is to steal information. However, in order to do it, the attacker must go\nthrough several steps to complete his malicious activity and successfully gain access to the sensitive data\nfrom the compromised environment.\n\nIn this case, the attacker begins with trying to gain Initial Access (TA0001) to the victim’s environment, in\norder to gain an initial foothold on the victim machine. Then, they will use several tactics such as Execution\n**_(TA0002), in order to execute the malicious code, and Persistency (TA0003), in order to gain persistency on_**\nthe victim system.\n\nThe attackers will often need to gain access to the victim’s system in order to keep the malicious activity going\nand to gain access to sensitive information from the infected environment. Such sensitive information includes\nbrowser history, cookies, Outlook data, Skype, Telegram, or cryptocurrency wallet account addresses. The\nattackers will then need to accomplish the Collection (TA0009) tactic. This means that the attacker will need\nto use a Defense Evasion (TA0005) tactics to bypass security application systems from detecting the\nmalicious activity. In order to establish a connection, the attacker will also use a Command and Control\n**_(TA0011) tactics to receive instruction commands from a remote server and keep preforming the attack flow._**\n\n\n-----\n\n_._\n\n13 SECONDS ATTACK FLOW:\n\n**Attack started at 7:47:43.000 PM:**\n\n**First Trojan Downloader:**\n\nCynet 360 platform has detected a Trojan Downloader. A downloader is a program that downloads another\nmalware component from the network by connecting to a Command and Control server.\n\nThe Trojan Downloader was detected as a child process of RegAsm.exe binary. RegAsm is the Assembly\nRegistration tool that reads the metadata within an assembly and adds the necessary entries to the registry,\nwhich allows COM clients to create .NET Framework classes transparently (Microsoft Developer Network).\nRegAsm (LOLBin) can be used to perform malicious actions such as PE file execution in order to bypass\nsecurity applications.\n\n\n-----\n\nAs you can see in the screenshot below – Cynet has detected EguiProxy.exe (the Trojan Downloader) that\nwas launched by RegAsm.exe (LOLBin):\n\n**First Downloader: EguiProxy.exe**\n**MD5: f70428c34a100f9b3a6dbe58aea05def**\n**SHA-1: 9dd57f78f6f488bc7e96b592a7201040049f4933**\n**SHA-256: 4a471f05c7624238ef374bbf3af4eeb2abc20f87579ecdbeefea61356e23ae69**\n**SSDEEP:**\n\n96:Iz3j1+n7W7AtmLykrFVEODJtutwc79LaB+UMWmLgt3x3kJ+iGczNt:mQ74OhkphDEwq9LaB+UMWmLgt32gm\n\n**Second Trojan Downloader:**\n\nThen, the Trojan Downloader downloads another malware from “hxxp://bzqopgtera[.]xyz/” that will be used as\nan Injector/Downloader and will execute a new malware from \\AppData\\Local\\Temp\\ directory:\n\n**Second Downloader: 1849226900.exe**\n**MD5: e5e13f095613837ff741cf9fb2b68eb0**\n\n\n-----\n\n**SHA-1: e7b63fbd6dc176fa29e208dc1de083c882a6ef01**\n**Sha256: 1f0ddf5088ac75862fe1d1c4f11f9c39645eee1e4acc938a1f66f14dfc5d5288**\n**SSDeep:**\n\n12288:D9ciEWzp4fqhCC77upiLcRGjbWWkKkc9Tm4RtxQBWUX2Fqmvu5UshghN:3jcqhJipiwojbWWkY9Tjm2eyh\n\nThe second downloader also initiated a network communication to the same Command and Control server as\nmentioned above (the same C&C of the first downloader).\n\nThe main purpose of this second trojan is to execute a malicious PowerShell command by running CMD.exe.\nIt is worth mentioning that the cmd.exe instance was executed from syswow64 directory. This kind of activity is\nsimilar with many other malicious activities the Cynet Research has investigated recently. The CMD instance\nhad run with /c argument (which allows the CMD to run and terminate immediately thereafter) in order to\nexecute the malicious PowerShell command described below.\n\nThe PowerShell command had ran with the following parameters:\n\n**-w 1 – WindowStyle Hidden, hide the PowerShell window.**\n**-e – EncodedCommand, allow to encode the command with base 64 format.**\n\nAfter decoding the malicious PowerShell base64 command, we have figured that the attack switched from filebased attack to a Fileless attack. In the screenshot below, you may see that the command contains two\ninteresting parts:\n\n\n-----\n\n1. The first part of the PowerShell command is the $thdTask variable, which contains another base64\n\nstring. After encoding the base 64 command, we got the following command:\n\nThe above command is using “System.Net.WebClient” and “DownloadString” to initiate network connectivity to\ngitlab.com (hxxps://gitlab[.]com/UL9gbzuP37/rt/snippets/1956305/raw) and to download the cs.exe file to\n\\temp\\ directory.\n\nWhen trying to access the malicious URL, we saw that it contains a large base64 string, as you can see\nbelow:\n\nAfter decoding the base64 string, we have figured that the base64 string is basically a PE file (an MZ file) that\nwill be downloaded to $env:temp (environment variable of the TEMP directory\n_C:\\Users\\user\\AppData\\Local\\Tem) the payload as “cs.exe”:_\n\n_[IO.File]::WriteAllBytes(“$env:temp\\cs.exe”, [Convert]::FromBase64String($base64string))_\n\nFinally, the payload executes by start-process command.\n\n_start-process “$env:temp\\cs.exe”_\n\n\n-----\n\nIn order to understand the malicious purpose of this payload we have to deep dive and analyze it by static and\ndynamic analysis.\n\n1. The second part of the command sets a new value to the “HKCU\\Sofatwarte\\cr” registry key – which is\n\nfurther described in the technical analysis\n\n**Technical Analysis**\n\nAfter downloading and investigating the cs.exe (the payload we extracted above), we have concluded that this\npayload is the said Trojan Banker that aims to steal banking data from infected machines.\n\n\n-----\n\n**File name: cs.exe**\n**MD5: 884da153fa3617c79a67b1941e4493ed**\n**SHA-1: e1346bc15d103f0bb96d3f93a1a042f030134c8b**\n**Sha256: e09013a2ac876746a5143f8ee8f997b06688b71adc05ddb81aeb9a1a69fa6f88**\n**SSDeep:**\n6144:Y4lCfqy7+mdXzEQj0oFIxRr4VsXR7P9/Z2Q+5AOh1faY:zlCfqy7+mdXzEQnYr4VsXRFf+5xaY\n\n**Static analysis**\n\nThe Trojan Banker’s static metadata and history (from VirusTotal.com)\n\nFrom the static analysis of the cs.exe payload we have found some hints about the malicious activity and\nbasic functionality that it will soon execute and use on the compromised environment.\n\nThe following screenshot of the malicious file can show that the sections of the files are not packed or\n\nencrypted. We can also see the assembly code and start figuring out the malicious context and purpose of this\nTrojan Banker:\n\n\n-----\n\nThe first step in understanding the functionality of the payload, then will be to check the imports and\n\nthe API calls that have been used by the payload.\n\nThe main functions that we discovered are:\n\n**CreateProcess: this function allows the attacker to create a new process and its primary thread. The**\nnew process runs in the security context of calling the process. Most of the time, the attackers will use\nthis API call to execute the malicious process:\n\n**CreateDirectory: this function allows the attacker to create a new directory. If the underlying file system**\nsupports security on files and directories, the function applies a specified security descriptor to the new\ndirectory. Usually, the attackers will use this API call to create the directory where the\n\nmalicious component will be stored in order to gain persistency on the victim’s host.\n\n\n-----\n\n**WriteFile: this function allows the attacker to write data to the specified file or input/output (I/O) device.**\nUsually, the adversaries will use this API call to create (write) a malicious file component. It also can be\nused for persistency and post-exploitation methods.\n\n**GetCommandLine: this function allows the attacker to retrieve the command-line string for the current**\nprocess. Attackers use this API call to execute (run command line) malicious code. It can also be used\nfor Fileless and post-exploitation methods.\n\n\n-----\n\nAll the above-mentioned API calls are associated with Kerenel32.dll. This DLL exports functions\n\nthat relate to filesystem operations, hardware, and processes.\n\nThe next interesting functionality that is used by the below API functions implies that the attacker may have\nthe ability to hook, record, and steal the clipboard data which can contains sensitive information (usernames,\npasswords, etc.). The attacker used USER.DLL to perform a keyboard monitoring (keylogging).\n\nThe final API function that we have covered in this section is the GetUserName function that can be used by\nthe attacker for enumeration and discovering actions.\n\n\n-----\n\nAfter discovering and understanding the functionality of the cs.exe payload, we have exported the strings from\nthe payload. The stings are good indicators for the malicious actions that the malware will perform, which will\neventually lead us to new hints about the attack stages of the Trojan Banker:\n\nThe main stings we have investigated are the following:\n\nCreation of a new file (hysvc.exe) in the ProgamData directory (this file is created by using WinAPI).\nManipulation of the StartUp directory (can be used for persistence).\n\n\n-----\n\nExecution of CMD.\nCreation of Scheduled Task (can be used for Persistence) to run the new hysvc.exe file.\nCreation of LNK file that is linked to the new hysvc.exe file.\nExecution of a base64 PowerShell command.\n\nIn order to understand the above-mentioned strings, we looked at the assembly code by using IDA.\n\nThe first block containing an interesting offset that was discovered and analyzed is the aCProgramdataHy that\nis associated with the new payload that will be created in the ProgamData directory.\n\nThe second block showed a few other interesting offsets:\n\naCMDCTimeoutT4\naCMDSchtaskFC\naMKlinkCProgram\naPowershellW1Ex\n\n\n-----\n\nThe aCMDCTimeoutT4 offset contains a CMD command line that run a “timeout /t 4” that pauses the\ncommand processor for 4 seconds before launching the CMD process again. This defense evasion technique\nis being used to prevent any detection by security application and traditional Anti-Virus vendors.\n\nThe aCMDSchtaskFC offset contains another CMD command line that will run a “schtasks” for creating a\n\nscheduled task on the compromised host. The name of the schedule task will be “GoogleChromUpdateTask”\n(/tn – taskname ) and the task is scheduled to run hysvc.exe every 1 hour (/sc – schedule).\n\n\n-----\n\nThe aMKlinkCProgram offset contains a _mklink command that will create a link (.LNK) file in the StartUp_\n\ndirectory that will be linked to the hysvc.exe file.\n\nThe aPowershellW1Ex offset contains a base64 PowerShell command that will be executed by the main\npayload (cs.exe).\n\nAfter preforming a static analysis and code analysis we wil know move to execute the cs.exe payload and\npreform a Dynamic/Behavior analysis.\n\n**Behavior Analysis**\n\nOnce we launched the payload, we immediately saw the following process tree:\n\nAs we learned from the static analysis, the CreateProcess API function will execute a CMD instance\n\nand create a scheduled task:\n\nCMD Timeout command:\n\nschtasks command:\n\n\n-----\n\nIn order to gain persistency on the compromised host the attacker created a schedule task in the Task\nScheduler. Moreover, the attacker tried to masquerade it with a legitimate name of “GoogleChromUpdateTask”\nas we can see in the screenshot below:\n\nThe task information shows that it run the file every 3 hours:\n\nThe CreateFile and CreateDirectory functions create a new payload (hysvc.exe) in the PrgramData directory:\n\n\n-----\n\nAfter checking the hash of the new hysvc.exe payload, we have found that it is the same file as the original\ncs.exe payload. Thus, the initial trojan just copied itself to a new location:\n\nAfter creating the second payload (hysvc.exe) and a scheduled task to run this payload, the initial payload\n(cs.exe) is launching PowerShell in order to run an encoded malicious command:\n\n\n-----\n\nThe decoded command, as shown above, has used a Com-Object of “Wscript.Shell” to create a shortcut file\n\n(LNK) in the StartUp directory which is linked to the hysvc.exe payload. This is basically an attempt to use a\nsecond persistence technique for the payload to run every time the victim reboots the compromised\n\nmachine, by automatically executing the LNK file from the startup:\n\n_“AppData\\Romming\\Microsoft\\Windows\\Start Menu\\Programs\\StartUp”_\n\n\n-----\n\nThe LNK file is linked to the trojan Banker (hysvc.exe) which is now located in the ProgramData directory.\n\nMemory context of the payload:\n\n\n-----\n\nAfter we finished the investigation and analyzed the trojan banker, we can go back to the second part of the\nfirst PowerShell Command.\n\nThe second part of the command sets a new value to the “HKCU\\Sofatwarte\\cr” registry key that related\n\nto the $thTask variable which contains the binary of the trojan Banker that we have analyzed above.\n\nIt also creates a scheduled task with CMD instance and named it “Update Shell”. The task will execute the\nPowerShell command in base 64 format.\n\nAfter decoding the base 64 command, we have figured that it will invoke the “HKCU\\Sofatwarte\\cr” value\n\nwhich means that the trojan Banker’s binary (hysvc.exe) will be executed by the PowerShell command directly\nfrom the registry:\n\nIn parallel, the downloader “1849226900.exe” which was responsible for downloading the main payload\n(cs.exe), executes another CMD instance in order to execute an additional PowerShell command:\n\n\n-----\n\nAfter decoding the PowerShell command, we discovered the following:\n\nThe first part is the $K variable that contains a base 64 command.\n\nAfter decoding the command, we see that it launchs a pure fileless attack that run from the PowerShell virtual\nmemory. The command initiates network communication to the following URL:\n“hxxps://asq.d6shiiwz[.]pw/win/ins/checking[.]ps1” in order to invoke the content of the “checking.ps1” script.\nThis activity happened by the IEX (Invoke-Expression) cmdlet that executes the content of the PS1 file by\nusing the DownladString method.\n\nUnfortunately, the URL nolonger exists and when we have tried to access the URL, we get no response:\n\n\n-----\n\nIn order to verify that the malicious URL does not exist, we have tried to run a CURL command. In some of the\ncases attacker can fake the HTML page to show no response, while there is active communication to the\nmalicious domain.\n\nIn the second part of the PowerShell command, it sets a new value in the “HKCU:\\Sofatware” registry key. The\nvalue name is “kumi” and it contains the $k variable, which means it will execute the malicious PS1 script\ncontent.\n\nFurthermore, it will create a schedule task named: “OneDrive SyncTask”. The task will execute a PowerShell\ncommand.\n\nIn order to understand what the purpose of the command, we have decoded the base 64 command:\n\nThe command simply executes by the IEX cmdlet the kumi value which contain the malicious PS1 script.\n\n**Attack ended at 7:47:56.000 PM (13 seconds after it executed)**\n\n## INDICATORS OF COMPROMISE\n\n**Type** **Indicator**\n\nRegistry _HKCU:\\Sofatware (value – Kumi)_\n_HKCU\\Sofatwarte\\cr_\n\nSchedule Task _OneDrive SyncTask_\n_GoogleChromUpdateTask_\n\n_Update Shell_\n\nSHA256 4a471f05c7624238ef374bbf3af4eeb2abc20f87579ecdbeefea61356e23ae69\n1f0ddf5088ac75862fe1d1c4f11f9c39645eee1e4acc938a1f66f14dfc5d5288\n\ne09013a2ac876746a5143f8ee8f997b06688b71adc05ddb81aeb9a1a69fa6f88\n\n\n-----\n\nURL _hxxps://asq.d6shiiwz[.]pw/win/ins/checking[.]ps1_\n_hxxps://gitlab[.]com/UL9gbzuP37/rt/snippets/1956305/raw_\n\nhxxp://bzqopgtera[.]xyz/\n\nConclusion\n\nThe Cynet Research Team has analyzed and investigated different threats and malware using various tools\nand techniques. Cynet’s seasoned security experts are familiar with the newest attacks vectors and\ntechniques that exist in the wild.\n\nCynet 360 customers are fully protected from these kinds of threats and have full visibility over their protected\nassets. Cynet has various behavioral and heuristics capabilities designed to detect and prevent advanced\nthreats like the one described in this report.\n\nThe Cynet 360 solution gives our customers the ability to control and manage cyber security incidents, to\nperform forensic analysis on infected environments, and to run remote actions on the infected hosts in order to\nmitigate the threat. On top of that, we have our CyOps team which is monitoring our customers’ environments\n24/7/365.\n\n## Contact Cynet CyOps\n (Cynet Security Operations Center)\n\nThe Cynet CyOps available to clients for any issues 24/7, questions or comments related to Cynet 360. For\nadditional information, you may contact us directly at:\n\nPhone (US): +1-347-474-0048\n\nPhone (EU): +44-203-290-9051\n\nPhone (IL): +972-72-336-9736\n\nCyOps Email: [[email protected]](https://www.cynet.com/cdn-cgi/l/email-protection#cab9a5a98aa9b3a4afbee4a9a5a7)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-08-10 - ClipBanker Trojan - A 13-Second Attack.pdf"
    ],
    "report_names": [
        "2020-08-10 - ClipBanker Trojan - A 13-Second Attack.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536121,
    "ts_updated_at": 1743041156,
    "ts_creation_date": 1653752196,
    "ts_modification_date": 1653752196,
    "files": {
        "pdf": "https://archive.orkl.eu/a2617ac2b33c4c3527cc2e082c2ebff88b43597a.pdf",
        "text": "https://archive.orkl.eu/a2617ac2b33c4c3527cc2e082c2ebff88b43597a.txt",
        "img": "https://archive.orkl.eu/a2617ac2b33c4c3527cc2e082c2ebff88b43597a.jpg"
    }
}