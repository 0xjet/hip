{
    "id": "01a9f868-a5cf-4689-965b-34f6ad573ca7",
    "created_at": "2023-01-12T15:03:05.232106Z",
    "updated_at": "2025-03-27T02:05:53.267444Z",
    "deleted_at": null,
    "sha1_hash": "ccd2911d8bfad97130dcdf212a5ecdc26b076bbd",
    "title": "2020-12-09 - njRAT Spreading Through Active Pastebin Command and Control Tunnel",
    "authors": "",
    "file_creation_date": "2022-05-28T03:33:54Z",
    "file_modification_date": "2022-05-28T03:33:54Z",
    "file_size": 693279,
    "plain_text": "# njRAT Spreading Through Active Pastebin Command and Control Tunnel\n\n**[unit42.paloaltonetworks.com/njrat-pastebin-command-and-control](https://unit42.paloaltonetworks.com/njrat-pastebin-command-and-control)**\n\nYanhui Jia, Chris Navarrete, Haozhe Zhang December 9, 2020\n\nBy [Yanhui Jia,](https://unit42.paloaltonetworks.com/author/yanhui-jia/) [Chris Navarrete and](https://unit42.paloaltonetworks.com/author/chris-navarrete/) [Haozhe Zhang](https://unit42.paloaltonetworks.com/author/haozhe-zhang/)\n\nDecember 9, 2020 at 6:00 AM\n\n[Category: Malware,](https://unit42.paloaltonetworks.com/category/malware-2/) [Unit 42](https://unit42.paloaltonetworks.com/category/unit-42/)\n\nTags: [C2,](https://unit42.paloaltonetworks.com/tag/c2/) [command and control,](https://unit42.paloaltonetworks.com/tag/command-and-control/) [Cybercrime,](https://unit42.paloaltonetworks.com/tag/cybercrime/) [Evasion,](https://unit42.paloaltonetworks.com/tag/evasion/) [exploit,](https://unit42.paloaltonetworks.com/tag/exploit/) [NJRat,](https://unit42.paloaltonetworks.com/tag/njrat/) [Pastebin](https://unit42.paloaltonetworks.com/tag/pastebin/)\n\nThis post is also available in: 日本語 [(Japanese)](https://unit42.paloaltonetworks.jp/njrat-pastebin-command-and-control/)\n\n## Executive Summary\n\nIn observations collected since October 2020, Unit 42 researchers have found that malware\nauthors have been leveraging njRAT (also known as Bladabindi), a Remote Access Trojan,\nto download and deliver second-stage payloads from Pastebin, a popular website that is\nwell-known to be used to store data anonymously. Attackers are taking advantage of this\nservice to post malicious data that can be accessed by malware through a shortened URL,\nthus allowing them to avoid the use of their own command and control (C2) infrastructure\nand therefore increasing the possibility of operating unnoticed.\n\n\n-----\n\nIn this blog, we will introduce different scenarios and data transformations that we have\nfound in the wild, and describe the relationship between the downloader component and its\nsecond-stage malware.\n\n[Palo Alto Networks Next-Generation Firewall customers are protected from njRAT with](https://www.paloaltonetworks.com/network-security/next-generation-firewall)\n[Threat Prevention and](https://www.paloaltonetworks.com/products/secure-the-network/subscriptions/threat-prevention) [WildFire security subscriptions. Customers are also protected with](https://www.paloaltonetworks.com/products/secure-the-network/wildfire)\n[Cortex XDR.](https://www.paloaltonetworks.com/cortex/cortex-xdr)\n\n## Active Pastebin C2 Tunnel\n\nPastebin's C2 tunnel is actively used by attackers as a hosting service for malicious payloads\nthat can be downloaded by keyloggers, backdoors or Trojans.\n\nThe hosted data differs in its form and shape. The different data encodings and\ntransformations that can be found include traditional base64 encoding, hexadecimal and\nJSON data, compressed blobs, and plain-text data with embedded malicious URLs. It is\nbelieved that this use of Pastebin is intended to evade detection by security products.\n\nIn the following sections, we will introduce different scenarios and data transformations that\nwe have found in the wild, and describe the relationship between the downloader component\nand its second-stage malware.\n\n## Second-Stage Malware Dropped by base64 Encoding Response\n\nDownloader: 91f4b53cc4fc22c636406f527e3dca3f10aea7cc0d7a9ee955c9631c80d9777f\nSecond-stage:\n492ea8436c9a4d69e0a95a13bac51f821e8454113d4e1ccd9c8d903a070e37b2\nSource URL: hxxps://pastebin[.]com/raw/VbSn9AnN\n\nThe downloader\n(91f4b53cc4fc22c636406f527e3dca3f10aea7cc0d7a9ee955c9631c80d9777f) requests\nPastebin C2 data and uses the less evasive version of stored data, which corresponds to\ntraditional base64 encoding.\n\nbase64: Encoded data base64: Decoded / Binary dumped\n\n_f_ _f_\n\n\n-----\n\nOnce decoded, the final payload is revealed as a 32-bit .NET executable, which makes use\nof several Windows API functions including GetKeyboardState(), GetAsynckeyState(),\nMapVirtualKey(), etc. These are commonly used by keyloggers and Trojans, as well as by\nfunctions used to potentially exfiltrate user data. It is also worth noting that the downloader\nand second-stage executables are similar in their functionality and code.\n\nThe following image presents a screen capture of the decompiled code of the second-stage\nsample.\n\nFigure 2. Windows API functions related to keylogger functionalities.\n\n## Second-Stage Malware Dropped by base64 Encoding Reverse Evasion\n\nDownloader: 67cbb963597abb591b8dc527e851fc8823ff22d367f4b580eb95dfad7e399e66\n\nSecond-stage: ffb01512e7357ab899c8eabe01a261fe9462b29bc80158a67e75fdc9c2b348f9\n\nSource URL: hxxps://pastebin[.]com/raw/JMkdgr4h\n\nIn this version, the base64 data was reversed, presumably as a measure to avoid detection\nfor automated systems.\n\nReversed base64 string Transformed base64 data\n\n_Figure 3. base64 encoded reversed string and its transformation to base64 format._\n\n\n-----\n\nAfter proper transformation and decoding of data, the final second-stage 32-bit .NET\nexecutable was found to be a similar sample, which exhibits keylogging and Trojan\ncapabilities as well. Three data transformation layers were required to get the final payload.\n\n## Second-Stage Malware Dropped by ASCII and base64 Response\n\nDownloader: 9ba0126bd6d0c4b41f5740d3099e1b99fed45b003b78c500430574d57ad1ad39\n\nSecond-stage: dfc8bffef19b68cfa2807b2faaf42de3d4903363657f7c0d27435a767652d5b4\n\nSource URL: hxxps://pastebin[.]com/raw/LKRwaias\n\nIn this version, the base64 data was presented in hex characters.\n\nHex encoded string Hex decoded and encoded base64 data\n\n_Figure 4. Hex encoded string and its transformation to base64 format._\n\nAfter proper decoding of Hex and base64 data, the dumped program is also a 32-bit.NET\nexecutable file sharing the same malicious characteristics as the previous example.\n\n## Second-Stage Malware Dropped by base64 Encoded and Compressed Data Response\n\nDownloader: 54cf2d7b27faecfe7f44fb67cb608ce5e33a7c00339d13bb35fdb071063d7654\nSecond-stage:\n96c7c2a166761b647d7588428fbdd6030bb38e5ef3d407de71da657f76b74cac\nSource URL: hxxp://pastebin[.]com/raw/zHLUaPvW\n\nThis 32-bit .NET launcher sample, unlike the others, works with compressed data fetched\nfrom Pastebin.\n\n\n-----\n\nFigure 5. Decompression and execution of base64 compressed data.\nThe downloader performs the following actions:\n\n1. The base64 encoded and compressed data is downloaded by the execution of the\n\nDownloadString() function by passing as an argument, a string that was generated by\nthe concatenation of the variables str, str2, str3 and str4 that form the target URL.\n2. The base64 and compressed data are now decoded by the FromBase64String()\n\nfunction and decompressed by the DecompressGZip() function. The result is an\nexecutable file stored in a byte array in the rawAssembly variable.\n3. Finally, a call to the Load().EntryPoint.Invoke() function is made by passing the\n\nrawAssembly variable to the executable file in memory in order to position itself within\nthe system and release the malicious payload.\n\nThe following picture shows the decompressed 32-bit .NET executable data residing in\nmemory before its execution.\n\nFigure 6. Decompressed second-stage malware in memory.\n\n## Second-Stage Malware Dropped by URL Link Response\n\nDownloader: bd2387161cc077bfca0e0aae5d63820d1791f528feef65de575999454762d617\n\nSecond-stage:\n7754d2a87a7c3941197c97e99bcc4f7d2960f6de04d280071eb190eac46dc7d8\n\nSource URL: hxxp://pastebin[.]com/raw/ZFchNrpH\n\nThis .NET downloader uses the traditional method of grabbing an executable file from a\nremote URL. The target address points to hxxp://textfiles[.]us/driverupdate0.exe.\n\nAccording to VirusTotal, this malware sample was identified by several vendors as malicious.\n\n\n-----\n\nFigure 7. VirusTotal and its detection rate on driverupdate0.exe executable file.\n\n## Configuration File in JSON Response\n\nDownloader: 94e648c0166ee2a63270772840f721ba52a73296159e6b72a1428377f6f329ad\n\nSource URL: hxxps://pastebin[.]com/raw/8DEsZn2y\n\nIn this version, JSON formatted data was used. One of the key names, “downlodLink”\n(misspelled on purpose by the malware author), indicates that the value will be a URL, where\nadditional components can be downloaded. No further information was given regarding the\nobjective of this particular file, but it could potentially be used as a configuration file.\n\n\n-----\n\nFigure 8. Suspected JSON-based malware configuration file.\n\n## Proxy Scraper Dropped by HTML Response\n\nDownloader: 97227c346830b4df87c92fce616bdec2d6dcbc3e6de3f1c88734fe82e2459b88\n\nProxy Scraper.exe:\ne3ea8a206b03d0a49a2601fe210c949a3c008c97e5dbf77968c0d08d2b6c1255\n\nMaterialSkin.dll:\nb9879df15e82c52e9166c71f7b177c57bd4c8289821a65a9d3f5228b3f606b4e\n\nSource URL: hxxps://pastebin[.]com/rw/770qPDMt\n\nThis malware parses the HTML page in order to get the link to prepare for further attacks.\nFor this particular sample, Pastebin data is used to provide links for software downloads.\n\nFigure 9. Link pointing to Proxy Scraper software.\nThe download link points to a compressed file called Simple+Scraper.zip containing two files:\nMaterialSkin.dll and Proxy Scraper.exe. By statically inspecting the code using .NET\nDecompiler software, we found that the downloader malware uses Pastebin as a repository\nto host links to updates related to the Proxy Scraper software.\n\n\n-----\n\nFigure 10. .NET code used to check for updates related to the Proxy Scraper software.\nThe downloader version (“v2.0”) is shown at code level, but the second-stage malware code\ndoesn’t indicate a version. However, based on [VirusTotal information, the executable file has](https://www.virustotal.com/gui/file/e3ea8a206b03d0a49a2601fe210c949a3c008c97e5dbf77968c0d08d2b6c1255/details)\nbeen submitted under different names, including “Lithium proxy scraper v2.6”.\n\n## Conclusion\n\nThe Pastebin C2 tunnel is still alive and being used by njRAT to deliver malicious payloads\nby downloading data hosted in Pastebin, allowing this and other malware families in the wild\nto take advantage of paste-based public services. Based on our research, malware authors\nare interested in hosting their second-stage payloads in Pastebin and encrypting or\nobfuscating such data as a measure to evade security solutions. There is a possibility that\nmalware authors will use services like Pastebin for the long term.\n\nAt the time of this writing, the following samples were not publicly available. However, we\nhave created all the required coverage against their behavior and communication.\n\nffb01512e7357ab899c8eabe01a261fe9462b29bc80158a67e75fdc9c2b348f9\ndfc8bffef19b68cfa2807b2faaf42de3d4903363657f7c0d27435a767652d5b4\n96c7c2a166761b647d7588428fbdd6030bb38e5ef3d407de71da657f76b74cac\n\nPalo Alto Networks customers are protected from this kind of attack by the following:\n\n[1. Threat Prevention signatures](https://www.paloaltonetworks.com/products/secure-the-network/subscriptions/threat-prevention) [21010,](https://threatvault.paloaltonetworks.com/?query=21010) [21005,](https://threatvault.paloaltonetworks.com/?query=21005) [21075 and](https://threatvault.paloaltonetworks.com/?query=21075) [21077 identify HTTP Pastebin](https://threatvault.paloaltonetworks.com/?query=21077)\n\nrequests attempting to download malicious components.\n[2. WildFire and](https://www.paloaltonetworks.com/products/secure-the-network/wildfire) [Cortex XDR identify and block njRAT and its droppers.](https://www.paloaltonetworks.com/cortex/cortex-xdr)\n\n## IOCs\n\n**Samples**\n\n03c7015046ef4e39a209384f2632812fa561bfacffc8b195542930e91fa6dceb\n\n205341c9ad85f4fc99b1e2d0a6a5ba5c513ad33e7009cdf5d2864a422d063aba\n\n\n-----\n\n2270b21b756bf5b5b1b5002e844d0abe10179c7178f70cd3f7de02473401443a\n\n54cf2d7b27faecfe7f44fb67cb608ce5e33a7c00339d13bb35fdb071063d7654\n\n54d7ee587332bfb04b5bc00ca1e8b6c245bb70a52f34835f9151b9978920b6d7\n\n678a25710addeefd8d42903ceddd1c82c70b75c37a80cf2661dab7ced6732cd3\n\n67cbb963597abb591b8dc527e851fc8823ff22d367f4b580eb95dfad7e399e66\n\n6817906a5eff7b02846e4e6a492ee57c2596d3f19708d8483bef7126faa7267f\n\n69366be315acc001c4b9b10ffc67dad148e73ca46e5ec23509f9bb3eedcd4c08\n\n94c2196749457b23f82395277a47d4380217dd821d0a6592fc27e1e375a3af70\n\n94e648c0166ee2a63270772840f721ba52a73296159e6b72a1428377f6f329ad\n\n96640d0c05dd83bb10bd7224004056e5527f6fad4429beaf4afa7bad9001efb7\n\n97227c346830b4df87c92fce616bdec2d6dcbc3e6de3f1c88734fe82e2459b88\n\n97b943a45b4716fcea4c73dce4cefe6492a6a51e83503347adcd6c6e02261b84\n\n9ba0126bd6d0c4b41f5740d3099e1b99fed45b003b78c500430574d57ad1ad39\n\nbd2387161cc077bfca0e0aae5d63820d1791f528feef65de575999454762d617\n\n**Second Stage**\n\n9982c4d431425569a69a022a7a7185e8c47783a792256f4c5420f9e023dee12a\n\nd347080fbc66e680e2187944efbca11ff10dc5bfcc76c815275c4598bb410ef6\n\n30c071a9e0207f0ca98105c40ac60ec50104894f3e4ed0fb1e7b901f56d14ad4\n\n231d52100365c14be32e2e81306b2bb16c169145a8dbcdc8f921c23d7733cef0\n\nfd5c731bb53c4e94622e016d83e4c0d605baf8e34c7960f72ff2953c65f0084c\n\nb3730931aaa526d0189aa267aa0d134eb89e538d79737f332223d3fc697c4f5a\n\n75b833695a12e16894a1e1650ad7ed51e6f8599ceaf35bbd8e9461d3454ab711\n\n6d0b09fe963499999af2c16e90b6f8c5ac51138509cc7f3edb4b35ff8bef1f12\n\n2af1bb05a5fde5500ea737c08f1b675a306150a26610d2ae3279f8157a3cb4df\n\ndb8ca46451a6c32e3b7901b50837500768bb913cafb5e12e2111f8b264672219\n\n\n-----\n\n5ebb875556caefb78d5050e243f0efb9c2c8e759c9b32a426358de0c391e8185\n\nbdc33dbdfd92207ad88b6feb3066bb662a6ca5cf02710870cae38320bb3a35bf\n\n08f378fe42aec892e6eb163edc3374b0e2eb677bd01e398addd1b1fca4cd23c4\n\n## URLs\n\n**Active:**\n\nhxxp://pastebin[.]com/raw/JKqwsAs6\n\nhxxp://pastebin[.]com/raw/pc9QbQCK\n\nhxxp://pastebin[.]com/raw/Rpx7tm9N\n\nhxxp://pastebin[.]com/raw/hsGSLP89\n\nhxxp://pastebin[.]com/raw/HNkipzLK\n\nhxxp://pastebin[.]com/raw/Z3mcNqjz\n\nhxxp://pastebin[.]com/raw/h5yBCwpY\n\nhxxp://pastebin[.]com/raw/zHLUaPvW\n\nhxxp://pastebin[.]com/raw/V6UWZm2n\n\nhxxp://pastebin[.]com/raw/rTjmne99\n\nhxxp://pastebin[.]com/raw/JMkdgr4h\n\nhxxp://pastebin[.]com/raw/yPTNdYRN\n\nhxxp://pastebin[.]com/raw/q56JPtdY\n\nhxxp://pastebin[.]com/raw/a3U5MMj2\n\nhxxp://pastebin[.]com/raw/E4MB4MFj\n\nhxxp://pastebin[.]com/raw/770qPDMt\n\nhxxp://pastebin[.]com/raw/YtuXz7YX\n\nhxxp://pastebin[.]com/raw/LKRwaias\n\nhxxp://pastebin[.]com/raw/ZFchNrpH\n\n\n-----\n\nhxxp://pastebin[.]com/raw/8DEsZn2y\n\n**Inactive**\n\nhxxp://pastebin[.]com/raw/TWQYHv9Y\n\nhxxp://pastebin[.]com/raw/0HpgqDt2\n\nhxxp://pastebin[.]com/raw/1t8LPE7R\n\nhxxp://pastebin[.]com/raw/3vsJLpWu\n\nhxxp://pastebin[.]com/raw/6MFWAdWS\n\nhxxp://pastebin[.]com/raw/AqndxJKK\n\nhxxp://pastebin[.]com/raw/SdcQ9yPM\n\nhxxp://pastebin[.]com/raw/XMKKNkb0\n\nhxxp://pastebin[.]com/raw/ZM6QyknC\n\nhxxp://pastebin[.]com/raw/pMDgUv62\n\nhxxp://pastebin[.]com/raw/yEw5XbvF\n\n**Get updates from**\n\n**Palo Alto**\n\n**Networks!**\n\nSign up to receive the latest news, cyber threat intelligence and research from us\n\n[By submitting this form, you agree to our Terms of Use and acknowledge our Privacy](https://www.paloaltonetworks.com/legal-notices/terms-of-use)\nStatement.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-12-09 - njRAT Spreading Through Active Pastebin Command and Control Tunnel.pdf"
    ],
    "report_names": [
        "2020-12-09 - njRAT Spreading Through Active Pastebin Command and Control Tunnel.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535785,
    "ts_updated_at": 1743041153,
    "ts_creation_date": 1653708834,
    "ts_modification_date": 1653708834,
    "files": {
        "pdf": "https://archive.orkl.eu/ccd2911d8bfad97130dcdf212a5ecdc26b076bbd.pdf",
        "text": "https://archive.orkl.eu/ccd2911d8bfad97130dcdf212a5ecdc26b076bbd.txt",
        "img": "https://archive.orkl.eu/ccd2911d8bfad97130dcdf212a5ecdc26b076bbd.jpg"
    }
}