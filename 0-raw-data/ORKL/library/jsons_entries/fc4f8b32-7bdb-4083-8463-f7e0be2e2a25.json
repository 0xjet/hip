{
    "id": "fc4f8b32-7bdb-4083-8463-f7e0be2e2a25",
    "created_at": "2023-01-12T14:59:45.863839Z",
    "updated_at": "2025-03-27T02:05:32.2836Z",
    "deleted_at": null,
    "sha1_hash": "937955c9d27adcfbac48194172ff0a1b1cb35b40",
    "title": "2021-12-31 - IKO activation - Malware campaign",
    "authors": "",
    "file_creation_date": "2022-05-27T23:27:51Z",
    "file_modification_date": "2022-05-27T23:27:51Z",
    "file_size": 1045655,
    "plain_text": "# Aktywacja aplikacji IKO – Kampania złośliwego oprogramowania\n\n**cert.pl/posts/2021/12/aktywacja-aplikacji-iko/**\n\nW ostatnim czasie obserwowaliśmy kolejną kampanię złośliwego oprogramowania wymierzoną w użytkowników urządzeń mobilnych z\nsystemem Android. Szkodliwa aplikacja, podszywa się pod aplikację banku PKO BP – IKO. Po analizie okazało się, że w atakach\nwykorzystywany jest obserwowany po raz pierwszy w Polsce trojan bankowy Coper.\n\n## Kampania\n\nW dniu 28 grudnia 2021 dostaliśmy pierwsze zgłoszenie o podejrzanym SMSie w którym nadawca wiadomości prosi o odnowienie systemu\npoprzez \"aktywację\" aplikacji:\n```\nSzanowny kliencie.W ostatnim czasie odnotowaliśmy aktywność ataków chakerskich.\nProsimy odnowić system https://iko.pkobq.pl/aktywacja/\n\n```\nNa uwagę zasługuje słowo \"chakerskich\" pisane przez ch i brzmiące dziwnie po polsku zdanie \"Prosimy odnowić system\". Oczywiście złośliwa\n[domena od razu znalazła się na naszej liście ostrzeżeń, a dla samej domeny](https://cert.pl/posts/2020/03/ostrzezenia_phishing/) `pkobq.pl został wystawiony wniosek o usunięcie z rejestru.`\n\nPo kliknięciu w link zawarty w wiadomości SMS, użytkownik zostaje przeniesiony na fałszywą stronę banku PKO BP. Jest ona przygotowana\nprofesjonalnie i przypomina prawdziwą stronę aplikacji IKO.\n\nAtakujący przygotowali instrukcję dla użytkownika krok po kroku w jaki sposób zainstalować aplikację i nadać jej dodatkowe uprawnienia. Po\npierwszym uruchomieniu pojawia się okno, które w natarczywy sposób domaga się wyrażenia zgody na korzystanie z usług ułatwień dostępu\n(ang. accessibility services).\n\nUłatwienia dostępu, mają z założenia wspomagać obsługę systemu osobom niepełnosprawnym, ale są one często wykorzystywane przez\nzłośliwe oprogramowanie do przejęcia kontroli nad urządzeniem. Jeżeli użytkownik zgodzi się, aby złośliwe oprogramowanie korzystało z tej\nfunkcjonalności, może ono samodzielnie imitować działania użytkownika jak klikanie w przyciski, czy zamykanie okien. W efekcie przejmuje\nono pełną kontrolę nad urządzeniem.\n\n\n-----\n\nCiekawą obserwacją jest to, że przez pewien czas, aktor kampanii do hostowania złośliwego pliku APK używał platformy GitHub. Jednak po\nusunięciu kilku kolejnych kont zdecydował się na kierowanie użytkowników bezpośrednio na aplikację znajdującą się na jego stronie.\n\nPobierany plik oczywiście nie jest prawdziwą aplikacją banku, lecz próbką mało znanego, złośliwego oprogramowania z rodziny Coper.\nJedyny na te chwile dostępny materiał na jego temat pochodzi z analizy dokonanej przez firmę Dr.WEB, gdy była ona używana do infekowania\n[użytkowników z Kolumbii: https://news.drweb.com/show/?i=14259](https://news.drweb.com/show/?i=14259)\n\n## Analiza techniczna\n\nPo zdekompilowaniu pliku APK, np. narzędziem JADX, na pierwszy rzut oka nie wydaje się on szczególnie ciekawy – większość klas jest\npusta i nie widać w nich żadnych ciekawych funkcjonalności. Możemy zacząć podejrzewać, że aplikacja została w jakiś sposób spakowana.\n\n\n-----\n\nas ą u agę o e p y uć asa tó a od o uje s ę do a ąc o ej b b ote aty ej `S`\n```\npublic class SjrPjuhyyhtmbDJ extends Application {\n  static {\n    System.loadLibrary(\"EzSNRfTMfY\");\n  }\n  /* access modifiers changed from: protected */\n  public void attachBaseContext(Context context) {\n    super.attachBaseContext(context);\n    snlOMCujSZmMAS(context);\n  }\n  public native void snlOMCujSZmMAS(Object obj);\n}\n\n```\nMożemy również stwierdzić jej obecność korzystając z przeglądarki plików projektu. Na poniższym screenie jest widoczna jako\n```\nlibEzSNRfTMfY.so .\n\n```\nKolejnym krokiem będzie więc analiza tej biblioteki, a w szczególności wywoływanej z niej funkcji `snlOMCujSZmMAS . W tym celu możemy`\nskorzystać np. z dekompilatora dostępnego w IDA Pro.\n\n\n-----\n\nostęp do de o p o a ego odu ba d o po aga usta e u d a a a b b ote S yb o doc od y do os u, e des y uje o a\nzałączony plik `ziwnopuf, korzystając z szyfru RC4 i stałego klucza – w tym przypadku` `3O10TAjsBlehWNa8e7vUgOWHlRH1T4Tr .`\n\nDziałanie tego kodu możemy bardzo prosto zasymulować, korzystając ze stworzonej przez nas biblioteki do pracy nad złośliwym\n[oprogramowaniem – Malduck. Kod z jej wykorzystaniem pozwalający odszyfrować plik](https://github.com/CERT-Polska/malduck) `ziwnopuf wygląda następująco:`\n```\nfrom malduck import rc4\nwith open(\"res/raw/ziwnopuf\", \"rb\") as f:\n  data = f.read()\ndecrypted = rc4(b\"3O10TAjsBlehWNa8e7vUgOWHlRH1T4Tr\", data)\nwith open(\"decrypted.dex\", \"wb\") as f:\n  f.write(decrypted)\n\n```\nWynikowy plik dex jest już o wiele ciekawszy.\n\nNiektóre łańcuchy znaków są szyfrowane ponownie za pomocą RC4 i klucza `7BLiz2PK6wbk1mhp, ale również tym razem nie sprawia to zbyt`\n[wiele problemu i analogicznie możemy wykorzystać Malduck.](https://github.com/CERT-Polska/malduck)\n\nWynikowo dostaniemy odszyfrowane stringi. Jednym z nich są wykorzystywane serwery C&C:\n```\n'https://s22231232fdnsjds.top/PArhFzp5sG2sN/|https://s32231232fdnsjds.top/PArhFzp5sG2sN/|https://s42231232fdnsjds.top/P\n\n```\n\nSpędzając trochę czasu na dalszej analizie możemy ustalić, że zapytania i odpowiedzi są szyfrowane za pomocą szyfru AES w trybie\nblokowym ECB, a następnie kodowane z wykorzystaniem Base64:\n```\npublic static String m59try(String str) {\n  if (str == null || str.isEmpty()) {\n    return \"\";\n  }\n  try {\n    SecretKeySpec secretKeySpec = new SecretKeySpec(adgjsfgjsgdfjea(Ctry.f83try).getBytes(), \"AES\");\n    Cipher instance = Cipher.getInstance(\"AES/ECB/PKCS5Padding\");\n    instance.init(1, secretKeySpec);\n    byte[] doFinal = instance.doFinal(str.getBytes());\n    return doFinal == null ? str : Base64.encodeToString(doFinal, 0);\n  } catch (Exception unused) {\n    return str;\n  }\n}\n\n```\nNatomiast klucz dla tego szyfrowania jest generowany korzystając z funkcji skrótu MD5 – `54569d2aaae7176335a67bf72e86736f :`\n\n\n-----\n\n```\n  try {\n    MessageDigest instance = MessageDigest.getInstance(\"MD5\");\n    instance.update(str.getBytes());\n    byte[] digest = instance.digest();\n    StringBuilder sb = new StringBuilder();\n    for (byte b : digest) {\n      String hexString = Integer.toHexString(b & 255);\n      while (hexString.length() < 2) {\n        hexString = \"0\" + hexString;\n      }\n      sb.append(hexString);\n    }\n    return sb.toString();\n  } catch (NoSuchAlgorithmException e) {\n    e.printStackTrace();\n    return \"\";\n  }\n}\n\n```\nPotrafiąc odszyfrować komunikację możemy przeanalizować jak ona wygląda, a następnie spreparować odpowiedni pakiet podszywający się\n[za zainfekowane urządzenie. Więcej informacji o protokole komunikacji można znaleźć w raporcie Dr.WEB. Dzięki nawiązaniu takiej](https://vms.drweb.com/virus/?i=24505684)\nkomunikacji, możemy uzyskać odpowiedź od serwera z aktualnymi danymi konfiguracyjnymi, m.in listą aplikacji, dla których autor przygotował\nwebinjecty, czy dodatkowe domeny C&C.\n```\n{\n  \"response\": \"er1\",\n  \"tasks\": [],\n  \"injects_list\":\n\"au.com.auswidebank.auswidebank|au.com.bankwest.mobile|au.com.ingdirect.android|au.com.nab.mobile|au.com.pnbank.android|au.com.sunco\n  \"extra_domains\": \"https://s122231232fdnsjds.top/|https://s222231232fdnsjds.top/|https://s322231232fdnsjds.top/|\",\n  \"keylogger_enabled\": null,\n  \"net_delay\": \"20\"\n}\n\n```\nW przypadku nieprawidłowego zapytania serwer udaje zwykły serwer HTTP, jednak można dostrzec zakomentowaną informację o błędzie w\ndekodowaniu zapytania – `<!-- aes_err: --> :`\n```\n<!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\">\n<html><head>\n<title>404 Not Found</title>\n</head><body>\n<h1>Not Found</h1>\n<p>The requested URL /PArhFzp5sG2sN/ was not found on this server.</p>\n</body></html>\n<!-- aes_err: -->\n\n```\nNa uwagę zasługuje lista webinjectów, czyli aplikacji dla których złośliwe oprogramowanie będzie próbowało wykraść dane. W większości\nprzypadków mają one dopisek `.test który powoduje, że nie zadziałają one i mogą sugerować wczesną fazę rozwoju oprogramowania. Gdy`\nje usuniemy dostajemy następującą listę targetowanych aplikacji:\n```\nau.com.auswidebank.auswidebank\nau.com.bankwest.mobile\nau.com.ingdirect.android\nau.com.nab.mobile\nau.com.pnbank.android\nau.com.suncorp.SuncorpBank\nbot.accessibility.hint\ncom.anz.android.gomoney\ncom.bankofqueensland.boq\ncom.bbva.bbvacontigo\ncom.bbva.netcash\ncom.bendigobank.mobile\ncom.commbank.netbank\ncom.fusion.banking\ncom.fusion.beyondbank\nenterprise.com.anz.shield\nes.bancosantander.apps\norg.banksa.bank\norg.bom.bank\norg.stgeorge.bank\norg.westpac.bank\nuk.co.tsb.newmobilebank\n\n```\nCiekawe jest to, że na chwilę obecną nie znajdziemy na niej polskich aplikacji, co nie znaczy, że infekcja tym złośliwym oprogramowaniem nie\njest groźna. Poza mechanizmem webinjectów Coper pozwala m.in na przechwytywanie i wysyłanie SMSów, czy uruchomienie keyloggera.\n\n## IOC\n\n\n-----\n\n**Nazwa pliku** **Użytkownik Githuba** **MD5**\n\nIKO.apk @steve229898 368f4b4d74a749ff55d76e929b52fedd\n\n2.iko_com.mindsoonvfk_IKO.apk @bechertfidor aebe71b857e868b1af752f90255aaab5\n\n2.iko_com.stoptravelg_IKO.apk @bechertfidor d2d8027baebf285703dc753219574d3e\n\n3.iko_com.growmainwkmm_IKO.apk @fidorde d6f521d9e83160ee06d71dc217c56693\n\nIKO.apk d6f521d9e83160ee06d71dc217c56693\n\nSerwery C&C zaszyte na stałe w próbkach:\n```\n   https://s22231232fdnsjds[.]top/PArhFzp5sG2sN/\n   https://s32231232fdnsjds[.]top/PArhFzp5sG2sN/\n   https://s42231232fdnsjds[.]top/PArhFzp5sG2sN/\n\n```\nDynamiczne serwery C&C:\n\n\n-----",
    "language": "PL",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-12-31 - IKO activation - Malware campaign.pdf"
    ],
    "report_names": [
        "2021-12-31 - IKO activation - Malware campaign.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535585,
    "ts_updated_at": 1743041132,
    "ts_creation_date": 1653694071,
    "ts_modification_date": 1653694071,
    "files": {
        "pdf": "https://archive.orkl.eu/937955c9d27adcfbac48194172ff0a1b1cb35b40.pdf",
        "text": "https://archive.orkl.eu/937955c9d27adcfbac48194172ff0a1b1cb35b40.txt",
        "img": "https://archive.orkl.eu/937955c9d27adcfbac48194172ff0a1b1cb35b40.jpg"
    }
}