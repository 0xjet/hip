{
    "id": "f96b2c9e-4122-4d7d-b31f-ac1a47ad4765",
    "created_at": "2023-01-12T15:03:41.517817Z",
    "updated_at": "2025-03-27T02:09:24.565895Z",
    "deleted_at": null,
    "sha1_hash": "05b5ede871db40df18faf8b675edc47fc3ca17af",
    "title": "2021-10-25 - UAParser.js npm Package Supply Chain Attack- Impact and Response",
    "authors": "",
    "file_creation_date": "2022-05-28T17:06:45Z",
    "file_modification_date": "2022-05-28T17:06:45Z",
    "file_size": 1306039,
    "plain_text": "# UAParser.js npm Package Supply Chain Attack: Impact and Response\n\n**[truesec.com/hub/blog/uaparser-js-npm-package-supply-chain-attack-impact-and-response](https://www.truesec.com/hub/blog/uaparser-js-npm-package-supply-chain-attack-impact-and-response)**\n\nNote: This is a developing story.\n\n## What Has Happened?\n\nMalware was added to a very popular project on npm called ua-parser-js (> 7 million weekly\ndownloads). Three malicious versions were published. Those were later superseded by\nbenign versions and finally unpublished. The project is used directly or indirectly by many\nweb projects. Most users are likely not even aware of using it.\n\nDevelopers that have downloaded or installed npm packages during the time period may\nhave received the malware. Figuring out if that has happened can be tricky. Other changes\nto the dependency tree or clean installs could have triggered the malicious package. At the\nvery least, check package caches on developer machines for malicious versions and check\nfor running malware.\n\n\n-----\n\nThe most dangerous time period seems to have been Friday 22 between ~12:15 and 16:27\nUTC when the malware was tagged as the latest versions. It was available for explicit\ndownload a while after before being unpublished.\n\n## Why Is This a Notable Problem?\n\nMalware embedded into package managers can endanger many parts of an environment. It\ncan typically execute and affect the developer machine, the build environment (CI/CD), and\nlikely even the production environment. A modern developer computer or CI/CD environment\nhas access to many keys and secrets related to sensitive systems and can of course be\nused to leverage further attacks on customers as well.\n\nThe project is very common in modern web projects. It is a direct dependency of common\npackages such as “fbjs” and “karma”. At the time of writing, ua-parser-js has 5.9k stars and\n949 forks on GitHub. It is listed as having 1,215 direct (public) dependents on npmjs.com\nand can be expected to have many times as many indirect public and private dependents\n(deps.dev lists 53 208 publicly known indirect dependencies).\nSince the malware likely steals credentials, the secondary effects may not be visible for a\nlong time. Make sure to reimage machines and rotate secrets if affected.\n\n## Who Was Affected?\n\nBroadly speaking, anyone that matches the following could have received the malware. If:\n\nYou added the malicious versions to your package.json or otherwise installed the\npackage (0.7.29, 0.8.0, 1.0.0).\nHad a direct or indirect dependency on the package in question, without explicitly\nlocking down versions. For example, a dependency on the package with version set as\n“^0.7.28”\n\nThis can affect both developer machines and CI/CD environments! Recommendations\nwith regards to rotating secrets and reinstalling will typically extend to servers using this\npackage as well.\n\n## What Are Some Mitigating Factors?\n\nNot running npm/yarn install while the malicious package was available.\nOnly running with frozen/locked dependencies. Note, however, that if you added some\nother package during the timeframe that might have led to the dependencies being\nreevaluated.\nIf “ignore-scripts” or similar was set to true\nMacOS was likely unaffected\n\n\n-----\n\n## How Do I Know if I Was Affected?\n\nAs this is a developing story, it is hard to say what all indicators are. Truesec’s [Fabio Viggiani](https://www.truesec.com/experts/fabio-viggiani)\n[has posted notes on indicators of compromise and malware behavior on Twitter, and several](https://twitter.com/fabio_viggiani/status/1451854934077591556)\nother teams are working on incidents as well as analysis of the malware.\n\nIf you are running Windows with AV enabled it is likely that Defender and others have noted\nthe malware.\n\nBeyond looking for indicators of the malware running on systems, we can also look for the\npackage on the machine:\n\nLook for the versions 0.7.29, 0.8.0 and 1.0.0 of ua-parser-js in node_modules or other\ncache directories\nLook for the malicious versions in any package-lock.json, yarn.lock, or similar package\nlock files.\nIf a central dependency repository/cache such as Nexus or Artifactory is used: See if\nthe malicious versions have been proxied/cached by any user.\n\nIt is not sufficient to only look for the versions in lockfiles as those could have been\nreevaluated on developer machines, ci/cd, or pr branches without being pushed to main.\n\nDon’t forget to check CI/CD. Pull requests for other package updates could have triggered\nthe malware.\n\n## How Could This Happen?\n\nSomehow the threat actor got access to the publisher's keys/identity and managed to publish\nmalicious versions. It has not been publicly stated how the threat actor got access to the\npublisher’s identity.\n\n## How Can We Avoid This in the Future?\n\nThe npm ecosystem is not well. Composability is admirable, but we can’t trust hundreds of\npublishers. Locking versions, having vulnerability feeds, and leveraging quarantine can\nmitigate. We can propose MFA for publishers all we want, we still can’t trust that many. I\nelaborate a bit on this in my blog post about supply chain threats and mitigations:\nhttps://www.truesec.com/hub/blog/secure-your-software-supply-chain-threats-andmitigations.\n\n## Why Three Versions?\n\nThe project didn’t have a 0.8 or 1.0 track previously, but the TA still pushed 0.8.0 and 1.0.0.\nThis increased the reach, as those versions would be the latest minor and major versions\n(similar to how using later version works for dependency confusion\n\n\n-----\n\n[(https://medium.com/@alex.birsan/dependency-confusion-4a5d60fec610)](https://medium.com/@alex.birsan/dependency-confusion-4a5d60fec610)\n\n## More\n\nKeep up to date with the GitHub advisory (https://github.com/advisories/GHSA-pjwm-rvh2[c87w) and ua-parser-js issue (https://github.com/faisalman/ua-parser-js/issues/536).](https://github.com/faisalman/ua-parser-js/issues/536)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-10-25 - UAParser.js npm Package Supply Chain Attack- Impact and Response.pdf"
    ],
    "report_names": [
        "2021-10-25 - UAParser.js npm Package Supply Chain Attack- Impact and Response.pdf"
    ],
    "threat_actors": [
        {
            "id": "20c759c2-cd02-45bb-85c6-41bde9e6a7cf",
            "created_at": "2024-01-18T02:02:34.189827Z",
            "updated_at": "2025-03-27T02:02:09.937024Z",
            "deleted_at": null,
            "main_name": "HomeLand Justice",
            "aliases": [
                "Karma",
                "Storm-842",
                "Void Manticore"
            ],
            "source_name": "ETDA:HomeLand Justice",
            "tools": [
                "BABYWIPER",
                "BiBi Wiper",
                "BiBi-Linux Wiper",
                "BiBi-Windows Wiper",
                "Cl Wiper",
                "LowEraser",
                "No-Justice Wiper",
                "Plink",
                "PuTTY Link",
                "RevSocks",
                "W2K Res Kit"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535821,
    "ts_updated_at": 1743041364,
    "ts_creation_date": 1653757605,
    "ts_modification_date": 1653757605,
    "files": {
        "pdf": "https://archive.orkl.eu/05b5ede871db40df18faf8b675edc47fc3ca17af.pdf",
        "text": "https://archive.orkl.eu/05b5ede871db40df18faf8b675edc47fc3ca17af.txt",
        "img": "https://archive.orkl.eu/05b5ede871db40df18faf8b675edc47fc3ca17af.jpg"
    }
}