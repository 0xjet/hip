{
    "id": "7a2d39ba-4fc4-4623-9553-bc45ce53a006",
    "created_at": "2023-01-12T14:59:44.18286Z",
    "updated_at": "2025-03-27T02:05:32.906464Z",
    "deleted_at": null,
    "sha1_hash": "8d5fc0757da1a4f7fd0b9a8c6c83c06d29c6e415",
    "title": "2021-10-22 - Recent Attack Uses Vulnerability on Confluence Server",
    "authors": "",
    "file_creation_date": "2022-05-28T15:14:38Z",
    "file_modification_date": "2022-05-28T15:14:38Z",
    "file_size": 695046,
    "plain_text": "# Recent Attack Uses Vulnerability on Confluence Server\n\n**[fortinet.com/blog/threat-research/recent-attack-uses-vulnerability-on-confluence-server](https://www.fortinet.com/blog/threat-research/recent-attack-uses-vulnerability-on-confluence-server)**\n\nOctober 21, 2021\n\n**[FortiGuard Labs Threat Research Report](https://www.fortinet.com/fortiguard/labs.html?utm_source=blog&utm_medium=campaign&utm_campaign=FortiGuardLabs)**\n\n**Affected platforms: Atlassian’s Confluence**\n\n**Impacted parties: Confluence Server or Data Center instance**\n\n**Impact: An OGNL injection vulnerability exists that would allow an unauthenticated user to**\nexecute arbitrary code\n\n**Severity level: Critical**\n\n## Introduction of CVE-2021-26084\n\n[In August 2021, Atlassian published a security advisory about](https://confluence.atlassian.com/doc/confluence-security-advisory-2021-08-25-1077906215.html) [CVE-2021-26084 that could](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-26084)\nenable a threat actor to run arbitrary code on unpatched Confluence Server and Data Center\n[instances. FortiGuard Labs analyzed the situation and published a Threat Signal with](https://www.fortinet.com/fortiguard/labs?utm_source=blog&utm_campaign=fortiguardlabs)\nrelevant information. After releasing the advisory, there occur massive scanning and proof-of\n\n-----\n\nconcept exploit code in public. We also collect a lot attacking traffic. In this blog we will\nanalyze the payloads leveraging this vulnerability, deep dive into the attack and summarize\nthe IOCs for these suspicious activities that may hint the network was affected by CVE-202126084.\n\n## Overview of CVE-2021-26084 Incidents\n\nIn September, we observed numerous threat actors targeting this vulnerability whose goal\nwas to download a malicious payload that would install a backdoor or miner in a user’s\nnetwork. These threats include Cryptojacking, Setag backdoor, Fileless attack that uses\n[PowerShell in a system to execute shell without file dropped and Muhstik botnet; we will](https://www.fortinet.com/blog/threat-research/offense-and-defense-a-tale-of-two-sides-powershell?utm_source=blog&utm_campaign=offense-and-defense-a-tale-of-two-sides-powershell)\nelaborate each of them in this analysis.\n\nAlthough there are different attack vectors for this vulnerability, all of these attacks are\ntargeting the parameter “queryString” which is shown in following packet capture:\n\nFileless attack leverage CVE-2021-26084\n\n## Cryptojacking\n\nAfter exploiting CVE-2021-26084, it downloads init.sh from 86.105.195[.]120. The shell is a\ncrypto miner that includes following tasks:\n\n1. Delete syslog\n2. Change commonly used command\n3. Stop aliyun services and apparmor\n4. Set the path for miner execution file (zzh) and itself but rename as newinit.sh\n5. Kill all other miner processes\n6. Use crontab to establish persistence\n7. Get scanning shell (is.sh)\n8. Clean the trace\n\nPayload Exploits CVE-2021-26084\n\nInti.sh\n\nIn the scanning shell, it will try to download a scanning tool, like Masscan, Pnscan, etc, which\ncan be used to scan and survey IPv4 TCP network in order to discover live host to proceed\nthe spreading. The downloader path is shown as below. It also downloads a shell that\ndefines specific steps for the scan. First, get the login brute force tool hxx (md5:\nf0551696774f66ad3485445d9e3f7214) and account/password list ps (md5:\na43ad8a740081f0b5a89e219fe8475a3), then scan the subnet belong to private network\n(172.16.0.0/12, 192.168.0.0/16, 10.0.0.0/8). This is to allow the malware to login into\nmore devices in victim’s intranet and spread miner script (init.sh).\n\n\n-----\n\nDownloader path in is.sh\n\nScannng steps in rs.sh\n\nThe entire workflow can be seen below.\n\nConfluence server\n\n## Setag\n\nThe following exploit traffic was observed from IP address 86.105.195.154 (AS 3164 Astimp\nIT Solution SRL). Setag, also known as BillGates or Ganiw, belongs to a well-known\nmalware family that targets server via 1 day vulnerability. It mainly uses\n[UDP/SYN/ICMP/DNS floods to conduct DDoS attack. But it also has various command can](https://www.fortinet.com/products/ddos/fortiddos.html?utm_source=blog&utm_campaign=ddos)\ncheck its own status or control their victims. The command for dos attack or controlling their\nvictims can be seen in following rawdata:\n\nSyna\n\n## Fileless Attack\n\nThe observed packet is from 141.98.83.139 (AS 209588 Flyservers S.A.) and the main\npayload is b64 encoded. The decoded data is as follow:\n\nFirst layer decoded data\n\nWe can see that the payload is constructed and executed via PowerShell. The final\nexecution will set “WindowStyle” to hidden and “CreateNoWindow” to True, which is to put\nitself out of sight. We decoded those data in the middle and replace {0} and {1} with “=” and\n“P”, then 2nd layer payload data\n\nSecond layer payload data\n\nIt defined two functions, and one variable that contain the main exploit code. After converting\nthe code in $sG, it will use VirtualAlloc to reserve a part of memory. Then it uses\nCreateThread to invoke the malicious code. So what exactly $sG is? After b64 decoding, we\nget about 570 bytes binary data as below:\n\n570 bytes binary data\n\nTo dive deep in to this, we have to check this binary by IDA. Following the first call into\nloc_D6, it puts ws2_32 and move edx, 726774ch, and this is the hash value of LoadLibrary\nfunction, the detail code is as below:\n\nThe hash value of LoadLibrary function\n\n\n-----\n\nIt is a reverse shell meterpreter shellcode that connects to exploit source 141.98.83[.]139 via\ntcp port 23733. Since the port now is closed, we only managed to capture the following\npackets. But the entire attack process only leveraged PowerShell to decode layer by layer,\nand uses hidden window style to hide itself. And finally, create a thread to achieve the\nreverse shell. Not a single file is dropped in the entire attack, which is known as fileless\nattack.\n\n## Muhstik\n\nBy exploiting CVE-2021-26084, it downloads conf2 from 149.28.85[.]17. The file will deploy\nand execute dk86 from 188.166.137[.]241 and ldm script. The attack scenario afterward is\n[analyzed in this article, but we observed a different server IP and more attack source IP](https://www.lacework.com/blog/muhstik-takes-aim-at-confluence-cve-2021-26084/)\nwhich is intended to spread conf2 of Muhstik.\n\nDifferent conf2 downloader\n\n## Conclusion\n\nWe have been tracking this vulnerability for weeks and observing massive threat exploitation\ntargeting Atlassian Confluence. Although the patch for CVE-2021-26084 is already released,\npublic attacks are still undergoing. In this post, we gave detail of those attacks and illustrate\nhow they using the payload to deliver malware, users should upgrade the system\nimmediately and also apply Fortiguard protection to avoid the threat probing.\n\n## Fortinet Protections\n\n[For vulnerability CVE-2021-26084, Fortinet already release IPS signature](https://www.fortinet.com/products/data-center-ips.html?utm_source=blog&utm_campaign=ips-page)\nAtlassian.Confluence.CVE-2021-26084.Remote.Code.Execution for it to proactive protect\nour customer. For payloads described are detected and blocked by the FortiGuard AntiVirus.\n\nThe downloading URLs and attacker's IP addresses have been rated as \"Malicious\nWebsites\" by the [FortiGuard Web Filtering service.](https://www.fortinet.com/support-and-training/support-services/fortiguard-security-subscriptions/web-filtering.html?utm_source=blog&utm_campaign=web-filtering)\n\n## IOC\n\nValue Item\n\n86.105.195.154 Cryptojacking expolit source IP address\n\n86.105.195.120 Cryptojacking dropper hosting IP address\n\n\n-----\n\n911e417b9bc8689a3eed828f0b39f579 hxxp://86.105.195.120/cleanfda/init.sh\n\nhxxp://86.105.195.120/cleanfda/newinit.sh\n\n75259ee2db52d038efea5f939f68f122 hxxp://86.105.195.120/cleanfda/zzh\n\n4a7bf7f013cc2297d62627b2b78c5b0b hxxp://86.105.195.120/cleanfda/is.sh\n\n8cc2b831e29dc9f4832a162e9f425649 hxxp://86.105.195.120/cleanfda/rs.sh\n\n2.57.33.59 Setag expolit source IP address\n\n209.141.50.210 Setag dropper hosting IP address\n\na8eb59396d698bda5840c8b73c34a03b hxxp://209.141.50.210/syna\n\n141.98.83.139 Fileless attack expolit source IP address\n\n1b8a7954b9630be2e0dd186a4fc6a32a 2nd layer payload data\n\nbf8a7b199f3293852c7f2b3578e8c0ae Binary shellcode\n\n\n98.239.93.20\n\n87.106.194.46\n\n51.75.195.137\n\n34.247.148.227\n\n121.196.25.170\n\n221.168.37.77\n\n122.9.48.250\n\n18.182.153.49\n\n\nMuhstik exploit source IP address\n\n\n149.28.85.17 Conf2 dropper hosting IP address\n\n6078c8a0c32f4e634f2952e3ebac2430 hxxp://149.28.85.17/conf2\n\n\n-----\n\n_Learn more about Fortinet s_ _[FortiGuard Labs threat research and intelligence organization](https://www.fortinet.com/fortiguard/labs?utm_source=blog&utm_campaign=fortiguard-labs)_\n_[and the FortiGuard Security Subscriptions and Services portfolio.](https://www.fortinet.com/fortiguard/labs?tab=security-bundles&utm_source=blog&utm_campaign=security-bundles)_\n\n_Learn more about Fortinet’s_ _[free cybersecurity training, an initiative of Fortinet’s Training](https://www.fortinet.com/training/cybersecurity-professionals?utm_source=blog&utm_medium=campaign&utm_campaign=Freetraininginitiative)_\n_Advancement Agenda (TAA), or about the_ _Fortinet Network Security Expert_\n_[program, Security Academy program, and](https://training.fortinet.com/local/staticpage/view.php?page=fnsa&utm_source=pr&utm_campaign=fnsa)_ _[Veterans program. Learn more about FortiGuard](https://www.fortinet.com/corporate/careers/vets.html?utm_source=blog&utm_campaign=fortivet)_\n_Labs global threat intelligence and research and the FortiGuard Security Subscriptions and_\n_Services portfolio._\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-10-22 - Recent Attack Uses Vulnerability on Confluence Server.pdf"
    ],
    "report_names": [
        "2021-10-22 - Recent Attack Uses Vulnerability on Confluence Server.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535584,
    "ts_updated_at": 1743041132,
    "ts_creation_date": 1653750878,
    "ts_modification_date": 1653750878,
    "files": {
        "pdf": "https://archive.orkl.eu/8d5fc0757da1a4f7fd0b9a8c6c83c06d29c6e415.pdf",
        "text": "https://archive.orkl.eu/8d5fc0757da1a4f7fd0b9a8c6c83c06d29c6e415.txt",
        "img": "https://archive.orkl.eu/8d5fc0757da1a4f7fd0b9a8c6c83c06d29c6e415.jpg"
    }
}