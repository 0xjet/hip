{
    "id": "ea38bd6d-9bfd-4d6d-b009-5984ba3581f4",
    "created_at": "2023-01-12T15:01:55.320444Z",
    "updated_at": "2025-03-27T02:09:18.009942Z",
    "deleted_at": null,
    "sha1_hash": "a3c5926fa49fc29df4bcb6013a8833c3784c688e",
    "title": "2022-06-16 - Confluence exploits used to drop ransomware on vulnerable servers",
    "authors": "",
    "file_creation_date": "2022-07-02T23:11:56Z",
    "file_modification_date": "2022-07-02T23:11:56Z",
    "file_size": 2521143,
    "plain_text": "# Confluence exploits used to drop ransomware on vulnerable servers\n\n**[news.sophos.com/en-us/2022/06/16/confluence-exploits-used-to-drop-ransomware-on-vulnerable-servers/](https://news.sophos.com/en-us/2022/06/16/confluence-exploits-used-to-drop-ransomware-on-vulnerable-servers/)**\n\nAndrew Brandt June 16, 2022\n\n[The disclosure of](https://www.volexity.com/blog/2022/06/02/zero-day-exploitation-of-atlassian-confluence/) [a serious vulnerability in Atlassian’s core intranet product, Confluence, has](https://confluence.atlassian.com/doc/confluence-security-advisory-2022-06-02-1130377146.html)\nraised the profile of a number of incidents the SophosLabs and Managed Threat Response\n(MTR) teams have been tracking since the remote code execution bug was disclosed over\nMemorial Day weekend in the US.\n\nWhile the number of vulnerable Confluence servers is low and shrinking, MTR and\nSophosLabs have been investigating several attacks against Confluence instances running\non Windows or Linux. Two of those attacks, against Windows servers, resulted in the\ndeployment of Cerber ransomware payloads.\n\nThe vulnerability, [CVE-2022-26134, allows an attacker to spawn a remotely-accessible shell,](https://nvd.nist.gov/vuln/detail/CVE-2022-26134)\nin-memory, without writing anything to the server’s local storage. Atlassian has posted both\nupdates to the product (that also fix other security-related vulnerabilities), and mitigation\nstrategies, which most of their customers appear to be implementing.\n\n\n-----\n\nMost of the small number of cases we re following appear to be automated, with some of the\nattackers using the fileless web shell to deliver various payloads, including Mirai-like bots; a\n[malicious Linux package called pwnkit; a cryptominer known as z0miner](https://nakedsecurity.sophos.com/2022/01/26/pwnkit-security-bug-gets-you-root-on-most-linux-distros-what-to-do/) (previously seen\ndropped after exploitation of Log4J and [a 2021 vulnerability in Atlassian); and, oddly, file-](https://www.trendmicro.com/en_us/research/21/i/cryptominer-z0miner-uses-newly-discovered-vulnerability-cve-2021.html)\nbased web shells, written in either ASP or PHP formats. This gives us the impression that\nthe initial attackers leveraging this exploit have done so as a way to spread an existing\ncollection of hacking tools more widely.\n\nWe’ve also observed attackers pushing down Cobalt Strike shellcode and running\nPowerShell commands on vulnerable Windows servers\n\n## Wormable ransomware\n\nIn the two incidents where the attackers tried to deploy ransomware, we observed\nunexpected (likely malicious) executions of the tool curl on the server prior to the\ndeployment. While we were trying to get ahold of the affected customers, the attacker\ndelivered an encoded PowerShell command to the Confluence server they controlled.\n\n_Figure 1: The encoded PowerShell command_\n\nThe encoded command was an instruction to download and execute a Windows program,\nsaved to the %temp% folder under the name svcPrvinit.exe, then delete it when execution\nwas complete.\n\n_Figure 2: The decoded PowerShell commands, downloading a Windows binary_\n\nThe parent process of this execution was the Apache Tomcat web server software running\nunder the Confluence directory on the server, leaving little doubt where the attack began.\nThe attacks were both stopped by the CryptoGuard feature in Intercept X before damage\ncould be done.\n\nIf the servers had not been protected, and the attack had proceeded successfully, the\nservers’ operators would have discovered that most files had the .locked suffix appended to\ntheir names, and every folder contained a file named __$$RECOVERY_README$$__.html\n\n\n-----\n\nwith a link to the criminal s Tor website, and a demand for payment within 30 days – followed\nby the threat “we will post information about your private data on public news webs.”\n\n_Figure 3: The Cerber ransomware note_\n\nThere was no evidence the attackers had exfiltrated any private data from the servers, nor\nthat the attackers had made any lateral movement to pivot from the servers to any other\nmachines on the targets’ networks.\n\n## Detection and guidance\n\nAs most of Atlassian’s customers have been notified about the vulnerable installations, there\nare fewer instances of vulnerable public-facing Confluence servers with each passing day.\nThe company’s guidance includes some instructions for moving the vulnerable components\nto folders that aren’t publicly accessible, but an upgrade should resolve the problem with the\nvulnerability.\n\nRebooting the server will remove any in-memory remote shell code that’s running on\nmachines that have been infected, but a reboot won’t remove the hacker toolkit components\nsome attackers are dropping into the %temp% directory on Windows, or /tmp on Linux. In\nsome cases, manual deletion of the contents of those folders may be warranted.\n\n[Sophos products will detect the ASP and PHP webshells as Troj/WebShel-BU or](https://www.virustotal.com/gui/search/sophos%253ATroj%252FWebShel-BU)\n[Troj/WebShel-DB, respectively. CryptoGuard is highly effective at stopping the execution of](https://www.virustotal.com/gui/search/sophos%253ATroj%252FWebShel-DB)\nCerber ransomware, among others. The Cobalt Strike stager shellcode is detected as\n\n\n-----\n\n**ATK/ChimeraPS-A. Updated behavioral rules will also detect when Tomcat processes**\ninvoke PowerShell or curl, and alert or halt the execution of the command.\n\nIndicators of compromise relating to these attacks have been posted to the SophosLabs\nGithub repository.\n\n## Acknowledgments\n\nSophosLabs thanks analysts Andrew Ludgate and Gabor Szappanos, and MTR incident\nresponders Sam Kettleson, Coleman Laguzza, Dakota Mercer-Szady, Ade Muhammed,\nMark Parsons, and Kevin Thipphavong, for their diligent efforts in protecting customers\naround the clock.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-06-16 - Confluence exploits used to drop ransomware on vulnerable servers.pdf"
    ],
    "report_names": [
        "2022-06-16 - Confluence exploits used to drop ransomware on vulnerable servers.pdf"
    ],
    "threat_actors": [
        {
            "id": "873a6c6f-a4d1-49b3-8142-4a147d4288ef",
            "created_at": "2022-10-25T16:07:23.455744Z",
            "updated_at": "2025-03-27T02:02:09.811933Z",
            "deleted_at": null,
            "main_name": "Chimera",
            "aliases": [
                "Operation Skeleton Key"
            ],
            "source_name": "ETDA:Chimera",
            "tools": [
                "Agentemis",
                "Cobalt Strike",
                "CobaltStrike",
                "SkeletonKeyInjector",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f88b16bc-df4b-48e7-ae35-f4117240ff24",
            "created_at": "2022-10-25T15:50:23.556699Z",
            "updated_at": "2025-03-27T02:00:55.499173Z",
            "deleted_at": null,
            "main_name": "Chimera",
            "aliases": [
                "Chimera"
            ],
            "source_name": "MITRE:Chimera",
            "tools": [
                "PsExec",
                "esentutl",
                "Mimikatz",
                "Cobalt Strike"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535715,
    "ts_updated_at": 1743041358,
    "ts_creation_date": 1656803516,
    "ts_modification_date": 1656803516,
    "files": {
        "pdf": "https://archive.orkl.eu/a3c5926fa49fc29df4bcb6013a8833c3784c688e.pdf",
        "text": "https://archive.orkl.eu/a3c5926fa49fc29df4bcb6013a8833c3784c688e.txt",
        "img": "https://archive.orkl.eu/a3c5926fa49fc29df4bcb6013a8833c3784c688e.jpg"
    }
}