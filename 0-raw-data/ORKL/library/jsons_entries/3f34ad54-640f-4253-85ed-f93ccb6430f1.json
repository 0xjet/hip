{
    "id": "3f34ad54-640f-4253-85ed-f93ccb6430f1",
    "created_at": "2023-01-12T15:03:05.53486Z",
    "updated_at": "2025-03-27T02:17:11.70471Z",
    "deleted_at": null,
    "sha1_hash": "212b98e63ee01dcbece852e90c46aaff7c07f4b8",
    "title": "2021-10-05 - UEFI threats moving to the ESP- Introducing ESPecter bootkit",
    "authors": "",
    "file_creation_date": "2022-05-28T19:42:40Z",
    "file_modification_date": "2022-05-28T19:42:40Z",
    "file_size": 1127751,
    "plain_text": "# UEFI threats moving to the ESP: Introducing ESPecter bootkit\n\n**[welivesecurity.com/2021/10/05/uefi-threats-moving-esp-introducing-especter-bootkit/](https://www.welivesecurity.com/2021/10/05/uefi-threats-moving-esp-introducing-especter-bootkit/)**\n\nOctober 5, 2021\n\nESET research discovers a previously undocumented UEFI bootkit with roots going back all the way to at least 2012\n\nESET researchers have analyzed a previously undocumented, real-world UEFI bootkit that persists on the EFI System\nPartition (ESP). The bootkit, which we’ve named ESPecter, can bypass Windows Driver Signature Enforcement to load its\nown unsigned driver, which facilitates its espionage activities. Alongside Kaspersky’s recent discovery of the unrelated\n[FinSpy bootkit, it is now safe to say that real-world UEFI threats are no longer limited to SPI flash implants, as used by](https://securelist.com/finspy-unseen-findings/104322/)\n[Lojax.](https://www.welivesecurity.com/2018/09/27/lojax-first-uefi-rootkit-found-wild-courtesy-sednit-group/)\n\nThe days of UEFI (Unified Extensible Firmware Interface) living in the shadows of the legacy BIOS are gone for good. As a\nleading technology embedded into chips of modern computers and devices, it plays a crucial role in securing the pre-OS\nenvironment and loading the operating system. And it’s no surprise that such a widespread technology has also become a\ntempting target for threat actors in their search for ultimate persistence.\n\n[In the last few years, we have seen proof-of-concept examples of UEFI bootkits (DreamBoot,](https://github.com/quarkslab/dreamboot) [EfiGuard), leaked documents](https://github.com/Mattiwatti/EfiGuard)\n[(DerStarke,](https://wikileaks.org/ciav7p1/cms/page_26968082.html) [QuarkMatter) and even leaked source code (Hacking Team Vector EDK), suggesting the existence of real UEFI](https://wikileaks.org/ciav7p1/cms/page_26968082.html)\nmalware either in the form of SPI flash implants or ESP implants. Despite all of the above, only three real-world cases of\n[UEFI malware have been discovered so far (LoJax, discovered by our team in 2018, MosaicRegressor, discovered by](https://www.welivesecurity.com/wp-content/uploads/2018/09/ESET-LoJax.pdf)\nKaspersky in 2019, and most recently the FinSpy bootkit, whose analysis was just published by Kaspersky). While the first\ntwo fall in the category of SPI flash implants, the last falls in the ESP implants category, and surprisingly, it’s not alone there.\n\nToday, we describe our recent discovery of ESPecter, just the second real-world case of a UEFI bootkit persisting on the\nESP in the form of a patched Windows Boot Manager to be analyzed. ESPecter was encountered on a compromised\nmachine along with a user-mode client component with keylogging and document-stealing functionalities, which is why we\nbelieve ESPecter is mainly used for espionage. Interestingly, we traced the roots of this threat back to at least 2012,\npreviously operating as a bootkit for systems with legacy BIOSes. Despite ESPecter’s long existence, its operations and\nupgrade to UEFI went unnoticed and have not been documented until now. Note that the only similarity between ESPecter\nand the Kaspersky FinSpy find is that they share the UEFI boot manager compromise approach.\n\n\n-----\n\n_Figure 1. Comparison of the Legacy Boot flow (left) and UEFI boot flow (right) on Windows (Vista and newer) systems_\n\nBy patching the Windows Boot Manager, attackers achieve execution in the early stages of the system boot process (see\nFigure 1), before the operating system is fully loaded. This allows ESPecter to bypass Windows Driver Signature\nEnforcement (DSE) in order to execute its own unsigned driver at system startup. This driver then injects other user-mode\ncomponents into specific system processes to initiate communication with ESPecter’s C&C server and to allow the attacker\nto take control of the compromised machine by downloading and running additional malware or executing C&C commands.\n\nEven though Secure Boot stands in the way of executing untrusted UEFI binaries from the ESP, over the last few years we\nhave been witness to various UEFI firmware vulnerabilities affecting thousands of devices that allow disabling or bypassing\nSecure Boot (e.g. [VU#758382,](https://www.kb.cert.org/vuls/id/758382) [VU#976132,](https://www.kb.cert.org/vuls/id/976132) [VU#631788, …). This shows that securing UEFI firmware is a challenging task](https://www.kb.cert.org/vuls/id/631788)\nand that the way various vendors apply security policies and use UEFI services is not always ideal.\n\n[Previously, we have reported multiple malicious EFI samples in the form of simple, single-purpose UEFI applications](https://twitter.com/ESETresearch/status/1275770256389222400?s=20)\n[without extensive functionality. These observations, along with the concurrent discovery of the ESPecter and FinFisher](https://securelist.com/finspy-unseen-findings/104322/)\nbootkits, both fully functional UEFI bootkits, show that threat actors are not relying only on UEFI firmware implants when it\ncomes to pre-OS persistence, but also are trying to take advantage of disabled Secure Boot to execute their own ESP\nimplants.\n\nWe were not able to attribute ESPecter to any known threat actor, but the Chinese debug messages in the associated usermode client component (as seen in Figure 2) leads us to believe with a low confidence that an unknown Chinese-speaking\nthreat actor is behind ESPecter. At this point, we don’t know how it was distributed.\n\n\n-----\n\n_Figure 2. Example of Chinese debug messages in the user-mode client component_\n\n## Evolution of the ESPecter bootkit\n\nWhen we looked at our telemetry, we were able to date the beginnings of this bootkit back to at least 2012. At its beginning,\nit used MBR (Master Boot Record) modification as its persistence method and its authors were continuously adding support\nfor new Windows OS versions. What is interesting is that the malware’s components have barely changed over all these\nyears and the differences between 2012 and 2020 versions are not as significant as one would expect.\n\nAfter all the years of insignificant changes, those behind ESPecter apparently decided to move their malware from legacy\nBIOS systems to modern UEFI systems. They decided to achieve this by modifying a legitimate Windows Boot Manager\nbinary (bootmgfw.efi) located on the ESP while supporting multiple Windows versions spanning Windows 7 through\nWindows 10 inclusive. As we mentioned earlier, this method has one drawback – it requires that the Secure Boot feature be\ndisabled in order to successfully boot with a modified boot manager. However, it’s worth mentioning that the first Windows\nversion supporting Secure Boot was Windows 8, meaning that all previous versions are vulnerable to this persistence\nmethod.\n\nFor Windows OS versions that support Secure Boot, the attacker would need to disable it. For now, it’s unknown how the\nESPecter operators achieved this, but there are a few possible scenarios:\n\nThe attacker has physical access to the device (historically known as an “evil maid” attack) and manually disables\nSecure Boot in the BIOS setup menu (it is common for the firmware configuration menu to still be labeled and referred\nto as the “BIOS setup menu”, even on UEFI systems).\nSecure Boot was already disabled on the compromised machine (e.g., user might dual-boot Windows and other OSes\nthat do not support Secure Boot).\nExploiting an unknown UEFI firmware vulnerability that allows disabling Secure Boot.\nExploiting a known UEFI firmware vulnerability in the case of an outdated firmware version or a no-longer-supported\nproduct.\n\n## Technical analysis\n\nDuring our investigation, we discovered several malicious components related to ESPecter:\n\nInstallers, only for the older MBR versions of the bootkit, whose purpose was to set up persistence on the machine by\nrewriting the MBR of the boot device.\nBoot code in the form of either a modified Windows Boot Manager (bootmgfw.efi) on UEFI systems or a malicious\nMBR in the case of Legacy Boot systems.\nA kernel-mode driver used to prepare the environment for the user-mode payloads and to load them in the early\nstages of OS startup by injecting them into specific system processes.\nUser-mode payloads responsible for communication with the C&C, updating the C&C configuration and executing\nC&C commands.\n\nFor the complete scheme of the ESPecter bootkit compromise, see Figure 3.\n\n\n-----\n\n_Figure 3. ESPecter bootkit components_\n\n### Achieving persistence – UEFI boot\n\nOn systems using UEFI Boot mode, ESPecter persistence is established by modifying the Windows Boot Manager\nbootmgfw.efi and the fallback bootloader binary bootx64.efi, which are usually located in the ESP directories\n\\EFI\\Microsoft\\Boot\\ and \\EFI\\Boot\\, respectively. Modification of the bootloader includes adding a new section called .efi to\nthe PE, and changing the executable’s entry point address so program flow jumps to the beginning of the added section, as\nseen in Figure 4.\n\n\n-----\n\n_Figure 4. Comparison of original (top) and modified (bottom) Windows Boot Manager (bootmgfw.efi)_\n\n**_Simplified boot chain_**\n\nAs shown in the scheme on the left in Figure 5, the boot process on UEFI systems (ignoring the firmware part) starts with\nexecution of the bootloader application located in the ESP. For the Windows OS, this is the Windows Boot Manager binary\n(bootmgfw.efi) and its purpose is to find an installed operating system and transfer execution to its OS kernel loader –\nwinload.efi. Similar to the boot manager, the OS kernel loader is responsible for the loading and execution of the next\ncomponent in the boot chain – the Windows kernel (ntoskrnl.exe).\n\n\n-----\n\n_Figure 5. Boot flow modified by ESPecter_\n\n**_How does ESPecter modify the UEFI boot process?_**\n\nIn order to successfully drop its malicious payload, ESPecter needs to bypass integrity checks performed by the Windows\nBoot Manager and the Windows kernel during the boot process. To do this, it looks for byte patterns identifying the desired\nfunctions in memory and patches them accordingly.\n\nStarting with the bootloader, in our case Windows Boot Manager (bootmgfw.efi), the bootkit begins by patching the\nBmFwVerifySelfIntegrity function. This function is responsible for verification of the boot manager’s own digital signature\nand is intended to prevent execution of a modified boot manager. In Figure 6 you can see how ESPecter searches memory\nfor BmFwVerifySelfIntegrity using various byte patterns (to support many bootmgfw.efi versions) and modifies this function\nin a way that it always returns zero, indicating that verification was successful.\n\nAs mentioned earlier, the bootloader’s main goal is to find an installed operating system and transfer execution to its OS\nkernel loader. For the Windows Boot Manager, this happens in the Archpx64TransferTo64BitApplicationAsm function;\ntherefore ESPecter looks for this function in order to catch the moment that the OS loader is loaded into memory but still\n\n\n-----\n\nhasn t been executed. If found, ESPecter patches this function to insert its own detour function, which can easily modify the\nloaded OS loader in memory at the right moment.\n\n_Figure 6. Hex-Rays decompiled code – searching for and patching the BmFwVerifySelfIntegrity function_\n\nModification of the OS loader does not include patching of any integrity checks or other functionality. At this stage it’s\nimportant for the bootkit to reallocate its code, because as a UEFI Application it will be unloaded from memory after\nreturning from its entry point function. For this purpose, it uses the BlImgAllocateImageBuffer or BlMmAllocateVirtualPages\nfunction (depending on the pattern found). After this reallocation, the bootkit inserts a detour (located in the previously\nallocated buffer) to the function responsible for transferring execution to the OS kernel – OslArchTransferToKernel – so it\ncan patch the Windows kernel in memory, once it is loaded but before it is executed. The final stage of the bootkit’s boot\ncode is responsible for disabling DSE by patching the SepInitializeCodeIntegrity kernel function (see Figure 7 for details).\n\n_Figure 7. Comparison of Hex-Rays decompiled SepInitializeCodeIntegrity function before (left) and after (right) it is patched in memory_\n\nInterestingly, the boot code also patches the MiComputeDriverProtection kernel function. Even though this function does\nnot directly affect successful loading of the malicious driver, the bootkit does not proceed to the driver dropping if it does not\nfind and patch this function in kernel memory. We were not able to identify the purpose of this second patch, but we assume\nthis modified function may be used by other, as yet unknown, ESPecter components.\n\n\n-----\n\n\\SystemRoot\\System32\\null.sys (driver)\n\\SystemRoot\\Temp\\syslog (encrypted configuration)\n\nThe configuration is used by the WinSys.dll user-mode component deployed by the kernel driver and consists of a one-byte\nXOR key followed by the encrypted configuration data. To decrypt the configuration, WinSys.dll:\n\n1. Base64 decodes the configuration data\n2. XORs the data with the XOR key\n3. Base64 decodes each value delimited by “|” separately\n\nAn example of a configuration dropped by the EFI version of ESPecter is presented in Figure 8. A full list of IP addresses\nand domains from configurations embedded in the ESPecter bootkit samples that we have discovered (both Legacy Boot\nand UEFI versions) is included in the IoCs section.\n\n_Figure 8. Decryption of configuration delivered by the EFI version of the ESPecter bootkit_\n\n### Achieving persistence – Legacy Boot\n\nAs already mentioned, there are ESPecter versions supporting UEFI, and others supporting Legacy Boot, modes. In the\ncase of Legacy Boot mode, persistence is achieved by the well-known technique of modifying the MBR code located in the\nfirst physical sector of the disk drive; therefore, we won’t explain it in detail here, but will just summarize it.\n\n**_How does ESPecter modify the Legacy Boot process?_**\n\nThe malicious MBR first decrypts code previously copied to disk sectors 2, 3 and 4 by the installer, hooks the real-mode\n[INT13h (BIOS sector read-write services) interrupt handler and then passes execution to the original MBR code, backed up](https://en.wikipedia.org/wiki/INT_13H)\nto the second sector (sector 1) by the installer. Similar to other known MBR bootkits, when the INT13h interrupt handler is\ninvoked, hook code (located in sector 0) checks for service 0x02 (Read sectors from drive) and 0x42 (Extended read\nsectors from drive) being handled in order to intercept loading of bootmgr – the legacy version of the Windows Boot\nManager. Note that ESPecter legacy versions do not need to patch the BmFwVerifySelfIntegrity function in bootmgr,\nbecause the bootmgr binary wasn’t modified in any way.\n\nFrom this point, the functionality of the boot code is almost the same as in the UEFI version, resulting in dropping the\nmalicious driver (located contiguously on Track 0, starting at sector 6) into one of the following locations, depending on the\narchitecture:\n\n\\SystemRoot\\System32\\drivers\\beep.sys (x86)\n\\SystemRoot\\System32\\drivers\\null.sys (x64)\n\nIn this case, the encrypted configuration is not dropped to the syslog file but stays hidden in sector 5 of the compromised\ndisk.\n\n_Figure 9. Modified disk scheme used by the legacy ESPecter version_\n\n### Kernel-mode driver\n\n\n-----\n\nThe driver s main purpose is to load user mode payloads, set up the keylogger and, in the end, delete itself. Setting up the\nkeylogger is done in two steps:\n\nAt first, it creates a device named \\Device\\WebBK that exposes a function handling IRP_MJ_DEVICE_CONTROL\nrequests from the user-mode components. This function supports one IOCTL (Input/Output Control) code\n(0x22C004), which can be used to trigger registration of an asynchronous procedure call routine responsible for\nprocessing intercepted keystrokes.\nInterception of keystrokes is done by setting up CompletionRoutine for IRP_MJ_READ requests for the keyboard\ndriver object \\Device\\KeyboardClass0.\n\nWhen done, any process can start logging intercepted keystrokes by defining its own routine and passing it to the created\ndevice object using the custom IOCTL 0x22C004.\n\nBy default, the driver tries to load two base payloads – WinSys.dll and Client.dll – which have the ability to download and\nexecute additional payloads. The first one, WinSys.dll, is an [MPRESS-packed DLL embedded in the driver’s binary in an](https://www.autohotkey.com/mpress/mpress_web.htm)\nencrypted form. The second one, Client.dll, is downloaded by WinSys.dll to the file \\SystemRoot\\Temp\\memlog, also in an\nencrypted form, using the same encryption method – a simple one-byte XOR with subtraction – but not the same keys. Both\nlibraries are decrypted and dropped to the system directory \\SystemRoot\\System32\\ by the driver.\n\nExecution of both WinSys.dll and Client.dll libraries is achieved by injecting them into svchost.exe and winlogon.exe,\nrespectively. To do this, the driver registers the image load callback routine NotifyRoutine using\nPsSetLoadImageNotifyRoutine, which is used to execute:\n\nThe MainThread export from Client.dll, in context of the winlogon.exe process\nThe MainThread export from WinSys.dll, in context of the svchost.exe process\n\nNotifyRoutine hooks the entry point of the winlogon.exe and svchost.exe process images in memory before being executed;\nthis hook is then responsible for loading and executing the appropriate payload DLL. As shown in Figure 10, only the first\nsvchost.exe or winlogon.exe image being loaded is processed by the routine.\n\n_Figure 10. Hex-Rays decompiled NotifyRoutine checking if svchost.exe or winlogon.exe is being loaded_\n\n### User-mode components – WinSys.dll\n\nWinSys.dll acts as a base update agent, which periodically contacts its C&C server in order to download or execute\nadditional payloads or execute simple commands. The C&C address, along with other values like campaign ID, bootkit\nversion, time between C&C communication attempts and active hours range, are located in the configuration, which can be\nloaded from:\n\nDefaultConfig value in HKLM\\SYSTEM\\CurrentControlSet\\Control registry\n\\SystemRoot\\Temp\\syslog file\nor directly from the specific disk sector (in the Legacy Boot version)\n\nIf both registry- and disk-stored configurations exist, the one from the registry is used.\n\n\n-----\n\n### C&C communication\n\nWinSys.dll communicates with its C&C using HTTPS and the communication is initiated by sending an HTTP GET request\nusing the following URL format:\n\nhttps://<ip>/Heart.aspx?ti=<drive_ID>&tn=<campaign_ID>&tg=<number>&tv=<malware_version>\n\nwhere drive_ID is the MD5 hash of the serial number of the main system volume and the other parameters are further\ninformation identifying this instance of the malware.\n\nAs a result, the C&C can respond with the command ID represented as a string, optionally followed by command\nparameters. The full list of commands is available in Table 1.\n\n_Table 1. WinSys component C&C commands_\n\n**Command ID** **Description** **URL**\n\n1 or 4 Exit. \n\n2 Upload various system info (CPU name, OS version, memory size,\nethernet MAC address, list of installed software, etc.) to the predefined\nURL using the HTTP POST.\n\n3 Download or download and execute file into one of the predefined\nlocations (listed in IoCs ) from the predefined URL using HTTP GET.\n\n\nhttps://<ip>/GetSysteminfo.aspx\n\nhttps://<ip>/UpLoad.aspx?ti=\n<drive_ID>\n\n\n5 Restart PC via ExitProcess (for Windows Vista only). N/A\n\n\n6 Download new configuration from the predefined URL using HTTP\nGET and save it in the registry.\n\n### User-mode components – Client.dll\n\n\nhttps://<ip>/ModifyIpaddr.aspx?\nti=<drive_ID>\n\n\nThe second payload deployed by the malicious driver, if available, is Client.dll. It’s a backdoor that supports a rich set of\ncommands (Table 2) and contains various automatic data exfiltration capabilities including document stealing, keylogging,\nand monitoring of the victim’s screen by periodically taking screenshots. All of the collected data is stored in a hidden\ndirectory, with separate subdirectories for each data source – the full list of directory paths used is available from our GitHub\nrepository. Also note that interception of the keyboard is handled by the driver and the client just needs to register its\nlogging function by sending IOCTL 0x22C004 to the driver’s device in order to save intercepted keystrokes to the file\n(Figure 11).\n\n_Figure 11. Client payload setting up keylogger function by sending IOCTL to the bootkit’s device driver_\n\nConfiguration for the Client component should be located in an encrypted form in the file’s overlay. It contains information\nsuch as the C&C address and port, flags indicating what data should be collected (keystrokes, screenshots, files with\nspecific extensions), time period for the screenshotting thread, maximum file size for exfiltrated data and a list of file\nextensions.\n\n**_C&C communication_**\n\nThe client sets its own communication channel with the C&C. For communication with the C&C, it uses the TCP protocol\nwith single-byte XOR encryption applied to non-null message bytes that are different from the key, which was 0x66 in the\ncampaign analyzed here. Communication is initiated by sending beacon messages to the IP:PORT pair specified in the\n\n\n-----\n\nconfiguration. This message contains the drive_ID value (the MD5 hash of the serial number of the main system volume)\nalong with a value specifying the type of message – that is, a command request or the uploading of collected data.\n\nAfter execution of the C&C command, the result is reported back to the C&C specifying the result code of the executed\noperation, command ID and, interestingly, each such resulting report message contains a watermark/tag representing the\nwide string WBKP located at offset 0x04, which makes it easier to identify this malicious communication at the network\nlevel.\n\n_Table 2. List of Client C&C commands_\n\n**Command ID** **Description**\n\n0x0000 Stop backdoor.\n\n0x0064 Execute command line received from C&C and capture output using pipes.\n\n0x00C8 Execute power commands logoff, power off, reboot, or shutdown, depending on the value of this C&C\ncommand’s parameter.\n\n0x012C Take screenshot of foreground window, full screenshot, or change automatic screenshotting parameters,\ndepending on the value of the parameter.\n\n0x0190 Execute various file system operations.\n\n0x01F4 Upload collected data and files.\n\n0x0258 Execute various service-related commands.\n\n0x02BC Execute various process-related commands.\n\n0x0320 Modify configuration values.\n\n0x0384 Stop/start keylogger, depending on the value of the parameter.\n\n## Conclusion\n\nESPecter shows that threat actors are relying not only on UEFI firmware implants when it comes to pre-OS persistence\nand, despite the existing security mechanisms like UEFI Secure Boot, invest their time into creating malware that would be\neasily blocked by such mechanisms, if enabled and configured correctly.\n\nTo keep safe against threats similar to the ESPecter bootkit, make sure that:\n\nYou always use the latest firmware version.\nYour system is properly configured and Secure Boot is enabled.\n[You apply proper Privileged Account Management to help prevent adversaries from accessing privileged accounts](https://attack.mitre.org/mitigations/M1026)\nnecessary for bootkit installation.\n\n## Indicators of Compromise (IoCs)\n\n[A comprehensive list of IoCs and samples can be found in our GitHub repository.](https://github.com/eset/malware-ioc/tree/master/especter)\n\n### ESET detections\n\nEFI/Rootkit.ESPecter\n\nWin32/Rootkit.ESPecter\n\nWin64/Rootkit.ESPecter\n\n### C&C IP addresses and domains from configurations\n\n196.1.2[.]111\n\n103.212.69[.]175\n\n183.90.187[.]65\n\n61.178.79[.]69\n\n\n-----\n\nswj02.gicp[.]net\nserver.microsoftassistant[.]com\nyspark.justdied[.]com\ncrystalnba[.]com\n\n### Legacy version installers\n\nABC03A234233C63330C744FDA784385273AF395B\n\nDCD42B04705B784AD62BB36E17305B6E6414F033\n\n656C263FA004BB3E6F3EE6EF6767D101869C7F7C\n\nA8B4FE8A421C86EAE060BB8BF525EF1E1FC133B2\n\n3AC6F9458A4A1A16390379621FDD230C656FC444\n\n9F6DF0A011748160B0C18FB2B44EBE9FA9D517E9\n\n2C22AE243FDC08B84B38D9580900A9A9E3823ACF\n\n08077D940F2B385FBD287D84EDB58493136C8391\n\n1D75BFB18FFC0B820CB36ACF8707343FA6679863\n\n37E49DBCEB1354D508319548A7EFBD149BFA0E8D\n\n7F501AEB51CE3232A979CCF0E11278346F746D1F\n\n### Compromised Windows Boot Manager\n\n27AD0A8A88EAB01E2B48BA19D2AAABF360ECE5B8\n\n8AB33E432C8BEE54AE759DFB5346D21387F26902\n\n## MITRE ATT&CK techniques\n\n[This table was built using version 9 of the MITRE ATT&CK framework.](https://attack.mitre.org/resources/versions/)\n\n**Tactic** **ID** **Name** **Description**\n\nExecution [T1106](https://attack.mitre.org/versions/v9/techniques/T1106/) Native API ESPecter leverages\nseveral Windows\nAPIs: VirtualAlloc,\nWriteProcessMemory,\nand\nCreateRemoteThread\nfor process injection.\n\nPersistence [T1542.003](https://attack.mitre.org/versions/v9/techniques/T1542/003/) Pre-OS Boot: Bootkit ESPecter achieves\npersistence by\ncompromising\nWindows Boot\nManager\n(bootmgfw.efi) located\non the ESP, or by\nmodifying the MBR on\nLegacy Boot systems.\n\n\n[T1547](https://attack.mitre.org/versions/v9/techniques/T1547/) Boot or Logon\nAutostart Execution\n\n\nESPecter replaces the legitimate null.sys or beep.sys driver\nwith its own malicious one in order to be executed on system\nstartup.\n\n\nDefense\nEvasion\n\n\n[T1055.001](https://attack.mitre.org/versions/v9/techniques/T1055/001/) Process Injection: Dynamic-link Library Injection ESPecter’s driver\ninjects its main usermode components\ninto svchost.exe and\nwinlogon.exe\nprocesses.\n\n\n[T1564.001](https://attack.mitre.org/versions/v9/techniques/T1564/001/) Hide Artifacts: Hidden\nFiles and Directories\n\n\nESPecter’s Client.dll component creates hidden directories\nto store collected data.\n\n\n-----\n\n**Tactic** **ID** **Name** **Description**\n\n\n[T1564.005](https://attack.mitre.org/versions/v9/techniques/T1564/005/) Hide Artifacts: Hidden\nFile System\n\n[T1140](https://attack.mitre.org/versions/v9/techniques/T1140/) Deobfuscate/Decode\nFiles or Information\n\n\nESPecter bootkit installers for Legacy Boot versions use\nunallocated disk space located right after the MBR to store\nits code, configuration and malicious driver.\n\nESPecter uses single-byte XOR with subtraction to decrypt\nuser-mode payloads.\n\n\n[T1562](https://attack.mitre.org/versions/v9/techniques/T1562/) Impair Defenses ESPecter patches Windows kernel function directly in\nmemory to disable Driver Signature Enforcement (DSE).\n\n\n[T1036.003](https://attack.mitre.org/versions/v9/techniques/T1036/003/) Masquerading:\nRename System\nUtilities\n\n\nESPecter bootkit installers for Legacy Boot versions copy\ncmd.exe to con1866.exe to evade detection.\n\n\n[T1112](https://attack.mitre.org/versions/v9/techniques/T1112/) Modify Registry ESPecter can use DefaultConfig value under\nHKLM\\SYSTEM\\CurrentControlSet\\Control to store\nconfiguration.\n\n\n[T1601.001](https://attack.mitre.org/versions/v9/techniques/T1601/001/) Modify System Image:\nPatch System Image\n\n[T1027.002](https://attack.mitre.org/versions/v9/techniques/T1027/002/) Obfuscated Files or\nInformation: Software\nPacking\n\n\nESPecter patches various functions in Windows Boot\nManager, Windows OS loader and OS kernel directly in\nmemory during the boot process.\n\nESPecter’s WinSys.dll component is packed using the\nMPRESS packer.\n\n\n[T1542.003](https://attack.mitre.org/versions/v9/techniques/T1542/003/) Pre-OS Boot: Bootkit ESPecter achieves persistence by modifying Windows Boot\nManager (bootmgfw.efi) located on the ESP or by modifying\nthe MBR on Legacy Boot systems.\n\n\n[T1553.006](https://attack.mitre.org/versions/v9/techniques/T1553/006/) Subvert Trust\nControls: Code\nSigning Policy\nModification\n\n[T1497.003](https://attack.mitre.org/versions/v9/techniques/T1497/003/) Virtualization/Sandbox\nEvasion: Time Based\nEvasion\n\n\nESPecter patches Windows kernel function\nSepInitializeCodeIntegrity directly in memory to disable\nDriver Signature Enforcement (DSE).\n\nESPecter’s WinSys.dll component can be configured to\npostpone C&C communication after execution or to\ncommunicate with the C&C only in a specified time range.\n\n\nCredential\nAccess\n\n\n[T1056.001](https://attack.mitre.org/versions/v9/techniques/T1056/001/) Input Capture: Keylogging ESPecter has a\nkeylogging capability.\n\n\nDiscovery [T1010](https://attack.mitre.org/versions/v9/techniques/T1010/) Application Window Discovery ESPecter’s Client.dll\ncomponent reports\nforeground window\nnames along with\nkeylogger information\nto provide application\ncontext.\n\n\n[T1083](https://attack.mitre.org/versions/v9/techniques/T1083/) File and Directory\nDiscovery\n\n[T1120](https://attack.mitre.org/versions/v9/techniques/T1120/) Peripheral Device\nDiscovery\n\n\nESPecter’s Client.dll component can list file information for\nspecific directories.\n\nESPecter’s Client.dll component detects the insertion of new\ndevices by listening for the WM_DEVICECHANGE window\nmessage.\n\n\n[T1057](https://attack.mitre.org/versions/v9/techniques/T1057/) Process Discovery ESPecter’s Client.dll component can list running processes\nand their loaded modules.\n\n[T1012](https://attack.mitre.org/versions/v9/techniques/T1012/) Query Registry ESPecter’s WinSys.dll component can check for installed\nsoftware under the Registry key\nHKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall.\n\n\n[T1082](https://attack.mitre.org/versions/v9/techniques/T1082/) System Information\nDiscovery\n\n\nESPecter user-mode payloads can collect system\ninformation from the victim’s machine.\n\n\n-----\n\n**Tactic** **ID** **Name** **Description**\n\n\n[T1124](https://attack.mitre.org/versions/v9/techniques/T1124/) System Time\nDiscovery\n\n\nESPecter’s WinSys.dll component can use GetLocalTime for\ntime discovery.\n\n\nCollection [T1119](https://attack.mitre.org/versions/v9/techniques/T1119/) Automated Collection ESPecter’s Client.dll\ncomponent can\nautomatically collect\nscreenshots,\nintercepted\nkeystrokes and\nvarious files.\n\n\n[T1025](https://attack.mitre.org/versions/v9/techniques/T1025/) Data from Removable\nMedia\n\n[T1074.001](https://attack.mitre.org/versions/v9/techniques/T1074/001/) Data Staged: Local\nData Staging\n\n[T1056.001](https://attack.mitre.org/versions/v9/techniques/T1056/001/) Input Capture:\nKeylogging\n\n\nESPecter’s Client.dll component can collect files with\nspecified extension from removable drives.\n\nESPecter’s Client.dll component stores automatically\ncollected data into a hidden local directory.\n\nESPecter has keylogging functionality.\n\n\n[T1113](https://attack.mitre.org/versions/v9/techniques/T1113/) Screen Capture ESPecter’s Client.dll component has screen capture\nfunctionality.\n\n\nCommand\nand Control\n\n\n[T1071.001](https://attack.mitre.org/versions/v9/techniques/T1071/001/) Application Layer Protocol: Web Protocols ESPecter’s\nWinSys.dll\ncomponent\ncommunicates with its\nC&C server over\nHTTPS.\n\n\n[T1573.001](https://attack.mitre.org/versions/v9/techniques/T1573/001/) Encrypted Channel:\nSymmetric\nCryptography\n\n\nESPecter’s Client.dll component encrypts C&C traffic using\nsingle-byte XOR.\n\n\n[T1105](https://attack.mitre.org/versions/v9/techniques/T1105/) Ingress Tool Transfer ESPecter’s user-mode components can download additional\npayloads from C&C.\n\n[T1104](https://attack.mitre.org/versions/v9/techniques/T1104/) Multi-Stage Channels ESPecter’s user-mode components use separate C&C\nchannels.\n\n\n[T1095](https://attack.mitre.org/versions/v9/techniques/T1095/) Non-Application Layer\nProtocol\n\n\nESPecter’s Client.dll component uses TCP for C&C\ncommunication.\n\n\nExfiltration [T1020](https://attack.mitre.org/versions/v9/techniques/T1020/) Automated Exfiltration ESPecter’s Client.dll\ncomponent creates a\nthread to\nautomatically upload\ncollected data to the\nC&C.\n\n\n[T1041](https://attack.mitre.org/versions/v9/techniques/T1041/) Exfiltration Over C2\nChannel\n\n\nESPecter exfiltrates data over the same channel used for\nC&C.\n\n\n[T1029](https://attack.mitre.org/versions/v9/techniques/T1029/) Scheduled Transfer ESPecter’s Client.dll component is set to upload collected\ndata to the C&C every five seconds.\n\n\n-----\n\n5 Oct 2021 - 11:30AM\n\n### Sign up to receive an email update whenever a new article is published in our Ukraine Crisis – Digital Security Resource Center\n\n Newsletter\n\n Discussion\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-10-05 - UEFI threats moving to the ESP- Introducing ESPecter bootkit.pdf"
    ],
    "report_names": [
        "2021-10-05 - UEFI threats moving to the ESP- Introducing ESPecter bootkit.pdf"
    ],
    "threat_actors": [
        {
            "id": "a3687241-9876-477b-aa13-a7c368ffda58",
            "created_at": "2022-10-25T16:07:24.496902Z",
            "updated_at": "2025-03-27T02:02:10.256629Z",
            "deleted_at": null,
            "main_name": "Hacking Team",
            "aliases": [],
            "source_name": "ETDA:Hacking Team",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "e90c06e4-e3e0-4f46-a3b5-17b84b31da62",
            "created_at": "2023-01-06T13:46:39.018236Z",
            "updated_at": "2025-03-27T02:00:02.978356Z",
            "deleted_at": null,
            "main_name": "Hacking Team",
            "aliases": [],
            "source_name": "MISPGALAXY:Hacking Team",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "e3767160-695d-4360-8b2e-d5274db3f7cd",
            "created_at": "2022-10-25T16:47:55.914348Z",
            "updated_at": "2025-03-27T02:05:17.411172Z",
            "deleted_at": null,
            "main_name": "IRON TWILIGHT",
            "aliases": [
                "ATK5 ",
                "Blue Athena ",
                "BlueDelta ",
                "FROZENLAKE ",
                "Fancy Bear ",
                "Fighting Ursa ",
                "Forest Blizzard ",
                "GRAPHITE ",
                "Group 74 ",
                "PawnStorm ",
                "STRONTIUM ",
                "Sednit ",
                "Snakemackerel ",
                "Sofacy ",
                "TG-4127 ",
                "Tsar Team ",
                "APT28 "
            ],
            "source_name": "Secureworks:IRON TWILIGHT",
            "tools": [
                " Downdelph",
                " Drovorub",
                " EVILTOSS",
                " HIDEDRV",
                " Headlace",
                " LoJack",
                " Powershell Empire",
                " SCONATO",
                " SEDUPLOADER",
                " SHARPFRONT",
                " Scaramouche",
                " Sedkit Exploit Kit",
                " Sofacy downloader",
                " X-Agent",
                " X-Tunnel",
                " Zebrocy",
                " reGeorg",
                "DEALERSCHOICE"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "730dfa6e-572d-473c-9267-ea1597d1a42b",
            "created_at": "2023-01-06T13:46:38.389985Z",
            "updated_at": "2025-03-27T02:00:02.821388Z",
            "deleted_at": null,
            "main_name": "APT28",
            "aliases": [
                "FROZENLAKE",
                "BlueDelta",
                "SNAKEMACKEREL",
                "TG-4127",
                "ITG05",
                "TA422",
                "Fancy Bear",
                "FANCY BEAR",
                "Sednit",
                "IRON TWILIGHT",
                "G0007",
                "Sofacy",
                "Forest Blizzard",
                "GruesomeLarch",
                "Pawn Storm",
                "Tsar Team",
                "STRONTIUM",
                "ATK5",
                "Blue Athena",
                "APT-C-20",
                "Group 74",
                "SIG40",
                "Grizzly Steppe",
                "Fighting Ursa",
                "T-APT-12",
                "UAC-0028"
            ],
            "source_name": "MISPGALAXY:APT28",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "ae320ed7-9a63-42ed-944b-44ada7313495",
            "created_at": "2022-10-25T15:50:23.671663Z",
            "updated_at": "2025-03-27T02:00:55.518748Z",
            "deleted_at": null,
            "main_name": "APT28",
            "aliases": [
                "APT28",
                "IRON TWILIGHT",
                "SNAKEMACKEREL",
                "Group 74",
                "Sednit",
                "Sofacy",
                "Pawn Storm",
                "Fancy Bear",
                "STRONTIUM",
                "Tsar Team",
                "Threat Group-4127",
                "TG-4127",
                "Forest Blizzard",
                "FROZENLAKE"
            ],
            "source_name": "MITRE:APT28",
            "tools": [
                "Wevtutil",
                "certutil",
                "Forfiles",
                "DealersChoice",
                "Mimikatz",
                "ADVSTORESHELL",
                "Komplex",
                "HIDEDRV",
                "JHUHUGIT",
                "Koadic",
                "Winexe",
                "XTunnel",
                "Drovorub",
                "CORESHELL",
                "OLDBAIT",
                "Downdelph",
                "XAgentOSX",
                "USBStealer",
                "Zebrocy",
                "Fysbis",
                "LoJax"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "d2516b8e-e74f-490d-8a15-43ad6763c7ab",
            "created_at": "2022-10-25T16:07:24.212584Z",
            "updated_at": "2025-03-27T02:02:10.141001Z",
            "deleted_at": null,
            "main_name": "Sofacy",
            "aliases": [
                "APT 28",
                "ATK 5",
                "Blue Athena",
                "BlueDelta",
                "FROZENLAKE",
                "Fancy Bear",
                "Fighting Ursa",
                "Forest Blizzard",
                "Grey-Cloud",
                "Grizzly Steppe",
                "Group 74",
                "GruesomeLarch",
                "ITG05",
                "Iron Twilight",
                "Operation DealersChoice",
                "Operation Dear Joohn",
                "Operation Komplex",
                "Operation Pawn Storm",
                "Operation Russian Doll",
                "Operation Steal-It",
                "Pawn Storm",
                "SIG40",
                "Sednit",
                "Snakemackerel",
                "Sofacy",
                "Strontium",
                "T-APT-12",
                "TA422",
                "TAG-0700",
                "TAG-110",
                "TG-4127",
                "Tsar Team",
                "UAC-0028",
                "UAC-0063"
            ],
            "source_name": "ETDA:Sofacy",
            "tools": [
                "ADVSTORESHELL",
                "AZZY",
                "Backdoor.SofacyX",
                "CHERRYSPY",
                "CORESHELL",
                "Carberp",
                "Computrace",
                "DealersChoice",
                "Delphacy",
                "Downdelph",
                "Downrage",
                "Drovorub",
                "EVILTOSS",
                "Foozer",
                "GAMEFISH",
                "GooseEgg",
                "Graphite",
                "HATVIBE",
                "HIDEDRV",
                "Headlace",
                "Impacket",
                "JHUHUGIT",
                "JKEYSKW",
                "Koadic",
                "Komplex",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "LoJack",
                "LoJax",
                "MASEPIE",
                "Mimikatz",
                "NETUI",
                "Nimcy",
                "OCEANMAP",
                "OLDBAIT",
                "PocoDown",
                "PocoDownloader",
                "Popr-d30",
                "ProcDump",
                "PythocyDbg",
                "SMBExec",
                "SOURFACE",
                "SPLM",
                "STEELHOOK",
                "Sasfis",
                "Sedkit",
                "Sednit",
                "Sedreco",
                "Seduploader",
                "Shunnael",
                "SkinnyBoy",
                "Sofacy",
                "SofacyCarberp",
                "SpiderLabs Responder",
                "Trojan.Shunnael",
                "Trojan.Sofacy",
                "USB Stealer",
                "USBStealer",
                "VPNFilter",
                "Win32/USBStealer",
                "WinIDS",
                "Winexe",
                "X-Agent",
                "X-Tunnel",
                "XAPS",
                "XTunnel",
                "Xagent",
                "Zebrocy",
                "Zekapab",
                "carberplike",
                "certutil",
                "certutil.exe",
                "fysbis",
                "webhp"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535785,
    "ts_updated_at": 1743041831,
    "ts_creation_date": 1653766960,
    "ts_modification_date": 1653766960,
    "files": {
        "pdf": "https://archive.orkl.eu/212b98e63ee01dcbece852e90c46aaff7c07f4b8.pdf",
        "text": "https://archive.orkl.eu/212b98e63ee01dcbece852e90c46aaff7c07f4b8.txt",
        "img": "https://archive.orkl.eu/212b98e63ee01dcbece852e90c46aaff7c07f4b8.jpg"
    }
}