{
    "id": "a61d45ea-811b-449c-9b87-9ce98f3df417",
    "created_at": "2022-10-25T16:48:25.036398Z",
    "updated_at": "2025-03-27T02:15:45.271269Z",
    "deleted_at": null,
    "sha1_hash": "9ddcf2053edf7a3ec8fb74ab679878d82c6641e7",
    "title": "",
    "authors": "",
    "file_creation_date": "2019-05-29T01:55:38Z",
    "file_modification_date": "2019-05-29T01:55:38Z",
    "file_size": 3113722,
    "plain_text": "# Emissary Panda Attacks Middle East Government Sharepoint Servers\n\n**[unit42.paloaltonetworks.com/emissary-panda-attacks-middle-east-government-sharepoint-servers](https://unit42.paloaltonetworks.com/emissary-panda-attacks-middle-east-government-sharepoint-servers/)**\n\nBy Robert Falcone and Tom Lancaster May 28, 2019\n\nExecutive Summary\n\nIn April 2019, Unit 42 observed the Emissary Panda (AKA APT27, TG-3390, Bronze Union, Lucky Mouse) threat\ngroup installing webshells on Sharepoint servers to compromise Government Organizations of two different\ncountries in the Middle East. We believe the adversary exploited a recently [patched vulnerability in Microsoft](https://support.microsoft.com/en-us/help/4462211/description-of-the-security-update-for-sharepoint-enterprise-server)\nSharePoint tracked by [CVE-2019-0604, which is a remote code execution vulnerability used to compromise the](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-0604)\nserver and eventually install a webshell. The actors uploaded a variety of tools that they used to perform\nadditional activities on the compromised network, such as dumping credentials, as well as locating and pivoting\nto additional systems on the network. Of particular note is their use of tools to identify systems vulnerable to CVE2017-0144, which is the same vulnerability exploited by EternalBlue that is best known for its use in the\nWannaCry attacks of 2017.\n\nThis activity appears related to campaigns exploiting CVE-2019-0604 mentioned in recent security alerts from\n[Saudi Arabian National Cyber Security Center and the](https://www.ncsc.gov.sa/wps/portal/ncsc/home/Alerts/!ut/p/z1/lVLRboJAEPwaH8kud-cBj2elYKkxYgpyLwYR67VyaEts-_c9apM2aYS6T3PJ3O7szIKEJUidn9Rj3qha53vzziRf2fbYDUmA9zMnGqMYzRe3QxpQMUVIQIIsdHNodpDp4rXYq_UAWzDAXV2VZ7xq4arULflQqA1khBPGiyGxkOWOxYiXW57tEWvLGS9dToi33kD6NR0njIU2I9EsRkRBkzCk7o2NAQX5W5w7cgTOEZOJmER0HvHv_x0E2b1cz3zyv_l4oQReqf-vQNndfmEcvzuTLntoIlZPx6MUJsdaN-V7A8v-INM2yh5z-uRlZj3nZ70g8bjpEDt-Evt0ljBIT6p8gwddv1TmFhdXXk-IcKgql34oU1aQWs_bqU_ZJ0-OxIA!/dz/d5/L2dBISEvZ0FBIS9nQSEh/#collapseOne1) [Canadian Center for Cyber Security. In addition to the](https://cyber.gc.ca/en/alerts/china-chopper-malware-affecting-sharepoint-servers)\naforementioned post-exploitation tools, the actors used these webshells to upload legitimate executables that they\nwould use DLL sideloading to run a malicious DLL that has code overlaps with known [Emissary Panda attacks.](https://www.nccgroup.trust/uk/about-us/newsroom-and-events/blogs/2018/may/emissary-panda-a-potential-new-malicious-tool/)\nWe also found the China Chopper webshell on the SharePoint servers, which has also been used by the\nEmissary Panda threat group.\n\nIn this blog, we provide details of the tools and tactics we observed on these compromised SharePoint servers,\nexplain how we believe these connect to the Emissary Panda threat group, correlate our findings with those of the\nSaudi Arabian National Cyber Security Center and the Canadian Center for Cyber Security, and provide indicators\nof compromise (IoCs) from our research. You can find the Adversary Playbook for the activity detailed in this blog\n[here.](https://pan-unit42.github.io/playbook_viewer/)\n\nAttack Overview\n\nThis webshell activity took place across three SharePoint servers hosted by two different government\norganizations between April 1, 2019 and April 16, 2019, where actors uploaded a total of 24 unique executables\nacross the three SharePoint servers. Figure 1 shows a timeline of when the files were uploaded to the three\nwebshells. The timeline shows three main clusters of activity across the three webshells, with activity occurring on\ntwo separate webshells (green and orange) within a very small window of time on April 2, 2019 and the activity\n\n\n-----\n\ninvolving the third webshell two weeks later on April 16, 2019. The actors uploaded several of the same tools to\nacross these three webshells, which provides a relationship between the incidents and indicates that a single\nthreat group is likely involved.\n\n_Figure 1. Timeline of file uploads across three related webshells_\n\nThe tools uploaded to the webshells range from legitimate applications such as cURL to post-exploitation tools\nsuch as Mimikatz. The threat actors also uploaded tools to scan for and exploit potential vulnerabilities in the\nnetwork, such as the well-known SMB vulnerability patched in [MS17-010 commonly exploited by EternalBlue to](https://docs.microsoft.com/en-us/security-updates/securitybulletins/2017/ms17-010)\nmove laterally to other systems on the network. We also observed the actors uploading custom backdoors such\nas [HyperBro which is commonly associated with Emissary Panda. Based on the functionality of the various tools](https://securelist.com/luckymouse-hits-national-data-center/86083/)\nuploaded to the webshells, we believe the threat actors breach the SharePoint servers to use as a beachhead,\nthen attempt to move laterally across the network via stolen credentials and exploiting vulnerabilities.\n\nWebshells Installed\n\nAs previously mentioned, we found webshells installed on three SharePoint servers hosted at two different\norganizations, two of which had the same file name of errr.aspx and the other a filename of error2.aspx. The\nwebshells were hosted at the following paths on the compromised servers:\n\n/_layouts/15/error2.aspx\n\n/_layouts/15/errr.aspx\n\nWe were able to gather one of the webshells with which we saw the actor interacting, specifically the error2.aspx\nfile listed above. The error2.aspx file (SHA256:\n006569f0a7e501e58fe15a4323eedc08f9865239131b28dc5f95f750b4767b38) is a variant of the [Antak webshell,](http://www.labofapenetrationtester.com/2014/06/introducing-antak.html)\nwhich is part of a tool created for red teaming called [Nishang. The specific variant of Antak in error2.aspx is](https://github.com/samratashok/nishang)\nversion v0.5.0, which is an older version of the webshell that was updated in August 2015 to v0.7.6 to include\nsome basic authentication functionality and the ability to perform SQL queries. It’s possible the actors obtained\nAntak v0.5.0 via the [Nishang GitHub repository or from](https://github.com/samratashok/nishang) [SecWiki’s GitHub that also has the v0.5.0 version of](https://github.com/SecWiki/WebShell-2/blob/master/Aspx/Antak%20Webshell.aspx)\nAntak. Figure 2 shows the Antak webshell loaded on one of the Sharepoint servers.\n\n\n-----\n\n_Figure 2. Antak webshell ‘error2.aspx’ used to upload post-exploitation tools_\n\nWhile we observed the threat actor uploading additional tools to the Antak webshell above, the Sharepoint server\nalso had several other webshells installed. The additional webshells, specifically stylecs.aspx, stylecss.aspx, and\ntest.aspx are listed in Table 1, and appear related to the China Chopper webshell. We cannot be sure all of these\nwebshells were installed by the same actors, as multiple actors could have exploited the SharePoint server. For\ninstance, the China Chopper-related webshells are one-line of JScript code that could be easily copied and used\nby multiple groups, and the Antak webshell is easily obtained from publicly accessible repositories. However, the\ninstallation of China Chopper and the uploading of Emissary Panda related custom payloads to the Antak\nwebshell suggests they are likely related, as this threat group has used China Chopper to compromise servers in\nthe past.\n\n**Filename** **SHA256**\n\nstylecs.aspx 2feae7574a2cc4dea2bff4eceb92e3a77cf682c0a1e78ee70be931a251794b86\n\nstylecss.aspx d1ab0dff44508bac9005e95299704a887b0ffc42734a34b30ebf6d3916053dbe\n\ntest.aspx 6b3f835acbd954af168184f57c9d8e6798898e9ee650bd543ea6f2e9d5cf6378\n\n_Table 1. Additional webshells hosted on Sharepoint server_\n\nThe stylecs.aspx webshell provides fairly significant functionality, as its developer wrote this webshell in JScript\nthat ultimately runs any supplied JScript code provided to it within the HTTP request. Figure 3 shows this\nwebshell’s code that will run supplied JScript provided in base64 encoded format within the URL within a\nparameter e358efa489f58062f10dd7316b65649e. The parameter e358efa489f58062f10dd7316b65649e is\ninteresting as it is the MD5 hash for the letter ‘t’, which is a known parameter for China Chopper as mentioned in\nthe next section.\n\n_Figure 3. China Chopper code found in stylecs.aspx webshell on SharePoint server_\n\nThe stylecss.aspx webshell is very similar to the stylecs.aspx, as it runs JScript provided within the\ne358efa489f58062f10dd7316b65649e parameter of the URL; however, the stylecss.aspx webshell does not\naccept base64 encoded JScript but expects the JScript in cleartext that the actor would provide as URL safe text\n\n\n-----\n\nFigure 4 shows the code within stylecss.aspx, which when compared to Figure 3 above shows the lack of the\nbase64 decoding function ‘FromBase64String’.\n\n_Figure 4. China Chopper code found in stylecss.aspx webshell on SharePoint server_\n\nThe last webshell extracted from the Sharepoint server had a filename of test.aspx, which is very similar to the\nstylecs.aspx webshell as it runs base64 encoded JScript provided in the URL of the request. However, the\ntest.aspx webshell uses a parameter related to the compromised organization to obtain the base64 encoded\nJScript that it will run and display within the browser. The test.aspx shell also includes code that sets the HTTP\nresponse status to a 404 Not Found, which will display an error page but will still run the provided JScript. Figure\n5 shows the code within the test.aspx file.\n\n_Figure 5. China Chopper code found in test.aspx webshell on SharePoint server_\n\nLinks to Security Advisories\n\nIn April 2019, several national security organizations released alerts on CVE-2019-0604 exploitation, including the\n[Saudi Arabian National Cyber Security Center and the](https://www.ncsc.gov.sa/wps/portal/ncsc/home/Alerts/!ut/p/z1/lVLRboJAEPwaH8kud-cBj2elYKkxYgpyLwYR67VyaEts-_c9apM2aYS6T3PJ3O7szIKEJUidn9Rj3qha53vzziRf2fbYDUmA9zMnGqMYzRe3QxpQMUVIQIIsdHNodpDp4rXYq_UAWzDAXV2VZ7xq4arULflQqA1khBPGiyGxkOWOxYiXW57tEWvLGS9dToi33kD6NR0njIU2I9EsRkRBkzCk7o2NAQX5W5w7cgTOEZOJmER0HvHv_x0E2b1cz3zyv_l4oQReqf-vQNndfmEcvzuTLntoIlZPx6MUJsdaN-V7A8v-INM2yh5z-uRlZj3nZ70g8bjpEDt-Evt0ljBIT6p8gwddv1TmFhdXXk-IcKgql34oU1aQWs_bqU_ZJ0-OxIA!/dz/d5/L2dBISEvZ0FBIS9nQSEh/#collapseOne1) [Canadian Center for Cyber Security. Both of these alerts](https://cyber.gc.ca/en/alerts/china-chopper-malware-affecting-sharepoint-servers)\ndiscussed campaigns in which actors used the CVE-2019-0604 to exploit SharePoint servers to install the China\nChopper webshell. While we cannot confirm all of the claims made in these advisories, we noticed overlaps in the\nwebshell code hosted on the compromised SharePoint servers we observed and the webshells mentioned in\nthese advisories.\n\nThe Saudi Arabian National Cyber Security Center’s alert provided details regarding the activities carried out by\nthe adversary. This alert also displayed the code associated with the China Chopper webshell observed in the\nattacks, which included Request.Item[“t”] to obtain JScript code from the ‘t’ parameter of the URL. As mentioned\nin the previous section, stylecs.aspx and stylecss.aspx both used a parameter of\ne358efa489f58062f10dd7316b65649e, which is the MD5 hash of ‘t’. This may suggest the actor modified the\nscript slightly between the attack we observed, and the attack mentioned in the NCSC advisory, all while retaining\nthe same functionality. Also, the NCSC advisory mentioned that the actors used a file name stylecss.aspx for their\nwebshell, which is the same filename we saw associated with China Chopper.\n\nThe alert from the Canadian Center for Cyber Security included the SHA256 hashes of the files associated with\nthe campaign, one of which was 05108ac3c3d708977f2d679bfa6d2eaf63b371e66428018a68efce4b6a45b4b4 for\na file named pay.aspx. The pay.aspx file is part of the China Chopper webshell and is very similar to the\nstylecss.aspx webshell we discussed above, with the only major difference is the URL parameter of\n‘vuiHWNVJAEF’ within the URL that pay.aspx webshell uses to obtain and run JScript. Figure 6 below shows a\ncomparison between the stylecss.aspx and pay.aspx files.\n\n_Figure 6. Comparison between stylecss.aspx webshell and pay.aspx webshell discussed in Canadian Center for_\n_Cyber Security advisory_\n\nTools Uploaded\n\nDuring our research into this attack campaign, Unit 42 gathered several tools that the actor uploaded to the three\nwebshells at the two government organizations. The chart in Figure 7 shows the same tools being uploaded to the\nwebshells, which provided an initial linkage between the activities. One of the overlapping tools uploaded to the\nwebshells is the legitimate cURL application, which could be used by multiple groups. The other overlapping files\nare tools used by the adversary to locate other systems on the network (etool.exe), check to see if they are\nvulnerable to CVE-2017-0144 (EternalBlue) patched in MS07-010 (checker1.exe) and pivot to them using remote\nexecution functionality offered by a tool similar to PsExec offered by [Impacket (psexec.exe). These tools are not](https://github.com/SecureAuthCorp/impacket)\n\n\n-----\n\ncustom made by the adversary but still provide a medium confidence linkage between the activities. We also\nobserved the actors uploading the HyperBro backdoor to one of the webshells, as well as legitimate executables\nthat would sideload malicious DLLs that have overlapping code associated with known Emissary Panda activity.\n\n_Figure 7. Relationships between tools uploaded to the three webshells hosted on SharePoint servers_\n\nThe actors uploaded 10 portable executables to the error2.aspx webshell, as seen in Table 2. The list of tools\nuploaded to this webshell includes legitimate applications, such as cURL and a component of Sublime Text used\nto sideload a malicious DLL, which we will discuss in an upcoming section. The list also includes several hack\ntools, such as Mimikatz for credential dumping and several compiled python scripts used to locate and\ncompromise other systems on the local network. Lastly, we saw the actor uploading a custom backdoor called\nHyperBro, which has been associated with Emissary Panda operations in the past. We will provide an analysis of\nthe HyperBro tool in an upcoming section.\n\n**Filename** **SHA256** **Description**\n\n\nm2.exe b279a41359367408c627ffa8d80051ed0f04c76f‐\nbf6aed79b3b2963203e08ade\n\npsexec.exe 7eea6e15bb13a3b65cca9405829123761bf7d12c6d‐\nc3b81ce499d8f6a0b25fb7\n\ns.exe 04f48ed27a83a57a971e73072ac5c769709306f27140227\n70fb364fd575fd462\n\ncurl.exe abc16344cdfc78f532870f4dcfb‐\nb75794c9a7074e796477382564d7ba2122c7d\n\ncurl.exe bbb9cd70fdc581812822679e6a875d‐\ncf5b7d32fd529a1d564948a5a3f6f9e3ab\n\nchecker1.exe 090cefebef655be7f879f2f14b‐\nd849ac20c4051d0c13e55410a49789738fad98\n\netool.exe 38fa396770e0ecf60fe1ce089422283e2dc8599489b‐\nd18d5eb033255dd8e370c\n\n\nplug‐\nin_host.exe\n\n\n738abaa80e8b6ed21e16302cb91f6566f9322aebf7a2246\n4f11ee9f4501da711\n\n\nPacked Mimikatz tool.\n\n[Compiled Impacket psexec](https://github.com/SecureAuthCorp/impacket/blob/master/examples/psexec.py)\n\nHyperBro backdoor\n\nLegitimate cURL\n\nLegitimate cURL\n\n[Compiled EternalBlue checker script](https://github.com/3ndG4me/AutoBlue-MS17-010/blob/master/eternalblue_checker.py)\n\nC# Tool, likely from\n[https://github.com/mubix/netview](https://github.com/mubix/netview.)\n\nLegitimate Sublime Text plugin host\n\nSideloaded DLL loaded by Sublime\nText\n\nLegitimate cURL.\n\n\nPYTHON33.dll 2dde8881cd9b43633d69d‐\nfa60f23713d7375913845ac3fe9b4d8a618660c4528\n\ncurl.exe bbb9cd70fdc581812822679e6a875d‐\ncf5b7d32fd529a1d564948a5a3f6f9e3ab\n\n\n_Table 2. Unique tools uploaded to the error2.aspx webshell installed on a SharePoint server_\n\n\n-----\n\nWe saw 17 tools uploaded to the errr.aspx webshell hosted on the SharePoint server of one of the government\norganizations, which is in the middle of the chart in Figure 8. Table 3 shows all of the tools we observed the actor\nuploading to the webshell, which includes a list of tools used to dump credentials, locate, and exploit remote\nsystems, as well as pivoting to other systems on the network.\n\n**Filename** **SHA256** **Description**\n\n\nsmb1.exe 88027a44dc82a97e21f04121eea2e86b4ddf1bd7b‐\nbaa4ad009b97b50307570bd\n\n\nSMB backdoor based on\n[smbrelay3](https://github.com/abatchy17/WindowsExploits/blob/master/MS08-068/src/smbrelay3.cpp)\n\n\nmcmd.exe 738128b4f42c8d2335d68383d72734130c0c4184725c06851498a4cf0374a841 [Compiled zzz_exploit.py](https://github.com/worawit/MS17-010/blob/master/zzz_exploit.py)\n\nmcafee.exe 3bca0bb708c5dad1c683c6ead857a5ebfa15928a59211432459a3efa6a1afc59 [Compiled zzz_exploit.py](https://github.com/worawit/MS17-010/blob/master/zzz_exploit.py)\n\ndump.exe 29897f2ae25017455f904595872f2430b5f7fedd00ff1a46f1ea77e50940128e pwdump\n\n\nchecker1.exe d0df8e1dcf30785a964ecdda9bd86374d35960e1817b25a6b0963‐\nda38e0b1333\n\nmemory.exe a18326f929229da53d4cc340b‐\nde830f75e810122c58b523460c8d6ba62ede0e5\n\n\n[Compiled MS17-010 checker](https://github.com/worawit/MS17-010/blob/master/checker.py)\n\nPacked Mimikatz\n\n\nchecker.exe 090cefebef655be7f879f2f14bd849ac20c4051d0c13e55410a49789738fad98 [Compiled MS17-010 checker](https://github.com/worawit/MS17-010/blob/master/checker.py)\n\npsexec.exe 7eea6e15bb13a3b65cca9405829123761bf7d12c6dc3b81ce499d8f6a0b25fb7 [Compiled Impacket psexec.](https://github.com/SecureAuthCorp/impacket/blob/master/examples/psexec.py)\n\netool.exe 38fa396770e0ecf60fe1ce089422283e2dc8599489bd18d5eb033255dd8e370c C# Tool, likely from\n[https://github.com/mubix/netview](https://github.com/mubix/netview)\n\nsmb.exe 4a26ec5fd16ee13d869d6b0b6177e570444f6a007759ea94f1aa18fa831290a8 SMB backdoor based on\n[smbrelay3](https://github.com/abatchy17/WindowsExploits/blob/master/MS08-068/src/smbrelay3.cpp)\n\n\nagent_Win32.exe b2b2e900aa2e96ff44610032063012aa0435a47a5b416c384b‐\nd6e4e58a048ac9\n\n\n[Termite](https://klionsec.github.io/2017/11/02/termite/)\n\n\nsmb_exec.exe 475c7e88a6d73e619ec585a7c9e6e57d2efc8298b688ebc10a3c703322f1a4a7 [httprelay](https://github.com/abatchy17/WindowsExploits/blob/master/MS08-068/src/httprelay.cpp)\n\ncurl.exe bbb9cd70fdc581812822679e6a875dcf5b7d32fd529a1d564948a5a3f6f9e3ab Legitimate cURL\n\nincognito.exe 9f5f3a9ce156213445d08d1a9ea99356d2136924dc28a8ceca6d528f9dbd718b [Incognito](https://github.com/mwrlabs/incognito)\n\nnbtscan.exe c9d5dc956841e000bfd8762e2f0b48b66c79b79500e894b4efa7fb9ba17e4e9e nbtscan\n\nfgdump.exe a6cad2d0f8dc05246846d2a9618fc93b7d97681331d5826f8353e7c3a3206e86 pwdump\n\nsmbexec.exe e781ce2d795c5dd6b0a5b849a414f5bd05bb99785f2ebf36edb70399205817ee [Compiled Impacket smbexec](https://github.com/SecureAuthCorp/impacket/blob/master/examples/smbexec.py)\n\n_Table 3. Unique tools uploaded to the errr.aspx webshell installed on a SharePoint server_\n\nTwo of the tools, specifically the compiled zzz_exploit.py and checker.py suggest the actor would check and\nexploit remote systems if they were not patched for MS17-010, which patched the CVE-2017-0144 (EternalBlue)\nvulnerability. Also, the use of the Mimikatz and pwdump tools suggests the adversary attempts to dump\ncredentials on compromised systems. We were able to gather the command line arguments the actor used to run\nthe SMB backdoor smb1.exe. The following arguments shows the actor using the SMB backdoor to attempt to run\na batch script m.bat on a remote host using a domain username and the account’s password hash:\n\nc:\\programdata\\smb1.exe <redacted 10.0.0.0/8 IP> <redacted domain>\\<redacted username> :<redacted\npassword hash> winsk c:\\programdata\\m.bat\n\nWe saw far fewer portable executable files uploaded to the second errr.aspx webshell, specifically the 3 files seen\nin Table 4. The files uploaded to this webshell included the same compiled python script that would scan remote\nsystems that were vulnerable to CVE-2017-0144 (EternalBlue) that we saw uploaded to the other errr.aspx\nwebshell. Also, we observed the actor uploading a legitimate Microsoft application that would sideload a malicious\nDLL, of which was very similar to the DLL sideloaded by the Sublime Text plugin host that was uploaded to the\nerror2.aspx webshell.\n\n**Filename** **SHA256** **Description**\n\n\n-----\n\nchecker1.exe d0df8e1dcf30785a964ecdda9b‐\nd86374d35960e1817b25a6b0963da38e0b1333\n\n\nCreateMedi‐\na.exe\n\nCreateTsMe‐\ndiaAdm.dll\n\n\n2b‐\nb22c7b97e4c4d07e17a259cbc48d72f7e3935aa873e3d‐\nd78d01c5bbf426088\n\n06510504f30feb1adc7e423d5a24e67e5b97acb‐\nfafe40f253a054be8b1c4e8d7\n\n\n[Compiled MS17-010 checker](https://github.com/worawit/MS17-010/blob/master/checker.py)\n\nLegitimate CreateMedia.exe application\nfrom Microsoft’s System Center 2012\nConfiguration Manager\n\nSideloaded DLL loaded by\nCreateMedia.exe\n\n\n_Table 4. Unique tools uploaded to the errr.aspx webshell installed on a SharePoint server_\n\nEmissary Panda Specific Tools\n\nMany of the tools uploaded to these webshells are hacking tools that are publicly accessible and could be used by\nmultiple threat actors. However, several of the tools uploaded to the webshells appear to be custom made and\nlikely related to the Emissary Panda threat group.\n\nHyperBro\n\nThe s.exe (SHA256: 04f48ed27a83a57a971e73072ac5c769709306f2714022770fb364fd575fd462) uploaded to\nthe error2.aspx webshell is a self-extracting 7-zip archive that is an example of the HyperBro backdoor. According\nto [Kaspersky and](https://securelist.com/luckymouse-hits-national-data-center/86083/) [SecureWorks research, HyperBro is a custom backdoor developed and used by Emissary](https://www.secureworks.com/research/a-peek-into-bronze-unions-toolbox)\nPanda in their attack campaigns. This sample of HyperBro is similar to the sample discussed in Kaspersky’s\nresearch, specifically using a legitimate pcAnywhere application to sideload a DLL to decrypt, decompress and\nrun a payload embedded within a file named ‘thumb.db’. Table 5 shows the three files associated with this\nHyperBro sample, which have the same file names as the self-extracting 7zip archives mentioned in Kaspersky’s\nblog (SHA256 hashes: 34a542356ac8a3f6e367c6827b728e18e905c71574b3813f163e043f70aa3bfa and\n2144aa68c7b2a6e3511e482d6759895210cf60c67f14b9485a0236af925d8233).\n\n**Filename** **SHA256** **Description**\n\n\nthin‐\nprobe.exe\n\nthinhost‐\nprobedll.dll\n\n\n76d2e897ca235beab44ee7eaab9ede7bc7868bbaeb7d6cb10b4323c07e‐\nb216af\n\n\nd40414b1173d59597ed1122361fe60303d3526f15320aede355c6ad9e7e239af Sideloaded DLL\nloaded by\nthinprobe.exe\n\n\nSymantec\npcAnywhere thin‐\nprobe application\n\n\nthumb.db 270ea24f2cef655bd89439ab76c1d49c80caaa8899ffa6f0ef36dc1beb894530 Contains encrypted\nand compressed DLL\npayload run by side‐\nloaded DLL\n\n_Table 5. Files associated with the HyperBro tool uploaded to webshell on SharePoint server_\n\nThe functional payload is a DLL compiled on 2019-03-11 02:23:54, which has two functionalities depending if the\nbinary has a command line argument -daemon or -worker passed to it. The daemon functionality handles the C2\ncommunications portion of the Trojan, which is configured to communicate with 185.12.45[.]134 over HTTPS\nusing the following URL:\n\nhxxps://185.12.45[.]134:443/ajax\n\nThe worker functionality acts on the data received from the C2 server, which is passed from the daemon to the\nworker via a named pipe called “\\\\.\\pipe\\testpipe“. The worker subjects the received data to a command handler\nwhose available commands are listed in Table 6.\n\n**Command** **Sub-command** **Description**\n\n0x12 File manager\n\n0x10 Enumerate logical storage volumes\n\n\n-----\n\n0x11 Delete a specified file\n\n0x12 Upload a file\n\n0x13 Download a file\n\n0x17 List contents of a folder\n\n0x19 Run an application (CreateProcessW) or script/file (ShellExecuteW)\n\n0x13 Execute command on shell\n\n0x16 Takes screenshot\n\n0x19 Runs shellcode it injects into a newly created process ‘msiexec.exe’\n\n0x1a Kill specific process\n\n0x1e Service manager\n\n0x17 List all services and their configurations\n\n0x19 Start a specified service\n\n0x1a Stop a specified service\n\n_Table 6. The commands available within the HyperBro tool’s command handler_\n\nUnknown Sideloaded Payloads\n\nTable 2 and 4 above include two legitimate executables used for DLL sideloading, specifically the plugin_host.exe\napplication for Sublime Text and the CreateMedia.exe application from Microsoft’s System Center 2012\nConfiguration Manager. The plugin_host.exe application imports several functions from a library named python33,\nwhich is how the legitimate application sideloads the malicious DLL named PYTHON33.dll. This is the first\ninstance we have observed Sublime Text’s plugin host application used for sideloading. Like the plugin host\napplication, the CreateMedia.exe application imports several functions from a library named CreateTsMediaAdm\nthat is leveraged to load the malicious DLL named CreateTsMediaAdm.dll.\n\nThe PYTHON33.dll and the CreateTsMediaAdm.dll libraries are very similar with BinDiff providing a 97% similarity\nwith 99% confidence between the two DLLs. The code diff in Figure 8 shows the decryption routine in\nPYTHON33.dll (right) and CreateTsMediaAdm.dll (left), both of which use an eight byte XOR key to decrypt a\npiece of shikata_ga_nai obfuscated shellcode. The shellcode is responsible for patching the entry point of the\nlegitimate application to call another function in the shellcode that is responsible for loading a file with the library\nname with an .hlp extension (PYTHON33.hlp or CreateTsMediaAdm.hlp).\n\n\n-----\n\n_Figure 8. Code comparison between the sideloaded CreateTsMediaAdm.dll and PYTHON33.dll files uploaded to_\n_two webshells_\n\nUnfortunately, we do not have access to the PYTHON33.hlp or CreateTsMediaAdm.hlp files, so we do not know\nthe final payload loaded by either of these DLLs. However, using [NCC Group’s research published in May 2018,](https://www.nccgroup.trust/uk/about-us/newsroom-and-events/blogs/2018/may/emissary-panda-a-potential-new-malicious-tool/)\nwe were able to discover code overlaps between these DLLs and a sideloaded DLL that ran the SysUpdate tool\nthat the NCC group has associated with an Emissary Panda campaign. Figure 9 shows a code comparison\nbetween the PYTHON33.dll (right) and inicore_v2.3.30.dll (left) (SHA256:\n4d65d371a789aabe1beadcc10b38da1f998cd3ec87d4cc1cfbf0af014b783822), which was sideloaded to run the\nSysUpdate tool in a previous Emissary Panda campaign. The code overlaps below include the same technique to\nfind the entry point of the loading executable and decrypting the first piece of shellcode used to patch the entry\npoint.\n\n_Figure 9. Code comparison between the sideloaded PYTHON33.dll uploaded to webshell and the_\n_inicore_v2.3.30.dll file sideloaded in previous Emissary Panda_ _attacks_\n\n\n-----\n\nConclusion\n\nThe Emissary Panda threat group loaded the China Chopper webshell onto SharePoint servers at two\nGovernment organizations in the Middle East, which we believe with high confidence involved exploiting a remote\ncode execution vulnerability in SharePoint tracked in CVE-2019-0604. According to [Microsoft’s advisory, this](https://support.microsoft.com/en-us/help/4462211/description-of-the-security-update-for-sharepoint-enterprise-server)\nvulnerability was patched on March 12, 2019 and we first saw the webshell activity on April 1, 2019. This suggests\nthat the threat group was able to quickly leverage a known vulnerability to exploit Internet facing servers to gain\naccess to targeted networks.\n\nOnce the adversary established a foothold on the targeted network, they used China Chopper and other\nwebshells to upload additional tools to the SharePoint server to dump credentials, perform network\nreconnaissance and pivot to other systems. We believe the actors pivoted to other systems on the network using\nstolen credentials and by exploiting the CVE-2017-0144 (EternalBlue) vulnerability patched in MS17-010. We also\nobserved the actors uploading legitimate tools that would sideload DLLs, specifically the Sublime Text plugin host\nand the Microsoft’s Create Media application, both of which we had never seen used for DLL sideloading before.\n\nPalo Alto Networks customers are protected by:\n\nThe CVE-2019-0604 vulnerability is covered by our IPS signature Microsoft Sharepoint Remote Code\nExecution Vulnerability (55411)\nAll illegitimate tools uploaded to the webshells are marked with malicious verdicts by WildFire\nAutoFocus customers can track the custom Emissary Panda payload seen uploaded to the webshell using\nthe [HyperBro tag, but can also track the hack tools using the following tags (note the hack tools are used by](https://autofocus.paloaltonetworks.com/#/tag/Unit42.HyperBro)\nmultiple actors and not just Emissary Panda):\n\nPalo Alto Networks has shared our findings, including file samples and indicators of compromise, in this report\nwith our fellow Cyber Threat Alliance members. CTA members use this intelligence to rapidly deploy protections\nto their customers and to systematically disrupt malicious cyber actors. For more information on the Cyber Threat\n[Alliance, visitwww.cyberthreatalliance.org.](http://www.cyberthreatalliance.org/)\n\nIOCs\n\nWebshells SHA256\n\n006569f0a7e501e58fe15a4323eedc08f9865239131b28dc5f95f750b4767b38\n\n2feae7574a2cc4dea2bff4eceb92e3a77cf682c0a1e78ee70be931a251794b86\n\nd1ab0dff44508bac9005e95299704a887b0ffc42734a34b30ebf6d3916053dbe\n\n6b3f835acbd954af168184f57c9d8e6798898e9ee650bd543ea6f2e9d5cf6378\n\nMalicious HackTools and Payloads SHA256\n\n88027a44dc82a97e21f04121eea2e86b4ddf1bd7bbaa4ad009b97b50307570bd\n\n738128b4f42c8d2335d68383d72734130c0c4184725c06851498a4cf0374a841\n\n3bca0bb708c5dad1c683c6ead857a5ebfa15928a59211432459a3efa6a1afc59\n\n29897f2ae25017455f904595872f2430b5f7fedd00ff1a46f1ea77e50940128e\n\nd0df8e1dcf30785a964ecdda9bd86374d35960e1817b25a6b0963da38e0b1333\n\na18326f929229da53d4cc340bde830f75e810122c58b523460c8d6ba62ede0e5\n\n090cefebef655be7f879f2f14bd849ac20c4051d0c13e55410a49789738fad98\n\n7eea6e15bb13a3b65cca9405829123761bf7d12c6dc3b81ce499d8f6a0b25fb7\n\n38fa396770e0ecf60fe1ce089422283e2dc8599489bd18d5eb033255dd8e370c\n\n4a26ec5fd16ee13d869d6b0b6177e570444f6a007759ea94f1aa18fa831290a8\n\n\n-----\n\nb2b2e900aa2e96ff44610032063012aa0435a47a5b416c384bd6e4e58a048ac9\n\n475c7e88a6d73e619ec585a7c9e6e57d2efc8298b688ebc10a3c703322f1a4a7\n\n9f5f3a9ce156213445d08d1a9ea99356d2136924dc28a8ceca6d528f9dbd718b\n\nc9d5dc956841e000bfd8762e2f0b48b66c79b79500e894b4efa7fb9ba17e4e9e\n\na6cad2d0f8dc05246846d2a9618fc93b7d97681331d5826f8353e7c3a3206e86\n\ne781ce2d795c5dd6b0a5b849a414f5bd05bb99785f2ebf36edb70399205817ee\n\nd0df8e1dcf30785a964ecdda9bd86374d35960e1817b25a6b0963da38e0b1333\n\n06510504f30feb1adc7e423d5a24e67e5b97acbfafe40f253a054be8b1c4e8d7\n\nb279a41359367408c627ffa8d80051ed0f04c76fbf6aed79b3b2963203e08ade\n\n7eea6e15bb13a3b65cca9405829123761bf7d12c6dc3b81ce499d8f6a0b25fb7\n\n04f48ed27a83a57a971e73072ac5c769709306f2714022770fb364fd575fd462\n\n090cefebef655be7f879f2f14bd849ac20c4051d0c13e55410a49789738fad98\n\n38fa396770e0ecf60fe1ce089422283e2dc8599489bd18d5eb033255dd8e370c\n\n2dde8881cd9b43633d69dfa60f23713d7375913845ac3fe9b4d8a618660c4528\n\nHyperBro C2\n\nhxxps://185.12.45[.]134:443/ajax\n\n185.12.45[.]134\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2019/2019.05.28.Emissary_Panda/Emissary%20Panda%20Attacks%20Middle%20East%20Government%20Sharepoint%20Servers.pdf"
    ],
    "report_names": [
        "Emissary Panda Attacks Middle East Government Sharepoint Servers"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "2f07a03f-eb1f-47c8-a8e9-a1a00f2ec253",
            "created_at": "2022-10-25T16:07:24.277669Z",
            "updated_at": "2025-03-27T02:02:10.157972Z",
            "deleted_at": null,
            "main_name": "TA428",
            "aliases": [
                "Operation LagTime IT",
                "Operation StealthyTrident",
                "ThunderCats"
            ],
            "source_name": "ETDA:TA428",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "Agent.dhwf",
                "Albaniiutas",
                "BlueTraveller",
                "Chymine",
                "Cotx RAT",
                "CoughingDown",
                "Darkmoon",
                "Destroy RAT",
                "DestroyRAT",
                "Gen:Trojan.Heur.PT",
                "Kaba",
                "Korplug",
                "LuckyBack",
                "PhantomNet",
                "PlugX",
                "Poison Ivy",
                "RedDelta",
                "RoyalRoad",
                "SManager",
                "SPIVY",
                "Sogu",
                "TIGERPLUG",
                "TManger",
                "TVT",
                "Thoper",
                "Xamtrav",
                "pivy",
                "poisonivy"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "e3492534-85a6-4c87-a754-5ae4a56d7c8c",
            "created_at": "2022-10-25T15:50:23.819113Z",
            "updated_at": "2025-03-27T02:00:55.552554Z",
            "deleted_at": null,
            "main_name": "Threat Group-3390",
            "aliases": [
                "Threat Group-3390",
                "Earth Smilodon",
                "TG-3390",
                "Emissary Panda",
                "BRONZE UNION",
                "APT27",
                "Iron Tiger",
                "LuckyMouse"
            ],
            "source_name": "MITRE:Threat Group-3390",
            "tools": [
                "Systeminfo",
                "gsecdump",
                "PlugX",
                "ASPXSpy",
                "Cobalt Strike",
                "Mimikatz",
                "Impacket",
                "gh0st RAT",
                "certutil",
                "China Chopper",
                "HTTPBrowser",
                "Tasklist",
                "netstat",
                "SysUpdate",
                "HyperBro",
                "ZxShell",
                "RCSession",
                "ipconfig",
                "Clambling",
                "pwdump",
                "NBTscan",
                "Pandora",
                "Windows Credential Editor"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "2c980ea7-04c4-4193-8535-52f87e66a96e",
            "created_at": "2024-05-01T02:03:07.994126Z",
            "updated_at": "2025-03-27T02:05:17.293799Z",
            "deleted_at": null,
            "main_name": "BRONZE UNION",
            "aliases": [
                "Budworm ",
                "Emissary Panda ",
                "Iron Tiger ",
                "Lucky Mouse ",
                "TG-3390 ",
                "Temp.Hippo ",
                "APT27 "
            ],
            "source_name": "Secureworks:BRONZE UNION",
            "tools": [
                " ASPXSpy",
                " China Chopper",
                " Enfal",
                " Gh0st RAT",
                " HttpBrowser",
                " Hunter",
                " HyperBro",
                " OwaAuth",
                " PlugX",
                " PoisonIvy",
                " Sysupdate",
                " ZxShell",
                "9002"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "c63ab035-f9f2-4723-959b-97a7b98b5942",
            "created_at": "2023-01-06T13:46:38.298354Z",
            "updated_at": "2025-03-27T02:00:02.798255Z",
            "deleted_at": null,
            "main_name": "APT27",
            "aliases": [
                "TG-3390",
                "EMISSARY PANDA",
                "TEMP.Hippo",
                "Budworm",
                "Group 35",
                "BRONZE UNION",
                "Lucky Mouse",
                "Iron Taurus",
                "GreedyTaotie",
                "Red Phoenix",
                "ZipToken",
                "Iron Tiger",
                "G0027",
                "Earth Smilodon"
            ],
            "source_name": "MISPGALAXY:APT27",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "5c13338b-eaed-429a-9437-f5015aa98276",
            "created_at": "2022-10-25T16:07:23.582715Z",
            "updated_at": "2025-03-27T02:02:09.875151Z",
            "deleted_at": null,
            "main_name": "Emissary Panda",
            "aliases": [
                "APT 27",
                "ATK 15",
                "Bronze Union",
                "Budworm",
                "Earth Smilodon",
                "Emissary Panda",
                "Group 35",
                "Iron Taurus",
                "Iron Tiger",
                "LuckyMouse",
                "Operation DRBControl",
                "Operation Iron Tiger",
                "Operation PZChao",
                "Operation SpoiledLegacy",
                "Operation StealthyTrident",
                "Red Phoenix",
                "TEMP.Hippo",
                "TG-3390",
                "ZipToken"
            ],
            "source_name": "ETDA:Emissary Panda",
            "tools": [
                "ASPXSpy",
                "ASPXTool",
                "Agent.dhwf",
                "AngryRebel",
                "Antak",
                "CHINACHOPPER",
                "China Chopper",
                "Destroy RAT",
                "DestroyRAT",
                "FOCUSFJORD",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "HTTPBrowser",
                "HTran",
                "HUC Packet Transmit Tool",
                "HighShell",
                "HttpBrowser RAT",
                "HttpDump",
                "HyperBro",
                "HyperSSL",
                "HyperShell",
                "Kaba",
                "Korplug",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Mimikatz",
                "Moudour",
                "Mydoor",
                "Nishang",
                "OwaAuth",
                "PCRat",
                "PlugX",
                "ProcDump",
                "PsExec",
                "RedDelta",
                "SEASHARPEE",
                "Sensocode",
                "SinoChopper",
                "Sogu",
                "SysUpdate",
                "TIGERPLUG",
                "TVT",
                "Thoper",
                "Token Control",
                "TokenControl",
                "TwoFace",
                "WCE",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "Xamtrav",
                "ZXShell",
                "gsecdump",
                "luckyowa"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716505,
    "ts_updated_at": 1743041745,
    "ts_creation_date": 1559094938,
    "ts_modification_date": 1559094938,
    "files": {
        "pdf": "https://archive.orkl.eu/9ddcf2053edf7a3ec8fb74ab679878d82c6641e7.pdf",
        "text": "https://archive.orkl.eu/9ddcf2053edf7a3ec8fb74ab679878d82c6641e7.txt",
        "img": "https://archive.orkl.eu/9ddcf2053edf7a3ec8fb74ab679878d82c6641e7.jpg"
    }
}