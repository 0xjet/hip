{
    "id": "e8bf78c5-12a9-4a0a-a078-3b72eeb1474e",
    "created_at": "2023-01-12T15:01:40.979155Z",
    "updated_at": "2025-03-27T02:05:55.591969Z",
    "deleted_at": null,
    "sha1_hash": "1f974be38350d71e5f118b0386e174cae7446d37",
    "title": "2022-01-18 - Analysis of Destructive Malware (WhisperGate) targeting Ukraine",
    "authors": "",
    "file_creation_date": "2022-05-27T21:38:25Z",
    "file_modification_date": "2022-05-27T21:38:25Z",
    "file_size": 2239639,
    "plain_text": "# Analysis of Destructive Malware (WhisperGate) targeting Ukraine\n\n**[medium.com/s2wblog/analysis-of-destructive-malware-whispergate-targeting-ukraine-9d5d158f19f3](https://medium.com/s2wblog/analysis-of-destructive-malware-whispergate-targeting-ukraine-9d5d158f19f3)**\n\nS2W January 19, 2022\n\n[S2W](https://medium.com/@s2w?source=post_page-----9d5d158f19f3--------------------------------)\n\nJan 18\n\n\n5 min read\n\nBLKSMTH | S2W TALON\n\nPhoto by on\n\n## Executive Summary\n\n2022–01–15, MSTIC (Microsoft Threat Intelligence Center) identified and unveiled a cyberattack\ntargeting Ukrainian organizations with “” overwrites Master Boot Record(MBR) and files.\n```\nAn actor who conducted this attack tracked as and has not yet been attributed to existing groups\n\n```\nIt was confirmed that the actor uses a tool “” to perform `lateral movement and` `malware`\n```\n   execution .\nKnown working paths: C:\\PerfLogs, C:\\ProgramData, C:\\, C:\\temp\n\n```\nThe flow consisting of a total of three stages revealed so far is as follows.\n```\n: Overwrites the MBR and destroy all partitions: Downloads Stage3 through the discord link: Executes\nfile wiper & AdvancedRun.exe after decoding resources\n\n```\n\n-----\n\nFlow chart\n\nThe malware sets used in this attack not only overwrites the MBR and create a ransom note but also\noverwrites files without any backups, so it seems that the purpose is data destruction, not financial\ngain.\nAs additional samples such as Stage3 are being shared among analysts on Twitter in addition to the\ntwo samples currently released by MSTIC, the IoC, and analysis reports will be continuously updated.\n\n## Detailed Analysis\n\n Stage1\n\nSHA256: a196c6b8ffcb97ffb276d04f354696e2391311db3841ae16c8c9f56f36a38e92\nCreation Time: 2022–01–10 10:37:18\nFirst Submission: 2022–01–16 20:30:19\nFile Type: Win32 EXE\n\nStage1 directly accesses the MBR(Master Boot Record) and overwrites with the 0x200 size data that is\nhard-coded inside. After that, when the PC is rebooted, the overwritten code is executed, and the code\ntraverses all drives on the disk and overwrites it with specific data at intervals of 199 LBAs.\n\nOverwrites MBR\nThe overwritten code reads the ransom note string inside the MBR and sets it to appear on the display\n\n\n-----\n\nWrites ransom note on the display\nAfter that, it traverses from the C drive and attempts to destroy it by overwriting it with fixed data as\nExtended Write mode.\n\nDrives wiper code\nDisk Address Packet(DAP) structure initialized when malicious code writes to disk\n\n(0x7C72) (offset 0 size 1) : size of packet (16 bytes)\n(0x7C73) (offset 1 size 1) : Reserved (always 0)\n\n\n-----\n\n(0x7C74) (offset 2 size 2) : number of sectors to transfer\n(0x7C76) (offset 4 size 4) : transfer buffer (segment:offset)\n(0x7C7A) (offset 8 size 4) : lower 32-bits of 48-bit starting LBA\n(0x7C7E) (offset 12 size 4) : upper 16-bits of 48-bit starting LBA\n\nWrite starts from LBA#1 of disk\n\nWhen disk access is successful, LBA is increased by 0xC7 (199) and written\nWhen disk access fails, increase the Drive Index and try to access the next disk\n\nOverwritten drives\n\n## Stage2\n\nSHA256: dcbbae5a1c61dbbbb7dcd6dc5dd1eb1169f5329958d38b58c3fd9384081c9b78\nCreation Time: 2022–01–10 14:39:54\nFirst Submission: 2022–01–16 20:31:26\nFile Type: Win32 EXE\n\nStage2 does not perform malicious actions for 20 seconds to bypass the AV (Anti Virus). To do this, run the\nfollowing command twice.\n\nCommand: powershell -enc UwB0AGEAcgB0AC0AUwBsAGUAZQBwACAALQBzACAAMQAwAA==\n\n—> Start-Sleep -s 10\n\nThen, it downloads an additional file disguised as a JPG extension from the discord link. The downloaded file\nis reversed and takes the form of PE, and executes “Ylfwdwgmpilzyaph” method in the file in the memory.\n\n\n-----\n\nStage3 payload downloaded via Discord link\n\nURL:\nhttps[:]//cdn.discordapp[.]com/attachments/928503440139771947/930108637681184768/Tbopbh.jpg\n\n## Stage3 (Tbopbh.jpg)\n\n: 923eb77b3c9e11d6c56052318c119c1a22d11ab71675e6b95d05eeb73d1accd6\n\n**Tbopbh.jpg (Reversed)**\n\n: 9ef7dbd3da51332a78eff19146d21c82957821e464e8133e9594a07d716d892d\n: 2022–01–10 14:39:31\n: 2022–01–16 21:29:58\n: Win32 DLL\n\nThe downloaded Stage3 is written in C# as in Stage2, and an obfuscation tool called Eazfuscator is\ndetected by exeinfoPE.\n\nDetected Eazfuscator\nThere are 3 resources inside Stage3, and except for the resource “78c855a088924e92a7f60d661c3d1845 ”,\nthe use of the remaining 2 resources has not yet been confirmed, and the contents will be updated later.\n\n\n-----\n\n3 resources inside Stage3\nStage3 loads “78c855a088924e92a7f60d661c3d1845 ” resource inside and performs decoding by XOR\noperation.\n\nXOR decoding code\nNext, the decoded data is a DLL file and contains two additional resources. The two resources\n“AdvancedRun” and “Waqybg”, are extracted by Stage3, and decompressed with GZIP.\n\nAdvancedRun (GZIP Decompressed)\nWaqybg (Reversed and GZIP Decompressed)\n\n\n-----\n\n2 resources in the decoded resource\n\n1. : Stop Windows Defender service\n\nExecute “%Temp%Nmddfrqqrbyjeygggda.vbs” to specify “C:\\” as the exception folder\n\nCommand: C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe” Set-MpPreference ExclusionPath ‘C:\\’\n\nStop Windows Defender service through AdvancedRun.exe and delete\n“C:\\ProgramData\\Microsoft\\Windows Defender” directory\n\nCommand: “C:\\Users\\Administrator\\AppData\\Local\\Temp\\AdvancedRun.exe” /EXEFilename\n“C:\\Windows\\System32\\sc.exe” /WindowState 0 /CommandLine “stop WinDefend” /StartDirectory “”\n/RunAs 8 /Run\n\nCommand: “C:\\Users\\Administrator\\AppData\\Local\\Temp\\AdvancedRun.exe” /EXEFilename\n“C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe” /WindowState 0 /CommandLine\n“rmdir ‘C:\\ProgramData\\Microsoft\\Windows Defender’ -Recurse” /StartDirectory “” /RunAs 8 /Run\n\n2. Waqybg: Overwrites target files\n\nOverwrites the 0x100000(1MB) of the file with 0xCC\nExtension: Random number\n\nOverwrites files\n\nTarget file extensions (106)\n\n\n-----\n\n```\n.MSG .EML .TXT .CSV .RTF .WKS .WK1 .PDF .DWG .JPEG .JPG .DOCM .DOT .DOTM .XLSM .XLSB .XLW .XLT .XLM\n.XLC .XLTX .XLTM .PPTM .POT .PPS .PPSM .PPSX .HWP .SXI .STI .SLDX .SLDM .BMP .PNG .GIF .RAW .TIF\n.TIFF .PSD .SVG .CLASS .JAR .SCH .VBS .BAT .CMD .ASM .PAS .CPP .SXM .STD .SXD .ODP .WB2 .SLK .DIF\n.STC .SXC .ODS .3DM .MAX .3DS .STW .SXW .ODT .PEM .P12 .CSR .CRT .KEY .PFX .DER .OGG .JAVA .INC .INI\n.PPK .LOG .VDI .VMDK .VHD .MDF .MYI .MYD .FRM .SAV .ODB .DBF .MDB .ACCDB .SQL .SQLITEDB .SQLITE3\n.LDF .ARC .BAK .TAR .TGZ .RAR .ZIP .BACKUP .ISO .CONFIG\n\n```\nExecutes ping command and delete itself\n\ncmd.exe /min /C ping 111.111.111.111 -n 5 -w 10 > Nul & Del /f /q \\”[Filepath]\\”\n\n## Appendix\n\n Ransom Note\n```\nYour hard drive has been corrupted.In case you want to recover all hard drivesof your\norganization,You should pay us $10k via bitcoin wallet and send message viatox ID with your\norganization name.We will contact you to give further instructions.\n\n Related IoCs\n\n```\na196c6b8ffcb97ffb276d04f354696e2391311db3841ae16c8c9f56f36a38e92 (Stage1)\ndcbbae5a1c61dbbbb7dcd6dc5dd1eb1169f5329958d38b58c3fd9384081c9b78 (Stage2)\n923eb77b3c9e11d6c56052318c119c1a22d11ab71675e6b95d05eeb73d1accd6 (Stage3, Tbopbh.jpg)\n9ef7dbd3da51332a78eff19146d21c82957821e464e8133e9594a07d716d892d (Stage3, Tbopbh.jpg )\n35FEEFE6BD2B982CB1A5D4C1D094E8665C51752D0A6F7E3CAE546D770C280F3A (Decoded\nResource “78c855a088924e92a7f60d661c3d1845 ”)\n29AE7B30ED8394C509C561F6117EA671EC412DA50D435099756BBB257FAFB10B(AdvancedRun.exe)\nDB5A204A34969F60FE4A653F51D64EEE024DBF018EDEA334E8B3DF780EDA846F\n(Nmddfrqqrbyjeygggda.vbs)\n34CA75A8C190F20B8A7596AFEB255F2228CB2467BD210B2637965B61AC7EA907 (File Wiper)\nURL:\nhttps[:]//cdn.discordapp[.]com/attachments/928503440139771947/930108637681184768/Tbopbh.jpg\n\n## Reference\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-01-18 - Analysis of Destructive Malware (WhisperGate) targeting Ukraine.pdf"
    ],
    "report_names": [
        "2022-01-18 - Analysis of Destructive Malware (WhisperGate) targeting Ukraine.pdf"
    ],
    "threat_actors": [
        {
            "id": "a1ce86c2-3efc-4115-a85e-92c5fa461838",
            "created_at": "2022-10-25T16:47:55.561071Z",
            "updated_at": "2025-03-27T02:05:17.261424Z",
            "deleted_at": null,
            "main_name": "BRONZE ELGIN",
            "aliases": [
                "Lotus Blossom ",
                "Lotus Panda ",
                "Lstudio",
                "Spring Dragon ",
                "CTG-8171 "
            ],
            "source_name": "Secureworks:BRONZE ELGIN",
            "tools": [
                " Lzari",
                "Elise"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "87a20b72-ab72-402f-9013-c746c8458b0b",
            "created_at": "2023-01-06T13:46:38.293223Z",
            "updated_at": "2025-03-27T02:00:02.796483Z",
            "deleted_at": null,
            "main_name": "LOTUS PANDA",
            "aliases": [
                "Lotus BLossom",
                "Spring Dragon",
                "ST Group",
                "DRAGONFISH",
                "BRONZE ELGIN",
                "ATK1",
                "G0030",
                "Red Salamander"
            ],
            "source_name": "MISPGALAXY:LOTUS PANDA",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "b69484be-98d1-49e6-aed1-a28dbf65176a",
            "created_at": "2022-10-25T16:07:23.886782Z",
            "updated_at": "2025-03-27T02:02:10.014032Z",
            "deleted_at": null,
            "main_name": "Naikon",
            "aliases": [
                "Hellsing",
                "ITG06",
                "Lotus Panda",
                "Naikon",
                "Operation CameraShy"
            ],
            "source_name": "ETDA:Naikon",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "AR",
                "ARL",
                "Agent.dhwf",
                "Aria-body",
                "Aria-body loader",
                "Asset Reconnaissance Lighthouse",
                "BackBend",
                "Creamsicle",
                "Custom HDoor",
                "Destroy RAT",
                "DestroyRAT",
                "Flashflood",
                "FoundCore",
                "Gemcutter",
                "HDoor",
                "JadeRAT",
                "Kaba",
                "Korplug",
                "LOLBAS",
                "LOLBins",
                "LadonGo",
                "Lecna",
                "Living off the Land",
                "NBTscan",
                "Naikon",
                "NetEagle",
                "Neteagle_Scout",
                "NewCore RAT",
                "Orangeade",
                "PlugX",
                "Quarks PwDump",
                "RARSTONE",
                "RainyDay",
                "RedDelta",
                "RoyalRoad",
                "Sacto",
                "Sandboxie",
                "ScoutEagle",
                "Shipshape",
                "Sisfader",
                "Sisfader RAT",
                "Sogu",
                "SslMM",
                "Sys10",
                "TIGERPLUG",
                "TVT",
                "TeamViewer",
                "Thoper",
                "WinMM",
                "Xamtrav",
                "XsFunction",
                "ZRLnk",
                "nbtscan",
                "nokian",
                "norton",
                "xsControl",
                "xsPlus"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535700,
    "ts_updated_at": 1743041155,
    "ts_creation_date": 1653687505,
    "ts_modification_date": 1653687505,
    "files": {
        "pdf": "https://archive.orkl.eu/1f974be38350d71e5f118b0386e174cae7446d37.pdf",
        "text": "https://archive.orkl.eu/1f974be38350d71e5f118b0386e174cae7446d37.txt",
        "img": "https://archive.orkl.eu/1f974be38350d71e5f118b0386e174cae7446d37.jpg"
    }
}