{
    "id": "58d898d1-bf6d-476b-b485-be19fa6fa52d",
    "created_at": "2023-01-12T15:07:34.32247Z",
    "updated_at": "2025-03-27T02:05:51.871441Z",
    "deleted_at": null,
    "sha1_hash": "1e1d8649790b4520ea513eab4dc9fb7cec5b3d11",
    "title": "2020-01-09 - ServHelper 2.0- Enriched with bot capabilities and allow remote desktop access",
    "authors": "",
    "file_creation_date": "2022-05-28T19:45:05Z",
    "file_modification_date": "2022-05-28T19:45:05Z",
    "file_size": 371710,
    "plain_text": "# ServHelper 2.0: Enriched with bot capabilities and allow remote desktop access\n\n**[securitynews.sonicwall.com/xmlpost/servhelper-2-0-enriched-with-bot-capabilities-and-allow-remote-desktop-access/](https://securitynews.sonicwall.com/xmlpost/servhelper-2-0-enriched-with-bot-capabilities-and-allow-remote-desktop-access/)**\n\nJanuary 9, 2020\n\nSonicWall RTDMI ™ engine has recently detected a Nullsoft Scriptable Install System\n(NSIS) compiled executable file which executes new variant of ServHelper malware as a\nfinal payload. The NSIS binary contains a PowerShell script, which on execution brings\nanother PowerShell script. The second level PowerShell script is responsible for checking\nand setting execution environment for ServHelper 2.0 malware.\n\n**PE Static Information:**\n\n**First Level PowerShell Script:**\n\nThis PowerShell script perform Base64 decoding, followed by the decryption using Triple\nData Encryption Standard (TripleDES) algorithm to get second level PowerShell script. The\nsecond level PowerShell script is executed after removing null bytes from the end:\n\n\n-----\n\n**Second Level PowerShell Script:**\n\nThe PowerShell script checks the Read Only Memory (ROM) size, by accessing\n“SMBiosData” property in System Management BIOS (SMBIOS). If ROM size if less than or\nequal to 2048 KiloBytes, the malware calls function “clearupper” which removes the\ntemporary files and terminates the execution. The 9th byte is “SMBiosData” represents\n“[ROM size(in KiloBytes)/64 – 1]”. Checking ROM size can be a used to determining virtual\nenvironment or the malware author does not want to execute ServHelper, if victim’s\nmachine does not meet the expected ROM size. If the malware is executed with\n“Administrators” account then “install” function is executed which is responsible for further\nServHelper execution, else “gsdingeku” is executed which is responsible for executing the\nPowerShell script with escalated privilege:\n\nThe malware now checks for “TermService” (Remote Desktop Service), if not already\npresent, the malware creates the service setting “ServiceDll” path as\n“%SystemRoot%\\System32\\termsrv.dll” and then terminates “TermService” if already\nrunning. The malware contains strings variable, which are Base64 decoded, followed by\ngzip decompression to get the component files(32-bit ServHelper binary, modified 64-bit\n_RDP Wrapper Library, 64-bit ServHelper binary, RDP Wrapper Library configuration, 64-bit_\n_RDP Clipboard Monitor executable and 64-bit Microsoft RemoteFX VM Transport library):_\n\n\n-----\n\n32-bit ServHelper binary is packed with PECompact (Powerful executable compression for\nsoftware developers and vendors), 64-bit ServHelper binary and modified 64-bit RDP\nWrapper Library are packed with UPX (Ultimate Packer for eXecutables). The malware\nchecks “[System.IntPtr]::Size” to determine Operating System architecture and copies\ncomponent files to below file locations:\n\nModified RDP Wrapper Library – Copies to $env:programfiles\\windows\nmail\\appcache.xml\nServHelper binary – Copies to $env:programfiles\\windows mail\\default_list.xml\nRDP Wrapper Library configuration – Copies to $env:programfiles\\windows\nmail\\cleanuptask.cfg\nRDP Clipboard Monitor executable – If not present already, copies\nto env:systemroot\\system32\\rdpclip.exe\nMicrosoft RemoteFX VM Transport library – If not present already, copies to\n$env:systemroot\\system32\\rfxvmt.dll\n\nThe malware changes Remote Desktop Protocol (RDP) port to “7201” and ServiceDLL to\n“$env:programfiles\\windows mail\\appcache.xml” for “Remote Desktop Service”. The\nmalware then starts “rdpdr” and “TermService” services. ServiceDLL for “TermService”\nwhich is now “Modified RDP Wrapper Library” executes the ServHelper binary.\n\n**ServHelper 2.0:**\n\nThe malware decrypts encrypted string “d:\\xbl_QpfneNpYlu_.qye” to\n“c:\\aaa_TouchMeNot_.txt” using below decryption logic and uses same decryption logic for\ndecrypting other encrypted strings:\n\n\n-----\n\nThe malware now checks the presence of “c:\\aaa_TouchMeNot_.txt” (Windows Defender’s\ngoat file), if found then malware terminates the execution:\n\nThe malware modified user accounts using below batch commands to allow remote desktop\naccess:\n\nnet user wgautilacc Ghar4f5 /del\nnet user wgautilacc yysJG0Or /add\nnet LOCALGROUP “Remote Desktop Users” wgautilacc /ADD\nnet LOCALGROUP “Remote Desktop Users” Deepak /ADD\nnet LOCALGROUP “Administrators” wgautilacc /ADD\nnet user wgautilacc yysJG0Or\n\n\n-----\n\nThe malware modifies below registry entries:\n\nHKLM\\System\\CurrentControlSet\\Control\\Terminal Server\\fDenyTSConnections -> 0\nHKLM\\System\\CurrentControlSet\\Control\\Terminal Server\\FSingleSessionPerUser ->\n1\nHKLM\\System\\CurrentControlSet\\Control\\Lsa\\LimitBlankPasswordUse -> 0\nHKLM\\System\\CurrentControlSet\\Control\\Terminal Server\\Licensing\nCore\\EnableConcurrentSessions -> 1\nHKLM\\SOFTWARE\\Microsoft\\Windows\nNT\\CurrentVersion\\Winlogon\\AllowMultipleTSSessions -> 1\nHKLM\\SOFTWARE\\Microsoft\\Windows\nNT\\CurrentVersion\\Winlogon\\SpecialAccounts\\UserList\\wgautilacc -> 0\nHKLM\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\Terminal\nServices\\fAllowToGetHelp -> 1\n\nThe malware writes victim’s machine information into “%TEMP%\\LYNPCDXX”:\n\n**Network Communication:**\n\nThe malware sends the information to its Command and Control (C&C) server. Before\nsending information to the C&C server, malware performs xor operation followed by Base64\nencoding:\n\n\n-----\n\n**Commands Supported:**\n\nbk\ninfo\nfixrdp\nreboot\nupdateuser\ndeployns\nkeylogadd\nkeylogdel\nkeyloglist\nkeylogreset\nkeylogstart\nsshurl\ngetkeylog\ngetchromepasswords\ngetmozillacookies\ngetchromecookies\nsearch\nbkport\nhijack\npersist\nstophijack\nsethijack\nsetcopyurl\nforcekill\nnop\ntun\nslp\nkilltun\nshell\nupdate\nload\nsockt\n\nUnavailability of Portable Executable (PE) in any of the popular threat intelligence sharing\nportals like the VirusTotal and the ReversingLabs at the time of writing this blog indicates its\nuniqueness and limited distribution:\n\n\n-----\n\nEvidence of the detection by RTDMI(tm) engine can be seen below in the Capture ATP\nreport for this file:\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-01-09 - ServHelper 2.0- Enriched with bot capabilities and allow remote desktop access.pdf"
    ],
    "report_names": [
        "2020-01-09 - ServHelper 2.0- Enriched with bot capabilities and allow remote desktop access.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536054,
    "ts_updated_at": 1743041151,
    "ts_creation_date": 1653767105,
    "ts_modification_date": 1653767105,
    "files": {
        "pdf": "https://archive.orkl.eu/1e1d8649790b4520ea513eab4dc9fb7cec5b3d11.pdf",
        "text": "https://archive.orkl.eu/1e1d8649790b4520ea513eab4dc9fb7cec5b3d11.txt",
        "img": "https://archive.orkl.eu/1e1d8649790b4520ea513eab4dc9fb7cec5b3d11.jpg"
    }
}