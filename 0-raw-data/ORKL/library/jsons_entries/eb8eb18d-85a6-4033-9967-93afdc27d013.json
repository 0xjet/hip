{
    "id": "eb8eb18d-85a6-4033-9967-93afdc27d013",
    "created_at": "2023-01-12T15:09:10.760218Z",
    "updated_at": "2025-03-27T02:05:21.238985Z",
    "deleted_at": null,
    "sha1_hash": "70d1bff34454f5edd795705e66079bc42491e48d",
    "title": "2016-11-23 - InPage zero-day exploit used to attack financial institutions in Asia",
    "authors": "",
    "file_creation_date": "2022-05-28T15:09:10Z",
    "file_modification_date": "2022-05-28T15:09:10Z",
    "file_size": 590357,
    "plain_text": "# InPage zero-day exploit used to attack financial institutions in Asia\n\n**[securelist.com/inpage-zero-day-exploit-used-to-attack-financial-institutions-in-asia/76717/](https://securelist.com/inpage-zero-day-exploit-used-to-attack-financial-institutions-in-asia/76717/)**\n\nAuthors\n\n[Denis Legezo](https://securelist.com/author/denislegezo/)\n\nIn September 2016, while researching a new wave of attacks, we found an interesting target\nwhich appeared to constantly receive spearphishes, a practice we commonly describe as a\n“magnet of threats”. Among all the attacks received by this magnet of threats, which included\nvarious older Office exploits such as CVE-2012-0158, one of them attracted our attention.\nThis file, which was also uploaded to a multiscanner service in September 2016, had an\nextension that we were unfamiliar with – “.inp”. Further investigation revealed this was an\nInPage document. InPage, in case you are wondering, is publishing and text processing\nsoftware, mostly popular with Urdu and Arabic speaking users.\n\n\n-----\n\n_InPage user groups from vendor official site_\n\nSince no exploits for InPage have previously been mentioned in public, we took a closer look\nto see if the document was malicious or not. Further analysis indicated the file contained\nshellcode, which appeared to decrypt itself and further decrypt an EXE file embedded in the\ndocument. The shellcode appeared to trigger on several versions of InPage. We don’t\nobserve any public mentions of such exploit so we consider it a zero-day. We report it to the\nvendor and CERT-IN. Assigned vulnerability number is CVE-2017-12824.\n\n## Discovery and analysis\n\nInPage is an interesting vulnerable software selection as it’s widely used within the Indian\nMuslim population, as well as in Pakistan. This, of course, includes local mass-media and\nprint shops, governmental and financial institutions (banks). If someone wants to deploy\nattack modules into regional press-related companies, an InPage exploit would work well.\n\nDue to its wide range of technologies, it wasn’t perhaps surprising to see that Kaspersky Lab\nproducts already detect the exploit with the generic rule HEUR:Exploit.Win32.Generic. This\ndetection is triggered by the presence of the shellcode inside a Microsoft Compound Storage\nfile (OLE), which works extremely well for a wide category of Office-based exploits, going\nback to 2009.\n\nThe good news is that Kaspersky Lab users have been protected against this attack for quite\nsome time – and the protection worked well in the past when it blocked a number of\nmalicious InPage documents.\n\nBetween the various phishing campaigns relying on this exploit, one particular attack\nattracted our attention. The targets of this attack were special, since they were banks in Asia\nand Africa. The payload and C&C servers are also different from the recent attacks we’ve\n\n\n-----\n\nobserved, meaning there are probably several actors utilizing this zero-day exploit at the\nmoment.\n\n## Technical details\n\n_Spearphishing e-mail with several malicious attachments. The .inp contains the zero-day_\n_exploit_\n\nIn their attacks, the threat actors often use more than one malicious document. During\nspearphishing, the actors attached InPage files as well as .rtfs and .docs with old popular\nexploits.\n\nLooking through all the related documents we could find, we counted several different\nversions of keyloggers and backdoors written mostly in Visual C++, Delphi and Visual Basic.\n\nOne such keylogger we analysed (MD5 hash: 18a5194a4254cefe8644d191cb96da21) was\nwritten in Visual C++. After gaining control, the module decodes several internal strings. One\nof them is the C2 domain name visitorzilla[.]com. This backdoor maintains persistence by\ncreating “C:\\Documents and Settings\\<USER>\\Start\n**Menu\\Programs\\Startup\\DataABackup.lnk“. Similar to the other campaign modules, it**\nuses SetWindowsHook() with WH_KEYBOARD_LL hook to gather keystrokes. To gather\nkeystroke data, the module uses two files on disk: C:\\Documents and Settings\\\n<USER>\\Application Data\\DataBackup\\sed.ic and me.ic (located in the same directory).\n\n## Inside weaponized documents\n\nInPage uses its own proprietary file format that is based on the Microsoft Compound File\nFormat. The parser in the software’s main module “inpage.exe” contains a vulnerability when\nparsing certain fields. By carefully setting such a field in the document, an attacker can\ncontrol the instruction flow and achieve code execution.\n\n\n-----\n\nThe shellcode has three main parts:\n\n1. Pattern searcher (so-called “egg hunter”) before the decoder,\n2. Decoder.\n3. Downloader.\n\nThe pattern searcher looks through all of the virtual memory space attempting to find the\npattern “68726872”. Once the searcher identifies this pattern it starts the next stage of exploit\n– the decoder.\n\n_Shellcode decryptor_\n\nThe small decoder obtains the instruction pointer and uses FLDPI + FSTENV instructions (an\nold and uncommon technique). The decoder is using an arithmetic NOT followed by a XOR\n0xAC operation to decrypt the next stage.\n\nNext, the downloader fetches a remote payload using InternetReadFile() and runs it using\nthe WinExec() function in the %userprofile% directory. This functionality is very common and\nwe’ve seen it with many other exploits. It’s the choice of vulnerable software that is\ninteresting in this case and, for sure, the appearance of an exploit for software that is popular\nmostly in India and Pakistan.\n\nThe final payload is a Trojan written in Visual Basic 6. It defines a hook using the\nSetWindowsHook() function with the WH_MSGFILTER parameter. It communicates with its\nC2 server at 195.189.227.26 on port 8080.\n\nDuring the initial session the C2 server sends “Pass” and host replies with\n“Auth<username>@<hostname>\\#/<OS version>\\#/<IP address>\\#/-” In addition to\nb4invite[.]com this same Trojan was also spread using a configuration with the C2 server\nrelaybg[.]com.\n\n## Victims\n\n\n-----\n\nSo far, victims of these attacks have been observed in Myanmar, Sri-Lanka and Uganda. The\nsector for the victims include both financial and governmental institutions.\n\n## Conclusions\n\nBy all appearances, this newly discovered exploit has been in the wild for several years. In\nsome way, it reminds us of other similar exploits for Hangul Word Processor, another\nlanguage/region-specific text processing suite used almost exclusively in South Korea. HWP\nhas been plagued by several exploits in the past, which have been used by various threat\ngroups to attack Korean interests.\n\nDespite our attempts, we haven’t been able to get in touch with the InPage developers. By\ncomparison, the Hangul developers have been consistently patching vulnerabilities and\npublishing new variants that fix these problems. The best defense against exploits is always\na multi-layered approach to security. Make sure you have an internet security suite capable\nof catching exploits generically, such as Kaspersky Internet Security. Installing the Microsoft\nEMET tool can also help, as well as running the most recent version of Windows (10).\nFinally, default deny policies, also known as allowlisting can mitigate many such attacks.\n\nThe Australian Signals Directorate Top35 list of mitigation strategies shows us that at least\n[85% of intrusions could have been mitigated by following the top four mitigation strategies](https://securelist.com/blog/software/69887/how-to-mitigate-85-of-threats-with-only-four-strategies/)\ntogether. These are: application allowlisting, updating applications, updating operating\nsystems and restricting administrative privileges. Kaspersky Lab has technological solutions\nto cover the first three of these (i.e. all the technology-based strategies) as well as most of\nthe others from Top35 ASD’s list.\n\n_Kaspersky Lab detects this exploit as HEUR:Exploit.Win32.Generic._\n\n_More information about this exploit, associated campaigns and attacks is available to_\n_customers of Kaspersky Intelligence Services. Contact: intelreports@kaspersky.com_\n\n## Indicators of compromise:\n\n### Hashes\n\nf00e20ec50545106dc012b5f077954ae – rtf\n\n729194d71ed65dd1fe9462c212c32159 – inp\n\nc9e7ec899142477146d4f7f83df3f63f\n\n750ed4f79496dee1d624a7b508f83f4e\n\nB43aa5ea4ff5292fd92d416bb2b41c3a\n\n4d508e44c5f3028a36a5206383cf235c\n\n53c3503d3193bf14a93dc3ac24829490\n\n5a9a8502b87ce1a6a608debd10761957\n\n\n-----\n\n### C&Cs used in the samples dropped by the weaponized InPage documents:\n\nRelaybg[.]com\n\nB4invite[.]com\n\nLeastinfo[.]com\n\ntropicmig[.]com\n\nDigivx[.]com\n\nGigatrons[.]com\n\nkinohata[.]ru\n\nVisitorzilla[.]com\n\nAmbicluster[.]com\n\nAliasway[.]com <- SINKHOLED by Kaspersky Lab\nXynoder[.]com\n\nBy4mode[.]com\n\nStringbit[.]com\n\nEncrypzi.com\n\nGigsense[.]com\n\nI3mode[.]com\n\n[Spear phishing](https://securelist.com/tag/spear-phishing/)\n[Vulnerabilities and exploits](https://securelist.com/tag/vulnerabilities-and-exploits/)\n[Zero-day vulnerabilities](https://securelist.com/tag/zero-day-vulnerabilities/)\n\nAuthors\n\n[Denis Legezo](https://securelist.com/author/denislegezo/)\n\nInPage zero-day exploit used to attack financial institutions in Asia\n\nYour email address will not be published. Required fields are marked *\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2016/2016-11-23 - InPage zero-day exploit used to attack financial institutions in Asia.pdf"
    ],
    "report_names": [
        "2016-11-23 - InPage zero-day exploit used to attack financial institutions in Asia.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536150,
    "ts_updated_at": 1743041121,
    "ts_creation_date": 1653750550,
    "ts_modification_date": 1653750550,
    "files": {
        "pdf": "https://archive.orkl.eu/70d1bff34454f5edd795705e66079bc42491e48d.pdf",
        "text": "https://archive.orkl.eu/70d1bff34454f5edd795705e66079bc42491e48d.txt",
        "img": "https://archive.orkl.eu/70d1bff34454f5edd795705e66079bc42491e48d.jpg"
    }
}