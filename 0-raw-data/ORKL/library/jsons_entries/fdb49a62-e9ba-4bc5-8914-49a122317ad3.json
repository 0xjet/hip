{
    "id": "fdb49a62-e9ba-4bc5-8914-49a122317ad3",
    "created_at": "2022-10-25T16:48:19.703043Z",
    "updated_at": "2025-03-27T02:11:01.430558Z",
    "deleted_at": null,
    "sha1_hash": "005000464a9f344017647ae24c95407f58b0187d",
    "title": "",
    "authors": "",
    "file_creation_date": "2020-05-15T03:05:28Z",
    "file_modification_date": "2020-05-15T03:05:28Z",
    "file_size": 2188435,
    "plain_text": "# RATicate: an attacker’s waves of information-stealing malware\n\n**news.sophos.com/en-us/2020/05/14/raticate**\n\nMarkel Picado May 14, 2020\n\nIn a series of malspam campaigns dating back to November of 2019, an unidentified group sent\nout waves of installers that drop remote administration tool (RAT) and information stealing\nmalware on victims’ computers.\n\nWe’ve identified five separate campaigns between November, 2019 and January, 2020 in which\nthe payloads used similar packing code and pointed to the same command and control (C&C)\ninfrastructure. The campaigns targeted industrial companies in Europe, the Middle East, and the\nRepublic of Korea. This leads us to believe that they are all the work of the same actors—a group\nwe’ve dubbed RATicate.\n\nA new campaign we believe connected to the same actors leverages concern about the global\nCOVID-19 pandemic to convince victims to open the payloads. This is a shift in tactics, but we\nsuspect that this group constantly changes the way they deploy malware—and that the group has\nconducted campaigns prior to this past November.\n\nIn this post, we’ll focus on the initial wave of campaigns, which all used Nullsoft Scriptable Install\nSystem (NSIS) installers. NSIS is an open source tool for creating Windows installers, designed\nfor Internet-based software distribution. But it has also been abused for a long time to disguise\nand deploy malware. (We’ll discuss newer campaigns using other installers, and the group’s shift\nin phishing tactics, in an upcoming follow-up report.)\n\n### Plugged in for malware\n\n\n-----\n\nOne of the interesting features of NSIS installers is their plug-in architecture, which allow\ninstallers to communicate with other software components—including components of the\n[Windows operating system. (A list of available plug-ins can be found here.) These plug-ins are](https://nsis.sourceforge.io/Category:Plugins)\ndeployed as Windows DLL files. If selected during the installer build, they will be automatically\nadded to the final compiled NSIS installer’s packaged files inside the “$PLUGINS” folder.\n\nSome of the capabilities these plugins can provide include:\n\nThe installers we looked at caught our attention because they all drop the same set of “junk files”\n(files that are never used by the installed malware) across the initial sample set. We’ve seen the\ntactic of packing NSIS installers with garbage files to conceal malware in the past; the junk files\nare intended to confuse analysts and create “noise” during sandbox analysis. So this behavior\ncaught our attention, and we started to analyze it in more detail.\n\nWe found that all the samples use the System.dll plugin, which allows you to load a DLL and call\nits exported functions. The DLL called by these malicious installers injects a payload into memory\n(in most cases by using cmd.exe).\n\nFor purposes of illustration, this report focuses primarily on the analysis of one sample NSIS\ninstaller from the first group we discovered:\n\nThe output of the Exeinfo PE tool identifies the sample as an NSIS installer\n\nNSIS installers contain compressed components, including executable code, which can be loaded\ninto memory by the installers. These components can be extracted using file decompression\ntools, such as 7zip.\n\n\n-----\n\nOutput of 7zip after list the files contained on the analyzed sample\n\nThe files dropped by this sample included the following types:\n\nASCII text\nC source files, in ASCII text\ndata\nExecutable and Linkable Format (ELF) 64-bit\nGIF image data\nJPEG image data\nPC bitmap, Windows 3.x format, 164 x 314 x 4\nPE32 executable (DLL)\nPE32 executable (GUI)\nPOSIX shell script, ASCII text executable\nPython 3.6 byte-compiled\nXML 1.0 document\n\nThe installer drops the junk files into the %TEMP%/careers/katalog/_mem_bin/page1/W3SVC2\nfolder.\n\n\n-----\n\nJunk files created by analyzed sample.\n\nThere are only two components dropped by the installer that are important to the malware\ninstallation, which are dropped into the $TEMP folder. In the case of the NSIS installer we\nanalyzed for this report, these two components are:\n\naventailes.dll (the Initial Loader)\nCluck (Encrypted data)\n\nThe payloads of the installers we examined vary. During analysis of the samples we collected—\nconducted both manually and with the aid of sandboxing tools—we found several different\nfamilies of RATs and infostealers. These included Lokibot, Betabot, Formbook, and AgentTesla.\nBut all of them followed the same multi-stage unpacking process when executed.\n\n### First stage: initial loader and shellcode\n\nIn the first stage, the installer deploys the initial loader, a malicious DLL. The DLL is then used to\nbegin decryption of the malicious payload, and then finally to inject malicious payload into\nmemory while the NSIS layer drops the junk files. The following images show how the analyzed\nsample creates a cmd.exe process, which is used to inject the Final Payload.\n\n\n-----\n\nOutput of Procmon which shows how the analyzed sample\n\ncreates a child process\n\nThe memory of created child process by the analyzed sample. The final\n\npayload is loaded at the address 0x400000.\n\nThe malicious DLL deployed with the RATicate installers (in this case, aventailes.dll) is a custom\nloader, likely developed by the threat actor, stored in the $TEMP folder of the file package. All of\nthe analyzed initial loaders are DLL files with only one export, though the name of the loader and\nthe export function vary across the samples. In this case, the export was named Inquilinity.\n\nThis export is called using the NSIS System plugin as explained previously. The export loads and\nexecutes a shellcode, located in the initial loader’s .rdata section. The shellcode is initially\nencrypted using a basic arithmetic operation. This operation varies across the initial loaders we\nanalyzed.\n\nThe shellcode dropped by the initial loader then reads the Encrypted data (Cluck file) where other\nloaders and payloads are stored. These PE files and shellcodes are decrypted on demand during\nthe next two stages of malware deployment. In the first stage of the decryption, done by the\nshellcode called by initial loader, contains an xor key, a second shellcode (shellcode 2), and a PE\nfile (Loader 2).\n\n\n-----\n\nExport of Initial Loader\n\n\nThe xor key is used to decrypt shellcode2 and Loader 2.\n\nHere’s how the workflow of Stage 1 breaks down in depth:\n\n\n-----\n\nStage 1 workflow:\n\n1. NSIS exe file is executed.\n2. System.dll plugin loads and calls to Initial Loader (aventailes.dll)\n3. The export of Initial Loader decrypts shellcode1 and jumps to it.\n4. shellcode1 reads Cluck file which is loaded in a memory buffer.\n5. shellcode1 decrypts both shellcode2 and Loader2 and maps shellcode2 then jumps to it.\n6. shellcode2 maps Loader2 into memory (Reflective loading).\n\n### Second stage: second shellcode and loader DLL\n\nThe second stage of decryption begins when Loader 2 is loaded in memory by\nshellcode2. Loader 2 reads the Cluck file in order to decrypt more artifacts. The data for this stage\nis decrypted with a dynamically generated xor key based on the name of the file which contains\nthe encrypted data (which in this case is Cluck). As shown below, after this xor is applied, there is\nanother xor key (xor_key2) stored in the second part of the file, which is used to decrypt different\nartifacts like strings, shellcodes, and PE files.\n\n\n-----\n\nStage 2 workflow\n\n\n-----\n\n1. Loader2 starts executing its DllEntryPoint.\n2. Loader2 reads again Cluck file.\n3. Loader2 decrypts from Cluck some shellcodes which are never used.\n4. Loader2 decrypts shellcode3 from read data from Cluck.\n5. Loader2 executes shellcode3, which decrypts the Final Payload (a PE file).\n\n### Third stage: injection\n\nAfter the decryption, shellcode3 injects the final payload in a child process. It accomplishes this\n[using cmd.exe with the NtCreateSection + NtMapViewOfSection code injection technique.](https://ired.team/offensive-security/code-injection-process-injection/ntcreatesection-+-ntmapviewofsection-code-injection)\n\nThese are the extracted artifacts during the analysis.\n\n##### ARTIFACT HASH\n\n Loader 2 c2cdb371d3394ff71918ac2422a84408644fa603f1b45e3fb1a438d‐ bce9dcad0\n\n\n##### Final Payload\n\n\n##### 46c6fa90acdf651e99620c257ae4e9ed9d1cfcb31fd676dc9b570b‐ b3f9720ac8\n\n\n### Hints of a single actor\n\nWe found 38 NSIS installer samples in total that shared very similar characteristics:\n\nIdentical junk files. Not only their name, but also their content. When generating the installer from\nNSIS Script, the actor who is packing the payload would have to have all these random files in\ntheir possession on their hard drive.\n\nThe loader is the same: All the loaders across analyzed NSIS installers are the same, not in\nterms of their hash value but in terms of their functionality.\n\nAll initial loaders have just one export, which is called by the NSIS installer\nThe Initial Loader reads from Encrypted Data in order to decrypt a shellcode which loads\nthe Loader 2.\nLoader 2 across all samples extracts and decrypts shellcode 3 from Encrypted Data.\nShellcode 3, responsible for decrypting the final payload and injecting it into a remote\nprocess, is binary-equal between all analyzed samples.\n\nHowever, each NSIS installer we looked at dropped different malware payloads. We considered\ntwo possible scenarios: either the malicious NSIS package is a generic packer sold on dark\nforums; or, the same threat actor is using a custom loader to deploy different payloads in a variety\nof their attacks.\n\nWhile there are many packers sold in dark forums, we found this scenario unlikely, as one should\nexpect the junk files to change along with the payloads, if different actors were using the same\ngeneric packer. So, we continued our investigation with the hypothesis the attacks come from the\nsame actor.\n\n\n-----\n\nGiven the evidence we have in hand, we can’t prove that a single actor was responsible for all of\nthem, but we at least knew from the identical packing strategy and artifacts that we could find a\nway to connect all of them. We performed further analysis in search of a definitive link, turning to\nthe infection chain that delivered them.\n\nBased on Sophos telemetry, we found a set of NSIS installers dropping these same junk files as\npart of an email campaign seen between December 8 and December 13, 2019. (We later\ndesignated this wave Campaign 3, after discovering other sets of NSIS installers, discussed\nlater.) In the email attacks we observed, the targets appeared to all be critical infrastructure\nproviders (or businesses related to critical infrastructure). We analyzed the observed attacks\nusing VirusTotal’s graphing feature, gathering open-source information about other victims.\n\nThe graph above shows the infection chain for some of the analyzed NSIS installers. It reveals\ntwo common patterns used to infect a victim:\n\n\n-----\n\nSuperimposing the distinct infection chains over the graph shows that both chains were used for\nthe same target company revealed by VT data. It is likely the same approach is taken for any\ntargeted company.\n\n\n-----\n\nWe were able to retrieve some of the emails associated with this campaign from VT. With these\nemails, we were able to identify some of the installers’ targets.\n\n\n-----\n\nOne of the Campaign 3 emails, presenting the installer as a “banking confirmation.”\n\nMany of the the emails we found in VirusTotal data did not show recipients’ addresses, or the “To”\naddress was filled with the same email address that appeared in the “From” field. In these cases,\nwe analyzed the email headers—since the headers hold more information related to the email,\nlike the original recipients.\n\nDuring the analysis of the NSIS installers we found with identical junk files to our initial sample,\nwe identified at least 5 different malware families used as final payload—all of them InfoStealer or\nRAT malware:\n\nForeIT/Lokibot\nBetaBot\nFormbook\nAgentTesla\nNetwire\n\n\n-----\n\nWe then looked at the Command and Control (C&C) infrastructure used for these payloads, to\ncheck for any relationship between them and to see if the C&Cs were used to send the stolen\ndata points to same or similar servers.\n\nThese are some of the families identified in this campaign and their C&Cs:\n\n##### TYPE OBSERVED PAYLOADS OBSERVED PAYLOAD C&C DOMAINS\n\n Info Stealer Betabot stngpetty.ga allenservice.ga gelcursot.top\n\n Info Stealer Formbook ef-oh.com/c208 odoyo.net/c208 hearee.com/c208 binzom.com/c208 pizzans.com/c208 phochain.com/sa rdrfi.com/sa/ skylod.com/sa hsctsu.com/sa\n\n Info Stealer Lokibot gelcursot.top\n\n RAT Netwire 79.134.225.97:2556\n\n RAT AgentTesla mail.newmedicacare.com mail.jrdigitalstore.com mail.koyo.com.my mail.qoa.com.my mail.sedirectory.com.my\n\nAlmost all of the malware samples of each type connected to the campaign share the same C&C.\nAnd in some cases, even different families—such as Lokibot and Betabot—share same domain\nfor their C&C.\n\n### Identifying more campaigns\n\nFollowing this pattern—looking for other groups of NSIS installers which drop identical junk files\nduring the same range of dates—we were able to identify 5 distinct NSIS campaigns that took\nplace between November 16, 2019 and January 8, 2020. While the junk files for each of these\ncampaigns were different from our first samples, their behavior was identical (or at least similar)\nto those observed in Campaign 3.\n\n##### NAME DATES\n\n Campaign 1 2019-11-16/2019-11-20\n\n Campaign 2 2019-11-25/2019-11-26\n\n Campaign 3 2019-12-08/2019-12-13\n\n\n-----\n\n##### Campaign 4 2019-12-20/2019-12-31\n\n Campaign 5 2020-01-03/2020-01-08\n\n#### Campaign 1 (November 16-20, 2019)\n\nThese are the dropped junk files for all NSIS installers that belong to Campaign 1:\n\nOutput of 7z after list the files contained on a sample that belongs to campaign 1\n\nThese are some of the payloads identified for Campaign 1 on a first triage of the installers.\n\n##### TYPE OBSERVED PAYLOADS OBSERVED PAYLOAD C&C DOMAINS\n\n Info Stealer Betabot negrodesigns.ga gelcursot.top webxpo.ga\n\n Info Stealer Lokibot gelcursot.top\n\n Info Stealer Formbook cbespania.info/c206 conrak.net/c206 coxemen.com/c206 dachfix.com/c206 hypnose-beziers.com/c206 jevmod.com/c206 lighthouse-campus24.com/c206 oleum.gmbh/c206 pupilfy.com/c206 tellpizzqhut.com/c206 terenium.com/c206 vibe.restaurant/c206 yamatobb.com/c206 yncits89.com/p0x ratokasutka.com/p0x miscov.com/p0x\n\n\n-----\n\n##### RAT Netwire 79.134.225.11:1199\n\nHere is a sample of the emails we collected from VirusTotal connected to Campaign 1:\n\nUsed emails on Campaign 1\n\nThe following graph shows the relation and infection chain for campaign 1 (based on available\ndata on VT)\n\n### Campaign 2 (November 25, 2019 to November 26, 2019)\n\nThese are the dropped junk files for all NSIS installers that belong to campaign 2:\n\n\n-----\n\nOutput of 7z after list the files contained on a sample that belongs to campaign 2\n\nSome of the payloads identified for campaign 2 on a first triage included the following:\n\n##### TYPE OBSERVED PAYLOADS OBSERVED PAYLOADS C&C DOMAINS\n\n Info Stealer Betabot negrodesigns.ga\n\n Info Stealer Formbook czxpkj.com/c206 pupilfy.com cbespania.info/c206 jevmod.com/c206\n\n RAT Bladabindi tucson1989.duckdns.org pedrobedoya201904.duckdns.org\n\n RAT Blackrat 79.134.225.97:1982\n\n RAT Remcos cashout2018.ddns.de\n\nWe found no emails for this campaign, so we were unable to map its intended targets. The graph\nbelow shows the relationship between the similar payloads.\n\n\n-----\n\nData from VirusTotal\n\n#### Campaign 4 (December 20, 2019 to December 31, 2019)\n\nThese are the dropped junk files for all NSIS installers that belong to campaign 4:\n\nSome of the payloads observed associated with campaign 4 included:\n\n##### TYPE OBSERVED PAYLOADS OBSERVED PAYLOADS C&C DOMAINS\n\n Info Stealer Betabot pitchstak.ga\n\n Info Stealer Lokibot pitchstak.ga\n\n Info Stealer Formbook slashoff.com/c208 sofisleep.com/c208 jinshasoft.com/c208 binzom.com/c208\n\n RAT Netwire 79.134.225.97:2556\n\n\n-----\n\n##### RAT AgentTesla mail.newmedicacare.com\n\nEmails collected from VirusTotal tied to campaign 4.\n\n#### Campaign 5 (January 3, 2020 to January 8, 2020)\n\nThese are the dropped junk files for all NSIS installers that belong to campaign 5:\n\nOutput of 7z after list the files contained on a sample that belongs to campaign 5\n\nSome of the payloads of campaign 5:\n\n##### TYPE OBSERVED PAYLOADS OBSERVED PAYLOADS C&C DOMAINS\n\n Info Stealer Betabot pitchstak.ga\n\n Info Stealer Lokibot pitchstak.ga\n\n\n-----\n\n##### Info Stealer Formbook binzom.com/c208 bywebhost.com/c208 jinshasoft.com/c208\n\n RAT Netwire 79.134.225.97:2556\n\n RAT AgentTesla mail.arkazo.com mail.alhilaly-group.com\n\nSample emails we collected tied to campaign 5:\n\nThe following graph shows the relation and infection chain for campaign 5 (based on available\ndata on VT)\n\n### Profiling the threat actor\n\nLooking across all the campaigns we discovered during this analysis, we saw frequent\nduplications in C&C infrastructure, as shown in the table summarizing the campaigns below:\n\n\n##### CAM‐ PAIGN DATES TYPE\n\n\n##### OBSERVED PAYLOADS\n\n\n##### OBSERVED PAYLOADS C&C DOMAINS\n\n\n-----\n\n##### 1 2019-11- 16/2019-11- 20\n\n 2 2019-11- 25/2019-11- 26\n\n 3 2019-12- 08/2019-12- 13\n\n\n##### Info Stealer\n\n\n##### Info Stealer\n\n\n##### Info Stealer\n\n\n##### Betabot negrodesigns.ga gelcursot.top webxpo.ga\n\n Lokibot gelcursot.top\n\n Formbook cbespania.info/c206 conrak.net/c206 coxemen.com/c206 dachfix.com/c206 hypnose-beziers.com/c206 jevmod.com/c206 lighthouse-campus24.com/c206 oleum.gmbh/c206 pupilfy.com/c206 tellpizzqhut.com/c206 terenium.com/c206 vibe.restaurant/c206 yamatobb.com/c206 yncits89.com/p0x ratokasutka.com/p0x miscov.com/p0x\n\n\n##### RAT Netwire 79.134.225.11:1199\n\n\n##### Info Stealer\n\n\n##### Info Stealer\n\n\n##### Betabot negrodesigns.ga\n\n Formbook czxpkj.com/c206 pupilfy.com cbespania.info/c206 jevmod.com/c206\n\n\n##### RAT Bladabindi tucson1989.duckdns.org pedrobedoya201904.duckdns.org\n\n RAT Blackrat 79.134.225.97:1982\n\n RAT Remcos cashout2018.ddns.de\n\n\n##### Info Stealer\n\n\n##### Info Stealer\n\n\n##### Betabot stngpetty.ga allenservice.ga gelcursot.top\n\n Formbook ef-oh.com/c208 odoyo.net/c208 hearee.com/c208 binzom.com/c208 pizzans.com/c208 phochain.com/sa rdrfi.com/sa/ skylod.com/sa hsctsu.com/sa\n\n\n-----\n\n##### Info Stealer\n\n\n##### Lokibot gelcursot.top\n\n\n##### RAT Netwire 79.134.225.97:2556\n\n RAT AgentTesla mail.newmedicacare.com mail.jrdigitalstore.com mail.koyo.com.my mail.qoa.com.my mail.sedirectory.com.my\n\n\n##### 4 2019-12- 20/2019-12- 31\n\n 5 2020-01- 03/2020-01- 08\n\n\n##### Info Stealer\n\n\n##### Info Stealer\n\n\n##### Info Stealer\n\n\n##### Betabot pitchstak.ga\n\n Lokibot pitchstak.ga\n\n Formbook slashoff.com/c208 sofisleep.com/c208 jinshasoft.com/c208 binzom.com/c208\n\n\n##### RAT Netwire 79.134.225.97:2556\n\n RAT AgentTesla\n\n\n##### Info Stealer\n\n\n##### Info Stealer\n\n\n##### Info Stealer\n\n\n##### Betabot pitchstak.ga\n\n Lokibot pitchstak.ga\n\n Formbook binzom.com/c208 bywebhost.com/c208 jinshasoft.com/c208\n\n\n##### RAT Netwire 79.134.225.97:2556\n\n RAT AgentTesla mail.arkazo.com mail.alhilaly-group.com\n\nWe also found that some of the different payloads from each campaign (mostly Betabot, Lokibot,\nAgentTesla and Formbook) shared the same C&C. This suggests that the same actor/group was\nmanaging the web panels behind these malware campaigns.\n\nThere was also a distinct clustering of the campaign timelines—there was never any overlap\nbetween them, suggesting that they were operated serially by the same threat actors (including a\nsixth campaign we observed, to be covered in our next report):\n\n\n-----\n\nThese campaigns didn’t just share command and control infrastructure across different payloads\nwithin the same campaign. Some of the infrastructure was also shared across multiple\ncampaigns, which also suggests the same actor was involved across all of them.\n\nThe following tables show some interesting relations between campaigns.\n\n### Targeting and motivation\n\nBased on the payloads used by RATicate, it’s clear that the campaigns run by the group are\nintended to gain access to and control of computers on the targeted companies’ networks. The\ntargets identified from the collected emails sent by these campaigns include:\n\n\n-----\n\nAn electrical equipment manufacturer in Romania;\nA Kuwaiti construction services and engineering company;\nA Korean internet company;\nA Korean investment firm;\nA British building supply manufacturer;\nA Korean medical news publication;\nA Korean telecommunications and electrical cable manufacturer;\nA Swiss publishing equipment manufacturer;\nA Japanese courier and transportation company.\n\nWe know that the targets overlapped on at least two campaigns: Campaign 1 and 2 both targeted\nthe electrical equipment manufacturer. There are likely more targets that were common across\nmultiple campaigns (we looked only at publicly-available data from VirusTotal, and have not\nexplored non-public databases). And many (but not all) of the companies that have been\ntargeted-up are related to critical infrastructure.\n\nWe’ve detected one more recent campaign using these NSIS installers (from January 13-16).\nHowever, as we’ve continued to research this actor group, we’ve been studying other campaigns\nthat we believe are being run by the the same actor—and we believe that since January, the actor\nhas moved to using other loaders and packers.\n\nOne of those campaigns is an email campaign we detected in March that uses the COVID-19\nglobal pandemic as a lure to get victims to open the payload. The most recent detected samples\nare delivered with a variety of Visual Basic loaders —including the Guloader malware dropper\n[discovered by Proofpoint on December 2019.](https://www.proofpoint.com/us/threat-insight/post/guloader-popular-new-vb6-downloader-abuses-cloud-services)\n\nWe believe these campaigns are run by the same actor fro a number of reasons:\n\nThe email targets the same companies seen in previous campaigns.\nSome of the detected payloads are Betabot and Lokibot, families observed in previous\ncampaigns.\nThis Betabot’s C&C are similar to observed in these previous campaigns—it uses same\ndomain as Campaign 3 for Betabot (stngpetty[.]ga) and uses a similar path\n(/~zadmin/{NAME1}/{NAME2}/logout.php).\n\nBased on their behavior, we’re unsure of whether the RATicate group is focused on corporate\nespionage or is simply acting as a malware-as-a-service provider to other actors. It could simply\n\n\n-----\n\nbe that they are dropping malware on targeted companies in order to provide paid access to\nothers, or are using InfoStealer and RAT malware as part of a larger malware distribution effort.\nWe continue to analyze the new attacks and hope to get deeper insight into their motivations.\n\n### Anti-sandboxing by dumb luck\n\nDuring our analysis of the first RATicate sample, we discovered that the Shellcode3 dropped by\nthe installer uses a number of interesting techniques to make it difficult to analyze API calls, as\nwell as a number of anti-debugging tricks to further hinder analysis. But we also found a strange\nbehavior in these samples: if the sample is executed with its SHA256 hash as its filename, the\nprogram will crash.\n\nAnalyzed sample crashing when the file name size is its SHA256 hash.\n\nThis sort of behavior might be seen as an anti-analysis trick. Since sandboxes usually run the\nsamples with their hash as a filename, this technique could avoid the execution of the payload in\nsandbox environments. But in this case, the behavior is actually because of a bug in the code.\n\nThe error occurs during the execution of shellcode 3.\n\nA snippet of shellcode 3’s code as viewed in IDA Pro.\n\nShellcode3 uses a known technique to get the address of loaded modules (such as libraries and\nthe executable’s image itself) by searching against the LDR_DATA_TABLE_ENTRY data\nstructure within the Windows operating system’s Process Environment Block (PEB). The LDR\n\n\n-----\n\nstructure contains information that includes the names and addresses of loaded modules. The\nshell code checks this structure against hashes of the desired function names, providing a silent\nway to dynamically resolve the memory address of a function to be called.\n\nShellcode 3 function to get module base addresses based on LDR_DATA_TABLE, which contains a bug that\n\ncauses the sample to crash.\n\nThis feature is implemented in the code’s get_dll_base_addres_from_ldr_by_hash(dll_hash)\nfunction, which is where the crash happens. The function walks through the LDR data structure,\nhashing the names of loaded modules in order to try to match the hash passed as argument.\n\nThe function puts the contents of ldr_data_table->BaseDllName.Buffer into vulnerable_buffer in\norder to convert the ANSI string to a UNICODE string.\n\nBut since the size of the vulnerable_buffer string is 104 and it’s storing a Unicode string, which\nmeans its size limit is really just 52 ANSI characters. The consequences of that are if the filename\nhas a length of 53 or more characters, a buffer overflow will occur. To make the program crash,\nyou simply need to give the sample a 57-character-long filename (such as\n“this_is_57_length_filename_in_order_to_do_a_crash_PoC.exe”).\n\nOnce analyzed, we determined this was a programming error, rather than an anti-sandbox\ntechnique.\n\n## Indicators of Compromise (IOCs)\n\nHashes for the files associated with the RATicate campaigns can be found on SophosLabs’\n[GitHub here.](https://github.com/sophoslabs/IoCs/blob/master/malware-Raticate)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2020/2020.05.14.RATicate/RATicate_%20an%20attacker%E2%80%99s%20waves%20of%20information-stealing%20malware%20%E2%80%93%20Sophos%20News.pdf"
    ],
    "report_names": [
        "RATicate_ an attacker’s waves of information-stealing malware – Sophos News"
    ],
    "threat_actors": [
        {
            "id": "0d07b30c-4393-4071-82fb-22f51f7749e0",
            "created_at": "2022-10-25T16:07:24.097096Z",
            "updated_at": "2025-03-27T02:02:10.106625Z",
            "deleted_at": null,
            "main_name": "RATicate",
            "aliases": [],
            "source_name": "ETDA:RATicate",
            "tools": [
                "AgenTesla",
                "Agent Tesla",
                "AgentTesla",
                "BetaBot",
                "BlackRAT",
                "BlackRemote",
                "Bladabindi",
                "CloudEyE",
                "ForeIT",
                "Formbook",
                "GuLoader",
                "Jorik",
                "Loki",
                "Loki.Rat",
                "LokiBot",
                "LokiPWS",
                "NSIS",
                "Negasteal",
                "NetWeird",
                "NetWire",
                "NetWire RAT",
                "NetWire RC",
                "NetWired RC",
                "Neurevt",
                "Nullsoft Scriptable Install System",
                "Origin Logger",
                "Recam",
                "Remcos",
                "RemcosRAT",
                "Remvio",
                "Socmer",
                "ZPAQ",
                "njRAT",
                "vbdropper",
                "win.xloader"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716499,
    "ts_updated_at": 1743041461,
    "ts_creation_date": 1589511928,
    "ts_modification_date": 1589511928,
    "files": {
        "pdf": "https://archive.orkl.eu/005000464a9f344017647ae24c95407f58b0187d.pdf",
        "text": "https://archive.orkl.eu/005000464a9f344017647ae24c95407f58b0187d.txt",
        "img": "https://archive.orkl.eu/005000464a9f344017647ae24c95407f58b0187d.jpg"
    }
}