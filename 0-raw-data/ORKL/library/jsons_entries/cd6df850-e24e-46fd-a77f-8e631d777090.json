{
    "id": "cd6df850-e24e-46fd-a77f-8e631d777090",
    "created_at": "2023-01-12T15:06:23.42183Z",
    "updated_at": "2025-03-27T02:05:53.558997Z",
    "deleted_at": null,
    "sha1_hash": "55d46f8b854a0244e0f059776728113e5a9c02e4",
    "title": "2020-04-28 - IcedID PhotoLoader evolution",
    "authors": "",
    "file_creation_date": "2022-05-28T17:57:43Z",
    "file_modification_date": "2022-05-28T17:57:43Z",
    "file_size": 337855,
    "plain_text": "# IcedID PhotoLoader evolution\n\n**[sysopfb.github.io/malware,/icedid/2020/04/28/IcedIDs-updated-photoloader.html](https://sysopfb.github.io/malware,/icedid/2020/04/28/IcedIDs-updated-photoloader.html)**\n\nRandom RE\n\nIcedID continues to evolve but yet not a lot of attention is given it, Joshua Platt, Vitali Kremez\n[and myself recently released a report[1] detailing how they have been targeting and continue](https://labs.sentinelone.com/icedid-botnet-the-iceman-goes-phishing-for-us-tax-returns/)\nto target tax season in the midst of the Covid-19 pandemic which has extended tax season in\nthe US to July.\n\nIn light of this they are also continuing to innovate on their malware tools including their\n[PhotoLoader which was detailed by MalwareBytes previously[2]. The loader has recently had](https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/)\na number of additions added to it which appear to be designed towards protecting the\npayloads and also evading network detection.\n\n## Config\n\nThe loader comes with an onboard configuration which will be decoded:\n\nDecoding this config shows some hex data and a number of domains:\n\nSome of these domains are legit and one of them stands out as suspect, the loader\nenumerates these domains and makes requests to them in a loop.\n\n\n-----\n\nAfter retrieving the content it will look for the first occurrence of ‘url(“‘ or ‘src=”’.\n\nIt will then build another request for this resource from the same domain but depending on\nthe flag value before the domain will determine whether or not the second request will have a\ncallback function set on the request for the retrieved resource.\n\n\n-----\n\nThe callback will add cookie values to the request headers.\n\nThe cookie values built are based on various information from the infected system.\n\n\n-----\n\n[An example of the request can be seen from this sandbox detonation[3]:](https://app.any.run/tasks/d092cd7a-3e1c-479f-93e0-6494e464f44e/)\n\nThe _u cookie value holds the username and computername hexlified.\n\n\n-----\n\nInspecting the data from the sandbox detonation:\n```\n>>> binascii.unhexlify(\n'4445534B544F502D4A474C4C4A4C44'\n)\n'DESKTOP-JGLLJLD'\n>>> binascii.unhexlify('61646D696E')\n'admin'\n\n```\nA breakdown of what the cookie values are:\n\n**Cookie** **Value**\n\n\n-----\n\n**Cookie** **Value**\n\n_gid Based on physical address of NIC\n\n_io Domain identifier from SID\n\n_u Username and Computername\n\n_gat Windows version info\n\n_ga Processor info via CPUID including hypervisor brand if available\n\n_gads First DWORD from decoded config data, flag from inspecting server certificate, a\nrandom DWORD or number passed as parameter with -id=, number of\nprocesses\n\nAfter pulling down the fake image file it will look for ‘IDAT’.\n\nUses a byte value to determine the size of the RC4 key before RC4 decrypting the data:\n\n\n-----\n\nThen will perform a hash check on the decoded data to determine if it was correct.\n\nIf the hash check fails it will just continue performing this enumeration through the domain\nlist, effectively turning this process into a checkin loop with fake traffic mixed in.\n\nMany of these added features to their photo loader appear to be designed for evading\nresearchers and detections, this gives us insights into their operations as what their\ncustomers are asking for dictates what their development team will prioritize. With the\nprevious photo loader being blogged about and signatures being released, it was only a few\nmonths before a new updated system was created to replace it.\n\n## IOCs\n\n1a4408ff606936ba91fa759414f1c6dd8b27e825\n\nca792a5d30d3ca751c4486e2d26c828a542a001a\n\nzajjizev[ ]club\n\n\n-----\n\nhxxp://45.147.231[.]107/ldr.exe\n\nhxxps://customscripts[.]us/ldr_2817175199.exe\n\nkarantino[.]xyz\n\nhinkaly[.]club\n\n## Signatures\n```\nalert http $HOME_NET any -> $EXTERNAL_NET any (msg:\"IcedID PhotoLoader Ver2\";\nflow:established,to_server; content:\".png\"; http_uri; content:\"__gads=\"; http_cookie;\ncontent:\"gat=\"; http_cookie; content:\"_ga=\"; http_cookie; content:\"_u=\"; http_cookie;\ncontent:\"__io=\"; http_cookie; content:\"_gid=\"; http_cookie; classtype:trojanactivity; sid:9000030; rev:1; metadata:author Jason Reaves;)\n\n```\nReferences:\n\n1. https://labs.sentinelone.com/icedid-botnet-the-iceman-goes-phishing-for-us-tax-returns/\n2. https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan\nuses-steganographic-payloads/\n3. https://app.any.run/tasks/d092cd7a-3e1c-479f-93e0-6494e464f44e/\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-04-28 - IcedID PhotoLoader evolution.pdf"
    ],
    "report_names": [
        "2020-04-28 - IcedID PhotoLoader evolution.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535983,
    "ts_updated_at": 1743041153,
    "ts_creation_date": 1653760663,
    "ts_modification_date": 1653760663,
    "files": {
        "pdf": "https://archive.orkl.eu/55d46f8b854a0244e0f059776728113e5a9c02e4.pdf",
        "text": "https://archive.orkl.eu/55d46f8b854a0244e0f059776728113e5a9c02e4.txt",
        "img": "https://archive.orkl.eu/55d46f8b854a0244e0f059776728113e5a9c02e4.jpg"
    }
}