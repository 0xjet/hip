{
    "id": "a2c2b20f-80fa-443d-b3b1-307942cc1386",
    "created_at": "2023-01-12T15:08:06.727991Z",
    "updated_at": "2025-03-27T02:05:19.934657Z",
    "deleted_at": null,
    "sha1_hash": "697482c213d5dcf03f504bf9336089ad72fd1007",
    "title": "2021-02-02 - XLSB- Analyzing a Microsoft Excel Binary Spreadsheet",
    "authors": "",
    "file_creation_date": "2022-05-28T03:31:53Z",
    "file_modification_date": "2022-05-28T03:31:53Z",
    "file_size": 385889,
    "plain_text": "# XLSB: Analyzing a Microsoft Excel Binary Spreadsheet\n\n**[clickallthethings.wordpress.com/2021/02/02/xlsb-analyzing-a-microsoft-excel-binary-spreadsheet/](https://clickallthethings.wordpress.com/2021/02/02/xlsb-analyzing-a-microsoft-excel-binary-spreadsheet/)**\n\nView all posts by Jamie February 2, 2021\n\nThe [@InQuest crew has been putting some unusual documents out on the Twitters and I](https://twitter.com/InQuest)\nthought I’d take a closer look at one of them. And as ALWAYS, new documents are never\nthat straight forward to analyze. Attackers always put a twist on what has already been done.\n\nIn this case, we’ve got an .xlsb file, XLM code, hidden sheets, protected sheets, and the\never-so-sneaky-hiding-in-plain-sight white font.\n\nHere’s the doc: **[https://app.any.run/tasks/47e1c347-664c-4ada-9655-1724387e859e/#](https://app.any.run/tasks/47e1c347-664c-4ada-9655-1724387e859e/#)**\n\n## Microsoft Excel Binary Spreadsheets (.xlsb)\n\nI can’t say that I’ve ever seen these until now. They open and function like any other\nspreadsheet. The difference is under the hood. They store the spreadsheet using a binary\nformat (BIFF12) rather than the typical .xlsx or .xls. This means that .xlsb files are usually\nbigger as they’re not compressed. Extremely complicated spreadsheets (ones with lots of\nformulas, charts, and shapes) can benefit from this file format as they may save and load\nmuch faster.\n\nBut this format means that some of our normal analysis tools do not work. For example,\noledump can’t find any OLE objects in the file.\n\nOfficeMalScanner will expand the document if you use the inflate option. However, the output\ndoesn’t show the normal vbaproject.bin. There’s a ton of other files that are NOT\nvbaproject.bin. (Of course, there’s no vbaproject.bin. Oledump.py didn’t find any macros,\nright?)\n\n\n-----\n\n-----\n\nIn hindsight, all of these .bin files make sense as this is an .xlsb file. It certainly didn t make\nsense the first time I cracked it open, though.\n\n## Analysis from within the document\n\nFirst, there are a bunch of hidden sheets.\n\nQuite a few of these sheets contain a lot of nonsense.\n\n\n-----\n\nHowever, Auto_Open is pointing to Sheet11!A1. If we go there, we can see a empty columns\ncontaining XLM in white font.\n\nAnd of COURSE we can’t edit the font because a bunch of these sheets are protected AND\nwe don’t have the password!\n\nIt is possible to enable content and step through the XLM like we’ve done before. However,\nthe other sheets contain macro code and characters that are spread out all over the place.\nThat’s annoying enough to analyze even if it wasn’t in white font.\n\n\n-----\n\n## Unprotecting the sheets\n\nAll hope is not lost. We can bypass the protected sheets if we save the document in a\ndifferent macro-enabled format like .xlsm. This will also change the worksheets from .bin files\nto .xml files. This will be important in a moment.\n\nChange your newly created .xlsm file to a .zip and navigate your way into xl\\worksheets and\n_xl\\macrosheets to find .xml sheets. We will un-protect these sheets by taking out a section_\ncalled sheetProtection. Delete everything from <sheetProtection to its trailing />, including\nthe two < > characters, and then save the .xml. Delete sheet protection wherever you find it.\n\nYou’ll have to drag the various .xml files out of the .zip file, edit them, and then copy them\nback into their appropriate locations. Finally, change the file from .zip to .xlsm.\n\n## Analyzing the XLM\n\nNow that the sheets are unprotected, we can finally get rid of that white font and see the\nXLM. Auto_open is pointing to Sheet11!A1. I color-coded the extraneous lines and analyzed\nthe three important =CALL() commands.\n\n\n-----\n\nUltimately, it downloads a .dll to C:\\ProgramData\\fps\\ and registers that .dll via rundll32.exe.\n\nAs a bonus, Excel does some of the XLM concatenating for us making analysis easier.\nHere’s an example from Sheet1. You can see that cell L3 contains\n=CONCATENATE(Sheet…), but the cell itself shows the result.\n\nGood times!\n\nThanks for reading.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-02-02 - XLSB- Analyzing a Microsoft Excel Binary Spreadsheet.pdf"
    ],
    "report_names": [
        "2021-02-02 - XLSB- Analyzing a Microsoft Excel Binary Spreadsheet.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536086,
    "ts_updated_at": 1743041119,
    "ts_creation_date": 1653708713,
    "ts_modification_date": 1653708713,
    "files": {
        "pdf": "https://archive.orkl.eu/697482c213d5dcf03f504bf9336089ad72fd1007.pdf",
        "text": "https://archive.orkl.eu/697482c213d5dcf03f504bf9336089ad72fd1007.txt",
        "img": "https://archive.orkl.eu/697482c213d5dcf03f504bf9336089ad72fd1007.jpg"
    }
}