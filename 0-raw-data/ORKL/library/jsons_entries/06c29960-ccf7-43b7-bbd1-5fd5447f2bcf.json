{
    "id": "06c29960-ccf7-43b7-bbd1-5fd5447f2bcf",
    "created_at": "2023-01-12T15:06:25.24272Z",
    "updated_at": "2025-03-27T02:10:04.935623Z",
    "deleted_at": null,
    "sha1_hash": "dd93245fcec67cfc366fd262787629e183daeda0",
    "title": "2022-02-07 - Roaming Mantis reaches Europe",
    "authors": "",
    "file_creation_date": "2022-07-18T18:22:08Z",
    "file_modification_date": "2022-07-18T18:22:08Z",
    "file_size": 2678810,
    "plain_text": "# Roaming Mantis reaches Europe\n\n**securelist.com/roaming-mantis-reaches-europe/105596/**\n\nAuthors\n\n[Suguru Ishimaru](https://securelist.com/author/suguru/)\n\n## Part VI. 2021 sees smishing and modified Wroba.g/Wroba.o extend attacks to Germany and France\n\nRoaming Mantis is a malicious campaign that targets Android devices and spreads mobile\n[malware via smishing. We have been tracking Roaming Mantis since 2018, and published](https://encyclopedia.kaspersky.com/glossary/smishing/?utm_source=securelist&utm_medium=blog&utm_campaign=termin-explanation)\nfive blog posts about this campaign:\n\n[Roaming Mantis uses DNS hijacking to infect Android smartphones](https://securelist.com/roaming-mantis-uses-dns-hijacking-to-infect-android-smartphones/85178/)\n[Roaming Mantis dabbles in mining and phishing multilingually](https://securelist.com/roaming-mantis-dabbles-in-mining-and-phishing-multilingually/85607/)\n[Roaming Mantis, part III](https://securelist.com/roaming-mantis-part-3/88071/)\n[Roaming Mantis, part IV](https://securelist.com/roaming-mantis-part-iv/90332/)\n[Roaming Mantis, part V](https://securelist.com/roaming-mantis-part-v/96250/)\n\n\n-----\n\nIt s been a while since the last blog post, but we ve observed some new activities by\nRoaming Mantis in 2021, and some changes in the Android Trojan Wroba.g (or Wroba.o,\na.k.a Moqhao, XLoader) that’s mainly used in this campaign. Furthermore, we discovered\nthat France and Germany were added as primary targets of Roaming Mantis, in addition to\nJapan, Taiwan and Korea.\n\n## Geography of Roaming Mantis victims\n\nOur latest research into Roaming Mantis shows that the actor is focusing on expanding\ninfection via smishing to users in Europe. The campaign in France and Germany was so\nactive that it came to the attention of the [German police and](https://www.polizei-praevention.de/aktuelles/sms-mit-paketbenachrichtigungslink-verursacht-massenhafte-sms.html) [French media. They alerted](https://cyberguerre.numerama.com/11670-votre-colis-a-ete-envoye-attention-a-ce-sms-il-cache-un-malware.html)\nusers about smishing messages and the compromised websites used as landing pages.\n\n**_Smishing alerts on German and French websites_**\n\nTypically, the smishing messages contain a very short description and a URL to a landing\npage. If a user clicks on the link and opens the landing page, there are two scenarios: iOS\nusers are redirected to a phishing page imitating the official Apple website, while the Wroba\nmalware is downloaded on Android devices.\n\n\n-----\n\n**_Link from smishing message redirects to Wroba or phishing page_**\n\nBased on the telemetry we gathered between July 2021 and January 2022, Wroba.g and\nWroba.o have been detected in many regions. The most affected countries were France,\nJapan, India, China, Germany and Korea.\n\n_Territories affected by Trojan-Dropper.AndroidOS.Wroba.g and Trojan-_\n_[Dropper.AndroidOS.Wroba.o (download)](https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2022/02/07090748/01-en-roaming-mantis-part-vi.png)_\n\nWe’d also like to point out some very interesting data on Roaming Mantis landing page\n[statistics published on Internet Week 2021 and](https://www.nic.ad.jp/iw2021/program/detail/#c25) [Github by @ninoseki, an independent](https://github.com/ninoseki/iw2021_moqhao/tree/main/)\nsecurity expert based in Japan. The data shows the number of downloaded APK files,\nlanding page domains, and IP addresses located in the seven regions targeted most by\nRoaming Mantis using Wroba.g/Wroba.o on a particular day in September 2021.\n\n\n-----\n\n**_The number of downloaded APK files and IPs/domains of landing pages_**\n\nThe following table is a ranking based on the number of APK file downloads. The most\naffected country is France, followed by Japan, Germany and others. Some targeted regions\nseem to overlap with our telemetry mentioned above.\n\n**Region** **Number of** **Impersonated**\n**brand**\n\n**IPs** **domains** **downloads**\n\n1 France 5 1,246 66,789 Google Chrome\n\n2 Japan 4 539 22,254 Yamato transport\n\n3 Germany 1 162 2,681 Google Chrome\n\n4 Korea 2 8 2,564 ePOST\n\n\n5 United\nStates\n\n\n5 123 549 Google Chrome\n\n\n6 Taiwan 1 62 302 智能宅急便 (Yamato transport\nin Chinese)\n\n7 Turkey 3 5 27 Google Chrome\n\n## Anti-researcher tricks in the landing page\n\n\n-----\n\nThroughout 2020 and 2021, the criminal group behind Roaming Mantis made use of various\nobfuscation techniques in the landing page script in order to evade detection.\n\n**_Variety of obfuscation techniques in the landing page script_**\n\nIn addition to obfuscation, the landing page blocks the connection from the source IP\naddress in non-targeted regions and shows just a fake “404” page for these connections.\n\nThe user agent checking feature has not been changed in the landing page since 2019; it\nevaluates the devices by user agent, redirecting to the phishing page if the device is iOSbased, or delivering the malicious APK file if the device is Android-based.\n\n## Technical analysis: loader module of Wroba.g/Wroba.o\n\nWe performed in-depth analysis of Wroba.g/Wroba.o samples and observed several\nmodifications in the loader module and payload, using kuronekoyamato.apk as an example.\nFirst, the actor changed the programming language from Java to Kotlin, a programming\nlanguage designed to interoperate fully with Java. Then, the actor removed the multidex\nobfuscation trick. Instead of this, the data structure of the embedded payload\n(\\assets\\rmocpdx\\15k7a5q) was also modified as follows:\n\n\n-----\n\n**_Modified data structure of embedded payload_**\n\nThe first eight bytes of the data are junk code (gray), followed by the size of payload\n(orange), a single-byte XOR key (red), the encrypted payload (green) and more junk code\n(gray). Furthermore, an ELF file, \\lib\\armeaib-v7a\\libdf.so, was embedded in the APK file: it\nuses Java Native Interface (JNI) for the second stage payload, for decryption and also part of\nthe loading feature. The decryption process and algorithms are just three steps as follows:\n\n**_Various obfuscation techniques in the landing page script_**\n\nFirst, the loader function takes each section of data from the embedded data, except the junk\ndata. Then, the encrypted payload is XORed using the embedded XOR key. After the XOR\noperation, as with previous samples, the data is decompressed using zlib to extract the\npayload, a Dalvik Executable (DEX) file.\n\nThe following simple Python script helps to extract the payload:\n\n\n-----\n\n1\n\n2\n\n3\n\n4\n\n5\n\n6\n\n7\n\n8\n\n9\n\n10\n\n11\n\n12\n\n13\n\n14\n\n15\n\n\n#!/usr/bin/env python3\n\nimport sys\n\nimport zlib\n\nimport base64\n\ndata = open(sys.argv[1], \"rb\").read()\n\nkey = data[11]\n\nsize = data[10] | data[9] << 8 | data[8] << 16\n\nenc = data[12:12+size]\n\ndec_x = bytes(enc[i] ^ key for i in range(len(enc)))\n\ndec_z = zlib.decompress(dec_x)\n\nwith open(sys.argv[1]+\".dec\",\"wb\") as fp:\n\nfp.write(dec_z)\n\n\nIn this sample, the decrypted payload is saved as \\data\\data\\ggk.onulfc.jb.utxdtt.bk\\files\\d\nand executed to infect the malicious main module on victim devices.\n\n## Technical analysis: payload of Wroba.g/Wroba.o\n\nRegarding the updates to the Wroba.g/Wroba.o payload, Kaspersky experts only observed\ntwo minor updates in the payload part. One of them is the feature for checking the region of\nthe infected device in order to display a phishing page in the corresponding language. In the\nold sample, it checked for three regions: Hong Kong, Taiwan and Japan. However, Germany\nand France were added as new regions. From this update, together with the map above, it is\nclear that Germany and France have become the main targets of Roaming Mantis with\nWroba.g/Wroba.o.\n\nAnother modification is in the backdoor commands. The developer added two backdoor\ncommands, “get_photo” and “get_gallery”, as well as removing the command\n“show_fs_float_window”. Overall, there are 21 embedded backdoor commands.\n\n\n-----\n\n**_List of embedded backdoor commands with the two new commands ‘get_gallery’ and_**\n**_‘get_photo’_**\n\nThese new backdoor commands are added to steal galleries and photos from infected\ndevices. This suggests the criminals have two aims in mind. One possible scenario is that\nthe criminals steal details from such things as driver’s licenses, health insurance cards or\nbank cards, to sign up for contracts with QR code payment services or mobile payment\nservices. The criminals are also able to use stolen photos to get money in other ways, such\nas blackmail or sextortion. The other functions of the payload are unchanged. For more\ndetails, please see our previous blogposts mentioned above.\n\n## Conclusion\n\nIt has been almost four years since Kaspersky first observed the Roaming Mantis campaign.\nSince then, the criminal group has continued its attack activities by using various malware\nfamilies such as HEUR:Trojan-Dropper.AndroidOS.Wroba, and various attack methods such\nas phishing, mining, smishing and DNS poisoning. In addition, the group has now expanded\nits geography, adding two European countries to its main target regions. We predict these\nattacks will continue in 2022 because of the strong financial motivation.\n\n## MD5 hashes of Wroba.o\n\n\n-----\n\n[527b5eebb6dbd3d0b777c714e707659c](https://opentip.kaspersky.com/527b5eebb6dbd3d0b777c714e707659c/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n\n[19c4be7d5d8bf759771f35dec45f267a](https://opentip.kaspersky.com/19c4be7d5d8bf759771f35dec45f267a/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n\n[2942ca2996a80ab807be08e7120c2556](https://opentip.kaspersky.com/2942ca2996a80ab807be08e7120c2556/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n\n[4fbc28088b9bf82dcb3bf42fe1fc1f6d](https://opentip.kaspersky.com/4fbc28088b9bf82dcb3bf42fe1fc1f6d/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n\n[0aaf6aa859fbdb84de20bf4bf28a02f1](https://opentip.kaspersky.com/0aaf6aa859fbdb84de20bf4bf28a02f1/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n\n[5bafe0e5a96b1a0db291cf9d57aab0bc](https://opentip.kaspersky.com/5bafe0e5a96b1a0db291cf9d57aab0bc/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n\n[ddd131d7f0918ece86cc7a68cbacb37d](https://opentip.kaspersky.com/ddd131d7f0918ece86cc7a68cbacb37d/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n\n[Google Android](https://securelist.com/tag/google-android/)\n[Malware Descriptions](https://securelist.com/tag/malware-descriptions/)\n[Malware Statistics](https://securelist.com/tag/malware-statistics/)\n[Malware Technologies](https://securelist.com/tag/malware-technologies/)\n[Mobile Malware](https://securelist.com/tag/mobile-malware/)\n[smishing](https://securelist.com/tag/smishing/)\n\nAuthors\n\n[Suguru Ishimaru](https://securelist.com/author/suguru/)\n\nRoaming Mantis reaches Europe\n\nYour email address will not be published. Required fields are marked *\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-02-07 - Roaming Mantis reaches Europe.pdf"
    ],
    "report_names": [
        "2022-02-07 - Roaming Mantis reaches Europe.pdf"
    ],
    "threat_actors": [
        {
            "id": "f9bc28d0-ce98-4991-84ae-5036e5f9d4e3",
            "created_at": "2022-10-25T16:07:24.546437Z",
            "updated_at": "2025-03-27T02:02:10.277573Z",
            "deleted_at": null,
            "main_name": "Roaming Mantis",
            "aliases": [
                "Roaming Mantis Group",
                "Shaoye"
            ],
            "source_name": "ETDA:Roaming Mantis",
            "tools": [
                "MoqHao",
                "Roaming Mantis",
                "SmsSpy",
                "Wroba",
                "XLoader"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "c94cb0e9-6fa9-47e9-a286-c9c9c9b23f4a",
            "created_at": "2023-01-06T13:46:38.823793Z",
            "updated_at": "2025-03-27T02:00:02.928254Z",
            "deleted_at": null,
            "main_name": "Roaming Mantis",
            "aliases": [
                "Roaming Mantis Group"
            ],
            "source_name": "MISPGALAXY:Roaming Mantis",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535985,
    "ts_updated_at": 1743041404,
    "ts_creation_date": 1658168528,
    "ts_modification_date": 1658168528,
    "files": {
        "pdf": "https://archive.orkl.eu/dd93245fcec67cfc366fd262787629e183daeda0.pdf",
        "text": "https://archive.orkl.eu/dd93245fcec67cfc366fd262787629e183daeda0.txt",
        "img": "https://archive.orkl.eu/dd93245fcec67cfc366fd262787629e183daeda0.jpg"
    }
}