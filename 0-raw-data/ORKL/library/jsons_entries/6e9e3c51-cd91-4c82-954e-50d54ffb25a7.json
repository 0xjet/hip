{
    "id": "6e9e3c51-cd91-4c82-954e-50d54ffb25a7",
    "created_at": "2023-01-12T15:02:07.911701Z",
    "updated_at": "2025-03-27T02:06:03.937175Z",
    "deleted_at": null,
    "sha1_hash": "c990ca1dda11e6b0e9ab058a06f8448d01e4ac4c",
    "title": "2019-05-05 - Unpacking NanoCore Sample Using AutoIT",
    "authors": "",
    "file_creation_date": "2022-05-28T17:37:29Z",
    "file_modification_date": "2022-05-28T17:37:29Z",
    "file_size": 2798304,
    "plain_text": "# Unpacking NanoCore Sample Using AutoIT\n\n**goggleheadedhacker.com/blog/post/11**\n\nJacob Pimental May 5, 2019\n\n### 05 May 2019\n\nIn this article I want to take a look at a Nanocore sample that I found on HybridAnalysis that\nis using a compiled AutoIT script as a packing technique. This article will go over how to\ndetect if a sample is using AutoIT and how to analyze it. The hash for this sample is\n[ad9f99ad687a8ae71a40fd589b028ef6194e35c7.](https://www.hybrid-analysis.com/sample/6b6fc99e796803233065509cec7644f1c731d996057e46d097b86f7524d8f702?environmentId=120)\n\nAs usual, one of the first things I do when analyzing a new sample is to run the “strings”\ncommand on the binary to see if there are any clues as to what it does. When running this\ncommand on the sample we will find the string “This is a third-party compiled AutoIt script.”,\nwhich is very self-explanatory. In order to decompile the sample we will need to download the\nprogram exe2aut. Last I checked, the site to download exe2aut is down so you can grab it\nfrom my [gitHub in the meantime.](http://github.com/JacobPimental/exe2aut)\n\n\n-----\n\nWhen running exe2aut you will be presented with a blank screen. To decompile our program\nyou need to drag the file onto the screen, which will then display the decompiled AutoIT\nscript. It will also create a file in your working directory that also contains the script.\n\nIt looks like the script is lightly obfuscated. The function thksczjzrvh seems to be the string\ndeobfuscation function, taking the obfuscated string and the symbol to remove from the\nstring as parameters. For example, the first variable, nthituvhcf, becomes the string\n_“Execute”._\n\nAt the end of the script we can see a call to multiple functions. The application grabs the\nresources MSIEXEC1, AUTOPLAY2, and PRINTFILTERPIPELINESVC3. These resources\ncontain very large hex strings that the script then concatenates together to create one\n\n\n-----\n\nextremely large hex string. The script will take this newly created string and decrypt it using\nthe Windows advapi.dll libray. I used a python script to deobfuscate the decryption function\nthe script is using.\n\nThe decryption function first uses CryptCreateHash with the key\n“akzejgkkukeebssbhftrhvxwizaftqlblnpvsogcvifsnyzpcs” to create a hash of the key. It then\nuses the function CryptDeriveKey to create a key from the created hash. Then the data is\ndecrypted using the key from the previous function using CryptDecrypt. With the ctypes\nlibrary in Python I managed to create a tool that will decrypt the final payload of the AutoIT\n[script. You can find it on my gitHub here. The decrypted file is a .NET executable. Loading](http://github.com/JacobPimental/nanocore_extractor)\nthis file into dnSpy confirms that this is NanoCore.\n\n\n-----\n\nI am not going to go in depth into the NanoCore payload as this article was meant to\ndemonstrate the extraction process and provide insight into how to RE a compiled AutoIT\nprogram. I have noticed this specific packing method used in multiple samples, not just\nNanoCore either. My script was able to unpack each sample successfully, my hope is that it\nproves useful to other researchers. Feel free to add commits to improve functionality. Also,\nfeel free to reach out to me on my [Twitter and](https://twitter.com/jacob_pimental) [LinkedIn with any questions or comments you](https://www.linkedin.com/in/jacobpimental/)\nhave on this article or any of my other articles.\n\nThanks for reading and happy reversing!\n\n**Malware Analysis, Malware, Unpacking, Scripting, Automation, DotNET, DnSpy, AutoIT**\n\n## More Content Like This:\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-05-05 - Unpacking NanoCore Sample Using AutoIT.pdf"
    ],
    "report_names": [
        "2019-05-05 - Unpacking NanoCore Sample Using AutoIT.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535727,
    "ts_updated_at": 1743041163,
    "ts_creation_date": 1653759449,
    "ts_modification_date": 1653759449,
    "files": {
        "pdf": "https://archive.orkl.eu/c990ca1dda11e6b0e9ab058a06f8448d01e4ac4c.pdf",
        "text": "https://archive.orkl.eu/c990ca1dda11e6b0e9ab058a06f8448d01e4ac4c.txt",
        "img": "https://archive.orkl.eu/c990ca1dda11e6b0e9ab058a06f8448d01e4ac4c.jpg"
    }
}