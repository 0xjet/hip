{
    "id": "151e67bf-bd9c-472f-b15e-96604034d758",
    "created_at": "2023-01-12T15:01:39.295341Z",
    "updated_at": "2025-03-27T02:05:50.340595Z",
    "deleted_at": null,
    "sha1_hash": "b83873400fed57ba296fefc08da3957691b3fc52",
    "title": "2014-11-26 - Getmypass Point of Sale Malware",
    "authors": "",
    "file_creation_date": "2022-10-02T12:11:00Z",
    "file_modification_date": "2022-10-02T12:11:00Z",
    "file_size": 314250,
    "plain_text": "# securitykitten.github.io/_posts/2014-11-26-getmypass- point-of-sale-malware.md\n\n**[github.com/malware-kitten/securitykitten.github.io/blob/master/_posts/2014-11-26-getmypass-point-of-sale-malware.md](https://github.com/malware-kitten/securitykitten.github.io/blob/master/_posts/2014-11-26-getmypass-point-of-sale-malware.md)**\n\nmalware-kitten\n\n**layout** **title** **date**\n\n\ncategorypost\n\n## Introduction\n\n\nGetmypass Point of Sale\nMalware\n\n\n2014-11-26 13:00:33\n-0500\n\n\nWhile doing some digging recently on VirusTotal I had a rule trigger on what\nappears to be a new POS malware family.\n\nThe MD5 (1d8fd13c890060464019c0f07b928b1a) is the malware that I will be\ndissecting in this post.\n\nThe first interesting thing that struck my eye is the incredibly low detection rate\nwhich at the time of this writing was 0/55.\n\n\n-----\n\nSecondly (and what may be affecting detection) is that the binary is signed from\n“Bargaining active” which is currently a valid certificate.\n\nSo digging into the code a bit, this malware appears to do something in\ncommon with other POS RAM scrapers.\n\nProcess Dumping\nSearching for CC data\nValidation using Luhn's algorithm\nWriting that to a file\nEncrypting / Encoding file\n\nThere doesn't appear to be any C2 functionality in this particular piece of\nmalware so this is more of a utility than a backdoor. This malware also does not\ncontain code to do any of the following:\n\nLateral movement\nCredential harvesting\nPushing the harvested data to a non-local file\nKeylogging\n\n## Analysis\n\n\n-----\n\nThe malware will first search for an ini file named 1.ini in the same directory as\nthe malware. Without the ini file the malware will exit. Thanks to Josh\nGrunzweig for pointing out the ini format.\n```\n[settings]\n\nproc=notepad.exe\n\ntime=1000\n\ncryp=1\n\n\n```\nThe cryp argument is responsible for toggling on/off functionality to encrypt the\ncollected CC data with RC4.\n\nThe malware will also create a mutex when running \"1yn8RQLkm8\"\n\nDiving in head first, the first function that stuck out to me is at loc 0x402360.\nThis function is responsible for iterating over processes, calling OpenProcess,\nand then ultimately ReadProcessMemory.\n\nVery (very!) rough logic for this would look resemble:\n\n{% highlight ruby %}\n{% raw %}\nprocs = CreateToolhelp32Snapshot\nProcess32FirstW(procs)\ndo\nOpenProcess\nwhile true\nif VirtualQueryEx\nReadProcessMemory\nelse\nbreak\nCloseHandle\nwhile Process32NextW\nCloseHandle\nVirtualFree\n{% endraw %}\n{% endhighlight %}\n\nMany of the POS ram scrapers will use this same sort of functionality to crawl\nand enumerate processes. One difference is that this malware does use a\nwhitelist (in the ini file) and only dumps processes the user would specify.\n\nBelow is a screenshot of the configuration file 1.ini and the encrypted track1\nand track2 CC information:\n\n\n-----\n\nWhen running the malware in a debugger, I posted sample track data into\nnotepad and stepped though execution. The malware will locate the notepad\nprocess (using the above loop) and then pass those results to a function to\nsearch for strings that look like track data. These are then parsed and the\nresults are passed to a function that will use the Luhn's algorithm to process\nand check for valid numbers. A lookup table is used rather than calculating a\ndigital root. This is the same version of the algorithm used in FrameworkPOS\nand Dexter.\n\n{% highlight c %}\n{% raw %}\nv5 = 0;\nv6 = 2;\nv7 = 4;\nv8 = 6;\nv9 = 8;\nv10 = 1;\nv11\n= 3;\nv12 = 5;\nv13 = 7;\nv14 = 9;\nv16 = 1;\nv15 = 0;\nv17 = a2;\nwhile ( 1 )\n{\nv2 = v17-;\nif ( !v2 )\nbreak;\nif ( v16 )\nv4 = *(_WORD *)(a1 + 2 * v17) - 48;\nelse\nv4 = *(&v5\n+ *(_WORD *)(a1 + 2 * v17) - 48);\nv15 += v4;\nv16 = v16 == 0;\n}\nreturn v15 % 10\n== 0;\n}\n{% endraw %}\n{% endhighlight %}\n\nWhich in source code would look more like this\n\n{% highlight c %}\n{% raw %}\nint IsValidCC(const char* cc,int CClen)\n{\nconst int\nm[] = {0,2,4,6,8,1,3,5,7,9}; // mapping for rule 3\nint i, odd = 1, sum = 0;\nfor (i =\nCClen; i--; odd = !odd) {\nint digit = cc[i] - '0';\nsum += odd ? digit : m[digit];\n}\nreturn sum % 10 == 0;\n}\n{% endraw %}\n{% endhighlight %}\n\nOnce the numbers have been validated, they are passed to an RC4 function\nand written out to rep.tmp and rep.bin the RC4 password used is \"getmypass\"\n\nDisabling the \"cryp\" option in the config file will write plaintext data to the\nrep.tmp and rep.bin files\n\n\n-----\n\n## Final Thoughts\n\nTo run this malware successfully the attacker would need several pieces of\ninformation:\n\nCredentials\nName of the POS executable / service\nA method for moving the data out of the network\n\nThis malware seems to be in its infancy. There are debug strings still existent in\nthe malware indicate to me that the author is still testing the tool or is still\nactively developing it.\n\nIt's important to track tools like this from their very young stages so that\nresearchers can watch them develop and eventually grow into the next big tool.\nWhile this isn't the most advanced POS RAM scraper there is, it's still capable\nof bypassing all 55 AV's used to scan it.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2014/2014-11-26 - Getmypass Point of Sale Malware.pdf"
    ],
    "report_names": [
        "2014-11-26 - Getmypass Point of Sale Malware.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535699,
    "ts_updated_at": 1743041150,
    "ts_creation_date": 1664712660,
    "ts_modification_date": 1664712660,
    "files": {
        "pdf": "https://archive.orkl.eu/b83873400fed57ba296fefc08da3957691b3fc52.pdf",
        "text": "https://archive.orkl.eu/b83873400fed57ba296fefc08da3957691b3fc52.txt",
        "img": "https://archive.orkl.eu/b83873400fed57ba296fefc08da3957691b3fc52.jpg"
    }
}