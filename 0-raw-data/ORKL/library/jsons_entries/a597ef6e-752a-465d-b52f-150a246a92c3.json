{
    "id": "a597ef6e-752a-465d-b52f-150a246a92c3",
    "created_at": "2023-01-12T15:05:37.130773Z",
    "updated_at": "2025-03-27T02:15:06.29612Z",
    "deleted_at": null,
    "sha1_hash": "f49ccf857e2551fb1739f6ed6560d99e32ebf393",
    "title": "2022-06-01 - Analysis of the attack activities of the Maha grass group using the documents of relevant government agencies in Pakistan as bait",
    "authors": "",
    "file_creation_date": "2022-07-18T18:06:43Z",
    "file_modification_date": "2022-07-18T18:06:43Z",
    "file_size": 4279936,
    "plain_text": "# 奇安信威胁情报中心\n\n**ti.qianxin.com/blog/articles/analysis-of-the-attack-activities-of-patchwork-using-the-documents-of-relevant-government-agencies-in-**\npakistan-as-bait\n\n返回 TI 主页\nRESEARCH\n\n数 据 驱 动 安 全\n\n## 背景\n\n摩诃草，又名Hangover、Patchwork、白象等，奇安信内部跟踪编号为APT-Q-36，最早由国外安全厂\n商Norman披露并命名为Hangover，2016年8月其他厂商后续披露了摩诃草组织的详细报告。国内其他\n安全厂商通常也称其为“白象”。该APT组织被广泛认为来自南亚地区某国，其最早攻击活动可以追溯到\n2009年11月，从2015年开始变得更加活跃。该组织主要针对Windows系统进行攻击，同时也会针对\nAndroid、Mac OS系统进行攻击。其攻击活动中使用了大量漏洞，其中至少包括一次 0day 漏洞利用攻\n击。\n\n摩诃草组织攻击目标所涉及的国家和地区分布非常广泛，除了中国和巴基斯坦等主要目标，还包括以色\n列、孟加拉国、美国、英国、日本、韩国等国以及中东和东南亚地区。该组织以鱼叉攻击为主，以少量\n水坑攻击为辅，针对目标国家的政府、军事、电力、工业、外交和经济进行网络间谍活动，窃取敏感信\n息[1]。\n\n## 概述\n\n摩诃草组织一直以来都是我们的重点关注对象。近期，奇安信威胁情报中心红雨滴团队在日常的威胁狩\n猎中捕获了该组织多个攻击样本。在此攻击活动中，攻击者使用带漏洞的RTF文件进行鱼叉攻击，当受\n害者点击执行诱饵文件之后，将会通过漏洞执行变种BADNEWS木马。从此次摩诃草的攻击活动中，我\n们总结出该组织的攻击手段具有以下特点：\n\n1. 熟悉目标国家的政府机构，使用政府机构图标增强诱饵的可信性；\n2. 初始感染文档使用CVE-2017-11882公式编辑器漏洞执行后续载荷；\n3. 提升加密效率，使用RC4算法替换AES-CBC-128算法对数据的加密；\n\n## 样本信息\n\n本次捕获的两例攻击样本为RTF文件，且均携带CVE-2017-11882公式编辑器漏洞。\n\n诱饵1\n\n以巴基斯坦旁遮普政府劳动和人力资源部相关文档为诱饵。\n\n\n-----\n\n诱饵相关信息如下：\n\n**-** **-**\n\n文件名 Reduction of working days.rtf\n\n**MD5** CB50C0650B32911DAEB17217AC258AFE\n\n文件大小 1308543 bytes\n\n样本上传地 巴基斯坦\n\n\n-----\n\n诱饵2\n\n以巴基斯坦旁遮普政府监督与评估总局相关文档为诱饵。\n\n诱饵相关信息如下：\n\n**-** **-**\n\n文件名 Recruitment of officials on deputation basis2.rtf\n\n**MD5** 26991E42F4FA6DFAB84CFA886B4D51F0\n\n文件大小 1194286 bytes\n\n样本上传地 巴基斯坦\n\n\n-----\n\n## 漏洞利用\n\n两个钓鱼文档都内置了CVE-2017-11882漏洞利用代码，通过触发Office应用中公式编辑器组件的栈溢出\n漏洞，从而执行指定的shellcode。\n\n漏洞利用将触发两段shellcode。第一段shellcode的主要功能为通过栈地址计算得到第二段shellcode的\n起始位置，并跳转至第二段shellcode执行。\n\nShellcode首先检测当前系统中是否存在Kaspersky主进程avp.exe或Avast主进程AvastSvc.exe，若存\n在，则通过cmd执行shell命令“/c schtasks /create /sc minute /mo 1 /tn WindowsUpdate /tr\nC:\\\\ProgramData\\\\OneDrive.exe“。\n\n然后恢复shellcode尾部PE文件的魔术头‘MZ’，并将其写入C:\\ProgramData\\OneDrive.exe程序中。\n\n\n-----\n\n随后在注册表中添加启动项实现持久化，最后启动OneDrive.exe程序，OneDrive.exe程序实际为摩诃草\n组织常用的BADNEWS木马。\n\n## BADNEWS木马\n\nBADNEWS木马自2016年8月首次被披露以来，历经多次的版本变更，还衍生出多个变种版本，本次捕\n获的BADNEWS木马就属于变种版本。根据该变种木马的时间戳来看，其创建时间为2022年5月22日，\n并且携带了有一个有效的签名，显示名称为5Y TECHNOLOGY LIMITED。\n\n该BADNEWS变种木马的基本信息如下：\n\n**-** **-**\n\n文件名 OneDrive.exe\n\n**MD5** 729DD4604FDA4B19146D8F33509A43F6\n\n文件类型 exe\n\n时间戳 6289FBB0 (2022/5/22 17:00:32)\n\n\n-----\n\nBADNEWS木马首先通过WMI获取当前系统唯 标识UUID，用于标识受害主机。\n\n通过执行powershell获取系统上的所有服务，并将结果写入RTYgjfdg.sys文件。\n\n通过执行tasklist命令来获取当前正在运行的进程列表，并将结果写入RTYgjfdg.sys文件。\n\n\n-----\n\n通过遍历指定注册表项来获取当前系统安装的产品信息，同样将结果写入RTYgjfdg.sys文件。\n\n随后向指定地址dayspringdesk.xyz/wfgkl/cvrkaf/xkj/test.php发送如下所示的POST请求：\n\n可以看到，该POST流量中包含加密后的数据。和以往不同的是，摩诃草组织似乎在尝试对BADNEWS\n木马进行改革，不再使用AES-CBC-128算法对数据进行加密，而是使用较为轻便的RC4算法进行加\n密，部分字段的数据在使用RC4算法加密后，还会使用Base64进行编码。其中RC4算法的加密密钥为”\nabcdefghijklmnopqrstuvwxyzABCD1234567890987654gzasdfghjklqwertpppqqq11111111110000011111”。\n\n将收集到的数据上传后，创建新线程来实现键盘记录功能，将其记录在atapi.sys文件中。\n\n\n-----\n\n随后通过nslookup来获取外部IP地址。\n\n将获取的IP、用户名、UUID等加密拼接后发送至C2。\n\nBADNEWS木马向C2发送上述POST请求后，C2将返回对应的指令字符，用来控制BADNEWS木马的\n后续动作，其指令码功能如下：\n\n**-** **-**\n\n\n-----\n\n**-** **-**\n\n指令码 功能\n\n1 把收集的文件上传\n\n2 截图后经RC4加密上传\n\n3 退出\n\n4 下载TGJdbkds.exe并执行\n\n5 创建指定文件\n\n6 把键盘记录器记录的atapi.sys文件经RC4加密后上传\n\n7 远程命令执行\n\n## 关联分析\n\n在摩诃草组织以往的攻击活动中，该组织擅长使用鱼叉攻击作为入口，将带有漏洞的文档向受害者投\n递，这些文档通常是RTF文档，由于是纯文本格式的文件，很容易让人放松警惕。本次攻击使用的\nShellcode与之前攻击使用的shellcode在利用手法上并未改变。\n\n其次在后续载荷中，摩诃草组织持续使用BANDEWS木马进行攻击，并对加密方式、网络流量请求的一\n些字段均做了一些调整，以往攻击中的键盘记录器功能通过窗口类的消息循环来实现，而本次捕获的\nBANDEWS变种木马摒弃了这种做法，并简化了键盘记录的内容，不再记录包括时间和窗口名称的详细\n日志。\n\n\n-----\n\n回看诱饵内容，可以发现键盘记录器结合诱饵内容，比较好的实现了对受害者信息的窃取。本次捕获的\n样本的上传地均为巴基斯坦拉合尔，可见摩诃草组织持续针对巴基斯坦进行情报刺探或信息获取。\n\n## 总结\n\n摩诃草组织是一个长期活跃的组织，其攻击武器较为丰富，其攻击武器并不会因为被安全公司多次曝光\n而有所收敛，反而会持续更新其攻击武器库。此次捕获的攻击活动也可以看出该组织攻击手法灵活多\n变，是攻击能力较强的APT团伙。\n\n虽然本次捕获的样本仅涉及南亚地区，但是我们要防患于未然。因此，奇安信红雨滴团队在此提醒广大\n用户，切勿打开社交媒体分享的来历不明的链接，不点击执行未知来源的邮件附件，不运行夸张标题的\n未知文件，不安装非正规途径来源的APP。做到及时备份重要文件，更新安装补丁。\n\n若需运行，安装来历不明的应用，可先通过奇安信威胁情报文件深度分析平台\n（https://sandbox.ti.qianxin.com/sandbox/page）进行判别。目前已支持包括Windows、安卓平台在内\n的多种格式文件深度分析。\n\n目前，基于奇安信威胁情报中心的威胁情报数据的全线产品，包括奇安信威胁情报平台（TIP）、奇安\n信天狗漏洞攻击防护系统、天擎、天眼高级威胁检测系统、奇安信NGSOC、奇安信态势感知等，都已\n经支持对此类攻击的精确检测。\n\n\n-----\n\n## IOCs\n\n**MD5**\n\nCB50C0650B32911DAEB17217AC258AFE\n\n26991E42F4FA6DFAB84CFA886B4D51F0\n\n729DD4604FDA4B19146D8F33509A43F6\n\n**C2**\n\ndayspringdesk.xyz\n\n## 参考链接\n\n[1] https://ti.qianxin.com/apt/detail/5aa10b90d70a3f2810c4d3c5?\nname=%E6%91%A9%E8%AF%83%E8%8D%89&type=map\n\n南亚地区\nAPT\n摩诃草\n\n分享到：\n\n\n-----",
    "language": "ZH",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-06-01 - Analysis of the attack activities of the Maha grass group using the documents of relevant government agencies in Pakistan as bait.pdf"
    ],
    "report_names": [
        "2022-06-01 - Analysis of the attack activities of the Maha grass group using the documents of relevant government agencies in Pakistan as bait.pdf"
    ],
    "threat_actors": [
        {
            "id": "7ea1e0de-53b9-4059-802f-485884180701",
            "created_at": "2022-10-25T16:07:24.04846Z",
            "updated_at": "2025-03-27T02:02:10.090459Z",
            "deleted_at": null,
            "main_name": "Patchwork",
            "aliases": [
                "APT-C-09",
                "ATK 11",
                "Capricorn Organisation",
                "Chinastrats",
                "Dropping Elephant",
                "Maha Grass",
                "Quilted Tiger",
                "TG-4410",
                "Thirsty Gemini",
                "Zinc Emerson"
            ],
            "source_name": "ETDA:Patchwork",
            "tools": [
                "AndroRAT",
                "Artra Downloader",
                "ArtraDownloader",
                "AutoIt backdoor",
                "BADNEWS",
                "BIRDDOG",
                "Bahamut",
                "Bozok",
                "Bozok RAT",
                "Brute Ratel",
                "Brute Ratel C4",
                "CinaRAT",
                "Crypta",
                "ForeIT",
                "JakyllHyde",
                "Loki",
                "Loki.Rat",
                "LokiBot",
                "LokiPWS",
                "NDiskMonitor",
                "Nadrac",
                "PGoShell",
                "PowerSploit",
                "PubFantacy",
                "Quasar RAT",
                "QuasarRAT",
                "Ragnatela",
                "Ragnatela RAT",
                "SocksBot",
                "TINYTYPHON",
                "Unknown Logger",
                "WSCSPL",
                "Yggdrasil"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "9c884c88-2c9f-49c5-856a-2383ad1d8ef8",
            "created_at": "2024-05-01T02:03:08.152Z",
            "updated_at": "2025-03-27T02:05:17.422887Z",
            "deleted_at": null,
            "main_name": "ZINC EMERSON",
            "aliases": [
                "Dropping Elephant ",
                "EHDevel ",
                "Manul ",
                "Monsoon ",
                "Operation Hangover ",
                "Patchwork ",
                "TG-4410 ",
                "Viceroy Tiger ",
                "Confucius "
            ],
            "source_name": "Secureworks:ZINC EMERSON",
            "tools": [
                " Hanove",
                " Mac OS X KitM Spyware",
                " Proyecto2",
                " YTY Backdoor",
                "Enlighten Infostealer"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "c81067e0-9dcb-4e3f-abb0-80126519c5b6",
            "created_at": "2022-10-25T15:50:23.285448Z",
            "updated_at": "2025-03-27T02:00:55.42906Z",
            "deleted_at": null,
            "main_name": "Patchwork",
            "aliases": [
                "Hangover Group",
                "Dropping Elephant",
                "Chinastrats",
                "Operation Hangover"
            ],
            "source_name": "MITRE:Patchwork",
            "tools": [
                "NDiskMonitor",
                "QuasarRAT",
                "BackConfig",
                "TINYTYPHON",
                "AutoIt backdoor",
                "PowerSploit",
                "BADNEWS",
                "Unknown Logger",
                "Socksbot"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535937,
    "ts_updated_at": 1743041706,
    "ts_creation_date": 1658167603,
    "ts_modification_date": 1658167603,
    "files": {
        "pdf": "https://archive.orkl.eu/f49ccf857e2551fb1739f6ed6560d99e32ebf393.pdf",
        "text": "https://archive.orkl.eu/f49ccf857e2551fb1739f6ed6560d99e32ebf393.txt",
        "img": "https://archive.orkl.eu/f49ccf857e2551fb1739f6ed6560d99e32ebf393.jpg"
    }
}