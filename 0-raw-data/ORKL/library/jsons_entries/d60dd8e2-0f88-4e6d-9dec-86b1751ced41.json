{
    "id": "d60dd8e2-0f88-4e6d-9dec-86b1751ced41",
    "created_at": "2023-01-12T15:00:21.646899Z",
    "updated_at": "2025-03-27T02:05:44.623138Z",
    "deleted_at": null,
    "sha1_hash": "90532d191bc27f08242181d39816f822da351648",
    "title": "2020-06-16 - The Little Ransomware That Couldn’t (Dharma)",
    "authors": "",
    "file_creation_date": "2022-05-28T18:02:26Z",
    "file_modification_date": "2022-05-28T18:02:26Z",
    "file_size": 607363,
    "plain_text": "# The Little Ransomware That Couldn’t (Dharma)\n\n**[thedfirreport.com/2020/06/16/the-little-ransomware-that-couldnt-dharma/](https://thedfirreport.com/2020/06/16/the-little-ransomware-that-couldnt-dharma/)**\n\nJune 16, 2020\n\n### Ransomware continues unabated in the year of continually mounting pressure. But for every big game actor out there compromising Fortune listed companies there are the little guys that maybe just aren’t as skilled.\n\n## Initial access:\n\n### Threat actor logged in from 217.138.202.116 as a local admin at 0858 UTC. Our threat actor apparently missed the little fact of being just local admin on a domain joined system.\n\n## Reconnaissance and Lateral fail:\n\n### But worry not, our intrepid actor brought their own enumeration and pivoting tool set NS.exe. We’ve seen this tool used time and time again to scan and map file shares. Executed at 0936 UTC.\n\n\n-----\n\n```\n%USERPROFILE%\\Desktop\\Oc\\NS.exe\n\n## Action on Objectives:\n\n### First was the execution of a bat file called shadow.bat, I bet you can guess what that does… (delete shadow files)\nvssadmin delete shadows /all\n\n Seconds later logdelete.bat is run. Guesses here, that’s right it clears all logs using wevtutil.exe.\n\n```\n\n-----\n\n### Following this closeapps.bat was run which loops through various common applications to try to prevent open file lockouts keeping critical files from being encrypted.\n\n\n-----\n\n-----\n\n### Registry run keys and two startup folders were then created for the primary ransomware file 1pgp.exe.\n```\nC:\\Users\\Administrator\\AppData\\Roaming\\Microsoft\\Windows\\Start\nMenu\\Programs\\Startup\\1pgp.exe\nC:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\StartUp\\1pgp.exe\nHKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\1pgp.exe\n\n Finally the ransomware executed and locked up the system.\n\n This ransomware can be linked to the Dharma/Crysis family of ransomware based on the pdb path present in the file strings.\n\n A rather sparse ransom note was left behind.\n\n## IOC’s\n\n### MISPPriv 5ee3822c-6828-418c-b619-62de950d210f and 68219.\n\n```\n\n-----\n\n```\n1pgp.exe|1ebb6bb49ac1077c5e7eba4d56f6a3a1\n1ebb6bb49ac1077c5e7eba4d56f6a3a1\n1a37bb789c7bdda44330fd55aa292f5f76dada5d\n2f2e75affe9217c7211043936678fb1777e2db4a8f1986b8805ddb1e84e9e99b\ncloseapps.bat|9b0d6df42f879ba969f82c7a0ab48bc6\n9b0d6df42f879ba969f82c7a0ab48bc6\nb5d6f94f270a02abedc7484dc7214d15d2cee99e\ne25245f98a23596e03e51535beb0f73c000de63e473580c4c26e7b8b01b4e593\nEverything.exe|8add121fa398ebf83e8b5db8f17b45e0\n8add121fa398ebf83e8b5db8f17b45e0\nc8107e5c5e20349a39d32f424668139a36e6cfd0\n35c4a6c1474eb870eec901cef823cc4931919a4e963c432ce9efbb30c2d8a413\nLogDelete.bat|fb9c610ba195f9b18a96b84c5e755df7\nfb9c610ba195f9b18a96b84c5e755df7\n5e4f2074850cce0eab4d6165807e86c88b5b8c0b\ne17ca6c764352c0a74e1e6b80278bb4395588df4bed64833b1b127ea2ca5c5fd\nNS.exe|597de376b1f80c06d501415dd973dcec\n597de376b1f80c06d501415dd973dcec\n629c9649ced38fd815124221b80c9d9c59a85e74\nf47e3555461472f23ab4766e4d5b6f6fd260e335a6abc31b860e569a720a5446\nShadow.bat|df8394082a4e5b362bdcb17390f6676d\ndf8394082a4e5b362bdcb17390f6676d\n5750248ff490ceec03d17ee9811ac70176f46614\nda3f155cfb98ce0add29a31162d23da7596da44ba2391389517fe1a2790da878\n217.138.202.116\n\n### YARA\n\n```\n\n-----\n\n```\n/\n  YARA Rule Set\n  Author: DFIR Report\n  Date: 2020-06-12\n  Identifier: dharma-06-12-20\n  Reference: https://thedfirreport.com/\n*/\n/* Rule Set ----------------------------------------------------------------- */\nimport \"pe\"\nrule vssadmin_Shadow_bat {\n  meta:\n   description = \"dharma-06-12-20 - file Shadow.bat\"\n   author = \"DFIR Report\"\n   reference = \"https://thedfirreport.com/\"\n   date = \"2020-06-12\"\n   hash1 = \"da3f155cfb98ce0add29a31162d23da7596da44ba2391389517fe1a2790da878\"\n  strings:\n   $s1 = \"vssadmin delete shadows /all\" fullword ascii\n  condition:\n   uint16(0) == 0x7376 and filesize < 1KB and\n   all of them\n}\nrule Network_Scanner_post_exploit_enumeration {\n  meta:\n   description = \"dharma-06-12-20 - file NS.exe\"\n   author = \"DFIR Report\"\n   reference = \"https://thedfirreport.com/\"\n   date = \"2020-06-12\"\n   hash1 = \"f47e3555461472f23ab4766e4d5b6f6fd260e335a6abc31b860e569a720a5446\"\n  strings:\n   $s1 = \"CreateMutex error: %d\" fullword ascii\n   $s2 = \"--Error mount \\\\\\\\%s\\\\%s Code: %d\" fullword wide\n   $s3 = \"-Found share \\\\\\\\%s\\\\%s\" fullword wide\n   $s4 = \"--Share \\\\\\\\%s\\\\%s successfully mounted\" fullword wide\n   $s5 = \"host %s is up\" fullword ascii\n   $s6 = \"Get ip: %s and mask: %s\" fullword wide\n   $s7 = \"GetAdaptersInfo failed with error: %d\" fullword wide\n   $s8 = \"# Network scan and mount include chek for unmounted local volumes. #\"\nfullword wide\n   $s9 = \"####################################################################\"\nfullword wide /* reversed goodware string\n'####################################################################' */\n   $s10 = \"Share %s successfully mounted\" fullword wide\n   $s11 = \"Error mount %s %d\" fullword wide\n   $s12 = \"Failed to create thread.\" fullword ascii\n   $s13 = \" start scan for shares. \" fullword wide\n   $s14 = \"# '98' was add for standalone usage!                #\"\nfullword wide\n   $s15 = \"Error, wrong value.\" fullword wide\n   $s16 = \"QueryDosDeviceW failed with error code %d\" fullword wide\n   $s17 = \"FindFirstVolumeW failed with error code %d\" fullword wide\n\n```\n\n-----\n\n```\n   $s18 FindNextVolumeW failed with error code %d fullword wide\n   $s19 = \"SetVolumeMountPointW failed with error code %d\" fullword wide\n   $s20 = \"|  + scan local volumes for unmounted drives.          |\"\nfullword wide\n  condition:\n   uint16(0) == 0x5a4d and filesize < 400KB and\n   ( pe.imphash() == \"0b0d8152ea7241cce613146b80a998fd\" or 8 of them )\n}\nrule Dharma_ransomware_1pgp {\n  meta:\n   description = \"dharma-06-12-20 - file 1pgp.exe\"\n   author = \"DFIR Report\"\n   reference = \"https://thedfirreport.com/\"\n   date = \"2020-06-12\"\n   hash1 = \"2f2e75affe9217c7211043936678fb1777e2db4a8f1986b8805ddb1e84e9e99b\"\n  strings:\n   $x1 = \"C:\\\\crysis\\\\Release\\\\PDB\\\\payload.pdb\" fullword ascii\n   $s2 = \"sssssbsss\" fullword ascii\n   $s3 = \"sssssbs\" fullword ascii\n   $s4 = \"9c%Q%f\" fullword ascii\n   $s5 = \"jNYZO\\\\\" fullword ascii\n   $s6 = \"RSDS%~m\" fullword ascii\n   $s7 = \"xy ?*5\" fullword ascii\n   $s8 = \"<a-g6J\" fullword ascii\n   $s9 = \"]q)WtH?\" fullword ascii\n   $s10 = \"s=9uo^\" fullword ascii\n   $s11 = \"\\\"iMw\\\\e\" fullword ascii\n   $s12 = \"{?nT*}2g\" fullword ascii\n   $s13 = \"h*UqD*\" fullword ascii\n   $s14 = \"b,_f n7\" fullword ascii\n   $s15 = \"+mm7S%I\" fullword ascii\n   $s16 = \"+L]DAb\" fullword ascii\n   $s17 = \"nq0<3AD\" fullword ascii\n   $s18 = \"U2cUbO\" fullword ascii\n   $s19 = \";C!|E2z\" fullword ascii\n   $s20 = \"P)8$X=\" fullword ascii\n  condition:\n   uint16(0) == 0x5a4d and filesize < 300KB and\n   ( pe.imphash() == \"f86dec4a80961955a89e7ed62046cc0e\" or ( 1 of ($x*) or 4 of\nthem ) )\n}\nrule closeapps_bat {\n  meta:\n   description = \"dharma-06-12-20 - file closeapps.bat\"\n   author = \"DFIR Report\"\n   reference = \"https://thedfirreport.com/\"\n   date = \"2020-06-12\"\n   hash1 = \"e25245f98a23596e03e51535beb0f73c000de63e473580c4c26e7b8b01b4e593\"\n  strings:\n   $x1 = \"taskkill /F /IM MSExchangeTransportLogSearch.exe\" fullword ascii\n   $x2 = \"taskkill /F /IM Veeam.Backup.Agent.ConfigurationService.exe\" fullword\nascii\n   $x3 = \"taskkill /F /IM MSExchangeTransport.exe\" fullword ascii\n\n```\n\n-----\n\n```\n   $x4 taskkill /F /IM EdgeTransport.exe fullword ascii\n   $x5 = \"taskkill /F /IM Microsoft.Exchange.ServiceHost.exe\" fullword ascii\n   $x6 = \"taskkill /F /IM Microsoft.Exchange.ProtectedServiceHost.exe\" fullword\nascii\n   $x7 = \"taskkill /F /IM agent.exe\" fullword ascii\n   $x8 = \"taskkill /F /IM fdhost.exe\" fullword ascii\n   $x9 = \"taskkill /F /IM MSExchangeThrottling.exe\" fullword ascii\n   $x10 = \"taskkill /F /IM sqlagentc.exe\" fullword ascii\n   $x11 = \"taskkill /F /IM Microsoft.Exchange.ContentFilter.Wrapper.exe\" fullword\nascii\n   $x12 = \"taskkill /F /IM Veeam.Backup.CatalogDataService.exe\" fullword ascii\n   $x13 = \"taskkill /F /IM cbInterface.exe\" fullword ascii\n   $x14 = \"taskkill /F /IM httpd.exe\" fullword ascii\n   $x15 = \"taskkill /F /IM VeeamTransportSvc.exe\" fullword ascii\n   $x16 = \"taskkill /F /IM cbService.exe\" fullword ascii\n   $x17 = \"taskkill /F /IM Veeam.Backup.BrokerService.exe\" fullword ascii\n   $x18 = \"taskkill /F /IM wsusservice.exe\" fullword ascii\n   $x19 = \"taskkill /F /IM pvxcom.exe\" fullword ascii\n   $x20 = \"taskkill /F /IM Veeam.Backup.MountService.exe\" fullword ascii\n  condition:\n   uint16(0) == 0x6c3a and filesize < 10KB and\n   1 of ($x*)\n}\nrule LogDelete_bat {\n  meta:\n   description = \"dharma-06-12-20 - file LogDelete.bat\"\n   author = \"DFIR Report\"\n   reference = \"https://thedfirreport.com/\"\n   date = \"2020-06-12\"\n   hash1 = \"e17ca6c764352c0a74e1e6b80278bb4395588df4bed64833b1b127ea2ca5c5fd\"\n  strings:\n   $s1 = \"FOR /F \\\"delims=\\\" %%I IN ('WEVTUTIL EL') DO (WEVTUTIL CL \\\"%%I\\\") \"\nfullword ascii\n  condition:\n   uint16(0) == 0x4f46 and filesize < 1KB and\n   all of them\n}\nrule Everything_seach_tool {\n  meta:\n   description = \"dharma-06-12-20 - file Everything.exe\"\n   author = \"DFIR Report\"\n   reference = \"https://thedfirreport.com/\"\n   date = \"2020-06-12\"\n   hash1 = \"35c4a6c1474eb870eec901cef823cc4931919a4e963c432ce9efbb30c2d8a413\"\n  strings:\n   $x1 = \"<assembly xmlns=\\\"urn:schemas-microsoft-com:asm.v1\\\"\nmanifestVersion=\\\"1.0\\\" xmlns:asmv3=\\\"urn:schemas-microsoft-com:asm.v3\\\"><a\" ascii\n   $s2 = \"\\\" version=\\\"6.0.0.0\\\" processorArchitecture=\\\"*\\\"\npublicKeyToken=\\\"6595b64144ccf1df\\\" language=\\\"*\\\"></assemblyIdentity></depen\" ascii\n   $s3 = \"http://www.voidtools.com/downloads/\" fullword ascii\n   $s4 = \"http://www.voidtools.com/downloads/#language\" fullword ascii\n   $s5 = \"Folder\\\\shell\\\\%s\\\\command\" fullword ascii\n   $s6 = \"Directory\\\\background\\\\shell\\\\%s\\\\command\" fullword ascii\n\n```\n\n-----\n\n```\n   $s7 Directory\\\\Background\\\\shell\\\\%s\\\\command fullword ascii\n   $s8 = \"yIdentity version=\\\"1.0.0.0\\\" processorArchitecture=\\\"*\\\"\nname=\\\"Everything\\\" type=\\\"win32\\\"></assemblyIdentity><description>Eve\" ascii\n   $s9 = \"; settings stored in %APPDATA%\\\\Everything\\\\Everything.ini\" fullword\nascii\n   $s10 = \"Host the pipe server with the security descriptor.\" fullword ascii\n   $s11 = \"http://www.voidtools.com/support/everything/\" fullword ascii\n   $s12 = \"username:[email protected]:port\" fullword ascii\n   $s13 = \"<html><meta http-equiv=\\\"Content-Type\\\" content=\\\"text/html;\ncharset=utf-8\\\"><meta name=\\\"viewport\\\" content=\\\"width=512\\\"><head\" ascii\n   $s14 = \"\\\\\\\\.\\\\PIPE\\\\Everything Service\" fullword ascii\n   $s15 = \"Everything Service Debug Log.txt\" fullword wide\n   $s16 = \"Auto detect will attempt to read file contents with the associated\nIFilter.\" fullword ascii\n   $s17 = \"processed %I64u / %I64u file records\" fullword ascii\n   $s18 = \"SERVICE_SERVER_COMMAND_REFS_MONITOR_READ_USN_JOURNAL_DATA read ok %d\"\nfullword ascii\n   $s19 = \"Store settings and data in %APPDATA%\\\\Everything?\" fullword ascii\n   $s20 = \"http://www.voidtools.com/donate/\" fullword ascii\n  condition:\n   uint16(0) == 0x5a4d and filesize < 5000KB and\n   ( pe.imphash() == \"e7a8222fca78bde6fe29c9cc10d97ca2\" or ( 1 of ($x*) or 4 of\nthem ) )\n}\n/* Super Rules ------------------------------------------------------------- */\nrule Everything_search_tool_super {\n  meta:\n   description = \"dharma-06-12-20 - from files Everything.exe, Everything.exe\"\n   author = \"DFIR Report\"\n   reference = \"https://thedfirreport.com/\"\n   date = \"2020-06-12\"\n   hash1 = \"35c4a6c1474eb870eec901cef823cc4931919a4e963c432ce9efbb30c2d8a413\"\n   hash2 = \"35c4a6c1474eb870eec901cef823cc4931919a4e963c432ce9efbb30c2d8a413\"\n  strings:\n   $s1 = \"-disable-run-as-admin\" fullword ascii /* Goodware String - occured 1\ntimes */\n   $s2 = \"type=%s;\" fullword ascii /* Goodware String - occured 1 times */\n   $s3 = \"EVERYTHING\" fullword ascii /* Goodware String - occured 1 times */\n   $s4 = \"-install-run-on-system-startup\" fullword ascii /* Goodware String occured 2 times */\n   $s5 = \"-uninstall-url-protocol\" fullword ascii /* Goodware String - occured 2\ntimes */\n   $s6 = \"-app-data\" fullword ascii /* Goodware String - occured 2 times */\n   $s7 = \"-uninstall-service\" fullword ascii /* Goodware String - occured 2 times\n*/\n   $s8 = \"-uninstall-efu-association\" fullword ascii /* Goodware String - occured\n2 times */\n  condition:\n   ( uint16(0) == 0x5a4d and filesize < 5000KB and pe.imphash() ==\n\"e7a8222fca78bde6fe29c9cc10d97ca2\" and ( all of them )\n   ) or ( all of them )\n}\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-06-16 - The Little Ransomware That Couldn’t (Dharma).pdf"
    ],
    "report_names": [
        "2020-06-16 - The Little Ransomware That Couldn’t (Dharma).pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535621,
    "ts_updated_at": 1743041144,
    "ts_creation_date": 1653760946,
    "ts_modification_date": 1653760946,
    "files": {
        "pdf": "https://archive.orkl.eu/90532d191bc27f08242181d39816f822da351648.pdf",
        "text": "https://archive.orkl.eu/90532d191bc27f08242181d39816f822da351648.txt",
        "img": "https://archive.orkl.eu/90532d191bc27f08242181d39816f822da351648.jpg"
    }
}