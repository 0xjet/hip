{
    "id": "4d670a67-c203-420c-8df0-5ab1be7866bd",
    "created_at": "2022-10-25T16:48:15.22746Z",
    "updated_at": "2025-03-27T02:16:20.862391Z",
    "deleted_at": null,
    "sha1_hash": "d055ed78d134e377b39a2172957b377946a37da3",
    "title": "Turla - operations & development",
    "authors": "",
    "file_creation_date": "2014-10-26T16:33:38Z",
    "file_modification_date": "2014-10-26T16:33:38Z",
    "file_size": 1856012,
    "plain_text": "Picture from deviantart.com\n\n# Turla - development & operations\n\n##### THE BIG PICTURE\n\n###### ANDRZEJ DERESZOWSKI\n\n\n-----\n\n## Agenda\n\n######  Introduction\n\n  Part I – Development\n\n  Part II – Operations\n\n  How to protect yourself\n\n  Attribution ?\n\n\n-----\n\n## A bit of history from my perspective\n\n######  2008 – Agent.BTZ – threat that hit Pentagon\n\n  2009 – Some Agent.BTZ incidents here and there\n\n  2011 – me, tecamac and other researchers get together to analyze\n certain complex threat\n\n  Beginning 2013 – we started distributing our report and help others\n handle infections\n\n  Beginning 2014 – a series of discoveries started by G-Data and BAE\n Systems\n\n\n-----\n\n## What has been published so far ?\n\n######  ThreatExpert – “Agent.btz - A Threat That Hit Pentagon” – Nov 2008\n\n  Trend Mirco - Windows XP/Server 2003 Zero-Day Payload Uses Multiple Anti- Analysis Techniques – Dec 2013\n\n  G-DATA – “Uroburos – Highly complex espionage software with Russian roots” – Feb 2014\n\n  BAE Systems – “Snake Campaign & Cyber Espionage Toolkit” – Mar 2014\n\n  Deresz&tecamac – “Uroburos – The Snake Rootkit” – Mar 2014\n\n  Sourcefire VRT – “Snake Campaign: A few words about the Uroburos Rootkit” – Apr 2014\n\n  F-Secure – “Anatomy of Turla Exploits” – May 2014\n\n  Kernelmode.info threads – Jun 2014\n\n  CIRCL – “TR-25 Analysis - Turla / Pfinet / Snake/ Uroburos” – Jul 2014\n\n  Symantec – “Turla: Spying tool targets governments and diplomats” – Aug 2014\n\n  Kaspersky – “The Epic Turla Operation – Aug 2014\n\n\n-----\n\n## Many publications – many names\n\n######  Currently there is a lot of confusion in naming scheme\n\n  Final stage:\n Agent.BTZ/Snake/Turla/Uroburos/Carbon/Pfinet/Snark/Sengoku\n\n  Reconaissance stage:\n Epic/Tavdig/WipBot/WorldCupSec/TadjMakhal\n\n  NOT all of them decribe the same « product »\n\n\n-----\n\n# PART I Development\n\n\n-----\n\n## What is Turla ?\n\n######  Family of related sophisticated backdoor software\n\n  Name comes from Microsoft detection signature – anagram of Ultra\n (Ultra3 was a name of the fake driver)\n\n  All related by shared code\n\n\n-----\n\n###### Agent.BTZ: Snake:\n\n - Sengoku - Urouros Pfinet: - Snark\n\n - Carbon - Kernelmode-centric Snake\n - Usermorde-centric Snake\n\n#### Agent.BTZ Pfinet Snake\n\n (2006) (2009) (2011)\n\n\n-----\n\n|Feature|Agent.BTZ|Pfinet|Snake|\n|---|---|---|---|\n|Storage|Hidden folder|Encrypted VFS|Encrypted VFS|\n|Configuration|Hardcoded|Text file|Key-value store (queue)|\n|Networking|Separate exes|Userland payloads|Kernel+userland|\n|Incomming transports|No|No|Yes|\n\n\n## Features: summary\n\n###### Feature Agent.BTZ Pfinet Snake\n\n Storage Hidden folder Encrypted VFS Encrypted VFS\n\n Configuration Hardcoded Text file Key-value store (queue)\n\n Networking Separate exes Userland payloads Kernel+userland\n\n Incomming transports No No Yes\n\n\n-----\n\n###### Pfinet Snake\n\n## VirtualBox exploit to load the driver\n\n###### Uses a vulnerability in old (yet still signed!) VirtualBox driver to load its own driver\n Source: F-Secure\n\n Source: Sourcefire VRT\n\n Source: kernelmode.info\n\n\n-----\n\n###### Pfinet\n\n## Udis86: on-the-fly manipulation of Snake dissassembled code in live kernel\n\n###### Source: deresz & tecamac\n\n\n-----\n\n###### Snake\n\n## Hooking engine – Udis86 reused\n\n###### Source: deresz & tecamac\n\n\n-----\n\n###### Snake\n\n## Encrypted VFS\n\n######  Implemented in Carbon and Snake\n\n  CAST 128 encryption used\n Source: deresz & tecamac\n  Decryption/encryption implemented on low level by\n hooking sector processing mechanisms:\n\n\n-----\n\n###### Snake\n\n## Encryped VFS\n\n###### Two volumes: permanent (mapped to a file on a real file system) and volatile storage\n\n Encrypted container located in %windows%\\$NtUninstallQ817473$\\hotfix.dat\n\n Source: deresz & tecamac\n\n\n-----\n\n## Configuration mechanism\n\n######  Agent.BTZ:\n\n  Config hardcoded in the user mode executables\n\n  Pfinet:\n\n  Configuration file stored on the VFS in a flat file: config.txt\n\n  Transports implemented in user mode\n\n  Usermode payloads hardcoded in the rootkit body:\n\n  cryptoapi.dll\n\n  inetpub.dll\n\n\n-----\n\n## Configuration mechanism\n\n######  SNAKE:\n\n  Uses « queue » file that contains configuration parameters in the form of\n key/value pairs\n\n  « queue » file located on the VFS\n\n  Queue contains:\n\n  Transports configuration\n\n  Userland payloads:\n\n inj_snake_Win32.dll – a counterpart of a rootkit for userland\n\n inj_services_Win32.dll\n\n rkctl_Win32.dll\n\n\n-----\n\n###### Snake\n\n#### Modular transports – channel elements\n\n###### Type 2 (m) Type 4 (d) Type 3 (t) Type 1 (b)\n\nmpx\n\n###### enc doms t2m tcp network\n\n frag domc\n Type 5 (s)\n\nreliable\n\n###### udp network sicmp converters\n\n d2s m2d m2b\n\n\\\\.\\pipe\\P\n###### np\n\n\n-----\n\n##### Modular transports – combined together Snake\n\n###### enc.frag.np\n\nHTTP covert\n\\\\.\\pipe\\P\n\nchannel enc frag np\n\n###### domc.np\n\n Kernel mode\n\nDatagram\n###### domc np \\\\.\\pipe\\P\ncovert channel\n\n###### frag.enc.reliable.doms.np\n\n User\n\nmpx t2m frag enc reliable doms np \\\\.\\pipe\\P\n\n###### mode\n\n\n-----\n\n## Protocols to choose\n\n######  Datagram covert channels:\n - Raw layer 2 (Ethernet type 0x7FF)\n - Raw ICMP\n - Raw UDP - DNS\n - Raw IP\n\n  Stream covert channels and activation triggers:\n - Raw TCP\n - HTTP: URL parameters of an HTTP request\n - HTTP: Hidden in HTTP headers\n - HTTP: Hidden in local part of the URL\n - SMTP: triggered by a recipient e-mail address\n\n\n-----\n\n## Examples of incoming transports – covert channels\n\n###### SMTP covert channel – rootkit resides on the mail server of pwned-prg.com\n```\n    HELO whatever.com\n    250 Hello whatever.com, I am glad to meet you\n    MAIL FROM: <you.bet@you.are.not>\n\n 250 OK Recipient user name must be 10 characters\n Last two characters (in red) are the checksum calculated\n    RCPT TO: <trueburger@pwned-org.com> on the first 8:\n    250 OK username[9] == sum / 26 + 65\n    354 End data with <CR><LF>.<CR><LF> username[10] == 122 - sum % 26\n    <commands>\n    .\n\n```\n\n-----\n\n## Examples of incoming transports\n\n###### HTTP covert channel – rootkit resides on the web server of pwned-prg.com\n```\n   GET / HTTP/1.1\n   SomeHeader: trueburgerYmFzZTY0ZW5jb2RlZCBzdHJpbmcKYmFz\n   …\n\n - Same signature calculated on the first 10 bytes of the header value - Base 64 content that follows is decoded and XOR-ed back with raw buffer starting at offset 0 - First four bytes of the resulting content is a magic value, by default set to 0xDEADBEEF but changed by the initialization queue\n\n SNORT signatures – difficult to create ! Possible to create Surricata sigs with the use of LUA\n\n```\n\n-----\n\n## Big picture view of compromised network\n\n\n-----\n\n## Developers\n\n######  Vlad, gilg, urik\n\n  Version control info present in some of the samples:\n\n $Id: snake_config.c 5204 2007-01-04 10:28:19Z vlad $ $Id: mime64.c 12892 2010-06-24 14:31:59Z vlad $ $Id: event.c 14097 2010-11-01 14:46:27Z gilg $ $Id: named_mutex.c 15594 2011-03-18 08:04:09Z gilg $ $Id: nt.c 20719 2012-12-05 12:31:20Z gilg $ $Id: ntsystem.c 19662 2012-07-09 13:17:17Z gilg $ $Id: rw_lock.c 14516 2010-11-29 12:27:33Z gilg $ $Id: rk_bpf.c 14518 2010-11-29 12:28:30Z gilg $ $Id: t_status.c 14478 2010-11-27 12:41:22Z gilg $ $Id: l1_check.c 4477 2006-08-28 15:58:21Z vlad $ $Id: m2_to_b2_stub.c 4477 2006-08-28 15:58:21Z vlad $ $Id: m_frag.c 8715 2007-11-29 16:04:46Z urik $\n\n\n-----\n\n## Who are they ?\n\n\n-----\n\n# PART II Operations\n\n\n-----\n\n## Hmm, which group are we talking about ?\n\n######  Not sure we can speak about one « Turla group »\n\n  Turla is just one of the tools « Turla group(s) » uses\n\n  There is however a lot of common things …\n\n  While the tool itself is quite impressive, operators that are using it are\n sloppy …\n\n\n-----\n\n## Countries of interest\n\n###### Source: BAE Systems\n\n\n-----\n\n## Publicly known victims\n\n\n-----\n\n## Turla: Staged operation\n\n######  Stage 0 – attack stage - infection vector\n\n  Stage 1 – reconaissance stage - initial backdoor\n\n  Stage 2 – lateral movements\n\n  Stage 3 – « access established » stage – TURLA deployed\n\n  On each stage they can quit if it turns out that the « non-interesting »\n victim has been encountered\n\n\n-----\n\n## Stage 0: infection vector\n\n######  Traditional infection vector – spear phishing: exploits (CVE-2013-3346\n + CVE-2013-5065)\n\n  Watering holes (strategic web compromise)\n\n  “Adobe update” social engineering trick\n\n  Java exploits (CVE-2012-1723), Adobe Flash exploits (unknown) or Internet Explorer 6, 7, 8 exploits (unknown)\n\n  Third party suppliers compromise\n\n  No use of 0-day exploits (almost no)\n\n\n-----\n\n#### Stage 0: Watering holes mechanism\n\n###### Source: Kaspersky Lab\n\n\n-----\n\n## Stage 0: Watering hole panel\n\n\n-----\n\n## Stage 0: Web shell\n\n\n-----\n\n## Stage 1: reconaissance stage\n\n######  Initial backdoor dropped – WipBot/Epic/TavDig\n\n  Simple backdoor with a handful of commands\n\n  Has no code in common with any variant of Turla but exports\n functions with the same names: ModuleStart and ModuleStop\n\n  Well desribed in Kaspersky Lab report:\n\n\n-----\n\n## Stage 1: Some interesting tricks used in WipBot\n\n###### Source: Trend Micro\n\n  CVE-2013-3346 - zero day used together with a known exploit\n\n  Sets ThreadHideFromDebugger – breaks debugging\n\n  Creates a new process in suspended mode and maps the same\n section of memory twice, in two different processes\n\n  SetWindowsLong API call to start a thread in the newly created\n process – breaks most malware sandboxes\n\n  Jumps several times from one process to another\n\n  Wipes out the PE section so that it is harder to rebuild the unpacked\n executable\n\n\n-----\n\n## Stage 2: lateral movements\n\n######  Stage 1 C&C servers are easy targets – for example, they can be\n caught in spear phishing e-mails and sandbox\n\n  Stage 2 backdoor: So let’s replace this by a less known backdoor\n\n  Go after Domain Admin credentials\n\n  Further explore and compromise the network\n\n\n-----\n\n## Stage 3: Turla\n\n######  Network has been found interesting to explore long-term and exfiltrate\n\n  Is fully compromised\n\n  Turla dropped on chosen machines\n\n  Usage of many other tools\n\n  Some networks owned for years…\n\n\n-----\n\n## How to detect Turla ?\n\n######  Not very easy task …\n\n  One fun story to tell \n\n  Do not only rely on vendors - talk to your partner organizations\n\n  Establish relationships and share information !\n\n  IOCs exchange is good but not enough these days:\n\n  They are easy to change by the intruders\n\n  Separate samples and infras used for different victims\n\n  Good Yara sigs and custom detection tools can help\n\n  Check your third party suppliers – for intruders it’s a perfect way to get\n in\n\n\n-----\n\n## Divagations on attribution\n\n######  Development:\n\n  Vlad, gilg, urik\n\n  “Transmittion”, “Password it’s wrong” etc.\n\n  Zagruzchik.dll\n\n  Operations:\n\n  Geographic distribution of infections\n\n  Virustotal submission countries\n\n  $default_charset = 'Windows-1251';\n\n\n-----\n\n### Questions ?\n\n deresz@gmail.com\n @deresz666\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        },
        {
            "id": "6825b8cb-7d82-43d2-b0b0-d51c7e255b42",
            "created_at": "2023-01-06T13:46:37.642134Z",
            "updated_at": "2023-01-06T13:46:37.642134Z",
            "deleted_at": null,
            "name": "MISPGALAXY",
            "url": "https://www.misp-project.org/galaxy.html",
            "description": "MISP Galaxy Clusters",
            "reports": null
        }
    ],
    "references": [
        "https://www.first.org/resources/papers/tbilisi2014/turla-operations_and_development.pdf"
    ],
    "report_names": [
        "turla-operations_and_development.pdf"
    ],
    "threat_actors": [
        {
            "id": "a97cf06d-c2e2-4771-99a2-c9dee0d6a0ac",
            "created_at": "2022-10-25T16:07:24.349252Z",
            "updated_at": "2025-03-27T02:02:10.184406Z",
            "deleted_at": null,
            "main_name": "Turla",
            "aliases": [
                "ATK 13",
                "Belugasturgeon",
                "Blue Python",
                "CTG-8875",
                "Group 88",
                "ITG12",
                "Iron Hunter",
                "Krypton",
                "Makersmark",
                "Operation Epic Turla",
                "Operation Moonlight Maze",
                "Operation Penguin Turla",
                "Operation Satellite Turla",
                "Operation Skipper Turla",
                "Operation Turla Mosquito",
                "Operation WITCHCOVEN",
                "Pacifier APT",
                "Pensive Ursa",
                "Popeye",
                "SIG15",
                "SIG2",
                "SIG23",
                "Secret Blizzard",
                "TAG-0530",
                "Turla",
                "UNC4210",
                "Venomous Bear",
                "Waterbug"
            ],
            "source_name": "ETDA:Turla",
            "tools": [
                "ASPXSpy",
                "ASPXTool",
                "ATI-Agent",
                "AdobeARM",
                "Agent.BTZ",
                "Agent.DNE",
                "BigBoss",
                "COMpfun",
                "Chinch",
                "Cloud Duke",
                "CloudDuke",
                "CloudLook",
                "Cobra Carbon System",
                "ComRAT",
                "DoublePulsar",
                "EmPyre",
                "EmpireProject",
                "Epic Turla",
                "EternalBlue",
                "EternalRomance",
                "GoldenSky",
                "Group Policy Results Tool",
                "HTML5 Encoding",
                "HyperStack",
                "IcedCoffee",
                "IronNetInjector",
                "KSL0T",
                "Kapushka",
                "Kazuar",
                "KopiLuwak",
                "Kotel",
                "LOLBAS",
                "LOLBins",
                "LightNeuron",
                "Living off the Land",
                "Maintools.js",
                "Metasploit",
                "Meterpreter",
                "MiamiBeach",
                "Mimikatz",
                "MiniDionis",
                "Minit",
                "NBTscan",
                "NETTRANS",
                "NETVulture",
                "Neptun",
                "NetFlash",
                "NewPass",
                "Outlook Backdoor",
                "Penquin Turla",
                "Pfinet",
                "PowerShell Empire",
                "PowerShellRunner",
                "PowerShellRunner-based RPC backdoor",
                "PowerStallion",
                "PsExec",
                "PyFlash",
                "QUIETCANARY",
                "Reductor RAT",
                "RocketMan",
                "SMBTouch",
                "SScan",
                "Satellite Turla",
                "SilentMoon",
                "Sun rootkit",
                "TTNG",
                "TadjMakhal",
                "Tavdig",
                "TinyTurla",
                "TinyTurla Next Generation",
                "TinyTurla-NG",
                "Topinambour",
                "Tunnus",
                "Turla",
                "Turla SilentMoon",
                "TurlaChopper",
                "Uroburos",
                "Urouros",
                "WCE",
                "WITCHCOVEN",
                "WhiteAtlas",
                "WhiteBear",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "Wipbot",
                "WorldCupSec",
                "XTRANS",
                "certutil",
                "certutil.exe",
                "gpresult",
                "nbtscan",
                "nbtstat",
                "pwdump"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "8aaa5515-92dd-448d-bb20-3a253f4f8854",
            "created_at": "2024-06-19T02:03:08.147099Z",
            "updated_at": "2025-03-27T02:05:17.408118Z",
            "deleted_at": null,
            "main_name": "IRON HUNTER",
            "aliases": [
                "Belugasturgeon ",
                "Blue Python ",
                "CTG-8875 ",
                "ITG12 ",
                "KRYPTON ",
                "MAKERSMARK ",
                "Pensive Ursa ",
                "Secret Blizzard ",
                "Turla",
                "UAC-0003 ",
                "UAC-0024 ",
                "UNC4210 ",
                "Venomous Bear ",
                "Waterbug ",
                "ATK13 "
            ],
            "source_name": "Secureworks:IRON HUNTER",
            "tools": [
                " ComRAT",
                " Kazuar",
                " KopiLuwak",
                " LightNeuron",
                " Mosquito",
                " Nautilus",
                " Neuron",
                " Penquin",
                " PoisonFrog",
                " PyFlash",
                " Skipper",
                " Snake",
                " Tavdig",
                " TinyTurla",
                " Tunnus",
                "Carbon-DLL"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "a97fee0d-af4b-4661-ae17-858925438fc4",
            "created_at": "2023-01-06T13:46:38.396415Z",
            "updated_at": "2025-03-27T02:00:02.823045Z",
            "deleted_at": null,
            "main_name": "Turla",
            "aliases": [
                "Uroburos",
                "Hippo Team",
                "Pacifier APT",
                "MAKERSMARK",
                "ATK13",
                "UAC-0003",
                "IRON HUNTER",
                "Waterbug",
                "TAG_0530",
                "KRYPTON",
                "Popeye",
                "SIG23",
                "UAC-0144",
                "G0010",
                "Blue Python",
                "VENOMOUS Bear",
                "Group 88",
                "Pfinet",
                "ITG12",
                "UNC4210",
                "Secret Blizzard",
                "UAC-0024"
            ],
            "source_name": "MISPGALAXY:Turla",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d11c89bb-1640-45fa-8322-6f4e4053d7f3",
            "created_at": "2022-10-25T15:50:23.509601Z",
            "updated_at": "2025-03-27T02:00:55.487991Z",
            "deleted_at": null,
            "main_name": "Turla",
            "aliases": [
                "Turla",
                "IRON HUNTER",
                "Group 88",
                "Waterbug",
                "WhiteBear",
                "Krypton",
                "Venomous Bear",
                "Secret Blizzard",
                "BELUGASTURGEON"
            ],
            "source_name": "MITRE:Turla",
            "tools": [
                "PsExec",
                "nbtstat",
                "ComRAT",
                "netstat",
                "certutil",
                "KOPILUWAK",
                "IronNetInjector",
                "LunarWeb",
                "Arp",
                "Uroburos",
                "PowerStallion",
                "Kazuar",
                "Systeminfo",
                "LightNeuron",
                "Mimikatz",
                "Tasklist",
                "LunarMail",
                "HyperStack",
                "NBTscan",
                "TinyTurla",
                "Penquin",
                "LunarLoader"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1666716495,
    "ts_updated_at": 1743041780,
    "ts_creation_date": 1414341218,
    "ts_modification_date": 1414341218,
    "files": {
        "pdf": "https://archive.orkl.eu/d055ed78d134e377b39a2172957b377946a37da3.pdf",
        "text": "https://archive.orkl.eu/d055ed78d134e377b39a2172957b377946a37da3.txt",
        "img": "https://archive.orkl.eu/d055ed78d134e377b39a2172957b377946a37da3.jpg"
    }
}