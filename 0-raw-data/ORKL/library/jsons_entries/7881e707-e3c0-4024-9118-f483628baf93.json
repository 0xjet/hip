{
    "id": "7881e707-e3c0-4024-9118-f483628baf93",
    "created_at": "2023-01-12T15:03:05.281224Z",
    "updated_at": "2025-03-27T02:16:34.908061Z",
    "deleted_at": null,
    "sha1_hash": "17a7da3ddd251f841dadc8eccfb67eea3dff8c97",
    "title": "2021-01-25 - Ungilded Secrets- A New Paradigm for Key Security",
    "authors": "",
    "file_creation_date": "2022-05-27T21:28:20Z",
    "file_modification_date": "2022-05-27T21:28:20Z",
    "file_size": 1150673,
    "plain_text": "# Ungilded Secrets: A New Paradigm for Key Security\n\n**[zengo.com/ungilded-secrets-a-new-paradigm-for-key-security/](https://zengo.com/ungilded-secrets-a-new-paradigm-for-key-security/)**\n\nJanuary 25, 2021\n\n**TLDR: SUNBURST attackers recently used stolen private keys to compromise several**\n**high profile targets in the US. To significantly reduce the chances of this happening**\n**again, we suggest a radical approach based on the cryptographic technology and**\n**security architecture that power our cryptocurrency wallet.**\n\nRussian Intelligence hackers recently pulled off a major cyberattack on the US. What is now\nknown as the [SUNBURST attack compromised the computer networks of several US](https://www.nytimes.com/2020/12/14/us/politics/russia-hack-nsa-homeland-security-pentagon.html)\ngovernment agencies and leading IT and security companies, including Microsoft and\nFireEye.\n\nAs authorities come to terms with the attack and learn of its true extent, most of the attention\ncontinues to focus on the initial access vector, a supply chain attack on a leading IT vendor.\nHowever, we believe the attackers’ modus operandi of abusing golden secrets also needs to\nbe scrutinized.\n\nGolden secrets are at the heart of most current authentication systems. These long-lasting\nsecrets are used to cryptographically secure the issuance of shorter-term access tokens and\nprotect their integrity. Consequently, they are also the most lucrative target for attackers.\nWhen a golden secret is captured, it allows attackers to issue golden access tokens in an\noffline manner to take full control over their victims’ environment.\n\nIn this post, we’ll present a novel solution based on the same advanced cryptographic\ntechnology and security architecture used in our cryptocurrency wallet, which we believe can\nsubstantially improve organizations’ ability to defend against such attacks.\n\n## SAML in SUNBURST\n\n\n-----\n\nThe SUNBURST attackers were initially able to enter their victims environments by infecting\n[the software updates of a widely used IT product called SolarWinds Orion (which is why this](https://www.solarwinds.com/orion-platform#:~:text=The%20SolarWinds%C2%AE%20Orion%C2%AE%20Platform%20is%20a%20powerful%2C%20scalable,a%20single%20pane%20of%20glass.)\nattack is named “SUNBURST”).\n\nOnce attackers were inside, their goal was to gain access to the authentication system’s\n[golden secrets, mainly (but not limited to) the SAML private key.](https://www.volexity.com/blog/2020/12/14/dark-halo-leverages-solarwinds-compromise-to-breach-organizations/)\n\nSAML tokens can be likened to a permit, such as a driver’s license. When someone wants to\nobtain a driver’s license, they must visit the Department of Motor Vehicles (DMV) once to\npresent the relevant papers (e.g., photo ID and driving test results) and get a permit.\n\nThe permit details the individual’s identity and contains authorizations (i.e., to drive a certain\ntype of vehicle). This permit can be verified by multiple other parties (e.g., policemen) by\nchecking the security measures embodied within.\n\n_Driver license: contains driver’s authentication (name) and authorization (class D)_\n_[information; security measures embodied within the permit. (source: mn.gov )](https://dps.mn.gov/divisions/dvs/PublishingImages/new-cards/mn-adult-dl.jpg)_\nSimilarly, SAML tokens are issued by Identity Providers (IdP) within an organization (e.g.,\nMicrosoft [ADFS). Users authenticate once (in a while) to the IdP by showing their](https://en.wikipedia.org/wiki/Active_Directory_Federation_Services)\ncredentials: usernames, passwords, and Multi-Factor Authentication (MFA) and get a SAML\ntoken in return, signed by the IdP private key.\n\n\n-----\n\nThe SAML token details the person s identity and authorization level (e.g., admin or regular\nuser). When users wish to connect to multiple Service Providers (SPs), either on cloud or\non-premises, they present their SAML token to the relevant SP. The SP verifies the token by\nvalidating the signature using the public key.\n\n_SAML Authentication: The user authenticates to IdP to receive a signed SAML token, later_\n_used to prove identity and role to services (SPs)_\nOne critical difference between a SAML token and a driver’s license is that a SAML token is\nnot a “photo ID.” There is no way for the SPs to make sure the holder is the same person as\nthe SAML token claims. SPs can only verify the token is signed correctly.\n\nBy stealing the SAML private key, the attackers could create their own tokens offline (i.e.,\nwithout interacting with any of the victims’ systems, thus leaving no traces in audit logs).\n**They could also masquerade as any user with different access privileges and totally**\n**bypass Multi-Factor Authentication (MFA), thus gaining unlimited access to all**\n**systems.**\n\n\n-----\n\n_SAML Authentication abused: Attackers copy the victim’s IdP’s private key to issue forged_\n_SAML tokens to access the victim’s service as any user, bypassing all authentication_\n_procedures including Multi-Factor Authentication (MFA)_\nWhat’s more, even when victims’ were able to supposedly clean their environment by\nremoving the malware and resetting passwords (but not the SAML private key), attackers\ncould keep returning and accessing the victims’ services with their forged SAML tokens.\n\n## The knee-jerk reaction: build another wall around private Keys\n\nThe automatic reaction when something we own is stolen is to add more layers of defense.\nThis was precisely how the Cybersecurity and Infrastructure Security Agency (CISA) reacted\nwhen they [advised victims’ to store their private keys in a Hardware Security Module (HSM).](https://media.defense.gov/2020/Dec/17/2002554125/-1/-1/0/AUTHENTICATION_MECHANISMS_CSA_U_OO_198854_20.PDF)\n\n״Strongly consider deploying a FIPS validated Hardware Security Module (HSM) to store onpremises token signing certificate private keys. An HSM, aggressively updated, makes it very\ndifficult for actors who have compromised the system to steal the private keys and use them\noutside of the network״\n\n\n-----\n\nBut inherent weaknesses exist within this HSM recommendation. For a start, hardware\nsolutions are much more complicated and expensive to deploy compared to software\nsolutions. This meant CISA could only “strongly recommend” this action and not mandate it\nas they did in other situations.\n\n[Additionally, HSM solutions need to be “aggressively updated,” as HSM vulnerabilities can](https://www.zdnet.com/article/major-hsm-vulnerabilities-impact-banks-cloud-providers-governments/)\nallow attackers to gain access to private keys and steal them as before.\n\nGiven these limitations and the attackers’ demonstrated capability to penetrate highly\nprotected systems, adding additional security layers within the infected environment will likely\nprove ineffective. More radical thinking is required to solve this problem.\n\nsource: [thequotes.in](http://thequotes.in/wp-content/uploads/2016/05/Albert-Einstein-Quotes-6.jpg)\n\n## What if we didn’t need PRIVATE KEYS?\n\nSystem administrators don’t require the private key itself. They just need to get SAML tokens\nsigned. Instead of protecting private keys within an infected environment, what if keys are\nstored in another domain to which the victims have no access?\n\nHaving an external service that signs tokens but keeps the private key out of reach of system\nadmins and potential hackers can be a step forward. However, this solution is far from\nperfect.\n\nThe external signing service must be trusted to keep private keys safe from theft and ensure\nonly valid requests from the customers’ are signed and not from attackers.\n\nThe good news is we can use Secure Multi-Party Computation (MPC) and specifically\n[Threshold Signatures (TSS) to solve this issue.](https://zengo.com/threshold-signatures-the%e2%80%88future%e2%80%88of%e2%80%88private%e2%80%88keys/)\n\n\n-----\n\nUsing these state of the art cryptographic constructions, we can split the atom and create a\nprivate key in a distributed manner. Half the key is created in the customers’ organization\nenvironment, while the other half is created in the external service environment.\n\nBoth parties must engage in a protocol that signs the token without revealing their part of the\nkey to other parties to sign. The signature itself is the same as if it had been created with a\nsingle private key and validated with a public key. Therefore, there is no need to adjust\nexisting solutions to support this architecture.\n\nWhen a private key is distributed with TSS, attackers must compromise these two\nindependent environments. As a result, the SAML private key is protected, even if the\ncustomer’s environment is compromised.\n\nAdditionally, a customer’s need to trust the external service is eliminated. Even if the service\nbecomes entirely compromised or turns rogue, it cannot forge tokens independently.\n\n_SAML Authentication with TSS: As before, the user authenticates to IdP to receive a signed_\n\n\n-----\n\n_SAML token, later used to prove identity and role to services (SPs). However, the signing is_\n_done in a distributed manner, such that the full key is never in a single place._\n**The solution consists of two mandatory parts, TSS cryptography and the security**\n**architecture of an external service. It is the combination of these two parts that makes**\n**this solution effective.**\n\nUsing TSS on its own and distributing the secret within the customer’s environment without\nan external service is insufficient. This is because when a customer’s environment is fully\ncompromised, attackers can put their hands on all the distributed parties and extract the\nprivate key. On the other hand, using an external service to store keys without TSS is\nvulnerable to external service attacks, as described above.\n\nIt’s important to note that these TSS and MPC algorithms are not just theoretical but actually\nvery practical. In fact, we at [ZenGo have been successfully using them for the last two years](https://zengo.com/)\nin our cryptocurrency wallet to protect our customers’ private keys – by splitting them\nbetween our servers and customers’ devices. We’ve made our implementation code publicly\navailable for the benefit of the community.\n\n_ZenGo wallet solution for cryptocurrency: TSS and External service architecture (source:_\n_[ZenGo)](https://zengo.com/security/)_\nApplying TSS to SAML is even easier than for cryptocurrency, as availability is not a\nproblem. In cryptocurrency, users’ funds are bounded to a specific private key, and therefore\nlosing even a single part of that distributed key can lead to loss of funds. As a result, we\n[needed to develop dedicated solutions to prevent this from happening.](https://zengo.com/how-zengo-guarantees-access-to-customers-funds/)\n\nThis is not a problem for SAML. If a key, or some part of it, is lost, a new one can be issued,\nas unlike cryptocurrency, the specific private key has no special meaning. Additionally, older\ntokens do not become obsolete as they can still be verified with the older public key, even\n\n\n-----\n\nwhen the private key is no longer available.\n\nOf course, while TSS with external service for SAML signing is a significant step forward, it’s\nnot a panacea. Attackers can still generate requests to sign tokens online from the\ncustomers’ environment to the external signing service.\n\nHowever, this is restrictive and requires attackers to work against the system.\n\nAttackers cannot persistently return to the environment after they’ve been kicked out.\nOnline attacks leave traces in logs, making the attack much more visible. In fact,\nsplitting the signing between two environments adds more security, as there can be an\naudit log for both environments. Attackers need to compromise both to tamper them.\n\nAttackers may still add an additional pair of a private and a public key as further SAML\n[authenticators to the environment (a la Skeleton Key attack). But this attack must be carried](https://www.virusbulletin.com/virusbulletin/2016/01/paper-digital-bian-lian-face-changing-skeleton-key-malware)\nout in an online manner that’s highly visible.\n\n## Parting thoughts\n\nBy abusing golden secrets, attackers were able to take full control over the networks of some\nof the world’s most protected organizations. This clearly indicates our current defense\nmethods are insufficient and that new thinking is required.\n\nIn this post, we presented a radical but practical solution that can significantly reduce the\nchances of an attack like SUNBURST happening again.\n\nInstead of trying to keep golden secrets safe by adding additional protective security layers,\norganizations should strive not to keep them exclusively in the first place.\n\nSecurely distributing the responsibility for these secrets to external services using Threshold\nSignatures is simply a no-brainer. But it’s just the tip of the iceberg when it comes to how\nmodern cryptography can significantly upgrade the security of organizations worldwide.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-01-25 - Ungilded Secrets- A New Paradigm for Key Security.pdf"
    ],
    "report_names": [
        "2021-01-25 - Ungilded Secrets- A New Paradigm for Key Security.pdf"
    ],
    "threat_actors": [
        {
            "id": "b43e5ea9-d8c8-4efa-b5bf-f1efb37174ba",
            "created_at": "2022-10-25T16:07:24.36191Z",
            "updated_at": "2025-03-27T02:02:10.1909Z",
            "deleted_at": null,
            "main_name": "UNC2452",
            "aliases": [
                "Dark Halo",
                "Nobelium",
                "SolarStorm",
                "StellarParticle",
                "UNC2452"
            ],
            "source_name": "ETDA:UNC2452",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "1d3f9dec-b033-48a5-8b1e-f67a29429e89",
            "created_at": "2022-10-25T15:50:23.739197Z",
            "updated_at": "2025-03-27T02:00:55.536417Z",
            "deleted_at": null,
            "main_name": "UNC2452",
            "aliases": [
                "UNC2452",
                "NOBELIUM",
                "StellarParticle",
                "Dark Halo"
            ],
            "source_name": "MITRE:UNC2452",
            "tools": [
                "Sibot",
                "Mimikatz",
                "Cobalt Strike",
                "AdFind",
                "GoldMax"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "a241a1ca-2bc9-450b-a07b-aae747ee2710",
            "created_at": "2024-06-19T02:03:08.150052Z",
            "updated_at": "2025-03-27T02:05:17.409596Z",
            "deleted_at": null,
            "main_name": "IRON RITUAL",
            "aliases": [
                "Blue Dev 5 ",
                "BlueBravo ",
                "Cloaked Ursa ",
                "CozyLarch ",
                "Dark Halo ",
                "Midnight Blizzard ",
                "NOBELIUM ",
                "StellarParticle ",
                "UNC2452 ",
                "APT29"
            ],
            "source_name": "Secureworks:IRON RITUAL",
            "tools": [
                " Cobalt Strike",
                " EnvyScout",
                " GoldFinder",
                " GoldMax",
                " NativeZone",
                " RAINDROP",
                " SUNBURST",
                " Sibot",
                " TEARDROP",
                " VaporRage",
                "Brute Ratel C4"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "20d3a08a-3b97-4b2f-90b8-92a89089a57a",
            "created_at": "2022-10-25T15:50:23.548494Z",
            "updated_at": "2025-03-27T02:00:55.49688Z",
            "deleted_at": null,
            "main_name": "APT29",
            "aliases": [
                "APT29",
                "IRON RITUAL",
                "IRON HEMLOCK",
                "NobleBaron",
                "Dark Halo",
                "NOBELIUM",
                "UNC2452",
                "YTTRIUM",
                "The Dukes",
                "Cozy Bear",
                "CozyDuke",
                "SolarStorm",
                "Blue Kitsune",
                "UNC3524",
                "Midnight Blizzard"
            ],
            "source_name": "MITRE:APT29",
            "tools": [
                "PinchDuke",
                "ROADTools",
                "WellMail",
                "CozyCar",
                "Mimikatz",
                "Tasklist",
                "OnionDuke",
                "FatDuke",
                "POSHSPY",
                "EnvyScout",
                "SoreFang",
                "GeminiDuke",
                "GoldMax",
                "FoggyWeb",
                "SDelete",
                "PolyglotDuke",
                "AADInternals",
                "MiniDuke",
                "SeaDuke",
                "Sibot",
                "RegDuke",
                "CloudDuke",
                "GoldFinder",
                "AdFind",
                "PsExec",
                "NativeZone",
                "Systeminfo",
                "ipconfig",
                "Impacket",
                "Cobalt Strike",
                "PowerDuke",
                "QUIETEXIT",
                "HAMMERTOSS",
                "BoomBox",
                "CosmicDuke",
                "WellMess",
                "VaporRage",
                "LiteDuke"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "f27790ff-4ee0-40a5-9c84-2b523a9d3270",
            "created_at": "2022-10-25T16:07:23.341684Z",
            "updated_at": "2025-03-27T02:02:09.74554Z",
            "deleted_at": null,
            "main_name": "APT 29",
            "aliases": [
                "APT 29",
                "ATK 7",
                "Blue Dev 5",
                "BlueBravo",
                "Cloaked Ursa",
                "CloudLook",
                "Cozy Bear",
                "Dark Halo",
                "Earth Koshchei",
                "Grizzly Steppe",
                "Group 100",
                "ITG11",
                "Iron Hemlock",
                "Iron Ritual",
                "Midnight Blizzard",
                "Minidionis",
                "Nobelium",
                "NobleBaron",
                "Operation Ghost",
                "Operation Office monkeys",
                "Operation StellarParticle",
                "SilverFish",
                "Solar Phoenix",
                "SolarStorm",
                "StellarParticle",
                "TEMP.Monkeys",
                "The Dukes",
                "UNC2452",
                "UNC3524",
                "Yttrium"
            ],
            "source_name": "ETDA:APT 29",
            "tools": [
                "7-Zip",
                "ATI-Agent",
                "AdFind",
                "Agentemis",
                "AtNow",
                "BEATDROP",
                "BotgenStudios",
                "CEELOADER",
                "Cloud Duke",
                "CloudDuke",
                "CloudLook",
                "Cobalt Strike",
                "CobaltStrike",
                "CosmicDuke",
                "Cozer",
                "CozyBear",
                "CozyCar",
                "CozyDuke",
                "Danfuan",
                "EnvyScout",
                "EuroAPT",
                "FatDuke",
                "FoggyWeb",
                "GeminiDuke",
                "Geppei",
                "GoldFinder",
                "GoldMax",
                "GraphDrop",
                "GraphicalNeutrino",
                "GraphicalProton",
                "HAMMERTOSS",
                "HammerDuke",
                "LOLBAS",
                "LOLBins",
                "LiteDuke",
                "Living off the Land",
                "MagicWeb",
                "Mimikatz",
                "MiniDionis",
                "MiniDuke",
                "NemesisGemina",
                "NetDuke",
                "OnionDuke",
                "POSHSPY",
                "PinchDuke",
                "PolyglotDuke",
                "PowerDuke",
                "QUIETEXIT",
                "ROOTSAW",
                "RegDuke",
                "Rubeus",
                "SNOWYAMBER",
                "SPICYBEAT",
                "SUNSHUTTLE",
                "SeaDaddy",
                "SeaDask",
                "SeaDesk",
                "SeaDuke",
                "Sharp-SMBExec",
                "SharpView",
                "Sibot",
                "Solorigate",
                "SoreFang",
                "TinyBaron",
                "WINELOADER",
                "WellMail",
                "WellMess",
                "cobeacon",
                "elf.wellmess",
                "reGeorg",
                "tDiscoverer"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535785,
    "ts_updated_at": 1743041794,
    "ts_creation_date": 1653686900,
    "ts_modification_date": 1653686900,
    "files": {
        "pdf": "https://archive.orkl.eu/17a7da3ddd251f841dadc8eccfb67eea3dff8c97.pdf",
        "text": "https://archive.orkl.eu/17a7da3ddd251f841dadc8eccfb67eea3dff8c97.txt",
        "img": "https://archive.orkl.eu/17a7da3ddd251f841dadc8eccfb67eea3dff8c97.jpg"
    }
}