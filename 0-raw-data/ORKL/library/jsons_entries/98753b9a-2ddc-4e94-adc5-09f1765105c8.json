{
    "id": "98753b9a-2ddc-4e94-adc5-09f1765105c8",
    "created_at": "2022-10-25T16:48:15.980224Z",
    "updated_at": "2025-03-27T02:17:11.404893Z",
    "deleted_at": null,
    "sha1_hash": "c1d45e9e295ef68265aaab4d84c14f89109ea3cd",
    "title": "",
    "authors": "",
    "file_creation_date": "2018-09-27T16:34:53Z",
    "file_modification_date": "2018-09-27T16:54:32Z",
    "file_size": 2179261,
    "plain_text": "# LOJAX\n## First UEFI rootkit found\n in the wild, courtesy\n of the Sednit group\n\n\n-----\n\n### TABLE OF CONTENTS\n\n1. Executive summary .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   3\n\n2. Introduction  .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   . 4\n\nAttribution  .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   4\n\nVictimology .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .  4\n\n3. Previous research on Computrace/LoJack  .   .   .   .   .   .   .   4\n\nLoJack becomes LoJax .  .  .  .  .  .  .  .  .  .  .  .  . 7\n\n4. The hunt for a lower-level component .   .   .   .   .   .   .   .   . 7\n\nRWEverything driver (RwDrv) and info_efi.exe .   .   .   .  7\n\nDumping the SPI flash memory .   .   .   .   .   .   .   .   .   9\n\nPatching the UEFI firmware .  .  .  .  .  .  .  .  .  .  10\n\nWriting the patched firmware back\n\nto the SPI flash memory  .  .  .  .  .  .  .  .  .  .  .  12\n\n5. LoJax technical analysis .  .  .  .  .  .  .  .  .  .  .  .  .  . 14\n\nSecDxe: The malicious DXE driver .  .  .  .  .  .  .  .  15\n\nHacking Team’s NTFS driver .  .  .  .  .  .  .  .  .  .  . 17\n\nautoche.exe vs. autochk.exe  .   .   .   .   .   .   .   .   .   .  19\n\nrpcnetp.exe .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   . 20\n\n6. Prevention and remediation  .  .  .  .  .  .  .  .  .  .  .  . 20\n\n7. Conclusion  .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .  20\n\n8. Acknowledgement  .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   21\n\n9. Glossary .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .  21\n\n10. References  .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .  21\n\n11. IOCs .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   23\n\n\n-----\n\n### 1. EXECUTIVE SUMMARY\n\nSednit also known as APT28, Sofacy, Strontium and Fancy Bear – has been operating since at least 2004,\nand has made headlines frequently in the past years: it is believed to be behind major, high profile attacks.\nFor instance, several security companies [1] as well as the US Department of Justice [2] named the group\nas being responsible for the Democratic National Committee (DNC) hack just before the US 2016 elections.\nThe group is also presumed to be behind the hacking of global television network TV5Monde [3], the World\nAnti-Doping Agency (WADA) email leak [4] and many others. Its targets are many and the group\nhas a diversified set of malware in its toolbox several of which we have documented previously [5],\nbut this white paper details the first time this group is known to have used a UEFI rootkit.\n\nKey points in this white paper:\n\n- Starting in at least early 2017, trojanized versions of an older userland agent of the popular\n\nLoJack anti-theft software from Absolute Software were found in the wild. We call this trojanized\nLoJack agent LoJax. LoJack attracted a lot of attention in recent years as it implements a UEFI/BIOS\nmodule as a persistence mechanism.\n\n- The presence of known Sednit tools alongside LoJax samples as well as the fact that some of the\n\nC&C servers used by these trojanized agents were part of an earlier Sednit network infrastructure\nallows us to link this UEFI rootkit to the Sednit group with high confidence.\n\n- Along with the LoJax agents, tools with the ability to read systems’ UEFI firmware were found\n\nand in one case, this tool was able to dump, patch and overwrite part of the system’s SPI flash\nmemory. This tool’s ultimate goal was to install a malicious UEFI module on a system whose\nSPI flash memory protections were vulnerable or misconfigured.\n\n- This UEFI module has the responsibility to drop the LoJax agent on the system, making it the first\n\nSednit UEFI rootkit identified. As it resides in the system’s firmware, it can survive a Windows\nre-install as well as a hard drive replacement.\n\n- There was at least one case where this rootkit was successfully installed in a system’s SPI flash\n\nmemory. To our knowledge, this is the first UEFI rootkit found in the wild.\n\n[For any inquiries related to this white paper, contact us at threatintel@eset.com](mailto:threatintel%40eset.com?subject=Turla%20Outlook)\n\n\n-----\n\n### 2. INTRODUCTION\n\nThe Sednit group is a resourceful APT group targeting people and organizations around the world. It has\nbeen in operation since at least 2004, using a wide range of malware families. For a complete description\nof the most prevalent tools this group uses, please refer to our Sednit white paper [5].\n\nThroughout our multi-year tracking of this group, we released many reports on its activities, ranging from\nzero-day usage [6] to custom malware it develops, such as Zebrocy [7]. However, the component described\nin this white paper is in a league of its own.\n\nThere have been stories in the past of UEFI rootkits, such as “rkloader” described in a presentation [8] from\nthe Hacking Team data leak or “DerStarke”, a macOS EFI/UEFI boot implant described in the Vault7 leaks [9].\nWhile we know of their existence, there has never been a published report detailing a real case of a victim\ncompromised by such malware.\n\nNot only were we able to confirm discovering an in the wild firmware including the malicious LoJax\nUEFI module, but we were also able to find the full toolchain that was presumably used to install it. It is\ninteresting to note here that Sednit used the DownDelph bootkit in 2013 and 2014 as a persistence method\nfor Downdelph, one of the group’s first-stage backdoors. While the idea is similar, bootkits are no longer\npossible with the new UEFI implementation. Thus, these two components differ significantly in their behavior.\n\nThis white paper is divided into three sections. The first will deal with previous security research on LoJack/\nComputrace and how it could be used maliciously. The second section will examine the breadcrumbs found\nalong our research route that ultimately led us to the UEFI rootkit. Finally, the third section will detail\nthe different LoJax components and how they persist on a system even after a Windows re-install\nor a hard drive replacement.\n\n##### Attribution\n\nWhile many vendors have made attribution claims about the Sednit group in the past, ESET does not\nperform any type of geopolitical attribution. That was our position back when we published our white paper\nin 2016 [5] and is still the case today. As we wrote back then, performing attribution in a serious, scientific\nmanner is a hard problem that is out of our scope as ESET security researchers. What we call “the Sednit\ngroup” is merely a set of software and the related network infrastructure, which we can hardly correlate\nauthoritatively with any specific organization.\n\n##### Victimology\n\nWe found a limited number of different LoJax samples during our research. Based on our telemetry data\nand on other Sednit tools found in the wild, we are confident that this particular module was rarely used\ncompared to other malware components at their disposal. The targets were mostly government entities\nlocated in the Balkans as well as Central and Eastern Europe.\n\n### 3. PREVIOUS RESEARCH ON COMPUTRACE/LOJACK\n\nLoJack is anti-theft software made by Absolute Software Corporation. Earlier versions of this agent were\nknown as Computrace. As its former name implies, once a user activated the service, the computer could\ncall back to its C&C server and its user be notified of its location should it have gone missing or been stolen.\n\n\n-----\n\nComputrace attracted attention from the security community mostly because of its unusual persistence\nmethod. Since this software’s intent is to protect a system hardware from theft, it is important that\nit resists OS re-installation or hard drive replacement. Thus, it is implemented as a UEFI/BIOS module, able\nto survive such events. This solution comes pre-installed in the firmware of a large portion of laptops’\nmanufactured by various OEMs, waiting to be activated by its users. This activation step can be done\nthrough a BIOS option as depicted in Figure 1.\n\nFigure 1 // Computrace BIOS activation\n\nOne of the first research reports providing information on how this solution is implemented was published\nin 2009 [11]. The global architecture of the product, at that time, was revealed, detailing how the UEFI/BIOS\nmodule was able to drop the userland agent on disk and how this agent was then able to call home\nby contacting a web server controlled by Absolute Software. The overall process of the LoJack/Computrace\nsolution back then is best described in Figure 2.\n\nUEFI/BIOS module Windows Windows\nexecutes early boot OS running\n\n##### 1 2 3 4\n\nUEFI/BIOS module BIOS moduleautochk.exe **rpcnetp.exe** Normal operation\n\n                                              - small agent\n\nContains persistent Drops rpcnetp.exe Injects its DLL into svchost.exe,\nagent and its dropper    - small agent then Internet Explorer\n\nFull recovery agent\nis running on the machine\n\nCommunicates with C&C\n\nReplaces legitimate\n\nInstalls it as a service server to download and\n\nautochk.exe\n\ninstall full recovery agent\n\nFigure 2 // LoJack persistence mechanism (circa 2008)\n\n\n-----\n\nHere is a description of the different steps highlighted above:\n\n#### ➊ [At boot time, if activated, the UEFI/BIOS module is executed. It will try to find a FAT/FAT32/NTFS ]\n\npartition. Using an NTFS driver, it then creates a backup of autochk.exe and overwrites its content\n\nwith a dropper responsible for installing the userland agent component. autochk.exe is a Windows\n\nexecutable that is run during the early stages of Windows initialization to check for possible hard\n\ndrive corruption.\n\n#### ➋ [When the modified ][autochk.exe][ is run, its main purpose is to drop the small agent ][rpcnetp.exe]\n\nand add it as a service so that it is started at each reboot. The last step of this component is to restore\n\nthe original version of autochk.exe.\n#### ➌ [The small agent, ][rpcnetp.exe][, is a small executable whose main purpose is to ensure that the main ]\n\nagent is running. If not, it will try to connect to Absolute Software’s C&C server to download and execute\n\nit. The small agent will first make a copy of itself and modify the PE header so that it becomes a dynamic\nlink library (DLL). This DLL is then loaded in memory and it will spawn a svchost.exe process and inject\n\nthe DLL there. It will then spawn an Internet Explorer iexplore.exe process and again inject its DLL\n\ninto it. This last process will then be used to communicate over the Internet. The Computrace small\n\nagent’s behavior of injecting code into foreign processes is commonly seen in malware and rarely\n\nassociated with legitimate, reputable software.\n\n#### ➍ [The full featured agent is now running on the system and implements Computrace’s various tracking\n]\n\nand recovery functions.\n\nThis overall process, along with a detailed description of the network protocol used between the small\nagent and its C&C server, was published in 2014 [12]. As no authentication mechanism exists, if adversaries\ncould control the server with which the small agent communicates, they could make it download\nand execute arbitrary code. There are several different mechanisms allowing an attacker to communicate\ndirectly with the small agent. The one that is the most relevant to our discussion involves how the address\nof the C&C server is retrieved by the small agent. In fact, this information is stored in a configuration file\nhardcoded in the executable itself.\n\nFigure 3 // Encrypted LoJack configuration file on the right with partial decryption on the right\n\nFigure 3 shows both the encrypted and decrypted LoJack small agent configuration file. The “encryption”\nmethod used is a simple XOR operation using a one-byte key. This key, 0xB5, is the same for all small agents\nstudied. As seen in Figure 3, the C&C domain name is clearly visible. The four bytes preceding that comprise\na C&C server IP address. As there is no validation done on the configuration file content, adversaries with\nwrite access to %WINDIR% can change its content so that the small agent contacts a C&C server under\ntheir control instead of the legitimate one. By understanding the network protocol, it is then possible\nto make the small agent download and execute arbitrary code.\n\nAlthough these risks were identified a long time ago, no noteworthy usage of this security risk was\nseen in the wild until recently.\n\n\n-----\n\n##### LoJack becomes LoJax\n\nIn May 2018, an Arbor Networks blogpost [13] describing several trojanized samples of the LoJack small\nagent, rpcnetp.exe, was published. These malicious samples communicated with a malicious C&C server\ninstead of the legitimate Absolute Software one, because their hardcoded configuration settings had been\naltered. Some of the domains found in LoJax samples had been seen before: they were used in late 2017\nas C&C domains for the notorious Sednit first-stage backdoor, SedUploader. Figure 4 shows an example\nof the modified configuration in one such LoJax small agent.\n\nFigure 4 // Legitimate configuration file on the left, modified one on the right\n\nThe differences between the legitimate and trojanized agent are so small that the figures above actually\nshow most of the changes between them. All the LoJax small agent samples we could recover are trojanizing\nthe exact same legitimate sample of the Computrace small agent rpcnetp.exe. They all have the same\ncompilation timestamp and only a few tens of bytes are different from the original one. Besides the modifi­\ncations to the configuration file, the other changes include timer values specifying the intervals between\nconnections to the C&C server.\n\nAt the time the blog was published, we had found different LoJax small agents targeting different entities\nin the Balkans as well as Central and Eastern Europe, but had no idea how they were installed. Of course,\nthe obvious explanation was that some well-known Sednit backdoor installed them. After all, since\nLoJack was a well-known tool, it was whitelisted by many AV vendors. Thus, even if only the small agent\nwas used in this campaign and that it could not survive a Windows re-install, it still had the benefit of being\nless likely to be flagged as malicious. However, what if the compromise was deeper than that? What if they\ntried to mimic the LoJack solution and go all the way to the system’s firmware?\n\n### 4. THE HUNT FOR A LOWER-LEVEL COMPONENT\n\nWe were able to uncover LoJax campaigns targeting a few organizations in the Balkans as well as Central\nand Eastern Europe. In all of them, we were able to find traces of other Sednit malware detections, namely:\n\n- SedUploader, a first-stage backdoor\n\n- XAgent, Sednit’s flagship backdoor\n\n- Xtunnel, a network proxy tool that can relay any kind of network traffic between a C&C server\n\non the Internet and an endpoint computer inside a local network\n\nAlthough we detected traces of Sednit tools on most of the systems we examined that were targeted by\nLoJax, we found a couple of systems where only LoJax was present. Thus, we can infer that in some cases,\nLoJax was used as a stand-alone tool, presumably as an additional backdoor used to regain admittance\nto the network should Sednit operators lose access.\n\nAs XAgent is routinely used to drop additional modules on a compromised system, it is tempting to jump\nto the conclusion that LoJax samples are dropped in the same way and that there are no other mechanisms\nin place. This would mean that the only part that was inspired by the LoJack solution would be the small\nagent. However, shortly after we started our analysis, we found some clues that led us to believe the\ninspiration went a bit further.\n\n##### RWEverything driver (RwDrv) and info_efi.exe\n\nThe first piece of evidence comes from a custom tool created by the malicious actors that, when executed,\ndumps information about low level system settings to a text file. This tool was found alongside some LoJax\nsamples. The following figure shows a snippet of the log file produced by this tool, aptly named info_efi.exe.\n\n\n-----\n\nFigure 5 // Excerpt of log file as generated by info_efi.exe\n\nIn order to read this type of information, this tool embeds a driver called RwDrv.sys. This kernel driver\nis bundled with RWEverything, a free utility available on the web [14] that can be used to read information\non almost all the computer low-level settings, including PCI Express, Memory, PCI Option ROMs, etc. As this\nkernel driver belongs to legitimate software, it is signed with a valid code-signing certificate.\n\nFigure 6 // RwDrv.sys code-signing certificate\n\nRWEverything software comes with a GUI that lets the user access all of this data.\n\nFigure 7 // Screenshot of RWEverything GUI\n\nThe info_efi tool discovery was the first sign that a LoJax UEFI module might exist. When trying\nto update a system’s firmware, it is crucial to have information about the firmware vendor, its version,\netc. As there are known vulnerabilities allowing userland processes to access and modify the content\nof the SPI flash memory where the UEFI modules are stored, getting data about the system’s hardware\nis the first step towards a successful attack.\n\n\n-----\n\nThe final lead that allowed us to find Sednit’s first UEFI rootkit was two different tools — one used to dump\nthe SPI flash memory and one to write to it.\n\n##### Dumping the SPI flash memory\n\nThe first piece of the puzzle was a file called ReWriter_read.exe. This file contained all the code\nrequired to dump a system SPI flash memory using the RWEverything driver, RwDrv.sys. In order for the\ndevice driver to perform the required operations, the dumper tool must send the correct I/O control (IOCTL)\ncodes. While RwDrv.sys supports many different IOCTL codes, both the dumper and writer tool described\nin this section and the next use only four of them.\n\n\nTable 1 RwDrv.sys supported IOCTLs\n\n\nIOCTL code Description\n\n0x22280c Writes to memory mapped I/O space\n\n0x222808 Reads from memory mapped I/O space\n\n0x222840 Reads a dword from given PCI Configuration Register\n\n0x222834 Writes a byte to given PCI Configuration Register\n```\nReWriter_read first creates a service with the embedded kernel driver RwDrv.sys and logs some information\n\n\n```\non the UEFI/BIOS configuration, namely the value of three fields contained in the BIOS Control Register\n(BIOS_CNTL): BIOS Lock Enable (BLE), BIOS Write Enable (BIOSWE) and SMM BIOS Write Protect Disable\n(SMM_BWP). While ReWrite_read does not use these values at all, the following sections will highlight\nwhy these three fields are of interest to this tool.\n\nThe tool’s next task is to retrieve the BIOS region base address on the SPI flash memory as well as its size.\nThis information is contained in the SPI Host Interface register “BIOS Flash Primary Region”. All SPI Host\nInterface registers are memory-mapped in the Root Complex Register Block (RCRB) whose base address\ncan be retrieved by reading the correct PCI Configuration Register. ReWriter_read obtains this address\nby using RwDrv IOCTL 0x22840 and reading the correct offset (0xF0 in our case). Once the BIOS region\nbase address and size are known, the dump tool reads the relevant content of the SPI flash memory and\nwrites it to a file on disk. The reading process of the SPI flash memory is illustrated in Figure 8. Please refer\nto the Glossary for the expansions of the acronyms used below.\n\nWrite the number of bytes to be read\n\n**1**\n\ninto the HSFC (FDBC = size -1)\n\nSet the HSFC to the read\ncommand (FCYCLE = 0b00) **2**\n\nWrite the address to read SPI Flash\n\n**3**\n\nin the HSFC (FADDR)\n\nWrite 1 to Flash Cycle Go (FGO) **4**\n\nWait for SPI read cycle completion\n(HSFS�SCIP ==0) **5**\n\nRead data from FDATAX register\n\n**6**\n\nFigure 8 // Operation sequence to read from the SPI flash memory\n\n\n-----\n\nExcept for the first two steps that are executed only once, these operations are repeated in a loop until\nall the data is read from the SPI flash memory. This process is also well described in [15]. ReWriter_read\nwill then validate the size of the dumped image. It will parse the image Flash descriptor to get the memory\nranges of the BIOS, the Gigabit Ethernet (GbE) and the Management Engine (ME) regions. Adding the size\nof these three regions allows the dumper tool to compute the size of the entire content of the SPI flash\nmemory. If this size is equal to the size obtained by reading the BIOS Flash Primary region register,\nthe image is considered valid.\n\n##### Patching the UEFI firmware\n\nThe second piece of the puzzle is a file called ReWriter_binary.exe. This file contains the evidence\nwe were missing to prove that Sednit’s operators went as far as targeting the firmware. This file contains\nthe code to patch the dumped UEFI image and write the trojanized version back to the SPI flash memory.\nThis section will detail the inner workings of this binary.\n\nOnce the flash memory content has been dumped and successfully validated by the aforementioned dumper\ntool, the malicious UEFI module is added to the image. To do so, the UEFI image must first be parsed\nto extract the information required for this task.\n\nThe data stored in the UEFI image are laid out in volumes using Firmware File System (FFS). As its name\nsuggests, it is a file system specifically tailored for storing firmware images. Volumes contain files identified\nby GUIDs. Each file is usually composed of multiple sections, one of which contains the actual PE/COFF\nexecutable that is the UEFI image. To help visualize this layout, here’s a screenshot from UEFITool [16],\nan open source project for manipulating UEFI firmware images.\n\nFigure 9 // Example UEFI firmware image loaded in UEFITool\n```\nReWriter_binary parses all of the firmware volumes found in the BIOS region of the SPI flash memory\n\n```\nsearching for specific files:\n\n- Ip4Dxe (8f92960f-2880-4659-b857-915a8901bdc8)\n\n- NtfsDxe (768bedfd-7b4b-4c9f-b2ff-6377e3387243)\n\n- SmiFlash (bc327dbd-b982-4f55-9f79-056ad7e987c5)\n\n- DXE Core\n\n\n-----\n\nFigure 10 // Hex-Rays decompiler output for the routine parsing the firmware volumes\n\nIp4Dxe and NtfsDxe are DXE drivers. In UEFI firmware, DXE drivers are PE/COFF images that are either\nmeant to abstract the hardware or to produce services that can be used by other DXE drivers or by UEFI\napplications. Such drivers are discovered and loaded by the DXE Foundation through the DXE Dispatcher\n(DXE Core) early in the boot process. After completion of this phase, all services expected to be available\nby UEFI applications, such as an OS loader, are in place. Usually, all the DXE drivers are stored in the same\nvolume. However, the DXE dispatcher may be on a separate one.\n```\nReWriter_binary looks for Ip4Dxe only as an indication that the volume being parsed is the volume\n\n\n```\nthat contains the DXE drivers. As we will describe later, this volume will be a candidate for the installation\nof the malicious DXE driver. It also looks for DXE Core and adds the volume where it’s located as another\ncandidate volume for where to write the rootkit. The free space available on each of these volumes is stored\nand is used later to verify whether there is enough space available to add the malicious driver.\n\nNtfsDxe is the AMI NTFS DXE driver. If present in a firmware volume, its location is stored and is later used\nto remove the file from the volume. We will see why the tool removes this driver in the section dedicated\nto the analysis of the UEFI rootkit.\n\nAs for the SmiFlash image, the information related to this image is stored but is not used anywhere\nin the malware. Interestingly, this image is vulnerable [17]. Thus, we believe that Sednit’s operators might\nbe working on some exploit for these vulnerabilities. This could allow them to write to the SPI flash memory\neven on properly configured systems. As we will describe later: in its current state, the tool is only able\nto write to the BIOS region of misconfigured or fairly old systems (on motherboards older than Platform\nController Hub chipsets introduced around 2008).\n\n\n-----\n\nAfter the extraction of required metadata, ReWriter_binary proceeds to patching the dumped\nUEFI image, adding its malicious DXE driver. First, it creates a file header structure (EFI_FFS_FILE_HEADER).\nThen, it selects the destination volume based on the location of Ip4Dxe and DXE Core as well as the free\nspace available on these volumes. ReWriter_binary embeds a compressed section containing the PE image\nand a User interface section specifying the human-readable name of the file: SecDxe. The compressed section\nis appended to the file header and written at the end of the volume, where the volume free space is located.\nFigure 11 shows the file structure as viewed with UEFITool.\n\nFigure 11 // UEFITool view of SecDxe file\n\nFinally, if the NtfsDxe driver is present in the image, it is removed. Since the firmware file system stores\nfiles and their content sequentially, it is a fairly simple process:\n\n- It finds the offset to the free space at the end of the volume\n\n- The NtfsDxe image is overwritten by 0xFF bytes\n\n- The trailing part of the firmware volume is copied starting at the offset where NtfsDxe was located\n\n- The remainder of the file system is padded with 0xFF bytes, which means free space\n\n##### Writing the patched firmware back to the SPI flash memory\n\nOnce the dumped firmware image is successfully modified, the next step is to write it back to the SPI flash\nmemory. Before we dive into this process, we need to introduce some of the BIOS write protections that are\nrelevant to this case. Other existing mechanisms, like BIOS Range Write Protection, are left aside since they\nare not checked by ReWriter_binary.\n\nThe platform exposes multiple protection mechanisms to block unauthorized attempts to write to the BIOS\nregion. These mechanisms are nonetheless not enabled by default. The firmware is responsible for configur­\ning them properly. Such configurations are exposed via the BIOS control register (BIOS_CNTL). This register\ncontains the BIOS Write Enable (BIOSWE) bit, which needs to be set to 1 to be able to write to the BIOS region\nof the SPI flash memory. Since the platform shouldn’t allow all attempts to write to the BIOS region, another\nbit is available in the BIOS_CNTL to protect BIOSWE: the BIOS Lock Enable (BLE). When enabled,\nthis mechanism is meant to lock the BIOSWE bit to 0. However, the implementation is vulnerable. Indeed,\nwhen there is a request to set the BIOSWE bit to 1, the BIOSWE bit is actually set to 1. Only then does the\nplatform issue a System Management Interrupt (SMI) and the handler for this SMI is responsible for setting\nthe BIOSWE bit back to 0.\n\nMultiple issues arise from this implementation. First, the implementation of the SMI handler is left to\nthe firmware developers. Thus, if the firmware doesn’t implement this handler, the BLE bit is useless since\nthere won’t be any routine setting the BIOSWE bit back to 0. Second, there’s a race condition vulnerabili­\nty [18] that allows complete bypass of this mechanism, even if the SMI handler is properly implemented.\nTo exploit this vulnerability, an attacker needs to start a thread that continuously sets BIOSWE to 1 while\nanother thread writes data to the SPI flash memory. According to Kallenberg and Wojtczuk’s paper [19],\nthis attack works on multi-core processors and can also succeed on a single-core processor if it has\nhyper-threading enabled.\n\nTo remediate this issue, a new protection mechanism configured via the BIOS_CNTL was added to the platform.\nIt was introduced in the Platform Controller Hub (PCH) family of Intel chipsets. If its configuration bit is set,\nSMM BIOS Write Protect Disable (SMM_BWP) will ensure that the BIOS region is writable only if all the\ncores are running in System Management Mode (SMM) and BIOSWE is set to 1. This effectively protects a\nsystem against the race condition vulnerability explained above. However, as is the case for BLE, SMM_BWP\nneeds to be activated by the firmware. Hence, a firmware that doesn’t configure these mechanisms properly\nleaves the system at risk of unauthorized writes to the BIOS region.\n\n\n-----\n\n```\nReWriter_binary reads the content of the BIOS control register to choose the proper path to take.\n\n```\nIt first checks if BIOSWE is set. If it is, it goes to the writing phase. If BIOSWE is disabled, it checks the value\nof the BLE bit. If it is not set, it flips the BIOSWE bit and starts to write the patched firmware. If BLE is set,\nit makes sure that SMM_BWP is disabled and exploits the race condition mentioned above. If the SMM_BWP\nbit is set, it fails. Figure 12 illustrates this process.\n\nIs BIOSWE set?\n\nIs BLE set? Write UEFI image\n\nSet BIOSWE to 1 and write\nIs SMM_BWP set?\nUEFI image\n\nExploit race condition Fail\n\nFigure 12 // Decision tree of the writing process\n\nAssuming that the exact build of ReWriter_binary we analyzed was the one that was used to deploy\nthe UEFI rootkit, we can conclude that either the firmware did not properly configure the BIOS write\nprotection mechanisms or the victim’s machine had a chipset older than the Platform Controller Hub.\n```\nReWriter_binary wouldn’t have succeeded at flashing the UEFI firmware on a properly configured\n\n```\nmodern system. However, looking for the vulnerable SmiFlash UEFI image when parsing the UEFI firm­\nware volumes suggests that the operators might have been fiddling with more advanced techniques\nto bypass BIOS write protections [17].\n\nVery similar to the read operation described above, the following sequence of events occurs to write\nto the SPI flash memory:\n\nWrite the number of bytes to be written into\n\n**1**\n\nthe HSFC (FDBC = size -1)\n\nSet the HSFC to the write\ncommand (FCYCLE = 0b10) **2**\n\nWrite the address to write SPI Flash\n\n**3**\n\nto in the HSFC (FADDR)\n\nWrite the data chunk to write in\n\n**4**\n\nthe HSFC (FDATAX)\n\nWrite 1 to Flash Cycle Go (FGO) **5**\n\nWait for SPI write cycle completion\n(HSFS�SCIP == 0) **6**\n\nFigure 13 // Operation sequence to write to the SPI flash memory\n\n\n-----\n\nExcept for the first two steps that are only executed once, these operations are repeated in a loop until\nall the data is written to the SPI flash memory.\n\nWhen the writing process is done, the content of the SPI flash memory is once again dumped into the file\n```\nimage.bin. The same integrity check that was done by ReWriter_read is performed on the new dumped\n\n```\nimage. Then, the image read from the SPI flash memory is compared to the patched image in-memory.\nIf some bytes differ, the address where it happened is logged. Whether they differ or not has no effect\non the execution of the malware. It is just logged for the operators to know what happened.\n\nAs final steps, this registry key is set:\n```\nHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\BootExecute =\n“autocheck autochk *”\n\n```\nThen, RwDrv service is stopped and uninstalled. It is important that the Windows Registry value is set\nto that string because the UEFI Rootkit looks for that exact string to modify it and thus execute its payload\nduring Windows startup. We will give more details about this modification of the Windows Registry when\nwe describe the UEFI Rootkit and its payloads.\n\n### 5. LOJAX TECHNICAL ANALYSIS\n\nWhile the tool to dump, patch and write to the SPI flash memory is customized for a particular firmware\nimage and cannot be re-used easily on any given system, the full UEFI module can be extracted from it. The\nfirst step we did after recovering this module was to go through our telemetry to see whether we had seen\nthis module before. However, as this is a UEFI module, we had to rely on the new ESET UEFI scanner that is\nable to access and scan a system’s firmware. Using telemetry coming from this module, we were able to find\nat least one case where the Sednit’s UEFI module was installed on a system, meaning that this UEFI rootkit\nwas truly deployed in the wild.\n\nWe do not know for sure how the different tools ended up on the compromised systems. The most likely\nguess at this point is that it was dropped by another tool, likely XAgent, as part of the post-compromise\nsteps done by the operators. Since the dumper and the writer tools were found on the same system but\nat different times, it is likely the operators worked in two steps. First, they dumped the firmware on the target\nmachine, made sure that their patching tool would work fine before uploading it again and patching\nthe firmware for real. While we were able to find only one version of the dumper and writer tools, there\nis a possibility that different versions exist for different vulnerable firmware they were able to locate.\n\nFigure 14 gives a high-level overview of the UEFI rootkit workflow until the OS boots. First, SecDxe DXE driver\nis loaded by the DXE dispatcher. It sets a Notify function callback on the EFI_EVENT_GROUP_READY_TO_BOOT\nevent group. When the firmware is about to choose a boot device and to run the OS loader, the Notify\nfunction is called. The callback does three things:\n\n- It loads an embedded NTFS DXE driver to be able to access and write to NTFS partitions\n\n- It writes two files to the Windows NTFS partition: rpcnetp.exe and autoche.exe\n\n- It modifies this registry key ‘HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\\n```\n Session Manager\\BootExecute’:\n\n```\n   - Before: `‘autocheck autochk *’`\n\n   - After: `‘autocheck autoche *’.`\n\n\n-----\n\n**Security (SEC)**\n\n**Pre EFI**\n**Initialization (PEI)**\n\n**Driver**\n**Execution Environment**\n**(DXE)**\n\n**Boot Device Selection**\n**(BDS)**\n\n**Transient System Load**\n**(TSL)**\n\n**Run Time (RT)**\n\n|Verify|Col2|\n|---|---|\n\n\nDXE Drivers EFI_EVENT_GROUP_READY_TO_BOOT\n\n**rpcnetp.exe**\n\n**Boot Manager** Trigger event Drop\n\n**autoche.exe**\n\nEFI_EVENT_GROUP_READY_TO_BOOT\n\nModify **autochk.exe**\n\n**autoche.exe**\n\n**OS Loader**\n\n**autochk.exe**\n\n**Operating System** Run **autoche.exe** Modify **autoche.exe**\n\nFigure 14 // Boot process of a system infected by the UEFI rootkit\n\n|Col1|Col2|\n|---|---|\n|Drop||\n\n\n##### SecDxe: The malicious DXE driver\n\nNow that we have covered the details of the deployment of the UEFI rootkit, this section focuses on the\nchain of events that occurs on a compromised machine. We adopt a bottom-up approach where we begin\nby describing the UEFI rootkit itself and then follow the chain of events up to the final payloads that are\ndeployed at the operating system level.\n\nSednit’s UEFI rootkit is a DXE driver, identified by the GUID 682894B5-6B70-4EBA-9E90-A607E5676297.\nIt is unsigned; thus it cannot run on a system with Secure Boot enabled. Once deployed in one\nof the firmware volumes, the DXE Foundation loads it every time the system boots.\n\nSecDxe is a small DXE driver that mainly does two things. It installs a protocol identified by the GUID\n```\n832d9b4d-d8d5-425f-bd52-5c5afb2c85dc that is never used. Then, it creates an event associated with\n\n```\na Notify function. The Notify function is set to be called when the EFI_EVENT_GROUP_READY_TO_BOOT\nevent group is signaled. This event group is signaled by the boot manager when it is about to choose\na device to boot from.\n\n\n-----\n\nFigure 15 // Hex-Rays decompiler output for the routine creating the event\n\nThe Notify function implements the malicious behavior of Sednit’s UEFI rootkit. It writes the payloads\nto Windows’ NTFS file system. Since UEFI firmware normally deals solely with the EFI system partition,\nan NTFS driver usually is not included. Only FAT-based file systems are supported as boot partitions. Thus,\nit is not mandatory for a UEFI firmware to ship with NTFS drivers. For that reason, SecDxe embeds its own\nNTFS driver. This driver is first loaded and connected to the disk device. Hence, it installs an EFI_SIMPLE_\n```\nFILE_SYSTEM_PROTOCOL on disk devices with NTFS partitions, enabling file-based access to it.\n\n```\nNow that everything is in place to write files on the Windows partition, SecDxe drops rpcnetp.exe\nand autoche.exe. Next, rpcnetp.exe is installed to %WINDIR%\\SysWOW64 on 64-bit Windows versions\nor to %WINDIR%\\System32 on 32-bit versions. As for autoche.exe, it is installed to %WINDIR%\\SysWOW64.\nFigure 16 shows the routine responsible for writing these files to disk.\n\n\n-----\n\nFigure 16 // Hex-Rays decompiler output for the routine writing files to disk\n\nSecDxe then opens %WINDIR%\\System32\\config\\SYSTEM, which is the file backing the HKLM\\SYSTEM\nregistry hive. It parses the file until it finds ‘autocheck autochk *’ and replaces the ‘k’ of ‘autochk’\nwith ‘e’. This sets ‘HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\\n```\nBootExecute’ to ‘autocheck autoche *’. Next time Windows boots, autoche.exe will be launched\n\n```\ninstead of autochk.exe.\n\n##### Hacking Team’s NTFS driver\n\nAs previously discussed, SecDxe module embeds an NTFS driver. There is strong evidence that Sednit’s\noperators did not write their own driver, but rather compiled their own copy of Hacking Team’s leaked\nNTFS DXE driver.\n\nHacking Team’s NTFS driver uses the ntfs-3g open source project at its core. It is merely a wrapper around\nit to make it work as a UEFI DXE Driver. As such, the INF file build information of Hacking Team’s driver lists\nfilenames from the ntfs-3g project. SecDxe’s NTFS driver strings also lists many of these filenames:\n\n- `c:\\edk2\\NtfsPkg\\NtfsDxe\\ntfs\\inode.c`\n\n- `c:\\edk2\\NtfsPkg\\NtfsDxe\\ntfs\\volume.c`\n\n- `c:\\edk2\\NtfsPkg\\NtfsDxe\\ntfs\\bootsect.c`\n\n- `c:\\edk2\\NtfsPkg\\NtfsDxe\\ntfs\\unistr.c`\n\n- `c:\\edk2\\NtfsPkg\\NtfsDxe\\ntfs\\attrib.c`\n\n- `c:\\edk2\\NtfsPkg\\NtfsDxe\\ntfs\\mft.c`\n\n- `c:\\edk2\\NtfsPkg\\NtfsDxe\\ntfs\\index.c`\n\n- `c:\\edk2\\NtfsPkg\\NtfsDxe\\ntfs\\cache.c`\n\n- `c:\\edk2\\NtfsPkg\\NtfsDxe\\ntfs\\misc.c`\n\n- `c:\\edk2\\NtfsPkg\\NtfsDxe\\ntfs\\dir.c`\n\n- `c:\\edk2\\NtfsPkg\\NtfsDxe\\ntfs\\runlist.c`\n\n- c:\\edk2\\NtfsPkg\\NtfsDxe\\ntfs\\logfile.c\n\n- c:\\edk2\\NtfsPkg\\NtfsDxe\\ntfs\\uefi_io.c\n\n- `c:\\edk2\\NtfsPkg\\NtfsDxe\\ntfs\\ntfsinternal.c`\n\n- `c:\\edk2\\NtfsPkg\\NtfsDxe\\ntfs\\mst.c`\n\n\n-----\n\n- `c:\\edk2\\NtfsPkg\\NtfsDxe\\ntfs\\lcnalloc.c`\n\n- `c:\\edk2\\NtfsPkg\\NtfsDxe\\ntfs\\compress.c`\n\n- `c:\\edk2\\NtfsPkg\\NtfsDxe\\ntfs\\bitmap.c`\n\n- `c:\\edk2\\NtfsPkg\\NtfsDxe\\ntfs\\collate.c`\n\n- `c:\\edk2\\NtfsPkg\\NtfsDxe\\ntfs\\security.c`\n\nAnother interesting thing to note is that the project path is the same as those found in vector-edk, Hacking\nTeam’s EFI development leaked project. In vector-edk, there is a subproject NtfsPkg with the exact same\ndirectory layout. The ntfs-3g source code files are located in the same path. While these paths are generic,\nwe believe this is not a coincidence.\n\nComparing the leaked source code with Hex-Rays decompiler output, it becomes evident that it is the\nsame project. Figure 17 is an example comparing the function NtfsDriverBindingStart took from\n```\nvector-edk/NtfsPkg/NtfsDxe/Ntfs.c. Comments have been removed from the original HT’s source\n\n```\ncode for clarity. The logic and the order of the function calls are the same. Both projects even use the same\nvariable (LockedByMe) to keep the state of the lock.\n\nFigure 17 // Comparison between Hex-Rays decompiler output of Sednit’s NTFS driver (left) and HT’s NTFS driver (right)\n\nThe comparison above shows code from Hacking Team developers and is not present in the ntfs-3g open\nsource code.\n\nAs mentioned in the ReWriter_binary section, when parsing the firmware file system the executable\ntries to remove the AMI NTFS driver. We wanted to understand why they remove it instead of using it.\nWe analyzed the driver and found out that it can only perform read operations. As writing to the file system\nis not supported, they couldn’t use it for their purposes. It is also likely that Sednit’s operators may have run\ninto some issues when another NTFS driver was already present in the firmware, so they simply decided to\nremove it. In addition to implementing read and write operations, Hacking Team’s driver does not enforce\nfile permissions. For instance, it is possible to overwrite a read-only file without raising any error.\n\n\n-----\n\nAt this point in this paper, we have described the various operations performed by the UEFI rootkit\nto compromise the host operating system. We also discussed the reasons why we believe that Sednit\noperators used the source code of Hacking Team’s vector-edk to build their NTFS driver to write files\non the Windows NTFS partition. In the following sections, we will provide our analysis of the payloads\ndropped by SecDxe.\n\n##### autoche.exe vs. autochk.exe\n\nThe malicious autoche.exe is used to set up persistence for the small agent rpcnetp.exe. As can be seen\nin Figure 18, it uses native Windows API calls to create this service.\n\nFigure 18 // Malicious autoche.exe setting up rpcnetp.exe persistence\n\nIt should be noted that the service name is the same as the one used by the legitimate Computrace agent.\nOnce the service is created, it then restores the BootExecute registry key to its previous value.\n\nFigure 19 // Malicious autoche.exe restoring BootExecute’s original registry value\n\nSince this process takes place while Windows is booting, the user can hardly notice the BootExecute\nregistry key value modification. It should be noted that autoche.exe shows some similarities with Compu­\ntrace’s autochk.exe module, such as the API calls used and the service registration, but the rest is quite\ndifferent. Computrace’s module is bigger and restores the original autochk.exe executable instead\nof changing the registry key. It is also responsible for dropping the small agent on disk, while this\nis handled by the UEFI rootkit in the LoJax case.\n\n\n-----\n\n##### rpcnetp.exe\n\nWhile the small agent rpcnetp.exe can be dropped by the UEFI rootkit, it is probable that most instances\nwe saw of a trojanized LoJack small agent did not use this component. It is likely that they were opportunistic\nand installed the UEFI rootkit only when possible and in organizations of high importance.\n\nThroughout our investigation, we were able to uncover different LoJax small agent versions. The IOC section\nlists their hashes and the associated malicious domains/IPs. As discussed previously, all LoJax small agent\nsamples we were able to recover were a trojanized version of the same old Computrace small agent\ncompiled in 2008.\n\nWhile we never witnessed LoJax agent download and install additional modules, we do know\nthat this functionality exists. As LoJax’s best quality is to be stealthy and persistent, it could definitely\nbe used to help ensure that access to key resources is maintained.\n\n### 6. PREVENTION AND REMEDIATION\n\nHow could such an attack have been prevented? This involves a complex ecosystem composed of multiple\nactors. The first security mechanism that could have blocked such an attack is Secure Boot. When Secure\nBoot is enabled, each and every firmware component that is loaded by the firmware needs to be properly\nsigned, thus ensuring the integrity of the firmware. We strongly suggest that you enable it. This is the base\ndefense against attacks targeting UEFI firmware.\n\nAs is the case for software, the UEFI firmware should always be kept up-to-date. Visit your motherboard\nwebsite to make sure that you have the latest version available.\n\nYou should also make sure that all of your systems have modern chipsets with Platform Controller Hub\n(starting from Intel Series 5 chipsets onwards). This will ensure that the security mechanism against\nthe race condition vulnerability we mentioned [18] is available on the platform.\n\nThe other part of firmware security is in the hands of UEFI/BIOS vendors. The security mechanisms provided\nby the platform need to be properly configured by the system firmware to actually protect it. Thus, firmware\nmust be built with security in mind from the ground up. Fortunately, more and more security researchers\nare looking at firmware security thus contributing to improve this field and raise awareness of firmware\nvendors. It is also worth mentioning CHIPSEC [16], an open source framework to perform low-level security\nassessments, which is very helpful to determine if your platform is properly configured.\n\nRemediation of a UEFI firmware-based compromise is a hard problem. There are no easy ways of cleaning\nthe system from such threat nor are there any security products that can save the day. In the case we described\nin this paper, the SPI flash memory needs to be reflashed to remove the rootkit. This is not a trivial task and\nthat definitely is not a recommended procedure for the average computer owner. Upgrading the UEFI firm­\nware may remove the rootkit given that the update rewrites the whole BIOS region of the SPI flash memory.\nIf reflashing the UEFI firmware is not an option for you, the only alternative is to change the motherboard\nof the infected system.\n\n### 7. CONCLUSION\n\nUEFI rootkits are one of the most powerful tools in an attacker’s arsenal as they are persistent across\nOS re-install and hard disk changes and are extremely difficult to detect and remove. While it is hard\nto modify a system’s UEFI image, few solutions exists to scan system’s UEFI modules and detect malicious\nones. Moreover, cleaning a system’s UEFI firmware means re-flashing it, an operation not commonly done\nand certainly not by the average user. These advantages explain why determined and resourceful\nattackers will continue to target systems’ UEFI.\n\n\n-----\n\n### 8. ACKNOWLEDGEMENT\n\nWe’d like to express our gratitude to the people behind opensecuritytraining.info for the great material\nthat they share with the community. The course ‘Introduction to BIOS & SMM’ [20] was of great help\nto us when it came the time to analyze interactions with the SPI flash chip.\n\n### 9. GLOSSARY\n\nPlease refer to Intel specifications [21] for more details on each fields and more.\n\n- BIOS_CNTL: BIOS Control Register\n\n- BIOSWE: BIOS Write Enabled\n\n- BLE: BIOS Lock Enabled\n\n- FADDR: Flash Address\n\n- FDATAX: Flash Data from FDATA0 to FDATAN\n\n- FDBC: Flash Data Byte Count\n\n- FGO: Flash Cycle Go\n\n- HSFC: Hardware Sequencing Flash Control\n\n- HSFS: Hardware Sequencing Flash Status\n\n- IOCTL: Input/Output Control\n\n- PCH: Platform Controller Hub\n\n- RCBA: Root Complex Base Address Register\n\n- RCRB: Root Complex Register Block\n\n- SCIP: SPI Cycle in Progress\n\n- SMI: System Management Interrupt\n\n- SMM: System Management Mode\n\n- SMM_BWP: SMM BIOS Write Protect Disable\n\n- SPI: Serial Peripheral Interface\n\n### 10. REFERENCES\n\n1 D. Alperovitch, “Bears in the Midst: Intrusion into the Democratic National Committee,” Crowdstrike, 15 June 2016.\n\n[[Online]. Available: https://www.crowdstrike.com/blog/bears-midst-intrusion-democratic-national-committee/](https://www.crowdstrike.com/blog/bears-midst-intrusion-democratic-national-committee/)\n\n2 US Department of Justice, July 2018. [Online]. Available:\n\n_[https://assets.documentcloud.org/documents/4598895/DOJ-Russia-DNC-Hack-Indictment.pdf](https://assets.documentcloud.org/documents/4598895/DOJ-Russia-DNC-Hack-Indictment.pdf)_\n\n3 G. Corera, “How France’s TV5 was almost destroyed by ‘Russian hackers’,” BBC, 10 October 2016. [\n\n[Online]. Available: https://www.bbc.com/news/technology-37590375](https://www.bbc.com/news/technology-37590375)\n\n4 L. Matsakis, “Hack Brief: Russian Hackers Release Apparent IOC Emails in Wake of Olympics Ban,”\n\nWIRED, 1 January 2018. [Online].\n[Available: https://www.wired.com/story/russian-fancy-bears-hackers-release-apparent-ioc-emails/](https://www.wired.com/story/russian-fancy-bears-hackers-release-apparent-ioc-emails/)\n\n5 ESET Research, “En Route with Sednit,” ESET, 2016. [Online].\n\n[Available: http://www.welivesecurity.com/wp-content/uploads/2016/10/eset-sednit-full.pdf](http://www.welivesecurity.com/wp-content/uploads/2016/10/eset-sednit-full.pdf)\n\n6 ESET Research, “Sednit adds two zero-day exploits using ‘Trump’s attack on Syria’ as a decoy,” ESET,\n\n9 May 2017. [Online]. Available:\n_[https://www.welivesecurity.com/2017/05/09/sednit-adds-two-zero-day-exploits-using-trumps-attack-syria-decoy/](https://www.welivesecurity.com/2017/05/09/sednit-adds-two-zero-day-exploits-using-trumps-attack-syria-decoy/)_\n\n7 ESET Research, “Sednit update: Analysis of Zebrocy,” ESET, 24 April 2018. [Online].\n\n[Available: https://www.welivesecurity.com/2018/04/24/sednit-update-analysis-zebrocy/](https://www.welivesecurity.com/2018/04/24/sednit-update-analysis-zebrocy/)\n\n\n-----\n\n8 P. Lin, “Hacking Team Uses UEFI BIOS Rootkit to Keep RCS 9 Agent in Target Systems,” Trend Micro, 13 July\n\n[2015. [Online]. Available: https://blog.trendmicro.com/trendlabs-security-intelligence/](https://blog.trendmicro.com/trendlabs-security-intelligence/hacking-team-uses-uefi-bios-rootkit-to-keep-rcs-9-agent-in-target-systems/)\n_[hacking-team-uses-uefi-bios-rootkit-to-keep-rcs-9-agent-in-target-systems/](https://blog.trendmicro.com/trendlabs-security-intelligence/hacking-team-uses-uefi-bios-rootkit-to-keep-rcs-9-agent-in-target-systems/)_\n\n9 [WikiLeaks, “DerStarke 2.0,” [Online]. Available: https://wikileaks.org/ciav7p1/cms/page_13763820.html](https://wikileaks.org/ciav7p1/cms/page_13763820.html)\n\n10 Absolute, “Absolute Response to Arbor Research,” May 2018. [Online].\n\n[Available: https://www.absolute.com/en-gb/resources/faq/absolute-response-to-arbor-research](https://www.absolute.com/en-gb/resources/faq/absolute-response-to-arbor-research)\n\n11 A. Ortega and A. Sacco, “Deactivate the Rootkit: Attacks on BIOS anti-theft,” Core Security Technologies,\n\n[24 July 2009. [Online]. Available: https://www.coresecurity.com/system/files/publications/2016/05/Paper-Deactivate-](https://www.coresecurity.com/system/files/publications/2016/05/Paper-Deactivate-the-Rootkit-AOrtega-ASacco.pdf)\n_[the-Rootkit-AOrtega-ASacco.pdf](https://www.coresecurity.com/system/files/publications/2016/05/Paper-Deactivate-the-Rootkit-AOrtega-ASacco.pdf)_\n\n12 V. Kamlyuk, S. Belov and A. Sacco, “Absolute Backdoor Revisited,” BlackHat, June 2014. [Online].\n\n[Available: https://www.blackhat.com/docs/us-14/materials/us-14-Kamluk-Computrace-Backdoor-Revisited-WP.pdf](https://www.blackhat.com/docs/us-14/materials/us-14-Kamluk-Computrace-Backdoor-Revisited-WP.pdf)\n\n13 ASERT team, “Lojack Becomes a Double-Agent,” 1 May 2018. [Online].\n\n[Available: https://asert.arbornetworks.com/lojack-becomes-a-double-agent/](https://asert.arbornetworks.com/lojack-becomes-a-double-agent/)\n\n14 [“RWEverything Read & Write Everything,” [Online]. Available: http://rweverything.com/](http://rweverything.com/)\n\n15 A. Matrosov and E. Rodionov, “UEFI Firmware Rootkits: Myths and Reality,” Black Hat Asia, 2017. [Online].\n\n[Available: https://www.blackhat.com/docs/asia-17/materials/asia-17-Matrosov-The-UEFI-Firmware-Rootkits-Myths-](https://www.blackhat.com/docs/asia-17/materials/asia-17-Matrosov-The-UEFI-Firmware-Rootkits-Myths-And-Reality.pdf)\n_[And-Reality.pdf](https://www.blackhat.com/docs/asia-17/materials/asia-17-Matrosov-The-UEFI-Firmware-Rootkits-Myths-And-Reality.pdf)_\n\n16 [“GitHub repository for UEFITool,” [Online]. Available: https://github.com/LongSoft/UEFITool](https://github.com/LongSoft/UEFITool)\n\n17 Cylance, “Researchers Disclose Vulnerabilities in GIGABYTE BRIX Systems,” [Online].\n\n[Available: https://threatvector.cylance.com/en_us/home/gigabyte-brix-systems-vulnerabilities.html](https://threatvector.cylance.com/en_us/home/gigabyte-brix-systems-vulnerabilities.html)\n\n18 Carnegie Mellon University SEI CERT, “Vulnerability Note VU#766164, Intel BIOS locking mechanism contains\n\n[race condition that enables write protection bypass,” [Online]. Available: https://www.kb.cert.org/vuls/id/766164](https://www.kb.cert.org/vuls/id/766164)\n\n19 C. Kallenberg and R. Wojtczuk, “Speed Racer: Exploiting an Intel Flash Protection Race Condition,”\n\n[January 2015. [Online]. Available: https://bromiumlabs.files.wordpress.com/2015/01/speed_racer_whitepaper.pdf](https://bromiumlabs.files.wordpress.com/2015/01/speed_racer_whitepaper.pdf)\n\n20 J. Butterworth, “Advanced x86: Introduction to BIOS & SMM,” 2014. [Online].\n\n[Available: http://opensecuritytraining.info/IntroBIOS.html](http://opensecuritytraining.info/IntroBIOS.html)\n\n21 Intel, “Intel 7 Series / C216 Chipset and Family Platform Controller Hub (PCH),” June 2012. [Online]. Available:\n\n_[https://www.intel.com/content/dam/www/public/us/en/documents/datasheets/7-series-chipset-pch-datasheet.pdf](https://www.intel.com/content/dam/www/public/us/en/documents/datasheets/7-series-chipset-pch-datasheet.pdf)_\n\n\n-----\n\n### 11. IOCs\n\nReWriter_read.exe\n\nESET detection name\n\nWin32/SPIFlash.A\n\nSHA-1\n```\n  ea728abe26bac161e110970051e1561fd51db93b\n\n```\nReWriter_binary.exe\n\nESET detection name\n\nWin32/SPIFlash.A\n\nSHA-1\n```\n  cc217342373967d1916cb20eca5ccb29caaf7c1b\n\n```\nSecDxe\n\nESET detection name\n\nEFI/LoJax.A\n\nSHA-1\n```\n  f2be778971ad9df2082a266bd04ab657bd287413\n\n```\ninfo_efi.exe\n\nESET detection name\n\nWin32/Agent.ZXZ\n\nSHA-1\n```\n  4b9e71615b37aea1eaeb5b1cfa0eee048118ff72\n\n```\nautoche.exe\n\nESET detection name\n\nWin32/LoJax.A\n\nSHA-1\n```\n  700d7e763f59e706b4f05c69911319690f85432e\n\n```\nSmall agent EXE\n\nESET detection names\n\nWin32/Agent.ZQE\n\nWin32/Agent.ZTU\n\nSHA-1\n```\n  1771e435ba25f9cdfa77168899490d87681f2029\n  ddaa06a4021baf980a08caea899f2904609410b9\n  10d571d66d3ab7b9ddf6a850cb9b8e38b07623c0\n  2529f6eda28d54490119d2123d22da56783c704f\n  e923ac79046ffa06f67d3f4c567e84a82dd7ff1b\n  8e138eecea8e9937a83bffe100d842d6381b6bb1\n  ef860dca7d7c928b68c4218007fb9069c6e654e9\n\n```\n\n-----\n\n```\n  e8f07caafb23eff83020406c21645d8ed0005ca6\n  09d2e2c26247a4a908952fee36b56b360561984f\n  f90ccf57e75923812c2c1da9f56166b36d1482be\n\n```\nC&C server domain names\n\nsecao[.]org\n\nikmtrust[.]com\n\nsysanalyticweb[.]com\n\nlxwo[.]org\n\njflynci[.]com\n\nremotepx[.]net\n\nrdsnets[.]com\n\nrpcnetconnect[.]com\n\nwebstp[.]com\n\nelaxo[.]org\n\nC&C server IPs\n\n185.77.129[.]106\n\n185.144.82[.]239\n\n93.113.131[.]103\n\n185.86.149[.]54\n\n185.86.151[.]104\n\n103.41.177[.]43\n\n185.86.148[.]184\n\n185.94.191[.]65\n\n86.106.131[.]54\n\nSmall agent DLL\n\nIn this section, we list only the DLL for which we never obtained the corresponding EXE\n\nESET detection names\n\nWin32/Agent.ZQE\n\nSHA-1\n```\n  397d97e278110a48bd2cb11bb5632b99a9100dbd\n\n```\nC&C server domain names\n\nelaxo[.]org\n\nC&C server IPs\n\n86.106.131[.]54\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2018/2018.09.27.LoJax/ESET-LoJax.pdf"
    ],
    "report_names": [
        "ESET-LoJax"
    ],
    "threat_actors": [
        {
            "id": "cf0704ab-99e4-44d7-96d9-3cba91339229",
            "created_at": "2022-10-25T15:50:23.485375Z",
            "updated_at": "2025-03-27T02:00:55.482473Z",
            "deleted_at": null,
            "main_name": "Group5",
            "aliases": [
                "Group5"
            ],
            "source_name": "MITRE:Group5",
            "tools": [
                "njRAT",
                "NanoCore"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "9aa9b489-a297-4dbd-8601-8fc0370201a6",
            "created_at": "2022-10-25T16:07:23.696796Z",
            "updated_at": "2025-03-27T02:02:09.928416Z",
            "deleted_at": null,
            "main_name": "Group5",
            "aliases": [],
            "source_name": "ETDA:Group5",
            "tools": [
                "Atros2.CKPN",
                "Bladabindi",
                "DroidJack",
                "Jorik",
                "Nancrat",
                "NanoCore",
                "NanoCore RAT",
                "Zurten",
                "njRAT"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "4b076dcb-516e-42fb-9c8f-f153902cd5e9",
            "created_at": "2022-10-25T16:07:23.708745Z",
            "updated_at": "2025-03-27T02:02:09.935617Z",
            "deleted_at": null,
            "main_name": "Hidden Lynx",
            "aliases": [
                "Aurora Panda",
                "Group 8",
                "Hidden Lynx",
                "Operation SMN"
            ],
            "source_name": "ETDA:Hidden Lynx",
            "tools": [
                "AGENT.ABQMR",
                "AGENT.AQUP.DROPPER",
                "AGENT.BMZA",
                "AGENT.GUNZ",
                "BlackCoffee",
                "HiKit",
                "MCRAT.A",
                "Mdmbot.E",
                "Moudoor",
                "Naid",
                "PNGRAT",
                "Trojan.Naid",
                "ZoxPNG",
                "gresim"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "a3687241-9876-477b-aa13-a7c368ffda58",
            "created_at": "2022-10-25T16:07:24.496902Z",
            "updated_at": "2025-03-27T02:02:10.256629Z",
            "deleted_at": null,
            "main_name": "Hacking Team",
            "aliases": [],
            "source_name": "ETDA:Hacking Team",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "23dfc9f5-1862-4510-a6ae-53d8e51f17b1",
            "created_at": "2024-05-01T02:03:08.146025Z",
            "updated_at": "2025-03-27T02:05:17.420497Z",
            "deleted_at": null,
            "main_name": "PLATINUM TERMINAL",
            "aliases": [
                "Longhorn ",
                "The Lamberts ",
                "Vault7 ",
                "APT-C-39 "
            ],
            "source_name": "Secureworks:PLATINUM TERMINAL",
            "tools": [
                " Assassin",
                " Marble Framework",
                "AfterMidnight"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "e90c06e4-e3e0-4f46-a3b5-17b84b31da62",
            "created_at": "2023-01-06T13:46:39.018236Z",
            "updated_at": "2025-03-27T02:00:02.978356Z",
            "deleted_at": null,
            "main_name": "Hacking Team",
            "aliases": [],
            "source_name": "MISPGALAXY:Hacking Team",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "a7aefdda-98f1-4790-a32d-14cc99de2d60",
            "created_at": "2023-01-06T13:46:38.281844Z",
            "updated_at": "2025-03-27T02:00:02.792526Z",
            "deleted_at": null,
            "main_name": "APT17",
            "aliases": [
                "G0025",
                "AURORA PANDA",
                "Group 72",
                "G0001",
                "HELIUM",
                "Group 8",
                "Hidden Lynx",
                "Tailgater Team",
                "BRONZE KEYSTONE"
            ],
            "source_name": "MISPGALAXY:APT17",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "e3767160-695d-4360-8b2e-d5274db3f7cd",
            "created_at": "2022-10-25T16:47:55.914348Z",
            "updated_at": "2025-03-27T02:05:17.411172Z",
            "deleted_at": null,
            "main_name": "IRON TWILIGHT",
            "aliases": [
                "ATK5 ",
                "Blue Athena ",
                "BlueDelta ",
                "FROZENLAKE ",
                "Fancy Bear ",
                "Fighting Ursa ",
                "Forest Blizzard ",
                "GRAPHITE ",
                "Group 74 ",
                "PawnStorm ",
                "STRONTIUM ",
                "Sednit ",
                "Snakemackerel ",
                "Sofacy ",
                "TG-4127 ",
                "Tsar Team ",
                "APT28 "
            ],
            "source_name": "Secureworks:IRON TWILIGHT",
            "tools": [
                " Downdelph",
                " Drovorub",
                " EVILTOSS",
                " HIDEDRV",
                " Headlace",
                " LoJack",
                " Powershell Empire",
                " SCONATO",
                " SEDUPLOADER",
                " SHARPFRONT",
                " Scaramouche",
                " Sedkit Exploit Kit",
                " Sofacy downloader",
                " X-Agent",
                " X-Tunnel",
                " Zebrocy",
                " reGeorg",
                "DEALERSCHOICE"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "a97cf06d-c2e2-4771-99a2-c9dee0d6a0ac",
            "created_at": "2022-10-25T16:07:24.349252Z",
            "updated_at": "2025-03-27T02:02:10.184406Z",
            "deleted_at": null,
            "main_name": "Turla",
            "aliases": [
                "ATK 13",
                "Belugasturgeon",
                "Blue Python",
                "CTG-8875",
                "Group 88",
                "ITG12",
                "Iron Hunter",
                "Krypton",
                "Makersmark",
                "Operation Epic Turla",
                "Operation Moonlight Maze",
                "Operation Penguin Turla",
                "Operation Satellite Turla",
                "Operation Skipper Turla",
                "Operation Turla Mosquito",
                "Operation WITCHCOVEN",
                "Pacifier APT",
                "Pensive Ursa",
                "Popeye",
                "SIG15",
                "SIG2",
                "SIG23",
                "Secret Blizzard",
                "TAG-0530",
                "Turla",
                "UNC4210",
                "Venomous Bear",
                "Waterbug"
            ],
            "source_name": "ETDA:Turla",
            "tools": [
                "ASPXSpy",
                "ASPXTool",
                "ATI-Agent",
                "AdobeARM",
                "Agent.BTZ",
                "Agent.DNE",
                "BigBoss",
                "COMpfun",
                "Chinch",
                "Cloud Duke",
                "CloudDuke",
                "CloudLook",
                "Cobra Carbon System",
                "ComRAT",
                "DoublePulsar",
                "EmPyre",
                "EmpireProject",
                "Epic Turla",
                "EternalBlue",
                "EternalRomance",
                "GoldenSky",
                "Group Policy Results Tool",
                "HTML5 Encoding",
                "HyperStack",
                "IcedCoffee",
                "IronNetInjector",
                "KSL0T",
                "Kapushka",
                "Kazuar",
                "KopiLuwak",
                "Kotel",
                "LOLBAS",
                "LOLBins",
                "LightNeuron",
                "Living off the Land",
                "Maintools.js",
                "Metasploit",
                "Meterpreter",
                "MiamiBeach",
                "Mimikatz",
                "MiniDionis",
                "Minit",
                "NBTscan",
                "NETTRANS",
                "NETVulture",
                "Neptun",
                "NetFlash",
                "NewPass",
                "Outlook Backdoor",
                "Penquin Turla",
                "Pfinet",
                "PowerShell Empire",
                "PowerShellRunner",
                "PowerShellRunner-based RPC backdoor",
                "PowerStallion",
                "PsExec",
                "PyFlash",
                "QUIETCANARY",
                "Reductor RAT",
                "RocketMan",
                "SMBTouch",
                "SScan",
                "Satellite Turla",
                "SilentMoon",
                "Sun rootkit",
                "TTNG",
                "TadjMakhal",
                "Tavdig",
                "TinyTurla",
                "TinyTurla Next Generation",
                "TinyTurla-NG",
                "Topinambour",
                "Tunnus",
                "Turla",
                "Turla SilentMoon",
                "TurlaChopper",
                "Uroburos",
                "Urouros",
                "WCE",
                "WITCHCOVEN",
                "WhiteAtlas",
                "WhiteBear",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "Wipbot",
                "WorldCupSec",
                "XTRANS",
                "certutil",
                "certutil.exe",
                "gpresult",
                "nbtscan",
                "nbtstat",
                "pwdump"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "730dfa6e-572d-473c-9267-ea1597d1a42b",
            "created_at": "2023-01-06T13:46:38.389985Z",
            "updated_at": "2025-03-27T02:00:02.821388Z",
            "deleted_at": null,
            "main_name": "APT28",
            "aliases": [
                "FROZENLAKE",
                "BlueDelta",
                "SNAKEMACKEREL",
                "TG-4127",
                "ITG05",
                "TA422",
                "Fancy Bear",
                "FANCY BEAR",
                "Sednit",
                "IRON TWILIGHT",
                "G0007",
                "Sofacy",
                "Forest Blizzard",
                "GruesomeLarch",
                "Pawn Storm",
                "Tsar Team",
                "STRONTIUM",
                "ATK5",
                "Blue Athena",
                "APT-C-20",
                "Group 74",
                "SIG40",
                "Grizzly Steppe",
                "Fighting Ursa",
                "T-APT-12",
                "UAC-0028"
            ],
            "source_name": "MISPGALAXY:APT28",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "ae320ed7-9a63-42ed-944b-44ada7313495",
            "created_at": "2022-10-25T15:50:23.671663Z",
            "updated_at": "2025-03-27T02:00:55.518748Z",
            "deleted_at": null,
            "main_name": "APT28",
            "aliases": [
                "APT28",
                "IRON TWILIGHT",
                "SNAKEMACKEREL",
                "Group 74",
                "Sednit",
                "Sofacy",
                "Pawn Storm",
                "Fancy Bear",
                "STRONTIUM",
                "Tsar Team",
                "Threat Group-4127",
                "TG-4127",
                "Forest Blizzard",
                "FROZENLAKE"
            ],
            "source_name": "MITRE:APT28",
            "tools": [
                "Wevtutil",
                "certutil",
                "Forfiles",
                "DealersChoice",
                "Mimikatz",
                "ADVSTORESHELL",
                "Komplex",
                "HIDEDRV",
                "JHUHUGIT",
                "Koadic",
                "Winexe",
                "XTunnel",
                "Drovorub",
                "CORESHELL",
                "OLDBAIT",
                "Downdelph",
                "XAgentOSX",
                "USBStealer",
                "Zebrocy",
                "Fysbis",
                "LoJax"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "d11c89bb-1640-45fa-8322-6f4e4053d7f3",
            "created_at": "2022-10-25T15:50:23.509601Z",
            "updated_at": "2025-03-27T02:00:55.487991Z",
            "deleted_at": null,
            "main_name": "Turla",
            "aliases": [
                "Turla",
                "IRON HUNTER",
                "Group 88",
                "Waterbug",
                "WhiteBear",
                "Krypton",
                "Venomous Bear",
                "Secret Blizzard",
                "BELUGASTURGEON"
            ],
            "source_name": "MITRE:Turla",
            "tools": [
                "PsExec",
                "nbtstat",
                "ComRAT",
                "netstat",
                "certutil",
                "KOPILUWAK",
                "IronNetInjector",
                "LunarWeb",
                "Arp",
                "Uroburos",
                "PowerStallion",
                "Kazuar",
                "Systeminfo",
                "LightNeuron",
                "Mimikatz",
                "Tasklist",
                "LunarMail",
                "HyperStack",
                "NBTscan",
                "TinyTurla",
                "Penquin",
                "LunarLoader"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "d2516b8e-e74f-490d-8a15-43ad6763c7ab",
            "created_at": "2022-10-25T16:07:24.212584Z",
            "updated_at": "2025-03-27T02:02:10.141001Z",
            "deleted_at": null,
            "main_name": "Sofacy",
            "aliases": [
                "APT 28",
                "ATK 5",
                "Blue Athena",
                "BlueDelta",
                "FROZENLAKE",
                "Fancy Bear",
                "Fighting Ursa",
                "Forest Blizzard",
                "Grey-Cloud",
                "Grizzly Steppe",
                "Group 74",
                "GruesomeLarch",
                "ITG05",
                "Iron Twilight",
                "Operation DealersChoice",
                "Operation Dear Joohn",
                "Operation Komplex",
                "Operation Pawn Storm",
                "Operation Russian Doll",
                "Operation Steal-It",
                "Pawn Storm",
                "SIG40",
                "Sednit",
                "Snakemackerel",
                "Sofacy",
                "Strontium",
                "T-APT-12",
                "TA422",
                "TAG-0700",
                "TAG-110",
                "TG-4127",
                "Tsar Team",
                "UAC-0028",
                "UAC-0063"
            ],
            "source_name": "ETDA:Sofacy",
            "tools": [
                "ADVSTORESHELL",
                "AZZY",
                "Backdoor.SofacyX",
                "CHERRYSPY",
                "CORESHELL",
                "Carberp",
                "Computrace",
                "DealersChoice",
                "Delphacy",
                "Downdelph",
                "Downrage",
                "Drovorub",
                "EVILTOSS",
                "Foozer",
                "GAMEFISH",
                "GooseEgg",
                "Graphite",
                "HATVIBE",
                "HIDEDRV",
                "Headlace",
                "Impacket",
                "JHUHUGIT",
                "JKEYSKW",
                "Koadic",
                "Komplex",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "LoJack",
                "LoJax",
                "MASEPIE",
                "Mimikatz",
                "NETUI",
                "Nimcy",
                "OCEANMAP",
                "OLDBAIT",
                "PocoDown",
                "PocoDownloader",
                "Popr-d30",
                "ProcDump",
                "PythocyDbg",
                "SMBExec",
                "SOURFACE",
                "SPLM",
                "STEELHOOK",
                "Sasfis",
                "Sedkit",
                "Sednit",
                "Sedreco",
                "Seduploader",
                "Shunnael",
                "SkinnyBoy",
                "Sofacy",
                "SofacyCarberp",
                "SpiderLabs Responder",
                "Trojan.Shunnael",
                "Trojan.Sofacy",
                "USB Stealer",
                "USBStealer",
                "VPNFilter",
                "Win32/USBStealer",
                "WinIDS",
                "Winexe",
                "X-Agent",
                "X-Tunnel",
                "XAPS",
                "XTunnel",
                "Xagent",
                "Zebrocy",
                "Zekapab",
                "carberplike",
                "certutil",
                "certutil.exe",
                "fysbis",
                "webhp"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716495,
    "ts_updated_at": 1743041831,
    "ts_creation_date": 1538066093,
    "ts_modification_date": 1538067272,
    "files": {
        "pdf": "https://archive.orkl.eu/c1d45e9e295ef68265aaab4d84c14f89109ea3cd.pdf",
        "text": "https://archive.orkl.eu/c1d45e9e295ef68265aaab4d84c14f89109ea3cd.txt",
        "img": "https://archive.orkl.eu/c1d45e9e295ef68265aaab4d84c14f89109ea3cd.jpg"
    }
}