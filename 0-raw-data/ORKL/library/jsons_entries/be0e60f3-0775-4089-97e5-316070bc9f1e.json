{
    "id": "be0e60f3-0775-4089-97e5-316070bc9f1e",
    "created_at": "2023-01-12T15:10:39.682192Z",
    "updated_at": "2025-03-27T02:05:41.529793Z",
    "deleted_at": null,
    "sha1_hash": "5367e3aec99dd0de809412cd60cdbc4ae1ee2e65",
    "title": "2012-12-13 - The Dexter Malware- Getting Your Hands Dirty",
    "authors": "",
    "file_creation_date": "2022-05-28T02:12:07Z",
    "file_modification_date": "2022-05-28T02:12:07Z",
    "file_size": 392934,
    "plain_text": "# The Dexter Malware: Getting Your Hands Dirty\n\n**[trustwave.com/Resources/SpiderLabs-Blog/The-Dexter-Malware--Getting-Your-Hands-Dirty/](https://www.trustwave.com/Resources/SpiderLabs-Blog/The-Dexter-Malware--Getting-Your-Hands-Dirty/)**\n\nA very interesting piece of malware that targets Point ofSale systems has recently surfaced\nin the malware community. As a guy whofrequently reverses malware that targets card data\n(aka. Track data), thiscaused me to take notice. Before I jump into the really interesting bits\nof themalware, I'd like to offer a few links to those that have already taken a lookat this stuff.\nSeculert specificallywere the ones that originally discovered, and named, the Dexter\nmalware.\n\n[http://blog.seculert.com/2012/12/dexter-draining-blood-out-of-point-of.html](http://blog.seculert.com/2012/12/dexter-draining-blood-out-of-point-of.html)\n\n[http://volatility-labs.blogspot.com/2012/12/unpacking-dexter-pos-memory-dump.html](http://volatility-labs.blogspot.com/2012/12/unpacking-dexter-pos-memory-dump.html)\n\nSo if you either haven't gotten a chance to read the abovearticles, or simply would like a\nrefresher, here's what the malware does in anutshell.\n\nInjects itself into iexplore.exe\nEnsures the iexplore.exe process restarts in theevent that it is manually stopped\nEnsures persistence via writes to the 'Run'registry key\nScrapes track data through a very common method\nHas a command and control structure with aremote host\n\nThat last bullet in particular really caught my eye. I can'tremember the last time I saw a\npiece of malware that targeted Point of Salesystems that had a nice C&C structure to it.\nAnd that is where our storyreally begins…\n\n\n-----\n\nSo in looking at the underlying assembly of the malware, itbecomes apparent that this\nsample is planning on talking to as many as sevendifferent domains. It's also apparent that\nit's going to communicate over HTTP,via a POST request. Looking at the traffic that gets\ngenerated, we seesomething similar to the following:\n\nNow you might be thinking to yourself, \"Geez, that's a lotof …stuff\". And you'd be right. So\nlets break down that nice blob of datathat's being sent over the wire. In total, we see the\nfollowing ten differentvariables:\n\npage\nump\nunm\ncnm\nquery\nspec\nopt\nview\nvar\nval\n\nI'm going to focus on the last variable ('val') first, mainly because it's the easies to decode,\nand because it's one of the mostimportant. We see that 'val' has a value of 'ZnJ0a2o=',\nwhich I'm sure you'veall guessed by now is Base64 encoded. Once decoded, we see this\nvalue change to'frtkj'. You might be thinking that this is also garbage, but it is, in fact, akey\nthat is used to encode the remaining text in the POST request.Specifically, we see the\nfollowing occur when each variable's data is decoded:\n\n1. The data is Base64 decoded\n\n\n-----\n\n2. Each character in the decoded string is xoredsequentially against each character of\n\nthe key we previously identified. InRuby, it looks something like this:\n\n\"A\".xor(\"f\").xor(\"r\").xor(\"t\").xor(\"k\").xor(\"j\")\n\nThis results in the original content.\n\nKnow how this works, we can whip up a quick script to decodethe entire string.\n\nWe can now easily determine when a number of the variable discoveredactually contain.\n\npage: Mutex string\nump: Track data\nunm: Username\ncnm: Hostname\nquery: Victim OS\nspec: Processor type\nopt: Unknown\nview: List of all running processes on thevictim\nvar: Some unique string. Appears to be constantfor this sample\nval: Random key that changes every time themalware restarts\n\nSo at this point we can see how the malware is communicatingoutbound to its master.\nHowever, that's only half of the puzzle. How is themalware receiving commands?\n\nWell, the answer to that question comes in the form of theresponse Cookie. Specifically, the\nmalware will set the 'response' cookie usingthe same technique (only in reverse) that we\njust witnessed. So basically, theserver takes the key from before, XORs each byte of the\nstring against eachcharacter in the key, and Base64 encodes it. Dexter will then parse this\ndata,and look for one of the following variables:\n\nupdate- (Updates the malware with the specifiedargument)\ncheckin: (alters the delay between times themalware attempts to make POST\nrequests to the master host)\nscanin: (alters the delay between times the malware scrapes memory for trackdata)\nuninstall (completely removes the malware)\ndownload- (downloads and execute the specified argument)\n\n\n-----\n\nI should point out that each variable has to start with thecharacter $ in order for the\nmalware to look at it. We can see how thesevariables are checked in the following\ndecompiled code:\n\nSo at this point we can get a pretty clear picture of howthis malware operates over the wire.\nThe details of how this malware has gottenon these victim machines is still unclear, but\nplease ensure that you aretaking the necessary precautions to protect your system, with a\nspecialemphasis on Point of Sale boxes. Because really, nobody wants to becomeDexter's\nnext victim.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2012/2012-12-13 - The Dexter Malware- Getting Your Hands Dirty.pdf"
    ],
    "report_names": [
        "2012-12-13 - The Dexter Malware- Getting Your Hands Dirty.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536239,
    "ts_updated_at": 1743041141,
    "ts_creation_date": 1653703927,
    "ts_modification_date": 1653703927,
    "files": {
        "pdf": "https://archive.orkl.eu/5367e3aec99dd0de809412cd60cdbc4ae1ee2e65.pdf",
        "text": "https://archive.orkl.eu/5367e3aec99dd0de809412cd60cdbc4ae1ee2e65.txt",
        "img": "https://archive.orkl.eu/5367e3aec99dd0de809412cd60cdbc4ae1ee2e65.jpg"
    }
}