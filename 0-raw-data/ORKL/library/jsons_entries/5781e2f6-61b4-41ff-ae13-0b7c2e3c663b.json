{
    "id": "5781e2f6-61b4-41ff-ae13-0b7c2e3c663b",
    "created_at": "2022-10-25T16:48:18.816095Z",
    "updated_at": "2025-03-27T02:08:41.174756Z",
    "deleted_at": null,
    "sha1_hash": "c16375fdd9f0f4b81b76df0c4f0d09967d040ab7",
    "title": "",
    "authors": "",
    "file_creation_date": "2020-12-30T04:28:31Z",
    "file_modification_date": "2020-12-30T04:28:31Z",
    "file_size": 1695942,
    "plain_text": "# Revenge RAT targeting users in South America\n\n**uptycs.com/blog/revenge-rat-targeting-users-in-south-america**\n\n[By Abhijit Mohanta | Dec 29, 2020](https://www.uptycs.com/blog/author/abhijit-mohanta)\n\nThe Uptycs threat research team recently came across multiple document samples that download Revenge RAT. The campaign\ncurrently seems to be active in Brazil. All of the malware samples we received have the same properties. One of the samples we\nreceived has the name “Rooming List Reservas para 3 Familias.docx” (SHA-256:\n91611ac2268d9bf7b7cb2e71976c630f6b4bfdbb68774420bf01fd1493ed28c7). The document has only a few detections in\nVirusTotal.\n\n\n-----\n\n_Figure 1: VirusTotal detections for the document. (Image via VirusTotal.)_\n\nUpon opening the document, a series of events happen that lead to the download of Revenge RAT malware hosted on a\nBrazilian website (hxxp://azulviagens[.]online). Azul Viagens is a legitimate hotel chain in Brazil and the official website of the\nhotel is https://www.azulviagens.com.br/. Attackers registered the fake domain name and used a room reservation document\nfile to infect the end user. The attack is multi-stage with the components used in the attack spread across multiple files on the\nattacker’s server. The WHOIS records for hxxp://azulviagens[.]online seems to have been registered on December 10, 2020\n[with the email ID mmpereiramm30@gmail.com.](mailto:mmpereiramm30@gmail.com.)\n\n## The attack flow\n\nThe components of the attack span multiple stages. Figure 2 (below) shows the steps involved in the attack.\n\n\n-----\n\n_Figure 2: The attack flow._\n\n**Step 1: The DOCX file (“Rooming List Reservas para 3 Familias.docx”) used in the attack vector downloads the “1.docx”**\n(template) from the CnC server\n\n**Steps 2 and 3: The embedded “Microsoft_Excel_Macro-Enabled_Worsksheet1.xlsm” file in \"1.docx\" (template) downloads**\nthe PowerShell code “A.txt” from the CnC server and executes it in memory.\n\n**Step 4: The PowerShell code in “A.txt” downloads “index.mp3” from the CnC server and saves it as “index.vbs.”**\n\n\n-----\n\n**Step 5: Upon execution, “index.vbs” creates “opera.vbs,” which contains code to execute “opera.ps1” created in the next step.**\n\n**Step 6: “index.vbs” downloads “1.txt” and saves it as “opera.ps1,” which has obfuscated Revenge RAT in it.**\n\n**Step 7: “opera.vbs” executes “opera.ps1.”**\n\nA detailed analysis of files used during various stages of the attack is provided below.\n\n### The initial document\n\nThe initial document, “Rooming List Reservas para 3 Familias.docx,” used as the attack vector is a DOCX file. The document\nuses a technique known as Dynamic Office Template Injection to bypass security products. This allows the attacker to store the\nmalicious file on a remote server. This technique can evade anti-malware solutions that rely on static detection.\n\nThe document has the structure shown in Figure 3 (below). The structure contains a file named “footer.xml.rels.” The “target”\nfields in the file point to the templates hosted on the CnC server. There are several URLs in the “target” fields that point to files\n“1.docx” all the way to “9.docx” hosted on the CnC server. Each of the files has the same content (the same SHA-256:\n338b2d8d76f4028bfbd177127371b2509971606553d606c534316dc40cfa8fb9).\n\n\n-----\n\n_[Figure 3: Structure of the DOCX and footer.xml.res pointing to the malicious template. (Click to see larger version.)](https://f.hubspotusercontent00.net/hubfs/2617658/figure3-crop.png)_\n\nWhen the victim opens the document, one of the templates is downloaded and executed.\n\n### The template file\n\n\n-----\n\nThe template file(\"1.docx\" ... \"9x.docx\") follows the structure shown in Figure 4 (below). The settings.xml in the structure have\nthe “target” fields that point to XLSM files, which are present in the “embeddings'' directory in the structure of the DOCX file.\nThe XLSM files “Microsoft_Excel_Macro-Enabled_Worksheet.xlsm” to “Microsoft_Excel_Macro-Enabled_Worksheet9.xlsm”\nhave the same contents (same SHA-256: 32f1a502126b1932e1def04b98d8be235c8d25ef7268f8cb35d460cd073a88b2). When\nthe template file (\"1.docx\" ... \"9x.docx\") is executed by Microsoft Word, it executes one of the XLSM files\n(“Microsoft_Excel_Macro-Enabled_Worksheet.xlsm” to “Microsoft_Excel_Macro-Enabled_Worksheet9.xlsm”).\n\n_[Figure 4: XLSM files inside the 1.docx template. (Click to see larger version.)](https://f.hubspotusercontent00.net/hubfs/2617658/figure4-crop.png)_\n\n\n-----\n\n### The XLSM file\n\nThe XLSM file follows the structure shown in Figure 5 (below). The structure contains macros in the “VBAProject.bin” file. The\nfollowing screenshot shows the stream containing the macros.\n\n\n-----\n\n-----\n\n_Figure 5: Macros in XLSM._\n\nThere are two important macros present in the BIN file: “Macro 1” kills the Microsoft Word process “winword.exe” and “Macro\n2” downloads and executes the PowerShell code present at the URL\n“hxxp://azulviagens[.]online/A.txt” in memory.\n\nFigure 6 (below) shows the contents of “A.txt.”\n\n_Figure 6: PowerShell script in hxxp://azulviagens[.]online/A.txt._\n\nWhen the PowerShell code in “A.txt” is executed, it downloads the contents of “index.mp3” and saves it to file the “index.vbs”\nand executes it.\n\n### Index.vbs\n\nFigure 7 (below) shows the code in “index.vbs.” When “index.vbs” is executed it creates another two files, “opera.vbs” and\n“opera.ps1” in the “C:\\Users\\Public\\” directory. “Index.vbs” downloads the contents of hxxp://azulviagens[.]online/1.txt and\nsaves it to “opera.ps1.” The “index.vbs” file places the following command in “opera.vbs”:\n```\nl.exe -nologo -ExecutionPolicy Unrestricted -File C:\\Users\\Public\\Opera.ps1\n\n```\n\n-----\n\nThe command is then executed. When executed, “opera.vbs” executes the file “opera.ps1.\"\n\n_[Figure 7: Code in index.mp3 (index.vbs). (Click to see larger version.)](https://f.hubspotusercontent00.net/hubfs/2617658/figure7-lg.png)_\n\n### Opera.ps1\n\n“Opera.ps1” is a highly obfuscated PowerShell script (see Figure 8, below). One thing that catches our eye is the string “4D 5A,”\nwhich indicates the magic header of a Windows executable.\n\n\n-----\n\n_Figure 8: 4D5A in opera.ps1._\n\nAfter de-obfuscating the PowerShell code, we were able to retrieve the Windows executable, which is the Revenge RAT. Below\nis the description of the Revenge RAT we extracted.\n\nSimilar PowerShell code was also found hosted on x-root.net, which has also been registered in recent months. Uptycs’ EDR\ncapabilities can decode the obfuscated PowerShell code, as shown in the screenshot below (Figure 9).\n\n_[Figure 9: Deobfuscated PowerShell code. (Click to see larger version.)](https://f.hubspotusercontent00.net/hubfs/2617658/figure9.png)_\n\n## The Revenge RAT\n\n\n-----\n\nRevenge RAT was first seen mid-2016. The RAT has been coded in .NET. The Revenge RAT we extracted is not a packed binary\nand code is clearly visible. Below is a description of the various classes and methods present in the decompiled code.\n\n### Program\n\nThe “Program” class shown in Figure 10 (below) contains the main function of the program. The `main() function creates a`\nmutex and then executes the rest of the code.\n\n\n-----\n\n_[Figure 10: Program class. (Click to see larger version.)](https://f.hubspotusercontent00.net/hubfs/2617658/figure10.png)_\n\n### RAT configuration\n\nFigure 11 (below) contains the configuration for the RAT, which is used during execution.\n\n\n-----\n\n_Figure 11: RAT configuration._\n\nBelow are some members of the config class and their functionality:\n```\n   host : CnC server\n   port : CnC port\n   id : Unique identity of the installed RAT on the victim machine\n   currentMutex : Mutex placed by the RAT on the system\n   stopwatch() : This is a member function that can be use to reset the stopwatch\n\n### IdGenerator\n\n```\nThe class IdGenerator shown in Figure 12 (below) is used for creating a unique ID for the victim machine, which the RAT is\ngoing to send to the CnC server. A unique string ID is generated by retrieving various system attributes using the methods in\nthe class. Below are some of the methods:\n```\n   GetActiveWindow : Get active window or window of the application used by the user\n   GetAV : Get the antiviruses installed on the system\n   GetCamera : Get information about the camera\n   GetCpu : Get CPU information\n   GetHardDiskSerialNumber : Get hard disk serial number\n   GetIp : Get IP address\n\n```\n\n-----\n\n```\nGetSystem : Get processor information\nSendInfo : Concatenate information collected by previous methods into a string “id”\n\n```\n\n-----\n\n_[Figure 12: Components of the IdGenerator class. (Click to see larger version.)](https://f.hubspotusercontent00.net/hubfs/2617658/figure12-lg.png)_\n\n### Client\n\nThe client class implements the network client of the RAT. It has the following methods:\n```\n   Ping : Pings the CnC server\n   TCPReceive : Received data to the server\n   TCPSend : Send data to the server\n\n### Handler\n\n```\nThe `Handler class shown in Figure 13 (below) is used to process the CnC command received from the attacker.`\n\n\n-----\n\n_[Figure 13: CnC commands. (Click to see larger version.)](https://f.hubspotusercontent00.net/hubfs/2617658/figure13-lg.png)_\n\nBelow is the list of commands:\n```\n   PNC : Reset the stopwatch\n   P : Send the active windows to the CnC\n   IE : Check for installed plugins\n   LP : Invoke plugin\n\n```\n\n-----\n\n```\n   UNV : ninstall, restart the RAT\n\n```\nVariants of Revenge RAT are known to have many other capabilities as listed below:\n\nScreen capture\nKeylogging\nVideo capture\nCredential dumping\nAudio capture\n\n## Uptycs EDR detections\n\nThe following images show Uptycs EDR detection for the threat.\n\n\n-----\n\n_[Figure 14: Uptycs EDR detections. (Click to see larger version.)](https://f.hubspotusercontent00.net/hubfs/2617658/figure14.png)_\n\n_[Figure 15: Process graph in Uptycs EDR. (Click to see larger version.)](https://f.hubspotusercontent00.net/hubfs/2617658/figure15.png)_\n\n\n-----\n\n_[Figure 16: Process graph continued. (Click to see larger version.)](https://f.hubspotusercontent00.net/hubfs/2617658/figure16.png)_\n\n## Indicators of compromise\n\nBelow is the list of IOCs seen in the Revenge RAT attack.\n\n### Hashes\n\n**Initial attack document**\n\n91611ac2268d9bf7b7cb2e71976c630f6b4bfdbb68774420bf01fd1493ed28c7\n\n\n-----\n\n**Initial attack document**\n77d6651de47bff4c24fc26fa018ea648b0e14e276e8240fae6b1724b8638c46a\n\n**1.docx(template)**\n338b2d8d76f4028bfbd177127371b2509971606553d606c534316dc40cfa8fb9\n\n**Microsoft_Excel_Macro-Enabled_Worksheet.xlsm**\n32f1a502126b1932e1def04b98d8be235c8d25ef7268f8cb35d460cd073a88b2\n\n**A.txt**\n4b65e5785692950f8100b22f2827d65ba93e99dd717eb444af035e96fcd84763\n\n**opera.ps1**\n03f5ff9b6a6b24f76799cc15fe3f1fbf1ca9d6dda30a4154125ed5dd5834290c\n\n**Revenge RAT**\n73f113a6146224c4a1f92f89055922a28322787c108e30000a0a420fa46ed9e2\n\n### URLs\n\nhxxp://azulviagens[.]online\n\nCdtpitbull[.]hopto[.]org\n\n## YARA Rule\n\n\n-----\n\n```\nrule upt_Revenge_RAT {\n     meta:\n          description=\"Revenge-RAT\"\n          sha256=\"73f113a6146224c4a1f92f89055922a28322787c108e30000a0a420fa46ed9e2\"\n          author = \"abhijit mohanta\"\n          date = \"20 Dec 2020\"\n     strings:\n          $upt_Revenge_RAT0 = \"Revenge-RAT\" ascii wide nocase\n          $upt_Revenge_RAT1 = \"mscoree.dll\" ascii wide nocase\n          $upt_Revenge_RAT2 = \"REVEGERRRRR.exe\" ascii wide nocase\n          $upt_Revenge_RAT3 = \"keepAlivePing!\" ascii wide nocase\n          $upt_Revenge_RAT4 = \"AntiVirusProduct\" ascii wide nocase\n          $upt_Revenge_RAT5 = \"FirewallProduct\" ascii wide nocase\n     condition:\n          all of ($upt_Revenge_RAT*)\n}\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2020/2020.12.29.Revenge_RAT/Revenge%20RAT%20targeting%20users%20in%20South%20America.pdf"
    ],
    "report_names": [
        "Revenge RAT targeting users in South America"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716498,
    "ts_updated_at": 1743041321,
    "ts_creation_date": 1609302511,
    "ts_modification_date": 1609302511,
    "files": {
        "pdf": "https://archive.orkl.eu/c16375fdd9f0f4b81b76df0c4f0d09967d040ab7.pdf",
        "text": "https://archive.orkl.eu/c16375fdd9f0f4b81b76df0c4f0d09967d040ab7.txt",
        "img": "https://archive.orkl.eu/c16375fdd9f0f4b81b76df0c4f0d09967d040ab7.jpg"
    }
}