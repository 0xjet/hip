{
    "id": "7ce8fb4e-6750-46cf-9a66-147abc8cd6ae",
    "created_at": "2023-01-12T15:04:25.531301Z",
    "updated_at": "2025-03-27T02:05:25.128945Z",
    "deleted_at": null,
    "sha1_hash": "7f82ac974cf8151c9b0428beefdbe08d78016228",
    "title": "2020-04-16 - PoetRAT- Python RAT uses COVID-19 lures to target Azerbaijan public and private sectors",
    "authors": "",
    "file_creation_date": "2022-05-28T15:56:16Z",
    "file_modification_date": "2022-05-28T15:56:16Z",
    "file_size": 1423818,
    "plain_text": "# PoetRAT: Python RAT uses COVID-19 lures to target Azerbaijan public and private sectors\n\n**[blog.talosintelligence.com/2020/04/poetrat-covid-19-lures.html](https://blog.talosintelligence.com/2020/04/poetrat-covid-19-lures.html)**\n\nBy [Warren Mercer,](https://twitter.com/SecurityBeard/) [Paul Rascagneres and](https://twitter.com/r00tbsd?lang%3Den) [Vitor Ventura.](https://twitter.com/_vventura)\n\n## News summary\n\nAzerbaijan government and energy sector likely targeted by an unknown actor.\n\n\n-----\n\nFrom the energy sector, the actor demonstrates interest in SCADA systems related to\nwind turbines.\n\nThe actor uses Word documents to drop malware that allows remote control over the\nvictims.\nThe new remote access trojan, dubbed PoetRAT, is written in Python and is split into\nmultiple parts.\nThe actor collects files, passwords and even images from the webcam, using other\ntools that it deploys as needed.\n\n## Executive summary\n\nCisco Talos has discovered a new malware campaign based on a previously unknown family\nwe're calling \"PoetRAT.\" At this time, we do not believe this attack is associated with an\nalready known threat actor. Our research shows the malware was distributed using URLs\nthat mimic some Azerbaijan government domains, thus we believe the adversaries in this\ncase want to target citizens of the country Azerbaijan, including private companies in the\nSCADA sector like wind turbine systems. The droppers are Microsoft Word documents that\ndeploy a Python-based remote access trojan (RAT). We named this malware PoetRAT due\nto the various references to William Shakespeare, an English poet and playwright. The RAT\nhas all the standard features of this kind of malware, providing full control of the\ncompromised system to the operation. For exfiltration, it uses FTP, which denotes an\nintention to transfer large amounts of data.\n\nThe campaign shows us that the operators manually pushed additional tools when they\nneeded them on the compromised systems. We will describe a couple of these tools. The\nmost interesting is a tool used to monitor the hard disk and exfiltrate data automatically.\nBesides these, there are keyloggers, browser-focused password stealers, camera control\napplications, and other generic password stealers.\n\nIn addition to the malware campaigns, the attacker performed phishing a campaign on the\nsame infrastructure. This phishing website mimics the webmail of the Azerbaijan\nGovernment webmail infrastructure.\n\n### What's new?\n\nThis was a previously undiscovered RAT. It uses two components to avoid detection by a\nsingle component. The dropper uses an old trick in a new way: It appends the RAT to a Word\ndocument. Upon opening the document, a macro is executed that will extract the malware\nand execute it. The operation seems to be manual, but it's streamlined to deploy additional\ntools as needed and to avoid unnecessary steps.\n\n\n-----\n\n### How did it work?\n\nThe initial foothold is established by sending the malicious Word document. It's not clear at\nthis time how the adversary distributes the document. However, given that it is available for\ndownload from a basic URL, it wouldn't be surprising if the victims were being tricked into\ndownloading it by an email or social media network message.\n\n### So what?\n\nThis threat actor is highly motivated and focused on the victims it targets. They target the\npublic and the private sectors as well as SCADA systems. The quantity and diversification of\ntools available in its toolkit denote a carefully planned attack.\n\n## Malware campaigns\n\nWe identified multiple campaigns we believe target the Azerbaijan public and private sectors,\nespecially the energy sector. During our investigation, Talos identified the interest of this\nthreat actor for SCADA systems — mainly wind turbines.\n\n### Campaign No. 1: February 2020\n\n\n-----\n\nDecoy document\n\nOnce opened in Microsoft Office, the document is blurred. This can't be fixed — the\ndocument is composed of blurred pictures with no real text. The logo seems to be the logo of\nthe DRDO, the Defense R&G Organisation of the Ministry of Defence of India. We have no\nevidence that India is targeted by this actor.\n\n\n-----\n\nDRDO Logo\n\nThe file was located on hxxp://govaz[.]herokuapp[.]com/content/section_policies.docx\n\n### Campaign No. 2: April 2020 — C19.docx\n\n\n-----\n\nDocument image\n\nThe file, in this case, was named \"C19.docx,\" probably a reference to the COVID-19\npandemic, but without readable content.\n\n### Campaign #3: April 2020 — Coronavirus theme\n\nThe decoy document evolved to look more realistic. The initial stage is a Word document\nwritten in Russian posing as an Azerbaijan government document.\n\n\n-----\n\nDocument image\n\n\n-----\n\nDocument image\n\nBoth original file names are \"Azerbaijan_special[.]doc,\" which is a dropper that can be found\nat hxxps://gov-az[.]herokuapp[.]com/content/Azerbaijan_special[.]doc.\n\n## Phishing campaign\n\nOn the same server, we identified a phishing campaign against the webmail of the\nAzerbaijan government:\n\n\n-----\n\nThis phishing website was available on \"hxxps://gov-az[.]herokuapp[.]com/azGovaz.php?\nlogin=\" during the malware campaigns. The purpose was obviously to steal credentials.\n\n## Malware\n\nWe will present the infection vector of the most recent document. The other documents are\nnot exactly the same (using DDE) but the final goal is the same.\n\n### Dropper\n\nThe Word document is a dropper. As happens so many times, it contains a Visual Basic\nscript that will execute the malicious activities. This one, however, appears to be more\ninnovative. It starts by loading its own document into memory. Afterward, it copies 7,074,638\nbytes from the end of the file and writes the remaining bytes back to the disk.\n\nRAT extraction\n\n\n-----\n\nThe file written to the disk is actually a ZIP file. The actors appended the ZIP at the end of\nthe word document \"smile.zip.\"\n\nThis ZIP file contains a Python interpreter and Python script that is actually the RAT. The\nWord macro will unzip and execute the main script called \"launcher.py.\" The launcher script\nis responsible for checking the environment that the doc is currently being opened in. It\nassumes that all sandboxes will have hard drives smaller than 62GB. If it's in a sandbox\nenvironment, it will overwrite the malware scripts with the contents of the file \"License.txt\"\nand exit, thus deleting itself.\n\nAnti-sandbox code\n\nIf it determines that it is not running in a sandbox environment, it will generate a unique ID,\nthat is then replaced directly with the Python source code of the main scripts before\nexecuting it.\n\n### RAT\n\nThe RAT is composed of two main scripts that need to work together. One, called \"frown.py,\"\nis responsible for the communications with the command and control (C2). It uses TLS to\nencrypt the communication that occurs on port 143. With a successful connection, it will send\nthe word \"almond\" The server should reply either with \"who\" or \"ice.\" The RAT will answer\nthe \"who\" command with a string that contains the username, computer name and the\npreviously generated UUID. The \"ice\" command simply makes the RAT finish the connection\nprocedure.\n\nThe other script is called \"smile.py.\" This is responsible for the interpretation and execution of\nthe C2 commands. The available commands are:\n\nls - listing files\ncd - change current directory\nsysinfo - get information about the system\n\n\n-----\n\ndownload - upload file into the C2 using ftp\nupload - download from C2 file into the victim from\nshot - takes a screenshot and uploads it to the C2 using ftp\ncp - copies files\nmv - moves files\nlink - creates links between files\nregister - makes changes in the registry\nhide - hides a file or unhides it depending on its current state\ncompress - compresses files using zip function\njobs - performs actions, like kill, clear, terminate on processes. By default will list all\nprocesses.\n<os command to be executed> - this will be executed if none of the above are\nexecuted.\n\nSome features need additional credentials (shot, upload, download). These credentials are\nnot hardcoded on the sample. For each FTP usage, the credentials are provided by the C2\nserver during the request.\n\nThere is a normal usage of the Windows registry to provide a method of persistence for this\nRAT by adding in a registry key in the RUN hive which will execute the Python script\n\"launcher.py.\" During our investigation, we witnessed several registry modifications that\nresulted in the malware skipping the sandbox evasion checks and carrying out the execution\nby using a \"police\" keyword.\n\n\"C:\\Users\\Public\\Python37\\pythonw.exe\" \"C:\\Users\\Public\\Python37\\launcher.py\" \"police\"s\\0\n\nIn launcher.py, the police keyword will skip the sandbox checks and initialization process.\nThis could be used for hosts already infected to ensure they do not re-check this\nenvironment.\n\n\n-----\n\nStart routine\n\nThe communication between the scripts is done via a file called \"Abibliophobia23\"\nCommands and results are written into the file using a custom encryption scheme. The \"23\"\nat the end of the file is different depending on the variant of the RAT.\n\n\n-----\n\nObfuscation algorithm\n\nIt uses a char substitution cipher where the new char code is obtained after performing\nmathematical operations on the char code to be encrypted using the key parameters.\n\n## Post-exploitation tools\n\nDuring the campaign, the operator deployed additional tools on the targeted systems. In this\nsection, we will describe a few of these tools.\n\n### Dog\n\nQuickly after the initial compromise, the operator deploys a tool named \"dog.exe.\" This\n\n\n-----\n\nmalware is written in .NET and its purpose is to monitor hard drive paths and to exfiltrate the\ninformation via an email account or an FTP, depending on the configuration.\n\nThe configuration file is named dconf.json. It is pushed by the operator with the binary. Here\nis the format:\n```\n{\n\"FileSize\": 50,\n\"BasePath\": \"C:/ProgramData/\",\n\"MyPath\": \"TARGET_Dog/\",\n\"UploadType\": \"ftp\",\n\"FtpUsername\": \"username1\",\n\"FtpPassword\": \"password1\",\n\"FtpUri\": \"ftp://ftp.ftpserver/repo/\",\n\"SmtpHost\": \"smtp.servermail.com\",\n\"EmailUser\": \"username2@servermail.com\",\n\"EmailPass\": \"password2\",\n\"Paths\": \"C:/Users/User/Desktop/,C:/Users/User/Downloads/,C:/Users/User/Documents/\"\n}\n\n```\nFileSize defines the max size of the file to be exfiltrated (50MB in our example).\nThe working directory is defined by the concat of BasePath and MyPat\n(\"C:/ProgramData/ TARGET_Dog/\" in our example).\nUploadType is the exfiltration method. It can be \"ftp\" or \"email.\"\nFtpUsername, FtpPassword and FtpUri define the FTP parameters for exfiltration.\nSmtpHost, EmailUser and EmailPass define the email parameters for exfiltration.\nPaths define the path to monitor on the compromised system.\n\nThe binary uses a file system watcher in order to generate an event each time a file is\nmodified in one of the directories in the \"Paths\" variable of the configuration file.\n\nFilesystem monitoring routine\n\nOnce a file is available, the Dog.exe binary exfiltrates it, using email or FTP depending on\n\n\n-----\n\nthe configuration.\n\n### Bewmac\n\nThe attacker has a short Python script to record the victim's webcam.\n\nCamera image capturing routine.\n\nThe script uses the OpenCV library, taking a sequence of 10 captures each time it is\nexecuted. The images are stored on the filesystem and there is no automatic exfiltration.\n\n### Additional tools\n\nDuring our investigation, we identified a couple of additional tools mainly in Python and\ncompiled for Windows:\n\nKlog.exe: A keylogger using an output file called \"System32.Log.\"\n\n\n-----\n\nKeylogger special key map\n\n\"Browdec.exe\": A browser credential-stealer\n\"voStro.exe\": A compiled pypykatz that'ss a full Python implementation of Mimikatz, a\nwell-known credential-stealer.\n\"Tre.py\": A script used to create the file with the files/directories tree.\nWinPwnage: An open-source framework of privilege escalation.\nNmap: An open-source pentesting and network-scanning tool.\n\n## Conclusion\n\nDuring this investigation, we observed an actor using multiple tools and methodologies to\ncarry out their full attack chain Talos identified multiple lure documents during this campaign\n\n\n-----\n\nwhich all made use of Visual Basic macros and then Python to carry out their attacks on\nvictims. The adversaries' targets are very specific and appear to be mostly Azerbaijan\norganizations in the public and private sectors, specifically ICS and SCADA systems in the\nenergy industry.\n\nThe actor monitored specific directories, signaling they wanted to exfiltrate certain\ninformation on the victims. The attacker wanted to gain a full picture of the victim by using a\nkeylogger, browser credential stealers and Mimikatz and pypykatz for further credential\nharvesting. Based on our research, the adversaries may have wanted to obtain important\ncredentials from officials in Azerbaijan's government. The malware attempts to obtain\npictures of the victim and utilizes a mail platform targeting the Azerbaijan government. The\nattacker wanted not only specific information obtained from the victims but also a full cache\nof information relating to their victim. They would have been able to gain potentially very\nimportant credentials and information using these techniques given their victimology. By\nusing Python and other Python-based tools during their campaign, the actor may have\navoided detection by traditional tools that have whitelisted Python and Python execution\ntechniques.\n\n## Coverage\n\nWays our customers can detect and block this threat are listed below.\n\n[Advanced Malware Protection (AMP) is ideally suited to prevent the execution of the](https://www.cisco.com/c/en/us/products/security/advanced-malware-protection)\nmalware used by these threat actors. Exploit Prevention present within AMP is designed to\nprotect customers from unknown attacks such as this automatically.\n\n\n-----\n\n[Cisco Cloud Web Security (CWS) or Web Security Appliance (WSA) web scanning prevents](https://www.cisco.com/c/en/us/products/security/cloud-web-security/index.html)\naccess to malicious websites and detects malware used in these attacks.\n\n[Email Security can block malicious emails sent by threat actors as part of their campaign.](https://www.cisco.com/c/en/us/products/security/email-security-appliance/index.html)\n\n[Network Security appliances such as Next-Generation Firewall (NGFW), Next-Generation](https://www.cisco.com/c/en/us/products/security/firewalls/index.html)\n[Intrusion Prevention System (NGIPS), Cisco ISR, and Meraki MX can detect malicious](https://www.cisco.com/c/en/us/products/security/intrusion-prevention-system-ips/index.html)\nactivity associated with this threat as sids 53689-53691.\n\n[AMP Threat Grid helps identify malicious binaries and build protection into all Cisco Security](https://www.cisco.com/c/en/us/solutions/enterprise-networks/amp-threat-grid/index.html)\nproducts.\n\n[Umbrella, our secure internet gateway (SIG), blocks users from connecting to malicious](https://umbrella.cisco.com/)\ndomains, IPs, and URLs, whether users are on or off the corporate network.\n\nOpen Source Snort Subscriber Rule Set customers can stay up to date by downloading the\n[latest rule pack available for purchase on Snort.org.](https://www.snort.org/products)\n\n## IOCs\n\n### OSQuery\n\nCisco AMP users can use Orbital Advanced Search to run complex OSqueries to see if their\nendpoints are infected with this specific threat.\n\nFor specific OSqueries on this threat, click below:\n[PoetRAT filepath](https://github.com/Cisco-Talos/osquery_queries/blob/master/win_malware/malware_poetrat_filepath.json)\n\n[PoetRAT registry](https://github.com/Cisco-Talos/osquery_queries/blob/master/win_malware/malware_poetrat_registry.json)\n\n### Hosts\n\nC2 \ndellgenius[.]hopto[.]org\n\nPhishing\n\ngov-az[.]herokuapp[.]com\n\ngovaz[.]herokuapp[.]com\n\nUrls\n\nhxxps://gov-az[.]herokuapp[.]com/azGovaz.php?login=\n\nSamples\n\n\n-----\n\n208ec23c233580dbfc53aad5655845f7152ada56dd6a5c780d54e84a9d227407\n252c5d491747a42175c7c57ccc5965e3a7b83eb5f964776ef108539b0a29b2ee\n312f54943ebfd68e927e9aa95a98ca6f2d3572bf99da6b448c5144864824c04d\n31c327a3be44e427ae062c600a3f64dd9125f67d997715b63df8d6effd609eb3\n37118c097b7dbc64fa6ac5c7b28ebac542a72e926d83564732f04aaa7a93c5e3\n4eb83253e8e50cd38e586af4c7f7db3c4aaddf78fb7b4c563a32b1ad4b5c677c\n5f1c268826ec0dd0aca8c89ab63a8a1de0b4e810ded96cdee4b28108f3476ce7\n66679d83d3993ae79229b1ccff5350e083d6631190eeeb3207fa10c3e572ca75\n746fbdee1867b5531f2367035780bd615796ebbe4c9043134918d8f9240f98b9\n970793967ecbe58d8a6b54f5ec5fd2551ce922cb6b3584f501063e5f45bdd58a\na3405cc1fcc6b6b96a1d6604f587aee6aafe54f8beba5dcbaa7322ac8589ffde\na703dc8819dca1bc5774de3b6151c355606e7fe93c760b56bc09bcb6f928ba2d\nac4e621cc5895f63a226f8ef183fe69e1ae631e12a5dbef97dd16a6dfafd1bfc\nb14a8bf8575e46b5356acf3d19667278002935b21b7fc9f62e0957cc1e25209d\nb1e7dc16e24ebeb60bc6753c54e940c3e7664e9fcb130bd663129ecdb5818fcd\nca8492139c556eac6710fe73ba31b53302505a8cc57338e4d2146bdfa8f69bdb\nd4b7e4870795e6f593c9b3143e2ba083cf12ac0c79d2dd64b869278b0247c247\nd5d7fad5b745fa04f7f42f61a1db376f9587426c88ce276f06de8ea6889dfae8\nd605a01e42d5bb6bca781b7ba32618e2f2870a4624b50d6e3d895e8e96adee6a\nF842354198cfc0a3296f8d3c6b38389761674f1636129836954f50c2a7aab740\ne4e99dc07fae55f2fa8884c586f8006774fe0f16232bd4e13660a8610b1850a2\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-04-16 - PoetRAT- Python RAT uses COVID-19 lures to target Azerbaijan public and private sectors.pdf"
    ],
    "report_names": [
        "2020-04-16 - PoetRAT- Python RAT uses COVID-19 lures to target Azerbaijan public and private sectors.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535865,
    "ts_updated_at": 1743041125,
    "ts_creation_date": 1653753376,
    "ts_modification_date": 1653753376,
    "files": {
        "pdf": "https://archive.orkl.eu/7f82ac974cf8151c9b0428beefdbe08d78016228.pdf",
        "text": "https://archive.orkl.eu/7f82ac974cf8151c9b0428beefdbe08d78016228.txt",
        "img": "https://archive.orkl.eu/7f82ac974cf8151c9b0428beefdbe08d78016228.jpg"
    }
}