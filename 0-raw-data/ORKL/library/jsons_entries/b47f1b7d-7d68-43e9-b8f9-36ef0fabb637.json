{
    "id": "b47f1b7d-7d68-43e9-b8f9-36ef0fabb637",
    "created_at": "2022-10-25T16:48:21.19062Z",
    "updated_at": "2025-03-27T02:05:28.54771Z",
    "deleted_at": null,
    "sha1_hash": "f90b1a23783a7f4a51db8a73788beeebe70108ad",
    "title": "Protect Against BlackMatter Ransomware Before It’s Offered",
    "authors": "",
    "file_creation_date": "2021-08-03T16:30:32Z",
    "file_modification_date": "2021-08-03T16:32:25Z",
    "file_size": 1670396,
    "plain_text": "#### MALWARE/\n\n TOOLS\n\n PROFILE\n\n## By Insikt Group®\n\nAugust 4, 2021\n\n# Protect Against  BlackMatter Ransomware\n\n\n-----\n\n_Figure 1: Public extortion blog (Source: BlackMatter Ransomware)_\n\n_Insikt Group reverse-engineered the Linux and Windows variants_\n_of BlackMatter ransomware and provided a high-level overview of the_\n_functionality in addition to IOCs, utilities, and detections. The intended_\n_audience of this research is threat intelligence professionals and those_\n_interested in a technical overview of the new ransomware variant._\n\n##### Executive Summary\n\nInsikt Group analyzed Windows and Linux variants\nof BlackMatter ransomware, a new ransomware-asa-service (RaaS) affiliate program founded in July\n2021. During our technical analysis, we found that\nboth variants accomplish similar goals of encrypting\na victim’s files and appear to have been developed by\na relatively sophisticated group. The Windows version\nof the ransomware employs several obfuscation and\nanti-reverse engineering techniques, suggesting that it\nwas created by an experienced ransomware developer.\nBlackMatter’s Linux variant is another example of an\nemerging trend of malware targeting Linux-based\nsystems, including ESXi and network-attached storage\n(NAS) devices. Recorded Future has provided reverseengineering utilities, a YARA rule, and IOCs that\norganizations can use to hunt or detect the ransomware.\n\n\n##### Background\n\nBlackMatter is a new ransomware-as-service (RaaS)\naffiliate program that was founded in July 2021. According to\nBlackMatter, “The project has incorporated in itself the best\nfeatures of DarkSide, REvil, and LockBit”.\n\nAccording to their public blog, as shown in Figure 1 below,\nthe threat actor group does not conduct attacks against\norganizations in several industries, including healthcare, critical\ninfrastructure, oil and gas, defense, non-profit, and government.\n\n##### Technical Analysis\n\nInsikt Group analyzed the Windows and Linux executable\nversions of BlackMatter ransomware. Unlike some less\nsophisticated ransomware variants, the Windows version of\nBlackMatter employs anti-VM techniques as well as import\nand string obfuscation, while the Linux version obfuscates\nconfiguration information. At a high level, both the Linux and\nWindows variants have approximately the same functionality,\nwith differences in implementation based on their respective\noperating system targets.\n\n\n-----\n\n###### Windows Ransomware Variant\n\nAccording to the threat actor’s advertisement, the Windows\nransomware variant was successfully tested on Windows Server\n2003 through 2021, Windows 7 and newer, and is available in\nexecutable form, Reflective DLL and PowerShell. Insikt Group’s\nanalysis focused primarily on the Windows executable version,\nwhich purports to be “version 1.2”.\n\nThe ransomware is designed to make reverse engineering\nmore challenging by obfuscating 3 values: imported function\ncalls, strings used by the ransomware, and configuration\ninformation essential to the encryption process.\n\nAlthough the import obfuscation technique (shown on the\nleft in Figure 2 below) is somewhat simple, the technique makes\nit difficult for a reverse engineer to directly view which library\nfunctions are being called at what point. Instead of directly calling\nthe exported function from the DLL, which would make the call\ntarget plainly visible (see Figure 2, right), the ransomware calls\ncode at an address (top, left), that XORs two values together to\ncompute the address of the cal (bottom, left)l: one that depends\non the function it wishes to call, and the other is 0x22065fed.\n\nSimilarly, the string obfuscation technique is also XOR-based\nand uses a rolling XOR seed over 4-byte chunks of the encrypted\ntext, as seen in Figure 3 below. For configuration data, including\nthe C2 information and the list of services the ransomware looks\nto stop, a second deobfuscation routine is performed, followed\nby a base64-decode of the data.\n\n_Figure 2: Top: Import obfuscation technique employed by BlackMatter ransomware using XOR with_\n_0x22065FED to calculate function address._\n_Bottom: typical function call from other malware. (Source: Recorded Future)_\n\n\n_Figure 3: String deobfuscation algorithm for BlackMatter (Source: Recorded Future)_\n\nOutside of these obfuscation techniques, the ransomware\ngoes through the following steps during execution:\n\n  - First, the malware sets up the function pointers in\n\nmemory for each of the DLLs. During the process, it\nchecks whether the memory allocated has been filled\nin with 0xABABABAB, an indication the HEAP_TAIL_\nCHECKING_ENABLED flag is set indicating a debugger\nis in use, which is likely being used as an anti-debug\n[technique.](http://virusbulletin.com/virusbulletin/2010/05/anti-unpacker-tricks-part-eight)\n\n  - Then, it obtains the MachineGUID from the SOFTWARE\\\\\n\nMicrosoft\\\\Cryptography registry key and Base64encodes it. It uses this value as a unique identifier\nfor the ransomware, prepending it to the README.txt\nransom note filename as seen in Figures 5 and 6. The\nMachineGUID value is also used to create a mutex, and\nthe MD4 of this value is appended to Global\\<MD4\nvalue>.\n\n  - The ransomware decodes the configuration information\n\nusing the string deobfuscation technique described\nabove. In the configuration data, the malware stores a\nlist of services and processes to stop and command and\ncontrol domains. Identifying processes and services to\nstop is fairly typical of ransomware as these processes\nand services may make it easier for a defender to recover\nfiles or interfere with the encryption process.\n\n  - Next, based on the command line arguments provided\n\nto the ransomware, it will execute a different subset\nof functionality. By default, the ransomware has the\nfollowing behavior:\n\n\n-----\n\n- Collect and send victim information to the C2,\n\nincluding the computer’s hostname, the username\nof the victim and other information about the\naffected system. An example of this data and the\nformat it is contained in is below in Figure 4. A\nWireshark capture of the traffic is contained in\nFigure 7.\n\n- Optionally stops any running processes or\n\nservices, as described above. The sample\nanalyzed by Insikt Group looked for the following\nprocesses and services to stop, according to its\nconfiguration information.\n\n   - Processes: encsvc, thebat, mydesktopqos,\n\nxfssvccon, firefox, infopath, winword,\nsteam, synctime, notepad, ocomm, onenote,\nmspub, thunderbird, agntsvc, sql, excel,\npowerpnt, outlook, wordpad, dbeng50,\nisqlplussvc, sqbcoreservice, oracle,\nocautoupds, dbsnmp, msaccess, tbirdconfig,\nocssd, mydesktopservice, and visio\n\n   - Services: mepocs, memtas, veeam, svc$,\n\nbackup, sql, vss\n\n- Optionally encrypts logical drives and network\n\nshares attached to the victim system\n\n- Encrypts the files on the local machine\n\n- Sends back statistics on the encryption results,\n\nincluding execution time, start time, stop time, and\nthe number of files encrypted to the C2\n\n- If the system booted in normal mode, it changes\n\nthe victim’s wallpaper and creates a ransom note,\nas seen in Figure 5 and Figure 6 below. If the\nsystem booted in a failsafe mode, the malware will\nexecute one of the following to turn off safe mode,\nbased on the version of Windows:\n\n   - bootcfg /raw /fastdetect /id 1\n\n   - bootcfg /raw /a /safeboot:network /id 1\n\n   - bcdedit /deletevalue {current} safeboot\n\n   - bcdedit /set {current} safeboot network\n\n\n_Figure 4: Data sent back to the C2 by BlackMatter ransomware (Source: Recorded Future)_\n\n\n-----\n\n_Figure 5: BlackMatter ransom note (Source: Recorded Future)_\n\n_Fi_ _6 Bl_ _kM_ _d_ _k_ _ll_ _(S_ _R_ _d d F_ _)_\n\n\n-----\n\n_Figure 7: Network traffic generated by Windows variant of BlackMatter ransomware (Source: Recorded Future)_\n\n\nCurrently, Insikt Group’s analysis of the similarity of\nBlackMatter to other Windows ransomware variants such as\nDarkSide is still ongoing.\n\n###### Linux Ransomware Variant\n\nInsikt Group analyzed the Linux variant of the BlackMatter\nransomware, purporting to be version 1.6.0.2, according to a\nsection in the binary named “.app.version”. The Linux version\nof the ransomware has several log messages, including those\nproviding the name of the function in which they are present, and\nit contains several ESXI-targeted functions, as seen in Figure 8\nbelow. This suggests that this may be an early version of the\nransomware, with these messages to be removed in subsequent\nversions. Overall, the Linux version performs semantically\nsimilarly to the Windows variant:\n\n  - Checks if another instance of itself is running by trying\n\nto get exclusive access to the file handle. If it cannot,\nanother instance is running, and the ransomware notes\nanother instance is currently running.\n\n  - Creates a daemon to run in the background and\n\ndetaches itself from the terminal instance used to run it,\nredirecting its standard input and standard output to /\ndev/null and changing its current working directory to\nthe root directory (/).\n\n\n\n- Initializes its configuration file data. Like the Windows\n\nversion, the Linux variant stores its configuration\ninformation in an obfuscated format to make it more\ndifficult to discern through static analysis of the file.\nConfiguration information is kept in a special ELF\nsection, “.cfgETD”, which is first base64 decoded, ZLIB\ndecompressed, then deobfuscated with a rolling 32-byte\nXOR contained at the beginning of the decompressed\nfile. The configuration file contains C2s for the\nransomware, processes and services to stop, and other\ninformation related to the execution of the ransomware.\n\n- The ransomware then executes its main functionality:\n\n    - First, it will optionally stop running vms, excluding\n\nthose on the “ignore list” in the configuration\nfile. In Insikt Group’s sample, these were VMware\nvCenter and VMware-VirtualSAN-Witness. It uses\nthe command: esxcli --formatter=csv --formatparam=fields==”WorldID,DisplayName” vm\nprocess list\n\n    - If kill-process is enabled in the configuration,\n\nthe ransomware will kill the specified processes;\nin Insikt Group’s sample, this was limited to\nvmsyslogd; this is the Syslog service running on\nVMWare.\n\n\n-----\n\n     - Stops the firewall using the command: esxcli\n\nnetwork firewall set --enabled false\n\n     - If message.enable is selected in the configuration\n\nfile, the malware will create a ransom note and\ndisplay it in /etc/motd or /etc/vmware/welcome.\nThe ransomware is also able to create a note\ncalled ReadMe.txt with the note contents.\n\n     - The ransomware starts the “web reporter”. The\n\nmalware collects and exfiltrates information\nabout the host machine such as the hostname,\noperating system, username, architecture and disk\ninformation. Later, the ransomware will also report\ninformation about the encryption process, such\nas execution time, start time, how many files were\nencrypted and bot version information.\n\n     - The ransomware then encrypts the victim’s files.\n\nThere are several configuration parameters related\nto encryption, including the mode (single or\nmultiple), encryption size (dark size), white size,\nand minimum size. The ransomware specifically\ntargets files with the extensions vmdk, vmem,\nvswp, and log per the configuration file.\n\n  - If “remove-self” is enabled in the configuration file, the\n\nransomware removes its executable.\n\n_Figure 8: Function names from Linux ransomware variant log messages (Source: Recorded Future)_\n\nUltimately, the Linux version of the ransomware has similar\nfunctionality to other ransomware variants made to target ESXI\nsystems, but an assessment of potential code overlap is ongoing.\n\n##### Mitigations\n\nInsikt Group has created a YARA rule to detect Linux and\nWindows variants of BlackMatter ransomware, which are in\nthe appendix of this report. Organizations can use this rule for\ndetection or hunting purposes. As the RaaS program grows, we\nwill likely see more information regarding initial access methods,\nlateral movement, and discovery tools used by affiliates of the\nprogram.\n\nUntil then, we recommend organizations employ defenses\nagainst common techniques associated with other sophisticated\nransomware groups, such as:\n\n\n\n- Maintain offline backups of your organization’s data and\n\nensure that these backups stay up to date to prevent\ndata loss in the event of a ransomware infection.\n\n- Network segmentation can halt the propagation of\n\nransomware through an organization’s network. This\nsolution involves splitting the larger network into\nsmaller network segments and can be accomplished\nthrough firewalls, virtual local area networks, and other\nseparation techniques.\n\n- If remote access solutions are crucial to daily operations,\n\nall such remote access services and protocols, such as\nCitrix and RDP, should be implemented with two-factor or\nmulti-factor authentication.\n\n- Cobalt Strike is frequently used by both criminal\n\nand state-sponsored threat actors, including many\nransomware operators, both to gain a network foothold\nand for lateral movement. Defenders should monitor for\nCobalt Strike C2 servers.\n\n- Monitor for the creation of suspicious file modification\n\nactivity, particularly large quantities of file modifications\nin user directories.\n\n- Consider keeping sensitive client information on\n\nsystems that are disconnected from the internet or\nsegmented from the rest of the corporate network. Since\nransomware will encrypt all files on a victim system\nand often will search for directories on the network (eg:\nnetworked file shares) to also encrypt, moving highly\nsensitive customer data to a system with no internet\naccess or access to the rest of the network will minimize\nthe access ransomware would have to those files.\n\n\n-----\n\n##### Outlook\n\nWe have seen a shift in calculus following recent high-profile\nransomware attacks. The administrators of two major Russianlanguage forums, Exploit and XSS, quickly banned ransomware\ntopics on their criminal underground platforms. DarkSide, REvil,\nand Avaddon ransomware families halted extortionist activities\nright before or days after the first meeting between President\nBiden and Putin. Ransomware operators reacted and created new\nransomware brands with a strict set of rules following what was\noutlined during that meeting. Moreover, BlackMatter operators\nare ostensibly required to review and vet every compromised\nnetwork before deploying ransomware to avoid unnecessary\nattention from the media and governments.\n\nThe Linux ransomware variant of BlackMatter falls in line with\nan emerging trend of ransomware threat actors moving towards\ntargeting ESXi systems in addition to the more traditional\nWindows. We expect that other threat actors will likely develop\nLinux variants of their ransomware in the future, and we may\nsee new variants emerge targeting just these types of systems.\n\nBlackMatter is suspected to be a successor to DarkSide,\nand Insikt Group’s technical analysis of these tools relative to\nother ransomware variants such as those published by DarkSide\nis ongoing.\n\n\n-----\n\n### Appendix — YARA Rule\n\n\n-----\n\nAbout Recorded Future\n\nRecorded Future is the world’s largest provider of intelligence for enterprise\n\nsecurity. By combining persistent and pervasive automated data collection and analytics\n\nwith human analysis, Recorded Future delivers intelligence that is timely, accurate,\n\nand actionable. In a world of ever-increasing chaos and uncertainty, Recorded Future\n\nempowers organizations with the visibility they need to identify and detect threats\n\nfaster; take proactive action to disrupt adversaries; and protect their people, systems,\n\nand assets, so business can be conducted with confidence. Recorded Future is trusted\n\nby more than 1,000 businesses and government organizations around the world.\n\nLearn more at recordedfuture.com and follow us on Twitter at @RecordedFuture.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        }
    ],
    "references": [
        "https://go.recordedfuture.com/hubfs/reports/MTP-2021-0804.pdf"
    ],
    "report_names": [
        "MTP-2021-0804.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716501,
    "ts_updated_at": 1743041128,
    "ts_creation_date": 1628008232,
    "ts_modification_date": 1628008345,
    "files": {
        "pdf": "https://archive.orkl.eu/f90b1a23783a7f4a51db8a73788beeebe70108ad.pdf",
        "text": "https://archive.orkl.eu/f90b1a23783a7f4a51db8a73788beeebe70108ad.txt",
        "img": "https://archive.orkl.eu/f90b1a23783a7f4a51db8a73788beeebe70108ad.jpg"
    }
}