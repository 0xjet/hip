{
    "id": "eaa6aec5-437e-4e91-832e-d7352b788d4b",
    "created_at": "2023-01-12T15:06:38.505669Z",
    "updated_at": "2025-03-27T02:14:05.942809Z",
    "deleted_at": null,
    "sha1_hash": "b5079ab7cbec11bc771a73a02f4bd42a492383e6",
    "title": "2021-08-12 - Vice Society Leverages PrintNightmare In Ransomware Attacks",
    "authors": "",
    "file_creation_date": "2022-05-27T21:58:35Z",
    "file_modification_date": "2022-05-27T21:58:35Z",
    "file_size": 1011252,
    "plain_text": "# Vice Society leverages PrintNightmare in ransomware attacks\n\n**[blog.talosintelligence.com/2021/08/vice-society-ransomware-printnightmare.html](https://blog.talosintelligence.com/2021/08/vice-society-ransomware-printnightmare.html)**\n\n## Executive Summary\n\n[Another threat actor is actively exploiting the so-called PrintNightmare vulnerability (CVE-](https://blog.talosintelligence.com/2021/07/printnightmare-coverage.html)\n2021-1675 / CVE-2021-34527) in Windows' print spooler service to spread laterally across a\n\n\n-----\n\nvictim s network as part of a recent ransomware attack, according to Cisco Talos Incident\nResponse research. While previous research found that other threat actors had been\n[exploiting this vulnerability, this appears to be new for the threat actor Vice Society.](https://www.bleepingcomputer.com/news/security/ransomware-gang-uses-printnightmare-to-breach-windows-servers/)\n\nTalos Incident Response's research demonstrates that multiple, distinct threat actors view\nthis vulnerability as attractive to use during their attacks and may indicate that this\nvulnerability will continue to see more widespread adoption and incorporation by various\nadversaries moving forward. For defenders, it is important to understand the attack lifecycle\nleading up to the deployment of ransomware. If users have not already, they should\n[download the latest patch for PrintNightmare from Microsoft.](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34527)\n\nIn this post, we'll analyze the various TTPs used in a recent ransomware attack from Vice\nSociety that leveraged this vulnerability. Many of these same TTPs are commonly observed\nin other ransomware attacks, such as a previously published analysis of a WastedLocker\nattack.\n\n## Who is Vice Society?\n\nVice Society is a relatively new player in the ransomware space. They emerged in mid-2021\nand have been observed launching big-game hunting and double-extortion attacks, primarily\n[targeting small or midsize victims.](https://www.databreaches.net/frederick-public-schools-in-oklahoma-back-up-and-running-after-ransomware-attack/)\n\nThis group also has notably targeted public school districts and other educational institutions.\nAs they are a new actor in this space, Vice Society's TTPs are difficult to quantify. However,\nbased on incident response observations, they are quick to leverage new vulnerabilities for\nlateral movement and persistence on a victim's network. They also attempt to be innovative\non end-point detection response bypasses.\n\nAs with other threat actors operating in the big-game hunting space, Vice Society operates a\ndata leak site, which they use to publish data exfiltrated from victims who do not choose to\npay their extortion demands. Below is an example screenshot of this site.\n\n\n-----\n\n## Recent attack methodology\n\nThroughout the course of our analysis of a recent human-operated ransomware attack\nassociated with Vice Society, we observed several notable tactics, techniques, and\nprocedures (TTPs) used throughout each stage of the attack lifecycle. Some of the most\ninteresting characteristics of this attack were:\n\nThe use of utilities such as proxychains and impacket during the post-compromise\nphases of the attack lifecycle.\nThe targeting of backups to prevent recovery following ransomware deployment.\nThe degradation of ESXi servers used for virtualization in victim environments.\nThe use of a DLL that takes advantage of the recently discovered PrintNightmare\nvulnerability for which Microsoft has previously released a security update.\nAttempts to bypass native Windows protections for credential theft and privilege\nescalation.\n\n\n-----\n\nBelow are some key examples of the TTPs used in this attack as they relate to the Mitre\n[ATT&CK Framework.](https://attack.mitre.org/)\n\n### Discovery\n\n[ATT&CK Technique: System Owner/User Discovery (T1033)](https://attack.mitre.org/techniques/T1033/)\n\n[ATT&CK Technique: Account Discovery (T1087)](https://attack.mitre.org/techniques/T1087/)\n\n[ATT&CK Technique: Domain Trust Discovery (T1482)](https://attack.mitre.org/techniques/T1482/)\n\nOnce initial access was achieved, several techniques were observed being leveraged to\nconduct post-compromise discovery and reconnaissance within the environment. We\nobserved attempts to access the backup solution employed in the environment, likely to\nprevent the organization from successfully recovering without paying the demanded ransom.\nThe \"sudo\" command was used to obtain credentials associated with a commercial backup\nsolution, likely trying to gain access to backups present within the environment.\n```\nsudo -s -k -p [Backup Prompt] whoami\n\n```\nWe also observed the use of impacket, a common network protocol manipulation tool to\nenumerate the environment and obtain additional information about the Active Directory\nconfiguration in place. This is typically done to identify high-value targets that may be\nattractive, as attacks attempt to maximize their sphere of influence over as much of the\nenvironment as possible prior, eventually deploying ransomware and making their presence\nknown. Below are some examples of the command line syntax used for the performance of\nthis activity.\n```\ncmd.exe /q /c net group enterprise admins /domain 1> \\\\127.0.0.1\\admin$\\__[STIRNG]\n2>&1\ncmd.exe /q /c net group domain admins /domain 1> \\\\127.0.0.1\\admin$\\__[STRING] 2>&1\n\n```\nWe observed enumeration of the domain trust relationships present within the environment.\nThe adversaries used the \"nltest\" command for this purpose.\n```\nc:\\windows\\system32\\nltest.exe /dclist:linux [HOSTNAME]\n\n### Execution\n\n```\nATT&CK Technique: Command and Scripting Interpreter: Windows Command Shell\n(T1059.003)\n\n[ATT&CK Technique: Command and Scripting Interpreter: PowerShell (T1059.001)](https://attack.mitre.org/techniques/T1059/001/)\n\n[ATT&CK Technique: Windows Management Instrumentation (T1047)](https://attack.mitre.org/techniques/T1047/)\n\n[ATT&CK Technique: System Services: Service Execution (T1569.002)](https://attack.mitre.org/techniques/T1569/002/)\n\n\n-----\n\nSimilar to what was observed during the post-compromise reconnaissance phase of the\nattack, the adversary used impacket to execute Windows Management Instrumentation\n(WMI) to achieve command execution on other systems present in the environment. The\nattacker also used the \"proxychains\" utility, which is often employed to redirect network traffic\nduring penetration testing, red teaming, and other offensive operations.\n```\ncmd.exe /q /c proxychains ~/impacket/examples/wmiexec.py -hashes [SHA256 HASH]\n[USERNAME]@[IP ADDRESS] 1> \\\\127.0.0.1\\admin$\\__[STRING] 2>&1\n\n```\nWe also observed the adversary using Windows Batch files to execute PSExec. In this case,\nPSExec remotely authenticated and executed PowerShell on remote systems within the\nenvironment.\n```\ncmd.exe /c C:\\s$\\0.bat PsExec.exe -d \\\\[HOSTNAME] -u [DOMAIN]\\[USERNAME] -p\n[PASSWORD] -accepteula -s cmd /c powershell.exe -ExecutionPolicy Bypass -file \\\\\n[HOSTNAME]\\s$\\p.ps1\n\n```\nThere were also artifacts in the environment that indicate that the recently disclosed\nPrintNightmare vulnerability may have been used during this attack. A DLL associated with\n[PrintNightmare was observed on systems within the environment as described in the section](https://blog.talosintelligence.com/2021/07/printnightmare-coverage.html)\n\"Credential Access.\"\n\n### Persistence\n\n[ATT&CK Technique: Create or Modify System Process (T1543)](https://attack.mitre.org/techniques/T1543/)\n\nIn many big-game hunting ransomware attacks, upon achieving initial access into the target\nenvironment, the adversary will first attempt to achieve persistence so that they can regain\naccess to the environment if they are detected or their initial point of access is otherwise\nremoved. In this particular case, we observed the adversary leveraging a Windows Service\nto execute PowerShell to stay persistent in the environment.\n\nThe Windows service was configured with the following options:\n\n**Service Type: user mode service**\n\n**Service Start Type: demand start**\n\n**Service Account: LocalSystem**\n\n**Service Name: Updater**\n\n**Service Filename:**\n```\n%COMSPEC% /C start /b %WINDIR%\\System32\\WindowsPowershell\\v1.0\\powershell -noP -sta w 1 -enc [BASE64 ENCODED BLOB]\n\n```\nAs can be seen above, the PowerShell being executed was Base64 encoded. The decoded\nPowerShell instructions are below:\n\n\n-----\n\nThis PowerShell is responsible for the performing the following tasks:\n\nDisabling PowerShell logging.\nBypassing AMSI protection for PowerShell.\nDownloading, decrypting, and executing a backdoor payload from an attackercontrolled server.\n\nBy implementing this persistence, the attacker can regain access to the environment if the\ntargeted organization destroys their initial means of access.\n\n### Lateral movement\n\n[ATT&CK Technique: Remote Services (T1021)](https://attack.mitre.org/techniques/T1021/)\n\n[ATT&CK Technique: Lateral Tool Transfer (T1570)](https://attack.mitre.org/techniques/T1570/)\n\nOnce operational within the target environment, attackers will typically perform\nreconnaissance, identifying additional target systems, and then move laterally from system to\nsystem as they attempt to escalate privileges and then, ultimately, deploy ransomware on\nmany systems in the environment. During the investigation, we observed the attacker\nleveraging Windows Remote Desktop Connections to pivot to additional systems in the\nenvironment. This was typically performed via the following command-line syntax:\n```\nC:\\Windows\\system32\\mstsc.exe /v [HOSTNAME]\n\n```\nThe attacker also attempted to execute PowerShell scripts on remote systems in the\nenvironment while moving system-to-system.\n```\ncmd /c powershell.exe -ExecutionPolicy Bypass -file \\[IPADDRESS]\\share$\\p.ps1\n\n```\nDuring the attack, adversaries copied and executed the aforementioned PowerShell script on\nmultiple systems across the environment.\n\n### Credential access\n\n\n-----\n\n[ATT&CK Technique: OS Credential Dumping (T1003)](https://attack.mitre.org/techniques/T1003/)\n[ATT&CK Technique: OS Credential Dumping: LSASS Memory (T1003.001)](https://attack.mitre.org/techniques/T1003/001/)\n\nThe actor attempted to extract credentials from the victim in two ways: Accessing the active\ndirectory global catalog file ntds.dit and utilizing comsvcs.dll. Comsvcs.dll is a well-known\nway to extract LSASS (Local Security Authority Subsystem Service) data. By invoking\ncomsvcs.dll with rundll32.exe, an adversary can create a dump of any process. This is a\n[classic and clever living-off-the-land binary (LoLBin) tactic that avoids popular credential](https://blog.talosintelligence.com/2019/11/hunting-for-lolbins.html)\nextraction tools like Mimikatz, which may alert defenders.\n\nWe also observed attempts to dump the NTDS.dit, which is a database of Active Directory\ninformation. Examples of the command-line syntax used in these cases are below.\n```\ncmd.exe /q /c powershell ntdsutil.exe 'ac i ntds' 'ifm' 'create full c:\\temp' q q 1>\n\\\\127.0.0.1\\admin$\\__[STRING] 2>&1\ncmd.exe /q /c powershell ntdsutil.exe 'ac i ntds' 'ifm' 'create full c:\\temp_logs' q\nq 1> \\\\127.0.0.1\\admin$\\__[STRING]5 2>&1\n\n```\n[The actor also utilized PrintNightmare, a recently published series of vulnerabilities by](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34527)\nMicrosoft that would allow remote code execution when an improper print spooler performs\nprivileged file operations. This attack vector is notable in the ubiquitous nature of print\n[services in all modern corporate enterprises. Microsoft has recently released a security patch](https://msrc-blog.microsoft.com/2021/08/10/point-and-print-default-behavior-change/)\nfor PrintNightmare — we encourage all enterprises to patch immediately to avoid\nexploitation.\n\n### Defense evasion\n\n[ATT&CK Technique: Indicator Removal on Host: Clear Windows Event Logs (T1070.001)](https://attack.mitre.org/techniques/T1070/001/)\n\n[ATT&CK Technique: Modify Registry (T1112)](https://attack.mitre.org/techniques/T1112/)\n\n[ATT&CK Technique: Impair Defenses or Modify Tools (T1562.001)](https://attack.mitre.org/techniques/T1562/001/)\n\nThroughout the attack, the adversary made multiple attempts to evade detection and subvert\nsecurity controls in place as described throughout previous sections of this blog post. We\nalso observed the attacker attempting to clear the contents of security logs on compromised\nsystems. The following command-line syntax was observed being used to clear the System,\nSecurity and Application Windows Event Logs.\n```\nc:\\windows\\system32\\wevtutil.exe cl system\nc:\\windows\\system32\\wevtutil.exe cl security\nc:\\windows\\system32\\wevtutil.exe cl application\n\n```\n\n-----\n\nThe adversary was also observed remotely modifying the Windows Registry on remote\nsystems to disable [remote administration restrictions to facilitate lateral movement and](https://www.stigviewer.com/stig/windows_paw/2017-11-21/finding/V-78161)\nprivilege escalation activities. Disabling this security control allows attackers to leverage\npass-the-hash attacks and hinder RDP's security on systems.\n```\ncmd.exe /q /c powershell new-itemproperty -path\nhklm:\\system\\currentcontrolset\\control\\lsa -name disablerestrictedadmin -value 0 propertytype dword -force 1> \\\\127.0.0.1\\admin$\\__[STRING] 2>&1\n\n```\nWe also observed the attacker disabling Windows Defender by modifying the Windows\nRegistry on compromised systems. This was performed using the following commands:\n```\nC:\\Windows\\system32\\reg.exe delete HKLM\\Software\\Policies\\Microsoft\\Windows Defender\n/f\nC:\\Windows\\system32\\reg.exe add HKLM\\Software\\Policies\\Microsoft\\Windows\nDefender\\Real-Time Protection /v DisableRoutinelyTakingAction /t REG_DWORD /d 1 /f\nC:\\Windows\\system32\\reg.exe add HKLM\\Software\\Policies\\Microsoft\\Windows\nDefender\\SpyNet /v DisableBlockAtFirstSeen /t REG_DWORD /d 1 /f\n\n```\nWe also observed the threat actor attempting to evade detection while enumerating the\nenvironment using an AMSI bypass, which is often used as a way to evade detection by\nendpoint security solutions that may be present on compromised systems. In this case, the\nWindows Command Processor was used to invoke PowerShell, which then leveraged\nInvoke-Expression (IEX) for this purpose.\n```\ncmd.exe /Q /c powershell.exe -exec bypass -noni -nop -w 1 -C IEX\n([Net.ServicePointManager]::ServerCertificateValidationCallback=\n{$true}try{[Ref].Assembly.GetType('Sys'+'tem.Man'+'agement.Aut'+'omation.Am'+'siUt'+'i\n\n### Exfiltration\n\n```\n[ATT&CK Technique: Exfiltration Over Alternative Protocol (T1048)](https://attack.mitre.org/techniques/T1048/)\n\nOver the past couple of years, we have observed an increasing number of ransomware\nthreat actors adopting a double-extortion methodology in their attacks. In these attacks,\nadversaries attempt to exfiltrate large quantities of sensitive information for the purposes of\nfurther extortion against victims. This data, once exfiltrated, is published to attackercontrolled websites that are commonly referred to as \"data leak sites\" in situations where the\nvictim chooses not to pay the ransom demand.\n\nIn this attack, we observed the adversary attempting to exfiltrate sensitive information over\nSMB (TCP/445) directly from a compromised domain controller. This was likely chosen as a\nway to bypass egress filtering that may have been in place at the perimeter of the victim\nenvironment.\n\n\n-----\n\n### Defender takeaways\n\nIt can be difficult to account for the myriad ways an attacker can compromise and inflict\nmalware on a network. Given the techniques demonstrated here, it can feel overwhelming as\na defender to account for every avenue of attack. The good news is that there are several\nlessons we can learn about this incident:\n\nLogging is critical for forensics — ensure there is reliable and secure logging\ninfrastructure in place.\nUtilize multi-factor authentication to make credential theft more difficult to exploit.\nLook at egress filtering for firewalls and ensure malicious traffic cannot call out to\nadversary infrastructure.\nUtilize an endpoint detection response platform that detects LoLBin abuse and\nmalware implants.\nKeep up-to-date and offline backups that cannot be targeted by adversaries.\n\n## Conclusion\n\nAs demonstrated throughout this post, attackers often make use of a variety of tactics,\ntechniques, and procedures as they work to accomplish their mission objectives. In some\ninstances, there is significant overlap and similarities between the approaches taken by\n[distinct threat actors. They often leverage dual-use tools for various purposes to minimize](https://youtu.be/3OzHRTImA1U)\ntheir footprint and evade detection. Likewise, adversaries are constantly refining their\napproach to the ransomware attack lifecycle as they strive to operate more effectively,\nefficiently, and evasively. The use of the vulnerability known as PrintNightmare shows that\nadversaries are paying close attention and will quickly incorporate new tools that they find\nuseful for various purposes during their attacks. Multiple distinct threat actors are now taking\nadvantage of PrintNightmare, and this adoption will likely continue to increase as long as it is\neffective. It is important that defenders be aware of the various TTPs being used throughout\nthe attack lifecycle so that they are prepared to prevent, detect, and respond to nefarious\nactivity that may be indicative of a successful compromise of their environment. Failure to do\nso could result in widespread operational disruption, reputational damage, and the loss of\nconfidentiality of sensitive information.\n\n## Coverage\n\nWays our customers can detect and block this threat are listed below.\n\n\n-----\n\n[Cisco Secure Endpoint is ideally suited to prevent the execution of the malware detailed in](https://www.cisco.com/c/en/us/products/security/amp-for-endpoints/index.html)\n[this post. New users can try Cisco Secure Endpoint for free here.](https://www.cisco.com/c/en/us/products/security/amp-for-endpoints/free-trial.html?utm_medium%3Dweb-referral%26utm_source%3Dcisco%26utm_campaign%3Damp-free-trial%26utm_term%3Dpgm-talos-trial%26utm_content%3Damp-free-trial)\n\n[Cisco Secure Web Appliance web scanning prevents access to malicious websites and](https://www.cisco.com/c/en/us/products/security/web-security-appliance/index.html)\ndetects malware used in these attacks.\n\n[Cisco Secure Firewall and](https://www.cisco.com/c/en/us/products/security/firewalls/index.html) [Meraki MX can detect malicious activity associated with this](https://meraki.cisco.com/products/appliances)\nthreat.\n\n[Cisco Secure Malware Analytics helps identify malicious binaries and build protection into all](https://www.cisco.com/c/en/us/solutions/enterprise-networks/amp-threat-grid/index.html)\nCisco Security products.\n\n[Cisco Umbrella, our secure internet gateway (SIG), blocks users from connecting to](https://umbrella.cisco.com/)\nmalicious domains, IPs, and URLs, whether users are on or off the corporate network.\n\nAdditional protections with context to your specific environment and threat data are available\nfrom the [Cisco Secure Firewall Management Center.](https://www.cisco.com/c/en/us/products/security/firepower-management-center/index.html)\n\nOpen Source Snort Subscriber Rule Set customers can stay up to date by downloading the\n[latest rule pack available for purchase on Snort.org.The following SIDs have been released](https://www.snort.org/products)\nto detect this threat: 57876, 57877.\n\n## Indicators of Compromise (IOCs)\n\n\n-----\n\nThe following IOCs have been observed being associated with the attack.\n\nPrintNightmare DLL:\n6f191f598589b7708b1890d56b374b45c6eb41610d34f976f0b4cfde8d5731af\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-08-12 - Vice Society Leverages PrintNightmare In Ransomware Attacks.pdf"
    ],
    "report_names": [
        "2021-08-12 - Vice Society Leverages PrintNightmare In Ransomware Attacks.pdf"
    ],
    "threat_actors": [
        {
            "id": "84aa9dbe-e992-4dce-9d80-af3b2de058c0",
            "created_at": "2024-02-02T02:00:04.041676Z",
            "updated_at": "2025-03-27T02:00:03.297502Z",
            "deleted_at": null,
            "main_name": "Vanilla Tempest",
            "aliases": [
                "DEV-0832",
                "Vice Society"
            ],
            "source_name": "MISPGALAXY:Vanilla Tempest",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "600a0c3b-b595-4d10-b84b-cc2cf89289ac",
            "created_at": "2024-06-19T02:03:08.134296Z",
            "updated_at": "2025-03-27T02:05:17.402638Z",
            "deleted_at": null,
            "main_name": "GOLD VICTOR",
            "aliases": [
                "STAC5279 ",
                "Vanilla Tempest ",
                "Vice Society",
                "DEV-0832 "
            ],
            "source_name": "Secureworks:GOLD VICTOR",
            "tools": [
                " Advanced Port Scanner",
                " HelloKitty ransomware",
                " MEGAsync",
                " Neshta",
                " PAExec",
                " PSexec",
                " PortStarter",
                " SystemBC",
                " Zeppelin ransomware",
                "Advanced IP Scanner"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673535998,
    "ts_updated_at": 1743041645,
    "ts_creation_date": 1653688715,
    "ts_modification_date": 1653688715,
    "files": {
        "pdf": "https://archive.orkl.eu/b5079ab7cbec11bc771a73a02f4bd42a492383e6.pdf",
        "text": "https://archive.orkl.eu/b5079ab7cbec11bc771a73a02f4bd42a492383e6.txt",
        "img": "https://archive.orkl.eu/b5079ab7cbec11bc771a73a02f4bd42a492383e6.jpg"
    }
}