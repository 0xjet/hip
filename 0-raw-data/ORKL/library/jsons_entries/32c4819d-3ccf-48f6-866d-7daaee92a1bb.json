{
    "id": "32c4819d-3ccf-48f6-866d-7daaee92a1bb",
    "created_at": "2022-10-25T16:48:23.658038Z",
    "updated_at": "2025-03-27T02:09:29.838674Z",
    "deleted_at": null,
    "sha1_hash": "94ec5a52df9db88ccd953a7e65658bd6ed04b2ee",
    "title": "",
    "authors": "",
    "file_creation_date": "2008-05-06T12:20:33Z",
    "file_modification_date": "2008-05-06T12:20:35Z",
    "file_size": 408826,
    "plain_text": "# Win32.Ntldrbot (aka Rustock.C)\n\n no longer a myth, no longer a threat\n\n**Rootkit is a program (or combination of several programs) designed to take fundamental**\ncontrol (in Unix terms «root» access, in Windows terms «Administrator» access) of a\ncomputer system, without authorization by the system's owners and legitimate managers\nand obscure their presence on the system through subversion or evasion of standard\noperating system security mechanisms.\n\nAfter Wikipedia\n## Preface\n\nVarious anti-virus evasion techniques have become a predominant trend of the malware\ndevelopment. Rootkits are getting more and more complex; their number grows month\nafter month. Most of them are dull coded implementations of someone else's ideas.\nHowever, very interesting pieces of malware emerge every now and then. One of such\nphantom rootkits that has been moving around undetected is described in this article.\n\n## Botnets\n\nIn order to understand the material provided in the article you need to become familiar with\nseveral malware-related terms. One of them is a botnet. Again according to Wikipedia,\na botnet is a term for a set of software robots, or bots, which run autonomously and\nautomatically. They run on groups of zombie computers controlled remotely. Typically\na bot included in a botnet is covertly installed on a target machine so an intruder can\nperform certain actions exploiting software and hardware of an infected computer. As\na rule botnets are applied for illegal activities — spamming, brute force hack attacks of a\nremote host, DDoS attacks, etc.\n\nAccording to Secure Works, the botnet built by Rustock is the third largest and distributes\naround 30 billion spam messages daily, most of them are about securities and medicines.\nThe Rustock botnet summary:\n\n- an estimated number of infected machines – about 150, 000;\n\n- the botnet spamming capability: about 30 billion messages a day;\n\n- rootkit component: yes.\n\nNow you can see what we are dealing with and what impact of such networks can be.\n\n© D t W b Ltd\n\n\n-----\n\n## Rustock growing up\n\nThe name Rustock was given to the malware by Symantec anti-virus experts. The author\nof the rookit liked it so much that he came to use it from then on. In early version of the\nrootkit one could come across with the following string: “Z:\\NewProjects\\spambot\\last\\\ndriver\\objfre\\i386\\driver.pdb”. In subsequent versions a string containing «spambot»\nwas supplemented by a string «Rustock rootkit v 1.2”.\n\nThree «age-groups» are distinguished among rootkits of this class: A, B and C. It is not\nquite accurate, as the author often modified the rootkit code, changed the functions`\ninterception methods and improved the program's stability. However, one version didn't\nundergo too many modifications. In fact switching from one version to another can be\nfollowed pretty easily.\n\nAt the end of 2005 or early in 2006 the first beta-versions of Rustock.A cane into being\nand were used to test new technologies. The most obvious difference between them\nwas the driver names: i386.sys, sysbus32. The rootkit intercepted the system calls table\n(SSDT) and IRP-packets for hiding.\n\nThe betas were followed by a completed Rustock.A – pe386.sys (version 1.0), that\nused more sophisticated stealth techniques. First of all the author abandoned the SSDT\ninterception and resorted to intercepting the 0x2E interrupt (Windows 2000) and MSR_\nSYSENTER(Windows XP+). ADS (Alternate Data Stream) were used to hide a malware\nfile on an NTFS disk. The body of the rootkit was placed at %SystemRoot%\\system32:[a\nstring of random digits].\n\nStill in 2006 a Rustock.B beta (huy32.sys) appeared, a completed Rustock.B - lzx32.sys\n(version 1.2) came shortly after it. The new version intercepted INT2E/MSR_SYSENTER,\nADS (%Windir%\\System32:lzx32.sys). Moreover, the author enhanced the rootkit with\ninterception of network drivers: tcpip.sys, wanarp.sys and ndis.sys, so it could bypass\nfirewalls and hide spam traffic.\n\nVariations of the malicious programs with limited functionality were also released to\nrestore interceptions in case they were detected and blocked by anti-rootkit or anti-virus\nsoftware. Variations with random driver name were used as well.\n\nSome anti-virus vendors, TrendMicro for example, provided a description of Rustock.C in\ntheir virus encyclopedia, however, the subject piece of the malicious code turned out to\nbe another experimental variation of Rustock.B.\n\n## Rustock.C\n\nRumours on Rustock.C started in summer 2006. Anti-virus labs and virus makers began\ntheir search. The first wanted to analyze it and improve their rootkit detection methods, the\nlatter — to steal and then to use more efficient stealth and self-protection techniques.\n\nTime passed, but the hard-sought sample didn’t turn up or anti-virus labs failed to find\ntime for proper analysis. Indeed, they have thousands of files to work on every day. Apart\nfrom forum discussions no one provided clear evidence if Rustock.C actually existed\nor the opposite. Many vendors found it more convenient to avoid the subject of the\nC-version saying, “Since we haven’t found it, it doesn’t exist. It’s just a myth” or: “Speak\nof a nonsense, you might as well bring up Rustock.С here, the rumour has it being in the\nwild but no one actually has seen it”.\n\n2 © D t W b Ltd\n\n\n-----\n\nBut it turned out that Rustock.C is not a myth. Some anti-virus labs didn’t give up searching\nand succeeded.\n\nAs the snapshot above shows, its author accepted the suggested name of Rustock. 18\nmonths passed and Rustock.C was discovered at the beginning of 2008. All this time the\nrootkit was in the wild compromising PCs and turning them into bots.\n\nVirus Monitoring Service of Doctor Web, Ltd. collected about 600 samples of this version\nof the rootkit but nobody knows how many of them exist in the wild. Most of them\nare built in September – October, 2007. Dr.Web virus analysts spent several weeks\non its unpacking, thorough examination and perfection of the detection and curing\ntechniques.\n\nAssuming that the malware has been running free and completely invisible since October\n2007, one could asses the resulting amount of infected traffic. Unsolicited mail has\nbecome a worldwide issue. Many of us notice our traffic increase for no apparent reason\nand experts assess up to 90 per cent of our e-mail correspondence to be completely\nirrelevant and irritating. Win32.Ntldrbot is one of the reasons behind the booming activity\nof spammers. Win32.Ntldrbot has been able to hide from anti-viruses for quite a while.\nIt means that no one can guarantee that your machine is not infected. Probably it has\nbecome a bot and is sending out spam right now.\n\n## Key features of the rootkit\n\n- Sophisticated polymorphic self-protection of the rootkit makes its extraction and\nanalysis extremely difficult.\n\n- Implemented as a driver, it runs on the lowest kernel level.\n\n- Has a self-protect function, prevents runtime changes.\n\n- Uses active anti-debugging techniques: monitors setting hardware breakpoints\n(DR-registers), disrupts operation of the kernel-level debuggers (e.g. Syser,\nSoftIce). WinDbg debugger won’t work, if the rootkit is running.\n\n- Intercepts the following system functions using non-standard method:\n\n    - NtCreateThread\n\n    - NtDelayExecution\n\n    - NtDuplicateObject\n\n    - NtOpenThread\n\n    - NtProtectVirtualMemory\n\n    - NtQuerySystemInformation\n\n    - NtReadVirtualMemory\n\n    - NtResumeThread\n\n    - NtTerminateProcess\n\n3 © D t W b Ltd\n\n\n-----\n\n    - NtTerminateThread\n\n    - NtWriteVirtualMemory\n\n- Functions as a file-virus and infects system drivers.\n\n- A particular sample of the rootkit becomes adjusted to the hardware of an infected\nmachine and most likely won’t run on another computer.\n\n- Utilizes time-triggered re-infection feature. An old infected file is cured. So the\nrootkit «wonders» through system drivers infecting only one at a time.\n\n- Filters calls to an infected file, intercepts FSD-procedures of a file system driver and\nredirects a call to the original file instead of the infected one.\n\n- Features anti-rootkit protection.\n\n- Links its library to one of the Windows system processes, so the library starts\nspamming. A driver is connected to the DLL using a special command transfer\nmechanism.\n\n## Conclusions\n\nOnce virus writers manage to obtain a sample of the rootkit, the flourishing of similar\ntechnologies and their implantation into viral programs will become a matter of time.\n\nAt present, no other anti-virus program, except for Dr.Web anti-virus can detect Rustock.C.\nNone anti-virus, except for Dr.Web anti-virus, can cure system files infected by it. Those\nwho are not Dr.Web customers can download free Dr.Web CureIt! utility and scan the\ncomputer, to be on the safe side.\n\nIn 90s there was a saying popular among IT-guys. Today I devote it to the Rustock author:\n_“Everything which can be run, can be cracked”._\n\n**Virus analysts**\n\n**Vyacheslav Rusakoff**\n\n**Doctor Web, Ltd.**\n\n4 © D t W b Ltd\n\n\n-----\n\n# About Doctor Web, Ltd.\n\nDoctor Web, Ltd. is a Russian company developing and distributing Dr.Web IT-security\nsolutions.\n\nDr.Web anti-virus has been developed since 1992; it has always shown perfect results of\nmalicious programmes` detection and complies with international security standards.\n\nDoctor Web, Ltd. is one of a few anti-virus vendors in the world that owns its technologies\nfor detecting and curing malware, has its own virus monitoring service and analytical\nlaboratory. This provides a rapid response to latest threats and allows to solve any problems\nof customers in a few hours.\n\nState certificates and awards received by the Dr.Web Anti-virus, as well as the geography\nof our users are the best evidence of exceptional trust to the products created by the\ntalented Russian programmers.\n\n## Large enterprise-network experience\n\nCustomers of Doctor Web, Ltd include large and well-known companies: Russian and,\ninternational banks, state and educational institutions, research departments with dozens\nof thousands computers in their networks. Highest government institutions and oil and\ngas companies of Russia entrust their information security to Doctor Web, Ltd.\n\n125124, Russia, Moscow, 3-ja ulitsa Yamskogo polya 2-12A\nTel: +7 (495) 789-45-87\nFax: +7 (495) 789-45-97\nhttp://www.drweb.com\nhttp://www.freedrweb.com\nhttp://www.av-desk.com\n\nTechnical support service:\nhttp://support.drweb.com/new/\n\nDemo-versions:\nhttp://buy.drweb.com/demo\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        }
    ],
    "references": [
        "http://www.drweb.com/upload/6c5e138f917290cb99224a8f8226354f_1210062403_DDOCUMENTSArticales_PRDrWEB_RustockC_eng.pdf"
    ],
    "report_names": [
        "6c5e138f917290cb99224a8f8226354f_1210062403_DDOCUMENTSArticales_PRDrWEB_RustockC_eng.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716503,
    "ts_updated_at": 1743041369,
    "ts_creation_date": 1210076433,
    "ts_modification_date": 1210076435,
    "files": {
        "pdf": "https://archive.orkl.eu/94ec5a52df9db88ccd953a7e65658bd6ed04b2ee.pdf",
        "text": "https://archive.orkl.eu/94ec5a52df9db88ccd953a7e65658bd6ed04b2ee.txt",
        "img": "https://archive.orkl.eu/94ec5a52df9db88ccd953a7e65658bd6ed04b2ee.jpg"
    }
}