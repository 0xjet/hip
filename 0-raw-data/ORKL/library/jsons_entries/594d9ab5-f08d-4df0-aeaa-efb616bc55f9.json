{
    "id": "594d9ab5-f08d-4df0-aeaa-efb616bc55f9",
    "created_at": "2023-01-12T15:06:38.380563Z",
    "updated_at": "2025-03-27T02:16:28.770205Z",
    "deleted_at": null,
    "sha1_hash": "e478084b347a3024017a4f5647a23a7aa53f9407",
    "title": "2020-11-27 - New MacOS Backdoor Connected to OceanLotus Surfaces",
    "authors": "",
    "file_creation_date": "2022-05-28T15:27:06Z",
    "file_modification_date": "2022-05-28T15:27:06Z",
    "file_size": 1265199,
    "plain_text": "# New MacOS Backdoor Connected to OceanLotus Surfaces\n\n**[trendmicro.com/en_us/research/20/k/new-macos-backdoor-connected-to-oceanlotus-surfaces.html](https://www.trendmicro.com/en_us/research/20/k/new-macos-backdoor-connected-to-oceanlotus-surfaces.html)**\n\nNovember 27, 2020\n\n[We recently discovered a new backdoor we believe to be related to the OceanLotus group. Some of the updates of this new variant (detected](https://www.trendmicro.com/en_us/research/18/d/new-macos-backdoor-linked-to-oceanlotus-found.html)\nby Trend Micro as Backdoor.MacOS.OCEANLOTUS.F) include new behavior and domain names. As of writing, this sample is still undetected\nby other antimalware solutions.\n\nDue to similarities in dynamic behavior and code with previous OceanLotus samples, it was confirmed to be a variant of the said malware.\n\nFigures 1-2. Comparison of old OceanLotus sample\n\n(above) with the latest OceanLotus sample (below)\n\n\n-----\n\nOcea otus [as espo s b e o ta geted attac s aga st o ga](https://www.trendmicro.com/en_us/research/18/d/new-macos-backdoor-linked-to-oceanlotus-found.html) at o s o [dust es suc](https://www.volexity.com/blog/2017/11/06/oceanlotus-blossoms-mass-digital-surveillance-and-exploitation-of-asean-nations-the-media-human-rights-and-civil-society/) as ed a, esea c, a d co st uct o ece t y\n[they have also been discovered by researchers from Volexity to be using malicious websites to propagate malware.](https://www.volexity.com/blog/2020/11/06/oceanlotus-extending-cyber-espionage-operations-through-fake-websites/)\n\nThe attackers behind this sample are suspected to target users from Vietnam since the document’s name is in Vietnamese and the older\nsamples targeted the same region before.\n\n## Arrival\n\nThe sample arrives as an app bundled in a Zip archive. It uses the icon for a Word document file as a disguise, attempting to pass itself off as\na legitimate document file.\n\nFigure 3. The sample’s file name, icon, and app bundle structure\n\nAnother technique it uses to evade detection is adding special characters to its app bundle name. When a user looks for the fake doc folder via\nthe macOS Finder app or the terminal command line, the folder's name shows \"ALL tim nha Chi Ngoc Canada.doc\" (“tìm nhà Chị Ngọc”\nroughly translates to “find Mrs. Ngoc’s house”). However, checking the original Zip file that contains the folder shows 3 unexpected bytes\nbetween \".\" and \"doc\".\n\nFigure 4. Special character between ‘.’ and ‘doc’ as\n\nviewed inside the zip archive.\nThe 3 bytes \"efb880\" is in UTF-8 encoding. According to UTF-8 mapping, the related Unicode code is \"U+FE00\".\n\n**Code point** **First byte** **Second byte** **Third byte** **Fourth byte**\n\nU+0000 to U+007F 0xxxxxxx\n\nU+0080 to U+07FF 110xxxxx 10xxxxxx\n\nU+0800 to U+FFFF 1110xxxx 10xxxxxx 10xxxxxx\n\nU+10000 to U+10FFFF 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx\n\nTable 1. UTF-8 mapping\n\n\"U+FE00\" is a special Unicode control character with name variation selector-1, which provides the visual appearance of a CJK compatibility\nideograph. In this case, the preceding character is the general character \".\", so the variation selector does not change the visual appearance.\n\nThe operating system sees the app bundle as an unsupported directory type, so as a default action the “open” command is used to execute\nthe malicious app. Otherwise, if the postfix is .doc without special characters, Microsoft Word is called to open the app bundle as a document;\nbut since it is not a valid document, the app fails to open it.\n\nHere is the code signing information for the app bundle sample.\n\n\n-----\n\nFigure 5. Code signing information for the sample\n\nThe app bundle contains two notable files:\n\nALL tim nha Chi Ngoc Canada: The shell script containing the main malicious routines\nconfigureDefault.def: The word file displayed during execution\n\nFigure 6. Contents of “ALL tim nha Chi Ngoc Canada” file\n\nFigure 7. The document displayed after executing the\n\nfile\nWhen the shell script was run, it performed the following routines:\n\n1)   Delete the file quarantine attribute for the files in \"*ALL tim nha Chi Ngoc Canada.?doc*”\n\n2)   Attempt to remove file quarantine attribute of the files in the system.\n\n3)   Copy \"ALL tim nha Chi Ngoc Canada.?doc/Contents/Resources/configureDefault.def(doc)\" to \"/tmp/ALL tim nha Chi Ngoc\nCanada.doc(doc)\"\n\n4)   Open \"/tmp/ALL tim nha Chi Ngoc Canada.doc(doc)\"\n\n\n-----\n\n5) t act t e b6 e coded at b a y to t a C goc Ca ada doc/Co te ts/ esou ces/co gu e e au t de ( at b a y), c\nis the second-stage payload\n\n6)   Change access permission of second-stage payload to execute the launch of the second-stage payload\n\n7)   Delete the malware app bundle \"ALL tim nha Chi Ngoc Canada.?doc\"\n\n8)   Copy \"/tmp/ALL tim nha Chi Ngoc Canada.doc(doc)\" to \"{execution directory}/ALL tim nha Chi Ngoc Canada.doc\"\n\n9)   Delete \"/tmp/ALL tim nha Chi Ngoc Canada.doc\"\n\n## Second-stage payload\n\nWhen executed, the second stage payload (ALL tim nha Chi Ngoc Canada.?doc/Contents/Resources/configureDefault.def) performs the\nfollowing malware routines:\n\n1)   Drop third-stage payload to ~/Library/User Photos/mount_devfs\n\n2)   Create persistence for the sample by creating ~/Library/LaunchAgents/com.apple.marcoagent.voiceinstallerd.plist\n\nFigure 8. Plist file\n\n~/Library/LaunchAgents/com.apple.marcoagent.voiceinstallerd.plist\n3)   Use the touch command to change the timestamp of the sample\n\nFigure 9. The timestamp of the dropped files\n\n4)   Delete itself\n\n## Third-stage payload\n\nIn the third-stage payload (~/Library/User Photos/mount_devfs), the strings are encrypted with custom encryption using base64 encoding and\nbyte manipulation.\n\nFigure 10. Encrypted strings\n\n\n-----\n\nFigures 11-12. Decryption routine\n\n[Like older versions of the OceanLotus backdoor, the new version contains two main functions: one for collecting operating system information](https://www.trendmicro.com/en_us/research/18/d/new-macos-backdoor-linked-to-oceanlotus-found.html)\nand submitting this to its malicious C&C servers and receiving additional C&C communication information, and another for the backdoor\ncapabilities.\n\nIt collects the following information from the infected system by invoking the following commands:\n\n**Command** **Description**\n\n\nsystem_profiler SPHardwareDataType 2>/dev/null | awk '/Processor / {split($0,line,\\\":\\\");\nprintf(\\\"%s\\\",line[2]);}'\n\n15f20 = system_profiler SPHardwareDataType 2>/dev/null | awk '/Memory/ {split($0,line, \\\":\\\");\nprintf(\\\"%s\\\", line[2]);}'\n\nioreg -rd1 -c IOPlatformExpertDevice | awk '/IOPlatformSerialNumber/ { split($0, line, \\\"\\\\\\\"\\\");\nprintf(\\\"%s\\\", line[4]); }\n\nifconfig -l\n\nifconfig <device> | awk '/ether /{print $2}' 2>&1\n\nTable 2. OceanLotus commands and descriptions\n\nThe collected information is encrypted and sent to the malware C&C server.\n\n\nGet processor information\n\nGet memory information\n\nGet serial number\n\nGet network interface MAC\naddresses\n\n\ninformation to C&C server\nIt also receives commands from the same server.\n\nHere are the C&C servers used by the malware:\n\nmihannevis[.]com\nmykessef[.]com\nidtpl[.]org\n\n\nFigure 13. TCP stream excerpt of the malware sending\n\nFigure 14. TCP stream excerpt of the malware receiving commands from C&C server\n\n\n[The new variant’s backdoor capabilities are similar to those of the old OceanLotus sample, as detailed in the code excerpts below:](https://www.trendmicro.com/en_us/research/18/d/new-macos-backdoor-linked-to-oceanlotus-found.html)\n\n\n-----\n\nFigures 15-16. A comparison of the codes of the old OceanLotus\n\nvariant (above) and the new one (below)\n[Below are the supported commands and their respective codes (taken from an earlier blog post that covered OceanLotus).](https://www.trendmicro.com/en_us/research/18/d/new-macos-backdoor-linked-to-oceanlotus-found.html)\n\n0x33 Get file size\n\n0xe8 Exit\n\n0xa2 Download and execute a file\n\n0xac Run command in terminal\n\n0x48 Remove file\n\n0x72 Upload file\n\n0x23 Download file\n\n0x3c Download file\n\n0x07 Get configuration info\n\n0x55 Empty response, heartbeat packet\n\nTable 3. Supported commands and their respective codes\n\n## Details about C&C domain names\n\n[According to its Google and Whois history, the mihannevis[.]com domain was used to host other websites in the past before it was changed to](https://www.whois.net/)\na C&C server around the end of August 2020.\n\n\n-----\n\nfrom Whois (above) and Google (below)\nIn VirusTotal, some related URL queries appeared at the end of August.\n\n19. URLs related to mihannevis[.]com as seen on VirusTotal\nThe domain \"mykessef[.]com\" was used for the C&C server earlier.\n\n\nFigures 17-18. Domain history of mihannevis[.]com,\n\nFigure\n\nFigure\n\n\n20. Domain history of mykessef[.]com based on Whois Lookup\nThe domain name \"idtpl[.]org\" was registered three years ago, and there was no update history. According to Whois lookup, its register expired\nat the end of March 2020.\n\nFigure 21. idtpl[.]org registration information based on Whois Lookup\n\nBut from the middle of July 2020, its IP address changed to 185[.]117[.]88[.]91.\n\n\n-----\n\nFigure 22. Domain History of idtpl[.]org as seen on VirusTotal\n\n## Recommendations\n\nThreat groups such as OceanLotus are actively updating malware variants in attempts to evade detection and improve persistence. The\nfollowing best practices can be applied to defend against malware:\n\nNever click links or download attachments from emails coming from suspicious sources\nRegularly patch and update software and applications\nUse security solutions suitable for your operating system\n\n[To protect systems operating on macOS, we recommend Trend Micro Home Security for Mac, which offers comprehensive and multi-device](https://www.trendmicro.com/en_us/forHome/products/maximum-security.html)\nprotection against malware and other cyberthreats.\n\n## Indicators of Compromise\n\n**SHA-256** **Filename/Description** **Trend M**\n\ncfa3d506361920f9e1db9d8324dfbb3a9c79723e702d70c3dc8f51825c171420 ALL%20tim%20nha%20Chi%20Ngoc%20Canada.zip Backdoo\n\n48e3609f543ea4a8de0c9375fa665ceb6d2dfc0085ee90fa22ffaced0c770c4f ALL tim nha Chi Ngoc Canada Backdoo\n\n05e5ba08be06f2d0e2da294de4c559ca33c4c28534919e5f2f6fc51aed4956e3 2nd stage fat binary Backdoo\n\nfd7e51e3f3240b550f0405a67e98a97d86747a8a07218e8150d2c2946141f737 3rd stage fat binary Backdoo\n\n**Domains**\n\nmihannevis[.]com\nmykessef[.]com\nidtpl[.]org\n\n## MITRE TTP\n\n**Tactic** **ID** **Name** **Description**\n\n\nDefense\nEvasion\n\n\n[T1070.004](https://attack.mitre.org/techniques/T1070/004/) File Deletion The app bundle and dropper delete\nthemselves after execution\n\n\n[T1222.002](https://attack.mitre.org/techniques/T1222/002/) Linux and Mac File and\nDirectory Permissions\nModification\n\n\nThe backdoor changes the permission of the file\nit wants to execute to +x\n\n\n[T1027](https://attack.mitre.org/techniques/T1027/) Obfuscated Files or Information Readable strings were encrypted\n\n\n[T1036.005](https://attack.mitre.org/techniques/T1036/005/) Masquerading: Match\nLegitimate Name or Location\n\n[T1070.006](https://attack.mitre.org/techniques/T1070/006/) Indicator Removal on Host:\nTimestomp\n\n\nThe app bundle is disguised as a doc file to trick\nusers into executing it\n\nThe backdoor modifies the date and time of the\ndropped files using the “touch” command\n\n\n-----\n\nDiscovery [T1082](https://attack.mitre.org/techniques/T1082/) System Information Discovery The backdoor collects various\ninformation to send to the C&C server\n\n\nCollection [T1560.003](https://attack.mitre.org/techniques/T1560/003/) Archive Collected Data: Archive via Custom\nMethod\n\n\nThe backdoor encrypts the data before\nexfiltration\n\n\nCommand\nand Control\n\n\n[T1095](https://attack.mitre.org/techniques/T1095/) Non-Application Layer Protocol Like previous samples, performs\nbackdoor routines based on C&C data\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-11-27 - New MacOS Backdoor Connected to OceanLotus Surfaces.pdf"
    ],
    "report_names": [
        "2020-11-27 - New MacOS Backdoor Connected to OceanLotus Surfaces.pdf"
    ],
    "threat_actors": [
        {
            "id": "870f6f62-84f5-48ca-a18e-cf2902cd6924",
            "created_at": "2022-10-25T15:50:23.303818Z",
            "updated_at": "2025-03-27T02:00:55.435309Z",
            "deleted_at": null,
            "main_name": "APT32",
            "aliases": [
                "APT32",
                "SeaLotus",
                "OceanLotus",
                "APT-C-00",
                "Canvas Cyclone"
            ],
            "source_name": "MITRE:APT32",
            "tools": [
                "Mimikatz",
                "ipconfig",
                "Kerrdown",
                "Cobalt Strike",
                "SOUNDBITE",
                "OSX_OCEANLOTUS.D",
                "KOMPROGO",
                "netsh",
                "RotaJakiro",
                "PHOREAL",
                "Arp",
                "Denis",
                "Goopy"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "af509bbb-8d18-4903-a9bd-9e94099c6b30",
            "created_at": "2023-01-06T13:46:38.585525Z",
            "updated_at": "2025-03-27T02:00:02.866727Z",
            "deleted_at": null,
            "main_name": "APT32",
            "aliases": [
                "TIN WOODLAWN",
                "OceanLotus Group",
                "OceanLotus",
                "Sea Lotus",
                "G0050",
                "Cobalt Kitty",
                "SeaLotus",
                "ATK17",
                "Ocean Lotus",
                "Ocean Buffalo",
                "POND LOACH",
                "Canvas Cyclone",
                "APT-C-00",
                "APT-32",
                "APT 32"
            ],
            "source_name": "MISPGALAXY:APT32",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f1518ac1-4710-4dd1-a422-e3801e4806cb",
            "created_at": "2024-05-01T02:03:08.147856Z",
            "updated_at": "2025-03-27T02:05:17.421275Z",
            "deleted_at": null,
            "main_name": "TIN WOODLAWN",
            "aliases": [
                "Cobalt Kitty",
                "OceanLotus",
                "WOODLAWN ",
                "APT32 "
            ],
            "source_name": "Secureworks:TIN WOODLAWN",
            "tools": [
                " Denis",
                " Goopy",
                " JEShell",
                " KerrDown",
                " Mimikatz",
                " Ratsnif",
                " Remy",
                " Rizzo",
                " RolandRAT",
                "Cobalt Strike"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "2439ad53-39cc-4fff-8fdf-4028d65803c0",
            "created_at": "2022-10-25T16:07:23.353204Z",
            "updated_at": "2025-03-27T02:02:09.749502Z",
            "deleted_at": null,
            "main_name": "APT 32",
            "aliases": [
                "APT 32",
                "APT-C-00",
                "APT-LY-100",
                "ATK 17",
                "Lotus Bane",
                "Ocean Buffalo",
                "OceanLotus",
                "Operation Cobalt Kitty",
                "Operation PhantomLance",
                "Pond Loach",
                "SeaLotus",
                "SectorF01",
                "Tin Woodlawn"
            ],
            "source_name": "ETDA:APT 32",
            "tools": [
                "Agentemis",
                "Android.Backdoor.736.origin",
                "AtNow",
                "Backdoor.MacOS.OCEANLOTUS.F",
                "BadCake",
                "CACTUSTORCH",
                "CamCapture Plugin",
                "CinaRAT",
                "Cobalt Strike",
                "CobaltStrike",
                "Cuegoe",
                "DKMC",
                "Denis",
                "Goopy",
                "HiddenLotus",
                "KOMPROGO",
                "KerrDown",
                "METALJACK",
                "MSFvenom",
                "Mimikatz",
                "Nishang",
                "OSX_OCEANLOTUS.D",
                "OceanLotus",
                "PHOREAL",
                "PWNDROID1",
                "PhantomLance",
                "PowerSploit",
                "Quasar RAT",
                "QuasarRAT",
                "RatSnif",
                "Remy",
                "Remy RAT",
                "Rizzo",
                "Roland",
                "Roland RAT",
                "SOUNDBITE",
                "Salgorea",
                "Splinter RAT",
                "Terracotta VPN",
                "Yggdrasil",
                "cobeacon",
                "denesRAT",
                "fingerprintjs2"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535998,
    "ts_updated_at": 1743041788,
    "ts_creation_date": 1653751626,
    "ts_modification_date": 1653751626,
    "files": {
        "pdf": "https://archive.orkl.eu/e478084b347a3024017a4f5647a23a7aa53f9407.pdf",
        "text": "https://archive.orkl.eu/e478084b347a3024017a4f5647a23a7aa53f9407.txt",
        "img": "https://archive.orkl.eu/e478084b347a3024017a4f5647a23a7aa53f9407.jpg"
    }
}