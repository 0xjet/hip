{
    "id": "42f68bee-e249-4e10-90e3-bf6d31a6ff3e",
    "created_at": "2023-01-12T15:07:53.351342Z",
    "updated_at": "2025-03-27T02:05:29.276784Z",
    "deleted_at": null,
    "sha1_hash": "adc371d066f2cb23ba6a21f4bc2eed9bbc526f20",
    "title": "2022-04-01 - Threat Update- CaddyWiper",
    "authors": "",
    "file_creation_date": "2022-05-28T23:24:15Z",
    "file_modification_date": "2022-05-28T23:24:15Z",
    "file_size": 406823,
    "plain_text": "# Threat Update: CaddyWiper\n\n**[splunk.com/en_us/blog/security/threat-update-caddywiper.html](https://www.splunk.com/en_us/blog/security/threat-update-caddywiper.html)**\n\nSECURITY\n\n\nApril 1, 2022\n\n\nBy [Splunk Threat Research Team April 01,](https://www.splunk.com/en_us/blog/author/secmrkt-research.html)\n\n\n2022\n\n\n-----\n\nAs the conflict in Eastern Europe continues, the Splunk Threat Research Team (STRT) is\nconstantly monitoring new developments, especially those related to destructive software.\n[As we have showcased in previous releases in relation to destructive software and](https://www.splunk.com/en_us/blog/security/threat-advisory-strt-ta02-destructive-software.html)\n[HermeticWiper, malicious actors modify their TTPs in order to become more effective and](https://www.splunk.com/en_us/blog/security/detecting-hermeticwiper.html)\nachieve their objectives. In the case of HermeticWiper, we witnessed the introduction of\n[new features since the increment of malicious cyber activity targeting Ukraine from last](https://www.splunk.com/en_us/blog/security/detecting-hermeticwiper.html)\nmonth.\n\n[We now have a new payload recently discovered by ESET named CaddyWiper, indicating](https://twitter.com/ESETresearch/status/1503436420886712321)\nno code sharing with previous malicious payloads during this campaign. There is one thing\nhowever that has been seen during the deployment of payloads, and that is the use of\nGroup Policy Objects (GPOs).\n\n[Group Policy Objects are Microsoft Active Directory network policies that can be applied](https://docs.microsoft.com/en-us/previous-versions/windows/desktop/policy/group-policy-objects)\nselectively to computers, organizational units, applications, and individual users. Splunk\n[Security research has previously shown how to use GPOs to defend against Ransomware,](https://www.rsaconference.com/Library/presentation/USA/2017/automated-prevention-of-ransomware-with-machine-learning-and-gpos)\nas the selective and massive application of these settings helps streamline, enforce and\nharden security policies.\n\nHowever, as we have witnessed, GPOs can be used to harm if malicious actors can\ncompromise domain administrators. This new malicious payload, incorporates the following\nfeatures:\n\nDomain Controller killswitch. If payload detects installation on a Domain Controller it\nstops its functions.\nIf not in a Domain Controller it destroys users data “C:\\Users” and subsequent\nmapped drives (this may include network mapped drives).\nIf not in a Domain Controller it destroys drive partitions including boot partitions\n(\\\\.\\PhysicalDrive9 to \\\\.\\PhysicalDrive0)\n\nThe above new features indicate the intention of malicious actors to maintain access to\nDomain Controllers and deploy destructive software without the need to have to\ncompromise and get access again if they were destroyed and had to be reinstalled. This\napproach is much more tactical and it also gives attackers the possibility to modify, re-apply,\nor enforce GPOs that can achieve the deployment of this destructive payload. Below is a\nbreakdown of these features.\n\n## Domain Controller Kill Switch\n\nThis wiper will prepare the module name and API name string on the stack to dynamically\nparse it upon execution. Then it will execute DsRolePrimaryDomainInformation() API to\nretrieve the state data of the targeted host. If the state role of the computer is\nDsRole_RolePrimaryDomainController caddywiper will exit its process.\n\n\n-----\n\n## Overwriting Files with Zeroed Buffer\n\nIf the computer is not a Domain Controller it will start to do its payload. One of them is\noverwriting files in C:\\users directory and from Drive D:\\ until Drive Z:\\.\n\nIf it finds a file that is not a folder and has a hidden system attribute, it will adjust the\nSecurity identifier permission of its process as well as its TokenPrivileges to\n“SeTokenOwnershipPrivilege” to be able to access those files.\n\n\n-----\n\nAfter that checking, Caddywiper will initialize a zeroed buffer based on the file size of the\nfile it found. If the file size is greater than 0xA00000, It will set the maximum zeroed buffer\nsize to 0xA00000. That buffer will be used to overwrite the files and make them\nunrecoverable.\n\n\n-----\n\n## Wiping Boot Partitions\n\nThis payload will enumerate all possible boot sectors partitions from \\\\.\\PhysicalDrive9 to\n\\\\.\\PhysicalDrive0 to overwrite it with a zeroed buffer with size of 1920 bytes. The wiping\nwas executed using DeviceIoControl IOCTL_DISK_SET_DRIVE_LAYOUT_EX.\n\n\n-----\n\n**Name** **Technique**\n**ID**\n\n\n**Tactic** **Description**\n\n\nWindows\nRaw\nAccess To\nDisk\nVolume\nPartition\n\n\n[T1561.002](https://attack.mitre.org/techniques/T1561/002/) Impact This analytic is to look for suspicious raw access read\nto device disk partition of the host machine. This\ntechnique was seen in several attacks by adversaries\nor threat actor to wipe, encrypt or overwrite the boot\nsector of each partition as part of their impact payload\nfor example the “hermeticwiper” malware.\n\n\n-----\n\nWindows\nRaw\nAccess To\n[Master](https://research.splunk.com/endpoint/windows_raw_access_to_master_boot_record_drive/)\nBoot\nRecord\nDrive\n\n\n[T1561.002](https://attack.mitre.org/techniques/T1561/002/) Impact This analytic is to look for suspicious raw access read\nto drive where the master boot record is placed. This\ntechnique was seen in several attacks by adversaries\nor threat actors to wipe, encrypt or overwrite the\nmaster boot record code as part of their impact\npayload.\n\n\n## Mitigate via GPO\n\n[As mentioned in this Threat Update GPOs can also be used defensively and the Splunk](https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/how-to-configure-security-policy-settings)\nSecurity Research has previously shown how to apply them in a defensive manner. Here\nare some examples of GPO that can be applied to protect against destructive software\nattacks:\n\nForce logoff\nRemove Computer from Domain\nDisable password changes\nDisable access to network shares\nEnforce account lockout\nPrevent further download of payloads from the internet\nApply firewall rules\nPrevent reboot of computers\n\nThe above GPO settings in combination with Splunk SOAR playbooks such as\n[Ransomware Investigate and Contain may improve defenses and containment of these](https://research.splunk.com/playbooks/ransomware_investigate_and_contain/)\ntypes of attacks.\n\n## Mitigation\n\nThe Cybersecurity & Infrastructure Security Agency (CISA) has provided numerous\nguidelines on how to prepare, defend and respond against destructive software attacks.\nThe following links provide extensive information on the subject.\n\n## Splunk Threat Research Related Resources\n\n Learn More\n\n[You can find the latest content about security analytic stories on research.splunk.com. For a](https://research.splunk.com/)\n[full list of security content, check out the release notes on](https://docs.splunk.com/Documentation/ESSOC/3.21.0/RN/Enhancements) [Splunk Docs.](https://docs.splunk.com/Documentation/ESSOC)\n\n\n-----\n\n## Contributors\n\nWe would like to thank the following for their contributions to this post.\n\nTeoderick Contreras\nRod Soto\nJose Hernandez\nPatrick Barreiss\nLou Stella\nMauricio Velazco\nMichael Haag\nBhavin Patel\nEric McGinnis\n\nPosted by\n\n**[Splunk Threat Research Team](https://www.splunk.com/en_us/blog/author/secmrkt-research.html)**\n\nThe Splunk Threat Research Team is an active part of a customer’s overall defense\nstrategy by enhancing Splunk security offerings with verified research and security content\nsuch as use cases, detection searches, and playbooks. We help security teams around the\nglobe strengthen operations by providing tactical guidance and insights to detect,\ninvestigate and respond against the latest threats. The Splunk Threat Research Team\nfocuses on understanding how threats, actors, and vulnerabilities work, and the team\n[replicates attacks which are stored as datasets in the Attack Data repository.](https://github.com/splunk/attack_data/)\n\nOur goal is to provide security teams with research they can leverage in their day to day\noperations and to become the industry standard for SIEM detections. We are a team of\n\n\n-----\n\nindustry-recognized experts who are encouraged to improve the security industry by\nsharing our work with the community via conference talks, open-sourcing projects, and\nwriting white papers or blogs. You will also find us presenting our research at conferences\nsuch as Defcon, Blackhat, RSA, and many more.\n\n[Read more Splunk Security Content.](https://github.com/splunk/security_content)\n\nTAGS\n[Security](https://www.splunk.com/en_us/blog/tag/security.html)\nShow All Tags\n\nShow Less Tags\n\n**Join the Discussion**\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-04-01 - Threat Update- CaddyWiper.pdf"
    ],
    "report_names": [
        "2022-04-01 - Threat Update- CaddyWiper.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536073,
    "ts_updated_at": 1743041129,
    "ts_creation_date": 1653780255,
    "ts_modification_date": 1653780255,
    "files": {
        "pdf": "https://archive.orkl.eu/adc371d066f2cb23ba6a21f4bc2eed9bbc526f20.pdf",
        "text": "https://archive.orkl.eu/adc371d066f2cb23ba6a21f4bc2eed9bbc526f20.txt",
        "img": "https://archive.orkl.eu/adc371d066f2cb23ba6a21f4bc2eed9bbc526f20.jpg"
    }
}