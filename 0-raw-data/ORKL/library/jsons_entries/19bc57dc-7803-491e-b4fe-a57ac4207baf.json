{
    "id": "19bc57dc-7803-491e-b4fe-a57ac4207baf",
    "created_at": "2022-10-25T16:48:21.345716Z",
    "updated_at": "2025-03-27T02:16:42.965811Z",
    "deleted_at": null,
    "sha1_hash": "c7afca26feabcb0374cbbe2cee010696212d4f85",
    "title": "",
    "authors": "",
    "file_creation_date": "2016-05-02T03:51:02Z",
    "file_modification_date": "2016-05-02T03:51:02Z",
    "file_size": 2893422,
    "plain_text": "##  BLOG\n\n###### Featured  Recent  Videos  Categories  Contributors\n\n\n### Mo’ Shells Mo’ Problems – File List Stacking\n\nMarch 7, 2014 [RyanJ](http://www.crowdstrike.com/blog/author/ryanj/) [From The Front Lines, Research & Threat Intel](http://www.crowdstrike.com/blog/category/from-the-front-lines/)\n\nDisclaimer: CrowdStrike derived this information from\n\ninvestigations in non-classified environments. Since we value\n\nour clients’ privacy and interests, some data has been redacted\n\nor sanitized.\n\nIn our first blog post, “Mo’ Shells Mo’ Problems: Deep Panda\n\nWeb Shells – Part 1”, we discussed two web shells leveraged by a\n\nChinese threat group we call Deep Panda. In case you forgot, a\n\nweb shell is a file containing backdoor functionality written in a\n\nweb scripting language such ASP, ASPX, PHP, JSP or CFM. When a\n\nweb shell is hosted on an internet facing victim system, an\n\nadversary can remotely access the system to perform malicious\n\nactions.\n\nToday we’ll cover one of three ways to help hunt for web shells in\n\nyour environment: file stacking. We often use this method\n\n\n-----\n\ncreates web shells on only a small number of servers in a victim\n\nenvironment, providing us with a “needle in many haystacks”\n\nproblem. Luckily, most servers in an organization have very little\n\nend user interaction and contain far less user artifacts than a\n\ntypical workstation. As a result, it is typically easier to identify\n\nanomalies on servers.\n\nThe main goal of file stacking is to identify outliers. By\n\nidentifying uncommon files across a set of servers, we hope to\n\nfind the most uncommon file type of all, malware.\n\nIn the case of web shells, there are certain search criteria we may\n\nwant to adopt to speed up our efforts:\n\n**·    If the environment is a mix of Windows Server and other**\n\nweb hosting solutions (such as Apache Tomcat and Adobe Cold\n\nFusion), search for extensions of ASP, ASPX, JSP, PHP and CFM.\n\nFocus searches on %systemdrive%Inetpubwwwroot,\n\n%programfiles%Apache Software Foundation,\n\n%systemdrive%ColdFusion<version> and other file paths to 3rd\n\nparty web hosting solutions in your environment.\n\n**·    If the environment is Windows based with no other 3rd**\n\nparty web hosting solutions, limit search to\n\n%systemdrive%Inetpubwwwroot and search for extensions ASP\n\nand ASPX. This will restrict to searching only for scripts that are\n\naccessible externally from the internet.\n\nFile Stacking with Timestamps\n\nTo illustrate file stacking, consider the following real world\n\nnetwork:\n\n**·    Predominately Windows environment**\n\n**·    About 200 Servers**\n\n**·    Usage of third party web hosting solutions**\n\nIn this example, the wide variety of custom web applications\n\ncauses many legitimate and unique web scripts across the\n\nenterprise. It would be extremely difficult to identify web shells\n\n\n-----\n\nby restricting the search to the aforementioned criteria and\n\nsorting by file creation time, we can identify uncommon web\n\nscripts not created at similar times to one another. We would\n\nnormally expect groupings of web scripts to be created in\n\nsuccession if they are part of a normal deployment by an\n\nadministrator or part of an installation. Files that do not adhere\n\nto this model are worth looking at further. Our method of\n\nfiltering by file path and extension, coupled with sorting by file\n\ncreation time, helps identify suspicious outliers. Pretty\n\nstraightforward, right? Here’s how it looks in this network:\n\nIgnoring my previous search criteria advice and searching for all\n\nthe aforementioned extensions, results in 179,231 files found on\n\nthe 200 servers in our example environment. I don’t know about\n\nyou, but I don’t often have the time to sift through 179,231 web\n\nscripts. Limiting our search criteria to specific directories\n\nresults in 1,671 files, a significant improvement. Timestamp\n\nanalysis can be used to further reduce this set, and we were\n\nmost interested in files created between April and November\n\n2013.\n\nThe below table shows an abbreviated listing of the file stacking\n\nresults for the 200 windows servers in the sample victim\n\norganization, sorted by file creation time:\n\n\n-----\n\nReferencing Table 1, the web scripts on Servers 1 and 4-6 appear\n\nto be created contemporaneous with one another and all reside\n\nin the same directories. This type of activity is likely a result of\n\nlegitimate installation of a 3rd party application or other custom\n\napplications used for legitimate purposes within the\n\norganization. However, you can also see two particular web\n\nscripts that stand out:\n\n**·**\n\nC:inetpubwwwrootaspnet_clientsystem_web<VERSION>system_web.aspx\n\n**·**\n\nC:Inetpubwwwroot_wmcscertificationPassportRedirector.aspx\n\nBoth of these scripts were created at isolated times from all\n\nother web scripts created between our target dates of April 2013\n\nand November 2013. Further investigation of\n\nPassportRedirector.aspx, showed it to be a false positive related\n\nto the Windows Rights Management – Account Certification\n\nService.\n\nTaking a closer look at System_web.aspx shows us it was\n\ncreated at an atypical time of 3:35:17 UTC (Roughly 23:35:17 EDT).\n\nThis suggests it may not have been created by an administrator\n\n\n-----\n\nindeed was a web shell covered in our first post “Mo Shells Mo’\n\nProblems: Deep Panda Web Shells – Part 1”.\n\nFile Stacking with File Paths\n\nWe can also search on full file path, using the same data above,\n\nto identify web scripts that are not grouped with others.\n\nAdditionally, we’ll be on the lookout for files in unusual or unique\n\nlocations.\n\nTable 2 shows an abbreviated listing of the file stacking results\n\nfor the 200 windows servers in our sample victim organization,\n\nsorted by full file path:\n\nIn Table 2, the web scripts on Servers 1 and 3 appear to be\n\nconsistently residing in the same subdirectories. This type of\n\nactivity suggests that these web scripts may have been part of a\n\n3rd party installation or custom application. We can also\n\nreference the file creation times and see that these scripts were\n\nall consistently created around the same time as one another.\n\nLooking again at Server 2, you can see our malicious Deep Panda\n\nweb shell stand out:\n\n\n-----\n\nC:inetpubwwwrootaspnet_clientsystem_web<VERSION>system_web.aspx\n\nSystem_web.aspx is the only file across all 200 systems that\n\nresides in that specific subdirectory.\n\nWe can also perform similar sanity checks on individual servers.\n\nIf we look at all files with web script extensions on Server 2, there\n\nare a total of 616 files returned. Table 3 shows an abbreviated\n\nlisting of these results.\n\nInterestingly, System_web.aspx was the only web script located\n\nin C:inetpubwwwroot. This directory is publically accessible\n\nthrough the internet and it is extremely unlikely that an\n\napplication would only have one web script to provide its\n\nfunctionality to an end user. If this location is legitimate, where\n\nare the other scripts? The fact that System_web.aspx was the\n\nonly web script hosted publically by this web server is highly\n\nsuspicious.\n\nSummary\n\n**·    Focus searching on only web servers in an environment**\n\n**·    Filter for extensions ASP, ASPX, JSP, PHP and CFM**\n\n**·    Limit searches to:**\n\n– %systemdrive%\\Inetpub\\wwwroot\n\n– %programfiles%\\Apache Software Foundation\n\n\n-----\n\n– Other 3rd party web hosting solutions\n\n**·    Sort by file creation time**\n\n**·    Sort by full file path**\n\nIn our next post, we will dissect web logs to help identify web\n\n[shells in your environment. In the meantime, register now for the](https://attendee.gotowebinar.com/register/8497096584722200321)\n\nApril 1st CrowdCast.\n\n######  Tweet  Share\n\n##### Related Content\n\n\n###### Compromise Attack Targets: Corporate Printers?\n\nThe term,\n\n“Advanced\n\npersistent\n\nthreat” (APT),\n\nhas become\n\nalmost as\n\nmainstream as\n\nsecurity\n\nbreaches in\n\neveryday…\n\n\n###### CrowdStrike Intelligence – Adversary- based Approach\n\nTreating the\n\nproblem, not the\n\nsymptomsHaving\n\nspent the better\n\npart of the last 10\n\nyears dealing…\n\n\n###### Is Your Cybersecurity Approach Based on Myth? Get a Reality Check.\n\nAs human\n\nbeings, we make\n\nthousands of\n\nassumptions\n\nevery day. It is\n\nour way of\n\ncoping…\n\n\n-----\n\n[](https://twitter.com/CrowdStrike) [](https://www.linkedin.com/company/crowdstrike) [](https://www.facebook.com/CrowdStrike/) [](http://www.youtube.com/user/CrowdStrike)\n# \n\nCopyright © 2016 CrowdStrike | [Privacy](http://www.crowdstrike.com/privacy-notice/) | [Request Info](http://www.crowdstrike.com/request-information/) | [Blog](http://www.crowdstrike.com/blog) | [Contact Us](http://www.crowdstrike.com/contact-us/) | 1.888.512.8906\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2014/2014.02.20.deep-panda-webshells/Mo%27%20Shells%20Mo%27%20Problems%20-%20File%20List%20Stacking%20%C2%BB.pdf"
    ],
    "report_names": [
        "Mo' Shells Mo' Problems - File List Stacking »"
    ],
    "threat_actors": [
        {
            "id": "7a9a7873-8e41-40ae-9d06-b27c92bb54e4",
            "created_at": "2022-10-25T16:47:55.568362Z",
            "updated_at": "2025-03-27T02:05:17.264615Z",
            "deleted_at": null,
            "main_name": "BRONZE FIRESTONE",
            "aliases": [
                "C0d0s0",
                "Deep Panda ",
                "Pupa ",
                "TG-3551 ",
                "APT19 "
            ],
            "source_name": "Secureworks:BRONZE FIRESTONE",
            "tools": [
                " Alice's Rabbit Hole",
                " Briba",
                " Cobalt Strike",
                " Derusbi",
                " PlugX",
                " PoisonIvy",
                " Powershell Empire",
                " Zuguo",
                "9002"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "2f07a03f-eb1f-47c8-a8e9-a1a00f2ec253",
            "created_at": "2022-10-25T16:07:24.277669Z",
            "updated_at": "2025-03-27T02:02:10.157972Z",
            "deleted_at": null,
            "main_name": "TA428",
            "aliases": [
                "Operation LagTime IT",
                "Operation StealthyTrident",
                "ThunderCats"
            ],
            "source_name": "ETDA:TA428",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "Agent.dhwf",
                "Albaniiutas",
                "BlueTraveller",
                "Chymine",
                "Cotx RAT",
                "CoughingDown",
                "Darkmoon",
                "Destroy RAT",
                "DestroyRAT",
                "Gen:Trojan.Heur.PT",
                "Kaba",
                "Korplug",
                "LuckyBack",
                "PhantomNet",
                "PlugX",
                "Poison Ivy",
                "RedDelta",
                "RoyalRoad",
                "SManager",
                "SPIVY",
                "Sogu",
                "TIGERPLUG",
                "TManger",
                "TVT",
                "Thoper",
                "Xamtrav",
                "pivy",
                "poisonivy"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "64ca1755-3883-4173-8e0a-6e5cf92faafd",
            "created_at": "2022-10-25T15:50:23.636456Z",
            "updated_at": "2025-03-27T02:00:55.51077Z",
            "deleted_at": null,
            "main_name": "Deep Panda",
            "aliases": [
                "Deep Panda",
                "Shell Crew",
                "KungFu Kittens",
                "PinkPanther",
                "Black Vine"
            ],
            "source_name": "MITRE:Deep Panda",
            "tools": [
                "Mivast",
                "StreamEx",
                "Sakula",
                "Tasklist",
                "Derusbi"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "46a151bd-e4c2-46f9-aee9-ee6942b01098",
            "created_at": "2023-01-06T13:46:38.288168Z",
            "updated_at": "2025-03-27T02:00:02.794118Z",
            "deleted_at": null,
            "main_name": "APT19",
            "aliases": [
                "Black Vine",
                "TEMP.Avengers",
                "PinkPanther",
                "G0073",
                "KungFu Kittens",
                "Group 13",
                "Shell Crew",
                "BRONZE FIRESTONE",
                "G0009",
                "Sunshop Group",
                "DEEP PANDA",
                "Codoso"
            ],
            "source_name": "MISPGALAXY:APT19",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "0639667a-fb3f-43d9-a38c-6c123fd19c7f",
            "created_at": "2022-10-25T16:07:23.335869Z",
            "updated_at": "2025-03-27T02:02:09.743237Z",
            "deleted_at": null,
            "main_name": "APT 19",
            "aliases": [
                "APT 19",
                "Bronze Firestone",
                "C0d0so0",
                "Codoso",
                "Deep Panda",
                "Operation Kingslayer",
                "Red Pegasus",
                "Sunshop Group",
                "TG-3551"
            ],
            "source_name": "ETDA:APT 19",
            "tools": [
                "Agentemis",
                "C0d0so0",
                "Cobalt Strike",
                "CobaltStrike",
                "Derusbi",
                "EmPyre",
                "EmpireProject",
                "Fire Chili",
                "PowerShell Empire",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716501,
    "ts_updated_at": 1743041802,
    "ts_creation_date": 1462161062,
    "ts_modification_date": 1462161062,
    "files": {
        "pdf": "https://archive.orkl.eu/c7afca26feabcb0374cbbe2cee010696212d4f85.pdf",
        "text": "https://archive.orkl.eu/c7afca26feabcb0374cbbe2cee010696212d4f85.txt",
        "img": "https://archive.orkl.eu/c7afca26feabcb0374cbbe2cee010696212d4f85.jpg"
    }
}