{
    "id": "4b78b823-9f95-4ca3-a703-186a05d3748b",
    "created_at": "2022-10-25T16:48:20.367318Z",
    "updated_at": "2025-03-27T02:05:57.689598Z",
    "deleted_at": null,
    "sha1_hash": "83092276fe4d5c3c656d5811413f4560e3653a41",
    "title": "ChessMaster's New Strategy: Evolving Tools and Tactics",
    "authors": "Trend Micro",
    "file_creation_date": "2018-02-04T19:28:30Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 868954,
    "plain_text": "# ChessMaster’s New Strategy: Evolving Tools and Tactics\n\n**[blog.trendmicro.com/trendlabs-security-intelligence/chessmasters-new-strategy-evolving-tools-tactics/](https://blog.trendmicro.com/trendlabs-security-intelligence/chessmasters-new-strategy-evolving-tools-tactics/)**\n\nTrend Micro November 6, 2017\n\n**_by MingYen Hsieh, CH Lei, and Kawabata Kohei_**\n\nA few months ago, we covered the ChessMaster\ncyberespionage campaign, which leveraged a variety of\ntoolsets and malware such as ChChes and remote access\ntrojans like RedLeaves and PlugX to compromise its targets\n—primarily organizations in Japan. A few weeks ago, we\nobserved new activity from ChessMaster, with notable\nevolutions in terms of new tools and tactics that weren’t\npresent in the initial attacks. From what we’ve seen,\nChessMaster is continuously evolving, using open source\ntools and ones they developed, likely as a way to anonymize their operations. Based on the\nway the campaign has developed, it won’t be surprising to see additional evolutions from\nChessMaster in the future.\n\n**Infection Vector**\n\n_Figure: 1 ChessMaster infection chain._\n\nHere is a summary of how ChessMaster enters a target system:\n\n\n-----\n\n[parser vulnerability (CVE-2017-8759) that affects the Microsoft .NET Framework](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-8759)\n2. It then accesses the remote server 89[.]18[.]27[.]159/img.db\n3. Once the victim opens the document, the attacker can execute arbitrary commands on\n\nthe victim’s machine.\n4. The exploit document then launches mshta.exe to access 89[.]18[.]27[.]159:8080/lK0RS,\n\nwhich serves as the first backdoor into the system\n5. This backdoor launches a malicious PowerShell script\n6. The PowerShell script downloads and activates the malware located in the remote\n\nserver 89[.]18[.]27[.]159/FA347FEiwq.jpg\n7. jpg is the second backdoor, which uses the Command-and-Control (C&C)\n\nserver62[.]75[.]197[.]131.\n\nAs mentioned earlier, the first step of the new campaign involves the use of an exploit\ndocument that connects to the remote server 89[.]18[.]27[.]159/img.db when opened. Img.db\nholds the exploit command, which will execute the content of another remote server,\n89[.]18[.]27[.]159:8080/lK0RS, via mhsta.exe.\n\nThe image below shows the malicious link 89[.]18[.]27[.]159/img.db embedded in the exploit\ndocument:\n\n_Figure 2. Link embedded in the document_\n\n89[.]18[.]27[.]159:8080/lK0RS is a JScript backdoor, which apparently comes from an open\nsource RAT known as “Koadic.”\n\nAt this stage, we observed that the attacker tried to gather the system’s environment\ninformation via command line tools. We also observed that some commands were based on\nthe result of a previous command, which means that not all parts of the attack were automated\nand that parts of the commands were done manually. While this might be a sign of a more\nsophisticated automation technique, we believe that this may be an attacker trying to get up\nclose and personal by manually checking the environment before delivering the final payload.\nIt i ibl th t thi d t id db i l i b h\n\n\n-----\n\nable to observe Koadic and the following script, which tries to download another DLL file from\nthe same server that hosts Koadic, at the same time. We believe that FA347FEiwq.jpg serves\nas the final payload of this attack.\n\n_Figure 3: PowerShell script used to download & execute FA347FEiwq.jpg_\n\nThe script attempts to download the file from 89[.]18[.]27[.]159/FA347FEiwq.jpg (detected by\nTrend Micro as BKDR_ANEL.ZKEI), a DLL file which serves as the second backdoor. The\nPowershell script leverages RegisterXLL, which is a component of Excel, to load BKDR_ANEL\ninto Excel.exe\n\n_Figure 4: FA347FEiwq.jpg is loaded by Excel.exe_\n\n**Backdoor Analysis**\n\nBKDR_ANEL is downloaded from89[.]18[.]27[.]159. Once loaded onto the system, it will launch\nand inject code into svchost.exe, after which the injected code decrypts and activates the\nembedded backdoor. BKDR_ANEL has a Microsoft signature attached—the signature is\ninvalid and likely added to make it seem more harmless.\n\nThe backdoor has a hardcoded malware version labeled “5.0.0 beta1” that contains basic\nbackdoor routines with a string-like “Function not implemented.” inside. The relatively\nincomplete code might be a clue of a new variant in the future.\n\nThe malware’s C&C protocol is very similar to the one used by BKDR_CHCHES at first glance:\n\n\n-----\n\n_Figure 5: Comparison of BKDR_ANEL and BKDR_CHCHES’ C&C protocols_\n\nHowever they are different backdoors, with BKDR_CHCHES employing RC4 as its main\nencryption algorithm wherein the decryption key is sent with the encrypted information\nseparated by “=” and set in the Cookie header. On the other hand, BKDR_ANEL utilizes\nBlowfish with the hardcoded encryption key obviously labeled as “this is the encrypt key.”\n\nAnother difference between the two is that BKDR_CHCHES does not contain any backdoor\nroutines by default. Instead, it loads additional modules from the C&C server directly into\nmemory. Alternatively, BKDR_ANEL is more like a regular backdoor embedded with basic\nbackdoor routines.\n\nThe image and table below illustrate the information BKDR_ANEL sends, and how\nBKDR_ANEL encrypts the information.\n\n_Figure 6: Information sent by BKDR_ANEL (1/2)_\n\n**Offset** **Description** **Example in previous figure**\n\n0x0 Process ID 78 0C 00 00\n\n\n0x4 MD5(computer name + machine\nGUID)\n\n\n20 C4 36 1D 03 2F 93 B8\nC7 A0 01 9A EB 2B BD EF\n\n\n0x14 Computer name TEST\n\n0x20 Timestamp 1508201270\n\n0x2a OS version 5.1.2600\n\n0x3a User name Administrator\n\n\n-----\n\n00 00 00 00 => – (Bias % 60)\n\n01 00 00 00 => Has DaylightBias or not\n\n0x53 Current directory C:\\Documents and Settings\\Administrator\\My\nDocuments\n\n0x87 Backdoor version 5.0.0 beta1\n\n_Table 1: Information sent by BKDR_ANEL (2/2)_\n\n_Figure 7: BKDR_ANEL encryption process_\n\nThe information blocks are separated by “&”. As seen in the image above; the string before “=”\nin each block, such as “oVG,” is not used.\n\nFurther similarities between BKDR_ANEL and BKDR_CHCHES can be seen in special partial\nMD5 logic. Both malware only uses the middle 8 bytes from the regular MD5 result.\nBKDR_CHCHES will use it to encrypt the network traffic, while BKDR_ANEL uses it as a code\nbranch in the malware encryption routine, although from our analysis, it does not look like it is\ncurrently in use.\n\n**Mitigation**\n\n\n-----\n\navailable to them. This includes everything from regularly updating their systems to the latest\npatches, which minimizes the impact of attacks that leverage vulnerabilities. In addition, the\n[proper use of behavior monitoring, application control, email gateway monitoring, and](https://www.trendmicro.com/en_us/business/products/user-protection/sps/endpoint/endpoint-application-control.html)\nintrusion/detection systems can help detect any suspicious activities that occur within the\nnetwork. Finally, organizations need to cultivate a culture of security to educate users on what\nto look out for in terms of potential attacks, as end users are often the primary target of these\nkinds of campaigns.\n\nOrganizations can also strengthen their security by employing solutions such as Trend\n[Micro™ Vulnerability Protection™, which protects endpoints from threats that exploit](https://www.trendmicro.com/en_us/business/products/user-protection/sps/endpoint/vulnerability-protection.html)\nvulnerabilities via a high-performance engine monitors traffic for new specific vulnerabilities\nthat uses host-based intrusion prevention system (IPS) filters as well as zero-day attack\nmonitoring.\n\nIn addition, comprehensive security solutions can be used to protect organizations from\n[attacks. These include Trend Micro endpoint solutions such as Trend Micro™ Smart](http://www.trendmicro.com/us/business/complete-user-protection/index.html)\n[Protection Suites, and Worry-Free™ Business Security, which can protect users and](http://www.trendmicro.com/us/small-business/product-security/)\nbusinesses from these threats by detecting malicious files, well as blocking all related\n[malicious URLs. Trend Micro Deep Discovery™ has an email inspection layer that can protect](http://www.trendmicro.com/us/enterprise/security-risk-management/deep-discovery/)\nenterprises by detecting malicious attachment and URLs.\n\n[Trend Micro OfficeScan™ with XGen™ endpoint security infuses high-fidelity machine learning](http://www.trendmicro.com/us/enterprise/product-security/officescan/)\nwith other detection technologies and global threat intelligence for comprehensive protection\nagainst all kinds of threats.\n\n**Indicators of Compromise:**\n\n_Related hashes detected as BKDR_ANEL.ZKEI (SHA-256):_\n\naf1b2cd8580650d826f48ad824deef3749a7db6fde1c7e1dc115c6b0a7dfa0dd\n\n_Command-and-control server:_\n\nhxxp://62[.]75[.]197[.]131/page/?[random strings]\n\n_URLs related to the campaign_\n\nhxxp://89[.]18[.]27[.]159/img.db\nhxxp://89[.]18[.]27[.]159:8080/lK0RS\nhxxp://89[.]18[.]27[.]159/FA347FEiwq.jpg\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/0rt1hrxzbo2il7vmjfyye25qrgdabova"
    ],
    "report_names": [
        "TrendMicro_ChessMasters-New-Strategy-Evolving-Tools-Tactics(11-06-2017)"
    ],
    "threat_actors": [],
    "ts_created_at": 1666716500,
    "ts_updated_at": 1743041157,
    "ts_creation_date": 1517772510,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/83092276fe4d5c3c656d5811413f4560e3653a41.pdf",
        "text": "https://archive.orkl.eu/83092276fe4d5c3c656d5811413f4560e3653a41.txt",
        "img": "https://archive.orkl.eu/83092276fe4d5c3c656d5811413f4560e3653a41.jpg"
    }
}