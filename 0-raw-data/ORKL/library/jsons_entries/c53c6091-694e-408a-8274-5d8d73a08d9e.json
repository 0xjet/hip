{
    "id": "c53c6091-694e-408a-8274-5d8d73a08d9e",
    "created_at": "2023-01-12T15:04:05.144633Z",
    "updated_at": "2025-03-27T02:09:29.44489Z",
    "deleted_at": null,
    "sha1_hash": "996893271458f2a4511dd07667913c03cd53a94e",
    "title": "2021-06-21 - Sonatype Catches New PyPI Cryptomining Malware",
    "authors": "",
    "file_creation_date": "2022-05-28T19:27:58Z",
    "file_modification_date": "2022-05-28T19:27:58Z",
    "file_size": 2007798,
    "plain_text": "# Sonatype Catches New PyPI Cryptomining Malware\n\n**[blog.sonatype.com/sonatype-catches-new-pypi-cryptomining-malware-via-automated-detection](https://blog.sonatype.com/sonatype-catches-new-pypi-cryptomining-malware-via-automated-detection)**\n\n\n-----\n\nSonatype has identified malicious typosquatting packages infiltrating the PyPI repository that\nsecretly pull in cryptominers on the affected machines.\n\nThese PyPI packages are listed below, together scoring almost 5,000 downloads:\n\nmaratlib\nmaratlib1\nmatplatlib-plus\nmllearnlib\nmplatlib\nlearninglib\n\n[All of these were posted by the same author (“nedog123”) on PyPI, some as early as April of](http://web.archive.org/web/20210621092922/https://pypi.org/user/nedog123/)\nthis year.\n\nThese counterfeit components were discovered by Sonatype’s automated malware detection\nsystem, Release Integrity, which is part of our next-gen Nexus Intelligence engine.\n\nOur analysis tools are consistently catching and blocking counterfeit and malicious software\ncomponents before they strike modern software supply chains. In fact, since launching in\n[2019, Release Integrity has identified over 12,000 suspicious npm open source packages,](https://blog.sonatype.com/open-source-attacks-on-the-rise-top-8-malicious-packages-found-in-npm)\n[many of which have made headlines time and time again [1,](https://portswigger.net/daily-swig/open-source-security-malicious-npm-packages-broadcast-sensitive-user-data-online) [2,](https://www.techradar.com/news/not-even-the-best-antivirus-could-have-shielded-you-from-this-linux-and-macos-malware) [3,](https://www.bleepingcomputer.com/news/security/malicious-npm-project-steals-discord-accounts-browser-info/) [4,...].](https://www.bleepingcomputer.com/news/security/malicious-rubygems-packages-used-in-cryptocurrency-supply-chain-attack/)\n\n\n-----\n\nWhile we ve historically focused on the npm ecosystem, my colleague and data scientist\n[Cody Nash nudged me over the weekend with these components, explaining,“these](https://blog.sonatype.com/meet-the-developers-behind-sonatypes-automated-malware-detection-system-securing-open-source-supply-chains)\npackages came while exploring other ecosystems and developing new Release Integrity\nmalware detection capabilities.”\n\nAs observed by Sonatype with open source ecosystems like npm, Nash believes this is a\ntrend of malicious packages infiltrating PyPI, and expects it to keep growing. A bar graph at\nthe end of this post will explain why.\n\n## What’s inside these packages?\n\nOur primary focus for this analysis is “maratlib” because most other malicious components\nsimply pull in this one as a dependency. For example, this is the case for the aforementioned\n“learninglib”:\n\n_Image: “maratlib” dependency in the “learninglib” package_\n\n[Also, some of these packages are “typosquats,” or programs that are expected to be](https://blog.sonatype.com/discord.dll-successor-to-npm-fallguys-)\ngrabbed by people accidentally typing in the wrong name. For example, the counterfeit\n“mplatlib” and “matplatlib-plus” are named after the legitimate Python plotting software\n[“matplotlib.”](https://matplotlib.org/)\n\nOnce again, “mplatlib” pulls in the malicious “maratlib” dependency:\n\n\n-----\n\n_Image: The dependency referred to as ‘LKEK’ is once again “maratlib”_\n\nFor each of these packages, the malicious code is contained in the setup.py file which is a\n[build script that runs during a package’s installation. For Sonatype customers, we’re tracking](https://packaging.python.org/tutorials/packaging-projects/)\nthese malicious typosquats, under sonatype-2021-0722.\n\nWhen I began analyzing these, I first looked at “maratlib” 1.0 (the latest version):\n\n_Image: “maratlib” contains heavily obfuscated code_\n\n\n-----\n\nVersion 1.0 of maratlib is heavily obfuscated and attempted to connect to GitHub, but it\nwasn’t clear initially what it was looking for. Deobfuscating the code using popular tools didn’t\nhelp much, and initially left me frustrated.\n\nBut, observing the dynamic behavior and looking around for clues in prior versions of\n“maratlib” helped solve the puzzle. Looking at version 0.6, I found little to no obfuscated\ncode, seeing instead code that essentially downloads and runs a Bash script from GitHub:\n\n_Image: Highlighted URL from the 0.6 code_\n\nBut the URL serving the bash script (https://github.com/nedog123/files/raw/main/aza.sh)\nthrows a 404 (not found) error.\n\nIn every version of the package, this Bash script was hosted on GitHub, and sometimes\ncalled seo.sh, aza.sh, aza2.sh, or aza-obf.sh, among other variations, but none of these\nURLs worked.\n\nI kept digging and began tracing the malware author’s alias, “nedog123” on both GitHub\narchives and mirrors around the web. Shortly thereafter, [clues emerged.](http://web.archive.org/web/20210621113822/https://www.codefactor.io/repository/github/nedog123/mining-vds/commit/9b5bd50316a3aa53e29536defe8374c1df795174)\n\nThe author previously used the aliases “nedog123,” and “Marat Nedogimov,” but appears to\n[have switched to “maratoff,” which is where some of the scripts were found.](http://web.archive.org/web/20210621101802/https://github.com/maratoff/mining-vds/commit/069cf9fd5b9c79d553e0995e18dcb35ccb3850df?branch=069cf9fd5b9c79d553e0995e18dcb35ccb3850df&diff=unified)\n\nMoreover, the commit IDs associated with update/deletion of these scripts found on GitHub\nmirrors that mentioned alias nedog123, matched the commits in maratoff’s repository:\n\n_Image: Contents of “aza2.sh” Bash script pulled by some versions of “maratlib”_\n\n[Also, the newer maratoff repo contains files referencing the deleted nedog123 alias.](http://web.archive.org/web/20210621114225/https://github.com/maratoff/mining-vds/commit/66e987d68dabb974855ae62807f76eabda8e3988)\n\n\n-----\n\n## Bash scripts run cryptominers on compromised machines\n\nAs evident from the image, the so-called aza2.sh Bash script pulled in by the malicious PyPI\npackage, further downloads a cryptominer called “Ubqminer.”\n\nIn the Bash script, the malware author has already changed the default Kryptex wallet\naddress (ending in ....c0124) to their own:\n\n[0x510aec7f266557b7de753231820571b13eb31b57 [transaction history]](https://ubiqscan.io/address/0x510aec7f266557b7de753231820571b13eb31b57)\n\n[Also, upon digging deeper, the contents of the now-deleted aza.sh file emerged:](https://github.com/maratoff/mining-vds/commit/9b5bd50316a3aa53e29536defe8374c1df795174)\n\n[Image: Contents of the now-deleted aza.sh script (archived commit)](http://web.archive.org/web/20210621102843/https://github.com/maratoff/mining-vds/commit/79cff9e5511720d27193daff942919bb5b36d41c)\n\n[This script uses a different, open source GPU cryptomining program called T-Rex, although](https://github.com/trexminer/T-Rex)\nat some point has [also deployed the previously mentioned Ubqminer.](http://web.archive.org/web/20210621103048/https://github.com/maratoff/mining-vds/commit/ca9167cca6992ef1226c52ca8cb99ad69ce8b017)\n\nIn fact, for those interested, there’s a whole history of commits for both [aza.sh and](http://web.archive.org/web/20210620080728/https://github.com/search?q=aza.sh&type=commits) [aza2.sh.](https://github.com/search?q=aza2.sh&type=commits)\n\nSince their release, these packages have scored the following total number of downloads to\n[date, according to PePy:](https://pepy.tech/)\n\n1. maratlib: 2,371\n2. maratlib1: 379\n3. matplatlib-plus: 913\n4. mllearnlib: 305\n5. mplatlib: 318\n6. learninglib: 626\n\n… adding up to almost 5,000 downloads.\n\nSonatype is publishing our findings after catching these malicious packages over the\nweekend and notifying PyPI of these packages.\n\n## Evolving open source supply-chain attacks warrant advanced protection\n\n\n-----\n\nOnce again, this particular discovery is a further indication that developers are the new target\n[for adversaries over the software they write. Sonatype has been tracing novel brandjacking,](https://blog.sonatype.com/twilio-npm-is-brandjacking-malware-in-disguise)\n[cryptomining, and](https://blog.sonatype.com/rubygems-laced-with-bitcoin-stealing-malware) [typosquatting malware lurking in software repositories. We’ve also found](https://blog.sonatype.com/sonatype-spots-malicious-npm-packages)\n[critical vulnerabilities and next-gen supply-chain attacks, as well as copycat packages](https://blog.sonatype.com/netmask-flaw-leaves-millions-vulnerable-while-a-php-git-server-is-hacked-in-software-supply-chain-attack)\n[targeting well-known tech companies.](https://blog.sonatype.com/malicious-dependency-confusion-copycats-exfiltrate-bash-history-and-etc-shadow-files)\n\nThese PyPI packages have been lurking on the repository for months, targeting developer\nsystems with the goal of turning them into cryptominers.\n\nThe good news is, over the past few weeks, Release Integrity’s experimental runs have\nmanaged to catch over 3,157 PyPI packages. These components are either confirmed\nmalicious, previously known to be malicious, or dependency confusion copycats.\n\n_Image: Malicious PyPI package versions per Month_\n\nWe are now expanding our malware detection capabilities via Nexus Intelligence to other\necosystems as well.\n\nAll of this takes more than just due diligence and luck – it takes the expertise of experienced\nsecurity professionals and hundreds of terabytes of data. In order to keep pace with malware\nmutations, Sonatype analyses every newly-released npm package to keep developers safe.\n\nWe help you remain proactive and safeguard your software supply chains against up-and[coming attacks. Our AI/ML-powered automated malware detection system, Release Integrity,](https://blog.sonatype.com/meet-the-developers-behind-sonatypes-automated-malware-detection-system-securing-open-source-supply-chains)\nand security research team work together for full-spectrum protection. Release Integrity\ndetermines a likely malicious component based on historical supply chain attacks and over\nfive-dozen “signals.” This insight enables flagging for potential new attacks before security\nresearchers discover them.\n\n\n-----\n\n_Image: Nexus Firewall component analysis process_\n\nAs soon as Release Integrity flags a package or a dependency as “suspicious,” it undergoes\na quarantine queue for manual review by the Sonatype Security Research Team. Meanwhile,\nusers of [Nexus Firewall are protected from these suspicious packages while the review is](https://blog.sonatype.com/sonatype-releases-new-nexus-firewall-policy-to-secure-software-supply-chains-from-dependency-confusion-attacks)\nunderway. Existing components are quarantined before they are pulled “downstream” into a\ndeveloper’s open source build environment.\n\nMoreover, users that have enabled the “Dependency Confusion Policy” feature will get\nproactive protection from dependency confusion attacks. This works whether conflicting\npackage names exist in a public repository or in your private, internal repos.\n\nSonatype’s world-class security research data, combined with our automated malware\ndetection technology safeguards your developers, customers, and software supply chain\nfrom infections.\n\nTags: [vulnerabilities,](https://blog.sonatype.com/topic/vulnerabilities) [featured,](https://blog.sonatype.com/topic/featured) [Nexus Intelligence Insights](https://blog.sonatype.com/topic/nexus-intelligence-insights)\n\n\n-----\n\n### Written by Ax Sharma\n\nAx is a Security Researcher at Sonatype and Engineer who holds a passion for perpetual\nlearning. His works and expert analyses have frequently been featured by leading media\noutlets. Ax's expertise lies in security vulnerability research, reverse engineering, and\nsoftware development. In his spare time, he loves exploiting vulnerabilities ethically and\neducating a wide range of audiences.\n\nFollow me on:\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-06-21 - Sonatype Catches New PyPI Cryptomining Malware.pdf"
    ],
    "report_names": [
        "2021-06-21 - Sonatype Catches New PyPI Cryptomining Malware.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535845,
    "ts_updated_at": 1743041369,
    "ts_creation_date": 1653766078,
    "ts_modification_date": 1653766078,
    "files": {
        "pdf": "https://archive.orkl.eu/996893271458f2a4511dd07667913c03cd53a94e.pdf",
        "text": "https://archive.orkl.eu/996893271458f2a4511dd07667913c03cd53a94e.txt",
        "img": "https://archive.orkl.eu/996893271458f2a4511dd07667913c03cd53a94e.jpg"
    }
}