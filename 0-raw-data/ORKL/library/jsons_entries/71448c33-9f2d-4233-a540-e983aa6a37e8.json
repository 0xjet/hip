{
    "id": "71448c33-9f2d-4233-a540-e983aa6a37e8",
    "created_at": "2023-01-12T15:05:48.314628Z",
    "updated_at": "2025-03-27T02:14:02.825214Z",
    "deleted_at": null,
    "sha1_hash": "f5e6befd99fa643019a8659475e158ca486a6565",
    "title": "2017-08-15 - ShadowPad in corporate networks",
    "authors": "",
    "file_creation_date": "2022-05-28T02:02:38Z",
    "file_modification_date": "2022-05-28T02:02:38Z",
    "file_size": 753321,
    "plain_text": "# ShadowPad in corporate networks\n\n**securelist.com/shadowpad-in-corporate-networks/81432/**\n\nAuthors\n\nGReAT\n\n## Popular server management software hit in supply chain attack\n\n**[ShadowPad, part 2: Technical Details (PDF)](https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2017/08/07172148/ShadowPad_technical_description_PDF.pdf)**\n\nIn July 2017, during an investigation, suspicious DNS requests were identified in a partner’s\nnetwork. The partner, which is a financial institution, discovered the requests originating on\nsystems involved in the processing of financial transactions.\n\n\n-----\n\nFurther investigation showed that the source of the suspicious DNS queries was a software\n[package produced by NetSarang. Founded in 1997, NetSarang Computer, Inc. develops,](https://www.netsarang.com/en/)\nmarkets and supports secure connectivity solutions and specializes in the development of\nserver management tools for large corporate networks. The company maintains\nheadquarters in the United States and South Korea.\n\nNetSarang website\n\nOur analysis showed that recent versions of software produced and distributed by NetSarang\nhad been surreptitiously modified to include an encrypted payload that could be remotely\nactivated by a knowledgeable attacker.\n\nThe backdoor was embedded into one of the code libraries used by the software\n(nssock2.dll):\n\n\n-----\n\nBackdoored dll in a list of loaded modules of Xshell5 sofware\n\nDisposition of the NSSOCK2.DLL binary with embedded malicious code\n\nThe attackers hid their malicious intent in several layers of encrypted code. The tiered\narchitecture prevents the actual business logics of the backdoor from being activated until a\nspecial packet is received from the first tier command and control (C&C) server (“activation\nC&C server”). Until then, it only transfers basic information, including the computer, domain\nand user names, every 8 hours.\n\n\n-----\n\nActivation of the payload would be triggered via a specially crafted DNS TXT record for a\nspecific domain. The domain name is generated based on the current month and year\nvalues, e.g. for August 2017 the domain name used would be “nylalobghyhirgh.com”.\n\nDNS queries to C&C from backdoored nssock2.dll\n\nOnly when triggered by the first layer of C&C servers does the backdoor activate its second stage\n\nThe module performs a quick exchange with the controlling DNS server and provides basic\ntarget information (domain and user name, system date, network configuration) to the server.\nThe C&C DNS server in return sends back the decryption key for the next stage of the code,\neffectively activating the backdoor. The data exchanged between the module and the C&C is\nencrypted with a proprietary algorithm and then encoded as readable latin characters. Each\npacket also contains an encrypted “magic” DWORD value “52 4F 4F 44” (‘DOOR’ if read as\na little-endian value).\n\nOur analysis indicates the embedded code acts as a modular backdoor platform. It can\ndownload and execute arbitrary code provided from the C&C server, as well as maintain a\nvirtual file system (VFS) inside the registry. The VFS, and any additional files created by the\ncode, are encrypted and stored in a location unique to each victim. The remote access\ncapability includes a domain generation algorithm (DGA) for C&C servers which changes\n\n\n-----\n\nevery month. The attackers behind this malware have already registered the domains\ncovering July to December 2017, which indirectly confirms alleged start date of the attack as\naround mid July 2017.\n\nCurrently, we can confirm activated payload in a company in Hong Kong. Given that the\nNetSarang programs are used in hundreds of critical networks around the world, on servers\nand workstations belonging to system administrators, it is strongly recommended that\ncompanies take immediate action to identify and contain the compromised software.\n\nKaspersky Lab products detect and protect against the backdoored files as\n“Backdoor.Win32.ShadowPad.a”.\n\nWe informed NetSarang of the compromise and they immediately responded by pulling down\nthe compromised software suite and replacing it with a previous clean version. The company\nhas also published a message\n(https://www.netsarang.com/news/security_exploit_in_july_18_2017_build.html)\nacknowledging our findings and warning their customers.\n\nShadowPad is an example of the dangers posed by a successful supply-chain attack. Given\nthe opportunities for covert data collection, attackers are likely to pursue this type of attack\nagain and again with other widely used software components. Luckily, NetSarang was fast to\nreact to our notification and released a clean software update, most likely preventing\nhundreds of data-stealing attacks against their clients. This case is an example of the value\nof threat research as a means to secure the wider internet ecosystem. No single entity is in a\nposition to defend all of the links in an institution’s software and hardware supply-chain. With\nsuccessful and open cooperation, we can help weed out the attackers in our midst and\nprotect the internet for all users, not just our own.\n\n[For more information please contact: intelreports@kaspersky.com](http://10.10.0.46/mailto:intelreports@kaspersky.com)\n\n## Frequently Asked Questions\n\n### What does the code do if activated?\n\nIf the backdoor were activated, the attacker would be able to upload files, create processes,\nand store information in a VFS contained within the victim’s registry. The VFS and any\nadditional files created by the code are encrypted and stored in locations unique to each\nvictim.\n\n### Which software packages were affected?\n\nWe have confirmed the presence of the malicious file (nssock2.dll) in the following packages\npreviously available on the NetSarang site:\n\n\n-----\n\nXmanager Enterprise 5 Build 1232\nXme5.exe, Jul 17 2017, 55.08 MB\nMD5: 0009f4b9972660eeb23ff3a9dccd8d86\nSHA1: 12180ff028c1c38d99e8375dd6d01f47f6711b97\n\nXmanager 5 Build 1045\nXmgr5.exe, Jul 17 2017, 46.2 MB\nMD5: b69ab19614ef15aa75baf26c869c9cdd\nSHA1: 35c9dae68c129ebb7e7f65511b3a804ddbe4cf1d\n\nXshell 5 Build 1322\nXshell5.exe, Jul 17 2017, 31.58 MB\nMD5: b2c302537ce8fbbcff0d45968cc0a826\nSHA1: 7cf07efe04fe0012ed8beaa2dec5420a9b5561d6\n\nXftp 5 Build 1218\nXftp5.exe, Jul 17 2017, 30.7 MB\nMD5: 78321ad1deefce193c8172ec982ddad1\nSHA1: 08a67be4a4c5629ac3d12f0fdd1efc20aa4bdb2b\n\nXlpd 5 Build 1220\nXlpd5.exe, Jul 17 2017, 30.22 MB\nMD5: 28228f337fdbe3ab34316a7132123c49\nSHA1: 3d69fdd4e29ad65799be33ae812fe278b2b2dabe\n\n### Is NetSarang aware of this situation?\n\nYes, we contacted the vendor and received a swift response. Shortly after notification by\nKaspersky Lab all malicious files were removed from NetSarang website.\n\n### How did you find the software was backdoored?\n\nDuring an investigation, suspicious DNS requests were identified on a partner’s network. The\npartner, which is a financial institution, detected these requests on systems related to the\nprocessing of financial transactions. Our analysis showed that the source of these suspicious\nrequests was a software package produced by NetSarang.\n\n### When did the malicious code first appear in the software?\n\nA fragment of code was added in nssock2.dll (MD5:\n97363d50a279492fda14cbab53429e75), compiled Thu Jul 13 01:23:01 2017. The file is\nsigned with a legitimate NetSarang certificate (Serial number: 53 0C E1 4C 81 F3 62 10 A1\n68 2A FF 17 9E 25 80). This code is not present in the nssock2.dll from March (MD5:\nef0af7231360967c08efbdd2a94f9808) included with the NetSarang installation kits from\nApril.\n\n\n-----\n\n### How do I detect if code is present on a system?\n\nAll Kaspersky Labs products detect and cure this threat as Backdoor.Win32.Shadowpad.a. If\nfor some reason you can’t use an antimalware solution you can check if there were DNS\nrequests from your organization to these domains:\n\nribotqtonut[.]com\nnylalobghyhirgh[.]com\njkvmdmjyfcvkf[.]com\nbafyvoruzgjitwr[.]com\nxmponmzmxkxkh[.]com\ntczafklirkl[.]com\nnotped[.]com\ndnsgogle[.]com\noperatingbox[.]com\npaniesx[.]com\ntechniciantext[.]com\n\n### How do I clean any affected systems?\n\nAll Kaspersky Lab products successfully detect and disinfect the affected files as\n“Backdoor.Win32.Shadowpad.a” and actively protect against the threat.\n\nIf you do not have a Kaspersky product installed, then:\n\n1. Update to the latest version of the NetSarang package.\n2. Block DNS queries to the C2 domains listed in Appendix A.\n\n### What kind of companies/organizations/ are targeted by the attackers?\n\nBased on the vendor profile, the attackers could be after a broad set of companies who rely\non NetSarang software, which includes banking and financial industry, software and media,\nenergy and utilities, computers and electronics, insurance, industrial and construction,\nmanufacturing, pharmaceuticals, retail, telecommunications, transportation and logistics and\nother industries.\n\n### Who is behind this attack?\n\nAttribution is hard and the attackers were very careful to not leave obvious traces. However\ncertain techniques were known to be used in another malware like PlugX and Winnti, which\nwere allegedly developed by Chinese-speaking actors.\n\n### How did the attackers manage to get access to create trojanized updates. Does that mean that NetSarang was hacked?\n\n\n-----\n\nAn investigation is in progress, but since code was signed and added to all software\npackages it could point to the fact that attackers either modified source codes or patched\nsoftware on the build servers.\n\n## Appendix A – Indicators of Compromise\n\nAt this time, we have confirmed the presence of the malicious “nssock2.dll” in the following\npackages downloaded from the NetSarang site:\n\nXmanager Enterprise 5 Build 1232\nXme5.exe, Jul 17 2017, 55.08 MB\nMD5: 0009f4b9972660eeb23ff3a9dccd8d86\nSHA1: 12180ff028c1c38d99e8375dd6d01f47f6711b97\n\nXmanager 5 Build 1045\nXmgr5.exe, Jul 17 2017, 46.2 MB\nMD5: b69ab19614ef15aa75baf26c869c9cdd\nSHA1: 35c9dae68c129ebb7e7f65511b3a804ddbe4cf1d\n\nXshell 5 Build 1322\nXshell5.exe, Jul 17 2017, 31.58 MB\nMD5: b2c302537ce8fbbcff0d45968cc0a826\nSHA1: 7cf07efe04fe0012ed8beaa2dec5420a9b5561d6\n\nXftp 5 Build 1218\nXftp5.exe, Jul 17 2017, 30.7 MB\nMD5: 78321ad1deefce193c8172ec982ddad1\nSHA1: 08a67be4a4c5629ac3d12f0fdd1efc20aa4bdb2b\n\nXlpd 5 Build 1220\nXlpd5.exe, Jul 17 2017, 30.22 MB\nMD5: 28228f337fdbe3ab34316a7132123c49\nSHA1: 3d69fdd4e29ad65799be33ae812fe278b2b2dabe\n\n### Domains:\n\nribotqtonut[.]com\nnylalobghyhirgh[.]com\njkvmdmjyfcvkf[.]com\nbafyvoruzgjitwr[.]com\nxmponmzmxkxkh[.]com\ntczafklirkl[.]com\nnotped[.]com\ndnsgogle[.]com\n\n\n-----\n\noperatingbox[.]com\npaniesx[.]com\ntechniciantext[.]com\n\n### DLL with the encrypted payload:\n\n97363d50a279492fda14cbab53429e75\n\n### NetSarang packages which contain the DLL with the encrypted payload (same as above, just the list of MD5 sums):\n\n0009f4b9972660eeb23ff3a9dccd8d86\nb69ab19614ef15aa75baf26c869c9cdd\nb2c302537ce8fbbcff0d45968cc0a826\n78321ad1deefce193c8172ec982ddad1\n28228f337fdbe3ab34316a7132123c49\n\n### File names:\n\nnssock2.dll\n\n[APT](https://securelist.com/tag/apt/)\n[Backdoor](https://securelist.com/tag/backdoor/)\n[DNS](https://securelist.com/tag/dns/)\n[Supply-chain attack](https://securelist.com/tag/supply-chain-attack/)\n[Targeted attacks](https://securelist.com/tag/targeted-attacks/)\n\nAuthors\n\nGReAT\n\nShadowPad in corporate networks\n\nYour email address will not be published. Required fields are marked *\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-08-15 - ShadowPad in corporate networks.pdf"
    ],
    "report_names": [
        "2017-08-15 - ShadowPad in corporate networks.pdf"
    ],
    "threat_actors": [
        {
            "id": "4c68ccd0-caba-4189-9ead-86ac4c2d9b70",
            "created_at": "2024-05-01T02:03:07.930196Z",
            "updated_at": "2025-03-27T02:05:17.251237Z",
            "deleted_at": null,
            "main_name": "BRONZE ATLAS",
            "aliases": [
                "Axiom",
                "BARIUM ",
                "Blackfly ",
                "CTG-2633",
                "GREF",
                "Group 72 ",
                "Red Kelpie ",
                "TG-2633 ",
                "Wicked Panda ",
                "Winnti",
                "APT41 "
            ],
            "source_name": "Secureworks:BRONZE ATLAS",
            "tools": [
                " CCleaner v5.33 backdoor",
                " ChinaChopper",
                " Cobalt Strike",
                " Dicey MSDN",
                " ForkPlayground",
                " HUC Proxy Malware (Htran)",
                " Mimikatz",
                " PipeMon",
                " PlugX",
                " PortReuse",
                " Powershell Empire",
                " RCMD",
                " RbDoor",
                " SPEEDBOAT",
                " ShadowPad",
                " Sidewalk",
                " Speculoos",
                " TeamViewer",
                " Winnkit",
                " Winnti",
                " reg save",
                " vssadmin",
                "Acehash"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673535948,
    "ts_updated_at": 1743041642,
    "ts_creation_date": 1653703358,
    "ts_modification_date": 1653703358,
    "files": {
        "pdf": "https://archive.orkl.eu/f5e6befd99fa643019a8659475e158ca486a6565.pdf",
        "text": "https://archive.orkl.eu/f5e6befd99fa643019a8659475e158ca486a6565.txt",
        "img": "https://archive.orkl.eu/f5e6befd99fa643019a8659475e158ca486a6565.jpg"
    }
}