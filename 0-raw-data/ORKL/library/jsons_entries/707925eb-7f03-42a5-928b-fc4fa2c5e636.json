{
    "id": "707925eb-7f03-42a5-928b-fc4fa2c5e636",
    "created_at": "2023-01-12T15:01:26.512824Z",
    "updated_at": "2025-03-27T02:09:29.331677Z",
    "deleted_at": null,
    "sha1_hash": "601b1af770c34097b37e976349bc06e9ec284c66",
    "title": "2022-01-25 - How to Analyze Malware for Technical Writing",
    "authors": "",
    "file_creation_date": "2022-05-28T03:58:46Z",
    "file_modification_date": "2022-05-28T03:58:46Z",
    "file_size": 4359228,
    "plain_text": "# How to Analyze Malware for Technical Writing\n\n**[nozominetworks.com/blog/how-to-analyze-malware-for-technical-writing/](https://www.nozominetworks.com/blog/how-to-analyze-malware-for-technical-writing/)**\n\nBy January 25, 2022\n\n## Analyzing New Malware\n\nIn the ever-changing world of cybersecurity, new threats appear and evolve on a regular\nbasis. Sharing information about them is an important part of fighting cybercrime and\nkeeping people and organizations safe. To do so efficiently, being prepared will make the\nbest use of your—and your team’s—time when analyzing an emerging threat.\n\nIn this blog, we cover various situations that researchers encounter when they need to\npublish their findings and provide some suggestions on how to approach them, along with a\nsuggested workflow for approaching the analysis most efficiently. Finally, we apply this\nstrategy to analyze a ransomware sample.\n\n\n-----\n\nEfficient analysis is extremely important when investigating new malware.\n\n## Challenges and Solutions\n\nWhen a new threat emerges, there are a few common challenges that researchers face\nduring analysis. Here are a few ways to handle them so you can produce clear and\npurposeful findings.\n\n**Urgency**\n\nIn many cases, there is a relatively narrow window of time in which to release the publication,\nif we want the topic to be hot and the corresponding material to be relevant.\n\nThe solution is to focus on the most important questions that need answers.\n\nWho are the potential readers of the article? How will they benefit from reading it?\nHow will the time costs associated with each section compare to its benefits?\n\nBeginning your work by answering these questions will help shape the material in the right\ndirection and manage time properly.\n\n**Novelty**\n\n\n-----\n\nFor many attacks that hit the news, the related malware may not yet have been analyzed by\nother researchers. This increases the amount of work required to understand all parts of the\nrelevant functionality, as there is little to no information to use as a starting point.\n\nTo address this issue, it is worth remembering that in many cases, modern malware families\nand attacker groups already have some roots. Tracking these connections allows\nresearchers to find previous iterations of similar projects and reduce the amount of time\nrequired to understand malware’s functionality.\n\n**Complexity**\n\nThe consequences of simple cyberattacks aren’t generally big enough to attract the attention\nof the public. What that means for researchers is that if something is worth writing an article\nabout, it’s likely to be quite complex and therefore time-consuming to analyze.\n\nThe solution here might be to split the big task into smaller tasks. Apart from prioritizing\nbased on the article’s focus, it also allows the analysis to done by a group, with different\npeople focusing on different parts of functionality. Exchanging knowledge on a regular basis\nabout what has already been covered will help the team to be efficient and not waste time\nanalyzing the same parts multiple times.\n\n## Suggested Workflow\n\nHere is a common workflow that should allow researchers to approach the analysis of new\nexecutable samples efficiently and effectively.\n\nThe second step, Behavioral Analysis, refers to the blackbox-style analysis that generally\ninvolves the execution of a sample under various monitoring tools and on sandboxes. The\nDynamic Analysis step refers the use of a debugger to execute instructions.\n\n**Steps** **Actions**\n\n**1. Triage** Collect as much easily-accessible open information as\npossible. This can come from existing articles, public\nsandbox reports, or other vendors’ detections.\nCheck for the presence of high-entropy blocks, import\ntable or syscalls and strings to understand if it likely to be\npacked or not.\nCheck if some official (non-malicious) packers were used\nby using packer detection tools.\n\n\n-----\n\n**Steps** **Actions**\n\n**2. Behavioral Analysis** Conduct this analysis if it is easy to restore the lab\nenvironment after execution.\nIt may not be necessary if good public sandbox reports\nare already available.\nKeep in mind that, often, behavioral analysis doesn’t show\nthe full picture.\nIt may not go as expected because of anti-RE techniques\ninvolved.\n\n\n**3. Unpacking -**\n**Optional**\n\n**4. Static and Dynamic**\n**Analysis of the Actual**\n**Functionality**\n\n\nNot necessarily present, some malware developers prefer\nto only use obfuscation.\nFor official packers, there are multiple existing unpacking\ntools and scripts already available.\nIdeally, the unpacked sample should remain executable to\nmake the dynamic analysis easy. Otherwise, get as much\nunpacked code and data as possible.\n\nThis step only becomes possible once the unpacking is\ndone (if it was necessary).\nGenerally, strings and APIs give the maximum information\nand serve as important landmarks to facilitate navigation\nwithin the samples.\nKeep the markup accurate: rename functions, create\nstructures, define enums and leave comments where\nnecessary.\nDebugging is mainly needed to\ndecrypt/decode/decompress code and data and resolve\nAPIs. Static analysis is generally enough for the rest.\n\n\n## Applying the Workflow to Malware Analysis\n\n[Let’s take a look at a DarkSide ransomware sample, which we analyzed earlier this year:](https://www.nozominetworks.com/blog/colonial-pipeline-ransomware-attack-revealing-how-darkside-works/)\n```\n0a0c225f0e5ee941a79f2b7701f1285e4975a2859eb4d025d96d9e366e81abb9\n\n```\n**Step 1: Triage**\n\nAt the time of analysis, the sample had already been uploaded to Virustotal, so all\ncybersecurity community members could benefit from access and were able to see AV\nvendors’ detections as well as the sandbox logs in the Behavior tab. Note that there are now\nmultiple sandboxes supported in Virustotal, so try a few to find a good report.\n\n\n-----\n\nMultiple sandbox options on Virustotal.\n\nA quick look at the sample in the hex editor reveals that there is a high-entropy block at the\nend. There are multiple things it could be: the next stage payload or another module, a blob\ncontaining encrypted strings or configuration, etc. Static analysis will be required to\nunderstand it.\n\nA high-entropy block.\n\nThere are pretty much no meaningful strings and APIs:\n\n\n-----\n\nVery few entries in the import table.\n\nThis is a strong indicator that the sample is obfuscated with APIs resolved dynamically and\nstrings encrypted. Running a packer detection tool (PEiD with custom community signatures)\nconfirms that there is no indication that public packers have been used in this case.\n\nPEiD did not identify any known packers.\n**Step 2: Behavioral Analysis**\nBy the time the analysis began, the sample had already been submitted to various public\nsandboxes by other community members, so lots of information could be taken from there.\n\n\n-----\n\nFile activity in the public any.run report.\n**Step 3: Unpacking**\nChecking cross-references to the high-entropy block in the disassembler, we can see that\nthis doesn’t seem to be the next stage payload as there is no control transfer to it or related\nblocks. In addition, a quick look around the disassembly confirms that the sample is indeed\nobfuscated rather than packed with multiple APIs resolved dynamically by hashes and with\nstrings encrypted.\n\nAPI resolution by hashes.\n\n\n-----\n\nA call to the not-yet-resolved API.\n**Step 4: Static and Dynamic Analysis of the Actual Functionality**\nIn order to be able to efficiently navigate the disassembly, we need to make APIs and strings\neasily readable.\n\nFor APIs, this is very easy to achieve with dynamic analysis as all the APIs are resolved in a\nsingle function. Therefore, letting it execute until the end will give us all the APIs’ addresses.\nTo propagate their names to the pointers, use standard renimp.idc script shipped as part of\nIDA Pro.\n\nResolved APIs’ names.\nThis approach won’t work for strings, as they’re decrypted on an ad-hoc basis just before\nbeing used, rather than in a single place. Therefore, to make them easily visible, scripting will\nbe required. In our blog on Darkside, we have already provided such a script that will attempt\nto find all the encrypted strings and decrypt them.\n\n\n-----\n\nBefore string decryption.\n\nAfter string decryption.\nThat’s it. Now when both strings and APIs are visible, the only thing left to engineer is to\ncarefully go through cross references and keep the markup for the corresponding functions\ndescribing all potentially interesting information (subject to the target audience) in the article.\n\n\n-----\n\n## Conclusion\n\nKnowledge sharing is an important part of the cybersecurity field that allows us to quickly\nadapt to new threats and minimize their associated risks. By properly focusing our efforts, we\ncan improve the quality of this process and make the world a safer place.\n\n**Extra Tips**\n\n**Know your audience – the content of the technical blog post (and the corresponding**\nquestions to answer) will be very different from a news article for the general public\n**Consider teamwork to speed up the process – Asking for help if at an early stage**\nhelps increase the total time available for the analysis\n**Have your templates ready – simple scripts to decrypt / decode / decompress the**\ndata may help avoid unnecessary delays\n\n**Related Content**\n\nRESEARCH REPORT\n\n## OT/IoT Security Report – 2021 2H\n\nInsights on the latest cyber threats\nHow and why critical infrastructure industries such as transportation and healthcare are\nbeing targeted\n\n\n-----\n\nAnalysis of recent ICS-CERT vulnerabilities and exploitation trends\nRemediation strategies to address today’s emerging threats\n\n[Download](https://www.nozominetworks.com/ot-iot-security-report/)\n**Related Links**\n\nBlog: BlackMatter Ransomware Technical Analysis and Tools from Nozomi Networks\nLabs\nBlog: [Critical Log4shell (Apache Log4j) Zero-Day Attack Analysis](https://www.nozominetworks.com/blog/critical-log4shell-apache-log4j-zero-day-attack-analysis/)\nBlog: [Colonial Pipeline Ransomware Attack: Revealing How DarkSide Works](https://www.nozominetworks.com/blog/colonial-pipeline-ransomware-attack-revealing-how-darkside-works/)\nBlog: [Enhancing Threat Intelligence with the MITRE ATT&CK Framework](https://www.nozominetworks.com/blog/enhancing-threat-intelligence-with-the-mitre-attck-framework/)\n\n[Alexey Kleymenov](https://www.nozominetworks.com/author/alexey-kleymenov/)\n**Sr. Cyber Threat Analyst**\nAlexey Kleymenov performs in-depth research for emerging threats and designs and\ndevelops threat intelligence infrastructure in his role at Nozomi Networks. He is passionate\nabout reverse engineering, prototyping, process automation and research. His background\nincludes 12+ years of practical experience with several anti-virus companies and he is a\nmember of the (ISC)² organization.\n\nAlexey is the author of the book “Mastering Malware Analysis: The complete malware\nanalyst’s guide to combating [malicious software, APT, cybercrime, and IoT attacks.”](https://www.amazon.com/gp/product/B07SSK5HLT/ref=dbs_a_def_rwt_hsch_vapi_tkin_p1_i0)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-01-25 - How to Analyze Malware for Technical Writing.pdf"
    ],
    "report_names": [
        "2022-01-25 - How to Analyze Malware for Technical Writing.pdf"
    ],
    "threat_actors": [
        {
            "id": "bf6cb670-bb69-473f-a220-97ac713fd081",
            "created_at": "2022-10-25T16:07:23.395205Z",
            "updated_at": "2025-03-27T02:02:09.777308Z",
            "deleted_at": null,
            "main_name": "Bitter",
            "aliases": [
                "T-APT-17",
                "TA397"
            ],
            "source_name": "ETDA:Bitter",
            "tools": [
                "Artra Downloader",
                "ArtraDownloader",
                "Bitter RAT",
                "BitterRAT",
                "Dracarys"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "655f7d0b-7ea6-4950-b272-969ab7c27a4b",
            "created_at": "2022-10-27T08:27:13.133291Z",
            "updated_at": "2025-03-27T02:00:55.490812Z",
            "deleted_at": null,
            "main_name": "BITTER",
            "aliases": [
                "T-APT-17"
            ],
            "source_name": "MITRE:BITTER",
            "tools": [
                "ZxxZ"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535686,
    "ts_updated_at": 1743041369,
    "ts_creation_date": 1653710326,
    "ts_modification_date": 1653710326,
    "files": {
        "pdf": "https://archive.orkl.eu/601b1af770c34097b37e976349bc06e9ec284c66.pdf",
        "text": "https://archive.orkl.eu/601b1af770c34097b37e976349bc06e9ec284c66.txt",
        "img": "https://archive.orkl.eu/601b1af770c34097b37e976349bc06e9ec284c66.jpg"
    }
}