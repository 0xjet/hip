{
    "id": "f05fb3cb-ebc9-404a-a6f6-412c7e80e8ef",
    "created_at": "2023-01-12T14:59:37.358225Z",
    "updated_at": "2025-03-27T02:09:18.107118Z",
    "deleted_at": null,
    "sha1_hash": "ec84866f977bf583e7f3acb9c27a62e6d24983a2",
    "title": "2022-04-12 - SystemBC Being Used by Various Attackers",
    "authors": "",
    "file_creation_date": "2022-05-28T23:24:42Z",
    "file_modification_date": "2022-05-28T23:24:42Z",
    "file_size": 2380678,
    "plain_text": "# SystemBC Being Used by Various Attackers\n\n**asec.ahnlab.com/en/33600/**\n\nApril 12, 2022\n\nSystemBC is a proxy malware that has been used by various attackers for the last few years.\nWhile it is recently distributed through SmokeLoader or Emotet, this malware has steadily\nbeen used in various ransomware attacks in the past. When an attacker attempts to access\na certain address with malicious intent, the system can be used as a passage if the infected\nsystem utilizes SystemBC, which acts as a Proxy Bot. Because it can also act as a\ndownloader to install additional malware externally, attackers can also use it to install\nadditional payloads.\n\n## Previous Distribution Cases\n\nSystemBC’s distribution using RIG exploit kit and Fallout exploit kit was first discovered in\n[2019. [1] The initial version found in 2019 focused mainly on Socks5 Proxy features and had](https://www.proofpoint.com/us/threat-insight/post/systembc-christmas-july-socks5-malware-and-exploit-kits)\na small size. According to ProofPoint which first discovered SystemBC, the developer of the\nmalware had a history of selling it under the name “socks5 backconnect system.”\n\nSystemBC discovered in 2020 was used with Ryuk or Egregor in ransomware attacks. It was\nalso the malware used by the DarkSide ransomware group, which used it to attack Colonial\nPipeline, a U.S. pipeline company. [[2] Unlike ransomware distributed through exploit kits,](https://news.sophos.com/en-us/2021/05/11/a-defenders-view-inside-a-darkside-ransomware-attack/)\nweb browsers, or spam emails, attackers using this type of malware install ransomware after\n\n\n-----\n\ndominating the company environment system, then demand money. In other words, they\ndominate the internal network using tools such as Cobalt Strike after the initial infiltration and\ninfect various systems within a company by installing ransomware.\n\nThe role of SystemBC in such an attack is not known in detail. Yet as it can act as a proxy\nand install additional payloads after downloading them, it might download and execute\nmalicious payloads or be installed in internal networks to perform the role of a proxy. In fact,\n[according to a report made by F-Secure [3] that found an attack using SystemBC, the](https://labs.f-secure.com/blog/prelude-to-ransomware-systembc/)\nmalware was used for downloading and running PsExec and scripts for lateral movement\nattacks.\n\n## Recent Distribution Cases\n\nIn March 2022, it was found that SystemBC was being installed as an additional payload by\nEmotet. Emotet is a banking malware that installs additional modules or malware strains to\nsteal credentials from the infected system. Normally, the attackers install Cobalt Strike\nthrough Emotet to dominate the infected system, but recently, SystemBC is also being\ndistributed.\n\n[#Emotet E5 Update – Within the last several hours, we have seen some bots on the](https://twitter.com/hashtag/Emotet?src=hash&ref_src=twsrc%5Etfw)\nEpoch 5 botnet begin to drop SystemBC now as a module and execute it. This is the\nfirst drop beyond Cobalt Strike that we have seen since Emotet returned. This is a\nsignificant change 1/x\n\n[— Cryptolaemus (@Cryptolaemus1) March 10, 2022](https://twitter.com/Cryptolaemus1/status/1502069552246575105?ref_src=twsrc%5Etfw)\n\nAccording to AhnLab’s ASD infrastructure, most of the recent cases involving SystemBC\nhave the malware installed by SmokeLoader. SmokeLoader operates by being injected into\nexplorer.exe (Windows Explorer that is currently being run) and can install additional\nmodules or malware. The figure below shows the log of the injected Explorer process\ninstalling SystemBC.\n\nFigure 1. SystemBC installed by SmokeLoader\n\n\n-----\n\nSmokeLoader is recently installed through Muldrop, an NSIS dropper malware distributed\nthrough malicious websites disguised as cracks and serial download pages of commercial\nsoftware. Besides Muldrop, CryptBot and PseudoManuscrypt are also distributed in such a\nmethod.\n\n## Analysis of SystemBC\n\nSystemBC has a number of variants. The exact order is not confirmed, but the variants are\ncategorized based on their additional features. Unlike Type 1 which is an early version and\ncan only update itself, Type 2 can run scripts such as Batch, VBS, and PowerShell after\ndownloading them. It can also download malware in DLL and Shellcode forms to execute\nthem in the memory. In addition, the malware can communicate with the C&C server through\nthe Tor network. [[4] Type 3, the second variant, lacks certain features including being able to](https://news.sophos.com/en-us/2020/12/16/systembc/)\nuse the Tor network and execute DLL and Shellcode after downloading them.\n\nThis post will discuss the analysis of SystemBC type that can currently communicate with the\nC&C server. To be more precise, it is an analysis of Type 2, which has most of the features of\nType 1 and Type 3. The malware was found to be installed through RedLine, packed with the\npacker that was used for the type distributed through SmokeLoader. SystemBC known to be\ninstalled through Emotet is Type 3.\n\nInitial Routine\n\nWhen SystemBC is initially run, it first checks if the argument is “start”. It will not have an\nargument when it is executed for the first time. In this case, it checks the windows of the\ncurrently running processes. If there is a process with “Microsoft” as the window name and\n“win32app” as the class name, it will send the message “WM_COPYDATA” and goes\ndormant for a certain amount of time. Afterward, it deletes the file for the process.\n\nFigure 2. Process handling\n\nfunction that has a certain window\n\n\n-----\n\nSystemBC first registered a window class and created a window. The name of the window\nand class is “Microsoft” and “win32app” respectively. As shown in the figure below, the\nfollowing windows and classes can be seen when SystemBC is executed.\n\nFigure 3. Windows and classes of SystemBC being run\nThe message handling function registered at this moment deletes and terminates a process\nregistered as “certain random string” when it receives the message “WM_COPYDATA”. In\nsummary, SystemBC checks for the SystemBC process that has been running when it is\nexecuted for the first time. If there is one, it sends a message to terminate the old SystemBC.\nThe previous SystemBC that received the message deletes the task it is registered to and\nterminates itself, and SystemBC that was executed later deletes the binary of the previous\none.\n\nIt then scans the process named “a2guard.exe” which is assumed to be a product of Emisoft.\nIf the process is running, it terminates itself and will no longer perform malicious behaviors.\nLastly, it copies the binary of the currently running SystemBC as a random name in\n%ALLUSERSPROFILE% (in the random folder of the ProgramData path) and registers it as\na task named “certain random string” again. The process uses COM objects, TaskScheduler\nclass, and methods of the Task class.\n\nFigure 4. Process for registering the task using COM objects\nThe task starts 2 minutes after the current time and is run every 2 minutes. The target that is\nexecuted is SystemBC, and designates “start” as an argument. SystemBC can download\npayloads in exe form from the C&C server and run them. If the downloaded executable is\nSystemBC with the latest version, the process then becomes a binary update for SystemBC.\n\nC&C Communications\n\n\n-----\n\nSystemBC executed with the start argument attempts to communicate with the C&C server.\nIt has the URL of the C&C server in the data section in XOR-encrypted form. The malware\ndecrypts the C&C server address and port number before communicating with the C&C\nserver. If it cannot access the first URL, it will attempt to communicate with the second one.\nSince the current analysis target does not have its settings data encrypted, one can check it\nin its plain form. If the “xordata” string exists below the settings data, the XOR encoding will\nnot be processed. The 0x32 byte-sized data that has the string is the value for the RC4 key.\nIf a normal RC4 key value exists, the XOR encoding will be processed.\n\nFigure 5.\n\nSettings data of SystemBC\n```\n- C&C Server URL 1 : 31.44.185[.]6:4001\n- C&C Server URL 2 : 31.44.185[.]11:4001\n\n```\nAs shown below, SystemBC first collects the basic information of the infected system. When\nthe currently running SystemBC process is executed as an admin privilege (High Integrity\nLevel or higher), Offset 0x34 among the following items is set as 0x2. If not, it is set as 0.\n\n**Offset** **Size** **Data**\n\n+0x00 0x32 RC4 key\n\n+0x32 0x02 Windows ver.\n\n+0x34 0x01 Admin privilege status (0x02)\n\n+0x35 0x01 WOW64 availability\n\n+0x36 0x2A User name\n\n+0x60 0x04 Volume serial number\n\nTable 1. Data to be sent to C&C server\nThe data shown below has a size of 0x64 byte. It first uses the 0x32 byte-sized RC4 key to\nRC4-encrypt the 0x32 byte in the back. The C&C server that received the data can decrypt\nthe 0x32 byte-sized information of the infected system with the RC4 key of the first 0x32\nbyte.\n\n\n-----\n\nFigure 6. RC4 key and information collected from the infected system\n```\n- RC4 Key: 78 6F 72 64 61 74 61 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n\n```\nFigure 7. Communication packet with the C&C server\nThe encrypted data is then sent to the C&C server. SystemBC uses the Raw TCP socket to\ncommunicate with the C&C server. When the server receives information from the malware,\nit uses the same RC4 key to send the encrypted command data. The following is encrypted\ndata sent from the C&C server.\n\nFigure 8.\n\nData received from the C&C server\nSystemBC decrypts the first 4 bytes, which can be considered as a header of the C&C\ncommand. The header can be divided into 3 main parts: command, secondary command,\nand data size. The 4 byte that comes after means tokens, and the rest includes command\n\n\n-----\n\ndata.\n\n**Offset** **Size** **Data**\n\n+0x00 0x01 Command\n\n+0x01 0x01 Secondary Command\n\n+0x02 0x02 Data Size\n\n+0x04 0x04 Token\n\n+0x08 Variable Command Data\n\nTable 2. Downloaded packet structure\nThe command currently received is 0xFFFF2B00. This means the malware received the data\nwith the size of 0x002B. Decrypting the 0x002B-sized data following behind will reveal the\ntoken and URL. Since the command is 0xFFFF, the malware will run the files after\ndownloading them from the URL.\n\n\n**Command** **Secondary**\n**Command**\n\n\n**Size** **Feature**\n\n\n0xFF 0xFF Variable Download payload\n\n0xFF 0xFE 0x00 Terminate\n\n0x00 – Variable Create a new Proxy for the target\n\n\n– Index[0x00 –\n0xFF]\n\n– Index[0x00 –\n0xFF]\n\n\nVariable Sends the data received from the C&C server to\nthe designated target in Index\n\n0x00 Terminate Proxy with the designated target\n\n\nTable 3. Types of C&C commands\nNote that the exe malware downloaded currently is also SystemBC; this indicates that the\ncommand is for updating the binary.\n```\n- Download URL: hxxp://michaelstefensson[.]com/supd/s.exe\n\n```\n\n-----\n\nFigure 9. URL for downloading additional payloads\nSystemBC uses Raw TCP socket again for HTTP communications. The following is a UserAgent string used for downloading binaries from the URL that was sent.\n```\nGET %s HTTP/1.0\nHost: %s\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:66.0) Gecko/20100101\nFirefox/66.0\nConnection: close\n\n```\nAfter the download is complete, the malware sends the result encrypted with RC4 to the\nC&C server. The data that will be sent include 0xFF (secondary command used for\ndownloading payloads), 0x04 (data size that will be sent), and 0x07 (including the token\nvalue 0x04 byte that was sent earlier).\n\nFigure 10. Sending response to the C&C server\n\n\n-----\n\n**Offset** **Size** **Data**\n\n+0x00 0x01 Secondary Command\n\n+0x01 0x02 Data Size\n\n+0x03 0x04 Token\n\nTable 4. Structure of the packet sent to the C&C server\nThe download URLs that were sent are categorized depending on the file extension and\nformat.\n\n**Type** **Extension** **Format** **Feature**\n\nexe exe – Self-update for SystemBC\n\nVBS script .vbs – Run VBS script\n\nBatch script .bat – Run Batch script\n\nBatch script .cmd – Run Batch script\n\n\nPowershell\nScript\n\n\n.ps1 – Run Powershell script\n\n\nDLL – DLL Load DLL in the memory\nRun the function of DLL if the URL has # at\nthe back\n\n\nShellcode – Encoded\nform\n\nTable 5. Payload that can be downloaded\n\n\nRun Shellcode in the memory\n\n\n-----\n\nFigure 11. Categorization based on extensions and formats\nThe malware creates normal files in the Temp path and registers the files in the task\nscheduler to run them. For Powershell scripts, it additionally uses command lines such as “WindowStyle Hidden -ep bypass -file”.\n\nIf the downloaded payload is DLL, it assigns memory and loads it to run as a new thread. If\nthe “#” string is behind the URL sent from the C&C server, it calls the export function from the\ndownloaded DLL. For Shellcode, the malware also runs it as a new thread going through the\ndecoding routine. As a result, DLL and Shellcode are not created as files but run in the\nmemory of SystemBC.\n\nTOR Communications\n\nBecause the current analysis target does not have a Tor URL, the team will discuss a\nprevious case where Tor network communication was possible. The malware in this case has\nthe C&C server URLs encoded as shown below. If it cannot access both servers, it uses Tor\nto access another server.\n```\n- C&C Server URL 1: admex175x[.]xyz:4044\n- C&C Server URL 2: servx278x[.]xyz:4044\n\n```\nTo do so, it accesses the following URLs to obtain a public IP address. The address is then\nencoded with the data that will be sent to the C&C server and sent.\n```\nhttps://api.ipify.org/\nhttps://ip4.seeip.org/\n\n```\n\n-----\n\n[SystemBC is known to utilize the mini-tor[5] library to use the Tor network.[6] It first goes](https://github.com/wbenny/mini-tor)\nthrough the reset process to access Tor. By randomly selecting one of the IP addresses of\nthe hard-coded Authoritative Directory Server, it gets the Consensus data for the Tor\nnetwork. Then it will start Tor communications based on the settings data it received.\n\nFigure 12. Obtaining Tor Consensus data\n```\n193.23.244[.]244:80\n86.59.21[.]38:80\n199.58.81[.]140:80\n204.13.164[.]118:80\n194.109.206[.]212:80\n131.188.40[.]189:80\n154.35.175[.]225:80\n171.25.193[.]9:443\n128.31.0[.]34:9131\n128.31.0[.]39:9131\n\n```\nThe malware then obtains the Tor C&C URL. As seen below, Tor C&C URL needs an\nadditional decryption process, unlike normal C&C URLs that can be checked in text after Xor\ndecryption. The part that comes after the “TOR:” string is the Tor C&C URL that is decrypted\nfor the first time. The actual URL will be revealed through the additional decryption process.\n\nFigure 13. Xor\nencoded settings data\n\n\n-----\n\nFigure 14. C&C\n\nURL that is ultimately decrypted\n```\n- C&C URL (Tor): dfhg72lymw7s3d7b[.]onion:4044\n\n```\nAfter normally accessing the Tor network, the malware will send the information of the\ninfected system including the public IP address that was mentioned earlier. This method is\nidentical to other methods of using Raw TCP socket communications, except that it sends\ndata by using the Tor network. So the malware will send the data encrypted with RC4\nalgorithm and receive C&C commands encrypted with the same key as in previous cases.\nThe case is also the same for the HTTP communications used for downloading additional\npayloads.\n\nFigure 15. C&C\n\ncommand received through Tor\n```\n- Download URL: http://5.61.33[.]200/henos.exe\n\n```\nSOCKS5 PROXY\n\nBesides downloader, the main features of SystemBC include being able to operate as Proxy\nBot. The figure below shows the commands related to proxies that were mentioned above.\nEach line creates a socket for the proxy and processes certain proxy packets.\n\n\n-----\n\nFigure 16.\n\nSocks5 proxy routine\nIf the attacker wants to use an infected system as Proxy Bot (using SystemBC of the infected\nsystem when accessing a certain address), a command to create proxies will be sent first.\nSystemBC creates a socket depending on the type when it receives a command to create\nproxies. The created socket will be managed by index.\n\nAfter the socket is created, the malware will create a new thread and connect to the address\nit received. The reason the attacker initially named the malware BackConnect is because\nSystemBC first connects to the attacker’s server instead of the attacker manually accessing\nSystemBC to attempt Socks5 proxy connection. Since SystemBC cannot be accessed\nexternally if it is installed in the system of a private IP band, malware strains with the Proxy\nfeature mainly use the Reverse Proxy method.\n\nShould the attacker send requests to a certain address later, they will send the created proxy\nsocket with the assigned index. SystemBC will then send the data it received to the address.\nThe data received will be sent to the C&C server through SystemBC. SystemBC thus acts as\nProxy Bot, allowing the attacker to hide the IP when performing attacks. If the malware\noperates in the system that can access internal networks, the networks can be accessed by\nthe external attacker through SystemBC.\n\nComparison with Previous Versions\n\n\n-----\n\nThe post discussed Type 2 which supports most of the features, but each type has minor\nvariations in the features it supports.\n\n**Type 1** **Type 2** **Type 3**\n\n\nRecursive\nExecution\nArgument\n\nScan Emisoft\nproduct\n\n\n“Start2” “start” “start”\n\nO O X\n\n\nInstallation Path %ALLUSERSPROFILE%\\\n\n[Random]\n\n\n%ALLUSERSPROFILE%\\\n\n[Random]\n\nBatch, VBS, PowerShell,\nDLL, Shellcode, and\nupdate\n\n\nCurrent Path\n\nBatch, VBS,\nPowerShell,\nand update\n\n\nDownloader\nfeature\n\nSupport URL\nshortener .bit\n\n\nX (has only update\nfeature)\n\n\nO X X\n\n\nTable 6. Differences in each Type\nType 1 supports the URL shortener “.bit”. The following settings data of the malware has the\nlist of DNS servers besides C&C URL and port number.\n\nFigure\n\n17. List of DNS servers in settings data\n\n\n-----\n\n```\n C&C Server URL 1: db1.pushsecs[.]info:40690\n- C&C Server URL 2: db2.pushsecs[.]info:40690\n- DNS Server URL 1: 5.132.191[.]104\n- DNS Server URL 2: ns1.vic.au.dns.opennic[.]glue\n- DNS Server URL 3: ns2.vic.au.dns.opennic[.]glue\n\n```\nIf the C&C server URL ends it “.bit”, the malware obtains the IP address of the server by\nusing the DNS servers listed above.\n\nFigure 18. DNS query routine for .bit URL\n\n## Conclusion\n\nEver since SystemBC was distributed through exploit kits in the past, the malware has been\ninstalled through other malware strains from malicious websites disguised as download\npages for cracks and serials of commercial software until recently. While it was used for\nattacks targeting normal users, it was also employed by attackers in multiple ransomware\nattacks targeting companies to achieve their goals.\n\nAfter it is installed, SystemBC stays in the infected system to download additional payloads.\nMoreover, it can also act as Proxy Bot, meaning that the system can become a passageway\nfor other attackers. Users should apply the latest patch for OS and programs such as\nInternet browsers, and update V3 to the latest version to prevent malware infection in\nadvance.\n\nAhnLab’s anti-malware software, V3, detects and blocks the malware above using the\naliases below.\n\n**[File Detection]**\n\n– Trojan/Win.MalPE.R480644 (2022.03.29.02)\n\n– Trojan/Win.Generic.C5006057 (2022.03.11.03)\n\n– Malware/Win32.RL_Generic.R358611 (2020.12.18.01)\n\n– Trojan/Win32.Agent.C3511593 (2019.10.14.08)\n\n\n-----\n\n**[IOC]**\n**Type 1 MD5**\n– beb92b763b426ad60e8fdf87ec156d50\n\n**Type 2 MD5**\n– 8e3a80163ebba090c69ecdeec8860c8b\n– 28c2680f129eac906328f1af39995787\n\n**Type 3 MD5**\n– ae3f6af06a02781e995650761b3a82c6\n\n**Type 1 C&C**\n– db1.pushsecs[.]info:40690\n– db2.pushsecs[.]info:40690\n\n**Type 2 C&C**\n– 31.44.185[.]6:4001\n– 31.44.185[.]11:4001\n– admex175x[.]xyz:4044\n– servx278x[.]xyz:4044\n– dfhg72lymw7s3d7b[.]onion:4044\n\n**Type 3 C&C**\n– 96.30.196[.]207:4177\n– 45.32.132[.]182:4177\n\n**Download URLs**\n– hxxp://michaelstefensson[.]com/supd/s.exe\n– hxxp://5.61.33[.]200/henos.exe\n\n**Subscribe to AhnLab’s next-generation threat intelligence platform ‘AhnLab TIP’ to**\n**check related IOC and detailed analysis information.**\n\n[Categories:Malware Information](https://asec.ahnlab.com/en/category/malware-information/)\n\n[Tagged as:Downloader,](https://asec.ahnlab.com/en/tag/downloader-en/) [proxy,](https://asec.ahnlab.com/en/tag/proxy-en/) [Ransomware,](https://asec.ahnlab.com/en/tag/ransomware-en/) [SmokeLoader,](https://asec.ahnlab.com/tag/smokeloader/) [SystemBC](https://asec.ahnlab.com/tag/systembc/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-04-12 - SystemBC Being Used by Various Attackers.pdf"
    ],
    "report_names": [
        "2022-04-12 - SystemBC Being Used by Various Attackers.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535577,
    "ts_updated_at": 1743041358,
    "ts_creation_date": 1653780282,
    "ts_modification_date": 1653780282,
    "files": {
        "pdf": "https://archive.orkl.eu/ec84866f977bf583e7f3acb9c27a62e6d24983a2.pdf",
        "text": "https://archive.orkl.eu/ec84866f977bf583e7f3acb9c27a62e6d24983a2.txt",
        "img": "https://archive.orkl.eu/ec84866f977bf583e7f3acb9c27a62e6d24983a2.jpg"
    }
}