{
    "id": "a1fabdf8-b3e8-42f7-9de3-fca645514bc2",
    "created_at": "2022-10-25T16:48:17.390411Z",
    "updated_at": "2025-03-27T02:13:09.660244Z",
    "deleted_at": null,
    "sha1_hash": "fa92c0e06a7469a3dab6a34d37528bc173d517eb",
    "title": "",
    "authors": "",
    "file_creation_date": "2019-08-16T02:09:18Z",
    "file_modification_date": "2019-08-16T02:09:18Z",
    "file_size": 187101,
    "plain_text": "# An (un)documented Word feature abused by attackers\n\n**[securelist.com/an-undocumented-word-feature-abused-by-attackers/81899](https://securelist.com/an-undocumented-word-feature-abused-by-attackers/81899/)**\n\nBy Alexander Liskin, Anton Ivanov, Andrey Kryukov on September 18, 2017. 9:00 am\n\nA little while back we were investigating the malicious activities of the Freakyshelly targeted\nattack and came across spear phishing emails that had some interesting documents attached to\nthem. They were in OLE2 format and contained no macros, exploits or any other active content.\nHowever, a close inspection revealed that they contained several links to PHP scripts located on\nthird-party web resources. When we attempted to open these files in Microsoft Word, we found\nthat the application addressed one of the links. As a result, the attackers received information\nabout the software installed on the computer.\n\nWhat did the bad guys want with that information? Well, to ensure a targeted attack is successful,\nintelligence first needs to be gathered, i.e. the bad guys need to find ways to reach prospective\nvictims and collect information about them. In particular, they need to know the operating system\nversion and the version of some applications on the victim computer, so they can send it the\nappropriate exploit.\n\nIn this specific case, the document looked like this:\n\nThere’s nothing suspicious about it at first glance – just a few tips about how to use Google\nsearch more effectively. The document contains no active content, no VBA macros, embedded\nFlash objects or PE files. However, when the user opens the document, Word sends the following\nGET request to one of the internal links. So we opened the original document used in the attack,\nreplaced the suspicious links with http://evil-*, and obtained the following:\n\n_GET http://evil-333.com/cccccccccccc/ccccccccc/ccccccccc.php?cccccccccc HTTP/1.1_\n_Accept: */*_\n_User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; Trident/4.0; SLCC2; .NET CLR_\n_2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C;_\n_InfoPath.2; MSOffice 12)_\n\n\n-----\n\n_Accept-Encoding: gzip, deflate_\nHost: evil-333.com\nProxy-Connection: Keep-Alive\n\nThis code effectively sent information about the software installed on the victim machine to the\nattackers, including info about which version of Microsoft Office was installed. We decided to\nexamine why Office followed that link, and how these links can be identified in documents.\n\n## Inside a Word document\n\nThe first thing about the document that caught our eye was the INCLUDEPICTURE field\ncontaining one of the suspicious links. However, as can be seen, that is not the link that Word\naddresses.\n\nAs a matter of fact, the data chunk seen in the fragment above contains the first and only piece of\ntext in this document. The text in Word documents resides in the WordDocument stream in a ‘raw\nstate’, i.e. it contains no formatting except so-called fields. The fields tell Word that a certain\nsegment of the text must be presented in a specific way; for example, it is thanks to these fields\nthat we can see active links to other pages of the document, URL links, etc. The field\nINCLUDEPICTURE indicates that an image is attached to certain characters in the text. The 0x13\nbyte (marked in red) in front of this field indicates that the ‘raw’ text ends there and a field\ndescription begins. The description format is roughly as follows (according to [MS-DOC]: Word\n(.doc) Binary File Format):\n\n_Begin = 0x13_\n_Sep = 0x14_\n_End = 0x15_\n_Field = <Begin> *<Field> [Sep] *<Field> <End>_\n\nThe separator byte 0x14 is marked in yellow, and the field end byte 0x15 is shown inside the pink\nbox.\n\nThe link to the image in the INCLUDEPICTURE field should be in ASCII format, but in this case it\nis in Unicode, so Word ignores the link. However, the separator byte 0x14 is followed by the byte\n0x01 (shown in the green box) which indicates to the word processor that an image should be\ninserted at this point. The question is: how do we find this image?\n\n\n-----\n\ndocument streams under the names xTable and Data . We will not go into the complex details of\nhow to analyze character properties, but as a result of this analysis we can find the character\nproperties from the offset 0x929 to 0x92C in the WordDocument stream:\n\nThis is the byte sequence with the picture placeholder 0x14 0x01\n0x15. In the actual document, these bytes are located at offsets\n0xB29 – 0xB2C, but the WordDocument stream begins with offset\n0x200, and the character offsets are specified relative to its\nbeginning.\n\nThe properties of the group of characters CP[2] indicate that an image is attached to them that is\nlocated in the Data stream at offset 0:\n\n_1FEF: prop[0]: 6A03 CPicLocation_\n_1FF1: value[0]: 00000000 ; character = 14_\n\nWe arrive at this conclusion based on the fact that byte 0x01 is indicated in the\nINCLUDEPICTURE field’s value – this means the image should be located in the Data stream at\nthe appropriate offset. If this value were different, then it would have been necessary to look for\nthe image in a different place or ignore this property.\n\nThis is where we stumbled on an undocumented feature. Microsoft Office documentation provides\nbasically no description of the INCLUDEPICTURE field. This is all there is:\n\n_0x43 INCLUDEPICTURE Specified in [ECMA-376] part 4, section 2.16.5.33._\n\nStandard ECMA-376 describes only that part of INCLUDEPICTURE that precedes the separator\nbyte. It has no description of what the data that follows it may mean, and how it should be\ninterpreted. This was the main problem in understanding what was actually happening.\n\nSo, we go to offset 0 in the Data stream and see that the so-called SHAPEFILE form is located\nthere:\n\nForms are described in a different Microsoft document: [MSODRAW]: Office Drawing Binary File Format. This form has a\nname and, in this case, it is another suspicious link:\n\nHowever, this is just an object name, so this link is not used in\nany way. While investigating this form further, let’s look at the flags field\n(in the red box):\n\nThe value 0x0000000E resolves into a combination of three flags:\n\n\n-----\n\nThis indicates that additional data should be attached to the form (it is highlighted in yellow in the\nscreenshot), and that this data constitutes a URL that leads to the actual content of the form.\nAlso, there is a ‘do not save’ flag, which prevents this content from being saved to the actual\ndocument when it is opened.\n\nIf we look at what this URL is, we see that it’s the actual link that Word follows when the\ndocument is opened:\n\nWe should note that besides Word for Windows, this ‘feature’ is also present in Microsoft Office\nfor iOS and in Microsoft Office for Android; LibreOffice and OpenOffice do not have it. If this\ndocument is opened in LibreOffice or OpenOffice, the malicious link is not called.\n\nThis is a complex mechanism that the bad guys have created to carry out profiling of potential\nvictims for targeted attacks. In other words, they perform serious in-depth investigations in order\nto stay undetected while they carry out targeted attacks.\n\nKaspersky Lab’s security products are able to detect when the technique described in this article\nis used in Microsoft Word documents, and to find links embedded in a document using the same\ntechnique.\n\n\nhttps://youtu.be/_GsABMeZrdY\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2017/2017.09.18.Windows_branch_of_the_Cloud_Atlas/An%20%28un%29documented%20Word%20feature%20abused%20by%20attackers%20_%20Securelist.pdf"
    ],
    "report_names": [
        "An (un)documented Word feature abused by attackers _ Securelist"
    ],
    "threat_actors": [
        {
            "id": "02c9f3f6-5d10-456b-9e63-750286048149",
            "created_at": "2022-10-25T16:07:23.722884Z",
            "updated_at": "2025-03-27T02:02:09.945869Z",
            "deleted_at": null,
            "main_name": "Inception Framework",
            "aliases": [
                "ATK 116",
                "Blue Odin",
                "Clean Ursa",
                "Cloud Atlas",
                "Inception Framework",
                "Operation Cloud Atlas",
                "Operation RedOctober",
                "The Rocra"
            ],
            "source_name": "ETDA:Inception Framework",
            "tools": [
                "Lastacloud",
                "PowerShower",
                "VBShower"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "77b28afd-8187-4917-a453-1d5a279cb5e4",
            "created_at": "2022-10-25T15:50:23.768278Z",
            "updated_at": "2025-03-27T02:00:55.5423Z",
            "deleted_at": null,
            "main_name": "Inception",
            "aliases": [
                "Inception Framework",
                "Cloud Atlas"
            ],
            "source_name": "MITRE:Inception",
            "tools": [
                "PowerShower",
                "VBShower",
                "LaZagne"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "04a7ebaa-ebb1-4971-b513-a0c86886d932",
            "created_at": "2023-01-06T13:46:38.784965Z",
            "updated_at": "2025-03-27T02:00:02.91817Z",
            "deleted_at": null,
            "main_name": "Inception Framework",
            "aliases": [
                "ATK116",
                "Blue Odin",
                "Clean Ursa",
                "Cloud Atlas",
                "G0100"
            ],
            "source_name": "MISPGALAXY:Inception Framework",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1666716497,
    "ts_updated_at": 1743041589,
    "ts_creation_date": 1565921358,
    "ts_modification_date": 1565921358,
    "files": {
        "pdf": "https://archive.orkl.eu/fa92c0e06a7469a3dab6a34d37528bc173d517eb.pdf",
        "text": "https://archive.orkl.eu/fa92c0e06a7469a3dab6a34d37528bc173d517eb.txt",
        "img": "https://archive.orkl.eu/fa92c0e06a7469a3dab6a34d37528bc173d517eb.jpg"
    }
}