{
    "id": "432cf3af-937c-4dcd-bcb9-d05122d35dbb",
    "created_at": "2023-01-12T15:01:52.928021Z",
    "updated_at": "2025-03-27T02:06:09.165394Z",
    "deleted_at": null,
    "sha1_hash": "8cff1554b142483688152ac0f70614f541e7b037",
    "title": "2022-03-31 - VIASAT incident- from speculation to technical details.",
    "authors": "",
    "file_creation_date": "2022-05-28T19:05:34Z",
    "file_modification_date": "2022-05-28T19:05:34Z",
    "file_size": 2536386,
    "plain_text": "# VIASAT incident: from speculation to technical details.\n\n**[reversemode.com/2022/03/viasat-incident-from-speculation-to.html](https://www.reversemode.com/2022/03/viasat-incident-from-speculation-to.html)**\n\n[34 days after the incident, yesterday Viasat published a statement providing some technical](https://www.viasat.com/about/newsroom/blog/ka-sat-network-cyber-attack-overview/)\ndetails about the attack that affected tens of thousands of its SATCOM terminals. Also\nyesterday, I eventually had access to two Surfbeam2 modems: one was targeted during the\nattack and the other was in a working condition. Thank you so much to the person who\ndisinterestedly donated the attacked modem.\n\n[I've been closely covering this issue since the beginning, providing a plausible theory based](https://www.reversemode.com/2022/03/satcom-terminals-under-attack-in-europe.html)\non the information that was available at that time, and my experience in this field. Actually, it\nseems that this theory was pretty close to what really happened.\n\n\n-----\n\nFortunately, now we can move from just pure speculation into something more tangible, so I\n[dumped the flash memory for both modems (Spansion S29GL256P90TFCR2) and the](https://www.datasheetq.com/datasheet-download/597536/1/Spansion/S29GL256P90TFCR2)\ndifferences were pretty clear. In the following picture you can see 'attacked1.bin', which\nbelongs to the targeted modem and 'fw_fixed.bin', coming from the modem in working\nconditions.\n\nA destructive pattern, that corrupted the flash memory rendering the SATCOM modems\ninoperable, can be observed on the left, confirming what Viasat stated yesterday.\n\nAfter verifying the destructive attack, I'm now statically analyzing the firmware extracted from\nthe 'clean' modem. Firmware version is 3.7.3.10.9, which seems to date back to late 2017.\n\nBesides talking about a 'management network' and 'legitimate management commands',\nViasat did not provide any specific details about this. In my previous blog post I introduced\nthe theory that probably 'TR069' was the involved management protocol.\n\nObviously, I can't completely confirm this scenario but I'll try to elaborate my reasoning.\n\n## Attacking via a management protocol\n\nI think there are two main options: either the attackers abused a MAC management protocol\nor an application layer one.\n\nFor the MAC case ('ut_mac' binary), in general terms, the attackers would have required an\neven more privileged access to either the NOC or the Ground Stations, probably in a\npersistent way via malware. I guess that this kind of privileged access would have been\nenough to limit the attack to Ukraine, instead of knocking out half Europe. As a result, I'm\ninclined to think this was not the case.\n\n\n-----\n\nOn the other hand, a misconfigured VPN that enabled the attackers to reach the\n'management segment' and execute 'commands' seems to be more related to an application\nlayer management protocol: SNMP or TR069.\n\n**SNMP**\n\nAn initial analysis of 'vsatSb2Ut.so' shows that the implemented MIB does not seem to\nprovide the required functionality to perform this kind of attack.\n\nI would initially discard this option.\n\n**TR069**\n\n\n-----\n\nAs suggested in the previous blog post, the Surfbeam2 modems are deployed with the\n[Axiros' AXACT client. The nature of the operations performed by TR069 clients makes them](https://www.axiros.com/products/axact-embedded-connectivity)\nvery convenient for an attack of this type.\n\ncwmpdefault.xml\nBy reverse engineering the 'cwmpclient' binary it is possible to recover the Viasat's TR069\ndata model, analyze how it has been implemented as well as how it communicates with\nother components to perform the required actions (via IPC queues).\n\nSo far, I would highlight the following features/issues:\n\n**1.** *** Updated ***\n\nAs the analysis is ongoing I want to clarify that new firmware may be cryptographically\nvalidated, after being downloaded by the TR069 client. It depends on the configuration of the\nterminal, according to 'sw_unwrap.sh'\n\nIf the signature is not enforced, then the firmware image is just validated against a CRC via\n'swValidate'\n\n\n-----\n\n...\n\nswValidate (implemented in 'ut_mac' binary)\n\n**2.** *** Updated * 'APP INSTALL'**\n\n\n-----\n\nA deeper look at the ut_app_execute_operation function revealed that it is implementing a\nfunctionality that enables the ACS to install (upload and run) arbitrary binaries on the\nmodem, without requiring either a signature verification or a complete firmware upgrade.\n\nThis functionality seems to match both the Viasat statement as well as the approach to\ndeploy the 'AcidRain' wiper described by SentinelOne.\n\n'/usr/bin/app_img_dwnid'\n\n\n-----\n\n## Command Injections\n\nAdditionally, there are multiple command injection vulnerabilities that can be trivially exploited\nfrom a malicious ACS (or someone with the same privileged position in the network).\n\ni.e 'ut_app_execute_operation' for the custom 'Device.Services.X_VIASAT-COM_app' object\n('cwmpclient')\n\n\n-----\n\nAlso in '/usr/bin/bbagent' (listening on *:8700/TCP, when activated)\n\n**'Lifeline' - Firmware update over multicast**\n\nThis is an interesting 'emergency' feature intended to perform a firmware upgrade over a\nspecific Multicast group, when everything else fails. It's implemented across different\nbinaries: 'ut_mac', 'mim', 'mimIf' and 'lifelineClient'\n\n## Conclusion\n\nThere are similarities between these issues and the approach followed by the attackers in\nthe Viasat incident, especially the TR069 'APP INSTALL' feature, but I am not implying that\nany of these techniques were actually abused by the attackers. However, overall the security\nposture of the Surfbeam2 firmware does not look good.\n\nHopefully these vulnerabilities are no longer present in the newest Viasat firmware,\notherwise that may pose a security risk.\n\n\n-----\n\nThere are several unknowns yet to be resolved.\n\n1. How the initial compromise of the VPN appliance worked. Did the attackers have valid\ncredentials (maybe stolen from either Skylogic or its partners) or they exploited a known\nvulnerability (assuming an 0day doesn't match a 'misconfigured VPN appliance' explanation\n)?\n\n2. How exactly the attack [propagated to other countries, lasting for several hours. One of the](https://ioda.caida.org/ioda/dashboard#view=inspect&entity=asn/29286&lastView=overview&from=1645628090&until=1645800890)\naffected persons I talked to got his modem knocked out around 9:00 am (GMT+1), several\nhours after the initial attack.\n\n3. Before the destructive payload was executed, there was any other kind of malicious code\nrunning in the modems for a short period of time? Sentinelone published a very interesting\n[research on 'AcidRain', a wiper that is able to generate the same destructive pattern](https://www.sentinelone.com/labs/acidrain-a-modem-wiper-rains-down-on-europe/)\nobserved in the modem's flash memory.\n\nCoincidentally, this wiper also has similarities with 'VPNfilter' malware.\n\n4. Did the compromise of the management segment involve additional attacks besides the\nVPN issue?\n\n\n-----\n\nUnfortunately these technical questions can only be answered by people with an insider\nknowledge. Let's see if Viasat is willing to provide further details on this case.\n\n*** Updated - The VPN Attack vector***\n\nViasat has not elaborated the VPN attack vector yet, but they acknowledged to journalists\nthat the attack originated from the Internet. Viasat is also distancing itself from the fiasco by\ndirectly pointing to Skylogic and its ground infrastructure.\n\nAlthough we're entering again the land of speculation, there are some factual bits that should\nbe considered.\n\n[A simple recon of Skylogic's ground network (AS201935) reveals a couple of interesting](https://bgp.he.net/AS201935)\nthings:\n\n1. Skylogic relies on Fortigate appliances\n\n'cgl-fw02' may be indicating the Skylogic's Cagliari teleport.\n\n\n-----\n\n2. The route [propagation matches the](https://bgp.he.net/AS201935#_graph4) [attack. Viasat's statement explicitly mentions that the](https://ioda.caida.org/ioda/dashboard#view=inspect&entity=asn/29286&lastView=overview&from=1645628090&until=1645800890)\nattacker moved laterally until reaching the management network.\n\n\n-----\n\nIt is also worth mentioning that, in 2021, there were different [attack campaigns and](https://www.fortinet.com/blog/psirt-blogs/malicious-actor-discloses-fortigate-ssl-vpn-credentials)\n[leaks targeting Fortinet VPN appliances. These attacks were carried out by groups of](https://gist.github.com/crypto-cypher/f216d6fa4816ffa93c5270b001dc4bdc)\nmalicious actors that exploited multiple vulnerabilities that were discovered in these products.\n\nViasat's statement mentions a 'misconfigured VPN appliance', so if we consider that this\ndefinition may be a euphemism for an 'unpatched VPN appliance', then we may have a\nplausible attack vector. It is also possible that malicious actors may have previously collected\nvalid VPN credentials as a result of these attacks.\n\nAnother interesting aspect that Viasat implicitly introduces in its statement is the potential\nsecurity weaknesses that may be derived from the complexity of wholesale operations for a\nSatellite infrastructure. Down in this chain we find ground station operators, satellite service\nproviders, distributors, resellers...\n\nAt some point they all need certain kind of access to provide their services, so this\nintegration also may pose a challenge in terms of security. For instance, a publicly exposed\nserver provides a glimpse of the Eutelsat's partners API capabilities.\n\nIn general terms, it is also recommended to not expose an operator's desktop in corporate\nvideos. It usually leaks information that may facilitate different kinds of attacks.\n\n\n-----\n\n## SATCOM terminals under attack in Europe: a plausible analysis.\n\n------ Update 03/12/2022 Reuters has published new information on this incident, which\ninitially matches the proposed scenario. You can find the update at the bottom of this post. ----- February 24th: at the same time Russia initiated a full-scale attack on Ukraine, tens of\nthousands of KA-SAT SATCOM terminals suddenly stopped working in several european\ncountries: Germany, Ukraine, Greece, Hungary, Poland...Germany's Enercon moved forward\nand acknowledged that approximately 5800 of its wind turbines, presumably those remotely\noperated via a SATCOM link in central Europe, had lost contact with their SCADA server .\nIn the affected countries, a significant part of the customers of Eutelsat's domestic\nbroadband service were also unable to access Internet. From the very beginning Eutelsat\nand its parent company Viasat, stated that the issue was being investigated as a\ncyberattack. Since then, details have been scarcely provided but few days ago I came\nacross a really inter\n\n## Finding vulnerabilities in Swiss Post’s future e-voting system - Part 1\n\nIn September '21, I came across this story \"Swiss Post Offers up to €230,000 for Critical\nVulnerabilities in e-Voting System\" while catching up with the security news. The headline\ncertainly caught my attention as it looked like an outlier from the regular bug bounty\nprograms or well-known exploit contests, not only for the announced rewards but mainly\nbecause of the target. So essentially Swiss Post, the national postal service of Switzerland,\nwas opening to the general public a bug bounty program, using the YesWeHack platform,\nintended to uncover vulnerabilities in its future e-voting system. The first part of this blog post\nseries will detail the approach used to analyze the Swiss Post e-voting system, as well as the\n\n\n-----\n\nfirst round of vulnerabilities that I reported during September/October 21. Index Introduction\nApproach Attack Surface Vulnerabilities   1. Insecure USB file handling during\n'importOperation'   2. Insecure 'ReturnCodeGenerationI\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-03-31 - VIASAT incident- from speculation to technical details..pdf"
    ],
    "report_names": [
        "2022-03-31 - VIASAT incident- from speculation to technical details..pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535712,
    "ts_updated_at": 1743041169,
    "ts_creation_date": 1653764734,
    "ts_modification_date": 1653764734,
    "files": {
        "pdf": "https://archive.orkl.eu/8cff1554b142483688152ac0f70614f541e7b037.pdf",
        "text": "https://archive.orkl.eu/8cff1554b142483688152ac0f70614f541e7b037.txt",
        "img": "https://archive.orkl.eu/8cff1554b142483688152ac0f70614f541e7b037.jpg"
    }
}