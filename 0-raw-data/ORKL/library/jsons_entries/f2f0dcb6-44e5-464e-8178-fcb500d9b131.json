{
    "id": "f2f0dcb6-44e5-464e-8178-fcb500d9b131",
    "created_at": "2022-10-25T16:48:13.661654Z",
    "updated_at": "2025-03-27T02:06:01.907911Z",
    "deleted_at": null,
    "sha1_hash": "c95f380726bd8030d027749923497d00b06bbf39",
    "title": "",
    "authors": "",
    "file_creation_date": "2020-03-31T16:46:00Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 833148,
    "plain_text": "# ATTACKS INVOLVING THE MESPINOZA/PYSA RANSOMWARE\n\n###### 2\n\n\n-----\n\nAttacks involving the Mespinoza/Pysa ransomware\n## Table of contents\n\n**1** **Context . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .** **3**\n\n**2** **Technical analysis** . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . **3**\n2.1 The Mespinoza/Pysa ransomware . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 3\n2.1.1 Two versions of the ransomware . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 3\n2.1.2 Ransom demand messages . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 4\n2.1.3 A third ransomware . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 4\n2.2 Tactics, Techniques and Procedures . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 5\n2.2.1 Infection vector, reconnaissance and lateral movement . . . . . . . . . . . . . . . . . . . . . . 5\n2.2.2 Stealth and resilience . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 5\n2.2.3 Command and Control . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6\n2.3 Comments . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6\n\nPage 2 of 7\n\n\n-----\n\nAttacks involving the Mespinoza/Pysa ransomware\n\n### 1 Context\n\nIn the past few weeks, ANSSI became aware of cyber attacks targeting French local authorities. These attacks involved ransomwares whose use resulted in several encrypted files. The origin of these attacks is still unknown, and\ninvestigations are in progress. However, ransomware attacks are usually opportunistic and driven by a lucrative\npurpose.\n\nThis document aims at describing the behaviour of the intrusion set involved in these attacks, as well as providing\nrelated indicators of compromise.\n\n### 2 Technical analysis\n\nThe operation detailed in this document targeted interconnected information systems, and seems to leverage a variant of a ransomware known in open sources as Mespinoza. Note that the technical elements presented thereafter\ncome from ongoing analysis and are prone to evolve.\n\n#### 2.1 The Mespinoza/Pysa ransomware\n\nThe Mespinoza ransomware was first used in October 2018 at least. The first versions produced encrypted files\ncarrying the « .locked » extension, common to many ransomwares. Since December 2019, a new version of\n**Mespinoza is documented in open sources. This version is often called Pysa because it produces encrypted files**\nwith the « .pysa » extension.\n\n##### 2.1.1 Two versions of the ransomware\n\nThe ransomware used in this attack seems to be a variant of Pysa. Two versions were dicovered during the investigations:\n\n  - An executable file named « svchost.exe ». This file came along with several .bat scripts whose purpose was to\ncopy the executable in the « C:\\windows\\temp » directory (which is not the legitimate location of the standard\n_service host) and to execute it._\n\n  - A Python archive named « 17535.pyz », that contained the Python source code of the ransomware.\n\nFilename SHA-1 Size (bytes)\n\nsvchost.exe 52b2fc13ec0dbf8a0250c066cd3486b635a27827 516608\n\n17535.pyz c74378a93806628b62276195f9657487310a96fd 279590\n\n###### The Windows executable version\n\nNEW The executable version of the ransomware drops and executes a script named « update.bat » whose pur[pose is to delete it after execution [T1107].](https://attack.mitre.org/techniques/T1107)\n\nNEW Several system artefacts are generated by the ransomware. First, the malicious code creates a Mutex named\n[« Pysa ». Then, it modifies the registry key SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System [T1112] to](https://attack.mitre.org/techniques/T1112)\nadd the following entries:\n\n  - « legalnoticetext = [Ransom demand message] »\n\n  - « legalnoticecaption = PYSA »\n\nNEW Finally, the encryption routine contains a list of targeted file extensions for encryption, as well as a list of\nstrings identifying the critical files that should be spared (for instance, “:\\Windows\\”). The files created by the en\nPage 3 of 7\n\n|Filename|SHA-1|Size (bytes)|\n|---|---|---|\n|svchost.exe|52b2fc13ec0dbf8a0250c066cd3486b635a27827|516608|\n|17535.pyz|c74378a93806628b62276195f9657487310a96fd|279590|\n\n\n-----\n\nAttacks involving the Mespinoza/Pysa ransomware\n\n[cryption routine carry the « .pysa » extension [T1486].](https://attack.mitre.org/techniques/T1486)\n\nThese observations are perfectly consistent with those regarding previous Pysa samples analysed in open sources,\nsee [1].\n\n###### The Python version\n\nThe Python archive « 17535.pyz » is made of a run.py file together with Python libraries pyaes and rsa that are in\n[charge of the encryption function [T1486].](https://attack.mitre.org/techniques/T1486)\n\nThe run.py file contains the ransomware configuration, including the RSA public key used for encryption, the ransom demand message as well as a variable allowing to choose the extension of the encrypted files. In the present\nversion, this variable contained the value « .pysa ».\n\nNEW The run.py file also contains an instruction allowing to delete the ransomware after execution, as in the\n[executable version [T1107].](https://attack.mitre.org/techniques/T1107)\n\n##### 2.1.2 Ransom demand messages\n\nOut of the « .pysa » file extension, there is no evidence indicating that both versions of the ransomware were leveraged by the same intrusion set. However, both create a ransom demand file, in the form of a pop-up window and\na « Readme.README » file for the first, and a file named « RECOVER_YOUR_DATA.txt » for the second.\n\nThese ransom demands are written in English, but contain several mistakes. Despite being different, both messages\ncontain identical strings such as « To get all your data back contact us: ». One of them also offers free decryption of two files, as a proof of good faith. These characteristics were also available in former versions of the\n**Pysa ransomware.**\n\nFinally, both ransom demand messages contain PROTONMAIL e-mail addresses that seem to be generated from\nrandomly chosen names.\nNote that both ransom demand messages contain the same e-mail addresses. Moreover, similar e-mail addresses\nwere used in former versions of the Pysa ransomware.\n\n##### 2.1.3 A third ransomware\n\nNEW On one of the compromised information systems, a third ransomware has been used. This ransomware is\n[made of two PowerShell scripts named « step1.ps1 » and « step2.ps1 » [T1086].](https://attack.mitre.org/techniques/T1086)\n\nFilename SHA-1 Size (bytes)\n\nstep1.ps1                      - 12066\n\nstep2.ps1 24c592ad9b21df380cb4f39a85d4375b6a8a6175 4869\n\nNEW These codes operate in the following manner:\n\n  - The purpose of « step1.ps1 » is to produce a list of files of the compromised system. The script contains\nsome regular expressions whose aim is to avoid some critical directories and files, as in Pysa’s binary version.\nThe filenames are base-64 encoded (and separated by a “|” character), and then given as a parameter to\n« step2.ps1 ».\n\n  - In order to launch « step2.ps1 », the « step1.ps1 » script creates a copy of powershell.exe under a random\nname of the form « EnNoB-X.exe », where X is an integer ranging between 1000 and 9876. (The code of\n« step1.ps1 » thus contains the path of « step2.ps1 » on the victim’s machine, which is the reason why its\nhash is not mentioned above.)\n\n  - The « step2.ps1 » script does encrypt the files passed in parameter. To do so, it contains a RSA public key\n[and uses the AES-CBC algorithm [T1486]. Again, the script contains a list of file extensions to be spared. In](https://attack.mitre.org/techniques/T1486)\nthis version, the encrypted files carry the « .newversion » extension, which can be modified in the script.\n\nPage 4 of 7\n\n|ts named|« step1.ps1 » and « step2.ps1 » [T|T1086].|\n|---|---|---|\n|Filename|SHA-1|Size (bytes)|\n|step1.ps1|-|12066|\n|step2.ps1|24c592ad9b21df380cb4f39a85d4375b6a8a6175|4869|\n\n\n-----\n\nAttacks involving the Mespinoza/Pysa ransomware\n\nFinally, « step2.ps1 » contains an instruction that deletes the copy of powershell.exe that is responsible for its\n[execution [T1107].](https://attack.mitre.org/techniques/T1107)\n\nNEW The « step1.ps1 » script creates a ransom demand file named « Readme.READ ». Albeit very short, this message contains the same PROTONMAIL e-mail addresses as above. It is thus likely that all these attacks were led by\nthe same intrusion set.\n\nNEW To conclude, note that none of the analysed ransomwares has a self-propagation capability.\n\n#### 2.2 Tactics, Techniques and Procedures\n\nSeveral artefacts tied to the intrusion set’s activity were observed on the compromised information systems.\n\n##### 2.2.1 Infection vector, reconnaissance and lateral movement\n\nThe initial infection vector is currently unknown, but several events that occured before the attack could be linked\nto the intrusion set and its initial access or lateral movement methods.\n\n  - Some bruteforce attempts were observed on a central management console, as well as on some ACTIVE DI[RECTORY accounts [T1110]. Moreover, some domain administrator accounts were indeed compromised.](https://attack.mitre.org/techniques/T1110)\n\n[• A password database has been exfiltrated shortly before the attack [T1081].](https://attack.mitre.org/techniques/T1081)\n\n  - Some illegitimate RDP connections occured between domain controllers using an unknown hostname po[tentially linked to the intrusion set [T1076].](https://attack.mitre.org/techniques/T1076)\n\nThe « .bat » scripts used by the intrusion set to copy and execute the ransomware (see Section 2.1.1) reveal a sig[nificant use of the remote administration tool PsExec [T1035], as well as the PowerShell language [T1086].](https://attack.mitre.org/techniques/T1035)\n\nNEW The analysis of compromised machines also revealed the presence of several Mimikatz samples, potentially\n[used to gain access to credentials [T1003].](https://attack.mitre.org/techniques/T1003)\n\nNEW Finally, the network reconnaissance tools Advanced Port Scanner and Advanced IP Scanner by FAMATECH\n[were discovered on the information system [T1016].](https://attack.mitre.org/techniques/T1016)\n\n##### 2.2.2 Stealth and resilience\n\nOne of the aforementioned « .bat » scripts is dedicated to the execution of a PowerShell script named « p.ps1 » on\nmachines across the network. This script has several functionalities, among which:\n\n  - Stopping antivirus services, some other services and processes, as well as uninstalling WINDOWS DEFENDER\n\n[[T1089].](https://attack.mitre.org/techniques/T1089)\n\n[• Deleting restore points and shadow copies [T1490].](https://attack.mitre.org/techniques/T1490)\n\n  - Modifying README files to allow double-click opening.\n\n  - Broadcasting the MAC address of the machine in a UDP datagram sent over port 7.\n\n[• Modifying local accounts passwords [T1498].](https://attack.mitre.org/techniques/T1498)\n\nIt seems that this script is used to improve stealth, maintain the access to the network and mostly prepare the ransomware execution. The last functionality suggests that the intrusion set has a program listening over port 7, but\nsuch a program has not been discovered at the time of writing.\n\nNEW Several tools discovered on the information system may have allowed the attacker to maintain an access to\n[some machines or to exfiltrate data, such as Putty or WinSCP [T1021].](https://attack.mitre.org/techniques/T1021)\n\nPage 5 of 7\n\n\n-----\n\nAttacks involving the Mespinoza/Pysa ransomware\n##### 2.2.3 Command and Control\n\n###### Remote Access Tool in Go\n\nNEW The following binary was found on several compromised machines.\n\nSHA-1 Size (bytes)\n\nf2dda8720a5549d4666269b8ca9d629ea8b76bdf 5207040\n\nNEW This file was discovered under several legitimate filenames as sshsc.exe or explorer.exe. One was located under « C:\\windows\\temp\\svchost.exe », the same path as the Pysa ransomware (see Section 2.1.1). This suggests\nthat these tools could have been used by the same intrusion set.\n\nNEW The above binary is a Remote Access Tool written in Go language. A characteristic of this malware is the\nlogging in plaintext in the file « %TEMP%\\hlog.log ».\n\n###### Use of Empire\n\nSeveral agents of the post-exploitation tool Empire were discovered, in particular on domain controllers of the\ncompromised information systems. Although no technical link is established with the use of the Pysa ransomware,\nit is likely that these tools were used by the same intrusion set.\n\n#### 2.3 Comments\n\nThe intrusion set observed in these attacks is consistent with an opportunistic actor driven by profit.\n\nThe leveraged tactics, techniques and procedures are classic and not particularly evolved. The intrusion set performed some actions to avoid detection by security solutions, by disabling some of them. However, the purpose of\nthese actions is more likely to allow the ransomware to be executed in good conditions rather than covering the\ntracks.\n\nThe Python version of the ransomware is based on public libraries and its specific code is short. The observed elements suggest that this tool could have been developed quickly. Moreover, the use of three ransomwares in the\nsame attack suggests that the intrusion set may have adapted to the characteristics of the targeted information\nsystems. Finally, many publicly available post-exploitation tools were used during the attack.\n\nThese elements are consistent with an opportunistic actor leveraging resources adapted to its final objective.\n\nPage 6 of 7\n\n|SHA-1|Size (bytes)|\n|---|---|\n|f2dda8720a5549d4666269b8ca9d629ea8b76bdf|5207040|\n\n\n-----\n\nAttacks involving the Mespinoza/Pysa ransomware\n\n### Bibliography\n\n[1] [TLP:WHITE] MALWARE.NEWS, Another one for the collection - Mespinoza (Pysa) Ransomware. Dec. 2019.\n\nPage 7 of 7\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "99fdc3ef-333d-48f5-a4a1-becd788c7b80",
            "created_at": "2022-10-25T15:28:29.802983Z",
            "updated_at": "2022-10-25T15:28:29.802983Z",
            "deleted_at": null,
            "name": "MITRE",
            "url": "https://github.com/mitre-attack/attack-stix-data",
            "description": "MITRE ATT&CK STIX Data",
            "reports": null
        }
    ],
    "references": [
        "https://www.cert.ssi.gouv.fr/uploads/CERTFR-2020-CTI-003.pdf"
    ],
    "report_names": [
        "CERTFR-2020-CTI-003.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1666716493,
    "ts_updated_at": 1743041161,
    "ts_creation_date": 1585673160,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/c95f380726bd8030d027749923497d00b06bbf39.pdf",
        "text": "https://archive.orkl.eu/c95f380726bd8030d027749923497d00b06bbf39.txt",
        "img": "https://archive.orkl.eu/c95f380726bd8030d027749923497d00b06bbf39.jpg"
    }
}