{
    "id": "fc4a0252-7f25-4899-aefa-1acfbfce7ba2",
    "created_at": "2023-01-12T14:59:18.083414Z",
    "updated_at": "2025-03-27T02:17:02.273344Z",
    "deleted_at": null,
    "sha1_hash": "2766b5604865d0f7a1a200964fc3bd92c036e48d",
    "title": "2017-04-03 - RedLeaves - Malware Based on Open Source RAT",
    "authors": "",
    "file_creation_date": "2022-07-02T23:14:30Z",
    "file_modification_date": "2022-07-02T23:14:30Z",
    "file_size": 963969,
    "plain_text": "# JPCERT Coordination Center official Blog\n\n**[blogs.jpcert.or.jp/en/2017/04/redleaves---malware-based-on-open-source-rat.html](https://blogs.jpcert.or.jp/en/2017/04/redleaves---malware-based-on-open-source-rat.html)**\n\n朝長 [秀誠 (Shusei Tomonaga)](https://blogs.jpcert.or.jp/en/shu_tom/)\n\nApril 3, 2017\n\n## RedLeaves - Malware Based on Open Source RAT\n\n[RedLeaves](https://blogs.jpcert.or.jp/en/tags/redleaves/)\n\n[Email](http://10.10.0.46/mailto:?subject=RedLeaves%20-%20Malware%20Based%20on%20Open%20Source%20RAT&body=https%3A%2F%2Fblogs.jpcert.or.jp%2Fen%2F2017%2F04%2Fredleaves---malware-based-on-open-source-rat.html)\n\nHi again, this is Shusei Tomonaga from the Analysis Center.\n\n\n-----\n\nSince around October 2016, JPCERT/CC has been confirming information leakage and\nother damages caused by malware ‘RedLeaves’. It is a new type of malware which has been\nobserved since 2016 in attachments to targeted emails.\n\nThis entry introduces details of RedLeaves and results of our analysis including its relation to\nPlugX, and a tool which is used as the base of this malware.\n\n**How RedLeaves runs**\n\nTo have the RedLeaves injected into the process of Internet Explorer, the following steps will\nbe taken (Figure1):\n\nFigure 1: Flow of events until RedLeaves runs\n\nMalware samples that JPCERT/CC has analysed create the following three files in %TEMP%\nfolder and execute a legitimate application when executed.\n\nA legitimate application (EXE file): a signed, executable file which reads a DLL file\nlocated in the same folder\nA Loader (DLL file): a malicious DLL file which is loaded by the legitimate application\nEncoded RedLeaves (DATA file): Encoded data which is read by the loader\n\n\n-----\n\nWhen the legitimate application is executed, it loads the loader located in the same folder\nthrough DLL Hijacking (DLL preloading).\n\nThe loader, which is loaded in the legitimate application, reads and decodes the encoded\nRedLeaves and then executes it. The executed RedLeaves launches a process (Internet\nExplorer) depending on its configuration, and injects itself there. Then, RedLeaves starts\nrunning in the injected process. The following section explains the behaviour of the injected\nRedLeaves.\n\n**Behaviour of RedLeaves**\n\nRedLeaves communicates to specific sites by HTTP or its custom protocol and executes\ncommands that are received. Figure 2 is the PE header of the injected RedLeaves. Strings\nsuch as “MZ” and “PE” are replaced with “0xFF 0xFF”.\n\nFigure 2: Injected RedLeaves\n\nThe injected RedLeaves connects to command and control (C&C) servers by HTTP POST\nrequest or its custom protocol. Destination hosts and communication methods are specified\nin its configuration. Please refer to Appendix A for more information.\n\nBelow is an example of the HTTP POST request. Table B-1 and B-2 in Appendix B describe\nthe format of the data sent.\n\n\n-----\n\n```\nPOST /YJCk8Di/index.php\n\nConnection: Keep-Alive\n\nAccept: */*\n\nContent-Length: 140\n\nHost: 67.205.132.17:443\n\n[Data]\n\n```\nThe data is encrypted with RC4 (the key is stored in its configuration) and contains the\nfollowing:\n```\n__msgid=23.__serial=0.clientid=A58D72524B51AA4DBBB70431BD3DBBE9\n\n```\nThe data received from the C&C servers contain commands. Depending on the received\ncommands, RedLeaves executes the following functions (Please see Table B-3 in Appendix\nB for the details of received data):\n\nOperation on files\nExecute arbitrary shell commands\nConfigure communication methods\nSend drive information\nSend system information\nUpload/download files\nScreen capture\nExecute proxy function\n\n**Base of RedLeaves’s Code**\n\nJPCERT/CC analysed RedLeaves and confirmed that its code has a lot in common with the\nsource code of Trochilus[1], a type of RAT (Remote Administration Tool), which is available\non Github. Figure 3 shows part of the code to process received data. It is clear that it\nprocesses the same data as listed in Table B-3 in Appendix B.\n\nFigure 3: Part of Trochilus’s source code\n\n\n-----\n\nIt is presumed that RedLeaves is built on top of Trochilus’s source code, rather than from\nscratch.\n\n**Relation to PlugX**\n\nComparing RedLeaves samples that JPCERT/CC has observed with PlugX, used by certain\nattacker groups in the past, we identified that similar code is used in some processes. Below\nare the sequence of instructions observed when the sample creates three files (a legitimate\napplication, a loader and encoded RedLeaves or PlugX).\n\nFigure 4: Comparison of file creation process\n\n\n-----\n\nFurthermore, the process in which the loader decodes the encoded data (encoded\nRedLeaves or PlugX) is similar.\n\nFigure 5: Comparison of file decode process\n\n\n-----\n\nJPCERT/CC has also confirmed that some of the RedLeaves and PlugX samples that share\nthe above code also communicate with common hosts. From this observation, it is presumed\nthat the attacker group using RedLeaves may have used PlugX before.\n\n**Summary**\n\nRedLeaves is a new type of malware being observed since 2016 in attachments to targeted\nemails. Attacks using this malware may continue.\n\nThe hash values of the samples introduced here are listed in Appendix C. Some of the\nRedLeaves’ destination hosts that JPCERT/CC has confirmed are also listed in Appendix D.\nPlease check your devices for any suspicious communication with such hosts.\n\n- Shusei Tomonaga\n\n_(Translated by Yukako Uchida)_\n\nReference\n\n\n-----\n\n[1] Trochilus: A fast&free windows remote administration Tool\n\n[https://github.com/5loyd/trochilus](https://github.com/5loyd/trochilus)\n\nAppendix A: Configuration information\n\nTable A: List of Configuration Information\n\n**Offset** **Description** **Remarks**\n\n0x000 Destination 1\n\n0x040 Destination 2\n\n0x080 Destination 3\n\n0x0C0 Port number\n\n0x1D0 Communication mode 1=TCP, 2=HTTP, 3=HTTPS, 4=TCP and HTTP\n\n0x1E4 ID\n\n0x500 Mutex\n\n0x726 Injection Process\n\n0x82A RC4 key Used for encrypting communication\n\nRC4 key examples:\n\nLucky123\nproblems\n20161213\njohn1234\nminasawa\n\nAppendix B: Communicated data\n\nTable B-1: Format of data sent through HTTP POST request\n\n**Offset** **Length** **Contents**\n\n0x00 4 Length of data encrypted with RC4 (XOR encoded with the first 4 bytes\nof the RC4 key)\n\n0x04 4 Server id (XOR encoded with the first 4 bytes of the RC4 key)\n\n0x08 4 Fixed value\n\n0x0C - Data encrypted with RC4\n\n\n-----\n\nTable B-2: Format of data sent through its custom protocol\n\n**Offset** **Length** **Contents**\n\n0x00 4 Random numerical value\n\n0x04 4 Fixed value\n\n0x08 4 Length\n\n0x0C 4 Length of data encrypted with RC4 (XOR encoded with the first 4 bytes\nof the RC4 key)\n\n0x10 4 Server id (XOR encoded with the first 4 bytes of the RC4 key)\n\n0x14 4 Fixed value\n\n0x18 - Data encrypted with RC4\n\nTable B-3: Contents in received data\n\n**String** **Type** **Contents**\n\n__msgid Numeric Command\n\n__serial Numeric\n\n__upt true, etc. Whether the command is executed by a thread\n\n__data data Command parameter, etc.\n\nAppendix C: SHA-256 hash value of the samples\n\nRedLeaves\n\n5262cb9791df50fafcb2fbd5f93226050b51efe400c2924eecba97b7ce437481\n\nPlugX\n\nfcccc611730474775ff1cfd4c60481deef586f01191348b07d7a143d174a07b0\n\nAppendix D: Communication destination host\n\nmailowl.jkub.com\nwindowsupdates.itemdb.com\nmicrosoftstores.itemdb.com\n67.205.132.17\n144.168.45.116\n\n\n-----\n\n[Email](http://10.10.0.46/mailto:?subject=RedLeaves%20-%20Malware%20Based%20on%20Open%20Source%20RAT&body=https%3A%2F%2Fblogs.jpcert.or.jp%2Fen%2F2017%2F04%2Fredleaves---malware-based-on-open-source-rat.html)\n\nAuthor\n\n朝長 [秀誠 (Shusei Tomonaga)](https://blogs.jpcert.or.jp/en/shu_tom/)\n\nSince December 2012, he has been engaged in malware analysis and forensics\ninvestigation, and is especially involved in analyzing incidents of targeted attacks. Prior to\njoining JPCERT/CC, he was engaged in security monitoring and analysis operations at a\nforeign-affiliated IT vendor. He presented at CODE BLUE, BsidesLV, BlackHat USA Arsenal,\nBotconf, PacSec and FIRST Conference. JSAC organizer.\n\nWas this page helpful?\n\n0 people found this content helpful.\n\nIf you wish to make comments or ask questions, please use this form.\n\nThis form is for comments and inquiries. For any questions regarding specific commercial\nproducts, please contact the vendor.\n\nplease change the setting of your browser to set JavaScript valid.\nThank you!\n\n## Related articles\n\nAnalysis of HUI Loader\n\nAnti-UPX Unpacking Technique\n\n\n-----\n\nFAQ: Malware that Targets Mobile Devices and How to Protect Them\n\nMalware WinDealer used by LuoYu Attack Group\n\nMalware Gh0stTimes Used by BlackTech\n\n\n[Back](https://blogs.jpcert.or.jp/en/2017/03/board-game-on-cyber-security-for-awareness-raising.html)\n[Top](https://blogs.jpcert.or.jp/en/)\n[Next](https://blogs.jpcert.or.jp/en/2017/05/volatility-plugin-for-detecting-redleaves-malware.html)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-04-03 - RedLeaves - Malware Based on Open Source RAT.pdf"
    ],
    "report_names": [
        "2017-04-03 - RedLeaves - Malware Based on Open Source RAT.pdf"
    ],
    "threat_actors": [
        {
            "id": "2646f776-792a-4498-967b-ec0d3498fdf1",
            "created_at": "2022-10-25T15:50:23.475784Z",
            "updated_at": "2025-03-27T02:00:55.479958Z",
            "deleted_at": null,
            "main_name": "BlackTech",
            "aliases": [
                "BlackTech",
                "Palmerworm"
            ],
            "source_name": "MITRE:BlackTech",
            "tools": [
                "Kivars",
                "PsExec",
                "TSCookie",
                "Flagpro",
                "Waterbear"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "d3a7123c-f519-49a0-a234-de24a1ef052a",
            "created_at": "2022-10-25T16:47:55.545211Z",
            "updated_at": "2025-03-27T02:05:17.254744Z",
            "deleted_at": null,
            "main_name": "BRONZE CANAL",
            "aliases": [
                "CTG-6177 ",
                "Circuit Panda ",
                "Palmerworm ",
                "Shrouded Crossbow ",
                "BlackTech"
            ],
            "source_name": "Secureworks:BRONZE CANAL",
            "tools": [
                " DRIGO",
                " Flagpro",
                " Gh0stTimes",
                " PLEAD",
                " Spiderpig",
                " Waterbear",
                "Bifrose"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "75024aad-424b-449a-b286-352fe9226bcb",
            "created_at": "2023-01-06T13:46:38.962724Z",
            "updated_at": "2025-03-27T02:00:02.964002Z",
            "deleted_at": null,
            "main_name": "BlackTech",
            "aliases": [
                "CIRCUIT PANDA",
                "Temp.Overboard",
                "G0098",
                "Red Djinn",
                "HUAPI",
                "Palmerworm",
                "T-APT-03",
                "Manga Taurus",
                "Earth Hundun"
            ],
            "source_name": "MISPGALAXY:BlackTech",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "efa7c047-b61c-4598-96d5-e00d01dec96b",
            "created_at": "2022-10-25T16:07:23.404442Z",
            "updated_at": "2025-03-27T02:02:09.781478Z",
            "deleted_at": null,
            "main_name": "BlackTech",
            "aliases": [
                "BlackTech",
                "Circuit Panda",
                "Earth Hundun",
                "Manga Taurus",
                "Operation PLEAD",
                "Operation Shrouded Crossbow",
                "Operation Waterbear",
                "Palmerworm",
                "Radio Panda",
                "Red Djinn",
                "T-APT-03",
                "TEMP.Overboard"
            ],
            "source_name": "ETDA:BlackTech",
            "tools": [
                "BIFROST",
                "BUSYICE",
                "BendyBear",
                "Bluether",
                "CAPGELD",
                "DRIGO",
                "Deuterbear",
                "Flagpro",
                "GOODTIMES",
                "Gh0stTimes",
                "IconDown",
                "KIVARS",
                "LOLBAS",
                "LOLBins",
                "Linopid",
                "Living off the Land",
                "TSCookie",
                "Waterbear",
                "XBOW",
                "elf.bifrose"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "e3492534-85a6-4c87-a754-5ae4a56d7c8c",
            "created_at": "2022-10-25T15:50:23.819113Z",
            "updated_at": "2025-03-27T02:00:55.552554Z",
            "deleted_at": null,
            "main_name": "Threat Group-3390",
            "aliases": [
                "Threat Group-3390",
                "Earth Smilodon",
                "TG-3390",
                "Emissary Panda",
                "BRONZE UNION",
                "APT27",
                "Iron Tiger",
                "LuckyMouse"
            ],
            "source_name": "MITRE:Threat Group-3390",
            "tools": [
                "Systeminfo",
                "gsecdump",
                "PlugX",
                "ASPXSpy",
                "Cobalt Strike",
                "Mimikatz",
                "Impacket",
                "gh0st RAT",
                "certutil",
                "China Chopper",
                "HTTPBrowser",
                "Tasklist",
                "netstat",
                "SysUpdate",
                "HyperBro",
                "ZxShell",
                "RCSession",
                "ipconfig",
                "Clambling",
                "pwdump",
                "NBTscan",
                "Pandora",
                "Windows Credential Editor"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "5c13338b-eaed-429a-9437-f5015aa98276",
            "created_at": "2022-10-25T16:07:23.582715Z",
            "updated_at": "2025-03-27T02:02:09.875151Z",
            "deleted_at": null,
            "main_name": "Emissary Panda",
            "aliases": [
                "APT 27",
                "ATK 15",
                "Bronze Union",
                "Budworm",
                "Earth Smilodon",
                "Emissary Panda",
                "Group 35",
                "Iron Taurus",
                "Iron Tiger",
                "LuckyMouse",
                "Operation DRBControl",
                "Operation Iron Tiger",
                "Operation PZChao",
                "Operation SpoiledLegacy",
                "Operation StealthyTrident",
                "Red Phoenix",
                "TEMP.Hippo",
                "TG-3390",
                "ZipToken"
            ],
            "source_name": "ETDA:Emissary Panda",
            "tools": [
                "ASPXSpy",
                "ASPXTool",
                "Agent.dhwf",
                "AngryRebel",
                "Antak",
                "CHINACHOPPER",
                "China Chopper",
                "Destroy RAT",
                "DestroyRAT",
                "FOCUSFJORD",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "HTTPBrowser",
                "HTran",
                "HUC Packet Transmit Tool",
                "HighShell",
                "HttpBrowser RAT",
                "HttpDump",
                "HyperBro",
                "HyperSSL",
                "HyperShell",
                "Kaba",
                "Korplug",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Mimikatz",
                "Moudour",
                "Mydoor",
                "Nishang",
                "OwaAuth",
                "PCRat",
                "PlugX",
                "ProcDump",
                "PsExec",
                "RedDelta",
                "SEASHARPEE",
                "Sensocode",
                "SinoChopper",
                "Sogu",
                "SysUpdate",
                "TIGERPLUG",
                "TVT",
                "Thoper",
                "Token Control",
                "TokenControl",
                "TwoFace",
                "WCE",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "Xamtrav",
                "ZXShell",
                "gsecdump",
                "luckyowa"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "b72c2616-cc7c-4c47-a83d-6b7866b94746",
            "created_at": "2023-01-06T13:46:39.425297Z",
            "updated_at": "2025-03-27T02:00:03.08718Z",
            "deleted_at": null,
            "main_name": "Red Nue",
            "aliases": [
                "LuoYu"
            ],
            "source_name": "MISPGALAXY:Red Nue",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535558,
    "ts_updated_at": 1743041822,
    "ts_creation_date": 1656803670,
    "ts_modification_date": 1656803670,
    "files": {
        "pdf": "https://archive.orkl.eu/2766b5604865d0f7a1a200964fc3bd92c036e48d.pdf",
        "text": "https://archive.orkl.eu/2766b5604865d0f7a1a200964fc3bd92c036e48d.txt",
        "img": "https://archive.orkl.eu/2766b5604865d0f7a1a200964fc3bd92c036e48d.jpg"
    }
}