{
    "id": "1ddca532-2a32-43de-87b3-080122785b63",
    "created_at": "2023-01-12T15:05:21.760489Z",
    "updated_at": "2025-03-27T02:17:05.841332Z",
    "deleted_at": null,
    "sha1_hash": "c18a8b242a37540573134d00597a9606d48c7da8",
    "title": "2022-04-27 - Industroyer2- Nozomi Networks Labs Analyzes the IEC 104 Payload",
    "authors": "",
    "file_creation_date": "2022-05-28T05:02:38Z",
    "file_modification_date": "2022-05-28T05:02:38Z",
    "file_size": 1776988,
    "plain_text": "# Industroyer2: Nozomi Networks Labs Analyzes the IEC 104 Payload\n\n**[nozominetworks.com/blog/industroyer2-nozomi-networks-labs-analyzes-the-iec-104-payload/](https://www.nozominetworks.com/blog/industroyer2-nozomi-networks-labs-analyzes-the-iec-104-payload/)**\n\nBy April 27, 2022\n\nIn a [previous blog we gave a high-level overview of Industroyer2, the latest tool that](https://www.nozominetworks.com/blog/industroyer2-targets-ukraines-electric-grid-heres-how-companies-can-stay-protected-and-resilient/)\nadvanced persistent threat (APT) group Sandworm used to target the Ukrainian power grid.\nAs the name coined by ESET suggests, this sample presents many commonalities with its\npredecessor Industroyer, which was used in the notorious December 2016 attack on\nUkraine’s grid. In this blog, we will compare the two samples by providing a side-by-side\nanalysis to uncover the similarities, which helps us gain more insight into the mind of the\nattacker.\nBefore we present evidence that will link the two samples, we will first focus on the main task\nof Industroyer2, namely manipulating IEC-104 Information Object Address (IOA).\n\nUnlike Industroyer, which targeted IEC-101, IEC-104, IEC 61850 and OPC Data Access\nmostly through different Dynamic-link libraries (DLLs) (i.e.101.dll, 104.dll, 61850.dll, OPC.exe\nand OPCClientDemo.dll), the malware dubbed Industroyer2 is a standalone executable\nwhich exclusively targets IEC-104.\n\nDuring the analysis of the sample, we came across something unusual in modern malware:\nthe authors did not bother hiding its activity, nor perform any form of obfuscation. The core of\nthe malware consists of its configuration which, among other parameters described below,\ncontains a hardcoded list of IOAs to manipulate. This configuration is not protected in the\nexecutable, rather it is embedded as a regular Unicode string.\n\nThis lack of concern for detection on the endpoint suggests that the threat actor had a fairly\ncomplete understanding of the security measures deployed in the target environment. At the\nsame time, the hardcoded list of IOAs indicates two things:\n\n1. The operators had a thorough understanding of the Operational Technology (OT)\n\nenvironment; and\n2. The Industroyer2 sample is designed to be executed in a privileged environment with\n\ndirect access to the target devices.\n\nThe window between initial access and when Industroyer2 was launched is unknown.\nHowever, we can assume that the window between access and attack was within days rather\nthan hours, based on the malicious activity.\n\n\n-----\n\nNozomi Networks Labs’ analysis of Industroyer2 suggests that the threat actors had a fairly\ncomplete understanding of the security measures deployed in the target environment.\n\n## IEC-104 Configuration\n\nThe sample that we analyzed contains hardcoded configurations for three different stations.\nFor each station the configuration includes:\n\n1. Station Configuration Header: Header to configure the station interaction\n2. IOA Configuration Format: Table containing multiple IOAs and their corresponding\n\nparameters\n\n**Station Configuration Header**\n\nThe configuration for one of the stations uses the following header:\n\n10.x.y.z 2404 3 0 1 1 PService_PPD.exe 1 “D:\\OIK\\DevCounter” 0 1 0 0 1 0 0 44\n\n10.x.y.z → Controlled station local IP address\n\n2404 → Controlled station port\n\n3 → ASDU address\n\n\n-----\n\n0 → Operation mode. If set to 0, the hardcoded table of IOA is used. If set to 1, two\narguments need to follow specifying a start and an end IOA number, which are then used to\nset a range of IOA to iterate through.\n\n1 → Switch that requires 9 arguments:\n\na) 1 → Boolean, accepted values: 0, 1\n\nb) PService_PPD.exe → Name of the process to be killed\n\nc) 1 → Controls if the filename rename should happen, accepted values: 0 (skip rename), 1\n(rename)\n\nd) “D:\\OIK\\DevCounter” → Folder where the executable targeted for killing and rename is\nstored\n\ne) 0 → Sleep time in minutes, executed prior to initiating interaction with the station\n\nf) 1 → Sleep time in seconds\n\ng) 0 → Sleep time in seconds\n\nh) 0 → Sleep time in seconds\n\ni) 1 → Boolean, accepted values: 0, 1\n\n0 → If set, it will interact with each IOA again, with SCO/DCO On/Off inverted\n\n44 → Number of IOA following header\n\n**IOA Configuration Format**\n\n**Figure 1. IOA Configuration.**\n\n160921 1 0 1 1 2\n\n160921 → IOA address\n\n\n-----\n\n1 → Sets single or double command, accepted values: 0 (Double), 1 (Single)\n0 → Sets SCO/DCO Select/Execute, accepted values: 0 (Execute), 1 (Select)\n1 → Sets SCO/DCO On/Off, accepted values: 0 (Off), 1 (On)\n1 → Priority\n2 → IOA entry index in the configuration list\n\n## Operation\n\n**Figure 2. IEC 104 Interaction.**\n\nAfter terminating `PServiceControl.exe, and based on the configuration,`\n```\nPService_PPD.exe which is then renamed with .MZ appended to its name, the sample\n\n```\nbegins IEC 104 interaction (Figure 2).\n\n\n-----\n\nTraffic sent from the malicious sample to the substation is prefixed with MASTER ->> SLV in\nthe sample’s debugging output and vice versa. The interaction begins with a sequence of\nTESTFR frames: `TESTFR act sent from the malicious sample, which is then acknowledged`\nby a `TESTFR con frame. TESTFR frames are used to check if there are connectivity`\nproblems between two nodes.\n\nThe next frame sent to the receiving station is `STARTDT act, which is a data transfer`\nactivation request, expecting back a `STARTDT con reply as confirmation. Once data`\ntransfer is enabled it is followed by interrogation command `(C_IC_NA_1) .`\n\nThe next step that the sample performs using its hardcoded station configuration is to iterate\nthrough the hardcoded list of IOA per station and send `C_SC_NA_1 or C_DC_NA_1 type`\nframes, depending on each IOA’s configuration. Apart from specifying whether an IOA is\nmeant to be used with a single or double command, as detailed in the configuration above, it\nis possible to specify the bits used to control Single/Double (SCO/DCO), On/Off, and\nSelect/Execute.\n\n## Industroyer vs Industroyer2: Side-by-side Analysis\n\nThe Industroyer2 sample with `sha256`\n```\nd69665f56ddef7ad4e71971f06432e59f1510a7194386e5f0e8926aea7b88e00 has an\n\n```\noverwhelming number of similarities with the Industroyer sample called 104.dll and `sha256`\n```\n7907dd95c1d36cf3dc842a1bd804f0db511a0f68f4b3d382c23a3c974a383cad . This is a\n\n```\nstrong indication that the same threat actor had access to the source code.\n\nThe following screenshot (Figure 3) presents an example of these similarities with a side-byside comparison of the decompiled main thread of both samples. On the left side we have\nthe Industroyer sample from 2016, while on the right we have the Industroyer2 sample from\n2022.\n\n\n-----\n\n**Figure 3. Industroyer (left) and Industroyer2 (right) technical comparison of decompiled main**\nthread of both samples.\n\nThe “process killing” functionality that Industroyer implements in the main thread, in\nIndustroyer2 has been factored out into the thread that eventually spawns this main thread.\nWhat stands out the most though, is the usage of a structure that we renamed “main_config”\nin both the samples which stores data used globally throughout the execution. The\n“main_config” structure as found in Industroyer2 has been updated to hold additional fields,\nbut it shares the same “blueprint” of Industroyer.\nThe following screenshot (Figure 4) contains the decompiled code responsible for the\ncreation of the `STARTDT frame. The similarities between the two samples are once again`\nclear, with the “main_config” structure being passed as an argument from one function to\nanother.\n\n**Figure 4. Industroyer (left) and Industroyer2 (right) technical comparison of decompiled code**\nwhich creates STARTDT frame.\nWe can conclude that the threat actor does not aspire to be stealthy and is not concerned\nabout obfuscating the malware activity or the similarities between Industroyer and\nIndustroyer2.\n\n## Recommendations\n\nHere are some ways companies can increase their protection:\n\n**Basic cyber hygiene: reset passwords, check employee and vendor**\naccount/network access and permissions, scan the network for any open\nports and close/secure them, etc.\n**Utilize YARA rules to search for and generate alerts on associated**\nmalware activity\n**Use anomaly detection tools to detect any changes or variations to**\nmalware, as well as any irregular activity occurring in OT environments\n**Use an automated firewall in conjunction with an anomaly detection tool to**\nstop further attack commands\n**Threat hunt for suspicious activity in your network; this can potentially**\nhelp to discover attackers early on\n\n\n-----\n\n[We also recommend adhering to CISAs 2017 advisory if those security measures have not](https://www.cisa.gov/uscert/ncas/alerts/TA17-163A)\nbeen implemented already.\n\nNozomi Networks will continue to monitor the situation and provide updates on what we are\nseeing, as well as recommendations the OT industry can use to protect their networks.\n\n**Related Content**\n\nRESEARCH REPORT\n\n## OT/IoT Security Report\n\n**Trends and Countermeasures for Critical Infrastructure Attacks**\n\nInsights on ransomware and software supply chain attacks in 2H 2021\nOT/IoT vulnerability research and exploitation trends\nSuggested remediation strategies\n\n[Download](https://www.nozominetworks.com/ot-iot-security-report/)\n**Related Links**\n\nBlog: Industroyer2 Targets Ukraine’s Electric Grid: How Companies Can Stay Protected\nand Resilient\nBlog: [New BotenaGo Variant Discovered by Nozomi Networks Labs](https://www.nozominetworks.com/blog/new-botenago-variant-discovered-by-nozomi-networks-labs/)\nBlog: [INCONTROLLER: Acting to Protect Customers from Unknown Threats](https://www.nozominetworks.com/blog/incontroller-acting-to-protect-customers-from-unknown-threats/)\nBlog: [Critical Log4Shell (Apache Log4j) Attack Analysis](https://www.nozominetworks.com/blog/critical-log4shell-apache-log4j-zero-day-attack-analysis/)\n\n\n-----\n\n[Nozomi Networks Labs](https://www.nozominetworks.com/author/nn-labs/)\nNozomi Networks Labs is dedicated to reducing cyber risk for the world’s industrial and\ncritical infrastructure organizations. Through our cybersecurity research and collaboration\nwith industry and institutions, we’re helping defend the operational systems that support\neveryday life.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-04-27 - Industroyer2- Nozomi Networks Labs Analyzes the IEC 104 Payload.pdf"
    ],
    "report_names": [
        "2022-04-27 - Industroyer2- Nozomi Networks Labs Analyzes the IEC 104 Payload.pdf"
    ],
    "threat_actors": [
        {
            "id": "8941e146-3e7f-4b4e-9b66-c2da052ee6df",
            "created_at": "2023-01-06T13:46:38.402513Z",
            "updated_at": "2025-03-27T02:00:02.824555Z",
            "deleted_at": null,
            "main_name": "Sandworm",
            "aliases": [
                "G0034",
                "IRIDIUM",
                "Blue Echidna",
                "FROZENBARENTS",
                "Seashell Blizzard",
                "IRON VIKING",
                "ELECTRUM",
                "TeleBots",
                "UAC-0113",
                "UAC-0082",
                "APT44",
                "Quedagh",
                "VOODOO BEAR",
                "TEMP.Noble"
            ],
            "source_name": "MISPGALAXY:Sandworm",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "7bd810cb-d674-4763-86eb-2cc182d24ea0",
            "created_at": "2022-10-25T16:07:24.1537Z",
            "updated_at": "2025-03-27T02:02:10.126127Z",
            "deleted_at": null,
            "main_name": "Sandworm Team",
            "aliases": [
                "APT 44",
                "ATK 14",
                "BE2",
                "Blue Echidna",
                "CTG-7263",
                "FROZENBARENTS",
                "IRIDIUM",
                "Iron Viking",
                "Quedagh",
                "Sandworm",
                "Sandworm Team",
                "Seashell Blizzard",
                "TEMP.Noble",
                "UAC-0082",
                "UAC-0113",
                "UAC-0125",
                "UAC-0133",
                "Voodoo Bear"
            ],
            "source_name": "ETDA:Sandworm Team",
            "tools": [
                "AWFULSHRED",
                "ArguePatch",
                "BIASBOAT",
                "Black Energy",
                "BlackEnergy",
                "CaddyWiper",
                "Colibri Loader",
                "Cyclops Blink",
                "CyclopsBlink",
                "DCRat",
                "DarkCrystal RAT",
                "Fobushell",
                "GOSSIPFLOW",
                "Gcat",
                "IcyWell",
                "Industroyer2",
                "JaguarBlade",
                "JuicyPotato",
                "Kapeka",
                "KillDisk.NCX",
                "LOADGRIP",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "ORCSHRED",
                "P.A.S.",
                "PassKillDisk",
                "Pitvotnacci",
                "PsList",
                "QUEUESEED",
                "RansomBoggs",
                "RottenPotato",
                "SOLOSHRED",
                "SwiftSlicer",
                "VPNFilter",
                "Warzone",
                "Warzone RAT",
                "Weevly"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535921,
    "ts_updated_at": 1743041825,
    "ts_creation_date": 1653714158,
    "ts_modification_date": 1653714158,
    "files": {
        "pdf": "https://archive.orkl.eu/c18a8b242a37540573134d00597a9606d48c7da8.pdf",
        "text": "https://archive.orkl.eu/c18a8b242a37540573134d00597a9606d48c7da8.txt",
        "img": "https://archive.orkl.eu/c18a8b242a37540573134d00597a9606d48c7da8.jpg"
    }
}