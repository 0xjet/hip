{
    "id": "7665eb5f-53f1-4656-9c7d-d3f7471f8110",
    "created_at": "2023-01-12T15:02:31.576873Z",
    "updated_at": "2025-03-27T02:05:32.335186Z",
    "deleted_at": null,
    "sha1_hash": "215e651b1e98f7b04613bfde6545a397e32009a3",
    "title": "2022-08-23 - Emotet Resurgence- Cross-Industry Campaign Analysis",
    "authors": "",
    "file_creation_date": "2022-09-01T10:26:33Z",
    "file_modification_date": "2022-09-01T10:26:33Z",
    "file_size": 1527844,
    "plain_text": "# Emotet Resurgence: Cross-Industry Campaign Analysis\n\n**[de.darktrace.com/blog/emotet-resurgence-cross-industry-campaign-analysis](https://de.darktrace.com/blog/emotet-resurgence-cross-industry-campaign-analysis)**\n\n23\n\nAug 2022\n\n23\n\nAug 2022\n\n## Einführung\n\nLast year provided further evidence that the cyber threat landscape remains both complex\nand challenging to predict. Between uncertain attribution, novel exploits and rapid malware\ndevelopments, it is becoming harder to know where to focus security efforts. One of the\nlargest surprises of 2021 was the re-emergence of the infamous Emotet botnet. This is an\nexample of a campaign that ignored industry verticals or regions and seemingly targeted\ncompanies indiscriminately. Only 10 months after the Emotet takedown by law enforcement\nagencies in January, new Emotet activities in November were discovered by security\nresearchers. These continued into the first quarter of 2022, a period which this blog will\nexplore through findings from the Darktrace Threat Intel Unit.\n\nDating back to 2019, Emotet was known to deliver Trickbot payloads which ultimately\ndeployed Ryuk ransomware strains on compromised devices. This interconnectivity\nhighlighted the hydra-like nature of threat groups wherein eliminating one (even with fullscale law enforcement intervention) would not rule them out as a threat nor indicate that the\nthreat landscape would be any more secure.\n\nWhen Emotet resurged, as expected, one of the initial infection vectors involved leveraging\nexisting Trickbot infrastructure. However, unlike the original attacks, it featured a brand new\nphishing campaign.\n\n\n-----\n\nFigure 1: Distribution of observed Emotet activities across Darktrace deployments\nAlthough similar to the original Emotet infections, the new wave of infections has been\nclassified into two categories: Epochs 4 and 5. These had several key differences compared\nto Epochs 1 to 3. Within Darktrace’s global deployments, Emotet compromises associated to\nEpoch 4 appeared to be the most prevalent. Affected customer environments were seen\nwithin a large range of countries (Figure 1) and industry verticals such as manufacturing and\nsupply chain, hospitality and travel, public administration, technology and telecoms and\nhealthcare. Company demographics and size did not appear to be a targeting factor as\naffected customers had varying employee counts ranging from less than 250, to over 5000.\n\n## Key differences between Epochs 1-3 vs 4-5\n\nBased on wider security research into the innerworkings of the Emotet exploits, several key\ndifferences were identified between Epochs 4/5 and its predecessors. The newer epochs\nused:\n\n-   A different Microsoft document format (OLE vs XML-based).\n\n-   A different encryption algorithm for communication. The new epochs used Elliptic Curve\nCryptograph (ECC) [1] with public encryption keys contained in the C2 configuration file [2].\nThis was different from the previous Rivest-Shamir-Adleman (RSA) key encryption method.\n\n-   Control Flow Flattening was used as an obfuscation technique to make detection and\nreverse engineering more difficult. This is done by hiding a program’s control flow [3].\n\n\n-----\n\n-   New C2 infrastructure was observed as C2 communications were directed to over 230\nunique IPs all associated to the new Epochs 4 and 5.\n\nIn addition to the new Epoch 4 and 5 features, Darktrace detected unsurprising similarities in\nthose deployments affected by the renewed campaign. This included self-signed SSL\nconnections to Emotet’s new infrastructure as well as malware spam activities to multiple\nrare external endpoints. Preceding these outbound communications, devices across multiple\ndeployments were detected downloading Emotet-associated payloads (algorithmically\ngenerated DLL files).\n\n## Emotet Resurgence Campaign\n\nFigure 2: Darktrace’s Detection Timeline for Emotet Epoch 4 and 5 compromises\n**1. Initial Compromise**\n\nThe initial point of entry for the resurgence activity was almost certainly via Trickbot\ninfrastructure or a successful phishing attack (Figure 2). Following the initial intrusion, the\nmalware strain begins to download payloads via macro-ladened files which are used to\nspawn PowerShell for subsequent malware downloads.\n\n\n-----\n\nFollowing the downloads, malicious communication with Emotet s C2 infrastructure was\nobserved alongside activities from the spam module. Within Darktrace, key techniques were\nobserved and documented below.\n\n**2. Establish Foothold: Binary Dynamic-link library (.dll) with algorithmically generated**\n**filenames**\n\nEmotet payloads are polymorphic and contain algorithmically generated filenames . Within\ndeployments, HTTP GET requests involving a suspicious hostname, www[.]arkpp[.]com, and\nEmotet related samples such as those seen below were observed:\n\n-   hpixQfCoJb0fS1.dll (SHA256 hash:\n859a41b911688b00e104e9c474fc7aaf7b1f2d6e885e8d7fbf11347bc2e21eaa)\n\n-   M0uZ6kd8hnzVUt2BNbRzRFjRoz08WFYfPj2.dll (SHA256 hash:\n9fbd590cf65cbfb2b842d46d82e886e3acb5bfecfdb82afc22a5f95bda7dd804)\n\n-   TpipJHHy7P.dll (SHA256 hash:\n40060259d583b8cf83336bc50cc7a7d9e0a4de22b9a04e62ddc6ca5dedd6754b)\n\nThese DLL files likely represent the distribution of Emotet loaders which depends on\nwindows processes such as rundll32[.]exe and regsvr32[.]exe to execute.\n\n**3. Establish Foothold: Outbound SSL connections to Emotet C2 servers**\n\nA clear network indicator of compromise for Emotet’s C2 communication involved self-signed\nSSL using certificate issuers and subjects which matched\n‘CN=example[.]com,OU=IT Department,O=Global Security,L=London,ST=London,C=GB’,\nand a common JA3 client fingerprint (72a589da586844d7f0818ce684948eea). The primary\nC2 communications were seen involving infrastructures classified as Epoch 4 rather than 5.\nDespite encryption in the communication content, network contextual connection details\nwere sufficient for the detection of the C2 activities (Figure 3).\n\nFigure 3: UI Model Breach logs on download and outbound SSL activities.\n\n\n-----\n\n_Outbound SSL and SMTP connections on TCP ports 25, 465, 587_\n\nAn anomalous user agent such as, ‘Microsoft Outlook 15.0’, was observed being used for\nSMTP connections with some subject lines of the outbound emails containing Base64encoded strings. In addition, this JA3 client fingerprint\n(37cdab6ff1bd1c195bacb776c5213bf2) was commonly seen from the SSL connections.\nBased on the set of malware spam hostnames observed across at least 10 deployments, the\nmajority of the TLDs were .jp, .com, .net, .mx, with the Japanese TLD being the most\ncommon (Figure 4).\n\nFigure 4: Malware Spam TLDs observed in outbound SSL and SMTP\nPlaintext spam content generated from the spam module were seen in PCAPs (Figure 5).\nExamples of clear phishing or spam indicators included 1) mismatched personal header and\nemail headers, 2) unusual reply chain and recipient references in the subject line, and 3)\nsuspicious compressed file attachments, e.g. Electronic form[.]zip.\n\n\n-----\n\nFigure 5: Example of PCAP associated to SPAM Module\n**4. Accomplish Mission**\n\nThe Emotet resurgence also showed through secondary compromises involving anomalous\nSMB drive writes related to CobaltStrike. This consistently included the following JA3 hash\n(72a589da586844d7f0818ce684948eea) seen in SSL activities as well as SMB writes\ninvolving the svchost.exe file.\n\n## Darktrace Detection\n\nThe key DETECT models used to identify Emotet Resurgence activities were focused on\ndetermining possible C2. These included:\n\n-   Suspicious SSL Activity\n\n-   Suspicious Self-Signed SSL\n\n\n-----\n\n-   Rare External SSL Self-Signed\n\n-   Possible Outbound Spam\n\nFile-focused models were also beneficial and included:\n\n-   Zip or Gzip from Rare External Location\n\n-   EXE from Rare External Location\n\nDarktrace’s detection capabilities can also be shown through a sample of case studies\nidentified during the Threat Research team’s investigations.\n\n## Case Studies\n\nDarktrace’s detection of Emotet activities was not limited by industry verticals or company\nsizing. Although there were many similar features seen across the new epoch, each incident\ndisplayed varying techniques from the campaign. This is shown in two client environments\nbelow:\n\nWhen investigating a large customer environment within the public administration sector, 16\ndifferent devices were detected making 52,536 SSL connections with the example[.]com\nissuer. Devices associated with this issuer were mainly seen breaching the same SelfSigned and Spam DETECT models. Although anomalous incoming octet-streams were\nobserved prior to this SSL, there was no clear relation between the downloads and the\nEmotet C2 connections. Despite the total affected devices occupying only a small portion of\nthe total network, Darktrace analysts were able to filter against the much larger network\n‘noise’ and locate detailed evidence of compromise to notify the customer.\n\nDarktrace also identified new Emotet activities in much smaller customer environments.\nLooking at a company in the healthcare and pharmaceutical sector, from mid-March 2022 a\nsingle internal device was detected making an HTTP GET request to the host arkpp[.]com\ninvolving the algorithmically-generated DLL, TpipJHHy7P.dll with the SHA256 hash:\n40060259d583b8cf83336bc50cc7a7d9e0a4de22b9a04e62ddc6ca5dedd6754b (Figure 6).\n\n\n-----\n\nFigure 6: A screenshot from VirusTotal, showing that the SHA256 hash has been flagged as\nmalicious by other security vendors.\nAfter the sample was downloaded, the device contacted a large number of endpoints that\nhad never been contacted by devices on the network. The endpoints were contacted over\nports 443, 8080, and 7080 involving Emotet related IOCs and the same SSL certificate\nmentioned previously. Malware spam activities were also observed during a similar\ntimeframe.\n\nThe Emotet case studies above demonstrate how autonomous detection of an anomalous\nsequence of activities - without depending on conventional rules and signatures - can reveal\nsignificant threat activities. Though possible staged payloads were only seen in a proportion\nof the affected environments, the following outbound C2 and malware spam activities\ninvolving many endpoints and ports were sufficient for the detection of Emotet.\n\nIf present, in both instances Darktrace’s Autonomous Response technology, RESPOND,\nwould recommend or implement surgical actions to precisely target activities associated with\nthe staged payload downloads, outgoing C2 communications, and malware spam activities.\nAdditionally, restriction to the devices’ normal pattern of life will prevent simultaneously\noccurring malicious activities while enabling the continuity of normal business operations.\n\n## Schlussfolgerung\n\n-   The technical differences between past and present Emotet strains emphasizes the\nversatility of malicious threat actors and the need for a security solution that is not reliant on\nsignatures.\n\n\n-----\n\n-   Darktrace s visibility and unique behavioral detection continues to provide visibility to\nnetwork activities related to the novel Emotet strain without reliance on rules and signatures.\nKey examples include the C2 connections to new Emotet infrastructure.\n\n-   Looking ahead, detection of C2 establishment using suspicious DLLs will prevent\nfurther propagation of the Emotet strains across networks.\n\n-   Darktrace’s AI detection and response will outpace conventional post compromise\nresearch involving the analysis of Emotet strains through static and dynamic code analysis,\nfollowed by the implementation of rules and signatures.\n\n_Thanks to Paul Jennings and Hanah Darley for their contributions to this blog._\n\n## Appendices\n\n**Model breaches**\n\n-   Anomalous Connection / Anomalous SSL without SNI to New External\n\n-   Anomalous Connection / Application Protocol on Uncommon Port\n\n-   Anomalous Connection / Multiple Connections to New External TCP Port\n\n-   Anomalous Connection / Multiple Failed Connections to Rare Endpoint\n\n-   Anomalous Connection / Multiple HTTP POSTs to Rare Hostname\n\n-   Anomalous Connection / Possible Outbound Spam\n\n-   Anomalous Connection / Rare External SSL Self-Signed\n\n-   Anomalous Connection / Repeated Rare External SSL Self-Signed\n\n-   Anomalous Connection / Suspicious Expired SSL\n\n-   Anomalous Connection / Suspicious Self-Signed SSL\n\n-   Anomalous File / Anomalous Octet Stream (No User Agent)\n\n-   Anomalous File / Zip or Gzip from Rare External Location\n\n-   Anomalous File / EXE from Rare External Location\n\n-   Compromise / Agent Beacon to New Endpoint\n\n-   Compromise / Beacon to Young Endpoint\n\n- Compromise / Beaconing Activity To External Rare\n\n\n-----\n\n-   Compromise / New or Repeated to Unusual SSL Port\n\n-   Compromise / Repeating Connections Over 4 Days\n\n-   Compromise / Slow Beaconing Activity To External Rare\n\n-   Compromise / SSL Beaconing to Rare Destination\n\n-   Compromise / Suspicious Beaconing Behaviour\n\n-   Compromise / Suspicious Spam Activity\n\n-   Compromise / Suspicious SSL Activity\n\n-   Compromise / Sustained SSL or HTTP Increase\n\n-   Device / Initial Breach Chain Compromise\n\n-   Device / Large Number of Connections to New Endpoints\n\n-   Device / Long Agent Connection to New Endpoint\n\n-   Device / New User Agent\n\n-   Device / New User Agent and New IP\n\n-   Device / SMB Session Bruteforce\n\n-   Device / Suspicious Domain\n\n-   Device / Suspicious SMB Scanning Activity\n\n\n-----\n\n‍\n\n\n-----\n\n-----\n\n-----\n\n**References**\n\n[1] [https://blog.lumen.com/emotet-redux/](https://blog.lumen.com/emotet-redux/)\n\n[2] https://blogs.vmware.com/security/2022/03/emotet-c2-configuration-extraction-andanalysis.html\n\n[3] [https://news.sophos.com/en-us/2022/05/04/attacking-emotets-control-flow-flattening/](https://news.sophos.com/en-us/2022/05/04/attacking-emotets-control-flow-flattening/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-08-23 - Emotet Resurgence- Cross-Industry Campaign Analysis.pdf"
    ],
    "report_names": [
        "2022-08-23 - Emotet Resurgence- Cross-Industry Campaign Analysis.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535751,
    "ts_updated_at": 1743041132,
    "ts_creation_date": 1662027993,
    "ts_modification_date": 1662027993,
    "files": {
        "pdf": "https://archive.orkl.eu/215e651b1e98f7b04613bfde6545a397e32009a3.pdf",
        "text": "https://archive.orkl.eu/215e651b1e98f7b04613bfde6545a397e32009a3.txt",
        "img": "https://archive.orkl.eu/215e651b1e98f7b04613bfde6545a397e32009a3.jpg"
    }
}