{
    "id": "a82ee5ee-cfcf-4a49-a403-5b8e5fdcddf3",
    "created_at": "2023-01-12T15:04:54.607896Z",
    "updated_at": "2025-03-27T02:08:40.811333Z",
    "deleted_at": null,
    "sha1_hash": "73241badf10190c85dfd44f07aa0128f70ed90c4",
    "title": "2020-12-09 - EDR in block mode stops IcedID cold",
    "authors": "",
    "file_creation_date": "2022-05-28T22:09:28Z",
    "file_modification_date": "2022-05-28T22:09:28Z",
    "file_size": 828539,
    "plain_text": "# EDR in block mode stops IcedID cold\n\n**[microsoft.com/security/blog/2020/12/09/edr-in-block-mode-stops-icedid-cold/](https://www.microsoft.com/security/blog/2020/12/09/edr-in-block-mode-stops-icedid-cold/)**\n\nDecember 9, 2020\n\nWe are happy to announce the general availability of endpoint detection and response (EDR)\nin block mode in Microsoft Defender for Endpoint. EDR in block mode turns EDR detections\ninto real-time blocking of malicious behaviors, malware, and artifacts. It uses Microsoft\nDefender for Endpoint’s industry-leading visibility and detection capabilities and Microsoft\nDefender Antivirus’s built-in blocking function to provide an additional layer of post-breach\nprotection in cases where the primary antivirus misses a threat.\n\nEDR in block mode extends the behavioral blocking and containment capabilities in Microsoft\nDefender for Endpoint, thwarting attack chains that could allow attackers to gain a foothold\non a device and, consequently, a network. For each malicious behavior or malware blocked,\nEDR in block raises an alert in Microsoft Defender Security Center, enabling security teams\nto perform additional investigation and hunting and comprehensively resolve attacks.\n\n[Since being available for public preview in August, EDR in block mode has helped customers](https://techcommunity.microsoft.com/t5/microsoft-defender-for-endpoint/introducing-edr-in-block-mode-stopping-attacks-in-their-tracks/ba-p/1596617)\nto stop a wide range of threats, especially in cases where Microsoft Defender Antivirus isn’t\nthe primary antivirus. Below we describe an IcedID campaign, one of many attacks foiled by\nEDR in block mode. In this incident, the organization’s non-Microsoft antivirus solution\nmissed the malware, but Microsoft Defender for Endpoint picked up the malicious behavior.\nEDR in block mode kicked in and protected the device from a series of malicious activities\nthat include evasive attacker techniques like process hollowing and steganography that lead\nto the deployment of the info-stealing IcedID malware.\n\n\n-----\n\n_Figure 1. IcedID attack chain stopped by EDR in block mode_\n\n## How EDR in block mode stopped an IcedID attack\n\nOn October 13, attackers launched a new campaign to distribute the IcedID malware. IcedID\nis a banking trojan that remains in memory, monitors traffic to banking domains and financial\nwebsites, and steals sensitive financial information. It has also been observed to modify site\ncontent to redirect traffic to malicious sites for the same purpose.\n\nAs in many past IcedID campaigns, this attack started with an email carrying a malicious\n[attachment, in this case, a password-protected archive file. The emails used the fake reply](https://twitter.com/MsftSecIntel/status/1296854458098315264)\ntechnique and contained the password to the archive file.\n\n\n-----\n\n_Figure 2. Spear-phishing email used in the IcedID campaign_\n\nThe archive file contained a document with malicious obfuscated macro code. When\nenabled, the malicious macro connects to a remote site to attempt to download the IcedID\nloader, which would in turn download and run the main IcedID malware.\n\n_Figure 3. Document with malicious macro_\n\nIn customer environments protected by Microsoft for Defender Endpoint with Microsoft\nDefender Antivirus as the primary antivirus, the attack was blocked. Microsoft Defender for\n[Endpoint uses Anti-malware Scan Interface (AMSI) and](https://docs.microsoft.com/windows/desktop/amsi/antimalware-scan-interface-portal) specialized machine learning\nclassifiers on the client and in the cloud to detect malicious macro behavior.\n\n\n-----\n\nIn one environment that wasn t using Microsoft Defender Antivirus, the primary antivirus\nsolution missed the campaign, so when the user opened the document and enabled the\nmacro, the malicious code started connecting to the command-and-control (C2) server.\nMicrosoft Defender for Endpoint’s EDR capabilities, however, detected the malicious macro\nbehavior.\n\nEDR in block mode, which was enabled on the environment, kicked in and instantly blocked\nthe malicious document, preventing a chain of evasive attacker activities that could have led\nto the IcedID malware being installed.\n\n\n-----\n\n_Figure 4. Microsoft Defender Security Center alert for the blocked IcedID malware_\n\n## The attack that could have been\n\nThis IcedID campaign shows why blocking malicious behavior and attacks in real time,\nespecially in the earlier stages of the attack, is critical in preventing the full impact of threats.\nAfter gaining access to a device, attackers bring in sophisticated tools and utilize advanced\n\n\n-----\n\ntechniques to operate stealthily on a system.\n\nFor example, if the IcedID macro isn’t blocked from running, it downloads a DLL file\ndisguised as a CAB file from hxxp://h4dv4c1w[.]com/ryfu/bary[.]php?l=konu13[.]cab. This\nDLL file is saved as [random].txt and is executed using regsvr32.exe. The DLL then\ndownloads jazzcity.top, an encrypted PNG file that contains malware code. This technique of\nhiding malicious code in image files, called steganography, is used by attackers to evade\ndetection.\n\n[When decrypted, the PNG file creates an msiexec.exe process and uses process hollowing,](https://www.microsoft.com/security/blog/2017/07/12/detecting-stealthier-cross-process-injection-techniques-with-windows-defender-atp-process-hollowing-and-atom-bombing/)\na stealthy cross-process injection technique, to inject malicious code. The hollowed-out\n_msiexec.exe process then creates the file joavript.dll, which is the decrypted IcedID malware._\n\n\n-----\n\n_Figure 5. Microsoft Defender Security Center alert for the detection of IcedID malware_\n\nOnce in memory, the IcedID malware acts as the middleman between the browser and the\nbanking site. It does this by creating a self-signed certificate and by hooking the browser to\naccept this certificate. This allows IcedID to monitor HTTPS traffic to online banking sites\nand manipulate and steal information.\n\n\n-----\n\n## EDR in block mode: Transforming EDR visibility into real-time blocking\n\nWith endpoint and detection response (EDR) in block mode, now generally available,\nMicrosoft Defender for Endpoint provides another layer of post-breach protection when\nattacks manage to slip past the primary antivirus solution. An extension of the behavioral\nblocking and containment capabilities, EDR in block mode stops attacks cold when it detects\nmalicious behavior, malware implant, and other artifacts. It stops and blocks malicious\nbehavior in real-time, even if a threat has started running, helping ensure that attacks are not\nallowed to proceed and achieve their endgame.\n\nEDR in block mode can be enabled thru the advanced settings in Microsoft Defender\nSecurity Center. Organizations that have not enabled this feature will also get security\nrecommendation to do so via the threat and vulnerability management feature. To learn\n[more, read the EDR in block mode documentation.](https://docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-atp/edr-in-block-mode)\n\n_Figure 6. Enable EDR in block mode in advanced features in Microsoft Defender Security_\n_Center_\n\nEDR in block mode is part of the comprehensive endpoint protection provided by Microsoft\nDefender for Endpoint, which delivers preventative protection, post-breach detection,\nautomated investigation, and response. Learn how you can secure your organization with\nMicrosoft Defender for Endpoint.\n\n### Talk to us\n\nQuestions, concerns, or insights on this story? Join discussions at the Microsoft 365\nDefender tech community.\n\n[Read all Microsoft security intelligence blog posts.](https://www.microsoft.com/security/blog/microsoft-security-intelligence/)\n\nFollow us on Twitter **[@MsftSecIntel.](https://twitter.com/MsftSecIntel)**\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-12-09 - EDR in block mode stops IcedID cold.pdf"
    ],
    "report_names": [
        "2020-12-09 - EDR in block mode stops IcedID cold.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535894,
    "ts_updated_at": 1743041320,
    "ts_creation_date": 1653775768,
    "ts_modification_date": 1653775768,
    "files": {
        "pdf": "https://archive.orkl.eu/73241badf10190c85dfd44f07aa0128f70ed90c4.pdf",
        "text": "https://archive.orkl.eu/73241badf10190c85dfd44f07aa0128f70ed90c4.txt",
        "img": "https://archive.orkl.eu/73241badf10190c85dfd44f07aa0128f70ed90c4.jpg"
    }
}