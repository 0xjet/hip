{
    "id": "cf4111eb-8537-49bf-ae69-d032348497e1",
    "created_at": "2023-01-12T14:59:27.832431Z",
    "updated_at": "2025-03-27T02:06:10.839619Z",
    "deleted_at": null,
    "sha1_hash": "e7f8617d9cb552fc3243bea55adc644cb28f65a9",
    "title": "2017-08-29 - Second Google Chrome Extension Banker Malware in Two Weeks",
    "authors": "",
    "file_creation_date": "2022-05-28T15:41:05Z",
    "file_modification_date": "2022-05-28T15:41:05Z",
    "file_size": 1811320,
    "plain_text": "# SANS ISC: InfoSec Handlers Diary Blog - SANS Internet Storm Center SANS Site Network Current Site SANS Internet Storm Center Other SANS Sites Help Graduate Degree Programs Security Training Security Certification Security Awareness Training Penetration Testing Industrial Control Systems Cyber Defense Foundations DFIR Software Security Government OnSite Training InfoSec Handlers Diary Blog\n\n**isc.sans.edu/diary/22766**\n\n**Published: 2017-08-29**\n\n**Last Updated: 2017-08-29 14:25:45 UTC**\n\n**by** [Renato Marinho (Version: 1)](https://isc.sans.edu/handler_list.html#renato-marinho)\n\n1. Introduction\n\nIt seems that Google Chrome extensions have become quite the tool for banking malware\nfraudsters. Two weeks ago, an offender phoned a victim and asked him to install a\nsupposedly new bank security module that, instead, was a malicious extension hosted at the\nGoogle Chrome app store aimed to steal victim’s banking credentials [1]. This week I\nreceived a report about a targeted email phishing campaign against another company with a\nsuspicious attachment. The attachments, after the analysis detailed in today’s diary, revealed\nitself to be another Google Chrome extension prepared to steal banking credentials, credit\ncard, CVV numbers and fraud “compensation tickets” (a popular and particular Brazilian\npayment method; we call it “boleto”) to divert payments.\n\nTo increase the success rate and entice the victim’s attention to the message, scammers\nused a previously hijacked company email account to threaten employees with a fake layoff\nlist attached to the message in a “zip” file that contained the first part of the malware. I\nnamed it IDKEY due to the name of the extension it deploys.\n\n1. Threat Analysis\n\nAfter analyzing many different malware parts and lots of obfuscated code, it was possible to\nunderstand the threat’s flow, since the phishing e-mail to the malicious actions, as seen in\nFigure 1. A textual description can be seen below:\n\nThe e-mail attachment “zip” file contains a “.vbs” obfuscated script that, once executed,\ncollects system information and send to a C&C server;\n\n\n-----\n\nBased on the received information, the C&C server decides whether the victim\nmachine is a virtual machine (VM). If so, returns an URL to a non-malicious JPEG file.\nOtherwise, returns an URL to the second part of the malware;\nThe second file, supposedly another “zip”, is, in fact, an obfuscated VBE script, that is\ndownloaded and executed;\nThe VBE script makes additional system checks and downloads a “zip” file (a real one\nthis time) which contains a “Chrome” directory and a DLL;\nThe DLL is deployed and configured to load during user login;\nThe Google Chrome Extension is programmatically loaded into Google Chrome using\nthe parameter “--load-extension”;\nThe malicious extensions, called IDKEY STOR (very suggestive name in English)\nstarts to monitor all visited websites to identify sensitive information. When it matches\nspecific strings, the fraud begins;\nCredentials and credit card numbers are snatched and sent to the C&C server;\nWhen the victim generates a compensation ticket (the “boleto” we talked earlier) which\nhas a barcode, the malware intercepts the page loading, communicates with C&C and\nasks for a fraudulent barcode number. It then communicates with an open API on\nanother financial institution in Brazil and has it generate a barcode image and\noverwrites the original one. As result, the payment will be diverted to an account\nchosen by fraudsters.\n\n\n-----\n\nFigure 1 – IDKEY Malware Analysis\n\n1. Sandbox detection\n\nOne of the first malware actions done by the VBS attached to the phishing e-mail is\ncollecting a bunch of machine information and sending it to the C&C server, as shown in\nFigures 2 and 3.\n\nFigure 2 – Machine information collection\n\n\n-----\n\nFigure 3 – Machine information being posted to the C&C server\n\nThe result for this HTTP Post request was the URL\n“hxxp://cdn.ahnegao.com.br/2017/07/casa.jpg” which points to a regular JPEG file – a clear\nstrategy to mislead sandboxes. To bypass this control, it was enough to replace “VMWare”\nterms in the request to something else, as shown in Figure 4. This time, C&C returned us a\nURL to the next piece of malware.\n\nFigure 4 – Bypassing sandbox detection\n\n1. JavaScript [de]obfuscation\n\n\n-----\n\nAnother part of the malware that caught my attention was how the Google Chrome Extension\nJavaScript code was obfuscated. It uses an array of strings in hexadecimal followed by a\nfunction that reorders the array. The array is then used all over the code, as seen in Figure 5.\nI saw this approach other times, but now I had to decode the source before advancing. It was\nnot possible to read it otherwise.\n\nFigure 5 – Malicious Google Extension snippet\n\nUsing the “nicefier” service JSNice [2], it was possible to better understand the source, as\nseen in Figure 6.\n\nFigure 6 – After JSNice deobfuscation\n\nAlas, reading the code is still far from easy because of the array reference approach used.\nTo overcome this, it was necessary to create a “decode” function to map and replace all\n‘array[“position”]’ references (like ‘_0xb33d[“0x0”]’), to their respective array position, as\nseen in Figure 7.\n\n\n-----\n\nFigure 7 – JavaScript decoder\n\nLoading this code, we had the decoded JavaScript printed to the console, as seen in Figure\n8; it was finally possible to understand the malicious intentions prepared and described in\nthis article.\n\n\n-----\n\nFigure 8 – Source decoded\n\n1. Final words\n\nWhile it is extremely necessary for developers, the option of manually loading Google\nChrome extensions may pose a risk to the regular user who should be aware of browser\nwarnings about extensions in developer mode, as in Figure 9. And again [1], in my opinion,\nChrome should restrict extensions access to sensitive form fields, like passwords, unless it is\nexplicitly consented by the user.\n\nShould Google Chrome team be more explicit about the dangers posed by programmatically\nloaded extensions in their warning?\n\n\n-----\n\nFigure 9 – Google Chrome Extension in developer mode warning\n\n1. IOCs\n\n**Files**\n\nMalicious Google Chrome Extension Files\n\nMD5 (1.js) = 1d91e021e5989029ff0ad6dd595c7eb1\nMD5 (2.js) = d996bdc411c936ac5581386506e79ff4\nMD5 (3.js) = 59352276c38d85835b61e933da8de17b\nMD5 (manifest.json) = c6157953f44bba6907f4827a1b3b4d0a\n\nOther files\n\nMD5 (myinside.dll) = 574322a51aee572f60f2d87722d75056\nMD5 (uia.zip) = bae703565b4274ca507e81d3b623c808\n\n**Network**\n\nhxxp://cdn.ahnegao.com.br/2017/07/casa.jpg?1491404962\nhxxp://storage.googleapis.com/fogoreal/uia.zip\nhxxp://storate.googleapis.com/fogoreal/top019.zip\nhxxps://tofindanotherrace.com/\nhxxp://insidevx.net/log5.php?logins=did&s=ch\nhxxp://insidevx.net/log5.php?logins=did&s=b\n\n**File System**\n\n%userprofile%\\appdata\\roaming\\microsoft\\windows\\start menu\\programs\\startup\\\n<randomname>.vbs\n%userprofile%\\myinside.dll\n\n\n-----\n\n%userprofile%\\ext\\[Chrome|1.9.6]\n\n**Google Chrome**\n\nIDKEY STOR malicious extension deployed\n\n1. References\n\n[1] [https://isc.sans.edu/forums/diary/BankerGoogleChromeExtensiontargetingBrazil/22722/](https://isc.sans.edu/forums/diary/BankerGoogleChromeExtensiontargetingBrazil/22722/)\n\n[2] [http://jsnice.org/](http://jsnice.org/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-08-29 - Second Google Chrome Extension Banker Malware in Two Weeks.pdf"
    ],
    "report_names": [
        "2017-08-29 - Second Google Chrome Extension Banker Malware in Two Weeks.pdf"
    ],
    "threat_actors": [
        {
            "id": "484c5fed-029e-4504-b75a-bbdbc9460595",
            "created_at": "2022-10-25T16:07:24.529893Z",
            "updated_at": "2025-03-27T02:02:10.273182Z",
            "deleted_at": null,
            "main_name": "Pacha Group",
            "aliases": [],
            "source_name": "ETDA:Pacha Group",
            "tools": [
                "Antd",
                "DDG",
                "GreedyAntd",
                "Korkerds",
                "XMRig"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "18bcbaa6-8e7b-43c4-9db7-8b0b315ee5a3",
            "created_at": "2023-01-06T13:46:39.024086Z",
            "updated_at": "2025-03-27T02:00:02.980081Z",
            "deleted_at": null,
            "main_name": "Pacha Group",
            "aliases": [],
            "source_name": "MISPGALAXY:Pacha Group",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535567,
    "ts_updated_at": 1743041170,
    "ts_creation_date": 1653752465,
    "ts_modification_date": 1653752465,
    "files": {
        "pdf": "https://archive.orkl.eu/e7f8617d9cb552fc3243bea55adc644cb28f65a9.pdf",
        "text": "https://archive.orkl.eu/e7f8617d9cb552fc3243bea55adc644cb28f65a9.txt",
        "img": "https://archive.orkl.eu/e7f8617d9cb552fc3243bea55adc644cb28f65a9.jpg"
    }
}