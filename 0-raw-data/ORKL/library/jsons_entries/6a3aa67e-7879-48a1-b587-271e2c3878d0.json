{
    "id": "6a3aa67e-7879-48a1-b587-271e2c3878d0",
    "created_at": "2023-01-12T15:04:54.154159Z",
    "updated_at": "2025-03-27T02:16:25.747895Z",
    "deleted_at": null,
    "sha1_hash": "65dd8c1f144eea91751e31188546a6aa61beb657",
    "title": "2022-05-29 - Full Anubis android malware analysis",
    "authors": "",
    "file_creation_date": "2022-06-01T12:22:52Z",
    "file_modification_date": "2022-06-01T12:22:52Z",
    "file_size": 2121776,
    "plain_text": "# Full Anubis android malware analysis\n\n**muha2xmad.github.io/malware-analysis/anubis/**\n\n\nMay 27, 2022\n\n\n-----\n\n-----\n\n### Muhammad Hasan Ali\n\nMalware Analysis learner\n\n4 minute read\n\n**As-salamu Alaykum**\n\n## Introduction\n\nAnubis is an android malware or bank trojan collects sensitive data from the victim’s mobile\nsuch as financial data using read/write SMS and keylogging. Anubis targets turkish speaker\nand spreads through malicious websites which download directly anubis malware or through\ngoogle play which download the dropper then the dropper downloads the anubis malware.\n[The sample from VT](https://www.virustotal.com/gui/file/8cb941658ed8340b67a38a47162ab8850b89a14eee2899f0761fadd4f648fd5e/details)\n\n[Download the sample from github](https://github.com/muha2xmad/Samples/blob/main/8cb941658ed8340b67a38a47162ab8850b89a14eee2899f0761fadd4f648fd5e.zip)\n\n## Static analysis\n\nWe try to decompile the apk file using `apktool command` `apktool d anubis.apk . Then`\nwe open the decoded `AndroidManifest.xml file, we see many permissions which show`\nthe capability of the malware.\n\n\n-----\n\nFigure(1): permissions of the malware\n\nThe malware has the capability of access location, read/write SMS, call phone, record autio,\nread contacts, and internet.\n\nWe get back to the `apk file and` `unzip it. And convert the dalvik executable`\n```\nclasses.dex file to java bytecode file using dex2jar command d2j-dex2jar\nclasses.dex . Then open the classes.jar in jd-GUI to examine java code.\n\n## Uninstall the app\n\n```\nWhen trying to uninstall the program, it forces you going to home screen. Using Accessibility\n[services run in background when AccessibilityEvent is fired then do something. In anubis, if](https://developer.android.com/reference/android/view/accessibility/AccessibilityEvent)\nmalware app name, settings `com.android.settings, or remove/uninstall then go back to`\nhome screen trigaring `to_home_screen() .`\n\n\n-----\n\nFigure(2): attempting to uninstall the malware\n\n## Capabilities\n\nThe malware lots of Capabilities as we see VNC, keylogging, spam SMS, request location,\ndisable play protect, and more.\n\n\n-----\n\nFigure(3): Malware Capabilities\n\n\n-----\n\n## C2 server\n\nBy searching with `http, we can find the C2 server`\n```\nhxxp://sosyalkampanya2.tk/dedebus/ which is used as VNC client.\n\n```\nFigure(4): C2 server\n\nThe malware will try to get new C2 servers, which will be through twitter. It will query the\ntwitter page which contains Chinese tweets and search for text from two tags 苏尔的开始\nand 苏尔苏尔完 then loops to convert the Chinese chars with its related in English. Then the\noutput will be in `Base64 which will be decoded and the next output will be in` `RC4`\nencryption and will be decrypted using key `zanibus`\n\nFigure(5): Get new C2 server from twitter\n\n\n-----\n\nFigure(6): Decode and decrypt the output\n\n## Anubis as a Keylogger\n\nWhen you try to enter text in any textbox, the event `TYPE_VIEW_TEXT_CHANGED and its`\nevent type is `16 will be triggered and save the text into` `keys.log then send it to the C2`\nserver.\n\nFigure(7): Keylogging function\n\nFigure(8): If C2 sends a command contains Clear, then deletes key strokes saved\n\n## Receiving commands\n\nThe malware receives many encrypted commands from the C2 server and then decrypts it\nas we see when getting new C2 server such as `opendir,` `downloadfile,`\n```\ndeletefilefolder, getIP . In long string of commands, commands are separated by\n\n```\n\n-----\n\nFigure(9): receives encrypted commands and decryptes it\n\n## Intercepting and forwarding Calls and SMS\n\nThe malware can Intercepting and forwarding Calls and SMS which used in bank\nvarifications. In SMS, can forward the OTP SMS. In Calls, varification and warning calls\n\nFigure(10): Intercepting and forwarding Calls\n\n## Anubis as a ransomware\n\nThe malware acts as a ransomware which can encrypt files located in `/mnt,` `/mount,`\n```\n/sdcard, and /storage .\n\n```\n\n-----\n\nFigure(11): Anubis as a ransomware\n\nThe malware will use RC4 encryption to encrypt the files with a key which is received from\nthe C2 server then save the encrypted data and deletes the original data. The key is used as\na decryption and encryptio data.\n\n\n-----\n\nFigure(12): Anubis encrypts and decrypts data\n\n## Anubis with overlay attack\n\nThe malware searches for specific apps by comparing the installed apps to list of hardcoded\n[apps -most of them is banking apps- to perform overlay attack. The malware opens an active](https://encyclopedia.kaspersky.com/glossary/overlaying-overlay-attack/)\nwindow over a legitimate program. The opened malicious window is the same as the\nlegitimate program. The malware can steal the victim’s credential data such as payment data\nor login data.\n\n\n-----\n\nFigure(13): Targeted apps\n\nFigure(14): Webview over the legitimate program\n\n## Disable play protect\n\nThis is an installed malware on the device, then how it didn’t flag as a malware by play\nprotect? The malware disables play protect\n\n\n-----\n\nFigure(15): Anubis disables play protect\n\n## IoCs\n\n**No.** **Description** **Hash and URLs**\n\n1 The APK hash (MD5) ba7b1ba0830e11da60dec1c90632515d\n\n2 C2 server hxxp://sosyalkampanya2.tk/dedebus/\n\n3 related C2 Server hxxp://twitter.com/qweqweqwe\n\n4 related C2 Server hxxp://twitter.com/ankaratakipte\n\n## Article quote\n\nوﻣﻦ ﻟﻢ ﯾﻜﻦ ﻓﻲ ﻣﻌﯿّﺔ اﷲ ﻓﻬﻮ ﻫﺎﻟﻚ\n\n## REF\n\n[https://n1ght-w0lf.github.io/malware%20analysis/anubis-banking-malware/](https://n1ght-w0lf.github.io/malware%20analysis/anubis-banking-malware/)\n\n[https://eybisi.run/Mobile-Malware-Analysis-Tricks-used-in-Anubis/](https://eybisi.run/Mobile-Malware-Analysis-Tricks-used-in-Anubis/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-05-29 - Full Anubis android malware analysis.pdf"
    ],
    "report_names": [
        "2022-05-29 - Full Anubis android malware analysis.pdf"
    ],
    "threat_actors": [
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535894,
    "ts_updated_at": 1743041785,
    "ts_creation_date": 1654086172,
    "ts_modification_date": 1654086172,
    "files": {
        "pdf": "https://archive.orkl.eu/65dd8c1f144eea91751e31188546a6aa61beb657.pdf",
        "text": "https://archive.orkl.eu/65dd8c1f144eea91751e31188546a6aa61beb657.txt",
        "img": "https://archive.orkl.eu/65dd8c1f144eea91751e31188546a6aa61beb657.jpg"
    }
}