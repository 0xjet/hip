{
    "id": "c2aa46e4-a9a2-4cb5-823e-d550eafad6d2",
    "created_at": "2023-04-05T02:09:33.84805Z",
    "updated_at": "2025-03-27T02:05:21.378585Z",
    "deleted_at": null,
    "sha1_hash": "a81d84b7bf16f81110b46cadbc38f1ea18c8f10e",
    "title": "2023-02-20 - Royal Ransomware Expands Attacks by Targeting Linux ESXi Servers",
    "authors": "",
    "file_creation_date": "2023-04-03T08:21:57Z",
    "file_modification_date": "2023-04-03T08:21:57Z",
    "file_size": 677064,
    "plain_text": "# Royal Ransomware Expands Attacks by Targeting Linux ESXi Servers\n\n**[trendmicro.com/en_us/research/23/b/royal-ransomware-expands-attacks-by-targeting-linux-esxi-servers.html](https://www.trendmicro.com/en_us/research/23/b/royal-ransomware-expands-attacks-by-targeting-linux-esxi-servers.html)**\n\nFebruary 20, 2023\n\nRansomware\n\nRansomware actors have been observed to expand their targets by increasingly developing Linux-based versions.\nRoyal ransomware is following in the same path, a new variant targeting Linux systems emerged and we will\nprovide a technical analysis on this variant in this blog.\n\nBy: Nathaniel Morales, Ivan Nicole Chavez, Byron Gelera\nFebruary 20, 2023\nRead time: ( words)\n\n[Ransomware actors have been observed to expand their targets by increasingly developing Linux-based versions.](https://www.trendmicro.com/vinfo/us/security/definition/Ransomware)\nWe predicted in September 2022 that ransomware groups will would increasingly target Linux servers and\nembedded systems in the coming years after detecting a double-digit year-on-year (YoY) increase in attacks on\n[these systems in the first half of 2022. In May 2021 we reported ransomware variants of DarkSide and in May](https://www.trendmicro.com/en_ph/research/21/e/darkside-linux-vms-targeted.html)\n[2022 we found Cheerscrypt, specifically targeting the ESXi servers, which are widely used for server virtualization](https://www.trendmicro.com/en_us/research/22/e/new-linux-based-ransomware-cheerscrypt-targets-exsi-devices.html)\nby enterprises.\n\nRoyal ransomware is following in the same path, a new variant targeting Linux systems emerged and we will\nprovide a technical analysis on this variant in this blog. Royal’s Linux counterpart also targets ESXi servers, a\ntarget expansion which can create a big impact on victimized enterprise data centers and virtualized storage.\n\nRoyal ransomware was first observed in September 2022, and the threat actors behind it are believed to be\n[seasoned cybercriminals who used to be part of Conti Team One.](https://www.trendmicro.com/en_us/research/22/l/conti-team-one-splinter-group-resurfaces-as-royal-ransomware-wit.html)\n\n## Deep roots, strong start\n\nDespite being detected only in September 2022, Royal ransomware was among the three most prolific\nransomware groups in the fourth quarter last year. According to [data from ransomware groups’ leak sites, 10.7%](https://www.trendmicro.com/vinfo/us/security/news/ransomware-by-the-numbers/lockbit-blackcat-and-royal-dominate-the-ransomware-scene-ransomware-in-q4-2022)\nwere attributed to Royal, with only LockBit and BlackCat ahead of it, accounting for 22.3% and 11.7% respectively.\nIts threat actors being an offshoot from Conti may be the reason for its quick claim to fame as soon as it made\nheadlines in the ransomware landscape.\n\nUpon examining the ransomware’s attacks, we learned that it combines old and new techniques, which supports\nthe theory that actors behind it have an extensive knowledge of the ransomware scene. In its early campaigns,\nRoyal deployed BlackCat’s encryptor, but later shifted to its own called Zeon, which dropped ransom notes similar\nto Conti’s. Royal later rebranded and began using Royal in its ransom notes generated by its own encryptor.\n\n\n-----\n\nFigure 1. Ransom note of Royal ransomware\nRoyal ransomware targeted small to medium-sized businesses in the fourth quarter of 2022: 51.9% of its victims\nwere small business, while 26.8% were medium-sized. Only 11.3% of its victims for this period were large\nenterprises.\n\nAmong its victims, the IT, finance, materials, healthcare, and food and staples industries were its top targets.\nThreat actors behind Royal focused on targets in North America during the last quarter of 2022, which accounted\nfor three-quarters of its victims in that time period. Royal also targeted enterprises in Europe, Latin America, Asia\nPacific, Africa, and the Middle East.\n\n## Technical Analysis\n\nIn our analysis, we found that Royal ransomware accepts the following command-line arguments:\n\n**Argument** **Description**\n\n\n-id {32-byte\ncharacters}\n\n\nWill be used as the victim’s ID, which will be appended on the TOR link found in the dropped\nransom note. The process exits if not provided, or if the provided characters are not 32 bytes long\n\n\n-ep Used for full or partial encryption of file routine\n\n-stopvm Used to terminate VM processes via EXSCLi\n\n-vmonly\n\n-fork For creation of fork process\n\n-logs Display logs of encrypted files\n\nTable 1. Royal ransomware arguments and description\n\n\n-----\n\nFigure 2. Accepted arguments by Royal\n\nransomware\nThe “-id” parameter, like Royal ransomware’s [Win32 variant, requires 32-byte characters in order to proceed, and](https://www.trendmicro.com/en_us/research/22/l/conti-team-one-splinter-group-resurfaces-as-royal-ransomware-wit.html)\nwill be used as the Victim’s ID.\n\nFigure 3. Royal ransomware checks -id parameter length if equal\n\nto 32 bytes\nThe “-path” argument from earlier Royal ransomware Win32 variants was removed in the Linux variant, but the file\npath argument is still required in order to execute the ransomware. It designates the first argument to be used as\nthe file path to be encrypted.\n\nFigure 4. Royal ransomware sets the file path as first argument to be\n\naccepted and used for search_files function\nInside the “stop_vm” function, Royal ransomware implements the following command to terminate VM processes\nusing ESXCLI.\n\n_esxcli vm process kill –type=hard –world-id={ }_\n\nFigure 5. Terminating VM\n\nprocesses via ESXCLI\n\n\n-----\n\nRoyal ransomware then creates a specified number of threads depending on the number of processors of the\ninfected machine. It determines the number of processors by using the sysconf(84) function, multiplying it by 8 to\ndetermine the number of threads to be created. By doing so, it significantly increases the speed of the\n“thread_func” function where it contains the encryption routine of the ransomware.\n\nFigure 6. The Royal ransomware function used to\n\ndetermine number of threads to be created\nFor the “search_files” function, Royal ransomware uses the “opendir” function to open a specified directory. It then\ndrops the ransom note “readme” to the directory and then calls the “readdir” function in a loop to read all entries\ninside the directory. It then checks the type of the entry if it’s a directory (d_type == 4) or a file (d_type == 8). If it’s\na directory, it recursively calls the “search_files” function on the entry.\n\nFigure 7. The Royal ransomware\n\nsearch files function\n\n\n-----\n\nIf the entry is a regular file, it checks the filename and avoids encrypting the following files with the following\nnames/extensions:\n\n.royal_u\n.royal_w\n.sf\n.v00\n.b00\nroyal_log_\nreadme\n\n[One of the excluded extensions, “.royal_w”, is the latest appended extension of the Royal ransomware. We](https://www.virustotal.com/gui/file/4d7f6c6a051ecb1f8410243cd6941b339570165ebcfd3cc7db48d2a924874e99/detection)\nassume that the “royal_w” and “royal_u” are used by threat actors to differentiate encrypted files by their Windows\nvariant (royal_w) and Linux variants (royal_u), where u possibly stands for Unix.\n\nAs in Royal ransomware’s Win32 variant, it also uses OpenSSL’s Advanced Encryption Standard (AES) for its\nencryption.\n\nFigure 8. The Royal ransomware\n\nRSA Public Key is hardcoded in the binary\n\nFigure 9. Royal ransomware function containing the\n\nencryption routine\nRoyal ransomware threat actors also implement intermittent encryption. Using the -ep parameter, it accepts\nintegers from 0 to 100; if the integer exceeds 100 or is below or equal to 0, it sets the value to 50 and will be used\nas a parameter for intermittent encryption.\n\n\n-----\n\nFigure 10. Royal ransomware function which checks the parameter\n\nused for -ep argument\nRoyal ransomware then generates the AES key and IV using the following function, then encrypts it using RSA\nencryption. The encrypted AES and IV key will also be appended to each of the encrypted files.\n\nFigure 11. Generation of AES Key and IV of Royal\n\nransomware\nIf the RSA encryption is successful, it then rounds up the file to multiples of 16, which is required in AES\nencryption.\n\nFigure 12. Royal ransomware rounds up the file size to multiples of\n\n16\nFor the rounded-up files, Royal ransomware then checks if the size is less than or equal to 5,245,000 bytes or if\nthe value set on -ep is 100. If one of the conditions is met, it will encrypt the whole file. For files greater than\n5,245,000 bytes, the encryption will take place per certain calculated blocks where it will encrypt the first N bytes,\nthen skip the next N bytes, and repeats the process.\n\nFigure 13. Royal ransomware checks the file size\n\nif it meets specific conditions before encrypting\n\nFigure 14. The calculation of N\n\nbytes used for intermittent encryption used by Royal ransomware\nThe calculation of N bytes is as follows:\n\nN = (X/10) * (Original File Size / 100) then rounded down to multiples of 16\n\n\n-----\n\nwhere X is the value set to ep\n\nIf the calculated N is greater than 1,024,000, it will encrypt 1,024,000 block instead.\n\nFigure 15. Royal ransomware checks the file size if it is less than\n\n1,024,000 bytes\nThe intermittent encryption technique on the Linux variant shares great similarity to the encryption done by Royal\nransomware’s Win32 variant, which aims to make the encryption faster.\n\nFigure 16. Royal ransomware’s\n\nencryption routine\nLastly, Royal ransomware appends the “royal_u” file extension for the encrypted files and drops its ransom note\ninto the directory.\n\n\n-----\n\nFigure 17. Some of Royal ransomware’s encrypted\n\nfiles, with the accompanying ransom note\n\n## Conclusion\n\nThis new variant of the Royal ransomware expands their attacks to target ESXi servers, causing great damage to\ntheir victims. As the threat actors behind Royal are believed to be seasoned cybercriminals from Conti, they are\nequipped with an arsenal of knowledge of the ransomware scene which can prove to be a great risk to enterprises\nas we expect to see more activity from the ransomware group in the future. Royal ransomware can be expected to\ndevelop new variants for wider impact.\n\nTo protect systems from ransomware attacks, we recommend that both individual users and organizations\nimplement best practices such as applying data protection, backup, and recovery measures to secure data from\npossible encryption or erasure. Conducting regular vulnerability assessments and patching systems in a timely\nmanner can also minimize the damage dealt by ransomware that abuses exploits.\n\nWe advise users and organizations to update their systems with the latest patches and apply multi-layered\ndefense mechanisms. End users and enterprises alike can mitigate the risk of infection from new threats like\nRoyal ransomware by following these security best practices:\n\nEnable multifactor authentication (MFA) to prevent attackers from performing lateral movement inside a\nnetwork.\n[Adhere to the 3-2-1 rule when backing up important files. This involves creating three backup copies on two](https://www.trendmicro.com/vinfo/tmr/?/us/security/news/virtualization-and-cloud/best-practices-backing-up-data)\ndifferent file formats, with one of the copies stored in a separate location.\n[Patch and update systems regularly. It’s important to keep operating systems and applications up to date](https://www.trendmicro.com/vinfo/tmr/?/us/security/news/vulnerabilities-and-exploits/virtual-patching-patch-those-vulnerabilities-before-they-can-be-exploited)\nand maintain patch management protocols that can deter malicious actors from exploiting any software\nvulnerabilities.\n\nIndicators of Compromise\n\n**SHA256** **Detection**\n\nb57e5f0c857e807a03770feb4d3aa254d2c4c8c8d9e08687796be30e2093286c Ransom.Linux.ROYAL.THBOBBC\n\n06abc46d5dbd012b170c97d142c6b679183159197e9d3f6a76ba5e5abf999725 Ransom.Linux.ROYAL.THBOBBC\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2023/2023-02-20 - Royal Ransomware Expands Attacks by Targeting Linux ESXi Servers.pdf"
    ],
    "report_names": [
        "2023-02-20 - Royal Ransomware Expands Attacks by Targeting Linux ESXi Servers.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1680660573,
    "ts_updated_at": 1743041121,
    "ts_creation_date": 1680510117,
    "ts_modification_date": 1680510117,
    "files": {
        "pdf": "https://archive.orkl.eu/a81d84b7bf16f81110b46cadbc38f1ea18c8f10e.pdf",
        "text": "https://archive.orkl.eu/a81d84b7bf16f81110b46cadbc38f1ea18c8f10e.txt",
        "img": "https://archive.orkl.eu/a81d84b7bf16f81110b46cadbc38f1ea18c8f10e.jpg"
    }
}