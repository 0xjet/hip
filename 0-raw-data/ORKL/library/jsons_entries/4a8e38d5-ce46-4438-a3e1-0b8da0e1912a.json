{
    "id": "4a8e38d5-ce46-4438-a3e1-0b8da0e1912a",
    "created_at": "2023-01-12T15:05:59.95309Z",
    "updated_at": "2025-03-27T02:16:47.076345Z",
    "deleted_at": null,
    "sha1_hash": "17e00576fbb4442cf0777d9a11ea6f6fc5f9da4f",
    "title": "2020-03-10 - [RE012] Phân tích mã độc lợi dụng dịch Covid-19 để phát tán giả mạo “Chỉ thị của thủ tướng Nguyễn Xuân Phúc” - Phần 1",
    "authors": "",
    "file_creation_date": "2022-05-28T15:23:16Z",
    "file_modification_date": "2022-05-28T15:23:16Z",
    "file_size": 2034810,
    "plain_text": "# [RE012-1] Phân tích mã độc lợi dụng dịch Covid-19 để phát tán giả mạo “Chỉ thị của thủ tướng Nguyễn Xuân Phúc” - Phần 1\n\n**blog.vincss.net/2020/03/re012-phan-tich-ma-doc-loi-dung-dich-COVID-19-de-phat-tan-gia-mao-chi-thi-cua-thu-tuong-**\nNguyen-Xuan-Phuc.html\n\n_Lợi dụng tình hình diễn biến của dịch COVID-19 hiện tại đang rất phức tạp, nhiều nhóm tin_\n_tặc đã và đang âm thầm thực hiện các chiến dịch APT nhắm vào các cá nhân và tổ chức_\n_nhằm trục lợi. Tại Việt Nam cũng không ngoại lệ. Mới đây chúng tôi ghi nhận mẫu mã độc_\n_(nghi ngờ từ nhóm Mustang Panda) giả mạo chị thị của thủ tướng Nguyễn Xuân Phúc về_\n_phòng tránh dịch COVID-19. Trong bài viết này chúng tôi sẽ phân tích phương thức mà kẻ_\n_tấn công sử dụng để lây nhiễm vào máy người dùng._\n\n## 1. Thông tin về sample\n\n**File name:** _Chi Thi cua thu tuong nguyen xuan phuc.rar_\n**File Hash (SHA-256):**\nbbbeb1a937274825b0434414fa2d9ec629ba846b1e3e33a59c613b54d375e4d2\n**File Size: 172 KB**\n**File type: RAR**\n**File Timestamps: 2020:03:03 14:46:12**\n\n\n-----\n\n**Archived File Name: Chi Thi cua thu tuong nguyen xuan phuc\\Chi Thi cua thu tuong**\nnguyen xuan phuc.lnk\n\nHình 1: Nội dung của tài liệu xuất hiện khi mã độc thực thi\n\n## 2. Phân tích mã độc\n\n 2.1. Phân tích hành vi của mã độc\n\nTheo thông tin ở trên, mã độc gửi kèm email phishing là một file nén. Trong file nén này\nchứa một file Chi Thi cua thu tuong nguyen xuan phuc.lnk có kích thước 712 KB:\n\nHình 2: Nội dung trong file nén\n\nFile .lnk đơn giản là một shorcut được Windows sử dụng làm tham chiếu đến file gốc. Các\nfile này thường sử dụng cùng một biểu tượng với file gốc, nhưng thêm một mũi tên cuộn\n\n\n-----\n\ntròn nhỏ để cho biết nó trỏ đến một vị trí khác. Khi người dùng vô tình mở file .lnk trong file\nnén trên, hành vi của mã độc sẽ diễn ra theo trình tự:\n\n¨ Khởi chạy cmd.exe, mục đích để gọi mshta.exe với tham số truyền vào là file .lnk đã được\ngiải nén tạm ở thư mục %Temp%:\n\nHình 3: cmd.exe gọi tới mshta.exe\n\nHình 4: Thực thi mshta.exe với tham số truyền vào là file lnk\n\n¨ mshta.exe có nhiệm vụ phân tích file, tìm kiếm và thực thi script được nhúng trong file. Từ\nđây, thực hiện các hành động sau:\n\nTạo các file 3.exe, http_dll.dll, http_dll.dat, Chi Thi cua thu tuong nguyen xuan\n**phuc.doc trong thư mục %LocalAppData%\\Temp.**\nKhởi chạy 3.exe, tiến trình này sẽ tạo các file unsecapp.exe, http_dll.dll, http_dll.dat\ntrong thư mục %AllUsersProfile%\\Microsoft Malware Protectionydy.\nThiết lập run key Microsoft Malware Protectionydy trong Registry\n(HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\n**& HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\Microsoft Malware**\n**Protectionydy) trỏ tới file unsecapp.exe đã tạo ở trên.**\nGọi WINWORD.EXE để mở tài liệu %Temp%\\Chi Thi cua thu tuong nguyen xuan\n**phuc.doc với nội dung như ở Hình 1 nhằm đánh lừa người dùng.**\n\n\n-----\n\nHình 5: Luồng thực thi của các tiến trình\n\n¨ Tiến trình unsecapp.exe sau khi thực thi sẽ kết nối tới C2 là vietnam[.]zing[.]photos:\n\nHình 6: Tiến trình unsecapp.exe kết nối tới C2\n\nHai file 3.exe và unsecapp.exe thực chất là cùng là một file và có Certificate nhằm qua mặt\ncác phần mềm Antivirus:\n\nHình 7: 3.exe và unsecapp.exe trùng hash\n\n\n-----\n\nHình 8: Thông tin Certificate mà độc sử dụng\n\n## 2.2. Phân tích chi tiết file lnk và VBScript\n\nNhư mô tả ở phần trên, khi người dùng mở file Chi Thi cua thu tuong nguyen xuan\n**phuc.lnk trong Chi Thi cua thu tuong nguyen xuan phuc.rar, mshta.exe sẽ được gọi để**\nthực thi script. Như vậy, nội dung của script này phải được nhúng sẵn trong file .lnk. Sử\ndụng 010 Editor để mở file .lnk và tìm kiếm chuỗi <script, kết quả có được thông tin về\nđoạn VBScript được nhúng trong file:\n\n\n-----\n\nHình 9: Nội dung của script nhúng trong file\n\nTrích xuất toàn bộ nội dung của script. Nội dung của script như sau:\n\n¨ Khai báo các biến CAwyFTsgCQ, yilJSYTMMh, TPDgWjZcyJ và gán lần lượt nội dung\ncủa 3.exe, http_dll.dll, http_dll.dat cho từng biến:\n\n\n-----\n\nHình 10: Tạo biến chứa nội dung của file\n\n¨ Tạo lập đường dẫn cho các files và gọi hàm vSWGUThohAGJ để tạo files:\n\nHình 11: Tạo các file 3.exe, http_dll.dll, http_dll.dat\n\n¨ Thực thi file 3.exe đã tạo, tạo tài liệu Chi Thi cua thu tuong nguyen xuan phuc.doc và\nmở tài liệu này để đánh lừa người dùng.\n\n\n-----\n\nHình 12: Thực thi 3.exe và mở tài liệu Chi Thi cua thu tuong nguyen xuan phuc.doc\n\n## 2.3. Phân tích chi tiết các payload\n\n 2.3.1. Phân tích unsecapp.exe\n\nNhư đã đề cập ở trên, mã độc sau khi thực thi thành công sẽ thiết lập run key Microsoft\n**Malware Protectionydy trong Registry**\n(HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run) trỏ tới file unsecapp.exe.\nFile này bản chất là EHttpSrv.exe (ESET HTTP Server Service) thuộc sản phẩm Eset\n**Smart Security của hãng ESET. Kẻ tấn công đã lợi dụng file này để thực hiện kĩ thuật DLL**\n**side-loading nhằm tải và thực thi mã độc nằm trong thư viện http_dll.dll.**\n\nHình 13: unsecapp.exe gọi hàm LoadLibraryW để nạp http_dll.dll\n\n\n-----\n\n## 2.3.2. Phân tích http_dll.dll\n\n**http_dll.dll sau khi được nạp sẽ thực thi code tại DllMain, tại đây mã độc gọi hàm thực hiện**\ncông việc sau:\n¨ Lấy địa chỉ thuộc unsecapp.exe tính từ base address + 0x157A.\n¨ Gọi hàm VirtualProtect để thay đổi 16 bytes từ địa chí tính toán ở trên thành\n**PAGE_EXECUTE_READWRITE.**\n¨ Patch code tại địa chỉ đó thông qua kĩ thuật push – ret để nhảy tới hàm thực hiện nhiệm vụ\ngiải mã mà thực thi Shellcode.\n\nHình 14: Sử dụng kĩ thuật push-ret để nhảy tới hàm tại địa chỉ 0x10001230\n\nTại hàm DecryptShellCodeAndExcecute (0x10001230), mã độc tiếp tục thực hiện:\n¨ Cấu thành đường dẫn tới http_dll.dat, file này chứa payload đã bị mã hóa:\n\n\n-----\n\nHình 15: Cấu thành đường dẫn tới http_dll.dat\n\n¨ Gọi hàm FileReadAll (0x10001030), đọc toàn bộ nội dung của http_dll.dat vào vùng nhớ\nđã cấp phát:\n\n\n-----\n\nHình 16: Hàm FileReadAll chịu trách nhiệm đọc nội dung http_dll.dat\n\nHình 17: Code của hàm FileReadAll\n\n¨ Trích xuất key giải mã (10 bytes đầu của http_dll.dat), cấp phát vùng nhớ và copy toàn bộ\ndữ liệu của http_dll.dat vào vùng nhớ đã được cấp phát. Gọi hàm XorDecrypt\n**(0x100014B0) để giải mã payload mới trên bộ nhớ:**\n\nHình 18: Thực hiện giải mã payload mới trên bộ nhớ\n\n\n-----\n\nCuối cùng gọi hàm VirtualProtect để thay đổi vùng nhớ của payload mới thành\n**PAGE_EXECUTE_READWRITE và gọi thẳng tới payload này để thực thi. Payload cuối**\ncùng này sẽ làm nhiệm vụ giải mã cấu hình có thông tin về thư mục “Microsoft Malware\n**Protectionydy” dùng để lưu các payload, thông tin về C2 như đã đề cập ở trên và thực hiện**\nnhiệm vụ kết nối tới C2.\n\nHình 19: Thực thi payload mới đã giải mã trên bộ nhớ\n\nBằng thông tin phân tích được ở trên, có thể giải mã và thu được payload mới mà không\ncần debug:\n\n\n-----\n\nHình 20: http_dll.dat trước và sau khi giải mã\n\nPayload có được là một dll (HT.dll):\n\nHình 21: Payload mới là một dll\n\n_Bài viết xin được tạm dừng tại đây, trong phần tiếp theo chúng tôi sẽ phân tích chi tiết về_\n_cách thức hoạt động của payload cuối cùng (HT.dll)._\n\n**Indicators of compromise (IOCs)**\n\n**Dropped file:**\n\n**%LocalAppData%\\Temp**\n\n1. 3.exe  [SHA256:\nc3159d4f85ceb84c4a0f7ea9208928e729a30ddda4fead7ec6257c7dd1984763]\n\n2. http_dll.dll   [SHA256:\n79375c0c05243354f8ba2735bcd086dc8b53af709d87da02f9206685095bb035]\n\n3. http_dll.dat   [SHA256:\nb62d35d8edae874a994fff12ec085a0bf879c66b3c97fd13fe0a335b497342e5]\n\n4. Chi Thi cua thu tuong nguyen xuan phuc.doc    [SHA256:\ne3556d6ba5e705b85599b70422928165c8d4130074029a8dcd04a33f4d1aa858]\n\n**%AllUsersProfile%\\Microsoft Malware Protectionydy**\n\n\n-----\n\n1. unsecapp.exe\n\n[SHA256: c3159d4f85ceb84c4a0f7ea9208928e729a30ddda4fead7ec6257c7dd1984763]\n\n2. http_dll.dll   [SHA256:\n79375c0c05243354f8ba2735bcd086dc8b53af709d87da02f9206685095bb035]\n\n3. http_dll.dat   [SHA256:\nb62d35d8edae874a994fff12ec085a0bf879c66b3c97fd13fe0a335b497342e5]\n\n**Persistence Registry:**\n\nHKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\Microsoft Malware\nProtectionydy = C:\\ProgramData\\Microsoft Malware Protectionydy\\unsecapp.exe\"\n\nHKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\Microsoft Malware\nProtectionydy = C:\\ProgramData\\Microsoft Malware Protectionydy\\unsecapp.exe\"\n\n**C2:**\nDomain: vietnam[.]zing[.]photos\nIP: 104.160.44.85\n\n**R&D Center - VinCSS (a member of Vingroup)**\n\n\n-----",
    "language": "VI",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-03-10 - [RE012] Phân tích mã độc lợi dụng dịch Covid-19 để phát tán giả mạo “Chỉ thị của thủ tướng Nguyễn Xuân Phúc” - Phần 1.pdf"
    ],
    "report_names": [
        "2020-03-10 - [RE012] Phân tích mã độc lợi dụng dịch Covid-19 để phát tán giả mạo “Chỉ thị của thủ tướng Nguyễn Xuân Phúc” - Phần 1.pdf"
    ],
    "threat_actors": [
        {
            "id": "1691c25f-1aa4-4168-8ce2-7aa8f23246e7",
            "created_at": "2024-06-04T02:03:07.724221Z",
            "updated_at": "2025-03-27T02:05:17.284601Z",
            "deleted_at": null,
            "main_name": "BRONZE PRESIDENT",
            "aliases": [
                "Mustang Panda ",
                "Red Lich ",
                "Temp.Hex ",
                "HoneyMyte "
            ],
            "source_name": "Secureworks:BRONZE PRESIDENT",
            "tools": [
                " Cobalt Strike",
                " ORat",
                " PlugX",
                " RCSession",
                "China Chopper"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "b69037ec-2605-4de4-bb32-a20d780a8406",
            "created_at": "2023-01-06T13:46:38.790766Z",
            "updated_at": "2025-03-27T02:00:02.919758Z",
            "deleted_at": null,
            "main_name": "MUSTANG PANDA",
            "aliases": [
                "TEMP.HEX",
                "TA416",
                "TANTALUM",
                "Twill Typhoon",
                "Earth Preta",
                "Stately Taurus",
                "LuminousMoth",
                "Polaris",
                "BRONZE PRESIDENT",
                "HoneyMyte",
                "Red Lich"
            ],
            "source_name": "MISPGALAXY:MUSTANG PANDA",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "9baa7519-772a-4862-b412-6f0463691b89",
            "created_at": "2022-10-25T15:50:23.354429Z",
            "updated_at": "2025-03-27T02:00:55.45162Z",
            "deleted_at": null,
            "main_name": "Mustang Panda",
            "aliases": [
                "Mustang Panda",
                "TA416",
                "RedDelta",
                "BRONZE PRESIDENT"
            ],
            "source_name": "MITRE:Mustang Panda",
            "tools": [
                "Cobalt Strike",
                "RCSession",
                "NBTscan",
                "PoisonIvy",
                "PlugX"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "2ee03999-5432-4a65-a850-c543b4fefc3d",
            "created_at": "2022-10-25T16:07:23.882813Z",
            "updated_at": "2025-03-27T02:02:10.0116Z",
            "deleted_at": null,
            "main_name": "Mustang Panda",
            "aliases": [
                "Bronze President",
                "Camaro Dragon",
                "Earth Preta",
                "HoneyMyte",
                "Mustang Panda",
                "Operation SMUGX",
                "Operation SmugX",
                "PKPLUG",
                "Red Lich",
                "Stately Taurus",
                "TEMP.Hex"
            ],
            "source_name": "ETDA:Mustang Panda",
            "tools": [
                "9002 RAT",
                "AdFind",
                "Agent.dhwf",
                "Agentemis",
                "CHINACHOPPER",
                "China Chopper",
                "Chymine",
                "ClaimLoader",
                "Cobalt Strike",
                "CobaltStrike",
                "DCSync",
                "DOPLUGS",
                "Darkmoon",
                "Destroy RAT",
                "DestroyRAT",
                "Farseer",
                "Gen:Trojan.Heur.PT",
                "HOMEUNIX",
                "Hdump",
                "HenBox",
                "HidraQ",
                "Hodur",
                "Homux",
                "HopperTick",
                "Hydraq",
                "Impacket",
                "Kaba",
                "Korplug",
                "LadonGo",
                "MQsTTang",
                "McRAT",
                "MdmBot",
                "Mimikatz",
                "NBTscan",
                "NetSess",
                "Netview",
                "Orat",
                "POISONPLUG.SHADOW",
                "PUBLOAD",
                "PVE Find AD Users",
                "PlugX",
                "Poison Ivy",
                "PowerView",
                "QMAGENT",
                "RCSession",
                "RedDelta",
                "Roarur",
                "SPIVY",
                "ShadowPad Winnti",
                "SinoChopper",
                "Sogu",
                "TIGERPLUG",
                "TONEINS",
                "TONESHELL",
                "TVT",
                "TeamViewer",
                "Thoper",
                "TinyNote",
                "WispRider",
                "WmiExec",
                "XShellGhost",
                "Xamtrav",
                "Zupdax",
                "cobeacon",
                "nbtscan",
                "nmap",
                "pivy",
                "poisonivy"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535959,
    "ts_updated_at": 1743041807,
    "ts_creation_date": 1653751396,
    "ts_modification_date": 1653751396,
    "files": {
        "pdf": "https://archive.orkl.eu/17e00576fbb4442cf0777d9a11ea6f6fc5f9da4f.pdf",
        "text": "https://archive.orkl.eu/17e00576fbb4442cf0777d9a11ea6f6fc5f9da4f.txt",
        "img": "https://archive.orkl.eu/17e00576fbb4442cf0777d9a11ea6f6fc5f9da4f.jpg"
    }
}