{
    "id": "e67730c6-d79a-45bb-9a20-a6a03ba504f6",
    "created_at": "2023-06-05T02:07:48.663842Z",
    "updated_at": "2025-03-27T02:17:02.255931Z",
    "deleted_at": null,
    "sha1_hash": "987c5a3f673177f6cbbb0ed6ac060ea4315ec442",
    "title": "2023-05-08 - Malware analysis report- WinDealer (LuoYu Threat Group)",
    "authors": "",
    "file_creation_date": "2023-06-04T12:39:39Z",
    "file_modification_date": "2023-06-04T12:39:39Z",
    "file_size": 2997724,
    "plain_text": "# Malware analysis report: WinDealer (LuoYu Threat Group)\n\n**[mssplab.github.io/threat-hunting/2023/05/08/malware-analysis-windealer.html](https://mssplab.github.io/threat-hunting/2023/05/08/malware-analysis-windealer.html)**\n\n### 7 minute read\n\n\nMay 8, 2023\n\n\n### WinDealer is a type of malware that is used for financial fraud and theft. It is a banking Trojan that is designed to steal sensitive financial information, such as login credentials, credit card numbers, and other personal information from victims’ computers.\n\n Following are the capabilities of the malware:\n\n\n-----\n\n### Manipulation of files and file systems: reading, writing, and deleting files, listing directories, and collecting disk information Information collection: gathering device details, network settings, and/or keyboard layout, listing running processes, installed software, and configuration files of popular messaging services (Skype, QQ, WeChat, and Wangwang); Download and upload random file types; arbitrarily executed commands; System-wide text file and Microsoft Word document search; Screenshot taking; Discovery of networks through ping scan; Backdoor maintenance: enabling or disabling persistence (through the RUN key in the registry) and configuration changes\n\n## Threat actor\n\n### LuoYu is a threat group that is believed to be a Chinese state-sponsored hacking group. The group has been active since at least 2011 and is known to target a wide range of industries, including defense, government, telecommunications, and technology.\n\n## Target\n\n### Geographies and sectors:\n\n Chinese subsidiaries of Japanese companies Users of a Chinese private bank\n\n Industry:\n\n Technology Media Financial Military Telecom Ministries of Foreign Affairs\n\n## Cyber Kill Chain\n\n### WinDealer steals information of an infected PC and sends it to a C2 server as described in here:\n\n\n-----\n\n## Identification\n\n### Two samples are being investigated:\n\n sample.exe:\n\n File size: 372736 bytes MD5 sum: cc7207f09a6fe41c71626ad4d3f127ce SHA-1 sum: 84e749c37978f9387e16fab29c7b1b291be93a63 SHA-256 sum: 28df5c75a2f78120ff96d4a72a3c23cee97c9b46c96410cf591af38cb4aed0fa\n\n First of all, check our sample via VirusTotal:\n\n https://www.virustotal.com/gui/file/28df5c75a2f78120ff96d4a72a3c23cee97c9b46c96410cf591af38cb4aed0fa/details\n\n So, 52 of 68 AV engines detect our sample as malicious.\n\n More of them detect file as Backdoor.Win32.WINDEALER.ZYJA.\n\n## Static analysis\n\n### The specified sample is a PE file:\n```\nfile <sample.exe>\n\nhexdump -C <sample.exe>\n\n```\n\n-----\n\n### Use exiftool for looking metadata:\n```\nexiftool <sample.exe>\n\n```\n\n-----\n\n### And we see that file timestamp is 2021 01 25 13:32:26+03.00\n\n Executable sample is not packed by upx:\n```\nupx -l <sample.exe>\n\n What about Shannon entropy of the sample:\n\n Analysze with DIE says that the compiler is Microsoft Visual Studio C++ (6.0):\n\n```\n\n-----\n\n-----\n\n### Malware contains encrypted DLL:\n\n Interesting strings:\n\n\n-----\n\n### The hardcoded version of WinDealer:\n\n\n-----\n\n```\n18.20.1225 - version: 18, year: 2020, month and day: 12.25\n\n### another intersting strings is:\nSYSTEM\\CurrentControlSet\\Control\\Network\\{4D36E972-E325-11CE-BFC1-08002BE10318}\\%s\\Connection:\n\n## Dynamic analysis\n\n### The sample is GUI application:\n\n Contacted IP addresses is:\n\n```\n\n-----\n\n### May sleep (evasive loops) to hinder dynamic analysis:\n\n\n-----\n\n### The operator has the power to rename, move, and delete files on the target machine:\n\n Also malware search through directories and enum filesystem:\n\n and collecting volume information:\n\n API hooking\n\n\n-----\n\n### Using InterlockedExchange, probably the malware sample is hooking the winapi functions:\n\n AV/Sandbox evasion\n\n In the malware sample above, the delay timeout is set using the GetTickCount() timer function. The Sleep() function is called in a loop until the timer timeout. In the sandbox, delays that are performed by the Sleep() function are skipped (replaced with a very short timeout) and the virtually elapsed time will be much higher than the requested timeout. The concept behind these methods is to measure elapsed time while running several forms of delays in parallel:\n\n sample2.exe:\n\n File size: 458752 bytes MD5 sum: 76ba5272a17fdab7521ea21a57d23591 SHA-1 sum: 6b831413932a394bd9fb25e2bbdc06533821378c SHA-256 sum: ecd001aeb6bcbafb3e2fda74d76eea3c0ddad4e6e7ff1f43cd7709d4b4580261\n\n VirusTotal scan result:\n\n https://www.virustotal.com/gui/file/ecd001aeb6bcbafb3e2fda74d76eea3c0ddad4e6e7ff1f43cd7709d4b4580261/detec tion\n\n\n-----\n\n## Static analysis\n\n### The specified sample is a PE file:\n```\nfile <sample2.exe>\n\nhexdump -C <sample2.exe>\n\n Run exiftool for extracting metadata:\nexiftool <sample2.exe>\n\n```\n\n-----\n\n### The sample is a Windows GUI file with timestamp: 2021:03:06 04:13:51+03:00\n\n## Dynamic analysis\n\n### Generating victim ID set in a registry key:\n\n The format of the victim ID is md5(\"<MAC address>+<Physical_Drive_info>+<username>\"). The malware generates a unique registry entry to store the victim ID for subsequent execution. The victim ID is not saved as raw data; instead, the malware changes the 4 bytes victim ID to an IP address format.\n\n This sample collecting host information:\n\n\n-----\n\n### Encoding\n\n Malware sample use function call obfuscation:\n```\nGetUserNameW:\nRegCreateKeyExA:\nRegDeleteKeyA and RegCloseKey:\n\n```\n\n-----\n\n```\nRegQueryValueExA:\nGetTokenInformation:\n\n```\n\n-----\n\n```\nOpenProcessToken:\nOpenThreadToken:\nAdjustTokenPrivileges:\n\n```\n\n-----\n\n### .etc.\n\n So, malware sample use one of the interesting classic APT techniques: Token theft via turn on SeDebugPrivilege:\n```\n//....\n\nHANDLE token;\n\nTOKEN_PRIVILEGES tp;\n\nLUID luid;\n\nBOOL res = TRUE;\n\ntp.PrivilegeCount = 1;\n\ntp.Privileges[0].Luid = luid;\n\ntp.Privileges[0].Attributes = SE_PRIVILEGE_ENABLED;\n\nif (!LookupPrivilegeValue(NULL, priv, &luid)) res = FALSE;\n\nif (!OpenProcessToken(GetCurrentProcess(), TOKEN_ADJUST_PRIVILEGES, &token)) res = FALSE;\n\nif (!AdjustTokenPrivileges(token, FALSE, &tp, sizeof(TOKEN_PRIVILEGES), (PTOKEN_PRIVILEGES)NULL,\n(PDWORD)NULL)) res = FALSE;\n\n//...\n\n Registry Modifications and Persistence\n\n With a high degree of probability, it can be argued that WinDealer has the functionality of interacting with the registry, probably for persistence mechanism:\n\n```\n\n-----\n\n### Encryption\n\n Generate 16 bytes AES key to encrypt C2 communication:\n\n\n-----\n\n### C2 anti-tracking mechanism\n\n This malware sample employs an IP Generation Algorithm to generate a random C2 IP address when the backdoor lacks C2 configuration. The IP produced at random will exist inside particular IP address ranges:\n```\n113.62.0.0 - 113.63.255.255 or\n111.120.0.0 - 111.123.255.255\n\n This mechanism will prevent researchers from tracking down the real C2 IP.\nBackdoor.Win32.WINDEALER.ZYJA is a variant of the WinDealer malware family. It is a type of backdoor malware that\n\n is designed to allow remote attackers to gain unauthorized access to an infected computer system. Once installed, the malware creates a backdoor on the infected system, which allows the attacker to control the system and steal sensitive data.\n\n```\n\n-----\n\n### The Backdoor.Win32.WINDEALER.ZYJA variant is known to be spread through spear phishing emails that contain malicious attachments. Once the attachment is opened, the malware is installed and begins to communicate with a remote command-and-control server, allowing the attacker to send commands to the infected system and exfiltrate data.\n\n The malware is capable of performing a range of malicious activities, including stealing credentials and sensitive data, taking screenshots, recording keystrokes, and executing arbitrary commands on the infected system. The malware is also capable of bypassing antivirus and other security software, making it difficult to detect and remove.\n\n## IOCs\n\n### versions\n\n Malware version md5 sha1\n\n WinDealer 18.20.1225 76ba5272a17fdab7521ea21a57d23591 6b831413932a394bd9fb25e2bbdc06533821378c\n\n WinDealer 18.20.1225 cc7207f09a6fe41c71626ad4d3f127ce 84e749c37978f9387e16fab29c7b1b291be93a63\n\n domain IPs\n```\n   113.62.0.0/15 111.120.0.0/14\n\n port 55556/TCP, 6999/UDP\n   221.195.68.71/32\n   122.112.245.55/32\n\n## Yara rules (from Malpedia)\n\n```\n\n-----\n\n```\n    _ _ {\n  meta:\n\n    author = \"Felix Bilstein - yara-signator at cocacoding dot com\"\n\n    date = \"2023-01-25\"\n\n    version = \"1\"\n\n    description = \"Detects win.windealer.\"\n\n    info = \"autogenerated rule brought to you by yara-signator\"\n\n    tool = \"yara-signator v0.6.0\"\n\n    signator_config = \"callsandjumps;datarefs;binvalue\"\n\n    malpedia_reference = \"https://malpedia.caad.fkie.fraunhofer.de/details/win.windealer\"\n\n    malpedia_rule_date = \"20230124\"\n\n    malpedia_hash = \"2ee0eebba83dce3d019a90519f2f972c0fcf9686\"\n\n    malpedia_version = \"20230125\"\n\n    malpedia_license = \"CC BY-SA 4.0\"\n\n    malpedia_sharing = \"TLP:WHITE\"\n\n  /* DISCLAIMER\n\n  * The strings used in this rule have been automatically selected from the\n\n  * disassembly of memory dumps and unpacked files, using YARA-Signator.\n\n  * The code and documentation is published here:\n\n  * https://github.com/fxb-cocacoding/yara-signator\n\n  * As Malpedia is used as data source, please note that for a given\n\n  * number of families, only single samples are documented.\n\n  * This likely impacts the degree of generalization these rules will offer.\n\n  * Take the described generation method also into consideration when you\n\n  * apply the rules in your use cases and assign them confidence levels.\n\n  */\n\n\n  strings:\n\n    $sequence_0 = { 668b91d2070000 8a89d0070000 52 51 }\n\n      // n = 4, score = 800\n\n      //  668b91d2070000    | mov         dx, word ptr [ecx + 0x7d2]\n\n      //  8a89d0070000     | mov         cl, byte ptr [ecx + 0x7d0]\n\n      //  52          | push        edx\n\n      //  51          | push        ecx\n\n    $sequence_1 = { ff15???????? 85c0 7407 50 ff15???????? 6a01 }\n\n      // n = 6, score = 800\n\n      //  ff15????????     |          \n\n      //  85c0         | test        eax, eax\n\n      //  7407         | je         9\n\n      //  50          | push        eax\n\n      //  ff15????????     |          \n\n      //  6a01         | push        1\n\n    $sequence_2 = { 6a01 50 56 e8???????? 83c410 8bc7 }\n\n      // n = 6, score = 800\n\n      //  6a01         | push        1\n\n      //  50          | push        eax\n\n      //  56          | push        esi\n\n      //  e8????????      |          \n\n      //  83c410        | add         esp, 0x10\n\n      //  8bc7         | mov         eax, edi\n\n    $sequence_3 = { 6a00 ff15???????? 85c0 7407 50 ff15???????? 6a01 }\n\n      // n = 7, score = 800\n\n      //  6a00         | push        0\n\n      //  ff15????????     |          \n\n      //  85c0         | test        eax, eax\n\n      //  7407         | je         9\n\n      //  50          | push        eax\n\n      //  ff15????????     |          \n\n      //  6a01         | push        1\n\n```\n\n-----\n\n```\n    $sequence_4 = { 6a04 50 6a04 68???????? 68???????? }\n\n      // n = 5, score = 800\n\n      //  6a04         | push        4\n\n      //  50          | push        eax\n\n      //  6a04         | push        4\n\n      //  68????????      |          \n\n      //  68????????      |          \n\n    $sequence_5 = { 56 57 68da070000 e8???????? }\n\n      // n = 4, score = 800\n\n      //  56          | push        esi\n\n      //  57          | push        edi\n\n      //  68da070000      | push        0x7da\n\n      //  e8????????      |          \n\n    $sequence_6 = { 50 56 e8???????? 83c410 8b4618 }\n\n      // n = 5, score = 800\n\n      //  50          | push        eax\n\n      //  56          | push        esi\n\n      //  e8????????      |          \n\n      //  83c410        | add         esp, 0x10\n\n      //  8b4618        | mov         eax, dword ptr [esi + 0x18]\n\n    $sequence_7 = { 8b4d08 668b91d2070000 8a89d0070000 52 51 }\n\n      // n = 5, score = 800\n\n      //  8b4d08        | mov         ecx, dword ptr [ebp + 8]\n\n      //  668b91d2070000    | mov         dx, word ptr [ecx + 0x7d2]\n\n      //  8a89d0070000     | mov         cl, byte ptr [ecx + 0x7d0]\n\n      //  52          | push        edx\n\n      //  51          | push        ecx\n\n    $sequence_8 = { 53 56 57 68da070000 }\n\n      // n = 4, score = 800\n\n      //  53          | push        ebx\n\n      //  56          | push        esi\n\n      //  57          | push        edi\n\n      //  68da070000      | push        0x7da\n\n    $sequence_9 = { 8b4d08 668b91d2070000 8a89d0070000 52 }\n\n      // n = 4, score = 800\n\n      //  8b4d08        | mov         ecx, dword ptr [ebp + 8]\n\n      //  668b91d2070000    | mov         dx, word ptr [ecx + 0x7d2]\n\n      //  8a89d0070000     | mov         cl, byte ptr [ecx + 0x7d0]\n\n      //  52          | push        edx\n\n  condition:\n\n    7 of them and filesize < 770048\n\n}\n\n### By Cyber Threat Hunters from MSSPLab:\n\n @cocomelonc @wqkasper\n\n Thanks for your time happy hacking and good bye! All drawings and screenshots are MSSPLab’s\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2023/2023-05-08 - Malware analysis report- WinDealer (LuoYu Threat Group).pdf"
    ],
    "report_names": [
        "2023-05-08 - Malware analysis report- WinDealer (LuoYu Threat Group).pdf"
    ],
    "threat_actors": [
        {
            "id": "f8dddd06-da24-4184-9e24-4c22bdd1cbbf",
            "created_at": "2023-01-06T13:46:38.626906Z",
            "updated_at": "2025-03-27T02:00:02.877001Z",
            "deleted_at": null,
            "main_name": "Tick",
            "aliases": [
                "Stalker Taurus",
                "PLA Unit 61419",
                "Nian",
                "BRONZE BUTLER",
                "REDBALDKNIGHT",
                "STALKER PANDA",
                "G0060"
            ],
            "source_name": "MISPGALAXY:Tick",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d4e7cd9a-2290-4f89-a645-85b9a46d004b",
            "created_at": "2022-10-25T16:07:23.419513Z",
            "updated_at": "2025-03-27T02:02:09.790389Z",
            "deleted_at": null,
            "main_name": "Bronze Butler",
            "aliases": [
                "Bronze Butler",
                "CTG-2006",
                "Operation ENDTRADE",
                "RedBaldNight",
                "Stalker Panda",
                "Stalker Taurus",
                "TEMP.Tick",
                "Tick"
            ],
            "source_name": "ETDA:Bronze Butler",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "9002 RAT",
                "AngryRebel",
                "Blogspot",
                "Daserf",
                "Datper",
                "Elirks",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "HOMEUNIX",
                "HidraQ",
                "HomamDownloader",
                "Homux",
                "Hydraq",
                "Lilith",
                "Lilith RAT",
                "McRAT",
                "MdmBot",
                "Mimikatz",
                "Minzen",
                "Moudour",
                "Muirim",
                "Mydoor",
                "Nioupale",
                "PCRat",
                "POISONPLUG.SHADOW",
                "Roarur",
                "RoyalRoad",
                "ShadowPad Winnti",
                "ShadowWali",
                "ShadowWalker",
                "SymonLoader",
                "WCE",
                "Wali",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "XShellGhost",
                "XXMM",
                "gsecdump",
                "rarstar"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "bf0489c5-1c07-41e6-91c9-855ad96ccc6a",
            "created_at": "2022-10-25T16:47:55.541639Z",
            "updated_at": "2025-03-27T02:05:17.253496Z",
            "deleted_at": null,
            "main_name": "BRONZE BUTLER",
            "aliases": [
                "Daserf",
                "Stalker Panda ",
                "Tick ",
                "CTG-2006 "
            ],
            "source_name": "Secureworks:BRONZE BUTLER",
            "tools": [
                " DGet",
                " Daserf",
                " Datper",
                " Gofarer",
                " MSGet",
                " Mimikatz",
                " RarStar",
                " Screen Capture Tool",
                " ShadowPad",
                " T-SMB",
                " WinRAR",
                " Windows Credential Editor",
                " gsecdump",
                " xmm downloader",
                " xxmm",
                "ABK"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "b72c2616-cc7c-4c47-a83d-6b7866b94746",
            "created_at": "2023-01-06T13:46:39.425297Z",
            "updated_at": "2025-03-27T02:00:03.08718Z",
            "deleted_at": null,
            "main_name": "Red Nue",
            "aliases": [
                "LuoYu"
            ],
            "source_name": "MISPGALAXY:Red Nue",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1685930868,
    "ts_updated_at": 1743041822,
    "ts_creation_date": 1685882379,
    "ts_modification_date": 1685882379,
    "files": {
        "pdf": "https://archive.orkl.eu/987c5a3f673177f6cbbb0ed6ac060ea4315ec442.pdf",
        "text": "https://archive.orkl.eu/987c5a3f673177f6cbbb0ed6ac060ea4315ec442.txt",
        "img": "https://archive.orkl.eu/987c5a3f673177f6cbbb0ed6ac060ea4315ec442.jpg"
    }
}