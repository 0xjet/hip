{
    "id": "42863e46-271f-4237-bc56-b5769228815f",
    "created_at": "2023-01-12T15:09:46.167573Z",
    "updated_at": "2025-03-27T02:09:29.725675Z",
    "deleted_at": null,
    "sha1_hash": "ee3243a7c06176aa1276266b93326510f0a2e47e",
    "title": "2019-03-13 - BlackBerry Cylance vs. Tinba Banking Trojan",
    "authors": "",
    "file_creation_date": "2022-05-28T02:30:02Z",
    "file_modification_date": "2022-05-28T02:30:02Z",
    "file_size": 600269,
    "plain_text": "# BlackBerry Cylance vs. Tinba Banking Trojan\n\n**[blogs.blackberry.com/en/2019/03/blackberry-cylance-vs-tinba-banking-trojan](https://blogs.blackberry.com/en/2019/03/blackberry-cylance-vs-tinba-banking-trojan)**\n\nThe BlackBerry Cylance Threat Research Team, Tatsuya Hasegawa\n\n[RESEARCH & INTELLIGENCE / 03.13.19 /](https://blogs.blackberry.com/en/category/research-and-intelligence)\n\n_Our ‘BlackBerry Cylance Versus’ series takes an in-depth look at malware from A to Z, from_\n_past to present, with a goal of throwing light on how and why threats that may have been_\n_active for years still work, and what we, as a security community, can do to combat them._\n\nTinba (aka. Tina or Zusy), which stands for “Tiny Banker”, is a banking Trojan that has\ntargeted Windows computers since 2012. It is a famously small malware, file-wise, with a\ncode base of 20 kB. It is specifically designed to target financial institutions. Tinba steals\nbrowsing data, login credentials, and other sensitive information by using Man-in-theBrowser (MitB) attacks.\n\nTinba performs code injections on running processes to hide itself and achieve persistence.\nIn 2014 the source code for Tinba leaked on an underground cybercrime forum, giving\nthreat actors worldwide access to this powerful malware.\n\n## Tinba Analyzed\n\nOur analysis of Tinba was performed on the following hashes:\n\nE7C0B1BD0DB584D82E3D77F283467C899656075189183B5A8F8431C458E60321\n0283798A83AA597BF15ED5A59C21E68D66F6789B2ACABBE87DCA9C089608B893\n83C2B35F72749433E76B16F25A1CA9715B55AA280FB5D158389EAFD17CD0D392\n\n## Code Features\n\n\n-----\n\nThe Tinba variants we analyzed have the product/project name **Dealhoya . They are**\ncompiled with Visual Basic 6 which requires VB6 runtime to run. These variants attempt to\ncamouflage themselves as a flash game. The file description reads “flash game Lucknow is\n_the capital city of the state of Uttar” and the filename is FergusGamez.exe._\n\nTrue to its reputation, the Tinba files are tiny, each weighing in at less than 100 kB. The\nmalware files are highly obfuscated as shown in Figure 1:\n\n_Figure 1: Tinba’s obfuscated code_\n\n## Evasion Technique\n\nTinba can detect and evade virtual environments by calling the following Windows APIs:\n\nGetDiskFreeSpaceExW\nGlobalMemoryStatusEx\nGetAdaptersAddresses\n\nTinba also monitors user activity in the active window by calling GetForegroundWindow.\nThese functions allow the malware to judge whether the platform is an analysis environment\nsuch as sandbox or debugger.\n\n## Code Injection\n\nWhen Tinba executes it creates another process of itself. This second process launches a\nlegit Windows application called winver.exe and injects the malicious code into it.\nWinver.exe is the standard program for displaying Windows version information.\n\nThe injected code checks for the presence of explorer.exe by finding the window with the\n_Shell_TrayWnd class name. If found, the malware attempts to inject secondary code into_\n_explorer.exe. The secondary code also injects the main Tinba code into all active_\n\n\n-----\n\nprocesses. When successful, this attack results in ten or more injected process running\nTinba in their threads (See Figure 2):\n\n_Figure 2: Tinba execution flow_\n\n## Dropping the EXE File\n\nThe infected explorer.exe serves as the main process of Tinba. It drops bin.exe into\n%AppData% and adds the following RUN key to achieve persistence:\n\nRegistry key: HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\(random string)\n\nRegistry value: %AppData%\\(random string)\\bin.exe\n\nThe random string is eight alphanumeric characters ([0-9A-Z]{8} in regular expression) that\nare unique to each infected machine. Bin.exe is the polymorphic version of Tinba, which\nmeans the file hash differs for each infection. The malware also creates directories using\nthe random string then sets the hidden attribute:\n\n%AppData%\\Local\\Packages\\windows_ie_ac_001\\AC\\(random string)\n%AppData%\\LocalLow\\(random string)\n%AppData%\\(random string)\n\n## Command and Control (C2) Communication\n\nTinba connects to the C2 server to post the 157 bytes of encrypted system information\nusing the HTTP POST method:\n\n\n-----\n\nC2 URL: hxxp://recdataoneveter[.]cc/vet7sdfh678sdjjs7er0k/\nDNS resolved IP address: 216[.]218[.]185[.]162\n\n_Figure 3: Tinba C2 protocol_\n\nSome variants of Tinba use DGA (Domain Generation Algorithm) domains. This process\nuses a hardcoded domain as the seed to generate short-lived DGA domains which\nobfuscate C2 communications. Tinba also uses Fast Flux domains where allocated IP\naddress change frequently. In the above case, the server was not available at the time of\nour investigation because it was taken down.\n\nWhen the C2 connection succeeds, Tinba downloads additional payloads like a browser\ninjection module and a new banking target URL list. It will also install any pending updates.\n\n## MITB for Stealing Bank Account Credentials\n\nThe infected explorer.exe seeks out Internet Explorer and Firefox so Tinba can use Man-inthe-Browser (MitB) attacks to steal bank account information. Tinba targets accounts\nrelated to financial institutions, Google, Facebook, and Microsoft. Malicious code injected\ninto the browser will monitor credential information as it is entered into login pages or steal it\nfrom the browser cache. Tinba encrypts stolen data with the RC4 algorithm and sends it to\nthe C2 server.\n\n## Indicators of Compromise (IOCs)\n\n\n-----\n\n**Sample Hashes**\nE7C0B1BD0DB584D82E3D77F283467C899656075189183B5A8F8431C458E60321\n0283798A83AA597BF15ED5A59C21E68D66F6789B2ACABBE87DCA9C089608B893\n83C2B35F72749433E76B16F25A1CA9715B55AA280FB5D158389EAFD17CD0D392\n\n**Filenames**\no FergusGamez.exe\n\n**C2s/IPs**\no hxxp://recdataoneveter[.]cc/vet7sdfh678sdjjs7er0k/\no 216[.]218[.]185[.]162\n\n**Registry**\no key: HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\[0-9A-Z]{8}§\n   - value: %AppData%\\[0-9A-Z]{8}\\bin.exe\n\n**Create Folder**\no %AppData%\\Local\\Packages\\windows_ie_ac_001\\AC\\[0-9A-Z]{8}\no %AppData%\\LocalLow\\[0-9A-Z]{8}\no %AppData%\\[0-9A-Z]{8}\n\n## BlackBerry Cylance Stops Tinba\n\n[Blackberry Cylance offers a](http://cylance.com/en-us/platform/products/index.html) [predictive advantage over zero-day threats and is also effective](https://threatvector.cylance.com/en_us/home/cylance-vs-future-threats-the-predictive-advantage.html)\nagainst legacy malware like Tinba. Blackberry Cylance uses artificial intelligence (AI) agents\ntrained for threat detection on millions of both safe and unsafe files. This allows BlackBerry\nCylance prevent Tinba from executing based on the analysis of several malicious file\nattributes instead of a specific file signature.\n\n## About The BlackBerry Cylance Threat Research Team\n\n\n-----\n\nThe BlackBerry Cylance Threat Research team examines malware and suspected malware\nto better identify its abilities, function and attack vectors. Threat Research is on the frontline\nof information security and often deeply examines malicious software, which puts us in a\nunique position to discuss never-seen-before threats.\n\n## About Tatsuya Hasegawa\n\nSenior Threat Researcher at BlackBerry Cylance\n\n[Tatsuya Hasegawa is a Senior Threat Researcher in APAC at BlackBerry, and is](https://www.linkedin.com/in/tatsuya-hasegawa-aa3279142/)\nresponsible for malware analysis and sandbox technology. He has practical experience in\nthe both managed security service provider as a security analyst and CSIRT as an incident\nhandler. His certifications include: GREM, GCIH, GCFA, GXPN, GPEN and CISSP.\n\nBack\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-03-13 - BlackBerry Cylance vs. Tinba Banking Trojan.pdf"
    ],
    "report_names": [
        "2019-03-13 - BlackBerry Cylance vs. Tinba Banking Trojan.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "4d5f939b-aea9-4a0e-8bff-003079a261ea",
            "created_at": "2023-01-06T13:46:39.04841Z",
            "updated_at": "2025-03-27T02:00:02.985296Z",
            "deleted_at": null,
            "main_name": "APT41",
            "aliases": [
                "G0096",
                "Grayfly",
                "BARIUM",
                "BRONZE ATLAS",
                "BRONZE EXPORT",
                "Red Kelpie",
                "HOODOO",
                "Brass Typhoon",
                "TA415",
                "WICKED SPIDER",
                "WICKED PANDA",
                "G0044",
                "Earth Baku"
            ],
            "source_name": "MISPGALAXY:APT41",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "e698860d-57e8-4780-b7c3-41e5a8314ec0",
            "created_at": "2022-10-25T15:50:23.287929Z",
            "updated_at": "2025-03-27T02:00:55.43005Z",
            "deleted_at": null,
            "main_name": "APT41",
            "aliases": [
                "APT41",
                "Wicked Panda",
                "Brass Typhoon",
                "BARIUM"
            ],
            "source_name": "MITRE:APT41",
            "tools": [
                "ASPXSpy",
                "BITSAdmin",
                "PlugX",
                "Impacket",
                "gh0st RAT",
                "netstat",
                "PowerSploit",
                "ZxShell",
                "KEYPLUG",
                "ipconfig",
                "sqlmap",
                "China Chopper",
                "ShadowPad",
                "MESSAGETAP",
                "Mimikatz",
                "certutil",
                "njRAT",
                "Cobalt Strike",
                "pwdump",
                "BLACKCOFFEE",
                "ROCKBOOT",
                "dsquery",
                "Winnti for Linux",
                "DUSTTRAP",
                "Derusbi",
                "ftp"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673536186,
    "ts_updated_at": 1743041369,
    "ts_creation_date": 1653705002,
    "ts_modification_date": 1653705002,
    "files": {
        "pdf": "https://archive.orkl.eu/ee3243a7c06176aa1276266b93326510f0a2e47e.pdf",
        "text": "https://archive.orkl.eu/ee3243a7c06176aa1276266b93326510f0a2e47e.txt",
        "img": "https://archive.orkl.eu/ee3243a7c06176aa1276266b93326510f0a2e47e.jpg"
    }
}