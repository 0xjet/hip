{
    "id": "bea0e37e-33b7-4661-ae68-0ccf4a08de4f",
    "created_at": "2023-01-12T15:08:54.133357Z",
    "updated_at": "2025-03-27T02:09:29.846221Z",
    "deleted_at": null,
    "sha1_hash": "33f78cb81e8b6278f86c39762a88dcd6aea14e42",
    "title": "2012-11-05 - Citadel- a cyber-criminal’s ultimate weapon-",
    "authors": "",
    "file_creation_date": "2022-05-28T19:20:58Z",
    "file_modification_date": "2022-05-28T19:20:58Z",
    "file_size": 1303300,
    "plain_text": "# Citadel: a cyber-criminal’s ultimate weapon?\n\n**[blog.malwarebytes.com/threat-analysis/2012/11/citadel-a-cyber-criminals-ultimate-weapon/](https://blog.malwarebytes.com/threat-analysis/2012/11/citadel-a-cyber-criminals-ultimate-weapon/)**\n\nJérôme Segura November 5, 2012\n\nIn old times, a citadel was a fortress used as the last line of defense. For cyber criminals it is\na powerful and state-of-the-art toolkit to both distribute malware and manage infected\ncomputers (bots). Citadel is an offspring of the (too) popular Zeus crimekit whose main goal\nis to steal banking credentials by capturing keystrokes and taking screenshots/videos of\nvictims’ computers. Citadel came out circa January 2012 in the online forums and quickly\nbecame a popular choice for criminals. A version of Citadel (1.3.4.5) was leaked in late\nOctober and although it is not the latest (1.3.5.1), it gives us a good insight into what tools\nthe bad guys are using to make money.\n\nIn this post, I will show you how criminals operate a botnet. This is not meant as a tutorial\nand I do want to stress that running a botnet is illegal and could send you to jail.\n\n**A nice home**\n\nIn order to get into business the bad guys need a server that is hosted at a company that will\nturn a blind eye on their activities and also guarantee them some anonymity. Such\ncompanies are called Bulletproof hosting and can be found in most underground forums\n(Figure 1).\n\n\n-----\n\n_Figure 1: an ad for Bulletproof hosting_\n\nThose hosting firms are for the most part located in countries like China or Russia and\ntherefore in their own jurisdiction where so long as you don’t commit crimes against your own\npeople not a whole lot can happen to you. To cover their tracks even more, the bad guys use\nproxy or VPN services that disguise their own IP address.\n\n**A shiny new toy**\n\nOnce set up with a server, it is time to install what will be the mastermind program to create\nand organize an entire array (botnet) of infected computers worldwide. A variety of crimekits\nexist but in this post we will concentrate on Citadel.\n\n\n-----\n\nOnce again, the core installation files can be found in the underground community or through\nyour own connections. Recently, the Citadel kit was withdrawn from forums to prevent too\nmuch exposure and attention. It costs around $3000 USD.\n\nFigure 2 shows what the package looks like. An instruction manual in both Russian and\nEnglish is provided. The kit requires server software such as Apache, and PHP with a\nMySQL database to work properly.\n\n_Figure 2: the citadel package_\n\nTo install Citadel, you simply browse to the install folder with your browser (Figure 3) and set\nup the main access username and password as well as database information.\n\n\n-----\n\n_Figure 3: Citadel’s installation screen_\n\nIn this testing, the installer did not automatically create the database but you can do so by\nhand (Figure 4):\n\n_Figure 4: creating a database for Citadel’s exploit pack_\n\nTo finally access the login page, you need to browse to the cp.php file (Figure 5):\n\n\n-----\n\n_Figure 5: Citadel’s login page_\n\nBefore logging in, I want to show you the other component that makes this package\ncomplete. It is called the builder (Figure 6) and is essentially used to create the piece of\nmalware that criminals will distribute (forced installs through infected websites) and that links\nto their crimekit.\n\n_Figure 6: creating the Citadel bot with the builder_\n\nThe malware is built to avoid AV detection and is tested with online virus scanners like\nScan4You, an equivalent to the popular VirusTotal except this one is totally anonymous and\ndoes not share uploaded samples with antivirus vendors. Speaking of which, once installed\non the victim’s machine, the malware will prevent access to security sites (Figure 7).\n\n\n-----\n\nFigure 7: a list of antivirus vendors that are blocked by Citadel’s malware\n\nHere is an [example of an infection from a Citadel Trojan.](http://www.threatexpert.com/report.aspx?md5=91b64502a89d6c47d1adbde3ebbf2532)\n\nInfected PCs all report to the mothership and wait for orders. This is where it gets interesting\nbecause making malware is one thing but actually managing your own campaigns is the key\nto success. The Citadel control panel is well designed and puts a lot of features at your\nfingertips (Figure 8).\n\n\n-----\n\n_Figure 8: Citadel’s Control Panel_\n\nEach feature is actually a module written in PHP as seen on Figure 9. The control panel\ngives you an overview of the machines that have been infected. It’s a sort of Malware\nAnalytics with stats by country, Operating System, etc…\n\n\n-----\n\n_Figure 9: Citadel’s modules_\n\nThe main purpose of Citadel is to steal banking credentials and so it’s no big surprise to see\nadvanced search features to specifically look for financial institutions (Figure 10).\n\n_Figure 10: Citadel’s advanced search features_\n\nA password is a password whether it’d be for a bank or something more common like a\nFacebook or Gmail account. In fact, you can customize any site that is of interest to you and\ncapture the credentials. Notifications of successfully stolen passwords can be sent via\nInstant Message through the Jabber protocol (Figure 11).\n\n\n-----\n\n_Figure 11: Citadel’s custom rules and notifications_\n\nStolen credentials are harvested by various means:\n\nKeystroke logging\nScreenshot capture\nVideo capture\n\nA powerful feature used to trick users into revealing confidential information is\ndubbed WebInject. It is powerful because it happens in real time and is completely seamless.\nA WebInject is a piece of code that contains HTML and JavaScript which creates a fake popup that asks the victim for personal information within the context of logging into a site. The\nbad guys can trigger it in two ways: either automatically when a site of interest is opened by\nthe victim, or manually on the fly.\n\nIt is the ultimate phishing tool because it does not go against any known proper precautions\na user would normally take. For instance, the site’s URL is unchanged and shows the secure\npad lock with the financial institution’s SSL certificate (Figure 12). This type of hack is also\ncalled a man-in-the-middle attack.\n\n\n-----\n\n_Figure 12: Man-in-the-middle attack through webinject_\n\nIn case this method does not work (some people might get suspicious), the bad guys can\nalways revert to a more direct approach with some ransomware. Citadel is also involved in\nthe distribution of the FBI Moneypak (also known as Reveton) malware which locks the user\nout of his computer and demands $200 (Figure 13). It is customized based on the victim’s\ncountry of origin.\n\n\n-----\n\n_Figure 13: Reveton ransomware distributed by Citadel Trojan_\n\nSince a lot of people download music and movies from torrents or other shady sites, the\nmessage tricks them into thinking they have been caught by the local authorities. It’s a very\nsmart scare tactic which works quite well, unfortunately. To add to the drama, the malware\nwill attempt to turn on the user’s webcam as if they were already under surveillance.\n\nThe FBI has posted an article regarding this scam\n[(http://www.fbi.gov/news/stories/2012/august/new-internet-scam) and urges people to not](http://www.fbi.gov/news/stories/2012/august/new-internet-scam)\npay any money as it could get you into even more troubles.\n\nMalwarebytes users are protected against the FBI Moneypak malware. If you aren’t one of\nthem and are already infected you can remove this ransomware by following these 3 steps:\n\n1. Reboot your computer into Safe Mode with Networking. (Instructions from Microsoft\n\n[here)](http://www.microsoft.com/resources/documentation/windows/xp/all/proddocs/en-us/boot_failsafe.mspx?mfr=true)\n[2. Download Malwarebytes Anti-Malware.](http://www.malwarebytes.org/)\n3. Run Malwarebytes Anti-Malware and remove all malware (Figure 14)\n\nThat’s it!\n\n\n-----\n\n_Figure 14: Reveton ransomware Trojan detected by Malwarebytes Anti-Malware._\n\n**What’s next for Citadel?**\n\nThe latest version (1.3.5.1) whose code name is Rain Edition is getting pricey at $3931 but it\nincludes a lot of valuable features (advanced support for Chrome and Firefox, improved\nWebInjects, smarter ‘on-the-fly’ updates to the Trojan, etc…).\n\nThe makers of Citadel are trying to keep a low enough profile to avoid gathering too much\nattention which could result in efforts to go after them (as we have seen with Zeus). Getting\nyour hands on Citadel is more difficult because of a stricter validation process within the\nRussian underground.\n\n**How to protect yourself**\n\nWhen seeing such technically advanced crimekits it puts a lot of things into perspective. The\nmethods used to steal personal information are so advanced and sneaky that even the most\ncautious user may get fooled. It is best to avoid infection in the first place by using a solution\nsuch as [Malwarebytes Anti-Malware PRO that constantly protects your computer by blocking](http://www.malwarebytes.org/)\nmalicious sites and files. Using a combination of both safe online practices (if you ever feel\nuncomfortable disclosing personal information, give your bank a call or ask a friend) and a\ngood anti malware solution will keep you safe(r).\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2012/2012-11-05 - Citadel- a cyber-criminal’s ultimate weapon-.pdf"
    ],
    "report_names": [
        "2012-11-05 - Citadel- a cyber-criminal’s ultimate weapon-.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536134,
    "ts_updated_at": 1743041369,
    "ts_creation_date": 1653765658,
    "ts_modification_date": 1653765658,
    "files": {
        "pdf": "https://archive.orkl.eu/33f78cb81e8b6278f86c39762a88dcd6aea14e42.pdf",
        "text": "https://archive.orkl.eu/33f78cb81e8b6278f86c39762a88dcd6aea14e42.txt",
        "img": "https://archive.orkl.eu/33f78cb81e8b6278f86c39762a88dcd6aea14e42.jpg"
    }
}