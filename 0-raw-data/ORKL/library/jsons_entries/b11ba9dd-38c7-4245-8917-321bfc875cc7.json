{
    "id": "b11ba9dd-38c7-4245-8917-321bfc875cc7",
    "created_at": "2023-01-12T15:04:36.602932Z",
    "updated_at": "2025-03-27T02:06:07.506214Z",
    "deleted_at": null,
    "sha1_hash": "d702478d5627a4aa9a5bda19e70b8ffdf1a48ada",
    "title": "2020-09-15 - Threat analysis- The emergent URSA trojan impacts many countries using a sophisticated loader",
    "authors": "",
    "file_creation_date": "2022-05-28T21:47:39Z",
    "file_modification_date": "2022-05-28T21:47:39Z",
    "file_size": 12563998,
    "plain_text": "# Threat analysis: The emergent URSA trojan impacts many countries using a sophisticated loader\n\n**[seguranca-informatica.pt/threat-analysis-the-emergent-ursa-trojan-impacts-many-countries-using-a-sophisticated-loader/](https://seguranca-informatica.pt/threat-analysis-the-emergent-ursa-trojan-impacts-many-countries-using-a-sophisticated-loader/)**\n\nSeptember 15, 2020\n\n**Threat analysis: The emergent URSA trojan ‚Äì and also known as mispadu malware by ESET ‚Äì impacts many**\n**countries using a sophisticated loader.**\n[Since last June 2020, a new wave of the URSA trojan ‚Äì a derivation and also known as mispadu malware by ESET](https://www.welivesecurity.com/2019/11/19/mispadu-advertisement-discounted-unhappy-meal/)\n‚Äì has affected users from several countries, including Bolivia, Chile, Mexico, Argentina, Ecuador, Peru,\n**Colombia, Paraguay, Costa Rica, Brazil, Spain, Italy, and Portugal. This malware is a trojan malware, and when**\ninstalled on the victim‚Äôs devices, it collects passwords from browsers and from popular software such as FTP and\nemail services and also performs banking browser overlay to lure the victims to introduce the banking credentials\nwhile the flow is executed ‚Äì step-by-step ‚Äì in the background by criminals.\n\nBelow, a geographic representation of the number of infections between June and mid-September 2020 around the\nworld according to Table 1.\n\n## URSA trojan ‚Äì Geomap of Infections\n\n### June ‚Äì mid-September 2020\n\n**_Table 1: URSA trojan ‚Äì infections by country between June and mid-September 2020._**\n\nIn total, 3.379 users were impacted by this threat from June ‚Äì mid-September 2020 according to data obtained from\nsome C2s this wave. With a total of 1977 infections, Mexico is the country with more users affected, followed by\n**Spain ‚Äì 631 victims, Portugal ‚Äì 514, and Chile ‚Äì 331.**\n\nIt is important to realize that the number of infections may have been much higher, as these indicators are only\nrelated to the data existing in some of the C2s presented at the end of the article. For example, no infections have\nbeen identified in Italy, which cannot be true.\n\n## How URSA trojan spreads\n\n\n-----\n\nURSA malware is a relatively recent trojan and aims to steal credentials from victims machines and to create\n**banking overlay windows when the victim visits their home banking portals. URSA is propagated via social**\nengineering schemas ‚Äì namely, phishing/malscam campaigns. In Portugal, the threat has been disseminated inthe-wild and impersonating four popular organizations, namely Vodafone, EDP (Energias de Portugal), MEO\n(Servi√ßos de Comunica√ß√µes e Multim√©dia, S.A), and Pol√≠cia Judic√≠aria ‚Äì one of the police organizations\nresponsible for criminal investigations in Portugal.\n\nThe email message generally refers to overdue invoices ‚Äì the decoy ‚Äì in order to lure the victim to download the\nmalicious file (a .zip file downloaded from the Internet). These emails are often sent between the end and the\nbeginning of each month.\n\n**_Figure 1: Email templates of URSA impersonating Vodafone, EDP and Pol√≠cia Jud√≠ciaria ‚Äì Portugal._**\n\n## URSA loader in detail and the rabbit holes\n\nAt first glance, the file downloaded via the malicious URL sent by criminals on the email scam is a zip file with an\n**[MSI (Microsoft Installer) inside. By analyzing the MSI file, it‚Äôs possible to observe that another file is available](https://www.virustotal.com/gui/file/23892054f9494f0ee6f4aa8749ab3ee6ac13741a0455e189596edfcdf96416b3/details)**\n**inside, and probably dropped when the MSI is executed. That file called px3q8x.vbs is a VBscript file responsible**\nfor loading and executing the next stages. Interesting to note this file has a low detection rate bypassing, thus,\npopular antivirus (AV) engines.\n\n**Threat name: 554S2000A2S144D1S4111D.zip**\n\n**MD5: 2d2f3500836ed60303103bafac6357a3**\n\n**Threat name: 554S2000A2S144D1S4111D.msi**\n\n**MD5: 3be539aa8d421d09cef27723a98d2d83**\n\n**Threat name: px3q8x.vbs (initial payload ‚Äì VBScript)**\n\n**MD5: a4f066196b1009c42c1dea74f857180d**\n\n\n-----\n\n**_Figure 2: MSI file with another file inside ‚Äì a VBScript called px3q8x.vbs ‚Äì the Ursa trojan VBScript loader._**\n\nDuring this article, we can observe that the URSA trojan has two loaders. First, a VBScript loader followed by\nseveral rounds of obfuscation and rabbit holes. The final VBScript is responsible for starting and dropping the\nfiles on disk and executing an AutoIt loader/injector. That binary injects into the memory via the Process\nInjection technique some DLLs, including a Delphi binary related to the banking overlay windows, and also the\none that establishes all the communication with the C2 server.\n\nThe following image presents a high-level diagram of how the URSA trojan works.\n\n\n-----\n\n**_Figure 3: URSA trojan / Mispadu 2020 ‚Äì high-level diagram._**\n\n## VBScript deobfuscation rounds\n\nAfter extracting the **[VBscript loader, we observed that it is very confused and obfuscated as presented in Figure 4.](https://www.virustotal.com/gui/file/d1fb8a5061fc40291cc02cec0f1c2d13168b17d22ffcabea62816e14ed58e925/)**\n\n\n-----\n\n**_Figure 4: URSA VBScript loader ‚Äì code obfuscated to bypass AV and make hard its analysis._**\n\nSome deobfuscation rounds after, we got a more readable version. Notice that some parts related to useless code\nwere removed. In detail, the VBscript is grouped into two parts. The first part is the method of the Installer object that\nreturns a new Record object with the requested number of fields (code highlighted below).\n\n**_Figure 5: Analysis of URSA loader VBScript ‚Äì first part ‚Äì record object part._**\n\nThe second part is the code of the next payload encoded. That payload is then executed and is responsible for\ndecoding another payload (the 2nd payload in Figure 5 ‚Äì step 5).\n\n\n-----\n\n**_Figure 6: Analysis of URSA loader VBScript ‚Äì second part ‚Äì payload 2._**\n\nThis new payload (after deobfuscating the code and renaming some functions and variables) is another VBScript,\nwith the final payload that requests the next stage from the C2 server. Of course, this was funny, some rounds of\nrabbit holes.\n\n\n-----\n\n**_Figure 7: Analysis of URSA loader VBScript ‚Äì third part ‚Äì payload 3 ‚Äì step 8._**\n\n\n-----\n\n**_Figure 8: Network traffic when the next malware stage is downloaded from C2._**\n\nFinally and highlighted above, we got the C2 IP address (191.235.99.]13) and the final payload this stage from the\nC2 server.\n\n## URSA trojan ‚Äì VBscript loader/dropper (the final VBScript)\n\n**Threat name: final payload (VBScript)**\n\n**MD5: bda287c97d9373052f347ac0ccedfdf8**\n\nAfter some rabbit holes, finally, we got the URSA VBScript loader totally deobfuscated from the C2 server. Just the\nmalware configuration is encrypted, and all the communications between the C2 server and trojan clients are\nperformed using the same algorithm, even during the final stage of this malware ‚Äì a Delphi PE file responsible to\ncreate the banking overlay windows, collect credentials from the victim‚Äôs machine, and send all the date to the C2\nonline.\n\n\n-----\n\n**_Figure 9: URSA final VBScript loader and its configuration._**\n\nFrom Figure 9, we can observe the following:\n\nsome paths from the C2 server (SRoleX and sRoleXW2)\nthe path where binary files from C2 are downloaded to (cRaiz1); and\nsome sections that are used to build the final stage (an AutoIT binary responsible for injecting and executing\nthe malware final stage into the memory ‚Äì the mentioned Delphi file).\n\nAs mentioned, all the communications from this point are encrypted between the malware and the C2 server. In\n[order to decrypt the malware communication, we can use the next script available on GitHub.](https://github.com/sirpedrotavares/SI-LAB-malware/blob/master/decryption%20strings%20ursa%20trojan)\n\nBy executing the script, decrypt the malware config was possible as observed below.\n\n\n-----\n\n**_Figure 10: Ursa trojan config decrypted._**\n\nThe variables ‚Äú#wp#‚Äù are the final C2 endpoint where the victim‚Äôs information is sent during the malware execution.\nAlso, several host repetitions were identified. This is a potential C2, that notifies criminals when a new victim is\naffected. Nonetheless, the malware next stage is downloaded from the IP address (191.235.99.]13) as analyzed\nabove.\n\nDuring the VBScript code analysis, some functions were identified:\n\n\n-----\n\n```\n           p y ( p,, p y )\nfunction crypt(cText, cCod) \nfunction decrypt(cText, cCod)\nFunction UnZip(ZipFile, ExtractTo)\nFunction StringGetURL(sUrl)\nFunction BinaryGetURL(strURL)\nFunction StringGetURL(strURL)\nFunction SaveBinaryData(arrByteArray, strFileName)\nSub writeBinary(bstr, path)\nFunction makeArray(n) ' Small utility function\nFunction TrocaEntry(strFileName1, strFileName, sSenhaVelha, sSenhaNova)\nfunction cr1pt(x, c)\n\n```\nIn general, the next malware stage is retrieved from the C2 server in several parts and then built on the fly. The files\nare encrypted and are decrypted during the malware execution. Next, a final PE file is built during this process.\nSome interesting functions are presented below. Interesting to note that the user agent used to download the files is:\n‚ÄústrUserAgentString = ‚Äúbinary_getter/1.0‚Äù‚Äú.\n\n**_Figure 11: Some parts and functions of the VBScript file._**\n\nAfter this initial process, some validations regarding the victim device are performed to start the next stage. The\nOperating System (OS) version is retrieved, and if it is a virtual environment, the script terminates its execution.\nInteresting to observe this anti-VM technique earlier on the trojan loader. With this logic in place, the final payload is\nnot loaded and downloaded from the C2 allowing it not to be at least flagged by antivirus engines.\n\n\n-----\n\n**_Figure 12: Anti-VM technique found on the URSA loader._**\n\nNext, the script validates the victim devices is geo-located in target locations defined by the malware operators,\nnamely:\n\n**Spanish ‚Äì Spain (Traditional) 1034**\n**Portuguese ‚Äì Brazil ‚Äì 1046**\n**Spanish ‚Äì Mexico ‚Äì 2058**\n\n\n-----\n\n**Portuguese Portugal 2070**\n**Spanish ‚Äì 58378, 3082**\n\n**_Figure 13: Target locations affected by URSA malware._**\n\nIf the victim‚Äôs computer is executing in a language ID different from the hardcoded, or the computer name is equal to\n**‚ÄúJOHN-PC‚Äú, the infection process stops. Change the computer name to ‚ÄúJOHN-PC‚Äù is a potential killswitch to**\n**avoid URSA infections.**\n\nAt this moment, the next stage is downloaded from the C2 server. The files are stored into the C:\\Users\\Public folder\n(tmp file), and next moved to a random folder created on the C:\\ drive. The name of this folder is based on the\ncomputer name.\n\n\n-----\n\n**_Figure 14: Next binaries (AutoIT the injector/loader) and the URSA trojan (a Delphi binary injected into memory_**\n_are download from the C2 server._\n\nAlong the way, two additional DLLs are also downloaded. One is a DLL for SSL and the other for SQLite3. They are\nprobably dependencies packaged in the malware, and to avoid a failure if the target machine does not have these\nDLLs/resources installed on the device. We will observe that the final binary ‚Äì URSA Delphi ‚Äì has two tools inside\nand packed. These tools are legitimate software used during the credential harvesting process.\n\nAfter this complex process, the final files are moved into the C:\\‚Äùartibrary_name‚Äù folder.\n\n**_Figure 15: Final stage is moved into a random folder created on the C:\\ (o0t ‚Äì in this case)._**\n\n\n-----\n\nNext, another loader/injector, the AutoIT file is executed. It is responsible for loading into the memory the final\npayload (Delphi file that contains the trojan code and the malicious process).\n\n**_Figure 16: Final payload is executed._**\n\n## Ursa trojan ‚Äì AutoIT loader/injector\n\n**Threat name: n11ai.exe**\n\n**MD5: c56b5f0201a3b3de53e561fe76912bfd**\n\n**Threat name: n111.11n**\n\n**MD5: 7396051fd6575180166d66ddf0a9295b**\n\n**Threat name: winx86.dll**\n\n**MD5: 87f9e5a6318ac1ec5ee05aa94a919d7a**\n\n**Threat name: libeay32.dll**\n\n**MD5: f3e6c0d52bab27289db2a70e4aab628c**\n\n**Threat name: n11**\n\n**MD5: 71fdf07084a741b553b97b0d0815fa0e**\n\n[The AutoIT binary is protected and can be decompiled with the following script available on GitHub. That script is a](https://github.com/dzzie/myaut_contrib)\nbuild of myAut2Exe modified from the original and based on the version 2.12.\n\n\n-----\n\n**_Figure 17: AutoIT decompiled code (n11ai.exe)._**\n\nAs observed, some calls from kernel32.dll are imported in order to perform the Process Injection technique.\n```\nLOCAL $KERNELHANDLE=DLLCALL($_MDKERNEL32DLL,\"ptr\",\"LoadLibrary\",\"str\",\"kernel32.dll\")\n$_MFHOOKBAK=DLLSTRUCTCREATE(\"ubyte[7]\")\nDLLCALL($_MDKERNEL32DLL,\"int\",\"WriteProcessMemory\",\"ptr\",-1,\"ptr\",DLLSTRUCTGETPTR($_MFHOOKBAK),\"ptr\",$_MFHOO\nDLLCALL($_MDKERNEL32DLL,\"int\",\"WriteProcessMemory\",\"ptr\",-1,\"ptr\",$_MFHOOKPTR,\"byte*\",184,\"uint\",1,\"uint*\",\nDLLCALL($_MDKERNEL32DLL,\"int\",\"WriteProcessMemory\",\"ptr\",-1,\"ptr\",$_MFHOOKPTR+5,\"ushort*\",57599,\"uint\",2,\"u\n\n```\nIn detail, the file n111.11n is one of the DLLs imported ‚Äì the Delphi PE file. All the DLL files are injected depending\non the passed arguments. These command lines are executed in Figure 17, at the end of the VBScript loader.\n```\n\"C:\\o0t\\n11ai.exe\" n11 @\n\"C:\\o0t\\n11ai.exe.exe\" n11 ##1\n\"C:\\o0t\\n11ai.exe.exe\" /stext \"WWy1\"\n\"C:\\o0t\\n11ai.exe.exe\" n11 ##3\n\"C:\\o0t\\n11ai.exe.exe\" /stext \"WWy0\"\n\n```\nIn detail, this AutoIT loader is seen as a maestro. It loads the malware by parts, namely:\n\n**n11 @ ‚Äì DLL inside AutoIT that loads the Delphi binary into the memory.**\n**n11 /stext ‚ÄúWWy1‚Äù ‚Äì executes the module of collecting passwords from the browser.**\n**n11 /stext ‚ÄúWWy0‚Äù ‚Äì executes the module of collecting credentials from popular software (FTP, email, etc.).**\n\n\n-----\n\n**_Figure 18: DLLs injected into the memory (Delphi binary, and other)._**\n\nOn the other side, the two DLLs seem to be referred to SSL and SQLite3, probably dependencies to execute the\ntool available inside the Delphi PE file (winx86.dll and libeay32.dll).\n\n**_Figure 19: DLLs stored in the same path of AutoIT binary (the Delphi loader)._**\n\n## Digging into the URSA final stage (Delphi trojan)\n\n**Threat name: 36f0000.rec.dll (extracted from memory)**\n\n**MD5: 309335fe1e4f27029a8ec6087e0de1f4**\n\n\n-----\n\nThe last stage is a Delphi binary responsible to execute browser overlay to control and steal the victim s data while\nthey are accessing their home banking portals. The activity and code similarities here observed are much close to\n[other analyzed and popular trojans operating in Portugal and Latin America, such as Grandoreiro and](https://seguranca-informatica.pt/the-updated-grandoreiro-malware-equipped-with-latenbot-c2-features-in-q2-2020-now-extended-to-portuguese-banks/#.X2DFbWhKguU) **[Lampion](https://seguranca-informatica.pt/new-release-of-lampion-trojan-spreads-in-portugal-with-some-improvements-on-the-vbs-downloader/#.X2DFdGhKguU)** [[1,](https://seguranca-informatica.pt/new-release-of-lampion-trojan-spreads-in-portugal-with-some-improvements-on-the-vbs-downloader/#.X2DFdGhKguU)\n[2]. According to an](https://seguranca-informatica.pt/trojan-lampion-is-back-after-3-months/#.X2DFdWhKguU) **[ESET analysis, the final payload is Mispadu, an ambitious Latin American banking trojan that](https://www.welivesecurity.com/2019/11/19/mispadu-advertisement-discounted-unhappy-meal/)**\nextends its attack surface to web browsers.\n\nThe Delphi binary has also two legitimate tools inside. These tools are used to collect credentials stored on the\nvictim‚Äôs device.\n\n**_Figure 20: Binary files available inside the Delphi binary._**\n\nThese tools are executed when the final stage starts, and the data is stored between the tags ‚ÄúF1‚Äù and ‚ÄúF2‚Äù\nhighlighted below.\n\n**_Figure 21: Blocks of code where the credential stealer modules are executed._**\n\nIn detail, these tools are legitimate and from Nir Sofer. The first one ‚Äì **[WebBrowserPassView is launched in](https://www.nirsoft.net/utils/web_browser_password.html)**\n[memory and used to exfiltrate credentials from the popular web browsers. On the other side, Mail PassView is used](https://www.nirsoft.net/utils/mailpv.html)\nto collect data from several locations.\n\n\n-----\n\n**_Figure 22: Tools embedded inside the trojan file and used to collect data from the infected device._**\n\nAt the end of the harvesting process, the data is sent to the C2 server.\n\n\n-----\n\n**_Figure 23: Victim‚Äôs credentials collected and sent to the C2 server._**\n\nThe trojan is simultaneously listening and monitoring which windows and websites are accessed by the victim (it get\nthe focus windows on the web-browser). When a target banking portal is accessed, an overlay window is created on\nthe legitimate web browser window depending on the accessed banking portal.\n\nIn short, the next figure shows some target banks ‚Äúoperated‚Äù by URSA trojan criminals.\n\n\n-----\n\n**_Figure 24: Target banking organizations operated by URSA trojan loader criminals._**\n\nThe complete list can be found below.\n\n\n-----\n\n```\n                      _\n.text:039E67EC 0000001C unicode BANCOUNION_BO  \n.text:039E6814 0000000E unicode BNB_BO      \n.text:039E6830 00000010 unicode BISA_BO     \n.text:039E684C 0000000E unicode BCP_BO      \n.text:039E6868 00000014 unicode FASSIL_BO    \n.text:039E6888 00000018 unicode BANCOFIE_BO   \n.text:039E68AC 00000018 unicode BANCOSOL_BO   \n.text:039E68D0 0000000C unicode BG_BO      \n.text:039E68E8 00000014 unicode BANECO_BO    \n.text:039E6908 0000001A unicode CORPBANCA_CH   \n.text:039E6930 00000010 unicode BBCA_CH     \n.text:039E694C 00000024 unicode BANCOFALABELLA_CH\n.text:039E697C 00000020 unicode BANCOEDWARDS_CH \n.text:039E69A8 0000001E unicode BANCORIPLEY_CH  \n.text:039E69D4 00000018 unicode TBANCWLS_CH   \n.text:039E69F8 00000014 unicode BANEFE_CH    \n.text:039E6A18 0000001C unicode SCOTIABANK_CH  \n.text:039E6A40 00000010 unicode BICE_CH     \n.text:039E6A5C 0000001C unicode BANCOINTER_CH  \n.text:039E6A84 00000024 unicode BANCOCONSORCIO_CH\n.text:039E6AB4 00000010 unicode BITCOIN     \n.text:039E6AD0 0000000E unicode PAYPAL      \n.text:039E6AEC 00000014 unicode BANKIA_ES    \n.text:039E6B0C 00000018 unicode SABADELL_ES   \n.text:039E6B30 0000001A unicode BANKINTER_ES   \n.text:039E6B58 00000018 unicode IBERCAJA_ES   \n.text:039E6B7C 0000001A unicode LIBERBANK_ES   \n.text:039E6BA4 00000014 unicode ABANCA_ES    \n.text:039E6BC4 0000001C unicode KUTXABANCA_ES  \n.text:039E6BEC 00000016 unicode UNICAJA_ES    \n.text:039E6C10 00000012 unicode GERAL_PT     \n.text:039E6C30 0000000E unicode BPI_PT      \n.text:039E6C4C 0000001A unicode NOVOBANCO_PT   \n.text:039E6C74 0000000E unicode BCP_PT      \n.text:039E6C90 0000000E unicode CGD_PT      \n.text:039E6CAC 00000014 unicode ACTIVO_PT    \n.text:039E6CCC 00000018 unicode MONTEPIO_PT   \n.text:039E6CF0 0000001C unicode CREDITOAGR_PT  \n.text:039E6D18 0000000E unicode BPM_IT      \n.text:039E6D34 00000010 unicode BPER_IT     \n.text:039E6D50 00000016 unicode UNICRED_IT    \n.text:039E6D74 00000018 unicode SAMPAOLO_IT   \n.text:039E6D98 0000000E unicode BNL_IT      \n.text:039E6DB4 00000018 unicode BANCAMPS_IT   \n.text:039E6DD8 0000001A unicode SANTANDER_CH   \n.text:039E6E00 0000001A unicode SANTANDER_ES   \n.text:039E6E28 00000010 unicode BBVA_ES     \n.text:039E6E44 0000001A unicode CAIXABANK_ES   \n.text:039E6E6C 0000001A unicode SANTANDER_PT   \n.text:039E6E94 00000010 unicode BBVA_MX     \n.text:039E6EB0 00000014 unicode AZTECA_MX    \n.text:039E6ED0 00000016 unicode BANAMEX_MX    \n.text:039E6EF4 00000016 unicode BANORTE_MX    \n.text:039E6F18 00000012 unicode SANTA_MX     \n.text:039E6F38 00000010 unicode HSBC_MX     \n.text:039E6F54 00000014 unicode SCOTIA_MX    \n.text:039EA11C 0000000A unicode bbva          \n.text:039EA134 0000000A unicode xico          \n.text:039EA15C 00000008 unicode 99_           \n.text:039EA170 00000006 unicode 99           \n.text:039EA184 0000000A unicode BBVA          \n.text:039EA1AC 0000000C unicode banco          \n.text:039EA1C4 0000000E unicode azteca         \n.text:039EA1E0 0000001A unicode Banco Azteca      \n.text:039EA208 0000001C unicode banconacional      \n.text:039EA230 00000010 unicode agrcola         \n.text:039EA24C 00000032 unicode Banco Nacional de M√©xico\n\n```\n\n-----\n\n```\n.text:039EA2A8 00000010 unicode Banorte         \n.text:039EA2C4 00000014 unicode santander        \n.text:039EA2E4 0000001E unicode bancadeempresa     \n.text:039EA310 0000000C unicode mxico          \n.text:039EA328 00000012 unicode gobierno        \n.text:039EA348 0000000A unicode pyme          \n.text:039EA360 00000020 unicode Banco Santander     \n.text:039EA38C 00000014 unicode caixabank        \n.text:039EA3AC 00000008 unicode bpi           \n.text:039EA3C0 00000014 unicode CaixaBank        \n.text:039EA3E0 00000016 unicode scotiabank       \n.text:039EA404 0000000E unicode Scotia         \n.text:039EA420 0000000A unicode hsbc          \n.text:039EA438 0000000A unicode HSBC          \n.text:039EA450 0000000A unicode solu          \n.text:039EA468 00000010 unicode advance         \n.text:039EA484 00000012 unicode investor        \n.text:039EA4A4 00000012 unicode Santader        \n.text:039EA4C4 00000016 unicode blockchain       \n.text:039EA4E8 00000010 unicode bitcoin         \n.text:039EA504 00000010 unicode binance         \n.text:039EA520 00000012 unicode coinbase        \n.text:039EA540 0000000E unicode kraken         \n.text:039EA55C 0000000E unicode crypto         \n.text:039EA578 00000012 unicode primebit        \n.text:039EA598 0000000C unicode bitso          \n.text:039EA5B0 0000000E unicode paypal         \n.text:039EA5CC 0000000E unicode bankia         \n.text:039EA5E8 0000001C unicode bancosabadell      \n.text:039EA610 00000014 unicode bankinter        \n.text:039EA630 00000012 unicode ibercaja        \n.text:039EA650 00000014 unicode liberbank        \n.text:039EA670 0000000E unicode abanca         \n.text:039EA68C 00000014 unicode kutxabank        \n.text:039EA6AC 0000001A unicode unicajabanco      \n.text:039EA6D4 00000012 unicode bancobpi        \n.text:039EA6F4 00000014 unicode novobanco        \n.text:039EA714 0000001C unicode millenniumbcp      \n.text:039EA73C 0000001A unicode caixadirecta      \n.text:039EA764 00000016 unicode activobank       \n.text:039EA788 00000012 unicode montepio        \n.text:039EA7A8 00000014 unicode crditoagr        \n.text:039EA7C8 0000002C unicode bancapopolaredemilano  \n.text:039EA800 00000012 unicode bancobpm        \n.text:039EA820 0000000A unicode bper          \n.text:039EA838 00000014 unicode unicredit        \n.text:039EA858 00000010 unicode banking         \n.text:039EA874 00000028 unicode bancaintesasanpaolo   \n.text:039EA8A8 00000008 unicode bnl           \n.text:039EA8BC 0000000C unicode banca          \n.text:039EA8D4 00000012 unicode bancamps\n\n```\nDuring the malware analysis, some interesting overlay windows were obtained. More details and full images\navailable at the end of the article.\n\n\n-----\n\n**_Figure 25: Banking overlay windows from URSA trojan banker._**\n\nWhen the malware detects the victims accessed a target home banking portal, a socket connection is established to\nthe malware operator (C2 server). Criminals control each step, requesting specific data step-by-step in a back-office\nportal. Some commands hardcoded inside the malware are presented in Figure 26.\n\n**_Figure 26: Internal commands of URSA trojan._**\n\n\n-----\n\n## C2 details and victim s data\n\nThe victim‚Äôs data is sent to C2 during the malware execution. During our analysis, it was possible to collect\ninformation on the number of victims affected during this wave (June ‚Äì mid-September), as well as all data\nexfiltrated from the victims‚Äô devices.\n\n**_Figure 27: Some affected users and AV engine installed and running in the infected device._**\n\nInteresting that this malware evades AV detection, at least the phase where credentials were collected. We can see\nin Figure 28 that many affected computers were running popular antivirus and were infected by this threat. On the\nother side, all the victim‚Äôs data is stored in TXT files on the C2 server. The file starts with the id language (Portugal ‚Äì\n2070), followed by the computer name, trojan compilation ID, and finally, the victim ID present on the C2 database.\n\n\n-----\n\n**_Figure 28: Ursa trojan ‚Äì victim‚Äôs details._**\n\nThe geo-map initially addressed in this article was based on the C2s available below, and based on the number of\navailable infections found there.\n\n## URSA trojan ‚Äì Banking Overlay Windows\n\n\n-----\n\n-----\n\n-----\n\n-----\n\n-----\n\n-----\n\n## Mitre Att&ck Matrix\n\n Indicators of Compromise (IOCs)\n\n\n-----\n\n```\n       g g _\nhxxps://medeiros-boatworks.]com/wp-content/!/https:/my.vodafone.pt/?client=xxx\nhxxps://publichealth.msu.ac.]th/eng/wp-content/languages/--/my.vodafone.pt/?client=xxx\nhxxps://kresna.co.]id/sarikresnakimia/wp-content/!/www.edp.pt/?client=xxx\nhxxps://robyn-plombier-chauffagiste.fr/wp-admin/css/--/https:/www.policiajudiciaria.pt/?cliente=xxxx\n---- URLS ----hxxp://191.235.99.]13/lp1a.php\nhxxp://191.235.99.]13/m/\n---- C2 ----191.235.99.]13\n191.239.122.]4\n40.70.86.]161\n52.91.227.]152\n87.98.137.]173\n144.217.32.]24\n51.81.104.]17\n104.44.143.]28\n51.143.39.]80\n45.132.242.]89\n13.58.123.]122\n51.222.39.]127\n66.70.237.]175\n54.233.78.]131\n51.222.39.]128\n54.39.33.]188\n-- 21/10/2020-104.41.57.]9\n142.44.218.]78\n191.235.78.]73\n-- 02-11-2020-70.37.106.]179\n-- 14-11-2020-40.65.223.]174\n40.84.210.]148\n-- 01-12-2020-149.56.76.]254\n--20-12-2020-24.152.36.]236\n193.239.86.]182\n47.254.94.]1\n\n## Online Sandbox URLs\n\n```\n**554S2000A2S144D1S4111D.msi:**\nhttps://www.virustotal.com/gui/file/23892054f9494f0ee6f4aa8749ab3ee6ac13741a0455e189596edfcdf96416b3/details\n\n**px3q8x.vbs initial VBScript:**\n\nhttps://www.virustotal.com/gui/file/d1fb8a5061fc40291cc02cec0f1c2d13168b17d22ffcabea62816e14ed58e925/\n\n**final payload (VBScript):**\nhttps://www.virustotal.com/gui/file/5b91c8acffe1980653718a493e24bde7211ee825ea2947df54c03e9733d61a70/details\n\n**n11ai.exe (AutoIt loader/injector):**\nhttps://www.virustotal.com/gui/file/237d1bca6e056df5bb16a1216a434634109478f882d3b1d58344c801d184f95d/details\n\n**6f0000.dll (Delphi trojan):**\nhttps://www.virustotal.com/gui/file/93488eab403fafb3d8e10d38c80f0af745e3fa4cf26228acff24d35a149f6269/detection\n\n\n-----\n\n**Samples MalwareBazaar: https://bazaar.abuse.ch/browse/tag/URSA%20trojan/**\n\n[[2020-09-13] new #trojan](https://twitter.com/hashtag/trojan?src=hash&ref_src=twsrc%5Etfw) [#banker in the wild ‚Äì](https://twitter.com/hashtag/banker?src=hash&ref_src=twsrc%5Etfw) [#stealer](https://twitter.com/hashtag/stealer?src=hash&ref_src=twsrc%5Etfw) [#malware](https://twitter.com/hashtag/malware?src=hash&ref_src=twsrc%5Etfw) [#c2](https://twitter.com/hashtag/c2?src=hash&ref_src=twsrc%5Etfw)\n\n[‚û°target countries: #PTÔøΩ,](https://twitter.com/hashtag/PT?src=hash&ref_src=twsrc%5Etfw) [#BO`,](https://twitter.com/hashtag/BO?src=hash&ref_src=twsrc%5Etfw) [#CHo](https://twitter.com/hashtag/CH?src=hash&ref_src=twsrc%5Etfw) [#ESÛæì´,](https://twitter.com/hashtag/ES?src=hash&ref_src=twsrc%5Etfw) [#MXÔøΩ,](https://twitter.com/hashtag/MX?src=hash&ref_src=twsrc%5Etfw) [#BRa,](https://twitter.com/hashtag/BR?src=hash&ref_src=twsrc%5Etfw) [#ITÛæì©](https://twitter.com/hashtag/IT?src=hash&ref_src=twsrc%5Etfw)\n‚û°antivirus bypassüêû\n‚û°password stealerüêû\n‚û°browser overlay (banking)üè¶\n‚û°C2 [ 191.235.99.13, 52.91.227.152] @ azure & aws‚úÖ\n‚û°origin: BR a [pic.twitter.com/GW3XtXB8BD](https://t.co/GW3XtXB8BD)\n\n[‚Äî Pedro Tavares (@sirpedrotavares) September 13, 2020](https://twitter.com/sirpedrotavares/status/1305076741107519488?ref_src=twsrc%5Etfw)\n\n[Pedro Tavares](https://seguranca-informatica.pt/author/pipocaz/)\n**[Pedro Tavares is a professional in the field of information security working as an Ethical Hacker/Pentester, Malware](https://www.linkedin.com/in/sirpedrotavares/)**\nResearcher and also a Security Evangelist. He is also a founding member at CSIRT.UBI and Editor-in-Chief of the\n[security computer blog seguranca-informatica.pt.](https://seguranca-informatica.pt/)\n\nIn recent years he has invested in the field of information security, exploring and analyzing a wide range of topics,\nsuch as pentesting (Kali Linux), malware, exploitation, hacking, IoT and security in Active Directory networks. He is\n[also Freelance Writer (Infosec. Resources Institute and Cyber Defense Magazine) and developer of the 0xSI_f33d ‚Äì](https://feed.seguranca-informatica.pt/)\na feed that compiles phishing and malware campaigns targeting Portuguese citizens.\n\n[Read more here.](https://seguranca-informatica.pt/contacto/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-09-15 - Threat analysis- The emergent URSA trojan impacts many countries using a sophisticated loader.pdf"
    ],
    "report_names": [
        "2020-09-15 - Threat analysis- The emergent URSA trojan impacts many countries using a sophisticated loader.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535876,
    "ts_updated_at": 1743041167,
    "ts_creation_date": 1653774459,
    "ts_modification_date": 1653774459,
    "files": {
        "pdf": "https://archive.orkl.eu/d702478d5627a4aa9a5bda19e70b8ffdf1a48ada.pdf",
        "text": "https://archive.orkl.eu/d702478d5627a4aa9a5bda19e70b8ffdf1a48ada.txt",
        "img": "https://archive.orkl.eu/d702478d5627a4aa9a5bda19e70b8ffdf1a48ada.jpg"
    }
}