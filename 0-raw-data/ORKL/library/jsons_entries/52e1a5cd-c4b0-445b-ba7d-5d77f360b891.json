{
    "id": "52e1a5cd-c4b0-445b-ba7d-5d77f360b891",
    "created_at": "2023-01-12T15:03:55.334287Z",
    "updated_at": "2025-03-27T02:13:34.260747Z",
    "deleted_at": null,
    "sha1_hash": "df225af83da9315d7fdc2e773e0f734d4c6a0056",
    "title": "2016-10-27 - BLACKGEAR Espionage Campaign Evolves, Adds Japan To Target List",
    "authors": "",
    "file_creation_date": "2022-05-27T22:34:02Z",
    "file_modification_date": "2022-05-27T22:34:02Z",
    "file_size": 224126,
    "plain_text": "# BLACKGEAR Espionage Campaign Evolves, Targets Japan\n\n**[blog.trendmicro.com/trendlabs-security-intelligence/blackgear-espionage-campaign-evolves-adds-japan-target-list/](https://blog.trendmicro.com/trendlabs-security-intelligence/blackgear-espionage-campaign-evolves-adds-japan-target-list/)**\n\nOctober 27, 2016\n\n**_By Joey Chen and MingYen Hsieh BLACKGEAR is an espionage campaign which has_**\ntargeted users in Taiwan for many years. Multiple papers and talks have been released\ncovering this campaign, which used the ELIRKS backdoor when it was first discovered in\n2012. It is known for using blogs and microblogging services to hide the location of its actual\ncommand-and-control (C&C) servers. This allows an attacker to change the C&C server\nused quickly by changing the information in these posts. Like most campaigns, BLACKGEAR\nhas evolved over time. Our research indicates that it has started targeting Japanese\nusers. Two things led us to this conclusion: first, the fake documents that are used as part of\nits infection routines are now in Japanese. Secondly, it is now using blogging sites and\nmicroblogging services based in Japan for its C&C activity. This post will discuss this C&C\nroutine, the tools used in these attacks, and the connections between these tools. C&C\n**_configuration retrieval_**\n\n_Figure 1. Overview of C&C configuration retrieval method_\n\nBackdoors used by BLACKGEAR share a common characteristic: they all retrieve encrypted\nC&C configuration information from blogs or microblogs. An attacker would register an\naccount on these services and then create posts. The encrypted C&C information would be\nbetween two hardcoded tags, as seen below:\n\n_Figure 2. Encrypted configuration information between tags_\n\n\n-----\n\nThere are two reasons BLACKGEAR would use this technique. First, the beacon traffic of the\nbackdoor would look like normal traffic to blogs. Secondly, the threat actor would be able to\nquickly change the C&C servers used if these were blocked. A defender would be unable to\nblock this change in server from reaching any affected machines unless the legitimate site\nwas blocked as well. Tools Used by BLACKGEAR\n\n_Figure 3. Tools used by BLACKGEAR campaign_\n\nThe malware tools used by BLACKGEAR can be categorized into three categories: binders,\ndownloaders and backdoors. Binders are delivered by attack vectors (such as phishing and\nwatering hole attacks) onto a machine. These, in turn, drop decoys and downloaders. The\nlatter connect to various sites under the control of the attacker and downloads backdoors.\nThese use persistent methods to ensure that they remain present on the affected machines\nto give attackers access to the machine in question. By separating the attack tools into three\nstages, threat actors are able to adapt quickly. If one component is detected and/or blocked,\nit can be replaced without disrupting the entire toolset. Binder The binder (which we detect\nas the TROJ_BLAGFLDR family) hides as a normal folder by changing its icon to a folder\nicon. Once the victim executes it, it executes the downloader in the background, drops a\ndecoy folder that includes fake documents, then delete itself. This is so the victim won't\nnotice that the malicious downloader has been executed. Downloader _TSPY_RAMNY_\nTSPY_RAMNY is a downloader dropped by TROJ_BLAGFLDR malware. To remain\npersistent, it moves itself to the Windows temp folder and drops a *.lnk (Windows\nShortcut) file in the startup folder that points to itself. It also sends information about the\ncompromised host (such as network settings) back to the download site. The download link\nis formatted in the following format:\n\nhttp://{IP address}/{folder name}/{webpage name} (Example: http://{IP\naddress}/multi/index.html)\n\nThis is done so that if someone looks solely at the URL, the download of the backdoor will\nappear to be an ordinary website. TSPY_YMALRMINI TSPY_YMALRMINI is another\ndownloader that is dropped by TROJ_BLAGFLDR malware, which also sends information\nabout compromised hosts back to the download site. We were unable to determine which\npayloads were used by this downloader. However, our research indicates that some of these\ndownloads are saved as drWaston.exe on the compromised host. This same file name is\nalso used by some ELIRKS variants, indicating a possible connection. TSPY_YMALRMINI\nuses the same URL format as RAMNY. TSPY_YMALRMINI has the same download link\npattern as TSPY_RAMNY. The family name for this malware is because some variants have\nthe PDB string \"C:\\toolson-mini\\YmailerCreater - Debug\\Binder\\Binder\\YMailer.pdb\". In\naddition, these variants also create a log file named YmailerMini.log. Backdoors\n_BKDR_ELIRKS BKDR_ELIRKS was the first family of backdoors tied to BLACKGEAR. It_\nretrieves encrypted C&C configuration information from various blogging or microblogging\nservices. Once decoded, it connects to these C&C servers and waits for commands given by\na threat actor To remain persistent it moves itself to the Windows temp folder and drops a\n\n\n-----\n\n_.lnk (Windows Shortcut) file in the startup folder that points to itself. Its backdoor routines_\ninclude getting information from the compromised host, downloading and running files, taking\nscreenshots, and opening a remote shell. BKDR_YMALR BKDR_YMALR is a backdoor\nwritten using the .NET framework which is also known as LOGEDRUT. The detection name\ncomes from a log file created by this malware family named YMailer.log. Its behavior is\nsimilar to ELIRKS - both in terms of C&C information retrieval and available commands to a\nthreat actor. Encryption and Decryption _BKDR_ELIRKS Reverse analysis of ELIRKS_\nallowed us to determine how to decrypt the C&C information, which is done in the following\nPython code:\n```\n   #! /usr/bin/env python\n   from ctypes import *\n   def decipher(v, k):\n     y=c_uint32(v[0])\n     z=c_uint32(v[1])\n     sum=c_uint32(0xC6EF3720)\n     delta=c_uint32(0x61C88647)\n     n=32\n     w=[0,0]\n   while(n>0):\n     z.value -= (y.value + sum.value) ^ (y.value * 16 + k[2]) ^ (( y.value >> 5\n   ) + k[3])\n     y.value -= (z.value + sum.value) ^ (z.value * 16 + k[0]) ^ (( z.value >> 5\n   ) + k[1])\n     sum.value += delta.value\n     n -= 1\n   w[0]=y.value\n   w[1]=z.value\n   return w\n   if __name__ == '__main__':\n     key = [0x8F3B39F1, 0x8D3FBD96, 0x473EAA92, 0x502E41D2]\n     ciphertext = [ciphertext1, ciphertext2] # you can input cipher text here\n     res = decipher(ciphertext, key)\n     plaintext = \"%X\" % (res[0])\n     c4 = str(int(\"0x\"+plaintext[6:8],16))\n     c3 = str(int(\"0x\"+plaintext[4:6],16))\n     c2 = str(int(\"0x\"+plaintext[2:4],16))\n     c1 = str(int(\"0x\"+plaintext[:2],16))\n     print c4+\".\"+c3+\".\"+c2+\".\"+c1\n\n```\nThe malware contains shellcode with two things: the URL of the blog entry and the tags that\nidentify where in the fake articles the hidden C&C information is located. Once the fake\nblog/microblog posts are downloaded, the malware finds and decrypts the C&C information.\nThe C&C information is stored in the post in two short bits of text. The first is an eightcharacter string that is decoded into a six-byte hexadecimal value. The second is a two\n\n-----\n\ncharacter string which is already in a hexadecimal format, and is concatenated towards the\n[end. A modified version of the TEA algorithm decrypts these into the C&C server locations.](https://web.archive.org/web/20070127094759/http://www-users.cs.york.ac.uk/~matthew/TEA/)\n\n_Figure 4. BKDR_ELIRKS decryption algorithm_\n\n_BKDR_YMALR BKDR_YMALR implements the same behavior in a slightly different manner._\nIt contains several encrypted strings:\n\n_Figure 5. Encrypted strings in BKDR_YMALR_\n\nThese encrypted strings are the result of the blog URLs and tags being first encoded\nwith Base64, and then encrypted with DES. The encryption key and initialization vector are\nhardcoded, with both set to 1q2w3e4r. (Note how these are positioned on a normal\nkeyboard.)\n\n_Figure 6. Blog URL and tags in BKDR_YMALR_\n\n_Figure 7. BKDR_YMALR decryption algorithm_\n\nOnce these have been decoded, BKDR_YMALR uses the same algorithm as ELIRKS to\nobtain the C&C information.\n\n_Figure 8. BKDR_YMALR configuration from the blog post blog_\n\n**_Connections between tools_**\n\n_Figure 9. Connections between tools_\n\nMore than just tools being used together, it appears that there are distinct connections\nbetween the different tools used by BLACKGEAR. The string \"YMailer\" shows up in the\nfilenames of log files used by both BKDR_YMALR and TSPY_YMALRMINI, and it is in the\nPDB strings of the latter. The two downloaders TSPY_RLMNY and TSPY_YMALRMINI both\nuse the string toolson in different places. Lastly, both downloaders and one backdoor share\nthe same decryption key 1q2w3e4r. The above illustration shows the connections between\nthe families. Conclusion Malware threats need to evolve or otherwise become non-threats.\nSimilarly, to stay relevant, BLACKGEAR has evolved with both new tools and new targets,\nand will continue to be a threat for the foreseeable future. We will continue to monitor its\nactivities in order to protect our customers. Indicators of Compromise (IOCs)\n_TROJ_BLAGFLDR_\n\n52d6b30bc578465d8079d9abd0d4c4826b51b25f\n\n\n-----\n\n800c7d54280f5f35e3b58a6d4dfd4845f6ed9e15\n8b6614562a79a13e60d100a88f1ba4eb601636db\n98efee8dde7d493c0d35d02a2170b6d1b52987d3\n\n_TSPY_RAMNY_\n\n02785ebcb683a380c80958f3fe2a52f805c5c12d\n74031e70ca3b4004c6b7a8197397882bc02c30cb\nb4c63a0ff9b8eb8cc1a53a4dd036e93f9eeceeca\n\n_TSPY_YMALRMINI_\n\n048790098a7c6b8405761b75ef2a2fd8bd0560b6\n96f3b52460205f6ecc6b6d1a73f8db13c6634afc\n\n_BKDR_ELIRKS_\n\n17cacabcf78c4b164bb0e7d9200289be9236e7bc\n4157ecd252dc09b533fcf6a778aca2c376601354\n4f54cfcf266b73ca3759b9cb0252c27094b5b330\n521a9d73191c7740f969ae3c53e6abf70ffbedf9\n533565f7953fb1648d437d14d007003c6343b9ae\n80108d2aacb0a1f2a5350f71e7a04239fc5f96a9\n8cad1bcbdd558802b34119fb57160cc748170133\n9a768fae41ca7395b4257e85acef915e124c2981\na70001c67e81d1dcf62f808760514b6df28a411a\na9ea07caafeb63133e5131f7a56bc8da1bc3d72a\ndd0ceafbe7f4bf2905e560c3348545e32bc0f684\n\nBKDR_YMALR\n\n02fed8cae7f3986c1344dd75d869ba23cfc4073a\n09d73b522f36786bb6e645b96f244bb51c3cc7ea\n0a59d52367435bc22a92c27d60023acec575a5fb\n0cc74332b1e213456693159d3ba12a3421036f68\n1120f049dcb4a62809687dc277b42589d8d1caa6\n12c8cc7e125572d614b708c056f7fd0ed49870c5\n29b08d270ba6efcf57ca2ad33d8e3edd93d6b32a\n2d3d7b9521aec637f2e99624e0489b9f140d463f\n2de7d78615ec0fbf2652790d53b50ddb0472292c\n31de946255b240c0ae2f56786ac25183f3aaeea5\n3aa8509715c7f55bdee831d5f7db22a2c516db43\n3d175b1defe7076e0fe56076dd0d5f438de43324\n4000244b2cba78a45034bb6ab2bac46d6a8a79ea\n4882735e8a465fac938fd04546a51efefb9806da\n48d373bdb31dcecd7f59bd5a964d062c8b6bfce8\n49f6eb7f8e4a27f574c9a3e8c0da0b7895df7e41\n4c7df09012fc88d336467691acf0afce64f40341\n\n\n-----\n\n551f9a60203bec904487113e8d42dea463ac6ca9\n5a4b15fa5a615a93191ede4c75dd3e65e87586dc\n5aa5117db6f420c81d2e1a7f036963a3c6ef02e9\n5dc007d056513cba030ec16e15bdbb9ea5fe0e5a\n628309a60ad1fbe240486519de1424f7ddc2df4d\n636e7a9effb1a244697c880832e486de56260527\n6bb5f51d03edd1acd7d38cca8095a237543c6a0d\n6c4786b792f13643d408199e1b5d43f6473f5eea\n6dd997409afec6fafbe54bd9d70d45fffff6a807\n7142ca7079da17fa9871cbc86f7633b3253aeaed\n7254b719fd3cf87c8ac8ed9327c8e1bf99abf7af\n7329a789363f890c401c286dbaf3d2bf79ee14f7\n7b2c4d14710cf2fd53486399ecc5af85cd75eca6\n88e22933b76273793e4278c433562fb0b4fe125a\n8917c582ab5c2e831de6eba33b4f19d6e3a2cb70\n8c325e92bf21d0c3737dbbc596854bc12184eeaf\n8f65cbde2f3b664bcede3822a19765bdb7f58099\n9047b6b2e8fbaa8a06b2faaa30e038058444106a\n93c3f23905599df78cd5416dd9f7c171b3f1e29e\n94750bdae0fa190116a68e96d45f3d46c24b6cf1\n9954a1c8e7b0e2f17841608f6b8c9d042b7a0780\n9b96646d152583ff58c2c29191cb1672847d56b6\n9f5a3b6db752d617f4d278d6531e2bbdb7faa977\na30cc98ceb5d3379e80443f68a186326926f73ce\na893896af5468ac6e04cdd13edff8cae04800848\na8f461749c7fe2a21116b8390cf84a8300009321\na9108bf3ce39cea40e46ac575247a9a7c077b2a8\na9fd9ade807af4779f3eea39fed2c583a50c8497\nac014e4c2d68f6c982ac58738857b698b9e46af5\nacaec2b0f86ec4262be5bb8bcebcc12093e071ba\nad61c51b03022ef6bcb5e9738fe2f621e970ecb3\nb28f6ba3d6571c5d85cb5276cbcdce9adf49d5a9\nbc61f1b3c8eb3bda2071f6caf71ff23705128ca5\nc30b305a7bea9a2f61aca2dbcf596c2b0c0e4fa0\nc4c747f26f95fdbfc5bff04688dc76ae0bb48fff\nc58d6fc761dec675ab45ad5c3682ffc9936cf357\nc85f528900aa9d836abd88eb56902efd711491da\nca163d6ae85edede87b271267918a0ffe98040c7\ncf629249fb4af86746059e638ccef5b8a43c6834\ncfd9a67b4b0eb3d756bb7e449b46687e6aef006b\nd107268bd767a2dfe1c8733b7da96c1a64f5d112\nd7cd079f8485ea55443ed497f055dbed5ae4a668\n\n\n-----\n\nd95c97f1525e9888571f498f2be584dda243da2a\ne01f9ba6355bcdc7ccf89261658bff9f965b8c21\ne05efde2b442dc4119179e3c39c74a973499e271\ne1acfed710f186d86a2bc8179ff38fdd21f9a1b6\ne1fb2e1866f332a5656bf55fde13ff57d5f0bbf6\ne77303d80968395eec008515ea9eb3c620b14255\neb9e553524d414d862857297baf44da3b4072650\neca06f3c535ba3b3463917974a79efc821fddb6c\neeb065a1963a8aa0496e61305c076c5946d77e12\nefa611262e6d4804ce9026d50bfa64f20d9271ca\nfb59481d153388d2ad3bb6321d0b2875cb07f4d3\nfbcbbc187e99317c5a36a3667592590a7f5a17d1\n\nAPT & Targeted Attacks\n\nWe have seen how BLACKGEAR has started targeting Japanese users: fake documents\nthat are part of its infection routines are now in Japanese, and blogging sites and\nmicroblogging services for its C&C activity are Japan-based.\n\nBy: Trend Micro October 27, 2016 Read time: ( words)\n\nContent added to Folio\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2016/2016-10-27 - BLACKGEAR Espionage Campaign Evolves, Adds Japan To Target List.pdf"
    ],
    "report_names": [
        "2016-10-27 - BLACKGEAR Espionage Campaign Evolves, Adds Japan To Target List.pdf"
    ],
    "threat_actors": [
        {
            "id": "6750d709-9153-4e90-baa3-04883a9b762b",
            "created_at": "2022-10-25T16:07:23.397596Z",
            "updated_at": "2025-03-27T02:02:09.778738Z",
            "deleted_at": null,
            "main_name": "Blackgear",
            "aliases": [
                "Topgear"
            ],
            "source_name": "ETDA:Blackgear",
            "tools": [
                "Comnie",
                "Elirks",
                "Protux"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "ad59becc-29c2-4b7a-a958-d7f242d222ea",
            "created_at": "2023-01-06T13:46:38.956494Z",
            "updated_at": "2025-03-27T02:00:02.962214Z",
            "deleted_at": null,
            "main_name": "Blackgear",
            "aliases": [
                "Topgear",
                "Comnie",
                "BLACKGEAR"
            ],
            "source_name": "MISPGALAXY:Blackgear",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535835,
    "ts_updated_at": 1743041614,
    "ts_creation_date": 1653690842,
    "ts_modification_date": 1653690842,
    "files": {
        "pdf": "https://archive.orkl.eu/df225af83da9315d7fdc2e773e0f734d4c6a0056.pdf",
        "text": "https://archive.orkl.eu/df225af83da9315d7fdc2e773e0f734d4c6a0056.txt",
        "img": "https://archive.orkl.eu/df225af83da9315d7fdc2e773e0f734d4c6a0056.jpg"
    }
}