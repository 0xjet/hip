{
    "id": "ff69f7a3-a7d9-4f1f-8eb0-4114b749f51d",
    "created_at": "2023-01-12T15:03:47.039433Z",
    "updated_at": "2025-03-27T02:13:22.319386Z",
    "deleted_at": null,
    "sha1_hash": "d78a8d0ca868c2a3fceefd0cf14b9bfb6c770ba6",
    "title": "2019-01-10 - Global DNS Hijacking Campaign- DNS Record Manipulation at Scale",
    "authors": "",
    "file_creation_date": "2022-05-28T02:38:47Z",
    "file_modification_date": "2022-05-28T02:38:47Z",
    "file_size": 91875,
    "plain_text": "# Global DNS Hijacking Campaign: DNS Record Manipulation at Scale\n\n**[fireeye.com/blog/threat-research/2019/01/global-dns-hijacking-campaign-dns-record-manipulation-at-scale.html](https://www.fireeye.com/blog/threat-research/2019/01/global-dns-hijacking-campaign-dns-record-manipulation-at-scale.html)**\n\n## Breadcrumb\n\nThreat Research\n\nMuks Hirani, Sarah Jones, Ben Read\n\nJan 09, 2019\n\n6 mins read\n\nThreat Research\n\n**Introduction**\n\n\n-----\n\nFireEye s Mandiant Incident Response and Intelligence teams have identified a wave of DNS\nhijacking that has affected dozens of domains belonging to government, telecommunications\nand internet infrastructure entities across the Middle East and North Africa, Europe and\nNorth America. While we do not currently link this activity to any tracked group, initial\nresearch suggests the actor or actors responsible have a nexus to Iran. This campaign has\ntargeted victims across the globe on an almost unprecedented scale, with a high degree of\nsuccess. We have been tracking this activity for several months, mapping and understanding\nthe innovative tactics, techniques and procedures (TTPs) deployed by the attacker. We have\nalso worked closely with victims, security organizations, and law enforcement agencies\nwhere possible to reduce the impact of the attacks and/or prevent further compromises.\n\nWhile this campaign employs some traditional tactics, it is differentiated from other Iranian\nactivity we have seen by leveraging DNS hijacking at scale. The attacker uses this technique\nfor their initial foothold, which can then be exploited in a variety of ways. In this blog post, we\ndetail the three different ways we have seen DNS records be manipulated to enable victim\ncompromises. Technique 1, involving the creation of a Let's Encrypt certificate and changing\nthe A record, was [previously documented by Cisco’s TALOS team. The activity described in](https://blog.talosintelligence.com/2018/11/dnspionage-campaign-targets-middle-east.html)\ntheir blog post is a subset of the activity we have observed.\n\n**Initial Research Suggests Iranian Sponsorship**\n\nAttribution analysis for this activity is ongoing. While the DNS record manipulations described\nin this post are noteworthy and sophisticated, they may not be exclusive to a single threat\nactor as the activity spans disparate timeframes, infrastructure, and service providers.\n\nMultiple clusters of this activity have been active from January 2017 to January 2019.\nThere are multiple, nonoverlapping clusters of actor-controlled domains and IPs used\nin this activity.\nA wide range of providers were chosen for encryption certificates and VPS hosts.\n\nPreliminary technical evidence allows us to assess with moderate confidence that this\nactivity is conducted by persons based in Iran and that the activity aligns with Iranian\ngovernment interests.\n\nFireEye Intelligence identified access from Iranian IPs to machines used to intercept,\nrecord and forward network traffic. While geolocation of an IP address is a weak\nindicator, these IP addresses were previously observed during the response to an\nintrusion attributed to Iranian cyber espionage actors.\nThe entities targeted by this group include Middle Eastern governments whose\nconfidential information would be of interest to the Iranian government and have\nrelatively little financial value.\n\n**Details**\n\n\n-----\n\n_The following examples use victim[.]com to stand in for the victim domain, and private IP_\n_addresses to stand in for the actor controlled IP addresses._\n\nTechnique 1 – DNS A Records\n\nThe first method exploited by the attacker is altering DNS A Records, as seen in Figure 1.\n\nDNS A Record\n\nFigure 1: DNS A Record\n\n1. The attacker logs into PXY1, a Proxy box used to conduct non-attributed browsing and\n\nas a jumpbox to other infrastructure.\n2. The attacker logs into the DNS provider’s administration panel, utilising previously\n\ncompromised credentials.\n3. The A record (e.g. mail[.]victim[.]com) is currently pointing to 192.168.100.100.\n4. The attacker changes the A record and points it to 10.20.30.40 (OP1).\n5. The attacker logs in from PXY1 to OP1.\n\nA proxy is implemented to listen on all open ports, mirroring mail[.]victim[.]com.\nA load balancer points to 192.168.100.100 [mail[.]victim[.]com] to pass through\nuser traffic.\n6. certbot is used to create a Let’s Encrypt certificate for mail[.]victim[.]com\n\nWe have observed multiple Domain Control Validation providers being utilised as\npart of this campaign.\n7. A user now visits mail[.]victim[.]com and is directed to OP1. The Let’s Encrypt\n\ncertificate allows the browsers to establish a connection without any certificate errors\nas Let's Encrypt Authority X3 is trusted. The connection is forwarded to the load\nbalancer which establishes the connection with the real mail[.]victim[.]com. The user is\nnot aware of any changes and may only notice a slight delay.\n8. The username, password and domain credentials are harvested and stored.\n\nTechnique 2 – DNS NS Records\n\nThe second method exploited by the attacker involved altering DNS NS Records, as seen in\nFigure 2.\n\nDNS NS Record\n\nFigure 2: DNS NS Record\n\n1. The attacker again logs into PXY1.\n2. This time, however, the attacker exploits a previously compromised registrar or ccTLD.\n3. The nameserver record ns1[.]victim[.]com is currently set to 192.168.100.200. The\n\nattacker changes the NS record and points it to ns1[.]baddomain[.]com [10.1.2.3]. That\nnameserver will respond with the IP 10.20.30.40 (OP1) when mail[.]victim[.]com is\nrequested, but with the original IP 192.168.100.100 if it is www[.]victim[.]com.\n\n\n-----\n\n4. The attacker logs in from PXY1 to OP1.\n\nA proxy is implemented to listen on all open ports, mirroring mail[.]victim[.]com.\nA load balancer points to 192.168.100.100 [mail[.]victim[.]com] to pass through\nuser traffic.\n5. certbot is used to create a Let’s Encrypt certificate for mail[.]victim[.]com.\n\nWe have observed multiple Domain Control Validation providers being utilised\nduring this campaign.\n6. A user visits mail[.]victim[.]com and is directed to OP1. The Let’s Encrypt certificate\n\nallows browsers to establish a connection without any certificate errors as Let's Encrypt\nAuthority X3 is trusted. The connection is forwarded to the load balancer which\nestablishes the connection with the real mail[.]victim[.]com. The user is not aware of\nany changes and may only notice a slight delay.\n7. The username, password and domain credentials are harvested and stored.\n\nTechnique 3 – DNS Redirector\n\nThe attacker has also been observed using a third technique in conjunction with either Figure\n1 or Figure 2 above. This involves a DNS Redirector, as seen in Figure 3.\n\nDNS Operational box\n\nFigure 3: DNS Operational box\n\nThe DNS Redirector is an attacker operations box which responds to DNS requests.\n\n1. A DNS request for mail[.]victim[.]com is sent to OP2 (based on previously altered A\n\nRecord or NS Record).\n2. If the domain is part of victim[.]com zone, OP2 responds with an attacker-controlled IP\n\naddress, and the user is re-directed to the attacker-controlled infrastructure.\n3. If the domain is not part of the victim.com zone (e.g. google[.]com), OP2 makes a DNS\n\nrequest to a legitimate DNS to get the IP address and the legitimate IP address is\nreturned to the user.\n\n**Targets**\n\nA large number of organizations have been affected by this pattern of DNS record\nmanipulation and fraudulent SSL certificates. They include telecoms and ISP providers,\ninternet infrastructure providers, government and sensitive commercial entities.\n\n**Root Cause Still Under Investigation**\n\nIt is difficult to identify a single intrusion vector for each record change, and it is possible that\nthe actor, or actors are using multiple techniques to gain an initial foothold into each of the\ntargets described above. FireEye intelligence customers have received previous reports\ndescribing sophisticated phishing attacks used by one actor that also conducts DNS record\n\n\n-----\n\nmanipulation. Additionally, while the precise mechanism by which the DNS records were\nchanged is unknown, we believe that at least some records were changed by compromising\na victim’s domain registrar account.\n\n**Prevention Tactics**\n\nThis type of attack is difficult to defend against, because valuable information can be stolen,\neven if an attacker is never able to get direct access to your organization’s network. Some\nsteps to harden your organization include:\n\n1. Implement multi-factor authentication on your domain’s administration portal.\n2. Validate A and NS record changes.\n3. Search for SSL certificates related to your domain and revoke any malicious\n\ncertificates.\n4. Validate the source IPs in OWA/Exchange logs.\n5. Conduct an internal investigation to assess if attackers gained access to your\n\nenvironment.\n\n**Conclusion**\n\nThis DNS hijacking, and the scale at which it has been exploited, showcases the continuing\nevolution in tactics from Iran-based actors. This is an overview of one set of TTPs that we\nrecently observed affecting multiple entities. We are highlighting it now so that potential\ntargets can take appropriate defensive action.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-01-10 - Global DNS Hijacking Campaign- DNS Record Manipulation at Scale.pdf"
    ],
    "report_names": [
        "2019-01-10 - Global DNS Hijacking Campaign- DNS Record Manipulation at Scale.pdf"
    ],
    "threat_actors": [
        {
            "id": "4632103e-8035-4a83-9ecb-c1e12e21288c",
            "created_at": "2022-10-25T16:07:23.542255Z",
            "updated_at": "2025-03-27T02:02:09.854487Z",
            "deleted_at": null,
            "main_name": "DNSpionage",
            "aliases": [],
            "source_name": "ETDA:DNSpionage",
            "tools": [
                "Agent Drable",
                "AgentDrable",
                "CACTUSPIPE",
                "DNSpionage",
                "DropperBackdoor",
                "Karkoff",
                "MailDropper",
                "OILYFACE"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "8d76e350-dfb5-4733-800d-876de41f690d",
            "created_at": "2023-01-06T13:46:38.841887Z",
            "updated_at": "2025-03-27T02:00:02.932838Z",
            "deleted_at": null,
            "main_name": "DNSpionage",
            "aliases": [
                "COBALT EDGEWATER"
            ],
            "source_name": "MISPGALAXY:DNSpionage",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "3eebdb3f-f4e3-42e5-bb4d-f02a13328316",
            "created_at": "2024-05-01T02:03:08.014303Z",
            "updated_at": "2025-03-27T02:05:17.306592Z",
            "deleted_at": null,
            "main_name": "COBALT EDGEWATER",
            "aliases": [
                "Cold River ",
                "DNSpionage ",
                "APT34 "
            ],
            "source_name": "Secureworks:COBALT EDGEWATER",
            "tools": [
                " DNSpionage",
                " Karkoff",
                " MailDropper",
                " SideTwist",
                " TWOTONE",
                "AgentDrable"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673535827,
    "ts_updated_at": 1743041602,
    "ts_creation_date": 1653705527,
    "ts_modification_date": 1653705527,
    "files": {
        "pdf": "https://archive.orkl.eu/d78a8d0ca868c2a3fceefd0cf14b9bfb6c770ba6.pdf",
        "text": "https://archive.orkl.eu/d78a8d0ca868c2a3fceefd0cf14b9bfb6c770ba6.txt",
        "img": "https://archive.orkl.eu/d78a8d0ca868c2a3fceefd0cf14b9bfb6c770ba6.jpg"
    }
}