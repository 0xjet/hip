{
    "id": "33c3a728-392e-4f25-8d1e-704aed5683a0",
    "created_at": "2023-01-12T15:02:51.638185Z",
    "updated_at": "2025-03-27T02:05:51.069521Z",
    "deleted_at": null,
    "sha1_hash": "b43d8f3199357acb4d5e5dc6b49d4b6b4218d845",
    "title": "2021-07-22 - Behavorial xbits with Suricata",
    "authors": "",
    "file_creation_date": "2022-05-28T02:05:39Z",
    "file_modification_date": "2022-05-28T02:05:39Z",
    "file_size": 67372,
    "plain_text": "# Behavorial xbits with Suricata\n\n**travisgreen.net/2021/07/22/behavioral-xbits.html**\n\n### Jul 22, 2021\n\n## The Setting:\n\n### While attempting to build detection for DeepRats as revealed by @benkow_, I managed to have (what I think) is a pretty good idea about using xbits. Iâ€™ll admit its a bit basic but I think sometimes the best ideas are deceivingly simple.\n\n## The Idea:\n\n### 1.) observe potentially malicious behavior, set an xbit\n 2.) observe another potentially malicious behavior, set another xbit\n 3.) build detection consisting of a good fast_pattern match and xbits checks\n\n Example (edited for clarity, full working example here):\n\n IP check xbits set here:\n```\nalert tls $HOME_NET any -> $EXTERNAL_NET any (msg:\"ET POLICY IP Check\nDomain (myexternalip .com in TLS SNI)\"; flow:established,to_server; tls.sni;\ncontent:\"myexternalip.com\"; endswith; nocase; xbits:set,ET.ipcheck,track\nip_src; classtype:policy-violation; sid:7704131; rev:1;)\nalert tls $HOME_NET any -> $EXTERNAL_NET any (msg:\"ET POLICY IP Check\nDomain (freegeoip .live in TLS SNI)\"; flow:established,to_server; tls.sni;\ncontent:\"freegeoip.live\"; endswith; nocase; xbits:set,ET.ipcheck,track\nip_src; xbits:set,ET.ipcheck,track ip_src; classtype:policy-violation;\nsid:7704132; rev:1;)\n\n Known abused storage as dropper site xbit set here:\nalert tls $HOME_NET any -> $EXTERNAL_NET any (msg:\"ET POLICY IPFS Domain\n(storage.snark .art in TLS SNI)\"; flow:established,to_server; tls.sni;\ncontent:\"myexternalip.com\"; endswith; nocase; xbits:set,ET.dropsite,track\nip_src; classtype:policy-violation; sid:7704133; rev:1;)\n\n Tor & final detection:\nalert tcp any ![21,25,110,143,443,465,587,636,989:995,5061,5222,8443] ->\nany any (msg:\"ET MALWARE Possible DarkRats Tor Traffic\";\nflow:established,from_server; content:\"|06 03 55 04 03|\"; pcre:\"/^.{2}www\\.\n[0-9a-z]{8,20}\\.com[01]/Rs\"; content:\"|06 03 55 04 03|\"; distance:0;\npcre:\"/^.{2}www\\.[0-9a-z]{8,20}\\.net/Rs\"; xbits:isset,ET.ipcheck,track\n\n```\n\n-----\n\n```\nip_dst; xbits:isset,ET.dropsite,track ip_dst; classtype:trojan-activity;\nsid:7704134; rev:1;)\n\n### Note: track ip_dst here because this detects the Tor RESPONSE traffic.\n\n The final sig could probably also be a great HUNTING sig. Other HUNTING sig ideas:\n\n Tor -> coinmining IP Check -> HTTP POST IP Check -> HTTP to frequently abused TLD\n\n tweet me your ideas!\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-07-22 - Behavorial xbits with Suricata.pdf"
    ],
    "report_names": [
        "2021-07-22 - Behavorial xbits with Suricata.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535771,
    "ts_updated_at": 1743041151,
    "ts_creation_date": 1653703539,
    "ts_modification_date": 1653703539,
    "files": {
        "pdf": "https://archive.orkl.eu/b43d8f3199357acb4d5e5dc6b49d4b6b4218d845.pdf",
        "text": "https://archive.orkl.eu/b43d8f3199357acb4d5e5dc6b49d4b6b4218d845.txt",
        "img": "https://archive.orkl.eu/b43d8f3199357acb4d5e5dc6b49d4b6b4218d845.jpg"
    }
}