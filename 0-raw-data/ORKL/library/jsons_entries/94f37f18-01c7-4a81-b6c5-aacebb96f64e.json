{
    "id": "94f37f18-01c7-4a81-b6c5-aacebb96f64e",
    "created_at": "2023-01-12T15:03:39.61464Z",
    "updated_at": "2025-03-27T02:14:03.463174Z",
    "deleted_at": null,
    "sha1_hash": "84f9f54aebab49af1ccc4f7dcbf044673eca2faf",
    "title": "2018-07-20 - Calisto Trojan for macOS",
    "authors": "",
    "file_creation_date": "2022-05-28T04:49:35Z",
    "file_modification_date": "2022-05-28T04:49:35Z",
    "file_size": 1101790,
    "plain_text": "# The first member of the Proton malware family?\n\n**securelist.com/calisto-trojan-for-macos/86543/**\n\nAuthors\n\nMikhail Kuzin\n\n[Sergey Zelensky](https://securelist.com/author/sergeyzelensky/)\n\nAn interesting aspect of studying a particular piece of malware is tracing its evolution and\nobserving how the creators gradually add new monetization or entrenchment techniques.\nAlso of interest are developmental prototypes that have had limited distribution or not even\noccurred in the wild. We recently came across one such sample: a macOS backdoor that we\nnamed Calisto.\n\n\n-----\n\nThe malware was uploaded to VirusTotal way back in 2016, most likely the same year it was\ncreated. But for two whole years, until May 2018, Calisto remained off the radar of antivirus\nsolutions, with the first detections on VT appearing only recently.\n\nMalware for macOS is not that common, and this sample was found to contain some\nsuspiciously familiar features. So we decided to unpick Calisto to see what it is and why its\ndevelopment was stopped (or was it?).\n\n## Propagation\n\nWe have no reliable information about how the backdoor was distributed. The Calisto\ninstallation file is an unsigned DMG image under the guise of Intego’s security solution for\nMac. Interestingly, Calisto’s authors chose the ninth version of the program as a cover which\nis still relevant.\n\nFor illustrative purposes, let’s compare the malware file with the version of Mac Internet\nSecurity X9 downloaded from the official site.\n\nBackdoor Intego Mac Internet Security 2018\n\n\n-----\n\nUnsigned Signed by Intego\n\nIt looks fairly convincing. The user is unlikely to notice the difference, especially if he has not\nused the app before.\n\n## Installation\n\nAs soon as it starts, the application presents us with a sham license agreement. The text\ndiffers slightly from the Intego’s one — perhaps the cybercriminals took it from an earlier\nversion of the product.\n\n\n-----\n\nNext, the “antivirus” asks for the user’s login and password, which is completely normal when\ninstalling a program able to make changes to the system on macOS.\n\nBut after receiving the credentials, the program hangs slightly before reporting that an error\nhas occurred and advising the user to download a new installation package from the official\nsite of the antivirus developer.\n\n\n-----\n\nThe technique is simple, but effective. The official version of the program will likely be\ninstalled with no problems, and the error will soon be forgotten. Meanwhile, in the\nbackground, Calisto will be calmly getting on with its mission.\n\n## Analysis of the Trojan\n\n With SIP enabled\n\n[Calisto’s activity on a computer with SIP (System Integrity Protection) enabled is rather](https://support.apple.com/en-us/ht204899)\nlimited. Announced by Apple back in 2015 alongside the release of OSX El Capitan, SIP is\ndesigned to protect critical system files from being modified — even by a user with root\npermissions. Calisto was developed in 2016 or earlier, and it seems that its creators simply\ndidn’t take into account the then-new technology. However, many users still disable SIP for\nvarious reasons; we categorically advise against doing so.\n\nCalisto’s activity can be investigated using its child processes log and decompiled code:\n\n_Log of commands executed by the Trojan during its operation_\n\n_Hardcoded commands inside the Calisto sample_\n\n\n-----\n\nWe can see that the Trojan uses a hidden directory named .calisto to store:\n\nKeychain storage data\nData extracted from the user login/password window\nInformation about the network connection\nData from Google Chrome: history, bookmarks, cookies\n\nRecall that Keychain stores passwords/tokens saved by the user, including ones saved in\nSafari. The encryption key for the storage is the user’s password.\n\nNext, if SIP is enabled, an error occurs when the Trojan attempts to modify system files. This\nviolates the operational logic of the Trojan, causing it to stop.\n\n_Error message_\n\n## With SIP disabled/not available\n\nObserving Calisto with SIP disabled is far more interesting. To begin with, Calisto executes\nthe steps from the previous chapter, but as the Trojan is not interrupted by SIP, it then:\n\nCopies itself to /System/Library/ folder\nSets itself to launch automatically on startup\nUnmounts and uninstalls its DMG image\nAdds itself to Accessibility\nHarvests additional information about the system\nEnables remote access to the system\nForwards the harvested data to a C&C server\n\nLet’s take a closer look at the malware’s implementation mechanisms.\n\nAdding itself to startup is a classic technique for macOS, and is done by creating a .plist file\nin the /Library/LaunchAgents/ folder with a link to the malware:\n\n\n-----\n\nThe DMG image is unmounted and uninstalled via the following command:\n\nTo extend its capabilities, Calisto adds itself to Accessibility by directly modifying the TCC.db\nfile, which is bad practice and an indicator of malicious activity for the antivirus. On the other\nhand, this method does not require user interaction.\n\n\n-----\n\nAn important feature of Calisto is getting remote access to the user system. To provide this,\nit:\n\nEnables remote login\nEnables screen sharing\nConfigures remote login permissions for the user\nAllows remote login to all\nEnables a hidden “root” account in macOS and sets the password specified in the\nTrojan code\n\nThe commands used for this are:\n\nNote that although the user “root” exists in macOS, it is disabled by default. Interestingly,\nafter a reboot, Calisto again requests user data, but this time waits for the input of the actual\nroot password, which it previously changed itself (root: aGNOStIC7890!!!). This is one\nindication of the Trojan’s rawness.\n\n\n-----\n\nAt the end, Calisto attempts to transfer all data from the .calisto folder to the cybercriminals’\nserver. But at the time of our research, the server was no longer responding to requests and\nseemed to be disabled:\n\n_Attempt to contact the C&C server_\n\n## Extra functions\n\nStatic analysis of Calisto revealed unfinished and unused additional functionality:\n\nLoading/unloading of kernel extensions for handling USB devices\nData theft from user directories\nSelf-destruction together with the OS\n\n\n-----\n\n_Loading/unloading of kernel extensions_\n\n_Working with user directories_\n\n_Self-destruction together with the entire system_\n\n## Connections with Backdoor.OSX.Proton\n\nConceptually, the Calisto backdoor resembles a member of the Backdoor.OSX.Proton family:\n\nThe distribution method is similar: it masquerades as a well-known antivirus (a\n[Backdoor.OSX.Proton was previously distributed under the guise of a Symantec](https://blog.malwarebytes.com/threat-analysis/mac-threat-analysis/2017/05/handbrake-hacked-to-drop-new-variant-of-proton-malware/)\nantivirus product)\n\n\n-----\n\nThe Trojan sample contains the line com.proton.calisto.plist\nLike Backdoor.OSX.Proton, this Trojan is able to steal a great amount of personal data\nfrom the user system, including the contents of Keychain\n\nRecall that all known members of the Proton malware family were distributed and discovered\nin 2017. The Calisto Trojan we detected was created no later than 2016. Assuming that this\nTrojan was written by the same authors, it could well be one of the very first versions of\nBackdoor.OSX.Proton or even a prototype. The latter hypothesis is supported by the large\nnumber of unused and not fully implemented functions. However, they were missing from\nlater versions of Proton.\n\nTo protect against Calisto, Proton, and their analogues:\n\nAlways update to the current version of the OS\nNever disable SIP\nRun only signed software downloaded from trusted sources, such as the App Store\nUse antivirus software\n\n**MD5**\n\nDMG image: d7ac1b8113c94567be4a26d214964119\nMach-O executable: 2f38b201f6b368d587323a1bec516e5d\n\n[Apple MacOS](https://securelist.com/tag/apple-macos/)\n[Backdoor](https://securelist.com/tag/backdoor/)\n[Malware Descriptions](https://securelist.com/tag/malware-descriptions/)\n\nAuthors\n\nMikhail Kuzin\n\n[Sergey Zelensky](https://securelist.com/author/sergeyzelensky/)\n\nCalisto Trojan for macOS\n\nYour email address will not be published. Required fields are marked *\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-07-20 - Calisto Trojan for macOS.pdf"
    ],
    "report_names": [
        "2018-07-20 - Calisto Trojan for macOS.pdf"
    ],
    "threat_actors": [
        {
            "id": "2d06d270-acfd-4db8-83a8-4ff68b9b1ada",
            "created_at": "2022-10-25T16:07:23.477794Z",
            "updated_at": "2025-03-27T02:02:09.824281Z",
            "deleted_at": null,
            "main_name": "Cold River",
            "aliases": [
                "Blue Callisto",
                "BlueCharlie",
                "Calisto",
                "Cobalt Edgewater",
                "Nahr Elbard",
                "Nahr el bared",
                "Seaborgium",
                "Star Blizzard",
                "TA446",
                "TAG-53",
                "UNC4057"
            ],
            "source_name": "ETDA:Cold River",
            "tools": [
                "Agent Drable",
                "AgentDrable",
                "DNSpionage",
                "SPICA"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "3a057a97-db21-4261-804b-4b071a03c124",
            "created_at": "2024-06-04T02:03:07.953282Z",
            "updated_at": "2025-03-27T02:05:17.406598Z",
            "deleted_at": null,
            "main_name": "IRON FRONTIER",
            "aliases": [
                "BlueCharlie ",
                "CALISTO ",
                "COLDRIVER ",
                "Callisto Group ",
                "Gossamer Bear ",
                "Gossamer Bear ",
                "SEABORGIUM ",
                "Star Blizzard ",
                "TA446 ",
                "Blue Callisto "
            ],
            "source_name": "Secureworks:IRON FRONTIER",
            "tools": [
                " Galileo RCS",
                " SPICA",
                "Evilginx2"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673535819,
    "ts_updated_at": 1743041643,
    "ts_creation_date": 1653713375,
    "ts_modification_date": 1653713375,
    "files": {
        "pdf": "https://archive.orkl.eu/84f9f54aebab49af1ccc4f7dcbf044673eca2faf.pdf",
        "text": "https://archive.orkl.eu/84f9f54aebab49af1ccc4f7dcbf044673eca2faf.txt",
        "img": "https://archive.orkl.eu/84f9f54aebab49af1ccc4f7dcbf044673eca2faf.jpg"
    }
}