{
    "id": "cad1d9d0-ed84-4e69-9ab5-afeb41388db4",
    "created_at": "2023-01-12T15:01:59.225757Z",
    "updated_at": "2025-03-27T02:15:35.644297Z",
    "deleted_at": null,
    "sha1_hash": "efa0e6e3ad0d7d3b9e2597ece1d709d3f9924063",
    "title": "2022-02-06 - Deep Analysis of Vidar Information Stealer",
    "authors": "",
    "file_creation_date": "2022-05-28T00:26:42Z",
    "file_modification_date": "2022-05-28T00:26:42Z",
    "file_size": 2592931,
    "plain_text": "# Deep Analysis of Vidar Information Stealer\n\n**eln0ty.github.io/malware analysis/vidar/**\n\n17 minute read\n\nVidar (forked from Arkei info stealer) is very popular info stealer written in C++.\n\n**What does it steal?**\n\nThe malware has all the kinds of classic features of stealers:\n\nStealing browser Data (auto-fill, history, cookies - credit cards)\nStealing Crypto mining wallets\nStealing data from 2FA software like Authy\nSearching for specific documents\nTelegram notifications\nScreenshot\nGet a complete snapshot of all information of the computer victim\n\n\nFebruary 6, 2022\n\n\nVidar’s clients have access to a C2 Shop portal where they are able to generate their own payloads. So\nthere is no management on their side. For this in-depth analysis, I will inspect the 49.7 version of Vidar.\n\nBefore starting, I want to thank my friend [@_ n1ghtw0lf because he helped me a lot to write this report..](https://twitter.com/_n1ghtw0lf)\nLet’s start ^_^\n\n## Vidar overview\n\n**SHA256:** `532BC078A68683CE70CB765191A128FADEE2A23180B1A8E8A16B72F1A8EE291A`\n\nI will give a brief overview of how Vidar operates then I will go into details in the upcoming sections.\n\nThis is the basic config from [Hatching sandbox.](https://tria.ge/220118-alwyesegdk)\n\nVidar collects All important data from victim’s device then Uploads them to C2 server and delete these\nfiles from the device with `taskkill.exe`\n\n\n-----\n\nThe collection will be something like that (I got it from sandbox so I lost some data because sandbox\ndoesn’t contain everything)\n\ncompress them in `.zip file to be ready for uploading.`\n\nYou can watch this [video which describes the operation from server side.](https://vimeo.com/514353794?fbclid=IwAR1PqolWyX-uyF66U2LyY3z5mk7SnIJFKDw00vjbwnAo9LzNfLvS8yaI9iw)\n\n## Sample Preparation (strings & dlls)\n\nI faced some problems in my sample, all strings are encrypted and dlls are dynamic allocated.\n\nVidar tries to decrypt it with the first function before starting any process.\n\n\n-----\n\n## Decrypt strings\n\nThe encryption algorithm is pretty easy and straight forward. We just do `text = xor(key, cipher)`\nfor every encrypted text by automating it with IDAPython.\n\nThis is the script for the mission. “Every section of the code has a comment to make it readable for you”\n\n\n-----\n\n```\nimport idc\ndef dec_str(key, data, length):\n  res = bytearray()\n  for i in range(length):\n    res.append(key[i] ^ data[i])\n  return res.decode()\nstart = 0x401301\nend = 0x4031E5\nea = start\naddrs = []\ndec = ''\nkey = b''\ndata = b''\nlength = 0\nwhile ea <= end:\n  # check if opperand is immediate\n  if idc.get_operand_type(ea, 0) == idc.o_imm:\n    addrs.append((idc.get_operand_value(ea, 0)))\n  # get key, data, length\n  if len(addrs) == 3:\n    length = addrs[0]\n    data = idc.get_bytes(addrs[1], length)\n    key = idc.get_bytes(addrs[2], length)\n    addrs = []\n  # comment decrypted string\n  if idc.print_insn_mnem(ea) == \"call\":\n    dec = dec_str(key, data, length)\n    idc.set_cmt(ea, dec, 1)\n  if (idc.print_insn_mnem(ea) == \"mov\") and (idc.get_operand_type(ea, 0) == idc.o_mem) and\n(idc.get_operand_type(ea, 1) == idc.o_reg):\n    global_var = idc.get_operand_value(ea, 0)\n    idc.set_name(global_var, \"STR_\" + dec, SN_NOWARN)\n  # move to next instruction\n  ea = idc.next_head(ea, end)\n\n```\nAfter this step you must see a clear plain text. Here you are the results:\n\nExpand to see more\nINSERT_KEY_HERE\nJohnDoe\nHAL9TH\napi.faceit.com\n/core/v1/nicknames/\nabout\nMozilla/5.0 (iPhone; CPU iPhone OS 6_0 like Mac OS X) AppleWebKit/536.26 (KHTML, like Gecko)\nVersion/6.0 Mobile/10A5376e Safari/8536.25\nC:/ProgramData/\n.exe\n\n:Zone Identifier\n\n\n-----\n\n[ZoneTransfer] ZoneId=2\nWindows\nProgramData\nRECYCLE.BIN\nConfig.Msi\nSystem Volume Information\nmsdownld.tmp\nRecovery\nLocal/Temp\nProgram Files\nRecycle.Bin\nAll Users\nMicrosoftEdge/Cookies\nUsers/Public\nLocal/Packages\nLocal/NuGet\nRoaming/WinRAR\nLocal/Microsoft\nMicrosoft\nfee_estimates\npeers\nmempool\nbanlist\ngovernance\nmncache\nmnpayments\nnetfulfilled\npasswords.txt\nLogin Data\nCookies\nWeb Data\n/files/Autofill\n/files/Cookies\n/files/CC\n/files/History\n/files/Downloads\n/files/\n/files/Files\nhwid\nos\nplatform\nprofile\nuser\ncccount\nfcount\ntelegram\nver\n\n\n-----\n\nvaultcli.dll\nVaultOpenVault\nVaultCloseVault\nVaultEnumerateItems\nVaultGetItem\nVaultFree\nSELECT url FROM moz_places\n%s/Mozilla/Firefox/profiles.ini\n/signons.sqlite\nSELECT encryptedUsername, encryptedPassword, formSubmitURL FROM moz_logins\n/logins.json\nformSubmitURL\nusernameField\nencryptedUsername\nencryptedPassword\nguid\nSELECT host, name, value FROM moz_cookies\nSELECT origin_url, username_value, password_value FROM logins\nSELECT name, value FROM autofill\nSELECT name_on_card, expiration_month, expiration_year, card_number_encrypted FROM\ncredit_cards\nSELECT target_path, tab_url from downloads\nSELECT url, title from urls\nSELECT HOST_KEY, is_httponly, path, is_secure, (expires_utc/1000000)-11644480800, name,\nencrypted_value from cookies\nC:/Users/\n/AppData/Roaming/FileZilla/recentservers.xml\n<Host>\n<Port>\n<User>\n<Pass encoding=\"base64\">\nSoft: FileZilla\n/AppData/Roaming/.purple/accounts.xml\n<protocol>\n<name>\n<password>\nSoft: Pidgin\n/Thunderbird/Profiles/\nC:/Program Files (x86)/Mozilla Thunderbird\nAPPDATA\nLOCALAPPDATA\nThunderbird\n/files/Telegram\n/Telegram Desktop/tdata/*\nD877F783D5D3EF8C*\n/Telegram Desktop/tdata/\nkey_datas\n\n\n-----\n\n/Telegram Desktop/tdata/D877F783D5D3EF8C/\nmap*\n/Telegram Desktop/tdata/D877F783D5D3EF8C/\nfirefox.exe\nplugin-container.exe\nupdate_notifier.exe\nMozilla Firefox\n/Mozilla/Firefox/Profiles/\nPale Moon\n/Moonchild Productions/Pale Moon/Profiles/\nWaterfox\n/Waterfox/Profiles/\nCyberfox\n/8pecxstudios/Cyberfox/Profiles/\nBlackHawk\n/NETGATE Technologies/BlackHawk/Profiles/\nIceCat\n/Mozilla/icecat/Profiles/\nK-Meleon\n/K-Meleon/\nGoogle Chrome\n/Google/Chrome/User Data/\nChromium\n/Chromium/User Data/\nKometa\n/Kometa/User Data/\nAmigo\n/Amigo/User Data/\nTorch\n/Torch/User Data/\nOrbitum\n/Orbitum/User Data/\nComodo Dragon\n/Comodo/Dragon/User Data/\nNichrome\n/Nichrome/User Data/\nMaxthon5\n/Maxthon5/Users/\nSputnik\n/Sputnik/User Data/\nEpic Privacy Browser\n/Epic Privacy Browser/User Data/\nVivaldi\n/Vivaldi/User Data/\nCocCoc\n/CocCoc/Browser/User Data/\nURAN\n\n\n-----\n\n/uCozMedia/Uran/User Data/\nQIP Surf\n/QIP Surf/User Data/\nCent Browser\n/CentBrowser/User Data/\nElements Browser\n/Elements Browser/User Data/\nTorBro Browser\n/TorBro/Profile/\nSuhba Browser\n/Suhba/User Data/\nMustang Browser\n/Rafotech/Mustang/User Data/\nChedot Browser\n/Chedot/User Data/\nBrave_Old\n/brave/\n7Star\n/7Star/7Star/User Data/\nMicrosoft Edge\n/Microsoft/Edge/User Data/\n360 Browser\n/360Browser/Browser/User Data/\nQQBrowser\n/Tencent/QQBrowser/User Data/\nOpera\n/Opera Software/Opera Stable/\nOperaGX\n/Opera Software/Opera GX Stable/\nLocal State\nCookies\n%s_%s.txt\nTRUE\nFALSE\n/Microsoft/Windows/Cookies/Low/\nCookies/IE_Cookies.txt\n/Packages/Microsoft.MicrosoftEdge_8wekyb3d8bbwe/AC/#!001/MicrosoftEdge/Cookies/\nCookies/Edge_Cookies.txt\n/files/Wallets\n%USERPROFILE%\n%DESKTOP%\nKERNEL32.DLL\nLoadLibraryA\nGetProcAddress\nVirtualAllocExNuma\ngdi32.dll\nole32.dll\n\n\n-----\n\nuser32.dll\npsapi.dll\nBCRYPT.DLL\nBCryptCloseAlgorithmProvider\nBCryptDestroyKey\nBCryptOpenAlgorithmProvider\nBCryptSetProperty\nBCryptGenerateSymmetricKey\nBCryptDecrypt\nCRYPT32.DLL\nCryptUnprotectData\nCryptStringToBinaryA\nC:/ProgramData/nss3.dll\nNSS_Init\nNSS_Shutdown\nPK11_GetInternalKeySlot\nPK11_FreeSlot\nPK11_Authenticate\nPK11SDR_Decrypt\nadvapi32.dll\nRegOpenKeyExA\nRegQueryValueExA\nRegCloseKey\nRegOpenKeyExW\nRegGetValueW\nRegEnumKeyExA\nRegGetValueA\nGetUserNameA\nGetCurrentHwProfileA\nwininet.dll\nInternetCloseHandle\nInternetReadFile\nHttpSendRequestA\nHttpOpenRequestA\nInternetConnectA\nInternetOpenA\nHttpAddRequestHeadersA\nHttpQueryInfoA\nInternetSetFilePointer\nInternetOpenUrlA\nInternetSetOptionA\nDeleteUrlCacheEntry\nCreateCompatibleBitmap\nSelectObject\nBitBlt\nDeleteObject\nCreateDCA\n\n\n-----\n\nGetDeviceCaps\nCreateCompatibleDC\nCoCreateInstance\nCoUninitialize\nGetDesktopWindow\nReleaseDC\nGetKeyboardLayoutList\nCharToOemA\nGetDC\nwsprintfA\nEnumDisplayDevicesA\nGetSystemMetrics\nGetModuleFileNameExA\nGetModuleBaseNameA\nEnumProcessModules\nTronLink\n/Local Extension Settings/ibnejdfjmmkpcnlpebklmnkoeoihofec/CURRENT\n/Sync Extension Settings/ibnejdfjmmkpcnlpebklmnkoeoihofec/CURRENT\n/Local Extension Settings/ibnejdfjmmkpcnlpebklmnkoeoihofec\n/Sync Extension Settings/ibnejdfjmmkpcnlpebklmnkoeoihofec\nMetaMask\n/Local Extension Settings/nkbihfbeogaeaoehlefnkodbefgpgknn/CURRENT\n/Sync Extension Settings/nkbihfbeogaeaoehlefnkodbefgpgknn/CURRENT\n/Local Extension Settings/nkbihfbeogaeaoehlefnkodbefgpgknn\n/Sync Extension Settings/nkbihfbeogaeaoehlefnkodbefgpgknn\nBinanceChainWallet\n/Local Extension Settings/fhbohimaelbohpjbbldcngcnapndodjp/CURRENT\n/Sync Extension Settings/fhbohimaelbohpjbbldcngcnapndodjp/CURRENT\n/Local Extension Settings/fhbohimaelbohpjbbldcngcnapndodjp\n/Sync Extension Settings/fhbohimaelbohpjbbldcngcnapndodjp\nAuthenticator\n/Local Extension Settings/bhghoamapcdpbohphigoooaddinpkbai/CURRENT\n/Sync Extension Settings/bhghoamapcdpbohphigoooaddinpkbai/CURRENT\n/Local Extension Settings/bhghoamapcdpbohphigoooaddinpkbai\n/Sync Extension Settings/bhghoamapcdpbohphigoooaddinpkbai\nWallets\nPlugins\n*wallet*.dat\n/Wallets/\nkeystore\nEthereum\"\n/Ethereum/\nElectrum\n/Electrum/wallets/\nElectrumLTC\n/Electrum-LTC/wallets/\nExodus\n\n\n-----\n\n/Exodus/\nexodus.conf.json\nwindow-state.json\n/Exodus/exodus.wallet/\npassphrase.json\nseed.seco\ninfo.seco\nElectronCash\n/ElectronCash/wallets/\ndefault_wallet\nMultiDoge\n/MultiDoge/\nmultidoge.wallet\nJAXX\n/jaxx/Local Storage/\nfile__0.localstorage\nAtomic\n/atomic/Local Storage/leveldb/\n000003.log\nCURRENT\nLOCK\nLOG\nMANIFEST-000001\n0000*\nBinance\n/Binance/\napp-store.json\nCoinomi\n/Coinomi/Coinomi/wallets/\n*.wallet\n*.config\nwallet_path\nSOFTWARE/monero-project/monero-core\n/Monero/\nSELECT fieldname, value FROM moz_formhistory\n/files/Soft\n/files/Soft/Authy\n/Authy Desktop/Local Storage/\n/Authy Desktop/Local Storage/*.localstorage\n/Opera Stable/Local State\nLet’s move to the next step…\n\n## Building imports\n\nVidar uses `LoadLibraryA &` `GetProcAddress to make a build imports dynamically. The following`\nfunction is used for this mission.\n\n\n-----\n\nBut there are no readable APIs. So I wrote an IDAPython script to rename it. The script used the\n**_decrypted strings and map them with the functions to get a clear overview. “you can check it with the_**\ndebugger”\n\n\n-----\n\n```\nimport idc\nstart = 0x49978D\nend = 0x499B62\nea = start\napi_names = []\nwhile ea <= end:\n  # get GetProcAddress API name\n  if (idc.print_insn_mnem(ea) == \"mov\") and (idc.get_operand_type(ea, 0) == idc.o_reg) and\n(idc.get_operand_type(ea, 1) == idc.o_mem):\n    addr = idc.get_operand_value(ea, 1)\n    name = idc.get_name(addr)\n    if name.startswith(\"STR_\"):\n      api_names.append(name)\n  # assign GetProcAddress result to global var\n  if (idc.print_insn_mnem(ea) == \"mov\") and (idc.get_operand_type(ea, 0) == idc.o_mem) and\n(idc.print_operand(ea, 1) == \"eax\"):\n    addr = idc.get_operand_value(ea, 0)\n    name = api_names.pop(0)\n    idc.set_name(addr, \"API_\" + name[4:])\n  # move to next instruction\n  ea = idc.next_head(ea, end)\n\n```\nNow you can look and enjoy..\n\n### Imported DLLs\n\nHere is a list of imported functions:\n\n\n-----\n\nExpand to see more\nbcrypt.dll\nBCryptCloseAlgorithmProvider\nBCryptDestroyKey\nBCryptOpenAlgorithmProvider\nBCryptSetProperty\nBCryptGenerateSymmetricKey\nBCryptDecrypt\ncrypt32.dll\nCryptUnprotectData\nCryptStringToBinaryA\nadvapi32.dll\nRegOpenKeyExA\nRegQueryValueExA\nRegCloseKey\nRegOpenKeyExW\nRegGetValueW\nRegEnumKeyExA\nRegGetValueA\nGetUserNameA\nGetCurrentHwProfileA\nwininet.dll\nInternetCloseHandle\nInternetReadFile\nHttpSendRequestA\nHttpOpenRequestA\nInternetConnectA\nInternetOpenA\nHttpAddRequestHeadersA\nHttpQueryInfoA\nInternetSetFilePointer\nInternetOpenUrlA\nInternetSetOptionA\nDeleteUrlCacheEntry\ngdi32.dll\nCreateCompatibleBitmap\nSelectObject\nBitBlt\nDeleteObject\nCreateDCA\nGetDeviceCaps\nCreateCompatibleDC\nole32.dll\nCoCreateInstance\nCoUninitialize\nuser32.dll\nGetDesktopWindow\n\n\n-----\n\nReleaseDC\nGetKeyboardLayoutList\nCharToOemA\nGetDC\nwsprintfA\nEnumDisplayDevicesA\npsapi.dll\nGetModuleFileNameExA\nGetModuleBaseNameA\nEnumProcessModules\n\n### Extra DLLs\n\nThe malware has been observed, upon execution. DLL files are required during the stealing process of\ndifferent kind of browsers. So it downloads them with connecting to ip: `162.55.213.180 via GET`\nrequest. They are deleted when task is done.\n\n**DLL** **Description**\n\nfreebl3.dll Freebl Library for the NSS (Mozilla Browser)\n\nmozglue.dll Mozilla Browser Library\n\nmsvcp140.dll Visual C++ Runtime 2015\n\nnss3.dll Network System Services Library (Mozilla Browser)\n\nsoftokn3.dll Mozilla Browser Library\n\nvcruntime140.dll Visual C++ Runtime 2015\n\nWell, Now our sample is ready to reverse its functionalities. Let’s Continue…\n\n## C2 Server\n\nC2 IP `162.55.213.180 (real C2)`\n\nVidar has 2 profiles with different websites, every profile should have same IP list. IPs delimited with `|`\nin each list.\n\nSo Vidar tries to grep c2 server IP from 1 of them ‘In our case just 1 IP’. you can check profile\ndescription\n\nFirst `mastodon.online/@prophef1`\n\n\n-----\n\nSecond `koyu.space/@prophef2`\n\nVidar tries to connect with C2 server with it’s hardcoded profile-id to get the right config:\n```\n1,1,1,1,1,1,1,1,1,1,250,Default;%DESKTOP%/;/*.txt:/*.dat:/*wallet/*.*:/*2fa/*.*:/*backup/*.*:/*co\n\n```\nEach part have the “;” in delimiter, so let’s dig into it.\n\n## How to understand the configuration format\n\nIn our example, this is the configuration the malware could get from the C2 :\n\n**First part**\n\n\n-----\n\n**1** **Saved password**\n\n1 Cookies / AutoFill\n\n1 Wallet\n\n1 Internet History\n\n1 ??? – Supposed to be Skype (not implemented)/\n\n1 ??? – Supposed to be Steam (not implemented)/\n\n1 Telegram\n\n1 Screenshot\n\n1 Grabber\n\n1 ???\n\n250 Max Size (kb)\n\nDefault Name of the profile (also used for archive file into the files repository)\n\n**Second part**\n\n**%DESKTOP % –> Selected folder repository where the grabber feature will search recursively (or not)**\nsome selected data\n\n**Third part**\n\n**_.txt:/.dat:/wallet/./:/2fa/./:/backup/./:/code/./:/password/./:/auth/./:/google/./:/utc/./:/UTC/./:/crypt/./:/key/.*_**\n\n**Fourth part**\n\n**50** **Max Size per file (kb)**\n\ntrue Collect Recursively\n\n**Fifth part**\n\nmovies:music:mp3;\n\nThis is the exception part, the grabber will avoid those strings if it matches in the files searched\nrecursively in the specific wanted folder.\n\n## Folder generation\n\nTo summarize all kind of possibles files/folders that will be generated for the malicious repository is in\nfact pretty simple :\n\n\n-----\n\n```\n//files           Master folder\n//files//Autofill     <- Auto-Fill files\n//files//CC        <- Credit Cards\n//files//Cookies     <- Cookies\n//files//Downloads    <- Downloaded data history from browsers\n//files//Files      <- Profile configs (Archives)\n//files//History     <- Browser histories\n//files//Soft       <- Master folder for targeted softwares\n//files//Soft//Authy   <- 2FA software\n//files//Telegram     <- Telegram messages\n//files//Wallets     <- Cryptomining Wallets\n\n```\nGeneral list files\n```\n//files/screenshot.jpg   <- Actual screenshot of the screen\n//files/passwords.txt   <- Passwords consolidated all at once\n//files//information.txt  <- Snapshot of the computer setup\n//files//outlook.txt   <- Outlook cardentials\n\n## Browsers\n\n```\nfirefox\nwaterfall\nCyberfox\nBlackHawk\nIceCat\nOpera\nOperaGX\nChromium\nKometa\nAmigo\nTorch\norbitum\nNichrome\nMaxthon 5\nsputnik\nCocCoc\nUran\n7Star\nQQBrowser\nCryptoTab Browser\nBrave\nBrave old\n\nOf course, this list could be longer than this if there are some browsers based on chromium repository.\n\n## 2 Factor Authentication software (2FA)\n\nThis technique could be also another door for vulnerabilities because no system is safe and stealing it\nwill be more and more common in the future. So with Vidar, the Authy software is targeted.\n\n\n-----\n\nMore specifically the SQLite file on the corresponding application on %APPDATA% repository.\n\nSo guys don’t fully trust a system even security system. Give your privacy all your care.\n\n## Messengers\n\n\n-----\n\n**outlook**\n\nHere is the data that Vidar steals : extracted from sandbox machine\n\n**Thunderbird**\n\n**Telegram**\n\nI won’t describe how Vidar steals them because the process (in-depth)is painful and needs another\nreport to explain. :)\n\n## Crypto Wallets\n\nEletcrum\nExodus\nElectronCash\nMultiDoge\nJAXX\nAtomic\nBinance\n\nThis list could change if the customer added some additional files to search for specific areas on victim’s\nmachine.\n\n## Information log\n\n\n-----\n\nto understand how this file is generated with the corresponding API call, breakpoint on these API if you\nwant to take your time to analyze all the step easily. Vidar steals almost all general information about\nvictim machine and save it in inforamtion.txt file like:\n\nDate\n\nMachine ID\n\nGUID\n\nHWID\n\nPath\n\nWork DIR\n\n)\n\nGet the name of the operating system and platform is classic because this is, in fact, a concatenation of\n[two things. First, Vidar check if Windows is 32 or 64-bit, it checks itself if is running on WOW64 with the](https://docs.microsoft.com/fr-fr/windows/desktop/WinProg64/running-32-bit-applications)\n[help of IsWow64Process.](https://docs.microsoft.com/en-us/windows/desktop/api/wow64apiset/nf-wow64apiset-iswow64process)\n\n\n-----\n\nSecond, with [RegOpenKeyExA, the value of this registry key is fetched:](https://docs.microsoft.com/en-us/windows/desktop/api/winreg/nf-winreg-regopenkeyexa)\n```\nHKEY_LOCAL_MACHINE/SOFTWARE/Microsoft/Windows NT/CurrentVersion/ProductName\n\n```\nHere we can see the some pretty APIs that we decrypted before analysis. Let’s continue our analysis…\n\nWindows version Computer Name User Name Display Resolution Display Language Keyboard\nLanguages Local Time TimeZone\n\n[Hardware] -> Processor -> CPU Count -> RAM -> VideoCard\n\n\n-----\n\n[[Processes] Get a snapshot from all processes executed using CreateToolhelp32Snapshot &](https://docs.microsoft.com/en-us/windows/desktop/api/tlhelp32/nf-tlhelp32-createtoolhelp32snapshot)\n**_[Process32First &](https://docs.microsoft.com/en-us/windows/desktop/api/tlhelp32/nf-tlhelp32-process32first)_** **_[Process32Next](https://docs.microsoft.com/en-us/windows/win32/api/tlhelp32/nf-tlhelp32-process32next)_**\n\nAfter, checking if it’s a parent process or a child process, Vidar will grab two value of the\n**_[PROCESSENTRY32 object : th32ProcessID: PID szExeFile: The name of the PE](https://docs.microsoft.com/fr-fr/windows/desktop/api/tlhelp32/ns-tlhelp32-tagprocessentry32)_**\n\nI can’t screen all function here but you can take your time while analyzing it. Let’s continue…\n\n[Software] Get list of all installed software on the machine, the value of this registry key is fetched:\n```\nHKEY_LOCAL_MACHINE/SOFTWARE/Microsoft/Windows/CurrentVersion/Uninstall\n\n```\nThese values are retrieves of each software (DisplayName & DisplayVersion)\n\n\n-----\n\n## Result\n\n[You can see into sandbox analysis, the generated information.txt and the whole process and](https://app.any.run/tasks/0a57b362-32d4-4d33-bf66-9107ac1ca39d)\nconnections.\n\n\n-----\n\n```\nVersion: 49.7\nDate: Tue Feb 01 04:37:51 2022\nMachineID: 90059c37-1320-41a4-b58d-2b75a9850d2f\nGUID: {e29ac6c0-7037-11de-816d-806e6f6e6963}\nHWID: 90059c37-1320-41a4-b58d-816d-806e6f6e6963\nPath: C:/Users/admin/AppData/Local/Temp/vidar.exe \nWork Dir: C:/ProgramData/GI3PPKTM8AJDIRUF0RKXBSEQV \nWindows: Windows 7 Professional [x86]\nComputer Name: USER-PC\nUser Name: admin\nDisplay Resolution: 1280x720\nDisplay Language: en-US\nKeyboard Languages: English (United States)\nLocal Time: 1/2/2022 4:37:51\nTimeZone: UTC-0\n[Hardware]\nProcessor: Intel(R) Core(TM) i5-6400 CPU @ 2.70GHz\nCPU Count: 4\nRAM: 3583 MB\nVideoCard: Standard VGA Graphics Adapter\n[Processes]\n---------- System [4]\n------------------------------ smss.exe [260]\n- csrss.exe [544]\n- vidar.exe [1988]\n< ... >\n[Software]\nVLC media player [3.0.11]\nWinRAR 5.91 (32-bit) [5.91.0]\n< ... >\n\n## Other payloads\n\n```\n[Vidar can download an executable file and execute it with ShellExecuteA.](https://docs.microsoft.com/en-us/windows/win32/api/shellapi/nf-shellapi-shellexecutea)\n\nFirst Download\n\n\n-----\n\nThen Execute\n\n## Kill Task\n\nVidar uses taskkill.exe to kill process. So when all the task of the stealer is finally accomplished and\n[cleaned, the stealer needs to erase itself. So first of all, it retrieves its own PID with the help of](https://en.wikipedia.org/wiki/Process_identifier)\n[GetCurrentProcessId.](https://docs.microsoft.com/en-us/windows/desktop/api/processthreadsapi/nf-processthreadsapi-getcurrentprocessid)\n\n\n-----\n\n[When the request is finely crafted, Vidar is simply using ShellExecuteA to pop a command shell and](https://docs.microsoft.com/en-us/windows/desktop/api/shellapi/nf-shellapi-shellexecutea)\nexecute the task, this erases all trace of the interaction of the payload on the machine and delete all\ndownloaded DLLs.\n\nThe full command:\n```\n\"C:/Windows/System32/cmd.exe\" /c taskkill /im vidar.exe /f & timeout /t 6 & del /f /q\n\"C:/Users/admin/AppData/Local/Temp/vidar.exe\" & del C:/ProgramData/*.dll & exit\n\n## Exfiltration\n\n```\n**File Generation**\n\nI can’t understand well how malware generates the file name but It consists from ‘Machine ID + ??\n(random digits) + .zip ‘\n\n\n-----\n\nThis at least, all the different Content-Disposition that will be added to the HTTP request.\n\n**hwid** **Hardware ID**\n\nos Operating System\n\nplatform 32 or 64 bits System\n\nprofile C2 Profile ID\n\nuser Name of the victim account\n\ncccount Number of Credit Cards stolen\n\nccount Number of Coins Stolen (CryptoWallet)\n\nfcount Number of files stolen\n\nver The version of the Vidar malware\n\n## Conclusion\n\nVidar always tries to steal your data as much as it can and its tasks vary from version to another. It was\nhard and exciting and I want to mention “This is my first Tech. report” and I will write more and more.\n\n[Finally, Remember you can watch the video that I passed in the intro to see how it works from server](https://vimeo.com/514353794?fbclid=IwAR1PqolWyX-uyF66U2LyY3z5mk7SnIJFKDw00vjbwnAo9LzNfLvS8yaI9iw)\nside.\n\n\n-----\n\n## Yara Rules\n```\nrule Vidar_Stealer : Vidar\n{\n   meta:\n     Author = \"eln0ty\"\n     Description = \"Rule to detect Vidar\"\n     Date = \"Feb 5, 2022\"\n   strings:\n     $mz = \"MZ\"\n     $s1 = \"1BEF0A57BE110FD467A\" ascii\n     $s2 = \"Version: %s\" ascii\n     $s3 = \"Date: %s\" ascii\n     $s4 = \"MachineID: %s\" ascii\n     $s5 = \"GUID: %s\" ascii\n     $s6 = \"HWID: %s\" ascii\n   condition:\n     ($mz at 0) and (all of ($s*))\n}\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-02-06 - Deep Analysis of Vidar Information Stealer.pdf"
    ],
    "report_names": [
        "2022-02-06 - Deep Analysis of Vidar Information Stealer.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "9f101d9c-05ea-48b9-b6f1-168cd6d06d12",
            "created_at": "2023-01-06T13:46:39.396409Z",
            "updated_at": "2025-03-27T02:00:03.074969Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "CHROMIUM",
                "ControlX",
                "Red Dev 10",
                "RedHotel",
                "Red Scylla",
                "TAG-22",
                "BRONZE UNIVERSITY",
                "AQUATIC PANDA",
                "Charcoal Typhoon",
                "BountyGlad"
            ],
            "source_name": "MISPGALAXY:Earth Lusca",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "a66438a8-ebf6-4397-9ad5-ed07f93330aa",
            "created_at": "2022-10-25T16:47:55.919702Z",
            "updated_at": "2025-03-27T02:05:17.412024Z",
            "deleted_at": null,
            "main_name": "IRON VIKING",
            "aliases": [
                "ATK14 ",
                "BlackEnergy Group",
                "Blue Echidna ",
                "CTG-7263 ",
                "ELECTRUM ",
                "FROZENBARENTS ",
                "Hades/OlympicDestroyer ",
                "IRIDIUM ",
                "Qudedagh ",
                "Sandworm Team ",
                "Seashell Blizzard ",
                "TEMP.Noble ",
                "Telebots ",
                "Voodoo Bear ",
                "APT44 "
            ],
            "source_name": "Secureworks:IRON VIKING",
            "tools": [
                " BlackEnergy",
                " GCat",
                " GreyEnergy",
                " Industroyer",
                " KillDisk",
                " NotPetya",
                " PSCrypt",
                " TeleBot",
                " TeleDoor",
                " xData",
                "BadRabbit"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "b3e954e8-8bbb-46f3-84de-d6f12dc7e1a6",
            "created_at": "2022-10-25T15:50:23.339976Z",
            "updated_at": "2025-03-27T02:00:55.446795Z",
            "deleted_at": null,
            "main_name": "Sandworm Team",
            "aliases": [
                "Sandworm Team",
                "ELECTRUM",
                "Telebots",
                "IRON VIKING",
                "BlackEnergy (Group)",
                "Quedagh",
                "Voodoo Bear",
                "IRIDIUM",
                "Seashell Blizzard",
                "FROZENBARENTS",
                "APT44"
            ],
            "source_name": "MITRE:Sandworm Team",
            "tools": [
                "Bad Rabbit",
                "Mimikatz",
                "Exaramel for Linux",
                "Exaramel for Windows",
                "GreyEnergy",
                "PsExec",
                "Prestige",
                "P.A.S. Webshell",
                "VPNFilter",
                "Cyclops Blink",
                "SDelete",
                "AcidRain",
                "Industroyer",
                "Industroyer2",
                "BlackEnergy",
                "Cobalt Strike",
                "NotPetya",
                "KillDisk",
                "PoshC2",
                "Impacket",
                "Invoke-PSImage",
                "Olympic Destroyer"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "3a0be4ff-9074-4efd-98e4-47c6a62b14ad",
            "created_at": "2022-10-25T16:07:23.590051Z",
            "updated_at": "2025-03-27T02:02:09.878211Z",
            "deleted_at": null,
            "main_name": "Energetic Bear",
            "aliases": [
                "ATK 6",
                "Blue Kraken",
                "Crouching Yeti",
                "Dragonfly",
                "Electrum",
                "Energetic Bear",
                "Ghost Blizzard",
                "Group 24",
                "ITG15",
                "Iron Liberty",
                "Koala Team",
                "TG-4192"
            ],
            "source_name": "ETDA:Energetic Bear",
            "tools": [
                "Backdoor.Oldrea",
                "CRASHOVERRIDE",
                "Commix",
                "CrackMapExec",
                "CrashOverride",
                "Dirsearch",
                "Dorshel",
                "Fertger",
                "Fuerboos",
                "Goodor",
                "Havex",
                "Havex RAT",
                "Hello EK",
                "Heriplor",
                "Impacket",
                "Industroyer",
                "Karagany",
                "Karagny",
                "LightsOut 2.0",
                "LightsOut EK",
                "Listrix",
                "Oldrea",
                "PEACEPIPE",
                "PHPMailer",
                "PsExec",
                "SMBTrap",
                "Subbrute",
                "Sublist3r",
                "Sysmain",
                "Trojan.Karagany",
                "WSO",
                "Webshell by Orb",
                "Win32/Industroyer",
                "Wpscan",
                "nmap",
                "sqlmap",
                "xFrost"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "6abcc917-035c-4e9b-a53f-eaee636749c3",
            "created_at": "2022-10-25T16:07:23.565337Z",
            "updated_at": "2025-03-27T02:02:09.868522Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Bronze University",
                "Charcoal Typhoon",
                "Chromium",
                "Red Dev 10",
                "Red Scylla"
            ],
            "source_name": "ETDA:Earth Lusca",
            "tools": [
                "Agentemis",
                "AntSword",
                "BIOPASS",
                "BIOPASS RAT",
                "BadPotato",
                "Behinder",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "Doraemon",
                "FRP",
                "Fast Reverse Proxy",
                "FunnySwitch",
                "HUC Port Banner Scanner",
                "KTLVdoor",
                "Mimikatz",
                "NBTscan",
                "POISONPLUG.SHADOW",
                "PipeMon",
                "RbDoor",
                "RibDoor",
                "RouterGod",
                "SAMRID",
                "ShadowPad Winnti",
                "SprySOCKS",
                "WinRAR",
                "Winnti",
                "XShellGhost",
                "cobeacon",
                "fscan",
                "lcx",
                "nbtscan"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "8941e146-3e7f-4b4e-9b66-c2da052ee6df",
            "created_at": "2023-01-06T13:46:38.402513Z",
            "updated_at": "2025-03-27T02:00:02.824555Z",
            "deleted_at": null,
            "main_name": "Sandworm",
            "aliases": [
                "G0034",
                "IRIDIUM",
                "Blue Echidna",
                "FROZENBARENTS",
                "Seashell Blizzard",
                "IRON VIKING",
                "ELECTRUM",
                "TeleBots",
                "UAC-0113",
                "UAC-0082",
                "APT44",
                "Quedagh",
                "VOODOO BEAR",
                "TEMP.Noble"
            ],
            "source_name": "MISPGALAXY:Sandworm",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d53593c3-2819-4af3-bf16-0c39edc64920",
            "created_at": "2022-10-27T08:27:13.212301Z",
            "updated_at": "2025-03-27T02:00:55.529662Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Earth Lusca",
                "TAG-22",
                "Charcoal Typhoon",
                "CHROMIUM",
                "ControlX"
            ],
            "source_name": "MITRE:Earth Lusca",
            "tools": [
                "Mimikatz",
                "PowerSploit",
                "Tasklist",
                "certutil",
                "Cobalt Strike",
                "Winnti for Linux",
                "Nltest",
                "NBTscan",
                "ShadowPad"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535719,
    "ts_updated_at": 1743041735,
    "ts_creation_date": 1653697602,
    "ts_modification_date": 1653697602,
    "files": {
        "pdf": "https://archive.orkl.eu/efa0e6e3ad0d7d3b9e2597ece1d709d3f9924063.pdf",
        "text": "https://archive.orkl.eu/efa0e6e3ad0d7d3b9e2597ece1d709d3f9924063.txt",
        "img": "https://archive.orkl.eu/efa0e6e3ad0d7d3b9e2597ece1d709d3f9924063.jpg"
    }
}