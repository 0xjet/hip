{
    "id": "add0c437-518d-489a-969c-00980d69ae42",
    "created_at": "2023-01-12T15:08:21.104096Z",
    "updated_at": "2025-03-27T02:09:18.334943Z",
    "deleted_at": null,
    "sha1_hash": "e2e50cbdfd24ca30691fa1f6e0cb79fa5b4b57d5",
    "title": "2020-12-26 - Spoofing JARM signatures. I am the Cobalt Strike server now!",
    "authors": "",
    "file_creation_date": "2022-05-28T02:07:47Z",
    "file_modification_date": "2022-05-28T02:07:47Z",
    "file_size": 78162,
    "plain_text": "# Spoofing JARM signatures. I am the Cobalt Strike server now!\n\n**[grimminck.medium.com/spoofing-jarm-signatures-i-am-the-cobalt-strike-server-now-a27bd549fc6b](https://grimminck.medium.com/spoofing-jarm-signatures-i-am-the-cobalt-strike-server-now-a27bd549fc6b)**\n\nStefan Grimminck December 25, 2020\n\nSte\nfan\n\n\n[Stefan Grimminck](https://grimminck.medium.com/?source=post_page-----a27bd549fc6b--------------------------------)\n\nDec 25, 2020\n\n\n3 min read\n\n**TL;DR: JARM is very useful fingerprinting tool, but can be deceived by replaying server hello’s**\nfrom other services.\n\n\n-----\n\n[The JARM scanner created by @SalesforceEng is quite an effective tool for system](https://medium.com/u/41ea9b1cdc2b?source=post_page-----a27bd549fc6b--------------------------------)\n[fingerprinting. It uses the Server Hello responses from a TLS handshake to generate a](https://www.cloudflare.com/learning/ssl/what-happens-in-a-tls-handshake/)\nsignature. These can then be used to find similar software or services. Ideal for finding C2 or\n[other malicious servers that implement TLS. So, It doesn’t come as a surprise that Shodan.io](https://www.shodan.io/)\n[uses this fingerprinting mechanism in their scanners. Read the Salesforce post for more](https://engineering.salesforce.com/easily-identify-malicious-servers-on-the-internet-with-jarm-e095edac525a)\ninformation about the JARM library, scanner and its uses.\n\nThe question, then, arises: Is it possible to spoof these JARM signatures? Let’s find out!\n[Salesforce stated in their post that scanning a Cobalt Strike server would result in the following](https://engineering.salesforce.com/easily-identify-malicious-servers-on-the-internet-with-jarm-e095edac525a?gi=64f20df2d111)\nsignature `07d14d16d21d21d07c42d41d00041d24a458a375eef0c576d23a7bab9a9fb1`\n\n\n-----\n\n[That this signature isn t Cobalt Strike specific, was revealed in the Cobalt Strike blog. Let s still](https://blog.cobaltstrike.com/2020/12/08/a-red-teamer-plays-with-jarm/amp/)\nuse it as a starting point anyway.\n\nFirst I used the list of addresses published by Salesforce to find a server with a matching hash.\n[I scanned it using jarmscan and created a packet capture of the response. The ssl handshake](https://github.com/RumbleDiscovery/jarm-go)\n(filter: `ssl.handshake.type == 1 ) filter in Wireshark will display all TLS client hello’s sent by`\nthe scanner.\n\nWireshark capture of 10 TLS Client Hello’s\nAnd in turn the “Cobalt Strike“ server will return its Server Hello’s. These are used by jarmscan\nto generate a unique signature (filter: `ssl.handshake.type == 2 ).`\n\n\n-----\n\nWireshark capture of 10 TLS Server Hello’s\nThese Server Hello’s are the packets we want to replay. This can easily be done by setting up a\nTCP server listening for the specific Client Hello’s, then replaying their corresponding Server\nHello’s captured from the alleged Cobalt Strike server. A rather lazy, but effective approach.\n\nI scanned the server on three separate occasions and found the duplicate bytes for every\nrequest. I used these bytes to identify each specific Client Hello.\n\nLuckily Wireshark has an option to display packets as C Arrays. This made it pretty easy to get\nthe Server Hello’s working in my Golang spoofing application.\n\n\n-----\n\nBy replaying these responses, slowly but steadily the fingerprint can be rebuilt.\n```\nif bytes.Contains(request, [] byte {   0x00, 0x8c, 0x1a, 0x1a, 0x00, 0x16, 0x00, 0x33,\n0x00,   0x67, 0xc0, 0x9e, 0xc0, 0xa2, 0x00, 0x9e, 0x00, 0x39,   0x00, 0x6b, 0xc0,\n0x9f, 0xc0, 0xa3, 0x00, 0x9f, 0x00,   0x45, 0x00, 0xbe, 0x00, 0x88, 0x00, 0xc4, 0x00,\n0x9a,   ... ... }) {   fmt.Println(\"replaying: tls12Forward\")   conn.Write([]\nbyte {     0x16, 0x03, 0x03, 0x00, 0x5a, 0x02, 0x00, 0x00,     0x56, 0x03, 0x03,\n0x17, 0xa6, 0xa3, 0x84, 0x80,     0x0b, 0xda, 0xbb, 0x3d, 0xe9, 0x3e, 0x92, 0x65,  \n0x9a, 0x68, 0x7d, 0x70, 0xda, 0x00, 0xe9, 0x7c,     ... ...   }) }\n\n```\nA full signature can be faked after implementing a reply for all ten different requests.\n\n\n-----\n\n## (Mis)usage of spoofed signatures\n\nYou’re probably thinking: So what? What is the use of spoofed TLS fingerprints? They could be\nused by malicious actors to hide their applications when tools like JARM scanners are deployed\nto identify services in a network or on the internet. It can also be used for good. A honeypot\nreplaying the fingerprint of a specific service can be used to setup a digital smokescreen for\nattackers.\n\n**Notes**\n\n\n-----\n\njarmscan (jarm-go) is not a product of Salesforce. They ve published a Python based\nJARM scanner implementation. Jarmscan (the scanner used here) is a Golang based\nimplementation by\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-12-26 - Spoofing JARM signatures. I am the Cobalt Strike server now!.pdf"
    ],
    "report_names": [
        "2020-12-26 - Spoofing JARM signatures. I am the Cobalt Strike server now!.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536101,
    "ts_updated_at": 1743041358,
    "ts_creation_date": 1653703667,
    "ts_modification_date": 1653703667,
    "files": {
        "pdf": "https://archive.orkl.eu/e2e50cbdfd24ca30691fa1f6e0cb79fa5b4b57d5.pdf",
        "text": "https://archive.orkl.eu/e2e50cbdfd24ca30691fa1f6e0cb79fa5b4b57d5.txt",
        "img": "https://archive.orkl.eu/e2e50cbdfd24ca30691fa1f6e0cb79fa5b4b57d5.jpg"
    }
}