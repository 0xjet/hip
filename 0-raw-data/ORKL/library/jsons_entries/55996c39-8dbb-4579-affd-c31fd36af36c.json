{
    "id": "55996c39-8dbb-4579-affd-c31fd36af36c",
    "created_at": "2023-01-12T15:10:17.00061Z",
    "updated_at": "2025-03-27T02:08:00.238691Z",
    "deleted_at": null,
    "sha1_hash": "8a23c715cc561a139f7509c1a8e19f38723b17b6",
    "title": "2019-05-09 - New KPOT v2.0 stealer brings zero persistence and in-memory features to silently steal credentials",
    "authors": "",
    "file_creation_date": "2022-05-28T19:11:06Z",
    "file_modification_date": "2022-05-28T19:11:06Z",
    "file_size": 1330017,
    "plain_text": "# New KPOT v2.0 stealer brings zero persistence and in-memory features to silently steal credentials\n\n**[proofpoint.com/us/threat-insight/post/new-kpot-v20-stealer-brings-zero-persistence-and-memory-features-silently-steal](https://www.proofpoint.com/us/threat-insight/post/new-kpot-v20-stealer-brings-zero-persistence-and-memory-features-silently-steal)**\n\nMay 9, 2019\n\n\n-----\n\n[Blog](https://www.proofpoint.com/us/blog)\n[Threat Insight](https://www.proofpoint.com/us/blog/threat-insight)\nNew KPOT v2.0 stealer brings zero persistence and in-memory features to silently steal credentials\n\nMay 09, 2019 Dennis Schwarz and the Proofpoint Threat Insight Team\n\n\n-----\n\n**O e** **e**\n\nKPOT Stealer is a “stealer” malware that focuses on exfiltrating account information and other data from web browsers, instant messengers,\nemail, VPN, RDP, FTP, cryptocurrency, and gaming software.\n\nProofpoint researchers started seeing KPOT Stealer distributed via email campaigns and exploit kits in August 2018 (Figure 1). In addition,\ncolleagues at Flashpoint Intel observed the malware targeting users of the Jaxx cryptocurrency wallet in September 2018 [8].\n\n_Figure 1: Exploit kit campaigns distributing KPOT Stealer, November 2018 to May 2019_\n\nRecently, actors began delivering a newer version of the malware; this post analyzes one of those campaigns along with the malware itself.\nThis newer version is commercially available as “KPOT v2.0” on various underground hacking forums for around $100 USD (Figure 2).\n\n_Figure 2: Portion of a Russian forum advertisement describing changes in KPOT v2.0 and its price (Google translation)_\n\n**Campaign Analysis**\n\nKPOT has been observed in a variety of email campaigns. For example, the following message shared tactics, techniques, and procedures\n(TTPs) with campaigns delivering another malware family, Agent Tesla, from similar documents and the same payload domain.\n\n\n-----\n\n_Figure 3: Email message for the KPOT campaign_\n\n**From: Fernandes <webmaster@henrynet.ca>**\n\n**Subject: Due payment-Bank transfer**\n\n**Date: Tue, 30 Apr 2019**\n\n**Attachment: \"Bank transfer copy.doc\"**\n\n\n-----\n\n_Figure 4: RTF document attachment containing the CVE-2017-11882 exploit (aka Equation Editor)_\n\nIn this example, the attachment was an LCG Kit [6] variant RTF document which uses Equation Editor exploit CVE-2017-11882 to download an\nintermediate downloader via a bit.ly link:\n\nhxxps://bit[.]ly/2GK79A4 -> hxxp://internetowe[.]center/get/udeme.png\n\nThe downloader, in turn, fetches parts of a PowerShell script that includes the Base64-encoded payload from the various paste.ee links:\n```\nhxxps://paste[.]ee/r/BZVbl (PowerShell script segment including an accompanying binary used for reflective DLL injection)\nhxxps://paste[.]ee/r/mbQ6R (base64-encoded payload)\nhxxps://paste[.]ee/r/OsQra (tail of the PowerShell script)\n\n```\nThe payload is KPOT Stealer with configuration:\n```\nC2: hxxp://5.188.60[.]131/a6Y5Qy3cF1sOmOKQ/gate.php\nXOR key: Adx1zBXByhrzmq1e\n\n```\n**Malware Analysis**\n\nKPOT Stealer is a “stealer” malware written in C/C++ that focuses on stealing account information and other data from various software\napplications and services. Its name is based on the command and control (C&C) panel used in earlier versions of the malware (Figure 5):\n\n\n-----\n\n_Figure 5: Old KPOT C&C panel login_\n\nA screenshot of the C&C panel login for the newer version analyzed in this post is available in Figure 6. As can been seen, the self-identifying\nmark has been removed.\n\n_Figure 6: New C&C panel login_\n\n**Strings**\n\nMost of the malware’s important strings are encrypted. Each encrypted string is stored in an array of 8-byte structures where each structure\ncontains:\n\nXOR key (WORD)\nString length (WORD)\nPointer to encrypted string (DWORD)\n\nEach encrypted string can be decrypted by XORing it with its XOR key. [1] is an IDA Python snippet that can be used to decrypt the strings in\nthe analyzed sample and [2] contains a list of the decrypted strings.\n\n**Windows API Calls**\n\nKPOT Stealer resolves most of the Windows API functions it uses at runtime by hash. The hashing algorithm used is known as MurmurHash\n\n[3] and it is seeded with 0x5BCFB733 in the analyzed sample. The following table contains a list of some of the hashes used and their\ncorresponding Windows API name:\n\n\n-----\n\n0xEC595E53 GetModuleFileNameW\n\n0x68CCF342 CreateStreamOnHGlobal\n\n0xCF724FBB GetVolumeInformationW\n\n0xB6B1AD4A InternetOpenW\n\n0x6EAB51D socket\n\n**Command and Control**\n\nKPOT uses HTTP for command and control. The URL components are stored as encrypted strings. In the analyzed sample the URL was\n“hxxp://bendes[.]co[.]uk/lmpUNlwDfoybeulu/gate.php”. The malware also has support for .bit C&C domains which are becoming more\nprevalent.\n\nTwo types of requests are sent to the C&C server. The first request is a GET request (Figure 7):\n\n_Figure 7: GET request to C&C server_\n\nThe response from the C&C is base64 encoded and XOR’d with a hardcoded key that is stored as an encrypted string. In the analyzed\nsample, the key was “4p81GSwBwRrAhCYK”. An example of the plaintext response looks like:\n\n1111111111111100__DELIMM__A.B.C.D__DELIMM__appdata__GRABBER__*.log,*.txt,__GRABBER__%appdata%__GRABBER__0__GRABBER\n\nThe data is delimited by “__DELIMM__” and can be split into the following types of data:\n\n1. A bit string indicating what commands to run\n\n2. The external IP address of the victim\n\n3. “GRABBER rules” specifying what files to search for and exfiltrate\n\nBefore any commands are run, the malware checks to see if the victim is located in any of the Commonwealth of Independent States (CIS) [5].\nIf it is, the malware exits without further action. The specific languages it checks for can be seen in Figure 8:\n\n\n-----\n\n_Figure 8: Commonwealth of Independent States (CIS) country check_\n\nThis type of country check is common because threat actors have used the avoidance of CIS countries as a successful legal defense [7].\n\nAfter the commands are run, a POST request is sent to the C&C (Figure 9):\n\n_Figure 9: POST request to C&C server_\n\nThe POST data is XOR encrypted with the hardcoded XOR key used in the GET response above and once decrypted contains various data\norganized into sections. Each section has a start delimiter like “FFFILEE:” or “SYSINFORMATION:” and an end delimiter like “_FFFILEE_” or\n“_SYSINFORMATION_”. Sections include:\n\n\n-----\n\n6 byte st uctu e co ta g\nIs process token elevated\nProcess integrity level\nWindows version\nLocale\nBot ID\nAdditional system information including:\n\nWindows version\nMachine GUID\nExternal IP\nCPU\nRAM\nScreen\nComputer name\nUser name\nLocal time\nGPU\nKeyboard layouts\nInstalled software\nCommand outputs\nExfiltrated files\n\n**Commands and Functionality**\n\nThe first component of the GET response above is a 16 digit bit string, e.g. “1111111111111100”. Each “1” turns on some command functionality\nwhile each “0” turns it off. Conveniently the C&C panel provides an accessible config file that provides a mapping between the bit string and\nthe command names (Figure 10). This feature was also highlighted in an earlier version by a security researcher on Twitter [4].\n\n_Figure 10: Command bit string to command name mapping_\n\nThe commands provide the following functionality:\n\nSteal cookies, passwords, and autofill data from Chrome\nSteal cookies, passwords, and autofill data from Firefox\nSteal cookies from Internet Explorer\nSteal various cryptocurrency files\nSteal Skype accounts\nSteal Telegram accounts\nSteal Discord accounts\nSteal Battle.net accounts\nSteal Internet Explorer passwords\nSteal Steam accounts\nTake a screenshot\nSteal various FTP client accounts\n\n\n-----\n\nStea a ous do s c ede t a s\nSteal various Jabber client accounts\nRemove self\nWasn't able to find code referencing the last command bit\n\nAlthough there aren’t specific command bits controlling the functionality, the malware also looks for and attempts to steal user accounts from\nvarious VPN providers, RDP configuration files, and Microsoft Outlook accounts.\n\nKPOT Stealer also has the ability to search for and exfiltrate arbitrary files. “Rules” specifying what files to search for can be delivered in the\nabove GET response. Each rule has five components delimited by \"__GRABBER__\". The components include:\n\n1. Rule name\n2. File mask (comma separated)\n3. Search path\n4. Minimum file size\n5. Maximum file size\n\nAn example rule split up into its components looks like:\n\n['appdata', '*.log,*.txt,', '%appdata%', '0', '1024']\n\nThis rule is called “appdata” and looks for any “.log” or “.txt” files in “%APPDATA” that are between 0 and 1024 bytes.\n\nThe analyzed sample lacks a persistence mechanism. The malware queries its C&C server for the commands it should execute, executes the\ncommands, delivers the results to the C&C, and then exits. This has been seen in other stealer malware such as Pony since it lowers their\nchance of being detected.\n\n**Conclusion**\n\nClient desktop operating systems running many types of applications, such as web browsers, instant messengers, email, VPN, RDP, FTP,\ncryptocurrency, and gaming software are increasingly being targeted for credential and other data theft by relatively quiet off-the-shelf malware\nsuch as KPOT Stealer through email campaigns (and more infrequently, exploit kits). The commercial nature of these tools means that\nsophisticated capabilities are accessible to even technically unskilled criminals and highlight the ease with which threat actors can get started\nand change tools and tactics. We advise our customers to remain vigilant in terms of securing their client systems with the latest vendor\npatches, platform updates, and improving general awareness of social engineering techniques within their respective user populations.\n\n**References**\n\n[1] [https://github.com/EmergingThreats/threatresearch/blob/master/kpot_stealer/decrypt_str.py](https://github.com/EmergingThreats/threatresearch/blob/master/kpot_stealer/decrypt_str.py)\n\n[2] [https://github.com/EmergingThreats/threatresearch/blob/master/kpot_stealer/plaintext_strings.txt](https://github.com/EmergingThreats/threatresearch/blob/master/kpot_stealer/plaintext_strings.txt)\n\n[3] [https://en.wikipedia.org/wiki/MurmurHash](https://en.wikipedia.org/wiki/MurmurHash)\n\n[4] [https://twitter.com/sysopfb/status/1035177455667957760](https://twitter.com/sysopfb/status/1035177455667957760)\n\n[5] [https://en.wikipedia.org/wiki/Commonwealth_of_Independent_States](https://en.wikipedia.org/wiki/Commonwealth_of_Independent_States)\n\n[6] [https://www.proofpoint.com/us/threat-insight/post/lcg-kit-sophisticated-builder-malicious-microsoft-office-documents](https://www.proofpoint.com/us/threat-insight/post/lcg-kit-sophisticated-builder-malicious-microsoft-office-documents)\n\n[7] [https://www.recordedfuture.com/ar3s-prison-release/](https://www.recordedfuture.com/ar3s-prison-release/)\n\n[8] [https://www.flashpoint-intel.com/blog/malware-campaign-targets-jaxx-cryptocurrency-wallet-users/](https://www.flashpoint-intel.com/blog/malware-campaign-targets-jaxx-cryptocurrency-wallet-users/)\n\n**Indicators of Compromise**\n\n67f8302a2fd28d15f62d6d20d748bfe350334e5353cbdef112bd1f8231b5599d SHA256 KPOT Stealer (Malware Analysis)\n\n1f2852eeb1008b60d798f0cbcf09751e26e7980b435635bbef568402b3f82504 SHA256 KPOT Stealer (Campaign Analysis)\n\n36dcd40aee6a42b8733ec3390501502824f570a23640c2c78a788805164f77ce SHA256 Intermediate downloader (Campaign Analysis)\n\nhxxp://bendes.co[.uk/lmpUNlwDfoybeulu/gate.php URL KPOT Stealer C&C URL (Malware Analysis)\n\nhxxp://5.188.60[.]131/a6Y5Qy3cF1sOmOKQ/gate.php URL KPOT Stealer C&C URL (Campaign Analysis)\n\nSubscribe to the Proofpoint Blog\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-05-09 - New KPOT v2.0 stealer brings zero persistence and in-memory features to silently steal credentials.pdf"
    ],
    "report_names": [
        "2019-05-09 - New KPOT v2.0 stealer brings zero persistence and in-memory features to silently steal credentials.pdf"
    ],
    "threat_actors": [
        {
            "id": "b740943a-da51-4133-855b-df29822531ea",
            "created_at": "2022-10-25T15:50:23.604126Z",
            "updated_at": "2025-03-27T02:00:55.505366Z",
            "deleted_at": null,
            "main_name": "Equation",
            "aliases": [
                "Equation"
            ],
            "source_name": "MITRE:Equation",
            "tools": null,
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673536217,
    "ts_updated_at": 1743041280,
    "ts_creation_date": 1653765066,
    "ts_modification_date": 1653765066,
    "files": {
        "pdf": "https://archive.orkl.eu/8a23c715cc561a139f7509c1a8e19f38723b17b6.pdf",
        "text": "https://archive.orkl.eu/8a23c715cc561a139f7509c1a8e19f38723b17b6.txt",
        "img": "https://archive.orkl.eu/8a23c715cc561a139f7509c1a8e19f38723b17b6.jpg"
    }
}