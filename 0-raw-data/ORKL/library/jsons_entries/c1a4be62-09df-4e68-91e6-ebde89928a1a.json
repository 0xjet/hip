{
    "id": "c1a4be62-09df-4e68-91e6-ebde89928a1a",
    "created_at": "2022-10-25T16:48:14.46777Z",
    "updated_at": "2025-03-27T02:16:20.777168Z",
    "deleted_at": null,
    "sha1_hash": "44ea6ae12ca986a5d64d3207c7aa4fb3cf33559f",
    "title": "",
    "authors": "",
    "file_creation_date": "2019-05-01T19:37:37Z",
    "file_modification_date": "2019-05-01T19:37:41Z",
    "file_size": 2124803,
    "plain_text": "###### Matthieu Faou\n\n# TURLA LIGHTNEURON\n## One email away from remote code execution\n\n\n-----\n\n#### TABLE OF CONTENTS\n\n1. Executive summary  .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   4\n\n2. Attacker profile .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   . 5\n\n2.1 Publicized high-profile attacks  .  .  .  .  .  .  .  .  .  . 5\n\n2.2 Victimology  .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .  5\n\n2.3 Tools and tactics .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 5\n\n3. Overview .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  6\n\n3.1 Impact .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .  6\n\n3.2 Chronology .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   6\n\n3.3 Targeting .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .  7\n\n3.4 Attribution to Turla .  .  .  .  .  .  .  .  .  .  .  .  .  . 7\n\n3.5 Insight into attackers activity .   .   .   .   .   .   .   .   .   .  8\n\n4. Malware  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  9\n\n4.1 Microsoft Exchange architecture  .   .   .   .   .   .   .   .   .  9\n\n4.2 Malicious Transport Agent .   .   .   .   .   .   .   .   .   .   .  11\n\n4.3 Companion Dynamic Link Library  .  .  .  .  .  .  .  .  14\n\n4.4 Evolution  .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   . 28\n\n4.5 Linux variant  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  28\n\n5. Remediation  .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   28\n\n5.1 Cleaning  .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .  28\n\n5.2 Mitigations  .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   . 30\n\n6. Conclusion  .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .  30\n\n7. Bibliography .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 31\n\n8. IoCs .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 32\n\n8.1 Hashes .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   . 32\n\n8.2 Paths  .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .  33\n\n9. MITRE ATT&CK techniques  .   .   .   .   .   .   .   .   .   .   .   .  33\n\n#### LIST OF TABLES\n\nTable 1 _Description of the handlers implemented in the DLL  .   .   .   . 18_\n\nTable 2 _Handler return codes and their descriptions .   .   .   .   .   .   . 19_\n\nTable 2 _List of instruction codes .   .   .   .   .   .   .   .   .   .   .   .   .  24_\n\nTable 3 _Description of the log files .   .   .   .   .   .   .   .   .   .   .   .  26_\n\n\n-----\n\n#### LIST OF FIGURES\n\nFigure 1 _Timeline of important attacks attributed to Turla .   .   .   .   . 5_\n\nFigure 2 _LightNeuron timeline  .   .   .   .   .   .   .   .   .   .   .   .   .   . 6_\n\nFigure 3 _Map of known LightNeuron victims  .   .   .   .   .   .   .   .   .  7_\n\nFigure 4 _Operators working hours .   .   .   .   .   .   .   .   .   .   .   .   . 8_\n\nFigure 5 _Distribution of the backdoor commands used by the operators 9_\n\nFigure 6 _Microsoft Exchange architecture  .   .   .   .   .   .   .   .   .   . 10_\n\nFigure 7 _Classes implemented by the Transport Agent .   .   .   .   .   .  11_\n\nFigure 8 _PowerShell script to install the malicious Transport Agent  .   . 11_\n\nFigure 9 _SmtpReceiveAgent implementation  .   .   .   .   .   .   .   .   .  12_\n\nFigure 10 `Process function .   .   .   .   .   .   .   .   .   .   .   .   .   .   . 13`\n\nFigure 11 LightNeuron Transport Agent .   .   .   .   .   .   .   .   .   .   .  14\n\nFigure 12 Some decrypted strings .   .   .   .   .   .   .   .   .   .   .   .   .  15\n\nFigure 13 Partially redacted, decrypted configuration example  .   .   .   . 16\n\nFigure 14 Redacted example of a rule file .   .   .   .   .   .   .   .   .   .   . 18\n\nFigure 15 Decompilation output of the zip handler function .   .   .   .   . 19\n\nFigure 16 Original email (on the left) and email after\n\n_the call to changeSubject (on the right) .   .   .   .   .   .   .   .  20_\n\nFigure 17 Attachment type check (HexRays output) .   .   .   .   .   .   .  20\n\nFigure 18 Extraction of the container data\n\n_from the PDF (HexRays output) .   .   .   .   .   .   .   .   .   .   21_\n\nFigure 19 Representation in hexadecimal of a PDF containing a container 21\n\nFigure 20 Modified PDF document with embeded\n\n_commands for LightNeuron. Snake is another name for Turla.  . 21_\n\nFigure 21 Validation of the JPG signature (HexRays output) .   .   .   .   . 22\n\nFigure 22 Modified JPG picture with embedded commands\n\n_for LightNeuron .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   . 23_\n\nFigure 23 Hexadecimal dump of an encrypted container .   .   .   .   .   .  23\n\nFigure 24 Hexadecimal dump of a decrypted container .   .   .   .   .   .   23\n\nFigure 25 Structure of the command container (C-like syntax)  .   .   .   . 24\n\nFigure 26 Example of an email generated by LightNeuron\n\n_to send command output .   .   .   .   .   .   .   .   .   .   .   .   . 25_\n\nFigure 27 Log entry structure in C-like syntax .   .   .   .   .   .   .   .   .  26\n\nFigure 28 Exfiltration loop with night check (HexRays output) .   .   .   . 27\n\nFigure 29 Exfiltration loop (HexRays output) .   .   .   .   .   .   .   .   .   27\n\nFigure 30 Linux strings in the Windows DLL .   .   .   .   .   .   .   .   .   . 28\n\nFigure 31 agents.config example  .   .   .   .   .   .   .   .   .   .   .   .  29\n\n\n-----\n\n#### 1. EXECUTIVE SUMMARY\n\nTurla, also known as Snake, is one of oldest, still-active cyberespionage groups, with more than a decade\nof experience. Its operators mainly focus on high-profile targets such as governments and diplomatic\nentities in Europe, Central Asia and the Middle East. They are known for having breached major organiza­\ntions such as the US Department of Defense in 2008 and the Swiss defense company RUAG in 2014. More\nrecently, several European countries including France and the Czech Republic went public to denounce\nTurla’s attacks against their governments.\n\nTo perform these operations, Turla’s operators own a large arsenal of malware including a rootkit,\nseveral complex backdoors (with a notable one for Microsoft Outlook), and a large range of tools to pivot\non a network.\n\nIn this white paper, we present the analysis of LightNeuron, a backdoor specifically designed to target\nMicrosoft Exchange mail servers.\n\n###### Key points in this white paper:\n\n- Turla is believed to have used LightNeuron since at least 2014.\n\n- LightNeuron is the first publicly known malware to use a malicious Microsoft Exchange Transport Agent.\n\n- LightNeuron can spy on all emails going through the compromised mail server.\n\n- LightNeuron can modify or block any email going through the compromised mail server.\n\n- LightNeuron can execute commands sent by email.\n\n- Commands are hidden in specially crafted PDF or JPG attachments using steganography.\n\n- LightNeuron is hard to detect at the network level because it does not use standard HTTP(S)\n\ncommunications.\n\n- LightNeuron was used in recent attacks against diplomatic organizations in Eastern Europe\n\nand the Middle East.\n\n_For any inquiries, or to make sample submissions related to this white paper, contact us at: threatintel@eset.com._\n\n\n-----\n\n#### 2. ATTACKER PROFILE\n\nTurla, also known as Snake, is an infamous espionage group active for at least a decade. The group\nis well known for its advanced custom tools and its ability to run highly targeted operations.\n\n##### 2.1 Publicized high-profile attacks\n\nOver the past ten years, Turla has been responsible for numerous high-profile breaches. The targets include\nthe United States Central Command in 2008 [1], the Swiss military company RUAG in 2014 [2] and more\nrecently, the French Armed Forces in 2018 [3]. The timeline in Figure 1 presents some of the major attacks\nattributed to Turla.\n\n\n#### 2008\n\nUS Central\nCommand\n\n##### 2.2 Victimology\n\n\n#### 2013\n\nFinnish Foreign\nMinistry\n\n\n#### 2014\n\nRUAG Defense\nCompany\n\n\n#### 2017\n\nGerman Foreign\nOffice\n\n\n#### 2018\n\nFrench Armed\nForces\n\n\nFigure 1 // Timeline of important attacks attributed to Turla\n\n\nAs opposed to some other APT (Advanced Persistent Threat) groups, Turla is far from being opportunistic\nin the selection of its targets. The group is interested in collecting information from strategic people\nor organizations. In addition, to our knowledge, Turla has never conducted cybersabotage operations,\nsuch as those made by GreyEnergy [4] or TeleBots [5].\n\nWith several years of tracking this espionage group, we have identified the most at-risk types\nof organizations:\n\n- Ministries of Foreign Affairs and diplomatic representations (embassies, consulates, etc.)\n\n- Military organizations\n\n- Regional political organizations\n\n- Defense contractors\n\nMost parts of the world are targeted by Turla’s operations, with the exception, perhaps, of Eastern Asia.\nMoreover, over the past few years, we have noticed that geographical areas of conflict, such as Eastern\nEurope and the Middle East, are under heavy attacks from this APT group. However, even with this new\nfocus, they did not abandon their traditional targets in Western Europe and Central Asia.\n\n##### 2.3 Tools and tactics\n\nThe usual modus operandi used by Turla’s operators is to use basic first-stage malware for initial recon­\nnaissance. In some cases they even use generic tools such as Metasploit [6] [7]. Once they deem the victim\ninteresting enough, they switch to more advanced malware such as Carbon [8] or Gazer [9].\n\nThe initial compromise is generally tailored towards specific types of victims. In the past, they mainly relied\non spearphishing emails [10], watering hole attacks [11] or Man-in-the-Middle attacks [12].\n\nAfter this initial compromising step, they move laterally on the network and collect many credentials.\nTo avoid suspicious communications to the internet, they developed tools such as DarkNeuron [13] and\nRPCBackdoor, to forward commands and exfiltrate data on the local network. They also regularly create\nuser accounts that they use later if they lose access to a compromised machine. It means that once compro­\nmised, it is very hard to eject the attacker from the network without rebuilding most of it.\n\nFinally, collected data is exfiltrated through various channels such as HTTP and emails. They usually rely on\ncompromised web servers as first stage servers. They are also known for using SATCOM IP addresses to hide\nthe real destination of the traffic [14].\n\n\n-----\n\nTurla’s operators have a wide arsenal at their disposal for all major desktop platforms: Windows, macOS\nand Linux. Some of their tools stand out for their complexity, such as the Snake rootkit, which relies on\na vulnerable VirtualBox driver to bypass Windows Driver Signature Enforcement [15]. Some others stand\nout by their originality, such as the Outlook backdoor we analyzed in 2018 [16].\n\nDuring our several years of tracking Turla activities, we also noticed that they were reacting quickly to both\npublication and detection. Apparently, they do not hesitate to clean all the traces and potentially lose\ncontrol of a machine if they feel they will be detected soon. They probably do not want their more-advanced\nmalware to be exposed publicly.\n\n#### 3. OVERVIEW\n\nLightNeuron is a piece of malware specifically designed to target Microsoft Exchange servers. It has two\nfacets: spying on emails and acting as a full-feature backdoor.\n\n##### 3.1 Impact\n\nWhile rootkits and bootkits have an unmatched stealthiness in the malware domain, LightNeuron is uncom­\nmonly stealthy for “regular” malware. To our knowledge, leveraging a Microsoft Exchange Transport Agent\nfor persistence is something unique and never before seen. Moreover, in the few cases we studied, Light­\nNeuron was running with SYSTEM privileges. It is typically hard to gain this level of privilege on a Microsoft\nExchange server, as it is one of the most critical assets in an organization. Thus, once compromised, it is likely\nthat it will stay undetected for months or years.\n\nThe Command and Control protocol is fully based on emails and uses steganography to store data in PDF\nand JPG attachments. Given that, in the Microsoft Exchange architecture, the malware is installed at the\nsame level as anti-spam and other email security solutions, it allows the malware to bypass them easily.\nUsing a nearly undetectable Command and Control channel allows the malware to stay under the radar\nfor a long period.\n\nDuring the course of our investigation, we noticed alongside LightNeuron the presence of several tools used\nto control other machines on the local network. These tools include Remote Administration Software, RPCbased malware or .NET web shells targeting Outlook Web Access. By leveraging them, attackers are able to\ncontrol other machines on the local network using emails sent to the Exchange server. This strategy allows\navoiding typical, noisy methods such as an HTTP-based C&C protocol or connection via RDP from outside\nthe compromised network.\n\n##### 3.2 Chronology\n\nWe believe that LightNeuron development started before 2014 as the versions compiled in 2014, according\nto the compilation timestamp, appear to be in a late development state. Even if the development occurred\nseveral years ago, LightNeuron is still used in recent compromises. Figure 2 is a timeline of some important\nevents related to LightNeuron.\n\n\n### 2014\nJune\n\nOldest compilation\ntimestamp\n\n\n### 2016\nOctober\n\nMost recent\ncompilation\ntimestamp\n\n\n### 2017\nMay\n\nCompromise\nof an organization\nin the Middle East\n\n\n### 2018\nOctober\n\nCompromise\nof an organization\nin Eastern in Europe\n\n\nFigure 2 // LightNeuron timeline\n\n\n-----\n\n##### 3.3 Targeting\n\nThese targets are in line with traditional Turla targets. Figure 3 shows the geographical location of the\nidentified targets. The Eastern European and Middle East targets are diplomatic organizations. Regarding\nthe Brazilian target, the sample was uploaded to VirusTotal. Thus, we cannot know the exact nature\nof the victim or even be sure that the victim was based in Brazil.\n\n\nBrazil\nUnknown organization\n\n\nEastern Europe\nMinistry of Foreign Affairs\n\n\nMiddle East\nRegional Diplomatic\norganization\n\n\nFigure 3 // Map of known LightNeuron victims\n\n##### 3.4 Attribution to Turla\n\nWe believe with high confidence that Turla operates LightNeuron. The following artefacts we collected\nduring our investigation back this:\n\n- On one compromised Exchange server:\n\n  - A PowerShell script containing malware previously attributed to Turla was dropped 44 minutes before\n\na PowerShell script used to install LightNeuron.\n\n  - Both scripts were located in C:\\windows\\system32.\n\n- The script used to install LightNeuron has a filename msinp.ps1 that looks like typical filenames\n\nused by Turla.\n\n- On another compromised server, we saw a sample of the IntelliAdmin Remote Administration Tool,\n\npacked with a packer used only by Turla, being dropped by LightNeuron.\n\n- For each LightNeuron attack, we found several other instances of Turla malware on the same network.\n\n- The email address used by the attackers was registered at GMX and was impersonating an employee\n\nof the targeted organization. This same provider was used for the Outlook backdoor [16] and for\na previously undocumented PowerShell backdoor we have dubbed PowerStallion.\n\n- Kaspersky Labs researchers attribute LightNeuron, with medium confidence, to Turla [17].\n\n\n-----\n\n##### 3.5 Insight into attackers activity\n\nWhile analyzing a compromised asset, we were able to retrace part of the attackers’ activities. In particular,\nwe were able to map the working hours of the operators, using the time at which the compromised Exchange\nserver received emails containing commands for the backdoor.\n\nOur first observation is that the activity matches well a typical 9-to-5 workday in the UTC+3 time zone,\nas shown in Figure 4.\n\n**Number**\n**of email received**\n\n30\n\nUTC timezone UTC +3 timezone\n\n20\n\n10\n\n\n0\n\n\n**Hour**\n\n|Col1|Col2|Col3|Col4|Col5|H|our|Col8|Col9|Col10|Col11|Col12|\n|---|---|---|---|---|---|---|---|---|---|---|---|\n\n\n0 2 4 6 8 10 12 14 16 18 20\n\nFigure 4 // Operators working hours\n\nOur second observation is that no activity was observed between December 28, 2018 and January 14, 2019,\nwhile previously and afterwards, the attackers sent several emails per week. This break in activities corresponds\nto holidays around the Orthodox Christmas.\n\nEven if it is not sufficient for a strong attribution, one might correlate these two observations with other\nartefacts used for attribution.\n\nWe also compiled the type of commands used by the attackers, as shown in Figure 5. Even if we were\nnot able to retrieve the command arguments, it is already a good insight into the operators’ goals.\n\nIt turns out that LightNeuron is used mostly to exfiltrate data. The remaining activity is most likely dropping\nand executing tools to perform lateral movements across the local network.\n\n\n-----\n\nExfiltrate a file Execute\na command line\n\nDrop a file\nand execute it\n\nFigure 5 // Distribution of the backdoor commands used by the operators\n\n#### 4. MALWARE\n\nTwo main components comprise LightNeuron: a Transport Agent [18], registered in the Microsoft Exchange\nconfiguration, and a companion 64-bit Dynamic Link Library (DLL) containing most of the malicious code.\n\n##### 4.1 Microsoft Exchange architecture\n\nMicrosoft Exchange allows extending its functionalities using Transport Agents that can process and modify\nall email messages going through the mail server [18]. Transport Agents can be created by Microsoft,\nthird-party vendors, or directly within an organization.\n\nThey have many legitimate purposes, such as:\n\n- Filtering spam\n\n- Filtering malicious emails/attachments\n\n- Adding a corporate signature at the end of every email\n\nThe typical events handled by a Transport Agent occur when the mail server sends or receives an email.\nBefore the event is actually executed, the Transport Agents are called and have the possibility to modify\nor block the email.\n\nFigure 6 shows the typical workflow in a Microsoft Exchange server. It also shows where the malicious\nTransport Agents are inserted in this flow.\n\n\n-----\n\nClient\nAccess\nServer\n\nMailbox\nServer\n\n\n_SMTP from the_\n_Transport service_\n_or the Mailbox_\n_Transport service_\n_on other Mailbox_\n_Servers_\n\n**TO**\n\n_SMTP to the_\n_Transport service_\n_on other Mailbox_\n_Servers_\n\n\n_SMTP to the_\n\nProtocol Agents\n\n_Transport service_\n_or the Mailbox_\n\nHub Selector _Transport service_\n\n_on other Mailbox_\n_Servers_\n\nTransport Service\n\n**Categorizer**\n\nRouting Agents\n\n**SMTP**\n\nLightNeuron SMTP Send\nRouting Agent\n\nSubmission Delivery\nQueue Queue\n\nPickup & Replay\ndirectories\n\n**FROM**\n\nMailbox Transport Service\n_SMTP to the_\n_Transport service_\n\nMailbox transport _on other Mailbox_\nDelivery service _Servers_\n\n|Col1|Col2|\n|---|---|\n\n\nFigure 6 // Microsoft Exchange architecture\n_(original picture: https://docs.microsoft.com/en-us/exchange/mail-flow-exchange-2013-help)_\n\nIn order to register a Transport Agent to a Microsoft Exchange Installation, one could modify the list\nof agents in <ExchangeInstallFolder>\\TransportRoles\\Agents\\agents.config. The PowerShell\nfunction Install-TransportAgent is another way to register a new Transport Agent.\n\n\n-----\n\n##### 4.2 Malicious Transport Agent\n\nThis component is responsible for communicating with Microsoft Exchange and with the main malicious DLL.\nTo our knowledge, this is the first time a Transport Agent has been used for malicious purposes.\n\n###### Identification\n\nThe malicious Transport Agent is a 32-bit Windows DLL developed in .NET. Our analysis is based on the sample\nwith SHA-1 3C851E239FBF67A03E0DAE8F63EEE702B330DB6C, apparently compiled on 26/10/2016.\n\nIn Figure 7, you can see the seven different classes used by the malicious Transport Agent.\n```\nCommon_utl is the class used to process the email and call the second DLL. ContentFilterAgent\n\n```\nand SecurityInteropAgent are, respectively, inheriting from the standard base classes RoutingAgent\nand SmtpReceiveAgent.\n\nFigure 7 // Classes implemented by the Transport Agent\n\n###### Installation\n\nThe attackers drop this executable in the Exchange folder located in the Program Files folder. This first step\nrequires Administrative privileges. Then, they execute the script in Figure 8 to register the DLL as a Transport\nAgent. This second step is required before the malware starts receiving events from Exchange.\n\nFigure 8 // PowerShell script to install the malicious Transport Agent\n\n\n-----\n\n###### Functions\n\nThis Transport Agent implements two classes: SmtpReceiveAgent and RoutingAgent. These classes\ninherit from standard Microsoft Exchange classes, allowing them to receive events from the mail server.\nFigure 9 shows a part of the class implementing SmtpReceiveAgent.\n\nFigure 9 // SmtpReceiveAgent implementation\n\nOne of the events registered is EndofData, which the server calls once it has received the entire email.\nThis event’s callback then calls the Process function. The behavior is the same for all the callbacks.\n\nThe class common_utl contains the Process function. As shown in Figure 10, it first logs the date and the\nsender of the email. Then, it calls the CheckMessage function that then calls the companion DLL to process\nemail data.\n\nFinally, depending on the return value of CheckMessage, it does nothing, modifies the email, or blocks it.\n\n\n-----\n\nFigure 10 // Process function\n\nFigure 11 summarizes the behavior of the LightNeuron Transport Agent. A detailed explanation\nof the behavior of the companion DLL is available in the Backdoor section.\n\n\n-----\n\nExternal Email\n\n\nInternal Email\n\n\nFigure 11 // LightNeuron Transport Agent\n\n##### 4.3 Companion Dynamic Link Library\n\nThis second component implements most of the malicious functions that are needed\nby the Transport Agent.\n\n###### Identification\n\nThe companion DLL is a 64-bit Windows DLL developed in C. Our analysis is based on the sample\nwith SHA-1 76EE1802A6C920CBEB3A1053A4EC03C71B7E46F8, apparently compiled on 02/09/2016.\n\nThis DLL exports three functions:\n\n- FL (aka ForLoading): return 777\n\n- BLE (aka BinaryLogEx): Log input data in a log file\n\n- SV (aka SimpleValidate): Process an email\n\nThe exports’ full names were present in the oldest versions of the DLL, while in the most recent one,\nthey were shortened.\n\n###### Initialization\n\nWhen the Transport Agent loads the DLL, the DLL’s main function performs various initialization tasks.\n\nFirst, it decrypts, using an XOR operation; most of the strings with the hardcoded key 0xA9. Figure 12 shows\nsome interesting strings once decrypted.\n\n\n-----\n\nFigure 12 // Some decrypted strings\n\nThen, it decrypts the configuration file stored in %tmp%\\winmail.dat. Microsoft Outlook uses the same\nfilename when people send messages from an incorrectly configured mail client [19]. We believe they choose\nthis filename to hide their configuration file in plain sight as a Microsoft Exchange administrator might\nbe accustomed to see many legitimate files named winmail.dat.\n\nThe configuration is encrypted with AES-256, with the first 32 bytes of the file being the RSA-encrypted\nAES key. The 1024-bit RSA private key is hardcoded in the binary and it uses the mode PKCS1-v1_5\nfor encryption.\n\nFigure 13 is an example of a decrypted configuration. Please note that we have redacted\nsome confidential information.\n\n\n-----\n\n```\n<Parameters>\nCONFIG_FILE_NAME:c:\\Windows\\ServiceProfiles\\NetworkService\\appdata\\Local\\Temp\\msmocf.xml\nLOG_LEVEL:17\nDEBUG_LOG_FILE_NAME:c:\\Windows\\ServiceProfiles\\NetworkService\\appdata\\Local\\Temp\\msmodl.\ndat\nCRYPT_KEY: LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUlHZk1BMEdDU3FHU0liM0RRRUJBUVVBQTRH\n\nTkFEQ0JpUUtCZ1FDOG5zc2g2UDJpa29YMnpBOFg3dUpNcmxRWApkM21Pc3VvcWRpa1pzQ1l3TlJCNXc5RVl\n\njeHRQYVdubEc4L2hCeC9IMG05cnZyelFVamxCa3dieDY5L2tSclhVCmZ5MkE3RGk2NTZldlExMHZPVHlBcH\n\nRualMvRWtBKzFUUGRPSTdkZWcrakNpaDFMNk5TNUJFTyszTTN0aGZrVzcKZVU2ZUdkcVZyeWdiOWV6amxRS\n\nURBUUFCCi0tLS0tRU5EIFBVQkxJQyBLRVktLS0tLQo=\nDECRYPT_KEY: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlDWFFJQkFBS0JnUURRTWdoRS\n\n9sUlBpbGNNTXFqb1RSMDBJcU0wWkovalFuT2kwZzFTRXJ1dytaQ0tqUit0CmRZSHo1bUVNTXJmbS9uYnZkV\n\n2hRQUxubERpSlNwOHRpa3VHdHdJajFrV09aQ0ppangvazhHWWdoNHZkZmtCSkcKbmlnQnJTMTliSktqMzh0\n\neElGVWI2NGQwK0hISlczdld1VVJFYUhwZjVFemdmQmdIZ1ZIN2NzaVE1UUlEQVFBQgpBb0dCQUlLMkJzOGF\n\nSbUN4NERqK1RXR2JtS3cwMnZaMy9wSTJGRmV6UFQyOEdTN2hZTWc4RmhsWFgwRjc4STR5CkFaZjdSenpNSD\n\ndPcTRRdFlObUJpaktUVXh1Nm5rYk5MajQxVWhYQks4YUl1S1oxa2lKUG5rY3RVUERWWjN5WmkKS1lKZ3lje\n\nDI0SEozbXF3T05mZTczVElKcEsybDZFRkVDUDJkaTg5aHNZTFhsa2s1QWtFQTcwRGxlMDROMVBIeAozUzBj\n\nWkhFQm9ZNnhyNElvUGJSQmZ2Wkd0NHEyZWs5ZjVldG1idjVvck54WnE4QUpzRkJsOWhBZFIxUE8rdUk5Ckl\n\n0WnVGRzhvM3dKQkFON0VuZWpNQ05Td3FEdlhvSWxBMElFVkd5RlNIcHp1TDFBWW9FSFVhNXZpOFR0VC9KYV\n\nkKN1pSSFNwNUxZeExLZkh6MGovWExBVFo5a2oxVDNkaWpDcnNDUUdlMk1RUC9kTjEvTjhJUndRSUZQcGpDM\n\njJGaQpRWUZsOXhKTFBhSm9mZXVOSnR2cTdBOW5Od2JmeWZzNmxyaVlVV3FWMTZ0SXVDdG5FT3RlR24rL0kr\n\nOENRQnlsCjFGalh4RnIxek96Rk1oUDBqZHZMeHcxbDdpSG9UNVZSVldxaDBxVGRib0Jlc0tEOVViQTc2dEN\n\nvaVRrbGFSVDQKcm5yQmZJcHhZNWtYYS9Rc0kza0NRUUMzeS9wVUdRK0J1MDhJczBmcTBSQmNmaG5zYXREen\n\ndjWjRZS0cwc0NXVgpxeXNjdTZBd3hvaGdjZEN2UGJiNDJYcnZIamFmbTZYYk05aXFnU0lqc0JuRgotLS0tL\n\nUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=\nLOG_OUTPUT:c:\\Windows\\ServiceProfiles\\NetworkService\\appdata\\Local\\Temp\\\nMIN_SIZE_TO_ZIP:20000\nZIP_FILE_NAME:c:\\Windows\\ServiceProfiles\\NetworkService\\appdata\\Local\\Temp\\tmpE4BC\nCONFIG_UPDATE_INTERVAL:1800\nDEBUG_LOG_CRYPT:0\nSTAT_INTERVAL:5\nSTAT_PATH:c:\\Windows\\ServiceProfiles\\NetworkService\\appdata\\Local\\Temp\\tmpD48BC\nSEND_FROM:[redacted]noreply@[redacted]\nCOMMAND_REPLY_SUBJECT: Email_confirmation\nCOMMAND_REPLY_ATTACH_NAME: Letter; [redacted]; prnt01; Note; Instruction; List; Scanned;\n\n```\nUntitled; report; filename; ATT00001; ticket; Form; Attachment; Information\n```\n</Parameters>\n\n```\n\nFigure 13 // Partially redacted, decrypted configuration example\n\nThe configuration does not necessarily specify all the possible parameters. Some parameters,\nsuch as CRYPT_KEY, have their default values hardcoded in the DLL, which could be used in case none\nis specified in the winmail.dat file.\n\nThe different configuration parameters handled by the sample we analyzed are:\n\n- COMMAND_REPLY_ATTACH_NAME\n\n- COMMAND_REPLY_SUBJECT\n\n- CONFIG_FILE_NAME\n\n- CONFIG_UPDATE_INTERVAL\n\n- CRYPT_KEY\n\n- DEBUG_LOG_FILE_NAME\n\n- DECRYPT_KEY\n\n- LIMITS_MAILS_PER_SECOND\n\n- LIMITS_MAILS_PER_SECOND_REFRESH_INTERVAL\n\n- LIMITS_MEMORY_LOAD\n\n- LIMITS_MEMORY_LOAD_REFRESH_INTERVAL\n\n- LOG_LEVEL\n\n- LOG_OUTPUT\n\n\n-----\n\n- MIN_SIZE_TO_ZIP\n\n- POSTFIX_INCOMING_PATH\n\n- SEND_AT_NIGHT\n\n- SEND_FILE\n\n- SEND_FROM\n\n- SEND_NEW_MAIL_LOCAL_RECIPIENT\n\n- SEND_NEW_MAIL_LOGIN\n\n- SEND_NEW_MAIL_MODE\n\n- SEND_NEW_MAIL_PASS\n\n- SEND_NEW_MAIL_PORT\n\n- SEND_NEW_MAIL_SERVER\n\n- SEND_TIME\n\n- SEND_TO\n\n- STAT_INTERVAL\n\n- STAT_PATH\n\n- TMP_ID_PATH\n\n- USE_TEMPLATE\n\n- ZIP_FILE_NAME\n\nWhile most of the parameter names are self-explanatory, an interesting one is CONFIG_FILE_NAME.\nThis second configuration file contains the rules used to process the emails. We detail this behavior\nin the next section.\n\n###### Rules and handlers\n\nIn our example, the rules are defined in c:\\Windows\\ServiceProfiles\\NetworkService\\appdata\\\n```\nLocal\\Temp\\msmocf.xml. This file is encrypted in a similar way as winmail.dat and the RSA private\n\n```\nkey is defined in the configuration parameter DECRYPT_KEY.\n\nOnce decrypted, this is an XML file describing rules, as shown in Figure 14. It contains several class nodes,\neach one corresponding to a different function (aka handler) implemented in the DLL. Each class node\ncontains a set of rules describing conditions using the logical operators AND and OR. In addition, each\nconditional node has three parameters:\n\n- The field to which the condition applies\n\n- The condition: cnt for contains and !cnt for does not contain\n\n- The value that is compared to the field value\n\nFinally, at the end of the file is the mapping of the class names with the name of the functions in the DLL.\n\n\n-----\n\n```\n<class name=\"zip\" metric=\"30\" id=\"1\" dllName=\"ZipMe\" type=\"dll\" include=\"1\">\n  <rule metric=\"10\" id=\"1\" include=\"1\">\n    <and>\n       <or>\n         <To condition=\"cnt\" value=\"email1@[redacted]\" />\n         <From condition=\"cnt\" value=\"email1@[redacted]\" />\n         <To condition=\"cnt\" value=\"email2@[redacted]\" />\n         <From condition=\"cnt\" value=\"email2@[redacted]\" />\n         [...]\n       </or>\n       <and>\n         <To condition=\"!cnt\" value=\"email3@[redacted]\" />\n         <From condition=\"!cnt\" value=\"email3@[redacted]\" />\n         [...]\n       </and>\n    </and>\n  </rule>\n</class>\n<class name=\"command\" metric=\"40\" id=\"1\" dllName=\"ZipMe\" type=\"dll\" include=\"1\">\n  <rule metric=\"10\" id=\"1\" include=\"1\">\n    <attachment_Content-Type condition=\"cnt\" value=\"image/jpeg\" />\n  </rule>\n</class>\nlog:logHandler\nzip:zipHandler\nchangeSubject:changeSubjectHandler\nchangeBody:changeBodyHandler\ncreate:createHandler\ncommand:commandHandler\nblock:blockHandler\nreplace:replaceHandler\nstat:statHandler\n\n```\n\nFigure 14 // Redacted example of a rule file\n\nThese rules are applied to every email processed by the DLL. Thus, the behavioral characteristics\nof LightNeuron reside in this configuration file.\n\nThis configuration is highly flexible, allowing it to perform different actions depending on various fields\nof the email. For example, it is possible to collect all the emails sent by one particular email address.\n\nMoreover, the operators customize the rules for each victim. In the sample we analyzed, all the email\naddresses contained in the rules belonged to the targeted organization. In one case, they were monitoring\naround thirty different email addresses, which probably were the people about whom they were the most\ninterested in collecting information.\n\nThere are eleven different handlers implemented in the DLL and described in Table 1.\n\n\nTable 1 _Description of the handlers implemented in the DLL_\n\n\nHandler name Description\n\nblock Block the email\n\nchangeBody Change the body of the email\n\nchangeTo Change the recipient of the email\n\nchangeSubject Change the subject of the email\n\nParse the JPG/PDF attachment, decrypt and execute the commands. This is described in\ncommand\ndetail in the Backdoor section\n\ncreate Create a new email\n\nlog Log email attachment in LOG_OUTPUT\n\n\n-----\n\nHandler name Description\n\nreplace Replace the attachment\n\nspam Re-create and re-send the email from the exchange server to bypass the spam filter\n\nstat Log From, Date, To, Subject in STAT_PATH in CSV format\n\nzip Encrypt the email with RSA and store it in the path specified by ZIP_FILE_NAME.\n\nAll the handlers are implemented in the same way. In the arguments, there is the email in the form\nof a linked-list with the different fields parsed (From, To, body, etc.). The handler can modify this linked-list\nand will return a code corresponding to the action it performed, as listed in Table 2.\n\n\nTable 2 _Handler return codes and their descriptions_\n\n\nReturn Value Description\n\n0 No modification\n\n1 Email modified\n\n2 Block the email\n\n3 Error\n\n4 Contains .NET assembly\n\nThen, the Transport Agent interprets this return code to know if it should modify the email, block\nit or execute .NET assembly code.\n\nFigure 15 is the handler function for zip. Interestingly, it will dump, encrypt the email and store it on disk\nbut does not compress it. We believe these files are sent back to the attackers using a backdoor command.\n\nFigure 15 // Decompilation output of the zip handler function\n\nSome handlers, such as changeSubject, were not used in the rules we analyzed. However, by creating a new\nset of rules, we were able to trigger this handler. The modification is easily noticed, as you can see in Figure 16.\nOther handlers, such as changeBody or changeTo, might be used to hide some information or to redirect emails.\n\n\n-----\n\nFigure 16 // Original email (on the left) and email after the call to changeSubject (on the right)\n\n###### Backdoor\n\nThe command handler is actually the implementation of a backdoor controlled by email.\nIt has the following properties:\n\n- Depending on the rules, the commands are hidden in a PDF or a JPG attachment.\n\n- It uses steganography to hide data in PDF documents or JPG pictures.\n\n- The email is blocked so it will not be delivered to the final recipient.\n\nAlthough this may sound very similar to the Turla Outlook backdoor controlled by PDF attachments\nthat we analyzed in 2018 [16], the format of the attachment is quite different. Thus, we believe a different\nprogrammer or team developed it.\n\nAs shown in the configuration example, the rule to execute the command handler applies to every\nattachment of type image/jpeg going through the Exchange server. It is not very efficient, as most of the\nimages do not contain commands. As an example, for one victim, the command handler processed around\n7000 pictures while only 178 actually contained commands for the backdoor.\n\nEvery time the handler is called, it will first check whether the attachment is a PDF document or a JPG image,\nas shown in Figure 17.\n\nFigure 17 // Attachment type check (HexRays output)\n\n\n-----\n\nPDF\n\nIn the case of a PDF document, the routine first checks for a signature by performing XOR operations\nwith the data from offset 0x0B to offset 0x10. One way to satisfy this signature condition is by setting\nall the values from offset 0x0B to 0x10 to 0x00.\n\nIf the previous signature is satisfied, the routine reads the offset of the blob of data containing the command,\nwhich we call the container, from offset 0x11. It also reads the size of the container from offset 0x15. Finally,\nit copies the container data. Figure 18 shows these operations.\n\nFigure 18 // Extraction of the container data from the PDF (HexRays output)\n\nA visualization in a hexadecimal editor of the different fields is shown Figure 19.\n\nFigure 19 // Representation in hexadecimal of a PDF containing a container\n\nThis PDF, which was modified to embed a command, is still valid as you can see in Figure 20.\n\nFigure 20 // Modified PDF document with embeded commands for LightNeuron. Snake is another name for Turla.\n\n\n-----\n\nJPG\n\nIn case of a JPG image, it first computes a signature using 16 bytes from the first quantization table.\nThe quantization table is a part of the JPG format and contains data used during the compression of the picture.\n\nIt performs several XOR operations on these 16 bytes and compares the result against a hardcoded\nsignature, as shown in Figure 21.\n\nFigure 21 // Validation of the JPG signature (HexRays output)\n\nWe can view these multiple XOR ( ) operations on the input, followed by a comparison, as a set\nof mathematical equations:\n\n_input0_ _input4 = 250_\n\n_input1_ _input5 = 16_\n\n_input2   input6 = 82_\n\n_input3   input7 = 145_\n\n_input0_ _input10 = 40_\n\n_input1_ _input11 = 219_\n\n_input2   input12 = 213_\n\n_input3   input13 = 176_\n\nOnce we have the set of equations, we can easily solve it manually or use a SMT (Satisfiability Modulo\nTheories) solver such as Microsoft Z3 [20] to find out whether a solution exists and, if so, to find one possible\nsolution. It turns out this set of equations is solvable and we use the solution to create a JPG image\nthat can pass the check.\n\nIf the previous equation is satisfied, it gets the length of the container from offset 0x0F of the quantization table.\n\nFinally, it extracts the container from the last Start of Scan section, another standard field of the JPG format.\n\nBy modifying the quantization table, the resulting picture is also affected. However, the image is still valid,\nas shown in Figure 22.\n\n\n-----\n\nFigure 22 // Modified JPG picture with embedded commands for LightNeuron\n\nContainer and command execution\n\nRegardless of the attachment type delivering it, the container format is strictly identical. The first four bytes\nare the size of the container and the following bytes are encrypted with AES-256 with a key hardcoded\nin the binary. Figure 23 shows an example of an encrypted container.\n\nFigure 23 // Hexadecimal dump of an encrypted container\n\nOnce decrypted, we see the different fields used to store information about the commands to be executed.\nIn Figure 24, we can see some of the most important fields:\n\n- At offset 0x08, the email address to which the result of the command is sent.\n\n- At offset 0x1D, the instruction code. It corresponds to a function in the DLL.\n\n- At offset 0x25, the first argument. It will be passed to the function represented by the instruction code.\n\nFigure 24 // Hexadecimal dump of a decrypted container\n\nIf an email containing this particular container, embedded in a JPG or in a PDF, is sent to a server compromised\nby LightNeuron, a calculator will be executed on the Microsoft Exchange server.\n\nIn addition to the instruction code 0x04, which runs the executable given by the first argument,\nthere are eight other instruction codes having up to three arguments. Table 2 describes the nine different\nbackdoor instructions.\n\n\n-----\n\nTable 2 _List of instruction codes_\n\n\nInstruction\nDescription Arg 1 Arg 2 Arg 3\nCode\n\nWrite a file.\n0x01 Exe path N/A File data\nExecute it if it is an executable.\n\n0x02 Delete a file File path N/A N/A\n\nSet to “1” to\n0x03 Exfiltrate a file File path N/A\ndelete the file\n\n0x04 Execute a process (CreateProcess) Command line N/A N/A\n\n0x05 Execute a command line (cmd.exe /c) Command line N/A N/A\n\n0x06 Return 0 N/A N/A N/A\n\n0x07 Disable backdoor for N minutes. Minutes N/A N/A\n\nExfiltrate a file (duplicate function of Set to “1” to\n0x09 File Path N/A\n0x03) delete the file\n\n0x65 No-op N/A N/A N/A\n\nThe detailed structure, in C-like syntax, of the container is available Figure 25.\n\n```\nstruct encrypted_container {\n  int size; //clear text\n  container[]; //encrypted with AES-256\n}\nstruct container { //Can contain multiple commands\n  int CmdId; //Unique ID to identify the container\n  int rcptl; //Recipient address length\n  char rcpt[rcptl]; //Recipient address (address to which the output data will be sent)\n  command[]; //list of commands\n}\nstruct command {\n  int InstId; //Unique ID to identify this command\n  int InstrCode; //The instruction that will be executed\n  int fpl; //First parameter length\n  char fp[fpl]; //First parameter\n  int spl; //Second parameter length\n  char sp[spl]; //Second parameter\n  int bpl; //Third parameter length\n  char bp[bpl]; //Third parameter\n}\n\n```\n\nFigure 25 // Structure of the command container (C-like syntax)\n\nWhen processing a container, the backdoor writes the CmdId value to a log file, located at the path c:\\Win­\ndows\\ServiceProfiles\\NetworkService\\AppData\\Roaming\\Microsoft\\Windows\\thumbcache_32.\n```\ndb. The backdoor checks it just before processing a new container, to check whether this container\n\n```\nhas already been processed. This is an anti-replay mechanism, probably to avoid duplicate execution\nif the mail server somehow receives the same email multiple times.\n\nFinally, the command output is encrypted with AES and a PDF document or a JPG image is built using\na format similar to that described earlier. Interestingly, it reuses the incoming PDF or JPG and replaces\nthe command container with a container holding the output data. An email is then created using data\n\n\n-----\n\nfrom the configuration and the destination address provided in the incoming container. For instance,\nit uses the following fields from winmail.dat:\n\n```\nSEND_FROM:[redacted]noreply@[redacted]\nCOMMAND_REPLY_SUBJECT: Email_confirmation\nCOMMAND_REPLY_ATTACH_NAME: Letter; [redacted]; prnt01; Note; Instruction; List; Scanned;\n\n```\nUntitled; report; filename; ATT00001; ticket; Form; Attachment; Information\n\n\nTo send the email, it simply drops it in the folder <ExchangeInstallFolder>\\TransportRoles\\PickUp\\\nand the filename starts with msg followed by the result of the GetTickCount function. According to the\nMicrosoft documentation [21]:\n\n_The Pickup and replay directories are used by the Transport service on Mailbox servers and Edge_\n\n_Transport servers to insert message files directly into the transport pipeline. Correctly formatted_\n\n_email message files that you copy to the Pickup or Replay directories are submitted for delivery._\n\nMoreover, Exchange does not perform any security check on the email sent via this folder [22]:\n\n_Any security checks configured on a Receive connector, such as anti-spam, anti-malware, sender_\n\n_filtering, or recipient filtering actions, aren't performed on messages submitted through the Pickup_\n\n_directory or the Replay directory._\n\nThus, security solutions will not see the data exfiltrated through LightNeuron, which makes this malware\nvery stealthy.\n\nAn example of an email containing the result of LightNeuron executing a command is shown in Figure 26.\nThe recipient is reply@example.com, as specified in the incoming command container. The sender is noreply@\n_example.com, which is the address we choose to use to replace the redacted one specified in the original_\nconfiguration. The subject header and the attachment name were selected from the lists in the configura­\n\ntion and the incoming PDF was re-used to transport output data.\n\nFigure 26 // Example of an email generated by LightNeuron to send command output\n\n\n-----\n\n###### Miscellaneous\n\nLogging\n\nThe companion DLL uses logging extensively. The log level can be customized in the configuration file,\nallowing logging only relevant information when the malware is implanted on a victim machine.\n\nThe log files are encrypted with AES-256. Each log entry contained in the log files is encrypted separately\nand the thirty-two first bytes of each log file contain the key.\n\nRegardless of the log’s purpose, each log entry has the same format, as described in Figure 27 in C-like syntax.\n\n```\nstruct log_entry {\n   DWORD total_size;\n   QWORD unknown1; //AES encryption begins here\n   DWORD log_code;\n   DWORD hex_value;\n   DWORD unknown2;\n   DWORD data_size;\n   char data[data_size];\n}\n\n```\n\nFigure 27 // Log entry structure in C-like syntax\n\nThe most important fields are:\n\n- The log code field: each different code corresponds to a different logging event. For example, the log code\n\n0x3C28 corresponds to the execution of a handler.\n\n- The hex value field: Used when the data are numerical. For example, it can contain the Instruction\n\nCode executed by the backdoor.\n\n- The data field: Used to store text data. For example, it can contain the subject of the email.\n\nThe log file names vary across the different samples but for the sample we analyzed, we identified\nthe following six log files:\n\n\nTable 3 _Description of the log files_\n\n\nComponent Path Description\n\n\nTransport Agent\n\nTransport Agent\n\nCompanion DLL\n\n\nC:\\Windows\\serviceprofiles\\network­\nservice\\appdata\\Roaming\\Microsoft\\\nWindows\\814ad43-58ab-2cd3-3e68-b82a8f402fd0\n\nC:\\Windows\\serviceprofiles\\network­\nservice\\appdata\\Roaming\\Microsoft\\\nWindows\\42cf8a1-6e20-8c24-d35f-82c46d8b70ba\n\nC:\\Windows\\serviceprofiles\\network­\nservice\\appdata\\Roaming\\Microsoft\\\nWindows\\36b1f4a-82b9-eb06-7c1e-90b4b2d5c27d\n\n\nLog the sender and the date of every\nemail processed by the Exchange server\n\nError log\n\nLog the date at each execution of the\nDLL main\n\n\nC:\\Windows\\ServiceProfiles\\NetworkService\\AppData\\\nCompanion DLL Log backdoor actions\nRoaming\\Microsoft\\thumbcache_idx.db\n\nC:\\Windows\\ServiceProfiles\\NetworkService\\appdata\\\nCompanion DLL Debug log\nLocal\\Temp\\msmodl.dat\n\n\nC:\\Windows\\ServiceProfiles\\NetworkService\\AppData\\\nCompanion DLL\nRoaming\\Microsoft\\Windows\\thumbcache_32.db\n\n\nLog the command id. Used to protect\nagainst replay attacks.\n\n\n-----\n\nAutomatic exfiltration\n\nIf the configuration parameters SEND_TIME and SEND_AT_NIGHT are set, a thread launched by the DLL main\nfunction will loop indefinitely. As shown in Figure 28, it first waits SEND_TIME seconds and then checks if the\nexfiltration should only occur during the night or during working hours. In the latter case, it checks whether\nthe hour is between 17:00 and 09:00 and if it is true, it re-enters the sleep loop without exfiltrating any files.\n\nFigure 28 // Exfiltration loop with night check (HexRays output)\n\nThe exfiltration function, shown in Figure 29, loops over the files that match the SEND_FILE specification.\nIt is possible to include wildcards in the filename specification to match several different files. Then, for each\nfile, it will send an email containing the file in either a JPG or a PDF attachment. The Backdoor section details\nthe sending of the emails.\n\nFigure 29 // Exfiltration loop (HexRays output)\n\nEven though we did not see Turla make use of it in the wild, we believe this functionality might be used\nto exfiltrate automatically the emails archived by the zip handler, as this handler does not implement\nany exfiltration mechanism.\n\n\n-----\n\n##### 4.4 Evolution\n\nEven without the earliest versions of LightNeuron, we noticed some development effort between\nthe different versions we have seen:\n\n- There was an effort to obfuscate function names in the .NET Transport Agent.\n\n- Some Indicators of Compromise are different in each sample:\n\n  - Mutex names,\n\n  - Log file names,\n\n  - AES key used by the backdoor.\n\n- The oldest versions only support JPG attachments for the C&C protocol, while the latest versions\n\nalso support PDF documents.\n\n##### 4.5 Linux variant\n\nIn a previous section, we explained that most of the strings used by LightNeuron are encrypted. It turns\nout that some decrypted strings contain strings that make sense only in a Unix environment.\n\nFigure 30 shows some of these strings that refer to Unix. For example, sendmail is a common executable\nused to send an email on Linux. Thus, piping email content with cat to sendmail is actually a common way\nto send an email in a Linux environment. Further, Postfix is an alternative mail server to sendmail.\n\nFigure 30 // Linux strings in the Windows DLL\n\nThese Unix artefacts in the Windows malware could be explained by the possible sharing of code between\nWindows and Unix implementations.\n\nHence, the presence of these strings suggests LightNeuron exists for Linux. That would not be surprising,\ngiven that many organizations have Linux mail servers.\n\n#### 5. REMEDIATION\n\n##### 5.1 Cleaning\n\nThe cleaning of LightNeuron is not an easy task. Simply removing the two malicious files will break\nMicrosoft Exchange, preventing everybody in the organization from sending and receiving emails.\n\nNote to other AV vendors: before adding a detection for the Transport Agent files, be aware that doing\nso without a proper cleaning routine will render your infected customer’s exchange servers inoperable,\nso proceed with caution.\n\n\n-----\n\nBefore actually removing the files, the malicious Transport Agent should be disabled.\n\nFirst, open <ExchangeInstallFolder>\\TransportRoles\\Agents\\agents.config and check every DLL.\nAll of the genuine Transport Agents should be signed either by Microsoft a trusted software vendor. The\nagents.config file should be similar to Figure 31.\n\n```\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n\n```\n**<configuration>**\n**<mexRuntime>**\n**<monitoring>**\n**<agentExecution timeLimitInMilliseconds=\"90000\" />**\n**</monitoring>**\n**<agentList>**\n```\n  [...]\n\n```\n**<agent name=\"Security Interop Agent\"**\n```\n           baseType=\"Microsoft.Exchange.Data.Transport.Smtp.SmtpReceiveAgent\"\n           classFactory=\"Microsoft.Exchange.Security.Interop.\nSecurityInteropAgentFactory\"\n           assemblyPath=\"c:\\program files\\microsoft\\Exchange Server\\v15\\bin\\\nMicrosoft.Exchange.Security.Interop.dll\"\n           enabled=\"true\"\n           IsCritical=\"true\" />\n\n```\n**<agent name=\"Content Filter Agent\"**\n```\n           baseType=\"Microsoft.Exchange.Data.Transport.Routing.RoutingAgent\"\n           classFactory=\"Microsoft.Exchange.Security.Interop.\nContentFilterAgentFactory\"\n           assemblyPath=\"c:\\program files\\microsoft\\Exchange Server\\v15\\bin\\\nMicrosoft.Exchange.Security.Interop.dll\"\n           enabled=\"true\"\n           IsCritical=\"true\" />\n\n```\n**</agentList>**\n**<settings />**\n**</mexRuntime>**\n**</configuration>**\n\n\nFigure 31 // agents.config example\n\nIn that example, the malicious DLL is Microsoft.Exchange.Security.Interop.dll and two related\nTransport Agents are registered:\n\n- `Security Interop Agent (called <name1> in the following explanations)`\n\n- `Content Filter Agent (called <name2> in the following explanations)`\n\nThen, on the Exchange server, execute the following PowerShell commands with admin rights:\n\n```\nDisable-TransportAgent -Identity <name1>\nDisable-TransportAgent -Identity <name2>\nUninstall-TransportAgent -Identity <name1>\nUninstall-TransportAgent -Identity <name2>\n\n```\n\nThe malicious Transport Agents are now disabled. After that, it is possible to remove the two malicious files\nwithout breaking Microsoft Exchange.\n\nIf you do not plan to re-install the mail server, an important last step is to modify the passwords\nof all accounts that have administrative rights on the compromised server. Otherwise, attackers could access\nthe server again to compromise it again.\n\n\n-----\n\n##### 5.2 Mitigations\n\nGiven that attackers have gained administrative privileges on the Exchange server, there are no bulletproof\nmitigations against this threat. However, these few recommendations can help to detect the compromise\nand to make the attacker’s work harder.\n\n- Use dedicated accounts for the administration of Exchange servers with strong, unique passwords\n\nand, if possible, 2FA.\n\n- Monitor closely the usage of these accounts.\n\n- Restrict PowerShell execution.\n\n- Regularly check that all the installed Transport Agents are signed by a trusted provider.\n\n#### 6. CONCLUSION\n\nIn addition to their Turla Outlook backdoor [16], LightNeuron is another example that Turla operators\nhave a large set of sophisticated, custom malware at their disposal.\n\nTo our knowledge, this is the first time a malicious actor has leveraged a Microsoft Exchange Transport\nAgent to enable persistence on a mail server. This technique is very interesting as it allows them to receive\ncommands and exfiltrate data without any filtering.\n\nLightNeuron is a very powerful piece of malware. It can spy on all the emails of the compromised organization\nbut also execute commands, for example, to control other machines on the local network. This makes\nit a main hub in the breached network for Turla operators.\n\nWe will continue to monitor Turla developments to help defenders to protect their networks.\n\n_Indicators of Compromise can also be found on GitHub. For any inquiries, or to make sample submissions related_\n_to the subject, contact us at: threatintel@eset.com._\n\n\n-----\n\n#### 7. BIBLIOGRAPHY\n\n1 B. KNOWLTON, “Military Computer Attack Confirmed,” New York Times, 25 08 2010. [Online]. Available:\n_https://www.nytimes.com/2010/08/26/technology/26cyber.html?_r=1&ref=technology. [Accessed 09 04 2018]._\n\n2 MELANI, “ Technical Report about the Malware used in the Cyberespionage against RUAG,” 23 05 2016.\n\n[Online]. Available: https://www.melani.admin.ch/melani/en/home/dokumentation/reports/technical-reports/\n_technical-report_apt_case_ruag.html._\n\n3 M. Untersinger, “Quelle est la bonne équation pour pacifier le cyberespace ?,” Le Monde, 29 01 2019. [Online].\nAvailable: https://www.lemonde.fr/pixels/article/2019/01/29/course-aux-cyberarmes-logiciels-destructeurs-dormants_le-difficile-apaisement-du-cyberespace_5416003_4408996.html._\n\n4 A. Cherepanov, “GREYENERGY: A successor to BlackEnergy,” ESET, 2018.\n\n5 A. Cherepanov, “TeleBots are back: Supply-chain attacks against Ukraine,” ESET, 30 06 2017. [Online].\n_Available: https://www.welivesecurity.com/2017/06/30/telebots-back-supply-chain-attacks-against-ukraine/._\n\n6 ESET Research, “Turla Mosquito: A shift towards more generic tools,” 22 05 2018. [Online].\nAvailable: https://www.welivesecurity.com/2018/05/22/turla-mosquito-shift-towards-generic-tools/.\n\n7 Kaspersky GReAT, “Shedding Skin - Turla’s Fresh Faces,” 04 10 2018. [Online].\nAvailable: https://securelist.com/shedding-skin-turlas-fresh-faces/88069/.\n\n8 ESET Research, “Carbon Paper: Peering into Turla’s second stage backdoor,” ESET, 30 03 2017. [Online].\nAvailable: https://www.welivesecurity.com/2017/03/30/carbon-paper-peering-turlas-second-stage-backdoor/.\n\n9 ESET Research, “Gazing at Gazer - Turla’s new second stage backdoor,” ESET, 08 2017. [Online].\nAvailable: https://www.welivesecurity.com/wp-content/uploads/2017/08/eset-gazer.pdf.\n\n10 D. Huss, “Turla APT actor refreshes KopiLuwak JavaScript backdoor for use in G20-themed\nattack,” 17 08 2017. [Online]. Available: https://www.proofpoint.com/us/threat-insight/post/\n_turla-apt-actor-refreshes-kopiluwak-javascript-backdoor-use-g20-themed-attack._\n\n11 J.-I. Boutin, “Turla’s watering hole campaign: An updated Firefox extension abusing\nInstagram,” 06 06 2017. [Online]. Available: https://www.welivesecurity.com/2017/06/06/\n_turlas-watering-hole-campaign-updated-firefox-extension-abusing-instagram/._\n\n12 ESET Research, “Diplomats in Eastern Europe bitten by a Turla mosquito,” ESET, 01 2018. [Online].\n_Available: https://www.welivesecurity.com/wp-content/uploads/2018/01/ESET_Turla_Mosquito.pdf._\n\n13 National Cyber Security Centre, “Turla group using Neuron and Nautilus tools alongside Snake malware,”\n23 11 2017. [Online]. Available: https://www.ncsc.gov.uk/content/files/protected_files/article_files/Turla%20group%20\n_using%20Neuron%20and%20Nautilus%20tools%20alongside%20Snake%20malware_1.pdf._\n\n14 S. Tanase, “Satellite Turla: APT Command and Control in the Sky,” 09 09 2015. [Online].\n_Available: https://securelist.com/satellite-turla-apt-command-and-control-in-the-sky/72081/._\n\n15 GDATA, “Uroburos – Deeper travel into kernel protection mitigation,” 07 03 2014. [Online]. Available:\n_https://www.gdatasoftware.com/blog/2014/03/23966-uroburos-deeper-travel-into-kernel-protection-mitigation._\n\n16 ESET, “Turla Outlook Backdoor,” 08 2018. [Online]. Available:\n_https://www.welivesecurity.com/wp-content/uploads/2018/08/Eset-Turla-Outlook-Backdoor.pdf._\n\n17 GReAT, “APT Trends Report Q2 2018,” Kaspersky Labs, 10 06 2018. [Online]. Available:\n_https://securelist.com/apt-trends-report-q2-2018/86487/._\n\n18 Microsoft, “Transport agents,” 01 06 2016. [Online]. Available:\n_https://docs.microsoft.com/en-us/exchange/transport-agents-exchange-2013-help._\n\n19 Mozilla, “What is the winmail.dat attachment?,” [Online]. Available:\n_https://support.mozilla.org/en-US/kb/what-winmaildat-attachment._\n\n20 Microsoft, “The Z3 Theorem Prover,” [Online]. Available: https://github.com/Z3Prover/z3.\n\n21 D. Strome, “Configure the Pickup directory and the Replay directory,” 12 08 2016. [Online]. Available: https://\n_docs.microsoft.com/en-us/exchange/configure-the-pickup-directory-and-the-replay-directory-exchange-2013-help._\n\n\n-----\n\n22 D. Strome, “Pickup directory and Replay directory,” 08 12 2016. [Online]. Available:\n_https://docs.microsoft.com/en-us/exchange/pickup-directory-and-replay-directory-exchange-2013-help._\n\n23 M. Schlee, “Hackers used Outlook for cyberattack on German government: report,” Politico, 06 03 2018. [Online].\nAvailable: https://www.politico.eu/article/report-hackers-used-outlook-for-cyberattack-on-german-government/.\n\n#### 8. IOCS\n\n##### 8.1 Hashes\n\nIn order to avoid breaking a compromised Microsoft Exchange server, please read the Cleaning section before\ndeleting any of the LightNeuron files.\n\nSHA1 hash `3C851E239FBF67A03E0DAE8F63EEE702B330DB6C`\n\nFilename Microsoft.Exchange.Security.Interop.dll\n\nComponent Transport Agent\n\nCompilation date 26/10/2016\n\nESET Detection Name MSIL/Turla.A\n\nSHA1 hash `76EE1802A6C920CBEB3A1053A4EC03C71B7E46F8`\n\nFilename exrwdb.dll\n\nComponent Companion DLL\n\nCompilation date 02/09/2016\n\nESET Detection Name Win64/Turla.CC\n\nSHA1 hash `FF28B53B55BC77A5B4626F9DB856E67AC598C787`\n\nFilename Microsoft.Exchange.MessagingPolicies.Search.dll\n\nComponent Transport Agent\n\nCompilation date 16/08/2015\n\nESET Detection Name MSIL/Turla.A\n\nSHA1 hash `C1FF6804FDB8656AB08928D187837D28060A552F`\n\nFilename BPA.Transport.dll\n\nComponent Companion DLL\n\nCompilation date 25/07/2014\n\nESET Detection Name Win64/Turla.CC\n\nSHA1 hash `F9D52BB5A30B42FC2D1763BE586CEE8A57424732`\n\nFilename Microsoft.Exchange.MessagingPolicies.Search.exe\n\nComponent Transport Agent\n\nCompilation date 20/06/2014\n\nESET Detection Name MSIL/Turla.A\n\nSHA1 hash `0A9F10925AF42DF94925D07112F303D57392C908`\n\nFilename BPA.Transport.dll\n\nComponent Companion DLL\n\nCompilation date 01/07/2016\n\nESET Detection Name Win64/Turla.CC\n\nSHA1 hash `A4D1A34FE5EFFD90CCB6897679586DDC07FBC5CD`\n\nFilename /\n\nComponent Transport Agent\n\nCompilation date 20/06/2014\n\nESET Detection Name MSIL/Turla.A\n\n\n-----\n\n##### 8.2 Paths\n\n- `%tmp%\\winmail.dat`\n\n- C:\\Windows\\ServiceProfiles\\NetworkService\\appdata\\Local\\Temp\\msmocf.xml\n\n- C:\\Windows\\ServiceProfiles\\NetworkService\\appdata\\Local\\Temp\\msmodl.dat\n\n- C:\\Windows\\serviceprofiles\\networkservice\\appdata\\Roaming\\Microsoft\\\n\nWindows\\814ad43-58ab-2cd3-3e68-b82a8f402fd0\n\n- C:\\Windows\\serviceprofiles\\networkservice\\appdata\\Roaming\\Microsoft\\\n\nWindows\\42cf8a1-6e20-8c24-d35f-82c46d8b70ba\n\n- C:\\Windows\\serviceprofiles\\networkservice\\appdata\\Roaming\\Microsoft\\\n\nWindows\\36b1f4a-82b9-eb06-7c1e-90b4b2d5c27d\n\n- C:\\Windows\\ServiceProfiles\\NetworkService\\AppData\\Roaming\\Microsoft\\thumbcache_idx.db\n\n- C:\\Windows\\ServiceProfiles\\NetworkService\\AppData\\Roaming\\Microsoft\\Windows\\thumbcache_32.db\n\n#### 9. MITRE ATT&CK TECHNIQUES\n\nTactic Id Name Description\n\nAttackers probably re-used stolen credentials\nInitial Access T1078 Valid Accounts\nto deploy LightNeuron.\n\nExecution T1086 PowerShell A PowerShell script was used to install LightNeuron.\n\nPrivilege To have Administrative rights, attackers probably\nT1078 Valid Accounts\nEscalation used stolen credentials.\n\n\nSystem Network\nDiscovery T1016\nConfiguration Discovery\n\n\nLightNeuron exfiltrates the result of the functions\nGetAdaptersInfo and GetComputerName.\n\n\nCollection\n\nExfiltration\n\nCommand\nand Control\n\n\nDepending on the configuration, LightNeuron\nT1119 Automated Collection\ncan collect the files in a specific path.\n\nUsing a backdoor function, attackers can exfiltrate\nT1005 Data from Local System\nany local file.\n\nLightNeuron collects all the emails matching one rules\nT1114 Email Collection\nspecified in its configuration.\n\nDepending on the configuration, LightNeuron\nT1020 Automated Exfiltration\ncan exfiltrate files located in a specific path.\n\nT1022 Data Encrypted Data is encrypted using AES.\n\n\nDepending on the configuration, automatic exfiltration\nT1029 Scheduled Transfer\ncan happen during the night or during working hours.\n\nC&C data is hidden in PDF documents or JPG images\nT1001 Data Obfuscation\nusing steganography.\n\nStandard Cryptographic\nT1032 C&C data is encrypted using AES.\nProtocol\n\nStandard Application\nT1071 C&C communication uses emails.\nLayer Protocol\n\n\nT1041\n\n\nExfiltration Over\nCommand and Control\nChannel\n\n\nData is exfiltratated using an email C&C channel.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "99fdc3ef-333d-48f5-a4a1-becd788c7b80",
            "created_at": "2022-10-25T15:28:29.802983Z",
            "updated_at": "2022-10-25T15:28:29.802983Z",
            "deleted_at": null,
            "name": "MITRE",
            "url": "https://github.com/mitre-attack/attack-stix-data",
            "description": "MITRE ATT&CK STIX Data",
            "reports": null
        },
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        },
        {
            "id": "6fc23d14-23a6-4870-8fad-b291b182596f",
            "created_at": "2022-10-25T16:07:18.480113Z",
            "updated_at": "2022-10-25T16:07:18.480113Z",
            "deleted_at": null,
            "name": "ETDA",
            "url": "https://apt.etda.or.th",
            "description": "Threat Group Cards: A Threat Actor Encyclopedia",
            "reports": null
        },
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        },
        {
            "id": "5910e58f-4bc9-4e4e-9dbb-887804094a01",
            "created_at": "2022-10-25T16:32:58.457399Z",
            "updated_at": "2022-10-25T16:32:58.457399Z",
            "deleted_at": null,
            "name": "OTX",
            "url": "https://otx.alienvault.com",
            "description": "Alienvault Open Threat Exchange (OTX)",
            "reports": null
        }
    ],
    "references": [
        "https://www.welivesecurity.com/wp-content/uploads/2019/05/ESET-LightNeuron.pdf",
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2019/2019.05.07.Turla_LightNeuron/ESET-LightNeuron.pdf"
    ],
    "report_names": [
        "ESET-LightNeuron.pdf",
        "ESET-LightNeuron"
    ],
    "threat_actors": [
        {
            "id": "b740943a-da51-4133-855b-df29822531ea",
            "created_at": "2022-10-25T15:50:23.604126Z",
            "updated_at": "2025-03-27T02:00:55.505366Z",
            "deleted_at": null,
            "main_name": "Equation",
            "aliases": [
                "Equation"
            ],
            "source_name": "MITRE:Equation",
            "tools": null,
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "4d9cdc7f-72d6-4e17-89d8-f6323bfcaebb",
            "created_at": "2023-01-06T13:46:38.82716Z",
            "updated_at": "2025-03-27T02:00:02.928984Z",
            "deleted_at": null,
            "main_name": "GreyEnergy",
            "aliases": [],
            "source_name": "MISPGALAXY:GreyEnergy",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "a66438a8-ebf6-4397-9ad5-ed07f93330aa",
            "created_at": "2022-10-25T16:47:55.919702Z",
            "updated_at": "2025-03-27T02:05:17.412024Z",
            "deleted_at": null,
            "main_name": "IRON VIKING",
            "aliases": [
                "ATK14 ",
                "BlackEnergy Group",
                "Blue Echidna ",
                "CTG-7263 ",
                "ELECTRUM ",
                "FROZENBARENTS ",
                "Hades/OlympicDestroyer ",
                "IRIDIUM ",
                "Qudedagh ",
                "Sandworm Team ",
                "Seashell Blizzard ",
                "TEMP.Noble ",
                "Telebots ",
                "Voodoo Bear ",
                "APT44 "
            ],
            "source_name": "Secureworks:IRON VIKING",
            "tools": [
                " BlackEnergy",
                " GCat",
                " GreyEnergy",
                " Industroyer",
                " KillDisk",
                " NotPetya",
                " PSCrypt",
                " TeleBot",
                " TeleDoor",
                " xData",
                "BadRabbit"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "f8dddd06-da24-4184-9e24-4c22bdd1cbbf",
            "created_at": "2023-01-06T13:46:38.626906Z",
            "updated_at": "2025-03-27T02:00:02.877001Z",
            "deleted_at": null,
            "main_name": "Tick",
            "aliases": [
                "Stalker Taurus",
                "PLA Unit 61419",
                "Nian",
                "BRONZE BUTLER",
                "REDBALDKNIGHT",
                "STALKER PANDA",
                "G0060"
            ],
            "source_name": "MISPGALAXY:Tick",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "b3e954e8-8bbb-46f3-84de-d6f12dc7e1a6",
            "created_at": "2022-10-25T15:50:23.339976Z",
            "updated_at": "2025-03-27T02:00:55.446795Z",
            "deleted_at": null,
            "main_name": "Sandworm Team",
            "aliases": [
                "Sandworm Team",
                "ELECTRUM",
                "Telebots",
                "IRON VIKING",
                "BlackEnergy (Group)",
                "Quedagh",
                "Voodoo Bear",
                "IRIDIUM",
                "Seashell Blizzard",
                "FROZENBARENTS",
                "APT44"
            ],
            "source_name": "MITRE:Sandworm Team",
            "tools": [
                "Bad Rabbit",
                "Mimikatz",
                "Exaramel for Linux",
                "Exaramel for Windows",
                "GreyEnergy",
                "PsExec",
                "Prestige",
                "P.A.S. Webshell",
                "VPNFilter",
                "Cyclops Blink",
                "SDelete",
                "AcidRain",
                "Industroyer",
                "Industroyer2",
                "BlackEnergy",
                "Cobalt Strike",
                "NotPetya",
                "KillDisk",
                "PoshC2",
                "Impacket",
                "Invoke-PSImage",
                "Olympic Destroyer"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "39842197-944a-49fd-9bec-eafa1807e0ea",
            "created_at": "2022-10-25T16:07:24.310589Z",
            "updated_at": "2025-03-27T02:02:10.167471Z",
            "deleted_at": null,
            "main_name": "TeleBots",
            "aliases": [],
            "source_name": "ETDA:TeleBots",
            "tools": [
                "BadRabbit",
                "Black Energy",
                "BlackEnergy",
                "CredRaptor",
                "Diskcoder.C",
                "EternalPetya",
                "ExPetr",
                "Exaramel",
                "FakeTC",
                "Felixroot",
                "GreyEnergy",
                "GreyEnergy mini",
                "KillDisk",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "NonPetya",
                "NotPetya",
                "Nyetya",
                "Petna",
                "Petrwrap",
                "Pnyetya",
                "TeleBot",
                "TeleDoor",
                "Win32/KillDisk.NBB",
                "Win32/KillDisk.NBC",
                "Win32/KillDisk.NBD",
                "Win32/KillDisk.NBH",
                "Win32/KillDisk.NBI",
                "nPetya"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "a97cf06d-c2e2-4771-99a2-c9dee0d6a0ac",
            "created_at": "2022-10-25T16:07:24.349252Z",
            "updated_at": "2025-03-27T02:02:10.184406Z",
            "deleted_at": null,
            "main_name": "Turla",
            "aliases": [
                "ATK 13",
                "Belugasturgeon",
                "Blue Python",
                "CTG-8875",
                "Group 88",
                "ITG12",
                "Iron Hunter",
                "Krypton",
                "Makersmark",
                "Operation Epic Turla",
                "Operation Moonlight Maze",
                "Operation Penguin Turla",
                "Operation Satellite Turla",
                "Operation Skipper Turla",
                "Operation Turla Mosquito",
                "Operation WITCHCOVEN",
                "Pacifier APT",
                "Pensive Ursa",
                "Popeye",
                "SIG15",
                "SIG2",
                "SIG23",
                "Secret Blizzard",
                "TAG-0530",
                "Turla",
                "UNC4210",
                "Venomous Bear",
                "Waterbug"
            ],
            "source_name": "ETDA:Turla",
            "tools": [
                "ASPXSpy",
                "ASPXTool",
                "ATI-Agent",
                "AdobeARM",
                "Agent.BTZ",
                "Agent.DNE",
                "BigBoss",
                "COMpfun",
                "Chinch",
                "Cloud Duke",
                "CloudDuke",
                "CloudLook",
                "Cobra Carbon System",
                "ComRAT",
                "DoublePulsar",
                "EmPyre",
                "EmpireProject",
                "Epic Turla",
                "EternalBlue",
                "EternalRomance",
                "GoldenSky",
                "Group Policy Results Tool",
                "HTML5 Encoding",
                "HyperStack",
                "IcedCoffee",
                "IronNetInjector",
                "KSL0T",
                "Kapushka",
                "Kazuar",
                "KopiLuwak",
                "Kotel",
                "LOLBAS",
                "LOLBins",
                "LightNeuron",
                "Living off the Land",
                "Maintools.js",
                "Metasploit",
                "Meterpreter",
                "MiamiBeach",
                "Mimikatz",
                "MiniDionis",
                "Minit",
                "NBTscan",
                "NETTRANS",
                "NETVulture",
                "Neptun",
                "NetFlash",
                "NewPass",
                "Outlook Backdoor",
                "Penquin Turla",
                "Pfinet",
                "PowerShell Empire",
                "PowerShellRunner",
                "PowerShellRunner-based RPC backdoor",
                "PowerStallion",
                "PsExec",
                "PyFlash",
                "QUIETCANARY",
                "Reductor RAT",
                "RocketMan",
                "SMBTouch",
                "SScan",
                "Satellite Turla",
                "SilentMoon",
                "Sun rootkit",
                "TTNG",
                "TadjMakhal",
                "Tavdig",
                "TinyTurla",
                "TinyTurla Next Generation",
                "TinyTurla-NG",
                "Topinambour",
                "Tunnus",
                "Turla",
                "Turla SilentMoon",
                "TurlaChopper",
                "Uroburos",
                "Urouros",
                "WCE",
                "WITCHCOVEN",
                "WhiteAtlas",
                "WhiteBear",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "Wipbot",
                "WorldCupSec",
                "XTRANS",
                "certutil",
                "certutil.exe",
                "gpresult",
                "nbtscan",
                "nbtstat",
                "pwdump"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "8aaa5515-92dd-448d-bb20-3a253f4f8854",
            "created_at": "2024-06-19T02:03:08.147099Z",
            "updated_at": "2025-03-27T02:05:17.408118Z",
            "deleted_at": null,
            "main_name": "IRON HUNTER",
            "aliases": [
                "Belugasturgeon ",
                "Blue Python ",
                "CTG-8875 ",
                "ITG12 ",
                "KRYPTON ",
                "MAKERSMARK ",
                "Pensive Ursa ",
                "Secret Blizzard ",
                "Turla",
                "UAC-0003 ",
                "UAC-0024 ",
                "UNC4210 ",
                "Venomous Bear ",
                "Waterbug ",
                "ATK13 "
            ],
            "source_name": "Secureworks:IRON HUNTER",
            "tools": [
                " ComRAT",
                " Kazuar",
                " KopiLuwak",
                " LightNeuron",
                " Mosquito",
                " Nautilus",
                " Neuron",
                " Penquin",
                " PoisonFrog",
                " PyFlash",
                " Skipper",
                " Snake",
                " Tavdig",
                " TinyTurla",
                " Tunnus",
                "Carbon-DLL"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "a97fee0d-af4b-4661-ae17-858925438fc4",
            "created_at": "2023-01-06T13:46:38.396415Z",
            "updated_at": "2025-03-27T02:00:02.823045Z",
            "deleted_at": null,
            "main_name": "Turla",
            "aliases": [
                "Uroburos",
                "Hippo Team",
                "Pacifier APT",
                "MAKERSMARK",
                "ATK13",
                "UAC-0003",
                "IRON HUNTER",
                "Waterbug",
                "TAG_0530",
                "KRYPTON",
                "Popeye",
                "SIG23",
                "UAC-0144",
                "G0010",
                "Blue Python",
                "VENOMOUS Bear",
                "Group 88",
                "Pfinet",
                "ITG12",
                "UNC4210",
                "Secret Blizzard",
                "UAC-0024"
            ],
            "source_name": "MISPGALAXY:Turla",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "8941e146-3e7f-4b4e-9b66-c2da052ee6df",
            "created_at": "2023-01-06T13:46:38.402513Z",
            "updated_at": "2025-03-27T02:00:02.824555Z",
            "deleted_at": null,
            "main_name": "Sandworm",
            "aliases": [
                "G0034",
                "IRIDIUM",
                "Blue Echidna",
                "FROZENBARENTS",
                "Seashell Blizzard",
                "IRON VIKING",
                "ELECTRUM",
                "TeleBots",
                "UAC-0113",
                "UAC-0082",
                "APT44",
                "Quedagh",
                "VOODOO BEAR",
                "TEMP.Noble"
            ],
            "source_name": "MISPGALAXY:Sandworm",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d4e7cd9a-2290-4f89-a645-85b9a46d004b",
            "created_at": "2022-10-25T16:07:23.419513Z",
            "updated_at": "2025-03-27T02:02:09.790389Z",
            "deleted_at": null,
            "main_name": "Bronze Butler",
            "aliases": [
                "Bronze Butler",
                "CTG-2006",
                "Operation ENDTRADE",
                "RedBaldNight",
                "Stalker Panda",
                "Stalker Taurus",
                "TEMP.Tick",
                "Tick"
            ],
            "source_name": "ETDA:Bronze Butler",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "9002 RAT",
                "AngryRebel",
                "Blogspot",
                "Daserf",
                "Datper",
                "Elirks",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "HOMEUNIX",
                "HidraQ",
                "HomamDownloader",
                "Homux",
                "Hydraq",
                "Lilith",
                "Lilith RAT",
                "McRAT",
                "MdmBot",
                "Mimikatz",
                "Minzen",
                "Moudour",
                "Muirim",
                "Mydoor",
                "Nioupale",
                "PCRat",
                "POISONPLUG.SHADOW",
                "Roarur",
                "RoyalRoad",
                "ShadowPad Winnti",
                "ShadowWali",
                "ShadowWalker",
                "SymonLoader",
                "WCE",
                "Wali",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "XShellGhost",
                "XXMM",
                "gsecdump",
                "rarstar"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "bf0489c5-1c07-41e6-91c9-855ad96ccc6a",
            "created_at": "2022-10-25T16:47:55.541639Z",
            "updated_at": "2025-03-27T02:05:17.253496Z",
            "deleted_at": null,
            "main_name": "BRONZE BUTLER",
            "aliases": [
                "Daserf",
                "Stalker Panda ",
                "Tick ",
                "CTG-2006 "
            ],
            "source_name": "Secureworks:BRONZE BUTLER",
            "tools": [
                " DGet",
                " Daserf",
                " Datper",
                " Gofarer",
                " MSGet",
                " Mimikatz",
                " RarStar",
                " Screen Capture Tool",
                " ShadowPad",
                " T-SMB",
                " WinRAR",
                " Windows Credential Editor",
                " gsecdump",
                " xmm downloader",
                " xxmm",
                "ABK"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "d11c89bb-1640-45fa-8322-6f4e4053d7f3",
            "created_at": "2022-10-25T15:50:23.509601Z",
            "updated_at": "2025-03-27T02:00:55.487991Z",
            "deleted_at": null,
            "main_name": "Turla",
            "aliases": [
                "Turla",
                "IRON HUNTER",
                "Group 88",
                "Waterbug",
                "WhiteBear",
                "Krypton",
                "Venomous Bear",
                "Secret Blizzard",
                "BELUGASTURGEON"
            ],
            "source_name": "MITRE:Turla",
            "tools": [
                "PsExec",
                "nbtstat",
                "ComRAT",
                "netstat",
                "certutil",
                "KOPILUWAK",
                "IronNetInjector",
                "LunarWeb",
                "Arp",
                "Uroburos",
                "PowerStallion",
                "Kazuar",
                "Systeminfo",
                "LightNeuron",
                "Mimikatz",
                "Tasklist",
                "LunarMail",
                "HyperStack",
                "NBTscan",
                "TinyTurla",
                "Penquin",
                "LunarLoader"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1666716494,
    "ts_updated_at": 1743041780,
    "ts_creation_date": 1556739457,
    "ts_modification_date": 1556739461,
    "files": {
        "pdf": "https://archive.orkl.eu/44ea6ae12ca986a5d64d3207c7aa4fb3cf33559f.pdf",
        "text": "https://archive.orkl.eu/44ea6ae12ca986a5d64d3207c7aa4fb3cf33559f.txt",
        "img": "https://archive.orkl.eu/44ea6ae12ca986a5d64d3207c7aa4fb3cf33559f.jpg"
    }
}