{
    "id": "6077079d-bfd9-42dc-ac80-e2fb52f46fa4",
    "created_at": "2023-01-12T15:06:54.66561Z",
    "updated_at": "2025-03-27T02:05:44.080359Z",
    "deleted_at": null,
    "sha1_hash": "a593d7fd2107a3c40f1738b38c1a6d35028c1761",
    "title": "2022-01-27 - Threat Thursday- WhisperGate Wiper Targets Government, Non-profit, and IT Organizations in Ukraine",
    "authors": "",
    "file_creation_date": "2022-05-28T23:21:21Z",
    "file_modification_date": "2022-05-28T23:21:21Z",
    "file_size": 1791133,
    "plain_text": "# Threat Thursday: WhisperGate Wiper Targets Government, Non- profit, and IT Organizations in Ukraine\n\n**[blogs.blackberry.com/en/2022/01/threat-thursday-whispergate-wiper](https://blogs.blackberry.com/en/2022/01/threat-thursday-whispergate-wiper)**\n\nThe BlackBerry Research & Intelligence Team\n\nEarlier this month, a potent wiper named WhisperGate targeted government, non-profit, and IT\norganizations in Ukraine with what initially appeared to be ransomware. The threat was in fact a\ndestructive wiper malware, carried out as a multi-stage attack. Thus far, it has been seen targeting\ndevices running the Windows operating system; however, the Ukrainian government reported that\nthere might also be a Linux variant of the malware lurking out there too.\n\nWhisperGate runs as a multi-stage attack, beginning by overwriting the Master Boot Record (MBR)\nand displaying a fake ransom note. The second and third stages involve retrieving the payload from a\nmalicious discord link. The final stage executes a file corruptor against target file types, irrecoverably\ndestroying data.\n\nNo encryption has been observed during any of the attack stages. The malware does not appear to\nhave been created for financial gain. Thus far, the sole purpose of WhisperGate seems to be the\ndestruction of data, making it most likely that a threat group is using this malware to disrupt or disable\ntarget organizations.\n\nGiven the escalating geopolitical events in Ukraine and its surrounding regions, BlackBerry strongly\nencourages organizations with an elevated risk profile to use the information in this blog to proactively\ndefend against any malicious activity from this group.\n\n\n-----\n\n### Operating System\n\n Risk & Impact\n\n Technical Analysis\n\n**Stage 1 – MBR Wiper**\n\nThe initial stage of this attack involves the malware gaining access to, then overwriting, the Master\nBoot Record (MBR) to display a fake ransom note the next time the system is booted. The MBR is\nused to identify how and where an operating system is located so that it can be loaded correctly.\nModification of the MBR can result in the system becoming inoperable.\n\nAccording to [Microsoft's initial report, the threat actor uses the Python tool](https://www.microsoft.com/security/blog/2022/01/15/destructive-malware-targeting-ukrainian-organizations/) [Impacket to perform lateral](https://github.com/SecureAuthCorp/impacket#:~:text=README.md-,What%20is%20Impacket%3F,MSRPC)%20the%20protocol%20implementation%20itself.)\nmovement and execute the malware. This is done using the following command.\n\n_“cmd.exe /Q /c start c:\\stage1exe 1> \\\\127.0.0.1\\ADMIN$\\_[TIMESTAMP] 2>&1” ._\n\n**SHA256: a196c6b8ffcb97ffb276d04f354696e2391311db3841ae16c8c9f56f36a38e92**\n\nThe initial file used by attackers is a Win32 binary called “stage1.exe.” When launched with\nadministrative privileges, the malware will load an 8192-byte buffer onto the stack. The process will\nretrieve a handle to the MBR by calling the “CreateFileW” function, as seen in the image below.\n\n\n-----\n\n_Figure 1 - Buffer and handle being created and written to disk_\n\nThe malware will then overwrite the MBR with this handle that contains the fake ransom note and a\nshellcode used to display it on the victim’s machine. As can be seen in Figure 2, a file of 512 bytes is\nwritten into the MBR in the first sector of the physical drive.\n\n_Figure 2 – Buffer handle overwriting the MBR with fake ransom note_\n\nThis buffer contains a ransom note (as seen in Figure 3) that is shown to the victim upon the next\nsystem reboot. The note contains a bitcoin wallet address and an ID for the Tox instant message\nsystem, along with a demand for $10,000 to recover the data. However, this note appears to be pure\nsubterfuge, since the victim’s MBR has been overwritten and partitions already destroyed.\n\n_Figure 3 - Fake ransom note displayed to victim after system reboot_\n\nWhisperGate does not force a reboot; instead, it waits for victims to reboot their systems themselves.\nThe delayed reboot allows the malware time to launch additional stages of the attack chain, as\ndetailed below.\n\n**Stage 2 – Downloader**\n\n**SHA256: dcbbae5a1c61dbbbb7dcd6dc5dd1eb1169f5329958d38b58c3fd9384081c9b78**\n\nThe second stage of this attack involves the use of a .NET malware. This file is a downloader used to\ncreate an HTTP connection with a hardcoded Discord content delivery network link. This link (seen in\nFigure 4) hosts a JPG file called “Tbopbh.jpg,” which contains the malicious payload required to\ninitiate stage 3 of this attack. This file has the same name as the decompiled assembly of the second\nstage loader.\n\n\n-----\n\n_Figure 4 - Discord download link for third stage malware_\n\nBefore reaching out to the Discord server, the file utilizes PowerShell (shown in Figure 5) to launch a\nBase64 encoded command that performs a sleep function for 20 seconds. This delay aids the\nmalware in remaining undetected on the target machine.\n\n_Figure 5 - PowerShell used to perform sleep function for 20 seconds_\n\nThe loader creates a connection with the Discord server hosted at 162[.]159[.]135[.]233 as shown\nbelow, in order to retrieve the next stage.\n\n_Figure 6 - Stage 2 loader creates TCP connection with Discord server_\n\n**Stage 3 – Injector**\n\n**SHA256: 923eb77b3c9e11d6c56052318c119c1a22d11ab71675e6b95d05eeb73d1accd6**\n\nThe retrieved payload for Stage 3 is a .NET assembly file, which is obfuscated by using the reverse\norder of each byte in the file. When the byte order of the payload has been reversed, it results in a\nWin32 DLL (Dynamic Link Library) file called “Frkmlkdkdubkznbkmcf.dll.” The assembly contains three\nresources, as shown in Figure 7.\n\n\n-----\n\n_Figure 7 - Assembly containing three resources_\n\nThe resource “78c855a088924e92a7f60d661c3d1845” is loaded into memory and is decoded by an\nXOR operation. The result of this is another .NET DLL file called\n“zx_fee6cce9db1d42510801fc1ed0e09452.dll.” This decoded file contains two additional resources\ncalled “AdvancedRun” and “Waqybg.”\n\n_Figure 8 - Additional Resources \"AdvancedRun\" and \"Waqybg\"_\n\nThe resource “AdvancedRun” is used to stop Windows Defender from running, and to delete it from\nmemory. It does this by invoking PowerShell and executing multiple commands.\n\n**Stage 4 – File Corruptor**\n\n**SHA256: 34ca75a8c190f20b8a7596afeb255f2228cb2467bd210b2637965b61ac7ea907**\n\nThe final stage of this malware is the file corruptor stage. Here the resource “Waqybg” is executed and\nbegins overwriting the start of each targeted file with 1MB of static data. During analysis, this resulted\nin hard disk space filling up rapidly and the virtual machine (VM) used by our researchers crashing.\n\n\n-----\n\nThe following is the list of the hardcoded file extensions that this malware targets. Once the file is\nencrypted, the file corruptor will append a random four-byte extension to the file name: for example,\n“File.1234.”\n\n.HTML .HTM .PHTML .PHP .JSP .ASP .PHPS .PHP5 .ASPX .PHP4 .PHP3 .DOC .DOCX .XLS\n.XLSX .PPT .PPTX .PST .MSG .EML .TXT .CSV .RTF .WKS .WK1 .PDF .DWG .JPEG .JPG\n.DOCM .DOT .DOTM .XLSM .XLSB .XLW .XLT .XLM .XLC .XLTX .XLTM .PPTM .POT .PPS .PPSM\n.PPSX .HWP .SXI .STI .SLDX .SLDM .BMP .PNG .GIF .RAW .TIF .TIFF .PSD .SVG .CLASS .JAR\n.SCH .VBS .BAT .CMD .ASM .PAS .CPP .SXM .STD .SXD .ODP .WB2 .SLK .DIF .STC .SXC .ODS\n.3DM .MAX .3DS .STW .SXW .ODT .PEM .P12 .CSR .CRT .KEY .PFX .DER .OGG .JAVA .INC .INI\n.PPK .LOG .VDI .VMDK .VHD .MDF .MYI .MYD .FRM .SAV .ODB .DBF .MDB .ACCDB .SQL\n.SQLITEDB .SQLITE3 .LDF .ARC .BAK .TAR .TGZ .RAR .ZIP .BACKUP .ISO .CONFIG\n\nOnce the file corruptor has completed overwriting the targeted files, it will execute the following ping\ncommand to remove itself from the machine.\n\n_“cmd.exe /min /C ping 111.111.111.111 -n 5 -w 10 > Nul & Del /f /q \\”[Filepath]\\”_\n\n### Conclusion\n\nThe multi-stage attack method and stealth techniques of WhisperGate make it a unique piece of very\ndestructive malware. Through analysis, it becomes apparent that the goal of the malware is to cause\ndisruption at the targeted organization, rather than pursuit of any financial gain.\n\nAs this is still an ongoing investigation and BlackBerry’s analysis continues, we will share more\ninformation as soon as it becomes available. This will likely not be the last we hear about\nWhisperGate – especially if the possible existence of a Linux version of the wiper is confirmed. Stay\ntuned for further updates in next week’s blog.\n\n### YARA Rule\n\nThe following YARA rule was authored by the BlackBerry Research & Intelligence Team to catch the\nthreat described in this document:\n\n**rule Stage_1**\n\n{\nmeta:\ndescription = \"Detects Stage 1 WhisperGate\"\n\nauthor = \"BlackBerry Threat Research\"\n\ndate = \"2022-01-17\"\n\nlicense = \"This Yara rule is provided under the Apache License 2.0\n(https://www.apache.org/licenses/LICENSE-2.0) and open to any user or organization, as long as\nyou use it under this license and ensure originator credit in any derivative to The BlackBerry\nResearch & Intelligence Team\"\n\nstrings:\n\n// Regex for ransom note in MBR\n\n$re1 = /You should pay us \\$[0-9]{1,3}k via bitcoin wallet/\n\n\n-----\n\n// MBR signature\n$b1 = {55 AA}\n// Int 13 Bios interrupt\n$b2 = {CD 13}\n// Extended write interrupt code\n$b3 = {B4 43}\n\n// Strings in MBR replacement data\n$s1 = \"Your hard drive has been corrupted.\"\n$s2 = \"tox ID\"\n$s3 = \"We will contact you to give further instructions.\"\n\n// String used in CreateFileW call to open main physical drive\n$s4 = \"\\\\\\\\.\\\\PhysicalDrive0\" wide\n\n// The hardcoded data it uses to overwrite the MBR\n\ncondition:\n// MZ header\nuint16(0) == 0x5a4d and\n\n((all of ($b*) and 2 of ($s*)) or (all of ($s*) and $re1))\n}\n\nimport \"pe\"\n\n**rule Stage2**\n{\nmeta:\ndescription = \"Detects WhisperGate Stage 2\"\nauthor = \"BlackBerry Threat Research\"\ndate = \"2022-01-17\"\nlicense = \"This Yara rule is provided under the Apache License 2.0\n(https://www.apache.org/licenses/LICENSE-2.0) and open to any user or organization, as long as\nyou use it under this license and ensure originator credit in any derivative to The BlackBerry\nResearch & Intelligence Team\"\n\nstrings:\n// Regex for any attachment link coming from the same discord channel\n$re1 = /https:\\/\\/cdn\\.discordapp\\.com\\/attachments\\/928503440139771947\\/[0-9]{18}\\/[^<>:\"\\/\\|?\n*]*\\b/ wide\n\n// 3 strings combined to make powershell command that evaluates to \"Start-Sleep -s 10\"\n$s1 = \"powershell\" wide\n$s2 = \"-enc UwB0AGEAcgB0AC\" wide\n$s3 = \"0AUwBsAGUAZQBwACAALQBzACAAMQAwAA==\" wide\n\n// The method name being looked for in stage 3\n$s4 = \"Ylfwdwgmpilzyaph\" wide\n\n// Used with .Replace(\"x\", \"\") for reflection on WebClient to get DownloadData method\n$s5 = \"DxownxloxadDxatxxax\" wide\n\ncondition:\n// MZ header\nuint16(0) == 0x5a4d and\n// is a .NET binary\npe.data_directories[pe.IMAGE_DIRECTORY_ENTRY_COM_DESCRIPTOR].size != 0 and\n\n\n-----\n\n$re1 and 2 of ($s )\n}\n\n**rule Stage3**\n{\nmeta:\ndescription = \"Detects WhisperGate Stage 3\"\nauthor = \"BlackBerry Threat Research\"\ndate = \"2022-01-17\"\nlicense = \"This Yara rule is provided under the Apache License 2.0\n(https://www.apache.org/licenses/LICENSE-2.0) and open to any user or organization, as long as\nyou use it under this license and ensure originator credit in any derivative to The BlackBerry\nResearch & Intelligence Team\"\n\nstrings:\n// The same as a string from stage2, not sure what it is\n$s1 = \"Ylfwdwgmpilzyaph\"\n// Names of resources\n$s3 = \"78c855a088924e92a7f60d661c3d1845\"\n$s4 = \"7c8cb5598e724d34384cce7402b11f0e\"\n\ncondition:\n// MZ header\nuint16(0) == 0x5a4d and\n// is a .NET binary\npe.data_directories[pe.IMAGE_DIRECTORY_ENTRY_COM_DESCRIPTOR].size != 0 and\n\nall of them\n}\n\nimport \"pe\"\n\n**rule Stage3_reversed**\n{\nmeta:\ndescription = \"Detects WhisperGate Stage 3 Reversed\"\nauthor = \"BlackBerry Threat Research\"\ndate = \"2022-01-17\"\nlicense = \"This Yara rule is provided under the Apache License 2.0\n(https://www.apache.org/licenses/LICENSE-2.0) and open to any user or organization, as long as\nyou use it under this license and ensure originator credit in any derivative to The BlackBerry\nResearch & Intelligence Team\"\n\nstrings:\n// This string was also in stage2 so defo want to look into it\n// but this is the reversed version because Stage3 is backwards\n$s1 = \"hpayzlipmgwdwflY\"\n// Names of resources backwards\n$s3 = \"5481d3c166d06f7a29e429880a558c87\"\n$s4 = \"e0f11b2047ecc48343d427e8955bc8c7\"\n\ncondition:\n// MZ header backwards at the end of the file\nuint16(filesize-2) == 0x4d5a and\n\nall of them\n}\n\n\n-----\n\n### Indicators of Compromise (IoCs)\n\n**Files**\n\na196c6b8ffcb97ffb276d04f354696e2391311db3841ae16c8c9f56f36a38e92 (Stage 1)\n\ndcbbae5a1c61dbbbb7dcd6dc5dd1eb1169f5329958d38b58c3fd9384081c9b78 (Stage 2)\n\n923eb77b3c9e11d6c56052318c119c1a22d11ab71675e6b95d05eeb73d1accd6 (Stage 3)\n\n9ef7dbd3da51332a78eff19146d21c82957821e464e8133e9594a07d716d892d (Stage 3 Reversed)\n\n34ca75a8c190f20b8a7596afeb255f2228cb2467bd210b2637965b61ac7ea907 (File Wiper)\n\n35feefe6bd2b982cb1a5d4c1d094e8665c51752d0a6f7e3cae546d770c280f3a (Decoded Resource)\n\n**Bitcoin Wallet Address**\n\n1AVNM68gj6PGPFcJuftKATa4WLnzg8fpfv\n\n**ToxID**\n\n8BEDC411012A33BA34F49130D0F186993C6A32DAD8976F6A5D82C1ED23054C057ECED5496F65\n\n**Discord Link**\n\nhttps[:]//cdn.discordapp[.]com/attachments/928503440139771947/930108637681184768/Tbopbh.jpg\n\n**IP Address**\n\n162[.]159[.]135[.]233\n\n### BlackBerry Assistance\n\nIf you’re battling this malware or a similar threat, you’ve come to the right place, regardless of your\nexisting BlackBerry relationship.\n\n[The BlackBerry Incident Response team is made up of world-class consultants dedicated to handling](https://www.blackberry.com/us/en/services/incident-response)\nresponse and containment services for a wide range of incidents, including ransomware and\nAdvanced Persistent Threat (APT) cases.\n\nWe have a global consulting team standing by to assist you providing around-the-clock support, where\nrequired, as well as local assistance. Please contact us\nhere: https://www.blackberry.com/us/en/forms/cylance/handraiser/emergency-incident-responsecontainment\n\n\n-----\n\n## About The BlackBerry Research & Intelligence Team\n\nThe BlackBerry Research & Intelligence team examines emerging and persistent threats, providing\nintelligence analysis for the benefit of defenders and the organizations they serve.\n\nBack\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-01-27 - Threat Thursday- WhisperGate Wiper Targets Government, Non-profit, and IT Organizations in Ukraine.pdf"
    ],
    "report_names": [
        "2022-01-27 - Threat Thursday- WhisperGate Wiper Targets Government, Non-profit, and IT Organizations in Ukraine.pdf"
    ],
    "threat_actors": [
        {
            "id": "921cea27-4410-42e4-8c11-7d40ba313225",
            "created_at": "2023-01-06T13:46:39.375789Z",
            "updated_at": "2025-03-27T02:00:03.067286Z",
            "deleted_at": null,
            "main_name": "RansomHouse",
            "aliases": [],
            "source_name": "MISPGALAXY:RansomHouse",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536014,
    "ts_updated_at": 1743041144,
    "ts_creation_date": 1653780081,
    "ts_modification_date": 1653780081,
    "files": {
        "pdf": "https://archive.orkl.eu/a593d7fd2107a3c40f1738b38c1a6d35028c1761.pdf",
        "text": "https://archive.orkl.eu/a593d7fd2107a3c40f1738b38c1a6d35028c1761.txt",
        "img": "https://archive.orkl.eu/a593d7fd2107a3c40f1738b38c1a6d35028c1761.jpg"
    }
}