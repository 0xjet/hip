{
    "id": "4104f25d-febc-481e-a44e-8c72c006e280",
    "created_at": "2023-01-12T15:05:52.273301Z",
    "updated_at": "2025-03-27T02:06:08.138611Z",
    "deleted_at": null,
    "sha1_hash": "083813176c3809ec566f0a61638a74780950f411",
    "title": "2021-08-19 - Ragnar Locker – Malware analysis",
    "authors": "",
    "file_creation_date": "2022-05-28T21:48:19Z",
    "file_modification_date": "2022-05-28T21:48:19Z",
    "file_size": 2499544,
    "plain_text": "# Ragnar Locker – Malware analysis\n\n**[seguranca-informatica.pt/ragnar-locker-malware-analysis/](https://seguranca-informatica.pt/ragnar-locker-malware-analysis/)**\n\nAugust 19, 2021\n\nThe [popularity of ransomware threats does not appear to be decreasing. Instead, more and](https://resources.infosecinstitute.com/top-6-malware-strains-to-watch-out-for/)\nsophisticated ransomware threats are being deployed. Ragnar Locker is a new data\nencryption malware in this style.\n\nRagnar Locker is ransomware that affects devices running Microsoft Windows operating\nsystems. It was initially observed towards the end of December 2019 as part of a series of\nattacks against compromised networks.\n\nIn general, this malware is deployed manually after an initial compromise, network\nreconnaissance and pre-deployed tasks on the network. This shows that this is a more\ncomplex operation than most ransomware propagation campaigns.\n\nBefore starting the Ragnar Locker ransomware, attackers inject a module capable of\ncollecting sensitive data from infected machines and upload it to their servers. Next, threat\nactors behind the malware notify the victim the files will be released to the public if the\nransom is not paid.\n\n## Modus operandi\n\nThe next diagram shows how criminals are compromising infrastructures and organizations\nusing this data encryption malware.\n\n**_Figure 1: High-level diagram of the Ragnar Locker infection chain._**\n\n\n-----\n\nAs highlighted in the diagram above, there is a group of steps executed by Ragnar Locker\noperators every time an organization or infrastructure is impacted. Digging into the details,\nattackers first compromise networks, infrastructures, and organizations using found\nvulnerabilities or even through social engineering such as phishing attacks, spear phishing\n[and BEC attacks.](https://resources.infosecinstitute.com/bec-attacks-email-account-compromise-works/)\n\nDuring the compromise process, reconnaissance, pre-deployment tasks, and data exfiltration\nare performed before executing the piece of ransomware (Figure 1 — labels 1 and 2). When\nthe data exfiltration process is completed, a ransomware deployment is performed manually\n(label 3).\n\nNotice that each malware sample is unique, with the specific ransom note hardcoded inside\nthe malware. The affected group name, the links to the bitcoin wallet, and the links to a dark\nweb blog are embedded inside the binary as presented below.\n\n**_Figure 2: Parts of the ransom notes from the recent attacks._**\n\nWhen the ransomware starts, it enumerates running processes and stops if some of these\nservices contain specific strings, such as:\n\n\n-----\n\n```\nVss\nsql\nmemtas\nmepocs\nsophos\nveeam\nbackup\npulseway\nlogme\nlogmein\nconnectwise\nsplashtop\nKaseya\n\n```\nRansomware in this line often disables some services as a way to bypass security\nprotections and also database and backup systems to increase the impact of the attack.\nAlso, database and mail services are stopped so that their data can be encrypted during the\ninfection process.\n\nOne of the particularities that spotlight Ragnar Locker is that it is targeting specifically remote\nmanagement software often used by managed service providers (MSPs), such as the\npopular ConnectWise and Kaseya software.\n\nThis data encryption malware infects computers based on their language settings. When first\nstarted, Ragnar Locker checks the configured Windows language preferences. This piece of\nmalware terminates the process if the setting is configured as one of the former USSR\ncountries.\n\n**_Figure 3: Ragnar Locker stops when executed on former USSR countries._**\n\nAfter that, Ragnar Locker will begin the encryption process. When encrypting files, it will skip\nfiles in the following folders, file names and extensions.\n\nOne of the interesting findings is the “Tor browser” folder.\n\n\n-----\n\n**_Figure 4: Folders not encrypted by Ragnar Locker._**\n\nThis detail reveals this malware is also impacting security professionals and everyone that\nuse this specific web browser to navigate in the dark web. The completed list can be\nobserved in the following table.\n\n\n-----\n\n```\nkernel32.dll\nWindows\nWindows.old\nTor browser\nInternet Explorer\nGoogle\nOpera\nOpera Software\nMozilla\nMozilla Firefox\n$Recycle.Bin\nProgramData\nAll Users\nautorun.inf\nboot.ini\nbootfont.bin\nbootsect.bak\nbootmgr\nbootmgr.efi\nbootmgfw.efi\ndesktop.ini\niconcache.db\nntldr\nntuser.dat\nntuser.dat.log\nntuser.ini\nthumbs.db\n.sys\n.dll\n.lnk\n.msi\n.drv\n.exe\n\n```\nRagnar Locker adds the hardcoded extension “.ragnar_*” appended to the end of the file\nname and “*” is replaced by a generated and unique ID. All the available files inside physical\ndrives are encrypted and, in the end, the notepad.exe process is opened and showing the\nransom note file created on the victim’s system directory, as shown in the diagram below.\n\n\n-----\n\n**_Figure 5: Ragnar Locker encryption process._**\n\n\n-----\n\n**_Figure 6: Ransom note created on “Public Documents” folder._**\n\nIn detail, a ransom note file is dropped every folder, not including those observed in Table 2.\n\nThe ransom note file starts with the “RGNR_*” prefix, and the ID also used and appended to\nthe encrypted files.\n\n**_Figure 7: Ransom note file and parts of “Ragnar Secret key” redacted._**\n\nIn order to encrypt the files, the malware gets and decodes the ransom note from\nthe .keys sections, the public key and some configs.\n\n\n-----\n\n**_Figure 8: PE file .keys sections with the ransom note, encryption public key and other_**\n_configs encoded._\n\nThis section is decoded in runtime and can be observed below.\n\n\n-----\n\n-----\n\n**_Figure 9: Public key, configs and ransom note decoded during the malware execution._**\n\nWhen a file is encrypted, the “RAGNAR” file marker is also added to the end of each\nencrypted file.\n\n\n-----\n\n**_Figure 10: “RAGNAR” marker appended at the end of the encrypted file._**\n\nThis ransomware is not equipped with a mechanism to detect whether the computer has\nalready been compromised. A particularity is that if the malware reaches the same device\nmore than once, it will encrypt the device over and over again. Figure 11 presents this detail,\nwhere the files were encrypted three times by Ragnar Locker.\n\n**_Figure 11: The same device compromised three times by Ragnar Locker._**\n\nRagnar Locker and other mediatic ransomwares use several techniques and commands to\ndamage the Windows shadow copies. With this process in place, repairing potential data\nencryption attacks is harder.\n\n\n-----\n\n```\nvssadmin delete shadows /all /quiet\nwmic.exe shadowcopy delete\n\n## Ragnar blog, ransom page and chat\n\n```\nProof-of-Concept (PoC) files and images are published on the group blog on the dark web\n(Figure 1 — label 4) after a compromise.\n\n**_Figure 12: Ragnar Locker blog available on the dark web._**\n\n\n-----\n\n**_Figure 13: A leak of a specific group compromised by Ragnar Locker operators in mid-April_**\n_2020._\n\nInside the malware is hardcoded a link to a page with a countdown and the process to pay\nthe ransom.\n\n\n-----\n\n**_Figure 14: Countdown page with the bitcoin wallet and chat button._**\n\n\n-----\n\n**_Figure 15: Chat used to perform communications between ransomware operators and_**\n_victims._\n\n## Prevention measures\n\nWe are living in an era where ransomware continues to grow, and the number of attacks has\nincreased especially during the COVID-19 pandemic. There is no magic solution to prevent\nattacks of this nature, however, there is a set of good practices that can be applied in order\nto minimize the impact of data encryption attack.\n\nThe use of an antivirus is mandatory. This software should be regularly updated\nPatch updates regularly and update all the software including operating systems,\nnetwork devices, applications, mobile phones and other software if applicable\nMaintain a proper backup and restore mechanism and made it mandatory\nRegularly test the recovery function of backup and restore procedures and also test the\ndata integrity of backups\nConduct simulated ransomware preparedness tests. This is a rule of thumb to check\nthe response of your ecosystem against these kinds of attacks\nIf you use Microsoft Office, install Microsoft Office viewers and always keep macros\ndisabled by default\nLimit access to mapped drives whenever possible and keep file sharing disabled by\ndefault. In general, ransomware looks into shared drives and encrypts files available on\nthe network\nDon’t enable remote services. The organizations with RDP, VPN, proxies and servers\nare to be provided with better IT security standards.\n\n**[The article was initially published by Pedro Tavares on resources.infosecinstitute.com.](https://resources.infosecinstitute.com/topic/lazaruss-vhd-ransomware-malware-spotlight/)**\n\n\n-----\n\n**All rights reserved ®** **[infosecinstitute.com](http://infosecinstitute.com/)**\n\n[Pedro Tavares](https://seguranca-informatica.pt/author/pipocaz/)\n**[Pedro Tavares is a professional in the field of information security working as an Ethical](https://www.linkedin.com/in/sirpedrotavares/)**\nHacker/Pentester, Malware Researcher and also a Security Evangelist. He is also a founding\nmember at CSIRT.UBI and Editor-in-Chief of the security computer blog segurancainformatica.pt.\n\nIn recent years he has invested in the field of information security, exploring and analyzing a\nwide range of topics, such as pentesting (Kali Linux), malware, exploitation, hacking, IoT and\nsecurity in Active Directory networks. He is also Freelance Writer (Infosec. Resources\n[Institute and Cyber Defense Magazine) and developer of the 0xSI_f33d – a feed that](https://feed.seguranca-informatica.pt/)\ncompiles phishing and malware campaigns targeting Portuguese citizens.\n\n[Read more here.](https://seguranca-informatica.pt/contacto/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-08-19 - Ragnar Locker – Malware analysis.pdf"
    ],
    "report_names": [
        "2021-08-19 - Ragnar Locker – Malware analysis.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535952,
    "ts_updated_at": 1743041168,
    "ts_creation_date": 1653774499,
    "ts_modification_date": 1653774499,
    "files": {
        "pdf": "https://archive.orkl.eu/083813176c3809ec566f0a61638a74780950f411.pdf",
        "text": "https://archive.orkl.eu/083813176c3809ec566f0a61638a74780950f411.txt",
        "img": "https://archive.orkl.eu/083813176c3809ec566f0a61638a74780950f411.jpg"
    }
}