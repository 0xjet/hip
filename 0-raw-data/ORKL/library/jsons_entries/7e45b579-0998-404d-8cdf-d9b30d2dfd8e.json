{
    "id": "7e45b579-0998-404d-8cdf-d9b30d2dfd8e",
    "created_at": "2023-01-12T15:05:34.132051Z",
    "updated_at": "2025-03-27T02:05:32.90932Z",
    "deleted_at": null,
    "sha1_hash": "2882fbf19737761f111fab9edb4a49607a898d67",
    "title": "2022-10-04 - Alert (AA22-277A) Impacket and Exfiltration Tool Used to Steal Sensitive Information from Defense Industrial Base Organization",
    "authors": "",
    "file_creation_date": "2022-10-23T13:32:37Z",
    "file_modification_date": "2022-10-23T13:32:37Z",
    "file_size": 381767,
    "plain_text": "# Impacket and Exfiltration Tool Used to Steal Sensitive Information from Defense Industrial Base Organization\n\n**cisa.gov/uscert/ncas/alerts/aa22-277a**\n\n## Summary\n\n**Actions to Help Protect Against APT Cyber Activity:**\n\n- Enforce multifactor authentication (MFA) on all user accounts.\n\n- Implement network segmentation to separate network segments based on role and\nfunctionality.\n\n- Update software, including operating systems, applications, and firmware, on network\nassets.\n\n- Audit account usage.\nFrom November 2021 through January 2022, the Cybersecurity and Infrastructure Security\nAgency (CISA) responded to advanced persistent threat (APT) activity on a Defense\nIndustrial Base (DIB) Sector organization’s enterprise network. During incident response\nactivities, CISA uncovered that likely multiple APT groups compromised the organization’s\nnetwork, and some APT actors had long-term access to the environment. APT actors used\nan open-source toolkit called Impacket to gain their foothold within the environment and\nfurther compromise the network, and also used a custom data exfiltration tool,\nCovalentStealer, to steal the victim’s sensitive data.\n\nThis joint Cybersecurity Advisory (CSA) provides APT actors tactics, techniques, and\nprocedures (TTPs) and indicators of compromise (IOCs) identified during the incident\nresponse activities by CISA and a third-party incident response organization. The CSA\nincludes detection and mitigation actions to help organizations detect and prevent related\nAPT activity. CISA, the Federal Bureau of Investigation (FBI), and the National Security\nAgency (NSA) recommend DIB sector and other critical infrastructure organizations\nimplement the mitigations in this CSA to ensure they are managing and reducing the impact\nof cyber threats to their networks.\n\n[Download the PDF version of this report: pdf, 692 KB](https://www.cisa.gov/sites/default/files/publications/aa22-277a-impacket-and-exfiltration-tool-used-to-steal-sensitive-information-from-defense-industrial-base-organization.pdf)\n\nFor a downloadable copy of IOCs, see the following files:\n\n## Technical Details\n\n**Threat Actor Activity**\n\n\n-----\n\n**[Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 11. See](https://attack.mitre.org/versions/v11/matrices/enterprise/)**\n_the MITRE ATT&CK Tactics and Techniques section for a table of the APT cyber activity_\n_mapped to MITRE ATT&CK for Enterprise framework._\n\nFrom November 2021 through January 2022, CISA conducted an incident response\nengagement on a DIB Sector organization’s enterprise network. The victim organization also\nengaged a third-party incident response organization for assistance. During incident\nresponse activities, CISA and the trusted –third-party identified APT activity on the victim’s\nnetwork.\n\nSome APT actors gained initial access to the organization’s Microsoft Exchange Server as\nearly as mid-January 2021. The initial access vector is unknown. Based on log analysis, the\nactors gathered information about the exchange environment and performed mailbox\nsearches within a four-hour period after gaining access. In the same period, these actors\nused a compromised administrator account (“Admin 1”) to access the EWS Application\nProgramming Interface (API). In early February 2021, the actors returned to the network and\nused Admin 1 to access EWS API again. In both instances, the actors used a virtual private\nnetwork (VPN).\n\nFour days later, the APT actors used Windows Command Shell over a three-day period to\ninteract with the victim’s network. The actors used Command Shell to learn about the\norganization’s environment and to collect sensitive data, including sensitive contract-related\ninformation from shared drives, for eventual exfiltration. The actors manually collected files\nusing the command-line tool, WinRAR. These files were split into approximately 3MB chunks\nlocated on the Microsoft Exchange server within the CU2\\he\\debug directory. See Appendix:\nWindows Command Shell Activity for additional information, including specific commands\nused.\n\n[During the same period, APT actors implanted Impacket, a Python toolkit for](https://attack.mitre.org/versions/v11/software/S0357/)\nprogrammatically constructing and manipulating network protocols, on another system. The\nactors used Impacket to attempt to move laterally to another system.\n\nIn early March 2021, APT actors exploited CVE-2021-26855, CVE-2021-26857, CVE-202126858, and CVE-2021-27065 to install 17 China Chopper webshells on the Exchange\nServer. Later in March, APT actors installed HyperBro on the Exchange Server and two other\nsystems. For more information on the HyperBro and webshell samples, see CISA MAR10365227-2 and [-3.](https://www.cisa.gov/uscert/ncas/analysis-reports/ar22-277c)\n\nIn April 2021, APT actors used Impacket for network exploitation activities. See the Use of\nImpacket section for additional information. From late July through mid-October 2021, APT\nactors employed a custom exfiltration tool, CovalentStealer, to exfiltrate the remaining\nsensitive files. See the Use of Custom Exfiltration Tool: CovalentStealer section for additional\ninformation.\n\n\n-----\n\nAPT actors maintained access through mid-January 2022, likely by relying on legitimate\ncredentials.\n\n**Use of Impacket**\n\nCISA discovered activity indicating the use of two Impacket tools: wmiexec.py and\nsmbexec.py. These tools use Windows Management Instrumentation (WMI) and Server\nMessage Block (SMB) protocol, respectively, for creating a semi-interactive shell with the\ntarget device. Through the Command Shell, an Impacket user with credentials can run\ncommands on the remote device using the Windows management protocols required to\nsupport an enterprise network.\n\nThe APT cyber actors used existing, compromised credentials with Impacket to access a\nhigher privileged service account used by the organization's multifunctional devices. The\nthreat actors first used the service account to remotely access the organization’s Microsoft\nExchange server via Outlook Web Access (OWA) from multiple external IP addresses;\nshortly afterwards, the actors assigned the Application Impersonation role to the service\naccount by running the following PowerShell command for managing Exchange:\n\npowershell add-pssnapin *exchange*;New-ManagementRoleAssignment - name:\"JournalingLogs\" -Role:ApplicationImpersonation -User:<account>\n\nThis command gave the service account the ability to access other users’ mailboxes.\n\nThe APT cyber actors used virtual private network (VPN) and virtual private server (VPS)\nproviders, M247 and SurfShark, as part of their techniques to remotely access the Microsoft\nExchange server. Use of these hosting providers, which serves to conceal interaction with\nvictim networks, are common for these threat actors. According to CISA’s analysis of the\nvictim’s Microsoft Exchange server Internet Information Services (IIS) logs, the actors used\nthe account of a former employee to access the EWS. EWS enables access to mailbox items\nsuch as email messages, meetings, and contacts. The source IP address for these\nconnections is mostly from the VPS hosting provider, M247.\n\n**Use of Custom Exfiltration Tool: CovalentStealer**\n\nThe threat actors employed a custom exfiltration tool, CovalentStealer, to exfiltrate sensitive\nfiles.\n\nCovalentStealer is designed to identify file shares on a system, categorize the files, and\nupload the files to a remote server. CovalentStealer includes two configurations that\nspecifically target the victim's documents using predetermined files paths and user\ncredentials. CovalentStealer stores the collected files on a Microsoft OneDrive cloud folder,\nincludes a configuration file to specify the types of files to collect at specified times and uses\n[a 256-bit AES key for encryption. See CISA MAR-10365227-1 for additional technical details,](https://www.cisa.gov/uscert/ncas/analysis-reports/ar22-277a)\nincluding IOCs and detection signatures\n\n\n-----\n\n**MITRE ATT&CK Tactics and Techniques**\n\nMITRE ATT&CK is a globally accessible knowledge base of adversary tactics and techniques\nbased on real-world observations. CISA uses the ATT&CK Framework as a foundation for\nthe development of specific threat models and methodologies. Table 1 lists the ATT&CK\ntechniques employed by the APT actors.\n\n_Table 1: Identified APT Enterprise ATT&CK Tactics and Techniques_\n\n\n**Initial Access**\n\n\n**Technique Title** **ID** **Use**\n\nValid Accounts [T1078](https://attack.mitre.org/versions/v11/techniques/T1078/) Actors obtained and abused credentials of existing\naccounts as a means of gaining Initial Access,\nPersistence, Privilege Escalation, or Defense\nEvasion. In this case, they exploited an\norganization’s multifunctional device domain account\nused to access the organization’s Microsoft\nExchange server via OWA.\n\n\n**Execution**\n\n\n**Technique Title** **ID** **Use**\n\n\nWindows\nManagement\nInstrumentation\n\n\nCommand and\nScripting Interpreter\n\n\nCommand and\nScripting Interpreter:\nPowerShell\n\n\n[T1047](https://attack.mitre.org/versions/v11/techniques/T1047/) Actors used Impacket tools wmiexec.py and\nsmbexec.py to leverage Windows Management\nInstrumentation and execute malicious commands.\n\n[T1059](https://attack.mitre.org/versions/v11/techniques/T1059/003/) Actors abused command and script interpreters to\nexecute commands.\n\n[T1059.001](https://attack.mitre.org/techniques/T1059/001) Actors abused PowerShell commands and scripts\nto map shared drives by specifying a path to one\nlocation and retrieving the items from another. See\nAppendix: Windows Command Shell Activity for\nadditional information.\n\n\n-----\n\nCommand and\nScripting Interpreter:\nWindows Command\nShell\n\n\n[T1059.003](https://attack.mitre.org/versions/v11/techniques/T1059/003/) Actors abused the Windows Command Shell to\nlearn about the organization’s environment and to\ncollect sensitive data. See Appendix: Windows\nCommand Shell Activity for additional information,\nincluding specific commands used.\n\n\nThe actors used Impacket tools, which enable a user\nwith credentials to run commands on the remote\ndevice through the Command Shell.\n\n\nCommand and\nScripting Interpreter:\nPython\n\n\n[T1059.006](https://attack.mitre.org/versions/v11/techniques/T1059/006/) The actors used two Impacket tools: wmiexec.py\nand smbexec.py.\n\n\nShared Modules [T1129](https://attack.mitre.org/techniques/T1129) Actors executed malicious payloads via loading\nshared modules. The Windows module loader can\nbe instructed to load DLLs from arbitrary local paths\nand arbitrary Universal Naming Convention (UNC)\nnetwork paths.\n\nSystem Services [T1569](https://attack.mitre.org/versions/v11/techniques/T1569/) Actors abused system services to execute\ncommands or programs on the victim’s network.\n\n\n**Persistence**\n\n\n**Technique Title** **ID** **Use**\n\nValid Accounts [T1078](https://attack.mitre.org/versions/v11/techniques/T1078/) Actors obtained and abused credentials of existing\naccounts as a means of gaining Initial Access,\nPersistence, Privilege Escalation, or Defense\nEvasion.\n\n\nCreate or Modify\nSystem Process\n\n\n[T1543](https://attack.mitre.org/versions/v11/techniques/T1543/) Actors were observed creating or modifying system\nprocesses.\n\n\n**Privilege Escalation**\n\n\n**Technique Title** **ID** **Use**\n\n\n-----\n\nValid Accounts [T1078](https://attack.mitre.org/versions/v11/techniques/T1078/) Actors obtained and abused credentials of existing\naccounts as a means of gaining Initial Access,\nPersistence, Privilege Escalation, or Defense\nEvasion. In this case, they exploited an\norganization’s multifunctional device domain account\nused to access the organization’s Microsoft\nExchange server via OWA.\n\n\n**Defense Evasion**\n\n\n**Technique Title** **ID** **Use**\n\n\nMasquerading: Match\nLegitimate Name or\nLocation\n\n\nIndicator Removal on\nHost\n\n\nIndicator Removal on\nHost: File Deletion\n\n\n[T1036.005](https://attack.mitre.org/versions/v11/techniques/T1036/005) Actors masqueraded the archive utility WinRAR.exe\nby renaming it VMware.exe to evade defenses and\nobservation.\n\n[T1070](https://attack.mitre.org/versions/v11/techniques/T1070/004/) Actors deleted or modified artifacts generated on a\nhost system to remove evidence of their presence or\nhinder defenses.\n\n[T1070.004](https://attack.mitre.org/versions/v11/techniques/T1070/004/) Actors used the del.exe command with the /f\nparameter to force the deletion of read-only files with\nthe *.rar and tempg* wildcards.\n\n\nValid Accounts [T1078](https://attack.mitre.org/versions/v11/techniques/T1078/) Actors obtained and abused credentials of existing\naccounts as a means of gaining Initial Access,\nPersistence, Privilege Escalation, or Defense\nEvasion. In this case, they exploited an\norganization’s multifunctional device domain account\nused to access the organization’s Microsoft\nExchange server via OWA.\n\n\nVirtualization/Sandbox\nEvasion: System\nChecks\n\n\n[T1497.001](https://attack.mitre.org/techniques/T1497/001) Actors used Windows command shell commands\nto detect and avoid virtualization and analysis\nenvironments. See Appendix: Windows Command\nShell Activity for additional information.\n\n[T1562.001](https://attack.mitre.org/techniques/T1562/001) Actors used the taskkill command to probably\ndisable security features. CISA was unable to\ndetermine which application was associated with the\nProcess ID.\n\n\nImpair Defenses:\nDisable or Modify\nTools\n\n\nHijack Execution Flow [T1574](https://attack.mitre.org/versions/v11/techniques/T1574/) Actors were observed using hijack execution flow.\n\n\n-----\n\n**Discovery**\n\n\n**Technique Title** **ID** **Use**\n\n\nSystem Network\nConfiguration\nDiscovery\n\n\n[T1016](https://attack.mitre.org/techniques/T1016) Actors used the systeminfo command to look for\ndetails about the network configurations and settings\nand determine if the system was a VMware virtual\nmachine.\n\n\nThe threat actor used route print to display the\nentries in the local IP routing table.\n\n\nSystem Network\nConfiguration\nDiscovery: Internet\nConnection Discovery\n\n\n[T1016.001](https://attack.mitre.org/techniques/T1016/001) Actors checked for internet connectivity on\ncompromised systems. This may be performed\nduring automated discovery and can be\naccomplished in numerous ways.\n\n[T1033](https://attack.mitre.org/techniques/T1033) Actors attempted to identify the primary user,\ncurrently logged in user, set of users that commonly\nuse a system, or whether a user is actively using the\nsystem.\n\n[T1049](https://attack.mitre.org/techniques/T1049) Actors used the netstat command to display TCP\nconnections, prevent hostname determination of\nforeign IP addresses, and specify the protocol for\nTCP.\n\n\nSystem Owner/User\nDiscovery\n\n\nSystem Network\nConnections\nDiscovery\n\n\nProcess Discovery [T1057](https://attack.mitre.org/techniques/T1057) Actors used the tasklist command to get information\nabout running processes on a system and determine\nif the system was a VMware virtual machine.\n\n\nThe actors used tasklist.exe and find.exe to display\na list of applications and services with their PIDs for\nall tasks running on the computer matching the\nstring “powers.”\n\n\nSystem Information\nDiscovery\n\n\n[T1082](https://attack.mitre.org/techniques/T1082) Actors used the ipconfig command to get detailed\ninformation about the operating system and\nhardware and determine if the system was a\nVMware virtual machine.\n\n[T1083](https://attack.mitre.org/techniques/T1083) Actors enumerated files and directories or may\nsearch in specific locations of a host or network\nshare for certain information within a file system.\n\n\nFile and Directory\nDiscovery\n\n\n-----\n\nVirtualization/Sandbox\nEvasion: System\nChecks\n\n\n[T1497.001](https://attack.mitre.org/techniques/T1497/001) Actors used Windows command shellcommands to\ndetect and avoid virtualization and analysis\nenvironments.\n\n\n**Lateral Movement**\n\n\n**Technique Title** **ID** **Use**\n\n\nRemote Services:\nSMB/Windows Admin\nShares\n\n\n[T1021.002](https://attack.mitre.org/techniques/T1021/002) Actors used Valid Accounts to interact with a remote\nnetwork share using Server Message Block (SMB)\nand then perform actions as the logged-on user.\n\n\n**Collection**\n\n\n**Technique Title** **ID** **Use**\n\n\nArchive Collected\nData: Archive via\nUtility\n\n\nData from Network\nShared Drive\n\n\n[T1560.001](https://attack.mitre.org/techniques/T1560) Actor used PowerShell commands and WinRAR to\ncompress and/or encrypt collected data prior to\nexfiltration.\n\n[T1039](https://attack.mitre.org/versions/v11/techniques/T1039/) Actors likely used net share command to display\ninformation about shared resources on the local\ncomputer and decide which directories to exploit, the\npowershell dircommand to map shared drives to a\nspecified path and retrieve items from another, and\nthe ntfsinfo command to search network shares on\ncomputers they have compromised to find files of\ninterest.\n\n\nThe actors used dir.exe to display a list of a\ndirectory's files and subdirectories matching a\ncertain text string.\n\n\nData Staged: Remote\nData Staging\n\n\n[T1074.002](https://attack.mitre.org/versions/v11/techniques/T1074/002/) The actors split collected files into approximately\n\n3 MB chunks located on the Exchange server within\nthe CU2\\he\\debug directory.\n\n\n**Command and**\n**Control**\n\n\n**Technique Title** **ID** **Use**\n\n\n-----\n\nNon-Application Layer\nProtocol\n\n\n[T1095](https://attack.mitre.org/techniques/T1095) Actors used a non-application layer protocol for\ncommunication between host and Command and\nControl (C2) server or among infected hosts within a\nnetwork.\n\n\nIngress Tool Transfer [T1105](https://attack.mitre.org/versions/v11/techniques/T1105/) Actors used the certutil command with three\nswitches to test if they could download files from the\ninternet.\n\n\nThe actors employed CovalentStealer to exfiltrate\nthe files.\n\n\nProxy [T1090](https://attack.mitre.org/versions/v11/techniques/T1090/) Actors are known to use VPN and VPS providers,\nnamely M247 and SurfShark, as part of their\ntechniques to access a network remotely.\n\n\n**Exfiltration**\n\n\n**Technique Title** **ID** **Use**\n\nSchedule Transfer [T1029](https://attack.mitre.org/versions/v11/techniques/T1029/) Actors scheduled data exfiltration to be performed\nonly at certain times of day or at certain intervals\nand blend traffic patterns with normal activity.\n\n\nExfiltration Over Web\nService: Exfiltration to\nCloud Storage\n\n\n[T1567.002](https://attack.mitre.org/versions/v11/techniques/T1567/002) The actor's CovalentStealer tool stores collected\nfiles on a Microsoft OneDrive cloud folder.\n\n\n## DETECTION\n\nGiven the actors’ demonstrated capability to maintain persistent, long-term access in\ncompromised enterprise environments, CISA, FBI, and NSA encourage organizations to:\n\n**Monitor logs for connections from unusual VPSs and VPNs. Examine connection**\nlogs for access from unexpected ranges, particularly from machines hosted by\nSurfShark and M247.\n\n\n-----\n\n**Monitor for suspicious account use (e.g., inappropriate or unauthorized use of**\nadministrator accounts, service accounts, or third-party accounts). To detect use of\ncompromised credentials in combination with a VPS, follow the steps below:\n\n**Review logs for \"impossible logins,\" such as logins with changing username,**\nuser agent strings, and IP address combinations or logins where IP addresses do\nnot align to the expected user’s geographic location.\n**Search for \"impossible travel,\" which occurs when a user logs in from multiple**\nIP addresses that are a significant geographic distance apart (i.e., a person could\nnot realistically travel between the geographic locations of the two IP addresses\nin the time between logins). Note: This detection opportunity can result in false\npositives if legitimate users apply VPN solutions before connecting to networks.\n**Search for one IP used across multiple accounts, excluding expected logins.**\n\nTake note of any M247-associated IP addresses used along with VPN\nproviders (e.g., SurfShark). Look for successful remote logins (e.g., VPN,\nOWA) for IPs coming from M247- or using SurfShark-registered IP\naddresses.\n**Identify suspicious privileged account use after resetting passwords or**\napplying user account mitigations.\n**Search for unusual activity in typically dormant accounts.**\n**Search for unusual user agent strings, such as strings not typically associated**\nwith normal user activity, which may indicate bot activity.\n**Review the YARA rules provided in MAR-10365227-1 to assist in determining**\nwhether malicious activity has been observed.\n**Monitor for the installation of unauthorized software, including Remote Server**\nAdministration Tools (e.g., psexec, RdClient, VNC, and ScreenConnect).\n**Monitor for anomalous and known malicious command-line use. See Appendix:**\nWindows Command Shell Activity for commands used by the actors to interact with the\nvictim’s environment.\n**Monitor for unauthorized changes to user accounts (e.g., creation, permission**\nchanges, and enabling a previously disabled account).\n\n## CONTAINMENT AND REMEDIATION\n\nOrganizations affected by active or recently active threat actors in their environment can take\nthe following initial steps to aid in eviction efforts and prevent re-entry:\n\n\n-----\n\n**Report the incident. Report the incident to U.S. Government authorities and follow**\nyour organization’s incident response plan.\n\n[Report incidents to CISA via CISA’s 24/7 Operations Center (report@cisa.gov or](mailto:report@cisa.gov)\n888-282-0870).\nReport incidents to your local FBI field office at [fbi.gov/contact-us/field-offices or](http://www.fbi.gov/contact-us/field)\n[to FBI’s 24/7 Cyber Watch (CyWatch) via (855) 292-3937 or CyWatch@fbi.gov.](mailto:CyWatch@fbi.gov)\nFor DIB incident reporting, contact the Defense Cyber Crime Center (DC3) via\nDIBNET at [dibnet.dod.mil/portal/intranet or (410) 981 0104.](https://dibnet.dod.mil/portal/intranet)\n**Reset all login accounts. Reset all accounts used for authentication since it is**\npossible that the threat actors have additional stolen credentials. Password resets\nshould also include accounts outside of Microsoft Active Directory, such as network\ninfrastructure devices and other non-domain joined devices (e.g., IoT devices).\n**Monitor SIEM logs and build detections. Create signatures based on the threat actor**\nTTPs and use these signatures to monitor security logs for any signs of threat actor reentry.\n**Enforce MFA on all user accounts. Enforce phishing-resistant MFA on all accounts**\nwithout exception to the greatest extent possible.\n**Follow Microsoft’s security guidance for Active Directory—Best Practices for**\nSecuring Active Directory.\n**Audit accounts and permissions. Audit all accounts to ensure all unused accounts**\nare disabled or removed and active accounts do not have excessive privileges. Monitor\nSIEM logs for any changes to accounts, such as permission changes or enabling a\npreviously disabled account, as this might indicate a threat actor using these accounts.\n**Harden and monitor PowerShell by reviewing guidance in the joint Cybersecurity**\n[Information Sheet—Keeping PowerShell: Security Measures to Use and Embrace.](https://media.defense.gov/2022/Jun/22/2003021689/-1/-1/1/CSI_KEEPING_POWERSHELL_SECURITY_MEASURES_TO_USE_AND_EMBRACE_20220622.PDF)\n\n## Mitigations\n\nMitigation recommendations are usually longer-term efforts that take place before a\ncompromise as part of risk management efforts, or after the threat actors have been evicted\nfrom the environment and the immediate response actions are complete. While some may\nbe tailored to the TTPs used by the threat actor, recovery recommendations are largely\ngeneral best practices and industry standards aimed at bolstering overall cybersecurity\nposture.\n\n## Segment Networks Based on Function\n\n**Implement network segmentation to separate network segments based on role**\n**and functionality. Proper network segmentation significantly reduces the ability for**\nransomware and other threat actor lateral movement by controlling traffic flows\nbetween—and access to—various subnetworks. (See CISA’s Infographic on Layering\nNetwork Security Through Segmentation and NSA’s Segment Networks and Deploy\nApplication-Aware Defenses )\n\n\n-----\n\n**Isolate similar systems and implement micro-segmentation with granular access**\n**and policy restrictions to modernize cybersecurity and adopt Zero Trust (ZT)**\nprinciples for both network perimeter and internal devices. Logical and physical\nsegmentation are critical to limiting and preventing lateral movement, privilege\nescalation, and exfiltration.\n\n## Manage Vulnerabilities and Configurations\n\n**Update software, including operating systems, applications, and firmware, on**\n**[network assets. Prioritize patching known exploited vulnerabilities and critical and](https://www.cisa.gov/known-exploited-vulnerabilities-catalog)**\nhigh vulnerabilities that allow for remote code execution or denial-of-service on\ninternet-facing equipment.\n**Implement a configuration change control process that securely creates device**\nconfiguration backups to detect unauthorized modifications. When a configuration\nchange is needed, document the change, and include the authorization, purpose, and\nmission justification. Periodically verify that modifications have not been applied by\ncomparing current device configurations with the most recent backups. If suspicious\nchanges are observed, verify the change was authorized.\n\n## Search for Anomalous Behavior\n\n**Use cybersecurity visibility and analytics tools to improve detection of anomalous**\nbehavior and enable dynamic changes to policy and other response actions. Visibility\ntools include network monitoring tools and host-based logs and monitoring tools, such\nas an endpoint detection and response (EDR) tool. EDR tools are particularly useful for\ndetecting lateral connections as they have insight into common and uncommon\nnetwork connections for each host.\n**Monitor the use of scripting languages (e.g., Python, Powershell) by authorized and**\nunauthorized users. Anomalous use by either group may be indicative of malicious\nactivity, intentional or otherwise.\n\n## Restrict and Secure Use of Remote Admin Tools\n\n**Limit the number of remote access tools as well as who and what can be**\n**accessed using them. Reducing the number of remote admin tools and their allowed**\naccess will increase visibility of unauthorized use of these tools.\n**Use encrypted services to protect network communications and disable all clear**\n**text administration services(e.g., Telnet, HTTP, FTP, SNMP 1/2c). This ensures that**\nsensitive information cannot be easily obtained by a threat actor capturing network\ntraffic.\n\n## Implement a Mandatory Access Control Model\n\n\n-----\n\n**Implement stringent access controls to sensitive data and resources. Access**\nshould be restricted to those users who require access and to the minimal level of\naccess needed.\n\n## Audit Account Usage\n\n**Monitor VPN logins to look for suspicious access (e.g., logins from unusual geo**\nlocations, remote logins from accounts not normally used for remote access,\nconcurrent logins for the same account from different locations, unusual times of the\nday).\n**Closely monitor the use of administrative accounts. Admin accounts should be**\nused sparingly and only when necessary, such as installing new software or patches.\nAny use of admin accounts should be reviewed to determine if the activity is legitimate.\n**Ensure standard user accounts do not have elevated privileges Any attempt to**\nincrease permissions on standard user accounts should be investigated as a potential\ncompromise.\n\n## VALIDATE SECURITY CONTROLS\n\nIn addition to applying mitigations, CISA, FBI, and NSA recommend exercising, testing, and\nvalidating your organization's security program against threat behaviors mapped to the\nMITRE ATT&CK for Enterprise framework in this advisory. CISA, FBI, and NSA recommend\ntesting your existing security controls inventory to assess how they perform against the\nATT&CK techniques described in this advisory.\n\nTo get started:\n\n1. Select an ATT&CK technique described in this advisory (see Table 1).\n2. Align your security technologies against the technique.\n3. Test your technologies against the technique.\n4. Analyze the performance of your detection and prevention technologies.\n5. Repeat the process for all security technologies to obtain a set of comprehensive\n\nperformance data.\n6. Tune your security program, including people, processes, and technologies, based on\n\nthe data generated by this process.\n\nCISA, FBI, and NSA recommend continually testing your security program, at scale, in a\nproduction environment to ensure optimal performance against the MITRE ATT&CK\ntechniques identified in this advisory.\n\n## RESOURCES\n\n\n-----\n\nCISA offers several no-cost scanning and testing services to help organizations reduce their\nexposure to threats by taking a proactive approach to mitigating attack vectors. See\n[cisa.gov/cyber-hygiene-services.](https://www.cisa.gov/cyber-hygiene-services)\n\nU.S. DIB sector organizations may consider signing up for the NSA Cybersecurity\nCollaboration Center’s DIB Cybersecurity Service Offerings, including Protective Domain\nName System (PDNS) services, vulnerability scanning, and threat intelligence collaboration\nfor eligible organizations. For more information on how to enroll in these services, email\n[dib_defense@cyber.nsa.gov.](mailto:dib_defense@cyber.nsa.gov)\n\n## ACKNOWLEDGEMENTS\n\nCISA, FBI, and NSA acknowledge Mandiant for its contributions to this CSA.\n\n## APPENDIX: WINDOWS COMMAND SHELL ACTIVITY\n\nOver a three-day period in February 2021, APT cyber actors used Windows Command Shell\nto interact with the victim’s environment. When interacting with the victim’s system and\nexecuting commands, the threat actors used /q and /c parameters to turn the echo off, carry\nout the command specified by a string, and stop its execution once completed.\n\nOn the first day, the threat actors consecutively executed many commands within the\nWindows Command Shell to learn about the organization’s environment and to collect\nsensitive data for eventual exfiltration (see Table 2).\n\n_Table 2: Windows Command Shell Activity (Day 1)_\n\n**Command** **Description / Use**\n\nnet share Used to create, configure, and delete network shares from the command[line.[1] The threat actor likely used this command to display information](https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/hh750728(v=ws.11))\nabout shared resources on the local computer and decide which directories\nto exploit.\n\n\npowershell\ndir\n\n\nAn alias (shorthand) for the PowerShell Get-ChildItem cmdlet. This\ncommand maps shared drives by specifying a path to one location and\n[retrieving the items from another.[2] The threat actor added additional](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-childitem?view=powershell-7.2)\nswitches (aka options, parameters, or flags) to form a “one liner,” an\nexpression to describe commonly used commands used in exploitation:\npowershell dir -recurse -path e:\\<redacted>|select fullname,length|export-csv\nc:\\windows\\temp\\temp.txt. This particular command lists subdirectories of the\ntarget environment when.\n\n\n-----\n\nsysteminfo [Displays detailed configuration information [3], tasklist – lists currently](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/systeminfo)\n[running processes [4], and ipconfig – displays all current Transmission](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/tasklist)\nControl Protocol (TCP)/IP network configuration values and refreshes\nDynamic Host Configuration Protocol (DHCP) and Domain Name System\n[(DNS) settings, respectively [5]. The threat actor used these commands with](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/ipconfig)\nspecific switches to determine if the system was a VMware virtual machine:\nsysteminfo > vmware & date /T, tasklist /v > vmware & date /T, and ipconfig\n/all >> vmware & date /.\n\nroute print [Used to display and modify the entries in the local IP routing table. [6] The](https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/ff961510(v=ws.11))\nthreat actor used this command to display the entries in the local IP routing\ntable.\n\nnetstat Used to display active TCP connections, ports on which the computer is\nlistening, Ethernet statistics, the IP routing table, IPv4 statistics, and IPv6\n[statistics.[7] The threat actor used this command with three switches to](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/netstat)\ndisplay TCP connections, prevent hostname determination of foreign IP\naddresses, and specify the protocol for TCP: netstat -anp tcp.\n\ncertutil Used to dump and display certification authority (CA) configuration\ninformation, configure Certificate Services, backup and restore CA\n[components, and verify certificates, key pairs, and certificate chains.[8] The](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/certutil)\nthreat actor used this command with three switches to test if they could\ndownload files from the internet: certutil -urlcache -split -f\nhttps://microsoft.com temp.html.\n\nping Sends Internet Control Message Protocol (ICMP) echoes to verify\n[connectivity to another TCP/IP computer.[9] The threat actor used ping -n 2](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/ping)\napple.com to either test their internet connection or to detect and avoid\nvirtualization and analysis environments or network restrictions.\n\ntaskkill [Used to end tasks or processes.[10] The threat actor used taskkill /F /PID](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/taskkill)\n8952 to probably disable security features. CISA was unable to determine\nwhat this process was as the process identifier (PID) numbers are dynamic.\n\n\nPowerShell\nCompressArchive\ncmdlet\n\n\nUsed to create a compressed archive or to zip files from specified files and\n[directories.[11] The threat actor used parameters indicating shared drives as](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.archive/compress-archive?view=powershell-7.2)\nfile and folder sources and the destination archive as zipped files.\nSpecifically, they collected sensitive contract-related information from the\nshared drives.\n\n\nOn the second day, the APT cyber actors executed the commands in Table 3 to perform\ndiscovery as well as collect and archive data.\n\n_Table 3: Windows Command Shell Activity (Day 2)_\n\n\n-----\n\n**Command** **Description / Use**\n\nntfsinfo.exe Used to obtain volume information from the New Technology File System\n(NTFS) and to print it along with a directory dump of NTFS meta-data files.\n\n[[12]](https://docs.microsoft.com/en-us/sysinternals/downloads/ntfsinfo)\n\nWinRAR.exe Used to compress files and subsequently masqueraded WinRAR.exe by\n[renaming it VMware.exe.[13]](https://www.rarlab.com/)\n\nOn the third day, the APT cyber actors returned to the organization’s network and executed\nthe commands in Table 4.\n\n_Table 4: Windows Command Shell Activity (Day 3)_\n\n**Command** **Description / Use**\n\n\npowershell -ep\nbypass importmodule\n.\\vmware.ps1;exportmft -volume e\n\n\nThreat actors ran a PowerShell command with parameters to\nchange the execution mode and bypass the Execution Policy to\nrun the script from PowerShell and add a module to the current\nsection: powershell -ep bypass import-module\n.\\vmware.ps1;export-mft -volume e. This module appears to\nacquire and export the Master File Table (MFT) for volume E for\n[further analysis by the cyber actor.[14]](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/import-module?view=powershell-7.2)\n\n\nset.exe [Used to display the current environment variable settings.[15] (An](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/set_1)\nenvironment variable is a dynamic value pointing to system or user\nenvironments (folders) of the system. System environment\nvariables are defined by the system and used globally by all users,\nwhile user environment variables are only used by the user who\ndeclared that variable and they override the system environment\nvariables (even if the variables are named the same).\n\ndir.exe Used to display a list of a directory's files and subdirectories\nmatching the eagx* text string, likely to confirm the existence of\nsuch file.\n\n\ntasklist.exe and\nfind.exe\n\n\nUsed to display a list of applications and services with their PIDs\nfor all tasks running on the computer matching the string “powers”.\n\n[[16][17][18]](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/tasklist)\n\n\n-----\n\nping.exe Used to send two ICMP echos to amazon.com. This could have\nbeen to detect or avoid virtualization and analysis environments,\ncircumvent network restrictions, or test their internet connection.\n\n[[19]](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/ping)\n\n\ndel.exe with the /f\nparameter\n\n\nUsed to force the deletion of read-only files with the *.rar and\n[tempg* wildcards.[20]](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/del)\n\n\n## References\n\n Revisions\n\nOctober 4, 2022: Initial version\n\n[This product is provided subject to this Notification and this](https://www.cisa.gov/privacy/notification) [Privacy & Use policy.](https://www.dhs.gov/privacy-policy)\n\n**Please share your thoughts.**\n\n[We recently updated our anonymous product survey; we'd welcome your feedback.](https://www.surveymonkey.com/r/CISA-cyber-survey?product=https://us-cert.cisa.gov/ncas/alerts/aa22-277a)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-10-04 - Alert (AA22-277A) Impacket and Exfiltration Tool Used to Steal Sensitive Information from Defense Industrial Base Organization.pdf"
    ],
    "report_names": [
        "2022-10-04 - Alert (AA22-277A) Impacket and Exfiltration Tool Used to Steal Sensitive Information from Defense Industrial Base Organization.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535934,
    "ts_updated_at": 1743041132,
    "ts_creation_date": 1666531957,
    "ts_modification_date": 1666531957,
    "files": {
        "pdf": "https://archive.orkl.eu/2882fbf19737761f111fab9edb4a49607a898d67.pdf",
        "text": "https://archive.orkl.eu/2882fbf19737761f111fab9edb4a49607a898d67.txt",
        "img": "https://archive.orkl.eu/2882fbf19737761f111fab9edb4a49607a898d67.jpg"
    }
}