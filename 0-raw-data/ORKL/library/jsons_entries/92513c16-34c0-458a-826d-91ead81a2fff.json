{
    "id": "92513c16-34c0-458a-826d-91ead81a2fff",
    "created_at": "2022-10-25T16:48:21.21145Z",
    "updated_at": "2025-03-27T02:09:30.350868Z",
    "deleted_at": null,
    "sha1_hash": "d72aa785d811b96a223487b923bcf952c36ec636",
    "title": "",
    "authors": "",
    "file_creation_date": "2017-03-14T20:17:24Z",
    "file_modification_date": "2017-03-14T20:17:24Z",
    "file_size": 1109523,
    "plain_text": "# MajikPOS Combines  PoS Malware and RATs  to Pull Off its Malicious Tricks \n\n#### TrendLabs Security Intelligence Blog\n\n Cyber Safety Solutions Team\n\n March 2017\n\n\n-----\n\n## Table of Contents\n\n### MajikPOS is a Mishmash of Nefarious Tricks ........................................ 1\n\n Entry Point and Attack Chain ................................................................... 2\n\n RAM-scraping Routine .............................................................................. 5\n\n Online Shops for Stolen Credit Card Data .............................................. 8\n\n Indicators of Compromise ........................................................................ 9\n\nTREND MICRO LEGAL DISCLAIMER\n\nThe information provided herein is for general information and educational purposes only. It is not intended and should not be construed to constitute legal advice.\nThe information contained herein may not be applicable to all situations and may not reflect the most current situation. Nothing contained herein should be relied\non or acted upon without the benefit of legal advice based on the particular facts and circumstances presented and nothing herein should be construed otherwise.\nTrend Micro reserves the right to modify the contents of this document at any time without prior notice.\n\nTranslations of any material into other languages are intended solely as a convenience. Translation accuracy is not guaranteed nor implied. If any questions arise\nrelated to the accuracy of a translation, please refer to the original language official version of the document. Any discrepancies or differences created in the\ntranslation are not binding and have no legal effect for compliance or enforcement purposes.\n\nAlthough Trend Micro uses reasonable efforts to include accurate and up-to-date information herein, Trend Micro makes no warranties or representations of any\nkind as to its accuracy, currency, or completeness. You agree that access to and use of and reliance on this document and the content thereof is at your own risk.\nTrend Micro disclaims all warranties of any kind, express or implied. Neither Trend Micro nor any party involved in creating, producing, or delivering this document\nshall be liable for any consequence, loss, or damage, including direct, indirect, special, consequential, loss of business profits, or special damages, whatsoever\narising out of access to, use of, or inability to use, or in connection with the use of this document, or any errors or omissions in the content thereof. Use of this\ninformation constitutes acceptance for use in an “as is” condition.\n\n\n-----\n\n## MajikPOS is a Mishmash of Nefarious Tricks \n\nCrooks behind MajikPOS have various tricks up their sleeves. Apart from infecting systems with\nit, we also spotted instances where common lateral movement tools were detected around the\nsame time they were actively compromising the endpoint with MajikPOS. These tools include:\n[HKTL_MIMIKATZ, HKTL_FGDUMP, and HKTL_VNCPASSVIEW. We surmise that the bad](https://www.trendmicro.com/vinfo/us/threat-encyclopedia/malware/hktl_mimikatz)\nguys attempted to gain further access within the victim’s network. In separate isolated incidents,\nwe also noticed the deployment of MajikPOS via PsExec, a command-line tool that can be used\nto remotely execute processes on other systems. This may indicate that valid, administrativelevel credentials were used against the host. The attackers also tend to deploy what works or\nwhat's convenient, as we’ve also seen them attempt to infect the target host with other PoS\n[malware such as PwnPOS (TSPY_PWNPOS.SMA), and BlackPOS (TSPY_POCARDL.AI).](http://blog.trendmicro.com/trendlabs-security-intelligence/pwnpos-old-undetected-pos-malware-still-causing-havoc/)\n\nOne of MajikPOS’s striking functionalities is how it can take two parts to operate: the main\ncomponent, often called csrss.exe, and conhost.exe, which is in charge of the scraping routine.\nOnly the main component, csrss.exe, is often deployed; if access to the C&C server is blocked,\nthen full infection doesn’t occur and the endpoint is left with a similarly-named system file. We\nalso construe that csrss.exe and conhost.exe are so named as an effort by the MajikPOS’s\nauthor to hide the malware, as they mimic common file names in Microsoft Windows.\nAdditionally, MajikPOS opts to use uncommon ports as its C&C channel. We’re not certain why,\nas the customary approach for malware nowadays is to try blending in within normal user traffic,\nand use the more commonly utilized HTTP (TCP port 80), or HTTPS (TCP port 443).\n\nThis technical brief provides an in-depth look into MajikPOS’s attack chain and routines.\n\n1\n\n\n-----\n\n## Entry Point and Attack Chain\n\n  - **_Unsecure VNC and RDP. While port scanning of hosts directly accessible via the_**\ninternet happens all the time (and not all result in a compromise), we observed that\ntargets are initially identified by having open ports related to VNC (like TCP port 5900)\nand RDP (usually TCP port 3389).\n\n  - **_Previously installed malicious backdoors, or RATs. Most of the backdoors involved_**\nhave the functionality to acquire information from—and provide remote access to—the\nendpoint. These RATs can be purchased in the underground, and are otherwise easy to\ncome by. The MajikPOS-infected endpoints we observed would have one or more of the\nfollowing RATs:\n```\n     o Remcos (BKDR_SOCMER.SM)\n     o SpyGate (BKDR_BLADABI.SMC)\n     o Luminosity Link (BKDR_LUMINOSITY.SM1)\n     o Xtreme (WORM_XTREME.SMM)\n\n## Configuration and C&C Communication \n\n```\nMajikPOS contacts its C&C server to register the infected system, along with the local IP\naddress, Hardware ID (HWID), Operating System (OS), and computer name. All communication\nbetween client and server is encrypted with AES-ECB with Base64 encoding.\n\n_Figure 1: Sample encrypted C&C communication_\n\n2\n\n\n-----\n\n_Figure 2: The information after decrypting the C&C communication_\n\nThe key used in the sample we analyzed\n(427f1bf2b91cad1e9a4b7e095d6c83763f1bd50d6b8d515d3dbee9f96ef47097) is:\n\n**_@#$%^&*()<>,./;'-==oqwertgnhiopl_**\n\nOnce registered, the server replies with a configuration file in this format:\n\nok<password for update>#<regex for track2>|<regex for track1>#<whitelisted processes>\n\n_Figure 3: Server responds with configuration details after registration_\n\nThe malware then asks the server to update the executable while passing along the HWID and\npassword—the first data from its configuration. As a result, another file is downloaded from the\nserver, which is saved and executed in the system as “%WinDir%\\conhost.exe”.\n\n_Conhost.exe is then executed with encrypted arguments. The malware continues to do a task_\nrequest from the server while the downloaded component runs in parallel. As of this time, only\n“exeupdate” was executed, but code analysis indicates that it can also delete itself from the\nsystem using the command “deletebot”.\n\n_Figure 4: Malware requests for EXE update_\n\n_Figure 5: Encrypted command-line argument of conhost.exe_\n\n\n3\n\n\n-----\n\n_Figure 6: Decrypted command-line argument of conhost.exe_\n\n_Figure 7: Malware requests for commands_\n\n_Figure 8: “exeupdate” and “deletebot” routines_\n\nThe C&C servers are coded within the malware binary, which utilized both domain names and\n[IP addresses—the domain names were not employing Domain Generation Algorithm (DGA).](http://blog.trendmicro.com/domain-generating-algorithms-dgas/)\n\n\n4\n\n\n-----\n\n## RAM-scraping Routine \n\n_Conhost.exe is the component responsible for RAM scraping. It uses information from the_\nconfiguration file for this routine—a whitelist of processes to be skipped when scanning for\ncredit card track data; and regular expressions that verify Track 1 and Track 2 data.\n\nPoS malware typically scan the process memory of PoS software, where the credit card data\nare located; they are also stored on the magnetic stripe tracks (1, 2, and 3). A PoS malware\nwould need to conduct pattern matching on the track data (sometimes only track 2) to identify\nthe credit card dumps in memory. Track 1 contains the credit card number, expiration date,\nservice code, and the cardholder’s name, while Track 2 has the credit card number, expiration\ndate, and service code.\n\nProcesses not in the whitelist are first scanned for strings with delimiters, such as ‘=’ and ‘^’ and\nbeginning with ‘B’ or ‘;’ and ends with ‘?’, to make the routine faster. Depending on the result, it\nwill further verify if the track data is valid via regex matching:\n\n  - Track 1: ([3-6]{1}\\d{14,15}\\^[a-zA-Z/. ]{0,50}\\^\\d{12,22})\n\n  - Track2: [3-6]{1}\\d{14,15}=\\d{4}(101|121|126|201|206|220|221|226|521|606|620)\\d{5,15}\n\n_[Figure 9: Regex used to match Track 1 data (visualization by REGEXPER)](https://regexper.com/)_\n\n5\n\n\n-----\n\n_Figure 10: Regex used to match Track 2 data (visualization by REGEXPER)_\n\n[Magnetic stripe cards store this information in a format defined by ISO/IEC 7813:2006, where it](https://www.iso.org/standard/43317.html)\nis possible to determine the credit card issuer (i.e., Visa, MasterCard, American Express, etc.)\nthrough the primary account number (PAN), and card type (service code). These ascertain the\ncard’s restrictions, and where it can be used.\n\nMajikPOS checks the first digit which must be a value from 3 to 6. MajikPOS also checks the\nservice codes and delimiters “=” or “^” in their proper places. While it uses regular expressions\nto match a valid card number, it does not use Luhn algorithm (a checksum formula) to validate\nthe credit card number.\n\n6\n\n\n-----\n\nAfter verifying the track data, the information is sent to the C&C server via HTTP POST,\nAction=”bin”:\n\n_Figure 11: MajikPOS sends track data via HTTP POST_\n\nDelving into the conhost.exe’s code, we found that conhost.exe declares .NET classes\ncorresponding to the backdoor commands of the malware while communicating to its C&C\nserver. Interestingly, only the Track and SerializedTracks were used by conhost.exe among\nother classes present. The other classes/commands were used by its main component. It\nappears conhost.exe is designed as such so the main and RAM-scraping components can be\ncombined into one module.\n\nHere is a summary of the backdoor commands:\n\n**Command** **Description** **Parameter**\n_ExeUpdate_ Download an updated HWID\n\ncopy of the malware Password\n\nAction\n\n_GetTask_ Request for additional HWID\n\ntasks from C&C server Action\n\n_Register_ Reports the infected ExternalIp\n\nmachine information to LocalIP\nthe C&C server HWID\n\nOS\nPcname\nAction\n\n_Serialized Tracks_ Reports the scraped Tracklist:bin,Procname\n\ncredit card information to HWID\nthe C&C server Action\n\n_DeleteBot_ Removes the malware\nfrom the infected machine\n_Figure 12: Description of the backdoor commands_\n\n|Command|Description|Parameter|\n|---|---|---|\n|ExeUpdate|Download an updated copy of the malware|HWID Password Action|\n|GetTask|Request for additional tasks from C&C server|HWID Action|\n|Register|Reports the infected machine information to the C&C server|ExternalIp LocalIP HWID OS Pcname Action|\n|Serialized Tracks|Reports the scraped credit card information to the C&C server|Tracklist:bin,Procname HWID Action|\n|DeleteBot|Removes the malware from the infected machine||\n\n\n7\n\n\n-----\n\n## Online Shops for Stolen Credit Card Data \n\nThe peddler, who goes by the handle “MAGICDUMPS”, had specific instruction to “work exactly\nas instructed after you buy the dumps”. This can possibly refer to the location (city, area code,\nand ZIP code) where the card must be used to ensure “the highest percentage of approval rate”.\nThis can also suggest why the “magic dumps” shop indicates the country, state, city, and ZIP\ncode. These dumps can also be searched by location.\n\n_Figure 13: MAGICDUMPS advertising stolen credit card data_\n\n_Figure 14: MAGICDUMPS’s instructions on how to use the stolen data_\n\n8\n\n\n-----\n\nHere are the domains we found selling credit card data stolen by MajikPOS, based on our\nresearch on one of the malware’s C&C servers. The name “SwipeIT” curiously coincides with\n[our research on another PoS malware, FastPOS (TSPY_FASTPOS).](http://blog.trendmicro.com/trendlabs-security-intelligence/fastpos-quick-and-easy-credit-card-theft/)\n\n**Domain Name** **Create Date**\n\n[swipe[.]wtf](https://whois.domaintools.com/swipe.wtf) 12/4/2016\n[swipeit[.]pro](https://whois.domaintools.com/swipeit.pro) 12/5/2016\n[mcdumps[.]pro](https://whois.domaintools.com/mcdumps.pro) 12/21/2016\n[mcdumps[.]top](https://whois.domaintools.com/mcdumps.top) 12/21/2016\n[umbpan[.]pw](https://whois.domaintools.com/umbpan.pw) 1/16/2017\n[umbpan[.]xyz](https://whois.domaintools.com/umbpan.xyz) 1/16/2017\nmagicdumps[.]biz 1/19/2017\n[magicdumps[.]one](https://whois.domaintools.com/magicdumps.one) 1/19/2017\nmagicdumps[.]pw 1/19/2017\n[magicdumps[.]trade](https://whois.domaintools.com/magicdumps.trade) 1/19/2017\n[magicdumps[.]pro](https://whois.domaintools.com/magicdumps.pro) 1/30/2017\n[magicdumps[.]review](https://whois.domaintools.com/magicdumps.review) 1/30/2017\n[magicdumps[.]space](https://whois.domaintools.com/magicdumps.space) 1/30/2017\n[magicdumps[.]xyz](https://whois.domaintools.com/magicdumps.xyz) 1/30/2017\n[magicdumps[.]top](https://whois.domaintools.com/magicdumps.top) 2/1/2017\n_Figure 15: Domains of the “Magic Dump” shops_\n\n## Indicators of Compromise\n\n**_File Hashes, detected as TSPY_MAJIKPOS.A (SHA-256)_**\n\n427f1bf2b91cad1e9a4b7e095d6c83763f1bd50d6b8d515d3dbee9f96ef47097\n283d1780fbd96325b19b7f273343ba8f8a034bd59f92dbf9b35e3a000840a3b4\n14e5efcf0ba8773bcaf1c1b0517a614af68caa67902ee9f26a2a07a2ade58efb\n25e4d8354c882eaea94b52039a96cc6d969a2dec8486557351cfa1d05c3b8984\n4bbc0afc598c197f137d0617de4bd1ab8c6eef751accb83a5bb6ea02e6c047c0\n\n**_C&C Servers_**\n\numbpan[.]xyz/80okg80/\n195[.]22 [.]126[.]234:449/old1/\n193[.]169[.]252[.]102:449/1np3r0t/\numbpan[.]pw:8880/o4m3kw/\numbpan[.]pw:8880/o2kf8gp/\n\n|Domain Name|Create Date|\n|---|---|\n|swipe[.]wtf|12/4/2016|\n|swipeit[.]pro|12/5/2016|\n|mcdumps[.]pro|12/21/2016|\n|mcdumps[.]top|12/21/2016|\n|umbpan[.]pw|1/16/2017|\n|umbpan[.]xyz|1/16/2017|\n|magicdumps[.]biz|1/19/2017|\n|magicdumps[.]one|1/19/2017|\n|magicdumps[.]pw|1/19/2017|\n|magicdumps[.]trade|1/19/2017|\n|magicdumps[.]pro|1/30/2017|\n|magicdumps[.]review|1/30/2017|\n|magicdumps[.]space|1/30/2017|\n|magicdumps[.]xyz|1/30/2017|\n|magicdumps[.]top|2/1/2017|\n\n\n9\n\n\n-----\n\nTrend Micro Incorporated, a global leader in security software, strives to make the\nworld safe for exchanging digital information. Our innovative solutions for consumers,\nbusinesses and governments provide layered content security to protect information\non mobile devices, endpoints, gateways, servers and the cloud. All of our solutions\nare powered by cloud-based global threat intelligence, the Trend Micro™ Smart\nProtection Network™, and are supported by over 1,200 threat experts around the\nglobe. For more information, visit www.trendmicro.com.\n\n©2017 by Trend Micro, Incorporated. All rights reserved. Trend Micro and the Trend\nMicro t-ball logo are trademarks or registered trademarks of Trend Micro,\nIncorporated. All other product or company names may be trademarks or registered\ntrademarks of their owners.\n\n\n10101 N. De Anza Blvd.\nCupertino, CA 95014\n\nU.S. toll free: 1 +800.228.5651\nPhone: 1 +408.257.1500\nFax: 1 +408.257.2003\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "6fc23d14-23a6-4870-8fad-b291b182596f",
            "created_at": "2022-10-25T16:07:18.480113Z",
            "updated_at": "2022-10-25T16:07:18.480113Z",
            "deleted_at": null,
            "name": "ETDA",
            "url": "https://apt.etda.or.th",
            "description": "Threat Group Cards: A Threat Actor Encyclopedia",
            "reports": null
        },
        {
            "id": "5910e58f-4bc9-4e4e-9dbb-887804094a01",
            "created_at": "2022-10-25T16:32:58.457399Z",
            "updated_at": "2022-10-25T16:32:58.457399Z",
            "deleted_at": null,
            "name": "OTX",
            "url": "https://otx.alienvault.com",
            "description": "Alienvault Open Threat Exchange (OTX)",
            "reports": null
        }
    ],
    "references": [
        "https://documents.trendmicro.com/assets/majikpos-combines-pos-malware-and-rats-to-pull-off-its-malicious-tricks.pdf"
    ],
    "report_names": [
        "majikpos-combines-pos-malware-and-rats-to-pull-off-its-malicious-tricks.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716501,
    "ts_updated_at": 1743041370,
    "ts_creation_date": 1489522644,
    "ts_modification_date": 1489522644,
    "files": {
        "pdf": "https://archive.orkl.eu/d72aa785d811b96a223487b923bcf952c36ec636.pdf",
        "text": "https://archive.orkl.eu/d72aa785d811b96a223487b923bcf952c36ec636.txt",
        "img": "https://archive.orkl.eu/d72aa785d811b96a223487b923bcf952c36ec636.jpg"
    }
}