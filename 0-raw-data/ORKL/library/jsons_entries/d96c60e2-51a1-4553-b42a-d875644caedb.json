{
    "id": "d96c60e2-51a1-4553-b42a-d875644caedb",
    "created_at": "2023-01-12T15:06:28.959913Z",
    "updated_at": "2025-03-27T02:09:18.374411Z",
    "deleted_at": null,
    "sha1_hash": "726d7a1e149819a699053e96f46ec3501b6c2e79",
    "title": "2020-10-14 - They’re back- inside a new Ryuk ransomware attack",
    "authors": "",
    "file_creation_date": "2022-05-28T01:22:18Z",
    "file_modification_date": "2022-05-28T01:22:18Z",
    "file_size": 891506,
    "plain_text": "# They’re back: inside a new Ryuk ransomware attack\n\n**[news.sophos.com/en-us/2020/10/14/inside-a-new-ryuk-ransomware-attack/](https://news.sophos.com/en-us/2020/10/14/inside-a-new-ryuk-ransomware-attack/)**\n\nSean Gallagher October 14, 2020\n\nThe operators of Ryuk ransomware are at it again. After a long period of quiet, we identified\na new spam campaign linked to the Ryuk actors—part of a new wave of attacks. And in late\nSeptember, Sophos’ Managed Threat Response team assisted an organization in mitigating\na Ryuk attack—providing insight into how the Ryuk actors’ tools, techniques and practices\nhave evolved. The attack is part of a recent wave of Ryuk incidents tied to recent phishing\ncampaigns.\n\nFirst spotted in August of 2018, the Ryuk gang gained notoriety in 2019, demanding multimillion-dollar ransoms from companies, hospitals, and local governments. In the process, the\noperators of the ransomware pulled in over $61 million just in the US, according to figures\nfrom the Federal Bureau of Investigation. And that’s just what was reported—other estimates\nplace Ryuk’s take in 2019 in the hundreds of millions of dollars.\n\nStarting around the beginning of the worldwide COVID-19 pandemic, we saw a lull in Ryuk\nactivity. There was speculation that the Ryuk actors had moved on to a rebranded version of\nthe ransomware, called Conti. The campaign and attack we investigated was interesting both\nbecause it marked the return of Ryuk with some minor modifications, but also showed an\nevolution of the tools used to compromise targeted networks and deploy the ransomware.\n\nThe attack was also notable because of how quickly the attacks can move from initial\ncompromise to ransomware deployment. Within three and a half hours of a target opening a\nphishing email attachment, attackers were already conducting network reconnaissance.\nWithin a day, they had gained access to a domain controller, and were in the early stages of\nan attempt to deploy ransomware.\n\n\n-----\n\nThe attackers were persistent as well. As attempts to launch the attack failed, the Ryuk\nactors attempted multiple times over the next week to install new malware and ransomware,\nincluding renewed phishing attempts to re-establish a foothold. Before the attack had\nconcluded, over 90 servers and other systems were involved in the attack, though\nransomware was blocked from full execution.\n\n### Let the wrong one in\n\nInitial compromise, reconnaissance and lateral movement phase of Ryuk attack\nThe attack began on the afternoon of Tuesday. September 22. Multiple employees of the\ntargeted company had received highly-targeted phishing emails:\n\n\n-----\n\nFrom: Alex Collins [spoofed external email address]\n\nTo: [targeted individual]\n\nSubject: Re: [target surname] about debit\n\nPlease call me back till 2 PM, i will be in [company name] office till 2 PM.\n\n[Target surname], because of [company name]head office request #96-9/23 [linked to\nremote file], i will process additional 3,582 from your payroll account.\n\n[Target first name], call me back when you will be available to confirm that all is correct.\n\nHere is a copy of your statement in PDF[linked to remote file].\n\nAlex Collins\n\n[Company name] outsource specialist\n\nThe link, served up through the mail delivery service Sendgrid, redirected to a malicious\ndocument hosted on docs.google.com. The email was tagged with external sender warnings\nby the company’s mail software. And multiple instances of the malicious attachment were\ndetected and blocked.\n\nBut one employee clicked on the link in the email that afternoon. The user opened the\ndocument and enabled its content, allowing the document to execute print_document.exe\n—a malicious executable identified as Buer Loader. Buer Loader is a modular malware-as-aservice downloader, introduced on underground forums for sale in August of 2019. It\nprovides a web panel-managed malware distribution service; each downloader build sold for\n$350, with add-on modules and download address target changes billed separately.\n\nIn this case, upon execution, the Buer Loader malware dropped qoipozincyusury.exe, a\nCobalt Strike “beacon,” along with other malware files. Cobalt Strike’s beacon, originally\ndesigned for attacker emulation and penetration testing, is a modular attack tool that can\nperform a wide range of tasks, providing access to operating system features and\nestablishing a covert command and control channel within the compromised network.\n\nOver the next hour and a half, additional Cobalt Strike beacons were detected on the initially\ncompromised system. The attackers were then able to successfully establish a foothold on\nthe targeted workstation for reconnaissance and to hunt for credentials.\n\nA few hours later, the Ryuk actors’ reconnaissance of the network began. The following\ncommands were run on the initially infected system:\n\nC:\\WINDOWS\\system32\\cmd.exe /C whoami /groups (accessing list of AD groups the\nlocal user is in)\n\n\n-----\n\nC:\\WINDOWS\\system32\\cmd.exe /C nltest /domain_trusts /all_trusts (returns a list of\nall trusted domains)\nC:\\WINDOWS\\system32\\cmd.exe /C net group “enterprise admins” /domain (returns a\nlist of members of the “enterprise admins” group for the domain)\nC:\\WINDOWS\\system32\\net1 group “domain admins” /domain (the same, but a list of\nthe group “domain admins”)\nC:\\WINDOWS\\system32\\cmd.exe /C net localgroup administrators (returns a list of\nadministrators for the local machine)\nC:\\WINDOWS\\system32\\cmd.exe /C ipconfig (returns the network configuration)\nC:\\WINDOWS\\system32\\cmd.exe /C nltest /dclist:[target company domain name]\n(returns names of the domain controllers for the company domain name)\nC:\\WINDOWS\\system32\\cmd.exe /C nltest /dclist:[target company name] (the same,\nbut checking for domain controllers using the company name as the domain name)\n\n### Forward lateral\n\nUsing this data, by Wednesday morning the actors had obtained administrative credentials\nand had connected to a domain controller, where they performed a data dump of Active\n[Directory details. This was most likely accomplished through the use of SharpHound, a](https://github.com/BloodHoundAD/SharpHound3)\nMicrosoft C#-based data “injestor” tool for BloodHound (an open-source Active Directory\nanalysis tool used to identify attack paths in AD environments). A data dump from the tool\nwas written to a user directory for the compromised domain administrator account on the\ndomain server itself.\n\nAnother Cobalt Strike executable was loaded and launched a few hours later. That was\nfollowed immediately by the installation of a Cobalt Strike service on the domain controller\nusing the domain administrator credentials obtained earlier. The service was a chained\nServer Message Block listener, allowing Cobalt Strike commands to be passed to the server\nand other computers on the network. Using Windows Management Interface, the attackers\nremotely executed a new Cobalt Strike beacon on the same server.\n\nIn short order, other malicious services were created on two other servers using the same\nadmin credentials, using Windows Management Instrumentation from the initially\ncompromised PC. One of the services configured was an encoded PowerShell command\ncreating yet another Cobalt communications pipe.\n\nThe actors continued to perform reconnaissance activities from the initially infected desktop,\nexecuting commands trying to identify potential targets for further lateral movement. Many of\nthese repeated previous commands. The nltest command was used in an attempt to retrieve\ndata from domain controllers on other domains within the enterprise Active Directory tree.\nOther commands pinged specific servers, attempting to gain IP addresses. The actors also\nchecked against all mapped network shares connected to the workstation and used WMI to\ncheck for active Remote Desktop sessions on another domain controller within the Active\nDirectory tree.\n\n\n-----\n\n### Setting the trap\n\nLate Wednesday afternoon—less than a day after the victim’s click on the phish— the Ryuk\nactors began preparations to launch their ransomware. Using the beachhead on the initially\ncompromised PC, the attackers used RDP to connect to the domain controller with the admin\ncredentials obtained the day before. A folder named C:\\Perflogs\\grub.info.test2 –\n**Copy was dropped on the domain controller— a name consistent with a set of tools**\ndeployed in previous Ryuk attacks. A few hours later, the attackers ran an encoded\nPowerShell command that, accessing Active Directory data, generated a dump file called\n**ALLWindows.csv, containing login, domain controller and operating system data for**\nWindows computers on the network.\n\nNext, the SystemBC malicious proxy was deployed on the domain controller. SystemBC is a\nSOCKS5 proxy used to conceal malware traffic that shares code and forensic markers with\nother malware from the Trickbot family. The malware installed itself (as itvs.exe), and\ncreated a scheduled job for the malware, using the old Windows task scheduler format in a\nfile named itvs.job—in order to maintain persistence.\n\nA PowerShell script loaded into the grub.info.test folder on the domain controller was\nexecuted next. This script, Get.DataInfo.ps1, scans the network and provides an output of\nwhich systems are active. It also checks which AV is running on the system.\n\n\n-----\n\nThe Ryuk actors used a number of methods to attempt to spread files to additional servers,\nincluding file shares, WMI, and Remote Desktop Protocol clipboard transfer. WMI was used\nto attempt to execute GetDataInfo.ps1 against yet another server.\n\n### Failure to launch\n\nThursday morning, the attackers spread and launched Ryuk. This version of Ryuk had no\nsubstantial changes from earlier versions we’ve seen in terms of core functionality, but\nRyuk’s developers did add more obfuscation to the code to evade memory-based detections\nof the malware.\n\nThe organizational backup server was among the first targeted. When Ryuk was detected\nand stopped on the backup server, the attackers used the icacls command to modify access\ncontrol, giving them full control of all the system folders on the server.\n\nThey then deployed GMER, a “rootkit detector” tool:\n\nThe GMER process hunting tool.\nGMER is frequently used by ransomware actors to find and shut down hidden processes,\nand to shut down antivirus software protecting the server. The Ryuk attackers did this, and\nthen they tried again. Ryuk ransomware was redeployed and re-launched three more times\n\n\n-----\n\nin short order, attempting to overwhelm remaining defenses on the backup server.\n\nRansom notes were dropped in the folders hosting the ransomware, but no files were\nencrypted.\n\nThe Ryuk HTML ransom note.\nIn total, Ryuk was executed in attacks launched from over 40 compromised systems,but was\nrepeatedly blocked by Sophos Intercept X. By noon on Thursday, the ransomware portion of\nthe attack had been thwarted. But the attackers weren’t done trying—and weren’t off the\nnetwork yet.\n\nOn Friday, defenders deployed a block across the domains affected by the attack for the\nSystemBC RAT. The next day, the attackers attempted to activate another SOCKS proxy on\nthe still-compromised domain controller. And additional Ryuk deployments were detected\nover the following week—along with additional phishing attempts and attempts to deploy\nCobalt Strike.\n\n## Lessons learned\n\n\n-----\n\nThe Ryuk attack’s exploitation chain.\nThe tactics exhibited by the Ryuk actors in this attack demonstrate a solid shift away from\nthe malware that had been the basis of most Ryuk attacks last year (Emotet and Trickbot).\nThe Ryuk gang shifted from one malware-as-a-service provider (Emotet) to another (Buer\nLoader), and has apparently replaced Trickbot with more hands-on-keyboard exploitation\ntools—Cobalt Strike, Bloodhound, and GMER, among them—and built-in Windows scripting\nand administrative tools to move laterally within the network. And the attackers are quick to\nchange tactics as opportunities to exploit local network infrastructure emerge—in another\nrecent attack Sophos responded to this month, the Ryuk actors also used Windows Global\nPolicy Objects deployed from the domain controller to spread ransomware. And other recent\nattacks have used another Trickbot-connected backdoor known as Bazar.\n\nThe variety of tools being used, including off-the-shelf and open-source attack tools, and the\nvolume and speed of attacks is indicative of an evolution in the Ryuk gang’s operational\nskills. Cobalt Strike’s “offensive security” suite is a favorite tool of both state-sponsored and\ncriminal actors, because of its relative ease of use and broad functionality, and its wide\navailability—“cracked” versions of the commercially-licensed software are readily purchased\nin underground forums. And the software provides actors with a ready-made toolkit for\nexploitation, lateral movement, and many of the other tasks required to steal data, escalate\nthe compromise and launch ransomware attacks without requiring purpose-made malware.\n\nWhile this attack happened quickly, the persistence of the attacks following the initial failure\nof Ryuk to encrypt data demonstrate that the Ryuk actors—like many ransomware attackers\n—are slow to unlatch their jaws, and can persist for long periods of time once they’ve moved\nlaterally within the network and can establish additional backdoors. The attack also shows\nthat Remote Desktop Protocol can be dangerous even when it is inside the firewall.\n\n\n-----\n\n[IOCs for this attack are posted on the SophosLabs GitHub here.](https://github.com/sophoslabs/IoCs/blob/master/Ransomware-Ryuk.csv)\n\n**SophosLabs would like to acknowledge the contributions of Peter Mackenzie, Elida**\n**Leite, Syed Shahram and Bill Kearney of the MTR team, and Anand Aijan, Sivagnanam**\n**Gn, and Suraj Mundalik of SophosLabs to this report.**\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-10-14 - They’re back- inside a new Ryuk ransomware attack.pdf"
    ],
    "report_names": [
        "2020-10-14 - They’re back- inside a new Ryuk ransomware attack.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535988,
    "ts_updated_at": 1743041358,
    "ts_creation_date": 1653700938,
    "ts_modification_date": 1653700938,
    "files": {
        "pdf": "https://archive.orkl.eu/726d7a1e149819a699053e96f46ec3501b6c2e79.pdf",
        "text": "https://archive.orkl.eu/726d7a1e149819a699053e96f46ec3501b6c2e79.txt",
        "img": "https://archive.orkl.eu/726d7a1e149819a699053e96f46ec3501b6c2e79.jpg"
    }
}