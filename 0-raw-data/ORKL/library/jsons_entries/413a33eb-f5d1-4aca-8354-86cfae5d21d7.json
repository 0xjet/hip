{
    "id": "413a33eb-f5d1-4aca-8354-86cfae5d21d7",
    "created_at": "2023-01-12T15:08:06.033744Z",
    "updated_at": "2025-03-27T02:05:58.85413Z",
    "deleted_at": null,
    "sha1_hash": "991d7e400411a57abb942a3150692684cbd49369",
    "title": "2018-11-06 - Threat Spotlight- Inside VSSDestroy Ransomware (variant of Matrix Ransom)",
    "authors": "",
    "file_creation_date": "2022-05-28T02:30:00Z",
    "file_modification_date": "2022-05-28T02:30:00Z",
    "file_size": 1993321,
    "plain_text": "# Threat Spotlight: Inside VSSDestroy Ransomware\n\n**[blogs.blackberry.com/en/2018/11/threat-spotlight-inside-vssdestroy-ransomware](https://blogs.blackberry.com/en/2018/11/threat-spotlight-inside-vssdestroy-ransomware)**\n\nThe BlackBerry Cylance Threat Research Team, Tatsuya Hasegawa\n\n[RESEARCH & INTELLIGENCE / 11.06.18 /](https://blogs.blackberry.com/en/category/research-and-intelligence)\n\nVSSDestroy is a variant of the Matrix ransomware which targets Windows workstations.\nMatrix ransomware was spread via Rig EK as recently as 2017. This paper details the\nobservations made by the Cylance Threat Research team during their analysis of\nVSSDestroy.\n\n## Technical Analysis\n\nOur analysis begins with the execution of the malware payload. Upon execution, the\nransomware drops a copy of the malware file to the same directory of the original with the\nfollowing filename:\n\nNW[0-9a-zA-Z]{6}.exe\n\nThe copy of the malicious file then executes with the\"-n\" option: (NW[0-9a-zA-Z]{6}.exe -n )\n\n**Encryption:**\n\nVSSDestroy encrypts files and renames them with the .newrar extension:\n\n\n-----\n\n_Figure 1: File types encrypted by VSSDestroy_\n\nThe ransomware creates a README document for victims to read after encryption (Figure\n2):\n\n_Figure 2: Encrypted file and the README document_\n\nThe document instructs victims to email newrar(at)tuta[.]io or newrar(at)cock[.]lu to\nacquire a decryption key. A second avenue for communication, via bitmsg\n(hxxps://bitmsg[.]me/), is provided in case targets cannot communicate via email (Figure 3):\n\n\n-----\n\n_Figure 3: Contents of #NEWRAR_README#.rtf_\n\nVSSDestroy changes the background image of the affected system. The ransomware drops\nan image file named 0-9a-zA-Z]{8}.bmp and sets it as the wallpaper (Figure 4). The\nmalware modifies wallpaper settings in the following system registry locations:\n\n\n-----\n\nHKCU\\Control Panel\\Desktop\\Wallpaper\nHKCU\\Control Panel\\Desktop\\WallpaperStyle\nHKCU\\Control Panel\\Desktop\\TileWallpaper\n\n_Figure 4: Ransom wallpaper image_\n\nVictims will see the wallpaper after Windows reboot.\n\nThe Trojan drops a modified version of the Sysinternals tool called “Handle Viewer v4.11”.\nThe tool closes handles grabbed by running processes, allowing the ransomware to encrypt\nthem as well (Figure 5):\n\n_Figure 5: Handle Viewer [gLxNMqwr.exe]_\n\nThe modified version is packed with UPX whereas original HashViewer 4.11 is not packed.\n\nIf you unpack the modified version, there is only a slight difference between the original\nHashViewer 4.11 and the modified unpacked version (Figure 6):\n\n_Figure 6: HashViewer 4.11_\n\nDuring file encryption, the Trojan sends the infected computer name and any captured\nusernames to the C2 server (Figure 7):\n\n\n-----\n\nhxxp://no7654324wesdfghgfds[.]000webhostapp[.]com/addrecord[.]php\n\n_Figure 7: HTTP traffic_\n\nVSSDestroy searches for remote workstations by running an IP-incremental ARP scan of a\nrange of networks using NetShareEnum API. If anything is discovered, the malware will\nproceed to encrypt the files located on the remote resources:\n\n_Figure 8: ARP scan_\n\n## Removing VSS/Disabling Start-Up Repair\n\nVSSDestroy is designed to schedule a task named DSHCA which runs a bat file\n(FcHN8mhB.bat) every five minutes. This process is designed to let the ransomware delete\nshadow copies and disable start-up repair after a system reboot\n\n_Figure 9: Creating a scheduled task to run FcHN8mhB.bat every five minutes_\n\n_Figure 10: A script to remove shadow copies and disable start-up repair_\n\n## Summary\n\nIn testing, CylancePROTECT® detects and blocks both the ransomware file and malicious\nscripts.\n\n\n-----\n\n## Indicators of Compromise (IOCs)\n\n**Hashes**\n\n075f86e2db93138f3f3291bc8f362e5f54dfdeeb98b63026697b266fbebddb00\n193697be39290126d24363482627ff49ad7ff76ad12bbac43f53c0a3a614db5d\nd0c7b512610a1a206dbf4b4d8c352a26a26978abe8b5d0d3255f0b02196482a1\n91d07adbf35edb6bb96e7b210f17b9b868ed858802727d6f69c1e5a2d37a9c53\n0cfdbfb9c4a2a80794462f06cf0da43c5977aa61bd3bbe834002703fe44ef0b4\n(dropped executable file)\n\n**Filenames**\n\n**Malware Execution Directory**\n\nNW[0-9a-zA-Z]{6}.exe\n\n[0-9a-zA-Z]{8}.bat\n\n[0-9a-zA-Z]{8}.txt\nbad_[0-9a-zA-Z]{16}.txt\nelog_[0-9a-zA-Z]{16}.txt\nLFIN_[0-9a-zA-Z]{16}.txt\n\n[YOUR_GLOBAL_IPADDRESS]_log.txt\n\n[0-9a-zA-Z]{8}.exe\nPROCEXP152.SYS\n\n**%AppData%**\n\n[0-9a-zA-Z]{8}.bmp\n\n[0-9a-zA-Z]{8}.vbs\n\n[0-9a-zA-Z]{8}.bat\n\n**Every Directory**\n\n#NEWRAR_README#.rtf\n\n[newrar@tuta.io].[0-9a-z]{8}-[0-9a-z]{8}.newrar\n\n**C2s/IPs**\n\nhxxp://no7654324wesdfghgfds[.]000webhostapp[.]com/addrecord[.]php\no  145.14.144.16\no  145.14.144.143\no  145.14.145.178\no  145.14.144.182\n-Assigned IP address is dynamically changed in the segment.\n\n\n-----\n\nhxxp://myexternalip[.]com/raw\no  78.47.139.102\n\n**Mutexes**\n\no  MutexNEWRAR\no  MutexNEWRARDONW\n\n**Interesting strings/Commands**\n\no  NW[0-9a-zA-Z]{6}.exe -n\no  powershell \"$webClient = New-Object -TypeName\nSystem.Net.WebClient;$webClient.DownloadString('hxxp://myexternalip[.]com/raw')\"\n>\"[same directory of itself]\\[0-9a-zA-Z]{8}.txt\"\no  reg add \"HKCU\\Control Panel\\Desktop\" /v Wallpaper /t REG_SZ /d\n\"%AppData%\\[0-9a-zA-Z]{8}.bmp\" /f & reg add \"HKCU\\Control Panel\\Desktop\" /v\nWallpaperStyle /t REG_SZ /d \"0\" /f & reg add \"HKCU\\Control Panel\\Desktop\" /v\nTileWallpaper /t REG_SZ /d \"0\" /f\no  \"UseBackQ Tokens=3,6 delims=: \"\n\n## About The BlackBerry Cylance Threat Research Team\n\nThe BlackBerry Cylance Threat Research team examines malware and suspected malware\nto better identify its abilities, function and attack vectors. Threat Research is on the frontline\nof information security and often deeply examines malicious software, which puts us in a\nunique position to discuss never-seen-before threats.\n\n## About Tatsuya Hasegawa\n\n\n-----\n\nSenior Threat Researcher at BlackBerry Cylance\n\n[Tatsuya Hasegawa is a Senior Threat Researcher in APAC at BlackBerry, and is](https://www.linkedin.com/in/tatsuya-hasegawa-aa3279142/)\nresponsible for malware analysis and sandbox technology. He has practical experience in\nthe both managed security service provider as a security analyst and CSIRT as an incident\nhandler. His certifications include: GREM, GCIH, GCFA, GXPN, GPEN and CISSP.\n\nBack\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-11-06 - Threat Spotlight- Inside VSSDestroy Ransomware (variant of Matrix Ransom).pdf"
    ],
    "report_names": [
        "2018-11-06 - Threat Spotlight- Inside VSSDestroy Ransomware (variant of Matrix Ransom).pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536086,
    "ts_updated_at": 1743041158,
    "ts_creation_date": 1653705000,
    "ts_modification_date": 1653705000,
    "files": {
        "pdf": "https://archive.orkl.eu/991d7e400411a57abb942a3150692684cbd49369.pdf",
        "text": "https://archive.orkl.eu/991d7e400411a57abb942a3150692684cbd49369.txt",
        "img": "https://archive.orkl.eu/991d7e400411a57abb942a3150692684cbd49369.jpg"
    }
}