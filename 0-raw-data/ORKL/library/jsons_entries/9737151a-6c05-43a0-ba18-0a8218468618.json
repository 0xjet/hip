{
    "id": "9737151a-6c05-43a0-ba18-0a8218468618",
    "created_at": "2023-01-12T15:10:57.055992Z",
    "updated_at": "2025-03-27T02:14:11.95312Z",
    "deleted_at": null,
    "sha1_hash": "b5af2f325e669d681b974f8f001c14a705c3a09f",
    "title": "2022-08-18 - Cookie stealing- the new perimeter bypass",
    "authors": "",
    "file_creation_date": "2022-09-01T10:13:59Z",
    "file_modification_date": "2022-09-01T10:13:59Z",
    "file_size": 2668162,
    "plain_text": "# Cookie stealing: the new perimeter bypass\n\n**[news.sophos.com/en-us/2022/08/18/cookie-stealing-the-new-perimeter-bypass](https://news.sophos.com/en-us/2022/08/18/cookie-stealing-the-new-perimeter-bypass)**\n\nSean Gallagher August 18, 2022\n\nCredential-stealing malware is an integral part of the toolkit used by a wide variety of\ncybercriminals and other adversaries. While user account names and passwords are the\nmost obvious targets of credential-stealing activities, the increased use of multi-factor\nauthentication (MFA) to protect web-based services has reduced the effectiveness of that\napproach. Attackers are increasingly turning to stealing the “cookies” associated with\ncredentials to clone active or recent web sessions—bypassing MFA in the process.\n\nThe latest version of the Emotet botnet is just one of the many malware families that target\ncookies and other credentials stored by browsers, such as stored logins and (in some cases)\npayment card data. Google’s Chrome browser uses the same encryption method to store\nboth multi-factor authentication cookies and credit card data—both targets of Emotet.\n\nThe range of criminals targeting cookies is broad. At the bottom end of the cybercrime range,\ninformation-stealing malware such as the Raccoon Stealer malware-as-a-service and the\nRedLine Stealer keylogger / information stealer—both of which can be purchased through\nunderground forums—are often used by entry-level criminals to collect cookies and other\ncredentials in bulk for sale to criminal marketplaces.\n\n\n-----\n\n[One such marketplace, Genesis, was the apparent source for a cookie belonging to an](https://news.sophos.com/en-us/2022/08/04/genesis-brings-polish-to-stolen-credential-marketplaces/)\nemployee of the game developer Electronic Arts. Members of the Lapsus$ extortion group\n[claimed to have purchased a stolen session cookie from the marketplace, giving them](https://therecord.media/hackers-leak-full-ea-data-after-failed-extortion-attempt/)\naccess to EA’s Slack instance; that allowed them to spoof an existing login of an EA\nemployee and deceive a member of EA’s IT team into providing them network access. This\n[allowed Lapsus$ to grab 780 gigabytes of data, including game and graphics engine source](https://www.vice.com/en/article/wx5xpx/hackers-steal-data-electronic-arts-ea-fifa-source-code)\ncode, which the group then used to attempt to extort EA.\n\nAt the higher end of the criminal sophistication spectrum, we have observed active\nadversaries harvest cookies in a variety of ways. In some cases, we’ve seen evidence of\nransomware operators using the same info stealer malware as less sophisticated attackers.\nBut we’ve also often seen hands-on attacks abusing legitimate offensive-security tools such\nas [Mimikatz, Metasploit](https://tools.thehacker.recipes/mimikatz/modules/dpapi/chrome) [Meterpreter and](https://www.metasploit.com/) [Cobalt Strike to execute cookie harvesting malware](https://www.cobaltstrike.com/)\nor run scripts that grab cookies from browsers’ caches.\n\nThere are also legitimate applications and processes that interact with browser cookie files.\nWe found anti-malware software, auditing tools, and operating system helpers among\ncookie-snooping detections in Sophos telemetry: Bing’s wallpaper updater, for example,\naccesses cookies to retrieve new desktop backgrounds. But with these benign sources\nscreened out, we saw thousands of attempts to access browser cookies per day that fall\noutside the realm of benign software behavior. Occasionally, these detections spike\ndramatically as specific campaigns are launched. Additionally, some legitimate applications\nthat use cookies may leak them, exposing tokens to attackers.\n\n## Hands in the Cookie Jar\n\nBrowsers store cookies in a file; for Mozilla Firefox, Google Chrome, and Microsoft Edge, the\nfile is a SQLite database in the user profile folder. (Similar SQLite files store browser history,\nwebsite logins and autofill information on these browsers). Other applications that connect to\nremote services have their own cookie repositories, or in some cases access to those of web\nbrowsers.\n\nThe content of each cookie in the database is a list of parameters and values—a key-value\nstore that identifies the browser session to the remote website, including in some cases a\ntoken passed by the site to the browser after user authentication. One of these key-value\npairs specifies the expiration of the cookie—how long it is valid for before it must be\nrenewed.\n\n\n-----\n\nFigure 1: Some of the cookies in a cookies.sqlite file\nThe reason for cookie theft is straightforward: Cookies associated with authentication to web\nservices can be used by attackers in “pass the cookie” attacks, attempting to masquerade as\nthe legitimate user to whom the cookie was originally issued and gain access to web\nservices without a login challenge. This is similar to “pass the hash” attacks, which use\nlocally stored authentication hashes to gain access to network resources without having to\ncrack the passwords.\n\n\n-----\n\nFigure 2: Legitimate web-service activity…\n\nand how pass-the-cookie attacks subvert that.\n\n\n…\n\n\n-----\n\nThis can lead to exploitation of web services (such as AWS or Azure), software-as-a-service\nand collaboration services for further data exposure or lateral movement, such as business\nemail compromise, access to cloud data stores, or using a hijacked Slack session to lure\nadditional victims into downloading malware or exposing other data that can be leveraged for\naccess.\n\nMany web-based applications perform additional checks to prevent session spoofing, such\nas checking the IP address of the request against where the session was initiated. But if the\ncookies are used by a hands-on-keyboard attacker from within the same network, those\nsorts of measures may not be enough to stop exploitation. And applications that are built for\na combination of desktop and mobile use may not use geolocation as consistently.\n\nSome cookie theft attacks may be sprung completely remotely from within the target’s own\nbrowser. HTML injection attacks can use code inserted into a vulnerable web page to exploit\ncookies for other services—giving access to the target’s profile information on those services\nand allowing password and email changes.\n\n## Cheaper by the Dozen\n\nOften, malware operators will use paid download services and other untargeted approaches\nto gather as many victims’ cookies and other credentials as possible at low cost and with\nlittle effort. This type of stealer deployment is very similar to the ones used in Raccoon\nStealer and other malware campaigns we saw being distributed through droppers as a\nservice.\n\nMalware packages in ISOs or ZIP files are advertised through malicious websites boosted by\nsearch engine optimization as installers for pirated or “cracked” commercial software\npackages. ISO-based delivery packages are also widely used in place of malicious\ndocuments in malware spam email campaigns, mostly because of Microsoft’s recent blocking\nof macros in Office files from the Internet.\n\nIn one download-as-a-service case we saw on a college network, stealer malware arrived\nwrapped up in a fake software installer downloaded from a website, most likely one\nadvertising pirated commercial software. The installer was delivered in a 300-megabyte ISO\nfile downloaded by the user; large ISO files are often used in an attempt to jam up file scans\nby malware detection software.\n\nThe ISO contained BLENDERINSTALLER3.0.EXE, a repurposed software installation utility\nfrom another software package. This dropper installs several files, using a PowerShell\n[command and an executable created with AutoIT (a legitimate tool frequently abused by](https://www.autoitscript.com/site/autoit/)\nmalware operators) to extract malware from the .ISO and download additional malware files\nfrom Discord’s content delivery network. The malware package then injects a series of\ncommands through a .NET process (using jsc.exe from the .NET framework) to grab both\ncookies and login data from Chrome\n\n\n-----\n\nFigure 3: A fake installer / info stealer cookie theft\n\n## Crafted attacks\n\nMalicious spam is also used with other disguised attachments, often targeting organizations\nin specific industries or locations. In October 2021, a Turkish computer user received an\nemail with the attachment, an XZ archive file. This contains a disguised executable, “ürün\nörnekleri resmi pdf.exe” (which translates to “product samples image pdf.exe”). The\nexecutable was a self-extracting malware dropper built with the Delphi programming\nlanguage (known as “BobSoft Mini Delphi”).\n\nThe dropper, in turn, installed several executables. The first was a legitimate Microsoft Visual\nStudio component (msbuild.exe). MSBuild is normally used to compile and execute coding\n[projects; it can be passed project files or XML files containing scripts on the command line](https://lolbas-project.github.io/lolbas/Binaries/Msbuild/)\nand launch them Since the file is a trusted Microsoft binary, it can be packed into a dropper\nto mask the malicious nature of the malware.\n\nThe second executable was retrieved from the Discord content delivery network and\ndecrypted: It was the Phoenix keylogger, an information stealer. Also dropped at some point\n[was QuasarRat, a remote access tool written in C#.](https://github.com/malwares/QuasarRAT)\n\n\n-----\n\nOver the next week, the attacker used the installed QuasarRAT to launch the Phoenix info\nstealer and execute commands through MSBuild. The commands built and executed by\nMSBuild accessed the cookie files on the targeted machine.\n\nFigure 4: Portrait of a Malspam / Phoenix theft\n\n## Targeted exploitation\n\nStealing cookies is not just an automated activity. In some cases, it’s also part of efforts by\nactive adversaries seeking ways to deepen their penetration of a targeted network. In these\ncases, the attackers use a foothold on the network to deploy exploitation tools and use those\ntools to spread their access. As more data of value has moved off the network and into cloud\nservices, these attackers have added lateral movement to those services through cookie\nstealing and the scraping of web login data to their list of things to do.\n\nWe discovered an extended intrusion of this sort active in June 2022, in which cookie\nstealing was part of ongoing Cobalt Strike and Meterpreter activity stretching back months.\nThe attackers specifically targeted cookies in the Microsoft Edge browser. First, they were\nable to use the [Impacket exploit kit to spread from the initial point of entry via Windows SMB](https://github.com/SecureAuthCorp/impacket)\nfile transfer, dropping Cobalt Strike and Meterpreter on targeted computers within the\nnetwork.\n\n\n-----\n\nFigure 5: A hands-on cookie theft sequence\nNext, the attackers dropped a copy of a legitimate Perl script interpreter on the targeted\nsystem, along with a Perl script file (named c) and a batch file (execute.exe) seen in previous\nImpacket-based intrusions. They then used Meterpreter to pass the following command\nstring:\n```\nc:\\\\windows\\\\vss\\\\perl.exe -type c ^> \\\\\\\\127.0.0.1\\\\C$\\\\__output 2^>^&1 >\nC:\\\\WINDOWS\\\\TEMP\\\\execute.bat & C:\\\\WINDOWS\\\\system32\\\\cmd.exe\n\n/Q /c C:\\\\WINDOWS\\\\TEMP\\\\execute.bat & del C:\\\\WINDOWS\\\\TEMP\\\\execute.bat\n\n```\nThe Perl script accessed the cookie files on the target machine and output the contents to a\ntemporary file named _output. The batch file, among other things, transferred the contents of\n_output back to the attacker and deleted the Perl script. The remaining shell commands\nturned off screen output, deleted the batch file, and terminated the command shell.\n\n## Keeping a lid on cookies\n\nThese three examples represent just part of the cookie-stealing cybercrime spectrum.\nInformation-stealing malware increasingly include cookie theft as part of their functionality,\nand the success of marketplaces that make the sale of stolen cookies a viable business. But\nmore focused attackers are targeting cookies as well, and their activities may not be\ndetected by simple anti-malware defenses because of their abuse of legitimate executables,\nboth already present and brought along as tools.\n\n\n-----\n\nCookie theft would not be nearly as much of a threat if long-lived access cookies weren t\nused by so many applications. Slack, for example, uses a combination of persistent and\nsession-specific cookies to check for users’ identity and authentication. While session\ncookies are cleared when a browser is closed, some of these applications (such as Slack)\nremain open indefinitely in some environments. These cookies may not expire fast enough to\nprevent someone from exploiting them if they’re stolen. Single-sign-on tokens associated\nwith some multifactor authentication can pose the same potential threat if users don’t close\nsessions.\n\nRegularly clearing cookies and other authentication information for browsers reduces the\npotential attack surface provided by browser profile files, and organizations can use\nadministrative tools for some web-based platforms to shorten the allowable timeframe that\ncookies remain valid.\n\nBut strengthening cookie policies comes with trade-offs. Shortening the lives of cookies\nmeans more re-authentication by users. And some web-based applications that leverage\nclients based on Electron or similar development platforms may have their own cookiehandling issues; for instance, they may have their own cookie stores that can be specifically\ntargeted by attackers outside of the context of web browser stores.\n\nSophos uses several behavioral rules to prevent abuse of cookies by scripts and untrusted\nprograms and detects information-stealing malware with a number of memory and behavior\ndetections.\n\nIndicators of compromise for the attacks mentioned in this report are available on the\nSophosLabs Github page.\n\n**Sophos X-Ops thanks Felix Weyne of SophosLabs for his contributions to this report.**\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-08-18 - Cookie stealing- the new perimeter bypass.pdf"
    ],
    "report_names": [
        "2022-08-18 - Cookie stealing- the new perimeter bypass.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "52d5d8b3-ab13-4fc4-8d5f-068f788e4f2b",
            "created_at": "2022-10-25T16:07:24.503878Z",
            "updated_at": "2025-03-27T02:02:10.261742Z",
            "deleted_at": null,
            "main_name": "Lapsus$",
            "aliases": [
                "DEV-0537",
                "Strawberry Tempest"
            ],
            "source_name": "ETDA:Lapsus$",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "be5097b2-a70f-490f-8c06-250773692fae",
            "created_at": "2022-10-27T08:27:13.22631Z",
            "updated_at": "2025-03-27T02:00:55.534879Z",
            "deleted_at": null,
            "main_name": "LAPSUS$",
            "aliases": [
                "LAPSUS$",
                "DEV-0537",
                "Strawberry Tempest"
            ],
            "source_name": "MITRE:LAPSUS$",
            "tools": [
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d4b9608d-af69-43bc-a08a-38167ac6306a",
            "created_at": "2023-01-06T13:46:39.335061Z",
            "updated_at": "2025-03-27T02:00:03.053961Z",
            "deleted_at": null,
            "main_name": "LAPSUS",
            "aliases": [
                "LAPSUS$",
                "DEV-0537",
                "SLIPPY SPIDER",
                "Strawberry Tempest"
            ],
            "source_name": "MISPGALAXY:LAPSUS",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "2347282d-6b88-4fbe-b816-16b156c285ac",
            "created_at": "2024-06-19T02:03:08.099397Z",
            "updated_at": "2025-03-27T02:05:17.390442Z",
            "deleted_at": null,
            "main_name": "GOLD RAINFOREST",
            "aliases": [
                "Strawberry Tempest ",
                "Lapsus$"
            ],
            "source_name": "Secureworks:GOLD RAINFOREST",
            "tools": [
                "Mimikatz"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673536257,
    "ts_updated_at": 1743041651,
    "ts_creation_date": 1662027239,
    "ts_modification_date": 1662027239,
    "files": {
        "pdf": "https://archive.orkl.eu/b5af2f325e669d681b974f8f001c14a705c3a09f.pdf",
        "text": "https://archive.orkl.eu/b5af2f325e669d681b974f8f001c14a705c3a09f.txt",
        "img": "https://archive.orkl.eu/b5af2f325e669d681b974f8f001c14a705c3a09f.jpg"
    }
}