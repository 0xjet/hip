{
    "id": "089f9bbc-07f2-4604-bd2d-ec169f98101a",
    "created_at": "2023-02-02T02:07:55.027485Z",
    "updated_at": "2025-03-27T02:06:11.735594Z",
    "deleted_at": null,
    "sha1_hash": "6840ead663b5a38e4dd61ac51590ad28ee21fa3f",
    "title": "2022-12-25 - Detect Nokoyawa ransomware With YARA Rule",
    "authors": "",
    "file_creation_date": "2023-02-01T07:37:59Z",
    "file_modification_date": "2023-02-01T07:37:59Z",
    "file_size": 290726,
    "plain_text": "# Detect Nokoyawa ransomware With YARA Rule.\n\n**malgamy.github.io/malware-analysis/Nokoyawa/**\n\n4 minute read\n\n**On this page**\n\n**How to write Yara rule for Nokoyawa ransomware**\n\n[In the frist, we will work with 3 files that shared by\nzscaler](https://www.zscaler.com/blogs/security-research/nokoyawa-ransomware-rust-or-bust)\n\n**Introduction**\n\n\nDecember 21, 2022\n\n\nNokoyawa is a ransomware family that targets 64-bit Windows systems. It\nwas first identified\nin February 2022 and is known for its use of double\nextortion tactics, which involve\nexfiltrating sensitive data from\ntargeted organizations before encrypting files and demanding\na ransom\npayment. The initial version of Nokoyawa was written in C programming\nlanguage\nand used Elliptic Curve Cryptography (ECC) with SECT233R1 and\nSalsa20 for file\nencryption. In September 2022, a revised version of\nNokoyawa was released, which was\nrewritten in Rust programming language\nand utilized ECC with Curve25519 and Salsa20 for\nfile encryption. This\nnew version, known as Nokoyama 2.0, includes a configuration\nparameter\nthat can be passed via the command-line, providing threat actors with\ngreater\nflexibility at runtime.\n\n**IOCs**\n\n[7095beafff5837070a89407c1bf3c6acf8221ed786e0697f6c578d4c3de0efd6](https://www.virustotal.com/gui/file/7095beafff5837070a89407c1bf3c6acf8221ed786e0697f6c578d4c3de0efd6)\n[47c00ac29bbaee921496ef957adaf5f8b031121ef0607937b003b6ab2a895a12](https://www.virustotal.com/gui/file/47c00ac29bbaee921496ef957adaf5f8b031121ef0607937b003b6ab2a895a12)\n[259f9ec10642442667a40bf78f03af2fc6d653443cce7062636eb750331657c4](https://www.virustotal.com/gui/file/259f9ec10642442667a40bf78f03af2fc6d653443cce7062636eb750331657c4)\n\n**Loading sample with IDA pro**\n\nI manually write Yara rules by using IDA Pro to load samples and examine\ntheir strings for\nunique characteristics relevant to a specific family.\nFrom this analysis, I can use the identified\nstrings to craft effective\nYara rules.\n\nStrings with IDA\n\n\n-----\n\n“deps\\noko.pdb”\n“How to run:”\n”–config (to start full encryption)\"\n”–config --file \"\n“CIS lang detected! Stop working”\n“config isn’t configurated to load hidden drives”\n“ENCRYPT_NETWORKYour config isn’t configurated to encrypt network\nshares”\n“Your config isn’t configurated to delete shadow copies”\n“Successfully deleted shadow copies”\n\nBy analyzing strings of malware, we can extract relevant strings and use\nVirusTotal (if you\nhave a premium account) to test them individually in\norder to select appropriate conditions\nfor our rules\n\nWe can detect that the file “deps\\noko.pdb” will be present in all\nsamples because it is a\nmember of the family of pdb files.\n\n\n-----\n\nPDB stands for “Program Database,” and it is a file format used by\nMicrosoft Visual\nStudio to store debugging information about a\nprogram. It contains information about\nthe program’s code, data, and\nresources, as well as details about the program’s\nexecution. PDB\nfiles are typically used by developers to debug their programs and\nfix\nerrors. They can also be used by other tools, such as debugger\nprograms, to analyze\nthe code and execution of a program. PDB files\nare often associated with the .exe file\nof a program, and they are\ntypically stored in a separate directory or folder.\nWe can use the PDB as a condition for detecting the presence of the\nNokoyawa family\nin a sample. If the Yara scan identifies PDB in the\nsample, it will be identified as\nbelonging to the Nokoyawa family.\n\nAfter testing each string individually, we discovered that the first\nfour strings were present in\nthree samples, while the remaining strings\nwere present in only one sample. Based on this\ninformation, we can\nconclude that the first three strings are except to the PDB string, and\ncan\ntherefore be used to detect the presence of the three samples.\nTherefore, our condition will\nbe as follows: uint16(0) == 0x5A4D and\n($pdb or 3 of ($s*))\n\n**[Our YARA rule](https://github.com/MalGamy/YARA_Rules/blob/main/Nokoyawa.yara)**\n\n\n-----\n\n```\nrule Nokoyawa_ransomware: Nokoyawa\n\n{\n\n  meta:\n\n  description = \"Detect_Nokoyawa_ransomware\"\n\n  author = \"@malgamy12\"\n\n  date = \"20/12/2022\"\n\n  license = \"DRL 1.1\"\n\n    hash = \"7095beafff5837070a89407c1bf3c6acf8221ed786e0697f6c578d4c3de0efd6\"\n\n    hash = \"47c00ac29bbaee921496ef957adaf5f8b031121ef0607937b003b6ab2a895a12\"\n\n    hash = \"259f9ec10642442667a40bf78f03af2fc6d653443cce7062636eb750331657c4\"\n\n  strings:\n\n    $pdb = \"deps\\\\noko.pdb\" ascii\n\n    $s1 = \"How to run:\" ascii\n    $s2 = \"--config <base64 encoded config> (to start full encryption)\" ascii\n\n    $s3 = \"--config <base64 encoded config> --file <filePath>\" ascii\n\n    $s4 = \"CIS lang detected! Stop working\" ascii\n\n    $s5 = \"config isn't configurated to load hidden drives\" ascii\n\n    $s6 = \"ENCRYPT_NETWORKYour config isn't configurated to encrypt network\nshares\" ascii\n\n    $s7 = \"Your config isn't configurated to delete shadow copies\" ascii\n\n    $s8 = \"Successfully deleted shadow copies from\" ascii\n\n  condition:\n\n    uint16(0) == 0x5A4D and ($pdb or 3 of ($s*))\n\n}\n\n```\n**Testing**\n\n\n-----\n\nAs depicted in the preceding figure, it appears that our condition is\nfunctioning as intended.\nAfter conducting testing, we can confidently\nassert that our rules are effective on our sample\nset.\n\n**[Hunting](https://www.hybrid-analysis.com/yara-search)**\n\nFrom the previous figure, we can see the results of our rules\n\n\n-----\n\nThanks a lot for reading. You can find me into the following links\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-12-25 - Detect Nokoyawa ransomware With YARA Rule.pdf"
    ],
    "report_names": [
        "2022-12-25 - Detect Nokoyawa ransomware With YARA Rule.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1675303675,
    "ts_updated_at": 1743041171,
    "ts_creation_date": 1675237079,
    "ts_modification_date": 1675237079,
    "files": {
        "pdf": "https://archive.orkl.eu/6840ead663b5a38e4dd61ac51590ad28ee21fa3f.pdf",
        "text": "https://archive.orkl.eu/6840ead663b5a38e4dd61ac51590ad28ee21fa3f.txt",
        "img": "https://archive.orkl.eu/6840ead663b5a38e4dd61ac51590ad28ee21fa3f.jpg"
    }
}