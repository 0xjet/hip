{
    "id": "02e83e45-b535-4ce7-b474-c045c0abc6c1",
    "created_at": "2023-01-12T15:03:51.168533Z",
    "updated_at": "2025-03-27T02:05:59.582121Z",
    "deleted_at": null,
    "sha1_hash": "523753b81692786fc751e3be02c23f42dd74f35d",
    "title": "2019-01-22 - A Lazarus Keylogger- PSLogger",
    "authors": "",
    "file_creation_date": "2022-05-28T17:00:59Z",
    "file_modification_date": "2022-05-28T17:00:59Z",
    "file_size": 802090,
    "plain_text": "# A Lazarus Keylogger- PSLogger\n\n**norfolkinfosec.com/a-lazarus-keylogger-pslogger/**\n\nnorfolk January 22, 2019\n\nThis blog [recently referenced a late July](https://norfolkinfosec.com/recent-lazarus-tools/) [VNCert report containing file-based IOCs affiliated](https://web.archive.org/web/20180903103043/http://www.vncert.gov.vn/baiviet.php?id=101)\nwith attempted intrusions against financial organizations in Vietnam. Several contextual and\ntechnical characteristics of these files tie them to recent activity typically attributed to North\nKorean adversaries with a specific interest in the financial sector.\n\nThis post explores the technical characteristics of one of these files, a keylogging and\nscreengrabbing utility. Two versions of this utility have appeared in-the-wild. The first is\ndirectly identified in the VNCert alert and is a DLL injected via a modified version of the opensource PowerSploit framework. The second is a standalone executable submitted to\nVirusTotal by a user in Pakistan (and possibly used in an intrusion in that region).\n**syschk.ps1 (Vietnam)**\n\nMD5: 26466867557f84dd4784845280da1f27\n\nSHA1: ed7fcb9023d63cd9367a3a455ec94337bb48628a\n\nSHA256: 791205487bae0ac814440573e992ba2ed259dca45c4e51874325a8a673fa5ef6\n\nSyschk.ps1 contains three primary components: (1) A Base64 encoded DLL, (2) a Base64\nencoded variant of PowerSploit’s Invoke-ReflectivePEInjection, and (3) a routine for\ndecoding and executing these components. This script also contains references to\n“c:\\windows\\temp\\TMP0389A.tmp” (noted in the previous post for its similarity to another\nDPRK file path and directory) and “c:\\programdata\\1.dat” as part of a “remove-item” cmdlet\nroutine. The Base64 DLL can be copied, converted, and saved to another file for analysis.\n\nExtracted DLL\n\nMD5: d45931632ed9e11476325189ccb6b530\n\nSHA1: 081d5bd155916f8a7236c1ea2148513c0c2c9a33\n\nSHA256: efd470cfa90b918e5d558e5c8c3821343af06eedfd484dfeb20c4605f9bdc30e\n\nThe extracted malware is designed for 64-bit operating systems and contains an export\nnamed “Process.” The malware has two primary functions: grabbing keystroke (and\nclipboard) data, and grabbing screen captures of the user’s desktop. At launch, the malware\ncreates a file at “c:\\windows\\temp\\TMP0389A.tmp” containing the directory that the malware\nwill save files in.\n\nNext, the file begins monitoring keystrokes. These are logged and saved to a hardcoded\npath (visible in plaintext) within the user’s “AppData\\Local\\Temp” directory under a folder\nnamed “GoogleChrome” in a file named “chromeupdater_pk.” The keylogging routine uses\n\n\n-----\n\nthe GetKeyState and GetAsyncKeyState APIs and is not sophisticated, and logged keystroke\nand clipboard context is saved in plaintext.\n\nThe malware’s other functionality is to capture the desktop, compressing the images and\nsaving them in the same directory. These files are saved with the filename format\nchromeupdater_ps_[timestamp]. Notably, the malware uses two open-source\nimplementations to achieve this. To capture the desktop, it uses code likely derived from this\nexample (or code from which that example was derived). To perform compression, the\n[malware uses the XZip library, a derivation of the Info-Zip project. The combination of these](https://www.codeproject.com/KB/cpp/xzipunzip/XZip_demo.zip)\ncharacteristics is useful for identifying an additional variant of this malware.\n\nOpen-source screengrabbing implementation (left) and disassembled code graph (right).\n\n\n-----\n\nOpen-source XZip code implementation.\n\n**HSMBalance.exe**\n\nMD5 34404a3fb9804977c6ab86cb991fb130\n\nSHA1 b345e6fae155bfaf79c67b38cf488bb17d5be56d\n\nSHA256 c6930e298bba86c01d0fe2c8262c46b4fce97c6c5037a193904cfc634246fbec\n\nThe open-source screengrabbing code used in the keylogger from the Vietnam incident is\nrelatively uncommon: while a basic VirusTotal pivot on one of the more distinct strings from\nthis code identifies dozens of additional files that use it, most belong to a benign screensharing package. On the other hand, the malicious files include the Vietnam keylogger and a\nsecond keylogger submitted by a user in Pakistan with strikingly similar static and dynamic\nproperties (the hash of this file is listed above). A brief static analysis identifies the following\nstrings:\n\n_CDisplayHandlesPool: GetDC failed_\n_CDisplayHandlesPool: EnumDisplayMonitors failed_\n_CreateBitmapFinal: GetDIBits failed_\n_CaptureDesktop: CreateCompatibleDC failed_\n_CaptureDesktop: CreateCompatibleBitmap failed_\n_CaptureDesktop: SelectObject failed_\n_CaptureDesktop: BitBlt failed_\n_SpliceImages: CreateCompatibleDC failed_\n_SpliceImages: CreateCompatibleBitmap failed_\n_SpliceImages: SelectObject failed_\n_SpliceImages: BitBlt failed_\n\n_wild scan_\n\n_more < 2_\n\n\n-----\n\n_.zip_\n_.zoo_\n_.arc_\n_.lzh_\n_.arj_\n_.tgz_\n\nAs a triaging step, this strongly suggests the use of the same compression and\nscreengrabbing libraries. In addition, there are several other string similarities:\n\nPakistan file:\n_%s%s_\n_%s\\tmp_%s_\n\n_[%02d%02d-%02d:%02d:%02d]_\n\n_[Num %d]_\n\n_[ENTER]_\n\n_[EX]_\n_keycode = %ls keystatus = %d \\n_\n_%s\\tmp_%s_%02d%02d_%02d%02d%02d_\n_PSLogger.exe_\n\nVietnam File:\n_%s\\chromeupdater_pk_\n_%s\\chromeupdater_ps_%04d%02d%02d_%02d%02d%02d_%03d_%d_\n\n_[%02d:%02d:%02d:%03d]_\n_%s%s_\n\n_[ENTER]_\n\n_[EX]_\n\n_[CTL]_\n_PSLogger.dll_\n\nWhile some of these are not a 1:1 match, there are some clear similarities regarding the\nlikely functionality of the file and the naming conventions. Notably, this “new” file also\ncontains the same exported function name (“Process”) as the Vietnam DLL despite being an\nexecutable, suggesting that it may have been built using the same codebase. In addition, the\nfile contains a reference to the same “TMP0389A.tmp” file and path as the Vietnam\nkeylogger (though this is decoded at runtime). The combination of the shared strings, export,\nlibraries (including XZip), and (as will be explored shortly) functionality strongly suggests that\nthis file is likely attributable to the same threat actor.\n\nFunctionality\n\nAs mentioned, this file contains a decoding routine responsible for decrypting several strings,\nincluding:\n\n\n-----\n\nDownloads – Appended to the user s Appdata\\Local\\Temp path.\n“c:\\windows\\temp\\TMP0389A.tmp” – Intended to contain directory storing keylogs and\nscreenshots.\n“c:\\windows\\temp\\tmp1105.tmp” – Unknown purpose\n\nXOR decoding routines for\n\nseveral file paths within the malware\n\nAs with the Vietnam file, this file’s two core functions are screengrabbing (using the same\nlibrary) and keylogging. Both files are stored at “Appdata\\Local\\Temp\\Downloads.”\nScreenshots are generated as Bitmaps via CreateCompatibleBitmap, compressed, and\nsaved in this directory as “tmp_[username][mmdd{time}]” (e.g. tmp_userA_0121_142748″).\nAs additional screenshots are created, they are appended to the same file (although rerunning the malware will create a new file). Kesystrokes (along with process data) are\nrecorded in the same directory, under a file named “tmp_[user]” – unlike the Vietnam file,\nthese keylogs are encrypted prior to storage.\n\nWhile the malware author did take anti-analysis steps (including encoding several filepaths\nand keystroke logs), the malware as a whole remains generally unsophisticated.\n**Closing Thoughts**\n\n\n-----\n\nNeither variant of the malware is particularly sophisticated; in fact, key components of each\nrely on clunky implementations of open source tools and code (including screengrabbing,\ncompression, and memory injection). This deficiency is most evident in the screenshot\ncompression segment, in which new data is simply appended to an older file. A tool such as\n7Zip cannot properly unpack every screenshot appended this way; instead, the adversary\nwould need to manually carve these out (or write an additional tool to do so) given the fact\nthat additional zip data is simply appended to the end of the file.\n\nIt is also worth noting that neither file contains a C2 mechanism, meaning that log files and\ncompressed images would have to be extracted from the target device manually. This\nsuggests that these tools are designed for post-compromise use, possibly on machines\nintended to be monitored for an extended period of time.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-01-22 - A Lazarus Keylogger- PSLogger.pdf"
    ],
    "report_names": [
        "2019-01-22 - A Lazarus Keylogger- PSLogger.pdf"
    ],
    "threat_actors": [
        {
            "id": "32a223a8-3c79-4146-87c5-8557d38662ae",
            "created_at": "2022-10-25T15:50:23.703698Z",
            "updated_at": "2025-03-27T02:00:55.528031Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "Lazarus Group",
                "Labyrinth Chollima",
                "HIDDEN COBRA",
                "Guardians of Peace",
                "NICKEL ACADEMY",
                "Diamond Sleet"
            ],
            "source_name": "MITRE:Lazarus Group",
            "tools": [
                "RawDisk",
                "Proxysvc",
                "BADCALL",
                "FALLCHILL",
                "WannaCry",
                "HOPLIGHT",
                "TYPEFRAME",
                "Dtrack",
                "HotCroissant",
                "HARDRAIN",
                "Dacls",
                "KEYMARBLE",
                "TAINTEDSCRIBE",
                "AuditCred",
                "netsh",
                "ECCENTRICBANDWAGON",
                "AppleJeus",
                "BLINDINGCAN",
                "ThreatNeedle",
                "Volgmer",
                "Cryptoistic",
                "RATANKBA",
                "Bankshot",
                "Torisma",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "a2b92056-9378-4749-926b-7e10c4500dac",
            "created_at": "2023-01-06T13:46:38.430595Z",
            "updated_at": "2025-03-27T02:00:02.831633Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "Operation DarkSeoul",
                "APT38",
                "ATK117",
                "DEV-1222",
                "G0032",
                "APT 38",
                "Stardust Chollima",
                "APT-C-26",
                "ATK3",
                "Diamond Sleet",
                "Hidden Cobra",
                "Unit 121",
                "Subgroup: Bluenoroff",
                "NICKEL GLADSTONE",
                "DEV-0139",
                "Andariel",
                "Operation Troy",
                "COVELLITE",
                "TA404",
                "Lazarus group",
                "Dark Seoul",
                "G0082",
                "NewRomanic Cyber Army Team",
                "Bluenoroff",
                "Appleworm",
                "Nickel Academy",
                "COPERNICIUM",
                "Hastati Group",
                "Bureau 121",
                "Operation AppleJeus",
                "Whois Hacking Team",
                "Citrine Sleet",
                "Sapphire Sleet",
                "Group 77",
                "Labyrinth Chollima",
                "Operation GhostSecret",
                "BeagleBoyz"
            ],
            "source_name": "MISPGALAXY:Lazarus Group",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f32df445-9fb4-4234-99e0-3561f6498e4e",
            "created_at": "2022-10-25T16:07:23.756373Z",
            "updated_at": "2025-03-27T02:02:09.966155Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "APT-C-26",
                "ATK 3",
                "Appleworm",
                "Citrine Sleet",
                "DEV-0139",
                "Diamond Sleet",
                "Gleaming Pisces",
                "Gods Apostles",
                "Gods Disciples",
                "Group 77",
                "Guardians of Peace",
                "Hastati Group",
                "Hidden Cobra",
                "ITG03",
                "Jade Sleet",
                "Labyrinth Chollima",
                "Lazarus Group",
                "NewRomanic Cyber Army Team",
                "Operation 99",
                "Operation AppleJeus",
                "Operation AppleJeus sequel",
                "Operation Blockbuster: Breach of Sony Pictures Entertainment",
                "Operation CryptoCore",
                "Operation Dream Job",
                "Operation Dream Magic",
                "Operation Flame",
                "Operation GhostSecret",
                "Operation In(ter)caption",
                "Operation LolZarus",
                "Operation Marstech Mayhem",
                "Operation No Pineapple!",
                "Operation North Star",
                "Operation Phantom Circuit",
                "Operation Sharpshooter",
                "Operation Ten Days of Rain / DarkSeoul",
                "Operation Troy",
                "SectorA01",
                "Slow Pisces",
                "TA404",
                "TraderTraitor",
                "UNC2970",
                "UNC4034",
                "UNC4736",
                "UNC4899",
                "UNC577",
                "Whois Hacking Team"
            ],
            "source_name": "ETDA:Lazarus Group",
            "tools": [
                "3CX Backdoor",
                "3Rat Client",
                "3proxy",
                "AIRDRY",
                "ARTFULPIE",
                "ATMDtrack",
                "AlphaNC",
                "Alreay",
                "Andaratm",
                "AngryRebel",
                "AppleJeus",
                "Aryan",
                "AuditCred",
                "BADCALL",
                "BISTROMATH",
                "BLINDINGCAN",
                "BTC Changer",
                "BUFFETLINE",
                "BanSwift",
                "Bankshot",
                "Bitrep",
                "Bitsran",
                "BlindToad",
                "Bookcode",
                "BootWreck",
                "BottomLoader",
                "Brambul",
                "BravoNC",
                "Breut",
                "COLDCAT",
                "COPPERHEDGE",
                "CROWDEDFLOUNDER",
                "Castov",
                "CheeseTray",
                "CleanToad",
                "ClientTraficForwarder",
                "CollectionRAT",
                "Concealment Troy",
                "Contopee",
                "CookieTime",
                "Cyruslish",
                "DAVESHELL",
                "DBLL Dropper",
                "DLRAT",
                "DRATzarus",
                "DRATzarus RAT",
                "Dacls",
                "Dacls RAT",
                "DarkComet",
                "DarkKomet",
                "DeltaCharlie",
                "DeltaNC",
                "Dembr",
                "Destover",
                "DoublePulsar",
                "Dozer",
                "Dtrack",
                "Duuzer",
                "DyePack",
                "ECCENTRICBANDWAGON",
                "ELECTRICFISH",
                "Escad",
                "EternalBlue",
                "FALLCHILL",
                "FYNLOS",
                "FallChill RAT",
                "Farfli",
                "Fimlis",
                "FoggyBrass",
                "FudModule",
                "Fynloski",
                "Gh0st RAT",
                "Ghost RAT",
                "Gopuram",
                "HARDRAIN",
                "HIDDEN COBRA RAT/Worm",
                "HLOADER",
                "HOOKSHOT",
                "HOPLIGHT",
                "HOTCROISSANT",
                "HOTWAX",
                "HTTP Troy",
                "Hawup",
                "Hawup RAT",
                "Hermes",
                "HotCroissant",
                "HotelAlfa",
                "Hotwax",
                "HtDnDownLoader",
                "Http Dr0pper",
                "ICONICSTEALER",
                "Joanap",
                "Jokra",
                "KANDYKORN",
                "KEYMARBLE",
                "Kaos",
                "KillDisk",
                "KillMBR",
                "Koredos",
                "Krademok",
                "LIGHTSHIFT",
                "LIGHTSHOW",
                "LOLBAS",
                "LOLBins",
                "Lazarus",
                "LightlessCan",
                "Living off the Land",
                "MATA",
                "MBRkiller",
                "MagicRAT",
                "Manuscrypt",
                "Mimail",
                "Mimikatz",
                "Moudour",
                "Mydoom",
                "Mydoor",
                "Mytob",
                "NACHOCHEESE",
                "NachoCheese",
                "NestEgg",
                "NickelLoader",
                "NineRAT",
                "Novarg",
                "NukeSped",
                "OpBlockBuster",
                "PCRat",
                "PEBBLEDASH",
                "PLANKWALK",
                "POOLRAT",
                "PSLogger",
                "PhanDoor",
                "Plink",
                "PondRAT",
                "PowerBrace",
                "PowerRatankba",
                "PowerShell RAT",
                "PowerSpritz",
                "PowerTask",
                "Preft",
                "ProcDump",
                "Proxysvc",
                "PuTTY Link",
                "QUICKRIDE",
                "QUICKRIDE.POWER",
                "Quickcafe",
                "QuiteRAT",
                "R-C1",
                "ROptimizer",
                "Ratabanka",
                "RatabankaPOS",
                "Ratankba",
                "RatankbaPOS",
                "RawDisk",
                "RedShawl",
                "Rifdoor",
                "Rising Sun",
                "Romeo-CoreOne",
                "RomeoAlfa",
                "RomeoBravo",
                "RomeoCharlie",
                "RomeoCore",
                "RomeoDelta",
                "RomeoEcho",
                "RomeoFoxtrot",
                "RomeoGolf",
                "RomeoHotel",
                "RomeoMike",
                "RomeoNovember",
                "RomeoWhiskey",
                "Romeos",
                "RustBucket",
                "SHADYCAT",
                "SHARPKNOT",
                "SIGFLIP",
                "SIMPLESEA",
                "SLICKSHOES",
                "SORRYBRUTE",
                "SUDDENICON",
                "SUGARLOADER",
                "SheepRAT",
                "SierraAlfa",
                "SierraBravo",
                "SierraCharlie",
                "SierraJuliett-MikeOne",
                "SierraJuliett-MikeTwo",
                "SimpleTea",
                "SimplexTea",
                "SmallTiger",
                "Stunnel",
                "TAINTEDSCRIBE",
                "TAXHAUL",
                "TFlower",
                "TOUCHKEY",
                "TOUCHMOVE",
                "TOUCHSHIFT",
                "TOUCHSHOT",
                "TWOPENCE",
                "TYPEFRAME",
                "Tdrop",
                "Tdrop2",
                "ThreatNeedle",
                "Tiger RAT",
                "TigerRAT",
                "Trojan Manuscript",
                "Troy",
                "TroyRAT",
                "VEILEDSIGNAL",
                "VHD",
                "VHD Ransomware",
                "VIVACIOUSGIFT",
                "VSingle",
                "ValeforBeta",
                "Volgmer",
                "Vyveva",
                "W1_RAT",
                "Wana Decrypt0r",
                "WanaCry",
                "WanaCrypt",
                "WanaCrypt0r",
                "WannaCry",
                "WannaCrypt",
                "WannaCryptor",
                "WbBot",
                "Wcry",
                "Win32/KillDisk.NBB",
                "Win32/KillDisk.NBC",
                "Win32/KillDisk.NBD",
                "Win32/KillDisk.NBH",
                "Win32/KillDisk.NBI",
                "WinorDLL64",
                "Winsec",
                "WolfRAT",
                "Wormhole",
                "YamaBot",
                "Yort",
                "ZetaNile",
                "concealment_troy",
                "http_troy",
                "httpdr0pper",
                "httpdropper",
                "klovbot",
                "sRDI"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535831,
    "ts_updated_at": 1743041159,
    "ts_creation_date": 1653757259,
    "ts_modification_date": 1653757259,
    "files": {
        "pdf": "https://archive.orkl.eu/523753b81692786fc751e3be02c23f42dd74f35d.pdf",
        "text": "https://archive.orkl.eu/523753b81692786fc751e3be02c23f42dd74f35d.txt",
        "img": "https://archive.orkl.eu/523753b81692786fc751e3be02c23f42dd74f35d.jpg"
    }
}