{
    "id": "11fd420b-72b5-4fab-84a6-00cc0f56a4c3",
    "created_at": "2022-10-25T16:48:13.319692Z",
    "updated_at": "2025-03-27T02:05:32.519909Z",
    "deleted_at": null,
    "sha1_hash": "a119cd353c04867a79f19297b85442b17c8ca590",
    "title": "New Poison Ivy RAT Variant Targets Hong Kong Pro-Democracy Activists - Palo Alto Networks BlogPalo Alto Networks Blog",
    "authors": "",
    "file_creation_date": "2016-04-22T18:10:11Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 588291,
    "plain_text": "### 1\n\n\n**the Poison Ivy (aka PIVY) RAT. Poison Ivy has a convenient graphical user interface (GUI) for**\n\n**managing compromised hosts and provides easy access to a rich suite of post-compromise**\n\n**tools. It is no surprise it’s now being used against pro-democracy organizations and supporters**\n\n**in Hong Kong that have long been a target of advanced attack campaigns.**\n\n**Despite its simplicity and prevalence, detection rates for both AV and IDS systems has always**\n\n**been surprisingly low for Poison Ivy. Possibly for these reasons, since the mid-2000s threat**\n\n**actors have frequently used Poison Ivy to establish beachheads within target organizations,**\n\n**although this occurs much less frequently today than in years past. Since the last public release**\n\n**of version 2.3.2 in 2008, new variants of the tool have been relatively rare, especially versions**\n\n**which modify the core communication protocols.**\n\n**Unit 42 observed a new version of Poison Ivy which uses the popular search order hijacking,**\n\n**[a/k/a “DLL Sideloading,” technique frequently seen in malware such as PlugX. The Poison Ivy](https://attack.mitre.org/wiki/DLL_side-loading)**\n\n**builder has an output format option of either PE file or shellcode, and in this case the backdoor**\n\n**was built as shellcode and then obfuscated to help prevent detection. While analyzing the**\n\n**sample, we also observed a modified network communication protocol which will be discussed**\n\n**in this blog.**\n\n**In March, Unit 42 observed this new Poison Ivy variant we’ve named SPIVY being deployed via**\n\n**weaponized documents leveraging CVE-2015-2545. All of the decoy document themes involved**\n\n**recent Hong Kong pro-democracy events. In all of the samples we’ve found to date the exploit**\n\n**drops a self-extracting RAR which contains three files:**\n\n**exe – a legitimate, signed executable which is used to side-load the malware DLL**\n\n**dll – the malware DLL loaded by RasTls.exe, which then loads the Poison Ivy shellcode file**\n\n**hlp – the encoded shellcode Poison Ivy backdoor.**\n\n**Both identified C2 domains are third-levels off of leeh0m[.]org, which was created in late**\n\n**February 2016, less than a month before the attacks.**\n\n**_Figure 1. Malicious RARs and the three files within_**\n\n**In addition to the new variant we discovered, Japan’s Computer Emergency Response Team**\n\n**[Coordination Center (JPCERTCC) published a blog last July on a different new variant. That](http://blog.jpcert.or.jp/2015/07/poisonivy-adapts-to-communicate-through-authentication-proxies.html)**\n\n**variant is also side-loaded from a legitimate executable and stub DLL, but the shellcode isn’t**\n\n**encoded the same way as SPIVY. JPCERTCC didn’t comment on who was being targeted in**\n\n**their blog, but it is notable that two distinct Poison Ivy variants have recently appeared, several**\n\n**years after the tool largely fell out of common use by advanced actors.**\n\n**We believe the samples dropped have a direct connection to older Poison Ivy RATs based off of**\n\n**the behaviors and code reuse present in the shellcode loaded by the samsung.hlp file within the**\n\n**RAR. Once decoded, the shellcode is launched by ssMUIDLL.dll.**\n\n|Col1|POSTED BY: Micah Yates, Mike Scott, Brandon Levene and Jen Miller-Osborn on April 21, 2016 7:45 PM|\n|---|---|\n|1||\n|LLiikkee|FILED IN: Malware, Unit 42 TAGGED: DLL, PIVY, Poison Ivy, SPIVY Malware writers have always sought to develop feature-rich, easy to use tools that are also somewhat hard to detect via both host- and network-based detection systems. For many years, one of the go-to families of malware used by both less-skilled and advanced actors has been|\n|Tweet||\n|1||\n\n\n## New Poison Ivy RAT Variant Targets Hong Kong Pro-Democracy Activists\n\n**[posted by Micah Yates on April 21, 2016](http://researchcenter.paloaltonetworks.com/author/micah-yates/)**\n\n## Next-Generation Security with Palo Alto Networks VM-series and VMware NSX\n\n**[posted by Palo Alto Networks on April 21, 2016](http://researchcenter.paloaltonetworks.com/author/palo-alto-networks-staff/)**\n\n## Growing Awareness of Cyber Framework Bodes Well for Global Risk Management\n\n**[posted by Danielle Kriz on April 20, 2016](http://researchcenter.paloaltonetworks.com/author/danielle-kriz/)**\n\n## New on Security Roundtable: Cyber Insurance is a Misnomer\n\n**[posted by Cristina Salmastlian on April 19, 2016](http://researchcenter.paloaltonetworks.com/author/cristina-salmastlian/)**\n\n## Python-Based PWOBot Targets European Organizations\n\n**[posted by Josh Grunzweig on April 19, 2016](http://researchcenter.paloaltonetworks.com/author/josh-grunzweig/)**\n\n**[MORE →](http://researchcenter.paloaltonetworks.com/archives/)**\n\n\n**Get Updates**\n**Sign up to receive the latest news, cyber**\n**threat intelligence and research from Unit**\n**42.**\n\n**Business Email**\n\n**Submit**\n\n\n**LikeLike**\n\n\n-----\n\n**_Figure 2. The encoded shellcode is decoded with a single byte addition of 0x99, XOR with_**\n\n**_0xD4, then subtract 0x33._**\n\n**The SPIVY RAT uses the same API call table generation historically used by Poison Ivy. Shown**\n\n**below is a comparison of a PIVY sample from 2008 and our newer SPIVY sample on the right.**\n\n**Both have the exact same API call table function.**\n\n**_Figure 3. PIVY sample from 2008 and SPIVY variant with the same API call table function._**\n\n**Unlike previous versions of Poison Ivy which utilize a fixed 256 byte challenge-response**\n\n**handshake, this new version generates a payload that has been prepended with anywhere from**\n\n**1 to 16 bytes of pseudo-random data (plus control bytes), the 1st byte of which gives the length**\n\n**of the padding before the start of the 256 byte handshake. In the example below the first byte**\n\n**(0x09) tells the Poison Ivy controller to ignore the following 9 bytes (which were nulled out below**\n\n**for illustration purposes), plus one more byte which holds the first byte multiplied by 2 ( 0x09 X 2**\n\n**= 0x12). Two control bytes, plus the 9 random, plus the 256 byte handshake gives us 267 total**\n\n**[bytes. The Poison Ivy protocol has been very well documented in previous research by Conix](http://blog.conixsecurity.fr/wp-content/uploads/2013/10/Poison-Ivy-RAT-conf-comms.pdf)**\n\n**Security and others, and in these samples the remainder of the protocol remains unchanged.**\n\n**_Figure 4. SPIVY’s new challenge-response._**\n\n**We saw two Poison Ivy configurations with our samples, shown below.**\n\n**SHA256: 9c6dc1c2ea5b2370b58b0ac11fde8287cd49aee3e089dbdf589cc8d51c1f7a9e**\n\n**Password: bqesid#@**\n\n**C2 domain: found.leeh0m[.]org**\n\n\n-----\n\n**SHA256: 4d38d4ee5b625e09b61a253a52eb29fcf9c506ee9329b3a90a0b3911e59174f2**\n\n**Password: bqesid#@**\n\n**C2 domain: sent.leeh0m[.]org**\n\n**C2 port: 443**\n\n**Mutex: 40EM76iR9**\n\n**ID: 03-07**\n\n**Group: 03-07**\n\n**Decoy documents are a common technique used by many actors to trick victims into believing**\n\n**they have opened legitimate files from spear phishing e-mails. The attacker sends a malicious**\n\n**file which infects the host with malware and then displays a clean document which contains**\n\n**content the victim is expecting to see.**\n\n**The decoy documents associated with SPIVY are notable because they reference very specific**\n\n**recent events and organizations not widely publicized or known outside of the Hong Kong**\n\n**region and the pro-democracy movement. In addition, all appear to be legitimate invitations to**\n\n**actual events in Hong Kong. One of the decoys purports to be from Joshua Wong, announcing a**\n\n**press conference about ending the Scholarism group to start a progressive democratic political**\n\n**party, Demosistō, in March 2016. Joshua Wong is a well known Hong Kong activist who was**\n\n**one of the founders of the group and is the current Secretary-General for the political party.**\n\n**Scholarism centered around concerns for the Hong Kong’s Department of Education adding a**\n\n**mandatory course for all secondary-school students for “moral and national education”.**\n\n**Scholarism was successful in stopping the course and its members desired to shift into a**\n\n**political party to effect further change.**\n\n**_Figure 5. Invitation to press conference about disbanding Scholarism and establishing a political_**\n\n**_party._**\n\n**Another decoy concerns the Mong Kok riot that took place February 8, 2016, the first day of the**\n\n**Lunar New Year. It purports to be from the Justice & Peace Commission of the Hong Kong**\n\n**Catholic Diocese and calls for the government to establish an independent commission to**\n\n**investigate the cause of the riots and for parishes to establish booths throughout April staffed**\n\n**with church members advertising this. The riots were officially written off as being caused by a**\n\n**crackdown on unlicensed street vendors, but the decoy claims it’s instead a sign of continued**\n\n**civil unrest and dissatisfaction with the government in Hong Kong.**\n\n\n-----\n\n**_Figure 6. Decoy allegedly from the Justice & Peace Commission of the Hong Kong Catholic_**\n\n**_Diocese_**\n\n**The final decoy is an invitation to an April 4, 2016 wreath laying event held by the Hong Kong**\n\n**Alliance in Support of Patriotic Democratic Movements of China. The event commemorated the**\n\n**28[th] anniversary of the Tiananmen Square massacre and related events, information to which**\n\n**China heavily censors access for mainland Chinese citizens.**\n\n**_Figure 7. Decoy for an April 4, 2016 wreath laying event commemorating the Tiananmen Square_**\n\n**_massacre held by the Hong Kong Alliance in Support of Patriotic Democratic Movements of_**\n\n**_China._**\n\n**The venerable Poison Ivy has been revamped and used to continue targeted attacks against**\n\n**pro-democracy activists in Hong Kong. It’s fairly common to see actors retool malware to make**\n\n**it harder to detect, though it was rarely seen before with Poison Ivy. The updated execution and**\n\n**communications mechanisms of SPIVY offer insight into the ever changing tools, techniques,**\n\n**and practices of targeted attackers. Unit 42 will continue to follow these attacks and any new**\n\n**Poison Ivy variants and provide updates as we uncover new information. It is clearly**\n\n**demonstrated by this recent campaign that an old dog can learn new tricks.**\n\n**Pro-democratic activists in Hong Kong have increasingly been targeted by APT campaigns.**\n\n**Below are links to several related reports from different researchers. We don’t necessarily link**\n\n**the activity in this blog to any of the specific campaigns cited in the links; instead, they are**\n\n**provided for situational awareness.**\n\n**[October 2014 blog from Volexity titled “Democracy in Hong Kong Under Attack”](http://www.volexity.com/blog/?p=33)**\n\n**[June 2015 blog from Citizen Lab titled “Targeted Attacks against Tibetan and Hong Kong](https://citizenlab.org/2015/06/targeted-attacks-against-tibetan-and-hong-kong-groups-exploiting-cve-2014-4114/)**\n\n**Groups Exploiting CVE-2014-4114”**\n\n**[December 2015 blog from FireEye titled “China-based Cyber Threat Group Uses Dropbox for](https://www.fireeye.com/blog/threat-research/2015/11/china-based-threat.html)**\n\n**Malware Communications and Targets Hong Kong Media Outlets”**\n\n**[April 2016 blog from Citizen Lab titled “Between Hong Kong and Burma: Tracking UP007 and](https://citizenlab.org/2016/04/between-hong-kong-and-burma/)**\n\n**SLServer Espionage Campaigns”**\n\n**Palo Alto Networks customers can identify SPIVY command and control traffic using Threat**\n\n**[Prevention signature ID and AutoFocus users can track this family using the SPIVY tag.](https://autofocus.paloaltonetworks.com/#/tag/Unit42.SPIVY)**\n\n**IOCs**\n\n\n-----\n\n**9c6dc1c2ea5b2370b58b0ac11fde8287cd49aee3e089dbdf589cc8d51c1f7a9e**\n\n**Loader Files**\n\n**_RasTls.exe – legitimate, signed binary that is used in the sideloading process_**\n\n**0191cb2a2624b532b2dffef6690824f7f32ea00730e5aef5d86c4bad6edf9ead**\n\n**_ssMUIDLL.dll – 7a424ad3f3106b87e8e82c7125834d7d8af8730a2a97485a639928f66d5f6bf4_**\n\n**Poison Ivy shellcode files**\n\n**c707716afde80a41ce6eb7d6d93da2ea5ce00aa9e36944c20657d062330e13d8**\n\n**0414bd2186d9748d129f66ff16e2c15df41bf173dc8e3c9cbd450571c99b3403**\n\n**C2 Domains**\n\n**sent.leeh0m[.]org**\n\n**found.leeh0m[.]org**\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2016/2016.04.21.New_Poison_Ivy_RAT_Variant_Targets_Hong_Kong/unit42-new-poison-ivy-rat-variant-targets-hong-kong-pro-democracy-activists.pdf"
    ],
    "report_names": [
        "unit42-new-poison-ivy-rat-variant-targets-hong-kong-pro-democracy-activists"
    ],
    "threat_actors": [],
    "ts_created_at": 1666716493,
    "ts_updated_at": 1743041132,
    "ts_creation_date": 1461348611,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/a119cd353c04867a79f19297b85442b17c8ca590.pdf",
        "text": "https://archive.orkl.eu/a119cd353c04867a79f19297b85442b17c8ca590.txt",
        "img": "https://archive.orkl.eu/a119cd353c04867a79f19297b85442b17c8ca590.jpg"
    }
}