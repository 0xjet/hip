{
    "id": "5a608ec8-3573-4afc-aa12-6fe2e515cced",
    "created_at": "2022-10-25T16:48:24.111483Z",
    "updated_at": "2025-03-27T02:16:07.358075Z",
    "deleted_at": null,
    "sha1_hash": "79b9e779c11668efaab691c4941ea27503b01ba1",
    "title": "",
    "authors": "",
    "file_creation_date": "2020-09-18T10:19:16Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 1136493,
    "plain_text": "# 17 SEP 2020\n\nAlert Number\n# ME-000134-MW\n\n*Note: This information is being\n\n_provided by the FBI to assist_\n_cyber security specialists protect_\n\n_against the persistent malicious_\n\n_actions of cyber criminals. The_\n_information is provided without_\n_any guaranty or warranty and is_\n\n_for use at the sole discretion of_\n\n_the recipients._\n\n\nThe following information is being provided by the FBI, with no guarantees or\nwarranties, for potential use at the sole discretion of recipients in order to\nprotect against cyber threats. This data is provided in order to help cyber\nsecurity professionals and system administrators to guard against the\npersistent malicious actions of cyber criminals. This FLASH was coordinated\nwith DHS/CISA and US Treasury.\n\nThis FLASH has been released TLP:WHITE: Subject to standard copyright rules,\n**TLP:WHITE information may be distributed without restriction.**\n\n## Indicators of Compromise Associated with Rana Intelligence Computing, also known as Advanced Persistent Threat 39, Chafer, Cadelspy, Remexi, and ITG07\n\n#### Summary\n\nRana Intelligence Computing Company, also known as Rana Corp, is a Ministry\nof Intelligence and Security (MOIS) front company in Tehran, Iran that\nconducts malicious cyber activity. It is known in the public domain as Advanced\nPersistent Threat (APT) 39, Chafer, Cadelspy, Remexi, and ITG07.\n\nRana’s cyber targeting has been both global in scale and internal to Iran,\nincluding hundreds of individuals and entities from more than 30 different\ncountries across Asia, Africa, Europe, and North America. It has targeted more\nthan 15 US companies, primarily in the travel industry, and used this access to\ntrack the movements of individuals whom the MOIS considers a threat. It has\nalso targeted foreign citizens, foreign governments, and foreign institutions\nand companies primarily in the travel, hospitality, academic, and\ntelecommunications industries.\n\nWithin Iran, Rana has used malicious intrusion tools to target and monitor\nIranian citizens and dissidents on behalf of the MOIS. These include Iranian\njournalists, former government employees, environmentalists, refugees,\nuniversity students and faculty, and employees at international\nnongovernmental organizations. Rana has targeted Iranian private sector\ncompanies and academic institutions, including Persian language and cultural\ncenters inside and outside Iran.\n\n\n-----\n\nIn conjunction with Department of Treasury Office of Foreign Assets Control sanctions levied against\nindividuals and entities associated with Rana Corp, the FBI is providing information on numerous malware\nvariants and indicators of compromise (IOCs) associated with Rana to assist organizations and individuals in\ndetermining whether they may have been targeted. Representative samples of the malware have also been\nuploaded to Virus Total for individual analysis.\n\n#### Technical Details\n\nThe FBI identified numerous malware variants used by Rana, derived corresponding IOC signatures, and\ndeveloped YARA rules to help entities and individuals identify the malware on their networks and systems.\nMalware samples uploaded to Virus Total for individual analysis are also included below.\n\n**_Visual Basic Script (VBS) Malware_**\n\nThe FBI identified several malicious VBS scripts used by Rana. The VBS malware was embedded in Microsoft\nOffice documents and sent to victims via spear phishing or other social engineering techniques. Once\nopened, the Office document deobfuscated and broke out two scripts that perform the following actions:\n\n1. Sets upload/download paths to:\n```\n     a. %userprofile%\\appdata\\local\\Microsoft\\Feed\\dn\n     b. %userprofile%\\appdata\\local\\Microsoft\\Feed\\up\n\n```\n2. Deobfuscates and creates files named:\n```\n     a. %userprofile%\\appdata\\local\\Microsoft\\Feed\\[script name].vbs \n     b. %userprofile%\\appdata\\local\\Microsoft\\Feed\\tm.ps1\n\n```\n3. Runs Schedule Task Command to run [script name].vbs file with unique/obscure name every\n\n2 minutes. The APT names the scheduled tasks as follows:\n\na. `UpdatMachine and UpdateMachineG [The file is likely named a letter followed by`\n\nnumbers, for example: K1234.vbs.]\n4. Runs PowerShell, normally under a script named tm.ps1\n5. The VBS file reaches out to <actor IP or URL>:port/update.php?req=<victim\n```\n   identifier>. This request is followed by additional upload or download commands of the form\n   &m=d, &m=u, or&m=b. We assess the actors use this process to upload/download victim data\n\n```\nand/or additional malware. We assess the d stands for download, the u stands for upload, and the b\nrepresents a command to download as a .bat file.\nBoth [script name].vbs and tm.ps1 work together to upload victim files and execute commands via\ncmd.exe on a victim machine. PowerShell then downloads regular or batch files from actor controlled IP\naddresses or domains.\n\n\nIn conjunction with Department of Treasury Office of Foreign Assets Control sanctions levied against\n\n\n-----\n\n**_VBS Indicators of Compromise_**\nThe FBI derived the below signatures to detect the VBS malware's presence:\n\n  - Presence of files located in the following path:\n\n`o` %userprofile%\\appdata\\local\\Microsoft\\Feed\\dn\n`o` %userprofile%\\appdata\\local\\Microsoft\\Feed\\up\n\n  - Presence of text files starting with a letter name followed by numbers, example K1234.vbs, that had\n\nactor infrastructure embedded.\n\n  - Unusual scheduled tasks that run every 2 minutes and run the .vbs script. The following scheduled\n\ntask names: UpdatMachine and UpdateMachineG.\n\n  - The VBS malware traffic samples included:\n\n`o` Request: TCP and dport 80 and contains /update.php?req=\n`o` Response: TCP and sport 80 and begins with GET /update.php?req=(.*)&m=[bdu]\n```\n      HTTP/1.1\n\n```\n`o` Request : TCP and dport 80 and contains update.php?req=.*&m=d\n`o` Response: MZ.*\n\n**_VBS YARA Rules_**\nThe FBI developed the following YARA rule for detection of VBS malware:\n\n\n**_VBS Indicators of Compromise_**\n\n```\nrule vbs_malware { \nstrings:\n$a = \"$powIndex=.* ==> .* reminded\"\n$b = \"then .* throw exception\"\n$c = \"then no require padding\"\n$d = \"must be extend to\"\n$e = \"need add padding to reminded\"\n$f = \"& SERVER & \\\"&m=b','\\\"\"\n$g = \"$sendData = \\\"(rd|bd)_\\\".*-minimum 1 -maximum 10000.*\"\n$h = \"$sendData = \\\"(rne|bne)_\\\".*Get-Random.*\"\n$i = \"$sendData = \\\"(rne|bne|rd|bd)_\\\".*-minimum 1 -maximum 10001.*\"\ncondition:\n2 of them\n}\n\n```\n\n-----\n\n**_AutoIt Malware_**\nThe FBI identified several malicious AutoIt malware scripts used by Rana. The FBI assesses the AutoIt\nmalware was embedded in Microsoft Office documents or malicious links, and sent to victims via spear\nphishing or other social engineering techniques. Analysis of the AutoIt malware revealed it was technically\nvery similar in functionality to the above-mentioned VBS malware.\nAnalysis of the AutoIt malware code revealed the following:\n\n1. When the malware is run, an AutoIt script named App.au3 executes. This script contains a\n\nhardcoded domain that will act as a command and control (C2).\n2. The script performs a DNS flush and creates two directories:\n```\n     a. <USER_DIR>\\appdata\\microsoft\\Taskbar\\dn \n     b. <USER_DIR>\\appdata\\microsoft\\Taskbar\\up\n\n```\n3. The script looks for the values UMe (called \"method\"), UN (called \"rndname\"), UT (called\n\n\"lastMethodFinderTime\") from the registry key:\n```\n     a. HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\n\n```\n4. The script will write to the registry key:\n\na. `HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion, and`\n\nthe following values:\n\ni. `UMe : \"0\" or a method name`\nii. `UN : size 4 random string`\niii. `UT : a timestamp`\n5. This method, which is used for C2, was determined based on one of three methods described below:\n\na. Method 1: Selected in the case that the IP returned for the hardcoded server address begins\n\nwith 65.. Execute PowerShell command to run dnip.ps1 file.\nb. Method 2: Selected in the case that an nslookup of the hardcoded server name matches a\n\nspecific regular expression in the code. Execute PowerShell command to run dntx.ps1 file.\nc. Method 3: Selected in the case that a successful GET request (results in code 200) occurs to\n```\n      http://<server address>/update.php. Execute PowerShell commands very\n\n```\nsimilar to those found in the VBS malware, specifically going to the update.php?m=b and\n```\n      update.php?m=d for uploading/downloading commands and files.\n\n```\n**_AutoIt Indicators of Compromise_**\n\nThe FBI derived the below signatures to detect the AutoIT malware's presence:\n\n  - Presence of files located in the following path:\n```\n     o %userprofile%\\appdata\\local\\Microsoft\\Feed\\dn\n     o %userprofile%\\appdata\\local\\Microsoft\\Feed\\up\n     o %userprofile%\\appdata\\local\\Microsoft\\Feed\\te\n\n```\n  - Modifications to registry key:\n```\n     o HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\n\n```\n\n**_AutoIt Malware_**\n\n\n-----\n\n     - C2 traffic of the format:\n\n```\n     o http://<server>/update.php?req=<victim identifier>&m=b\n     o http://<server>/update.php?req=<victim identifier>&m=d\n     o http://<server>/update.php?req=<victim identifier>&m=u\n     o http://<server>/update.php?req=<victim identifier>&m=d&b3=1\n     o http://<server>/update.php?req=<victim identifier>&m=b&b3=1\n     o http://<server>/update.php?req=<victim identifier>&m=u&b3=1\n\n```\n**_AutoIt YARA Rules_**\n\nThe FBI developed the following YARA rules to detect the AutoIt malware's presence:\n\n```\nrule AutoIt_Malware_1 {\nstrings:\n$s1 = \"\\\\appdata\\\\local\\\\microsoft\\\\Taskbar\"\n$comm2 = \"&m=u\"\n$comm1 = \"&m=d\"\n$comm3 = \"&m=b\"\n$old1 = \"dnip.p\"\n$old2 = \"dntx.p\"\n$new1 = \"dntxu\"\n$new2 = \"dnipu\"\n$regs1 = \"HKEY_CURRENT_USER\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\"\n$regs2 = \"UMe\"\n$regs3 = \"UN\"\n$regs4 = \"UT\"\ncondition:\nall of ($comm*) and all of ($regs*) and (all of ($old*) or ($new1 and $new2))\nand $s1\n}\n\n```\n```\nrule AutoIt_Malware_2 {\nstrings:\n$dns1 = \"join ((65..90) + (48..57) + (97..122)\"\n$dns2 = \"upload data host name:\"\n$dns3 = \"get control value and batch & normal file existence\"\n$dns4 = \"check if hostlen is Ok ?\"\n$dns5 = \"\\\\dn\"\n$dns6 = \"\\\\up\"\n$dns7 = \"\\\\te\"\ncondition:\n4 of them\n}\n\n```\n\n-----\n\n```\nrule AutoIt_Malware_3 {\nstrings:\n$s1 = \"%dntx.ps1%\"\n$s2 = \"existence regular file\"\n$url3 = \"rne_\"\n$url4 = \"rd_\"\n$url5 = \"bne_\"\n$url6 = \"bd_\"\n$url7 = \"u_\"\n$s3 = \"Software\\\\Microsoft\\\\Windows\\\\CurrentVersion).UN\"\ncondition:\n(3 of ($url*)) and 2 of ($s*)\n}\n\n```\n```\n rule AutoIt_Malware_4 {\n strings:\n $s1 = \"%dntxu.ps1%\"\n $s2 = \"\\\\dnr\"\n $s3 = \"Software\\\\Microsoft\\\\Windows\\\\CurrentVersion).UN\"\n $s4 = \"u_\"\n $s5 = \"upload folder content\"\n condition:\n all of them /\n }\n\n```\n**_BITS 1.0 Malware_**\nThis malware, identified as BITS 1.0, appeared to work in conjunction with the above VBS and AutoIt\nmalware. The VBS and/or AutoIt malware pulled down the BITS 1.0 malware from actor controlled\ninfrastructure for further victimization. In general, the BITS 1.0 malware contained similar functionality,\nalthough each variant was slightly different.\nAnalysis of the BITS 1.0 malware revealed it conducted the following:\n\n1. Installed a dropper that contained two Microsoft CAB files. Observed droppers were named\n```\n   Bird.exe, Reg.exe, or natgeo-desktop.exe.\n\n```\n2. CAB file 1 was empty, and observed as being named Empty.exe.\n3. CAB file 2 contained two executables, one configuration file, and other files and folders detailed\n\nbelow.\n\na. Executable 1: Entitled Svc.exe or events.exe. This executable accepts multiple\n\ncommands to include the following: search, update, upload, shell execute, install, uninstall,\nand more.\n\n\n-----\n\nb. Executable 2: Entitled Splitter.exe. This executable contains the following functions:\n\n\nmouse capture, screen capture, key logger, and IP configuration.\nc. Configuration file: Located in CAB file 2, is obfuscated using a simple XOR cipher, and contains\n\na ZipPass key. Each target may be assigned a unique cipher and key.\nd. Other files: Log.txt, task.xml, upped.txt. Analysis indicated thatlog.txt logs malware functions,\n\ntask.xml triggers events.exe to keep running, XPTask.xml runs the scheduled tasks, and\nupped.txt contains obfuscated logging.\ne. Other folders: Cache000, Cache001, Cache002, Cache003, Cache004, Cache005\n4. The two executables worked together to aggregate victim data, encrypt it using the XOR key as a\n\nseed, and zip the data using the ZipPass key to password protect the files.\n5. The victim data was then transmitted utilizing the Microsoft BITS protocol to actor controlled\n\ninfrastructure. Executable 1 used a BITS_POST to send victim data to the actor controlled\ninfrastructure. The BITS_POST path and query string has the following format: /asp.asp?ui=[User ID,\nPersian Calendar Date, MAC Address, Computer Name]. The traffic occurred over port 80 http traffic.\n\n**_BITS 1.0 Malware Indicators of Compromise_**\n\nThe FBI derived the below signatures to detect the BITS 1.0 malware's presence:\n\n  - DNS resolution to obscure IP addresses, specifically 65.65.65.X, 76.76.76.76, and 61.61.X.X.\n\n  - Snort rule that alerts on TCP packets to and from any IP/any port to any IP/port on port 80 that\n\ncontains BITS: alert tcp any any -> any (sid: 1002351; rev:1; msg.\"BITS\n```\n   content\"; content:\"BITS\")\n\n```\n  - BITS 1.0 malware traffic samples:\n\n`o` Requests TCP and dport80 and contains the string asp.asp\\?ui=\n`o` Requests TCP and sport 80 and stream is NOK\n\n**_BITS 1.0 Malware YARA Rules_**\n\nThe FBI developed the following YARA rules to detect the BITS 1.0 malware's presence:\n\n```\nrule BITS_1_0_1 {\nstrings:\n$string1 = \"putCommandsInReg\"\n$string2 = \"diskFullityCheckRatio:\" wide\n$string3 = \"ipc%s/a%s\"\n$string4 = \"tuplog.txt\"\n$string5 = \"Splitter.exe\" wide\n$string6 = \"KLSource\"\n$string7 = \"classour\"\n$string8 = \"zXapr\"\n$string9 = \"XPTask.vbs\" wide\n\n```\n\n-----\n\n```\ncondition:\n3 of them\n}\n\n```\n```\nrule BITS_1_0_2 {\nstrings:\n$a = \"Error in LOID Type\" wide ascii\n$b = \"LOID is no-space and no-empty String\" wide ascii\n$c = \"Register By LOID\" wide ascii\n$d = \"Please Input Your LOID\" wide ascii\n$e = \"Please Select a LOID:\" wide ascii\ncondition:\n3 of them\n}\n\n```\n```\nrule BITS_1_0_3 {\nstrings:\n$a = \"expand.exe\" wide ascii nocase\n$b = \"EmptyProject.exe\" wide ascii nocase\n$c = \"events.exe\" wide ascii nocase\n$d = \"SExe.cab\" wide ascii nocase\n$e = \"HCK.cab\" wide ascii nocase\ncondition:\n3 of them\n}\n\n```\n```\nrule BITS_1_0_4 {\nstrings:\n$a = \"HCK.cab\" wide ascii nocase\n$b = \"SExe.cab\" wide ascii nocase\ncondition:\n1 of them\n}\n\n```\n```\nrule BITS_1_0_5 {\nstrings:\n$a = \"nyKTudhkoIfxohEisnZeVaRuY\" wide ascii nocase\n$b = \"readUploadFilesLineByLineAndUpload\" wide ascii\n$c = \"abe2869f-9b47-4cd9-a358-c22904dba7f7\" wide ascii \n$d = \"Software\\\\Microsoft\\\\Internet Explorer\\\\IntelliForms\\\\Storage2\" wide\nascii\n$e = \"D:\\\\Release\\\\KLSource\\\\thread_command.c\" wide ascii\n$f = \"YmaxUpFileSizeKByte:\" wide ascii\n\n```\n\n-----\n\n```\n$g = \"readUploadFilesLineByLineAndUpload=>\" wide ascii \ncondition:\n3 of them\n}\n\n```\n```\n    $g = \"readUploadFilesLineByLineAndUpload=>\" wide ascii \n\n```\n```\nrule BITS_1_0_6 {\nstrings:\n$a = \"config.ini\" wide \n$b = \"YZipPass:\" wide \n$c = \"captureScreenQC:\" wide\n$d = \"captureActiveQC:\" wide\n$e = \"maxUpFileSizeKByte:\" wide\n$f = \"image/jpeg\" wide \n$g = \"S.zip\" wide\n$h = \"upped.txt\" wide\ncondition:\n3 of them\n}\n\n```\n```\nrule BITS_1_0_7 {\nstrings:\n$a = \"const KSname = \\\"taskmgr.exe\\\"\"\n$b = \"const VBSName = \\\"XPTask.vbs\\\"\"\n$c = \"oShell.AppActivate \\\"schtasks\\\"\"\n$d = \"oshell.sendkeys \\\"~\\\"\"\n$e = \"\\\"\\\\system32\\\\se-SE\\\\\\\"\"\ncondition:\n3 of them\n}\n\n```\n```\nrule BITS_1_0_8 {\nstrings:\n$a = \"/IM bitsadmin.exe /F\"\n$b = \"googleyou\"\n$c = \"/TRANSFER HelpCenterDownload /DOWNLOAD\" wide\n$d = \"downCommand\" wide\n$e = \"/PRIORITY normal\" wide\n$f = \"Cache00\"\ncondition:\n4 of them\n}\n\n```\n\n-----\n\n**_BITS 2.0 Malware_**\nThe FBI identified a separate variant of the \"BITS_1.0\" malware referred to as \"BITS 2.0.\" This malware used\nsimilar communication channels and techniques as BITS 1.0 detailed previously, however with significant\nchanges in technical details.\nThe BITS 2.0 malware does the following:\n\n1. BITS 2.0 is a self-extracting executable file containing an image, an icon, a VBS script, and an\n\nexecutable. In one instance, this self-extracting executable file contained two additional files named\nrun.xml and events.log. The following file names were observed:\n\na. Self extracting executable named: final1.exe\nb. Image name: Chrysanthemum.jpg (This file is a legitimate JPG.)\nc. VBS script named: events.vbs\nd. An executable named: events.exe\n2. Events.vbs: Creates a scheduled task for persistence and execution. Two scheduled task names have\n\nbeen observed: \"Update Windows\" (sic) and \"Update Windows_<username>\". The FBI Observed\nevents.vbs installed in the following target directory:\n\na. C:\\Users\\user\\AppData\\Local\\Microsoft\\Events\\[events.vbs].\n3. Events.exe: Analysis of this file determined it to contain similar functionality to the events.exe\n\ndetailed in the BITS 1.0 analysis, however it is not the same file. This events.exe has the ability to\nexecute the following commands on the victim machine: Upload and download files, search for a file\nto upload, and use cmd.exe to execute command line operations on the target machine. Events.exe\nalso works to automatically obtain the following target information: screenshots, clipboard data, and\nkeylogger information. Events.exe listened for incoming commands, turns off the legitimate\nBITSADMIN process, and bundles the victim data into an encrypted .bak.zak file for exfiltration. Lastly,\nevents.exe exfiltrated the encrypted victim files to the C2. [*Analysis revealed events.exe was\nfunctionally equivalent to a combination of the events.exe and splittler.exe detailed in BITS 1.0\nanalysis.]\n4. Target files to C2: Once compromised, the target sends the zipped and encrypted .bak .zak files to the\n\nfollowing location on the C2 server:\n\na. http://[C2 IP].test.asp.\n5. Target beacons to C2: Once compromised, the target sends beacons to the following location on the\n\nC2 server:\n\na. http://[C2 IP]/checkupdate.asp?uname=[target username]&pid=[target operation name].\n\n**_BITS 2.0 Indicators of Compromise_**\nThe FBI derived the below signatures to detect the BITS 2.0 malware's presence:\n\n  - Egresses data to the\n\nfollowing:<url>/test.asp?name=<opname_from_config>_<computer_name>_<mac_\n```\n   address>_<filename>.bak.zak&q=<zipfile data>\n\n```\n  - Traffic used: bitsadmin.exe 5\n\n  - Does a GET request to: <url>/checkupdate.asp?uname=<username>&pid=<opname>\n\n\n**_BITS 2.0 Malware_**\n\n\n-----\n\n     - Modifies registry key:\n\n```\n     o Software\\Microsoft\\Internet Explorer\\Main\n\n```\n        - Subkey: DisableFirstRunCustomize set to 1\n\n  - Creates a folder: C:\\Users\\<username>\\AppData\\Local\\Microsoft\\Events in which\n```\n   Events.vbs is placed\n\n```\n  - BITS communications:\n```\n     o exe /TRANSFER SecurityCenterUpdate /DOWNLOAD /PRIORITY normal\n      <url><local filepath>\n     o exe /TRANSFER HelpCenterUpload /UPLOAD /PRIORITY normal\n      <url><local filepath>\n\n```\n`o` URL: <url>/<opname>_<computer name>_<mac address>_<filename>\n\n  - BITS 2.0 malware traffic samples included:\n\n`o` Request : TCP and dport 80 and contains /test.asp\n`o` Response: TCP and sport 80 and stream begins with name=.*\\.*bak\\.zak&q=\n`o` Response: TCP and stream contains Rar!.*\\.bak\\.zak\\x0A\n\n**_BITS 2.0 YARA Rules_**\n\nThe FBI developed the following YARA rules to detect the BITS 2.0 malware's presence:\n\n```\nrule BITS_2_0_1 {\nstrings:\n$a = \"checkupdate.asp\" wide ascii\n$b = \"classour\" wide ascii\n$c = \"OKKK\" wide ascii\n$d = \"%s%s.zak\" wide ascii\n$e = \".rmrm.dat\" wide ascii\n$f = \".cmcm.dst\" wide ascii\n$g = \"--||))((++__::\" wide ascii\ncondition:\n4 of them\n}\n\n```\n```\nrule BITS_2_0_2 {\nstrings:\n$a = \"ID:\" wide ascii\n$b = \"ECODE:\" wide ascii\n$c = \"RTIME:\" wide ascii\n$d = \"UNAME:\" wide ascii\n$e = \"MAC:\" wide ascii\n$f = \"RESP:\" wide ascii\ncondition:\n\n```\n\n-----\n\n```\n all of them\n }\n\n```\n**_Firefox Malware Overview_**\n\nThe FBI identified malware that was masquerading as legitimate Mozilla Firefox. The malware was entitled\n```\n1.exe, and contained the following files and functionalities:\n\n```\n1. 7z.dll:\n\na. MD5 3153abb3ee1acea396b0f7b77c0162c9\nb. Analysis indicates this was a legitimate copy of 7zip\n2. autoGetKbd.dll:\n\na. MD5 b15196f34a69e6579532c69fefad7ac6\nb. Analysis indicates this was a key logger of unknown origin.\n3. autoScreenShot.dll:\n\na. MD5 9e98ecf93ca86751dbdb7049f6d24e9b\nb. Analysis indicates this was a screenshot utility of unknown origin.\n4. CrachReport.exe:\n\na. MD5 fc105956b5b2d33411b2c0e362abb6b3\nb. Analysis indicates this conducts file compression.\n5. fort.vbs:\n\na. MD5 e169c4d3430c8342d809055dc5f3373e\nb. Analysis indicates this created a shell command to run the SafeBrowser.exe binary.\n6. Logging.dll:\n\na. MD5 e998fa518523ccc092c4167718b069cb\nb. Analysis indicated that upon running, screenshots are created and dumped to\n```\n      C:\\Users\\user\\AppData\\Local\\MozillaFirefox\\Cache. These are encrypted\n\n```\nwith a password. Keylogs current window information are created and dumped to\n```\n      C:\\Users\\user\\AppData\\Local\\MozillaFirefox\\Extensions. In the folder\n      C:\\Users\\user\\AppData\\Local\\MozillaFirefox\\Config\n\n```\nc. Two files are created: 1.txt and 2.txt. File 1.txt contains what appears to be a formatted\n\ndate string: 2018_6_12_11_31_32. File 2.txt contains a string of numbers:\n```\n      5759153778925404000. \n\n```\n7. MozillaFirefox.exe:\n\na. MD5 3f3f39bacfe115df5b55c9ab06b93aeb\nb. Analysis indicated this executable pretends to be legitimate Firefox, but is not. Does file egress\n\nfor some of the paths listed above.\n8. MozillaSciencedent.vbs:\n\n```\n    all of them\n\n```\n\n-----\n\na. MD5 d661d2dd1c28efd4b4f7c9c70f763354\nb. Analysis indicated this created a shell command to run MozillaFirefox.exe binary.\n9. MozillaUpdate.exe:\n\na. MD5 54c166c313c684eaa54c0c861cc34987\nb. Analysis indicated this was similar to MozillaFirefox.exe and logging.dll.\n10. SafeBrowser.exe:\n\na. MD5 dbc67d46cb7b6aa7406c979b248421c4\nb. Analysis indicated this created a scheduled task to run a task named Mozillafox which appears\n\nto be MozillaFirefox.exe.\n\n**_Mozilla Firefox Indicators of Compromise_**\n\nThe FBI derived the below signatures to detect the Mozilla Firefox malware's presence:\n\n  - Two files created in C:\\Users\\user\\AppData\\Local\\MozillaFirefox\\Config\n\n`o` txt: Contains formatted date string\n`o` txt: Contains randomly generated numerical string\n\n  - `C:\\Users\\user\\AppData\\Local\\MozillaFirefox\\Cache (contains screenshot data)`\n\n  - `C:\\Users\\user\\AppData\\Local\\MozillaFirefox\\Extensions (contains keylogs)`\n\n  - FTP traffic that matches the following: u_ex<number>-<numerical string>\n<year>_<month>_<day>_<hour>_<minute>_<second>.gzn\n\n**_Mozilla Firefox YARA Rules_**\n\nThe FBI developed the below YARA rules to detect the Mozilla Firefox malware’s presence:\n\n\na. MD5 d661d2dd1c28efd4b4f7c9c70f763354\n\n```\nrule Firefox_1 { \nstrings:\n$string1 = \"Mozilla\\\\fort.vbs\" wide ascii nocase\n$string2 = \"Main Returned.\" wide ascii nocase\n$string3 = \"\\\\Mozilla\\\\ReadMe.txt\" wide ascii nocase\n$string4 = \"Mozillafox\" wide ascii nocase\n$string5 = \"MozillaSciencedent.vbs\" wide ascii nocase\n$string6 = \"MozillaFirefox.exe\" wide ascii nocase\n$string7 = \"Hello World\" wide ascii nocase\n$a9 = \"C:\\\\Users\\\\RS01212M\\\\AppData\\\\Roaming\\\\generator\\\\proj1FTPCenter\\\\FTPCenter\\\\Release\\\\Task.pdb\" wide ascii nocase\ncondition:\n4 of them\n}\n\n```\n```\nrule Firefox_2 {\n\n```\n\n-----\n\n```\nstrings:\n$a1 = \"autoGetKbd.dll\" wide ascii nocase\n$a2 = \"autoScreenShot.dll\" wide ascii nocase\n$a3 = \"ConfigPath\" wide ascii nocase\n$a4 = \"savingToOldFolder\" wide ascii nocase\n$a5 = \"Logging.dll\" wide ascii nocase\n$a6 = \"taskmgr.exe\" wide ascii nocase\n$a7 =\n\"C:\\\\Users\\\\RS01212M\\\\AppData\\\\Roaming\\\\generator\\\\Proj1\\\\autoGetKbd\\\\Release\\\\\nMyApplication.pdb\" wide ascii nocase\ncondition:\n4 of them\n}\n\n```\n```\n    strings:\n\n```\n```\nrule Firefox_3 {\nstrings:\n$a1 = \"task notopen\" wide ascii nocase\n$a2 = \"tske open\" wide ascii nocase\n$a3 = \"\\\\MozillaFirefox\\\\SystemExtensionsDev\\\\\" wide ascii nocase\n$a4 = \"MozillaUpdate.exe\" wide ascii nocase\n$a5 = \"147!@#Asad\" wide ascii nocase\n$a6 = \"Send!\" wide ascii nocase\n$a7 = \"MozillaFirefox\\\\Cache\\\\\" wide ascii nocase\n$a8 = \"ftp\" wide ascii nocase\n$a9 = \"C:\\\\Users\\\\RS01212M\\\\AppData\\\\Roaming\\\\generator\\\\proj1FTPCenter\\\\FTPCenter\\\\Release\\\\FTPCenter.pdb\" wide ascii nocase\ncondition:\n4 of them\n}\n\n```\n```\nrule Firefox_4 {\nstrings:\n$a1 = \"1.txt\" wide ascii nocase\n$a2 = \"2.txt\" wide ascii nocase\n$a3 = \"CrachReport.exe\" wide ascii nocase\n$a4 = \"MuttiSSDERF23\" wide ascii nocase\n$a5 = \"\\\\MozillaFirefox\\\\SystemExtensionsDev\\\\\" wide ascii nocase\n$a6 = \"MozillaFirefox\\\\Config\" wide ascii nocase\n$a7 = \"\\\\MozillaFirefox\\\\SystemExtensionsDev\\\\u_ex\" wide ascii nocase\n$a8 = \"Logging.dll\" wide ascii nocase\n$a9 =\n\"C:\\\\Users\\\\RS01212M\\\\AppData\\\\Roaming\\\\generator\\\\Proj1\\\\autoGetKbd\\\\Release\\\\\nLogging.pdb\" wide ascii nocase\n\n```\n\n-----\n\n```\ncondition:\n4 of them\n}\n\n```\n```\n    condition:\n\n```\n```\nrule Firefox_5 {\nstrings:\n$a1 = \"CrachReport.exe\" wide ascii nocase\n$a2 = \"u_ex\" wide ascii nocase\n$a3 = \"Hello World\" wide ascii nocase\n$a4 = \".gzn\" wide ascii nocase\n$a5 = \"--PICE--\" wide ascii nocase\n$a6 = \"--PICS--\" wide ascii nocase\n$a7 = \"\\\\MozillaFirefox\\\\Cache\" wide ascii nocase\n$a9 = \"Logging.dll\" wide ascii nocase\n$a10 =\n\"C:\\\\Users\\\\RS01212M\\\\AppData\\\\Roaming\\\\generator\\\\Proj1\\\\autoGetKbd\\\\Release\\\\\nautoScreenShot.pdb\" wide ascii nocase\ncondition:\n4 of them\n}\n\n```\n```\n rule Firefox_6 {\n strings:\n $string = \"RS01212M\" wide ascii nocase\n condition:\n all of them\n }\n\n```\n**_Python-Based Malware Overview/Analysis_**\n\nThe FBI identified a Python-based malware used by Rana. The Python-based malware was normally\ncontained in a .rar file, which also contained a script named ma.py. When run, the file conducted a HTTP\nGET request to a command and control server conforming to [Actor IP]/service.html. This GET\nrequest then downloaded additional malicious files to the victim machine. The file directed additional files\nfrom the command and control server to be written out as:\n```\nC:\\\\Windows\\\\Temp\\\\ImageVeiwer.exe. The file also directed ImageVeiwer.exe to be run at\n\n```\nsystem reboot.\nThe file ma.py contained a comment in the code that stated \"# BTW This is working only on windows.\"\nMalware traffic signatures:\n\nTCP and dport=80 and stream starts with err0701\n\n\n-----\n\n**_Python-Based Malware YARA Rules_**\n\nThe FBI developed the following YARA rules to detect the Python-based malware's presence:\n\n```\nrule Python_1 {\nstrings:\n$string1 = \"ImageVeiwer\"\n$hex_string2 = { E2 80 AE }\n$string3 = \"ma.py\"\n$string4 = \"tipe exit to end it\"\n$string5 = \"BTW This is working only on windows\"\ncondition:\n3 of them\n}\n\n```\n```\nrule Python_2 {\nstrings:\n$string1 = \"ma.exe.manifest\"\ncondition:\nall of them\n}\n\n```\n```\nrule Python_3 {\nstrings:\n$string1 = \"modules['mails']\"\n$string2 = \"tedtools\"\n$string3 = \"thunderbird\"\n$string4 = \"Drive letter should be a letter between A and Z\"\ncondition:\n3 of them\n}\n\n```\n```\nrule Python_4 {\nstrings:\n$string1 = \"x86_64-posix-sjlj\"\n$string2 = \"tedtools\"\n$string3 = \"teddumper\"\n$string4 = \"teddumper.exe.manifest\"\ncondition:\n3 of them\n\n```\n\n-----\n\n**_Android Malware Overview/Analysis_**\n\nThe FBI identified Android malware used by Rana named optimizer.apk. This Android Package (APK)\nsupported several different functionalities that indicated it to be a malware implant for Android devices.\n\n**Malware metadata**\nFilename `Optimizer.apk`\nPackage Name `com.android.providers.optimizer`\n```\n         and com.android.providers.optimizer-1 \n\n```\nLast\n```\n         12/24/2018, 05:46\n```\nModification/\nCompile Date:\n\nFile Type: `Android Package Kit / Android Application Package (APK)`\nFile Size: `185.6 KB`\nMD5: `426351383DFE8F88A0959A9D5E8C43C7`\nSHA1: `0C23F62BA98EBFA2C062C485E5704F193909E421`\nSHA256: `A1481B251328B50D268B815DEBD614F539039E6E7012C90B66DAEE717712D524`\nEntropy: `7.966`\nCertificate: `Serial Number: 763faa62`\n```\n         Valid from: Sun Dec 23 18:47:57 EST 2018\n         Until: Mon Sep 25 19:47:57 EDT 2073\n         Certificate Fingerprints:\n         MD5: 7C:B5:E0:3A:4F:A2:7F:E1:0E:9A:81:A2:66:66:1F:6C\n         SHA1:\n         C4:D9:9E:F0:CB:CF:CA:B4:0A:B9:BE:4F:5A:68:5A:DC:00:6E:8D:49\n         SHA256:\n         53:1F:74:0C:51:9A:BD:1B:96:0F:E4:FF:E2:39:E3:DC:23:5C:99:41:D0:\n         D1:21:12:65:57:B3:CD:85:43:B0:D0\n\n```\nThe APK implant was a variant of Android malware. The implant was coded to communicate with a C2\nServer, saveingone.com (domain saveingone.com previously resolved to the Iranian IP address\n```\n185.165.116.47). The APK implant had information stealing and remote access functionality which\n\n```\ngained root access on an Android device without the user’s knowledge. The main capabilities include\nretrieving HTTP GET requests from the C2 server (typically updates or commands for the device), obtaining\ndevice data, compressing and AES-encrypting the collected data, and sending it via HTTP POST requests to\nthe malicious C2 server. The APK implant also had permissions to record audio and take photos, using the\nmicrophone and camera on the compromised device.\nThe Optimizer APK implant was decompressed and contained the following folders/files: lib, META```\nINF, res, AndroidManifest.xml, classes.dex, and resources.arsc. The\n\n```\n|Malware metadata|Col2|\n|---|---|\n|Filename|Optimizer.apk|\n|Package Name|com.android.providers.optimizer and com.android.providers.optimizer-1|\n|Last Modification/ Compile Date:|12/24/2018, 05:46|\n|File Type:|Android Package Kit / Android Application Package (APK)|\n|File Size:|185.6 KB|\n|MD5:|426351383DFE8F88A0959A9D5E8C43C7|\n|SHA1:|0C23F62BA98EBFA2C062C485E5704F193909E421|\n|SHA256:|A1481B251328B50D268B815DEBD614F539039E6E7012C90B66DAEE717712D524|\n|Entropy:|7.966|\n|Certificate:|Serial Number: 763faa62 Valid from: Sun Dec 23 18:47:57 EST 2018 Until: Mon Sep 25 19:47:57 EDT 2073 Certificate Fingerprints: MD5: 7C:B5:E0:3A:4F:A2:7F:E1:0E:9A:81:A2:66:66:1F:6C SHA1: C4:D9:9E:F0:CB:CF:CA:B4:0A:B9:BE:4F:5A:68:5A:DC:00:6E:8D:49 SHA256: 53:1F:74:0C:51:9A:BD:1B:96:0F:E4:FF:E2:39:E3:DC:23:5C:99:41:D0: D1:21:12:65:57:B3:CD:85:43:B0:D0|\n\n\n-----\n\n```\nAndroidManifest.xml file listed the SDK versions the Optimizer implant required: minimum 8, target\n\n```\n22, and maximum 23.\nThe file classes.dex contained binary Dalvik bytecode, which was originally the Java source code\ncompiled to run inside a Dalvik Virtual Machine on an Android device. The file classes.dex was converted to\nSmali language for a more readable format, then converted to Java source code with the open-source tools\nDex2jar and Androguard. This file defined four packages, 185 classes, 570 methods, and referenced 1,068\nmethods once converted to Java source code.\nThe APK implant collected detailed device data and sends the data in AES-encrypted zip files to the C2 as\nHTTP POST requests which is covered in the Dynamic Analysis section below. It was evident that the code\nwas configured to collect specific device information. The following code snippets display collected device\ndata, HTTP requests, and encryption method:\nThe package shares, class ai, and method a, or shares .ai.a, comprises code that makes up an HTTP\nPOST request that is used by the implant to send obtained device data to the malicious C2 server. The\npackage a, class m, method a, or a.m.a, contained a 96-byte string that appeared to be a base64-encoded\nkey. Upon further analysis, the Optimizer APK implant did not use the string \"JXsItS7…\" in a.m.a. The\n```\na.aj.a and a.al.a methods contained encryption mechanisms using the AES/ECB/PKCS5 padding cipher\n\n```\nto encrypt and decrypt data contained APK’s res folder files and collected device information. The a.a.a\nmethod contained mechanisms which used base64-decoding, UTF-8, and the AES cipher in a.aj.a. The\ncode also calls the configuration file cng.cn that is located in the APK’s res/raw folder.\n\nThe file libOptimizer.so contained within the APK file path \\Optimizer\\lib\\x86\\, contained the\nencryption key for the malware’s network communication in the form of a stack string which was manually\ncreated and stored in package a, class m, and method a (a.m.a). The variables of the key are defined in the\n.so file starting at functions doAll and as.StartService. The \"JXsITS7JIWI...\" string initially found in\nthe same a.m.a method during static analysis is a decoy and is not referenced during runtime.\n\nThe file libOptimizer.so also built the filename tmp.tmp, which was originally stored in the APK’s\nres/raw folder. Then the functions fopen and fclose were used to open the file tmp.tmp contents. The\ncontents of tmp.tmp appeared to be binary. Both of the files libOptimizer.so and tmp.tmp were identified\nas being loaded onto the device during dynamic analysis. The functionality of the loaded tmp.tmp contents\nwas not determined.\n\nDynamic analysis was conducted on the Optimizer APK implant, including running the implant on an\nemulated Android device and debugging/reverse-engineering. Analysis concluded that the implant’s main\nfunctionality was to retrieve updates or commands from the C2 saveingone.com through HTTP GET\nrequests and to collect device information, which was transmitted to the C2 in AES-encrypted zip files.\n\nUpon initial installation, the Optimizer APK implant did not generate an application (app) icon that was\nvisible on the android emulator’s Apps screen. The API Platforms 19, 22, and 26, were used to deploy the\nAPK implant onto the emulator device. The App settings for the APK implant did not provide an option to\n\n```\n   AndroidManifest.xml file listed the SDK versions the Optimizer implant required: minimum 8, target\n\n```\n\n-----\n\nForce Stop or Uninstall the application. The APK implant did not start any services or processes upon\ninstallation, only after the device was rebooted did the APK start and maintain persistence in the infected\ndevice.\n\nWhen the emulator device was rebooted after installation, the Optimizer APK implant app initiated an\ninstance of itself on the device with three running processes:\n\n  - `Optimizer (com.android.providers.optimizer)`\n\n  - `Android Core Apps (android.process.acore)`\n\n  - `Calendar Storage (com.android.providers.calendar)`\nand two running services:\n\n  - `Optimizer (Started by app)`\n\n  - `Helper (Started by app)`\n\nThe device administrative (admin) privileges settings contained an option to give the Optimizer implant the\nability to, Monitor screen-unlock attempts.\n\nThe following steps can be followed on an Android device to detect if the Optimizer implant application was\nrunning on a device: Settings -> Apps -> Running. The implant sent a Domain Name Service\n(DNS) request to resolve the C2 domain, saveingone.com. Then HTTP GET requests were formed to\nretrieve an unidentified type of data from the malicious C2. Finally, the implant used HTTP POST requests to\nsend AES-encrypted zipped data to the C2. The POST requests were coded into a loop and continuously\ncollected the device data.\n\nThe Optimizer APK implant created several folders on the device and saved the HTTP POST requests contents\nlocally. The folders and files can be found on the device image named userdata-qemu.img, at directory\npath: Root ->Data -> com.android.providers.optimizer -> files. The HTTP POSTS\nrequests were saved into the upsls folder in this instance. The resource files were also loaded on the\ndevice, and the libOptimizer.so file mentioned earlier was present on the device at directory path:\n```\nRoot ->app-lib -> com.android.providers.optimizer-1.\n\n```\nThe configured Optimizer APK implant code used decoys to thwart reverse-engineering of the implant such\nas the \"JXsITS7JIWItp…\" string stored statically in a.m.a. The decoy string only acts as a place holder to\nstore the new 96-byte base64 string \"aEpAayM4V...\" built in the libOptimizer.so file. Before the encryption\nmethod begins in a.a.a, the value it calls in a.m.a contains the 96-byte \"aEpAayM4V…\" string. That 96byte string is then base64-decoded to a 72-byte key \"hJ@k#8V%}H*&Yds2...\" and stored into the variable 1,\n```\na.m.a,. Only the first 16-bytes of the generated 72-byte key is required AES-decrypt the configuration file\ncng.cn. The cng.cn file contains an additional 72-byte key within which is the \"e2&njk%Nsfn&*Ysd…\"\n\n```\nused to AES-decrypt the compressed zip files sent via HTTP POST requests to the malicious C2 server. The key\n\n\nForce Stop or Uninstall the application. The APK implant did not start any services or processes upon\n\n\n-----\n\nalso decrypts a file in the res/raw folder named odr.od, along with other files generated and saved onto\nthe Android device by the implant.\n\n**_Android Malware YARA Rules_**\n\nThe FBI developed the following YARA rules to detect the Android malware’s presence:\n```\nrule APK_Optimizer_1 {\nmeta:\ndescription = \"Optimizer APK Malware\"\nhash1 = \"426351383DFE8F88A0959A9D5E8C43C7\" /* MD5 */\nhash2 = \"0C23F62BA98EBFA2C062C485E5704F193909E421\" /* SHA1 */\ncategory = \"Android Application Package Malware\"\nstrings:\n$x1 =\n\"JXsITS7JIWItpoSkBrf8wz5JVOXgrSCJVoKmYlbSjpmmmIsU3y0zRlIwbWmZhGZ4n5mrN2O\npajXGiYqIypzVMWQkNUbYHpW1\" fullword wide ascii\n$x2 = \"Contatcts\" fullword wide ascii\n$x3 = \"cng.cn\" fullword wide ascii\n$x4 = \"odr.od\" fullword wide ascii\n$x5 = \"Content-Disposition: form-data; name=\\\"InputFile\\\";filename=\\\"\"\nfullword wide ascii\ncondition:\n3 of them /* any string in the rule */\n}\n\n```\n**_Depot.dat Malware Overview/Analysis_**\n\nThe depot.dat malware had the ability to collect victim screenshots, keylogger information, and other data,\nand then send this data to Rana controlled infrastructure. The malware comprised two components: a\ndropper and an encrypted Microsoft CAB file. The CAB file is named depot.dat and contains four files that\nmake up the second stage of the malware. The Dropper decrypts the encrypted CAB file and establishes\npersistence.\n\n**Dropper Files**\n```\n        installer.exe \n\n```\nFilenames:\n```\n        svchost.exe\n\n```\nMD5 Hash: `fcc61b3a0277c47748a185dccccad5d8`\n\n|Dropper Files|Col2|\n|---|---|\n|Filenames:|installer.exe svchost.exe|\n|MD5 Hash:|fcc61b3a0277c47748a185dccccad5d8|\n\n\nalso decrypts a file in the res/raw folder named odr.od, along with other files generated and saved onto\n\n\n-----\n\n**Depot.dat Files**\nFilename: `depot.dat`\n```\n        4d8e2fdb16877f693d8e90410f90a164\n\n```\nMD5 Hash:\n```\n        ce456b20f6cb4d5d74f00d976e2e7a91\n\n```\n**_Dropper Details_**\n\nThe dropper decrypted the depot.dat file and established a persistent mechanism for the malware. The\ndropper executed with a password at runtime. The password was a number between 0 and 0x10000 that\nrepresented a seed. The seed was used to create a 72-byte Blowfish decryption key. Because the malware\nensures that the seed is less than 0x10000, this limits the options for the generation of a key significantly and\nthe potential passwords that could be used.\nIn order to persist, the dropper sets LoadAppInit_DLLs in the registry key\n```\nSOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Windows to persist Bootmgr.dll\n\n```\n(extracted from the decrypted depot.dat) and turns off RequireSigned (which ensures that only signed\nDLLs may be run on Windows) so that it can load and run its next stage components. This persistence\nmechanism was obfuscated with a sophisticated XOR routine which used a Pseudo-Random Number\nGenerator (PRNG) as the key.\nOnce the depot.dat file was extracted and the components deployed, the dropper would delete the\nencrypted depot.dat file.\n\n**_Depot.dat Details_**\n\nOnce depot.dat was decrypted, four files are extracted from the CAB file:\n\n**Contents of CAB File**\n**Filename** **MD5 Hash**\n```\nBootmgr.dll 66cb23c223ec4d78d683292d1b928fbf\nbootui.dll 46506fa669ec116da3d967c36eab7ba7\nmlp.dat f3d2c6084f09433a87f248726de288e0\ntfd.log d363ecffbe6a0a62546051fc383399f4\nBootmgr.dll is responsible for starting bootui.dll. Bootmgr.dll is persisted in the registry by the\n\n```\ndropper.\n```\nBootui.dll opens and deobfuscates the configuration file, mlp.dat, as well as performs the majority of\n\n```\nthe malware’s data collection and packaging functionality. After decrypting the configuration file,\n```\nbootui.dll creates and starts threads to monitor keystrokes and collect screenshots. These files are\n\n```\nplaced into a directory listed in the configuration file (and tfd.log) and end with .tmp. Prior to\nexfiltration, these files are placed in a CAB file and encrypted using the key obtained from the encryption file.\n\n|Depot.dat Files|Col2|\n|---|---|\n|Filename:|depot.dat|\n|MD5 Hash:|4d8e2fdb16877f693d8e90410f90a164 ce456b20f6cb4d5d74f00d976e2e7a91|\n\n|Contents of CAB File|Col2|\n|---|---|\n|Filename|MD5 Hash|\n|Bootmgr.dll|66cb23c223ec4d78d683292d1b928fbf|\n|bootui.dll|46506fa669ec116da3d967c36eab7ba7|\n|mlp.dat|f3d2c6084f09433a87f248726de288e0|\n|tfd.log|d363ecffbe6a0a62546051fc383399f4|\n\n\n**Depot.dat Files**\n\n\n-----\n\n```\nMlp.dat is deobfuscated by bootui.dll using a slightly different sophisticated XOR routine from the\n\n```\none used by the dropper to obfuscate the persistence mechanism. The configuration file contains the\ndirectory into which data for exfiltration will be stored, a Blowfish encryption key for victim data, a sleep\ntimer, and some other unique data. For these pieces of malware, analysis victim data prior to egress will be\nstored in: C:\\Windows\\Help\\OEM which is the sole contents of tfd.log\n\n**_Depot.dat Indicators of Compromise_**\n\nThe FBI derived the below signatures to detect the Depot.dat malware's presence:\n\n  - Known Filenames:\n\n`o` Dropper: installer.exe, svchost.exe\n```\n     o depot.dat\n\n```\n  - Both observed sample contents begin with 2300 but the dropper code would support files starting\n\nwith 2640 or MSCF. Approximate size 59k.\n\n  - Second stage directory paths:\n```\n     o C:\\Windows\\system32\\Bootui.dll\n     o C:\\Windows\\system32\\Bootmgr.dl\n     o C:\\Windows\\system32\\Tfd.log\n     o C:\\Windows\\system32\\Mlp.dat\n\n```\n  - Director paths for victim data:\n```\n     o C:\\Windows\\Help\\OEM\n     o C:\\Windows\\debug\\WIA\n\n```\n  - Victim data:\n\n`o` Stored in one of the above paths, named <timestamp>.tmp and begins with 2300.\n\n  - Altered registry keys:\n```\n     o SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Windows, specifically\n      LoadAppInit_DLLs to include Bootmgr.dll and RequireSigned to be off\n\n```\n**_Depot.dat YARA Rules_**\n\nThe FBI developed the following YARA rules to detect the Android malware’s presence:\n\n```\nrule Depot_dat_1 {\nmeta:\ndescription = \"rules for the dropper\"\nstrings:\n$format1 = \"MSCF\" wide ascii\n$format2 = \"2640\" wide ascii\n$format3 = \"2300\" wide ascii\n$fnames = \"depot.dat\" wide ascii nocase\n\n```\n\n-----\n\n```\n$fnames2 = \"tfd.log\" wide ascii nocase\n$cabinet = \"Cabinet.dll\" wide ascii nocase\ncondition:\nall of ($format*) and (1 of ($fnames*)) and $cabinet\n}\n\n```\n```\n    $fnames2 = \"tfd.log\" wide ascii nocase\n\n```\n```\nrule Depot_dat_2 {\nmeta:\ndescription = \"rules for Bootmgr.dll\"\nstrings:\n$fname = \"mlp.dat\" wide ascii nocase\n$fname2 = \"bootui.dll\" wide ascii nocase\n$callnext1 = \"BootUI\" wide ascii\n$callnext2 = \"GetProcAddress\" wide ascii\ncondition:\nall of them\n}\n\n```\n```\nrule Depot_dat_3 {\nmeta:\ndescription = \"rules for bootui\"\nstrings:\n$format1 = \"<xzl xnm =\" wide ascii nocase\n$format2 = \"(...)\" wide ascii\n$fname1 = \"__????.tmp\" wide ascii\n$fname2 = \"mlp.dat\" wide ascii nocase\n$fname3 = \"i.log\" wide ascii nocase\ncondition:\nall of them\n}\n\n```\n```\nrule Depot_dat_4 {\nmeta:\ndescription = \"rule for prng\"\nstrings:\n$s1 = {af 00 2c 15}/*\"0x152c00af\"*/\n$s2 = {6d 4e c6 41} /*\"0x41c64ed\"*/\n$s3 = {45 69 c9 24 0d 00 00} /* imul r9d, r9d, 0xd24 */\n$s4 = {69 d2 da 2e 18 00} /* imul edx, edx, 0x182eda */\n$s5 = {b5 81 4e 1b} /*\"0x1b4e81b5\"*/\ncondition:\n3 of them\n}\n\n```\n\n-----\n\n**Malware Samples Uploaded to Virus Total**\n\nThe FBI uploaded at least one representative sample of each malware category to VirusTotal. Specifically, the\nFBI uploaded the following:\n\n**VBS Malware**\n**Filename** **MD5 Hash**\nUrban Development Plan.doc `9f7c280b20d021f0a0984d1ad0aeba41`\n\n**AutoIt Malware**\nEtisalat.exe `486aa8849c173450911f886116f4b5d6`\n\n**BITS 1.0 Malware**\nBirds.exe `91e1793bd5f3f274ddb22b47662cb860`\nSplitter.exe `2f01092e9cd49448b0de7da48e545682`\nActivorse.exe `0d6d385354584264e2b37ff3a199ea04`\nSplitter.exe `8f848b67af0d6ad3dd3419c9d11c28c1`\npoweriso.exe `45045fa9d428f29e8a3a988048e3aff1`\n\n**BITS 2.0 Malware**\nfinal1.exe `43124f6d418b086f3107a8cb708c3d2b`\nevents.exe `6269e8ae9d86c648c15e41c7d89509ab`\n\n**Firefox Malware**\n1.exe `eee655c5522267d63314a0b20162d619`\n\n**Python Malware**\nAl_image of my own_official for `de8986682ab25d98448e688506250b94`\nregistrartion_Al_GNP.exe\n\nTeddumper.exe `50ded657ff5a1c80d736fe3b80beb87f`\n\n**Android Malware**\nOptimizer.apk `426351383DFE8F88A0959A9D5E8C43C7`\n\n**Depot.dat**\nDepot.dat `59c2c1c6451417f054efaee32416c652`\n\n|VBS Malware|Col2|\n|---|---|\n|Filename|MD5 Hash|\n|Urban Development Plan.doc|9f7c280b20d021f0a0984d1ad0aeba41|\n\n|AutoIt Malware|Col2|\n|---|---|\n|Etisalat.exe|486aa8849c173450911f886116f4b5d6|\n\n|BITS 1.0 Malware|Col2|\n|---|---|\n|Birds.exe|91e1793bd5f3f274ddb22b47662cb860|\n|Splitter.exe|2f01092e9cd49448b0de7da48e545682|\n|Activorse.exe|0d6d385354584264e2b37ff3a199ea04|\n|Splitter.exe|8f848b67af0d6ad3dd3419c9d11c28c1|\n|poweriso.exe|45045fa9d428f29e8a3a988048e3aff1|\n\n|BITS 2.0 Malware|Col2|\n|---|---|\n|final1.exe|43124f6d418b086f3107a8cb708c3d2b|\n|events.exe|6269e8ae9d86c648c15e41c7d89509ab|\n\n|Firefox Malware|Col2|\n|---|---|\n|1.exe|eee655c5522267d63314a0b20162d619|\n\n|Python Malware|Col2|\n|---|---|\n|Al_image of my own_official for registrartion_Al_GNP.exe|de8986682ab25d98448e688506250b94|\n|Teddumper.exe|50ded657ff5a1c80d736fe3b80beb87f|\n\n|Android Malware|Col2|\n|---|---|\n|Optimizer.apk|426351383DFE8F88A0959A9D5E8C43C7|\n\n|Depot.dat|Col2|\n|---|---|\n|Depot.dat|59c2c1c6451417f054efaee32416c652|\n\n\n-----\n\n#### Best Practices for Network Security and Defense:\n\n  - Employ regular updates to applications and the host operating system to ensure protection against\n\nknown vulnerabilities.\n\n  - Establish, and backup offline, a \"known good\" version of the relevant server and a regular change\nmanagement policy to enable monitoring for alterations to servable content with a file integrity\nsystem.\n\n  - Employ user input validation to restrict local and remote file inclusion vulnerabilities.\n\n  - Implement a least-privileges policy on the Webserver to:\n\n`o` Reduce adversaries’ ability to escalate privileges or pivot laterally to other hosts.\n`o` Control creation and execution of files in particular directories.\n\n  - If not already present, consider deploying a demilitarized zone (DMZ) between the Web-facing\n\nsystems and corporate network. Limiting the interaction and logging traffic between the two provides\na method to identify possible malicious activity.\n\n  - Ensure a secure configuration of Webservers. All unnecessary services and ports should be disabled\n\nor blocked. All necessary services and ports should be restricted where feasible. This can include\nwhitelisting or blocking external access to administration panels and not using default login\ncredentials.\n\n  - Use a reverse proxy or alternative service to restrict accessible URL paths to known legitimate ones.\n\n  - Conduct regular system and application vulnerability scans to establish areas of risk. While this\n\nmethod does not protect against zero day attacks, it will highlight possible areas of concern.\n\n  - Deploy a Web application firewall and conduct regular virus signature checks, application fuzzing,\n\ncode reviews, and server network analysis.\n\n#### Reporting Notice\n\nThe FBI encourages recipients of this document to report information concerning suspicious or criminal\nactivity to their local FBI field office. Field office contacts can be identified at www.fbi.gov/contact-us/fieldoffices. When available, each report submitted should include the date, time, location, type of activity,\nnumber of people, and type of equipment used for the activity, the name of the submitting company or\norganization, and a designated point of contact.\n\n#### Administrative Note\n\nThis product is marked TLP:WHITE. Subject to standard copyright rules, TLP:WHITE information may be\ndistributed without restriction.\n\n\n#### Best Practices for Network Security and Defense:\n\n\n-----\n\n# Your Feedback on the Value of this Product Is Critical\n\n### Was this product of value to your organization? Was the content clear and concise?  Your comments are very important to us and can be submitted anonymously. Please take a moment to complete the survey at the link below. Feedback should be specific to\n your experience with our written products to enable the FBI to make quick and continuous improvements to such products. Feedback may be submitted online here: \n https://www.ic3.gov/PIFSurvey\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "99fdc3ef-333d-48f5-a4a1-becd788c7b80",
            "created_at": "2022-10-25T15:28:29.802983Z",
            "updated_at": "2022-10-25T15:28:29.802983Z",
            "deleted_at": null,
            "name": "MITRE",
            "url": "https://github.com/mitre-attack/attack-stix-data",
            "description": "MITRE ATT&CK STIX Data",
            "reports": null
        }
    ],
    "references": [
        "https://www.iranwatch.org/sites/default/files/public-intelligence-alert.pdf"
    ],
    "report_names": [
        "public-intelligence-alert.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "bee22874-f90e-410b-93f3-a2f9b1c2e695",
            "created_at": "2022-10-25T16:07:23.45097Z",
            "updated_at": "2025-03-27T02:02:09.808919Z",
            "deleted_at": null,
            "main_name": "Chafer",
            "aliases": [
                "APT 39",
                "Cobalt Hickman",
                "ITG07",
                "Radio Serpens",
                "Remix Kitten",
                "TA454"
            ],
            "source_name": "ETDA:Chafer",
            "tools": [
                "ASPXSpy",
                "ASPXTool",
                "Antak",
                "CACHEMONEY",
                "EternalBlue",
                "HTTPTunnel",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "MechaFlounder",
                "Metasploit",
                "Mimikatz",
                "NBTscan",
                "NSSM",
                "Non-sucking Service Manager",
                "POWBAT",
                "Plink",
                "PuTTY Link",
                "Rana",
                "Remcom",
                "Remexi",
                "RemoteCommandExecution",
                "SafetyKatz",
                "UltraVNC",
                "WCE",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "nbtscan",
                "pwdump"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "a761f2a6-26ba-47fd-89c3-6a74f847a3b2",
            "created_at": "2024-05-01T02:03:08.025289Z",
            "updated_at": "2025-03-27T02:05:17.312292Z",
            "deleted_at": null,
            "main_name": "COBALT HICKMAN",
            "aliases": [
                "Chafer ",
                "ITG07 ",
                "APT39 "
            ],
            "source_name": "Secureworks:COBALT HICKMAN",
            "tools": [
                " Mimikatz",
                " Remexi",
                " TREKX",
                "MechaFlounder"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "6b6155e4-94ec-4909-b908-550afe758ad6",
            "created_at": "2022-10-25T15:50:23.365074Z",
            "updated_at": "2025-03-27T02:00:55.455014Z",
            "deleted_at": null,
            "main_name": "APT39",
            "aliases": [
                "APT39",
                "ITG07",
                "Remix Kitten"
            ],
            "source_name": "MITRE:APT39",
            "tools": [
                "NBTscan",
                "MechaFlounder",
                "Remexi",
                "CrackMapExec",
                "pwdump",
                "Mimikatz",
                "Windows Credential Editor",
                "Cadelspy",
                "PsExec",
                "ASPXSpy",
                "ftp"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1666716504,
    "ts_updated_at": 1743041767,
    "ts_creation_date": 1600424356,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/79b9e779c11668efaab691c4941ea27503b01ba1.pdf",
        "text": "https://archive.orkl.eu/79b9e779c11668efaab691c4941ea27503b01ba1.txt",
        "img": "https://archive.orkl.eu/79b9e779c11668efaab691c4941ea27503b01ba1.jpg"
    }
}