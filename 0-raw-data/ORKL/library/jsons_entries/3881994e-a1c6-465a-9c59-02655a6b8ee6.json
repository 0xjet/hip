{
    "id": "3881994e-a1c6-465a-9c59-02655a6b8ee6",
    "created_at": "2023-01-12T15:05:47.072511Z",
    "updated_at": "2025-03-27T02:05:53.551447Z",
    "deleted_at": null,
    "sha1_hash": "4efefd7be8506629c359fdd08ee0dc6ffb831607",
    "title": "2018-07-08 - Hussarini – Targeted Cyber Attack in the Philippines",
    "authors": "",
    "file_creation_date": "2022-05-28T15:39:06Z",
    "file_modification_date": "2022-05-28T15:39:06Z",
    "file_size": 127979,
    "plain_text": "# Hussarini – Targeted Cyber Attack in the Philippines\n\n**[fortinet.com/blog/threat-research/hussarini---targeted-cyber-attack-in-the-philippines.html](https://www.fortinet.com/blog/threat-research/hussarini---targeted-cyber-attack-in-the-philippines.html)**\n\nJuly 8, 2018\n\nTwo weeks ago, FortiGuard Labs spotted a malicious document with the politically themed\nfile name “Draft PH-US Dialogue on Cyber Security.doc”. This document takes advantage of\n[the vulnerability CVE-2017-11882. Upon successful exploitation, it drops a malware in the](https://www.fortinet.com/blog/threat-research/cve-2017-11826-exploited-in-the-wild-with-politically-themed-rtf-document.html)\nvictim’s %temp% directory.\n\nOur analysis of this malware shows that it belongs to Hussarini, also known as Sarhust, a\nbackdoor family that has been used actively in APT attacks targeting countries in the ASEAN\nregion since 2014.\n\n[According to reports, the Philippines is the most exposed country in ASEAN to the](http://news.abs-cbn.com/business/08/15/14/philippines-most-exposed-cyber-attack-threats-report)\ncyberattacks known as advanced persistent threats, or APTs. After several massive data\n[breaches in 2016, the Philippines started to invest in beefing up their defences against](http://cnnphilippines.com/business/2017/05/04/Govt-to-invest-P2B-for-national-cybersecurity.html)\ncyberattacks. In spite of these investments, however, the Philippines is still among the most\nprone countries to be targeted by these sorts of APT attacks.\n\n**Exploit Document**\n\nOur analysis begins with the exploit document named “Draft PH-US Dialogue on Cyber\nSecurity.doc” that takes advantage of the CVE-2017-11882 vulnerability. Upon successful\nexploitation, the malicious document file drops two files in the %Temp% directory.\n\n-   Outllib.dll\n\n-   OutExtra.exe\n\n\n-----\n\nOutExtra.exe is a signed legitimate application from Microsoft named finder.exe. This file is\npart of the Microsoft Office suite and can be used to find keywords within Outlook data files.\nHowever, in this attack, this file is used to load the Hussarini backdoor via DLL hijacking.\n\nDLL hijacking is a technique used by some APT malware in which instead of the legitimate\napplication (.exe) loading the benign DLL, the application is tricked into loading a DLL\ncontaining malicious code. Using this technique, a malware can evade the Host Intrusion\nPrevention System (HIPS) of security programs that monitor the behaviors of executed files.\nMost HIPS tools whitelist signed or trusted files, thereby excluding any malware loaded using\nDLL hijacking by those signed files from any behavior monitoring. In the context of this\nattack, OutExtra.exe is a signed legitimate application; however, it is tricked into loading a\nmalware file that is disguised as the legitimate Outllib.dll file.\n\n**Decoy Document**\n\nTo avoid suspicion by the victim, the exploit downloads a decoy document from the\nlegitimate-seeming hxxp://157.52.167.71:29317/office/word/2003/ph2/philip.varilla. During\nour analysis, though, the download link for the decoy document was already down.\n\nHowever, taking a look at the URI, we spotted several clues as to where/from whom the\nhacker possibly wants the user to believe the document came from. First is the “ph2,” which\ncould mean “ph” for Philippines and “2” as its second directory of decoy documents. And\nsecond is “philip.varilla”. A quick Google search on this name led us to the Service Director\nof the Philippines Department of Information and Communications Technology (DICT), who\nhas the same name. DICT is the agency responsible for the planning, development, and\npromotion of the Philippines’ information and communications technology including\ncybersecurity.\n\n**Hussarini**\n\nIn fact, the file Outllib.dll is actually the Hussarini backdoor, a DLL which exports functions\ncontaining the malicious code. When the file OutExtra.exe is executed, some of these\nfunctions are called, effectively executing its malicious code.\n\nFig 1. Hussarini export functions\n\nWhile the original Outllib.dll also has some of the functions above, notice that this backdoor\nhas a lot more exported functions than just the backdoor DLL.\n\nFig 2. Export functions of the original Outllib.dll file\n\nThere is also a big difference in the file size. The original Outllib.dll has a file size range of 48 MB, depending on the version, but the fake file only ranges from 40-50 KB. One of the\nreasons for this big difference in file size is that only one of the exported functions of the\n\n\n-----\n\nbackdoor DLL contains the malicious code. All of the others are just RETN functions that do\nnothing.\n\nThus, we will focus our analysis on the function that contains the backdoor code named\n_RenInitInstance@12. This function begins by instantiating a class initializing the setting of the_\nbot. It then creates two concurrent threads taking the created object as its parameter.\n\nFig 3. Hussarini main function\n\nThe first thread acts as a client thread that is responsible for communicating with the\ncommand and control (C&C) server and listening for commands. The response is then\nparsed and passed to the second thread that acts as the worker. The worker thread executes\nthe commands and reports the result to the client thread.\n\nBefore communicating with its command and control (C&C), the malware saves a ServerID\nin the registry with a randomly generated value. This ID identifies this bot in the botnet.\n\nFig 4. Bot ServerID\n\n**C&C Communication**\n\nInterestingly, there’s a private IP address 10.1.0.105 in the code that may have been used as\na test C&C server. This IP address is replaced at runtime with the real C&C\npublicdfaph.publicvm.com.\n\nWhen communicating with its C&C, Hussarini uses its own custom protocol encoded with\nbase64, which is sent over HTTP. Due to the high-level nature of the code and limited\nanalysis time, we were not able to identify all the fields of the protocol, but knowing some\nimportant parts is enough to understand how the communication works.\n\nFig 5. Hussarini protocol\n\nThe initial data it sends contains the generated ServerID, the size, and the checksum of the\nmessage. This data is encoded with base64 and sent as an argument to the HTTP GET\nrequest.\n\nFig 6. Initial message to the command and control server\n\nThe response from the C&C is enclosed with the tag <CHECK></CHECK>. The data in\nbetween is also base64 encoded. When decoded, we can see that it follows the same data\nstructure as the initial message.\n\nFig 7. Initial response from the command and control server\n\nAfter the check, the malware gets the following system information, which it sends to the\nC&C via an HTTP POST request:\n\n\n-----\n\n-   User name, Computer Name, OS, and CPU information\n\nFig 8. Sending of machine information to the C&C\n\nIt took a while before we were able to receive commands from the C&C, and when we did we\nsuddenly lost connection to the C&C, which could mean that the hacker controls the C&C\nmanually. The connection disruption could be because the attacker detected that the bot was\nbeing analysed and blocked our analysis environment from communicating with the C&C, or\njust that the machine is not interesting to performing further attacks. The received data was\nenclosed with the tag <COMMAND></COMMAND>, encoded with base64, and still follows\nthe same data structure of the protocol when decoded. The commands are pretty obvious\nsince its strings are not encrypted after decoding the data.\n\nFig 9. Receiving commands from the C&C\n\nThe first command includes the string “cache.txt”. The worker thread is called with this\ncommand to create the following files in the same directory where the malware is running.\n\n-   cache.txt\n\n-   cache.txt.cfg\n\nThe second command contains commands for the Command Prompt (cmd.exe).\n\nFig 10. Receiving next commands from the C&C\n\nThe following cmd commands sent from the C&C are then passed to the worker thread and\nwritten to cache.txt.\n\nFig 11. Commands written in cache.txt\n\nThe description of the commands written on cache.txt are as follows:\n\n-   systeminfo – get the systeminfo of the computer\n\n-   arp –a – view the mapping of IP addresses to MAC addresses\n\n-   ipconfig /all – display all current TCP/IP network configuration values\n\n-   netstat -ano - displays protocols statistics and current TCP/IP network connections\n\n-   tasklist -v – list of apps and services with their Process ID (PID) for all task running\n\n-   net start – starts any of the various services that are running\n\n-   net view – displays the other computers that are visible on the network\n\n- _dir \"c:\\users\" /o-d – displays all users_\n\n\n-----\n\nAfter sending these cmd commands, the C&C stopped responding. It could be that the\nhacker decided to block the connection after seeing the result of these commands.\n\nBased on its code, this malware is capable of executing the following commands from the\nhacker:\n\n-   Create, read, write files\n\n-   Download and execute files/components\n\n-   Launch remote shell using cmd.exe\n\nWhile other APT backdoors have more capabilities, such as keylogging, taking screen shots,\netc., Hussarini only has few, including the capability to download and execute\nfiles/components. However, its functionality can be extended by the hacker. Also, since this\nbackdoor can launch a remote cmd shell, all cmd commands are available for the attacker to\nuse, such as those seen in Figure 11.\n\n_Hussarini uses a dynamic domain to maintain anonymity and to also possibly be able to_\nchange the C&C server IP address. At the time of this analysis, however, we only saw it\nresolved to the IP address 157.52.167.71, which is the same IP used to host the decoy\ndocument.\n\nFig 12. C&C domain name resolution\n\n**Final thoughts**\n\nWe are unsure how the document is being distributed; however, taking a look at the C&C\ndomain name publicdfaph.publicvm.com and considering the file name of the exploit\ndocument “Draft PH-US Dialogue on Cyber Security.doc” and the clues from the decoy\ndocument download link hxxp://157.52.167.71:29317/office/word/2003/ph2/philip.varilla,\nthere is one scenario that seems to make the most sense.\n\nIt seems likely that the names used were crafted to make it look like the document came\nfrom the Department of Information and Communications Technology (DICT), or possibly\nfrom the Service Director, which would imply that the employees of the Department of\nForeign Affairs (DFA) are the target. Clearly, the use of publicdfaph in the C&C domain name\nis used to camouflage the traffic and to trick a network administrator into thinking that this\ndomain is under DFA so as not to raise any suspicion.\n\n**Conclusion**\n\nHussarini was first mentioned in APT campaigns targeting the Philippines and Thailand in\n2014. Today, this malware is still actively being used against the Philippines. The Department\nof Information and Communications Technology was only formed in 2016 and has\n[acknowledged that the Philippines’ state of cybersecurity is still in infancy. In general, this](https://www.rappler.com/technology/news/168634-dict-launches-ph-5-year-natl-cybersecurity-plan)\n\n\n-----\n\ncontributes to the Philippines continuing to be a target for cybercrime/cyberespionage or\neven state-sponsored attacks. Because of this, we expect that attacks targeting that region\nwill continue to evolve in both quantity and quality. As always, we here at FortiGuard Labs\nwill continue to monitor events in order to hunt for, catch, and block these attacks.\n\n**Solution:**\n\nFortinet detects the exploit document as MSOffice/CVE_2017_11882.A!tr and the Hussarini\nsamples as W32/Sarhust.D!tr. Malicious URLs related to this malware are also blocked\nby FortiGuard Web Filtering Service.\n\n-= FortiGuard Lion Team =\n**IOCs:**\n\n_SHA256:_\n\n154261a4aab73f1ceef28695d8837902cc1e8b5cca0b8fc81ddeda350564adc0 MSOffice/CVE_2017_11882.A!tr\n\n05dcc7856661244d082daa88a074d2f266c70623789a7bb5a919282b178d8f98 W32/Sarhust.D!tr\n\n_CC:_\n\nhxxp://157.52.167.71:29317/office/word/2003/ph2/philip.varilla\n\nhxxp://publicdfaph.publicvm.com:8080/\n\n_Check out our latest_ _[Quarterly Threat Landscape Report for more details about recent](http://go.fortinet.com/LP=4658?utm_source=social&utm_medium=blog&utm_campaign=GEN-WP-Q1-2018-Threat-Landscape-Report&elq_src=Social&elq_cid=70134000001StUhAAK&elq_staid=10&elq_eid=10258&elq_sid=11288)_\n_threats._\n\n_[Sign up for our weekly FortiGuard Threat Brief or for our FortiGuard Threat Intelligence](https://www.fortinet.com/fortiguard/threat-intelligence/threat-research.html?utm_source=nreleaseblog&utm_campaign=2018-q2-fortiguardlabs-cta)_\n_Service._\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-07-08 - Hussarini – Targeted Cyber Attack in the Philippines.pdf"
    ],
    "report_names": [
        "2018-07-08 - Hussarini – Targeted Cyber Attack in the Philippines.pdf"
    ],
    "threat_actors": [
        {
            "id": "fe3d8dee-3bee-42e6-8f16-b6628b6189ae",
            "created_at": "2023-01-06T13:46:39.039285Z",
            "updated_at": "2025-03-27T02:00:02.98336Z",
            "deleted_at": null,
            "main_name": "SWEED",
            "aliases": [],
            "source_name": "MISPGALAXY:SWEED",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f2c53785-fb8b-460d-ba73-7fbfba36f0f5",
            "created_at": "2022-10-25T16:07:24.247949Z",
            "updated_at": "2025-03-27T02:02:10.150345Z",
            "deleted_at": null,
            "main_name": "Sweed",
            "aliases": [],
            "source_name": "ETDA:Sweed",
            "tools": [
                "AgenTesla",
                "Agent Tesla",
                "AgentTesla",
                "ForeIT",
                "Formbook",
                "Loki",
                "Loki.Rat",
                "LokiBot",
                "LokiPWS",
                "Negasteal",
                "Origin Logger",
                "RDP",
                "Remote Desktop Protocol",
                "ZPAQ",
                "win.xloader"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535947,
    "ts_updated_at": 1743041153,
    "ts_creation_date": 1653752346,
    "ts_modification_date": 1653752346,
    "files": {
        "pdf": "https://archive.orkl.eu/4efefd7be8506629c359fdd08ee0dc6ffb831607.pdf",
        "text": "https://archive.orkl.eu/4efefd7be8506629c359fdd08ee0dc6ffb831607.txt",
        "img": "https://archive.orkl.eu/4efefd7be8506629c359fdd08ee0dc6ffb831607.jpg"
    }
}