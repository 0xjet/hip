{
    "id": "67de9ab4-c3df-498b-8cef-665ff94500ce",
    "created_at": "2023-01-12T15:01:48.714887Z",
    "updated_at": "2025-03-27T02:16:52.990069Z",
    "deleted_at": null,
    "sha1_hash": "8bdfaff39b5652c7c1fc0358d1ef52ec00bf2bfb",
    "title": "2022-09-30 - Diavol resurfaces",
    "authors": "",
    "file_creation_date": "2022-10-23T12:56:14Z",
    "file_modification_date": "2022-10-23T12:56:14Z",
    "file_size": 121708,
    "plain_text": "# Diavol resurfaces\n\n**[medium.com/walmartglobaltech/diavol-resurfaces-91dd93c7d922](https://medium.com/walmartglobaltech/diavol-resurfaces-91dd93c7d922)**\n\nJason Reaves September 30, 2022\n\n[Jason Reaves](https://medium.com/@jason.reaves?source=post_page-----91dd93c7d922--------------------------------)\n\nSep 30\n\n\n5 min read\n\nBy: Jason Reaves and Jonathan McCay\n\nWe previously walked through the Diavol ransomware variants file encryption[1] which has\nbeen linked to the TrickBot group[2]. After the recent breakup[3,4], Diavol all but seemed to\nhave disappeared. Curiously, we began to notice an uptick in samples submitted to\nVirusTotal. While investigating the more recent samples, we were able to determine that it\nuses a mix of RSA encryption and XOR encoding for files. In some instances, file recovery is\nstill possible.\n\nThe following samples were identified on VirusTotal:\n\n\n-----\n\n```\nSHA256: aac969e36686f8f8517c111d30f8fb3b527988ebd31b3b762aec8d46e860eb9d\nCreation Time 2022-09-05 20:01:56 UTC\nFirst Submission 2022-09-09 21:06:06 UTC\nLast Submission 2022-09-13 15:50:00 UTC\nLast Analysis 2022-09-13 15:50:00 UTC\n\nSHA256: fb5ee29b98446d34520bf04a82996eefec3b5692710c5631458da63ef7e44fe4\nCreation Time 2022-09-05 20:04:30 UTC\nFirst Submission 2022-09-11 20:30:20 UTC\nLast Submission 2022-09-11 20:30:20 UTC\nLast Analysis 2022-09-11 20:30:20 UTC\nSHA256: 708806f5e2e8bfa3d1e911e391ff2ccf1edcac05cc1df80439b8b867253423dfCreation Time\n2022-08-25 16:12:58 UTCFirst Submission 2022-08-29 19:49:08 UTC Last Submission 202209-03 15:40:44 UTC Last Analysis 2022-09-03 15:40:44 UTC\n\n```\nThe samples are now 64 bit but function similarly. For the purposes of this report we will be\ngoing through the 7088 sample above. For the purposes of this report, we will be going\nthrough the 7088 sample above.\n```\ngroup=testfile_ext=.bullynote_filename=WARNING.txt\n\n```\nFile encryption still involves the use of a 2048 byte XOR key which is randomly generated in\nthe GENBOTID piece of the main bot. The key is then stored in the main bot and reused\nlater in the file encryption code. Then a loop will sit reading chunks of 2048 bytes unless the\namount of data to be encoded is less than 2048:\n\nThe first part of the file encryption is the aforementioned usage of the 2048 byte XOR key.\nFor most files, the amount of bytes that will be XOR encoded is based on the overall file size\ndivided by 10. Then a loop will sit reading chunks of 2048 bytes unless the amount of data to\nbe encoded is less than 2048:\n\nA similar XOR loop has been implemented, which can be seen in the previous version of\nDiavol[1]. The loop will handle XOR encoding the chunk of data that was read before writing\nit back to the file:\n\nAfter XOR encoding the file, the RSA encrypted XOR key is written to the end of the file\nfollowed by the number of encoded bytes:\n\nNext the bot single XOR encodes the number of encoded bytes and writes that to the end of\nthe file:\n\nAfter XOR encoding and writing the appropriate data to the end of the file, the bot goes back\nto the beginning of the file and begins reading in chunks of 0x75 bytes. It will RSA encrypt\nthem and the encrypted bytes are then written back to the file but without the padding bytes.\n\n\n-----\n\nIn this way, 0x75 10 or 1170 bytes at the beginning of the file will be RSA encrypted after\ngetting XOR encoded.\n\nA quick test can be performed to validate our findings, using a file of NULLs and a large MSI\nfile. First, we validate the end data that was added to the file, which should be\n110+0x900+16 bytes from the end:\n```\n>>> data = open('test_data.txt.bully', 'rb').read()>>> 110+0x900+16 2430>>> end =\ndata[-2430:]\n\n```\nSkipping over the RSA encrypted XOR key should show the two 8 byte values with the\nsecond being XOR encoded with 0xFF\n```\n>>>\nend[0x900:]'\\x88\\x13\\x00\\x00\\x00\\x00\\x00\\x00w\\xec\\xff\\xff\\xff\\xff\\xff\\xffk\\xa8\\x0f/6o\\\n\\xf4\\xbd\\x03\\xf9H\\x01\\x99\\xa6\\xd7\\x9ae\\xee\\xf3\\xa7\\xe9\\xc6\\xb1\\xf8\\x81\\xe0\\xb6\\xc4\\xba\n 0x13885000>>>\nend[0x900+8:]'w\\xec\\xff\\xff\\xff\\xff\\xff\\xffk\\xa8\\x0f/6o\\x12\\x08\\xd6\\xbe\\xaaw\\xf1\\x1b0\\\n\\xf4\\xbd\\x03\\xf9H\\x01\\x99\\xa6\\xd7\\x9ae\\xee\\xf3\\xa7\\xe9\\xc6\\xb1\\xf8\\x81\\xe0\\xb6\\xc4\\xba\n l = bytearray('w\\xec')>>> l[0] ^= 0xff>>> l[1] ^= 0xff>>> lbytearray(b'\\x88\\x13')\n\n```\nSince the file is NULLs, the clear XOR key should be the first 2048 bytes after we skip over\nthe 1170 RSA encrypted bytes at the beginning:\n```\n>>> key = bytearray(data[1170:1170+2048])\n\n```\nWe can test this against another file, in this case an MSI:\n```\n>>> data2 = open('powerpointmui.msi.bully', 'rb').read()>>> test_block =\nbytearray(data2[1170:])>>> >>> for i in range(len(test_block)):...  test_block[i] ^=\nkey[i%2048]...>>>\ntest_block[:10000]bytearray(b'\\xa4A(H\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\\n Database\\x00\\x00\\x00\\x1e\\x00\\x00\\x00;\\x00\\x00\\x00Microsoft Office PowerPoint MUI\n(Portuguese (Brazil)) 2007\\x00\\x00\\x1e\\x00\\x00\\x00\\x16\\x00\\x00\\x00Microsoft\nCorporation\\x00\\x00\\x00\\x1e\\x00\\x00\\x00\"\\x00\\x00\\x00Installer, MSI, Database,\nRelease\\x00\\x00\\x00\\x1e\\x00\\x00\\x00\\x84\\x00\\x00\\x00This Installer database contains\nthe logic and data required to install Microsoft Office PowerPoint MUI (Portuguese\n(Brazil)) 2007....snip...\n\n```\nSo it is possible to recover most of each file trivially, after you recover the XOR key. The next\nstep is to just rebuild the first 1170 bytes.\n\n## IOCs\n\nEndpoint:\n```\nWARNING.txtwarning.txt.bully4eb5bea255c0308b296f5aa259f6862688b41ba2d6b7cca40118de9007\n\n```\nRansom Note:\n\n\n-----\n\n```\nYou ve been hacked. All your corporate network servers and workstations are\nencrypted.Your company is a victim of double extortion ransomware attack.\\rhat is it?\nBasically it means that not only your data is encrypted, but it's also have been\nexfiltrated from your network.Double Extortion attack explained in details\n:https://www.zscaler.com/resources/security-terms-glossary/what-is-double-extortionransomware\\r==== What now? =====If you want your network to be fully operational\nagain and if you want us not to publish all files we've taken :1. Download Tor\nBrowser from original site : https://torproject.org\\r. Open this url in Tor Browser\nand visit this website :\nhttps://7ypnbv3snejqmgce4kbewwvym4cm5j6lkzf2hra2hyhtsvwjaxwipkyd.onion/\\r. Enter this\nkey : 57C0E-4C543-DCABB-EBF0C-2EDCA-A9FC4If you've done everything correctly - now\nyou are able to contact us and take a chance to leave this all behind for a\nreasonable fee.\\rOTE : If TOR network is unavailable by any reason - you can use any\nVPN service to solve it.\n\n```\nNetwork:\n```\nhxxps://7ypnbv3snejqmgce4kbewwvym4cm5j6lkzf2hra2hyhtsvwjaxwipkyd[.]onion173.232[.]146[\n\n## References\n\n```\n1: [https://medium.com/walmartglobaltech/diavol-the-enigma-of-ransomware-1fd78ffda648](https://medium.com/walmartglobaltech/diavol-the-enigma-of-ransomware-1fd78ffda648)\n\n2: https://www.bleepingcomputer.com/news/security/fbi-links-diavol-ransomware-to-thetrickbot-cybercrime-group/\n\n3: https://www.advintel.io/post/the-trickbot-saga-s-finale-has-aired-but-a-spinoff-is-already-inthe-works\n\n4: https://www.bleepingcomputer.com/news/security/conti-ransomware-shuts-downoperation-rebrands-into-smaller-units/\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-09-30 - Diavol resurfaces.pdf"
    ],
    "report_names": [
        "2022-09-30 - Diavol resurfaces.pdf"
    ],
    "threat_actors": [
        {
            "id": "cf7fc640-acfe-41c4-9f3d-5515d53a3ffb",
            "created_at": "2023-01-06T13:46:38.228042Z",
            "updated_at": "2025-03-27T02:00:02.775905Z",
            "deleted_at": null,
            "main_name": "APT1",
            "aliases": [
                "GIF89a",
                "G0006",
                "PLA Unit 61398",
                "Group 3",
                "TG-8223",
                "Comment Group",
                "ShadyRAT",
                "COMMENT PANDA",
                "Comment Crew",
                "Byzantine Candor",
                "Brown Fox"
            ],
            "source_name": "MISPGALAXY:APT1",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "3aaf0755-5c9b-4612-9f0e-e266ef1bdb4b",
            "created_at": "2022-10-25T16:07:23.480196Z",
            "updated_at": "2025-03-27T02:02:09.826059Z",
            "deleted_at": null,
            "main_name": "Comment Crew",
            "aliases": [
                "APT 1",
                "BrownFox",
                "Byzantine Candor",
                "Byzantine Hades",
                "Comment Crew",
                "Comment Panda",
                "GIF89a",
                "Group 3",
                "Operation Oceansalt",
                "Operation Seasalt",
                "Operation Siesta",
                "Shanghai Group",
                "TG-8223"
            ],
            "source_name": "ETDA:Comment Crew",
            "tools": [
                "Auriga",
                "Cachedump",
                "Chymine",
                "CookieBag",
                "Darkmoon",
                "GDOCUPLOAD",
                "GLOOXMAIL",
                "GREENCAT",
                "Gen:Trojan.Heur.PT",
                "GetMail",
                "Hackfase",
                "Hacksfase",
                "Helauto",
                "Kurton",
                "LETSGO",
                "LIGHTBOLT",
                "LIGHTDART",
                "LOLBAS",
                "LOLBins",
                "LONGRUN",
                "Living off the Land",
                "Lslsass",
                "MAPIget",
                "ManItsMe",
                "Mimikatz",
                "MiniASP",
                "Oceansalt",
                "Pass-The-Hash Toolkit",
                "Poison Ivy",
                "ProcDump",
                "Riodrv",
                "SPIVY",
                "Seasalt",
                "ShadyRAT",
                "StarsyPound",
                "TROJAN.COOKIES",
                "TROJAN.FOXY",
                "TabMsgSQL",
                "Tarsip",
                "Trojan.GTALK",
                "WebC2",
                "WebC2-AdSpace",
                "WebC2-Ausov",
                "WebC2-Bolid",
                "WebC2-Cson",
                "WebC2-DIV",
                "WebC2-GreenCat",
                "WebC2-Head",
                "WebC2-Kt3",
                "WebC2-Qbp",
                "WebC2-Rave",
                "WebC2-Table",
                "WebC2-UGX",
                "WebC2-Yahoo",
                "Wordpress Bruteforcer",
                "bangat",
                "gsecdump",
                "pivy",
                "poisonivy",
                "pwdump",
                "zxdosml"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535708,
    "ts_updated_at": 1743041812,
    "ts_creation_date": 1666529774,
    "ts_modification_date": 1666529774,
    "files": {
        "pdf": "https://archive.orkl.eu/8bdfaff39b5652c7c1fc0358d1ef52ec00bf2bfb.pdf",
        "text": "https://archive.orkl.eu/8bdfaff39b5652c7c1fc0358d1ef52ec00bf2bfb.txt",
        "img": "https://archive.orkl.eu/8bdfaff39b5652c7c1fc0358d1ef52ec00bf2bfb.jpg"
    }
}