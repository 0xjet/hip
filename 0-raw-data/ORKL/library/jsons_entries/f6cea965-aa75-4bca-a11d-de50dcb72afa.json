{
    "id": "f6cea965-aa75-4bca-a11d-de50dcb72afa",
    "created_at": "2022-10-25T16:48:13.633822Z",
    "updated_at": "2025-03-27T02:05:56.228054Z",
    "deleted_at": null,
    "sha1_hash": "62d2eb6112d88baf0b14302e12e31425265ccb74",
    "title": "JPCERT/CC Blog: ChChes – Malware that Communicates with C&C Servers Using Cookie Headers",
    "authors": "",
    "file_creation_date": "2017-02-28T15:06:32Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 425312,
    "plain_text": "**[« Anti-analysis technique for PE Analysis Tools –INT Spoofing– | Main | PlugX + Poison](http://blog.jpcert.or.jp/2017/01/anti-analysis-t-24b9.html)**\n\n**Ivy = PlugIvy? - PlugX Integrating Poison Ivy’s Code - »**\n\n**Feb 17, 2017**\n\n# ChChes – Malware that Communicates with C&C Servers Using Cookie Headers\n\n**Since around October 2016, JPCERT/CC has been confirming emails that are sent to**\n**Japanese organisations with a ZIP file attachment containing executable files. The**\n**targeted emails, which impersonate existing persons, are sent from free email address**\n**services available in Japan. Also, the executable files’ icons are disguised as Word**\n**documents. When the recipient executes the file, the machine is infected with malware**\n**called ChChes.**\n\n**This blog article will introduce characteristics of ChChes, including its communication.**\n\n**ZIP files attached to Targeted Emails**\n\n**While some ZIP files attached to the targeted emails in this campaign contain executable**\n**files only, in some cases they also contain dummy Word documents. Below is the**\n**example of the latter case.**\n\n**Figure 1: Example of an attached ZIP file**\n\n**In the above example, two files with similar names are listed: a dummy Word document**\n**and an executable file whose icon is disguised as a Word document. By running this**\n**executable file, the machine will be infected with ChChes. JPCERT/CC has confirmed the**\n**executable files that have signatures of a specific code signing certificate. The dummy**\n**Word document is harmless, and its contents are existing online articles related to the file**\n**name “Why Donald Trump won”. The details of the code signing certificate is described in**\n**Appendix A.**\n\n**Communication of ChChes**\n\n**ChChes is a type of malware that communicates with specific sites using HTTP to receive**\n**commands and modules. There are only few functions that ChChes can execute by itself.**\n**This means it expands its functions by receiving modules from C&C servers and loading**\n**them on the memory.**\n\n\n**R** **E** **C** **E** **N**\n\n**[PlugX + Poison Ivy = PlugIvy? - PlugX](http://blog.jpcert.or.jp/2017/02/plugx-poison-iv-919a.html)**\n**Integrating Poison Ivy’s Code -**\n\n**ChChes – Malware that Communicates**\n**with C&C Servers Using Cookie Headers**\n\n**Anti-analysis technique for PE Analysis**\n**Tools –INT Spoofing–**\n\n**[2016 in Review: Top Cyber Security](http://blog.jpcert.or.jp/2017/01/2016-in-review-top-cyber-security-trends-in-japan.html)**\n**Trends in Japan**\n\n**[Update from the CyberGreen Project](http://blog.jpcert.or.jp/2016/12/update-from-the-cybergreen-project.html)**\n\n**A New Tool to Detect Known Malware**\n**[from Memory Images – impfuzzy for](http://blog.jpcert.or.jp/2016/12/a-new-tool-to-d-d6bc.html)**\n**Volatility –**\n\n**[Evidence of Attackers’ Development](http://blog.jpcert.or.jp/2016/12/evidence-of-att-3388.html)**\n**Environment Left in Shortcut Files**\n\n**APCERT Annual General Meeting &**\n**[Conference 2016 in Tokyo and](http://blog.jpcert.or.jp/2016/11/apcert-annual-g-3284.html)**\n**JPCERT/CC’s 20th Anniversary**\n\n**[APT workshop and Log analysis training](http://blog.jpcert.or.jp/2016/11/apt-workshop-and-log-analysis-training-in-jakarta.html)**\n**in Jakarta**\n\n**Verification of Windows New Security**\n**[Features – LSA Protection Mode and](http://blog.jpcert.or.jp/2016/10/verification-of-ad9d.html)**\n**Credential Guard**\n\n**C** **A** **T** **E** **G**\n\n**[#APCERT](http://blog.jpcert.or.jp/apcert/)** **[#FIRST](http://blog.jpcert.or.jp/first/)** **[#Incident management](http://blog.jpcert.or.jp/incident_management/)**\n## #JPCERT news\n### #Threats #Trends in Japan\n\n**[#Tsubame](http://blog.jpcert.or.jp/tsubame/)** **[#Vulnerabilities](http://blog.jpcert.or.jp/vulnerabilities/)** **[Africa](http://blog.jpcert.or.jp/africa/)** **[India](http://blog.jpcert.or.jp/india/)**\n**[Indonesia](http://blog.jpcert.or.jp/indonesia/)** **[Laos](http://blog.jpcert.or.jp/laos/)** **[Mongolia](http://blog.jpcert.or.jp/mongolia/)** **[Myanmar](http://blog.jpcert.or.jp/myanmar/)**\n**[Pacific Islands](http://blog.jpcert.or.jp/pac/)** **[Sri Lanka](http://blog.jpcert.or.jp/srilanka/)** **[Thailand](http://blog.jpcert.or.jp/thai/)**\n\n**A** **C** **C** **E** **S**\n\n**ChChes – Malware that Communicates**\n**with C&C Servers Using Cookie Headers**\n\n**[Windows Commands Abused by Attackers](http://blog.jpcert.or.jp/2016/01/windows-commands-abused-by-attackers.html)**\n\n**[Anti-analysis technique for PE Analysis](http://blog.jpcert.or.jp/2017/01/anti-analysis-t-24b9.html)**\n**Tools –INT Spoofing–**\n\n**PlugX + Poison Ivy = PlugIvy? - PlugX**\n**Integrating Poison Ivy’s Code -**\n\n**A New UAC Bypass Method that Dridex**\n**Uses**\n\n**[Analysis of a Recent PlugX Variant - “P2P](http://blog.jpcert.or.jp/2015/01/analysis-of-a-r-ff05.html)**\n**PlugX”**\n\n**A New Tool to Detect Known Malware**\n**[from Memory Images – impfuzzy for](http://blog.jpcert.or.jp/2016/12/a-new-tool-to-d-d6bc.html)**\n**Volatility –**\n\n**Verification of Windows New Security**\n**[Features – LSA Protection Mode and](http://blog.jpcert.or.jp/2016/10/verification-of-ad9d.html)**\n**Credential Guard**\n\n**Classifying Malware using Import API and**\n**Fuzzy Hashing – impfuzzy –**\n\n**[2016 in Review: Top Cyber Security](http://blog.jpcert.or.jp/2017/01/2016-in-review-top-cyber-security-trends-in-japan.html)**\n**Trends in Japan**\n\n**L** **I** **N** **K** **S**\n\n**[JPCERT homepage](http://www.jpcert.or.jp/english/)**\n\n\n-----\n\n**As you can see, the path for HTTP request takes /[random string].htm, however, the**\n**value for the Cookie field is not random but encrypted strings corresponding to actual**\n**data used in the communication with C&C servers. The value can be decrypted using the**\n**below Python script.**\n\n**data_list = cookie_data.split(';')**\n**dec = []**\n**for i in range(len(data_list)):**\n**tmp = data_list[i]**\n**pos = tmp.find(\"=\")**\n**key = tmp[0:pos]**\n**val = tmp[pos:]**\n**md5 = hashlib.md5()**\n**md5.update(key)**\n**rc4key = md5.hexdigest()[8:24]**\n**rc4 = ARC4.new(rc4key)**\n**dec.append(rc4.decrypt(val.decode(\"base64\"))[len(key):])**\n**print(\"[*] decoded: \" + \"\".join(dec))**\n\n**The following is the flow of communication after the machine is infected.**\n\n**Figure 2: Flow of communication**\n\n**The First Request**\n\n**The value in the Cookie field of the HTTP request that ChChes first sends (Request 1)**\n**contains encrypted data starting with ‘A’. The following is an example of data sent.**\n\n\n**[Contributor info](http://blog.jpcert.or.jp/authours.html)**\n\n**A** **R** **C** **H** **I**\n\n**[February 2017](http://blog.jpcert.or.jp/2017/02/)**\n\n**[January 2017](http://blog.jpcert.or.jp/2017/01/)**\n\n**[December 2016](http://blog.jpcert.or.jp/2016/12/)**\n\n**[November 2016](http://blog.jpcert.or.jp/2016/11/)**\n\n**[October 2016](http://blog.jpcert.or.jp/2016/10/)**\n\n**[August 2016](http://blog.jpcert.or.jp/2016/08/)**\n\n**[July 2016](http://blog.jpcert.or.jp/2016/07/)**\n\n**[June 2016](http://blog.jpcert.or.jp/2016/06/)**\n\n**[May 2016](http://blog.jpcert.or.jp/2016/05/)**\n\n**[April 2016](http://blog.jpcert.or.jp/2016/04/)**\n\n**[More...](http://blog.jpcert.or.jp/archives.html)**\n\n**C** **A** **T** **E** **G**\n\n**[#APCERT](http://blog.jpcert.or.jp/apcert/)**\n\n**[#FIRST](http://blog.jpcert.or.jp/first/)**\n\n**[#Incident management](http://blog.jpcert.or.jp/incident_management/)**\n\n**[#JPCERT news](http://blog.jpcert.or.jp/jpcert_news/)**\n\n**[#Threats](http://blog.jpcert.or.jp/threats/)**\n\n**[#Trends in Japan](http://blog.jpcert.or.jp/trends/)**\n\n**[#Tsubame](http://blog.jpcert.or.jp/tsubame/)**\n\n**[#Vulnerabilities](http://blog.jpcert.or.jp/vulnerabilities/)**\n\n**[Africa](http://blog.jpcert.or.jp/africa/)**\n\n**[India](http://blog.jpcert.or.jp/india/)**\n\n**[Indonesia](http://blog.jpcert.or.jp/indonesia/)**\n\n**[Laos](http://blog.jpcert.or.jp/laos/)**\n\n**[Mongolia](http://blog.jpcert.or.jp/mongolia/)**\n\n**[Myanmar](http://blog.jpcert.or.jp/myanmar/)**\n\n**[Pacific Islands](http://blog.jpcert.or.jp/pac/)**\n\n**[Sri Lanka](http://blog.jpcert.or.jp/srilanka/)**\n\n**[Thailand](http://blog.jpcert.or.jp/thai/)**\n\n\n-----\n\n**Figure 3: Example of the first data sent**\n\n**As indicated in Figure 3, the data which is sent contains information including computer**\n**name. The format of the encrypted data differs depending on ChChes’s version. The**\n**details are specified in Appendix B.**\n\n**As a response to Request 1, ChChes receives strings of an ID identifying the**\n**infected machine from C&C servers (Response 1). The ID is contained in the Set-Cookie**\n**field as shown below.**\n\n**Figure 4: Example response to the first request**\n\n**Request for Modules and Commands**\n\n**Next, ChChes sends an HTTP request to receive modules and commands (Request 2). At**\n**this point, the following data starting with ‘B’ is encrypted and contained in the Cookie**\n**field.**\n\n**B[ID to identify the infected machine]**\n\n**As a response to Request 2, encrypted modules and commands (Response 2) are sent**\n**from C&C servers. The following shows an example of received modules and commands**\n**after decryption.**\n\n**Figure 5: Decrypted data of modules and commands received**\n\n**Commands are sent either together with modules as a single data (as above), or by itself.**\n**Afterwards, execution results of the received command are sent to C&C servers, and it**\n**returns to the process to receive modules and commands. This way, by repeatedly**\n**receiving commands from C&C servers, the infected machines will be controlled remotely.**\n\n**JPCERT/CC’s research has confirmed modules with the following functions, which are**\n**thought to be the bot function of ChChes.**\n\n**Encrypt communication using AES**\n**Execute shell commands**\n**Upload files**\n**Download files**\n**Load and run DLLs**\n**View tasks of bot commands**\n\n\n-----\n\n**p** **yp** **p** **g** **yp**\n**method.**\n\n**Summary**\n\n**ChChes is a relatively new kind of malware which has been seen since around October**\n**2016. As this may be continually used for targeted attacks, JPCERT/CC will keep an eye**\n**on ChChes and attack activities using the malware.**\n\n**The hash values of the samples demonstrated here are described in Appendix C. The**\n**malware’s destination hosts that JPCERT/CC has confirmed are listed in Appendix D. We**\n**recommend that you check if your machines are communicating with such hosts.**\n\n**Thanks for reading.**\n\n**- Yu Nakamura**\n\n**_(Translated by Yukako Uchida)_**\n\n**Appendix A: Code signing certificate**\n\n**The code signing certificate attached to some samples are the following:**\n\n\n-----\n\n**Appendix B: ChChes version**\n\n**The graph below shows the relation between the version numbers of the ChChes**\n**samples that JPCERT/CC has confirmed and the compile times obtained from their PE**\n**headers.**\n\n**Figure 7: Compile time for each ChChes version**\n\n**The lists below describe encrypted data contained in the first HTTP request and**\n**explanation of the values for each ChChes version.**\n\n**Table 1: Sending format of each version**\n\n**Version** **Format**\n\n**1.0.0** **A<a>*<b>?3618468394?<c>?<d>*<f>**\n\n**1.2.2** **A<a>*<b>?3618468394?<c>?<d>*<f>**\n\n**1.3.0** **A<a>*<b>?3618468394?<c>?<d>*<f>**\n\n**1.3.2** **A<a>*<b>?3618468394?<c>?<d>*<g>**\n\n**1.4.0** **A<a>*<b>?3618468394?<c>?<d>*<g>**\n\n**1.4.1** **A<a>*<b>?3618468394?<c>?<d> (<e>)*<g>**\n\n**1.6.4** **A<a>*<b>*<h>?3618468394?<c>?<d> (<e>)*<g>**\n\n**Table 2: Description of <a> to <h>**\n\n**Letter** **Data** **Size** **Details**\n\n**<a>** **Computer name** **Variable** **Capital alphanumeric characters**\n\n**<b>** **Process ID** **Variable** **Capital alphanumeric characters**\n\n**<c>** **Path of a temp folder** **Variable** **%TEMP% value**\n\n**<d>** **Malware version** **Variable** **e.g. 1.4.1**\n\n**<e>** **Screen resolution** **Variable** **e.g. 1024x768**\n\n**<f>** **explorer.exe version** **Variable** **e.g. 6.1.7601.17567**\n\n**<g>** **kernel32.dll version** **Variable** **e.g. 6.1.7601.17514**\n\n**<h>** **Part of MD5 value of SID** **16 bytes e.g. 0345cb0454ab14d7**\n\n**Appendix C: SHA-256 Hash value of the samples**\n\n|Col1|Table 1: Sending format of each version|\n|---|---|\n|Version|Format|\n|1.0.0|A<a>*<b>?3618468394?<c>?<d>*<f>|\n|1.2.2|A<a>*<b>?3618468394?<c>?<d>*<f>|\n|1.3.0|A<a>*<b>?3618468394?<c>?<d>*<f>|\n|1.3.2|A<a>*<b>?3618468394?<c>?<d>*<g>|\n|1.4.0|A<a>*<b>?3618468394?<c>?<d>*<g>|\n|1.4.1|A<a>*<b>?3618468394?<c>?<d> (<e>)*<g>|\n|1.6.4|A<a>*<b>*<h>?3618468394?<c>?<d> (<e>)*<g>|\n\n|Letter|Data|Size|Details|\n|---|---|---|---|\n|<a>|Computer name|Variable|Capital alphanumeric characters|\n|<b>|Process ID|Variable|Capital alphanumeric characters|\n|<c>|Path of a temp folder|Variable|%TEMP% value|\n|<d>|Malware version|Variable|e.g. 1.4.1|\n|<e>|Screen resolution|Variable|e.g. 1024x768|\n|<f>|explorer.exe version|Variable|e.g. 6.1.7601.17567|\n|<g>|kernel32.dll version|Variable|e.g. 6.1.7601.17514|\n|<h>|Part of MD5 value of SID|16 bytes|e.g. 0345cb0454ab14d7|\n\n\n-----\n\n**5961861d2b9f50d05055814e6bfd1c6291b30719f8a4d02d4cf80c2e87753fa1**\n**ae6b45a92384f6e43672e617c53a44225e2944d66c1ffb074694526386074145**\n**2c71eb5c781daa43047fa6e3d85d51a061aa1dfa41feb338e0d4139a6dfd6910**\n**19aa5019f3c00211182b2a80dd9675721dac7cfb31d174436d3b8ec9f97d898b**\n**316e89d866d5c710530c2103f183d86c31e9a90d55e2ebc2dda94f112f3bdb6d**\n**efa0b414a831cbf724d1c67808b7483dec22a981ae670947793d114048f88057**\n**e90064884190b14a6621c18d1f9719a37b9e5f98506e28ff0636438e3282098b**\n**9a6692690c03ec33c758cb5648be1ed886ff039e6b72f1c43b23fbd9c342ce8c**\n**bc2f07066c624663b0a6f71cb965009d4d9b480213de51809cdc454ca55f1a91**\n**e6ecb146f469d243945ad8a5451ba1129c5b190f7d50c64580dbad4b8246f88e**\n**e88f5bf4be37e0dc90ba1a06a2d47faaeea9047fec07c17c2a76f9f7ab98acf0**\n**d26dae0d8e5c23ec35e8b9cf126cded45b8096fc07560ad1c06585357921eeed**\n**2965c1b6ab9d1601752cb4aa26d64a444b0a535b1a190a70d5ce935be3f91699**\n**312dc69dd6ea16842d6e58cd7fd98ba4d28eefeb4fd4c4d198fac4eee76f93c3**\n**4ff6a97d06e2e843755be8697f3324be36e1ebeb280bb45724962ce4b6710297**\n**45d804f35266b26bf63e3d616715fc593931e33aa07feba5ad6875609692efa2**\n**cb0c8681a407a76f8c0fd2512197aafad8120aa62e5c871c29d1fd2a102bc628**\n**75ef6ea0265d2629c920a6a1c0d1dd91d3c0eda86445c7d67ebb9b30e35a2a9f**\n**471b7edbd3b344d3e9f18fe61535de6077ea9fd8aa694221529a2ff86b06e856**\n**ae0dd5df608f581bbc075a88c48eedeb7ac566ff750e0a1baa7718379941db86**\n**646f837a9a5efbbdde474411bb48977bff37abfefaa4d04f9fb2a05a23c6d543**\n**3d5e3648653d74e2274bb531d1724a03c2c9941fdf14b8881143f0e34fe50f03**\n**9fbd69da93fbe0e8f57df3161db0b932d01b6593da86222fabef2be31899156d**\n**723983883fc336cb575875e4e3ff0f19bcf05a2250a44fb7c2395e564ad35d48**\n**f45b183ef9404166173185b75f2f49f26b2e44b8b81c7caf6b1fc430f373b50b**\n\n**Appendix D: List of communication destination**\n\n**area.wthelpdesk.com**\n**dick.ccfchrist.com**\n**kawasaki.cloud-maste.com**\n**kawasaki.unhamj.com**\n**sakai.unhamj.com**\n**scorpion.poulsenv.com**\n**trout.belowto.com**\n**zebra.wthelpdesk.com**\n**hamiltion.catholicmmb.com**\n**gavin.ccfchrist.com**\n\n**[Posted on Feb 17, 2017 in #Threats, #Trends in Japan | Permalink](http://blog.jpcert.or.jp/threats/)**\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2017/2017.02.17.chches-malware/chches-malware--93d6.html.pdf"
    ],
    "report_names": [
        "chches-malware--93d6.html"
    ],
    "threat_actors": [],
    "ts_created_at": 1666716493,
    "ts_updated_at": 1743041156,
    "ts_creation_date": 1488294392,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/62d2eb6112d88baf0b14302e12e31425265ccb74.pdf",
        "text": "https://archive.orkl.eu/62d2eb6112d88baf0b14302e12e31425265ccb74.txt",
        "img": "https://archive.orkl.eu/62d2eb6112d88baf0b14302e12e31425265ccb74.jpg"
    }
}