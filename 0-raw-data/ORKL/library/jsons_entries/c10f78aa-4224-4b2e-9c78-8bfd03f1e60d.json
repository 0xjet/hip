{
    "id": "c10f78aa-4224-4b2e-9c78-8bfd03f1e60d",
    "created_at": "2023-05-06T02:09:32.142121Z",
    "updated_at": "2025-03-27T02:14:34.075355Z",
    "deleted_at": null,
    "sha1_hash": "70f0f1b803c85ba7b41b4c8c4eec6b0a759a2257",
    "title": "2022-06-04 - The Domain Generation Algorithms of SharkBot",
    "authors": "",
    "file_creation_date": "2023-05-05T01:55:29Z",
    "file_modification_date": "2023-05-05T01:55:29Z",
    "file_size": 340621,
    "plain_text": "# The Domain Generation Algorithms of SharkBot\n\n**bin.re/blog/the-dgas-of-sharkbot/**\n\nTable of Contents\nDisclaimer\nThese are just unpolished notes. The content likely lacks clarity and structure; and the\nresults might not be adequately verified and/or incomplete.\n\nChanges\n\n2022-07-14 17:37:50: fixed the regex for version 1.63\n\nMalpedia\nFor more information about the malware in this blog post see the Malpedia entry on\nSharkBot.\n\nCover Image Photo by [Jonas Allert on](https://unsplash.com/@visuallert) [Unsplash](https://unsplash.com/)\n\n\n-----\n\nSharkBot is an Android banking malware that steals credentials and banking details .\nApart from one or two hard-coded domains, it relies on a fallback domain generation\nalgorithm (DGA) for communication — which is rather rare for Android malware. The DGA\nwas changed several times during the further development of SharkBot. This blogpost shows\nfour versions of this DGA, and how they differ.\n\nBoth [jadx and](https://github.com/skylot/jadx) [jd-gui were able to decompile almost the entire SharkBot code to great](http://java-decompiler.github.io/)\n[precision, but failed when it came to the DGA function. I therefore used dex2jar to translate](https://github.com/pxb1988/dex2jar)\n[the compiled Android application code to a jar file, then ran the unmaintained jad decompiler](http://www.javadecompilers.com/jad)\non the class that contains the DGA. You can find reimplementations of all four DGAs in\n[Python on my GitHub repo.](https://github.com/baderj/domain_generation_algorithms/blob/master/sharkbot/dga.py)\n\n## Version 0.0.0\n\nThe first sample that I found has the version set to 0.0.0:\n\n**MD5**\n0356f17f28778da7c97dc8b661c0aeb0\n\n**SHA1**\n2c4828f926471ec4f3522fc28dd4d8fdec692c35\n\n**SHA256**\n76b4ee2da4e39677038ea033f25652fb02ed9e84ab829ce212fa1dfbc941df2c\n\n**Size**\n3 MB (4116240 Bytes)\n\n**Compile Timestamp**\nn/a\n\n**Links**\n[VirusTotal](https://www.virustotal.com/gui/file/76b4ee2da4e39677038ea033f25652fb02ed9e84ab829ce212fa1dfbc941df2c)\n\n**Package Name**\n```\ncom.btfezxwhygk2dw0gaj.eguafyojiqcw7a\n\n```\n**Detections**\n**Virustotal: 21/73 as of 2022-04-25 06:01:16 - Android.BankBot.904.origin (DrWeb),**\nAndroid.Sharkbot.GEN46543 (CAT-QuickHeal), Android.PUA.DebugKey (Trustlook), Trojan (\n0058a5511 ) (K7GW), AndroidOS/SpyAgent.F.gen!Eldorado (Cyren), AppRisk:Generisk\n(SymantecMobileInsight), a variant of Android/Spy.Agent.BWR (ESET-NOD32),\nHEUR:Trojan-Banker.AndroidOS.Sharkbot.d (Kaspersky), a.privacy.BankSharkBot (Tencent),\nTrojan.Agent.Android.340641 (Zillya), Artemis!Trojan (McAfee-GW-Edition), Andr/BankerHAQ (Sophos), Android:Evo-gen [Trj] (Avast-Mobile), ANDROID/SpyAgent.FKIX.Gen (Avira),\nHEUR:Trojan-Banker.AndroidOS.Sharkbot.d (ZoneAlarm), Android.Trojan.SharkBot.B\n\n\n-----\n\n(BitDefenderFalx), Trojan/Android.Agent.1071402 (AhnLab-V3), Artemis!0356F17F2877\n(McAfee), Trojan-Spy.AndroidOS.SharkBot (Ikarus), Android/Agent.BWR!tr (Fortinet)\n\nAfter some mild deobfuscation of the strings and renaming the variables, the DGA looks as\nfollows:\n```\nprivate String dga()\n\n{\n\n  StringBuilder urls = new StringBuilder();\n\n  Calendar calendar = Calendar.getInstance();\n\n  String tlds[] = \".top,.xyz,.cc,.info,.com,.ru,.info,.net\".split(\",\");\n\n  int nrTlds = tlds.length;\n\n  int i = 0;\n\n  while(i < nrTlds)\n\n  {\n\n    String tld = tlds[i];\n\n    try\n\n    {\n\n      urls.append(\",http://\");\n\n      StringBuilder seed = new StringBuilder();\n\n      urls.append(\n\n        Base64.encodeToString(\n\n          seed.append(\n\n            calendar.get(Calendar.WEEK_OF_YEAR)\n\n          )\n\n          .append(\"pojBI9LHGFdfgegjjsJ99hvVGHVOjhksdf\")\n\n          .toString()\n\n          .getBytes()\n\n       , Base64.NO_WRAP)\n\n        .substring(0, 19)\n      )\n\n      .append(tld);\n\n    }\n\n    catch(Exception exception) { }\n\n    i++;\n\n  }\n\n  return urls.toString().toLowerCase();\n\n}\n\n\n```\nThe DGA performs these steps to generate domains:\n\n1. Take the current week number (e.g. 12)\n2. Append the hardcoded string pojBI9LHGFdfgegjjsJ99hvVGHVOjhksdf\n3. Base64 encode the result\n4. Take the first 19 characters\n5. Append a TLD from the list .top, .xyz, .cc, .info, .com, .ru, .info, .net in order.\n6. Convert the domain to lower-case\n\nThis results in domains like these:\n\n\n-----\n\n```\nmnbvakjjouxir0zkzmd.xyz\n\nmnbvakjjouxir0zkzmd.live\n\nmnbvakjjouxir0zkzmd.com\n\nmnbvakjjouxir0zkzmd.store\n\nmnbvakjjouxir0zkzmd.info\n\nmnbvakjjouxir0zkzmd.top\n\nmnbvakjjouxir0zkzmd.net\n\n```\nThe second level domain (SLD) is the same for all generated domains at a given time. And\nsince the time-dependent portion only affects the first two characters (when the week\nnumber is ≤ 9), or the first three characters (when the week number is ≥ 10), all domains will\nfollow either of the two following pattern:\n```\n[n-o][awgq]bvakjjouxir0zkzmd\\.(top|xyz|cc|info|com|ru|info|net)\n\n[nm][dtjz][acegikmquy]wb2pcstlmsedgzgz\\.(top|xyz|cc|info|com|ru|info|net)\n\n\n## Version 1.63.3\n\n```\nThe second version of the DGA appears in this sample:\n\n**MD5**\n48ad4e0478e4d742f51848604d06130e\n\n**SHA1**\na9ca49ef2201707b7bcf57798fc67e69d238c900\n\n**SHA256**\nc14f413d8ed944ba7e4364e6b17585019fd622feeb4b53f7002a742d7389e08a\n\n**Size**\n7 MB (7345268 Bytes)\n\n**Compile Timestamp**\n1970-02-21 06:07:33 UTC\n\n**Links**\n[VirusTotal](https://www.virustotal.com/gui/file/c14f413d8ed944ba7e4364e6b17585019fd622feeb4b53f7002a742d7389e08a)\n\n**Filename**\n(VirusTotal)\n\n**Detections**\n**Virustotal: 8/72 as of 2022-05-20 04:22:02 - Android.BankBot.958.origin (DrWeb), a variant**\nof Android/Spy.Agent.BWR (ESET-NOD32), HEUR:Trojan-Banker.AndroidOS.Sharkbot.d\n(Kaspersky), ANDROID/Bankbot.FKWN.Gen (Avira), HEUR:TrojanBanker.AndroidOS.Sharkbot.d (ZoneAlarm), Trojan/Android.Agent.1111318 (AhnLab-V3)\n\nThis sample features a small change to the DGA: The seed is now also based on the current\nyear, which prevents the DGA from repeating after a year.\n\n\n-----\n\n```\nprivate String dga()\n\n{\n\n  StringBuilder urls = new StringBuilder();\n\n  Calendar calendar = Calendar.getInstance();\n\n  String tlds[] = \".top,.xyz,.cc,.info,.com,.ru,.info,.net\".split(\",\");\n\n  int nrTlds = tlds.length;\n\n  int i = 0;\n\n  while(i < nrTlds)\n\n  {\n\n    String tld = tlds[i];\n\n    try\n\n    {\n\n      urls.append(\",http://\");\n\n      StringBuilder seed = new StringBuilder();\n\n      urls.append(\n\n        Base64.encodeToString(\n\n          seed.append(\n\n            calendar.get(Calendar.WEEK_OF_YEAR) +\n\n            calendar.get(Calendar.YEAR)\n\n          )\n\n          .append(\"pojBI9LHGFdfgegjjsJ99hvVGHVOjhksdf\")\n\n          .toString()\n\n          .getBytes()\n\n       , Base64.NO_WRAP)\n\n        .substring(0, 19)\n      )\n\n      .append(tld);\n\n    }\n\n    catch(Exception exception) { }\n\n    i++;\n\n  }\n\n  return urls.toString().toLowerCase();\n\n}\n\n```\nBy adding the year, the time dependent component always exactly affects the first three\ncharacters of the domains, which therefore always follow this pattern:\n```\nmja[xyz0123][mno][hnx3]bvakjjouxir0z.\\.(top|xyz|cc|info|com|ru|net)\n\n\n## Version 2.1\n\n```\nThe next version of the DGA is used in this sample:\n\n**MD5**\n92011ba743860567b85f46aedf360661\n\n**SHA1**\n506df2fd2e638ab614eeb4cbc416bd46fdbf6a19\n\n**SHA256**\n70b244a03a0eacd00cc52ea8863af2c459eb8dc2e6bf5887e657b401e0477485\n\n\n-----\n\n**Size**\n4 MB (4252173 Bytes)\n\n**Links**\n[VirusTotal](https://www.virustotal.com/gui/file/70b244a03a0eacd00cc52ea8863af2c459eb8dc2e6bf5887e657b401e0477485)\n\n**Detections**\n**Virustotal: 19/73 as of 2022-05-18 07:59:42 - Trojan.AndroidOS.Sharkbot.C!c (Lionic),**\nTrojanBanker:Android/Sharkbot.bc773aca (Alibaba), Spyware ( 00592d791 ) (K7GW),\nAppRisk:Generisk (SymantecMobileInsight), a variant of Android/Spy.Agent.BWR (ESETNOD32), HEUR:Trojan-Banker.AndroidOS.Sharkbot.e (Kaspersky), Android.Trojanspy.Agent.Hphh (Tencent), Android.BankBot.977.origin (DrWeb), Artemis!Trojan (McAfeeGW-Edition), Andr/ShrkBot-B (Sophos), Trojan.AndroidOS.Agent (Ikarus),\nANDROID/Bankbot.FKWN.Gen (Avira), TrojanSpy:AndroidOS/Sharkbot.B!MTB (Microsoft),\nAndroid:Evo-gen [Trj] (Avast-Mobile), Android.Trojan.Banker.ZP (BitDefenderFalx),\nArtemis!92011BA74386 (McAfee), Android/Agent.BWR!tr.spy (Fortinet)\n\nFor version 2, SharkBot made some larger changes:\n\nSwitch to md5 instead of base64. This assures that the second level domains (SLDs)\nwill no longer have a substantial portion that never changes.\nAdding the TLD to the seed, which leads to different SLDs for different TLDs.\nCutting the length of the SLD from 19 to 16 letters.\nUsing differnt TLDs\n\n\n-----\n\n```\nprivate String dga() {\n\n  StringBuilder urls = new StringBuilder();\n\n  Calendar calendar = Calendar.getInstance();\n\n  String tlds[] = \".xyz,.live,.com,.store,.info,.top,.net\".split(\",\");\n\n  int nrTlds = tlds.length;\n\n  int i = 0;\n\n  while(i < nrTlds)\n\n  {\n\n    String tld = tlds[i];\n\n    try\n\n    {\n\n      urls.append(\",http://\");\n\n      StringBuilder seed = new StringBuilder();\n\n      urls.append(\n\n        calc_md5(\n\n          seed.insert(0, tld)\n\n            .append(calendar.get(Calendar.WEEK_OF_YEAR))\n\n            .toString()\n\n        )\n\n        .append(Calendar.YEAR)\n\n        .toString()\n\n        .substring(0,16)\n\n      )\n\n      .append(tld);\n\n    }\n\n    catch(Exception exception) { }\n\n    i++;\n\n  }\n\n  return urls.toString().toLowerCase();\n\n```\nStrangely, the year is concatenated to the MD5 string instead of also being hashed. Because\nthe resulting string is cut to the first 16 characters, this means that the year once more has\nno influence on the generated domains.\n\n## Version 2.8\n\nThe most recent sample that I investigated is version 2.8:\n\n**MD5**\n2dfe83d4d7c0b5e0cfc0537efdbbbb01\n\n**SHA1**\nf1a820369f02a696e8bcaecee464eeaef0847c44\n\n**SHA256**\ndae193b7cac6d048dcc37916c92b0d2b11c56aa3f45e9995c16417e3b0587404\n\n**Size**\n7 MB (7735296 Bytes)\n\n**Compile Timestamp**\n\n\n-----\n\n1970-02-24 12:54:57 UTC\n\n**Links**\n[VirusTotal](https://www.virustotal.com/gui/file/dae193b7cac6d048dcc37916c92b0d2b11c56aa3f45e9995c16417e3b0587404)\n\n**Filename**\n(VirusTotal)\n\n**Detections**\n**Virustotal: 4/73 as of 2022-05-12 15:24:09 - a variant of Android/Spy.Agent.CDR (ESET-**\nNOD32), HEUR:Trojan-Banker.AndroidOS.Sharkbot.e (Kaspersky),\nANDROID/Bankbot.FKWN.Gen (Avira)\n\nIn version 2.8 the DGA was fixed. Now the year is part of the input to MD5, so domains will\nbe different for distinct years.\n```\nprivate String dga() {\n\n  StringBuilder urls = new StringBuilder();\n\n  Calendar calendar = Calendar.getInstance();\n\n  String tlds[] = \".xyz,.live,.com,.store,.info,.top,.net\".split(\",\");\n\n  int nrTlds = tlds.length;\n\n  int i = 0;\n\n  while(i < nrTlds)\n\n  {\n\n    String tld = tlds[i];\n\n    try\n\n    {\n\n      urls.append(\",http://\");\n\n      StringBuilder seed = new StringBuilder();\n\n      urls.append(\n\n        calc_md5(\n\n          seed.insert(0, tld)\n\n            .append(calendar.get(Calendar.WEEK_OF_YEAR))\n\n            .append(\"\")\n\n            .append(calendar.get(Calendar.YEAR))\n\n            .toString()\n\n        )\n\n        .substring(0,16)\n\n      )\n\n      .append(tld);\n\n    }\n\n    catch(Exception exception) { }\n\n    i++;\n\n  }\n\n  return urls.toString().toLowerCase();\n\n```\n1. [Malpedia entry for SharkBot](https://malpedia.caad.fkie.fraunhofer.de/details/apk.sharkbot) ↩︎\n\n2. [SharkBot: a new generation of Android Trojans is targeting banks in Europe](https://www.cleafy.com/cleafy-labs/sharkbot-a-new-generation-of-android-trojan-is-targeting-banks-in-europe) ↩︎\n\n\n-----\n\n3. [Google is on guard: sharks shall not pass!](https://research.checkpoint.com/2022/google-is-on-guard-sharks-shall-not-pass/) ↩︎\n\n4. SharkBot: a “new” generation Android banking Trojan being distributed on Google Play\n\nStore ↩︎\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-06-04 - The Domain Generation Algorithms of SharkBot.pdf"
    ],
    "report_names": [
        "2022-06-04 - The Domain Generation Algorithms of SharkBot.pdf"
    ],
    "threat_actors": [
        {
            "id": "3fff98c9-ad02-401d-9d4b-f78b5b634f31",
            "created_at": "2023-01-06T13:46:38.376868Z",
            "updated_at": "2025-03-27T02:00:02.818071Z",
            "deleted_at": null,
            "main_name": "Cleaver",
            "aliases": [
                "Cobalt Gypsy",
                "G0003",
                "Operation Cleaver",
                "Op Cleaver",
                "Tarh Andishan",
                "Alibaba",
                "TG-2889"
            ],
            "source_name": "MISPGALAXY:Cleaver",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1683338972,
    "ts_updated_at": 1743041674,
    "ts_creation_date": 1683251729,
    "ts_modification_date": 1683251729,
    "files": {
        "pdf": "https://archive.orkl.eu/70f0f1b803c85ba7b41b4c8c4eec6b0a759a2257.pdf",
        "text": "https://archive.orkl.eu/70f0f1b803c85ba7b41b4c8c4eec6b0a759a2257.txt",
        "img": "https://archive.orkl.eu/70f0f1b803c85ba7b41b4c8c4eec6b0a759a2257.jpg"
    }
}