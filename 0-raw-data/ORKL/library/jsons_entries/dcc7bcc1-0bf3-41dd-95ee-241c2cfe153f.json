{
    "id": "dcc7bcc1-0bf3-41dd-95ee-241c2cfe153f",
    "created_at": "2023-01-12T15:01:54.42436Z",
    "updated_at": "2025-03-27T02:05:54.314497Z",
    "deleted_at": null,
    "sha1_hash": "643491cdb81b59ccb45b35681d9e61c86eb2e524",
    "title": "2022-05-16 - UpdateAgent Adapts Again",
    "authors": "",
    "file_creation_date": "2022-05-27T21:50:15Z",
    "file_modification_date": "2022-05-27T21:50:15Z",
    "file_size": 132514,
    "plain_text": "# UpdateAgent Adapts Again\n\n**jamf.com/blog/updateagent-adapts-again/**\n\n[Jamf Blog](https://www.jamf.com/blog/)\n\nMay 16, 2022 by Jamf Threat Labs\n\n[Security](https://www.jamf.com/blog/category/security/)\nThe Jamf Threat Labs team has recently identified changes to the UpdateAgent malware\ndropper. These changes primarily focus on new executables written in Swift that reach out to\na registration server to pull down a new set of instructions in the form of a bash script.\nPerhaps one of the most identifiable features of the malware is that it relies on the AWS\ninfrastructure to host its various payloads and perform its infection status updates to the\nserver. The continued development of this malware shows that its authors continue to remain\nactive, trying to reach as many users as possible.\n\n**Authors: Jaron Bradley, Stuart Ashenbrenner and Matt Benyo**\n\n## Dropper and Initial Instructions\n\nThe newly discovered Swift-based dropper exhibits many of the characteristics of typical\ndropper malware, including some minor system fingerprinting, endpoint registration and\npersistence. The second stage download and execute the functionality of droppers, in\ngeneral, represent a risky class of malware that support a number of second-stage attacks\n— from malware to spyware, to adware.\n\n\n-----\n\nIn this case, Jamf Threat Labs was tipped by an increase in adware/malware threat\npreventions that appeared to be a part of the same family. Additionally, each instance was\ntraced to an executable named PDFCreator. This executable was unsigned and running from\nthe “/Library/Application Support” directory. Upon further inspection, the executable was\ndetermined to be written in Swift, containing suspiciously obfuscated (base64) strings.\n\nAt the time of discovery, this binary had zero hits from antivirus vendors in VirusTotal.\n\nWhen executed, this binary is responsible for reaching out to a registration server and setting\nup persistence on the system on which it runs.\n\nWhen this executable runs, the following command is run to gather the machine hardware id\nin order to use it as a unique identifier moving forward.\n\nThe executable then uses the following curl command to reach out to a server to register the\ndevice and acquire a bash script to be executed.\n\nThe execution of this bash script is the mach-O executable’s primary task. After pulling it\nfrom the URL, it runs directly from the Swift dropper without hitting the hard drive. During our\n[analysis, the script contents were uploaded to VirusTotal and can be seen here.](https://www.virustotal.com/gui/file/09673c3a260c37e79f799a5e045e71f9b466fbfca61d4467fda1206cdd24a657)\n\n\n-----\n\nBased on the results we are seeing, we suspect this bash script is likely built dynamically as\nmachines are registered. This script performs a large number of actions. Below are just\nsome of the interesting variables that are used which we’ve labeled with comments.\n\nAdditionally, another variable titled “URL” was set. However, it was obvious that at the time of\ninvestigation the link meant to provide this URL value was currently down or unattainable as\nthe $URL variable was set to a “File not found” type error.\n\n[However, other samples of this malicious script can be found on VT that appear to have](https://www.virustotal.com/gui/file/d3eebcbb2cacc1665dfdf8f474764c4d4f0f18fa9aab22a5f3037261c39da030/detection)\nURLs pointing to AWS S3 buckets. AWS has been made aware of the specifics.\n\n## Dropped Malware\n\nWhen the URL variable is accurately set by the server, it gets used to download a stage-2\ndisk image (DMG) to the endpoint. Below, we’ve again commented on the code to describe\nwhat's happening.\n\nIn cases where the $URL is active, the downloaded DMG contained an application. The\napplication file name held within the DMG appears to have been created by combining a few\nrandom words together. This application is then copied to the /tmp directory. A handful of the\nones we’ve seen are as follows:\n\nThe path to the newly created application is then stored within the $TMPFILE variable\ncreated earlier.\n\nOne interesting trick that this malware uses is that it modifies the /etc/sudoers file with the\nfollowing command:\n\nThis command makes it so that the basic user can execute the script ($TMPFILE) as root\nwithout requiring a password. This modification to the sudoers file is only possible if\nUpdateAgent is already running as root.\n\nThe malware then creates a user-level LaunchAgent by running a series of PlistBuddy\ncommands. Here’s an example of a resulting launch agent:\n\nBoth the editing of the sudoers file and the creation of persistence using the PlistBuddy\ncommand align with past workflows done by UpdateAgent according to previous findings\nfrom Microsoft.\n\nWhen this plist loads at runtime, it will execute the temporary application. Even though it runs\nas a user LaunchAgent it is able to escalate to root without a password due to the previously\nmentioned modification made to the /etc/sudoers file.\n\n\n-----\n\nAfter the LaunchAgent is loaded, the malicious bash script sleeps for a short period of time\nand then performs cleanup by unmounting the DMG file and removing the changes it made\nto the sudoers file.\n\n## Other Executables\n\nIn many circumstances, we see yet another plist and binary combination being dropped by\nPDFCreator called“ActiveDirectory”.\n\nOnce again, in the VirusTotal screenshot above, this binary is seen as clean.\n\nAfter close examination, we noted that this executable is almost identical to the PDFCreator\nexecutable. The primary difference is that it reaches out to a different URL from which it\nshould load a bash script.\n\nIn the cases that we observed, this downloaded bash script would send a simple check-in\nevent to the cloud. If the contents of this URL change, the victim computer can perform any\ngiven instructions when it checks in next.\n\n## Conclusion\n\nThe authors of the UpdateAgent malware remain vigilant in keeping it up to date. It is known\nfor having a well-built backend that allows itself to be easily updated, and although we’ve\nonly seen adware families dropped by it, security experts are concerned that there might be\nother malicious plans for the future with such a well-built infrastructure.\n\nJamf Protect users are covered against the known, existing families of this malware,\nincluding various different detection surrounding suspicious behaviors and potentially\nunwanted applications, thanks to the frequently updated behavioral analytics.\n\n## IoC's\n\n\n-----\n\n### Threat actors and malware authors are savvy to updating their toolsets to\n continue compromising endpoints.\n\nSo, why not rely on a solution, like Jamf Protect, that is consistently updated and has the\n\nstrength of the Jamf Threat Labs behind it to prevent the latest threats?\n\n[Request Trial](https://www.jamf.com/request-trial/jamf-protect/)\nJamf Threat Labs\nJamf\n\nJamf's internal research team comprised of Jaron Bradley, Stuart Ashenbrenner, Ferdous\nSaljooki and Matt Benyo.\n\nSubscribe to the Jamf Blog\nHave market trends, Apple updates and Jamf news delivered directly to your inbox.\n\nTo learn more about how we collect, use, disclose, transfer, and store your information,\n[please visit our Privacy Policy.](https://www.jamf.com/privacy-policy/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-05-16 - UpdateAgent Adapts Again.pdf"
    ],
    "report_names": [
        "2022-05-16 - UpdateAgent Adapts Again.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535714,
    "ts_updated_at": 1743041154,
    "ts_creation_date": 1653688215,
    "ts_modification_date": 1653688215,
    "files": {
        "pdf": "https://archive.orkl.eu/643491cdb81b59ccb45b35681d9e61c86eb2e524.pdf",
        "text": "https://archive.orkl.eu/643491cdb81b59ccb45b35681d9e61c86eb2e524.txt",
        "img": "https://archive.orkl.eu/643491cdb81b59ccb45b35681d9e61c86eb2e524.jpg"
    }
}