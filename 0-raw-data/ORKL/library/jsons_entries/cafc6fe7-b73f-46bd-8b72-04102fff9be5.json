{
    "id": "cafc6fe7-b73f-46bd-8b72-04102fff9be5",
    "created_at": "2023-01-12T14:58:57.976302Z",
    "updated_at": "2025-03-27T02:05:57.48191Z",
    "deleted_at": null,
    "sha1_hash": "3218252daf2eced054a80371fbc1824bfa315ab5",
    "title": "2016-11-15 - ScanPOS, new POS malware being distributed by Kronos",
    "authors": "",
    "file_creation_date": "2022-10-02T12:11:13Z",
    "file_modification_date": "2022-10-02T12:11:13Z",
    "file_size": 529982,
    "plain_text": "# securitykitten.github.io/2016-11-15-scanpos.md at master · malware-kitten/securitykitten.github.io · GitHub\n\n**[github.com/malware-kitten/securitykitten.github.io/blob/master/_posts/2016-11-15-scanpos.md](https://github.com/malware-kitten/securitykitten.github.io/blob/master/_posts/2016-11-15-scanpos.md)**\n\nmalware-kitten\n\n**layout** **title** **date**\n\n\ncategorypost\n\n\nScanPOS, new POS malware being\ndistributed by Kronos\n\n\n2016-11-15\n00:00:00 -0500\n\n\n## Summary:\n\nJust in time for the holidays, a brand new Point Of Sale (POS) malware family has\nbeen discovered.\n\nBooz Allen responded to a Kronos phishing campaign that involved a document\nwith a malicious macro that downloaded the Kronos banking malware. When\nrunning, the Kronos payload will download several other pieces of malware, but\nthe one that caught our eye is a new credit card dumper with very low detection.\nBooz Allen is tracking this malware under the name ScanPOS due to the build\nstring present in the malware.\n\n\n-----\n\n```\nC:\\Users\\example\\documents\\visual studio\n2010\\Projects\\scan3\\Release\\scan3.pdb\n\n```\nAt the time of this writing, ScanPOS only scored 1/55 on Virustotal:\n\nScanPOS, while not extraordinarily impressive or unique, is a new family. It\nperforms the same basic tasks that all other POS malware performs, yet sneaks\nby almost every developed detection technique. ScanPOS does little in terms of\nevading detection, which can help it blend in a production environment. When\ncode is heavily packed, it will often get picked up by generic heuristics.\n\n## Phish\n\nThe Kronos phish that was delivering the malware was a very basic email with the\nfollowing body:\n```\nAn Employee has just been terminated.\n\nName: Tanner Williamson\n\nEmployee profile: EmployeeID-6283.doc\n\nEmplid: 2965385\n\nRcd#: 0\n\nTermination Date: 11/17/2016\n\n\n```\nRelevant headers are below:\n```\nTIME-STAMP: \"16-11-14_13.44.23\"\n\nCONTENT-DISPOSITION: \"attachment; filename='EmployeeID-6283.doc'\"\n\nX-VIRUS-SCANNED: \"Debian amavisd-new at hosting5.skyinet.pl\"\n\nSubject : An Employee has just been terminated.\n\nFrom: HR <johns.brueggemann@banctec.com>\n\nMail-From: web1@hosting5.skyinet.pl\n\n1st rec: hosting23.skyinet.pl\n\n2nd rec:hosting23.skyinet.pl\n\n\n```\nWhen enabling the macro on EmployeID-6283.doc, the macro will download\n```\nprofile.excel-sharepoint[.]com/doc/office.exe \n\n\n```\n(Kronos Payload) and execute it. Kronos will then download and execute\nScanPOS from\n\n\n-----\n\n```\nhttp://networkupdate[.]online/kbps/upload/a8b05325.exe\n\n## Credit Card Dumping\n\n```\nOn execution, the malware will grab information about the current process and get\nthe user (calling GetUserNameA). Privileges are checked to ensure that the\nmalware has the ability to peek into other processes’ memory space by checking\nfor SeDebugPrivilege (see below).\n\nThe malware will then enter an infinite loop, padded with sleeps, to dump process\nmemory on the box to search for credit card track data. During this loop, the\nmalware iterates processes using Process32FirstW/Process32Next from a\nprocess list obtained via CreateToolhelp32Snapshot.\n\nThe iterator obtains a handle to the process by using OpenProcess, which is then\nchecked against a basic whitelist, to avoid unnecessary system processes:\n\n\n-----\n\nIf the name of the process passes a check against the whitelist, the malware will\ncontinue to get process memory information by calling VirtualQueryEx and then\neventually fall to ReadProcessMemory.\n\n\n-----\n\nOnce process memory is obtained, the scanning for credit card track data can\nbegin. The main logic behind this is in function 0x4026C0.\n\nThe logic starts with basic sentinel checks and a starting number of 3,4,5 or 6.\n\n\n-----\n\nThe malware will use a custom search routine (rather than regex) to find potential\nnumbers.\n\nAfter the malware does several checks for credit card information, it will pass the\npotential candidate to Luhn’s algorithm for basic validation.\n\n\n-----\n\nWhen it finds a potential candidate that passes Luhn’s, it will continue searching\nfor numbers (anything between 0 and 9) until it hits a “?” marking the end of the\ntrack data.\n\n## Network Connectivity\n\nOnce the potential card numbers are found, the information is sent via HTTP\nPOST to invoicesharepoint[.]com.\n\n## Conclusion\n\nScanPOS is being distributed through an active campaign. With only 1 anti-virus\nengine flagging this executable as malicious, this family helps show the constant\npressure that AV vendors face while trying to stay ahead of the curve. Being\n\n\n-----\n\ndistributed in a macro is a simple technique that has been covered in detail in\nmany different blog posts and may have helped this family hide a little bit in the\nnoise.\n\n## Indicators of Compromise\n\n**Indicator** **Type** **Notes**\n\ninvoicesharepoint.com Domain ScanPOS C2 & data dump\n(46.45.171.174)\n\n/gateway.php URI ScanPOS C2 POST uri\n\nnetworkupdate.online Domain Office.exe (Kronos) Downloads\nadditional EXE (46.45.171.174)\n\n[www.networkupdate.club](http://www.networkupdate.club/) Domain Office.exe (Kronos) C2\n(46.45.171.174 )\n\nprofile.excel-sharepoint.com Domain Dropper DL site from phish\n(211.110.17.192)\n\n939fcb17ebb3aa7dd57d62d36b442778 MD5 Phish doc: EmployeeID-6283.doc\n\n11180b265b010fbfa05c08681261ac57 MD5 Office.exe (Kronos)\n\n6fcc13563aad936c7d0f3165351cb453 MD5 POS malware: (Kronos DL)\na8b05325.exe\n\n73871970ccf1b551a29f255605d05f61 MD5 (Kronos DL) 1f80ff71.exe\n\nf99d1571ce9be023cc897522f82ec6cc MD5 (Kronos DL) c1c06f7d.exe\n\n/kbps/connect.php URI Kronos C2 traffic\n\n/kbps/connect.php?a=1 URI Kronos C2 traffic\n\n/kbps/upload/c1c06f7d.exe URI Kronos Trj DL [a-z0-9],{8}.exe\n\n[johns.brueggemann@banctec.com](mailto:johns.brueggemann@banctec.com) email From address\n\n[web1@hosting5.skyinet.pl](mailto:web1@hosting5.skyinet.pl) email Mail-From address\n\nftp.itmy520.com Domain Found in\n73871970ccf1b551a29f255605d05f61\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2016/2016-11-15 - ScanPOS, new POS malware being distributed by Kronos.pdf"
    ],
    "report_names": [
        "2016-11-15 - ScanPOS, new POS malware being distributed by Kronos.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535537,
    "ts_updated_at": 1743041157,
    "ts_creation_date": 1664712673,
    "ts_modification_date": 1664712673,
    "files": {
        "pdf": "https://archive.orkl.eu/3218252daf2eced054a80371fbc1824bfa315ab5.pdf",
        "text": "https://archive.orkl.eu/3218252daf2eced054a80371fbc1824bfa315ab5.txt",
        "img": "https://archive.orkl.eu/3218252daf2eced054a80371fbc1824bfa315ab5.jpg"
    }
}