{
    "id": "75960a95-10b2-4cdb-9c05-ff34e73e801f",
    "created_at": "2023-01-12T15:00:37.539831Z",
    "updated_at": "2025-03-27T02:05:39.419601Z",
    "deleted_at": null,
    "sha1_hash": "35db8bc68310e3103c8ad92122aead5d256921a0",
    "title": "2021-03-05 - Exchange Server IIS dropping web shells and other artifacts",
    "authors": "",
    "file_creation_date": "2022-05-28T15:47:08Z",
    "file_modification_date": "2022-05-28T15:47:08Z",
    "file_size": 104759,
    "plain_text": "# Exchange Server IIS dropping web shells and other artifacts\n\n**github.com/microsoft/Microsoft-365-Defender-Hunting-Queries/blob/master/Execution/exchange-iis-worker-dropping-**\nwebshell.md\n\nmicrosoft\n\nThis query was originally published in the threat analytics report, \"Exchange\nServer zero-days exploited in the wild\".\n\n[In early March 2021, Microsoft released patches for four different zero-day](https://msrc-blog.microsoft.com/2021/03/02/multiple-security-updates-released-for-exchange-server/)\nvulnerabilities affecting Microsoft Exchange Server. The vulnerabilities were\nbeing used in a coordinated attack. For more information on the vulnerabilities,\nvisit the following links:\n\n[CVE-2021-26855](https://nvd.nist.gov/vuln/detail/CVE-2021-26855)\n[CVE-2021-26857](https://nvd.nist.gov/vuln/detail/CVE-2021-26857)\n[CVE-2021-26858](https://nvd.nist.gov/vuln/detail/CVE-2021-26858)\n[CVE-2021-27065](https://nvd.nist.gov/vuln/detail/CVE-2021-27065)\n\nThe following query checks for the IIS worker process in Exchange Server\ndropping files that appear to be the web shells and other threat artifacts\nobserved in known attacks.\n\n\n-----\n\nMore queries related to this threat can be found under the See also section of\nthis page.\n\n## Query\n```\nDeviceFileEvents\n| where InitiatingProcessFileName == 'w3wp.exe' | where\nInitiatingProcessCommandLine contains \"MSExchange\"\n| where FolderPath has_any (\"\\\\wwwroot\\\\\",\n\"HttpProxy\\\\owa\\\\\",\"\\\\Temporary ASP.NET Files\\\\\")\n| where not(FolderPath has_any(\"\\\\tmp\\\\\",\"\\\\dl3\\\\\"))\n| where FolderPath !endswith \".log\" | where FolderPath !endswith \".json\"\n| where FolderPath !endswith \".ini\"\n| where FolderPath !endswith \".vb\"\n| where FolderPath !endswith '.tmp'\n| where FolderPath !endswith '.xml'\n| where FolderPath !endswith '.js'\n\n Category\n\n```\nThis query can be used to detect the following attack techniques and tactics\n[(see MITRE ATT&CK framework) or security configuration states.](https://attack.mitre.org/)\n\n**Technique, tactic, or state** **Covered? (v=yes)** **Notes**\n\nInitial access\n\nExecution v\n\nPersistence v\n\nPrivilege escalation\n\nDefense evasion\n\nCredential Access\n\nDiscovery\n\nLateral movement\n\nCollection\n\nCommand and control\n\nExfiltration\n\nImpact\n\nVulnerability\n\n\n-----\n\n**Technique, tactic, or state** **Covered? (v=yes)** **Notes**\n\nExploit\n\nMisconfiguration\n\nMalware, component\n\nRansomware\n\n## See also\n\n Contributor info\n\n**Contributor: Microsoft 365 Defender team**\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-03-05 - Exchange Server IIS dropping web shells and other artifacts.pdf"
    ],
    "report_names": [
        "2021-03-05 - Exchange Server IIS dropping web shells and other artifacts.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535637,
    "ts_updated_at": 1743041139,
    "ts_creation_date": 1653752828,
    "ts_modification_date": 1653752828,
    "files": {
        "pdf": "https://archive.orkl.eu/35db8bc68310e3103c8ad92122aead5d256921a0.pdf",
        "text": "https://archive.orkl.eu/35db8bc68310e3103c8ad92122aead5d256921a0.txt",
        "img": "https://archive.orkl.eu/35db8bc68310e3103c8ad92122aead5d256921a0.jpg"
    }
}