{
    "id": "77e48147-bbb5-4474-a0b8-f8c65da33299",
    "created_at": "2022-10-25T16:48:22.611055Z",
    "updated_at": "2025-03-27T02:17:27.645725Z",
    "deleted_at": null,
    "sha1_hash": "ab9e7ac7d48f727dab0986a1672f60c1a7d8dec2",
    "title": "",
    "authors": "",
    "file_creation_date": "2020-03-03T01:46:59Z",
    "file_modification_date": "2020-03-03T01:46:59Z",
    "file_size": 953644,
    "plain_text": "# APT34 (aka OilRig, aka Helix Kitten) attacks Lebanon government entities with MailDropper implants\n\n**[blog.telsy.com/apt34-aka-oilrig-attacks-lebanon-government-entities-with-maildropper-implant](https://blog.telsy.com/apt34-aka-oilrig-attacks-lebanon-government-entities-with-maildropper-implant/)**\n\nwebmaster@telsy.com\n\nVery recently another custom malicious implant that seems to be related to APT34 (aka OilRig)\nhas been uploaded to a major malware analysis platform. Since 2014, year in which FireEye\nspotted out this hacking group, APT34 is well-known to conduct cyber operations primarily in the\nMiddle East, mainly targeting financial, government, energy, chemical and telecommunications\nsector.\n\nIn this case, the threat group probably compromised a Microsoft Exchange account of a sensitive\nentity related to Lebanese government, and used the mail server as command-and-control of the\nimplant. All the traffic between the compromised machine and the C2 is conveyed through legit\nemail messages, making the implant identification harder. The victim seems to be a Lebanese\ngovernment entity, so it’s possible to guess that the APT group exploited the trust towards the first\nentity to compromise others and to hide its malicious operations.\n\n## Actor Profile\n\n\n-----\n\nAPT34 is believed to be a a threat actor close to Iranian government in consideration of the fact\nthat it conducts operations aligned with the interests of this country. Over the time this group has\nbeen observed to carry out supply chain attacks, leveraging the trust relationship between their\nprimary targets and others organizations. Over the time, many malware families have also been\nassociated with this group including ISMAgent, ISMDoor, ISMInjector, TwoFace and, at the time\nof this analysis, the MailDropper one.\n\n## Behavior Analysis\n\nThe malware is delivered through spear-phishing email messages. The infection starts with a\nmacro-armed Excel document. The Macro contains a base64 encoded executable payload,\ncopied as “monitor.exe”, which will be deployed in a just created folder, named “.Monitor” under\n_“C:\\Users\\Public”. Through the usage of Windows Task Scheduler, “monitor.exe” is added to a_\nnew task, named “SystemErrorReporter”, whose execution is scheduled every minute.\n\nAnalyzing the resources embedded into “monitor.exe”, it is possible to discover some further\ninformation, such as the credentials used to access a Microsoft Exchange server hosted in\nLebanon. For privacy reasons, the primary communication server will not be publicly released.\n\n_hardcoded credentials of the implant_\n\nWe guess the attackers have compromised the account “media@xxx.local”, belonging to the\nlocal domain of the targeted institution, and used it to perform malicious operations. In this\nspecific case, the access to the mail server is used by the malware to get a list of commands to\nbe executed through the retrieving and parsing of a CMD list. So, it acts like a command-andcontrol server.\n\n\n-----\n\n_Retrieving and parsing CMDs_\n\nIf the mail server is down or deny the access, the malware uses a backup URL,\n_“hxxp://godoycrus.com” to get the commands list, according to the evidences below:_\n\n_Switch between Command and Control servers_\n\nThe malware is capable to perform the following primary operations:\n\n_[+] arbitrary commands execution_\n\n_[+] download and upload of files_\n\n_[+] data exfiltration_\n\nThe following is a extraction of the commands handling code snippet:\n\n\n-----\n\n_Code handling code snippet_\n\nInteresting the way through which the malware retrieves the commands from the mail server. It\naccess to the Inbox folder and search for emails containing a specific subject:\n_“Resume7AKF1PMAVAHI7SYK”. If one or more emails are found, the malware tries to extract_\nthe content of the attachment files, that corresponds to a Base64-encoded command that should\nbe executed.\n\nOnce the attachments are inspected, the current email is definitely deleted using the\n_“HardDelete” flag. In this way the email message does not even appear in the trash folder._\n\nAs shown above, the retrieved commands are executed using the “ExecAllCmds” method and\nthe result is sent to the C2 through the “SendResult” method. If the malware is using the\nExchange server as C2, the output of the commands execution is sent as email message. Once\nagain, the malware uses a specific pattern to build the email: its subject is build starting from the\n\n\n-----\n\nstring “Great! 7AKF1PMAVAHI7SYK”, appending the current date to it. The email body contains\nonly the string “This is our reusme!” (showing with a syntax error) and the attachment is a “.txt”\nfile named “resume.txt”, which contains the encoded information returned by the commands\nexecution. The following image is another evidence about what observed:\n\nAll the data exchanged between the implant and the server is encrypted using an AES+RSA\nschema. The data is first ciphered using AES algorithm with an auto-generated key, then the key\nis encrypted using RSA and prepended to the data that will be sent to the server, as shown\nfollowing:\n\n## Persistence\n\nThe malware grants its persistence on the victim machine using the Windows Task Scheduler. It\ncreates a new task pointing to “C:\\Users\\Public\\.Monitor\\monitor.exe”, starting the malicious\npayload every minute.\n\n## Attribution\n\nThe analyzed sample has some similarities with DNSpionage, the remote administrative tool\ndeveloped by APT34 and analyzed by Talos Group in 2019 (ref.\n[https://blog.talosintelligence.com/2019/04/dnspionage-brings-out-karkoff.html). We can](https://blog.talosintelligence.com/2019/04/dnspionage-brings-out-karkoff.html)\nsummarize some characteristics in common:\n\nboth the implant targeted Lebanon;\n\n\n-----\n\nin both cases the initial document is an Excel file containing macro: in DNSpionage the\ncontent of the document is the only string “haha you are donkey”, but in the last case it is\ntotally empty;\nboth the samples use dot in the created folder name, which is “.msonedrive” in\n**_DNSpionage and “.Monitor” in the last sample;_**\nboth the campaigns employ .NET payload.\n\n## Telemetry\n\nAt the time of this analysis, this implant seems to be used exclusively in the Lebanese region,\nconfirming the targeted nature of the implant.\n\n## Indicators of Compromise\n\nmd5: b08dff2a95426a0e32731ef337eab542\n\nsha1: c53d785917c1da4d40cd9fac1455d096faa4b672\n\nsha256: ebae23be2e24139245cc32ceda4b05c77ba393442482109cc69a6cecc6ad1393\n\nDomain name: godoycrus[.]com\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2020/2020.03.02_APT34_MAILDROPPER/apt34-aka-oilrig-attacks-lebanon-government-entities-with-maildropper-implant.pdf"
    ],
    "report_names": [
        "apt34-aka-oilrig-attacks-lebanon-government-entities-with-maildropper-implant"
    ],
    "threat_actors": [
        {
            "id": "ce10c1bd-4467-45f9-af83-28fc88e35ca4",
            "created_at": "2022-10-25T15:50:23.458833Z",
            "updated_at": "2025-03-27T02:00:55.475188Z",
            "deleted_at": null,
            "main_name": "APT34",
            "aliases": null,
            "source_name": "MITRE:APT34",
            "tools": [
                "netstat",
                "Systeminfo",
                "PsExec",
                "SEASHARPEE",
                "Tasklist",
                "Mimikatz",
                "POWRUNER",
                "certutil"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "4632103e-8035-4a83-9ecb-c1e12e21288c",
            "created_at": "2022-10-25T16:07:23.542255Z",
            "updated_at": "2025-03-27T02:02:09.854487Z",
            "deleted_at": null,
            "main_name": "DNSpionage",
            "aliases": [],
            "source_name": "ETDA:DNSpionage",
            "tools": [
                "Agent Drable",
                "AgentDrable",
                "CACTUSPIPE",
                "DNSpionage",
                "DropperBackdoor",
                "Karkoff",
                "MailDropper",
                "OILYFACE"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "cffb3c01-038f-4527-9cfd-57ad5a035c22",
            "created_at": "2022-10-25T15:50:23.38055Z",
            "updated_at": "2025-03-27T02:00:55.459558Z",
            "deleted_at": null,
            "main_name": "OilRig",
            "aliases": [
                "COBALT GYPSY",
                "IRN2",
                "APT34",
                "Helix Kitten",
                "Evasive Serpens",
                "Hazel Sandstorm",
                "EUROPIUM",
                "ITG13"
            ],
            "source_name": "MITRE:OilRig",
            "tools": [
                "ISMInjector",
                "RDAT",
                "Systeminfo",
                "QUADAGENT",
                "OopsIE",
                "Tasklist",
                "certutil",
                "ZeroCleare",
                "POWRUNER",
                "netstat",
                "ipconfig",
                "LaZagne",
                "BONDUPDATER",
                "SideTwist",
                "PsExec",
                "SEASHARPEE",
                "Mimikatz",
                "RGDoor",
                "ftp"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "67709937-2186-4a32-b64c-a5693d40ac77",
            "created_at": "2023-01-06T13:46:38.495593Z",
            "updated_at": "2025-03-27T02:00:02.848206Z",
            "deleted_at": null,
            "main_name": "OilRig",
            "aliases": [
                "IRN2",
                "Hazel Sandstorm",
                "EUROPIUM",
                "TA452",
                "Earth Simnavaz",
                "Cobalt Gypsy",
                "Crambus",
                "Helix Kitten",
                "APT 34",
                "APT34",
                "ATK40",
                "G0049",
                "Evasive Serpens",
                "Twisted Kitten"
            ],
            "source_name": "MISPGALAXY:OilRig",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "8d76e350-dfb5-4733-800d-876de41f690d",
            "created_at": "2023-01-06T13:46:38.841887Z",
            "updated_at": "2025-03-27T02:00:02.932838Z",
            "deleted_at": null,
            "main_name": "DNSpionage",
            "aliases": [
                "COBALT EDGEWATER"
            ],
            "source_name": "MISPGALAXY:DNSpionage",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "3eebdb3f-f4e3-42e5-bb4d-f02a13328316",
            "created_at": "2024-05-01T02:03:08.014303Z",
            "updated_at": "2025-03-27T02:05:17.306592Z",
            "deleted_at": null,
            "main_name": "COBALT EDGEWATER",
            "aliases": [
                "Cold River ",
                "DNSpionage ",
                "APT34 "
            ],
            "source_name": "Secureworks:COBALT EDGEWATER",
            "tools": [
                " DNSpionage",
                " Karkoff",
                " MailDropper",
                " SideTwist",
                " TWOTONE",
                "AgentDrable"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "8f9c8a6e-f6b6-431b-bedd-94fdeea5474a",
            "created_at": "2024-05-01T02:03:08.022974Z",
            "updated_at": "2025-03-27T02:05:17.310877Z",
            "deleted_at": null,
            "main_name": "COBALT GYPSY",
            "aliases": [
                "CHRYSENE ",
                "Crambus ",
                "EUROPIUM ",
                "Hazel Sandstorm ",
                "Helix Kitten ",
                "ITG13 ",
                "OilRig ",
                "Yellow Maero ",
                "APT34 "
            ],
            "source_name": "Secureworks:COBALT GYPSY",
            "tools": [
                " Helminth",
                " Jason",
                " MacDownloader",
                " PoisonFrog",
                " RGDoor",
                " ThreeDollars",
                " TinyZbot",
                " Toxocara",
                " Trichuris",
                " TwoFace",
                "Glimpse"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "b6436f7b-6012-4969-aed1-d440e2e8b238",
            "created_at": "2022-10-25T16:07:23.91517Z",
            "updated_at": "2025-03-27T02:02:10.027531Z",
            "deleted_at": null,
            "main_name": "OilRig",
            "aliases": [
                "APT 34",
                "ATK 40",
                "Chrysene",
                "Cobalt Gypsy",
                "Crambus",
                "DEV-0861",
                "EUROPIUM",
                "Earth Simnavaz",
                "Evasive Serpens",
                "Hazel Sandstorm",
                "Helix Kitten",
                "IRN2",
                "ITG13",
                "Scarred Manticore",
                "Storm-0861",
                "TA452",
                "Twisted Kitten",
                "UNC1860",
                "Yellow Maero"
            ],
            "source_name": "ETDA:OilRig",
            "tools": [
                "AMATIAS",
                "Agent Drable",
                "Agent Injector",
                "AgentDrable",
                "Alma Communicator",
                "BONDUPDATER",
                "CACTUSPIPE",
                "Clayslide",
                "CypherRat",
                "DNSExfitrator",
                "DNSpionage",
                "DROPSHOT",
                "DistTrack",
                "DropperBackdoor",
                "Fox Panel",
                "GREYSTUFF",
                "GoogleDrive RAT",
                "HighShell",
                "HyperShell",
                "ISMAgent",
                "ISMDoor",
                "ISMInjector",
                "Jason",
                "Karkoff",
                "LIONTAIL",
                "LOLBAS",
                "LOLBins",
                "LONGWATCH",
                "LaZagne",
                "Living off the Land",
                "MailDropper",
                "Mimikatz",
                "MrPerfectInstaller",
                "OILYFACE",
                "OopsIE",
                "POWBAT",
                "POWRUNER",
                "Plink",
                "Poison Frog",
                "PowerExchange",
                "PsList",
                "PuTTY Link",
                "QUADAGENT",
                "RDAT",
                "RGDoor",
                "SEASHARPEE",
                "Saitama",
                "Saitama Backdoor",
                "Shamoon",
                "SideTwist",
                "SpyNote",
                "SpyNote RAT",
                "StoneDrill",
                "TONEDEAF",
                "TONEDEAF 2.0",
                "ThreeDollars",
                "TwoFace",
                "VALUEVAULT",
                "Webmask",
                "WinRAR",
                "ZEROCLEAR",
                "ZeroCleare",
                "certutil",
                "certutil.exe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716502,
    "ts_updated_at": 1743041847,
    "ts_creation_date": 1583200019,
    "ts_modification_date": 1583200019,
    "files": {
        "pdf": "https://archive.orkl.eu/ab9e7ac7d48f727dab0986a1672f60c1a7d8dec2.pdf",
        "text": "https://archive.orkl.eu/ab9e7ac7d48f727dab0986a1672f60c1a7d8dec2.txt",
        "img": "https://archive.orkl.eu/ab9e7ac7d48f727dab0986a1672f60c1a7d8dec2.jpg"
    }
}