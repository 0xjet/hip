{
    "id": "30ac18e0-12e5-4703-834d-fbe70e5dd1cc",
    "created_at": "2023-01-12T15:10:08.263133Z",
    "updated_at": "2025-03-27T02:06:09.552205Z",
    "deleted_at": null,
    "sha1_hash": "20e1f4ed185fb4c2fefde7a393deb82c0e25c45e",
    "title": "2020-11-09 - The Exploitation of CVE-2020-0688 in the UAE",
    "authors": "",
    "file_creation_date": "2022-05-28T02:33:07Z",
    "file_modification_date": "2022-05-28T02:33:07Z",
    "file_size": 541304,
    "plain_text": "# The Exploitation Of CVE-2020-0688 In The UAE\n\n**digital14.com/Microsoft-exchange-vulnerability.html**\n\nAccessibility\n\nA A\nResize text\n\nHigh Contrast (Grey Scale)\n\nHigh Contrast\n\nClose\n\nBlog\n\nAHMED AL HASHMI, JOSEPH FRANCIS, MYLENE VILLACORTE Nov. 9, 2020\n\n\n-----\n\n**Introduction**\n\n**During a recent incident, the Digital14** **[Incident Response team came across two](https://www.digital14.com/services/cyber-services/incident-response)**\n**notable pieces of malware related to recent APT activity in the MENA region. The**\n**incident started with the exploitation of CVE-2020-0688, which the attacker used to**\n**drop two DLL artefacts into a folder on the victim’s Exchange servers. The first piece**\n**of malware was first publicly disclosed by** **[RSA on March 24th, 2020. While RSA](https://community.rsa.com/community/products/netwitness/blog/2020/03/24/exchange-exploit-case-study-cve-2020-0688)**\n**covered the ‘System.Web.TransportClient.dll’ malware in detail, our main focus will be**\n**to discuss the second artefact, ‘System.Web.ServiceAuthentication.dll’, which at this**\n**time has not been publicly disclosed. This malware is particularly interesting because**\n**it shows the evolution and change in techniques and capabilities demonstrated by**\n**specific threat actors, and their ability to create malware giving them a stronger**\n**foothold in their target network.**\n\n**System.Web.TransportClient.dll**\n\nThe first DLL webshell we will examine is the ‘System.Web.TransportClient.dll.’ After the\ninitial exploitation of the public-facing web server using CVE-2020-0688, the threat actor\nsaved the webshell to ‘C:\\windows\\temp’ and then installed it at the\n‘C:\\windows\\Microsoft.NET\\assembly\\GAC_MSIL\\system.web.transportclient\\v4.0_1.0.0.0_9cbc’\ndirectory. They used a PowerShell script to register the webshell in the Global Assemblies\nCache (GAC) folder and used the IIS command line tool appcmd.exe to register it as a\nmanaged IIS module on the Exchange server. Once registered, the webshell had the\n\n\n-----\n\nfunctionality to execute commands over an encrypted transmission via cmd.exe as well as to\nsend commands to a named pipe called “splsvc.” The named pipe was initially set up by\nanother PowerShell script found running in memory and provided the functionality to receive\nand execute commands sent to it by the webshell.\n\nNamed Pipe “splsvc”\n\nThe attacker could issue commands to the webshell by sending a specially crafted HTTP\nPOST request containing two variables to the /ews/exchange.asmx page. The first variable\ncontains the first octet of the hardcoded AES key (9g6f4tKp) followed by the encoded\npayload data. The payload carries the commands to be executed. The second variable\ncontains the third octet of the hardcoded AES key (K0IzA79Y) followed by further encoded\ndata which identifies the target device. If the second variable is not present in the HTTP\nrequest, the command will execute on the local system, in this case, the Exchange server.\nLastly, the data is decrypted using base64 and the hardcoded AES key\n(9g6f4tKp****K0IzA79Y****) and then executes using cmd.exe.\n\nDLL Code Snippet\n\n\n-----\n\nAES Key Octets\n\nCrafted HTTP Request\n\nDecrypted Payload Data (1st variable)\n\n**System.Web.ServiceAuthentication.dll**\n\nThe second DLL webshell that we identified was ‘System.Web.ServiceAuthentication.dll’ and\nwas used by the threat actor during the escalation phase of their attack. The webshell was\nalso located in the GAC folder, and it contained three mechanisms which are: 1) form\nauthentication capture, 2) basic authentication capture, and 3) command and control. With\nthe first mechanism, the webshell monitors HTTP traffic and then captures credentials from\nwebform data as victims submit their usernames and passwords. Then it places the captured\nusername and password into a memory object for crosschecking. If the credentials are found\nin the memory object, the malware appends \"exists in cache\" to the output log file or else it\nappends “add to cache” along with the newly captured username and password to the output\nlog file.\n\n\n-----\n\nForm Authentication Capture Mechanism\n\nThe malware also employed a secondary mechanism to capture credentials by looking at the\nHTTP header for basic access authentication. If the header contains “Authorization” with the\ntext “header:” and “basic”, then the base64 data is captured and decoded to reveal the\ncleartext username and password. Next, it puts the username and password into a memory\nobject for crosschecking. If the username and password already exist, it will append “exists\nin cache” to the output log file, else it will append “add to cache”, and finally it adds the\nDateTime, username, password, and HTTP status code. The log file containing the captured\ncredentials from both the form and basic authentication mechanisms is stored in the\n\nC:\\windows\\temp folder.\n\n\n-----\n\nBasic Authentication Capture Mechanism\n\nLastly, with the third mechanism, the webshell acts as a command and control agent. It waits\nand listens for specific cookies and their respective values in the HTTP response header and\nthen executes the corresponding function. Below is a table with the cookies, values, and\nfunctions.\n\nTable 1: Cookies, Values, and Functions\n\n\n-----\n\nHTTP Header with Cookies and Values\n\n**Conclusion**\n\nIn this incident, the threat actor was able to conceal their malware on the Exchange servers\nby imitating legitimate IIS file naming conventions. Then they leveraged these modules to\ngain access to the target system, harvest credentials, and execute commands within the\nnetwork. Early detection is vital to prevent attackers from securing a stronger foothold in the\nnetwork and using legitimate accounts to mask their activity. Detection can be achieved by\nmonitoring for encoded PowerShell commands, verifying newly loaded IIS modules, and\nusing secure module authentication.\n\nWhile the Digital14 Incident Response team will not be discussing attribution of these\nsamples, it is interesting to watch the evolution of this threat actor as they mature aspects of\ntheir tradecraft.\n\nIOCs\n\nTable 2: File Names and Hashes\n\n\n-----\n\n**Yara Rules**\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-11-09 - The Exploitation of CVE-2020-0688 in the UAE.pdf"
    ],
    "report_names": [
        "2020-11-09 - The Exploitation of CVE-2020-0688 in the UAE.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536208,
    "ts_updated_at": 1743041169,
    "ts_creation_date": 1653705187,
    "ts_modification_date": 1653705187,
    "files": {
        "pdf": "https://archive.orkl.eu/20e1f4ed185fb4c2fefde7a393deb82c0e25c45e.pdf",
        "text": "https://archive.orkl.eu/20e1f4ed185fb4c2fefde7a393deb82c0e25c45e.txt",
        "img": "https://archive.orkl.eu/20e1f4ed185fb4c2fefde7a393deb82c0e25c45e.jpg"
    }
}