{
    "id": "575ae197-891a-4aa4-9994-895cfc209d6e",
    "created_at": "2023-01-12T15:06:17.511788Z",
    "updated_at": "2025-03-27T02:09:17.936603Z",
    "deleted_at": null,
    "sha1_hash": "f1ffb776f2d6ec1207e0b9d57c504fe9a8320e6f",
    "title": "2021-07-20 - Hancitor’s Multi-Step Delivery Process",
    "authors": "",
    "file_creation_date": "2022-05-28T15:21:41Z",
    "file_modification_date": "2022-05-28T15:21:41Z",
    "file_size": 1288254,
    "plain_text": "# Malware Analysis Spotlight: Hancitor’s Multi-Step Delivery Process\n\n**[vmray.com/cyber-security-blog/hancitor-multi-step-delivery-process-malware-analysis-spotlight/](https://www.vmray.com/cyber-security-blog/hancitor-multi-step-delivery-process-malware-analysis-spotlight/)**\n\nHancitor can be grouped into the category of downloaders that are often responsible for\ndelivering further malware families into a compromised network. Recently, it has been\n[observed delivering the Ficker Stealer Cobalt Strike and the Cuba ransomware among](https://unit42.paloaltonetworks.com/hancitor-infections-cobalt-strike/)\n\n\n-----\n\nothers. It is usually distributed to the victim via malicious spam campaigns that are\nintermittent in nature. In this Malware Analysis Spotlight, we will look at Hancitor’s behavior\nand ability to deliver an information stealer.\n\n[View the VMRay Analyzer Report for the Hancitor Infostealer](https://www.vmray.com/analyses/hancitor-info-stealer-2021-analysis)\n\n## Analysis of Hancitor’s Configurations\n\nIf we extract the buildID from Hancitor’s configuration, we are able to notice the fact that\nHancitor seems to be distributed in waves. The malspam with a particular build is sent for a\nperiod of time, after which there is a pause in the distribution before a new wave of malspam\ndistributes another build (Figure 1). Some of the spam waves produce more unique samples\nthan others but the overall trend is pointing upwards. Usually, each batch has a unique\nconfiguration containing a new buildID and new C&C URLs (see Extracted Configurations for\na non-exhaustive list of configurations).\n\n_Figure 1: Line graph where the points on the x-axis indicate the date extracted from the_\n_config and the y-axis indicates the number of samples associated with a buildID._\n\n### Hancitor Analysis\n\nThe usual execution chain starts with malicious emails containing an embedded Google\nDocs URL. Those URLs point the user to a domain controlled by the threat actor. There, the\nvictim is prompted to download a document. This dropped document is responsible for\nextracting and loading a DLL. The method that the malicious document uses to achieve\nexecution is usually a VBA macro that is executed when the document is opened (Figure 2).\nThe initial DLL is an intermediate stage responsible for extracting and running Hancitor.\n\n\n-----\n\n_Figure 2: Malicious document telling the user to enable editing._\n\nThe VBA macro’s main responsibility is to execute the embedded DLL. The DLL doesn’t\nrequire a specific entry point to run, but it’s still invoked with one. The passed entry point isn’t\nused by this initial DLL, but by the actual Hancitor payload at a later stage of the execution\nprocess. For Hancitor to run, it’s necessary to start it by calling one of its exported functions.\nThe name of the function is hard-coded inside the macro code (Figure 3).\n\n\n-----\n\n_Figure 3: VMRay Analyzer – Excerpt of the macro responsible for starting the embedded_\n_DLL (top) and a VTI tracking the dropped file (bottom)_\n\nThe document’s macro is loading the DLL by using the rundll32 utility. By observing the\n[process creation in the VMRay Analyzer we can also see the passed command line](https://www.vmray.com/products/analyzer-malware-sandbox/)\narguments. The called entry point corresponds exactly with one of Hancitor’s exported\nfunctions (Figure 4).\n\n\n-----\n\n_Figure 4: Monitoring of the rundll32 processes in VMRay Analyzer (left) and the export_\n_directory of Hancitor (right)._\n\nThe initial DLL is a packer that is responsible for decrypting, decompressing, and loading the\n[Hancitor payload. The compression library used by the packer is aPLib. aPLib became quite](https://ibsensoftware.com/products_aPLib.html)\npopular with malware authors due to its small footprint and relatively good compression and\n[decompression speed. Nonetheless, the smart memory dumping of the VMRay Analyzer](https://www.vmray.com/cyber-security-blog/smart-memory-dumping/)\nincludes the memory dumps of each stage which also contain the final uncompressed\nHancitor payload (Figure 5).\n\n_Figure 5: VMRay Analyzer – The final Hancitor payload extracted from one of the buffers_\n_(top) and the corresponding matching YARA rule (bottom)._\n\nThe DLL itself and the techniques it uses are very similar to the ones previously used by,\ne.g., [Dridex. When it’s finally Hancitor’s turn to take over the execution flow, it first tries to](https://blogs.vmware.com/networkvirtualization/2021/03/analysis-of-a-new-dridex-campaign.html/))\ninitiate a connection to its C&C server. Usually, each Hancitor binary knows about three C&C\nURLs which are embedded in its configuration file. It gathers information about the infected\nhost system (adapter addresses and the volume serial number) and uses that to generate a\nunique ID. It also checks the external IP address and the AD domain, if the host is part of\nany. It then bundles it all into the initial request to the server (Figure 6). Some of that\ninformation is used by the C&C server to deliver a specific payload. For example,\nin recent Hancitor campaigns it has been seen delivering Cobalt Strike if the host was part of\nan AD domain.\n\n\n-----\n\n_Figure 6: VMRay Analyzer – VTI rules matching the host discovery (left) and the C&C_\n_network connection containing the beacon string (right)._\n\nThe response sent by the server is XORed and base64 encoded. The 1-byte XOR key\nrequired to decrypt the data is hard-coded inside the routine responsible for decoding. When\nthe data is decoded, the command is extracted and validated. Then it’s processed and the\ncorresponding action is taken. In this analysis, Hancitor downloads a secondary payload\nfrom a server which it receives from its C&C (as part of the response). It then starts\nsvchost.exe and injects it with the downloaded payload (Figure 7). In this particular case, the\ndelivered payload is a stealer.\n\n_Figure 7: Hancitor contacts its C&C and downloads the payload from another server (left) it_\n_then injects it into svchost.exe (right)._\n\n### Conclusion\n\nAlthough the capabilities of Hancitor itself didn’t really change over the past years, the\ncombination of a multi-step delivery process and different packers, still allows it to avoid\ndetection and deliver further malware families successfully. VMRay Analyzer’s dynamic\nanalysis plays an important role in the detection process and can provide defenders with\ntimely information necessary to protect their networks.\n\n### IOCs\n\n**Initial document**\n\nSHA256:\n```\ne431a1bb2efcf6000f5bac4e19673d6deb9de7997dba5f65bae7779cd19e5caf\n\n```\n**Hancitor DLL**\n\nSHA256:\n\n\n-----\n\n```\n82E13456113A950EE0FE06975CEC093B2D78F91E75D482428ECFA274EC7D2555\n\n```\n**Extracted Configurations**\n\n[Hancitor configuration in the MWCP schema:](https://github.com/Defense-Cyber-Crime-Center/DC3-MWCP)\n\n\n-----\n\n```\n{ key : [b b27242d151accab3 ], missionid : [ 3011_hjdfsfg ], c2_url :\n['hxxp://propywast[.]com/8/forum.php', 'hxxp://aribliffored[.]ru/8/forum.php', 'hxxp:/\n{'key': [b'0e5c84ed4a00f0b8'], 'missionid': ['0112_hjdfsjhf'], 'c2_url':\n['hxxp://neectuded[.]com/8/forum.php', 'hxxp://exieverhiltur[.]ru/8/forum.php', 'hxxp:\n{'key': [b'c0b9e88c8c15013d'], 'missionid': ['0212_78434'], 'c2_url':\n['hxxp://eaussill[.]com/8/forum.php', 'hxxp://hossangerts[.]ru/8/forum.php', 'hxxp://b\n{'key': [b'd4cf01508b268707'], 'missionid': ['0312_89324'], 'c2_url':\n['hxxp://bandieve[.]com/8/forum.php', 'hxxp://decturnearrips[.]ru/8/forum.php', 'hxxp:\n{'key': [b'75a02962251f70df'], 'missionid': ['0712_843923'], 'c2_url':\n['hxxp://maduabin[.]com/8/forum.php', 'hxxp://thenexames[.]ru/8/forum.php', 'hxxp://pr\n{'key': [b'ddd2e881a29b02ee'], 'missionid': ['0912_3oooiu9'], 'c2_url':\n['hxxp://spardethe[.]com/8/forum.php', 'hxxp://tworkityre[.]ru/8/forum.php', 'hxxp://s\n{'key': [b'60cd28d0bb2fb7d8'], 'missionid': ['1301_dsf7823'], 'c2_url':\n['hxxp://requirend[.]com/8/forum.php', 'hxxp://spabyasiande[.]ru/8/forum.php', 'hxxp:/\n{'key': [b'299cdab6ea0db92f'], 'missionid': ['1401_90210'], 'c2_url':\n['hxxp://ocifirtaterity[.]com/8/forum.php', 'hxxp://mailartmen[.]ru/8/forum.php', 'hxx\n{'key': [b'f3725ea38a05c622'], 'missionid': ['1901_48re93'], 'c2_url':\n['hxxp://opulteme[.]com/8/forum.php', 'hxxp://tharepirms[.]ru/8/forum.php', 'hxxp://wo\n{'key': [b'155ed9c95666b69e'], 'missionid': ['0102_jerpo3'], 'c2_url':\n['hxxp://antialkinno[.]com/8/forum.php', 'hxxp://knorshand[.]ru/8/forum.php', 'hxxp://\n{'key': [b'cb5c4a0385406924'], 'missionid': ['0302_095463'], 'c2_url':\n['hxxp://efelsdvismade[.]com/8/forum.php', 'hxxp://curishisral[.]ru/8/forum.php', 'hxx\n{'key': [b'ea4276b76f53dbde'], 'missionid': ['1702_pro23'], 'c2_url':\n['hxxp://hatuderefer[.]com/8/forum.php', 'hxxp://thavelede[.]ru/8/forum.php']}\n{'key': [b'85a43da114bd20b4'], 'missionid': ['0103_jepskew'], 'c2_url':\n['hxxp://ementincied[.]com/8/forum.php', 'hxxp://watoredprocaus[.]ru/8/forum.php', 'hx\n{'key': [b'6727a6d2d2680b3a'], 'missionid': ['0203_lisr93'], 'c2_url':\n['hxxp://witakilateg[.]com/8/forum.php', 'hxxp://sonalsovele[.]ru/8/forum.php', 'hxxp:\n{'key': [b'c6935de3e9a3daf8'], 'missionid': ['0804_cifp'], 'c2_url':\n['hxxp://lerevahel[.]com/8/forum.php', 'hxxp://lerevahel[.]ru/8/forum.php', 'hxxp://me\n{'key': [b'430c378c39a69089'], 'missionid': ['1204_spk'], 'c2_url':\n['hxxp://varembacen[.]com/8/forum.php', 'hxxp://twomplon[.]ru/8/forum.php', 'hxxp://la\n{'key': [b'2347b01e5ff72081'], 'missionid': ['1404_cms3'], 'c2_url':\n['hxxp://dingulbolies[.]com/8/forum.php', 'hxxp://culadinces[.]ru/8/forum.php', 'hxxp:\n{'key': [b'c836388e91c7977c'], 'missionid': ['1504_wtp'], 'c2_url':\n['hxxp://regatimmish[.]com/8/forum.php', 'hxxp://wilewgracted[.]ru/8/forum.php', 'hxxp\n{'key': [b'7600d5b6a7526763'], 'missionid': ['1904_hvm'], 'c2_url':\n['hxxp://erisastand[.]com/8/forum.php', 'hxxp://trimpledtim[.]ru/8/forum.php', 'hxxp:/\n\n```\n\n-----\n\n```\n{'key': [b'58988055df80892d'], 'missionid': ['2104_mmvm'], 'c2_url':\n['hxxp://lectionalt[.]com/8/forum.php', 'hxxp://palimenciont[.]ru/8/forum.php', 'hxxp:\n{'key': [b'45c57c2205119f33'], 'missionid': ['2204_fesw09'], 'c2_url':\n['hxxp://adrouterigh[.]com/8/forum.php', 'hxxp://fronversimai[.]ru/8/forum.php', 'hxxp\n{'key': [b'2bfb5eabc096751b'], 'missionid': ['2604_gthewq'], 'c2_url':\n['hxxp://caperesto[.]com/8/forum.php', 'hxxp://watiounds[.]ru/8/forum.php', 'hxxp://th\n{'key': [b'e34fc8d1add6defb'], 'missionid': ['2804_jk02pol'], 'c2_url':\n['hxxp://sumbahas[.]com/8/forum.php', 'hxxp://staciterst[.]ru/8/forum.php', 'hxxp://se\n{'key': [b'b9d0eb646a90825c'], 'missionid': ['2904_x2'], 'c2_url':\n['hxxp://nencivelf[.]com/8/forum.php', 'hxxp://chasslace[.]ru/8/forum.php', 'hxxp://so\n{'key': [b'54bef01dcee6813b'], 'missionid': ['1305_vers89'], 'c2_url':\n['hxxp://chnicallimigue[.]com/8/forum.php', 'hxxp://amaozedractue[.]ru/8/forum.php', '\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-07-20 - Hancitor’s Multi-Step Delivery Process.pdf"
    ],
    "report_names": [
        "2021-07-20 - Hancitor’s Multi-Step Delivery Process.pdf"
    ],
    "threat_actors": [
        {
            "id": "50b43f44-b93c-4377-82bc-d6e9c7ef5ee6",
            "created_at": "2022-10-25T16:07:23.573424Z",
            "updated_at": "2025-03-27T02:02:09.872253Z",
            "deleted_at": null,
            "main_name": "Elephant Beetle",
            "aliases": [
                "TG2003"
            ],
            "source_name": "ETDA:Elephant Beetle",
            "tools": [
                "JSPSPY",
                "MiniWebCmdShell",
                "jsp File browser",
                "reGeorg"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f57e32ac-9f90-471d-93ba-7f6d8b05e6c1",
            "created_at": "2023-01-06T13:46:39.29882Z",
            "updated_at": "2025-03-27T02:00:03.044264Z",
            "deleted_at": null,
            "main_name": "FIN13",
            "aliases": [
                "TG2003",
                "Elephant Beetle"
            ],
            "source_name": "MISPGALAXY:FIN13",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535977,
    "ts_updated_at": 1743041357,
    "ts_creation_date": 1653751301,
    "ts_modification_date": 1653751301,
    "files": {
        "pdf": "https://archive.orkl.eu/f1ffb776f2d6ec1207e0b9d57c504fe9a8320e6f.pdf",
        "text": "https://archive.orkl.eu/f1ffb776f2d6ec1207e0b9d57c504fe9a8320e6f.txt",
        "img": "https://archive.orkl.eu/f1ffb776f2d6ec1207e0b9d57c504fe9a8320e6f.jpg"
    }
}