{
    "id": "cdd62fec-9ead-4547-ae8b-1550ec7f4a3f",
    "created_at": "2022-10-25T16:48:19.631736Z",
    "updated_at": "2025-03-27T02:05:24.332979Z",
    "deleted_at": null,
    "sha1_hash": "7c2f93f1fbe764ff94de5e5d5f29daea4a512956",
    "title": "",
    "authors": "",
    "file_creation_date": "2017-11-07T08:37:34Z",
    "file_modification_date": "2017-11-07T08:37:34Z",
    "file_size": 1107513,
    "plain_text": "# ChessMaster’s New Strategy: Evolving Tools and Tactics\n\n[Posted on:November 6, 2017 at 4:48 am](http://blog.trendmicro.com/trendlabs-security-intelligence/2017/11/)\n[Posted in:Bad Sites, Targeted Attacks](http://blog.trendmicro.com/trendlabs-security-intelligence/category/bad-websites/)\nAuthor:\n[Trend Micro](http://blog.trendmicro.com/trendlabs-security-intelligence/author/trend-micro/)\n\n**_by MingYen Hsieh, CH Lei, and Kawabata Kohei_**\n\nA few months ago, we covered the [ChessMaster cyberespionage campaign, which leveraged a variety of](http://blog.trendmicro.com/trendlabs-security-intelligence/chessmaster-cyber-espionage-campaign/)\ntoolsets and malware such as ChChes and remote access trojans like RedLeaves and PlugX to compromise its\ntargets—primarily organizations in Japan. A few weeks ago, we observed new activity from ChessMaster,\nwith notable evolutions in terms of new tools and tactics that weren’t present in the initial attacks. From what\nwe’ve seen, ChessMaster is continuously evolving, using open source tools and ones they developed, likely\nas a way to anonymize their operations. Based on the way the campaign has developed, it won’t be surprising\nto see additional evolutions from ChessMaster in the future.\n\n**Infection Vector**\n\n\n-----\n\nHere is a summary of how ChessMaster enters a target system:\n\n1. An exploit document arrives on a target system. This document abuses a SOAP WSDL parser\n\n[vulnerability (CVE-2017-8759) that affects the Microsoft .NET Framework](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-8759)\n2. It then accesses the remote server 89[.]18[.]27[.]159/img.db\n3. Once the victim opens the document, the attacker can execute arbitrary commands on the victim’s\n\nmachine.\n4. The exploit document then launches mshta.exe to access 89[.]18[.]27[.]159:8080/lK0RS, which serves\n\nas the first backdoor into the system\n5. This backdoor launches a malicious PowerShell script\n6. The PowerShell script downloads and activates the malware located in the remote server\n\n89[.]18[.]27[.]159/FA347FEiwq.jpg\n7. jpg is the second backdoor, which uses the Command-and-Control (C&C) server62[.]75[.]197[.]131.\n\nAs mentioned earlier, the first step of the new campaign involves the use of an exploit document that\nconnects to the remote server 89[.]18[.]27[.]159/img.db when opened. Img.db holds the exploit command,\nwhich will execute the content of another remote server, 89[.]18[.]27[.]159:8080/lK0RS, via mhsta.exe.\n\nThe image below shows the malicious link 89[.]18[.]27[.]159/img.db embedded in the exploit document:\n\n_Figure 2. Link embedded in the document_\n\n89[.]18[.]27[.]159:8080/lK0RS is a JScript backdoor, which apparently comes from an open source RAT\nknown as “Koadic.”\n\nAt this stage, we observed that the attacker tried to gather the system’s environment information via\ncommand line tools. We also observed that some commands were based on the result of a previous command,\nwhich means that not all parts of the attack were automated and that parts of the commands were done\nmanually. While this might be a sign of a more sophisticated automation technique, we believe that this may\nbe an attacker trying to get up close and personal by manually checking the environment before delivering\nthe final payload. It is possible that this was done to avoid sandboxing or analysis by researchers.\n\nWhile we were not able to gather the actual live data of the next step of the attack, we were able to observe\nKoadic and the following script, which tries to download another DLL file from the same server that hosts\nKoadic, at the same time. We believe that FA347FEiwq.jpg serves as the final payload of this attack.\n\n\n-----\n\n_Figure 3: PowerShell script used to download & execute FA347FEiwq.jpg_\n\nThe script attempts to download the file from 89[.]18[.]27[.]159/FA347FEiwq.jpg (detected by Trend Micro\nas BKDR_ANEL.ZKEI), a DLL file which serves as the second backdoor. The Powershell script leverages\nRegisterXLL, which is a component of Excel, to load BKDR_ANEL into Excel.exe\n\n_Figure 4: FA347FEiwq.jpg is loaded by Excel.exe_\n\n**Backdoor Analysis**\n\nBKDR_ANEL is downloaded from89[.]18[.]27[.]159. Once loaded onto the system, it will launch and inject\ncode into svchost.exe, after which the injected code decrypts and activates the embedded backdoor.\nBKDR_ANEL has a Microsoft signature attached—the signature is invalid and likely added to make it seem\nmore harmless.\n\nThe backdoor has a hardcoded malware version labeled “5.0.0 beta1” that contains basic backdoor routines\nwith a string-like “Function not implemented.” inside. The relatively incomplete code might be a clue of a\nnew variant in the future.\n\nThe malware’s C&C protocol is very similar to the one used by BKDR_CHCHES at first glance:\n\n_Figure 5: Comparison of BKDR_ANEL and BKDR_CHCHES’ C&C protocols_\n\nHowever they are different backdoors, with BKDR_CHCHES employing RC4 as its main encryption\nalgorithm wherein the decryption key is sent with the encrypted information separated by “=” and set in the\n\n\n-----\n\nobviously labeled as this is the encrypt key.\n\nAnother difference between the two is that BKDR_CHCHES does not contain any backdoor routines by\ndefault. Instead, it loads additional modules from the C&C server directly into memory. Alternatively,\nBKDR_ANEL is more like a regular backdoor embedded with basic backdoor routines.\n\nThe image and table below illustrate the information BKDR_ANEL sends, and how BKDR_ANEL encrypts\nthe information.\n\n_Figure 6: Information sent by BKDR_ANEL (1/2)_\n\n**Offset** **Description** **Example in previous figure**\n\n0x0 Process ID 78 0C 00 00\n\n20 C4 36 1D 03 2F 93 B8\n\nMD5(computer name +\n0x4\nmachine GUID) C7 A0 01 9A EB 2B BD EF\n\n0x14 Computer name TEST\n\n0x20 Timestamp 1508201270\n\n0x2a OS version 5.1.2600\n\n0x3a User name Administrator\n\n00 00 00 00 => – (Bias / 60)\n\n00 00 00 00 => – (Bias % 60)\n\n0x47 Time zone information\n\n01 00 00 00 => Has DaylightBias\nor not\n\n\n0x53 Current directory\n\n\nC:\\Documents and\nSettings\\Administrator\\My\nDocuments\n\n\n0x87 Backdoor version 5.0.0 beta1\n\n_Table 1: Information sent by BKDR_ANEL (2/2)_\n\n\n-----\n\n_Figure 7: BKDR_ANEL encryption process_\n\nThe information blocks are separated by “&”. As seen in the image above; the string before “=” in each\nblock, such as “oVG,” is not used.\n\nFurther similarities between BKDR_ANEL and BKDR_CHCHES can be seen in special partial MD5 logic.\nBoth malware only uses the middle 8 bytes from the regular MD5 result. BKDR_CHCHES will use it to\nencrypt the network traffic, while BKDR_ANEL uses it as a code branch in the malware encryption routine,\nalthough from our analysis, it does not look like it is currently in use.\n\n**Mitigation**\n\nTo combat campaigns like ChessMaster, organizations need to make full use of the tools available to them.\nThis includes everything from regularly updating their systems to the latest patches, which minimizes the\nimpact of attacks that leverage vulnerabilities. In addition, the proper use of behavior monitoring, application\n[control, email gateway monitoring, and intrusion/detection systems can help detect any suspicious activities](https://www.trendmicro.com/vinfo/us/security/news/cybercrime-and-digital-threats/infosec-guide-email-threats)\nthat occur within the network. Finally, organizations need to cultivate a culture of security to educate users on\nwhat to look out for in terms of potential attacks, as end users are often the primary target of these kinds of\ncampaigns.\n\nOrganizations can also strengthen their security by employing solutions such as [Trend Micro™](https://www.trendmicro.com/us/enterprise/cloud-solutions/deep-security/index.html) Vulnerability\nProtection™, which protects endpoints from threats that exploit vulnerabilities via a high-performance engine\nmonitors traffic for new specific vulnerabilities that uses host-based intrusion prevention system (IPS) filters\nas well as zero-day attack monitoring.\n\nIn addition, comprehensive security solutions can be used to protect organizations from attacks. These\ninclude Trend Micro endpoint solutions such as [Trend Micro™](http://www.trendmicro.com/us/business/complete-user-protection/index.html) [Smart Protection Suites, and](http://www.trendmicro.com/us/business/complete-user-protection/index.html) WorryFree™ [Business Security, which can protect users and businesses from these threats by detecting malicious](http://www.trendmicro.com/us/small-business/product-security/)\nfiles, well as blocking all related malicious URLs. [Trend Micro](http://www.trendmicro.com/us/enterprise/security-risk-management/deep-discovery/) [Deep Discovery™ has an email inspection](http://www.trendmicro.com/us/enterprise/security-risk-management/deep-discovery/)\nlayer that can protect enterprises by detecting malicious attachment and URLs.\n\n[Trend Micro](http://www.trendmicro.com/us/enterprise/product-security/officescan/) [OfficeScan™ with](http://www.trendmicro.com/us/enterprise/product-security/officescan/) [XGen™ endpoint security infuses high-fidelity machine learning with other](http://www.trendmicro.com/us/business/xgen/index.html)\ndetection technologies and global threat intelligence for comprehensive protection against all kinds of threats.\n\n**Indicators of Compromise:**\n\n\n-----\n\n_Command-and-control server:_\n\nhxxp://62[.]75[.]197[.]131/page/?[random strings]\n\n_URLs related to the campaign_\n\nhxxp://89[.]18[.]27[.]159/img.db\nhxxp://89[.]18[.]27[.]159:8080/lK0RS\nhxxp://89[.]18[.]27[.]159/FA347FEiwq.jpg\n\n**Share**\n**Tweet**\n**Share**\n**Share**\n**Mail**\n\n## Related Posts:\n\n**[ChessMaster Makes its Move: A Look into the Campaign’s Cyberespionage Arsenal](http://blog.trendmicro.com/trendlabs-security-intelligence/chessmaster-cyber-espionage-campaign/)**\n**[New Malicious Macro Evasion Tactics Exposed in URSNIF Spam Mail](http://blog.trendmicro.com/trendlabs-security-intelligence/new-malicious-macro-evasion-tactics-exposed-ursnif-spam-mail/)**\n\n\nLearn how to protect Enterprises, Small Businesses, and Home Users from ransomware:\n\n[ENTERPRISE](http://www.trendmicro.com/us/security-intelligence/enterprise-ransomware/index.html) » [SMALL BUSINESS](http://www.trendmicro.com/us/security-intelligence/small-business-ransomware/index.html) » [HOME](http://www.trendmicro.com/us/home/consumer-ransomware/index.html) »\n\n\nTags: [ChessMaster](http://blog.trendmicro.com/trendlabs-security-intelligence/tag/chessmaster/)\n\n\n-----\n\n Recommend\n\n\n### ⤤ Share Sort by Best\n\n\n### Start the discussion…\n\n\n**LOG IN WITH**\n**OR SIGN UP WITH DISQUS**\n\n\nName\n\n\nBe the first to comment.\n\n✉ **Subscribe** d **[Add Disqus to your siteAdd DisqusAdd](https://publishers.disqus.com/engage?utm_source=trendlabs&utm_medium=Disqus-Footer)** � **[Privacy](https://disqus.com/)**\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2017/2017.11.06.ChessMaster_New_Strategy/chessmasters-new-strategy-evolving-tools-tactics.pdf"
    ],
    "report_names": [
        "chessmasters-new-strategy-evolving-tools-tactics"
    ],
    "threat_actors": [],
    "ts_created_at": 1666716499,
    "ts_updated_at": 1743041124,
    "ts_creation_date": 1510043854,
    "ts_modification_date": 1510043854,
    "files": {
        "pdf": "https://archive.orkl.eu/7c2f93f1fbe764ff94de5e5d5f29daea4a512956.pdf",
        "text": "https://archive.orkl.eu/7c2f93f1fbe764ff94de5e5d5f29daea4a512956.txt",
        "img": "https://archive.orkl.eu/7c2f93f1fbe764ff94de5e5d5f29daea4a512956.jpg"
    }
}