{
    "id": "11b7efce-f896-4141-85bb-a60d1e8f3269",
    "created_at": "2023-01-12T15:04:06.018208Z",
    "updated_at": "2025-03-27T02:15:39.3837Z",
    "deleted_at": null,
    "sha1_hash": "5594281fdcd90ef0030911510f00dd02c3c3eb7d",
    "title": "2020-03-27 - The First Stage of ShadowHammer",
    "authors": "",
    "file_creation_date": "2022-05-28T17:33:43Z",
    "file_modification_date": "2022-05-28T17:33:43Z",
    "file_size": 632313,
    "plain_text": "# The First Stage of ShadowHammer\n\n**norfolkinfosec.com/the-first-stage-of-shadowhammer/**\n\nnorfolk March 27, 2019\n\n[On 25 March, Kaspersky researchers published details of a supply chain compromise](https://securelist.com/operation-shadowhammer/89992/)\ninvolving ASUS, a Taiwan-based computer manufacturer. As part of this compromise, a\nthreat actor pushed malicious code to victims who connected to the company’s servers using\nthe ASUS Live Update feature used to deliver drivers and other updates (this blog notes that\nsuch update platforms are common across all manufacturers).\n\nThe malicious code in question is a first-stage triage tool, and details of the second-stage\ncode have not yet been uncovered. This post documents this first-stage functionality of one\nof the identified variants, which compares the victim’s MAC address to a hardcoded list prior\nto communicating with a C2.\n**Malware Workflow**\n\nKaspersky provided a malicious hash in its original blog post; however, pivoting using\n[content from a tweet from Costin Raiu yields additional files. Examination of these files](https://twitter.com/craiu/status/1110180467272232961)\n(either through the VirusTotal platform or manually) indicates that they come in pairs: the\nsmaller executables are hardcoded resources within the larger executables. A full hash list is\navailable at the end of this post, and the hash used for this analysis is below.\n\nMD5: fa83ffde24f149f9f6d1d8bc05c0e023\n\nSHA1: b0127ce307589ef48e2658784dd83ef7aa26097b\n\nSHA256: c299b6dd210ab5779f3abd9d10544f9cae31cd5c6afc92c0fc16c8f43def7596\n\nAt the start of the malicious workflow for this code, the program dynamically resolves the\nLoadLibraryEx and GetProcAddress calls, which are in turn used to load additional APIs,\nincluding:\n\n\n-----\n\n– memcpy (ntdll)\n– memcmp (ntdll)\n– memset (ntdll)\n– MD5Init (ntdll)\n– MD5Update (ntdll)\n– MD5Final (ntdll)\n– GetAdaptersAddresses (iphlpapi)\n– InternetOpenA (wininit)\n– InternetOpenURLA (wininit)\n– InternetQueryDataAvailable (wininit)\n– InternetReadFile (wininit)\n\nThe malware then begins allocating large sections of code to memory and begins the triage\nprocess. The first function in this workflow queries the device’s network adapters through the\nGetAdaptersAddresses API call resolved above. The network adapter information is\nallocated into memory. Using the MD5 Init, Update, and Final calls, the malware calculates\nan MD5 hash of each adapter’s MAC address and stores this in memory for later\n[comparison. Documentation for these functions can be found here.](http://manpages.ubuntu.com/manpages/xenial/man3/md5.3bsd.html)\n\nThis workflow is shown below- the orange represents the parameters for the MD5Update\ncall, one of which is the address highlighted in blue of the stored MAC address.\n\nAfter these hash values are calculated and stored, the program compares them to a\nhardcoded set of MD5s. This step determines whether or not the malware will call out to its\nC2. By performing comparisons of the hashes of these values rather than the values\nthemselves, the malware author increases the difficulty of identifying potential targets.\n\n\n-----\n\nAt a high level, if no match is found, the C2 routine is bypassed and the malware terminates\nshortly thereafter. A lower-level workflow for this is shown below:\n\nShould a match be found, the “test eax eax” instruction will not set the zero flag, preventing\nthe malware from jumping over the function and initiating the C2 call-out for the next\n(currently undisclosed) stage of activity:\n\n**Additional Indicators**\n\nC2\n\nasushotfix[.]com\n\nHashes\n\n\n-----\n\nMD5\n17a36ac3e31f3a18936552aff2c80249\nfa83ffde24f149f9f6d1d8bc05c0e023\nf2f879989d967e03b9ea0938399464ab\n5855ce7c4a3167f0e006310eb1c76313\n2a95475af7a07ee95ab11caad9e99b0c\ncb3f78d3ff776a7afe6c56371b0c7e11\n\nSHA1\n5039ff974a81caf331e24eea0f2b33579b00d854\nb0127ce307589ef48e2658784dd83ef7aa26097b\n2c591802d8741d6aef1a278b9aca06952f035b8f\n0d9d48a4545120d84df6614378456ad722d82f58\n0595e34841bb3562d2c30a1b22ebf20d31c3be86\nffdb4f49a96f382161907ea21146332d2defb7b5\n\nSHA256\nbca9583263f92c55ba191140668d8299ef6b760a1e940bddb0a7580ce68fef82\nc299b6dd210ab5779f3abd9d10544f9cae31cd5c6afc92c0fc16c8f43def7596\n6aedfef62e7a8ab7b8ab3ff57708a55afa1a2a6765f86d581bc99c738a68fc74\ncfbec77180bd67cceb2e17e64f8a8beec5e8875f47c41936b67a60093e07fcfd\nac0711afee5a157d084251f3443a40965fc63c57955e3a241df866cfc7315223\n9acd43af36f2d38077258cb2ace42d6737b43be499367e90037f4605318325f8\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-03-27 - The First Stage of ShadowHammer.pdf"
    ],
    "report_names": [
        "2020-03-27 - The First Stage of ShadowHammer.pdf"
    ],
    "threat_actors": [
        {
            "id": "1c97ccfd-1888-492c-b7b9-bb52c4c3809b",
            "created_at": "2023-01-06T13:46:38.940529Z",
            "updated_at": "2025-03-27T02:00:02.957652Z",
            "deleted_at": null,
            "main_name": "Operation ShadowHammer",
            "aliases": [],
            "source_name": "MISPGALAXY:Operation ShadowHammer",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "c7d9878a-e691-4c6f-81ae-84fb115a1345",
            "created_at": "2022-10-25T16:07:23.359506Z",
            "updated_at": "2025-03-27T02:02:09.752427Z",
            "deleted_at": null,
            "main_name": "APT 41",
            "aliases": [
                "BrazenBamboo",
                "Bronze Atlas",
                "Double Dragon",
                "Earth Baku",
                "Grayfly",
                "Operation ColunmTK",
                "Operation CuckooBees",
                "Operation ShadowHammer",
                "Red Kelpie",
                "SparklingGoblin",
                "TA415",
                "TG-2633"
            ],
            "source_name": "ETDA:APT 41",
            "tools": [
                "9002 RAT",
                "ADORE.XSEC",
                "ASPXSpy",
                "ASPXTool",
                "AceHash",
                "Agent.dhwf",
                "Agentemis",
                "AndroidControl",
                "AngryRebel",
                "AntSword",
                "BIOPASS",
                "BIOPASS RAT",
                "BLUEBEAM",
                "Barlaiy",
                "BlackCoffee",
                "Bladabindi",
                "BleDoor",
                "CCleaner Backdoor",
                "CHINACHOPPER",
                "COLDJAVA",
                "China Chopper",
                "ChyNode",
                "Cobalt Strike",
                "CobaltStrike",
                "Crackshot",
                "CrossWalk",
                "CurveLast",
                "CurveLoad",
                "DAYJOB",
                "DBoxAgent",
                "DEADEYE",
                "DEADEYE.APPEND",
                "DEADEYE.EMBED",
                "DEPLOYLOG",
                "DIRTCLEANER",
                "DUSTTRAP",
                "Derusbi",
                "Destroy RAT",
                "DestroyRAT",
                "DodgeBox",
                "DragonEgg",
                "ELFSHELF",
                "EasyNight",
                "Farfli",
                "FunnySwitch",
                "Gh0st RAT",
                "Ghost RAT",
                "HDD Rootkit",
                "HDRoot",
                "HKDOOR",
                "HOMEUNIX",
                "HUI Loader",
                "HidraQ",
                "HighNoon",
                "HighNote",
                "Homux",
                "Hydraq",
                "Jorik",
                "Jumpall",
                "KEYPLUG",
                "Kaba",
                "Korplug",
                "LATELUNCH",
                "LOLBAS",
                "LOLBins",
                "LightSpy",
                "Living off the Land",
                "Lowkey",
                "McRAT",
                "MdmBot",
                "MessageTap",
                "Meterpreter",
                "Mimikatz",
                "MoonBounce",
                "MoonWalk",
                "Motnug",
                "Moudour",
                "Mydoor",
                "NTDSDump",
                "PACMAN",
                "PCRat",
                "PINEGROVE",
                "PNGRAT",
                "POISONPLUG",
                "POISONPLUG.SHADOW",
                "POTROAST",
                "PRIVATELOG",
                "PipeMon",
                "PlugX",
                "PortReuse",
                "ProxIP",
                "ROCKBOOT",
                "RbDoor",
                "RedDelta",
                "RedXOR",
                "RibDoor",
                "Roarur",
                "RouterGod",
                "SAGEHIRE",
                "SPARKLOG",
                "SQLULDR2",
                "STASHLOG",
                "SWEETCANDLE",
                "ScrambleCross",
                "Sensocode",
                "SerialVlogger",
                "ShadowHammer",
                "ShadowPad Winnti",
                "SinoChopper",
                "Skip-2.0",
                "SneakCross",
                "Sogu",
                "Speculoos",
                "Spyder",
                "StealthReacher",
                "StealthVector",
                "TERA",
                "TIDYELF",
                "TIGERPLUG",
                "TOMMYGUN",
                "TVT",
                "Thoper",
                "Voldemort",
                "WIDETONE",
                "WINNKIT",
                "WINTERLOVE",
                "Winnti",
                "WyrmSpy",
                "X-Door",
                "XDOOR",
                "XMRig",
                "XShellGhost",
                "Xamtrav",
                "ZXShell",
                "ZoxPNG",
                "certutil",
                "certutil.exe",
                "cobeacon",
                "gresim",
                "njRAT",
                "pwdump",
                "xDll"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535846,
    "ts_updated_at": 1743041739,
    "ts_creation_date": 1653759223,
    "ts_modification_date": 1653759223,
    "files": {
        "pdf": "https://archive.orkl.eu/5594281fdcd90ef0030911510f00dd02c3c3eb7d.pdf",
        "text": "https://archive.orkl.eu/5594281fdcd90ef0030911510f00dd02c3c3eb7d.txt",
        "img": "https://archive.orkl.eu/5594281fdcd90ef0030911510f00dd02c3c3eb7d.jpg"
    }
}