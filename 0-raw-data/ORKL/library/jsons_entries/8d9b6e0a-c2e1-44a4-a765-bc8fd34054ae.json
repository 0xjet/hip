{
    "id": "8d9b6e0a-c2e1-44a4-a765-bc8fd34054ae",
    "created_at": "2023-01-12T15:04:03.559791Z",
    "updated_at": "2025-03-27T02:06:11.495549Z",
    "deleted_at": null,
    "sha1_hash": "bc0638338e33cc190a17d10d90abc38035bfa26b",
    "title": "2022-03-30 - New Wave Of Remcos RAT Phishing Campaign",
    "authors": "",
    "file_creation_date": "2022-05-27T22:56:04Z",
    "file_modification_date": "2022-05-27T22:56:04Z",
    "file_size": 2890381,
    "plain_text": "# New Wave of Remcos RAT Phishing Campaign\n\n**[blog.morphisec.com/remcos-trojan-analyzing-attack-chain](https://blog.morphisec.com/remcos-trojan-analyzing-attack-chain)**\n\nPosted by [Hido Cohen on March 30, 2022](https://blog.morphisec.com/author/hido-cohen)\n\n[Tweet](https://twitter.com/share)\n\n\n-----\n\nMorphisec Labs has detected a new wave of Remcos trojan infection. The theme of the\nphishing emails is again financial, this time as payment remittances sent from financial\ninstitutions. The attacker lures a user to open a malicious Excel file that contains “confidential\ninformation” which starts the infection chain.\n\nMorphisec’s analysis has identified several services used for these phishing campaigns.\nThey include Wells Fargo, FIS Global, and ACH Payment notifications. For example:\n\nFigure 1: Email from Wells Fargo’s CEO with a malicious attachment\n\nThis infection contains many stages and largely depends on the C2 server, which stores the\nrequired files for each stage.\n\n\n-----\n\nFigure 2: All stages stored in the C2.\n\nThe attacker also uses a password-protected .xls file to lower the detection rate. The\npassword is in the phishing email, and as we can see—password protection helps:\n\nFigure 3: The malicious attachment and first stage detection rate\n\nIn this blog post, we analyze the full attack chain used by the attacker and explain how each\nstep works.\n\n## What is the Remcos Trojan?\n\n[Remcos is a commercial remote access trojan (RAT) developed by BreakingSecurity.](https://breakingsecurity.net/remcos/)\nRemcos has many capabilities, and a free version downloadable directly from\n[BreakingSecurity’s website Morphisec has previously covered Remcos as the payload in](https://blog.morphisec.com/guloader-the-rat-downloader)\n\n\n-----\n\n[Guloader, and the payload in the Babadeda crypter.](https://blog.morphisec.com/guloader-the-rat-downloader)\n\nThe Remcos trojan allows attackers to quickly and easily control an infected computer, steal\npersonal information, and surveil a victim’s activity. All this without investing time in\ndeveloping a tool with remote administration capabilities.\n\n## The Infection Chain\n\nFigure 4: Infection chain steps\n\nThe .xls file writes and executes a new .vbs file. The code inside the file executes a\nPowerShell command that downloads another .vbs file from a remote server. Once\ndownloaded and saved on the disk, PowerShell executes the file. Next, the newly\ndownloaded .vbs file connects to the C2 server again and fetches an encoded PowerShell\ncommand. This PowerShell code is responsible for downloading the next stage and\ndecoding it. This stage contains a .NET injector and the final payload. After decoding, the\nPowerShell initiates the injector that introduces the final payload, known as Remcos RAT.\n\n## Technical Analysis\n\n\n-----\n\n**Analyzed Sample**\n\n**.xls: 8740cdcef9e825fd5105b021e0616a1d6a41f761c92f29127cd000c8500f70e6**\n\n### First Stage: .xls\n\nSteps 2-3 in Figure 4\n\nFigure 5: The malicious .xls file\n\nThe .xls file contains a Visual Basic code that executes once a user opens the file and\nenables macros. Looking inside the file reveals the logic behind the script.\n\n\n-----\n\nFigure 6: Main VB function\n\nFirst, the .vbs reads the PowerShell command that is written to F variable, a\nFileSystemObject CLSID to F2, and a second CLSID (Shell.Application) to F3. Next it\ncreates a new file inside %AppData% using the CLSID object located inside F2. Finally, it\nwrites F to that file and calls the function that executes it. It does so by creating a\nShell.Application object using the second CLSID loaded and runs the newly created\nQAITB.vbs file.\n\n### Second Stage: .vbs Executes PowerShell Downloader\n\nSteps 3-5 in Figure 4\n\nInside QAITB.vbs is a reversed PowerShell command which downloads the next stage and\nsaves it to disk.\n\n\n-----\n\nFigure 7: .vbs downloader\n\nThe malware uses Shell.Application CLSID again to execute the PowerShell command. The\nPowerShell command downloads the file from 209.127.19[.]101/win.vbs in this case, and\nsaves it inside %Temp%\\harvest.vbs which also deletes the previous file at\n%APPDATA%\\QAITB.vbs. (See the IOCs section for more.)\n\n### Third Stage: Another.vbs Downloader\n\nSteps 6-7 in Figure 4\n\nThe malware continues to communicate with its C2 server, requesting more files. This time\nthe file request is made by harvest.vbs. This .vbs file is responsible for two things:\n\n1. Setting persistence by copying the script file to the Startup folder.\n\nFigure 8: Set persistence by copying the script to the Startup folder\n\n2. Downloading the next stage from the C2 server.\n\n\n-----\n\nFigure 9: Download and execute the next stage\n\nThe malware uses InternetExplorer class to create a hidden new IE window that navigates to\na URL. It then extracts the command located in InnerText.\n\nThe next stage is executed using the same Shell.Application CLSID as before:\n\nFigure 10: Powershell execution from .vbs\n\nWhich translates to:\n\nGetObject(\"new:13709620-C279-11CE-A49E-444553540000\").ShellExecute powershell\n<command>\n\n### Fourth Stage: Encoded Powershell\n\n\n-----\n\nSteps 8-9 in Figure 4\n\nThe downloaded PowerShell command is another encoded command that translates to:\n\nFigure 11: Decoded PowerShell command\n\nWhere g is an alias for IEX.\n\nThis command checks if the machine has an internet connection by pinging google.com. If\nso, it communicates with the C2 server again. The next stage is another PowerShell\ncommand executed using IEX.\n\n### Fifth Stage: Powershell Unzips Injector and FInal Payload\n\nSteps 10-11 in Figure 4\n\nThis stage uses two large GZipped archives and extracts them. The first blob is a .NET\ninjector. The second is the final payload injected into the target process.\n\nThe important commands in this stage are:\n\nFigure 12: Final payload injector execution\n\nThe malware loads the extracted data located inside $JtpgNId. This is the injector. Once the\ninjector is loaded into memory, the malware calls a toooyou.Black function that injects the\npayload into RegAsm.exe.\n\n### FInal Payload\n\nAt this point we get the final payload, a Remcos RAT.\n\n\n-----\n\nFigure 13: Remcos RAT agent initialized message\n\nIn this case the configuration of the Remcos trojan is stored as a resource named\nSETTINGS. It is RC4 encrypted. We can extract the configuration by decrypting it using the\nfollowing steps:\n\n1. Read the first byte in the resource—this is the key length.\n2. Read the next <key_length> bytes—this is the key.\n3. Read the rest of the data—this is the encrypted section.\n4. RC4 decrypt the encrypted section using the key.\n\nAfter extracting the configuration, we can find where the stolen data was sent to:\n\nFigure 14: Remcos decrypted configuration\n\nThis sample communicates with freshdirect.dvrlists[.]com:119.\n\n## How Do You Stop a Remcos Trojan?\n\nA Remcos RAT is just the final component of a lengthy and sophisticated attack chain\n[delivery process. Such attacks use advanced defense evasion techniques to sneak past](https://attack.mitre.org/tactics/TA0005/)\ncybersecurity solutions. These techniques include disabling or uninstalling security tools, and\nobfuscating or encrypting data and scripts. According to the latest Picus report, defense\n[evasion is now the most popular tactic among malware operators](https://www.picussecurity.com/resource/blog/red-report-2021-top-ten-attack-techniques)\n\n\n-----\n\nMorphisec s patented Moving Target Defense is the best on the market for preventing\ndefense evasion techniques. Unlike other cybersecurity solutions which focus on detecting\nknown patterns with response playbooks, Morphisec MTD preemptively blocks attacks on\nmemory and applications and remediates the need for response. To find out more about\nMorphisec’s revolutionary Moving Target Defense technology, read the white paper: Zero\n_[Trust + Moving Target Defense: Stopping Ransomware, Zero-Day, and Other Advanced](https://engage.morphisec.com/the-ultimate-ransomware-strategy)_\n_Threats Where NGAV and EDR Are Failing._\n\n### Indicators of Compromise (IOCs)\n\n**Emails**\n\nc221b6eb8437d1f43ebffae9e51c7d330016290d048cfff2f402a7508b1e16e3\n\n8740cdcef9e825fd5105b021e0616a1d6a41f761c92f29127cd000c8500f70e6\n\n6d9d1de4f4ea0e4aeb553458f4cea2af1a2554fe84c952b367ed5eb753990fc7\n\n342bad5211bf3c8af50e263334bb90b580d71220e6b16597ba7bdd6f404e4215\n\nb5833f95871ced64f48649b55e075e85c1c595f4af8522082c8e3ef72917ae80\n\na2cffc70c2b63baa3ada0b916b778996204bd3b7a91eab66757b4343888eec3f\n\n1a5b5299afb0c657e2141aaf46600c6ca91ca80840d65fb3b5afb53a99069e53\n\n**XLSs**\n\n6ad5d2aae0cb58f943f39d8b43492fd6007cd8caeeaaea03013194572756b124\n\n85c4808b3ed64480ae0d9f5c6fdaade6c7298f89cb4b799f0d5510b674d0a367\n\ndc88c4ddc7f428a266cf619d4d5367fa10a86c2c7fc18a359eb8d9d264437111\n\n26bd031cb4a5333bbd77698f5aaf737cb108b4b9d30670d92218a8c31ec0abc7\n\n5115b590c285b437f5d432b1ca0ad8ee8ba89afedd7a5228d8d79e20e6ec84d8\n\n77268e599a7bee74da06206f33c4725e262627d88123c7920e6aab9d9473a1c0\n\n**XLSs .vbs**\n\n\n-----\n\ne0306366dd9c04bc92421d855a116d145e4b9afe4852bc77a02089d363d031a4\n\n1e7dba5f19588eeceffb45e96f4673ce181d64392805c5a78e83ae8c15d42d61\n\na954043909b90d12ab1659e2d28adb236b4ac521084282448757f7b1fd8d8b05\n\n6f2e30793f43ea5b71f5609fa508acf595393d1a3e2ac2a9e8205228e0c50fe8\n\n128971c9ae22f36db1074ff2e93c2adb07c21eb3e5c139d501e06ef29bf28b97\n\n3f54c5f1cf53bb9a87aabdd0847c3506aebda16e5c384ab2d939264541e214e9\n\n70a1064fee27885c8d3caa5c18e0c08609c50ecdaa8e0ee2b9ce5c97a6df21f1\n\ne646ad0c447c477004947aa49154c9d1cf1013769332f76aa46bc230ae286d1c\n\nc04840608386221e34ec81c5e9875e6e77cbdbf3acd63e76e338a1ad5ccf8da5\n\n1cb0c04eefe74736dc16b418e01fa7d61753992bc4898fe3600f61d648e64e1c\n\nda546ce81e022979c8dc7942667e57aa605b11cae9eb20d917df63cad75d4ec3\n\nf3ef4e8e91f7558a6e86f4001e0fc78defeaafe0298263a8f3bd62a451e45c5e\n\n**URLs**\n\n\n-----\n\nhxxp://kingspalmhomes[.]com/wprl/Protected Client.vbs\n\nhxxp://kingspalmhomes[.]com/admin/Protected Client.vbs\n\nhxxp://kingspalmhomes[.]com/wprl/Protected.vbs\n\nhxxp://kingspalmhomes[.]com/admin/Protected Client.vbs\n\nhxxp://kingspalmhomes[.]com/product/Protected.vbs\n\nhxxp://fisintegrateds[.]com/zp-admin/Protected Client.vbs\n\nhxxp://fisintegrateds[.]com/zp-admin/Protected Client.vbs\n\nhxxp://gotovacoil[.]com/created/Protected Client.vbs\n\nhxxp://gotovacoil[.]com/newfolder/Protected Client.vbs\n\nhxxp://dreamwatchevent[.]com/wsalptza/Client.vbs\n\nhxxp://dreamwatchevent[.]com/zp-user/Protected Client.vbs\n\nhxxp://209.127.19[.]101/win.vbs\n\nhxxp://209.127.19[.]101/pit.txt\n\nhxxp://209.127.19[.]101/kif.jpg\n\n**Domains**\n\nfisintegrateds[.]com\n\nkingspalmhomes[.]com\n\ngotovacoil[.]com\n\ndreamwatchevent[.]com\n\n209.127.19[.]101\n\n**Final Payload (Remcos)**\n\n\n-----\n\n79AD11D52EA3D0BD956CAD871396C8DA2C9A76FFFC02E694339B7FE8B6CE18EA\n\n401D142905E2253E7E38CC7E275A09A4A0F45AE73F15748EA69C1F6CB0591A81\n\nCFD29C1AC568E0A21B5F2C05B96BB5BBF2848E89BD6DBDDF4C69DAB3B1CD8A32\n\n79AD11D52EA3D0BD956CAD871396C8DA2C9A76FFFC02E694339B7FE8B6CE18EA\n\nCFD29C1AC568E0A21B5F2C05B96BB5BBF2848E89BD6DBDDF4C69DAB3B1CD8A32\n\n**Remcos C2s**\n\nshiestynerd[.]dvrlists[.]com\n\nbreakingsecurity[.]dvrlists[.]com\n\nfreshdirect[.]dvrlists[.]com\n\n[Contact SalesInquire via Azure](http://10.10.0.46/mailto:sales@morphisec.com)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-03-30 - New Wave Of Remcos RAT Phishing Campaign.pdf"
    ],
    "report_names": [
        "2022-03-30 - New Wave Of Remcos RAT Phishing Campaign.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535843,
    "ts_updated_at": 1743041171,
    "ts_creation_date": 1653692164,
    "ts_modification_date": 1653692164,
    "files": {
        "pdf": "https://archive.orkl.eu/bc0638338e33cc190a17d10d90abc38035bfa26b.pdf",
        "text": "https://archive.orkl.eu/bc0638338e33cc190a17d10d90abc38035bfa26b.txt",
        "img": "https://archive.orkl.eu/bc0638338e33cc190a17d10d90abc38035bfa26b.jpg"
    }
}