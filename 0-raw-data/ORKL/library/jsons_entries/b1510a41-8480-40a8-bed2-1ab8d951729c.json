{
    "id": "b1510a41-8480-40a8-bed2-1ab8d951729c",
    "created_at": "2022-10-25T16:48:11.552965Z",
    "updated_at": "2025-03-27T02:09:54.997054Z",
    "deleted_at": null,
    "sha1_hash": "40f76477ba1f453b341743b53113ebd705c1bb75",
    "title": "Regin: Top-Tier Espionage Tool Enables Stealthy Surveillance",
    "authors": "Symantec",
    "file_creation_date": "2014-11-24T10:40:49Z",
    "file_modification_date": "2014-11-24T10:40:51Z",
    "file_size": 3439105,
    "plain_text": "### SECURITY RESPONSE\n\n# Regin: Top-tier espionage tool enables stealthy surveillance\n\n###### Symantec Security Response ﻿\n\n Version 1.0 – November 24, 2014\n\n#### Regin is an extremely complex piece of software that can be customized with a wide range of different capabilities that can be deployed depending on the target.\n\n\n-----\n\n### CONTENTS\n\n###### OVERVIEW...................................................................... 3 Introduction................................................................... 5 Timeline.......................................................................... 5 Target profile.................................................................. 6 Infection vector........................................................ 6 Architecture................................................................... 8 Stage 0 (dropper)..................................................... 9 Stage 1...................................................................... 9 Stage 2...................................................................... 9 Stage 3...................................................................... 9 Stage 4............................................................  11 Stage 5.................................................................... 11 Encrypted virtual file system containers ��������������11 Command-and-control operations......................... 12 Logging................................................................... 12 Payloads....................................................................... 14 64-bit version............................................................... 15 File names.............................................................. 15 Stage differences................................................... 15 Conclusion.................................................................... 16 Protection..................................................................... 16 Appendix...................................................................... 18 Data files................................................................ 18 Indicators of compromise............................................ 20 File MD5s................................................................ 20 File names/paths.................................................... 20 Extended attributes............................................... 21\n\n\n-----\n\n### OVERVIEW\n\n###### In the world of malware threats, only a few rare examples can truly be considered groundbreaking and almost peerless. What we have seen in Regin is just such a class of malware.\n\n Regin is an extremely complex piece of software that can be customized with a wide range of different capabilities which can be deployed depending on the target. It is built on a framework that is designed to sustain long-term intelligence-gathering operations by remaining under the radar. It goes to extraordinary lengths to conceal itself and its activities on compromised computers. Its stealth combines many of the most advanced techniques that we have ever seen in use.\n\n The main purpose of Regin is intelligence gathering and it has been implicated in data collection operations against government organizations, infrastructure operators, businesses, academics, and private individuals. The level of sophistication and complexity of Regin suggests that the development of this threat could have taken well-resourced teams of developers many months or years to develop and maintain.\n\n Regin is a multi-staged, modular threat, meaning that it has a number of components, each depending on others, to perform attack operations. This modular approach gives flexibility to the threat operators as they can load custom features tailored to individual targets when required. Some custom payloads are very advanced and exhibit a high degree of expertise in specialist sectors. The modular design also makes analysis of the threat difficult, as all components must be available in order to fully understand it. This modular approach has been seen in other sophisticated malware families such as Flamer and Weevil (The Mask), while the multi-stage loading architecture is similar to that seen in the Duqu/Stuxnet family of threats. \n\n Regin is different to what are commonly referred to as “traditional” advanced persistent threats (APTs), both in its techniques and ultimate purpose. APTs typically seek specific information, usually intellectual property. Regin’s purpose is different. It is used for the collection of data and continuous monitoring of targeted organizations or individuals. This report provides a technical analysis of Regin based on a number of identified samples and components. This analysis illustrates Regin’s architecture and the many\n\n\n-----\n\n### INTRODUCTION\n\n## Regin has a wide range of standard capabilities, particularly around monitoring targets and stealing data.\n\n\n-----\n\n#### Introduction\n\nRegin is a multi-purpose data collection tool which dates back several years. Symantec first began looking into\nthis threat in the fall of 2013. Multiple versions of Regin were found in the wild, targeting several corporations,\ninstitutions, academics, and individuals.\n\nRegin has a wide range of standard capabilities, particularly around monitoring targets and stealing data. It also\nhas the ability to load custom features tailored to individual targets. Some of Regin’s custom payloads point to a\nhigh level of specialist knowledge in particular sectors, such as telecoms infrastructure software, on the part of\nthe developers.\n\nRegin is capable of installing a large number of additional payloads, some highly customized for the targeted\ncomputer. The threat’s standard capabilities include several remote access Trojan (RAT) features, such as\ncapturing screenshots and taking control of the mouse’s point-and-click functions. Regin is also configured to\nsteal passwords, monitor network traffic, and gather information on processes and memory utilization. It can\nalso scan for deleted files on an infected computer and retrieve them. More advanced payload modules designed\nwith specific goals in mind were also found in our investigations. For example, one module was designed to\nmonitor network traffic to Microsoft Internet Information Services (IIS) web servers, another was designed\nto collect administration traffic for mobile telephony base station controllers, while another was created\nspecifically for parsing mail from Exchange databases.\n\nRegin goes to some lengths to hide the data it is stealing. Valuable target data is often not written to disk. In\nsome cases, Symantec was only able to retrieve the threat samples but not the files containing stolen data.\n\n#### Timeline\n\nSymantec is aware of two distinct versions of Regin. Version 1.0 appears to have been used from at least 2008 to\n2011. Version 2.0 has been used from 2013 onwards, though it may have possibly been used earlier.\n\nVersion 1.0 appears to have been abruptly withdrawn from circulation in 2011. Version 1.0 samples found after\nthis date seem to have been improperly removed or were no longer accessible to the attackers for removal.\n\nThis report is based primarily on our analysis of Regin version 1.0. We also touch on version 2.0, for which we\nonly recovered 64-bit files.\n\nSymantec has assigned these version identifiers as they are the only two versions that have been acquired. Regin\nlikely has more than two versions. There may be versions prior to 1.0 and versions between 1.0 and 2.0.\n\n\n-----\n\n#### Target profile\n\nThe Regin operators do not appear to\nfocus on any specific industry sector.\nRegin infections have been observed\nin a variety of organizations,\nincluding private companies,\ngovernment entities, and research\ninstitutes.\n\nInfections are also geographically\ndiverse, having been identified\nmainly in 10 different regions.\n\n##### Infection vector\n\nThe infection vector varies among\ntargets. A reproducible infection\nvector is unconfirmed at time of\nwriting. Targets may be tricked into\nvisiting spoofed versions of well-\nknown websites and the threat may\nbe installed through a web browser\nor by exploiting an application. On\none computer, log files show that\nRegin originated from Yahoo! Instant\nMessenger through an unconfirmed\nexploit.\n_Figure 1. Confirmed Regin infections by sector_\n\n_Figure 2. Confirmed Regin infections by country_\n\n\n-----\n\n### ARCHITECTURE\n\n## The initial Stage 1 driver is the only plainly visible code on the computer. All other stages are stored as encrypted data blobs...\n\n\n-----\n\n|Table 1. The six stages of Regin|Col2|\n|---|---|\n|Stages|Components|\n|Stage 0|Dropper. Installs Regin onto the target computer|\n|Stage 1|Loads driver|\n|Stage 2|Loads driver|\n|Stage 3|Loads compression, encryption, networking, and han- dling for an encrypted virtual file system (EVFS).|\n|Stage 4|Utilizes the EVFS and loads additional kernel mode drivers, including payloads.|\n|Stage 5|Main payloads and data files|\n\n\n#### Architecture\n\nRegin has a six-stage architecture. The initial _Table 1. The six stages of Regin_\nstages involve the installation and configuration\n\nStages Components\n\nof the threat’s internal services. The later stages\nbring Regin’s main payloads into play. This Stage 0 Dropper. Installs Regin onto the target computer\nsection presents a brief overview of the format\n\nStage 1 Loads driver\n\nand purpose of each stage. The most interesting\nstages are the executables and data files stored Stage 2 Loads driver\nin Stages 4 and 5. The initial Stage 1 driver is\n\nStage 3 Loads compression, encryption, networking, and han-\n\nthe only plainly visible code on the computer. All dling for an encrypted virtual file system (EVFS).\nother stages are stored as encrypted data blobs,\nas a file or within a non-traditional file storage Stage 4 Utilizes the EVFS and loads additional kernel mode\n\ndrivers, including payloads.\n\narea such as the registry, extended attributes, or\nraw sectors at the end of disk. Stage 5 Main payloads and data files\n\n_Figure 3. Regin’s architecture_\n\n\n-----\n\n##### Stage 0 (dropper)\n\nSymantec Security Response has not obtained the Regin dropper at the time of writing. Symantec believes that\nonce the dropper is executed on the target’s computer, it will install and execute Stage 1. It’s likely that Stage\n0 is responsible for setting up various extended attributes and/or registry keys and values that hold encoded\nversions of stages 2, 3, and potentially stages 4 and onwards. The dropper could be transient rather than acting\nas an executable file and may possibly be part of the infection vector exploit code.\n\n##### Stage 1\n\nStage 1 is the initial load point for the threat. There are two known Stage 1 file names:\n\n         - usbclass.sys (version 1.0)\n\n        - adpu160.sys (version 2.0)\n\nThese are kernel drivers that load and execute Stage 2. These kernel drivers may be registered as a system\nservice or may have an associated registry key to load the driver while the computer is starting up.\n\nStage 1 simply reads and executes Stage 2 from a set of NTFS extended attributes. If no extended attributes are\nfound, Stage 2 is executed from a set of registry keys.\n\n##### Stage 2\n\nStage 2 is a kernel driver that simply extracts, installs and runs Stage 3. Stage 2 is not stored in the traditional\nfile system, but is encrypted within an extended attribute or a registry key blob.\n\nStage 2 can be found encrypted in:\n\nExtended attribute\n\n       - %Windir%\n\n       - %Windir%\\fonts\n\n        - %Windir%\\cursors (possibly only in version 2.0)\n\nRegistry subkey\n\n       - HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Class\\{4F20E605-9452-4787-B793-\nD0204917CA58}\n\n        - HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\RestoreList\\VideoBase (possibly only in version\n2.0)\n\nThis stage can also hide running instances of Stage 1. Once this happens, there are no remaining plainly visible\ncode artifacts. Similar to previous stages, Stage 2 finds and loads an encrypted version of Stage 3 from either\nNTFS extended attributes or a registry key blob.\n\nStage 2 can also monitor the state of the threat. This stage drops the file msrdc64.dat, which appears to always\nbe 512 bytes in size. The first two bytes are used and the remaining bytes are set to zero. The second byte\nindicates the exclusive maximum number of instances allowed to run, which is set to two. This means no more\nthan one instance should run at any time. The first byte indicates how many instances were run or attempted to\nrun. Therefore, the potential combinations for the first two bytes are:\n\n         - 00 02 (the threat is not running)\n\n         - 01 02 (the threat is running)\n\n         - 02 02 (the threat was running and a second instance has started).\n\n##### Stage 3\n\nStage 3 is a kernel mode DLL and is not stored in the traditional file system. Instead, this file is encrypted within\nan extended attribute or registry key blob.\n\n\n-----\n\n|Table 2. An example of Regin’s methods organized into 12 groups|Col2|\n|---|---|\n|Major|Functionality|\n|0001h|Core|\n|000Dh|Compression, decompression|\n|000Fh|Encryption, decryption|\n|003Dh|EVFS handling|\n|0007h|Container management|\n|000Bh|Log management|\n|0033h|Loader|\n|0011h|Network|\n|0013h|Network|\n|C373h|TCP command-and-control (C&C)|\n|0019h|UDP C&C|\n|0009h|C&C Processor|\n\n\nStage 3 can be found in the following locations:\n\nExtended attribute\n\n       - %Windir%\\system32\n\n       - %Windir%\\system32\\drivers\n\nRegistry subkey\n\n       - HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Class\\{4F20E605-9452-4787-B793-\nD0204917CA5A}\n\nThe file is six to seven times the size of the driver in Stage 2. In addition to loading and executing Stage 4, Stage\n3 offers a framework for the higher level stages.\n\nStages 3 and above are based on a modular framework of code modules. These modules offer functions through\na private, custom interface. Each file in stages 3 and above can “export” functionality to other parts of Regin.\n\nIn the case of Stage 3, the following primitives are offered:\n\n         - The orchestrator, which parses custom records found in the appended data of the executable files for stages\n3 and above. These records contain a list of Regin functionalities to be executed. A record starts with the\nnumber 0xD912FEAB (little-endian ordering)\n\n        - Compression and decompression routines\n\n        - Encryption and decryption routines\n\n         - Routines to retrieve storage locations of higher-level (Stage 4) components\n\n         - Routines to handle an encrypted virtual file system used by Stage 4\n\n        - Network primitives\n\nThese primitives are provided through a custom export methodology.\n\n###### Export methodology\n\nThe Stage 3 DLL exports a wide range\n\n_Table 2. An example of Regin’s methods organized into 12 groups_\n\nof functionality through a custom\nexport methodology. The interface used Major Functionality\nto export functionality does not make 0001h Core\nuse of the traditional Windows DLL\nexport mechanism by name or ordinal. 000Dh Compression, decompression\n\n000Fh Encryption, decryption\n\nExported Regin methods are referenced\nby a tuple consisting of a major 003Dh EVFS handling\nand minor number. Stage 3 exports 0007h Container management\nhundreds of methods, organized\n\n000Bh Log management\n\ninto 12 different major groups. The\nnumbers used vary across versions. We 0033h Loader\nacquired artifacts using two different 0011h Network\nnumbering schemes. Table 2 is an\nexample listing. 0013h Network\n\nC373h TCP command-and-control (C&C)\n\nWith Regin’s modular nature, Stage\n4 kernel modules and Stage 5 user 0019h UDP C&C\nmodules (payloads) can provide 0009h C&C Processor\nfunctionality and export routines using\nthe same major and minor numbering\nscheme.\n\n\n-----\n\n##### Stage 4\n\nThe files for Stage 4, which are loaded by Stage 3, consist of a user-mode orchestrator and multiple kernel\npayload modules. They are stored in two EVFS containers as files:\n\n        - %System%\\config\\SystemAudit.Evt: Contains Stage 4 kernel drivers, which constitute the kernel mode part of\nRegin’s payload.\n\n        - %System%\\config\\SecurityAudit.Evt: Contains a user mode version of Stage 3. The files are injected into\nservices.exe.\n\nWhen the attackers who operated Regin cleaned up compromised computers once they were finished with them,\nthey often failed to remove Stage 4 and 5 artifacts from the system.\n\nStage 4 also uses the same export methodology described in Stage 3.\n\n##### Stage 5\n\nStage 5 consists of the main Regin payload functionality. The files for Stage 5 are injected into services.exe by\nStage 4.\n\nStage 5 files are EVFS containers containing other files:\n\n        - %System%\\config\\SystemLog.evt: Contains Stage 5 user mode DLLs. They constitute Regin’s payload.\n\n        - %System%\\config\\SecurityLog.evt: Contains Stage 5 data files, used by the Stage 4 and 5 components to\nstore various data items\n\n        - %System%\\config\\ApplicationLog.evt: Another Stage 5 log container, which is\nreferenced by Stage 5 data files\n\n        - %Windir%\\ime\\imesc5\\dicts\\pintlgbp.imd (version 2.0)\n\n        - %Windir%\\ime\\imesc5\\dicts\\pintlgbs.imd (version 2.0)\n\nRegin’s payload involves the DLLs contained in the SystemLog.evt EVFS container.\nThe payload functionality differs depending on the targeted computer. Custom\npayload files will likely be delivered for each specific environment. Example payload\nfunctionality seen to date includes:\n\n         - Sniffing low-level network traffic\n\n        - Exfiltrating data through various channels (TCP, UDP, ICMP, HTTP)\n\n        - Gathering computer information\n\n        - Stealing passwords\n\n        - Gathering process and memory information\n\n        - Crawling through the file system\n\n         - Low level forensics capabilities (for example, retrieving files that were deleted)\n\n         - UI manipulation (remote mouse point & click activities, capturing screenshots, etc.)\n\n        - Enumerating IIS web servers and stealing logs\n\n        - Sniffing GSM BSC administration network traffic\n\n##### Encrypted virtual file system containers\n\nRegin stores data files and payloads on disk in encrypted virtual file system files. Such\nfiles are accessed by the major routines 3Dh. Files stored inside EVFS containers are\nencrypted with a variant of RC5, using 64-bit blocks and 20 rounds. The encryption\nmode is reverse cipher feedback (CFB).\n\nKnown extensions for EVFS containers are *.evt and *.imd. The structure of a\ncontainer is similar to the FAT file system. One major difference is that files do _Figure 4. Physical layout_\nnot have a name; instead, they’re identified using a binary tag. The tag itself is the _of an EVFS container_\n\n\n-----\n\n|Table 3. The container’s header|Col2|Col3|\n|---|---|---|\n|Offset|Type|Description|\n|00h|WORD|Sector size in bytes|\n|02h|WORD|Maximum sector count|\n|04h|WORD|Maximum file count|\n|06h|BYTE|File tag length (taglen)|\n|07h|DWORD|Header CRC|\n|0Bh|DWORD|File table CRC|\n|0Fh|WORD|Number of files|\n|11h|WORD|Number of sectors in use|\n|13h|-|Sector-use bitmap|\n\n|Table 4. The container’s file entry table|Col2|Col3|\n|---|---|---|\n|Offset|Type|Description|\n|00h|DWORD|CRC|\n|04h|DWORD|File offset|\n|08h|DWORD|Offset to first sector holding the file data|\n|0Ch|BYTE[taglen]|File tag|\n\n|Table 5. The container’s sectors|Col2|Col3|\n|---|---|---|\n|Offset|Type|Description|\n|00h|DWORD|Next sector offset, or 0|\n|04h|BYTE[sectsize-4]|Data|\n\n\nconcatenation of a major number and a minor number. The major number typically indicates the major function\ngroup that will handle the file.\n\nA container starts with the header in Table 3\n(little-endian ordering). _Table 3. The container’s header_\n\nOffset Type Description\n\nThe header is followed by the file entry table\n(Table 4). Each file entry is 13h+taglen bytes 00h WORD Sector size in bytes\nlong. 02h WORD Maximum sector count\n\nThe sectors follow (Table 5). A sector of 04h WORD Maximum file count\nsectsize bytes starts with a DWORD pointing to 06h BYTE File tag length (taglen)\nthe next sector (if the file does not fit within a\nsingle sector), followed by sectsize-4 bytes of 07h DWORD Header CRC\npayload data. 0Bh DWORD File table CRC\n\nAs explained above, the files are encrypted. 0Fh WORD Number of files\nOther layers of encryption and compression 11h WORD Number of sectors in use\nmay also be in place, although those would be\n\n13h                                 - Sector-use bitmap\n\nhandled by higher level components.\n\n##### Command-and-control Table 4. The container’s file entry table operations Offset Type Description\n\n00h DWORD CRC\n\nRegin’s C&C operations are extensive. These\nbackchannel operations are bidirectional, 04h DWORD File offset\nwhich means either the attackers can initiate\n\n08h DWORD Offset to first sector holding the file data\n\ncommunications with compromised computers\non the border network or the compromised 0Ch BYTE[taglen] File tag\ncomputers can initiate communications with\nthe attacker. Furthermore, compromised\n\n_Table 5. The container’s sectors_\n\ncomputers can serve as a proxy for other\ninfections and command and control can Offset Type Description\nalso happen in a peer-to-peer fashion. All\n\n00h DWORD Next sector offset, or 0\n\ncommunications are strongly encrypted and\ncan happen in a two-stage fashion where the 04h BYTE[sectsize-4] Data\nattacker may contact a compromised computer\nusing one channel to instruct it to begin\ncommunications on a different channel. Four transport protocols are available for C&C:\n\n        - ICMP: Payload information can be encoded and embedded in lieu of legitimate ICMP/ping data. The string\n‘shit’ is scattered in the packet for data validation. In addition, CRC checks use the seed ‘31337’.\n\n        - UDP: Raw UDP payload\n\n        - TCP: Raw TCP payload\n\n        - HTTP: Payload information can be encoded and embedded within cookie data under the names SESSID,\nSMSWAP, TW, WINKER, TIMESET, LASTVISIT, AST.NET_SessionId, PHPSESSID, or phpAds_d. This information\ncan be combined with another cookie for validation under the names USERIDTK, UID, GRID, UID=PREF=ID, TM,\n__utma, LM, TMARK, VERSION, or CURRENT\n\nThe C&C operations are undertaken by various modules, including major groups C373h, 19h, 9, as well as Stage\n5 payloads, such as C375h and 1Bh.\n\n##### Logging\n\nRegin logs data to the ApplicationLog.dat file. This file is not an encrypted container, but it is encrypted and\ncompressed.\n\n\n-----\n\n### PAYLOADS\n\n## The extensible nature of Regin and its custom payloads indicate that many payloads are likely to exist in order to enhance Regin’s capabilities\n\n\n-----\n\n|Regin can be distributed with various payload modules or receive payload modules after infection. The extensible nature of Regin and its custom payloads indicate that many additional payloads are likely to exist in order to enhance Regin’s capabilities. Furthermore, we have found data files accompanying payload modules that have not been recovered. The following table describes the Stage 4 kernel payload modules and Stage 5 user mode payload modules, which we have seen several variants of Regin use.|Col2|Col3|\n|---|---|---|\n|Table 6. Regin’s stage 4 kernel payload modules and stage 5 user mode payload modules|||\n|File type|Major|Description|\n|SYS|0003|Driver|\n|SYS|C433|Rootkit|\n|SYS|C42B|PE loader|\n|SYS|C42D|DLL injection|\n|SYS|C3C3|Network packet filter driver similar to the WinPCap (protocol filter version 3.5) Used to set TCP and UDP pass-through filters and to bypass firewalls. Executes BPF (Berkeley Packet Filter) bytecode, stored in Stage 5 data files.|\n|SYS|4E69|Network port blocker|\n|DLL|C363|Network packet capture|\n|DLL|4E3B|Retrieve proxy information for a web browser (Internet Explorer, Netscape, Firefox) through registry or configu- ration files (for example, prefs.js, refs.js, etc.) Enumerate sessions and user accounts|\n|DLL|290B|Password stealer • Windows Explorer credentials • Windows Explorer pstore records • Internet Explorer LegacySettings • Data for a Winlogon notification package named “cryptpp”|\n|DLL|C375|C&C HTTP/cookies|\n|DLL|C383|SSL communications|\n|DLL|C361|Supporting cryptography functions|\n|DLL|001B|ICMP backchannel|\n|DLL|C399|Record builder for ApplicationLog.Evt|\n|DLL|C39F|Processes file: %Temp%\\~b3y7f.tmp|\n|DLL|C3A1|Miscellaneous functions|\n|DLL|28A5|Miscellaneous functions|\n|DLL|C3C1|Miscellaneous functions|\n|DLL|C3B5|Gather system information • CPUMemory • Drives and shares • Devices • Windows information (including type, version, license info, owner info) • Installed software • Running processes (through HKEY_PERFORMANCE_DATA id 230) • Services • Schedules tasks and jobs • Running desktop sessions • User accounts information • System’s auditing rules/policy • System time and Windows install time|\n\n\n#### Payloads\n\nRegin can be distributed with various payload modules or receive payload modules after infection. The\nextensible nature of Regin and its custom payloads indicate that many additional payloads are likely to exist in\norder to enhance Regin’s capabilities. Furthermore, we have found data files accompanying payload modules\nthat have not been recovered. The following table describes the Stage 4 kernel payload modules and Stage 5\nuser mode payload modules, which we have seen several variants of Regin use.\n\n_Table 6. Regin’s stage 4 kernel payload modules and stage 5 user mode payload modules_\n\nFile type Major Description\n\nSYS 0003 Driver\n\nSYS C433 Rootkit\n\nSYS C42B PE loader\n\nSYS C42D DLL injection\n\nSYS C3C3 Network packet filter driver similar to the WinPCap (protocol filter version 3.5)\nUsed to set TCP and UDP pass-through filters and to bypass firewalls.\nExecutes BPF (Berkeley Packet Filter) bytecode, stored in Stage 5 data files.\n\nSYS 4E69 Network port blocker\n\nDLL C363 Network packet capture\n\nDLL 4E3B Retrieve proxy information for a web browser (Internet Explorer, Netscape, Firefox) through registry or configu-\nration files (for example, prefs.js, refs.js, etc.) Enumerate sessions and user accounts\n\nDLL 290B Password stealer\n\n                               - Windows Explorer credentials\n\n                               - Windows Explorer pstore records\n\n                               - Internet Explorer LegacySettings\n\n                               - Data for a Winlogon notification package named “cryptpp”\n\nDLL C375 C&C HTTP/cookies\n\nDLL C383 SSL communications\n\nDLL C361 Supporting cryptography functions\n\nDLL 001B ICMP backchannel\n\nDLL C399 Record builder for ApplicationLog.Evt\n\nDLL C39F Processes file: %Temp%\\~b3y7f.tmp\n\nDLL C3A1 Miscellaneous functions\n\nDLL 28A5 Miscellaneous functions\n\nDLL C3C1 Miscellaneous functions\n\nDLL C3B5 Gather system information\n\n                               - CPUMemory\n\n                               - Drives and shares\n\n                               - Devices\n\n                               - Windows information (including type, version, license info, owner info)\n\n                               - Installed software\n\n                               - Running processes (through HKEY_PERFORMANCE_DATA id 230)\n\n                               - Services\n\n                               - Schedules tasks and jobs\n\n                               - Running desktop sessions\n\n                               - User accounts information\n\n                               - System’s auditing rules/policy\n\n                               - System time and Windows install time\n\n\n-----\n\n|DLL|C36B|UI manipulation • Capture screenshots • Log keystrokes • Lock the workstation/input Ctrl-Alt-Del • Click functionality (through three commands: go, click & release, return to original position) • End processes|\n|---|---|---|\n|DLL|C351|File system exploration primitives and forensic level exploration including a raw NTFS parser • Get miscellaneous file information and properties • Browse directories • Read and write files • Move and copy files • Read and recover partially or fully deleted files • Compute file hashes|\n|DLL|2B5D|Process and module manipulation • Read processes and modules • Processes running times, quotas, privileges • Skip Russian or English Microsoft files when scanning • Check for newly introduced PE files in the last two days|\n|DLL|C3CD|Enumerate TCP/IP interfaces from %System%\\CurrentControlSet\\Services\\Tcpip\\Linkage\\bind|\n|DLL|C38F|TCPDump utility|\n|DLL|C3C5|Libnet binary|\n|DLL|27E9|IIS web server log theft Enumeration through COM objects to find IIS logs. Ability to retrieve partial or complete log information. • Partial: Log type, last log, older log timestamps • Complete: Entire log data is exfiltrated|\n\n\nDLL C36B UI manipulation\n\n                               - Capture screenshots\n\n                               - Log keystrokes\n\n                               - Lock the workstation/input Ctrl-Alt-Del\n\n                               - Click functionality (through three commands: go, click & release, return to original position)\n\n                               - End processes\n\nDLL C351 File system exploration primitives and forensic level exploration including a raw NTFS parser\n\n                               - Get miscellaneous file information and properties\n\n                               - Browse directories\n\n                               - Read and write files\n\n                               - Move and copy files\n\n                               - Read and recover partially or fully deleted files\n\n                               - Compute file hashes\n\nDLL 2B5D Process and module manipulation\n\n                               - Read processes and modules\n\n                               - Processes running times, quotas, privileges\n\n                               - Skip Russian or English Microsoft files when scanning\n\n                               - Check for newly introduced PE files in the last two days\n\nDLL C3CD Enumerate TCP/IP interfaces from %System%\\CurrentControlSet\\Services\\Tcpip\\Linkage\\bind\n\nDLL C38F TCPDump utility\n\nDLL C3C5 Libnet binary\n\nDLL 27E9 IIS web server log theft\nEnumeration through COM objects to find IIS logs. Ability to retrieve partial or complete log information.\n\n                               - Partial: Log type, last log, older log timestamps\n\n                               - Complete: Entire log data is exfiltrated\n\nThe IIS web server log stealing module, 27E9h, is an example of a payload module that was installed after the initial\ninfection and was specifically deployed for a particular target.\n\n#### 64-bit version\n\nOnly a small amount of the 64-bit Regin files have been recovered. These samples may represent version 2.0 or\ntheir differences may possibly be solely specific to 64-bit versions of Regin. We also recovered files from infected\ncomputers that may or may not be associated with 64-bit Regin, including several variants of svcsstat.exe, a file that\naims to retrieve binary data over pipes or sockets and execute the data.\n\n##### File names\n\nThe recovered files do not appear to fundamentally vary from their 32-bit counterparts, apart from a few noteworthy\ndifferences.\n\nThe 32-bit and 64-bit versions of Regin use different file names. These differences are shown in the first section of\nthis paper as well as in the appendix. Most importantly, in the 64-bit version of Regin, the names of containers are\nchanged:\n\n        - PINTLGBP.IMD replaces SystemLog.Evt\n\n        - PINTLGBPS.IMD replaces SecurityLog.Evt\n\n##### Stage differences\n\nThe 64-bit version of Regin’s Stage 1 (wshnetc.dll) is no longer a kernel mode driver, as drivers under 64-bit Windows\nmust be signed. Instead, Stage 1 is a user mode DLL loaded as a Winsock helper when the computer is starting\nup. Rather than loading Stage 2 from an NTFS extended attribute, Stage 1 looks for the last partition (in terms of\n\n\n-----\n\nphysical location) on disk and searches for the payload in the raw sectors in this area of the disk.\n\nThe 64-bit Regin’s Stage 3 has not been recovered. We believe that it may not exist, as the 32-bit version is a driver.\nStage 4 is an orchestrator just like its 32-bit counterpart and it uses the same major and minor values to export\nfunctionality.\n\nStage 5 uses the following filenames:\n\n        - %Windir%\\IME\\IMESC5\\DICTS\\PINTLGBP.IMD contains Stage 5 user payloads, replacing SystemLog.Evt in the\n32-bit version\n\n        - %Windir%\\IME\\IMESC5\\DICTS\\PINTLGBS.IMD contains Stage 5 data files, replacing SecurityLog.Evt in the 32-bit\nversion\n\n         - The equivalent files for SystemAudit.Evt and SecurityAudit.Evt were not recovered\n\nNo Stage 5 payload modules have been recovered.\n\n#### Conclusion\n\nRegin is a highly-complex threat which has been used for large-scale data collection or intelligence gathering\ncampaigns. The development and operation of this threat would have required a significant investment of time\nand resources. Threats of this nature are rare and are only comparable to the Stuxnet/Duqu family of malware.\nThe discovery of Regin serves to highlight how significant investments continue to be made into the development\nof tools for use in intelligence gathering. Many components of Regin have still gone undiscovered and additional\nfunctionality and versions may exist.\n\n#### Protection\n\n[Symantec and Norton products detect this threat as Backdoor.Regin.](http://www.symantec.com/security_response/writeup.jsp?docid=2013-121221-3645-99)\n\n\n-----\n\n### APPENDIX\n\n\n-----\n\n|Regin’s data files are classified as Stage 5 components and are contained in an EVFS container.|Col2|Col3|\n|---|---|---|\n|Table 7. Data files used by Stage 4’s framework DLL|||\n|Major|Minor|Description|\n|0001|-|-|\n|000D|-|-|\n|000F|01|High-entropy blobs, cryptographic data|\n||02|High-entropy blobs, cryptographic data|\n|003D|-|-|\n|0007|-|-|\n|000B|01|Contains a path to the log file. Typically, %System\\config\\ApplicationLog.Evt|\n||02|Small 8 byte files|\n|0033|01|A single DWORD, such as 111Ch|\n||03|A single DWORD, such as 1114h|\n|0011|-|-|\n|0013|01|Unknown list of records|\n||02|A single byte, such as 3|\n|C373|01|BPF bytecode for the netpcap driver—allows UDP passthrough|\n||02|A WORD value, such as 1|\n|0019|01|BPF bytecode for the netpcap driver—allows TCP passthrough|\n||02|A WORD value, such as 1|\n|0009|00|A single DWORD, such as 11030B15h|\n||01|Contains C&C location information|\n||02|C&C routines to be executed: • (C375, 1) param= 08 02 • (19, 1) param= 44 57 58 00 • (C373, 1) param= 08 02 • (1B, 1) param= 20 00|\n||03|Routines to be executed • (4E69, 2) • (19, 2) • (1B, 2) • (C373, 2)( • C375, 2) • (C383, 2)(C363, 2)|\n||07|RC5 key used to decrypt command-and-control packets|\n||09|Unknown data|\n||0B|Unknown data|\n||12|A single byte, such as 1|\n||17|Unknown data|\n\n\n#### Appendix\n\n##### Data files\n\nRegin’s data files are classified as Stage 5 components and are contained in an EVFS container.\n\n_Table 7. Data files used by Stage 4’s framework DLL_\n\nMajor Minor Description\n\n0001         -         -\n\n000D         -         -\n\n000F 01 High-entropy blobs, cryptographic data\n\n02 High-entropy blobs, cryptographic data\n\n003D         -         -\n\n0007         -         -\n\n000B 01 Contains a path to the log file.\nTypically, %System\\config\\ApplicationLog.Evt\n\n02 Small 8 byte files\n\n0033 01 A single DWORD, such as 111Ch\n\n03 A single DWORD, such as 1114h\n\n0011         -         -\n\n0013 01 Unknown list of records\n\n02 A single byte, such as 3\n\nC373 01 BPF bytecode for the netpcap driver—allows UDP passthrough\n\n02 A WORD value, such as 1\n\n0019 01 BPF bytecode for the netpcap driver—allows TCP passthrough\n\n02 A WORD value, such as 1\n\n0009 00 A single DWORD, such as 11030B15h\n\n01 Contains C&C location information\n\n02 C&C routines to be executed:\n\n                               - (C375, 1) param= 08 02\n\n                               - (19, 1) param= 44 57 58 00\n\n                               - (C373, 1) param= 08 02\n\n                               - (1B, 1) param= 20 00\n\n03 Routines to be executed\n\n                               - (4E69, 2)\n\n                               - (19, 2)\n\n                               - (1B, 2)\n\n                               - (C373, 2)(\n\n                               - C375, 2)\n\n                               - (C383, 2)(C363, 2)\n\n07 RC5 key used to decrypt command-and-control packets\n\n09 Unknown data\n\n0B Unknown data\n\n12 A single byte, such as 1\n\n17 Unknown data\n\n\n-----\n\n|Table 8. Data files used by Stage 5’s modules (payloads)|Col2|Col3|\n|---|---|---|\n|Major|Minor|Description|\n|C363|02|6 bytes (01 00 00 00 00 00)|\n|4E3B|-||\n|290B|-||\n|C375|01|Dword (1)|\n||02|Dword (0)|\n|C383|01|Dword (1)|\n||02|Dword (0)|\n||10|64 bytes (512 bits)Diffie Hellman, p (prime)|\n||11|Byte (2)Diffie Hellman, g (generator)|\n|C361|10|File containing timestamps and high entropy dataUnclear|\n||11|Dword (E10h)|\n||12|Dword (2)|\n|001B|-||\n|C399|-||\n|C39F|00|Small file, 18h bytes, low entropy|\n||01|Unencrypted unicode path, %Temp%\\~B3Y7F.tmp|\n|C3A1|01|Small file, 6 bytes (08 01 00 00 00 01)|\n|28A5|02|Small file, 18h bytes, unknown|\n|C3C1|-|-|\n|C3B5|-|-|\n|C36B|-|-|\n|C351|-|-|\n|2B5D|-|-|\n|C3CD|-|-|\n|C38F|-|-|\n|C3C5|-|-|\n|27E9|-|-|\n\n|Table 9. Orphaned data files|Col2|Col3|\n|---|---|---|\n|Major|Minor|Description|\n|4E25|00|Byte (1)|\n||01|Byte (2)|\n|28A4|00|Unknown|\n||02|Small file, 8 bytes (01 00 00 00 00 00 00 00)|\n|DEAB|01|Small file, 8 bytes (00 00 01 01 04 00 00 00)|\n\n\nAs the data files are stored in a container, they do _Table 8. Data files used by Stage 5’s modules (payloads)_\nnot have names. Just like Stage 5 modules, they are\n\nMajor Minor Description\n\nreferenced by their filetag, which is the aggregation\nof the major and minor identifiers. The major C363 02 6 bytes (01 00 00 00 00 00)\nidentifier indicates which major routine group likely\n\n4E3B                                   -\n\nhandles or creates the file.\n\n290B                                   -\n\nNot all data files have been recovered, so the\n\nC375 01 Dword (1)\n\ninformation remains incomplete.\n\n02 Dword (0)\n\nData files associated with Stage 4 kernel modules\n\nC383 01 Dword (1)\n\nhave not been recovered\n\n02 Dword (0)\n\nTable 8 lists recovered data files used by Stage 5\nmodules. 10 64 bytes (512 bits)Diffie Hellman, p (prime)\n\n11 Byte (2)Diffie Hellman, g (generator)\n\nThe associated modules that supposedly\nmanipulate those data files were not recovered. C361 10 File containing timestamps and high\n\nentropy dataUnclear\n\n11 Dword (E10h)\n\n12 Dword (2)\n\n001B                                   -\n\nC399                                   -\n\nC39F 00 Small file, 18h bytes, low entropy\n\n01 Unencrypted unicode path,\n%Temp%\\~B3Y7F.tmp\n\nC3A1 01 Small file, 6 bytes (08 01 00 00 00 01)\n\n28A5 02 Small file, 18h bytes, unknown\n\nC3C1                                  -                                  -\n\nC3B5                                  -                                  -\n\nC36B                                  -                                  -\n\nC351                                   -                                   -\n\n2B5D                                 -                                 -\n\nC3CD                                 -                                 -\n\nC38F                                    -                                    -\n\nC3C5                                  -                                  -\n\n27E9                                   -                                   -\n\n_Table 9. Orphaned data files_\n\nMajor Minor Description\n\n4E25 00 Byte (1)\n\n01 Byte (2)\n\n28A4 00 Unknown\n\n02 Small file, 8 bytes (01 00 00 00 00 00 00 00)\n\nDEAB 01 Small file, 8 bytes (00 00 01 01 04 00 00 00)\n\n\n-----\n\n#### Indicators of compromise\n\nThe following details can be used to help determine whether you have been impacted by this threat.\n\n##### File MD5s\n\n2c8b9d2885543d7ade3cae98225e263b\n\n4b6b86c7fec1c574706cecedf44abded\n\n187044596bc1328efa0ed636d8aa4a5c\n\n06665b96e293b23acc80451abb413e50\n\nd240f06e98c8d3e647cbf4d442d79475\n\n6662c390b2bbbd291ec7987388fc75d7\n\nffb0b9b5b610191051a7bdf0806e1e47\n\nb29ca4f22ae7b7b25f79c1d4a421139d\n\n1c024e599ac055312a4ab75b3950040a\n\nba7bb65634ce1e30c1e5415be3d1db1d\n\nb505d65721bb2453d5039a389113b566\n\nb269894f434657db2b15949641a67532\n\nbfbe8c3ee78750c3a520480700e440f8\n\n##### File names/paths\n\nusbclass.sys\n\nadpu160.sys\n\nmsrdc64.dat\n\nmsdcsvc.dat\n\n%System%\\config\\SystemAudit.Evt\n\n%System%\\config\\SecurityAudit.Evt\n\n%System%\\config\\SystemLog.evt\n\n%System%\\config\\ApplicationLog.evt\n\n%Windir%\\ime\\imesc5\\dicts\\pintlgbs.imd\n\n%Windir%\\ime\\imesc5\\dicts\\pintlgbp.imd\n\n%Windir%\\system32\\winhttpc.dll\n\n%Windir%\\system32\\wshnetc.dll\n\n%Windir%\\SysWow64\\wshnetc.dll\n\n%Windir%\\system32\\svcstat.exe\n\n\n-----\n\n%Windir%\\system32\\svcsstat.exe\n\n##### Extended attributes\n\n%Windir%\n\n%Windir%\\cursors\n\n%Windir%\\fonts\n\n%Windir%\\System32\n\n%Windir%\\System32\\drivers\n\n##### Registry\n\nHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Class\\{4F20E605-9452-4787-B793-\nD0204917CA58}\n\nHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\RestoreList\\VideoBase\n\nHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Class\\{4F20E605-9452-4787-B793-\nD0204917CA5A}\n\n\n-----\n\n###### About Symantec\nSymantec Corporation (NASDAQ: SYMC) is an information\nprotection expert that helps people, businesses and\ngovernments seeking the freedom to unlock the opportunities\ntechnology brings -- anytime, anywhere. Founded in April\n1982, Symantec, a Fortune 500 company, operating one of\nthe largest global data-intelligence networks, has provided\nleading security, backup and availability solutions for where\nvital information is stored, accessed and shared. The company’s\nmore than 20,000 employees reside in more than 50 countries.\nNinety-nine percent of Fortune 500 companies are Symantec\ncustomers. In fiscal 2014, it recorded revenues of $6.7 billion.\n\n[To learn more go to www.symantec.com or connect with](http://www.symantec.com)\nSymantec at: go.symantec.com/social/.\n\nFor specific country offices and contact numbers, please visit our website.\n\nSymantec World Headquarters Copyright © 2014 Symantec Corporation. All\n350 Ellis St. rights reserved. Symantec, the Symantec Logo,\n\nand the Checkmark Logo are trademarks or\n\nMountain View, CA 94043 USA\n\nregistered trademarks of Symantec Corporation\n\n+1 (650) 527-8000 or its affiliates in the U.S. and other countries.\n1 (800) 721-3934 Other names may be trademarks of their\nwww.symantec.com respective owners.\n\nAny technical information that is made available by Symantec Corporation is the copyrighted work of Symantec Corporation and is owned by Symantec\nCorporation.\n\nNO WARRANTY . The technical information is being delivered to you as is and Symantec Corporation makes no warranty as to its accuracy or use. Any use\nof the technical documentation or the information contained herein is at the risk of the user. Documentation may include technical or other inaccuracies or\ntypographical errors. Symantec reserves the right to make changes without prior notice.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        },
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        },
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/at56dm7anwlk35y4cp4ung9qwgiz6bn1",
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2014/2014.11.24.Regin_Top-tier_espionage/regin-analysis.pdf",
        "https://papers.vx-underground.org/papers/ICS SCADA/Other/Security Response - Regin v1.0.pdf"
    ],
    "report_names": [
        "regin-analysis",
        "Security Response - Regin v1.0.pdf"
    ],
    "threat_actors": [
        {
            "id": "67bf0462-41a3-4da5-b876-187e9ef7c375",
            "created_at": "2022-10-25T16:07:23.44832Z",
            "updated_at": "2025-03-27T02:02:09.806007Z",
            "deleted_at": null,
            "main_name": "Careto",
            "aliases": [
                "Careto",
                "The Mask",
                "Ugly Face"
            ],
            "source_name": "ETDA:Careto",
            "tools": [
                "Careto"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "f5bf6853-3f6e-452c-a7b7-8f81c9a27476",
            "created_at": "2023-01-06T13:46:38.677391Z",
            "updated_at": "2025-03-27T02:00:02.889755Z",
            "deleted_at": null,
            "main_name": "Careto",
            "aliases": [
                "The Mask",
                "Ugly Face"
            ],
            "source_name": "MISPGALAXY:Careto",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1666716491,
    "ts_updated_at": 1743041394,
    "ts_creation_date": 1416825649,
    "ts_modification_date": 1416825651,
    "files": {
        "pdf": "https://archive.orkl.eu/40f76477ba1f453b341743b53113ebd705c1bb75.pdf",
        "text": "https://archive.orkl.eu/40f76477ba1f453b341743b53113ebd705c1bb75.txt",
        "img": "https://archive.orkl.eu/40f76477ba1f453b341743b53113ebd705c1bb75.jpg"
    }
}