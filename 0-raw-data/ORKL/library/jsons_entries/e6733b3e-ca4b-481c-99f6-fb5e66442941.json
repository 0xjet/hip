{
    "id": "e6733b3e-ca4b-481c-99f6-fb5e66442941",
    "created_at": "2023-01-12T15:06:39.683431Z",
    "updated_at": "2025-03-27T02:06:05.481298Z",
    "deleted_at": null,
    "sha1_hash": "1846b2b220719e6a6e0633e4356072adbe05410c",
    "title": "2019-03-13 - DanaBot control panel revealed",
    "authors": "",
    "file_creation_date": "2022-05-28T19:11:04Z",
    "file_modification_date": "2022-05-28T19:11:04Z",
    "file_size": 2091756,
    "plain_text": "# DanaBot control panel revealed\n\n**[proofpoint.com/us/threat-insight/post/danabot-control-panel-revealed](https://www.proofpoint.com/us/threat-insight/post/danabot-control-panel-revealed)**\n\n\nMarch 13, 2019\n\n\n-----\n\n[Blog](https://www.proofpoint.com/us/blog)\n[Threat Insight](https://www.proofpoint.com/us/blog/threat-insight)\nDanaBot control panel revealed\n\n\n-----\n\nMarch 13, 2019 Dennis Schwarz and Proofpoint Threat Insight Team\n\n**Overview**\n\nProofpoint researchers discovered and reported on the DanaBot banking malware in May 2018 [1]. In our\nOctober 2018 update [2], we speculated that DanaBot may be set up as a “malware as a service” in which\none threat actor controls a global command and control (C&C) panel and infrastructure system and then\nsells access to other threat actors known as affiliates. Affiliates then target and distribute DanaBot malware\nas they see fit. While analyzing a component of this infrastructure, we discovered an interesting graphical\nclient application that we believe to be a control panel used by affiliates to access the global C&C system.\nOnce logged on to the system, they can configure and build their DanaBot malware; access infected\ndevices; and sift through any stolen data including credentials, financial account information, and more.\n\n**Control Panel Application**\n\nOur current theory is that when an affiliate buys access to the DanaBot system, they are given the control\npanel application described here and a user account to the global C&C system.\n\nLike the malware, the control panel is written in the Delphi programming language. It has a compilation date\nof “2019-02-04 22:33:42” and an internal name of “Client.exe”. The application is mostly a graphical frontend\nin which inputs are formatted as commands that are sent to a backend C&C server for processing. Once\nprocessed, the C&C server sends back the results, which are then displayed by the application.\n\nFigures 1 through 6 give a tour of the main components of the control panel. While a valid login is required to\nsend and receive data to and from the backend C&C server, the figures still illustrate some of the potential\nactions a DanaBot affiliate can execute via the control panel:\n\nLogin to a backend C&C server (Figure 1)\nBuild new DanaBot malware (Figure 2)\nSee various statistics from infected devices (Figure 3)\nConfigure various aspects of the malware (e.g., video recording of the screen, keylogging, and\nwebinjects) (Figure 4)\nSearch and view stolen information (e.g., credentials and financial account information) (Figure 5)\nOperate on infected devices (e.g., search for files, download files, execute commands, take a\nscreenshot, and open a VNC session) (Figure 6)\n\n\n-----\n\n_Figure 1: Control panel “Connect” tab_\n\n_Figure 2: Control panel “Builds” button_\n\n\n-----\n\n_Figure 3: Control panel “Stats” tab_\n\n_Figure 4: Control panel “Config” tab_\n\n\n-----\n\n_Figure 5: Control panel “Logs” tab_\n\n_Figure 6: Control panel “Online” tab_\n\n**Association with DanaBot Malware**\n\nIn addition to finding the control panel application on infrastructure closely tied to DanaBot, two other\nsignificant pieces of evidence tie this control panel application to the DanaBot malware:\n\nC&C protocol overlap\n\n\n-----\n\nShared RSA public key\n\nIn February 2019, a new version of the DanaBot malware was spotted in the wild that contained a new C&C\nprotocol. ESET researchers were the first to notice the update and published a blog post [3] detailing the\nchanges. Since then all of the DanaBot affiliates into which we have visibility have switched to this new\nversion.\n\nUsing ESET’s post as background, we can compare and contrast the network communications used in the\ncontrol panel application (traffic generated when trying to login to a C&C server - Figure 7) and the C&C\nprotocol used in the malware (initial beacon - Figure 8).\n\n_Figure 7: Control panel “login” request_\n\n\n-----\n\n_Figure 8: DanaBot malware “initial beacon”_\n\nIn both figures we can see two sets of communications each containing a 24-byte header (highlighted in red)\nfollowed by encrypted data (highlighted in blue).\n\nThe header contains:\n\nOffset 0x0: length of data (QWORD)\nOffset 0x8: random value (QWORD)\nOffset 0x10: random value + length of data (QWORD)\n\nThe encrypted data sections are composed of 3 pieces:\n\nAES-256 encrypted data using a randomly generated key\nPadding length (DWORD)\nThe randomly generated AES key that has been RSA encrypted using an embedded RSA public key\n\n\n-----\n\nIn the first set of communications, the AES encrypted data contains a second RSA public key that is\ngenerated by the control panel application and malware. This second RSA key is used to decrypt data sent\nback from the C&C server.\n\nThe second set of communications contains the initial commands “login command” for the control panel\napplication and “initial beacon” for the malware. Both commands use a 167-byte structure and share many\ncommon fields as shown in Table 1. Some fields that only appear to apply to the malware such as\narchitecture and process integrity are set to zero in the control panel.\n\n**Field** **Control Panel Application** **DanaBot Malware**\n\nLength 167 167\n\nRandom value 8931 8499\n\n\nRandom value +\nlength\n\n\n9098 8666\n\n\nAffiliate ID 0 5\n\nCommand 101 300\n\nArgument 1006* 0\n\nRandom value 2 35786 14697\n\nUnknown 0 0\n\nArchitecture 0 64\n\nWindows version 0 610760110\n\nUnknown 0 0\n\nIs admin 0 1\n\nProcess integrity 0 12288\n\nUnknown 0 1\n\nUnknown 0 0\n\n\nUsername/archive\nkey**\n\n\ntest_user BB0B8678649F818C3A8F360098FD8874\n\n\n-----\n\nPassword/nonce\n1***\n\nnonce***/nonce\n2***\n\n- Control panel\nversion\n** A key used to\ndecrypt an\narchive of\ncomponents sent\nfrom the C&C\nserver to the\nmalware\n*** The malware\nand control panel\nuse something we\ncall “nonces”.\nThey can also be\nconsidered a type\nof checksum. In\ngeneral they are\nMD5 hash values\nof various fields\nand hard coded\nconstants added\ntogether.\n\n\ntest_pass 9AA088954D476D58590AC5B40543AF3C\n\n701011CE5A3BBBC4A5901A19BF19A706 AF9DE6B708E347F5A8F77E2EAF29E75F\n\n\n_Table 1: Control panel “login” command vs. DanaBot malware “initial beacon” command_\n\nThe second major feature that the control panel application and malware have in common is an embedded\nRSA public key used for encrypting AES session keys in the C&C protocol:\n\n```\n-----BEGIN PUBLIC KEY----\n```\n```\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCyJo2aXOQNP+KeAnWlpOiuMk5W\n\n```\n```\nl1An5GorPHqEyFAlRyv6sEylQDjAuSLGsy2LCvKmuzx2AFQ+3IMfqFf3JacY1HmY\n\n```\n```\nWuiL1V+R910TohM+6hnLnWx7JNbfzB3S7D1JC/WNUwlVv5NnIIX1i+zIW5BTanU1\n\n```\n```\nyQ97xjvokjvZHCHe2wIDAQAB\n\n```\n```\n-----END PUBLIC KEY----\n```\n\nThis RSA public key has actually been used in all of the DanaBot malware samples we have observed since\nthe upgrade in February. It is part of the reason we suspect that there is a single global C&C panel with\nwhich all affiliate malware communicates.\n\nIn addition to the overlapping C&C protocol and shared RSA key, the code in both the control panel and the\nmalware share the same structure and style.\n\n**Conclusion**\n\n\n-----\n\nA stand-alone binary application through which affiliates access malware control panels is unusual, with\nmalware developers generally opting for web-based control panels. Several factors, however, suggest that\nthe application described here is used by DanaBot affiliates to build and configure their malware and then to\naccess victim devices.\n\nIn either case, it is usually a careless OPSEC mistake by a threat actor or an intentional “leak” of the\nmalware that exposes the control panel. Once exposed, however, they tend to provide useful insights into\nmalware campaigns and a perspective usually hidden to defenders.\n\n**References**\n\n[1] [https://www.proofpoint.com/us/threat-insight/post/danabot-new-banking-trojan-surfaces-down-under-0](https://www.proofpoint.com/us/threat-insight/post/danabot-new-banking-trojan-surfaces-down-under-0)\n\n[2] https://www.proofpoint.com/us/threat-insight/post/danabot-gains-popularity-and-targets-us-organizationslarge-campaigns\n\n[3] [https://www.welivesecurity.com/2019/02/07/danabot-updated-new-cc-communication/](https://www.welivesecurity.com/2019/02/07/danabot-updated-new-cc-communication/)\n\n**Indicators of Compromise (IOCs)**\n\n\n**IOC** **IOC**\n**Type**\n\n\n**Description**\n\n\nd7ef48545457cbe791ed23c178551e4b17f0964a9e9ef7d0badda9f3e8c594f3 SHA256 DanaBot\nControl\nPanel\n\n8327931a5d2430526862d789b9654c9c8da7bc64519d210a93e4720aac7ccaa0 SHA256 DanaBot\nMalware\n(Affiliate 5)\nused for\ncomparison\n\nSubscribe to the Proofpoint Blog\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-03-13 - DanaBot control panel revealed.pdf"
    ],
    "report_names": [
        "2019-03-13 - DanaBot control panel revealed.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535999,
    "ts_updated_at": 1743041165,
    "ts_creation_date": 1653765064,
    "ts_modification_date": 1653765064,
    "files": {
        "pdf": "https://archive.orkl.eu/1846b2b220719e6a6e0633e4356072adbe05410c.pdf",
        "text": "https://archive.orkl.eu/1846b2b220719e6a6e0633e4356072adbe05410c.txt",
        "img": "https://archive.orkl.eu/1846b2b220719e6a6e0633e4356072adbe05410c.jpg"
    }
}