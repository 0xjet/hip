{
    "id": "a4235030-601f-40f0-854f-2931f272e6fd",
    "created_at": "2023-01-12T15:02:37.01269Z",
    "updated_at": "2025-03-27T02:09:29.402039Z",
    "deleted_at": null,
    "sha1_hash": "c12c7da174a63e788d3c6777d166853724f30dc9",
    "title": "2016-12-20 - Alice- A Lightweight, Compact, No-Nonsense ATM Malware",
    "authors": "",
    "file_creation_date": "2022-05-28T19:03:53Z",
    "file_modification_date": "2022-05-28T19:03:53Z",
    "file_size": 180475,
    "plain_text": "# Alice: A Lightweight, Compact, No-Nonsense ATM Malware\n\n**[blog.trendmicro.com/trendlabs-security-intelligence/alice-lightweight-compact-no-nonsense-atm-malware/](http://blog.trendmicro.com/trendlabs-security-intelligence/alice-lightweight-compact-no-nonsense-atm-malware/)**\n\nDecember 20, 2016\n\nTrend Micro has discovered a new family of ATM malware called Alice, which is the most\nstripped down ATM malware family we have ever encountered. Unlike other ATM malware\nfamilies, Alice cannot be controlled via the numeric pad of ATMs; neither does it have\ninformation stealing features. It is meant solely to empty the safe of ATMs. We detect this\nnew malware family as BKDR_ALICE.A. Trend Micro first discovered the Alice ATM malware\nfamily in November 2016 as result of our joint research project on ATM malware with Europol\nEC3. We collected a list of hashes and the files corresponding to those hashes were then\nretrieved from VirusTotal for further analysis. One of those binaries was initially thought to be\na new variant of the Padpin ATM malware family. However, after reverse analysis, we found\nthat it to be part of a brand new family, which we called Alice. ATM malware has been around\nsince 2007, but over the past nine years we have only learned of eight unique ATM malware\nfamilies, including Alice. This new discovery is remarkable because it shows a clear\ntendency for malware writers to attack an ever-increasing variety of platforms. This is\nespecially acute against ATMs, due to the high monetary value they represent. This\ntendency has accelerated enormously over the last 2-3 years, which is when the bulk of\nthose families have been discovered. Technical Details The family name “Alice” was\nderived from the version information embedded in the malicious binary:\n\n_Figure 1. File properties of Alice sample_\n\nBased on PE compilation times and Virustotal submission dates, Alice has been in the wild\nsince at least October 2014. The Alice samples we found were packed with a commercial,\n\n\n-----\n\noff-the-shelf packer/obfuscator called VMProtect. This software checks if the embedded\nbinary is being run inside a debugger and displays the following error message if it\ndetermines that to be the case:\n\n_Figure 2. Error message_\n\nBefore any malicious code runs, Alice checks if it is running within a proper Extensions for\nFinancial Services XFS environment to make sure that it's actually running on an ATM. It\ndoes this by looking for the following registry keys:\n\nHKLM\\SOFTWARE\\XFS\nHKLM\\SOFTWARE\\XFS\\TRCERR\n\nIf these registry keys do not exist, the malware assumes that the environment is not right and\nterminates itself. Alice also requires the following DLLs to be installed on the system:\n\nMSXFS.dll\nXFS_CONF.dll\nXFS_SUPP.dll\n\nDepending on whether its XFS check was successful or not, Alice displays either an\nauthorization window or a generic error message box:\n\n_Figures 3 and 4. Post-execution message boxes. On the left is an authorization window,_\n_which appears if the XFS check is successful. On the right is an error message, which_\n_appears if the check yields a negative result._\n\nWhen first run, Alice creates an empty 5 MB+ sized file called xfs_supp.sys and an error\nlogfile called TRCERR.LOG, both in the root directory. The first file is filled with zeros and no\ndata is ever written to it. The second file (TRCERR.LOG) is a log file that the malware uses\nto write any errors that occur during execution. All XFS API calls and their corresponding\nmessages/errors are logged. This file is not deleted from the machine during uninstallation. It\nremains on the system for future troubleshooting, or perhaps the malware author forgot to\nclean it up. Alice connects to the CurrencyDispenser1 peripheral, which is the default name\nfor the dispenser device in the XFS environment. Alice does not attempt to connect to other\nATM-specific hardware; therefore criminals cannot issue any commands via the PIN pad.\nAlice doesn’t terminate itself if it fails to connect to CurrencyDispenser1, instead it simply\nlogs the error. The PIN input seen in Figure 4 provides a way to issue commands to the Alice\nmalware. Three commands can be entered are:\n\n**PIN Code** **Description of Command**\n\n1010100 Decrypts and drops file sd.bat in current directory. This\nbatch file is used to cleanup/uninstall Alice.\n\n\n-----\n\n0 Exits the program and runs sd.bat. Also deletes\n_xfs_supp.sys._\n\n\nspecific 4-digit PIN based\non ATM’s terminal ID\n\n\nOpens the \"operator panel\".\n\n\nMultiple mistakes in entering the correct PIN will result in the following window being\nshown and the malware terminating itself:\n\n_Figure 5. Error message_\n\nWhen the correct PIN code is entered, Alice will open the \"operator panel\". This is a screen\nshowing the various cassettes with money loaded inside the machine, which the attacker can\nthen steal at their leisure. (In this sample, no cassettes are shown since we were running this\nmalware on a test setup.)\n\n_Figure 6. Operator panel_\n\nNote that entering \"0\" or \"9\" as the cassette ID will also cause sd.bat to be run\nand xfs_supp.sys to be deleted. When the money mule inputs the cassette number in the\noperator panel, the CurrencyDispenser1 peripheral is sent the dispense command via the\n_WFSExecute API and stored cash is dispensed. ATMs typically have a 40-banknote_\ndispensing limit, so the money mule might need to repeat the operation multiple times to\ndispense all the stored cash in the cassette. The stored cash levels for each cassette are\ndynamically updated on the screen, so the money mule knows how close they are to\ncompletely emptying the cassettes. Alice is usually found on infected systems as\n_taskmgr.exe. While the malware itself has no persistence method, we believe that the_\ncriminals manually replace the Windows Task Manager with Alice. Any command that would\ninvoke the Task Manager would instead invoke Alice. Conclusions Several things stand out\nabout Alice. It is extremely feature-lean and, unlike other ATM malware families we have\ndissected, it only includes the basic functionality required to successfully empty the money\nsafe of the ATM. It only connects to the CurrencyDispenser1 peripheral and it never attempts\nto use the machine's PIN pad. The logical conclusion is that the criminals behind Alice need\nto physically open the ATM and infect the machine via USB or CD-ROM, then connect a\nkeyboard to the machine's mainboard and operate the malware through it. Another possibility\nwould be to open a remote desktop and control the menu via the network, similar to the\nhacking attacks in Thailand and other recent incidents. However, we have not seen Alice\nbeing used this way. The existence of a PIN code prior to money dispensing suggests\nthat Alice is used only for in-person attacks. Neither does Alice have an elaborate install or\nuninstall mechanism—it works by merely running the executable in the appropriate\nenvironment. Alice’s user authentication is similar to other ATM malware families. The money\nmules that carry out the attacks receive from the actual criminal gang(s) the PIN needed.\nThe first command they enter drops the cleanup script while entering the machine-specific\n\n\n-----\n\nPIN code lets them access the operator panel for money dispensing. This access code\nchanges between samples to prevent mules from sharing the code and bypassing the\ncriminal gang, to keep track of individual money mules, or both. In our samples the passcode\nis only 4 digits long, but this can be easily changed. Attempts to brute-force the passcode will\neventually cause the malware to terminate itself once the PIN input limit is reached Given the\nfact that Alice only looks for an XFS environment and doesn't perform any additional more\nhardware-specific checks, we believe that it has been designed to run on any vendor's\nhardware configured to use the Microsoft Extended Financial Services middleware (XFS).\nOne more thing about the use of packers: Alice uses the commercially available VMProtect\npacker, but it is far from alone. We found GreenDispenser packed with Themida, and Ploutus\npacked with Phoenix Protector, among others. Packing makes analysis and reverse\nengineering more difficult. Common malware has been using this technique for years, with\nmalware today using custom-built packers. So why are ATM malware authors only just now\ndiscovering packing and obfuscation techniques? Up until recently, ATM malware was a\nniche category in the malware universe, used by a handful of criminal gangs in a highly\ntargeted manner. We are now at a point where ATM malware is becoming mainstream. The\ndifferent ATM malware families have been thoroughly analyzed and discussed by many\nsecurity vendors and these criminals have now started to see the need to hide their creations\nfrom the security industry to avoid discovery and detection. Today, they are using commercial\noff-the-shelf packers; tomorrow we expect to see them start to use custom packers and other\nobfuscation techniques. Further technical details and a comparison of various ATM malware\n[families can be found in this appendix. Indicators of Compromise The files used in this](https://documents.trendmicro.com/assets/appendix-alice-lightweight-compact-atm-malware-2.pdf)\nanalysis have the following SHA256 hashes:\n\n04F25013EB088D5E8A6E55BDB005C464123E6605897BD80AC245CE7CA12A7A70\nB8063F1323A4AE8846163CC6E84A3B8A80463B25B9FF35D70A1C497509D48539\n\nMalware\n\nWe have discovered a new family of ATM malware called Alice, which is the most stripped\ndown ATM malware family we have ever encountered. Alice cannot be controlled via the\nnumeric pad of ATMs; neither does it have information stealing features.\n\nBy: David Sancho December 20, 2016 Read time: ( words)\n\nContent added to Folio\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2016/2016-12-20 - Alice- A Lightweight, Compact, No-Nonsense ATM Malware.pdf"
    ],
    "report_names": [
        "2016-12-20 - Alice- A Lightweight, Compact, No-Nonsense ATM Malware.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535757,
    "ts_updated_at": 1743041369,
    "ts_creation_date": 1653764633,
    "ts_modification_date": 1653764633,
    "files": {
        "pdf": "https://archive.orkl.eu/c12c7da174a63e788d3c6777d166853724f30dc9.pdf",
        "text": "https://archive.orkl.eu/c12c7da174a63e788d3c6777d166853724f30dc9.txt",
        "img": "https://archive.orkl.eu/c12c7da174a63e788d3c6777d166853724f30dc9.jpg"
    }
}