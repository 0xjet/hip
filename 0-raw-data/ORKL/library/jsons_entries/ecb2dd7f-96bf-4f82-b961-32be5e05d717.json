{
    "id": "ecb2dd7f-96bf-4f82-b961-32be5e05d717",
    "created_at": "2023-01-12T15:05:04.766234Z",
    "updated_at": "2025-03-27T02:09:33.391108Z",
    "deleted_at": null,
    "sha1_hash": "2d48ef726373aefacd75bdaaca2e9cfb76fd80c4",
    "title": "2019-07-11 - Buhtrap group uses zero‑day in latest espionage campaigns",
    "authors": "",
    "file_creation_date": "2022-05-27T21:49:22Z",
    "file_modification_date": "2022-05-27T21:49:22Z",
    "file_size": 810047,
    "plain_text": "# Buhtrap group uses zero‑day in latest espionage campaigns\n\n**[welivesecurity.com/2019/07/11/buhtrap-zero-day-espionage-campaigns/](https://www.welivesecurity.com/2019/07/11/buhtrap-zero-day-espionage-campaigns/)**\n\nJuly 11, 2019\n\nESET research reveals notorious crime group also conducting espionage campaigns for the\npast five years\n\n[Jean-Ian Boutin](https://www.welivesecurity.com/author/boutin/)\n\n\n-----\n\n11 Jul 2019 - 11:30AM\n\nESET research reveals notorious crime group also conducting espionage campaigns for the\npast five years\n\n[The Buhtrap group is well known for its targeting of financial institutions and businesses in](https://www.welivesecurity.com/2015/04/09/operation-buhtrap/)\nRussia. However, since late 2015, we have witnessed an interesting change in its traditional\ntargets. From a pure criminal group perpetrating cybercrime for financial gain, its toolset has\nbeen expanded with malware used to conduct espionage in Eastern Europe and Central\nAsia.\n\nThroughout our tracking, we’ve seen this group deploy its main backdoor as well as other\ntools against various victims, but June 2019 was the first time we saw the Buhtrap group\nuse a [zero-day exploit as part of a campaign. In that case, we observed Buhtrap using a](https://www.welivesecurity.com/2019/07/10/windows-zero-day-cve-2019-1132-exploit/)\nlocal privilege escalation exploit, CVE-2019-1132, against one of its victims.\n\nThe exploit abuses a local privilege escalation vulnerability in Microsoft Windows,\nspecifically a NULL pointer dereference in the win32k.sys component. Once the exploit was\ndiscovered and analyzed, it was reported to the Microsoft Security Response Center, who\n[promptly fixed the vulnerability and released a patch.](https://portal.msrc.microsoft.com/en-us/security-guidance/advisory/CVE-2019-1132)\n\nThis blog post covers the evolution of Buhtrap from a financial crime to an espionage\nmindset.\n\n## History\n\nThe timeline in Figure 1 highlights some of the most important developments in Buhtrap\nactivity.\n\n_Figure 1. Important events in Buhtrap timeline_\n\nIt is always difficult to attribute a campaign to a particular actor when their tools’ source\ncode is freely available on the web. However, as the shift in targets occurred before the\nsource code leak, we assess with high confidence that the same people behind the first\nBuhtrap malware attacks against businesses and banks are also involved in targeting\ngovernmental institutions.\n\n\n-----\n\nAlthough new tools have been added to their arsenal and updates applied to older ones, the\ntactics, techniques and procedures (TTPs) used in the different Buhtrap campaigns have\nnot changed dramatically over all these years. They still make extensive use of NSIS\ninstallers as droppers and these are mainly delivered through malicious documents. Also,\nseveral of their tools are signed with valid code-signing certificates and abuse a known,\nlegitimate application to side-load their malicious payloads.\n\nThe documents employed to deliver the malicious payloads often come with benign decoy\ndocuments to avoid raising suspicions if the victim opens them. The analysis of these decoy\ndocuments provides clues about who the targets might be. When Buhtrap was targeting\nbusinesses, the decoy documents would typically be contracts or invoices. Figure 2 is a\ntypical example of a generic invoice the group used in a campaign in 2014.\n\n_Figure 2. Decoy document used in campaigns against Russian businesses_\n\nWhen the group’s focus shifted to banks, the decoy documents were related to banking\nsystem regulations or advisories from FinCERT, an organization created by the Russian\ngovernment to provide help and guidance to its financial institutions (such as the example in\nFigure 3).\n\n\n-----\n\n_Figure 3. Decoy document used in campaigns against Russian financial institutions_\n\nHence, when we first saw decoy documents related to government operations, we\nimmediately started to track these new campaigns. One of the first malicious samples\nshowing such a change was noticed in December 2015. It downloaded an NSIS installer\nwhose role was to install the main Buhtrap backdoor, but the decoy document – seen in\nFigure 4 – was intriguing.\n\n_Figure 4. Decoy document used in campaigns against governmental organizations_\n\n\n-----\n\nThe URL in the text is revealing. It is very similar to the State Migration Service of Ukraine\nwebsite, dmsu.gov.ua. The text, in Ukrainian, asks employees to provide their contact\ninformation, especially their email addresses. It also tries to convince them to click on the\nmalicious domain included in the text.\n\nThis was the first of many malicious samples we encountered being used by the Buhtrap\ngroup to target government institutions . Another, more recent decoy document that we\nbelieve was also distributed by the Buhtrap group is seen in Figure 5 – a document which\nwould appeal to a very different set of people, but still government-related.\n\n_Figure 5. Decoy documents used in campaigns against governmental organizations_\n\n## Analysis of the targeted campaigns leading to zero-day usage\n\nThe tools used in the espionage campaigns were very similar to those used against\nbusinesses and financial institutions. One of the first malicious samples we analyzed that\ntargeted governmental organizations was a sample with SHA-1 hash\n2F2640720CCE2F83CA2F0633330F13651384DD6A. This NSIS installer downloads the\nregular package containing the Buhtrap backdoor and displays the decoy document shown\nin Figure 4.\n\nSince then, we’ve seen several different campaigns against governmental organizations\ncoming from this group. In these, they were routinely using vulnerabilities to elevate their\nprivileges in order to install their malware. We’ve seen them exploit old vulnerabilities such\nas CVE-2015-2387. However, they were always known vulnerabilities. The zero-day they\nused recently was part of the same pattern: using it so that they could run their malware\nwith the highest privileges.\n\nThroughout the years, packages with different functionalities appeared. Recently, we found\ntwo new packages that are worth describing as they deviate from the typical toolset.\n\n\n-----\n\n### Legacy backdoor with a twist – E0F3557EA9F2BA4F7074CAA0D0CF3B187C4472FF\n\nThis document contains a malicious macro that, when enabled, drops an NSIS installer\nwhose task is to prepare installation of the main backdoor. However, this NSIS installer is\nvery different from the earlier versions used by this group. It is much simpler and is only\nused to set the persistence and launch two malicious modules embedded within it.\n\nThe first module, called “grabber” by its author, is a standalone password stealer. It tries to\nharvest passwords from mail clients, browsers, etc., and sends them to a C&C server. This\nmodule was also detected as part of the campaign using the zero-day. This module uses\nstandard Windows APIs to communicate with its C&C server.\n\n_Figure 6. Grabber module network capabilities_\n\nThe second module is something that we have come to expect from Buhtrap operators: an\nNSIS installer containing a legitimate application that will be abused to side-load the\nBuhtrap main backdoor. The legitimate application that is abused in this case is AVZ, a free\nanti-virus scanner.\n\n### Meterpreter and DNS tunneling – C17C335B7DDB5C8979444EC36AB668AE8E4E0A72\n\nThis document contains a malicious macro that, when enabled, drops an NSIS installer\nwhose task is to prepare installation of the main backdoor. Part of the installation process is\nto set up firewall rules to allow the malicious component to communicate with the C&C\nserver. Next is a command example the NSIS installer uses to set up these rules:\n\ncmd.exe /c netsh advfirewall firewall add rule name=\\”Realtek HD Audio Update Utility\\”\ndir=in action=allow program=\\”<path>\\RtlUpd.exe\\” enable=yes profile=any\n\nHowever, the final payload is something that we have never seen associated with Buhtrap.\nEncrypted in its body are two payloads. The first one is a very small shellcode downloader,\nwhile the second one is Metasploit’s Meterpreter. Meterpreter is a reverse shell that grants\n\n\n-----\n\nits operators full access to the compromised system.\n\nThe Meterpreter reverse shell actually uses DNS tunnelling to communicate with its C&C\n[server by using a module similar to what is described here. Detecting DNS tunnelling can](http://asintsov.blogspot.com/2017/12/data-exfiltration-in-metasploit.html)\nbe difficult for defenders, since all malicious traffic is done via the DNS protocol, as opposed\nto the more regular TCP protocol. Below is a snippet of the initial communication of this\nmalicious module.\n\n7812.reg0.4621.toor.win10.ipv6-microsoft[.]org\n7812.reg0.5173.toor.win10.ipv6-microsoft[.]org\n7812.reg0.5204.toor.win10.ipv6-microsoft[.]org\n7812.reg0.5267.toor.win10.ipv6-microsoft[.]org\n7812.reg0.5314.toor.win10.ipv6-microsoft[.]org\n7812.reg0.5361.toor.win10.ipv6-microsoft[.]org\n\n[…]\n\nThe C&C server domain name in this example is impersonating Microsoft. In fact, the\nattackers registered different domain names for these campaigns, most of them abusing\nMicrosoft brands in one way or another.\n\n## Conclusion\n\nWhile we do not know why this group has suddenly shifted targets, it is a good example of\nthe increasingly blurred lines between pure espionage groups and those primarily involved\nin crimeware activities. In this case, it is unclear if one or several members of this group\ndecided to change focus and for what reasons, but it is definitely something that we are\nlikely to see more of going forward.\n\n## Indicators of Compromise (IoCs)\n\n### ESET detection names\n\nVBA/TrojanDropper.Agent.ABM\n\nVBA/TrojanDropper.Agent.AGK\n\nWin32/Spy.Buhtrap.W\n\nWin32/Spy.Buhtrap.AK\n\nWin32/RiskWare.Meterpreter.G\n\n### Malware samples\n\n**_Main packages SHA-1_**\n\n\n-----\n\n2F2640720CCE2F83CA2F0633330F13651384DD6A\nE0F3557EA9F2BA4F7074CAA0D0CF3B187C4472FF\nC17C335B7DDB5C8979444EC36AB668AE8E4E0A72\n\n**_Grabber SHA-1_**\n\n9c3434ebdf29e5a4762afb610ea59714d8be2392\n\n### C&C servers\n\nhttps://hdfilm-seyret[.]com/help/index.php\n\nhttps://redmond.corp-microsoft[.]com/help/index.php\n\ndns://win10.ipv6-microsoft[.]org\n\nhttps://services-glbdns2[.]com/FIGm6uJx0MhjJ2ImOVurJQTs0rRv5Ef2UGoSc\n\nhttps://secure-telemetry[.]net/wp-login.php\n\n### Certificates\n\n**Company name** **Fingerprint**\n\nYUVA-TRAVEL 5e662e84b62ca6bdf6d050a1a4f5db6b28fbb7c5\n\nSET&CO LIMITED b25def9ac34f31b84062a8e8626b2f0ef589921f\n\n## MITRE ATT&CK techniques\n\n**Tactic** **ID** **Name** **Description**\n\nExecution [T1204](https://attack.mitre.org/techniques/T1204/) User execution The user must run the\nexecutable.\n\n\n[T1106](https://attack.mitre.org/techniques/T1106/) Execution through\nAPI\n\n[T1059](https://attack.mitre.org/techniques/T1059/) Command-Line\nInterface\n\n\nExecutes additional\nmalware through\nCreateProcess.\n\nSome packages\nprovide Meterpreter\nshell access.\n\n\nPersistence [T1053](https://attack.mitre.org/techniques/T1053/) Scheduled Task Some of the packages create\na scheduled task to be\nexecuted periodically.\n\n\nDefense\nevasion\n\n\n[T1116](https://attack.mitre.org/techniques/T1116/) Code Signing Some of the samples are\nsigned.\n\n\n-----\n\n**Tactic** **ID** **Name** **Description**\n\n\nCredential\nAccess\n\n\n[T1056](https://attack.mitre.org/techniques/T1056/) Input Capture Backdoor contains a\nkeylogger.\n\n\n[T1111](https://attack.mitre.org/techniques/T1111/) Two-Factor\nAuthentication\nInterception\n\n\nBackdoor actively\nsearches for a\nconnected smart card.\n\n\nCollection [T1115](https://attack.mitre.org/techniques/T1115/) Clipboard Data Backdoor logs clipboard\ncontent.\n\nExfiltration [T1020](https://attack.mitre.org/techniques/T1020/) Automated Exfiltration Log files are automatically\nexfiltrated.\n\n[T1022](https://attack.mitre.org/techniques/T1022/) Data Encrypted Data sent to C&C is\nencrypted.\n\n\n[T1041](https://attack.mitre.org/techniques/T1041/) Exfiltration Over\nCommand and\nControl Channel\n\n\nExfiltrated data is sent\nto a server.\n\n\nCommand\nand Control\n\n\n[T1043](https://attack.mitre.org/techniques/T1043/) Commonly Used Port Communicates with a server\nusing HTTPS.\n\n\n[T1071](https://attack.mitre.org/techniques/T1071/) Standard\nApplication Layer\nProtocol\n\n[T1094](https://attack.mitre.org/techniques/T1094/) Custom\nCommand and\nControl Protocol\n\n\nHTTPS is used.\n\nMeterpreter is using\nDNS tunneling to\ncommunicate.\n\n\n[T1105](https://attack.mitre.org/techniques/T1105/) Remote File Copy Backdoor can\ndownload and execute\nfile from C&C server.\n\n11 Jul 2019 - 11:30AM\n\n### Sign up to receive an email update whenever a new article is published in our Ukraine Crisis – Digital Security Resource Center\n\n Newsletter\n\n\n-----\n\n### Discussion\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-07-11 - Buhtrap group uses zero‑day in latest espionage campaigns.pdf"
    ],
    "report_names": [
        "2019-07-11 - Buhtrap group uses zero‑day in latest espionage campaigns.pdf"
    ],
    "threat_actors": [
        {
            "id": "3b046db2-f60e-49ae-8e16-0cf82a4be6fb",
            "created_at": "2022-10-25T16:07:23.427162Z",
            "updated_at": "2025-03-27T02:02:09.79482Z",
            "deleted_at": null,
            "main_name": "Buhtrap",
            "aliases": [
                "Buhtrap",
                "Operation TwoBee",
                "Ratopak Spider",
                "UAC-0008"
            ],
            "source_name": "ETDA:Buhtrap",
            "tools": [
                "AmmyyRAT",
                "Buhtrap",
                "CottonCastle",
                "FlawedAmmyy",
                "NSIS",
                "Niteris EK",
                "Nullsoft Scriptable Install System",
                "Ratopak"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "01d569b1-f089-4a8f-8396-85078b93da26",
            "created_at": "2023-01-06T13:46:38.411615Z",
            "updated_at": "2025-03-27T02:00:02.826863Z",
            "deleted_at": null,
            "main_name": "BuhTrap",
            "aliases": [],
            "source_name": "MISPGALAXY:BuhTrap",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535904,
    "ts_updated_at": 1743041373,
    "ts_creation_date": 1653688162,
    "ts_modification_date": 1653688162,
    "files": {
        "pdf": "https://archive.orkl.eu/2d48ef726373aefacd75bdaaca2e9cfb76fd80c4.pdf",
        "text": "https://archive.orkl.eu/2d48ef726373aefacd75bdaaca2e9cfb76fd80c4.txt",
        "img": "https://archive.orkl.eu/2d48ef726373aefacd75bdaaca2e9cfb76fd80c4.jpg"
    }
}