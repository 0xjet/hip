{
    "id": "d49d8e1b-edc0-4cac-b35d-e6237d434ed9",
    "created_at": "2023-01-12T15:00:43.487475Z",
    "updated_at": "2025-03-27T02:16:26.236616Z",
    "deleted_at": null,
    "sha1_hash": "156b76c8ff9049b1e71cdd9d4ee9f6165d02055e",
    "title": "2019-07-03 - BianLian- A New Wave Emerges",
    "authors": "",
    "file_creation_date": "2022-05-28T00:24:16Z",
    "file_modification_date": "2022-05-28T00:24:16Z",
    "file_size": 225702,
    "plain_text": "# BianLian: A New Wave Emerges\n\n**[fortinet.com/blog/threat-research/new-wave-bianlian-malware.html](https://www.fortinet.com/blog/threat-research/new-wave-bianlian-malware.html)**\n\n**_FortiGuard Labs Breaking Threat Research_**\n\n\nJuly 3, 2019\n\n\nRecently, during our daily malware analysis routine, members of the FortiGuard Labs team\nencountered an Android sample that did not look familiar.\n\n## Analysis\n\nAt a first look, it seemed clear that the APK was heavily obfuscated, and was possibly\npacked using some technique we had not seen before. This is not to say that it uses an\nextremely complicated technique. It seems to mostly rely on generating a variety of random\nfunctions to hide the real functionalities of the sample.\n\nDuring our initial examination, we also spotted some interesting code amongst the rubbish\nfunctions being generated, so we decided to run the sample through FortiGuard’s in-house\nAPK sandbox analysis system to gather more information from its both static and dynamic\nanalysis.\n\n## Sandbox Results\n\n\n-----\n\nThe results obtained from the sandbox helped us understanding the sample. First of all, in\nthe Dex operation section, where a dynamically loaded file should be logged, there are two\nentries. The first is related to the loading of the main application itself, and a second refers to\na file conveniently called “payload.apk” – which means that the sample will likely install an\nadditional application during execution. However, most of the interesting calls, like\ninformation exfiltration and connection initiations, are executed from the code in the first\napplication.\n\nWith this information in hand, and being familiar with recent malware families, we had a\nhunch as to what malware this could be. However, first things first: we needed to get rid of its\nvery annoying obfuscation.\n\n## Obfuscation Analysis\n\nThe code base is very messy as it is mostly comprised of randomly generated garbage.\nFortunately, the template is very identifiable, and most of the classes are useless, having no\nreal functionality at all. However, when first analyzing this application, the sheer number of\ndifferent classes can seem discouraging. Fortunately, the template for these junk-classes is\nvery predictable.\n\nEvery junk-class sports a name composed of random lowercase and uppercase characters.\n\nFigure 1: Randomly generated useless class\n\nIn addition, there is a clear difference between the classes that are useless and the ones that\ncontain used code. Conveniently enough, all of the interesting classes maintain their original\nname. However, to complicate things further, it looks like every legitimate function or\npackage is accompanied by 7 functions or packages performing useless calculations.\n\nMost of the strings in the code are generated by using functions implementing a XOR\ndecryption of byte arrays – a simple but relatively effective solution. Every string corresponds\nto a specific function that accepts no arguments and returns a `String` object.\n\nIn the screenshots used in the analysis section below, what is shown is the de-obfuscated\nversion of the code. We will not go through the process on how to obtain that in this report,\nbecause it is very boring and straight forward. It simply requires the elimination of many\nunnecessary functions and the execution of the ones yielding the required strings.\n\nAt this point we want to give a big shout-out to Max 'Libra' Kersten and his\n[AndroidProjectCreator for making this de-obfuscation process less painful than we](https://maxkersten.nl/projects/androidprojectcreator/)\nanticipated. If you have not heard about this project, go and check it out.\n\n## Malware Analysis\n\n\n-----\n\nAs identified in the title of this blogpost, this obfuscated sample belongs to the BianLian\nmalware family, discussed for the first time by [ThreatFabric in 2018.](https://www.threatfabric.com/blogs/bianlian_from_rags_to_riches_the_malware_dropper_that_had_a_dream.html)\n\nBianLIan started as a dropper for other malware, but developers quickly began to implement\ntheir own malicious code that primarily targets Turkish banking applications.\n\nIn true Android malware fashion, the first thing the application does is hide its icon and\nconstantly requests permission to abuse Accessibility services functionalities until granted.\n\nFigure 2: Permission requests\n\nOnce these are obtained, it initiates all of its modules. Compared to its 2018 version, the\nauthors behind this update have added some new functionalities. In addition to extensively\nabusing Accessibility services, it includes the following modules. This list include modules\nfrom the old and wave of BianLian as well as those added in this new version:\n\n**text: Module used to send, receive, and log SMS messages**\n**ussd: Module used to run USSD codes and make calls**\n**injects: Module used to run overlay attacks, mostly on banking applications**\n**locker: Module used to lock the screen, rendering the device unusable for a user**\n\nIn addition to these modules, this BianLian sample included also the following two modules\nthat we will describe in more detail below:\n\n**screencast**\n**socks5**\n\n## Screencast Module\n\nThe Screencast Module allows the malware to record the screen of the device. It uses the\nandroid package android.media.projection.MediaProjection to create a virtual display to\nscreencast.\n\nIt first checks if the screen is locked. If it is, it releases the lock and then starts its recording.\nThe recording is started remotely, as with other functionalities, using FCM (Firebase Cloud\nMessaging).\n\nFigure 3: Screencast Module\n\n## Socks5 Module\n\nThis module is used to create a functioning SSH server on the device using JSCH (Java\nSecure Channel), a library that implements SSH2 in pure Java. By using this tool, BianLian\ncan setup a proxy that can run SSH sessions using remote port forwarding on port 34500,\n\n\n-----\n\nwith an implementation similar to 2017 s malware MilkyDoor, making communication with the\nCC harder to detect.\n\nFigure 4: Socks5 Module\n\n## Dropped Files\n\nBianLian started its career in the malware industry as a dropper, so it is not surprising to find\na payload in this sample. In the older versions of BianLian, this payload was decrypted from\nthe assets of the APK, while in this case it is downloaded from the CC.\n\nThe dropped APK is actually far less interesting, and in fact, not actually a malware by itself.\nThe code base is very limited and performs only one function. It checks to see if Google Play\nProtect is active through the Google SafetyNet API. This code is loaded and used by the\nmain application through Java reflection.\n\nFigure 5: Payload.apk execution\n\nIt is worth reemphasizing that this payload is not a different malware, but rather, a tool used\nby BianLian.\n\n## Conclusion\n\nBianLian seems to still be under active development. The added functionalities, even though\nnot completely original, are effective and make this family a potentially dangerous one. Its\ncode base and strategies put it on a par with the other big players in the banking malware\nspace.\n\nIn addition, its new obfuscation technique, even though not very complicated, is still capable\nof tricking string-based detection, and would be very hard to detect with static analysis alone\nwhen encountered for the first time.\n\nWhile looking around for similar malware, we also encountered some Anubis samples using\nthis same obfuscation algorithm. This suggests that the author of this obfuscator is either\nselling it on hacking forums, or was able to get his hands on the source code of these two\nfamilies of malware.\n\nFortiGuard Labs has been following this family since it was first detected, and will continue to\nkeep on the lookout for new threats.\n\n-= FortiGuard Lion =\n## Solutions\n\nFortinet customers are protected by the following signatures:\n\n\n-----\n\nThe BianLian sample analyzed is detected as Android/Agent.AMJ!tr\nThe Anubis sample mentioned is detected as Android/Agent.JA!tr\n\n## IOC\n\n**BianLian: ac32dc236fea345d135bf1ff973900482cdfce489054760601170ef7feec458f**\n\n**Payload: 75e162dc291e15d13b0f3202a66e0c88ff2db09ec02922ee64818dbddcb78d6d**\n\n**Anubis: a99eb900d03aa1dd70d7712da7c42cc37ee2f2e21d763acd6ddf71a4027ed504**\n\n**CCs:**\n\nhxxps://tombaba[.]club\n\nhxxps://tomcatdomains[.]page[.]link\n\n**Banking applications targeted:**\n\ncom.akbank.android.apps.akbank_direkt\n\ncom.albarakaapp\n\ncom.binance.dev\n\ncom.btcturk\n\ncom.denizbank.mobildeniz\n\ncom.finansbank.mobile.cepsube\n\ncom.garanti.cepsubesi\n\ncom.ingbanktr.ingmobil\n\ncom.kuveytturk.mobil\n\ncom.magiclick.odeabank\n\ncom.mobillium.papara\n\ncom.pozitron.iscep\n\ncom.teb\n\ncom.thanksmister.bitcoin.localtrader\n\ncom.tmobtech.halkbank\n\ncom.vakifbank.mobile\n\ncom.ykb.android\n\ncom.ziraat.ziraatmobil\n\nfinansbank.enpara\n\ntr.com.hsbc.hsbcturkey\n\ntr.com.sekerbilisim.mbank\n\n_[Learn more about FortiGuard Labs and the FortiGuard Security Services portfolio.](https://www.fortinet.com/fortiguard/threat-intelligence/threat-research.html?utm_source=nreleaseblog&utm_campaign=2018-q2-fortiguardlabs-cta)_ _Sign_\n_up for our weekly FortiGuard Threat Brief._\n\n_[Read about the FortiGuard Security Rating Service, which provides security audits and best](https://www.fortinet.com/support-and-training/support-services/fortiguard-security-subscriptions/security-rating.html?utm_source=blog&utm_campaign=2018-blog-security-rating-service)_\n_practices._\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-07-03 - BianLian- A New Wave Emerges.pdf"
    ],
    "report_names": [
        "2019-07-03 - BianLian- A New Wave Emerges.pdf"
    ],
    "threat_actors": [
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535643,
    "ts_updated_at": 1743041786,
    "ts_creation_date": 1653697456,
    "ts_modification_date": 1653697456,
    "files": {
        "pdf": "https://archive.orkl.eu/156b76c8ff9049b1e71cdd9d4ee9f6165d02055e.pdf",
        "text": "https://archive.orkl.eu/156b76c8ff9049b1e71cdd9d4ee9f6165d02055e.txt",
        "img": "https://archive.orkl.eu/156b76c8ff9049b1e71cdd9d4ee9f6165d02055e.jpg"
    }
}