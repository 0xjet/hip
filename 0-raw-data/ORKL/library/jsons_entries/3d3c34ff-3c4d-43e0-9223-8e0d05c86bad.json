{
    "id": "3d3c34ff-3c4d-43e0-9223-8e0d05c86bad",
    "created_at": "2023-01-12T15:03:53.038002Z",
    "updated_at": "2025-03-27T02:06:07.688845Z",
    "deleted_at": null,
    "sha1_hash": "ec55ff5a2d00dc8f7863c379067ac91520b0686d",
    "title": "2022-02-24 - How to Decrypt the Files Encrypted by the Hive Ransomware",
    "authors": "",
    "file_creation_date": "2022-05-28T17:29:35Z",
    "file_modification_date": "2022-05-28T17:29:35Z",
    "file_size": 397876,
    "plain_text": "# How to Decrypt the Files Encrypted by the Hive Ransomware\n\n**[lifars.com/2022/02/how-to-decrypt-the-files-encrypted-by-the-hive-ransomware/](https://lifars.com/2022/02/how-to-decrypt-the-files-encrypted-by-the-hive-ransomware/)**\n\nFebruary 24, 2022\n\nSouth Korean researchers published an academic paper that presents a method to decrypt\nthe files encrypted by the Hive Ransomware [1]. This article highlights the main findings of\nthe paper and our comments regarding the feasibility of creating a universal decryptor for\nHive.\n\nHive ransomware appeared around June 2021 and infected multiple companies. Two\nimportant victims of Hive are the Altus Group [2] and Memorial Health System [3].\n\nThe ransomware generates 10MB of random data using the rand function in the Go\nlanguage, which is called the Master Key. For each file that will be encrypted, Hive extracts\n1MB and 1KB of data from specific offsets and uses them as a keystream. These offsets are\nstored in the encrypted file names and can be used to extract the keystream used for\nencryption.\n\n\n-----\n\nHive encrypts a file using the XOR operator with a random keystream. The Master Key is\nencrypted using a hard-coded RSA-2048 public key and stored in the “C:\\” folder or\n“C:\\Users\\<User>\\AppData\\Local\\VirtualStore” depending on the user’s privileges.\n\nThe ransomware creates a ransom note called HOW_TO_DECRYPT.txt in every targeted\ndirectory. Whether it’s running with admin privileges, Hive also encrypts the files located in\nthe “C:\\Users\\Program Files(x86)”, “C:\\Users\\Program Files”, and “C:\\Users\\ProgramData”\ndirectories.\n\nThe malware generates two random numbers R1 and R2, which are 8 bytes long using the\nrand function of the Math package. It defines the following values:\n\nKeystream1 offset (SP1) = R1 % 0x900000\nKeystream2 offset (SP2) = R2 % 0x9FFC00\nKeystream1 = Master Key [SP1:SP1+0x100000], 0x100000 bytes = 1MB\nKeystream2 = Master Key [SP2:SP2+0x400], 0x400 bytes = 1KB\n\nThe above selection is also shown in figure 1.\n\n_Figure 1_\n\nThe files are encrypted using the XOR operator:\n\nEncrypted Data [i] = Data [i] XOR Keystream1 [i % 0x100000] XOR Keystream2 [i %\n0x400]\n\nwhich is equivalent to:\n\nEKS [i] = Keystream1 [i] XOR Keystream2 [i % 0x400], i = 0,1, 2, …, 0xFFFFF\nEncrypted Data = Data [offset] XOR EKS [offset % 0x100000]\n\n\n-----\n\nAll files are partially encrypted: 0x1000 encrypted bytes (4KB) alternatively followed by the\nnon-encrypted data block (NBS bytes computed based on a file size). A visual representation\nof an encrypted file is displayed in figure 2.\n\n_Figure 2_\n\nA weakness of the above process is the fact that some keystreams will be partially reused\nwhen encrypting a lot of files. At least one of the following two conditions is required in order\nto decrypt files:\n\nSome original files corresponding to the encrypted files are available\nA lot of files with known signatures (.pdf, .xlsx, .hwp) have to be encrypted\n\nAn example provided by researchers regarding obtaining the original files represents the\ncontent of the Program Files, Program Files (x86), and ProgramData directories that are\nencrypted by the Hive ransomware. Some of these files are software files (Java, Python,\nMicrosoft Office) that aren’t related to the OS, which can be downloaded from the Internet.\nThe keystream (EKS) can be computed by XOR-ing the original file with the encrypted\ncontent.\n\nThe academic paper presents the pseudocode of 3 algorithms: “Calculation of the nonencrypted data block size”, “Calculation of the start offsets of Keystream1 and Keystream2”,\nand “Hive ransomware master key recovery”.\n\nThe researchers performed multiple experiments and concluded that it’s better to mix various\nfile sizes for recovering the Master Key:\n\nAverage file size Number of files Master key recovery rate (%)\n\n1KB 9 95.85\n\n2–127KB 24 95.85\n\n128–1,023KB 19 95.85\n\n1–10MB 19 95.85\n\n\n-----\n\n10–100MB 20 95.85\n\nUsing the Master Key that was partially recovered, we could decrypt most of the encrypted\nfiles, as highlighted in figure 3:\n\n_Figure 3_\n\nOur company has been engaged in a lot of ransomware engagements in the past and has\nanalyzed most of the ransomware families that are still active in the wild. We believe that\neven if there is a theoretical chance to create a universal decryptor for the Hive ransomware,\nit’s way easier to investigate an individual infection and decide whether the environment\nmeets at least one of the necessary conditions to decrypt the files: at least tens of the\nunencrypted files should be available, or a lot of files with known signatures should have\nbeen encrypted (there is no number specified in the paper, this might be even infeasible).\n\n**References:**\n\n[1] [https://arxiv.org/pdf/2202.08477.pdf](https://arxiv.org/pdf/2202.08477.pdf)\n\n\n-----\n\n[2] https://cybernews.com/news/new-ransomware-group-hive-leaks-altus-group-samplefiles/\n\n[3] https://www.bleepingcomputer.com/news/security/hive-ransomware-attacks-memorialhealth-system-steals-patient-data/\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-02-24 - How to Decrypt the Files Encrypted by the Hive Ransomware.pdf"
    ],
    "report_names": [
        "2022-02-24 - How to Decrypt the Files Encrypted by the Hive Ransomware.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535833,
    "ts_updated_at": 1743041167,
    "ts_creation_date": 1653758975,
    "ts_modification_date": 1653758975,
    "files": {
        "pdf": "https://archive.orkl.eu/ec55ff5a2d00dc8f7863c379067ac91520b0686d.pdf",
        "text": "https://archive.orkl.eu/ec55ff5a2d00dc8f7863c379067ac91520b0686d.txt",
        "img": "https://archive.orkl.eu/ec55ff5a2d00dc8f7863c379067ac91520b0686d.jpg"
    }
}