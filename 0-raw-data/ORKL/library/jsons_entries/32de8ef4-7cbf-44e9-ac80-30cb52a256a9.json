{
    "id": "32de8ef4-7cbf-44e9-ac80-30cb52a256a9",
    "created_at": "2023-01-12T15:08:07.836024Z",
    "updated_at": "2025-03-27T02:05:39.66983Z",
    "deleted_at": null,
    "sha1_hash": "bfd01b1a9112064e526f3f4c32bdd4085bf589ef",
    "title": "2017-08-01 - TrickBot comes up with new tricks- attacking Outlook and browsing data",
    "authors": "",
    "file_creation_date": "2022-05-28T04:56:47Z",
    "file_modification_date": "2022-05-28T04:56:47Z",
    "file_size": 473013,
    "plain_text": "# TrickBot comes up with new tricks: attacking Outlook and browsing data\n\n**[blog.malwarebytes.com/threat-analysis/2017/08/trickbot-comes-with-new-tricks-attacking-outlook-and-browsing-data/](https://blog.malwarebytes.com/threat-analysis/2017/08/trickbot-comes-with-new-tricks-attacking-outlook-and-browsing-data/)**\n\nMalwarebytes Labs August 1, 2017\n\n[Last year, we reported on a new modular malware called TrickBot that uses a network](https://blog.malwarebytes.com/threat-analysis/2016/10/trick-bot-dyrezas-successor/)\nprotocol similar to Dyreza. The malware was not particularly stealthy, and some parts looked\nto be still under development, but we noticed its potential and capability to be easily\nextended.\n\nIndeed, the authors of [TrickBot are persistent not only in spreading their malware but also in](https://www.malwarebytes.com/trickbot/)\ndeveloping new features.\n\nSome of the novel changes applied to TrickBot were noted in Spanish cybersecurity\n[company S2Grupo’s June 2017 report called the Evolution of Trickbot.](https://www.securityartwork.es/wp-content/uploads/2017/07/Trickbot-report-S2-Grupo.pdf)\n\n[In addition, it has been found that developers added to the bot a worm module, probably](https://www.flashpoint-intel.com/blog/new-version-trickbot-adds-worm-propagation-module/)\ninspired by the success of other worm-equipped ransomware such as\n[WannaCry and](https://blog.malwarebytes.com/threat-analysis/2017/05/the-worm-that-spreads-wanacrypt0r/) [EternalPetya.](https://blog.malwarebytes.com/cybercrime/2017/06/petya-esque-ransomware-is-spreading-across-the-world/)\n\nBut authors of this malware didn’t stop there. Recently, we captured some additions that\nallow for TrickBot to attack Outlook and capture browsing data. For example, we noticed a\nnew module called Outlook.dll, which was written in Delphi (while most of the other modules\n\n\n-----\n\nare written in C++). This may indicate that the team of TrickBot developers gained some new\nmembers that are more comfortable with this particular language.\n\n## Analyzed samples\n\n**Downloaded modules (32 bit):**\n\n**[b6f9ba3fd8af478147c59b2f3b3043c7 – OutlookX32.dll](https://virustotal.com/en/file/d3ec8f4a46b21fb189fc3d58f3d87bf9897653ecdf90b7952dcc71f3b4023b4e/analysis/)**\n**[ac32c723c94e2c311db78fb798f2dd63 – module.dll (importDll32)](https://virustotal.com/en/file/5f13e8151fa80d8a85b4831fe79ec719b0c4e76693b8f7ca390e48b4abc9b179/analysis/1501507903/)**\n[f8e58af3ffefd4037fef246e93a55dc8 – mailsearcher.dll (mailsearcher32)](https://virustotal.com/en/file/df9b37477a83189cd4541674e64ce29bf7bf98338ed0d635276660e0c6419d09/analysis/)\n[25570c3d943c0d83d69b12bc8df29b9d – SystemInfo.dll (systeminfo32)](https://virustotal.com/en/file/7598c98926dd870969c80036f9a9584d1dbc7b81fae61018a6d34a2de640b870/analysis/1501507907/)\n[5ac93850e24e7f0be3831f1a7c463e9c – loader.dll (injectDll32), reflectively loads](https://virustotal.com/en/file/c7553b1f5a178c8ef8863045e8c0c0f2e89f4affde89c3ac3b62c663446c5089/analysis/)\nsubmodules:\n\n[69086a1e935446067ecb1d20bfa99266 – core-dll.dll](https://virustotal.com/en/file/16a7b338e48b6d99c9afe57a72b898411eda586647b25ad6709735807c966fb2/analysis/1501512045/)\n[b34d36c1c76b08e7b8f28d74fbf808d8 – rtbroker_dll.dll](https://virustotal.com/en/file/0e0d9bce079aaba3c29b049678981eb28e05744d28ce94c41612ce67f19cc9dc/analysis/1501512035/)\n\n## Behavioral analysis\n\nAs before, after being deployed, TrickBot installs itself in a new directory created in\n%APPDATA%. It runs a new instance from the installation directory.\n\nInside, it creates another directory—Modules—where it drops downloaded modules and their\nconfiguration files in encrypted form:\n\n\n-----\n\nThe way in which the modules and configuration files are encrypted didn’t change. We can\n[still use the same scripts to recover them.](https://github.com/hasherezade/malware_analysis/tree/master/trickbot)\n\nAfter decrypting config.conf, we got some more details about the current campaign: the\nversion of the analyzed configuration is 1000030 and the given group tag is tt0002.\nFragment:\n\nAs before, persistence is achieved with the help of a Scheduled Task:\n\nThe task deploys the main bot that, after being run, decrypts and loads other modules. Each\nmodule is injected into a new instance of svchost:\n\n## Inside the malware\n\n\n-----\n\nAs before, all the TrickBot modules follow a predefined API. They export four functions:\n\nControl\nFreeBuffer\nRelease\nStart\n\nAs mentioned in “behavioral analysis,” we observed five modules in the current run.\n_SystemInfo.dll and loader.dll (injectDll32) have been present in TrickBot_ since the very\nbeginning. The module mailsearcher.dll was introduced in December 2016 (according to the\nF5 DevCentral’s article). But there are some modules in the set that we haven’t seen\ndescribed before: module.dll and Outlook.dll.\n\n## module.dll/importDll32\n\nThis bulky module is written in C++, compiled with Qt5 and OpenSSL, and also incorporates\nSQLite. Inside the binary, we can find the strings indicating particular versions of the libraries:\n\nQt 5.6.2 (i386-little_endian-ilp32 static release build; by GCC 6.2.0)\nOpenSSL 1.0.2k 26 Jan 2017\n[2017-02-13 16:02:40 ada05cfa86ad7f5645450ac7a2a21c9aa6e57d2 (SQLite)](https://www.sqlite.org/releaselog/3_17_0.html)\n\n[We can also find references in the code. In the given example, QAbstractSocket class from](http://doc.qt.io/qt-5/qabstractsocket.html)\nQt library is used:\n\n\n-----\n\nDLL’s compilation timestamp indicates that it is pretty fresh, written in May 2017:\n```\n2017:05:27 14:27:06+01:00\n\n```\nFunctionality-wise, this module is focused on stealing data from the browsers, such as:\n\nCookies\nHTML5 local storage\nBrowsing history\nFlash LSO (Local Shared Objects)\nURL hits\n\n…and more.\n\nAuthors didn’t put any effort into hiding their intentions. Debug strings informing about every\naction taken are being printed. Examples:\n\n\n-----\n\nGrabbing URL hits:\n\n\n-----\n\n[In contrast to loader.dll/injectDll (referenced here), which is modular and stores all the](https://blog.malwarebytes.com/threat-analysis/2016/10/trick-bot-dyrezas-successor/)\nscripts and targets in dedicated configuration files, module.dll/importDll32 comes with all its\ndata hardcoded. For example, inside the binary we found a long list of targets—websites\nfrom countries all around the world, including France, Italy, Japan, Poland, Norway, Peru,\nand more:\n\n\n-----\n\n**Browser fingerprinting**\n\nDuring its run, the module creates a hidden desktop:\n\nThis desktop is used as a workspace where the malicious module can open and fingerprint\nbrowsers in a way that is not noticed by the user.\n\n\n-----\n\nInside the malware s code, we found hardcoded HTML files with JavaScripts that are used\nfor gathering information about the browser’s configuration. For example:\n\n[You can see the full content here.](https://gist.github.com/hasherezade/309d3cbfa7f3cd2115b67beb264d999f#file-fingerprint2-html)\n\nThis script, while being executed, fills the text area with the data gathered about the\nenvironment and passes this data to the malware:\n\nAnother script is used for gathering information on the plugins installed in Internet Explorer\n[(compare with this script):](http://www.darkwavetech.com/fingerprint/fingerprint_plugin.html)\n\n\n-----\n\n[You can see the full content here.](https://gist.github.com/hasherezade/309d3cbfa7f3cd2115b67beb264d999f#file-fingerprint1-html)\n\nThe scripts send the collected data in the POST request in the variable called marker_:\n\nThe data is received by the handler inside the TrickBot module:\n\n\n-----\n\nInterestingly, the malicious plugin also contains four base64-encoded pictures in PNG\nformat:\n\nDecoded pictures:\n\n**The SQL part**\n\nAmong the data hardcoded within the module.dll we can find a string referencing an SQLite\nrelease:\n```\n2017-02-13 16:02:40 ada05cfa86ad7f5645450ac7a2a21c9aa6e57d2\n\n```\nThe incorporated SQLite is used to retrieve and steal data such as cookies from locally\n[stored databases (similar to Terdot Zbot, described here, that also incorporated SQLite for](https://blog.malwarebytes.com/cybercrime/2017/01/zbot-with-legitimate-applications-on-board/)\nthis purpose):\n\n\n-----\n\nSample strings and queries to the cookies database:\n\nWe can see also queries used for stealing the stored browsing history:\n\n## Outlook.dll\n\nThis is the module written in Delphi. It contains a hardcoded configuration that follows a\npattern typical for TrickBot modules:\n```\n<moduleconfig> \n<autostart>no</autostart>\n</moduleconfig>\n\n```\nIts purpose is to steal data saved by Microsoft Outlook.\n\n\n-----\n\nThe module opens relevant registry keys and tries to retrieve saved credentials:\n\n## Not going away\n\n\n-----\n\nTrickBot s new modules are not written well and are probably still under development. The\noverall quality of the design is much lower than the quality of the earlier code. For example,\n_module.dll is bulky and does not follow the clean modular structure introduced by TrickBot_\nbefore. Also, they make use of languages and libraries that are easier, using Qt instead of\nnative sockets for module.dll, and Delphi language for Outlook.dll.\n\nThe differences in code, languages, and design may indicate that some changes were made\nto the development team. Either they gained new members who have been delegated to the\nnew tasks, or some of the previous members resigned and have been substituted with lower\nquality programmers. It may also be possible that the malware authors are doing some\nprototyping and experimenting for the further development.\n\nWhichever is the case, it’s clear that TrickBot is still actively maintained, and is not going to\nleave the threat landscape anytime soon.\n\n_This was a guest post written by hasherezade, an independent researcher and programmer_\n_with a strong interest in InfoSec. She loves describing malware in detail and sharing threat_\n_information with the community. Check her out_ _[on Twitter as well as on her personal blog,](https://twitter.com/hasherezade)_\n_[hasherezade’s 1001 nights.](https://hshrzd.wordpress.com/)_\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-08-01 - TrickBot comes up with new tricks- attacking Outlook and browsing data.pdf"
    ],
    "report_names": [
        "2017-08-01 - TrickBot comes up with new tricks- attacking Outlook and browsing data.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536087,
    "ts_updated_at": 1743041139,
    "ts_creation_date": 1653713807,
    "ts_modification_date": 1653713807,
    "files": {
        "pdf": "https://archive.orkl.eu/bfd01b1a9112064e526f3f4c32bdd4085bf589ef.pdf",
        "text": "https://archive.orkl.eu/bfd01b1a9112064e526f3f4c32bdd4085bf589ef.txt",
        "img": "https://archive.orkl.eu/bfd01b1a9112064e526f3f4c32bdd4085bf589ef.jpg"
    }
}