{
    "id": "fb393cf5-07cd-4b78-98e3-227c95eaa1d6",
    "created_at": "2022-10-25T16:48:17.977282Z",
    "updated_at": "2025-03-27T02:06:01.811748Z",
    "deleted_at": null,
    "sha1_hash": "292359e869860f8308c2cf789986fe7c12502553",
    "title": "#9 Blitzanalysis: Embassy Of Greece Beijing - Compromise",
    "authors": "R136a1",
    "file_creation_date": "2014-12-21T23:32:29Z",
    "file_modification_date": "2014-12-21T23:32:29Z",
    "file_size": 862513,
    "plain_text": "It's friday afternoon, I had a bit of free time and stumbled across this tweet by PhysicalDrive0 (thx!) two\n\nhours ago and thought to give it a try to finally add a new article to this Blog (first of 2014):\n\n[https://twitter.com/PhysicalDrive0/status/479921770838102017](https://twitter.com/PhysicalDrive0/status/479921770838102017)\n\nSo, I went to Google to search for the domain of the Embassy of Greece Beijing and added the (allegedly)\n\nmalicious java file package that was found by PhysicalDrive0:\n\n**URL: http://www.grpressbeijing.com/1.jar (malicious!)**\n\n[Next, I loaded the 1.jar file into Java Decompiler to get the source code. It showed, that the functionality is](http://jd.benow.ca/)\n\nobfuscated in some way, e.g. the function csfn(String paramString) decrypts all strings by \"removing\" the\n\nnumbers of the string parameter:\n\ncsfn(\"64s33333e3333t333S55e666c777u5r333i534t76y2M34a55n76a88g666e44r2222\") ->\n\nsetSecurityManager\n\nThere are some other obfuscation techniques, but they are not important here. Instead, the following\n\ndeobfuscated code line in the function init() gives us an idea where the actual payload is located:\n\nResp localResp = new Resp(csfn(\"234p34a55445c43654k632434234235\")); -> pack\n\nWe can also see, that the java package contains a file named pack, so we open 7-Zip and unpack the file. A\n\nquick view with a PE viewer showed, that it is a x86 PE executable not even encrypted (SHA256:\n\n_b832e4b5a4829c8df6de7b42c5cb32ef25b5ab59072b4c2a7838404cd0dd5e5f):_\n\n\n-----\n\nFigure 2: Payload inside Java package\n\nFigure 3: Payload inside PE viewer\n\nSo, I opened IDA Pro to take a quick look at the functionality. Together with the strings of the executable,\n\nwe get a brief idea of what the purpose of this malware is. The important strings are as follows:\n\nSELECT * FROM AntiVirusProduct\n\nreg add \"HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\" /v PrivDiscUiShown /t\n\nREG_DWORD /d 1 /f\n\nreg add \"HKCU\\Software\\Microsoft\\Internet Explorer\\Main\" /v DEPOff /t REG_DWORD /d 1 /f\n\nreg add \"HKCU\\Software\\Microsoft\\Internet Explorer\\Main\" /v DisableFirstRunCustomize /t\n\nREG_DWORD /d 2 /f\n\nreg add \"HKCU\\Software\\Microsoft\\Internet Explorer\\Main\" /v Check_Associations /t REG_SZ /d no\n\n/f\n\nreg add \"HKCU\\Software\\Microsoft\\Internet Explorer\\Main\"\n\n\n-----\n\nREG_DWORD /d 3 /f\n\nreg add \"HKCU\\Software\\Microsoft\\Internet Explorer\\PhishingFilter\" /v Enabled /t REG_DWORD /d\n\n1 /f\n\nreg add \"HKCU\\Software\\Microsoft\\Internet Explorer\\PhishingFilter\"\n\nreg add \"HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\" /v\n\nWarnOnPostRedirect /t REG_DWORD /d 0 /f\n\nreg add \"HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\" /v\n\nWarnonZoneCrossing /t REG_DWORD /d 0 /f\n\nreg add \"HKCU\\Software\\Microsoft\\Internet Connection Wizard\" /v AutoRecover /t REG_DWORD /d\n\n2 /f\n\nreg add \"HKCU\\Software\\Microsoft\\Internet Connection Wizard\" /v Completed /t REG_BINARY /d 1\n\n/f\n\n\\cmd.exe\n\nTogether with the output of IDA Pro, we can see that this malware uses the command line tool cmd.exe for\n\nadding several registry keys to Internet Explorer. It also tries to retrieve possible AntiVirus information by\n\nusing the COM interface (dc12a687-737f-11cf-884d-00aa004b2e24 -> IWbemLocator -> SELECT *\n\n_FROM AntiVirusProduct). Furthermore, it makes use of the COM to launch an instance of Internet_\n\nExplorer (d30c1661-cdaf-11d0-8a3e-00c04fc9e26e -> IWebBrowser2), supposedly to contact its C&C\n\nserver. To verify this, we open up Wireshark and run the executable. As a result, we get the following\n\nnetwork information:\n\n**C&C server: defense.miraclecz.com (IP: 208.115.124.83)**\n\n**HTTP GET request: /index.asp?id=50100**\n\nAlso, we see that it downloads some kind of data (Base64 encoded). But first, we combine the C&C server\n\nand the HTTP request and open the URL in our favorite Browser:\n\n\n-----\n\nFigure 4: Base64 encoded (2nd) Payload\n\n**URL: defense.miraclecz.com/index.asp?id=50100**\n\nAs you can see, there is a string named microsoft followed by Base64 encoded data. Side note: Is there\n\n_also a Linux equivalent?_\n\nNext, we copy the Base64 encoded data and go to the following website to let us decode it into a file\n\n(because I had the feeling it's just another unencrypted executable):\n\n[http://www.motobit.com/util/base64-decoder-encoder.asp](http://www.motobit.com/util/base64-decoder-encoder.asp)\n\nAs a result, we get another executable (SHA256:\n\n_a4863f44f48d1c4c050dd7baad767a86b348dd4d33924acf4e0a3cd40c6ae29f) that was only Base64_\n\nencoded and not encrypted in any way:\n\n\n-----\n\nSo again, we fire up our PE viewer and take a look at the important strings:\n\nhttp://buy.miraclecz.com\n\nreg add \"HKCU\\Software\\Microsoft\\Internet Explorer\\Main\" /v DEPOff /t REG_DWORD /d 1 /f\n\nreg add \"HKCU\\Software\\Microsoft\\Internet Explorer\\Main\" /v DisableFirstRunCustomize /t\n\nREG_DWORD /d 2 /f\n\nreg add \"HKCU\\Software\\Microsoft\\Internet Explorer\\Main\" /v Check_Associations /t REG_SZ /d no\n\n/f\n\nreg add \"HKCU\\Software\\Microsoft\\Internet Explorer\\Main\"\n\nreg add \"HKCU\\Software\\Microsoft\\Internet Explorer\\PhishingFilter\" /v ShownVerifyBalloon /t\n\nREG_DWORD /d 3 /f\n\nreg add \"HKCU\\Software\\Microsoft\\Internet Explorer\\PhishingFilter\" /v Enabled /t REG_DWORD /d\n\n1 /f\n\nreg add \"HKCU\\Software\\Microsoft\\Internet Explorer\\PhishingFilter\"\n\nreg add \"HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\" /v\n\nWarnOnPostRedirect /t REG_DWORD /d 0 /f\n\nreg add \"HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\" /v\n\nWarnonZoneCrossing /t REG_DWORD /d 0 /f\n\nreg add \"HKCU\\Software\\Microsoft\\Internet Connection Wizard\" /v AutoRecover /t REG_DWORD /d\n\n2 /f\n\nreg add \"HKCU\\Software\\Microsoft\\Internet Connection Wizard\" /v Completed /t REG_BINARY /d 1\n\n/f\n\nreg add \"HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\" /v spoolsv.exe /t REG_SZ /d\n\n%%temp%%\\spoolsv.exe /f\n\nspoolsv.exe\n\nSoftware\\Microsoft\\Windows\\CurrentVersion\\Run\n\nopen file fail\n\ncmd timeout error %d\n\nRun cmd error %d\n\ncmd.exe /c %s>%s\n\n%s%d.txt\n\nopen file error\n\n%temp%\n\n\n-----\n\nmyWObject\n\n\\cmd.exe\n\n!DOCTYPE html\n\n%s/?id1=blank%d&id2=%d%d\n\n%s/?id1=%d%d\n\nAgain, we load the executable into IDA Pro and quickly fly over the assembly code to get an idea of the\n\nfunctionality. Once again, it creates several registry entries with the help of the command line tool and\n\ncreates an instance of the Internet Explorer (CoCreateInstance() -> d30c1661-cdaf-11d0-8a3e\n_00c04fc9e26e) for contacting the C&C server. This time, the network information is as follows:_\n\n**C&C server: buy.miraclecz.com (IP: 74.121.191.33)**\n\n**URL parameters (from strings of executable):**\n\n%s/?id1=blank%d&id2=%d%d\n\n%s/?id1=%d%d\n\nFrom the code we can see, that the sample has also the ability to encode/decode data from/to Base64. The\n\ndynamic analysis showed the malware sample contacted the C&C server, but wasn't sending any URL\n\nparameters (id1, id2). Also the server didn't respond...\n\nThe files can be downloaded here:\n\n[https://www.dropbox.com/s/ckr7p5kka62cc7s/Embassy%20of%20Greece%20-%20Beijing.zip](https://www.dropbox.com/s/ckr7p5kka62cc7s/Embassy%20of%20Greece%20-%20Beijing.zip)\n\nPassword: \"infected\" (without \"\")\n\n**_That's it, have a nice weekend..._**\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        },
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/j108s0yjga3w42lm7wifklqilr4l35ld",
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2014/2014.06.20.Embassy_of_Greece_Beijing/Compromise_Greece_Beijing.pdf"
    ],
    "report_names": [
        "Compromise_Greece_Beijing"
    ],
    "threat_actors": [],
    "ts_created_at": 1666716497,
    "ts_updated_at": 1743041161,
    "ts_creation_date": 1419204749,
    "ts_modification_date": 1419204749,
    "files": {
        "pdf": "https://archive.orkl.eu/292359e869860f8308c2cf789986fe7c12502553.pdf",
        "text": "https://archive.orkl.eu/292359e869860f8308c2cf789986fe7c12502553.txt",
        "img": "https://archive.orkl.eu/292359e869860f8308c2cf789986fe7c12502553.jpg"
    }
}