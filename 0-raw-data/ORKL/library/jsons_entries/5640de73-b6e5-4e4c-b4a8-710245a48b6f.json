{
    "id": "5640de73-b6e5-4e4c-b4a8-710245a48b6f",
    "created_at": "2023-01-12T15:05:51.70453Z",
    "updated_at": "2025-03-27T02:06:10.388503Z",
    "deleted_at": null,
    "sha1_hash": "93ba6ac9435e8cf4b35b7f9150d9af530cfa10d8",
    "title": "2021-11-18 - Threat Thursday- DanaBot’s Evolution from Bank Fraud to DDos Attacks",
    "authors": "",
    "file_creation_date": "2022-05-28T23:18:09Z",
    "file_modification_date": "2022-05-28T23:18:09Z",
    "file_size": 1528284,
    "plain_text": "# Threat Thursday: DanaBot’s Evolution from Bank Fraud to DDos Attacks\n\n**[blogs.blackberry.com/en/2021/11/threat-thursday-danabot-malware-as-a-service](https://blogs.blackberry.com/en/2021/11/threat-thursday-danabot-malware-as-a-service)**\n\nThe BlackBerry Research & Intelligence Team\n\n### Summary\n\nDanaBot is an ever-evolving and prevalent threat that has been in the wild since 2018. The\nmalware has seen a resurgence in late 2021 after it was found several times in hijacked\npackages of NPM, a popular JavaScript software package manager for Node.JS.\n\nSold as a Malware-as-a-Service (MaaS) offering, DanaBot initially focused on banking fraud\nand information stealing. However, over the years it has matured in complexity and grown in\nfunctionality.\n\nOne such functional shift was seen in late October 2021, when an affiliate using the\nmalware dropped via the hijacked NPM packages was involved in a distributed denial-ofservice (DDoS) attack against a commercial organization based in Russia.\n\n### Operating System\n\n\n-----\n\n### Risk & Impact\n\n Technical Analysis\n\nThe DanaBot malware has seen great success as a MaaS platform, allowing other threat\nactors to carry out their own desired malicious goals. Since its creation in 2018, threat\nactors who purchased the malware have been given specific botnet identification for the\nMaaS, known as affiliate IDs. These IDs signify different campaigns, threat actors, and\npotentially different targets. Throughout its life, DanaBot has been used in a wide range of\ncampaigns, and its delivery has changed and evolved as well.\n\n### Evolution of Delivery\n\n**Phishing and Spam**\n\nHistorically, the malware was used in phishing and malspamming campaigns. DanaBot\n[relied on social engineering tactics of varying complexity to bait victims into following](https://blogs.blackberry.com/en/2018/04/how-to-avoid-falling-for-a-social-engineering-attack)\nunknown links attached to emails, and inadvertently downloading the malware.\n\nOver time, DanaBot has focused more on deployment via traditional malspam. This threat\n[has had some noteworthy success since shifting tactics to using low-volume spear-phishing](https://blogs.blackberry.com/en/2020/11/the-art-of-targeted-phishing-how-not-to-get-hooked)\ncampaigns that target specific victims with a finer degree of complexity and social\nengineering, to make it seem more trustworthy to its targets.\n\nAs the malware has evolved, DanaBot began to further its reach by utilizing webinjects to\nharvest victim email addresses. Webinjects are malicious display fields or overlays that are\ninjected onto webpages open on the victim’s browser. These fields are filled by the user,\nwho thinks they are filling out their regular login page, and this information is then stolen by\nthe malware. Historically, malware such as DanaBot has displayed such fields over email,\nsocial networking, and banking log-on pages to steal these user credentials.\n\nDanaBot has since used addresses stolen by webinject to further its spam email campaigns\nand spread its reach.\n\n\n-----\n\n**Compromised and Cracked Websites**\n\nMore recently, DanaBot has been hosted and distributed via webpages offering cracked\nsoftware and applications. Cracked software is “closed-source” software-for-pay that has\nbeen exploited to allow people who use the “crack” to have full access to what would\nnormally be paid functionality and features, without paying licensing fees or an initial upfront cost.\n\nThreat actors commonly deploy their Trojanized executables by bundling them with cracked\nsoftware as a lure for victims to unknowingly download and execute malicious software.\nMalware that is distributed this way often targets a particular demographic of users who\nmay be less security-conscious, such as people who are seeking software that is either illicit\nor illegal, depending on the jurisdiction where they live.\n\n**Compromised Packages**\n\nLate in 2021, the NPM JavaScript software package manager for Node.JS had a handful of\nits libraries compromised and infected with malware. It was later ascertained that the\nmalware in question was DanaBot.\n\nIn October 2021, the Cybersecurity & Infrastructure Security Agency (CISA) published a\nwarning about malware being discovered in three versions of the NPM \"ua-parser-js\"\npackage. Users who downloaded and executed the hijacked package were infected with\n[DanaBot, along with a cryptocurrency miner.](https://blogs.blackberry.com/en/2017/08/threat-spotlight-cryptocurrency-malware)\n\n[In November 2021, NPM statedNPM stated via Twitter that it had been hijacked once again.](https://twitter.com/npmjs/status/1456398505832976384)\nA compromised account was used to publish and push malicious code to two further\npackages: first \"coa,\" and then \"rc.\"\n\n**Malicious “Rc\" and \"Coa\" Packages**\n\nThough both coa and rc had not been updated for several years, both still receive\nthousands of downloads daily. The presence of malicious code in these packages was\ndiscovered by someone who had used the coa package, and then subsequently reported\nerrors in various builds. This strange behavior prompted further investigation, which led to\n[the discovery of the maliciously injected code. NPM released a statement explaining that all](https://therecord.media/malware-found-in-npm-package-with-millions-of-weekly-downloads/)\nWindows® users who had recently downloaded either package should consider their\nsystems compromised.\n\nAnalyzing the contents of a compromised version of the package “rc-1.3.9,” we can see the\nmalicious scripts added to the package (highlighted in red).\n\n\n-----\n\n_Figure 1: Contents of rc-1.3.9_\n\nInspecting the contents of the affected package rc-1.3.9, we found that the files\n“compile.bat” and “compile.js” were compromised and contained malicious code. Both\ncompromised versions of coa and rc share identical malicious Windows Batch and\nJavaScript scripts.\n\nWhen installing, both packages will first execute and run the file compile.js via Node, as\nseen below:\n\n_Figure 2: Obfuscated compile.js_\n\nOn execution, this JavaScript code will launch the secondary malicious script, which is a\nWindows batch file (.BAT) called compile.bat. This batch file acts as a downloader for the\nmalware.\n\n\n-----\n\nThe content of compile.bat is initially obfuscated, but it can be deobfuscated to reveal the\ntrue intention of this malicious code.\n\n_Figure 3: Obfuscated compile.bat_\n\nOnce deobfuscated, we can see that it attempts to download a .DLL named \"sdd.dll\" from\nan unknown domain, and outputs it as “compile.dll.” If successful, the malicious .DLL will be\nexecuted via \"Regsvr32.exe,” which is a command-line utility in Microsoft® Windows® that\nis commonly used for registering DLLs in the Windows Registry.\n\n_Figure 4: Un-obfuscated compile.bat_\n\n**Indicator of Compromise (IoC): pastorcrytograph[dot]at/3/sdd[dot]dll**\n\n**_WARNING: At the time of writing, the BlackBerry Research & Intelligence Team has_**\n**_noted the URL above is both still active and hosting samples of DanaBot. BlackBerry_**\n**_is not responsible for any damage or harm incurred as a result of readers of this blog_**\n**_attempting to load this URL._**\n\nThe DLL will attempt to make contact with185[dot]117[dot]90[dot]36:443 before eventually\nlaunching the malware once again, via rundll32.exe.\n\nThe malware will then rerun using a Base64 encoded export. This export is calculated by\nDanaBot to determine which mode the malware is running in. This is done by subtracting\nthe first three bytes of export, as follows.\n\n\n-----\n\n**Name** **Value**\n\nExport (Base64): TkMLNjluVQ==\n\nDecimal: **78 67 11 54 57 110 85**\n\nCalculation: 78-67-11 = 0\n\nResult: 0 (running main malware component)\n\n### Capabilities and Commands\n\nDanaBot is mainly used for its information-stealing functionality and modular flexibility. The\nmalware made its last iterative change at the end of 2020, and then made additional\nchanges in September 2021.\n\nAll communication between the malware and its command-and-control (C2) server is\nencrypted using Advanced Encryption Standard (AES), including the following activities and\ncommands:\n\nInitial call-home beaconing to its C2\nUpdating its C2 list\nSwitching to using a Tor-based C2\nBeginning information-stealing\nReporting/listing system information\nReporting/listing hardware information\nTaking screenshots of victim device\nRemote Access Trojan (RAT) functionality\nKeylogging\nRemote screen recording\nRequesting updates\n\n### DDOS\n\nIn late October 2021, machines affected with samples of DanaBot that were dropped via the\nhijacking of ua-parser were involved in a DDoS attack. The affected devices received\nfurther malicious instructions to target a specific commercial organization based in Russia.\n\nThis event highlights the flexibility of the malware beyond its historic information-stealing\nfunctionality.\n\n### Collaboration\n\n\n-----\n\nHistorically, DanaBot has not operated alone. In the past, it has worked with other malware\nfamilies once on a victim’s device to add to the overall damage caused. For example, this\n[threat has been seen working in collaboration with GootKit, which was once a popular](https://blogs.blackberry.com/en/2020/04/threat-spotlight-gootkit-banking-trojan)\nbanking Trojan first found in the wild in 2014. Though seemingly not updated since 2019,\nGootKit has recently become active again.\n\nThere are no signs yet that point to this partnership reforging.\n\n### Conclusion\n\nAt its heart, DanaBot is a complex and modular information-stealer, focusing on harvesting\nvictim credentials and other valued logins. The malware has the ability to perform webinjects on popular services, as well as having remote access functionality. This allows the\nmalware to gather a wealth of information about a compromised victim’s device, which can\nbe further used in secondary attacks.\n\nSeemingly on the decline over recent years, the past year has sparked new life and a return\nto the mainstream for DanaBot. This threat is part of an evolving malware family, with\nfrequent enhancements to both communication, attack vector, and functionality.\n\nWith a recent spike in activity and a new attack vector via the recent hijacking of NPM\npackages, it is clear that this Malware-as-a-Service is still under development. Coupled with\nits utilization in recent DDoS attacks and NPM hijacks, the threat of DanaBot is as prevalent\nas ever.\n\n**NOTE: Users who have recently utilized NPM packages are likely to have**\n**compromised machines. They should patch such packages immediately and check**\n**for artifacts of DanaBot.**\n\n### YARA Rule\n\nThe following YARA rule was authored by the BlackBerry Research & Intelligence Team to\ncatch the threat described in this document:\n\n\n-----\n\nimport \"pe\"\n\nimport \"hash\"\n\nrule Mal_informationstealler_Win32_DanaBot_DLL_Nov_2021\n\n{\nmeta:\n\ndescription = \"Detects DanaBot DLL drop via compromised NPM packages\nNovember 2021\"\n\nauthor = \"Blackberry Threat Research Team \"\n\ndate = \"2021-11\"\n\nlicense = \"This Yara rule is provided under the Apache License 2.0\n(https://www.apache.org/licenses/LICENSE-2.0) and open to any user or organization, as\nlong as you use it under this license and ensure originator credit in any derivative to The\nBlackBerry Research & Intelligence Team\"\n\nstrings:\n$s0 = \"Thin.dll\" ascii wide\n\n$s1 = \"Usual done\" ascii wide\n\ncondition:\n\n//PE File\n\nuint16(0) == 0x5a4d and\n\n//PE File size\n\nfilesize < 2000KB and filesize > 1500KB and\n\n//Entry\n\npe.entry_point == 0x154ccb and\n\n//Must have exactly 5 sections\n\npe.number_of_sections == 5 and\n\n//All Strings\n\nall of ($s*)\n\n}\n\n### Indicators of Compromise (IoCs)\n\n\n-----\n\n**Affected NPM Packages:**\n\n[Ua-parser.js 0.7.29, 0.8.0, 1.0.0 (Available patch)](https://github.com/advisories/GHSA-pjwm-rvh2-c87w)\n[Coa – version 2.0.3 and above (Unpatched)](https://github.com/advisories/GHSA-73qr-pfmq-6rp8)\n[RC – version 1.2.9, 1.3.9 and 2.3.9 (Unpatched)](https://github.com/advisories/GHSA-g2q5-5433-rhrf)\n\n**Compromised NPM Package DanaBot URL**\n\n**_(WARNING: these are live malware sites at the time of writing):_**\n\npastorcryptograph[dot]at/3/sdd[dot]dll\ncitationsherbe[dot]at/3/sdd[dot]dll\n\n**DanaBot Hosting URLs:**\n\nhxxp://23[.]254[.]226[.]52/lots[.]exe\nhxxp://45[.]147[.]231[.]79/apply[.]exe\nhxxp://212[.]114[.]52[.]52/spho[.]exe\nhxxp://fumiom11[.]top/downfiles/sodomy[.]exe\n\n**C2 IP Addresses**\n\n185[.]117[.]90[.]36:443\n193[.]42[.]36[.]59:443\n193[.]56[.]146[.]53:443\n185[.]106[.]123[.]228:443\n192[.]119[.]110[.]73:443\n192[.]236[.]192[.]201:443\n88[.]150[.]227[.]98\n\n**Compromised NPM Packages:**\n\nrc-1.3.9.tar 697fa153891f6df6143a85b1b62a8ad1e0b2aae5ffc924de65d7266b721e6af1\nrc-1.3.9.tgz 485445b515455fdef701735462baf4d58653152e7a3da81d2b93d0ec8a878fb4\n\n**Comprised NPM Scripts:**\n\nCompile.js 608c06ef802ad84d7d4d8c2bf497690ed6da8b5380e99b76f32feb3918738c06\nCompile.bat eb99954657e3ae69c43c0ccb90131763030239fbd4dff18719e21dae2d6e0a93\n\n### BlackBerry Assistance\n\nIf you’re battling this malware or a similar threat, you’ve come to the right place, regardless\nof your existing BlackBerry relationship.\n\n\n-----\n\n[The BlackBerry Incident Response team is made up of world-class consultants dedicated to](https://www.blackberry.com/us/en/services/incident-response)\nhandling response and containment services for a wide range of incidents, including\nransomware and Advanced Persistent Threat (APT) cases.\n\nWe have a global consulting team standing by to assist you providing around-the-clock\nsupport, where required, as well as local assistance. Please contact us here:\nhttps://www.blackberry.com/us/en/forms/cylance/handraiser/emergency-incident-responsecontainment\n\n_Want to learn more about cyber threat hunting? Check out the BlackBerry Research &_\n_Intelligence Team’s new book,_ **_Finding Beacons in the Dark: A Guide to Cyber Threat_**\n**_[Intelligence - now available for free download here.](http://blackberry.com/beacon)_**\n\n## About The BlackBerry Research & Intelligence Team\n\nThe BlackBerry Research & Intelligence team examines emerging and persistent threats,\nproviding intelligence analysis for the benefit of defenders and the organizations they serve.\n\nBack\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-11-18 - Threat Thursday- DanaBot’s Evolution from Bank Fraud to DDos Attacks.pdf"
    ],
    "report_names": [
        "2021-11-18 - Threat Thursday- DanaBot’s Evolution from Bank Fraud to DDos Attacks.pdf"
    ],
    "threat_actors": [
        {
            "id": "1dadf04e-d725-426f-9f6c-08c5be7da159",
            "created_at": "2022-10-25T15:50:23.624538Z",
            "updated_at": "2025-03-27T02:00:55.508759Z",
            "deleted_at": null,
            "main_name": "Darkhotel",
            "aliases": [
                "Darkhotel",
                "DUBNIUM",
                "Zigzag Hail"
            ],
            "source_name": "MITRE:Darkhotel",
            "tools": null,
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "2b4eec94-7672-4bee-acb2-b857d0d26d12",
            "created_at": "2023-01-06T13:46:38.272109Z",
            "updated_at": "2025-03-27T02:00:02.790029Z",
            "deleted_at": null,
            "main_name": "DarkHotel",
            "aliases": [
                "DUBNIUM",
                "Fallout Team",
                "Luder",
                "Tapaoux",
                "Shadow Crane",
                "APT-C-06",
                "SIG25",
                "Karba",
                "Nemim",
                "Nemin",
                "G0012",
                "ATK52",
                "T-APT-02",
                "TUNGSTEN BRIDGE",
                "Zigzag Hail"
            ],
            "source_name": "MISPGALAXY:DarkHotel",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "c0cedde3-5a9b-430f-9b77-e6568307205e",
            "created_at": "2022-10-25T16:07:23.528994Z",
            "updated_at": "2025-03-27T02:02:09.847683Z",
            "deleted_at": null,
            "main_name": "DarkHotel",
            "aliases": [
                "APT-C-06",
                "ATK 52",
                "CTG-1948",
                "Dubnium",
                "Fallout Team",
                "Higaisa",
                "Luder",
                "Operation DarkHotel",
                "Operation Daybreak",
                "Operation Inexsmar",
                "Operation PowerFall",
                "Operation The Gh0st Remains the Same",
                "SIG25",
                "Shadow Crane",
                "T-APT-02",
                "Tungsten Bridge",
                "Zigzag Hail"
            ],
            "source_name": "ETDA:DarkHotel",
            "tools": [
                "Asruex",
                "DarkHotel",
                "DmaUp3.exe",
                "GreezeBackdoor",
                "Karba",
                "Nemain",
                "Nemim",
                "Ramsay",
                "Retro",
                "Tapaoux",
                "Trojan.Win32.Karba.e",
                "Virus.Win32.Pioneer.dx",
                "igfxext.exe",
                "msieckc.exe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535951,
    "ts_updated_at": 1743041170,
    "ts_creation_date": 1653779889,
    "ts_modification_date": 1653779889,
    "files": {
        "pdf": "https://archive.orkl.eu/93ba6ac9435e8cf4b35b7f9150d9af530cfa10d8.pdf",
        "text": "https://archive.orkl.eu/93ba6ac9435e8cf4b35b7f9150d9af530cfa10d8.txt",
        "img": "https://archive.orkl.eu/93ba6ac9435e8cf4b35b7f9150d9af530cfa10d8.jpg"
    }
}