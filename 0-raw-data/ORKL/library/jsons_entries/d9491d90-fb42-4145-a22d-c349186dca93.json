{
    "id": "d9491d90-fb42-4145-a22d-c349186dca93",
    "created_at": "2023-01-12T15:09:59.427435Z",
    "updated_at": "2025-03-27T02:16:11.601884Z",
    "deleted_at": null,
    "sha1_hash": "60f48252fcf4be5ae23312d1851f5d3aca05397d",
    "title": "2022-10-05 - Detecting and preventing LSASS credential dumping attacks",
    "authors": "",
    "file_creation_date": "2022-10-23T13:20:40Z",
    "file_modification_date": "2022-10-23T13:20:40Z",
    "file_size": 587046,
    "plain_text": "# Detecting and preventing LSASS credential dumping attacks\n\n**[microsoft.com/security/blog/2022/10/05/detecting-and-preventing-lsass-credential-dumping-attacks/](https://www.microsoft.com/security/blog/2022/10/05/detecting-and-preventing-lsass-credential-dumping-attacks/)**\n\nOctober 5, 2022\n\nObtaining user operating system (OS) credentials from a targeted device is among threat\nactors’ primary goals when launching attacks because these credentials serve as a gateway\nto various objectives they can achieve in their target organization’s environment, such as\nlateral movement. One technique attackers use is targeting credentials in the Windows Local\nSecurity Authority Subsystem Service (LSASS) process memory because it can store not\nonly a current user’s OS credentials but also a domain admin’s.\n\n[LSASS credential dumping was first observed in the tactics, techniques, and procedures](https://attack.mitre.org/techniques/T1003/001/)\n(TTPs) of several sophisticated threat activity groups—including actors that Microsoft tracks\nas [HAFNIUM and](https://www.microsoft.com/en-us/security/blog/2021/03/02/hafnium-targeting-exchange-servers/) [GALLIUM— and has become prevalent even in the cybercrime space,](https://www.microsoft.com/en-us/security/blog/2019/12/12/gallium-targeting-global-telecom/)\n[especially with the rise of the ransomware as a service gig economy. Detecting and stopping](https://www.microsoft.com/en-us/security/blog/2020/03/05/human-operated-ransomware-attacks-a-preventable-disaster/)\nOS credential theft is therefore important because it can spell the difference between\ncompromising or encrypting one device versus an entire network. Security solutions must\n\n\n-----\n\nprovide specific measures and capabilities to help harden the LSASS process—for example,\n[Microsoft Defender for Endpoint has advanced detections and a dedicated attack surface](https://www.microsoft.com/security/business/threat-protection/endpoint-defender)\nreduction rule (ASR) to block credential stealing from LSASS.\n\nIn May 2022, Microsoft participated in an evaluation conducted by independent testing\n[organization AV-Comparatives specifically on detecting and blocking the LSASS credential](https://www.av-comparatives.org/)\ndumping technique. The test, which evaluated several endpoint protection platforms (EPP)\nand endpoint detection and response (EDR) vendors, is the first time AV-Comparatives\nfocused on a single attack technique, and we’re happy to report that Defender for Endpoint\npassed all 15 test cases used to dump user OS credentials from the LSASS process,\nachieving 100% detection and prevention scores. Notably, we also passed all test cases\n**with only Defender for Endpoint’s default settings configured, that is, with LSASS ASR**\nand Protective Process Light (PPL) turned off to validate our antivirus protection durability in\nitself. Such results demonstrate our continued commitment to provide organizations with\nindustry-leading defense.\n\nIn this blog, we share examples of various threat actors that we’ve recently observed using\nthe LSASS credential dumping technique. We also provide details on the testing\n[methodology done by AV-Comparatives, which they also shared in their blog and](https://www.av-comparatives.org/lsass-credential-dumping-security/) detailed\nreport. Finally, we offer additional recommendations to further harden systems and prevent\nattackers from taking advantage of possible misconfigurations should they fail to leverage\ncredential dumping.\n\n## LSASS credential dumping: What we see in the wild\n\nDumping LSASS credentials is important for attackers because if they successfully dump\ndomain passwords, they can, for example, then use legitimate tools such as PsExec or\nWindows Management Instrumentation (WMI) to move laterally across the network. They\n[can also use techniques like pass-the-hash for lateral movement if they manage to obtain the](https://attack.mitre.org/techniques/T1550/002/)\npassword hashes.\n\nMicrosoft researchers are constantly monitoring the threat landscape, including the different\nways threat actors attempt to steal user credentials. The table below is a snapshot of the\nmost popular credential theft techniques these actors used from March to August 2022\nbased on our threat data:\n\n\n**[Living-off-the-land binary (LOLBin) or](https://github.com/LOLBAS-Project/LOLBAS/blob/master/README.md)**\n**hacking tool**\n\n_Comsvc.dll (and its “MiniDump” export)_\nloaded by rundll32.exe\n\n\n**Threat actor that frequently uses this**\n(not exhaustive)\n\n[DEV-0270](https://www.microsoft.com/en-us/security/blog/2022/09/07/profiling-dev-0270-phosphorus-ransomware-operations/)\n\n\nMimikatz (and its modified variants) DEV-0674\n\n\n-----\n\n_Procdump.exe (with -ma command line_\noption)\n\n\nDEV-0555\n\n\n_Taskmgr.exe_ DEV-0300\n\nThe first column shows the technique attackers most frequently used in their attempt to\ndump credentials from LSASS, while the second column shows which threat actor uses this\ntechnique most frequently. Based on the incidents we tracked from March to August 2022,\ncredential theft attacks using LOLBins such as comsvc.dll, procdump.exe, or taskmgr.exe\nare still popular. These LOLBins are legitimate, digitally signed binaries that are either\nalready present on the target device or are downloaded onto the system for the attacker to\nmisuse for malicious activities.\n\nMicrosoft Defender Antivirus prevents the execution of these command lines due to its\nsynchronous command line-blocking capabilities.\n\n## AV-Comparatives test\n\nTo evaluate EPP and EDR capabilities against the LSASS credential dumping technique, AVComparatives ran 15 different test cases to dump credentials from the LSASS process using\nboth publicly available hacking tools like Mimikatz (which the tester modified to bypass\nantivirus signatures) and privately developed ones. These test cases were as follows:\n\n**Test case** **LSASS attack method**\n\n01 Mimikatz with process herpaderping\n\n02 Native APIs DLL\n\n03 Silent process exit\n\n04 Alternative API snapshot function\n\n05 MalSecLogon\n\n06 Dump LSASS\n\n07 Duplicate dump\n\n08 PowerShell Mimikatz\n\n09 Invoke Mimikatz (PoshC2)\n\n10 SafetyDump\n\n11 RunPE snapshot (PoshC2)\n\n12 Unhook (Metasploit framework)\n\n\n-----\n\n13 Reflective DLL (Metasploit framework)\n\n14 Invoke Mimikatz (PowerShell Empire)\n\n15 Invoke-PPL dump (PowerShell Empire)\n\nEach test case implemented a comprehensive approach on how to dump credentials from\nLSASS. After the evaluation, AV-Comparatives shared the logs and detailed description of\nthe test cases. Microsoft participated using Defender for Endpoint, both its antivirus and EDR\ncapabilities, with only the default settings configured.\n\nDuring the initial run, Defender for Endpoint prevented 11 out of 15 test cases and\nalerted/detected three of the remaining ones (Figure 1). We then made improvements in our\nprotection and detection capabilities and asked AV-Comparatives to re-test the missed test\ncases. During the re-test, we prevented all the remaining four test cases, achieving 15 out of\n15 prevention score.\n\nFigure 1. Table showing how Defender for Endpoint prevented/detected the test cases in the\nfirst run of the AV-Comparatives test. The antivirus module missed test cases 01, 03, 09, and\n10. We added improvements to the product based on these findings, thus allowing Defender\n[for Endpoint to achieve 100% prevention score on re-test. (Source: AV-Comparatives)](https://www.av-comparatives.org/wp-content/uploads/2022/09/avc_sp_lsass_ms_2022.pdf)\n\n\n-----\n\nWe d like to thank AV-Comparatives for this thorough test, which led us to improve our\nprotection and detection capabilities in Defender for Endpoint. These improvements have\nalready been rolled out to benefit our customers, and we’re looking forward to the next\nsimilar test. We aim to provide industry-leading, cross-domain defense, so it’s important for\n[us to participate in tests like AV-Comparatives and MITRE Engenuity ATT&CK Evaluations](https://www.microsoft.com/en-us/security/blog/2022/03/31/microsoft-protects-against-human-operated-ransomware-across-the-full-attack-chain-in-the-2022-mitre-engenuity-attck-evaluations/)\nbecause they help us ensure that we’re delivering solutions that empower organizations to\ndefend their environments.\n\n## Securing the LSASS process with coordinated threat defense and system hardening\n\nThe continuous evolution of the threat landscape has seen attacks leveraging OS credential\ntheft, and threat actors will continue to find new ways to dump LSASS credentials in their\nattempts to evade detection. For Microsoft, our industry-leading defense capabilities in\n[Microsoft Defender for Endpoint are able to detect such attempts. We’ve also introduced new](https://www.microsoft.com/security/business/endpoint-security/microsoft-defender-endpoint)\nsecurity features in Windows 11 to harden the operating system, such as enabling PPL for\nthe LSASS process and Credential Guard by default. However, evaluations like this AVComparatives test go hand in hand with threat monitoring and research because they\nprovide security vendors additional insights and opportunities to continuously improve\ncapabilities.\n\n[Our teams performed an in-house test of all these test cases with the LSASS ASR rule](https://learn.microsoft.com/microsoft-365/security/defender-endpoint/attack-surface-reduction-rules-reference#block-credential-stealing-from-the-windows-local-security-authority-subsystem)\nenabled to check the protection level of that rule. We’re happy to report that the ASR rule\nalone successfully prevented all the tested techniques. The LSASS ASR rule is a generic yet\neffective protection our customers can implement to stop currently known user-mode LSASS\ncredential dumping attacks. Defender customers should therefore enable this ASR rule—\n[along with tamper protection—as an added protection layer for the LSASS process.](https://support.microsoft.com/windows/prevent-changes-to-security-settings-with-tamper-protection-31d51aaa-645d-408e-6ce7-8d7f8e593f87)\n\nOn top of the various dumping techniques, we’ve also observed threat actors attempt to\nweaken the device settings in case they can’t dump credentials. For example, they attempt\nto enable “UseLogonCredential” in WDigest registry, which enables plaintext passwords in\nmemory. Microsoft Defender Antivirus detects such techniques, too, as\nBehavior:Win32/WDigestNegMod.B.\n\nWindows administrators can also perform the following to further harden the LSASS process\non their devices:\n\n[Enable PPL for LSASS process; note that for new, enterprise-joined Windows 11](https://learn.microsoft.com/windows-server/security/credentials-protection-and-management/configuring-additional-lsa-protection#BKMK_HowToConfigure)\ninstalls (22H2 update), this is already enabled by default\n[Enable Windows Defender Credential Guard; this is also now enabled by default for](https://learn.microsoft.com/windows/security/identity-protection/credential-guard/credential-guard-manage#enable-windows-defender-credential-guard)\norganizations using the Enterprise edition of Windows 11\n[Enable restricted admin mode for Remote Desktop Protocol (RDP)](https://learn.microsoft.com/archive/blogs/kfalde/restricted-admin-mode-for-rdp-in-windows-7-2008-r2)\n[Disable “UseLogonCredential” in WDigest](https://support.microsoft.com/topic/microsoft-security-advisory-update-to-improve-credentials-protection-and-management-may-13-2014-93434251-04ac-b7f3-52aa-9f951c14b649)\n\n\n-----\n\nFinally, customers with Azure Active Directory (Azure AD) can follow our recommendations\non hardening environments:\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-10-05 - Detecting and preventing LSASS credential dumping attacks.pdf"
    ],
    "report_names": [
        "2022-10-05 - Detecting and preventing LSASS credential dumping attacks.pdf"
    ],
    "threat_actors": [
        {
            "id": "529c1ae9-4579-4245-86a6-20f4563a695d",
            "created_at": "2022-10-25T16:07:23.702006Z",
            "updated_at": "2025-03-27T02:02:09.93109Z",
            "deleted_at": null,
            "main_name": "Hafnium",
            "aliases": [
                "Red Dev 13",
                "Silk Typhoon"
            ],
            "source_name": "ETDA:Hafnium",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "6b4a82e8-21f1-4bc7-84cf-e27334998b48",
            "created_at": "2022-10-25T16:07:23.84296Z",
            "updated_at": "2025-03-27T02:02:09.997164Z",
            "deleted_at": null,
            "main_name": "DEV-0270",
            "aliases": [
                "DEV-0270",
                "DireFate",
                "Lord Nemesis",
                "Nemesis Kitten",
                "Yellow Dev 23",
                "Yellow Dev 24"
            ],
            "source_name": "ETDA:DEV-0270",
            "tools": [
                "Impacket",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "WmiExec"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "7c969685-459b-4c93-a788-74108eab6f47",
            "created_at": "2023-01-06T13:46:39.189751Z",
            "updated_at": "2025-03-27T02:00:03.017103Z",
            "deleted_at": null,
            "main_name": "HAFNIUM",
            "aliases": [
                "ATK233",
                "G0125",
                "Operation Exchange Marauder",
                "Red Dev 13",
                "Silk Typhoon"
            ],
            "source_name": "MISPGALAXY:HAFNIUM",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "eaef3218-1f8c-4767-b1ff-da7a6662acc0",
            "created_at": "2023-03-04T02:01:54.110909Z",
            "updated_at": "2025-03-27T02:00:03.124083Z",
            "deleted_at": null,
            "main_name": "DEV-0270",
            "aliases": [
                "Nemesis Kitten",
                "Storm-0270"
            ],
            "source_name": "MISPGALAXY:DEV-0270",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d8af157e-741b-4933-bb4a-b78490951d97",
            "created_at": "2023-01-06T13:46:38.748929Z",
            "updated_at": "2025-03-27T02:00:02.908256Z",
            "deleted_at": null,
            "main_name": "APT35",
            "aliases": [
                "Newscaster Team",
                "Magic Hound",
                "G0059",
                "Phosphorus",
                "Mint Sandstorm",
                "TunnelVision",
                "COBALT MIRAGE"
            ],
            "source_name": "MISPGALAXY:APT35",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "9faf32b7-0221-46ac-a716-c330c1f10c95",
            "created_at": "2022-10-25T16:07:23.652281Z",
            "updated_at": "2025-03-27T02:02:09.908624Z",
            "deleted_at": null,
            "main_name": "Gallium",
            "aliases": [
                "Alloy Taurus",
                "Granite Typhoon",
                "Phantom Panda"
            ],
            "source_name": "ETDA:Gallium",
            "tools": [
                "Agentemis",
                "BlackMould",
                "CHINACHOPPER",
                "China Chopper",
                "Chymine",
                "CinaRAT",
                "Cobalt Strike",
                "CobaltStrike",
                "Darkmoon",
                "Gen:Trojan.Heur.PT",
                "Gh0stCringe RAT",
                "HTran",
                "HUC Packet Transmit Tool",
                "LaZagne",
                "Mimikatz",
                "NBTscan",
                "PingPull",
                "Plink",
                "Poison Ivy",
                "PsExec",
                "PuTTY Link",
                "QuarkBandit",
                "Quasar RAT",
                "QuasarRAT",
                "Reshell",
                "SPIVY",
                "SinoChopper",
                "SoftEther VPN",
                "Sword2033",
                "WCE",
                "WinRAR",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "Yggdrasil",
                "cobeacon",
                "nbtscan",
                "netcat",
                "pivy",
                "poisonivy"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "7bf3ffe5-09ba-4378-8ea4-a6d748a494fd",
            "created_at": "2022-10-25T15:50:23.264584Z",
            "updated_at": "2025-03-27T02:00:55.414817Z",
            "deleted_at": null,
            "main_name": "GALLIUM",
            "aliases": [
                "GALLIUM",
                "Granite Typhoon"
            ],
            "source_name": "MITRE:GALLIUM",
            "tools": [
                "ipconfig",
                "cmd",
                "China Chopper",
                "PoisonIvy",
                "at",
                "PlugX",
                "PingPull",
                "BlackMould",
                "Mimikatz",
                "PsExec",
                "HTRAN",
                "NBTscan",
                "Windows Credential Editor"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "c87ee2df-e528-4fa0-bed6-6ed29e390688",
            "created_at": "2023-01-06T13:46:39.150432Z",
            "updated_at": "2025-03-27T02:00:03.008665Z",
            "deleted_at": null,
            "main_name": "GALLIUM",
            "aliases": [
                "Red Dev 4",
                "Alloy Taurus",
                "Granite Typhoon"
            ],
            "source_name": "MISPGALAXY:GALLIUM",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "2704d770-43b4-4bc4-8a5a-05df87416848",
            "created_at": "2022-10-25T15:50:23.306305Z",
            "updated_at": "2025-03-27T02:00:55.43633Z",
            "deleted_at": null,
            "main_name": "HAFNIUM",
            "aliases": [
                "HAFNIUM",
                "Operation Exchange Marauder",
                "Silk Typhoon"
            ],
            "source_name": "MITRE:HAFNIUM",
            "tools": [
                "Tarrask",
                "ASPXSpy",
                "Impacket",
                "PsExec",
                "China Chopper"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "04888f75-158b-47f9-8ad9-4ff83f618ece",
            "created_at": "2024-05-01T02:03:08.03763Z",
            "updated_at": "2025-03-27T02:05:17.319276Z",
            "deleted_at": null,
            "main_name": "COBALT MIRAGE",
            "aliases": [
                "Nemesis Kitten ",
                "PHOSPHORUS ",
                "TunnelVision ",
                "UNC2448 ",
                "DEV-0270 "
            ],
            "source_name": "Secureworks:COBALT MIRAGE",
            "tools": [
                " Custom powershell scripts",
                " DiskCryptor",
                " Drokbk",
                " FRPC",
                " Fast Reverse Proxy (FRP)",
                " Impacket wmiexec",
                " Ngrok",
                " Plink",
                " PowerLessCLR",
                " TunnelFish",
                "BitLocker"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "e3676dfe-3d40-4b3a-bfbd-4fc1f8c896f4",
            "created_at": "2022-10-25T15:50:23.808974Z",
            "updated_at": "2025-03-27T02:00:55.550912Z",
            "deleted_at": null,
            "main_name": "Magic Hound",
            "aliases": [
                "Magic Hound",
                "TA453",
                "COBALT ILLUSION",
                "Charming Kitten",
                "ITG18",
                "Phosphorus",
                "APT35",
                "Mint Sandstorm"
            ],
            "source_name": "MITRE:Magic Hound",
            "tools": [
                "Impacket",
                "CharmPower",
                "FRP",
                "Mimikatz",
                "Systeminfo",
                "ipconfig",
                "netsh",
                "PowerLess",
                "Pupy",
                "DownPaper",
                "PsExec",
                "Havij",
                "sqlmap"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "1699fb41-b83f-42ff-a6ec-984ae4a1031f",
            "created_at": "2022-10-25T16:07:23.83826Z",
            "updated_at": "2025-03-27T02:02:09.995863Z",
            "deleted_at": null,
            "main_name": "Magic Hound",
            "aliases": [
                "APT 35",
                "Ballistic Bobcat",
                "Charming Kitten",
                "CharmingCypress",
                "Cobalt Illusion",
                "Cobalt Mirage",
                "Educated Manticore",
                "Magic Hound",
                "Mint Sandstorm",
                "Operation BadBlood",
                "Operation Sponsoring Access",
                "Operation SpoofedScholars",
                "Operation Thamar Reservoir",
                "Phosphorus",
                "TA453",
                "TEMP.Beanie",
                "Tarh Andishan",
                "Timberworm",
                "TunnelVision",
                "UNC788",
                "Yellow Garuda"
            ],
            "source_name": "ETDA:Magic Hound",
            "tools": [
                "7-Zip",
                "AnvilEcho",
                "BASICSTAR",
                "CORRUPT KITTEN",
                "CWoolger",
                "CharmPower",
                "ChromeHistoryView",
                "CommandCam",
                "DistTrack",
                "DownPaper",
                "FRP",
                "Fast Reverse Proxy",
                "FireMalv",
                "Ghambar",
                "GoProxy",
                "GorjolEcho",
                "HYPERSCRAPE",
                "Havij",
                "MPK",
                "MPKBot",
                "Matryoshka",
                "Matryoshka RAT",
                "MediaPl",
                "Mimikatz",
                "MischiefTut",
                "NETWoolger",
                "NOKNOK",
                "PINEFLOWER",
                "POWERSTAR",
                "PowerLess Backdoor",
                "PsList",
                "Pupy",
                "PupyRAT",
                "SNAILPROXY",
                "Shamoon",
                "TDTESS",
                "WinRAR",
                "WoolenLogger",
                "Woolger",
                "pupy",
                "sqlmap"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536199,
    "ts_updated_at": 1743041771,
    "ts_creation_date": 1666531240,
    "ts_modification_date": 1666531240,
    "files": {
        "pdf": "https://archive.orkl.eu/60f48252fcf4be5ae23312d1851f5d3aca05397d.pdf",
        "text": "https://archive.orkl.eu/60f48252fcf4be5ae23312d1851f5d3aca05397d.txt",
        "img": "https://archive.orkl.eu/60f48252fcf4be5ae23312d1851f5d3aca05397d.jpg"
    }
}