{
    "id": "ac95e520-bc60-4fbd-bb24-380851439514",
    "created_at": "2023-01-12T15:06:24.260641Z",
    "updated_at": "2025-03-27T02:10:49.445272Z",
    "deleted_at": null,
    "sha1_hash": "d2a09edaca62504420cf724ec7fbb078858d59c2",
    "title": "2022-01-24 - Web Skimming Attacks Using Google Tag Manager",
    "authors": "",
    "file_creation_date": "2022-05-28T04:03:22Z",
    "file_modification_date": "2022-05-28T04:03:22Z",
    "file_size": 1221366,
    "plain_text": "# Web Skimming Attacks Using Google Tag Manager\n\n**[decoded.avast.io/pavlinakopecka/web-skimming-attacks-using-google-tag-manager/](https://decoded.avast.io/pavlinakopecka/web-skimming-attacks-using-google-tag-manager/)**\n\nJanuary 24, 2022\n\nby [Pavlína KopeckáJanuary 24, 20229 min read](https://decoded.avast.io/author/pavlinakopecka/)\n\nE-commerce websites are much more popular than they used to be, people tend to shop\nonline more and more often. This leads to the growth of an attack called web skimming.\nWeb skimming is a type of attack on e-commerce websites in which an attacker inserts\nmalicious code into a legitimate website. One of the most targeted e-commerce platforms is\n```\n Magento . The reason why Magento is so popular among attackers is that Magento is\n\n```\nknown for many vulnerabilities. However, this doesn’t mean that other platforms aren’t being\n[targeted, for example, sites using WooCommerce have also been victims.](https://www.bleepingcomputer.com/news/security/hackers-infect-random-wordpress-plugins-to-steal-credit-cards/)\n\nIn this posting, we go over what web skimming attacks are and how they work. We then\nanalyze a series of web skimming attacks that we found which were active from `March`\n```\n 2021 to the present. These attacks abused the Google Tag Manager and mainly\n\n```\ntargeted sites in `Argentina and` `Saudi Arabia .`\n\n## Overview of Web Skimming Attacks\n\nThe purpose of the malicious web skimming code is to steal the website’s customers’\npayment details. This attack can simply be compared to an attack on physical ATMs, where\ninstead of hardware skimmers, malicious code is used to steal payment card information.\n\n\n-----\n\nWeb skimming is dangerous because the customer often has no chance to know that a\nwebsite has been compromised. Mostly, the attackers go after small e-commerce websites\nwith poor security, but sometimes even a big e-commerce site can become a victim. In\n\n`2018, the` [British Airways website was infected by a web skimming attack. In](https://www.riskiq.com/blog/external-threat-management/magecart-british-airways-breach/) `2019,`\n\n`forbesmagazine[.]com was` [infected, payment details were sent to the](https://www.trendmicro.com/vinfo/pl/security/news/cybercrime-and-digital-threats/magecart-s-payment-card-data-skimming-code-found-on-forbes-magazine-s-website)\n```\nfontsawesome[.]gq . Later in 2020 a big online retailer selling beauty products,\nwishtrend[.]com, also became a victim of another web skimming attack. In 2021\n\n```\nanother big e-commerce website `store.segway[.]com was infected with a skimming`\nattack.\n\nWe observed a webpage ( wishtrend[.]com with more than `1M followers on`\n```\nFacebook ) that was infected with web skimming in 2020 . Later in 2021, the same\n\n```\nwebsite was infected with a phishing attack that imitates a Dropbox login.\n\n## How Web Skimming Attacks Work Under the Hood\n\nA website can be breached and compromised both on the client side and on the server\nside. From the AV perspective, as we protect the end customers (client) and have no\nvisibility on the server side, we focus on the client side. There can either be a single piece\n\n\n-----\n\nof malicious code hidden in infected websites, or more often, the attack can be split into two\nor more stages. First stage is a simple loader inserted in an infected website’s HTML or in\nan already existing javascript file. It can look like in the image below.\n\n_First stage of web skimming attack, example of malicious code inserted in websites_\nThis code loads additional malicious code from an attacker’s domain, sometimes\nobfuscated, sometimes not. For the second stage, attackers usually use `typosquatting`\ndomains to hide and act as a legitimate service. The malicious code gets the data from all\n(or in some cases specific) input forms and sends this data to the attacker’s server.\n\nTo get the payment details, the attackers use one of the following techniques:\n\nStealing payment details directly from the original payment form\nInserting malicious payment form (used in cases when no form exists)\nRedirecting to a malicious form on another website (can be placed on infected website\nor also on attacker’s website)\n\nThe image below shows an example of a fake payment form in the red box. It is almost\nimpossible to recognize that something is wrong, because on some e-commerce websites\nthe payment form looks exactly the same and is valid. But in this case a little help is in the\nyellow box that says: “You will be redirected to the Realex website when you place an order.\n“ It means that if the website states that you will be redirected, then the payment form\nshould not be directly on the e-commerce website and the user should expect to be\nredirected to the payment gateway (different website) with the form to enter payment\ndetails.\n\n\n-----\n\n_Example of a malicious payment form on an infected website_\nThere is more than one way the second stage (the part which is responsible for stealing and\nsending stolen payment details to the attacker) of a web skimming attack can look. In the\ncode snippet below, there is an example. Here the attackers use a `POST request to`\nexfiltrate payment details, but they can also use `GET requests and` `WebSockets .`\n\n\n-----\n\n_Example of web skimming code_\nStolen payment details are usually sold on the dark web. These datasets of credit cards that\ncome from web skimming attacks are usually fresh and therefore they are better and can be\nsold for a higher price than for example data stolen from databases, which can be old in\nmany cases. More information about selling stolen cards can be found in Yonathan\nKlijnsma’s\n\nVB2019 paper: : Inside Magecart: the history behind the covert card-skimming assault on\nthe e-Commerce industry.\n\n## Web Skimming using Google Tag Manager\n\nIn `Q3 2021 we discovered a web skimming attack that uses` `Google Tag Manager`\n```\n(GTM) as a first stage. First, the infected webpage loads a script from\ngoogletagmanager[.]com/gtm.js?id=gtm-<code> via script injected in the HTML file\n\n```\nshown on the image below.\n\n_Code snippet from index.html on infected e-commerce website_\nThere is nothing unusual in this behaviour, many websites use `Google Tag Manager and`\nit looks exactly the same (it can be suspicious that the website loads more than one `GTM`\nscript though). But if we look closer in the `gtm.js file, we can find suspicious code in it. In`\nthe image below there is a comparison between malicious and clean `GTM script. In the`\n\n\n-----\n\nmalicious file, there is added custom code that loads another javascript file from\n```\nganalitis[.]com . This is the feature of GTM, it is possible to add a custom script (which\n\n```\nis then loaded from `googletagmanager.com domain).`\n\n_Difference between usual and malicious GTM code_\nWe were able to connect (based on our common signature and IP) `ganalitis[.]com`\nwith similar domains from the same attacker (data from `RiskIQ ).`\n\nDomain Active from IP\n```\n ganalitics[.]com 2021-06-03 193[.]203[.]203[.]240\n bingfindapi[.]com 2021-04-29 193[.]203[.]203[.]56\n webfaset[.]com 2021-04-13 193[.]203[.]203[.]56\n pixstatics[.]com 2021-05-19 193[.]203[.]203[.]56\n ganalitis[.]com 2021-10-21 91[.]242[.]229[.]96\n gstatsc[.]com 2021-12-13 91[.]242[.]229[.]96\n gstatlcs[.]com 2021-12-15 193[.]203[.]203[.]14\n gstatuslink[.]com 2022-01-02 91[.]242[.]229[.]96\n gtagmagr[.]com 2022-01-05 193[.]203[.]203[.]14\n\n```\nThe second stage (downloaded from the malicious domain) is a file named `favicon (later`\nrenamed to refresh) that contains about `400 lines of obfuscated javascript code. We`\nfound that this code was being changed over time to avoid detection. The deobfuscated\n\n\n-----\n\ncode is shown below, almost everything out of the 400 lines of code was just obfuscation.\nThis file hides malicious code responsible for downloading the final stage through\n```\nWebSockets .\n\n```\nThe final stage of malware is downloaded through `WebSockets . First, the web page sends`\nits hostname, and then according to that information the corresponding malicious javascript\nis received. This communication is shown in the image below.\n\nMalicious javascript code is about `1k lines long (formatted) and as the previous stage is`\nalso obfuscated. This code is responsible for stealing the payment details. At the end of the\nobfuscated javascript code (shown in the image below) is configuration which is different for\nevery infected eshop. The red box at the bottom shows the configuration where the fake\npayment form will be inserted into an `HTML file on the infected website.`\n\n\n-----\n\n_The end of the third stage file that contains configuration_\nThe code from the yellow box is decoded in the white box. It is a dictionary, the key\n\n`E528330211747l` contains the form field names that match the input form field names on\nthe infected webpage. The last key contains an exfiltration URL that is encoded in\n```\nbase64 . In the image below is a code from an infected website, we can see that the id of\n\n```\nthe email field (customer-email) is in the mentioned code.\n\nThe missing field names (from fake payment form) are in the variable `a0_0x11ac38 .`\nWhich is an array and contains the following fields:\n\nThe fake payment form embedded on the infected website is shown in the image below.\nAbove is the infected webpage, while below is how the webpage looks normally.\n\n\n-----\n\n_E-commerce website with fake payment form_\nThe stolen payment details (including details such as name and address) are sent to the\nattacker encoded in `base64 through` `WebSockets .`\n\n## Affected users\n\nIn the map below are shown countries with the most affected users. The top is\n```\nArgentina, because of prune[.]com[.]ar . Site was infected with the new malicious\n\n```\ndomain `gstatlcs[.]com .`\n\n\n-----\n\nThe second one is `Saudi Arabia` e-commerce website `souqtime[.]com . From` RiskIQ\ndata we can see that this e-commerce website was infected over time with at least seven\ndifferent web skimming domains.\n\nCurrently Avast detects the malicious domain `gstatuslink[.]com on` `souqtime[.]com .`\n\n## Conclusion\n\nOverall, we can say that the attacker uses `Google Tag Manager to avoid detection. At the`\nsame time they were able to change the domains from which the malicious code was\nloaded over time, he also changed the malicious code itself to hide from detection by\nantivirus.\n\n\n-----\n\nSome websites were infected for several months (for example `souqtime[.]com ). It can`\nbe difficult for users to spot that the site is infected. For example, it is suspicious if the user\nfills in the payment form on the website itself and is then redirected to another payment\nform on the payment gateway webpage. But in cases where the payment form is normally\npresent directly on the e-commerce website and the attacker steals payment details from\nthis legitimate form, it is really hard to notice that the website is infected. Therefore we\nrecommend using a second factor (e.g. mobile app or SMS code) to confirm internet\npayments if the bank supports it.\n\nWebsite owners should keep software updated, monitor logs for any suspicious activity, use\nstrong passwords and also use Web Application Firewall.\n\n**IOC malicious domains:**\n```\n   pixstatics[.]com\n   ganalitics[.]com\n   bingfindapi[.]com\n   webfaset[.]com\n   ganalitis[.]com\n   gstatsc[.]com\n   gstatlcs[.]com\n   gstatuslink[.]com\n   gtagmagr[.]com\n\n```\n[Tagged asanalysis,](https://decoded.avast.io/tag/analysis/) [magento,](https://decoded.avast.io/tag/magento/) [malware,](https://decoded.avast.io/tag/malware/) [skimming](https://decoded.avast.io/tag/skimming/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-01-24 - Web Skimming Attacks Using Google Tag Manager.pdf"
    ],
    "report_names": [
        "2022-01-24 - Web Skimming Attacks Using Google Tag Manager.pdf"
    ],
    "threat_actors": [
        {
            "id": "ce10c1bd-4467-45f9-af83-28fc88e35ca4",
            "created_at": "2022-10-25T15:50:23.458833Z",
            "updated_at": "2025-03-27T02:00:55.475188Z",
            "deleted_at": null,
            "main_name": "APT34",
            "aliases": null,
            "source_name": "MITRE:APT34",
            "tools": [
                "netstat",
                "Systeminfo",
                "PsExec",
                "SEASHARPEE",
                "Tasklist",
                "Mimikatz",
                "POWRUNER",
                "certutil"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "5a0483f5-09b3-4673-bb5a-56d41eaf91ed",
            "created_at": "2023-01-06T13:46:38.814104Z",
            "updated_at": "2025-03-27T02:00:02.925972Z",
            "deleted_at": null,
            "main_name": "MageCart",
            "aliases": [],
            "source_name": "MISPGALAXY:MageCart",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "cffb3c01-038f-4527-9cfd-57ad5a035c22",
            "created_at": "2022-10-25T15:50:23.38055Z",
            "updated_at": "2025-03-27T02:00:55.459558Z",
            "deleted_at": null,
            "main_name": "OilRig",
            "aliases": [
                "COBALT GYPSY",
                "IRN2",
                "APT34",
                "Helix Kitten",
                "Evasive Serpens",
                "Hazel Sandstorm",
                "EUROPIUM",
                "ITG13"
            ],
            "source_name": "MITRE:OilRig",
            "tools": [
                "ISMInjector",
                "RDAT",
                "Systeminfo",
                "QUADAGENT",
                "OopsIE",
                "Tasklist",
                "certutil",
                "ZeroCleare",
                "POWRUNER",
                "netstat",
                "ipconfig",
                "LaZagne",
                "BONDUPDATER",
                "SideTwist",
                "PsExec",
                "SEASHARPEE",
                "Mimikatz",
                "RGDoor",
                "ftp"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "67709937-2186-4a32-b64c-a5693d40ac77",
            "created_at": "2023-01-06T13:46:38.495593Z",
            "updated_at": "2025-03-27T02:00:02.848206Z",
            "deleted_at": null,
            "main_name": "OilRig",
            "aliases": [
                "IRN2",
                "Hazel Sandstorm",
                "EUROPIUM",
                "TA452",
                "Earth Simnavaz",
                "Cobalt Gypsy",
                "Crambus",
                "Helix Kitten",
                "APT 34",
                "APT34",
                "ATK40",
                "G0049",
                "Evasive Serpens",
                "Twisted Kitten"
            ],
            "source_name": "MISPGALAXY:OilRig",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535984,
    "ts_updated_at": 1743041449,
    "ts_creation_date": 1653710602,
    "ts_modification_date": 1653710602,
    "files": {
        "pdf": "https://archive.orkl.eu/d2a09edaca62504420cf724ec7fbb078858d59c2.pdf",
        "text": "https://archive.orkl.eu/d2a09edaca62504420cf724ec7fbb078858d59c2.txt",
        "img": "https://archive.orkl.eu/d2a09edaca62504420cf724ec7fbb078858d59c2.jpg"
    }
}