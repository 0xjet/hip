{
    "id": "3e3b5e52-5ac0-4ecb-936d-7967bed5ff46",
    "created_at": "2023-01-12T15:03:05.119338Z",
    "updated_at": "2025-03-27T02:05:33.384367Z",
    "deleted_at": null,
    "sha1_hash": "4419deebcab9e4c793d0e726c91ee3d9b06e232d",
    "title": "2022-03-28 - Threat Update DoubleZero Destructor",
    "authors": "",
    "file_creation_date": "2022-05-28T23:23:58Z",
    "file_modification_date": "2022-05-28T23:23:58Z",
    "file_size": 1834932,
    "plain_text": "# Threat Update DoubleZero Destructor\n\n**[splunk.com/en_us/blog/security/threat-update-doublezero-destructor.html](https://www.splunk.com/en_us/blog/security/threat-update-doublezero-destructor.html)**\n\nMarch 28, 2022\n\nBy [Splunk Threat Research Team March 28,](https://www.splunk.com/en_us/blog/author/secmrkt-research.html)\n\n2022\nThe Splunk Threat Research Team is actively monitoring the emergence of new threats in\nthe cyber domain of ongoing geopolitical events. As we have shown previously in several\nreleases, including HermeticWiper and CaddyWiper, actors in this campaign are deploying,\nupdating, and modifying stealthier malicious payloads. On March 17th, 2022, the Ukraine\n[CERT discovered a new malicious payload named DoubleZero Destructor (CERT-UA](https://cert.gov.ua/article/38088)\n#4243). This new malicious payload has the following features:\n\nEnumerates Domain Controllers and executes killswitch if detected. An automated\n_[friend or foe, like targeting function that avoids destroying Domain Controllers so](https://en.wikipedia.org/wiki/Identification_friend_or_foe)_\n[attackers can maintain access or perform further elevation tasks (i.e GPOs) on](https://docs.microsoft.com/en-us/previous-versions/windows/desktop/policy/group-policy-objects)\ncompromised networks.\nThe above feature also aims to help footprinting and identification of potential targets\nnon-targets.\nOverwrites files with zero blocks of 4096 bytes. It may alternatively use API calls such\nas NtFileOpen, NtFSControlFile for the same purpose.\nLists system files and then proceeds to destroy them.\nDeletes [registry hives: HKCU (currently logged user), HKLM (configuration of currently](https://docs.microsoft.com/en-us/troubleshoot/windows-server/performance/windows-registry-advanced-users)\ninstalled software), HKU (information of all active users in the system), HKLM \\BCD\n(Boot configuration data needed for UEFI, Legacy BIOS systems). Then shuts down\nthe computer.\n\n\n-----\n\nAn added layering of obfuscation via junk code to obfuscate and impair forensic\nanalysis.\n\n## Analysis\n\n### Preparing Targeted File path\n\nThis malware is a .net compiled binary that has a customized obfuscation and a large\namount of junk code that makes analysis harder to accomplish. Before performing its\ndestructive functions it will list several directory names and paths where it will look for files it\nwill wipe.\n\n### Domain Controller Kill Switch\n\nIt also has a function that will enumerate the list of domain controllers connected to the\ncompromised host. This function was used to skip or as a kill switch if the compromised\nhost is the domain controller machine. Below is the code snippet of how it enumerates all\nthe domain controllers that are spread across the code because of the inserted junk code.\n\n\n-----\n\n### Wiping Files\n\nAside from the directory names it lists, shown earlier in its code, this malware will\nenumerate all the drives mounted to the machine to look for more files to wipe. The code\nbelow shows how it gets the drive’s information within the compromised host machine.\n\nThen it will adjust the token privilege and the securityIdentifier of its process to have “full\n**control” file system rights to avoid error or access denied while wiping the normal or**\nsystem files it found in the compromised host. Below is the code, how it adjusts the\nprivilege, and how it sets the access control for files with full control and allow control type.\n\n\n-----\n\nThen It will open the target file using NtOpenFile() native API to zero or wipe it using a\nnative API NtFsControlFile() that sends an IOCTL control code\n**FSCTL_SET_ZERO_DATA directly to a specified file system. The wiper can wipe system**\nfiles that make the compromised host unbootable after the restart. Below is the code\nscreenshot of how this API was used in this wiper to do its destructive function.\n\nBelow is an example of the event that happened to the compromised test lab while it wipes\nthe file. We can see how the “MimeWriter.py” file was wiped with zero bytes after calling the\nIOCTL code FSCTL_SET_ZERO_DATA.\n\n\n-----\n\nWe also identified another wiping function. This additional function works by writing a\nzeroed buffer to the target file using filestream.write .net function. Below is the screenshot\nof its code after removing some of its junk code.\n\n\n-----\n\n### Deleting Registry Subkey\n\nThis wiper will also wipe known registry hives as part of its destructive payload. First, it will\nkill the enumerated process to look for a process with the name “lsass” and kill it. Below is\nthe code screenshot of how it enumerates all processes and executes process.Kill()\nfunction if the “lsass” process was found.\n\n\n-----\n\nThen it will change the ownership of the registry to the current logo user and change the\naccess control to full access to delete each of the subkeys in each HKLM, HKCU, HKU\nregistry hive. Below is the code snippet spread out in one of its classes that modifies the\nowner and access control to the registry to delete all of its registry subkeys.\n\n\n-----\n\n## Detections:\n\nThe Splunk Threat Research Team (STRT) has developed the following detections\nspecifically targeting this payload and produced several Analytic Stories (WhisperGate,\nHermeticWiper, CaddyWiper) targeting destructive software. These previous Analytic\nStories can also help in the detection of this payload.\n\n### Windows Terminating Lsass Process\n\nThis analytic is to detect a suspicious process terminating Lsass process. Lsass process is\nknown to be a critical process that is responsible for enforcing security policy. This\ntechnique was seen in double zero malware that tries to wipe files and registry in\ncompromised hosts.\n```\n`sysmon` EventCode=10 TargetImage=*lsass.exe GrantedAccess = 0x1\n | stats count min(_time) as firstTime max(_time) as lastTime by SourceImage,\nTargetImage,\n TargetProcessId, SourceProcessId, GrantedAccess CallTrace, Computer\n | rename Computer as dest \n | `security_content_ctime(firstTime)`\n | `security_content_ctime(lastTime)`\n\n```\n\n-----\n\n### Windows Deleted Registry by a Non-Critical Process File Path\n\nThis analytic is to detect the deletion of a registry with a suspicious process file path. This\ntechnique was seen in Double Zero wiper malware where it will delete all the subkeys in the\nHKLM, HKCU, and HKU registry hive as part of its destructive payload to the targeted\nhosts.\n```\n| tstats `security_content_summariesonly` count from datamodel=Endpoint.Registry\n where Registry.action=deleted by _time span=1h Registry.dest Registry.user\n Registry.registry_path Registry.registry_value_name Registry.registry_key_name \nRegistry.process_guid\n Registry.registry_value_data Registry.action | `drop_dm_object_name(Registry)` \n|rename process_guid\n as proc_guid |join proc_guid, _time [| tstats `security_content_summariesonly`\ncount\n FROM datamodel=Endpoint.Processes where NOT (Processes.process_path IN \n(\"*\\\\windows\\\\*\", \"*\\\\program files*\")) by _time span=1h Processes.process_id \nProcesses.process_name\n Processes.process Processes.dest Processes.parent_process_name \nProcesses.parent_process Processes.process_path\n Processes.process_guid | `drop_dm_object_name(Processes)` |rename process_guid as\n proc_guid | fields _time dest user parent_process_name parent_process process_name\n process_path process proc_guid registry_path registry_value_name\nregistry_value_data\n registry_key_name action] | table _time parent_process_name parent_process \nprocess_name\n process_path process proc_guid registry_path registry_value_name\nregistry_value_data\n registry_key_name action dest user \n | `windows_deleted_registry_by_a_non_critical_process_file_path_filter`\n\n```\n\n-----\n\n**Name** **Technique**\n**ID**\n\n\n**Tactic** **Description**\n\n\nExecutables\nOr Script\n[Creation In](https://research.splunk.com/endpoint/executables_or_script_creation_in_suspicious_path/)\nSuspicious\nPath\n\nSuspicious\n[Process File](https://research.splunk.com/endpoint/suspicious_process_file_path/)\nPath\n\nWindows\nTerminating\nLsass\nProcess\n(New)\n\n\n[T1036](https://attack.mitre.org/techniques/T1036/) Defense\nEvasion\n\n[T1543](https://attack.mitre.org/techniques/T1543/) Persistence,\nPrivilege\nEscalation\n\n\n[T1562.001](https://attack.mitre.org/techniques/T1562/001) Defense\nEvasion This analytic is to detect a suspicious\nprocess terminating Lsass process. Lsass\nprocess is known to be a critical process that\nis responsible for enforcing a security policy.\nThis technique was seen in double zero\nmalware that tries to wipe files and registry\nin compromised hosts.\n\n\nThis analytic will identify suspicious\nexecutable or scripts (known file extensions)\nin a list of suspicious file paths in Windows.\n\nThis analytic will detect a suspicious process\nrunning in a file path where a process is not\ncommonly seen and is most commonly used\nby malicious software.\n\n\n-----\n\nWindows\nDeleted\nRegistry By A\nNon Critical\nProcess File\nPath (New)\n\n\n[T1112](https://attack.mitre.org/techniques/T1112) Defense\nEvasion\n\n\nThis analytic is to detect deletion of registry\nwith suspicious process file path.\n\n\nFilename description\n\nDouble\nZero\nmalware\n\n\nSha256\n\n3b2e708eaa4744c76a633391cf2c983f4a098b46436525619e5ea44e105355fe\n\n\n## Learn More\n\n[You can find the latest content about security analytic stories on research.splunk.com. For a](https://research.splunk.com/)\n[full list of security content, check out the release notes on](https://docs.splunk.com/Documentation/ESSOC/3.21.0/RN/Enhancements) [Splunk Docs.](https://docs.splunk.com/Documentation/ESSOC)\n\n## Contributors\n\nWe would like to thank the following for their contributions to this post.\n\nTeoderick Contreras\nRod Soto\nJose Hernandez\nPatrick Barreiss\nLou Stella\nMauricio Velazco\nMichael Haag\nBhavin Patel\nEric McGinnis\n\n\n-----\n\nPosted by\n\n**[Splunk Threat Research Team](https://www.splunk.com/en_us/blog/author/secmrkt-research.html)**\n\nThe Splunk Threat Research Team is an active part of a customer’s overall defense\nstrategy by enhancing Splunk security offerings with verified research and security content\nsuch as use cases, detection searches, and playbooks. We help security teams around the\nglobe strengthen operations by providing tactical guidance and insights to detect,\ninvestigate and respond against the latest threats. The Splunk Threat Research Team\nfocuses on understanding how threats, actors, and vulnerabilities work, and the team\n[replicates attacks which are stored as datasets in the Attack Data repository.](https://github.com/splunk/attack_data/)\n\nOur goal is to provide security teams with research they can leverage in their day to day\noperations and to become the industry standard for SIEM detections. We are a team of\nindustry-recognized experts who are encouraged to improve the security industry by\nsharing our work with the community via conference talks, open-sourcing projects, and\nwriting white papers or blogs. You will also find us presenting our research at conferences\nsuch as Defcon, Blackhat, RSA, and many more.\n\n[Read more Splunk Security Content.](https://github.com/splunk/security_content)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-03-28 - Threat Update DoubleZero Destructor.pdf"
    ],
    "report_names": [
        "2022-03-28 - Threat Update DoubleZero Destructor.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535785,
    "ts_updated_at": 1743041133,
    "ts_creation_date": 1653780238,
    "ts_modification_date": 1653780238,
    "files": {
        "pdf": "https://archive.orkl.eu/4419deebcab9e4c793d0e726c91ee3d9b06e232d.pdf",
        "text": "https://archive.orkl.eu/4419deebcab9e4c793d0e726c91ee3d9b06e232d.txt",
        "img": "https://archive.orkl.eu/4419deebcab9e4c793d0e726c91ee3d9b06e232d.jpg"
    }
}