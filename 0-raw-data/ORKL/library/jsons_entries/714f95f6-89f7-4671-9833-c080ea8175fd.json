{
    "id": "714f95f6-89f7-4671-9833-c080ea8175fd",
    "created_at": "2022-10-25T16:48:15.736398Z",
    "updated_at": "2025-03-27T02:06:01.104014Z",
    "deleted_at": null,
    "sha1_hash": "ed64dc87623be86dd2022c5e54468c28ba346579",
    "title": "",
    "authors": "",
    "file_creation_date": "2019-03-05T09:10:23Z",
    "file_modification_date": "2019-03-05T09:10:23Z",
    "file_size": 1651291,
    "plain_text": "# The Arsenal Behind the Australian Parliament Hack\n\n**[blog.yoroi.company/research/the-arsenal-behind-the-australian-parliament-hack](https://blog.yoroi.company/research/the-arsenal-behind-the-australian-parliament-hack/)**\n\nZLAB-YOROI February 26, 2019\n\n## Introduction\n\nIn the past days, an infamous cyber attack targeted an high profile target on the APAC\narea: the Australian Parliament House. As [reported by the Australian prime minister there](https://www.bbc.com/news/world-australia-47166590)\nwas no evidence of any information theft and the attack has been promptly isolated and\ncontained by the [Australian Cyber Security Centre (ACSC), however the attackers gained](https://cyber.gov.au/government/news/parliament-house-network-compromise/)\naccess the ruling Liberal and National coalition parties networks as well as the opposition\nLabor Party, just few months before the federal election. The first technical insight points\nto sophisticate state sponsored threat actors operating in the Pacific region, but no official\nstatement has been been published and the speculation that China was behind the attack\nis not confirmed in any way.\n\nContextually to the cyber incident disclosure to the public, the ACSC declassified some of\nthe samples involved in the parliament hack, so the Cybaze-Yoroi ZLab team decided to\ninvestigate these artifacts to have an insight of Tools and Capabilities of part of this APT\ncyber arsenal.\n\n## Technical analysis\n\nAll the analyzed files seem to be related to a post-exploitation phase, where the attacker\nleveraged them to conduct data exfiltration and lateral movements. All the modules don’t\nbelong to an open-source post-exploitation framework, like Metasploit or Empire, but they\nseem to be written from scratch using the high-level language C# on top of the .NET\nFramework.\n\n### The LazyCat DLL\n\nThe firstly analyzed sample is known in the InfoSec community. The malware is named\n\nC\n\n\n-----\n\n1c113dce265e4d744245a7c55dadc80199ae972a9e0ecbd0c5ced57067cf755b\n\n**Threat** LazyCat\n\n\n**Descrip‐**\n**tion**\n\n\nLazyCat DLL to perform local privilege escalation\n\n\n**Ssdeep** 1536:kxnT6jqsSwI1ChVKt5QtkJBDbFw+IPpUuOE7qBp69bfeL:kxCpSz1CyIGrbgKuN‐\nS69bA\n\nTable 1: Information about LazyCat sample.\n\nA first static analysis shows the library is written in .NET, with no heavy obfuscation, and\ntherefore easily revertable to its source-code like representation.\n\nFigure 1: Static info about LazyCat sample.\n\nFigure 2: Part of malware’s code.\n\nAn interesting function spotted in the code reveal its capability to inspect and gather the\ncontests of an arbitrary process memory, through the usage of the MiniDumpWriteDump\nfunction belonging to DbgHelp library. The function’s result will be stored in a file just\ncreated using “Output” string parameter as name (Figure 3).\n\n\n-----\n\nFigure 3: DumpMemory function.\n\nMoreover, the malware is able to start a “TcpRelay” service, probably with the intent of\ncreate a route between the attacker’s network and the victim’s one and then to make the\nlateral movements easier.\n\nFigure 4: StartTcpRelay function.\n\nExploring source code, a particular module named “RottenPotato” emerges. It contains\nsome interesting functions, such as “findNTLMBytes” and “HandleMessageAuth”, related\nto the post-exploitation phase in MS Windows environments. After a quick search, it is\npossible to discover it is an open source tool publicly available on GitHub at\n[https://github.com/foxglovesec/RottenPotato.](https://github.com/foxglovesec/RottenPotato)\n\n\n-----\n\nFigure 5: findNTLMBytes function.\n\nMaking a diff analysis between the Github source code and the malware’s one, emerges\nthat some functions included into malware’s RottenPoteto are not present into public\nsource code. This indicates that the cyber attacker has further weaponized the code to\nmake it more effective for the malicious goal. At the same time, the usage of code publicly\navailable and open source tools makes more difficult a punctual attribution of the weapons\nto a particular cyber group.\n\nThe LazyCat sample owns a specific module clerks to cover tracks, named “LogEraser”.\n\nFigure 6: LazyCat.LogEraser module.\n\nThe main function of the module is “RemoveETWLog” which has the purpose of delete the\nETW (Event Tracing for Windows) files related to the malicious actions the attacker has\ndone.\n\n\n-----\n\nFigure 7: Code to delete Windows log events.\n\nAs shown in the above figure, the malware scans all the records belonging to the Windows\nLog and, if the record ID is equal to the given ID, it will be deleted.\n\nAt time of analysis, the sample had a middle-low detection rate, probably due to the\ncustomization of open source code-snippets; the result of VirusTotal analysis is visible in\nthe following figure:\n\nFigure 8: LazyCat detection.\n\n### The Powerkatz DLL\n\n\n-----\n\n**Threat** Generic\n\n\n**De‐**\n**scrip‐**\n**tion**\n\n\npowerkatz DLL\n\n\n**Ssdeep** 192:RPmh9ncu5qqTz3XQUOsnoGWX4L4Lzn066HVV1GfzacScaz/69ek4VUAVc:ucuqq‐\nTz3gUOsnoGWoL4Lz0661V1PcS5V\n\nTable 2: key information about powerkatz (sample 2)\n\n**Hash** Sha256: a95c9fe29a8ae0f618536fdf4874ede5412281e8dfb380bf1370a8d8794f787a\n\n**Threat** Generic\n\n\n**De‐**\n**scrip‐**\n**tion**\n\n\npowerkatz DLL\n\n\n**Ssdeep** 192:BPmh9ncu5qqTz3XQUOsnoGWX4L4Lan066HVV1GfzacScazu69ek4VUf:ecuqq‐\nTz3gUOsnoGWoL4L00661V1PcS57\n\nTable 3: key information about powerkatz (sample 3)\n\nDespite the different hashes, the malicious functionalities within the DLL are the\nsubstantially the same, the attacker simply modified some strings and variables names,\nprobably to evade av detection. The similarity between the samples is shown in Figure 9,\nwhere is possible to see the differences are minimal and they don’t impact the overall\nbehavior.\n\n\n-----\n\nFigure 9: Diff analysis between the samples.\n\nThe decompiled source code of the main class also confirms this similarity, i.e. inside the\nAsyncTask class in Figure 10. For this reason we will reference a single sample in the\nfollowing paragraphs.\n\n\n-----\n\nFigure 10: Comparison between AsyncTask class of both samples.\n\nThe sample is composed by few classes and functions, one of them seems a good\nstarting point for our analysis: the “StartNew”. As intended by its name, it is able to start a\nnew asynchronous task on the victim’s machine, executing the task object passed as _app\nparameter. Once the task is started, the function waits its completion using repeated 1-sec\nsleeps cycle, and then it returns a valid code status to the function caller. Probably this\nmodule can be used in conjunction with some other functions, belonging to other pieces of\nthe implant, to perform malicious actions in background, making all more stealth.\n\n\n-----\n\nFigure 11: Source code of the StartNew function.\n\nThe name of this sample, Powerkatz, reminds to a tool available on GitHub (\n[https://github.com/digipenguin/powerkatz) but even if the name is the same, the code is](https://github.com/digipenguin/powerkatz)\ndifferent. As the previous sample, also the detection rate of this sample, 28 of 70, is not\nhigh, as shown in Figure 11.\n\n\n-----\n\nFigure 12: Samples detection rate.\n\n### The Recon Module\n\n**Hash** Sha256:\nb63ae455f3deaca297b616dd3356063112cfda6e6c5434c407781461ae69361f\n\n**Threat** generic\n\n\n**Descrip‐**\n**tion**\n\n\nport scanner DLL\n\n\n**Ssdeep** 192:P4NjWnNsFM+5Ic8l5OG/i1/5gK0kbhdeODo3:P4NWnuf5Ic8l21iK0IhDS\n\nTable 4: key information about port scanner sample\n\nLike other samples, it is written C# programming language too. It has two main classes\nnamed “PortScanner” and “ReconCommonFuncs”, providing a direct clue of the actions\nenabled by this part of the implant.\n\nFigure 13: Sample’s classes.\n\nReading the first one’s code, in fact, the “portScan” contains an Integer array listing few of\nthe well-known network ports, covering major local network services such as HTTP,\nTELNET, RDP, POP, IMAP, SSH, SQL .. .\n\n\n-----\n\nFigure 14: Array containing the port numbers to scan.\n\nFor each declared port, the function is able to perform a TCP scan, trying to connect to it.\nIf there is an available service behind the port, it responds with its own service banner,\nwhich will be stored into a “StringBuilder” object. The malware concatenates the\nresponses from all the scanned ports and finally it writes the results in a file using the\n“ReconCommonFuncs” class.\n\n\n-----\n\nFigure 15: Code to perform port scan.\n\nFigure 16: Usage of TcpClient C# class to perform scan.\n\nThe “ReconCommonFuncs” class, instead, provides some utility functions, such as\n“Append” or “GZipAndBase64”, which are self-explanatory.\n\nFigure 17: Functions belonging to ReconCommonFuncs class.\n\n\n-----\n\n### The Powershell Agent\n\n**Hash** Sha256: 1087a214ebe61ded9f61de81999868f399a1105188467e4e44182c02ee264a19\n\n**Threat** generic\n\n\n**De‐**\n**scrip‐**\n**tion**\n\n\nOfficeCommu DLL\n\n\n**Ssdeep** 3072:JbMNa4pc+32UhnsZFM7iCHF6aZ4oFlSAsBycrxAqSPWy3it5r2py2jYN/IroVbpm:Jb‐\nWa4xmZcl9fFlSBtuZWQ6qp8DrhFJ\n\nTable 5: key information about the sample\n\nThe last sample analyzed by Yoroi ZLab – Cybaze is called “OfficeCommu.dll”, probably\nwith the intent of being confused with the legit Office Communication module available on\nmost Windows machines.\n\nAlso this sample is a sort of utility, probably used in the post-exploitation phase, with the\npurpose of creating a “PowershellAgent”, a stager component of the implant able to parse\nand execute Powershell commands.\n\n\n-----\n\nFigure 18: PowershellAgent’s main function.\n\n## Conclusion\n\nThe analyzed samples show the attackers choose a multi-modular approach for the\ndevelopment of their cyber-arsenal, realizing a complex implant leveraging an ecosystem\nof libraries providing proper functionalities to conduct advanced, and offensive, cyber\noperations.\n\nDespite these functions and libraries does not appear to contain any zero-day exploit or\ntechniques, the detection of these modules within a high value perimeter such as the\nAustralian Parliament provides important indication on cyber arsenal development\nstrategies of this threat actor, revealing the abuse and the customization of open-source\nPenTest tools and proof of concept is one of the preferred way the attackers used to build\ntheir arsenal, possibly due to the lower the “time-to-market” and resources required to\nwrite it, without impacting its effectiveness and dangerousness.\n\nShowing also, how these supposedly “known” techniques and tools can be easily\nrepackaged in evasive and silent implants, capable to bypass the traditional kinds of\nsecurity boundaries.\n\n## Indicator of Compromise\n\nHashes\n\n1c113dce265e4d744245a7c55dadc80199ae972a9e0ecbd0c5ced57067cf755b\n08a85f5fe8714b4842180c12c4d192bd186500af01ee39825f6d5100a2019ebc\na95c9fe29a8ae0f618536fdf4874ede5412281e8dfb380bf1370a8d8794f787a\nb63ae455f3deaca297b616dd3356063112cfda6e6c5434c407781461ae69361f\n1087a214ebe61ded9f61de81999868f399a1105188467e4e44182c02ee264a19\n\n### Yara Rules\n\n\n-----\n\ny _ _ _ {\n\nmeta:\ndescription = \"Yara Rule for LazyCat\"\nauthor = \"Cybaze Zlab_Yoroi\"\nlast_updated = \"2019_02_22\"\ntlp = \"white\"\ncategory = \"informational\"\n\nstrings:\n$a = \"LazyCat\"\n$b = {48 74 74 70 53 65 72 76 65 72 4C 6F}\n$c = {0A 58 73 9E 00 00 0A 2A 0F 00 28 B0}\n$d = {80 A1 4E CD 13 56 80 9F}\n\ncondition:\npe.number_of_sections == 3 and pe.machine == pe.MACHINE_I386 and\n(($b and $c and $d) or ($a))\n}\n\nimport \"pe\"\nrule Powerkatz_22_02_2019{\n\nmeta:\ndescription = \"Yara Rule for Powerkatz\"\nauthor = \"Cybaze Zlab_Yoroi\"\nlast_updated = \"2019_02_22\"\ntlp = \"white\"\ncategory = \"informational\"\n\nstrings:\n$a1 = {C7 E8 3F}\n$b1 = {7C 43 3D}\n$a2 = {A4 58 24 8A 3A 36 8D 4B 89 15 15 33 CE 1D 1D F2}\n$b2 = {A9 B5 2D 2A 00 47 AC 44 97 7A F5 D0 04 09 75 13}\n\ncondition:\npe.number_of_sections == 3 and pe.machine == pe.MACHINE_I386 and\n(($a1 or $b1) and ($a2 or $b2))\n}\n\nimport \"pe\"\nrule Office_Commu_22_02_2019{\n\nmeta:\ndescription = \"Yara Rule for Office_Commu\"\nauthor = \"Cybaze Zlab_Yoroi\"\nlast_updated = \"2019_02_22\"\ntlp = \"white\"\ncategory = \"informational\"\n\nstrings:\n$a = {61 E0 4B A1 1D C6 2F A7}\n$b = {8F D2 A9 E3 70 5A B4 D9 92 1D BA}\n$c = \"Kill\"\n$d = {DB 71 F5 4C B0 29 27 20 B8}\n$e = \"get_IsAlive\"\n\ncondition:\n\n\n-----\n\nimport \"pe\"\nrule eba_sample_22_02_2019{\n\nmeta:\ndescription = \"Yara Rule for 1eba_sample\"\nauthor = \"Cybaze Zlab_Yoroi\"\nlast_updated = \"2019_02_22\"\ntlp = \"white\"\ncategory = \"informational\"\n\nstrings:\n$a = {4A 02 73 29 00 00 0A 7D}\n$b = {F8 01 7A 00 1B 00 54 28}\n$c = \"portScan\"\n$d = {C9 45 99 B9 AA AD C7 46}\n$e = \"parseHost\"\n\ncondition:\npe.number_of_sections == 3 and all of them\n}\n\n_This blog post was authored by Davide Testa, Antonio Farina and Luca Mella of Cybaze-_\n_Yoroi Z-LAB_\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2019/2019.02.26.Australian_Parliament_Hack/The%20Arsenal%20Behind%20the%20Australian%20Parliament%20Hack.pdf"
    ],
    "report_names": [
        "The Arsenal Behind the Australian Parliament Hack"
    ],
    "threat_actors": [],
    "ts_created_at": 1666716495,
    "ts_updated_at": 1743041161,
    "ts_creation_date": 1551777023,
    "ts_modification_date": 1551777023,
    "files": {
        "pdf": "https://archive.orkl.eu/ed64dc87623be86dd2022c5e54468c28ba346579.pdf",
        "text": "https://archive.orkl.eu/ed64dc87623be86dd2022c5e54468c28ba346579.txt",
        "img": "https://archive.orkl.eu/ed64dc87623be86dd2022c5e54468c28ba346579.jpg"
    }
}