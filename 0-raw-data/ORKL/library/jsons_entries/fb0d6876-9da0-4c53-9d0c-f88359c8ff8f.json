{
    "id": "fb0d6876-9da0-4c53-9d0c-f88359c8ff8f",
    "created_at": "2023-01-12T15:05:58.914506Z",
    "updated_at": "2025-03-27T02:09:29.851929Z",
    "deleted_at": null,
    "sha1_hash": "c8df6a12c5dd82d67341e92ffbcfda890d041d89",
    "title": "2021-04-21 - Nearly half of malware now use TLS to conceal communications",
    "authors": "",
    "file_creation_date": "2022-05-28T01:22:31Z",
    "file_modification_date": "2022-05-28T01:22:31Z",
    "file_size": 4051354,
    "plain_text": "# Nearly half of malware now use TLS to conceal communications\n\n**[news.sophos.com/en-us/2021/04/21/nearly-half-of-malware-now-use-tls-to-conceal-communications/](https://news.sophos.com/en-us/2021/04/21/nearly-half-of-malware-now-use-tls-to-conceal-communications/)**\n\nSean Gallagher April 21, 2021\n\nTransport Layer Security has been one of the greatest contributors to the privacy and\nsecurity of Internet communications over the past decade. The TLS cryptographic protocol is\nused to secure an ever-increasing portion of the Internet’s web, messaging and application\ndata traffic. The secure HTTP (HTTPS) web protocol, StartTLS email protocol, Tor\nanonymizing network, and virtual private networks such as those based on the OpenVPN\nprotocol all leverage TLS to encrypt and encapsulate their contents—protecting them from\nbeing observed or modified in transit.\n\nOver the past decade, and particularly in the wake of revelations about mass Internet\nsurveillance, the use of TLS has grown to cover a majority of Internet communications.\nAccording to browser data from Google, the use of HTTPS has grown from just over 40\npercent of all web page visits in 2014 to 98 percent in March of 2021.\n\nIt should come as no surprise, then, that malware operators have also been adopting TLS for\nessentially the same reasons: to prevent defenders from detecting and stopping deployment\nof malware and theft of data. We’ve seen dramatic growth over the past year in malware\n[using TLS to conceal its communications. In 2020, 23 percent of malware we detected](https://news.sophos.com/en-us/2020/02/18/nearly-a-quarter-of-malware-now-communicates-using-tls/)\ncommunicating with a remote system over the Internet were using TLS; today, it is nearly 46\n**percent.**\n\n\n-----\n\nA\n\nbreakdown of malware outbound communications for the first 3 months of 2021.\nThere’s also a significant fraction of TLS communications that use an Internet Protocol port\nother than 443—such as malware using a Tor or SOCKS proxy over a non-standard port\nnumber. We queried against certificate transparency logs with the host names associated\nwith malware Internet communications on ports other than 443, 80, and 8080, and found\nthat 49 percent of the hosts had TLS certificates associated with them that were issued by a\nCertificate Authority (CA). A small fraction of the others manually checked used self-signed\ncertificates.\n\nBut a large portion of the growth in overall TLS use by malware can be linked in part to the\nincreased use of legitimate web and cloud services protected by TLS—such as Discord,\nPastebin, Github and Google’s cloud services—as repositories for malware components, as\ndestinations for stolen data, and even to send commands to botnets and other malware. It is\nalso linked to the increased use of Tor and other TLS-based network proxies to encapsulate\nmalicious communications between malware and the actors deploying them.\n\n\n-----\n\nA\n\nbreakdown of the destinations of TLS malware “callhome” traffic by ISP for the first three\nmonths of 2021.\nGoogle’s cloud services were the destination for nine percent of malware TLS requests, with\nIndia’s BSNL close behind. During the month of March 2021, we saw a rise in the use of\nCloudflare-hosted malware—largely because of a spike in the use of Discord’s content\ndelivery network, which is based on Cloudflare, which by itself accounted for 4 percent of the\ndetected TLS malware that month. We reported over 9,700 malware related links to Discord;\nmany were Discord-specific, targeting the theft of user credentials, while others were delivery\npackages for other information stealers and trojans.\n\nIn aggregate, nearly half of all malware TLS communications went to servers in the United\nStates and India.\n\n\n-----\n\nWe’ve seen an increase in the use of TLS use in ransomware attacks over the past year,\nespecially in manually-deployed ransomware—in part because of attackers’ use of modular\noffensive tools that leverage HTTPS. But the vast majority of what we detect day-to-day in\nmalicious TLS traffic is from initial-compromise malware: loaders, droppers and documentbased installers reaching back to secured web pages to retrieve their installation packages.\n\nTo gain insight into how usage of TLS in malware has changed, we took a deep dive into our\ndetection telemetry to both measure how much TLS is used by malware, identify the most\ncommon malware that leverage TLS, and how those malware make use of TLS-encrypted\ncommunications. Based on our detection telemetry, we found that while TLS still makes up\nan average of just over two percent of the overall traffic Sophos classifies as “malware\ncallhome” over a three-month period, 56 percent of the unique C2 servers (identified by DNS\nhost names) that communicated with malware used HTTPS and TLS. And of that, nearly a\nquarter is with infrastructure residing in Google’s cloud environment.\n\n## Surprise packages\n\nMalware communications typically fall into three categories: downloading additional malware,\nexfiltration of stolen data, and retrieval or sending of instructions to trigger specific functions\n(command and control). All these types of communications can take advantage of TLS\nencryption to evade detection by defenders. But the majority of TLS traffic we found tied to\nmalware was of the first kind: droppers, loaders and other malware downloading additional\nmalware to the system they infected, using TLS to evade basic payload inspection.\n\n\n-----\n\nIt doesn t take much sophistication to leverage TLS in a malware dropper, because TLSenabled infrastructure to deliver malware or code snippets is freely available. Frequently,\ndroppers and loaders use legitimate websites and cloud services with built-in TLS support to\nfurther disguise the traffic. For example, this traffic from a Bladabindi RAT dropper shows it\nattempting to retrieve its payload from a Pastebin page. (The page no longer exists.)\n\nTLS traffic from a Bladabini RAT dropper attempting to retrieve second-stage code from\nPastebin over TLS.\nWe’ve seen numerous cases of malware behaving this way in our research. The PowerShellbased dropper for LockBit ransomware was observed retrieving additional script from a\nGoogle Docs spreadsheet via TLS, as well as from another website. And a dropper for\n[AgentTesla (discussed later in this report) also has been observed accessing Pastebin over](https://news.sophos.com/en-us/2021/02/02/agent-tesla-amps-up-information-stealing-attacks/)\nTLS to retrieve chunks of code. While Google and Pastebin often quickly shut down\nmalware-hosting documents and sites on its platform, many of these C2 sources are\nabandoned after a single spam campaign, and the attackers simply create new ones for their\nnext attack.\n\nSometimes malware uses multiple services this way in a single attack. For example, one of\nthe numerous malware droppers we found in Discord’s content delivery network dropped\nanother stage also hosted on Discord, which in turn attempted to load an executable directly\nfrom GitHub. (The GitHub code had already been removed as malicious; we disclosed the\ninitial stages of the malware attack to Discord, along with numerous other malware, who\nremoved them.)\n\n\n-----\n\nA\n\npacket capture of malware retrieving downloads from Discord and GitHub.\nMalware download traffic actually makes up the majority of the TLS-based C2 traffic we\nobserved. In February 2021, for instance, droppers made up over 90 percent of the TLS C2\ntraffic—a figure that closely matches the static C2 detection telemetry data associated with\nsimilar malware month-to-month from January through March of 2021.\n\n## Covert channels\n\nMalware operators can use TLS to obfuscate command and control traffic. By sending\nHTTPS requests or connecting over a TLS-based proxy service, the malware can create a\nreverse shell, allowing commands to be passed to the malware, or for the malware to\nretrieve blocks of script or required keys needed for specific functions. Command and control\nservers can be a remote dedicated web server, or they can be based on one or more\ndocuments in legitimate cloud services. For example, the Lampion Portuguese banking\ntrojan used a Google Docs text document as the source for a key required to unlock some of\nits code—and deleting the document acted as a kill-switch. By leveraging Google Docs, the\nactors behind Lampion were able to conceal controlling communications to the malware and\nevade reputation-based detection by using a trusted host.\n\n\n-----\n\nThe (now trashed) Google document used to pass a key to the Lampion banking trojan.\nThe same sort of connection can be used by malware to exfiltrate sensitive information—\ntransmitting user credentials, passwords, cookies, and other collected data back to the\nmalware’s operator. To conceal data theft, malware can encapsulate it in a TLS-based\nHTTPS POST, or export it via a TLS connection to a cloud service API, such as Telegram or\nDiscord “bot” APIs.\n\n## SystemBC\n\nOne example of how attackers use TLS maliciously is SystemBC, a multifaceted malicious\ncommunications tool used in a number of recent ransomware attacks. The first samples of\nSystemBC, spotted over a year ago, acted primarily as a network proxy, creating what\namounted to a virtual private network connection for attackers based on SOCKS5 remote\nproxy connection encrypted with TLS—providing concealed communications for other\nmalware. But the malware has continued to evolve, and more recent samples of SystemBC\nare more full-featured remote access trojans (RATs) that provide a persistent backdoor for\nattackers once deployed. The most recent version of SystemBC can issue Windows\ncommands, as well as deliver and run scripts, malicious executables, and dynamic link\nlibraries (DLLs)—in addition to its role as a network proxy.\n\n\n-----\n\nSystemBC is not entirely stealthy, however. There s a lot of non-TLS, non-Tor traffic\ngenerated by SystemBC—symptomatic of the incremental addition of features seen in many\nlong-lived malware. The sample we recently analyzed has a TCP “heartbeat” that connects\nover port 49630 to a host hard-coded into the SystemBC RAT itself.\n\n[The first TLS connection is an HTTPS request to a proxy for IPify, an API that can be used to](https://www.ipify.org/)\nobtain the public IP address of the infected system. But this request is sent not on port 443,\nthe standard HTTPS port—instead, it’s sent on port 49271. This non-standard port usage is\nthe beginning of a pattern.\n\nSystemBC using TLS and HTTPS to connect to IPify to obtain the system’s public Internet\naddress.\nSystemBC then attempts to obtain data about the current Tor network consensus, connecting\nto hard-coded IP addresses with an HTTP GET request, but via ports 49272 and 49273.\nSystemBC uses the connections to download information about the current Tor network\nconfiguration.\n\nSystemBC collects Tor network data.\nNext, SystemBC establishes a TLS connection to a Tor gateway picked from the Tor network\ndata. Again, it uses another non-standard port: 49274. And it builds the Tor circuit to the\ndestination of its Tor tunnel using directory data collected via port 49275 via another HTTP\nrequest. There, the progression of sequential ports ends, and in the sample we analyzed it\ntries to fetch another malware executable via an open HTTP request over the standard port.\n\n\n-----\n\nThe file retrieved by this sample, henos.exe, is another backdoor that connects over TLS on\nthe standard port (443) to a website that returns links to Telegram channels—a sign that the\nactor behind this SystemBC instance is evolving tactics. SystemBC is likely to continue to\nevolve as well, as its developers address the mixed use of HTTP and TLS and the somewhat\npredictable non-standard ports that allow SystemBC to be easily fingerprinted.\n\n## AgentTesla\n\nLike SystemBC, [AgentTesla—an information stealer that can also function in some cases as](https://news.sophos.com/en-us/2021/02/02/agent-tesla-amps-up-information-stealing-attacks/)\na RAT—has evolved over its long history. Active for more than seven years, AgentTesla has\nrecently been updated with an option to use the Tor anonymizing network to conceal traffic\nwith TLS.\n\nWe’ve also seen TLS used in one of AgentTesla’s most recent downloaders, as the\ndevelopers have used legitimate web services to store chunks of malware encoded in\nbase64 format on Pastebin and a lookalike service called Hastebin. The first stage\ndownloader further tries to evade detection by patching Windows’ Anti-Malware Software\nInterface (AMSI) to prevent in-memory scanning of the downloaded code chunks as they’re\njoined and decoded.\n\n\n-----\n\nA\n\npacket capture of traffic from AgentTesla’s installer attempting to connect to Pastebin over\nTLS.\n\nThe Tor addition to AgentTesla itself can be used to conceal communications over HTTP.\nThere is also another optional C2 protocols in AgentTesla that that could be TLS protected—\nthe Telegram Bot API, which uses an HTTPS server for receiving messages. However, the\nAgentTesla developer didn’t implement HTTPS communications in the malware (at least for\nnow)—it fails to execute a TLS handshake. Telegram accepts unencrypted HTTP messages\nsent to its bot API.\n\n## Dridex\n\nDridex is yet another long-lived malware family that has seen substantial recent evolution.\nPrimarily a banking Trojan, Dridex was first spotted in 2011, but it has evolved substantially. It\ncan load new functionality through downloaded modules, in a fashion similar to the Trickbot\nTrojan. Dridex modules may be downloaded together in an initial compromise of the affected\n\n\n-----\n\nsystem, or retrieved later by the main loader module. Each module is responsible for\nperforming specific functions: stealing credentials, exfiltrating browser cookie data or\nsecurity certificates, logging keystrokes, or taking screenshots.\n\nDridex’s loader has been updated to conceal communications, encapsulating them with TLS.\nIt uses HTTPS on port 443 both to download additional modules from and exfiltrate collected\ndata to the C2 server. Exfiltrated data can additionally be encrypted with RC4 to further\nconceal and secure it. Dridex also has a resilient infrastructure of command and control (C2)\nservers, allowing installed malware to fail over to a backup if its original C2 server goes\ndown.\n\nThese updates have made Dridex a continuing threat, and Dridex loaders are among the\nmost common families of malware detected using TLS—overshadowed only by the next\ngroup of threats in our TLS rogues’ gallery: off-the-shelf “offensive security” tools repurposed\nby cybercriminals.\n\n## Metasploit and Cobalt Strike\n\nOffensive security tools have long been used by malicious actors as well as security\nprofessionals. These commercial and open-source tools, including the modular Cobalt Strike\nand Metasploit toolkits, were built for penetration testing and “red team” security evaluations\n—but they’ve been embraced by ransomware groups for their flexibility.\n\nOver the last year, we’ve seen a surge in the use of tools derived from offensive security\n[platforms in manually-deployed ransomware attacks, used by attackers to execute scripts,](https://news.sophos.com/en-us/2021/02/16/conti-ransomware-evasive-by-nature/)\ngather information about other systems on the network, extract additional credentials, and\nspread ransomware and other malware.\n\nA\n\nCobalt Strike configuration file from a recent Conti ransomware attack. The Cobalt Strike\nbeacon used HTTPS and TLS to communicate with the C2 server in the attack.\nTaken together, Cobalt Strike beacons and Metasploit “Meterpreter” derivatives made up\nover 1 percent of all detected malware using TLS—a significant number in comparison to\nother major malware families\n\n\n-----\n\n## And all the rest\n\n[Potentially unwanted applications (PUAs), particularly on the macOS platform, also leverage](https://news.sophos.com/en-us/2020/06/18/new-bundlore-adware-targets-macos-with-updated-safari-extensions/)\nTLS, often through browser extensions that connect surreptitiously to C2 servers to exfiltrate\ninformation and inject content into other web pages. We’ve seen the Bundlore use TLS to\nconceal malicious scripts and inject advertisements and other content into web pages,\nundetected. Overall, we found over 89 percent of macOS threats with C2 communications\nused TLS to call home or retrieve additional harmful code.\n\nThere are many other privacy and security threats lurking in TLS traffic beyond malware and\nPUAs. Phishing campaigns increasingly rely on websites with TLS certificates—either\nregistered to a deceptive domain name or provided by a cloud service provider. Google\nForms phishing attacks may seem easy to spot, but users trained to “look for the lock”\nalongside web addresses in their browser may casually type in their personally identifying\ndata and credentials.\n\n\n-----\n\nEven with the Comic Sans font and the Google Forms URL, some may still fall for this phish.\n\n## Traffic analysis\n\nAll of this adds up to a more than 100 percent increase in TLS-based malware\ncommunications since 2020. And that’s a conservative estimate, as it’s based solely on what\nwe could identify through telemetry analysis and host data.\n\n\n-----\n\nAs we ve noted, some use TLS over non-standard IP ports, making a completely accurate\nassessment of TLS usage impossible without deeper packet analysis of their\ncommunications. So the statistics sited in this report do not reflect the full range of TLSbased malicious communications—and organizations should not rely on the port numbers\nrelated to communications alone to identify potential malicious traffic. TLS can be\nimplemented over any assignable IP port, and after the initial handshake it looks like any\nother TCP application traffic.\n\nEven so, the most concerning trend we’ve noted is the use of commercial cloud and web\nservices as part of malware deployment, command and control. Malware authors’ abuse of\nlegitimate communication platforms gives them the benefit of encrypted communications\nprovided by Google Docs, Discord, Telegram, Pastebin and others—and, in some cases,\nthey also benefit from the “safe” reputation of those platforms.\n\nWe also see the use of off-the-shelf offensive security tools and other ready-made tools and\napplication programming interfaces that make using TLS-based communications more\naccessible continuing to grow. The same services and technologies that have made\nobtaining TLS certificates and configuring HTTPS websites vastly simpler for small\norganizations and individuals have also made it easier for malicious actors to blend in with\nlegitimate Internet traffic, and have dramatically reduced the work needed to frequently shift\nor replicate C2 infrastructure.\n\nAll of these factors make defending against malware attacks that much more difficult. Without\na defense in depth, organizations may be increasingly less likely to detect threats on the wire\nbefore they have been deployed by attackers.\n\n**SophosLabs would like to acknowledge Suriya Natarajan, Anand Aijan, Michael Wood,**\n**Sivagnanam Gn, Markel Picado and Andrew Brandt for their contributions to this**\n**report.**\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-04-21 - Nearly half of malware now use TLS to conceal communications.pdf"
    ],
    "report_names": [
        "2021-04-21 - Nearly half of malware now use TLS to conceal communications.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "b0d34dd6-ee90-483b-bb6c-441332274160",
            "created_at": "2022-10-25T16:07:23.296754Z",
            "updated_at": "2025-03-27T02:02:09.724313Z",
            "deleted_at": null,
            "main_name": "Aggah",
            "aliases": [
                "Operation Red Deer",
                "Operation Roma225"
            ],
            "source_name": "ETDA:Aggah",
            "tools": [
                "AgenTesla",
                "Agent Tesla",
                "AgentTesla",
                "Aggah",
                "Atros2.CKPN",
                "Bladabindi",
                "Jorik",
                "Nancrat",
                "NanoCore",
                "NanoCore RAT",
                "Negasteal",
                "Origin Logger",
                "Revenge RAT",
                "RevengeRAT",
                "Revetrat",
                "Warzone",
                "Warzone RAT",
                "ZPAQ",
                "Zurten",
                "njRAT"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535958,
    "ts_updated_at": 1743041369,
    "ts_creation_date": 1653700951,
    "ts_modification_date": 1653700951,
    "files": {
        "pdf": "https://archive.orkl.eu/c8df6a12c5dd82d67341e92ffbcfda890d041d89.pdf",
        "text": "https://archive.orkl.eu/c8df6a12c5dd82d67341e92ffbcfda890d041d89.txt",
        "img": "https://archive.orkl.eu/c8df6a12c5dd82d67341e92ffbcfda890d041d89.jpg"
    }
}