{
    "id": "a74a7584-bd98-4c2b-b9f8-30c71385b55b",
    "created_at": "2023-01-12T15:07:49.5887Z",
    "updated_at": "2025-03-27T02:13:58.342199Z",
    "deleted_at": null,
    "sha1_hash": "49ceb94bd55674de18c5a1513ebf7bc33a9edd8c",
    "title": "2021-10-25 - Digital banking fraud- how the Gozi malware works",
    "authors": "",
    "file_creation_date": "2022-05-27T22:51:46Z",
    "file_modification_date": "2022-05-27T22:51:46Z",
    "file_size": 2447850,
    "plain_text": "# Digital banking fraud: how the Gozi malware works\n\n**[cleafy.com/cleafy-labs/digital-banking-fraud-how-the-gozi-malware-work](https://www.cleafy.com/cleafy-labs/digital-banking-fraud-how-the-gozi-malware-work)**\n\nFederico Valentini, Francesco Iubatti\n\n## Download your PDF guide to TeaBot \n\nGet your free copy to your inbox now\n\nDownload PDF Version\n\n## Introduction\n\nAlso known as RM3, ISFB, Ursnif, Dreambot, CRM, and Snifula, Gozi can be considered as\na group of malware families which are based on the same malicious codebase. Historically, it\nhas been known as one of the most widely spread and longest-standing Banking Trojans\nwith more than 14 years of activity. Its unique modular architecture facilitates multiple Threat\n**Actors (TAs) in carrying on with their own malicious purposes, which in most cases are**\nincluded in the following categories:\n\nBanking fraud\neCommerce fraud\nPOS devices compromise\nRansomware\n\n\n-----\n\nSince its source-code was leaked in 2015, tracking all the different variants appears to be\nknotty and time consuming due to its fragmentation and the several distinct names used by\nsecurity firms and researchers. The main functionalities of Gozi families, and derivatives,\ninclude:\n\nActing as info-stealer by collecting system activities and data (including network and\nbrowser data)\nRecording keystrokes (keylogging)\nRecording videos or making screenshots\nPerforming MitB attacks on the targeted websites (e.g., Formgrabbing, Web-injects)\nRedirect browser navigation to malicious websites\nEnabling hVNC (hidden-VNC) and SOCKS proxy\n\nFocusing on the Banking fraud category, during the last 2 years we were able to analyze indepth a specific TA (or a group of affiliates) which distributes Gozi infections on EU territory\nto corporate banks and their customers.\n\nDuring our analysis, we were able to extract multiple TTPs on how this specific TA leverages\nGozi to execute unauthorized transactions to a well-organized network of bank mule\naccounts controlled by the same group.\n\n**OUR FINDINGS**\n\n**More than 50 different banks and financial institutions appear to be targeted by this**\ngroup, which includes both retail and corporate environments in Europe.\n\nThrough Gozi, the TA delivers a specific Web-inject family, which we dubbed as RATBANK\n(also known as ‘delsrc’), which is used to discriminate interesting bots and to perform\n**Account Takeover (ATO)** **fraud only on valid ones.**\n\nThe TA behind this pattern has a deep knowledge of how those targeted corporate banking\nenvironments work, which steps are needed to authorize a bank transfer, and how different\n2FA (two factor authentication) mechanisms can be bypassed, by identifying specific\nweaknesses in their implementation.\n\nDuring Q4 2020, the same group started distributing another Android malware (Alien) to\nexpand their attack surface also on mobile devices.\n\nThe TA has access to native-speaking operators who perform vishing attacks in the attempt\nto elicit victims during the execution of an ATO scenario and to try to isolate all the\ncommunication between victims and their banks with Social Engineering tricks.\n\nThe TA has access to a significant and well-structured set of money mule accounts, in\nmultiple SEPA (Single Euro Payment Area) and NON-SEPA countries, which are typically\ndiscriminated against by the amount of the unauthorized transaction.\n\n\n-----\n\nIn the last 2 years, we identified more than 100 bank accounts controlled by this group,\nwith the largest amount being 1,5M Euro, handled in a single bank transfer during a\ntargeted Account Takeover fraud.\n\n## Gozi malspam distribution: a recent example\n\nGozi has a very stable malspam distribution routine as many different campaigns have been\nused to spread this malware. In recent malspam campaigns, the well-known actor TA551 has\nbeen caught multiple times pushing Gozi infection to European citizen as follows:\n\n[Figure 1 – TA551/Shathak [1] pushing Gozi in Europe (April 2020)](https://twitter.com/malware_traffic/status/1385241028924518410)\n**TA551 (also known as Shathak) is a sophisticated threat actor behind an email-based**\nmalware distribution campaign that often targets end-users on a global scale.Historically,\nTA551 has pushed different payloads belonging to multiple malware families such as\n\n\n-----\n\nGozi/Ursnif, IcedID, and Trickbot.\n\nEven though TA551 often targets English-speaking victims, it has been caught targeting\nGerman, Italian and Japanese users as well by using geofencing techniques that make\npayloads not accessible to users in all regions and better protected against malware analysts\nand researchers.\n\nThe following list shows multiple maldocs that, last April, spread Gozi infection from a\nspecific TA551/Shathak campaign focused on both German and Italian lures:\n\n[Figure 2 - Gozi maldocs pushed[2] by TA551/Shathak](https://www.malware-traffic-analysis.net/2021/04/22/index.html)\n\n\n-----\n\nFigure 3 - TA551/Shathak German and Italian maldoc template\nFrom a high-level perspective, atypical Gozi infection is characterized by the following steps:\n\n1. The user opens the Word document attached to the received email and enables a\n\nmalicious macro which triggers the download of a dynamic link library (.dll) from a\nremote server.\n2. The downloaded .dll will be executed via RegSvr32.exe and unpack the core Gozi\n\nloader into memory, which is designed to manage all the interactions with the infected\nmachine (e.g download/launch additional modules, update configuration, etc.).\n3. Gozi uses Internet Explorer (IE) COM objects to communicate with its C2server; it\n\ncreates a running instance through the CoCreateInstance() API.\n\nThe previous steps can be better visualized with the following “process graph view” which\nhas been extracted from a recent Gozi malspam campaign:\n\n\n-----\n\n[Figure 4 - Gozi process tree view[3]](https://app.any.run/tasks/5c628008-9f2c-49d1-8a94-aa878e46076f/)\n\n[1] Source: [https://twitter.com/malware_traffic/status/1385241028924518410](https://twitter.com/malware_traffic/status/1385241028924518410)\n\n[2] Source: [https://www.malware-traffic-analysis.net/2021/04/22/index.html](https://www.malware-traffic-analysis.net/2021/04/22/index.html)\n\n[3] Source: [https://app.any.run/tasks/5c628008-9f2c-49d1-8a94-aa878e46076f/](https://app.any.run/tasks/5c628008-9f2c-49d1-8a94-aa878e46076f/)\n\n## Exploring the “Gozi fraud core toolkit”\n\nAfter a new victim has been successfully infected, the TA will deliver a specific configuration\nthrough the core Gozi loader, to instruct the bot on where to retrieve additional modules (also\nreferred to as “second stages”), which typically includes:\n\nWeb-inject kit(s) for the targeted applications\nhVNC module\nSOCKS module\n\n\n-----\n\nFigure 5 - Fraud-related additional modules (hVNC, Web-injects) from Gozi configuration\n**Web-injects are typically part of a MitB attack with the goal of modifying the content of a**\nlegitimate web page in real-time by performing API hooking. They are considered as an\nextension of the formgrabbing technique since they can intercept and manage web\nresponses, altering the content before it is displayed on the browser (bypassing TLS\nprotocol).\n\n**hVNC stands for Hidden VNC and means that the malware controls a machine without the**\nvictim’s knowledge. Instead of controlling a victim’s desktop, an attacker can open a hidden\ninstance in the shape of a virtual desktop and control it invisibly behind the scenes, even as\nthe unwitting victim continues using his or her computer.\n\n**SOCKS module enables TA to remotely connect to the infected bot, routing all the internet**\ndata through the same IP address as the victim, bypassing anti-fraud countermeasures such\nas network heuristics, etc.\n\nWe refer to those three modules as the “Gozi fraud core toolkit” since those are the\nmodules used by high-skilled fraud operators for conducting banking fraud nowadays which\ntypically happens only on the most valuable bots. This is an interesting pattern that we\nobserved especially over the last year: from the initial malspam campaign to the actual\nbanking fraud attempt, it can take weeks or even months, and during this period operators\n_enrich their botnet automatically via RATBANK, exfiltrating in the background useful_\ninformation, such as:\n\nValid credentials\nPersonal information and phone numbers(for further vishing attacks, if required)\nAccount balances\nRecent bank transfers\n2FA mechanism in use (e.g., SMS based, token based, QR codes)\n\n**RATBANK appears to be the main Web-inject kit used by this TA, which works as aRitB**\n(RAT in the Browser), injecting a malware code into the browser memory by using MitB\n(Man in the Browser) techniques. In this way the victim’s browser becomes a middle man\n\n\n-----\n\ncomponent for all monitored web sessions. These specific attacks are very hard to detect\nsince the compromised user continues to act undisturbed in a normal-looking web session\non his own device and with his own IP address, known to (and therefore not suspected by)\nthe targeted bank.\n\nFigure 6 - RATBANK injected during the login process into a targeted website\nDuring our analysis, we were also able to intercept “less-common” configurations where we\nnoticed the usage of another Web-inject kit in addition to RATBANK, also known as tables,\n[and well described in the following research published by FireEye in 2018.](https://www.botconf.eu/wp-content/uploads/2018/12/2018-J-Wyke-Tracking-actors-through-their-webinjects-.pdf)\n\nFigure7 - Two different Web-inject kits found on recent Gozi campaigns\nAn example of a related sample that has been caught delivering this specific configuration\nhas been provided in Appendix 1: IOCs.\n\n\n-----\n\nOnce extracted, we identified more than 50 different financial institutions targeted by this\nspecific configuration, including both retail and corporate banking environments, as shown in\nthe following table:\n\n**Country** **Number of targets** **Webinjects kit (family)** **Additional modules**\n\nItaly 39 RATBANK (delsrc) SOCKS-5, hVNC\n\nGermany 12 tables NA\n\nAppendix1: IOCs\n\n2ef16b02901c1bdd819ddf1aa96f3994 (Gozi maldoc)\n\n0b26191e482cf7c321efeb8d2569caac (Gozi loader)\n\nx-energy[.org/components/com_finder/img32.rar(hVNC 32 bit)\n\nx-energy[.org/components/com_finder/img64.rar(hVNC 64 bit)\n\necertificateboly[.us (RATBANK C2)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-10-25 - Digital banking fraud- how the Gozi malware works.pdf"
    ],
    "report_names": [
        "2021-10-25 - Digital banking fraud- how the Gozi malware works.pdf"
    ],
    "threat_actors": [
        {
            "id": "26a04131-2b8c-4e5d-8f38-5c58b86f5e7f",
            "created_at": "2022-10-25T15:50:23.579601Z",
            "updated_at": "2025-03-27T02:00:55.50292Z",
            "deleted_at": null,
            "main_name": "TA551",
            "aliases": [
                "TA551",
                "GOLD CABIN",
                "Shathak"
            ],
            "source_name": "MITRE:TA551",
            "tools": [
                "QakBot",
                "IcedID",
                "Valak",
                "Ursnif"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "04e34cab-3ee4-4f06-a6f6-5cdd7eccfd68",
            "created_at": "2022-10-25T16:07:24.578896Z",
            "updated_at": "2025-03-27T02:02:10.286803Z",
            "deleted_at": null,
            "main_name": "TA551",
            "aliases": [
                "Gold Cabin",
                "Monster Libra",
                "Shathak",
                "TA551"
            ],
            "source_name": "ETDA:TA551",
            "tools": [
                "BokBot",
                "CRM",
                "Gozi",
                "Gozi CRM",
                "IceID",
                "IcedID",
                "Papras",
                "Snifula",
                "Ursnif",
                "Valak",
                "Valek"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "90f216f2-4897-46fc-bb76-3acae9d112ca",
            "created_at": "2023-01-06T13:46:39.248936Z",
            "updated_at": "2025-03-27T02:00:03.031127Z",
            "deleted_at": null,
            "main_name": "GOLD CABIN",
            "aliases": [
                "Shakthak",
                "TA551",
                "ATK236",
                "G0127",
                "Monster Libra"
            ],
            "source_name": "MISPGALAXY:GOLD CABIN",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "40b623c7-b621-48db-b55b-dd4f6746fbc6",
            "created_at": "2024-06-19T02:03:08.017681Z",
            "updated_at": "2025-03-27T02:05:17.342829Z",
            "deleted_at": null,
            "main_name": "GOLD CABIN",
            "aliases": [
                "TA551 ",
                "Shathak"
            ],
            "source_name": "Secureworks:GOLD CABIN",
            "tools": [
                ""
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673536069,
    "ts_updated_at": 1743041638,
    "ts_creation_date": 1653691906,
    "ts_modification_date": 1653691906,
    "files": {
        "pdf": "https://archive.orkl.eu/49ceb94bd55674de18c5a1513ebf7bc33a9edd8c.pdf",
        "text": "https://archive.orkl.eu/49ceb94bd55674de18c5a1513ebf7bc33a9edd8c.txt",
        "img": "https://archive.orkl.eu/49ceb94bd55674de18c5a1513ebf7bc33a9edd8c.jpg"
    }
}