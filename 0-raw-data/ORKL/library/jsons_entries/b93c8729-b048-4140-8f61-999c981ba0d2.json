{
    "id": "b93c8729-b048-4140-8f61-999c981ba0d2",
    "created_at": "2023-01-12T15:10:20.3204Z",
    "updated_at": "2025-03-27T02:16:26.53281Z",
    "deleted_at": null,
    "sha1_hash": "8dfccb5571706901baf1d5282080187e467b675f",
    "title": "2017-05-02 - Philadelphia Ransomware",
    "authors": "",
    "file_creation_date": "2022-05-28T21:54:12Z",
    "file_modification_date": "2022-05-28T21:54:12Z",
    "file_size": 685849,
    "plain_text": "# Threat Spotlight: Philadelphia Ransomware\n\n**[cylance.com/en_us/blog/threat-spotlight-philadelphia-ransomware.html](https://www.cylance.com/en_us/blog/threat-spotlight-philadelphia-ransomware.html)**\n\nThe BlackBerry Cylance Threat Research Team\n\n## Introduction\n\nIt has been increasingly popular for malware authors to create and sell various frameworks\nto create ransomware easily. With an estimated [752% increase in new ransomware families](https://www.trendmicro.com/vinfo/us/security/research-and-analysis/threat-reports/roundup)\n[in 2016, both Ransomware-as-a-Service (RaaS) models such as Satan, or one-time license](https://threatvector.cylance.com/en_us/home/threat-spotlight-satan-raas.html)\n[models like Philadelphia make it trivially easy for those with enough money and absolutely](https://threatvector.cylance.com/en_us/home/https://threatvector.cylance.com/en_us/home/cylance-vs-philadelphia-ransomware.html)\nno coding experience to create and distribute ransomware indiscriminately. In a recent blog\npost, Forcepoint Security examined a Philadelphia sample that was leveraged in a\nspearfishing attack on a hospital in the Pacific Northwest, although it’s unclear at this\nmoment whether this attack was successful.\n\nThe emerging threat becomes clear: criminals with no programming knowledge are now able\nto target any organization or person with minimal effort. And what better way to maximize\n**_the payout than to target those industries where lives immediately depend on network_**\n**_connected devices that can be ransomed?_**\n\nThe Philadelphia ransomware is one of the latest in a rash of do-it-yourself ransomware\nframeworks that have become recently available. The Threat Guidance Team located a copy\n[of the builder for this threat on the dark web and took a closer look to discover what makes](https://en.wikipedia.org/wiki/Dark_web)\nthis ransomware different.\n\n## Philadelphia Ransomware Origins\n\nAt the time of writing, the Philadelphia builder can be found for sale by the same author of\n[Stampado ransomware for $300.00 for a lifetime license.](https://www.scmagazine.com/stampado-ransomare-cheap-but-easily-decrypted/article/575059/)\n\n\n-----\n\n-----\n\n_Figure 1. Philadelphia Builder Advertisement_\n\nThe builder generates obfuscated AutoIt payloads that can be optionally packed with a builtin UPX packer. AutoIt is a scripting language that is popular among sysadmins to create\ntools for legitimate administrative tasks due to its ease of use and ability to be compiled into\nstandalone executables.\n\nOne feature that sets Philadelphia apart is the use of PHP bridges to administer infected\nmachines. From the authors website:\n\n_“It's simply a PHP script that uses itself as database (no MySQL or whatever needed, just_\n_PHP). Bridges store the clients keys, verifies payments and provide the victims informations_\n\n_[sic] to the headquarters safely. And they can be hosted on nearly any server: even hacked_\n_servers…”_\n\nThis allows the attacker to simply place the PHP script on a compromised site, and does\naway with the need to administer and maintain a dedicated Virtual Private Server (VPS) to\nmonitor victim machines.\n\n## Building Philadelphia\n\nThe Philadelphia builder is available for a one-time fee, is highly configurable, and allows the\nuser to easily create a seemingly unlimited number of infected files for distribution.\n\nPhiladelphia operates with two components, an agent and PHP bridges. The agent is the\npayload that will execute on the victim machine and bridges that allow the attacker to\ncommunicate with the agents. Upon installation, the user is presented with a menu in which\na new agent can be created (Figure 1). The user is prompted to assign a file name to the\npayload, designates a specific icon to be associated with the agent and enters the directory\nin which the newly created payload will be saved.\n\n\n-----\n\n-----\n\n_Figure 2. Agent Generation, Naming the Final Executable_\n\nThe user then moves on to edit the ransom note if desired (Figure 2). The builder contains a\ndefault ransom message, but the text is fully configurable. (“<<< TEST TEST TEST TEST\nTEST>>>” in Figure 3 below was added by the Threat Guidance Team to demonstrate this\nflexibility.)\n\n\n-----\n\n-----\n\n_Figure 3. Agent Generation, Editing the Ransom Note_\n\nNext, the user designates both the name of the malicious process that will execute on the\nvictim machine (the default setting is lsass.exe) and the directory that the payload will extract\nto (the default is once again shown). For testing purposes, we have named the process\n“legitproc.exe.”\n\n\n-----\n\n-----\n\n_Figure 4. Agent Generation, Naming Process and Extraction Directory_\n\nFigure 5 shows that user can easily customize the ransom amount from within the builder:\n\n\n-----\n\n-----\n\n_Figure 5. Agent Generation, Determining Ransom Amount_\n\nFinally, a bridge must be created using a simple menu. Each bridge can be assigned a\nunique username and password, to avoid being taken over by anyone else. Figure 6\ndemonstrates the ease with which the PHP bridge script can be generated:\n\n\n-----\n\n-----\n\n_Figure 6. Bridge Generation, Naming Bridge and Setting Password_\n\nWhen all configurations are set and the bridge script has been created, clicking “Build” will\ngenerate and compile the payload, then drop it to the predesignated directory (in this case,\nthe Desktop, shown in Figure 7).\n\n\n-----\n\n-----\n\n_Figure 7: Agent and Bridge Script Generation Complete_\n\n## Building Bridges to the Victim\n\nOnce generated, the bridge PHP script can be dropped into any web server, removing the\nneed to maintain a dedicated virtual private server. As suggested by the author, a directory\non a compromised site is ideal for this type of deployment. A closer look at the bridge script\nreveals information about the type of administration tasks that are possible through the\nbridge script. Figure 8 illustrates the hardcoded bridge username and password as well as\ninformation about the ransom amount in the script.\n\n\n-----\n\n-----\n\n_Figure 8: PHP Bridge Script, Username and Password, Ransom Amount_\n\nFigure 9 shows the types of victim information that can be queried. Details regarding\ngeolocation and operating system as well as hardcoded BTC wallet addresses are available.\n\n\n-----\n\n-----\n\n_Figure 9: PHP Bridge Script, Victim System and BTC Wallet Information_\n\nFinally, Figure 10 shows that the attacker can also query information regarding the payment\nstatus of the victim.\n\n\n-----\n\n-----\n\n_Figure 10. PHP Bridge Script, Victim Payment Status_\n\n## Analysis\n\nThreat Guidance acquired a recent Philadelphia sample for testing: a 539kb compiled AutoIt\nscript, packed with UPX. When the executable is decompiled, five separate files are\nproduced:\n\n[4262].au3\n\ndelphi.au3.509\n\npd4ta.dat\n\nph1la.bin\n\nstub.au3.509\n\nAn initial look at the decompiled AutoIt script shows that it is heavily obfuscated, which is\ncommon for script-based malware (Figure 11). There is also no immediate indication of what\nroles most of the other files play in the payload. With some effort, it is possible to remove the\nobfuscation because the script itself must reverse the obfuscation to recover legitimate AutoIt\n[expressions. The obfuscated script makes heavy use of the Execute function to evaluate the](https://www.autoitscript.com/autoit3/docs/functions/Execute.htm)\nend result (Figure 12).\n\n\n-----\n\n-----\n\n_Figure 11: Decompiled Agent, Obfuscated AutoIt Script_\n\n\n-----\n\n-----\n\n_Figure 12: Decompiled Agent, Decoded Function_\n\n[A researcher by the name Calle ‘Zeta Two’ Svensson wrote an excellent blog post that](https://zeta-two.com/reversing/2017/03/20/gothenburg-malware.html)\ndetails the encryption and obfuscation methods employed by the script. In short,\ndelphi.au3.509 contains encoded constants for [4262].au3, and the other files contain RC4\nencrypted configuration information. The post offers a great deal of detail, so the decrypting\nefforts will not be detailed again here.\n\nUpon execution, after the UPX unpacking and script decoding, our generated agent begins\nrunning as the predefined “legitproc.exe” and runs from C:\\Users\\\n\n[user]\\AppData\\Roaming\\legitproc.exe.\n\n\n-----\n\n-----\n\n_Figure 13: Running Malicious Process With Attacker Designated Names_\n\nWhen the agent is executed, it will generate the encryption key, send it to the bridge, then\nreceive the ransom amount, a unique ID and BTC wallet information (Figure 14).\n\n\n-----\n\n-----\n\n_Figure 14: Network Traffic_\n\nIn this case, the PHP bridge script is being hosted on hxxp://foolonthehill(dot)com website,\n[(198.54.114[dot]228), a known malicious site that appears on multiple blacklists.](https://www.virustotal.com/en/url/07995a645b7233c2f8f5bf671e4ffe19d143404d3a61fdbb914ed1f7a91a1d57/analysis/1492603985/)\n\nThe attacker can configure when the image in Figure 15 appears - either at the initial\nexecution, or after encryption is complete - and a text file is also optionally dropped onto the\nDesktop.\n\n\n-----\n\n-----\n\n_Figure 15. Ransom Note_\n\n## Shortcomings in Philadelphia and Consequences For Its Victims\n\nPhiladelphia uses PHP bridge scripts to administer victim machines as well as store data in a\nflat file, removing the need for attackers to maintain dedicated hosts. While this is touted as a\nfeature by the author, distributors of this malware must keep bridges alive in hopes of\nensnaring a victim.\n\nMeanwhile, there is a real possibility that victims may be cut off from the bridge when the\ncompromise is discovered and remediated by the site’s owner. Or worse, a willing victim may\nsubmit a payment and never receive a key from the now-disabled bridge. As the information\nstored on the bridge includes the encryption key, any modification of the agent, or the\ndeletion of a bridge will make the decryption of the victim files impossible.\n\nFrom the documentation of the builder:\n\n_“…the encryption password is kept on the bridge, and not on the machine, and only the_\n_bridge can provide the right keys (based on conditions: the transaction ID be valid, for the_\n_wallet that has been set for that victim and also above the minimal amount, given the defined_\n_tolerance). If these conditions aren't fit, the password and decrypt all the files incorrectly, so_\n_all the data will be lost.”_\n\nFortunately for victims, the encrypted files can be completely recovered if the malware is\nretained. As Mr. Stevenson details on his blog, the key generation algorithm uses the built-in\n[Random function, which always uses the system time as the seed. For additional details on](https://www.autoitscript.com/autoit3/docs/functions/Random.htm)\n[recovering encrypted files, consult the No More Ransom website.](https://www.nomoreransom.org/)\n\n## Conclusion\n\nThe Philadelphia ransomware builder makes it very easy for would-be cybercriminals to\nchurn out attack payloads for distribution. While easy to deploy, a successful payout for\nransomware distributors may be a long time coming due to the overhead of keeping\ncompromised sites alive. The author is likely trying to cash in on a demand for cheap, easily\naccessible ransomware on the black market, making the real victims of this flawed\nransomware the wanna-be criminals themselves.\n\nOne only need conduct cursory research into ransomware delivery methods to discover that\nmuch of the time, victims are infected after interacting with an infected email attachment.\nThis is easily remedied by not interacting with unfamiliar, unsolicited email attachments.\n\n[If you use our endpoint protection product CylancePROTECT®, you were already protected](https://threatvector.cylance.com/en_us/home/https://threatvector.cylance.com/en_us/home/cylance-vs-philadelphia-ransomware.html)\nfrom this attack. If you don't have CylancePROTECT, [contact us to learn how our AI-driven](https://www.cylance.com/en_us/contact-us.html)\nsolution can predict and prevent unknown and emerging threats.\n\n\n-----\n\n## Indicators of Compromise (IoCs)\n\n**SHA-256 Hash:**\n\n4262B1C6EA0D11FBAABAEF6412B0B520317B26CB40688ADE6619CAC647EC35B0\n\n**MD5 Hash:**\n\n70c032329cc7bd1c6d27e1a5f0da6333\n\nThe BlackBerry Cylance Threat Research Team\n\n## About The BlackBerry Cylance Threat Research Team\n\nThe BlackBerry Cylance Threat Research team examines malware and suspected malware\nto better identify its abilities, function and attack vectors. Threat Research is on the frontline\nof information security and often deeply examines malicious software, which puts us in a\nunique position to discuss never-seen-before threats.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-05-02 - Philadelphia Ransomware.pdf"
    ],
    "report_names": [
        "2017-05-02 - Philadelphia Ransomware.pdf"
    ],
    "threat_actors": [
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673536220,
    "ts_updated_at": 1743041786,
    "ts_creation_date": 1653774852,
    "ts_modification_date": 1653774852,
    "files": {
        "pdf": "https://archive.orkl.eu/8dfccb5571706901baf1d5282080187e467b675f.pdf",
        "text": "https://archive.orkl.eu/8dfccb5571706901baf1d5282080187e467b675f.txt",
        "img": "https://archive.orkl.eu/8dfccb5571706901baf1d5282080187e467b675f.jpg"
    }
}