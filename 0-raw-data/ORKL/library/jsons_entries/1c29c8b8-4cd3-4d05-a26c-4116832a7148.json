{
    "id": "1c29c8b8-4cd3-4d05-a26c-4116832a7148",
    "created_at": "2023-01-12T14:59:33.579634Z",
    "updated_at": "2025-03-27T02:05:27.792057Z",
    "deleted_at": null,
    "sha1_hash": "94d105f513a92cfcca6cdc87a753cb94b54825df",
    "title": "2019-07-31 - SystemBC is like Christmas in July for SOCKS5 Malware and Exploit Kits",
    "authors": "",
    "file_creation_date": "2022-05-28T02:29:13Z",
    "file_modification_date": "2022-05-28T02:29:13Z",
    "file_size": 3142214,
    "plain_text": "# SystemBC is like Christmas in July for SOCKS5 Malware and Exploit Kits\n\n**[proofpoint.com/us/threat-insight/post/systembc-christmas-july-socks5-malware-and-exploit-kits](https://www.proofpoint.com/us/threat-insight/post/systembc-christmas-july-socks5-malware-and-exploit-kits)**\n\nJuly 31, 2019\n\n\n-----\n\n[Blog](https://www.proofpoint.com/us/blog)\n[Threat Insight](https://www.proofpoint.com/us/blog/threat-insight)\nSystemBC is like Christmas in July for SOCKS5 Malware and Exploit Kits\n\n\n-----\n\nAugust 01, 2019 Kade Harmon | Kafeine | Dennis Schwarz | The Proofpoint Threat Insight Team\n\n**Overview**\n\nSystemBC is a previously undocumented malware that we have recently observed as a payload in both\nRIG and Fallout exploit kit (EK) campaigns. While EK activity has remained quite low relative to its peak\nin early 2016, exploit kits remain important vectors for malware distribution, particularly in regions where\nWindows piracy is common. The new malware utilizes SOCKS5 proxies to mask network traffic to and\nfrom Command and Control (C&C) infrastructure using secure HTTP connections for well-known banking\nTrojans such as Danabot, which we have also observed distributed in the same EK campaigns.\n\n[A related sample of this malware may have been identified by other Infosec researchers on Twitter [2] in](https://twitter.com/James_inthe_box/status/1150397404916543488)\n[mid-October of 2018 distributing AZORult instead of Danabot. SystemBC may also have connections to](https://www.proofpoint.com/us/threat-insight/post/new-version-azorult-stealer-improves-loading-features-spreads-alongside)\n[Brushaloader and related malware.](https://www.proofpoint.com/us/threat-insight/post/brushaloader-still-sweeping-victims-one-year-later)\n\n**Campaign Analysis**\n\nWhile analyzing a Fallout EK campaign on June 4, 2019, Proofpoint researchers observed the\ndistribution of a previously unseen proxy malware. Most recently, the malvertising-based Fallout exploit\nkit chain has been used to deliver instances of Maze ransomware (Figure 1).\n\n_Figure 1: Malvertising-based Fallout EK chain that previously delivered Maze ransomware_\n\nOn June 6, 2019, Proofpoint researchers observed the new proxy malware in the wild again [3]. This\ntime it was being delivered via a Fallout EK and PowerEnum campaign (Figure 2) alongside an instance\nof the Danabot banking Trojan (affiliate ID 4).\n\n\n-----\n\n_Figure 2: Fallout EK dropping PowerEnum, which has been observed instructing the download of_\n_Danabot Affid 4 and a proxy malware DLL_\n\nBetween July 18 and 22, 2019, Proofpoint researchers observed the proxy malware a third time. This\ntime it was being distributed by the Amadey Loader, which itself was being distributed in a RIG EK\ncampaign.\n\nOther security researchers have also observed the malware being used in the wild. Notably, Vitali\nKremez saw a sample of the malware on May 2, 2019 [3], and @nao_sec observed it in connection with\nin a third Fallout EK campaign on July 13, 2019 [4].\n\n**Marketplace Analysis**\n\nSince this proxy malware was being used in multiple separate campaigns, Proofpoint researchers\nbelieve it was very likely that it was being sold in an underground marketplace. Moreover, we found an\nadvertisement from April 2, 2019, on an underground forum that described a malware named “socks5\nbackconnect system” (Figure 3) that matched the functionality of the malware seen in the above\ncampaigns. To differentiate from other malware leveraging SOCKS5, we dubbed the new malware\n“SystemBC” based on the URI path shown in the advertisement’s panel screenshots (Figures 4 and 5).\n\n\n-----\n\n_Figure 3: Original forum advertisement for SystemBC (translated from Russian)_\n\nThe advertisement also contains screenshots of the C&C panel (Figure 4-6). The simple C&C panel\nboasts a list of victim computers, automated updating, and built-in authentication. The builder allows\nusers to create a set number of samples with custom configurations.Figure 3: Original forum\n_advertisement for SystemBC malware (translated from Russian)_\n\n\n-----\n\n_Figure 4: SystemBC Administrator Panel (as observed in an underground advertisement)_\n\n_Figure 5: Another section of the SystemBC Administrator Panel (as observed in an underground_\n_advertisement)_\n\n\n-----\n\n_Figure 6: SystemBC Builder (as observed in the advertisement noted above)_\n\n**Malware Analysis**\n\nSystemBC is written in C++ and primarily sets up SOCKS5 proxies on victim computers that can then be\nused by threat actors to tunnel/hide the malicious traffic associated with other malware.\n\n**Configuration**\n\nImportant strings such as the C&C servers, DNS servers, and port number are encrypted with a 40-byte\nXOR key that is stored in memory. Reference [5] is a GitHub-hosted Ghidra Python script that can be\nused to decrypt the configuration from the analyzed sample (Figure 7):\n\n_Figure 7: Decrypted malware configuration_\n\n\n-----\n\nThe DNS servers are used to resolve .bit domains. The malware calls a function to check whether the\nserver name ends in “.bit.” If it does, a DNS query will be generated by iterating through the list of DNS\nhostnames until the malware finds a valid server (Figures 8 and 9). It is worth mentioning that although\nboth the screenshots and samples reference OpenNIC, they are no longer resolving “.bit” domains [6].\n\n_Figure 8: SystemBC performing the initial “.bit” check_\n\n_Figure 9: The malware checks to see if the last four characters of the server name are “.bit”_\n\n**Command and Control**\n\nAll packets are encrypted using standard RC4, but the S-Box is initialized in a novel way (Figure 10):\n\n_Figure 10: Side-by-side comparison of the SystemBC RC4 S-Box initialization (left) and the more_\n_common implementation (right)_\n\nAn example of the hex-encoded (for visibility) C&C communications are available in Figure 11:\n\n\n-----\n\n_Figure 11: Example C&C communications (hex-encoded for visibility)_\n\nThe client begins the communication by sending a 100-byte packet to the C&C address.\n\nThe packet contains four elements:\n\nBytes 0-49 Plaintext RC4 key\n\nBytes 50-51 Windows build ID\n\nBytes 52-53 Boolean determining if the client is running on an x64 processor\n\nBytes 53-99 Client machine’s account name, with trailing zeroes\n\nIt was derived from the following decompiled code (Figure 12):\n\n\n-----\n\n_Figure 12: Logic of initial packet creation_\n\nThis is verified by decrypting the last 50 bytes of the packet using the first 50 bytes as the RC4 key. The\nresult is plaintext data (Figure 13).\n\n_Figure 13: Decryption of the initial packet data_\n\nThe return packet from the C&C server contains two main segments, a header and data, which are\ndecrypted separately using the RC4 key from the first packet. The header, which makes up the initial 4\nbytes of the packet, has a type, index, and length field. The data segment takes up the remaining bytes\nin the packet and contains details for the creation of a SOCKS5 proxy connection. A breakdown of the\npacket is as follows:\n\n\nByte\n0\n\nByte\n1\n\n\nType\n\n1: Indicates the following “data” packet is SOCKS5 proxy traffic and is associated with the\nidentified index number.\n\n0: Create a new proxy and will assign it the given index number. The index number is\nassigned by the C&C server and is used to associate traffic to a particular proxy.\n\n-1: Update malware by downloading an executable, save it with a randomly generated name\nin the TEMP directory, then run the file\n\nIndex: Tells the infected machine which proxy to use\n\n\n-----\n\nBytes\n2-3\n\nBytes\n3\n\nLength: records the number of bytes in the following data chunk\n\nSOCKS5 packet information\n\n\n_Figure 14: Decryption of the first response packet_\n\nReferencing source [7], we can map these values to a structured SOCKS5 client connection request\npacket to yield (for example):\n\nVersion: 5\n\nCommand code: 1\n\nReserved: 0\n\nAddress type: 3\n\nLength of domain: 19\n\nDomain name: accounts.google.com\n\nPort number: 443\n\nThe second packet sent from the client to the server contains a 3-byte RC4-encrypted header consisting\nof an index number and data length. Repeating the above steps, but instead assuming a 3-byte header,\nwe can decrypt a typical SOCKS5 server acknowledgment:\n\nVersion: 5\n\nStatus: 0\n\nReserved: 0\n\nAddress type: 1\n\nIPv4 Address: 00 00 00 00\n\nPort number: 00 00\n\nThis sample goes on to initialize another proxy with a different domain name and an incrementing index\nvalue.\n\n\n-----\n\nWith the proxies initialized, the client now begins to retrieve data requested from the C&C via HTTPS.\nWe can discern that data with a 3-byte header contains response data sent from the proxy while data\nsent with a 4-byte header are commands from the C&C server.\n\n**Conclusion**\n\nProofpoint researchers have identified a previously undocumented proxy malware, dubbed \"SystemBC\",\nbeing distributed by the Fallout and RIG exploit kits.\n\nIn the most recently tracked example, the Fallout exploit is used to download the Danabot banking\n[Trojan and a SOCKS5 proxy which is used on the victim’s Windows system to evade detection of](https://samsclass.info/122/proj/how-socks5-works.html)\ncommand and control (C&C) traffic. The synergy between SystemBC as a malicious proxy and\nmainstream malware creates new challenges for defenders relying on network edge detections to\nintercept and mitigate threats like banking Trojans.\n\nProofpoint recommends that organizations continue to remain vigilant in keeping their Windows client\nand server operating systems as well as infrastructure devices patched with vendor-recommended\nupdates and patches, to retire the use of legacy systems which use susceptible browser plugins such as\nAdobe Flash Player, and to retire legacy Windows systems that may be susceptible to exploit kits such\nas Fallout.\n\n**References**\n\n[1] [https://www.proofpoint.com/us/threat-insight/post/brushaloader-still-sweeping-victims-one-year-later](https://www.proofpoint.com/us/threat-insight/post/brushaloader-still-sweeping-victims-one-year-later)\n\n[2] [https://twitter.com/James_inthe_box/status/1150397404916543488](https://twitter.com/James_inthe_box/status/1150397404916543488)\n\n[3] [https://twitter.com/VK_Intel/status/1123867031709863937](https://twitter.com/VK_Intel/status/1123867031709863937)\n\n[4] [https://twitter.com/nao_sec/status/1150038665013235717](https://twitter.com/nao_sec/status/1150038665013235717)\n\n[5] [https://github.com/EmergingThreats/threatresearch/blob/master/SystemBC/XORscript.py](https://github.com/EmergingThreats/threatresearch/blob/master/SystemBC/XORscript.py)\n\n[6] [https://wiki.opennic.org/votings/drop_namecoin](https://wiki.opennic.org/votings/drop_namecoin)\n\n[7] [https://samsclass.info/122/proj/how-socks5-works.html](https://samsclass.info/122/proj/how-socks5-works.html)\n\n**Indicators of Compromise (IOCs)**\n\n**IOC** **IOC Type** **Description**\n\ne8627abf6b2e9ccebbc544d485b4e2bccd22580b4dc7ba8510d4e4e8bba63fc9 SHA256 June 4,\n2019\nSystemBC\nMalware\n\nmie[.crypto-crypto[.site Hostname June 4,\n2019\nSystemBC\nC&C\n\n\n-----\n\n893305fd80eb324b262406c60496163ed4ff73dad679f1bd543ff703de457f91 SHA256 June 6,\n2019\nSystemBC\nMalware\n\ngougounu[.site Domain June 6,\n2019\nSystemBC\nC&C\n\n3261f0e45d867236d4794b2a3dce38663bb319a6fabec7ae07fac3237e474689 SHA256 July 18,\n2019\nAmadey\n\n\ndsntu[.top\n\nelienne[.net\n\namnsns[.com\n\nhxxp://mmasl[.com/s1.exe\n\nhxxp://calacs-laurentides[.com/s1.exe\n\n\nDomains July 18,\n2019\nAmadey C2\nhosted\nbehind\nSandiflux\n\nURLs July 18-22,\n2019\n\nAmadey\nTasks\n(SystemBC)\n\n\n9024a3ec7df6ef51f69c2e452da26d3a45743fd1c49b2d59beeb83be0949fe06 SHA256 July 18,\n2019\nSystemBC\nMalware\n\n20a7cfcaf76890ad5e959e5662f421f41126d3ee1edace8f5531f8effecb6051 SHA256 July 22,\n2019\nSystemBC\nMalware\n\n146.0.75[.34 IP July 18-22,\n2019\nSystemBC\nC&C\n\n6269d9ce2adb19a46bffefe50c9b3e00974c4dc8f4c2dc0156545707efb4f453 SHA256 July 24,\n2019\nSystemBC\nMalware\n\nSubscribe to the Proofpoint Blog\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-07-31 - SystemBC is like Christmas in July for SOCKS5 Malware and Exploit Kits.pdf"
    ],
    "report_names": [
        "2019-07-31 - SystemBC is like Christmas in July for SOCKS5 Malware and Exploit Kits.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535573,
    "ts_updated_at": 1743041127,
    "ts_creation_date": 1653704953,
    "ts_modification_date": 1653704953,
    "files": {
        "pdf": "https://archive.orkl.eu/94d105f513a92cfcca6cdc87a753cb94b54825df.pdf",
        "text": "https://archive.orkl.eu/94d105f513a92cfcca6cdc87a753cb94b54825df.txt",
        "img": "https://archive.orkl.eu/94d105f513a92cfcca6cdc87a753cb94b54825df.jpg"
    }
}