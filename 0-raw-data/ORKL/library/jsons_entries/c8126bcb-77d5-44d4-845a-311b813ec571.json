{
    "id": "c8126bcb-77d5-44d4-845a-311b813ec571",
    "created_at": "2022-10-25T16:48:22.077227Z",
    "updated_at": "2025-03-27T02:09:29.201128Z",
    "deleted_at": null,
    "sha1_hash": "37563d47952e48cc0223c8d8d1b84a24ba1f83b9",
    "title": "Attack Delivers ‘9002’ Trojan Through Google Drive - Palo Alto Networks BlogPalo Alto Networks Blog",
    "authors": "",
    "file_creation_date": "2016-07-28T10:02:05Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 557479,
    "plain_text": "### 16\n\n\n**infrastructure associated with this 9002 Trojan sample was also found to have previous ties to**\n\n**attacks on Myanmar and other Asian countries that used Poison Ivy as the payload, including a**\n\n**recent, and possibly ongoing campaign against Taiwan.**\n\n**While we do not have specific telemetry on the attack at this time, we believe the attack relies**\n\n**on a shortened link (in this case using the URL shortening service TinyURL) to deliver the 9002**\n\n**payload. The shortened URL is as follows:**\n\n**hxxp://tinyurl[.]com/zmu4dry**\n\n**This shortened link redirects to an actor-controlled server that we refer to as a redirection server,**\n\n**as it hosts a script responsible for redirecting the browser to another location. The shortened link**\n\n**above points to:**\n\n**hxxp://222.239.91[.]152?**\n\n**<redacted>QGdtYWlsLmNvbWh0dHA6Ly90aW55dXJsLmNvbS9qZmo5b3V2**\n\n**The URL above contains base64 encoded data, which we believe will then be decoded by the**\n\n**server. The base64 encoded parameter in the URL redirect decodes to:**\n\n**<redacted>@gmail.comhttp://tinyurl[.]com/jfj9ouv**\n\n**The Gmail address in the decoded data is the legitimate address of a well-known politician and**\n\n**human rights activist in Myanmar. The shortened URL within the decoded data, specifically**\n\n**‘hxxp://tinyurl[.]com/jfj9ouv’ again redirects to:**\n\n**hxxps://drive.google[.]com/uc?**\n\n**id=0B0eVt8dSXzFuN2ltVlVkVl8zNVU&authuser=0&export=download**\n\n**The server with an IP address of ‘222.239.91[.]152’ appears to run a script that parses**\n\n**parameters from inbound HTTP requests. To better determine the script’s functionality, we**\n\n**issued a series of HTTP requests to the redirection server to figure out the purpose of the**\n\n**base64 encoded data within the URL and to determine the strings that the script uses to redirect**\n\n**the browser.**\n\n**Our initial HTTP request, as seen in Figure 1, involved the URL pointed to by the initial**\n\n**shortened link associated with this attack. As seen from the HTTP response, the script issued**\n\n**an HTTP 302 Moved Temporarily response to relocate the browser to the URL in the “Location”**\n\n**field, which is the same URL from the decoded base64 data sent in the HTTP request.**\n\n**1** **$** **curl -i -A** **\"Mozzarella/4.0\"** **222.239.91[.]152?<redacted>QGdtYWlsLmN**\n**2** **HTTP/1.1** **302** **Moved Temporarily**\n**3** **Connection: close**\n**4** **Content-Length: 0**\n**5** **Date: Mon,** **18** **Jul** **2016** **16:25:28** **GMT**\n**6** **Location: http://tinyurl[.]com/jfj9ouv**\n\n**Figure 1 Response to HTTP request to initial delivery URL**\n\n**The second test HTTP request we issued used the base64 encoded data for the string**\n\n**“fake@gmail.comhttp://yahoo.com”, which as seen in Figure 2 would redirect the browser to**\n\n**“http://yahoo.com” via an HTTP 302 response. This suggests that the email string is not used for**\n\n**any sort of authentication for the inbound request, and instead is possibly used by the threat**\n\n**actors to track successful clicks by a targeted email.**\n\n|Col1|POSTED BY: Robert Falcone and Jen Miller-Osborn on July 26, 2016 5:00 PM|\n|---|---|\n|16||\n|LLiikkee|FILED IN: Unit 42 TAGGED: 9002 Trojan, AutoFocus, Google Drive, HTTP, Poison Ivy, TinyURL, Trojan, WildFire Unit 42 recently observed a 9002 Trojan delivered using a combination of shortened links and a shared file hosted on Google Drive. The delivery method also uses an actor-controlled server hosting a custom redirection script to track successful clicks by targeted email addresses. The|\n|Tweet||\n|1||\n\n\n## Interns Meet Executives: Annual Gathering at CEO’s House\n\n**[posted by Kristina Valenziano on July 27, 2016](http://researchcenter.paloaltonetworks.com/author/kristina-valenziano/)**\n\n## Palo Alto Networks Researchers Discover Critical Safari 9.1 Vulnerability\n\n**[posted by Ryan Olson on July 27, 2016](http://researchcenter.paloaltonetworks.com/author/ryan-olson/)**\n\n## Attack Delivers ‘9002’ Trojan Through Google Drive\n\n**[posted by Robert Falcone on July 26, 2016](http://researchcenter.paloaltonetworks.com/author/robert-falcone/)**\n\n## How to Interpret HHS Guidance on Ransomware as a HIPAA Breach\n\n**[posted by Matt Mellen on July 25, 2016](http://researchcenter.paloaltonetworks.com/author/matt-mellen/)**\n\n## Putting the METI Cyberthreat Information Sharing Recommendation Into Action in Japan\n\n**[posted by Mihoko Matsubara on July 25, 2016](http://researchcenter.paloaltonetworks.com/author/mihoko-matsubara/)**\n\n**[MORE →](http://researchcenter.paloaltonetworks.com/archives/)**\n\n\n**Select a Category**\n\n**Select a Month**\n\n**[MORE →](http://researchcenter.paloaltonetworks.com/archives/)**\n\n\n## 1\n\n\n-----\n\n**4**\n**5**\n**6**\n\n\n**Content-Length: 0**\n**Date: Mon,** **18** **Jul** **2016** **17:10:33** **GMT**\n**Location: http://yahoo.com**\n\n\n**Figure 2 Test request confirming that the redirection server uses the base64 decoded data for**\n\n**redirection**\n\n**We issued an HTTP request using the base64 encoded data for the string**\n\n**“fake@gmail.comyahoo.com”. Figure 3 shows that the server responded with an HTTP 200 OK**\n\n**response that attempts to resemble an HTTP 403 Forbidden response, by writing “403**\n\n**Forbidden” to the browser window. This error suggests that the redirection script on the server**\n\n**parses the base64 decoded data for the string “http” to determine the redirection location.**\n\n\n**1**\n**2**\n**3**\n**4**\n**5**\n**6**\n**7**\n**8**\n\n\n**$** **curl -i -A** **\"Mozzarella/4.0\"** **http://222.239.91[.]152/?ZmFrZUBnbWFpb**\n**HTTP/1.1** **200** **OK**\n**Connection: close**\n**Content-Type: text/html;** **charset=ISO-8859-1**\n**Content-Length: 89**\n**Date: Mon,** **18** **Jul** **2016** **17:11:10** **GMT**\n\n**<html><head><title>403** **Forbidden</title></head><body><h1>403** **Forbidd**\n\n\n**Figure 3 Test request showing the redirection server requires “http” within the base64 decoded**\n\n**data**\n\n**We ran subsequent test requests to find additional strings that the script would check for within**\n\n**the base64 decoded data, which it uses to determine the location it should redirect the browser.**\n\n**We found that the script also supports redirection to URLs that begin with “https”. Also, the script**\n\n**is case sensitive, as requests for URLs with “HTTP” and “HTTPS” resulted in the same 403**\n\n**Forbidden response seen in Figure 3. Lastly, we determined that the script does not require the**\n\n**“://” characters after “http” and “https”.**\n\n**In the delivery of this attack, the shortened link that the redirection server redirects to points to a**\n\n**Zip file hosted on Google Drive. The Zip file has a filename of “2nd Myanmar Industrial Human**\n\n**Resource Development Symposium.zip” (SHA256:**\n\n**c11b963e2df167766e32b14fb05fd71409092092db93b310a953e1d0e9ec9bc3) and contains**\n\n**one executable that was added on July 13, 2016.**\n\n**The executable within this Zip archive has a filename “2nd Myanmar Industrial Human**\n\n**Resource Development Symposium.exe” (SHA256:**\n\n**49ac6a6c5449396b98a89709b0ad21d078af783ec8f1cd32c1c8b5ae71bec129). It is a dropper**\n\n**Trojan that saves a decoy and a payload to the system then opens both. The executable uses**\n\n**the PowerPoint icon, as seen in Figure 4 to trick the victim into launching the executable by**\n\n**making the user think the file is a PowerPoint presentation.**\n\n**Figure 4 Payload has a PowerPoint icon to trick the victim into double clicking the executable**\n\n**The decoy, seen in Figure 5, is a PowerPoint presentation that contains details of a conference**\n\n**in Myanmar held on July 30, 2016, titled “Role of JMVTI Aung San and Building of Clean and**\n\n**Safe Automobile Society”. The Japan Myanmar Vocational Training Institute (JMVTI) Aung San**\n\n**is a forthcoming vocational training center established by the Asia Environmental Technology**\n\n**Promotion Institute under Myanmar’s Ministry of Science and Technology.**\n\n\n-----\n\n**Figure 5 Decoy document opened during the installation of the 9002 Trojan**\n\n**In regards to the payload, the dropper creates a randomly named folder within the current**\n\n**user’s folder (%USERPROFILE%), which it uses to store the following files:**\n\n**RealNetwork.exe (SHA256:**\n\n**10d40c51d85ea9ced6050b8951802aaebe81f7db13f42fe5a5589172af481a7e)**\n\n**main.dll (SHA256:**\n\n**53671fe98a0c8c85f6f8eabfa851e27b437f6c392b46e42ddea3f0a656591b12)**\n\n**mpaplugins\\MPAMedia.dll (SHA256:**\n\n**f76f639f2a7b8f39abf83737c6d3e533be66398c85ec95526e4b13561e15fbae)**\n\n**The ‘RealNetwork.exe’ file is a legitimate executable signed to ‘RealNetworks, Inc.’ that loads**\n\n**‘mpaplugins\\MPAMedia.dll’ to call a function named ‘BuildDeviceDatabase’. The threat actors**\n\n**[however, leverage the legitimate executable to sideload a DLL they created by saving the](https://attack.mitre.org/wiki/DLL_side-loading)**\n\n**‘mpaplugins\\MPAMedia.dll’ to the randomly named folder created by the dropper.**\n\n**The sideloaded ‘MPAMedia.dll’ DLL first checks to make sure the system time is greater than**\n\n**May 20, 2016 as a likely attempt for sandbox evasion. It will then load the ‘main.dll’ file initially**\n\n**saved to the randomly named folder created by the dropper. The overall loading process of this**\n\n**Trojan can be seen in Figure 6.**\n\n**Figure 6 Overview of DLL sideloading process**\n\n**The ‘MPAMedia.dll” DLL calls exported functions named “stdInstall” and “CreateFunc” from**\n\n**within ‘main.dll’. The ‘stdInstall’ function is responsible for creating the following autorun registry**\n\n**key for persistence purposes:**\n\n**Software\\Microsoft\\Windows\\CurrentVersion\\Run\\RealNetwork**\n\n**The ‘CreateFunc’ exported function returns the offset within the ‘main.dll’ file to shellcode that**\n\n**contains 9002 Trojan’s actual functional code, which ‘MPAMedia.dll’ DLL will then create a**\n\n**thread to execute the Trojan. The 9002 Trojan creates two mutexes during its execution: F16ME**\n\n**and widfasdf. It also creates the following registry key that it uses to store the path to the user’s**\n\n**folder (%USERPROFILE%):**\n\n**HKCU\\Software\\Microsoft\\F6\\uid**\n\n**The Trojan uses the path stored in this registry key to locate its configuration, which it decrypts**\n\n**using a multiple-byte XOR algorithm and a key of “1pKFmjw”. Figure 7 shows a hexdump of the**\n\n**decrypted configuration for this sample of 9002.**\n\n\n-----\n\n**Figure 7 9002 Trojan’s configuration**\n\n**Using the configuration file above, the 9002 Trojan communicates with the following domain that**\n\n**acts as its command and control (C2) server:**\n\n**logitechwkgame[.]com**\n\n**The Trojan sends network beacons to its C2 server using two different methods. The first**\n\n**method, seen in Figure 8 uses a custom protocol on TCP port 80 that begins with the string**\n\n**‘9002’, which is the basis of the tool’s name. If the C2 server responds, the Trojan will send**\n\n**system specific information along with the strings “jackhex” and “2016” from the configuration**\n\n**file. “jackhex” has also been seen in a C2 for what is likely related Poison Ivy activity, discussed**\n\n**briefly later in this blog.**\n\n**Figure 8 Network beacon using custom 9002 protocol**\n\n**The second beacon method also uses TCP port 80, but this method uses HTTP requests to**\n\n**communicate with its C2 server. Figure 9 shows a sample HTTP request issued by this Trojan,**\n\n**which has a user-agent of “lynx” and POST data of “AA” that are both hardcoded into the**\n\n**payload.**\n\n**Figure 9 Network beacon from 9002 using HTTP request**\n\n**The two beacons seen generated by this payload are very similar to those generated by the**\n\n**[‘3102’ variant of 9002 that we previously analyzed. The capabilities within this 9002 sample are](http://researchcenter.paloaltonetworks.com/2015/09/chinese-actors-use-3102-malware-in-attacks-on-us-government-and-eu-media/)**\n\n**very similar to the 3102 variant discussed, as its main functionality is to load plugins provided by**\n\n**the C2 server and call an exported function named “CreatePluginObj”.**\n\n\n-----\n\n**was found to also be a C2 for Poison Ivy samples associated with attacks on Myanmar and**\n\n**[other Asian countries as discussed in a blog published by Arbor Networks. An additional tie](https://www.arbornetworks.com/blog/asert/recent-poison-iv/)**\n\n**between the activity is the Poison Ivy C2 ‘jackhex.md5c[.]net’, as “jackhex” is not a common**\n\n**word or phrase and is also seen in the beacon activity with the previously discussed 9002**\n\n**sample.**\n\n**In addition to those noted in the blog by Arbor Networks, we found several other Poison Ivy**\n\n**samples using the same mutex, created by the same parent processes, and using most of the**\n\n**same C2 infrastructure. However, the samples we collected lack campaign IDs and all use**\n\n**“version2013” as the password to encrypt its communications. The additional Poison Ivy**\n\n**samples also provided us three new C2 domains:**\n\n**outhmail[.]com**\n\n**mxdnsv6[.]com**\n\n**microsoftserve[.]com**\n\n**Also, some of the C2 domains associated with these Poison Ivy samples were registered with**\n\n**emails that were used to register the following possibly related domains:**\n\n**gooledriveservice[.]com**\n\n**queryurl[.]com**\n\n**appupdatemoremagic[.]com**\n\n**While we do not have complete targeting information associated with these samples, several of**\n\n**the decoy files were in Chinese and appear to be part of a recent and possibly ongoing**\n\n**campaign targeting organizations in Taiwan. The decoy themes centered primarily around**\n\n**cross-strait relations and the Taiwanese Mainland Affairs Council (MAC), which is a cabinet-level**\n\n**organization tasked with creating, implementing, and overseeing policies between Taiwan and**\n\n**the People’s Republic of China (PRC).**\n\n**The use of Google Drive to host malicious files is not a new tactic in attacks. However, using a**\n\n**well-known hosting platform may allow the downloading of a payload to blend into other**\n\n**legitimate traffic from the hosting provider. The actors still use spear phishing as their primary**\n\n**attack method, but because that technique has been so well publicized, intended victims are**\n\n**perhaps more cautious about opening suspicious email attachments or links. As spear phishing**\n\n**becomes less successful, threat actors need to continue to adapt and find new methods to**\n\n**successfully deliver malware. The use of a URL shortening service and a redirection server**\n\n**further aids the chances of a successful attack, as it becomes more challenging to determine**\n\n**the validity of the link within an email due to the way link shorteners obfuscate link content.**\n\n**The files used in these attacks are properly classified as malware by WildFire. AutoFocus**\n\n**[customers can find out more about both 9002 and Poison Ivy via the respective malware family](https://autofocus.paloaltonetworks.com/#/tag/Unit42.9002)**\n\n**tags.**\n\n**9002 samples**\n\n**C11b963e2df167766e32b14fb05fd71409092092db93b310a953e1d0e9ec9bc3**\n\n**49ac6a6c5449396b98a89709b0ad21d078af783ec8f1cd32c1c8b5ae71bec129**\n\n**Poison Ivy samples**\n\n**193ae4da14874aa29902052d08064395afa5e4763f949e7369157d893fa08653**\n\n**ac8fc264c7ec3cf70836e1bb21f9a20174b04ad49731b8797d7d8bb95cb353e2**\n\n**12759f7fd01ffdea97954be5404d7e43a3941a7388129e7b6ace85f56b500cd8**\n\n**0940602e7d47941f36c975afa9d2c6b1b0d2bd15bbea6ad4baf0f828420d72bf**\n\n**6bdd45cb6c021512c203cf01a051dce28449e364627e1366412c0051094f60a0**\n\n**f0ab826ea65b4a9eb66528ad74c4d3e747c1ecebfca6bdafd2504e0f794195d9**\n\n**e2fb4a53e54774f1645c940f905e76beb5fc729e9e968b736b8377312cb2454a**\n\n**0af768b4ba8fe7aac7a7da7fd5f21e7496d5617dccdf2321f526fd1091d64a6d**\n\n**fd21cd1846f25d42b1997ec1fd5ae6e14ea9b5bb0161ab7edf0ce184174e6da6**\n\n**12759f7fd01ffdea97954be5404d7e43a3941a7388129e7b6ace85f56b500cd8**\n\n**08dee1f5ced372716ad5c6e3f2041bcdeb25e905efc19d3749fe637d0a589ccc**\n\n**269c03e205c403ab8fa1033caa1c8e3a86a1495cc33a7f3a3a3c9b8a9ea77490**\n\n**3a9ab623c8a0a9f6c65e108e83c90da7620d2d6b22192c857556117587d0d038**\n\n**C2 Domains**\n\n**logitechwkgame[ ]com**\n\n\n-----\n\n**outhmail[.]com**\n\n**mxdnsv6[.]com**\n\n**microsoftdefence[.]com**\n\n**microsoftserve[.]com**\n\n**gooledriveservice[.]com**\n\n**queryurl[.]com**\n\n**appupdatemoremagic[.]com**\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2016/2016.07.26.Attack_Delivers_9002_Trojan_Through_Google_Drive/unit-42-attack-delivers-9002-trojan-through-google-drive.pdf"
    ],
    "report_names": [
        "unit-42-attack-delivers-9002-trojan-through-google-drive"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716502,
    "ts_updated_at": 1743041369,
    "ts_creation_date": 1469700125,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/37563d47952e48cc0223c8d8d1b84a24ba1f83b9.pdf",
        "text": "https://archive.orkl.eu/37563d47952e48cc0223c8d8d1b84a24ba1f83b9.txt",
        "img": "https://archive.orkl.eu/37563d47952e48cc0223c8d8d1b84a24ba1f83b9.jpg"
    }
}