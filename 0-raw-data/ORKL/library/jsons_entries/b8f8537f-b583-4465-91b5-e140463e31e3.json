{
    "id": "b8f8537f-b583-4465-91b5-e140463e31e3",
    "created_at": "2023-01-12T15:04:55.256053Z",
    "updated_at": "2025-03-27T02:05:25.958348Z",
    "deleted_at": null,
    "sha1_hash": "93c2e2d296d5db2b9fddad724453cf33a586ddce",
    "title": "2021-01-21 - Solarwinds Attack- Sunburst's DLL Technical Analysis",
    "authors": "",
    "file_creation_date": "2022-05-28T00:38:09Z",
    "file_modification_date": "2022-05-28T00:38:09Z",
    "file_size": 1356292,
    "plain_text": "# SolarWinds Attack: Sunburst's DLL Technical Analysis\n\n**notes.netbytesec.com/2021/01/solarwinds-attack-sunbursts-dll.html**\n\nFareed Fauzi\n\nPosted by Fareed Fauzi\n\n## Introduction\n\nIn late 2020, a sophisticated SolarWinds attack that hit organizations through the supply chain has recently\nbeen disclosed by various sources. This was done via a compromised version of SolarWinds Orion which we\ncalled the backdoor with the name “Sunburst”. Once the update (include the malicious DLL) is installed, the\nmalicious DLL will be imported and loaded by the legitimate SolarWinds.BusinessLayerHost.exe executable.\n\nSunburst is a trojan version of a digitally signed SolarWinds Orion plugin named\n**_SolarWinds.Orion.Core.BusinessLayer.dll. The malicious DLL contains a backdoor code used to initiate a_**\nfunction that will do the communication with the victim’s system via HTTP to the attacker’s command and\ncontrol server [1]. The malicious code initiation will give full access to the victim which may retrieve and\nexecute commands that instruct the backdoor to transfer files, remote execution, profile victim’s system\ninformation, and complete control over the affected system.\n\n## Technical Analysis\n\n**Name: SolarWinds.Orion.Core.BusinessLayer.dll**\n\n**MD5: b91ce2fa41029f6955bff20079468448**\n**File type: Dynamic Link Library**\n\nThe malicious function code that was being patched in the compromised DLL by the attacker resides\nin OrionImprovementBusinessLayer.Initialize which all malicious subfunctions were started right here. The\nfunction Initialize was invoked at line 119 by the parent function RefreshInternal as shown in Figure 1 below.\n\n\n-----\n\nFigure 1: Invoking of Initialize function\n\nIn the Initialize method in Figure 2 below, we can see that the code trying to check if the current process\nexecutable is solarwinds.businesslayerhost where the hash of the current process being generated by the\nfunction GetHash.\n\nFigure 2: Check if the current process is solarwinds.businesslayerhost\n\nThe code use function GetHash to check the hash of the process. We will see this GetHash function often after\nthis as the attacker obfuscate those important strings. Deep diving into the code of the GetHash will give us\nideas how things get going. Looking into the subroutine GetHash, the function uses Fowler–Noll–Vo\n[hash (FNV-1a) + XOR algorithm which we can refer to in Wikipedia. Figures 3 and 4 below comparing the](https://en.wikipedia.org/wiki/Fowler%E2%80%93Noll%E2%80%93Vo_hash_function)\nalgorithm being used.\n\n\n-----\n\nFigure 3: GetHash function\n\nFigure 3: Wikipedia's FNV-1a explained\n\nThe next thing that needs to be explained in the Initialize function is at lines 116 to 118 in figure 4 below. At\nthese lines, the malware waits about two weeks/12 days before it executes to avoid any suspicious activity\ndetection.\n\n\n-----\n\nFigure 4: The malware waits for about 2 weeks to execute\n\nAfter about 2 weeks, the malware starts to execute the next line where the malware creates the named pipe\n**_583da945-62af-10e8-4902-a8f205c72b2e to ensure only one instance of the backdoor is running._**\n\nFigure 5: The sample creates named pipe\n\nIn figure 5, after creates the named pipe, the sample check for modes of operation as described by FireEye. If\nthe mode return \"Truncate\", the malware will be terminate and exit.\n\n\n-----\n\nFigure 6: Makes some delay execution\n\nAfter the truncate mode being checked and pass, the malware then will delay the execution of the next line\nabout 30min to 120min.\n\nFigure 7: Sunburst check for domain-joined\n\nIn figure 7, Sunburst also checks if the victim is joined to an Active Directory domain. Those blacklisted AD\ndomains as follows:\n\nFigure 8: Hashes of blacklisted domain\n\nThe next lines of codes will be executed if the current victim does not join the blacklisted AD domains. These\nencoded strings have been brute-forced by FireEye to determine what are the decoded result of these encoded\nstrings. Refer [SolarWinds/SunBurst FNV-1a-XOR hash founds analysis spreadsheet shared by FireEye.](https://docs.google.com/spreadsheets/d/1u0_Df5OMsdzZcTkBDiaAtObbIOkMa5xbeXdKk_k0vWs/edit#gid=0)\n\n1. swdev.local\n2. emea.sales\n3. pci.local\n4. apac.lab\n5. swdev.dmz\n\n\n-----\n\n6. cork.lab\n7. saas.swi\n8. dmz.local\n9. lab.local\n10. dev.local\n\n11. lab.rio\n12. lab.brno\n13. lab.na\n14. test\n15. solarwinds\n\nThe sample then performs another checking functionality to generate the user ID of the current victim as shown\nin figures 8 and 9.\n\nFigure 8: GetOrCreateUserID call\n\nFigure 9: GetOrCreateUserID code\n\nIn figure 9, the user ID of the victim is built based on 3 values:\n\n1. Network interface MAC address that is up and not a loopback device from the ReadDeviceInfo function\n2. The domain name that contains in variable domain4\n3. HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Cryptography\\MachineGuid value\n\nAfter that, the user ID is encoded with the XOR MD5 of the value at line 424 to 434 shown in figure 9.\n\n\n-----\n\nFigure 10: Method Update being invoke\n\nThe backdoor then invokes method Update which main part of the backdoor resides in here.\n\nFigure 11: Snippet code of the Update method\n\nIn the first part of the code, as shown in Figure 11, the backdoor begins the domain algorithm generation\n(DGA) things using class CryptoHelper.\n\n\n-----\n\nFigure 12: Content of CryptoHelper\n\nSunburst victims, who have been installed and infected by one of the malicious SolarWinds Orion software\nupdates, will query for domain names. The part of the malicious code of the software update will construct and\nresolve a subdomain of avsvmcloud.com.\n\nThe code generates those domain names by taking the victim's User ID and computer’s domain name and\nencoded it with a simple substitution cipher. These encoded strings of subdomains are then being\nconcatenated with one of the following domains to create the hostname to resolve:\n\n**_.appsync-api.eu-west-1[.]avsvmcloud[.]com_**\n**_.appsync-api.us-west-2[.]avsvmcloud[.]com_**\n**_.appsync-api.us-east-1[.]avsvmcloud[.]com_**\n**_.appsync-api.us-east-2[.]avsvmcloud[.]com_**\n\nThe example of the generated and encoded C2 domain name as follows:\n\n**_02m6hcopd17p6h450gt3.appsync-api.us-west-2.avsvmcloud.com_**\n**_06o0865eliou4t0btvef0b12eu1.appsync-api.us-east-1.avsvmcloud.com_**\n**_04spiistorug1jq5o6o0.appsync-api.us-west-2.avsvmcloud.com_**\n**_060mpkprgdk087ebcr1jov0te2h.appsync-api.us-east-1.avsvmcloud.com_**\n\nThe subdomains highlighted above are the encoded User ID and computer’s domain name which can be\n[decoded using tools from Netresec.](https://www.netresec.com/?page=Blog&month=2020-12&post=Reassembling-Victim-Domain-Fragments-from-SUNBURST-DNS)\n\nAfter generated the domain, Sunburst continues invoking another important method\ncalled UpdateNotification.\n\n\n-----\n\nFigure 13: UpdateNotification invoked.\n\nFigure 14: Check is there any blacklisted process running\n\nIn this method, the backdoor check for the blacklisted processes running based on Figure 14. If there is a\nblacklisted process running, the backdoor will exit the code. If we deep dive into the method, we can see three\nimportant sub-method which are SearchAssemblies, SearchServices, and SearchConfiguration.\n\nFigure 15: Identify AV, EDR, tools, and drivers\n\nThe backdoor uses several blocklists to identify anti-virus and endpoint detection response processes, drivers,\nand services. It also checks for any forensic and malware analysis tools in these three functions.\n\n**SearchAssemblies = Processes of malware analysis and forensics tools**\n_SearchServices = Anti-Virus and EDR services_\n**_SearchConfiguration = Anti-Virus and EDR drivers_**\n\n\n-----\n\nBelow figures (Figure 16-19) show the hashes of the blacklisted process of malware analysis and forensics\ntools, AV and EDR services, and drivers:\n\nFigure 16: The processes hashes included in the field assemblyTimeStamps\n\nFigure 17: List of the blacklisted malware analysis and forensics tools hashes.\n\n\n-----\n\nFigure 16: The services hashes included in the field svcList\n\nFigure 17: List of the blacklisted AV and EDR services hashes.\n\n\n-----\n\nFigure 18: The drivers hashes included in the field configTimeStamps\n\nThe backdoor retrieves all the driver listing via the WMI query Select * From Win32_SystemDriver as shown in\nfigure 18. The drivers hashes are included in the field configTimeStamps.\n\nFigure 19: List of the blacklisted AV and EDR drivers hashes.\n\n[All the decoded version of the encoded hashes can be checked here. Thanks to the FireEye team!](https://docs.google.com/spreadsheets/d/1u0_Df5OMsdzZcTkBDiaAtObbIOkMa5xbeXdKk_k0vWs/edit#gid=0)\n\n\n-----\n\nFigure 20: Bruteforced blacklist hashes spreadsheet\n\nNext, in the while loop, the sample check for the processes, services, and drivers again. If the victims do not\nhave the indicator of the blacklisted processes, services, and drivers, the backdoor continues to execute the\nfollowing codes.\n\nFigure 21: Check for the process again\n\nContinue investigation of the code at line 222 as we see the backdoor trying to get the AdressFamily of the\nvictim and decide its decision in the switch case after that shown in figure 22.\n\n\n-----\n\nFigure 22: Switch case of socket AddressFamily Netbios\n\nThe Command and Control beaconing is starting from here. If the AddressFamily is NetBios the backdoor\nwill either initiate the C2 beaconing or continue the command and control beaconing which we can see at line\n248 in Figure 22 where method Initialize being invoked.\n\n\n-----\n\nFigure 23: C2 things in Initialize method\n\nSupported commands for the C2 can be view in the JobEngine field as shown as follow in figure 24.\n\n\n-----\n\nFigure 24: JobEngine contains the supported command of the Command and Control\n\nOnce the Sunburst is gained access to the victim machine, depending on the objectives of the actor, any\nmalicious actions and activities can be executed like stealing sensitive data, source codes, etc.\n\n## Conclusion\n\nThe cyberattack of this campaign is a highly skilled adversary. The threat actors behind this cyber attack\ncampaign got access to numerous organizations around the world including Malaysia's organizations. Every\norganization in the world that using SolarWind’s Orion IT monitoring and management software must be\nalerted with this campaign to take precautions for this matter as the attack still ongoing right now.\n\n## IOC\n\nThe following SHA256 hashes are associated with Sunburst DLL files:\n\ne0b9eda35f01c1540134aba9195e7e6393286dde3e001fce36fb661cc346b91d\n\n\n-----\n\na58d02465e26bdd3a839fd90e4b317eece431d28cab203bbdde569e11247d9e2\n32519b85c0b422e4656de6e6c41878e95fd95026267daab4215ee59c107d6c77\ndab758bf98d9b36fa057a66cd0284737abf89857b73ca89280267ee7caf62f3b\neb6fab5a2964c5817fb239a7a5079cabca0a00464fb3e07155f28b0a57a2c0ed\nc09040d35630d75dfef0f804f320f8b3d16a481071076918e9b236a321c1ea77\nffdbdd460420972fd2926a7f460c198523480bc6279dd6cca177230db18748e8\nb8a05cc492f70ffa4adcd446b693d5aa2b71dc4fa2bf5022bf60d7b13884f666\n20e35055113dac104d2bb02d4e7e33413fae0e5a426e0eea0dfd2c1dce692fd9\n0f5d7e6dfdd62c83eb096ba193b5ae394001bac036745495674156ead6557589\ncc082d21b9e880ceb6c96db1c48a0375aaf06a5f444cb0144b70e01dc69048e6\nac1b2b89e60707a20e9eb1ca480bc3410ead40643b386d624c5d21b47c02917c\n019085a76ba7126fff22770d71bd901c325fc68ac55aa743327984e89f4b0134\nce77d116a074dab7a22a0fd4f2c1ab475f16eec42e1ded3c0b0aa8211fe858d6\n2b3445e42d64c85a5475bdbc88a50ba8c013febb53ea97119a11604b7595e53d\n92bd1c3d2a11fc4aba2735d9547bd0261560fb20f36a0e7ca2f2d451f1b62690\na3efbc07068606ba1c19a7ef21f4de15d15b41ef680832d7bcba485143668f2d\na25cadd48d70f6ea0c4a241d99c5241269e6faccb4054e62d16784640f8e53bc\nd3c6785e18fba3749fb785bc313cf8346182f532c59172b69adfb31b96a5d0af\nd0d626deb3f9484e649294a8dfa814c5568f846d5aa02d4cdad5d041a29d5600\nc15abaf51e78ca56c0376522d699c978217bf041a3bd3c71d09193efa5717c71\n\nThe following domain names are associated with Sunburst cyber-attack campaign:\n\navsvmcloud[.]com\ndatabasegalore[.]com\ndeftsecurity[.]com\ndigitalcollege[.]org\nfreescanonline[.]com\nglobalnetworkissues[.]com\nhighdatabase[.]com\nincomeupdate[.]com\nkubecloud[.]com\nlcomputers[.]com\nmobilnweb[.]com\npanhardware[.]com\nseobundlekit[.]com\nsolartrackingsystem[.]net\nthedoccloud[.]com\nvirtualwebdata[.]com\nwebcodez[.]com\nwebsitetheme[.]com\nzupertech[.]com\n\n## Reference\n\n1. https://www.fireeye.com/blog/threat-research/2020/12/sunburst-additional-technical-details.html\n2. https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply\nchain-compromises-with-sunburst-backdoor.html\n3. https://docs.google.com/spreadsheets/d/1u0_Df5OMsdzZcTkBDiaAtObbIOkMa5xbeXdKk_k0vWs/edit#gid=0\n\n\n-----\n\n4. https://labs.sentinelone.com/solarwinds sunburst backdoor inside the stealthy apt campaign/\n5. Colin Hardy videos on Sunburst on Youtube\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-01-21 - Solarwinds Attack- Sunburst's DLL Technical Analysis.pdf"
    ],
    "report_names": [
        "2021-01-21 - Solarwinds Attack- Sunburst's DLL Technical Analysis.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535895,
    "ts_updated_at": 1743041125,
    "ts_creation_date": 1653698289,
    "ts_modification_date": 1653698289,
    "files": {
        "pdf": "https://archive.orkl.eu/93c2e2d296d5db2b9fddad724453cf33a586ddce.pdf",
        "text": "https://archive.orkl.eu/93c2e2d296d5db2b9fddad724453cf33a586ddce.txt",
        "img": "https://archive.orkl.eu/93c2e2d296d5db2b9fddad724453cf33a586ddce.jpg"
    }
}