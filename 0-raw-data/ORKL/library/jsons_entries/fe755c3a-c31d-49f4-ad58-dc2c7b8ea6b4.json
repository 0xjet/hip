{
    "id": "fe755c3a-c31d-49f4-ad58-dc2c7b8ea6b4",
    "created_at": "2023-01-12T15:07:41.660316Z",
    "updated_at": "2025-03-27T02:06:09.274785Z",
    "deleted_at": null,
    "sha1_hash": "d0bdc6944e18de1bf4a969efe089305d978eeead",
    "title": "2021-04-13 - Compromised Exchange server hosting cryptojacker targeting other Exchange servers",
    "authors": "",
    "file_creation_date": "2022-05-27T21:51:36Z",
    "file_modification_date": "2022-05-27T21:51:36Z",
    "file_size": 1203775,
    "plain_text": "# Compromised Exchange server hosting cryptojacker targeting other Exchange servers\n\n**news.sophos.com/en-us/2021/04/13/compromised-exchange-server-hosting-cryptojacker-targeting-other-exchange-**\nservers/\n\nAndrew Brandt April 13, 2021\n\nIn the weeks since Microsoft released details about a serious vulnerability affecting their\nExchange mail server software, a range of threat actors have been targeting exploitable\nservers with a variety of malware, from webshells to ransomware. But those aren’t the only\npayloads we’ve seen directed at Exchange servers: An unknown attacker has been\nattempting to leverage what’s now known as the ProxyLogon exploit to foist a malicious\nMonero cryptominer onto Exchange servers, with the payload being hosted on a\ncompromised Exchange server.\n\nThe SophosLabs team was inspecting telemetry when they came across the unusual attack\ntargeting a customer’s Exchange server. The attack begins with a PowerShell command to\nretrieve a file named win_r.zip from another compromised server’s Outlook Web Access\nlogon path (/owa/auth).\n\n## How the attack works\n\nThe .zip file is not a compressed archive, but a batch script that then invokes the built-intoWindows certutil.exe program to download two additional files, win_s.zip and win_d.zip.\n\n\n-----\n\nNeither of these are compressed files, either.\n\nThe first file is written out to the filesystem as QuickCPU.b64. The certutil application is\ndesigned to be able to decode base64-encoded security certificates, so the attackers have\nleveraged that functionality by encoding an executable payload in base64 and wrapping it in\nheaders that indicate it is some form of digital certificate.\n\nThe batch script runs\n\nthis command that outputs the decoded executable into the same directory.\n```\ncertutil.exe -decode QuickCPU.b64 QuickCPU.exe\n\n```\nWhen decoded, the batch script runs the executable, which extracts the miner and\nconfiguration data from the QuickCPU.dat file, injects it into a system process, and then\ndeletes the evidence. The file uses forged data in its Properties sheet that indicates the file is\n\n\n-----\n\na Windows component, but the binary is not digitally signed and besides, no such file has\never existed as a standard component of Windows, though there is a legitimate utility with\nthe same name, made by a third-party software developer. That utility is not connected to\nthis malware in any way.\n\nThe executable appears to contain\n\na modified version of a tool publicly available on Github called PEx64-Injector. The page for\nthat project describes the tool as having the ability to “migrate any x64 exe to any x64\nprocess…no administrator privileges required.” When it runs, it extracts the contents of the\nQuickCPU.dat file (an installer for the miner, and its configuration) temporarily to the\nfilesystem, configures the miner, injects it into a running process, then quits. The batch file\nthen deletes the evidence and the miner remains running in memory, injected into a process\nalready running on the system.\n\n\n-----\n\nA\n\nsegment of a root-cause analysis flowchart shows the QuickCPU installer running within the\nsystem folder on a compromised Exchange server after certutil.exe decoded it.\nAmong the files contained in the QuickCPU.dat archive are the configurator for the miner,\n[which appears to be xmr-stak. By default, the payload sets up the miner so that it only can](https://github.com/fireice-uk/xmr-stak)\ncommunicate if it can have a secure TLS connection back to the Monero wallet where it will\nstore its value. If the miner detects that there’s a certificate mismatch (or some other\nindication of a TLS MITM), it quits and attempts to reconnect every 30 seconds.\n\nThe miner’s pools.txt file is also temporarily written to disk, which reveals not only the wallet\naddress and its password, but also that the name the attacker has given to this pool of\n\n\n-----\n\nminers: DRUGS. The **currency : randomx in this file appears to be a configuration**\nspecific to the xmr-stak miner.\n\nAccording to the Monero\n\nblockchain, the wallet began receiving funds on March 9 (the Patch Tuesday in which the\nExchange updates were released as part of the update cycle), which corresponds with when\nwe saw the attack begin. As time has gone on, the attacker lost several servers and the\ncryptomining output decreased, but then gained a few new ones that more than make up for\nthe early losses.\n\n## Detection and indicators of compromise\n\nSophos endpoint products will detect the executables associated with this attack as\n**Mal/Inject-GV and xmr-stak is detected as XMR-Stak Miner (PUA). SophosLabs has**\n[published indicators of compromise to our Github page.](https://github.com/sophoslabs/IoCs/blob/master/PUA-QuickCPU_xmr-stak.csv)\n\n\n-----\n\nSophosLabs acknowledges the assistance of Fraser Howard and Simon Porter in the\ndiscovery and analysis of this threat.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-04-13 - Compromised Exchange server hosting cryptojacker targeting other Exchange servers.pdf"
    ],
    "report_names": [
        "2021-04-13 - Compromised Exchange server hosting cryptojacker targeting other Exchange servers.pdf"
    ],
    "threat_actors": [
        {
            "id": "d8dff631-87b0-4320-8352-becff28dbcf1",
            "created_at": "2022-10-25T16:07:24.565038Z",
            "updated_at": "2025-03-27T02:02:10.282132Z",
            "deleted_at": null,
            "main_name": "ShinyHunters",
            "aliases": [],
            "source_name": "ETDA:ShinyHunters",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536061,
    "ts_updated_at": 1743041169,
    "ts_creation_date": 1653688296,
    "ts_modification_date": 1653688296,
    "files": {
        "pdf": "https://archive.orkl.eu/d0bdc6944e18de1bf4a969efe089305d978eeead.pdf",
        "text": "https://archive.orkl.eu/d0bdc6944e18de1bf4a969efe089305d978eeead.txt",
        "img": "https://archive.orkl.eu/d0bdc6944e18de1bf4a969efe089305d978eeead.jpg"
    }
}