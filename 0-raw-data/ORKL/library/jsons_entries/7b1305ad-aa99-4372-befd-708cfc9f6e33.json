{
    "id": "7b1305ad-aa99-4372-befd-708cfc9f6e33",
    "created_at": "2022-10-25T16:48:25.032972Z",
    "updated_at": "2025-03-27T02:16:14.053288Z",
    "deleted_at": null,
    "sha1_hash": "23c0a1812535edbe41637784380ff52e7f9fb777",
    "title": "New PowerShell-based Backdoor Found in Turkey, Strikingly Similar to MuddyWater Tools",
    "authors": "",
    "file_creation_date": "2018-12-06T03:19:33Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 296510,
    "plain_text": "# New PowerShell-based Backdoor Found in Turkey, Strikingly Similar to MuddyWater Tools\n\n**[blog.trendmicro.com/trendlabs-security-intelligence/new-powershell-based-backdoor-found-in-turkey-strikingly-similar-](https://blog.trendmicro.com/trendlabs-security-intelligence/new-powershell-based-backdoor-found-in-turkey-strikingly-similar-to-muddywater-tools/)**\nto-muddywater-tools/\n\nJaromir Horejsi (Threat Researcher) November 30, 2018\n\n[Home  »  Malware  »  New PowerShell-based Backdoor Found in Turkey, Strikingly Similar](https://blog.trendmicro.com/trendlabs-security-intelligence/)\nto MuddyWater Tools\n\n[0](https://blog.trendmicro.com/trendlabs-security-intelligence/new-powershell-based-backdoor-found-in-turkey-strikingly-similar-to-muddywater-tools/#respond)\nMuddyWater is a well-known threat actor group that has\nbeen active since 2017. They target groups across Middle\nEast and Central Asia, primarily using spear phishing\nemails with malicious attachments. Most recently they\nwere connected to a campaign in March that targeted\n[organizations in Turkey, Pakistan, and Tajikistan .](https://blog.trendmicro.com/trendlabs-security-intelligence/campaign-possibly-connected-muddywater-surfaces-middle-east-central-asia/)\n\nThe group has been quite visible since the initial 2017\n[Malwarebytes report on their elaborate espionage attack](https://blog.malwarebytes.com/threat-analysis/2017/09/elaborate-scripting-fu-used-in-espionage-attack-against-saudi-arabia-government_entity/)\nagainst the Saudi Arabian government. After that first\n[report, they were extensively analyzed by other security](https://researchcenter.paloaltonetworks.com/2017/11/unit42-muddying-the-water-targeted-attacks-in-the-middle-east/)\ncompanies. Through all that, we’ve only seen minor changes to the tools, techniques and\nprocedures (TTPs) they have used.\n\nHowever, we recently observed a few interesting delivery documents similar to the known\nMuddyWater TTPs. These documents are named Raport.doc or Gizli Raport.doc (titles\nmean “Report” or “Secret Report” in Turkish) and maliyeraporti (Gizli Bilgisi).doc (“finance\n(Confidential Information)” in Turkish) — all of which were uploaded to Virus Total from\nTurkey. Our analysis revealed that they drop a new backdoor, which is written in PowerShell\nas MuddyWater’s known POWERSTATS backdoor. But, unlike previous incidents using\nPOWERSTATS, the command and control (C&C) communication and data exfiltration in this\ncase is done by using the API of a cloud file hosting provider.\n\nThe screenshots below show the malicious attachments, which are disguised to look real,\nsimilar to any typical phishing document. The images show blurry logos that we’ve\nidentified as belonging to various Turkish government organizations — the logos add to the\ndisguise and lure users into believing the documents are legitimate. Then the document\nnotifies users that it is an “old version” and prompts them to enable macros to display the\ndocument properly. If the targeted victims enable macros, then the malicious process\ncontinues.\n\n\n-----\n\n_Figure 1. Fake Office document tries to get user to enable malicious macros. The blurred_\n_document contains logos of different Turkish government entities_\n\n\n-----\n\n_institution related to taxes_\n\nThe macros contain strings encoded in base52, which is rarely used by threat actors other\nthan MuddyWater. The group is known to use it to encode their PowerShell backdoor.\n\nAfter enabling macros, a .dll file (with a PowerShell code embedded) and a .reg file are\ndropped into %temp% directory. The macro then runs the following command:\n\n“C:\\Windows\\System32\\cmd.exe” /k %windir%\\System32\\reg.exe IMPORT %temp%\\B.reg\n\nRunning this registry file adds the following command to the Run registry key:\n\nrundll32 %Temp%\\png.dll,RunPow\n\n_Figure 3. Run registry key_\n\nWe assume that RunPow stands for “run PowerShell,” and triggers the PowerShell code\nembedded inside the .dll file. The PowerShell code has several layers of obfuscation. The\nfirst layer contains a long base64 encoded and encrypted code with variables named using\nEnglish curse words.\n\n_Figure 4. Encrypted PowerShell code_\n\nThe other layers are simple obfuscated PowerShell scripts. But the last layer is the main\nbackdoor body. This backdoor has some features similar to a previously discovered\nversion of the Muddywater backdoor.\n\nFirstly, this backdoor collects the system information and concatenates various pieces of\ninformation into one long string. The data retrieved includes: OS name, domain name, user\nname, IP address, and more. It uses the separator “::” between each piece of information.\n\n\n-----\n\n_Figure 5. String of system information collected from the victim’s system_\n\nThe previous MuddyWater version collected similar information but used a different\nseparator:\n\n_Figure 6. String of system information_\n_collected from the victim’s system, from_\n_older Muddywater backdoor sample_\n\nAs mentioned above, another difference\nbetween this and older Muddywater\nbackdoors is that C&C communication is\ndone by dropping files to the cloud\nprovider. When we analyzed further, we\nsaw that the communication methods use\nfiles named <md5(hard disk serial\n_number)> with various extensions_\ndepending on the purpose of the file.\n\n**.cmd – text file with a command to execute**\n**.reg – system info as generated by myinfo() function, see screenshot above**\n**.prc – output of the executed .cmd file, stored on local machine only**\n**.res – output of the executed .cmd file, stored on cloud storage**\n\n_Figure 7. Example of .cmd file content_\n\n_Figure 8. Example of .reg file content_\n\n\n-----\n\n_Figure 9.Example of .res file content_\n\nIn both the older version of the MuddyWater backdoor and this recent backdoor, these files\nare used as an asynchronous mechanism instead of connecting directly to the machine\nand issuing a command. The malware operator leaves a command to execute in a .cmd\nfile, and comes back later to retrieve the .res files containing the result of the issued\ncommand.\n\nHowever, in the older MuddyWater backdoor their content was encoded differently. The\nfiles are temporarily stored on compromised websites. The more recent backdoor uses a\nlegitimate cloud storage service provider instead.\n\nThe .res file can be decoded by replacing “00” with empty string, then converting from hex\nto ASCII, then reversing the string. The figure below is the decoded .res file from Figure 9.\n\n_Figure 10. Decoded .res file_\n\nThe backdoor supports the following commands:\n\n**$upload – upload a file to file hosting service**\n**$dispos – remove persistence**\n**$halt – exit**\n**$download – download file from a hosting service**\n**No prefix – execute command via Invoke Expression (IEX), a PowerShell command**\nthat runs commands or expressions on the local computer\n\nBased on our analysis, we can confirm that the targets were Turkish government\norganizations related to the finance and energy sectors. This is yet another similarity with\nprevious MuddyWater campaigns, which were known to have targeted multiple Turkish\ngovernment entities. If the group is responsible for this new backdoor, it shows how they\nare improving and experimenting with new tools.\n\n**_S l ti_** **_d R_** **_d ti_**\n\n\n-----\n\nuses social engineering to manipulate targets into enabling malicious documents. It is\nimportant that employers and employees across all organizations and enterprises be able\n[to identify phishing attacks and distinguish legitimate emails from malicious ones.](https://www.trendmicro.com/vinfo/ph/security/news/cybercrime-and-digital-threats/best-practices-identifying-and-mitigating-phishing-attacks)\nAwareness of these threats and the tactics they use is an effective first step.\n\nTelltale signs of social engineering include “too-good-to-be-true” offers and messages that\nlack context. In general, users should always practice caution when it comes to email. This\nincludes avoiding clicking on links or downloading any documents unless certain that these\nare legitimate.\n\nApart from knowledge and awareness of phishing and social engineering, it is also\nimportant to be prepared with effective and layered security solutions. Trend Micro™ Deep\nDiscovery™ provides detection, in-depth analysis, and proactive response to today’s\nstealthy malware, and targeted attacks in real time. It provides a comprehensive defense\ntailored to protect organizations against targeted attacks and advanced threats through\n[specialized engines, custom sandboxing, and seamless correlation across the entire attack](https://www.trendmicro.com/vinfo/us/security/news/security-technology/how-can-advanced-sandboxing-techniques-thwart-elusive-malware)\nlifecycle, allowing it to detect threats even without any engine or pattern update.\n\n[Trend Micro™ Hosted Email Security](https://www.trendmicro.com/us/small-business/hosted-email-security/) is a no-maintenance cloud solution that delivers\ncontinuously updated protection to stop spam, malware, spear phishing, ransomware, and\nadvanced targeted attacks before they reach the network.\n\n[Trend Micro™ Deep Discovery™ Email Inspector](https://www.trendmicro.com/us/enterprise/security-risk-management/deep-discovery/index.html#email-protection) [and InterScan™ Web Security](https://www.trendmicro.com/us/enterprise/web-security/index.html) prevent\nmalware from ever reaching end users. At the endpoint level, Trend Micro™ Smart\nProtection Suites deliver several capabilities that minimize the impact of these attacks.\n\nThese solutions are powered by the Trend Micro [XGen™ security, which provides a cross-](https://www.trendmicro.com/en_us/business/products/all-solutions.html)\ngenerational blend of threat defense techniques against a full range of threats for data\n[centers, cloud environments, networks, and endpoints. It features high-fidelity machine](https://www.trendmicro.com/en_us/business/products/hybrid-cloud/deep-security-for-cloud.html)\n[learning to secure the gateway and endpoint data and applications, and protects physical,](https://www.trendmicro.com/us/business/complete-user-protection/index.html)\nvirtual, and cloud workloads.\n\n**_Indicators of Compromise_**\n\n**SHA256** **Type** **Detection Name**\n\n\n41ee0ab77b474b0c84a1c25591029533f058e4454d9f83ba\n30159cc6309c65d1\n\n43080479eb1b00ba80c34272c5595e6ebdc6b0ffabcdc2c4\n0ea2af49fcc43db4\n\n4f509354d8b3152a40c64ce61f7594d592c1256ad6c08297\n60b8dbdcb10579a2\n\n685e91bc4e98c38bda7c8e57d5d40a11e7cf48bb43859bb7\n99813f0146a14fcf\n\n888a6f205ac9fc40d4898d8068b56b32f9692cb75f0dd813f\n96a7bd8426f8652\n\n0acd10b14d38a4ac469819dfa9070106e7289ecf7360e248\nb7f10f868 2f373d\n\n\nDelivery\ndocuments\n\nDropped DLL fil\ne\n\nWeaponized do\ncument\n\nDropped DLL fil\ne\n\nDropped DLL fil\ne\n\n\nW2KM_POWRUN.A\n\nBackdoor.Win32.POWR\nUN.AA\n\nBACKDOOR.WIN32.PO\nWRUN.AA\n\nBKDR_POWRUN.B\n\nTrojan.W97M.POWRUN.\nAA\n\n\nDropped DLL fil BKDR_POWRUN.A\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2018/2018.11.30.MuddyWater_Turkey/PowerShell-based%20Backdoor%20Found%20in%20Turkey%20Strikingly%20Similar%20to%20MuddyWater%20Tools.pdf"
    ],
    "report_names": [
        "PowerShell-based Backdoor Found in Turkey Strikingly Similar to MuddyWater Tools"
    ],
    "threat_actors": [
        {
            "id": "2ed8d590-defa-4873-b2de-b75c9b30931e",
            "created_at": "2023-01-06T13:46:38.730137Z",
            "updated_at": "2025-03-27T02:00:02.903261Z",
            "deleted_at": null,
            "main_name": "MuddyWater",
            "aliases": [
                "Boggy Serpens",
                "Mango Sandstorm",
                "TEMP.Zagros",
                "Static Kitten",
                "G0069",
                "TA450",
                "Earth Vetala",
                "Seedworm",
                "COBALT ULSTER",
                "ATK51"
            ],
            "source_name": "MISPGALAXY:MuddyWater",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "31e69945-6c1e-40c3-ba8e-a77e81dd142a",
            "created_at": "2024-05-01T02:03:08.047377Z",
            "updated_at": "2025-03-27T02:05:17.326452Z",
            "deleted_at": null,
            "main_name": "COBALT ULSTER",
            "aliases": [
                "ENT-11 ",
                "ITG17 ",
                "MERCURY ",
                "Mango Sandstorm ",
                "MuddyWater ",
                "STAC 1171 ",
                "Seedworm ",
                "Static Kitten ",
                "TEMP.Zagros ",
                "UNC3313 ",
                "Yellow Nix ",
                "Earth Vetala "
            ],
            "source_name": "Secureworks:COBALT ULSTER",
            "tools": [
                " Canopy",
                " CrackMapExec",
                " CredNinja",
                " Empire",
                " FORELORD",
                " Koadic",
                " LaZagne",
                " Ligolo",
                " MKL64",
                " Metasploit",
                " Mimikatz",
                " MiniDump",
                " Mori",
                " MuddyC2Go",
                " MuddyC3",
                " PhonyC2",
                " Plink",
                " PowGoop",
                " PowerStats",
                " RemoteUtilities",
                " Revsocks",
                " ScreenConnect",
                " SimpleHelp",
                " Small Sieve",
                " Syncro",
                " Venom Proxy",
                " WMIExec",
                "AnyDesk"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "02e1c2df-8abd-49b1-91d1-61bc733cf96b",
            "created_at": "2022-10-25T15:50:23.308924Z",
            "updated_at": "2025-03-27T02:00:55.437268Z",
            "deleted_at": null,
            "main_name": "MuddyWater",
            "aliases": [
                "MuddyWater",
                "Earth Vetala",
                "Static Kitten",
                "Seedworm",
                "TEMP.Zagros",
                "Mango Sandstorm",
                "TA450"
            ],
            "source_name": "MITRE:MuddyWater",
            "tools": [
                "STARWHALE",
                "POWERSTATS",
                "Out1",
                "PowerSploit",
                "Small Sieve",
                "Mori",
                "Mimikatz",
                "LaZagne",
                "PowGoop",
                "CrackMapExec",
                "ConnectWise",
                "SHARPSTATS",
                "RemoteUtilities",
                "Koadic"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "3c430d71-ab2b-4588-820a-42dd6cfc39fb",
            "created_at": "2022-10-25T16:07:23.880522Z",
            "updated_at": "2025-03-27T02:02:10.010443Z",
            "deleted_at": null,
            "main_name": "MuddyWater",
            "aliases": [
                "ATK 51",
                "Boggy Serpens",
                "Cobalt Ulster",
                "ITG17",
                "Mango Sandstorm",
                "MuddyWater",
                "Operation BlackWater",
                "Operation Earth Vetala",
                "Operation Quicksand",
                "Seedworm",
                "Static Kitten",
                "T-APT-14",
                "TA450",
                "TEMP.Zagros",
                "Yellow Nix"
            ],
            "source_name": "ETDA:MuddyWater",
            "tools": [
                "Agentemis",
                "BugSleep",
                "CLOUDSTATS",
                "ChromeCookiesView",
                "Cobalt Strike",
                "CobaltStrike",
                "CrackMapExec",
                "DELPHSTATS",
                "EmPyre",
                "EmpireProject",
                "FruityC2",
                "Koadic",
                "LOLBAS",
                "LOLBins",
                "LaZagne",
                "Living off the Land",
                "MZCookiesView",
                "Meterpreter",
                "Mimikatz",
                "MuddyC2Go",
                "MuddyRot",
                "Mudwater",
                "POWERSTATS",
                "PRB-Backdoor",
                "PhonyC2",
                "PowGoop",
                "PowerShell Empire",
                "PowerSploit",
                "Powermud",
                "QUADAGENT",
                "SHARPSTATS",
                "SSF",
                "Secure Socket Funneling",
                "Shootback",
                "Smbmap",
                "Valyria",
                "chrome-passwords",
                "cobeacon",
                "prb_backdoor"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716505,
    "ts_updated_at": 1743041774,
    "ts_creation_date": 1544066373,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/23c0a1812535edbe41637784380ff52e7f9fb777.pdf",
        "text": "https://archive.orkl.eu/23c0a1812535edbe41637784380ff52e7f9fb777.txt",
        "img": "https://archive.orkl.eu/23c0a1812535edbe41637784380ff52e7f9fb777.jpg"
    }
}