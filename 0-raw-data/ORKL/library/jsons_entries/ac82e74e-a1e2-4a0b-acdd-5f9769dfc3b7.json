{
    "id": "ac82e74e-a1e2-4a0b-acdd-5f9769dfc3b7",
    "created_at": "2023-01-12T15:03:33.863575Z",
    "updated_at": "2025-03-27T02:13:12.187366Z",
    "deleted_at": null,
    "sha1_hash": "a80573833eec8855bfc62d866f681d9870c9e1fc",
    "title": "2020-05-20 - ZLoader Loads Again- New ZLoader Variant Returns",
    "authors": "",
    "file_creation_date": "2022-05-28T19:11:17Z",
    "file_modification_date": "2022-05-28T19:11:17Z",
    "file_size": 1362020,
    "plain_text": "# ZLoader Loads Again: New ZLoader Variant Returns\n\n**[proofpoint.com/us/blog/threat-insight/zloader-loads-again-new-zloader-variant-returns](https://www.proofpoint.com/us/blog/threat-insight/zloader-loads-again-new-zloader-variant-returns)**\n\n\nMay 20, 2020\n\n\n-----\n\n[Blog](https://www.proofpoint.com/us/blog)\n[Threat Insight](https://www.proofpoint.com/us/blog/threat-insight)\nZLoader Loads Again: New ZLoader Variant Returns\n\nMay 20 2020 Dennis Schwarz Matthew Mesa and the Proofpoint Threat Research Team\n\n\n-----\n\nIn December 2019, Proofpoint researchers observed email campaigns widely distributing a new version of the ZLoader banking\nmalware, which appears to be under active development. We have seen over 100 campaigns since January 1, 2020 with recipients in\nthe United States, Canada, Germany, Poland, and Australia. The fraudulent email lures include a variety of subjects, including\nCOVID-19 scam prevention tips, COVID-19 testing, and invoices.\n\nZLoader, a variant of the infamous Zeus banking malware, has been around since 2006. It is a typical banking malware that makes\nuse of webinjects to steal credentials and other private information from users of targeted financial institutions. The malware can also\nsteal passwords and cookies stored in victim’s web browsers. With the stolen information in hand, the malware can use the VNC\n(Virtual Network Computing) client it downloads to allow threat actors to connect to the victim’s system and make illicit\nfinancial transactions from the banking user’s legitimate device.\n\nAlmost two years after ZLoader’s last activity in 2018, we started observing campaigns using a new banking\nmalware that exhibited functionality and network traffic similar to the original 2016-2018 ZLoader. However, during our analysis we\nnoticed that it was missing the code obfuscation, string encryption, and a few other advanced features of the\noriginal ZLoader. Hence, the new malware does not appear to be a continuation of the 2018 strain, but likely a fork of an earlier\nversion.\n\nIn this post, we analyze the new malware version and provide several examples of the most interesting email campaigns spreading\n[it. We will continue to track this new malware as a “ZLoader variant” which has caught on in the wider community.](https://twitter.com/hashtag/zloader)\n\n**Background**\n\nFrom [June 2016 to February 2018, a banking malware known as ZLoader (also known as DELoader or Terdot) spread in the](https://www.fortinet.com/blog/threat-research/the-curious-case-of-an-unknown-trojan-targeting-german-speaking-users.html)\nwild. The letter “Z” in its name was given because it is a variant of the Zeus malware. The “loader” part of its name is due to its\ndistinguishing feature: it was distributed as a downloader component, which would download and run the main banking\nmalware component and other modules from its command and control (C&C) server.\n\nWhile there were multiple threat actors using the malware at the time, TA511 (Hancitor) was one of the most prevalent. In\napproximately November 2017, TA511 switched from ZLoader to Panda Banker. Other threat actors started following suit and\nswitched away from ZLoader to other malware. The last email campaign we saw using the original ZLoader was in February 2018.\n\n**Malware Analysis**\n\n**Version History**\n\nThis ZLoader variant is in active development. We have seen 25 versions released since the first one (1.0.2.0) was spotted in the wild\nin December 2019. As can be seen in Table 1, about 1-2 new versions have been released each week:\n\n**Month** **Versions**\n\nDecember 2019 1.0.2.0, 1.0.4.0, 1.0.5.0, 1.0.6.0, 1.0.7.0, 1.0.8.0, 1.0.9.0\n\nJanuary 2020 1.0.10.0, 1.0.10.1, 1.011.1, 1.0.12.0, 1.0.13.0, 1.0.14.0\n\nFebruary 2020 1.0.15.0, 1.0.16.0, 1.0.17.0, 1.0.18.0\n\nMarch 2020 1.1.18.0, 1.1.19.0, 1.1.20.0, 1.1.21.0, 1.1.22.0\n\nApril 2020 1.2.22.0, 1.2.23.0\n\nMay 2020 1.2.24.0\n\n_Table 1 ZLoader versions in the wild_\n\nAt the time of writing, version 1.2.24.0 was the latest release and it was spotted in the wild in May 2020.\n\n**Anti-Analysis**\n\n\n-----\n\nZLoader employs several anti analysis mechanisms to make it more difficult to detect and reverse engineer. These include junk code,\nconstant obfuscation, Windows API function hashing, encrypted strings, and C&C blacklisting. An example of junk code and constant\nobfuscation can be seen in Figure 1:\n\n_Figure 1 Example of junk code and constant obfuscation_\n\nThis function returns the version of the malware as a DWORD (0x1021600) by XORing two hardcoded constants (0x21F89813 and\n0x20FA8E13). The rest of the code is superfluous and is used to distract the analyst.\n\nAnother anti-analysis mechanism is Windows API (Application Programming Interface) function hashing. A Python implementation of\n[the hashing algorithm is available on our GitHub. Table 2 lists some example Windows API functions and their hash values:](https://github.com/EmergingThreats/threatresearch/blob/master/zloader/func_hashes.py)\n\n**Windows API Function** **Hash Value**\n\nExitProcess 0x7F96C13\n\nInternetConnectA 0xAE775E1\n\nInternetReadFile 0x7E90205\n\nCryptHashData 0x23ED221\n\n_Table 2 Example Windows API functions and their hash value_\n\nThe next anti-analysis mechanism is the encryption of strings. Most of ZLoader’s important strings are encrypted using XOR and a\nhardcoded string (e.g. “7Gl5et#0GoTI5VV94”). An example IDAPython script to decrypt strings in the sample we analyzed is available\n[on our GitHub.](https://github.com/EmergingThreats/threatresearch/blob/master/zloader/str_decrypt.py)\n\nThe last anti-analysis measure we will mention is not built into the malware client but implemented in the C&C server instead. While it\nvaries based on the campaign, we noticed aggressive blacklisting of sandboxes and malware analysis\nsystems and significant blocking based on geography of the connecting source IP address.\n\n**Configuration**\n\n[ZLoader continues the Zeus tradition of using a data structure known as the “BaseConfig” to store its initial configuration. Figure](https://github.com/Visgean/Zeus/blob/translation/source/common/generateddata.h#L58)\n2 shows an example of the BaseConfig decryption function:\n\n\n-----\n\n_Figure 2 Example of a BaseConfig decryption function_\n\nIt uses RC4 with a hardcoded key (e.g. “quxrfjxtmedqretawrxg”). An example plaintext config is shown in Figure 3:\n\n_Figure 3 Example of a plaintext BaseConfig_\n\nThe plaintext data is interpreted as a binary structure and includes:\n\nDWORD used in C&C communications (e.g. 0x83)\nBotnet name (e.g. “1”)\nCampaign name (e.g. “07/04”)\nUp to 10 C&C URLs (e.g. “hxxps://xyajbocpggsr\\.site/wp-config.php” and “hxxps://ooygvpxrb\\.pw/wp-config.php”)\nRC4 key used in C&C communications (e.g. “41997b4a729e1a0175208305170752dd”)\nMiscellaneous timeouts and flags\n\n**Command and Control**\n\nZLoader uses HTTP(S) POST requests for command and control. The POST data is encrypted in two layers. The first layer is RC4\n[using the key from the BaseConfig. The second layer is an XOR-based encryption typical in Zeus variants known as “Visual Encrypt.”](https://github.com/Visgean/Zeus/blob/translation/source/common/crypt.cpp#L207)\n\n[The plaintext data is structured using a traditional Zeus data structure known as “BinStorage.” BinStorage consists of a header and a](https://github.com/Visgean/Zeus/blob/translation/source/common/binstorage.h#L42)\n[variable number of data items. The header is 48-bytes in size and contains:](https://github.com/Visgean/Zeus/blob/translation/source/common/binstorage.h#L51)\n\nRandom data (20-bytes)\nSize of data items (DWORD)\nFlags (DWORD)\nNumber of data items (DWORD)\nMD5 hash of data items (16-bytes)\n\nEach data item starts with a 16-byte header containing:\n\nId (DWORD) -- also known as “CFGID”\nFlags (DWORD)\nSize of data (compressed) (DWORD) -- ZLoader does not use compression\nSize of data (uncompressed) (DWORD)\n\nThe response data is encrypted similarly to requests. Once decrypted, it also typically uses the BinStorage structure. We will look at\nthree requests: initial “hello,” main component download, and configuration update.\n\n\n-----\n\n_Initial hello Request_\n\nThe initial “hello” requests contains a BinStorage with the data items from Table 3:\n\n**CFGID** **Data**\n\n10029 DWORD value from the BaseConfig\n\n10002 Botnet string from the BaseConfig\n\n10001 Bot ID\n\n10022 Flag from BaseConfig indicating whether this is a debug version\n\n10006 Hardcoded 0x0 (DWORD)\n\n_Table 3 Initial “hello” request BinStorage_\n\nAn affirmative response from the C&C server to the “hello” request is an empty BinStorage.\n\n_Module Request_\n\nThe “loader” component of ZLoader downloads the main component using a BinStorage described in Table 4:\n\n**CFGID** **Data**\n\n10029 - 10022 The same as the “hello” request in Table 3 above\n\n11014 Module ID (32-bit main component is ID 1006)\n\n11015 Module Version (typically the same as the malware version)\n\n_Table 4 Module request BinStorage_\n\nThe main component also uses this request to download additional modules for various pieces of functionality. Modules include\nOpenSSL, SQLite, Zlib, Certutil, and VNC.\n\nA module response is encrypted and formatted differently than the other responses. It is only RC4 encrypted using the key from\nthe BaseConfig. Once decrypted it contains a 21-byte header followed by a PE file. The header contains:\n\nModule ID (DWORD)\nModule Version (DWORD)\nUnknown (DWORD)\nModule length (DWORD)\nModule CRC32 checksum (DWORD)\nUnknown (BYTE)\n\n_Configuration Update Request_\n\nThe last request we’ll look at is the configuration update request—this is generally known as the “DynamicConfig” in Zeus’ parlance. It\nuses a BinStorage containing the items from Table 5:\n\n**CFGID** **Data**\n\n10029 - 10022 The same as the “hello” request in Table 3 above\n\n10012 Windows version and architecture\n\n\n-----\n\n10003 Malware version\n\n10023 Process integrity level\n\n10024 Number of monitors\n\n10016 IPv4 address\n\n10025 BaseConfig campaign name\n\n10026 MD5 hash of loader component\n\n10020 Running process list\n\n10027 Time zone\n\n_Table 5 Configuration update request_\n\nDynamicConfigs include a variety of data including:\n\nAdditional C&C URLs\nCommands to execute\nuser_execute – download and execute\nbot_uninstall – remove self\nuser_cookies_get – steal cookies from web browsers\nuser_cookies_remove – remove cookies from web browsers\nuser_passwords_get – steal passwords\nuser_files_get – steal files\nuser_url_block – block access to URL\nuser_url_unblock – unblock access to URL\nWebinjects (see Figure 4)\nUsed in conjunction with Zeus’ [person-in-the-browser mechanism to manipulate and steal user credentials and other data](https://attack.mitre.org/techniques/T1185/)\nfrom financial websites (typically)\n\n_Figure 4 Example snippet of a parsed webinject_\n\n**Domain Generation Algorithm**\n\nStarting in version 1.1.22.0 (March 2020) a backup domain generation algorithm (DGA) was added. If ZLoader is unable to connect to\nthe C&Cs from the BaseConfig or DynamicConfig it will generate 32 “.com” domains to try. The DGA uses the BaseConfig RC4 key to\nencrypt the current date as a starting seed. This seed is used with a basic hashing algorithm to generate 20 lowercase letters. A\n[Python implementation of the algorithm is available on our GitHub. Table 6 show the first few DGA generated domains for the](https://github.com/EmergingThreats/threatresearch/blob/master/zloader/dga.py)\nanalyzed sample on April 8, 2020:\n\n\nctmaetpfoecphxxqlgfk\\.com\n\n\nirtdojdrlgodkgfkyxab\\.com\n\n\n-----\n\nmtpfmkyxaaceblyjlwxv\\.com\n\n\nvrwuosfciqjcgvvrliup\\.com\n\n\nsdauiqukokclpxtpirkh\\.com\n\n\n_Table 6 Example DGA generated domains from April 8, 2020_\n\n**Campaign Analysis**\n\nSince we started observing the new variant in December 2019, it has become popular and widespread. At the time of writing, we are\ndocumenting at least one ZLoader campaign per day by a variety of actors primarily targeting organizations in the United States,\nCanada, Germany, Poland, and Australia. Below are examples of campaigns that delivered ZLoader in the past few months.\n\nOn December 6, 2019, we observed an email campaign that purported to deliver an invoice (Figure 5).th\n\n_Figure 5 Example email used in December 6, 2019 campaign_\n\nThe messages contained PDF attachments (Figure 6) that utilized the branding of several invoicing software companies.\n\n_Figure 6 Example PDF used in December 6, 2019 campaign_\n\nThe PDFs contained URLs linking to a Microsoft Word document (Figure 7). The document utilized macros to download and\nexecute ZLoader version “1.0.2.0.” Each of the downloads were filtered by Keitaro TDS (Traffic Distribution\nSystem) to hinder automated analysis.\n\n\n-----\n\n_Figure 7 Example document used in December 6th, 2019 campaign_\n\nOn March 30, 2020 we observed an email campaign utilized multiple lures (Figure 8) that \"warn” the user of various COVID19 scams.\n\n_Figure 8 Example email used in March 30 2020 campaign_\n\n\n-----\n\nThese emails contained URLs linking to a landing page that presents a CAPTCHA challenge (Figure 9) before linking to the download\nof a Microsoft Word Document (Figure 10). The document contained macros that, if enabled, would then\ndownload ZLoader version “1.1.21.0.”\n\n_Figure 9 Example CAPTCHA used in March 30, 2020 campaign_\n\n_Figure 10 Example document used in March 30, 2020 campaign_\n\nOn April 4, 2020, we observed an email campaign (Figure 11) that contained a message about a family member, colleague, or\nneighbor who contracted COVID-19, and supposedly provided information on where to get tested.\n\n\n-----\n\n_Figure 11 Example email used in April 4th, 2020 campaign_\n\nThe emails contained password-protected Excel sheets (Figure 12). The sheet utilized Excel 4.0 macros to download and execute\nthe ZLoader version “1.1.22.0.”\n\n_Figure 12 Example spreadsheet used in April 4 2020 campaign_\n\n\n-----\n\n**Conclusion**\n\nThis post has analyzed the latest Zeus banking malware variant and some of the campaigns we have seen spreading it. It uses\ntypical banking malware functionality such as webinjects, password and cookie theft, and access to devices via VNC to steal\ncredentials, personally identifiable information, and ultimately money from targets. The Zeus banking malware and its descendants\nhave been a staple in the cybercrime landscape since 2006. From Zeus to Citadel, Ice\nIX, Murofet, Gameover, ZLoader, KINS, Flokibot, Chthonic, Panda Banker, and back to ZLoader again.\n\n**Indicators of Compromise**\n\n\n**IOC** **IOC**\n**Type**\n\n\n**Description**\n\n\n2b5e50bc3077610128051bc3e657c3f0e331fb8fed2559c6596911890ea866ba SHA256 Zloader (1.2.22.0)\n\nhxxps://xyajbocpggsr\\.site/wp-config.php URL Zloader (1.2.22.0) C&C\n\nhxxps://ooygvpxrb\\.pw/wp-config.php URL Zloader (1.2.22.0) C&C\n\n6348bded936831629494c1d820fe8e3dbe3fb4d9f96940bbb4ca0c1872bef0ad SHA256 Zloader (1.1.21.0)\n\nhxxps://vfgthujbxd\\.xyz/milagrecf.php URL Zloader (1.1.21.0) C&C\n\nhxxps://todiks\\.xyz/milagrecf.php URL Zloader (1.1.21.0) C&C\n\n4725e0e2e358e06da19de9802b4c345f1a5ab572dd688c78adf317ce8be85be6 SHA256 PDF Attachment from Zloader campaign\n\nf1bdd2bcbaf40bb99224fa293edc1581fd124da63c035657918877901d79bed8 SHA256 Zloader (1.0.2.0)\n\nhxxps://brihutyk\\.xyz/abbyupdater.php URL Zloader (1.0.2.0) C&C\n\nhxxps://asdmark\\.org/ph4xUMChrXId6.php URL Example Landing Page\n\nfe10daf5e3de07d400ca37b6b151eb252b71d013312e2958d1281da6626813d9 SHA256 Example Document Delivering Zloader\n\nea190ef11b88e830fa8835ff9d22dcab77a3356d3b1cb7b9f9b56e8cd7deb8c0 SHA256 Zloader (1.1.21.0)\n\nhxxps://105711\\.com/docs.php URL Zloader (1.1.21.0) C&C\n\nhxxps://209711\\.com/process.php URL Zloader (1.1.21.0) C&C\n\nhxxps://106311\\.com/comegetsome.php URL Zloader (1.1.21.0) C&C\n\nhxxps://124331\\.com/success.php URL Zloader (1.1.21.0) C&C\n\nbfe470b390f20e3e189179fc1372d6e66d04d7676fa07d2a356b71362cd03e53 SHA256 Example Excel Sheet\nDelivering Zloader\n\nb4e0478cf85035852a664984f8639e98bee3b54d6530ef22d46874b14ad0e748 SHA256 Zloader (1.1.22.0)\n\nhxxp://march262020\\.best/post.php URL Zloader (1.1.22.0) C&C\n\n\n-----\n\nhxxp://march262020\\.club/post.php URL Zloader (1.1.22.0) C&C\n\nhxxp://march262020\\.com/post.php URL Zloader (1.1.22.0) C&C\n\nhxxp://march262020\\.live/post.php URL Zloader (1.1.22.0) C&C\n\nhxxp://march262020\\.network/post.php URL Zloader (1.1.22.0) C&C\n\nhxxp://march262020\\.online/post.php URL Zloader (1.1.22.0) C&C\n\nhxxp://march262020\\.site/post.php URL Zloader (1.1.22.0) C&C\n\nhxxp://march262020\\.store/post.php URL Zloader (1.1.22.0) C&C\n\nhxxp://march262020\\.tech/post.php URL Zloader (1.1.22.0) C&C\n\n_[Is your organization protected from Malware threats? Learn about Malware Attacks & Protection.](https://www.proofpoint.com/us/threat-reference/malware)_\n\nSubscribe to the Proofpoint Blog\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-05-20 - ZLoader Loads Again- New ZLoader Variant Returns.pdf"
    ],
    "report_names": [
        "2020-05-20 - ZLoader Loads Again- New ZLoader Variant Returns.pdf"
    ],
    "threat_actors": [
        {
            "id": "1f6ae238-765f-4495-9d54-6a7883d7a319",
            "created_at": "2022-10-25T16:07:24.573456Z",
            "updated_at": "2025-03-27T02:02:10.284644Z",
            "deleted_at": null,
            "main_name": "TA511",
            "aliases": [
                "MAN1",
                "Moskalvzapoe"
            ],
            "source_name": "ETDA:TA511",
            "tools": [
                "Agentemis",
                "Chanitor",
                "Cobalt Strike",
                "CobaltStrike",
                "Ficker Stealer",
                "Hancitor",
                "NetSupport",
                "NetSupport Manager",
                "NetSupport Manager RAT",
                "NetSupport RAT",
                "NetSupportManager RAT",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "542cf9d0-9c68-428c-aff8-81b6f59dc985",
            "created_at": "2023-02-15T02:01:49.554105Z",
            "updated_at": "2025-03-27T02:00:03.110991Z",
            "deleted_at": null,
            "main_name": "Moskalvzapoe",
            "aliases": [
                "MAN1",
                "TA511"
            ],
            "source_name": "MISPGALAXY:Moskalvzapoe",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535813,
    "ts_updated_at": 1743041592,
    "ts_creation_date": 1653765077,
    "ts_modification_date": 1653765077,
    "files": {
        "pdf": "https://archive.orkl.eu/a80573833eec8855bfc62d866f681d9870c9e1fc.pdf",
        "text": "https://archive.orkl.eu/a80573833eec8855bfc62d866f681d9870c9e1fc.txt",
        "img": "https://archive.orkl.eu/a80573833eec8855bfc62d866f681d9870c9e1fc.jpg"
    }
}