{
    "id": "0c8a19c6-8994-4df1-a36a-e058ecda2d0e",
    "created_at": "2023-01-12T15:00:41.912085Z",
    "updated_at": "2025-03-27T02:06:08.237909Z",
    "deleted_at": null,
    "sha1_hash": "1a27458ec17373b64305a4d53267f184e0eb244d",
    "title": "2014-09-21 - Reversing Tinba- World's smallest trojan-banker DGA Code",
    "authors": "",
    "file_creation_date": "2022-05-28T01:23:46Z",
    "file_modification_date": "2022-05-28T01:23:46Z",
    "file_size": 105586,
    "plain_text": "# garage4hackers\n\n**garage4hackers.com/entry.php**\n\n## CSIS Security Group A/S has uncovered a new trojan-banker family which we have named Tinba (Tiny Banker) alias Zusy.\n\n Tinba is a small data stealing trojan-banker. It hooks into browsers and steals login data and sniffs on network traffic. As several sophisticated banker-trojan it also uses Man in The Browser (MiTB) tricks and webinjects in order to change the look and feel of certain webpages with the purpose of circumventing Two factor Authentification (2FA) or tricking the infected user to give away additional sensitive data such as credit card data or TANs.\n\n Tinba is the smallest trojan-banker we have ever encountered and it belongs to a complete new family of malware which we expect to be battling in upcoming months.\n source:https://www.csis.dk/en/csis/news/3566/\n\n This time we are investigating the tiny banker's DGA. We are again only interested in the code that is dealing\n with the domain name generation.\n Execute the sample and let it terminate itself. It will inject its code into Explorer.exe process.\n Attach debugger to explorer.exe.\n\n\n-----\n\n## Now where should we start in vast pool of explorer.exe address space? The answer is again the place where we can find teh simptoms of DGA. Let us set breakpoint at \"gethostbyname\". The code will break at gethostbyname, let it finish its work and you'l land in DGA code from its return address. The following code belongs to the DGA :\n\n Code:\n\n\n-----\n\n```\n02252739  55        PUSH EBP\n0225273A  89E5       MOV EBP,ESP\n0225273C  81EC 0C020000  SUB ESP,20C\n02252742  57        PUSH EDI\n02252743  6A 20      PUSH 20\n02252745  8D93 605E4000  LEA EDX,DWORD PTR DS:[EBX+405E60]\n0225274B  52        PUSH EDX\n0225274C  8D95 F8FEFFFF  LEA EDX,DWORD PTR SS:[EBP-108]\n02252752  52        PUSH EDX\n02252753  E8 040B0000   CALL 0225325C\n02252758  0FB783 C25E4000 MOVZX EAX,WORD PTR DS:[EBX+405EC2]\n0225275F  8945 FC     MOV DWORD PTR SS:[EBP-4],EAX\n02252762  EB 6C      JMP SHORT 022527D0\n02252764  837D FC 00    CMP DWORD PTR SS:[EBP-4],0\n02252768  75 21      JNZ SHORT 0225278B\n0225276A  6A 20      PUSH 20\n0225276C  8D95 F8FEFFFF  LEA EDX,DWORD PTR SS:[EBP-108]\n02252772  52        PUSH EDX\n02252773  8D93 605E4000  LEA EDX,DWORD PTR DS:[EBX+405E60]\n02252779  52        PUSH EDX\n0225277A  E8 DD0A0000   CALL 0225325C\n0225277F  0FB783 C25E4000 MOVZX EAX,WORD PTR DS:[EBX+405EC2]\n02252786  8945 FC     MOV DWORD PTR SS:[EBP-4],EAX\n02252789  EB 45      JMP SHORT 022527D0\n0225278B  FF4D FC     DEC DWORD PTR SS:[EBP-4]\n0225278E  8DB3 A05E4000  LEA ESI,DWORD PTR DS:[EBX+405EA0] ; \"oGkS3w3sGGOGG7oc\"\n02252794  B9 10000000   MOV ECX,10\n02252799  31C0       XOR EAX,EAX\n0225279B  31D2       XOR EDX,EDX\n0225279D  AC        LODS BYTE PTR DS:[ESI]\n0225279E  01C2       ADD EDX,EAX\n022527A0 ^E2 FB      LOOPD SHORT 0225279D\n022527A2  8DBB 605E4000  LEA EDI,DWORD PTR DS:[EBX+405E60] ; \"ssrgwnrmgrxe.com\"\n022527A8  B9 0C000000   MOV ECX,0C\n022527AD  0207       ADD AL,BYTE PTR DS:[EDI]\n022527AF  30D0       XOR AL,DL\n022527B1  0247 01     ADD AL,BYTE PTR DS:[EDI+1]\n022527B4  3C 61      CMP AL,61\n022527B6  76 04      JBE SHORT 022527BC\n022527B8  3C 7A      CMP AL,7A\n022527BA  72 04      JB SHORT 022527C0\n022527BC  FEC2       INC DL\n022527BE ^EB ED      JMP SHORT 022527AD\n022527C0  AA        STOS BYTE PTR ES:[EDI]\n022527C1 ^E2 EA      LOOPD SHORT 022527AD\n022527C3  B0 2E      MOV AL,2E ; \".\"\n022527C5  AA        STOS BYTE PTR ES:[EDI]\n022527C6  8B83 B85E4000  MOV EAX,DWORD PTR DS:[EBX+405EB8] ; \"com\"\n022527CC  AB        STOS DWORD PTR ES:[EDI]\n022527CD  31C0       XOR EAX,EAX\n022527CF  AA        STOS BYTE PTR ES:[EDI]\n022527D0  8D93 605E4000  LEA EDX,DWORD PTR DS:[EBX+405E60]\n022527D6  52        PUSH EDX\n022527D7  FF93 4D354000  CALL DWORD PTR DS:[EBX+40354D]\n022527DD  85C0       TEST EAX,EAX\n\n```\n\n-----\n\n```\n022527DF  79 1C      JNS SHORT 022527FD\n022527E1  8D93 605E4000  LEA EDX,DWORD PTR DS:[EBX+405E60]\n022527E7  52        PUSH EDX\n022527E8  FF93 5F354000  CALL DWORD PTR DS:[EBX+40355F] ; call to gethostbyname\n022527EE  85C0       TEST EAX,EAX\n022527F0 ^0F84 6EFFFFFF  JE 02252764\n022527F6  8B40 0C     MOV EAX,DWORD PTR DS:[EAX+C]\n022527F9  8B00       MOV EAX,DWORD PTR DS:[EAX]\n022527FB  8B00       MOV EAX,DWORD PTR DS:[EAX]\n022527FD  8B55 08     MOV EDX,DWORD PTR SS:[EBP+8]\n02252800  8942 04     MOV DWORD PTR DS:[EDX+4],EAX\n02252803  66:8B83 7E5E4000 MOV AX,WORD PTR DS:[EBX+405E7E]\n0225280A  66:8942 02    MOV WORD PTR DS:[EDX+2],AX\n0225280E  66:C702 0200   MOV WORD PTR DS:[EDX],2\n02252813  C642 08 00    MOV BYTE PTR DS:[EDX+8],0\n02252817  C642 0C 00    MOV BYTE PTR DS:[EDX+C],0\n0225281B  8DBD F4FDFFFF  LEA EDI,DWORD PTR SS:[EBP-20C]\n02252821  6A 20      PUSH 20\n02252823  8D93 605E4000  LEA EDX,DWORD PTR DS:[EBX+405E60]\n02252829  52        PUSH EDX\n0225282A  57        PUSH EDI\n0225282B  E8 2C0A0000   CALL 0225325C\n02252830  83C7 20     ADD EDI,20\n02252833  B9 18000000   MOV ECX,18\n02252838  60        PUSHAD\n02252839  6A 01      PUSH 1\n0225283B  FF93 93104000  CALL DWORD PTR DS:[EBX+401093]\n02252841  61        POPAD\n02252842  0F31       RDTSC\n02252844  AB        STOS DWORD PTR ES:[EDI]\n02252845  49        DEC ECX\n02252846 ^75 F0      JNZ SHORT 02252838\n02252848  8B7D 0C     MOV EDI,DWORD PTR SS:[EBP+C]\n0225284B  31C0       XOR EAX,EAX\n0225284D  AA        STOS BYTE PTR ES:[EDI]\n0225284E  B8 80000000   MOV EAX,80\n02252853  AB        STOS DWORD PTR ES:[EDI]\n02252854  68 80000000   PUSH 80\n02252859  8D95 F4FDFFFF  LEA EDX,DWORD PTR SS:[EBP-20C]\n0225285F  52        PUSH EDX\n02252860  57        PUSH EDI\n02252861  E8 F6090000   CALL 0225325C\n02252866  83EF 04     SUB EDI,4\n02252869  57        PUSH EDI\n0225286A  E8 57F9FFFF   CALL 022521C6\n0225286F  4F        DEC EDI\n02252870  68 85000000   PUSH 85\n02252875  57        PUSH EDI\n02252876  FF75 08     PUSH DWORD PTR SS:[EBP+8]\n02252879  E8 8F010000   CALL 02252A0D\n0225287E  89C6       MOV ESI,EAX\n02252880  29F8       SUB EAX,EDI\n02252882  6A 04      PUSH 4\n02252884  E8 05000000   CALL 0225288E\n02252889  0D 0A0D0A00   OR EAX,0A0D0A\n\n```\n\n-----\n\n```\n0225288E  50        PUSH EAX\n0225288F  57        PUSH EDI\n02252890  E8 F30A0000   CALL 02253388\n02252895  85C0       TEST EAX,EAX\n02252897 ^0F84 C7FEFFFF  JE 02252764\n0225289D  8D78 04     LEA EDI,DWORD PTR DS:[EAX+4]\n022528A0  39F7       CMP EDI,ESI\n022528A2 ^0F84 BCFEFFFF  JE 02252764\n022528A8  87FE       XCHG ESI,EDI\n022528AA  AD        LODS DWORD PTR DS:[ESI]\n022528AB  3B83 573D4000  CMP EAX,DWORD PTR DS:[EBX+403D57]\n022528B1 ^0F85 ADFEFFFF  JNZ 02252764\n022528B7  AC        LODS BYTE PTR DS:[ESI]\n022528B8  84C0       TEST AL,AL\n022528BA ^0F85 A4FEFFFF  JNZ 02252764\n022528C0  AD        LODS DWORD PTR DS:[ESI]\n022528C1  3D 80000000   CMP EAX,80\n022528C6  74 12      JE SHORT 022528DA\n022528C8  3D 00010000   CMP EAX,100\n022528CD  74 0B      JE SHORT 022528DA\n022528CF  3D 00020000   CMP EAX,200\n022528D4 ^0F85 8AFEFFFF  JNZ 02252764\n022528DA  50        PUSH EAX\n022528DB  56        PUSH ESI\n022528DC  8D95 F4FDFFFF  LEA EDX,DWORD PTR SS:[EBP-20C]\n022528E2  52        PUSH EDX\n022528E3  E8 0D000000   CALL 022528F5\n022528E8  85C0       TEST EAX,EAX\n022528EA ^0F84 74FEFFFF  JE 02252764\n022528F0  5F        POP EDI\n022528F1  C9        LEAVE\n022528F2  C2 0800     RETN 8\n\n## If gethostbyname returns empty hand, it then loops through the code to generate another domain :\n\n Code:\n022527E8  FF93 5F354000  CALL DWORD PTR DS:[EBX+40355F] ; call to gethostbyname\n022527EE  85C0       TEST EAX,EAX\n022527F0 ^0F84 6EFFFFFF  JE 02252764\n\n Above code snippet will loop through the code starting at 0x02252764. So this address is where the DGA starts, We should check the stack and all register's conditions when we'll land on address 0x02252764. Remember these conditions are needed as arguments while reversing any subroutine :\n\n Code:\n\n```\n\n-----\n\n```\n02252764  837D FC 00    CMP DWORD PTR SS:[EBP 4],0 ; Starts with 0x03E8 ; 1000\nNumber of domains\n02252768  75 21      JNZ SHORT 0225278B\n0225276A  6A 20      PUSH 20\n0225276C  8D95 F8FEFFFF  LEA EDX,DWORD PTR SS:[EBP-108]\n02252772  52        PUSH EDX\n02252773  8D93 605E4000  LEA EDX,DWORD PTR DS:[EBX+405E60]\n02252779  52        PUSH EDX\n0225277A  E8 DD0A0000   CALL 0225325C\n0225277F  0FB783 C25E4000 MOVZX EAX,WORD PTR DS:[EBX+405EC2]\n02252786  8945 FC     MOV DWORD PTR SS:[EBP-4],EAX\n02252789  EB 45      JMP SHORT 022527D0\n0225278B  FF4D FC     DEC DWORD PTR SS:[EBP-4]\n0225278E  8DB3 A05E4000  LEA ESI,DWORD PTR DS:[EBX+405EA0] ; \"oGkS3w3sGGOGG7oc\"\n02252794  B9 10000000   MOV ECX,10\n02252799  31C0       XOR EAX,EAX\n0225279B  31D2       XOR EDX,EDX\n0225279D  AC        LODS BYTE PTR DS:[ESI]\n0225279E  01C2       ADD EDX,EAX\n022527A0 ^E2 FB      LOOPD SHORT 0225279D\n022527A2  8DBB 605E4000  LEA EDI,DWORD PTR DS:[EBX+405E60] ; \"ssrgwnrmgrxe.com\"\n022527A8  B9 0C000000   MOV ECX,0C\n022527AD  0207       ADD AL,BYTE PTR DS:[EDI]\n022527AF  30D0       XOR AL,DL\n022527B1  0247 01     ADD AL,BYTE PTR DS:[EDI+1]\n022527B4  3C 61      CMP AL,61\n022527B6  76 04      JBE SHORT 022527BC\n022527B8  3C 7A      CMP AL,7A\n022527BA  72 04      JB SHORT 022527C0\n022527BC  FEC2       INC DL\n022527BE ^EB ED      JMP SHORT 022527AD\n022527C0  AA        STOS BYTE PTR ES:[EDI]\n022527C1 ^E2 EA      LOOPD SHORT 022527AD\n022527C3  B0 2E      MOV AL,2E ; \".\"\n022527C5  AA        STOS BYTE PTR ES:[EDI]\n022527C6  8B83 B85E4000  MOV EAX,DWORD PTR DS:[EBX+405EB8] ; \"com\"\n022527CC  AB        STOS DWORD PTR ES:[EDI]\n022527CD  31C0       XOR EAX,EAX\n022527CF  AA        STOS BYTE PTR ES:[EDI]\n022527D0  8D93 605E4000  LEA EDX,DWORD PTR DS:[EBX+405E60]\n022527D6  52        PUSH EDX\n\n## A decision is made at 0x02252764 for comparison of value at address [EBP-4] which is 0x03E8 in teh begining that is 0x3E8 and then decreses along the looping through the successive loops. This is the maximum number of domains to be generated. If this value is greater than 0 then a jump is made to address 0x0225278B. Let us check what is at this address:\n\n Code:\n\n```\n\n-----\n\n```\n0225278B  FF4D FC     DEC DWORD PTR SS:[EBP 4]\n0225278E  8DB3 A05E4000  LEA ESI,DWORD PTR DS:[EBX+405EA0] ; \"oGkS3w3sGGOGG7oc\"\n02252794  B9 10000000   MOV ECX,10\n02252799  31C0       XOR EAX,EAX\n0225279B  31D2       XOR EDX,EDX\n0225279D  AC        LODS BYTE PTR DS:[ESI]\n0225279E  01C2       ADD EDX,EAX\n022527A0 ^E2 FB      LOOPD SHORT 0225279D\n022527A2  8DBB 605E4000  LEA EDI,DWORD PTR DS:[EBX+405E60] ; \"ssrgwnrmgrxe.com\"\n022527A8  B9 0C000000   MOV ECX,0C\n022527AD  0207       ADD AL,BYTE PTR DS:[EDI]\n022527AF  30D0       XOR AL,DL\n022527B1  0247 01     ADD AL,BYTE PTR DS:[EDI+1]\n022527B4  3C 61      CMP AL,61\n022527B6  76 04      JBE SHORT 022527BC\n022527B8  3C 7A      CMP AL,7A\n022527BA  72 04      JB SHORT 022527C0\n022527BC  FEC2       INC DL\n022527BE ^EB ED      JMP SHORT 022527AD\n022527C0  AA        STOS BYTE PTR ES:[EDI]\n022527C1 ^E2 EA      LOOPD SHORT 022527AD\n022527C3  B0 2E      MOV AL,2E ; \".\"\n022527C5  AA        STOS BYTE PTR ES:[EDI]\n022527C6  8B83 B85E4000  MOV EAX,DWORD PTR DS:[EBX+405EB8] ; \"com\"\n022527CC  AB        STOS DWORD PTR ES:[EDI]\n022527CD  31C0       XOR EAX,EAX\n022527CF  AA        STOS BYTE PTR ES:[EDI]\n022527D0  8D93 605E4000  LEA EDX,DWORD PTR DS:[EBX+405E60]\n022527D6  52        PUSH EDX\n\n## The above code snippet is the DGA itself. It utilizes one hardcoded domain name as seed and another string as salt. Every new generated domain name gets consumed in generating next domain name. The difference in this DGA is that it it doesnt use date/time for domain generation, rather uses the domain name as seed for generating next domain.\n\n Code:\n\n```\n\n-----\n\n```\n  Filename : TinBaDGA.py\n  Developer : Garage4Hackers\n  Greets  : b0nd, FB1H2S, \"vinnu\", l0rdDeathStorm, nightrover and all g4h team\n'''\nimport os, time\nutility = \"TinBaDGA\"\ndef tinbaDGA(idomain, seed):\n  print \"[+] \"+utility+\" : Initiated\"\n  suffix = \".com\"\n  domains = []\n  count = 0x03E8\n  eax = 0\n  edx = 0\n  for i in range(count) :\n    buf = ''\n    esi = seed\n    ecx = 0x10\n    eax = 0\n    edx = 0\n    for s in range(len(seed)) :\n      eax = ord(seed[s])\n      edx += eax\n    edi = idomain\n    ecx = 0x0C\n    d = 0\n    while ( ecx > 0 ):\n      al = eax & 0xFF\n      dl = edx & 0xFF\n      #print \"0 eax : %x edx : %x ecx : %x\" % (eax, edx, ecx)\n      #print \"0 al : %x dl : %x\" % (al, dl)\n      al = al + ord(idomain[d])\n      al = al ^ dl\n      #print \"1 al : %x dl : %x\" % (al, dl)\n      al += ord(idomain[d+1])\n      al = al & 0xFF\n      #print \"2 al : %x dl : %x\" % (al, dl)\n      eax = (eax & 0xFFFFFF00)+al\n      edx = (edx & 0xFFFFFF00)+dl\n      if al > 0x61 :\n        if al < 0x7A :\n          #al = ord(idomain[d])\n          eax = (eax & 0xFFFFFF00) +al\n          buf += chr(al)\n          d += 1\n          ecx -= 1\n          #print \"\\tal : %x ecx : %x\" % (al, ecx)\n          continue\n      #time.sleep(4)\n      dl += 1\n\n```\n\n-----\n\n```\n      dl dl & 0xFF\n      edx = (edx & 0xFFFFFF00)+dl\n    domain = buf+suffix\n    print \"[%d] %s\" %(i, domain)\n    domains.append(domain)\n    idomain = domain\n  return domains    \ndef init():\n  harddomain = \"ssrgwnrmgrxe.com\"\n  seed = \"oGkS3w3sGGOGG7oc\"\n  domains = tinbaDGA(harddomain, seed)\n  index = 0\n  fp = open(utility+\".log\", \"wb\")\n  for domain in domains :\n    index += 1\n    line = \"[%d] %s\" % (index, domain)\n    fp.write(line+'\\n')\n    print line\n  fp.close()\ninit()\n\n## SHA256 hash of Sample under investigation : 856e486f338cbd8daed51932698f9cdc9c60f4558d22d963f5 6da7240490e465\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2014/2014-09-21 - Reversing Tinba- World's smallest trojan-banker DGA Code.pdf"
    ],
    "report_names": [
        "2014-09-21 - Reversing Tinba- World's smallest trojan-banker DGA Code.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535641,
    "ts_updated_at": 1743041168,
    "ts_creation_date": 1653701026,
    "ts_modification_date": 1653701026,
    "files": {
        "pdf": "https://archive.orkl.eu/1a27458ec17373b64305a4d53267f184e0eb244d.pdf",
        "text": "https://archive.orkl.eu/1a27458ec17373b64305a4d53267f184e0eb244d.txt",
        "img": "https://archive.orkl.eu/1a27458ec17373b64305a4d53267f184e0eb244d.jpg"
    }
}