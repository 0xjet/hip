{
    "id": "0929b33e-a837-46b7-9079-8b9b612380d7",
    "created_at": "2023-01-12T15:04:45.180627Z",
    "updated_at": "2025-03-27T02:05:38.25585Z",
    "deleted_at": null,
    "sha1_hash": "edc0001023982010eb55f66104a564340fc7aedb",
    "title": "2011-08-03 - HTran and the Advanced Persistent Threat",
    "authors": "",
    "file_creation_date": "2022-05-28T19:54:57Z",
    "file_modification_date": "2022-05-28T19:54:57Z",
    "file_size": 112705,
    "plain_text": "# HTran and the Advanced Persistent Threat\n\n**secureworks.com/research/htran**\n\nJoe Stewart\n\nWednesday, August 3, 2011 By: Joe Stewart\n\n**Author: Joe Stewart, Director of Malware Research, Dell SecureWorks Counter Threat Unit Research Team**\n**Date: August 3, 2011**\n\nWhile researching one of the malware families involved in the RSA breach disclosed in March 2011, Dell SecureWorks\nCTU observed an interesting pattern in the network traffic of a related sample\n(MD5:53ba6845f57f8e9ef600ef166be3be14). When the sample under analysis attempted to connect to the C2 server at\nmy.amazingrm.com (203.92.45.2), the server returned a succinct plain-text error message instead of the expected HTTPformatted response:\n```\n[SERVER]connection to funn\n\n```\nAlthough the message was seemingly truncated, this pattern was enough to correlate the error string to a known (and fairly\nold) program called \"HUC Packet Transmit Tool\", or \"HTran\", for which source code can be readily found on the Internet:\n\nhttp://read.pudn.com/downloads199/sourcecode/windows/935255/htran.cpp__.htm\n\nHTran is a rudimentary connection bouncer, designed to redirect TCP traffic destined for one host to an alternate host. The\nsource code copyright notice indicates that HTran was authored by \"lion\", a well-known Chinese hacker and member of\n\"HUC\", the [Honker Union of China. The purpose of this type of tool is to disguise either the true source or destination of](http://en.wikipedia.org/wiki/Honker_Union)\nInternet traffic in the course of hacking activity.\n\nHTran contains several debugging messages throughout the source code that are sent to the console or to the connecting\nclient in order to diagnose connection issues. The part of the HTran source code that generated the error message seen in\nthe trojan C2 response is shown below:\n```\nif(client_connect(sockfd2,host,port2)==0)\n{\nclosesocket(sockfd2);\nsprintf(buffer,\"[SERVER]connection to %s:%d error\\r\\n\", host, port2);\nsend(sockfd1,buffer,strlen(buffer),0);\n\n```\nThe code is written so that if the connection bouncer is unable to connect to the hidden destination in order to relay the\nincoming traffic, the formatted error message containing the target host and port parameters will be sent to the connecting\nclient. As long as there are no connection issues, HTran might be a useful tool to hide a trojan C2's true location - but, in\nthe case of any connection downtime between the HTran host and the hidden C2, HTran will betray the location of the\nhidden C2 host.\n\nInstances of HTran on multiple hosts could theoretically be chained together in order to add extra layers of obfuscation.\nHowever, in case of the final endpoint C2 being unavailable for any reason, the last link in the HTran chain will still pass its\nconnection failure message up the chain, rendering all of the other layers of obfuscation useless. This tiny bit of error\ndebugging code left in by the author can be quite useful if one wants to track HTran-bounced hacking activity to its source.\n\n## HTran Survey\n\nArmed with the knowledge of HTran's transient error message formatting, Dell SecureWorks CTU was able to locate TCP\npacket captures containing HTran connection errors in response to traffic from other APT-related malware that had been\npreviously executed in our sandnet. The following Snort signatures can be used by other organizations to search for HTran\nconnection error messages in transit on their networks:\n\n\n-----\n\n```\n     p y y ( g g ;\nflow:established,from_server; dsize:<80; content:\"|5b|SERVER|5d|connection|20|to|20|\"; depth:22; \nreference:url,www.secureworks.com/research/threats/htran/; sid:1111111111;) \nalert tcp $EXTERNAL_NET any -> $HOME_NET any (msg:\"HTran Connection Redirect Failure Message \n(Unicode)\"; flow:established,from_server; dsize:<160; content:\"|5b00|S|00|E|00|R|00|V|00|E|00|R|\n005d00|c|00|o|00|n|00|n|00|e|00|c|00|t|00|i|00|o|00|n|002000|t|00|o|002000|\"; depth:44; \nreference:url,www.secureworks.com/research/threats/htran/; sid:1111111112;)\n\n```\nIn addition to locating historical packet captures containing evidence of HTran connection failures, Dell SecureWorks CTU\nimplemented a scanning system which checks for the HTran error message in responses from active probing of more than\na thousand IP addresses known to be associated with APT trojan activity currently or in the past. The results of this survey\ncan be seen in the following table:\n\n\n**Malware C2 IP/Port**\n\n\n**Associated Hostnames** **Host-Related Malware Hashes** **Hidden Destination**\n**IP/Port**\n\n\n**12.38.236.41:443** **epod.businessconsults.net**\n**hapyy2010.lflinkup.net**\n**info.businessconsults.net**\n**pop.businessconsults.net**\n**ssa.businessconsults.net**\n**sys.businessconsults.net**\n\n**173.244.209.196:443** **bbs.india-videoer.com**\n**itiupdated.dyndns.info**\n**news.india-videoer.com**\n**www.india-videoer.com**\n\n\n**3493fc0e4a76b9d12b68afc46cab7f34**\n**fd4a4ac08f5a7271fbd9b8157d30244e**\n**51744d77fc8f874934d2715656e1a2df**\n\n**1daa3e392d1fea79badfbcd86d765d32**\n**855cea7939936e86016a0aedee1d2c24**\n\n\n**112.65.87.58:443**\n**58.247.25.108:443**\n\n**123.120.102.251:443**\n\n\n**204.45.228.140:80**\n**204.45.228.140:443**\n\n\n**create301.dyndns.info** **00b9619613bc82f5fe117c2ca394a328** **123.120.106.136:8080**\n**123.120.117.98:9000**\n**123.120.126.73:8080**\n**123.120.127.146:9000**\n\n\n**207.225.36.69:443** **leets.hugesoft.org**\n**rouji.freespirit.acmetoy.com**\n**slnoa.newsonet.net**\n**sos.businessconsults.net**\n**trb.arrowservice.net**\n**ug-aa.hugesoft.org**\n**www.optimizon.com**\n\n**212.125.200.197:443** **inter.earthsolution.org**\n**quick.earthsolution.org**\n\n\n**cca75af9786d7364866f40b80dddcc5c** **58.247.240.91:80**\n\n**3a3bf6cab9702d0835e8425f4e9d7a9c** **223.167.5.10:8000**\n**223.167.5.250:8000**\n**223.167.5.254:8000**\n\n\n-----\n\n**212.125.200.204:443** **bah001.blackcake.net**\n**caci2.infosupports.com**\n**doa.bigdepression.net**\n**lucy2.businessconsults.net**\n**lucy2.infosupports.com**\n**lucy.blackcake.net**\n**lucy.businessconsults.net**\n**mantech.blackcake.net**\n**news.businessconsults.net**\n**qiao1.bigdepression.net**\n**qiao2.bigdepression.net**\n**qiao3.bigdepression.net**\n**qiao4.bigdepression.net**\n**qiao5.bigdepression.net**\n**qiao6.bigdepression.net**\n**sports.businessconsults.net**\n**srs.infosupports.com**\n\n\n**03557c3e5c87e6a121c58f664b0ebf18**\n**8a873136b6e4dd70ff9470288ff99d93**\n**bbf4212f979c32eb6bc43bd8ba5996f9**\n\n\n**112.64.214.174:443**\n\n\n**220.110.70.51:443** **nsweb.hostent.org** **c9067c06bb9e8a5304b93687c59e4e15** **125.215.189.114:40781**\n\n\n**60.249.150.162:443** **argentinia.faqserv.com**\n**epaserver.toythieves.com**\n**mailserver.instanthq.com**\n**mailserver.sendsmtp.com**\n**moiserver.myftp.info**\n**mosfdns.ddns.ms**\n**office.lflink.com**\n**san.www1.biz**\n**seoulsummit.ddns.ms**\n**songs.longmusic.com**\n**sysinfo.mynumber.org**\n**timeforbeat.ns01.us**\n**www.cpear.ddns.us**\n**yahoo2.epac.to**\n\n**64.255.101.100** **aar.bigdepression.net**\n**conn.gxdet.com**\n**db.billten.net**\n**ddbb.gxdet.com**\n**info.billten.net**\n**info.dcfrr.com**\n**info.helpngr.net**\n**info.new-soho.com**\n**info.scitence.net**\n**mail.new-soho.com**\n**mailsrv.scitence.net**\n**news.billten.net**\n**news.scitence.net**\n**pop.dnsweb.org**\n**techniq.whandjg.net**\n**webmail.dcfrr.com**\n**webmail.whandjg.net**\n\n**68.96.31.136** **gee.safalife.com**\n**ghma.earthsolution.org**\n**hav.earthsolution.org**\n**java.earthsolution.org**\n**quiet.earthsolution.org**\n**special.earthsolution.org**\n**visual.earthsolution.org**\n**vop.earthsolution.org**\n**vope.purpledaily.com**\n\n\n**056310138cb5ed295f0df17ac591173d**\n**45a66ae3537488f7d63622ded64461e0**\n**92e28cec1c82f5d82cbd80c64050c5ca**\n**ec4d34c742d2d5714c600517f05c2253**\n\n**3a3bf6cab9702d0835e8425f4e9d7a9c**\n**7cb055ac3acbf53e07e20b65ec9126a1**\n\n\n**121.229.201.158:10009**\n**121.229.201.238:10009**\n\n**112.64.213.249:443**\n\n**223.167.5.10:8000**\n\n\n-----\n\n**72.167.34.54:443** **catalog.earthsolution.org**\n**ou2.infosupports.com**\n**ou3.infosupports.com**\n**ou7.infosupports.com**\n**www2.wikaba.com**\n**yang1.infosupports.com**\n**yang2.infosupports.com**\n\n\n**47a76cf2e60960405a492bc7f41b0483** **58.247.27.232:443**\n\n\n_HTran Survey Results_\nThe hostnames in the table were gathered using passive DNS records showing that at one point in time they pointed to the\nIP address in question. The hostnames may currently be pointed at different IP addresses than shown, as they are rotated\nfrequently. The domains involved are all known to be connected to a variety of different Advanced Persistent Threat (APT)\ntrojans. In cases where a related sample has been analyzed by Dell SecureWorks CTU, the MD5 hash of the sample is\nprovided.\n\nThe survey of HTran traffic shows a clear pattern that can be seen by analyzing the Autonomous System Number (ASN)\nowner of each hidden IP address:\n```\n17621 | 112.64.213.249 | CNCGROUP-SH China Unicom Shanghai network\n17621 | 112.64.214.174 | CNCGROUP-SH China Unicom Shanghai network\n17621 | 112.65.87.58  | CNCGROUP-SH China Unicom Shanghai network\n4134  | 121.229.201.158 | CHINANET-BACKBONE No.31,Jin-rong Street\n4134  | 121.229.201.238 | CHINANET-BACKBONE No.31,Jin-rong Street\n4808  | 123.120.106.136 | CHINA169-BJ CNCGROUP IP network China169 Beijing Province Network\n4808  | 123.120.117.98 | CHINA169-BJ CNCGROUP IP network China169 Beijing Province Network\n4808  | 123.120.126.73 | CHINA169-BJ CNCGROUP IP network China169 Beijing Province Network\n4808  | 123.120.127.146 | CHINA169-BJ CNCGROUP IP network China169 Beijing Province Network\n4515  | 125.215.189.114 | ERX-STAR PCCW IMSBiz\n60055 | 223.167.5.10  | CNCGROUP-SH China Unicom Shanghai network\n60055 | 223.167.5.250  | CNCGROUP-SH China Unicom Shanghai network\n60055 | 223.167.5.254  | CNCGROUP-SH China Unicom Shanghai network\n17621 | 58.247.240.91  | CNCGROUP-SH China Unicom Shanghai network\n17621 | 58.247.25.108  | CNCGROUP-SH China Unicom Shanghai network\n17621 | 58.247.27.232  | CNCGROUP-SH China Unicom Shanghai network\n\n```\nEvery hidden IP address observed in the HTran error messages captured during our survey is located on just a few\ndifferent networks in the People's Republic of China (PRC). In almost every case, the observable C2 is in a different\ncountry, most likely the same country in which the victim institution is located.\n\nIt's not surprising that hackers using a Chinese hacking tool might be operating from IP addresses in the PRC. Most of the\nChinese destination IPs belong to large ISPs, making further attribution of the hacking activity difficult or impossible without\nthe cooperation of the PRC government\n\n\n-----\n\n## Conclusion\n\nOver the past ten years, we have seen dozens of families of trojans that have been implicated in the theft of documents,\nemail and computer source code from governments, industry and activists. Typically when hacking or malware traffic is\nreported on the Internet, the location of the source IP is not a reliable indicator of the true origin of the activity, due to the\nwide variety of programs designed to tunnel IP traffic through other computers. However, occasionally we get a chance to\npeek behind the curtain, either by advanced analysis of the traffic and/or its contents, or due to simple programmer/user\nerror. This is one of those cases where we were lucky enough to observe a transient event that showed a deliberate\nattempt to hide the true origin of an APT. This particular hole in the operational security of a certain group of APT actors\nmay soon be closed, however it is impossible for them to erase the evidence gathered before that time. It is our hope that\nevery institution potentially impacted by APT activity will make haste to search out signs of this activity for themselves\nbefore the window of opportunity closes.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2011/2011-08-03 - HTran and the Advanced Persistent Threat.pdf"
    ],
    "report_names": [
        "2011-08-03 - HTran and the Advanced Persistent Threat.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535885,
    "ts_updated_at": 1743041138,
    "ts_creation_date": 1653767697,
    "ts_modification_date": 1653767697,
    "files": {
        "pdf": "https://archive.orkl.eu/edc0001023982010eb55f66104a564340fc7aedb.pdf",
        "text": "https://archive.orkl.eu/edc0001023982010eb55f66104a564340fc7aedb.txt",
        "img": "https://archive.orkl.eu/edc0001023982010eb55f66104a564340fc7aedb.jpg"
    }
}