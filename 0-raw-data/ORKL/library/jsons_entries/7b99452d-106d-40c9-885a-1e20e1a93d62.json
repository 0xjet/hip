{
    "id": "7b99452d-106d-40c9-885a-1e20e1a93d62",
    "created_at": "2023-01-12T15:04:36.654911Z",
    "updated_at": "2025-03-27T02:05:18.427282Z",
    "deleted_at": null,
    "sha1_hash": "3dafeb02a302c41c1ad3bd7915892fc51fe8f48b",
    "title": "2020-12-15 - Malware Analysis Spotlight – Hentai Oniichan Ransomware (Berserker Variant)",
    "authors": "",
    "file_creation_date": "2022-05-28T22:09:55Z",
    "file_modification_date": "2022-05-28T22:09:55Z",
    "file_size": 1164072,
    "plain_text": "# Malware Analysis Spotlight – Hentai Oniichan Ransomware (Berserker Variant)\n\n**[vmray.com/cyber-security-blog/hentai-oniichan-ransomware-berserker-malware-analysis-spotlight/](https://www.vmray.com/cyber-security-blog/hentai-oniichan-ransomware-berserker-malware-analysis-spotlight/)**\n\nIn this [Malware Analysis Spotlight, we analyze the Berserker variant of Hentai Oniichan](https://www.vmray.com/cyber-security-blog/tag/malware-analysis-spotlight/)\nRansomware.\n\nWe’ve observed at least two different variants of Hentai Oniichan Ransomware in-the-wild,\n[King Engine, and Berserker. What we found interesting in our analysis of the Berserker](https://cofense.com/coronavirus-test-results-return-data-exfiltrating-ransomware/)\nvariant is its attempts to make recovery difficult by deleting backup files, uncommon with\ntraditional ransomware.\n\n[View the VMRay Analyzer Report for Hentai Oniichan Ransomware (Berserker Variant)](https://www.vmray.com/analyses/hentai-oniichan-ransomware-berserker/report/overview.html)\n\n## Hentai Oniichan Ransomware (Berserker Variant) Analysis\n\nAs a first step, Berserker injects code into a newly created process of the sample.\n\nInitially, Berserker starts enumerating running processes in an attempt to terminate all\nprocesses that match its internal list (Figure 1, Appendix).\n\n\n-----\n\n_Figure 1: The decompiled function that terminates processes in the blocked list._\n\nAfter it finishes with process enumeration, Berserker tries to shutdown services responsible\nfor backups (see Appendix for a complete list), monitoring, or anything that could prevent it\nfrom encrypting files (Figure 2).\n\n\n-----\n\n_Figure 2: VMRay Analyzer Function Log – Berserker attempts to stop running services_\n_including “Acronis” and “Antivirus”._\n\nBerserker executes multiple Powershell commands during its execution. To make sure this is\npossible it tries to adjust certain settings and preferences (Figure 3). Following that, it also\nadjusts preferences for Windows Defender like disabling real-time monitoring and behavior\nmonitoring.\n\n\n-----\n\nThe ransomware transmits the user name, computer name, and client key to an external\nserver by sending an email. It uses Powershell to construct and send it via Gmail’s SMTP\nserver, whereby the script contains the plain login credentials (Figure 4.1 & 4.2).\n\n_Figure 4.2: View of traffic in VMRay Analyzer’s Network Tab._\n\nBerserker makes recovery more difficult by deleting backup files. Usually, ransomware\ntargets the recovery feature provided by Microsoft Windows. They disable the recovery\nmode, delete shadow copies, and the backup catalog.\n\nWhile most ransomware stops at this point, Berserker goes the extra length by attempting to\ndelete potential backup and disk image files. It searches for the extensions `.vhd, .bac,`\n```\n.bak, .wbcat, .bkf, .set, .win, .dsk and for files within directories called “Backup”\n\n```\nor “backup” in the root directory of the filesystem (Figure 5). Typically, ransomware encrypts\nbackups and doesn’t remove them, except for Shadow Copies. By removing the backups\n\n\n-----\n\ninstead of encrypting the Berserker is potentially faster but carries the risk of deleting\nsomething they can’t restore. In the case of virtual disk files used as additional data storage\nand not for backups, the data is lost.\n\n[Recently, we have seen another approach used by RegretLocker which also targets virtual](https://www.bleepingcomputer.com/news/security/new-regretlocker-ransomware-targets-windows-virtual-machines/)\ndisk image files. Instead of deleting them, the RegretLocker ransomware mounts the image\nfiles and encrypts the data inside.\n\n_Figure 5: Additional deleting of backups by extensions and directories._\n\n**Cyber Security Side-Note**\n\nSince ransomware targets files used for backups, it is advisable to not host those files on\nthe same system that is being backed-up.\n\nIdeally, the storage is only temporarily accessible and further protected so that\nransomware can not access those with ease.\n\n### Encryption\n\nBerserker is written in C++ and is statically compiled against the library Crypto++.\n\nFor the encryption, Berserker iterates over the whole hard drive using depth-first search. It\nuses block-lists as a filtering mechanism. If a folder name or file extension is on its internal\nblock-lists (see Appendix for a complete list) the file or directory is skipped. If the file is not on\nthe list it is encrypted later on and gets the extension .HOR.\n\nThe ransomware also doesn’t forget to deliver its ransom note. It drops two types of notes:\none that is dropped on the desktop warning the user to not kill the running process (Figure\n6).\n\nThe second ransom note is used as a replacement for the desktop wallpaper where the\nactual ransom demand and contact information is written (Figure 7).\n\n\n-----\n\n_Figure 6: Content of Warning.html displayed in a web browser._\n\n_Figure 7: Ransom note displayed as desktop wallpaper_\n\n\n-----\n\n### Conclusion\n\nIn contrast to most ransomware, Berserker targets additional files and directories to make\nrecovery more complicated. To do so, it heavily relies on Powershell and cmd. For example,\nWindows Defender mitigation, recovery feature, and email transmissions are handled by\nusing Powershell.\n\nFurthermore, we have found several log messages referenced in the code and during the\ndynamic analysis, the sample creates empty log files. This could indicate that the malware is\nstill under development.\n\n[With VMRay’s unique dynamic analysis technology and the intelligent monitoring system at](https://www.vmray.com/cyber-security-blog/intelligent-monitoring-technology/)\nthe hypervisor layer, malware analysts can quickly and reliably reconstruct the big picture of\nthe malware’s behavior regardless of the complexity of the threat or its behavior.\n\n### IOCs\n\n**Sample**\n```\n4444458bf47925c82431843fd147aabbfbee71ca849fc711cb69b0cea01f4747\n\n### Appendix\n\n```\n**Names compared against running processes**\n\n\n-----\n\n```\nantidebug_antivm_index.yar\nautoruns.exe\nautorunsc.exe\ncrypto_index.yar\ndumpcap.exe\nexploit_kits_index.yar\nFiddler.exe\nfilemon.exe\nHipsDaemon.exe\nHipsMain.exe\nHipsTray.exe\nHookExplorer.exe\nhttpdebugger.exe\nidaq.exe\nidaq64.exe\nImmunityDebugger.exe\nImportREC.exe\ninVtero.ps1\ninVteroPS.ps1\ninVteroPS.psm1\njoeboxcontrol.exe\njoeboxserver.exe\nkscan.exe\nkwsprotect64.exe\nkxescore.exe\nkxetray.exe\nLordPE.exe\nmalware_index.yar\nollydbg.exe\npackers_index.yar\nPETools.exe\nproc_analyzer.exe\nProcessHacker.exe\nprocexp.exe\nprocmon.exe\npy.exe\npython.exe\nQMDL.exe\nQMPersonalCenter.exe\nQQPCPatch.exe\nQQPCRealTimeSpeedup.exe\nQQPCRTP.exe\nQQPCTray.exe\nQQRepair.exe\nregmon.exe\nResourceHacker.exe\nsniff_hit.exe\nsysAnalyzer.exe\nSysInspector.exe\ntcpview.exe\nwindbg.exe\nWireshark.exe\nx32dbg.exe\nx64dbg.exe\n\n```\n\n-----\n\n**List of Disabled Services**\n\n\n-----\n\n```\nAcronis VSS Provider\nAcronisAgent\nAcrSch2Svc\nAntivirus\nARSM\nAVP\nBackupExecAgentAccelerator\nBackupExecAgentBrowser\nBackupExecDeviceMediaService\nBackupExecJobEngine\nBackupExecManagementService\nBackupExecRPCService\nBackupExecVSSProvider\nbedbg\nccEvtMgr\nccSetMgr\nCulserver\ndbeng8\ndbsrv12\nDCAgent\nDefWatch\nEhttpSrv\nekrn\nEnterprise Client Service\nEPSecurityService\nEPUpdateService\nEraserSvc11710\nEsgShKernel\nESHASRV\nFA_Scheduler\nIISAdmin\nIMAP4Svc\nKAVFSGT\nkavfsslp\nklnagent\nmacmnsvc\nmasvc\nMBAMService\nMBEndpointAgent\nMcAfeeEngineService\nMcAfeeFrameworkMcAfeeFramework\nMcShield\nMcTaskManager\nmfefire\nmfemms\nmfevtp\nMMS\nmozyprobackup\nMsDtsServer100\nMsDtsServer110\nMSExchangeES\nMSExchangeIS\nMSExchangeMGMT\nMSExchangeMTA\nMSExchangeSA\n\n```\n\n-----\n\n```\nMSExchangeSRS\nmsftesql$PROD\nmsmdsrv\nMSOLAP$SQL_2008\nMSOLAP$SYSTEM_BGC\nMSOLAP$TPSAMA\nMSSQL$BKUPEXEC\nMSSQL$ECWDB2\nMSSQL$PRACTICEMGT\nMSSQL$PRACTTICEBGC\nMSSQL$PROD\nMSSQL$PROFXENGAGEMENT\nMSSQL$SBSMONITORING\nMSSQL$SHAREPOINT\nMSSQL$SOPHOS\nMSSQL$SQL_2008\nMSSQL$SQLEXPRESS\nMSSQL$SYSTEM_BGC\nMSSQL$TPSAMA\nMSSQL$VEEAMSQL2008R2\nMSSQL$VEEAMSQL2012\nMSSQLFDLauncher$PROFXENGAGEMENT\nMSSQLFDLauncher$SBSMONITORING\nMSSQLFDLauncher$SHAREPOINT\nMSSQLFDLauncher$SQL_2008\nMSSQLFDLauncher$SYSTEM_BGC\nMSSQLFDLauncher$TPSAMA\nMSSQLSERVER\nMSSQLServerADHelper100\nMSSQLServerOLAPService\nMySQL57\nMySQL80\nNetMsmqActivator\nntrtscan\nOracleClientCache80\nPDVFSService\nPOP3Svc\nQBCFMonitorService\nQBIDPService\nQuickBoooks.FCS\nReportServer$SQL_2008\nReportServer$SYSTEM_BGC\nReportServer$TPSAMA\nRESvc\nRTVscan\nSAVAdminService\nSavRoam\nSAVService\nSepMasterService\nShMonitor\nSmcinst\nSmcService\nSMTPSvc\nSNAC\nSntpService\n\n```\n\n-----\n\n```\nSophos Agent\nSophos AutoUpdate Service\nSophos Clean Service\nSophos Device Control Service\nSophos File Scanner Service\nSophos Health Service\nSophos MCS Agent\nSophos MCS Client\nSophos Message Router\nSophos Safestore Service\nSophos System Protection Service\nSophos Web Control Service\nsophossps\nSQL Backups\nsqladhlp\nSQLADHLP\nsqlagent\nSQLAgent$BKUPEXEC\nSQLAgent$CITRIX_METAFRAME\nSQLAgent$CXDB\nSQLAgent$ECWDB2\nSQLAgent$PRACTTICEBGC\nSQLAgent$PRACTTICEMGT\nSQLAgent$PROD\nSQLAgent$PROFXENGAGEMENT\nSQLAgent$SBSMONITORING\nSQLAgent$SHAREPOINT\nSQLAgent$SOPHOS\nSQLAgent$SQL_2008\nSQLAgent$SQLEXPRESS\nSQLAgent$SYSTEM_BGC\nSQLAgent$TPSAMA\nSQLAgent$VEEAMSQL2008R2\nSQLAgent$VEEAMSQL2012\nsqlbrowser\nSQLBrowser\nSQLsafe Backup Service\nSQLsafe Filter Service\nSQLSafeOLRService\nsqlserv\nSQLSERVERAGENT\nSQLTELEMETRY$ECWDB2\nsqlwriter\nSQLWriter\nsvcGenericHost\nswi_filter\nswi_service\nswi_update_64\nSymantec System Recovery\nTmCCSF\ntmlisten\ntomcat6\nTrueKeyScheduler\nTrueKeyServiceHelper\nUI0Detect\n\n```\n\n-----\n\n```\nVeeam Backup Catalog Data Service\nVeeamBackupSvc\nVeeamBrokerSvc\nVeeamCatalogSvc\nVeeamCloudSvc\nVeeamDeploymentService\nVeeamDeploySvc\nVeeamEnterpriseManagerSvc\nVeeamHvIntegrationSvc\nVeeamMountSvc\nVeeamNFSSvc\nVeeamRESTSvc\nVeeamTransportSvc\nvmware-converter\nvmware-usbarbitator64\nW3Svc\nwrapper\nWRSVC\n\n```\n**List of Ignored Extensions**\n```\n.bak\n.bin\n.c\n.cpp\n.ps1\n.hpp\n.cmd\n.com\n.dat\n.DAT\n.db\n.dll\n.exe\n.h\n.inf\n.ini\n.ink\n.js\n.lib\n.lnk\n.sys\n.vbs\n.ws\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-12-15 - Malware Analysis Spotlight – Hentai Oniichan Ransomware (Berserker Variant).pdf"
    ],
    "report_names": [
        "2020-12-15 - Malware Analysis Spotlight – Hentai Oniichan Ransomware (Berserker Variant).pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535876,
    "ts_updated_at": 1743041118,
    "ts_creation_date": 1653775795,
    "ts_modification_date": 1653775795,
    "files": {
        "pdf": "https://archive.orkl.eu/3dafeb02a302c41c1ad3bd7915892fc51fe8f48b.pdf",
        "text": "https://archive.orkl.eu/3dafeb02a302c41c1ad3bd7915892fc51fe8f48b.txt",
        "img": "https://archive.orkl.eu/3dafeb02a302c41c1ad3bd7915892fc51fe8f48b.jpg"
    }
}