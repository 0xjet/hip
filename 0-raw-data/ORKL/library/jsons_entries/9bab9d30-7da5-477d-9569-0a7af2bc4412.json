{
    "id": "9bab9d30-7da5-477d-9569-0a7af2bc4412",
    "created_at": "2023-01-12T14:59:50.77569Z",
    "updated_at": "2025-03-27T02:15:39.242739Z",
    "deleted_at": null,
    "sha1_hash": "69114d82c56eb23a2a2d12ce34362b92b5ed27f1",
    "title": "2019-03-28 - Unleash The Hash - ShadowHammer MAC Address List",
    "authors": "",
    "file_creation_date": "2022-05-27T23:03:14Z",
    "file_modification_date": "2022-05-27T23:03:14Z",
    "file_size": 256285,
    "plain_text": "# Unleash The Hash\n\n**[skylightcyber.com/2019/03/28/unleash-the-hash-shadowhammer-mac-list/](https://skylightcyber.com/2019/03/28/unleash-the-hash-shadowhammer-mac-list/)**\n\nTL;DR: The latest list of plain-text MAC addresses targeted in the ShadowHammer ASUS\n[breach can be downloaded here.](https://skylightcyber.com/2019/03/28/unleash-the-hash-shadowhammer-mac-list/list.txt)\n\n[You can find the extended list containing more complete information here.](https://skylightcyber.com/2019/03/28/unleash-the-hash-shadowhammer-mac-list/extended_list.txt)\n\nLast Updated: 30/Mar/2019\n\n[You have probably heard of the ShadowHammer hack by now.](https://securelist.com/operation-shadowhammer/89992/)\nA truly disturbing case that shows yet again, that nothing can be 100% trusted, not even a\nformally signed update from a well known vendor.\n\nAccording to available information, the threat actors have infected computers en-masse, but\nhave targeted specific machines based on their MAC address.\n\nThe question of who did this and why is intriguing, but not one we were trying to answer in\nthis case.\n\nFirst thing’s first - if information regarding targets exists, it should be made publicly available\nto the security community so we can better protect ourselves.\n\n[Kaspersky have released an online tool that allows you to check your MAC address against](https://shadowhammer.kaspersky.com/)\na DB of victim MAC addresses (which is hidden).\n\nGood on Kaspersky on one hand, but on the other hand, this is highly inefficient, and does\nnot really serve the security community.\n\nSo, we thought it would be a good idea to extract the list and make it public so that every\nsecurity practitioner would be able to bulk compare them to known machines in their domain.\n\n[If you are interested in the list it can be downloaded here or](https://skylightcyber.com/2019/03/28/unleash-the-hash-shadowhammer-mac-list/list.txt) [here for the extended list.](https://skylightcyber.com/2019/03/28/unleash-the-hash-shadowhammer-mac-list/extended_list.txt)\n\n\n-----\n\nIf you are interested in learning how we extracted it, read on, it was a short yet sweet ride,\nkind of like the CTFs we love so much, and thank you Kaspersky for the challenge!\n\n## Phase I - getting the bulk list in binary format\n\nIn conjunction with the website, Kaspersky have released an executable that checks if your\nmachine has been targeted. Naturally, since it is an offline tool, it means that the full list of\nMAC addresses has to be contained within that executable.\n\nSo, up goes IDA and we go hunting for the MAC list.\n\nBefore even taking a look at the disassembled code, we can hypothesize how such a tool\nmight work:\n\nExtract local MAC addresses\nCalculate hashes for those addresses\nCompare the local list with addresses that are embedded in the executable\n\nA quick look at the disassembly shows that the entire logic of the program was written inside\nWinMain() (classic security researcher coding style…).\n\nSure enough, the program follows the expected steps.\n\nWe can see that the first thing the tool does is extract the local MAC addresses and hash\nthem.\n\nFollowing that, we can immediately recognize two sets of nested loops, and further analysis\nreveals that there are actually two different lists the tool compares the hashes of the local\nMAC addresses to.\n\nFinding the two lists is straightforward, and the total weight of the hashes is 19936 bytes.\n\n## Phase II - what the hash?!\n\nSo now that we have the list, and knowing that the threat actors used MD5 hashes, we have\nto brute force these MD5s, which should be pretty straightforward.\nHowever, something doesn’t seem right from the get go.\n\nMD5 hashes are 16 bytes (128 bit) long, but dividing the list of hashes by 16 yields 1246,\nwhich doesn’t make sense as we know from publications that there should be around 600\naddresses.\nMoreover, the hash comparison loops seems to work in 32 bytes increments, suggesting a\ndifferent hashing algorithm than MD5.\nWe need to dig deeper…\n\nLooking at the hashing routine, we find this:\n\n\n-----\n\nhashing routine constants\n\nFor people involved with cryptography, these constants are an instant tell-tale sign of SHA2256. SHA256’s hash size is 32 bytes long, matching the comparison routine.\n\nWe don’t consider disassembling crypto code as a fun afternoon activity, and so we’ve opted\nto try the short path first. Let’s hash one of the few known target MAC addresses with SHA2256 and see if we get a hit. Nothing in life is easy, especially not crypto, so of course, the\napproach failed, and we did not get a hit.\n\nLittle did we know that these are not vanilla SHA256 hashes at all.\n\n## Phase III - Who are you Mr. hash?\n\nReluctantly, we had to dig deeper into the hashing routine.\n\nFollowing a reference implementation of SHA256 and the disassembly, we’ve noticed that\nthe code calls SHA256_Transform (the inner function that performs transformations on the\ninner algorithm state) with a constant that seems to be four bytes long.\n\n\n-----\n\nDisassembly of hashing routine\n\nWell, “That must be it!”, they’ve salted the hash, we figured. But why would they do that? Are\nthey trying to hide those MAC addresses?\n\nAnyway, we’ve tried the blackbox approach using known target MAC address hashed with\nthe discovered salt (0xad, 0x12, 0xf4, 0x19) to see if we get a match, but it failed again.\n\n\n-----\n\nDynamically analyzing calls to the SHA256_Transform function demonstrated that the hash\nis actually calculated on repeated sequences of the salt + MAC address.\n\nsalt (0xad,0x12,0xf4,0x19)\n\nfollowed by 70:8B:CD:10:43:18\nRevisiting the disassembled code, we can spot a constant (10,000) being used to break a\nloop. Could they be running the hashing algorithm 10,000 times with the salt?\nLet’s have a go with the following code and test it:\n```\n $salt = \"\\xad\\x12\\xf4\\x19\"; \n $mac = \"\\x70\\x8b\\xcd\\x10\\x43\\x18\"; // 70:8B:CD:10:43:18 (one of the few MD5s that\nwere published and we brute-forced)\n $ctx = hash_init(\"sha256\");\n for($i=0;$i<10000;$i++)\n   hash_update($ctx, \"$salt$mac\");\n print hash_final($ctx);\n\n```\nWhich yields “cde5d9a781e56f37351be146a4389a975a9838f0fe13710f3501202e8ca2fb7a”.\nThis hash is part of the list of hashes embedded in Kaspersky’s executable. Yes! This is\ndefinitive proof!\nNow that we have the hashing algorithm we can start brute-forcing.\n\n## Phase IV - We’re going to need a bigger cat\n\nYou can write your own code to brute-force hashes, but there is a lot of know-how involved in\nmaking the most use out of your Hardware.\n\nFor us, [Hashcat was an obvious choice, given that it’s an open-source and flexible tool.](https://hashcat.net/hashcat/)\n\nWe tried stretching Hashcat’s features to their fullest, but couldn’t find a way to use the\nalgorithm we saw in Kaspersky’s code ( If you know of a method, please share in the\ncomments).\n\nAfter a sigh that was heard throughout the continent, we set about to modify Hashcat to\nsupport the new scheme. Trying to compile & build most open-source cross-platform projects\non Windows is a pain and Hashcat is no different, so we’ve switched to our Linux box.\n\nActually, it was surprisingly easy to enhance Hashcat and all we had to do is add two lines of\ncode inside the OpenCL implementation of SHA2-256 (Hashcat algorithm #01400), as\nfollows:\n\n\n-----\n\nHashcat code modification\nAnd with that we were good to go.\n\n## Phase V - She’s not gonna hold, Captain!\n\nTrying to brute-force the entire space of MAC addresses, hashed using SHA256 on the\nrepeated salt+MAC is not feasible in a reasonable amount of time and resources.\n\nTherefore, we had to reduce the address space.\n\nA MAC address is comprised of the prefix (3 bytes) and a suffix (3 bytes). Prefixes are\nallocated to vendors.\n\nWe used a couple of different strategies to limit the prefixes we were targeting:\n\nLimit to only known, assigned MAC address prefixes.\nReduce further by following information released by other security vendors: 360 Threat\n[Intelligence Center tweeted a nice infographic detailing the distribution of vendors of](https://twitter.com/360TIC/status/1110797967621914625)\ntargeted MAC addresses. We could use that list to limit the prefixes we were bruteforcing.\nLimit to prefixes assigned to AsusTek.\n\n\n-----\n\nEven with all of those strategies in place, brute forcing a single prefix was going to take us ~3\nhours on our modest hardware. With a narrowed down list of around 1300 prefixes, that\nmeant 162.5 days, a tad bit more than we would have liked.\n\n## Phase VI - victory\n\nWith that in mind, we realized that to do brute-forcing you need a brute!\n\nEnter Amazon’s AWS p3.16xlarge instance.\n\nThese beasts carry eight (you read correctly) of NVIDIA’s V100 Tesla 16GB GPUs.\n\nAs Al Pacino once said - “Say hello to my little friend!” :)\n\nThe entire set of 1300 prefixes was brute-forced in less than an hour.\n\nSo far, we’ve managed to extract 583 out of 619 hashes, others probably have different\nvendors associated with them.\n\nIf you’ve found a MAC address that is not on our list, please contact us and we’ll update\naccordingly (or share in the comments section).\n\nThanks again Kaspersky for an enjoyable afternoon!\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-03-28 - Unleash The Hash - ShadowHammer MAC Address List.pdf"
    ],
    "report_names": [
        "2019-03-28 - Unleash The Hash - ShadowHammer MAC Address List.pdf"
    ],
    "threat_actors": [
        {
            "id": "1c97ccfd-1888-492c-b7b9-bb52c4c3809b",
            "created_at": "2023-01-06T13:46:38.940529Z",
            "updated_at": "2025-03-27T02:00:02.957652Z",
            "deleted_at": null,
            "main_name": "Operation ShadowHammer",
            "aliases": [],
            "source_name": "MISPGALAXY:Operation ShadowHammer",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "ee3363a4-e807-4f95-97d8-b603c31b9de1",
            "created_at": "2023-01-06T13:46:38.485884Z",
            "updated_at": "2025-03-27T02:00:02.845851Z",
            "deleted_at": null,
            "main_name": "FIN6",
            "aliases": [
                "Camouflage Tempest",
                "MageCart Group 6",
                "G0037",
                "TA4557",
                "SKELETON SPIDER",
                "ITG08",
                "White Giant",
                "GOLD FRANKLIN",
                "ATK88"
            ],
            "source_name": "MISPGALAXY:FIN6",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "12517c87-040a-4627-a3df-86ca95e5c13f",
            "created_at": "2022-10-25T16:07:23.61665Z",
            "updated_at": "2025-03-27T02:02:09.889471Z",
            "deleted_at": null,
            "main_name": "FIN6",
            "aliases": [
                "ATK 88",
                "Camouflage Tempest",
                "FIN6",
                "Gold Franklin",
                "ITG08",
                "Skeleton Spider",
                "TAAL",
                "TAG-CR2",
                "White Giant"
            ],
            "source_name": "ETDA:FIN6",
            "tools": [
                "AbaddonPOS",
                "Agentemis",
                "AmmyyRAT",
                "Anchor_DNS",
                "BlackPOS",
                "CmdSQL",
                "Cobalt Strike",
                "CobaltStrike",
                "FlawedAmmyy",
                "FrameworkPOS",
                "Grateful POS",
                "JSPSPY",
                "Kaptoxa",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "LockerGoga",
                "MMon",
                "Magecart",
                "Meterpreter",
                "Mimikatz",
                "More_eggs",
                "NeverQuest",
                "POSWDS",
                "Reedum",
                "Ryuk",
                "SCRAPMINT",
                "SONE",
                "SpicyOmelette",
                "StealerOne",
                "Taurus Loader Stealer Module",
                "Terra Loader",
                "TerraStealer",
                "Vawtrak",
                "WCE",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "cobeacon",
                "grabnew"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "ea7bfe06-7c23-481d-b8ba-eafa6cda3bc9",
            "created_at": "2022-10-25T15:50:23.317961Z",
            "updated_at": "2025-03-27T02:00:55.440858Z",
            "deleted_at": null,
            "main_name": "FIN6",
            "aliases": [
                "FIN6",
                "Magecart Group 6",
                "ITG08",
                "Skeleton Spider",
                "TAAL",
                "Camouflage Tempest"
            ],
            "source_name": "MITRE:FIN6",
            "tools": [
                "FlawedAmmyy",
                "GrimAgent",
                "FrameworkPOS",
                "More_eggs",
                "Cobalt Strike",
                "Windows Credential Editor",
                "AdFind",
                "PsExec",
                "LockerGoga",
                "Ryuk",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "c7d9878a-e691-4c6f-81ae-84fb115a1345",
            "created_at": "2022-10-25T16:07:23.359506Z",
            "updated_at": "2025-03-27T02:02:09.752427Z",
            "deleted_at": null,
            "main_name": "APT 41",
            "aliases": [
                "BrazenBamboo",
                "Bronze Atlas",
                "Double Dragon",
                "Earth Baku",
                "Grayfly",
                "Operation ColunmTK",
                "Operation CuckooBees",
                "Operation ShadowHammer",
                "Red Kelpie",
                "SparklingGoblin",
                "TA415",
                "TG-2633"
            ],
            "source_name": "ETDA:APT 41",
            "tools": [
                "9002 RAT",
                "ADORE.XSEC",
                "ASPXSpy",
                "ASPXTool",
                "AceHash",
                "Agent.dhwf",
                "Agentemis",
                "AndroidControl",
                "AngryRebel",
                "AntSword",
                "BIOPASS",
                "BIOPASS RAT",
                "BLUEBEAM",
                "Barlaiy",
                "BlackCoffee",
                "Bladabindi",
                "BleDoor",
                "CCleaner Backdoor",
                "CHINACHOPPER",
                "COLDJAVA",
                "China Chopper",
                "ChyNode",
                "Cobalt Strike",
                "CobaltStrike",
                "Crackshot",
                "CrossWalk",
                "CurveLast",
                "CurveLoad",
                "DAYJOB",
                "DBoxAgent",
                "DEADEYE",
                "DEADEYE.APPEND",
                "DEADEYE.EMBED",
                "DEPLOYLOG",
                "DIRTCLEANER",
                "DUSTTRAP",
                "Derusbi",
                "Destroy RAT",
                "DestroyRAT",
                "DodgeBox",
                "DragonEgg",
                "ELFSHELF",
                "EasyNight",
                "Farfli",
                "FunnySwitch",
                "Gh0st RAT",
                "Ghost RAT",
                "HDD Rootkit",
                "HDRoot",
                "HKDOOR",
                "HOMEUNIX",
                "HUI Loader",
                "HidraQ",
                "HighNoon",
                "HighNote",
                "Homux",
                "Hydraq",
                "Jorik",
                "Jumpall",
                "KEYPLUG",
                "Kaba",
                "Korplug",
                "LATELUNCH",
                "LOLBAS",
                "LOLBins",
                "LightSpy",
                "Living off the Land",
                "Lowkey",
                "McRAT",
                "MdmBot",
                "MessageTap",
                "Meterpreter",
                "Mimikatz",
                "MoonBounce",
                "MoonWalk",
                "Motnug",
                "Moudour",
                "Mydoor",
                "NTDSDump",
                "PACMAN",
                "PCRat",
                "PINEGROVE",
                "PNGRAT",
                "POISONPLUG",
                "POISONPLUG.SHADOW",
                "POTROAST",
                "PRIVATELOG",
                "PipeMon",
                "PlugX",
                "PortReuse",
                "ProxIP",
                "ROCKBOOT",
                "RbDoor",
                "RedDelta",
                "RedXOR",
                "RibDoor",
                "Roarur",
                "RouterGod",
                "SAGEHIRE",
                "SPARKLOG",
                "SQLULDR2",
                "STASHLOG",
                "SWEETCANDLE",
                "ScrambleCross",
                "Sensocode",
                "SerialVlogger",
                "ShadowHammer",
                "ShadowPad Winnti",
                "SinoChopper",
                "Skip-2.0",
                "SneakCross",
                "Sogu",
                "Speculoos",
                "Spyder",
                "StealthReacher",
                "StealthVector",
                "TERA",
                "TIDYELF",
                "TIGERPLUG",
                "TOMMYGUN",
                "TVT",
                "Thoper",
                "Voldemort",
                "WIDETONE",
                "WINNKIT",
                "WINTERLOVE",
                "Winnti",
                "WyrmSpy",
                "X-Door",
                "XDOOR",
                "XMRig",
                "XShellGhost",
                "Xamtrav",
                "ZXShell",
                "ZoxPNG",
                "certutil",
                "certutil.exe",
                "cobeacon",
                "gresim",
                "njRAT",
                "pwdump",
                "xDll"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535590,
    "ts_updated_at": 1743041739,
    "ts_creation_date": 1653692594,
    "ts_modification_date": 1653692594,
    "files": {
        "pdf": "https://archive.orkl.eu/69114d82c56eb23a2a2d12ce34362b92b5ed27f1.pdf",
        "text": "https://archive.orkl.eu/69114d82c56eb23a2a2d12ce34362b92b5ed27f1.txt",
        "img": "https://archive.orkl.eu/69114d82c56eb23a2a2d12ce34362b92b5ed27f1.jpg"
    }
}