{
    "id": "af0988f4-7c4e-4a0a-972a-abd2844be71d",
    "created_at": "2023-01-12T15:00:03.730723Z",
    "updated_at": "2025-03-27T02:05:33.20986Z",
    "deleted_at": null,
    "sha1_hash": "40f431292ceba4826edee74f9363ae7e9a73a55f",
    "title": "2020-06-05 - Retread Ransomware- Identifying Satana to Understand -CoronaVirus-",
    "authors": "",
    "file_creation_date": "2022-05-28T19:32:40Z",
    "file_modification_date": "2022-05-28T19:32:40Z",
    "file_size": 2654946,
    "plain_text": "# Retread Ransomware\n\n**blog.reversinglabs.com/blog/retread-ransomware**\n\n[Threat Research | June 5, 2020](https://blog.reversinglabs.com/blog/tag/threat-research)\n\nBlog Author\nRobert Simmons, Independent malware researcher and threat researcher at\n[ReversingLabs. Read More...](https://blog.reversinglabs.com/blog/author/robert-simmons)\n\n\n-----\n\n[In March of 2020, MalwareHunterTeam discovered a downloader which installed both a KPot](https://twitter.com/malwrhunterteam/status/1238113568442265602)\ninfostealer as well as a second payload which was a ransomware variant that used the string\n\"CoronaVirus\". This sample was leveraging ongoing current events and appears to be some\nform of cover for or distraction from the infostealer trojan that was installed alongside it. Via\ncode analysis of this \"CoronaVirus\" sample, it is clear that it reuses a large amount of code\nfrom a four year old sample of ransomware detected as \"Satana\".\n\nThis older malware sample was first seen on June 29, 2016. This old sample and the recent\none share two decoding algorithms that are used to hide strings, code, and a little, tiny PE\n[file. This embedded file is run via a modification to the BootExecute registry key. The new file](https://attack.mitre.org/techniques/T1060/)\nhas some changes to the strings that are encoded along with the encoded data hiding the\nransom note and the Bitcoin wallet addresses used to collect payment.\n\nThese are new addresses with a number of payments made during the same time that the\nnew file was observed in the wild. The ransom amount demanded is quite small: $50. All in\nall, this is a strange executable. What follows is an examination of the two decoding\nalgorithms and a method for discovering the old samples based on YARA rules that focus on\nthese algorithms.\n\n**String Decoding**\n\nMany malware families obfuscate the strings that are used during their execution as a way to\n[foil static analysis and detections based on the decoded forms of the strings. In the samples](https://attack.mitre.org/techniques/T1027/)\nexamined here, the string encoding is very simple. It is a substitution cipher which shifts one\ncharacter then subtracts the position index of the character in the encoded string to reveal\nthe decoded character. This algorithm is highlighted in Figure 1.\n\n\n-----\n\n**Figure 1: String Decoding Algorithm**\n\nBy focusing on the algorithm itself, which can be more stable than surrounding code when\nreused, one may locate other malware samples that could be related to the sample being\nanalyzed. Figure 2 shows the same algorithm, but in a debugger where the first encoded\nstring that is operated on in the sample can be seen in the dump at the bottom.\n\n**Figure 2: First Encoded String in Sample**\n\nThis same algorithm can be easily translated into Python and the strings from the sample\ndecoded without executing the sample. A small Python program for decoding these strings is\nshown in Figure 3. The first string in the sample, which decodes to \"CoronaVirus\", is shown\nhere.\n\n\n-----\n\n**Figure 3: Python Implementation of String Decoder Algorithm**\n\nTaking only the bytes of the instructions that comprise this algorithm, a byte string for a YARA\nrule is identified.\n\n```\n$op1 = { 8A 14 06 2A D1 FE CA 88 14 07 }\n\n```\n\n[By then deploying this YARA rule as a retrohunt in the Titanium Platform, a number of](https://www.reversinglabs.com/products/malware-analysis-platform)\nadditional samples are found. The results of this retrohunt are shown in Figure 4.\n\n\n-----\n\n**Figure 4: Retrohunt Results**\n\n**Old Satana Sample**\n\nIn the results of the retrohunt there are a number of samples from 2016. The sample with the\nearliest ‘first seen’ date is shown in Figure 5.\n\n**Figure 5: Earliest Related Satana Sample from 2016**\n\n[This file is well detected as Satana via the TitaniumCore YARA classification as well as being](https://www.reversinglabs.com/products/automated-static-analysis-tools)\n[classified as ransomware by the TitaniumCore Machine Learning classification. Both of these](https://www.reversinglabs.com/products/explainable-machine-learning)\nclassifications are seen in Figure 6.\n\n\n-----\n\n**Figure 6: Detection and Classification**\n\nIn addition to this first sample, there are nine other samples that have been identified as\n[related to the first based on the ReversingLabs Hash Algorithm (RHA). These other samples](https://www.reversinglabs.com/technology/reversinglabs-hash-algorithm)\nare seen in Figure 7.\n\n**Figure 7: Cluster of Ten Files Related via RHA**\n\nThe earliest files in the cluster, each of which are also first seen in 2016, are very minor\nchanges to the earliest file. These may be researchers testing or other types of analysis\nartifacts. One such minor change is highlighted in Figure 8 which shows a side-by-side\n\n\n-----\n\n[comparison of the two files using HexFiend.](https://github.com/ridiculousfish/HexFiend/)\n\n**Figure 8: Side-by-side Comparison of Satana Samples**\n\nMore recently observed files from this same cluster are clearly analysis artifacts from\nresearchers or analysis tools. Many of them simply have the encoded strings decoded in the\nsample and no other changes. Knowing that all the files in the cluster are essentially the\nsame file, only the earliest sample\n(ee937717efe9a2e076b9497498b628beb0c84a8476bd288105a59c5aeea01f3d) is used for\ncomparison with the CoronaVirus sample.\n\n**Data Decoding**\n\nAnother common method used to encode data to avoid detection and identification is the\n[\"exclusive or\" operation or XOR. The sample analyzed here uses this operation to hide large](https://en.wikipedia.org/wiki/Exclusive_or)\nblobs of data. It specifically encodes the ransom note as well as a very small PE file which is\nused to display a variation of the ransom note on reboot. The location where this XOR\noperation is carried out is shown in Figure 9.\n\n**Figure 9: XOR Decoding Process**\n\n\n-----\n\nThis is a loop which uses the first byte of the data as the key and then operates using that\nkey on the rest of the bytes in the data. The encoded data before this operation has started\nis shown in Figure 10. The XOR key is the very first byte, 0x58.\n\n**Figure 10: First Byte of Encoded Data is XOR Key**\n\nAfter this decoding process is complete, the embedded PE file begins to appear. This data is\nstill compressed, but the file magic \"MZ\" and the DOS stub string are clear. The decoded\nversion of the data shown above is seen in Figure 11.\n\n\n-----\n\n**Figure 11: Decoded Data with PE File Starting to Appear**\n\nThe next step after decoding the data is to decompress it. The instructions that perform this\n[action utilize the library function \"RtlDecompressBuffer\". The function name is loaded](https://docs.microsoft.com/en-us/windows-hardware/drivers/ddi/ntifs/nf-ntifs-rtldecompressbuffer)\ndynamically by decoding a string using the string decoding capability examined earlier. As\npuzzling as it sounds, something like a comic book supervillain telling you their next step\nbefore doing something evil, the meaning of these instructions is stated clearly by the\nadditional string, \"DeCompressor\", which is not encoded or hidden in any way. These\ninstructions as seen in the debugger are shown in Figure 12.\n\n**Figure 12: Disassembled Decompression Instructions**\n\n\n-----\n\nAside from the tiny PE file and the ransom note template, the decoded list of Bitcoin wallet\naddresses is provided. One of these addresses is selected to be used with the ransom note\ntemplate to generate the note that is dropped by the ransomware. These decoded and\ndecompressed Bitcoin wallet addresses are shown in Figure 13.\n\n**Figure 13: Decoded and Decompressed Bitcoin Wallet Addresses**\n\nThese addresses are listed in Table 1. The list of wallet addresses in the sample have two\nduplicates, so the total set of addresses has 22 members each of which is of type Bech32\nSegregatedWitness address format.\n\nbc1qc9axh3fq2ypgcd92j582v9khfrn52strql7ztn\n\nbc1qzww0kjteu52w50m3d2ucp72zh5dwchph9vqj6k\n\nbc1q5e8pwyk9rqtq400agngmq5h23cuz42x0wlqw3q\n\nbc1qrkp9cx6svxguxupx9p0z5ss4nmyr4fwhvgkasg\n\nbc1qjl0ufmwct84ww69zwyxe99gext7za6qkyhx200\n\nbc1q6ryyex33jxgr946u3jyre66uey07e2xy3v2cah\n\nbc1qlmu9xk8wdnydnlcvy9uvcepzklcv7kxyhk8ymy\n\nbc1qftwqsaw57v6cstwrdvclmkz63plvf5q3vqvw4k\n\nbc1qegps92ddvgv8t45lfcn02afsjlyf7mynuqvpmm\n\nbc1quwc6yqgdcgm6z2663vpjm9cgtfwf7mhk2n7gtn\n\nbc1q9dd5nkqrxsny93r9u09jwq8agvkf04afxh67jg\n\nbc1qt6ypzfv25hwv70zs8nvrdhjl962jzyymkl7y9d\n\nbc1qgd3nj0486k35ra42a550ntyafdr7s5lmyzjn29\n\nbc1q8r42fm7kwg68dts3w70qah79n5emt5m76rus5u\n\nbc1q3v6far85gtdsrk4zu4fuhphheyqprwmuv62n92\n\nbc1qpvguajy4rxr7743hzuwfmz32krzzfcjl9rf0qx\n\n\n-----\n\nbc1qe9gj2sj3an73dq37vpe34xflc83yjp4u3pzfgz\n\nbc1qpaksevt2w6cqdeqjvm8dapvz66y3hs3jjy4x66\n\nbc1qt3uf3wx569z5z9wdeanuj4rwq7m06grhxt96v3\n\nbc1qzv6h2zaedjgduc6xmyn86hdsu0skuunt9lhkxn\n\nbc1q2x9h8wlh2cuxjd9rv94v6syz7lpxxk2wwrndmv\n\nbc1qxsjfw0jftfr9n5urdyh7xmz4cspls8qefuyetr\n\n**Table 1: Bitcoin Wallet Addresses**\n\nThe ransom note template has four locations where string replacement is used to generate\nthe final note text that is dropped to the ransom note file. These locations in the template are\nhighlighted in Figure 14.\n\n**Figure 14: Ransom Note Template**\n\nThe email address, coronaVi2022[@]protonmail[.]ch, along with the amount demanded in\nBitcoin (BTC), 0.008, are both hard coded. The unique ID is generated by concatenating the\ndrive serial number collected from PhysicalDrive0 and the HwProfileGuid and then\ngenerating an MD5 from this string. The Bitcoin wallet address is chosen from the list\ndecoded and decompressed as documented above. These four values just before the call to\nsprintf can be seen in Figure 15.\n\n\n-----\n\n**Figure 15: String Replacement into Ransom Note Template**\n\nThe payment demand of 0.008 BTC, interestingly, does not line up with any of the seven\npayments made to the set of wallet addresses from the binary. Each is a single payment.\nSome of the payments are larger than the demand and some are smaller than the demand. It\nis unknown whether these payments are in fact connected with the ransomware.\n\n**Old Satana Sample Differences**\n\nThe majority of the instructions that handle the generation of randomness and moving that\nrandom data around in memory are all identical between the Satana and the Coronavirus\nsamples. Library and compiler added code along with these identical functions are shown in\nFigure 16 as analyzed using Relyze's binary difference feature.\n\n**Figure 16: Binary Difference Showing Identical Functions**\n\nThere are a number of functions that have some amount of change according to binary\ndifference, however, most of these instruction changes do not have a significant effect on the\nmalware sample's behavior. The strings that are operated on are different and one significant\nlocation of change is the BTC demand amount which was 0.5 BTC in the older sample and\n0.008 BTC in the newest. This change in price in the disassembly is shown in Figure 17.\n\n\n-----\n\n**Figure 17: Difference in Hard-Coded BTC Demand**\n\n**Conclusion**\n\nAs can be seen through comparison between the older Satana sample and the new\nCoronavirus sample, these two are very closely related. This old sample, or the source code\nfor it, has been repurposed and redeployed as \"CoronaVirus\" ransomware. However, due to\nthe distribution alongside the KPot sample, the very low demand amount of approximately\n$70, and the payments that are oddly larger or smaller than the demand: this may be a faux\nransomware campaign. Totaling all the payments received, the set of wallet addresses only\ncollected 0.10417322 BTC or about $930, a strangely low amount.\n\n**YARA Rule**\n```\nprivate rule WindowsPE\n {\n   condition:\n     uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550\n }\n rule SubstCipher_MinusIndex\n {\n   meta:\n     author = \"Malware Utkonos\"\n     date = \"2020-04-13\"\n     exemplar =\n\"ee937717efe9a2e076b9497498b628beb0c84a8476bd288105a59c5aeea01f3d\"\n   strings:\n     $op1 = { 8A 14 06 2A D1 FE CA 88 14 07 }\n   condition:\n     WindowsPE and all of them\n }\n\n## MORE BLOG ARTICLES\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-06-05 - Retread Ransomware- Identifying Satana to Understand -CoronaVirus-.pdf"
    ],
    "report_names": [
        "2020-06-05 - Retread Ransomware- Identifying Satana to Understand -CoronaVirus-.pdf"
    ],
    "threat_actors": [
        {
            "id": "b43e5ea9-d8c8-4efa-b5bf-f1efb37174ba",
            "created_at": "2022-10-25T16:07:24.36191Z",
            "updated_at": "2025-03-27T02:02:10.1909Z",
            "deleted_at": null,
            "main_name": "UNC2452",
            "aliases": [
                "Dark Halo",
                "Nobelium",
                "SolarStorm",
                "StellarParticle",
                "UNC2452"
            ],
            "source_name": "ETDA:UNC2452",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "1d3f9dec-b033-48a5-8b1e-f67a29429e89",
            "created_at": "2022-10-25T15:50:23.739197Z",
            "updated_at": "2025-03-27T02:00:55.536417Z",
            "deleted_at": null,
            "main_name": "UNC2452",
            "aliases": [
                "UNC2452",
                "NOBELIUM",
                "StellarParticle",
                "Dark Halo"
            ],
            "source_name": "MITRE:UNC2452",
            "tools": [
                "Sibot",
                "Mimikatz",
                "Cobalt Strike",
                "AdFind",
                "GoldMax"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "20d3a08a-3b97-4b2f-90b8-92a89089a57a",
            "created_at": "2022-10-25T15:50:23.548494Z",
            "updated_at": "2025-03-27T02:00:55.49688Z",
            "deleted_at": null,
            "main_name": "APT29",
            "aliases": [
                "APT29",
                "IRON RITUAL",
                "IRON HEMLOCK",
                "NobleBaron",
                "Dark Halo",
                "NOBELIUM",
                "UNC2452",
                "YTTRIUM",
                "The Dukes",
                "Cozy Bear",
                "CozyDuke",
                "SolarStorm",
                "Blue Kitsune",
                "UNC3524",
                "Midnight Blizzard"
            ],
            "source_name": "MITRE:APT29",
            "tools": [
                "PinchDuke",
                "ROADTools",
                "WellMail",
                "CozyCar",
                "Mimikatz",
                "Tasklist",
                "OnionDuke",
                "FatDuke",
                "POSHSPY",
                "EnvyScout",
                "SoreFang",
                "GeminiDuke",
                "GoldMax",
                "FoggyWeb",
                "SDelete",
                "PolyglotDuke",
                "AADInternals",
                "MiniDuke",
                "SeaDuke",
                "Sibot",
                "RegDuke",
                "CloudDuke",
                "GoldFinder",
                "AdFind",
                "PsExec",
                "NativeZone",
                "Systeminfo",
                "ipconfig",
                "Impacket",
                "Cobalt Strike",
                "PowerDuke",
                "QUIETEXIT",
                "HAMMERTOSS",
                "BoomBox",
                "CosmicDuke",
                "WellMess",
                "VaporRage",
                "LiteDuke"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "f27790ff-4ee0-40a5-9c84-2b523a9d3270",
            "created_at": "2022-10-25T16:07:23.341684Z",
            "updated_at": "2025-03-27T02:02:09.74554Z",
            "deleted_at": null,
            "main_name": "APT 29",
            "aliases": [
                "APT 29",
                "ATK 7",
                "Blue Dev 5",
                "BlueBravo",
                "Cloaked Ursa",
                "CloudLook",
                "Cozy Bear",
                "Dark Halo",
                "Earth Koshchei",
                "Grizzly Steppe",
                "Group 100",
                "ITG11",
                "Iron Hemlock",
                "Iron Ritual",
                "Midnight Blizzard",
                "Minidionis",
                "Nobelium",
                "NobleBaron",
                "Operation Ghost",
                "Operation Office monkeys",
                "Operation StellarParticle",
                "SilverFish",
                "Solar Phoenix",
                "SolarStorm",
                "StellarParticle",
                "TEMP.Monkeys",
                "The Dukes",
                "UNC2452",
                "UNC3524",
                "Yttrium"
            ],
            "source_name": "ETDA:APT 29",
            "tools": [
                "7-Zip",
                "ATI-Agent",
                "AdFind",
                "Agentemis",
                "AtNow",
                "BEATDROP",
                "BotgenStudios",
                "CEELOADER",
                "Cloud Duke",
                "CloudDuke",
                "CloudLook",
                "Cobalt Strike",
                "CobaltStrike",
                "CosmicDuke",
                "Cozer",
                "CozyBear",
                "CozyCar",
                "CozyDuke",
                "Danfuan",
                "EnvyScout",
                "EuroAPT",
                "FatDuke",
                "FoggyWeb",
                "GeminiDuke",
                "Geppei",
                "GoldFinder",
                "GoldMax",
                "GraphDrop",
                "GraphicalNeutrino",
                "GraphicalProton",
                "HAMMERTOSS",
                "HammerDuke",
                "LOLBAS",
                "LOLBins",
                "LiteDuke",
                "Living off the Land",
                "MagicWeb",
                "Mimikatz",
                "MiniDionis",
                "MiniDuke",
                "NemesisGemina",
                "NetDuke",
                "OnionDuke",
                "POSHSPY",
                "PinchDuke",
                "PolyglotDuke",
                "PowerDuke",
                "QUIETEXIT",
                "ROOTSAW",
                "RegDuke",
                "Rubeus",
                "SNOWYAMBER",
                "SPICYBEAT",
                "SUNSHUTTLE",
                "SeaDaddy",
                "SeaDask",
                "SeaDesk",
                "SeaDuke",
                "Sharp-SMBExec",
                "SharpView",
                "Sibot",
                "Solorigate",
                "SoreFang",
                "TinyBaron",
                "WINELOADER",
                "WellMail",
                "WellMess",
                "cobeacon",
                "elf.wellmess",
                "reGeorg",
                "tDiscoverer"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535603,
    "ts_updated_at": 1743041133,
    "ts_creation_date": 1653766360,
    "ts_modification_date": 1653766360,
    "files": {
        "pdf": "https://archive.orkl.eu/40f431292ceba4826edee74f9363ae7e9a73a55f.pdf",
        "text": "https://archive.orkl.eu/40f431292ceba4826edee74f9363ae7e9a73a55f.txt",
        "img": "https://archive.orkl.eu/40f431292ceba4826edee74f9363ae7e9a73a55f.jpg"
    }
}