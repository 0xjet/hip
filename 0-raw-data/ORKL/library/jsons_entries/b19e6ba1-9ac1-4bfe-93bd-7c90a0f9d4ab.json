{
    "id": "b19e6ba1-9ac1-4bfe-93bd-7c90a0f9d4ab",
    "created_at": "2023-01-12T15:07:25.376187Z",
    "updated_at": "2025-03-27T02:14:02.643876Z",
    "deleted_at": null,
    "sha1_hash": "70742f16a26052c5332945e35054897b28182109",
    "title": "2018-05-09 - Malware Analysis - PlugX - Part 2",
    "authors": "",
    "file_creation_date": "2022-05-28T18:25:29Z",
    "file_modification_date": "2022-05-28T18:25:29Z",
    "file_size": 1135671,
    "plain_text": "# Malware Analysis – PlugX – Part 2\n\n**[countuponsecurity.com/2018/05/09/malware-analysis-plugx-part-2/](https://countuponsecurity.com/2018/05/09/malware-analysis-plugx-part-2/)**\n\nBy Luis Rocha May 9, 2018\n\n[Following my previous article on PlugX, I would](https://countuponsecurity.com/2018/02/04/malware-analysis-plugx/)\nlike to continue the analysis but now use the\nPlugX controller to mimic some of the steps that\nmight be executed by an attacker. As you know\n[the traditional steps of an attack lifecycle follow,](https://countuponsecurity.com/2016/06/29/the-abcs-of-a-cyber-intrusion/)\nnormally, a predictable sequence of events i.e.,\nReconnaissance, initial compromise, establish\nfoothold, escalate privileges, internal\nreconnaissance, move laterally, maintain\npersistence, complete mission. For sake of\nbrevity I will skip most of the steps and will focus\non the lateral movement.I will use the PlugX\ncontroller and C2 functionality to simulate an\nattacker that established a foothold inside an environment and obtained admin access to a\nworkstation. Following that, the attacker moved laterally to a Windows Domain Controller. I\nwill use the PlugX controller to accomplish this scenario and observe how an attacker would\noperate within a compromised environment.\n\nAs we saw previously, the PlugX controller interface allows an operator to build payloads, set\ncampaigns and define the preferred method for the compromised hosts to check-in and\ncommunicate with the controller. In the PlugX controller, English version from Q3 2013, an\noperator can build the payload using two techniques. One is using the “DNS Online”\ntechnique which allows the operator to define the C2 address e.g, an URL or IP address, that\nwill be used by the payload to speak with the C2. The other method, is the “Web Online”,\nwhich allows the operator to tell the payload from where it should fetch the C2 address. This\nmethod allows the operator to have more control over the campaign. The following diagram\nillustrates how the “Web Online” technique works.\n\n\n-----\n\nWhy do I say this technique would allow an attacker to have more control? Consider the\ncase that an organization was compromised by a threat actor that use this PlugX technique.\nIn case the C2 is discovered, the impacted organization could block the IP or URL on the\nexisting boundary security controls as a normal reaction to the concerns of having an\nattacker inside the network. However, the attacker could just change the C2 string and point\nit to a different system. In case the organization was not able to scope the incident and\nunderstand the TTP’s (Tools, Tactics and Procedures) then the attacker would still maintain\npersistence in the environment. This is an example that when conducting incident response,\namong other things, you need to have visibility into the tools and techniques the attacker is\nusing so you could properly scope the incident and perform effective and efficient\ncontainment and eradication steps. As an example of this technique, below is a print screen\nfrom a GitHub page that has been used by an unknown threat actor to leverage this method.\n\n\n-----\n\nSo, how to leverage this technique on the PlugX builder? The picture below shows how the\noperator could create a payload that uses the “Web Online” technique. The C2 address\nwould be fetched from a specified site e.g. a Pastebin address, which on its turn would\nredirect the payload to the real C2 address. The string\n“DZKSAFAAHHHHHHOCCGFHJGMGEGFGCHOCDGPGNGDZJS” in this case is used to\ndecode to the real C2 address which is “www.builder.com”. On the “PlugX: some uncovered\npoints” article, Fabien Perigaud writes about how to decode this string. Palo Alto Unit42\n[gives another example of this technique on the “Paranoid PlugX” article. The article “Winnti](https://researchcenter.paloaltonetworks.com/2017/06/unit42-paranoid-plugx/)\nAbuses GitHub for C&C Communications” from [Cedric Pernet ilustrates an APT group](https://twitter.com/cedricpernet?lang=en)\nleveraging this technique using GitHub.\n\n\n-----\n\nFor sake of simplicity, in this article, I’m going to use the DNS Online technique using\n“www.builder.com” as C2 address. Next, on the “First” tab I specify the campaing ID and the\npassword used by the payload to connect to the C2.\n\n\n-----\n\nNext, on the Install tab I specify the persistence settings, in this case I’m telling the payload\nto install a service and I can specify different settings including where to deploy the binaries,\nthe service name and service description. In addition, I can specify that if the Service\npersistence mechanism fails due to some reason the payload should install the persistence\nmechanism using the Registry and I can specify which HIVE should be used.\n\n\n-----\n\nThen, In the inject tab I specify which process will be injected with the malicious payload. In\nthis case I choose “svchost.exe”. This will make PlugX start a new instance of “svchost.exe”\n[and then inject the malicious code into svchost.exe process address space using process](https://countuponsecurity.com/2015/12/07/malware-analysis-dridex-process-hollowing/)\nhollowing technique.\n\n\n-----\n\nOther than that, the operator could define a schedule and determine which time of the week\nthe payload should communicate with the C2. Also the operator could define the Screen\nRecording capability that will take screenshots at a specific frequency and will save them\nencrypted in a specific folder.\n\n\n-----\n\nLast settings on the “option” tab allow the operator to enable the keylogger functionality and\nspecify if the payload should hide it self and also delete itself after execution.\n\n\n-----\n\nFinally, after all the settings defined, the operator can create/download the payload in\ndifferent formats. An executable, binary form (Shellcode), or an array in C that can then be\nplugged in another delivery mechanism e.g, PowerShell or MsBuild. After deploying and\ninstalling the payload on a system, that system will check-in into the PlugX controller and an\noperator can call the “Manager” to perform the different actions. In this example I show how\nan attacker, after having compromised a system, uses the C2 interface to:\n\nBrowse the network\n\n\n-----\n\nAccess remote systems via UNC path\n\nUpload and execute a file e.g., upload PlugX binary\n\nInvoke a command shell and perform remote commands e.g., execute PlugX binary on\na remote system\n\n\n-----\n\nPrevious pictures illustrate actions that the attacker could perform to move laterally and, for\nexample, at some point in time, access a domain controller via UNC path, upload the PlugX\npayload to a directory of its choice and execute it. In this case the pictures show that the\nPlugX payload was dropped into c:\\PerfLogs\\Admin folder and then was executed using\nWMI. Below example shows the view from the attacker with two C2 sessions. One for one\nworkstation and another for a domain controller.\n\n\n-----\n\nHaving access to a domain controller is likely one of the goals of the attacker so he can\nobtain all the information he needs about an organization from the Active Directory database.\n\nTo access the Active Directory database, the attacker could, for example, run the\n“ntdsutil.exe” command to create a copy of the “NTDS.dit” file using Volume Shadow Copy\ntechnique. Then, the attacker can access the database and download it to a system under\nhis control using the PlugX controller interface. The picture below illustrates an attacker\nobtained the relevant data that was produced using the “ntdsutil.exe” command.\n\n\n-----\n\nFinally, the attacker might delete the artifacts that were left behind on the file system as\nconsequence of running “ntdsutil.exe”.\n\nSo, in summary, we briefly looked at the different techniques a PlugX payload could be\nconfigured to speak with a Command and Controller. We built, deploy and install a payload.\nCompromised a system and obtain a perspective from PlugX operator. We move laterally to\na domain controller and installed the PlugX payload and then used a command shell to\nobtain the Active Directory database. Of course, as you noted, the scenario was\naccomplished with an old version of the PlugX controller. Newer versions likely have many\nnew features and capabilities For example the print screen below is from a PlugX builder\n\n\n-----\n\nfrom 2014 (MD5: 534d28ad55831c04f4a7a8ace6dd76c3) which can create different\n[payloads that perform DLL Search order hijacking using Lenovo’s RGB LCD Display Utility](https://countuponsecurity.com/2016/05/24/digital-forensics-dll-search-order/)\nfor ThinkPad (tplcdclr.exe) or Steve Gibson’s Domain Name System Benchmarking Utility\n(sep_NE.exe). The article from Kaspersky “PlugX malware: A good hacker is an apologetic\nhacker” outlines a summary about it.\n\nThat’s it! With this article we set the table for the next article focusing on artifacts that might\nhelps us uncover the hidden traits that were left behind by the attacker actions performed\nduring this scenario. Stay tuned and have fun!\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-05-09 - Malware Analysis - PlugX - Part 2.pdf"
    ],
    "report_names": [
        "2018-05-09 - Malware Analysis - PlugX - Part 2.pdf"
    ],
    "threat_actors": [
        {
            "id": "2646f776-792a-4498-967b-ec0d3498fdf1",
            "created_at": "2022-10-25T15:50:23.475784Z",
            "updated_at": "2025-03-27T02:00:55.479958Z",
            "deleted_at": null,
            "main_name": "BlackTech",
            "aliases": [
                "BlackTech",
                "Palmerworm"
            ],
            "source_name": "MITRE:BlackTech",
            "tools": [
                "Kivars",
                "PsExec",
                "TSCookie",
                "Flagpro",
                "Waterbear"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "d3a7123c-f519-49a0-a234-de24a1ef052a",
            "created_at": "2022-10-25T16:47:55.545211Z",
            "updated_at": "2025-03-27T02:05:17.254744Z",
            "deleted_at": null,
            "main_name": "BRONZE CANAL",
            "aliases": [
                "CTG-6177 ",
                "Circuit Panda ",
                "Palmerworm ",
                "Shrouded Crossbow ",
                "BlackTech"
            ],
            "source_name": "Secureworks:BRONZE CANAL",
            "tools": [
                " DRIGO",
                " Flagpro",
                " Gh0stTimes",
                " PLEAD",
                " Spiderpig",
                " Waterbear",
                "Bifrose"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "75024aad-424b-449a-b286-352fe9226bcb",
            "created_at": "2023-01-06T13:46:38.962724Z",
            "updated_at": "2025-03-27T02:00:02.964002Z",
            "deleted_at": null,
            "main_name": "BlackTech",
            "aliases": [
                "CIRCUIT PANDA",
                "Temp.Overboard",
                "G0098",
                "Red Djinn",
                "HUAPI",
                "Palmerworm",
                "T-APT-03",
                "Manga Taurus",
                "Earth Hundun"
            ],
            "source_name": "MISPGALAXY:BlackTech",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "efa7c047-b61c-4598-96d5-e00d01dec96b",
            "created_at": "2022-10-25T16:07:23.404442Z",
            "updated_at": "2025-03-27T02:02:09.781478Z",
            "deleted_at": null,
            "main_name": "BlackTech",
            "aliases": [
                "BlackTech",
                "Circuit Panda",
                "Earth Hundun",
                "Manga Taurus",
                "Operation PLEAD",
                "Operation Shrouded Crossbow",
                "Operation Waterbear",
                "Palmerworm",
                "Radio Panda",
                "Red Djinn",
                "T-APT-03",
                "TEMP.Overboard"
            ],
            "source_name": "ETDA:BlackTech",
            "tools": [
                "BIFROST",
                "BUSYICE",
                "BendyBear",
                "Bluether",
                "CAPGELD",
                "DRIGO",
                "Deuterbear",
                "Flagpro",
                "GOODTIMES",
                "Gh0stTimes",
                "IconDown",
                "KIVARS",
                "LOLBAS",
                "LOLBins",
                "Linopid",
                "Living off the Land",
                "TSCookie",
                "Waterbear",
                "XBOW",
                "elf.bifrose"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "4c68ccd0-caba-4189-9ead-86ac4c2d9b70",
            "created_at": "2024-05-01T02:03:07.930196Z",
            "updated_at": "2025-03-27T02:05:17.251237Z",
            "deleted_at": null,
            "main_name": "BRONZE ATLAS",
            "aliases": [
                "Axiom",
                "BARIUM ",
                "Blackfly ",
                "CTG-2633",
                "GREF",
                "Group 72 ",
                "Red Kelpie ",
                "TG-2633 ",
                "Wicked Panda ",
                "Winnti",
                "APT41 "
            ],
            "source_name": "Secureworks:BRONZE ATLAS",
            "tools": [
                " CCleaner v5.33 backdoor",
                " ChinaChopper",
                " Cobalt Strike",
                " Dicey MSDN",
                " ForkPlayground",
                " HUC Proxy Malware (Htran)",
                " Mimikatz",
                " PipeMon",
                " PlugX",
                " PortReuse",
                " Powershell Empire",
                " RCMD",
                " RbDoor",
                " SPEEDBOAT",
                " ShadowPad",
                " Sidewalk",
                " Speculoos",
                " TeamViewer",
                " Winnkit",
                " Winnti",
                " reg save",
                " vssadmin",
                "Acehash"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673536045,
    "ts_updated_at": 1743041642,
    "ts_creation_date": 1653762329,
    "ts_modification_date": 1653762329,
    "files": {
        "pdf": "https://archive.orkl.eu/70742f16a26052c5332945e35054897b28182109.pdf",
        "text": "https://archive.orkl.eu/70742f16a26052c5332945e35054897b28182109.txt",
        "img": "https://archive.orkl.eu/70742f16a26052c5332945e35054897b28182109.jpg"
    }
}