{
    "id": "1aa4f7fa-5f1b-4ab0-8b28-80a93b07a7cf",
    "created_at": "2022-10-25T16:48:18.869541Z",
    "updated_at": "2025-03-27T02:14:45.159347Z",
    "deleted_at": null,
    "sha1_hash": "c38d19048cb7d66480d4e12c61fc0c3c8ebbc78d",
    "title": "“Red October”. Detailed Malware Description 4. Second Stage of Attack",
    "authors": "",
    "file_creation_date": "2018-12-21T03:34:31Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 265284,
    "plain_text": "# “Red October”. Detailed Malware Description 4. Second Stage of Attack\n\n**[securelist.com/red-october-detailed-malware-description-4-second-stage-of-attack/36884/](https://securelist.com/red-october-detailed-malware-description-4-second-stage-of-attack/36884/)**\n\nBy GReAT\n\n## First stage of attack\n\n1. [Exploits](https://securelist.com/red-october-detailed-malware-description-1-first-stage-of-attack/36830/#exploits)\n2. [Dropper](https://securelist.com/red-october-detailed-malware-description-1-first-stage-of-attack/36830/#dropper)\n3. [Loader Module](https://securelist.com/red-october-detailed-malware-description-1-first-stage-of-attack/36830/#loader)\n4. [Main component](https://securelist.com/red-october-detailed-malware-description-1-first-stage-of-attack/36830/#main-component)\n\n## Second stage of attack\n\n1. [Modules, general overview](https://securelist.com/red-october-detailed-malware-description-2-second-stage-of-attack/36842/)\n2. [Recon group](https://securelist.com/red-october-detailed-malware-description-2-second-stage-of-attack/36842/)\n3. [Password group](https://securelist.com/red-october-detailed-malware-description-3-second-stage-of-attack/36802/)\n4. [Email group](https://securelist.com/red-october-detailed-malware-description-3-second-stage-of-attack/36802/)\n5. [USB drive group](https://securelist.com/red-october-detailed-malware-description-3-second-stage-of-attack/36802/)\n6. [Keyboard group](https://securelist.com/red-october-detailed-malware-description-3-second-stage-of-attack/36802/)\n7. [Persistence group](https://securelist.com/red-october-detailed-malware-description-4-second-stage-of-attack/36884/)\n8. [Spreading group](https://securelist.com/red-october-detailed-malware-description-4-second-stage-of-attack/36884/)\n9. [Mobile group](https://securelist.com/red-october-detailed-malware-description-5-second-stage-of-attack/36879/)\n10. [Exfiltration group](https://securelist.com/red-october-detailed-malware-description-5-second-stage-of-attack/36879/)\n\n## 7. Persistence group\n\n### Scheduler module\n\nKnown locations: %APPDATA%MicrosoftRtkN32Gdi.exe\n\nThe module is created and executed (for the first time) by the module “fileputexec”.\n\nKnown variants:\n\n**Compilation date**\n\n**MD5** **(encrypted)** **Compilation date (payload)**\n\n43C0BA45BE45CA20ED014A8298104716 2012.10.24 13:12:43 (GMT) 2012.10.11 07:19:12\n(GMT),\n\n#### Summary\n\nThe file is a PE EXE file, compiled with Microsoft Visual Studio 2010.\n\nCreates encrypted log files: “%TMP%smrdprevsmrdprev_%p_%p.tmp”, where “%p” parameters are\nformatted from the return values of subsequent GetTickCount API calls.\n\nCreates event: “Globalwsheledstpknt”\n\n\n-----\n\nWhen started, the module initializes its log object with a new filename. Then, it creates one of the\nfollowing registry values to ensure its automatic start:\n\nHKLMSOFTWAREMicrosoftWindowsCurrentVersionPoliciesExplorerRunservise=%path to the\nmodule’s executable file%\n\nHKCUSoftwareMicrosoftWindows NTCurrentVersionWindowsload=%path to the module’s\nexecutable file%\n\nThen, the module enters an infinite loop where it executes its main function with 300 second\ndelay between iterations.\n\n#### Main function\n\nThe module traverses the directories from a hardcoded list, looking for files with names\nmatching regular expressions “.*..*.bak” and “.*..*.trh”. The list of directories:\n\n%ProgramFiles%Microsoft Common\n%ProgramFiles%Common Files\n%SystemDrive%Documents and SettingsLocalServiceApplication DataMicrosoft\n%SystemDrive%Documents and SettingsLocalServiceLocal SettingsApplication DataMicrosoft\n%ALLUSERSPROFILE%\n%ALLUSERSPROFILE%Application Data\n%ALLUSERSPROFILE%Application DataMicrosoft\n%ALLUSERSPROFILE%Application DataMicrosoftOffice\n%ALLUSERSPROFILE%Application DataMicrosoftOfficeData\n%ALLUSERSPROFILE%Application DataMicrosoftWindows\n%windir%Installer\n%windir%HelpToursmmTour\n%windir%HelpTourshtmTour\n%windir%HelpToursWindowsMediaPlayer\n%windir%IME\n%windir%MsApps\n%windir%MsAppsMsInfo\n%windir%inf\n%HOMEPATH%Local Settings\n%APPDATA%\n%APPDATA%MicrosoftOffice\n%APPDATA%MicrosoftOfficeData\n%APPDATA%MicrosoftWindows\n%windir%Temp\n%TMP%\n%module’s installation directory%\n\nAny found file with the extension “.trh” is deleted.\n\nFiles with the extension “.bak” are treated differently. They are decrypted using a custom\nAMPRNG algorithm with a hardcoded key, then decompressed using LZMA. If the file was\ndecompressed without errors, it is expected to start with a header that describes an internal task.\n\n\n-----\n\nof the decrypted file differently:\n\n**Task**\n\n**type** **Task action**\n\n1 The task is a PE EXE file. It is written to a temporary file ‘%TMP%%number%.exe‘ and executed with\nCreateProcess API. The file is removed when the process terminates.\n\n3 The task is a PE DLL file. It is loaded in memory with a custom PE loader. Then, its export named\n‘START‘ is called.\n\n4 The task is a new version of the ‘scheduler’ module. The original module is moved to a file with\nextension ‘.trh‘ and deleted, the task’s contents are written instead.\n\nKnown variants of the “.bak” task files were created by the “fileputexec” module. They all\ncontained a task named “fileinfo”.\n\n### DocBackdoor (Acrobat Reader and Microsoft Office plugin) module\n\nKnown file locations: add-on directories of Acrobat Reader or Microsoft Office, depends on\ninstallation settings.\n\nKnown variants:\n\n**MD5** **Compilation date (payload)**\n\n1294af519b9e6a521294607c8c1b3d27 2012.05.14 08:49:35 (GMT)\n\n#### Summary\n\nThe file is a PE DLL file with 1 exported function, compiled with Microsoft Visual Studio 2010.\nThe malware contains a universal plugin for Acrobat Reader and Microsoft Office application.\nThe plugin does not depend on the application so it could have been used with other applications,\ntoo.\n\nExport(s): winampGetGeneralPurposePlugin\n\nAll the functionality is implemented in the DllMain function.\n\n#### DllMain function\n\nWhen loaded, the module starts a new thread and returns. In the new thread, the module\nexecutes its main function in an infinite loop, with 1 second delay.\n\n#### Main function\n\nThe module iterates through file handle values from 0 to 65534 with step 4, and tries to get file\nsize for every handle. If call to GetFileSize succeeds, the module assumes that it found a valid file\nhandle, and proceeds with this file. The file handle may belong to any file that is currently open by\nthe application, including any open documents (i.e. PDF, DOC, XLS, PPT files).\n\nThe module retrieves the name of the file, reads the whole file into memory and checks its last\nDWORD. If the value is not equal to the magic number 0x29A (666 decimal), it skips this file. If the\nDWORD matches the magic value, it reads more values from the end of file.\n\n\n-----\n\n-5 BYTE Operation mode byte\n\n-9 DWORD Payload length\n\n-9 – Payload length BYTE*payload length Encrypted payload\n\nIf the operation mode byte is equal to 3, the module loads the decrypted payload as a PE DLL\nlibrary using own PE format loader, and executes its DllMain function. If the operation mode byte\ncontains any other value, it tries to write the payload to the first available directory from the list:\n\n%windir%Temp\n%TMP%\n%TEMP%\n%ProgramFiles%Common Files\n%ProgramFiles%WindowsUpdate\n\nThe name of the file is read from the beginning of the decrypted payload.\n\nThen, the module selects further actions depending on the operation mode byte:\n\n**Operation mode byte value** **Action**\n\n1 Execute the file with\nCreateProcess\n\n2 Load the file with LoadLibrary\n\n### OfficeBDInstaller module (Microsoft Office plugin installer)\n\nKnown variants:\n\n**MD5** **Compilation date (payload)**\n\nAE693C43E40F0DE9DE9FA2D950003ABF 2012.10.09 06:42:11 (GMT)\n\nThe file is a PE DLL file without exported functions, compiled with Microsoft Visual Studio 2010.\nAll the functionality is implemented in the DllMain function.\n\n#### DllMain\n\nWhen loaded, the module retrieves its resource of type “BBB” and name “AAA”, and starts an\ninternal plugin framework. The main function of the module is named “task_msplugin” and is\nregistered in the framework. Then, it starts the framework main loop, effectively parsing the\nresource data and executing the list of actions encoded in the resource.\n\nThe decoded resource data for the known sample can be represented as the following script:\n\nSetOption(conn_a.VERSION_ID, [6] “51070”)\nSetOption(conn_a.VER_SESSION_ID, %removed%)\nSetOption(conn_a.SEND_DELAY_TIME, [5] “2000”)\nSetOption(conn_a.D_CONN, [65] “nt-windows-online.com;nt-windows-update.com;nt-windowscheck.com”)\nSetOption(conn_a.D_MODE, “3”)\nS tO ti ( D NAME [15] “/ i bi / t/ k”)\n\n\n-----\n\nSetOption(conn_a.D_RPRT, [3] 80 )\nSetOption(conn_a.D_SPRT, [3] “80”)\nSetOption(conn_a.D_USER, [21] %removed%)\nSetOption(conn_a.J_CONN, [65] “nt-windows-online.com;nt-windows-update.com;nt-windowscheck.com”)\nSetOption(conn_a.J_MODE, 0x0033)\nSetOption(conn_a.J_NAME, [15] “/cgi-bin/nt/th”)\nSetOption(conn_a.J_PASS, 0x00)\nSetOption(conn_a.J_RPRT, [3] “80”)\nSetOption(conn_a.J_SPRT, [3] “80”)\nSetOption(conn_a.J_USER, [21] %removed%)\nSetOption(msplugin_loc, 76288 bytes buffer)\nSetOption(msplugin_name, 28 bytes buffer)\nSetOption(msplugin_Word, “1”)\nSetOption(msplugin_Excel, “0”)\nSetOption(msplugin_PowerPoint, “0”)\nSetOption(msplugin_desc0, 38 bytes buffer)\nSetOption(msplugin_desc1, 58 bytes buffer)\nSetOption(msplugin_desc2, 64 bytes buffer)\nSetOption(msplugin_progid, 22 bytes buffer)\nCall(task_msplugin)\n\n#### Main function (task_msplugin)\n\nFirst, the module tries to raise its privileges. It tries to log in as a privileged user using a\ndictionary of common passwords. Then, it tries to locate installed Microsoft Office application by\nenumerating the registry keys in HKLMSOFTWAREMicrosoftWindowsCurrentVersionUninstall\nand searching for the keys that contain “Microsoft Office”, “Microsoft Office Word”, “Microsoft\nOffice Shared” in the “DisplayName” value. If no key was found, the module aborts installation.\n\nThen, depending on the values of the options “msplugin_Word”, “msplugin_Excel”,\n“msplugin_PowerPoint”, it installs a plugin for selected Office applications. For each application,\nit tries to write the plugin to the first available directory from the list:\n\n%ProgramFiles%Microsoft OfficeOffice10Data\n%ProgramFiles%Microsoft OfficeOffice10\n%ProgramFiles%Microsoft OfficeOffice11Data\n%ProgramFiles%Microsoft OfficeOffice11\n%ProgramFiles%Microsoft OfficeOffice12Data\n%ProgramFiles%Microsoft OfficeOffice12\n%ALLUSERSPROFILE%Application DataMicrosoftOffice\n%ALLUSERSPROFILE%Application DataMicrosoftOfficeData\n%APPDATA%MicrosoftOfficeData\n%APPDATA%MicrosoftOffice\n%APPDATA%MicrosoftWindows\n%ProgramFiles%Microsoft Common\n%ProgramFiles%Common Files\n\nThe file name for the plugin is retrieved from the “msplugin name” option from the resource It\n\n\n-----\n\nIf the file was created without errors, the module creates the following registry values:\n\nHKLMSOFTWAREMicrosoftOffice%product name%Addins%msplugin_progid option value%\nLoadBehavior=DWORD:0x10\nCommandLineSafe=DWORD:0x00\nFriendlyName=%msplugin_desc1 option value%\nDescription=%msplugin_desc2 option value%\n\nHKCRCLSID%plugin’s CLSID%\ndefault=%msplugin_desc0 option value%\n\nHKCRCLSID%plugin’s CLSID%InProcServer32\ndefault=%plugin installation path%\n\nHKCRCLSID%plugin’s CLSID%ProgID\ndefault=%msplugin_progid option value%\n\nHKCRCLSID%plugin’s CLSID%VersionIndependentProgID\ndefault=%msplugin_progid option value%\n\nHKCR%msplugin_progid option value%CLSID\ndefault=%plugin’s CLSID%\n\nAfter completing the installation, the module sends its log file to the C&C server. The connection\noptions are retrieved from the configuration (resource):\n\n**Option name** **Description**\n\nD_CONN List of C&C domain names, separated by\n‘;’\n\nD_RPRT C&C server port\n\nD_NAME Relative URL to send request to\n\nThe data send to the C&C server is compressed with Zlib and encrypted with a modified PKZIP\nstream cipher, and then it is Base64-encoded.\n\n### AdobeBDInstaller module (Adobe Reader plugin installer)\n\nKnown variants:\n\n**MD5** **Compilation date (payload)**\n\n09fd8e1f2936a97df477a5e8552fe360 2012.10.05 11:20:40 (GMT)\n\nThe file is a PE DLL file without exported functions, compiled with Microsoft Visual Studio 2010.\nAll the functionality is implemented in the DllMain function.\n\n#### DllMain function\n\nWhen loaded, the module retrieves its resource of type “BBB” and name “AAA”, and starts an\ninternal plugin framework. The main function of the module is named “task_arplugin” and is\nregistered in the framework. Then, it starts the framework main loop, effectively parsing the\nresource data and executing the list of actions encoded in the resource\n\n\n-----\n\nSetOption(conn_a.VERSION_ID, [6] “51070”)\nSetOption(conn_a.VER_SESSION_ID, %removed%)\nSetOption(conn_a.SEND_DELAY_TIME, [5] “2000”)\nSetOption(conn_a.D_CONN, [65] “nt-windows-online.com;nt-windows-update.com;nt-windowscheck.com”)\nSetOption(conn_a.D_MODE, 0x0033)\nSetOption(conn_a.D_NAME, [15] “/cgi-bin/nt/sk”)\nSetOption(conn_a.D_PASS, 0x00)\nSetOption(conn_a.D_RPRT, [3] “80”)\nSetOption(conn_a.D_SPRT, [3] “80”)\nSetOption(conn_a.D_USER, [21] %removed% )\nSetOption(conn_a.J_CONN, [65] “nt-windows-online.com;nt-windows-update.com;nt-windowscheck.com”)\nSetOption(conn_a.J_MODE, 0x0033)\nSetOption(conn_a.J_NAME, [15] “/cgi-bin/nt/th”)\nSetOption(conn_a.J_PASS, 0x00)\nSetOption(conn_a.J_RPRT, [3] “80”)\nSetOption(conn_a.J_SPRT, [3] “80”)\nSetOption(conn_a.J_USER, [21] %removed% )\nSetOption(arplugin_loc, 76288 bytes buffer )\nSetOption(arplugin_name, 28 bytes buffer )\nCall(task_arplugin)\n\n#### Main function (task_arplugin)\n\nThe module retrieves the Adobe Reader installation path by reading the registry value:\n\nHKLMSOFTWAREClassesSoftwareAdobeAcrobatExe@default\n\nThen, it tries to identify the version of installed software by searching for strings “10.0”, “9.0”,\n“8.0” in the installation path. If none of them are found, it aborts installation with error.\n\nIf installation path contains the string “10.0”, the module tries to open the existing registry key:\n\nHKCUSOFTWAREAdobeAcrobat Reader10.0\n\nIf the key exists, then writes “Privileged=’ON'” into its log and sets the following registry key,\neffectively disabling the “protected mode” of the Adobe Reader:\n\nHKCUSOFTWAREAdobeAcrobat Reader10.0PrivilegedbProtectedMode=0\n\nThen, the module extracts the Acrobat Reader plugin body from the configuration option\n“arplugin_loc” (specified in the resource) and writes it to:\n\n%acrobat reader installation path%plug_ins%arplugin_rem option value%\n\nIt also retrieves the last write time of the plug_ins directory and sets the plugin’s last write time to\nthe same value.\n\nAfter completing the installation, the module sends its log file to the C&C server. The connection\noptions are retrieved from the configuration (resource):\n\n\n-----\n\nD_CONN List of C&C domain names, separated by\n‘;’\n\nD_RPRT C&C server port\n\nD_NAME Relative URL to send request to\n\nThe data send to the C&C server is compressed with Zlib and encrypted with a modified PKZIP\nstream cipher, and then it is Base64-encoded.\n\n## 8. Spreading group\n\n### Fileputexec module\n\nKnown variants:\n\n**MD5** **Compilation date (payload)**\n\n6FE7EB4E59448E197BDFAE87247F3AE6 2012.09.06 07:55:31 (GMT)\n\nED5FF814B10ED25946623A7EC2C0A682 2012.09.06 07:55:31 (GMT)\n\n37B443893551C1537D00FD247E3C9A78 2012.09.06 07:55:31 (GMT)\n\n#### Summary\n\nThe file is a PE DLL file without exported functions, compiled with Microsoft Visual Studio 2010.\nKnown samples share one code section, but contain different payloads in the resource section.\nAll the functionality is implemented in the DllMain function. It writes files from its configuration\nresource to disk and starts a new process from these file(s).\n\n#### DllMain\n\nWhen loaded, the module retrieves its resource of type “BBB” and name “AAA”, and starts an\ninternal plugin framework. The main function of the module is named “task_fileputexec” and is\nregistered in the framework. Then, it starts the framework main loop, effectively parsing the\nresource data and executing the list of actions encoded in the resource.\n\nDecoded resource data for the module can be represented as the following script:\n\nSetOption(conn_a.VERSION_ID, [6] “51070”)\nSetOption(conn_a.VER_SESSION_ID, %removed%)\nSetOption(conn_a.SEND_DELAY_TIME, [5] “2000”)\nSetOption(conn_a.D_CONN, [65] “nt-windows-online.com;nt-windows-update.com;nt-windowscheck.com”)\nSetOption(conn_a.D_MODE, 0x0033)\nSetOption(conn_a.D_NAME, [15] “/cgi-bin/nt/sk”)\nSetOption(conn_a.D_PASS, 0x00)\nSetOption(conn_a.D_RPRT, [3] “80”)\nSetOption(conn_a.D_SPRT, [3] “80”)\nSetOption(conn_a.D_USER, [21] %removed%)\nSetOption(conn_a.J_CONN, [65] “nt-windows-online.com;nt-windows-update.com;nt-windows\n\n-----\n\nSetOption(conn_a.J_NAME, [15] /cgi-bin/nt/th )\nSetOption(conn_a.J_PASS, 0x00)\nSetOption(conn_a.J_RPRT, [3] “80”)\nSetOption(conn_a.J_SPRT, [3] “80”)\nSetOption(conn_a.J_USER, [21] %removed%)\nSetOption(file_loc)\nSetOption(file_rem)\nSetOption(file_exec_rem)\nSetOption(file_loc, 156898 bytes buffer )\nSetOption(file_rem, 100 bytes buffer )\nCall(task_fileputexec)\n\n#### Main function (task_fileputexec)\n\nThe module implements two distinct functions:\n\nIt writes files from its configuration resource to disk\nIt starts executable files specified in the resource\n\nFirst, the module looks for pairs of configuration options called “file_rem” and “file_loc”. The\nmodule iterates through all “file_rem” options, reads the corresponding “file_loc” value and writes\nthe contents of the latter option to disk, using the value of “file_rem” as a filename.\n\nThe “file_rem” value can specify a location at another computer’s network share. In this case the\nmodule tries to log onto that share using credentials specified in an encrypted configuration file\nthat may be located at:\n\n%ALLUSERSPROFILE%adt.dat\n%LOCALAPPDATA%adt.dat\n\nKnown variants of the module were used to write another module called “scheduler” and\nadditional files for this module.\n\nAfter processing all “file_rem” and “file_loc” options, the module iterates through all values of the\n“file_exec_rem” option. Each value is expected to be an applications path, and each application is\nexecuted using the CreateProcess API function.\n\nAfter processing all the configuration options, the module sends its log file to the C&C server.\nThe connection options are retrieved from the configuration (resource):\n\n**Option name** **Description**\n\nD_CONN List of C&C domain names, separated by\n‘;’\n\nD_RPRT C&C server port\n\nD_NAME Relative URL to send request to\n\nThe data sent to the C&C server is compressed with Zlib and encrypted with a modified PKZIP\nstream cipher, and then it is Base64-encoded.\n\n### Netscan module\n\n\n-----\n\n**MD5** **Compilation date**\n\n06ebdde6a600a65e9e65ba7c63f139fa 2012.09.05 07:02:28 (GMT)\n\nb49232652748ab677a944bd4d4650603 2012.09.05 07:02:28 (GMT)\n\n#### Summary\n\nThe file is a PE DLL file without exported functions, compiled with Microsoft Visual Studio 2010.\nAll the functionality is implemented in the DllMain function.\n\nOnce it is loaded it was designed to start scanning other hosts in the network and record\nresponses. It would do several probes for remote vulnerabilities, such as MS08-067. It is capable\nof dumping current configuration of Cisco routers if they are available via SNMP and the scanner\nsuccessfully guessed the SNMP community name.\n\nThis module loads a config from local resource AAA and executes a network scanning task.\n\n#### Loading procedure\n\nDue a design made by the developer usage of this module is limited. It seems that it was\ndeveloped and tested as an EXE file, however in the release version it was compiled as a DLL.\nThis change was extremely significant for the whole functionality which creates a number of\nworker threads right in the main function, which is would be fine for EXE module WinMain\nfunction, but is restrcited for library DllMain function. This broke down the module as it created\nthreads which couldn’t run when DLL is loaded via LoadLibrary API. However, it’s important to\nnote that the developers implemented own PE loader, which doesn’t have such limitation as\nWindow native PE loader, and which is why it can still be used as a component of malicious kit.\n\n#### DllMain function\n\nCurrent sample has the following embedded config:\n\nSetOption(conn_a.D_CONN, [65] “nt-windows-online.com;nt-windows-update.com;nt-windowscheck.com”)\nSetOption(conn_a.D_NAME, [15] “/cgi-bin/nt/sk”)\nSetOption(conn_a.D_RPRT, [3] “80”)\nSetOption(conn_a.D_SPRT, [3] “80”)\nSetOption(conn_a.D_USER, [21] “%removed%”)\nSetOption(conn_a.D_MODE, 0x0033)\nSetOption(conn_a.D_PASS, 0x00)\nSetOption(conn_a.J_CONN, [65] “nt-windows-online.com;nt-windows-update.com;nt-windowscheck.com”)\nSetOption(conn_a.J_NAME, [15] “/cgi-bin/nt/th”)\nSetOption(conn_a.J_USER, [21] “%removed%”)\nSetOption(conn_a.J_RPRT, [3] “80”)\nSetOption(conn_a.J_SPRT, [3] “80”)\nSetOption(conn_a.J_MODE, 0x0033)\nSetOption(conn_a.J_PASS, 0x00)\nSetOption(conn_a.VERSION_ID, [6] “51070”)\n\n\n-----\n\nSetOption(NET, [26] 127.0.0.1 255.255.255.255 )\nSetOption(netscan_get_NET, “1”)\nSetOption(netscan_get_net_ad, “1”)\nSetOption(netscan_get_net_msnet, “1”)\nSetOption(netscan_get_net_msdom, “1”)\nSetOption(netscan_threads_num, [3] “64”)\nSetOption(netscan_tcpscanwinsrv, “1”)\nSetOption(netscan_tcpscanwin, “0”)\nSetOption(netscan_tcpscannotwin, “0”)\nCall(task_netscan)\n\nThe target networks to scan are selected automatically and include the following lists:\n\n1. specified in the config NET variable if netscan_get_NET is set to 1\n2. subnets of IPs which are visible from adapters config via GetAdaptersInfo API (current IP,\n\ngateway, DHCP, WINS servers)\n3. subnets of IPs which are visible in the list of currently mapped shared folders\n4. subnets of IPs which are part of current Microsoft Windows domain as reported by the\n\nDomain Controller\n\n#### Scanning procedure\n\nThe scan begins with pinging the target with 2 seconds timeout. Then the scanner gets target\nhostname and MAC address. After that it tries to send an SNMPv3 request. Unlike SNMPv2,\nSNMPv3 responds even if the username is wrong allowing you to identify if the port is open or\nnot. If the remote SNMP agent responds, then the scanner will try to talk further.\n\nSNMP packet from malware in Wireshark\n\nIt tries to guess the SNMP agent community name from a list of 600 hardcoded variants. The list\nitself interesting enough as it seems to be made of previously discovered SNMP agent\ncommunity names from various locations where the attackers managed to penetrate networks.\n\nWe are sharing the list, maybe it will help someone identify his SNMP community name and will\ncause further network checks:\n\n\n-----\n\nprivate Private hp_admin publis\n\n1q2w3e Ptbnic i6666 publiw\n\n1q2w3e4r Ptcmic icces publkB\n\n1q2w3e4r5t PuBMic ilmi publkc\n\n1q2w3e4r5t6y Public intelligence publmc\n\ncscAstral RM24655521 intermec publoc\n\n@5tr0Mon1 RcFnsSnCo20m08R internal publxc\n\n1qazxsw23edc RnfE36mM ipko publyc\n\n3edcxzaq12 RoaringKat ipxint publ{C\n\n123ewqasdcxz SECRET itorocmn publ{c\n\n!@#ewqASDcxz SECURITY jessica pubmi?\n\n!QAZxcde32 SINetMGT jg214327 pubmia\n\nqsczse SNMP jimaguas pubmic\n\n234rfvcxsw SNMP_trap jozefina pubn\n\n$3eTn27W#7 SPBranc1d-Rw jpiworldwide pubn)c\n\n10101 SWITCH karZer pubni?\n\n3101974 SYSTEM kazeem pubni?”\n\n0392a0 SbcihAiryq52 kbiway2007 pubnib\n\n41309 Secret kbiway2008 pubnic\n\n6051983 Security kerrek pubpc1\n\n80808 Si4m2010AyZnFkDe45L kittec pucliC\n\n0ublic Slay1987 kokale puclic\n\n1021947 Soco kokale1980 puclic?\n\n1100293 Sr.h3Q6i koko puclik\n\n112511polo Switch konsulro pucmic\n\n1212x System korablik pufl\n\n123123321 TENmanUFactOryPOWER korona puflic\n\n1234 TEST krakoziabra pufli{\n\n123456 TRD_VSAT kuwait pufmyc\n\n12345678 W1ld#Parr0ts kyw.u61 puglic\n\n1,23457E+17 YDFWgSKh lapublic pujlic\n\n1,23457E+17 YXaLmb1t5Ras laura pur-i?\n\n123o321 YsZpL5RqMa76 lebanon pur??1\n\n126ajm19kal51ma Z123456z lfcadoot purlic\n\n\n-----\n\n1,32413E+15 ublic linda pusac\n\n13244231 a1b2c3d4 louvain pwbli#\n\n13971852654 absurdistan_81 loveme pwblic\n\n162534 access macedonia pwjlic\n\n17081- adimn makbank23 p}1??1\n\n170810 admin manager qazwsx\n\n1809BGD11 admin1 manuel qazxcdew\n\n1940117 adonis mariam qubl?3\n\n1947102 agent marius qwedcxza\n\n19841990 agent_steal martin qwer1234\n\n199397 ajutorsoci mary1964 qwerty\n\n19M1R20S akjol1230 meerim0909 qwerty123456\n\n1Q5IRJmg9Q alfa239 merlin62 qwertyu\n\n1q2w3e alfa2390 mesurucu qwertyui\n\n1q2w3e4r alfred metiha r0snmp$tr1ng\n\n1q2w3e4r5t all private mfa123MFA r23771\n\n1q2w3e4r5t6y all public mfa6789 rainbow\n\n1qazxsw23edc alpha mfalOVAL rbnpublic\n\n2005 amBa3#wsx mimoza rccm-map\n\n21012008a amsterdam2003 mirella read\n\n212321a andrey240787 mirella26091978 read-only\n\n24021985 antoniu mitrkq1w2e3 read-write\n\n240787 arbor mmat1230 readonly\n\n2531821 assistant2007 mmat1987 readwrite\n\n280d1a03 astalavista mngt regional\n\n285468339 at.prague mofa rekzi\n\n29091972 at@szat mohammed richka\n\n2read aublic moni4man rm5tbd23\n\n31sal999 auok12 monitor rmon\n\n378dd6 avsvMda monitoring rmon_admin\n\n3DB5ZG baborasa1234 mq5Kg9iG ro4orion\n\n3MC-Zuku-Rw backb00r mrtg ro81qnp4\n\n43827207V backupauto ms03101974 roembil\n\n4changes badarsul msnadm romania2\n\n\n-----\n\n549yotok bandwidth nasasiet router\n\n553322 bar789 nasawr1 rusinfonet\n\n5bpbpyHeLu0a9Ab bathclnet nature rw4orion\n\n5zzkzp batru_ro netman rwcfcmp1s\n\n626fqs benj2023 netman2002 s3cr3t\n\n63Fd6dYhMnsjMNPk benjaminfranklin network sabonis\n\n654321 bintec nina180754 safara\n\n6551318 blue none salvaje07\n\n693ygUgv boksha noppes san-fran\n\n722690 br0adwhy norformin sanfran\n\n7777777inchinas bratan notprivate sayyara\n\n789456 breakpoint notpublic scotty\n\n7917407 bumblebee notpulic seCtion%\n\n794613 bunnia2010 nr.490315 seait\n\n7nsi20 c20176 ntnhflm secret\n\n7p1cCcZvqY6T cable-d nurtenbay security\n\n80244 cable-docsis nvaiaJC4 sel1\n\n816836 canon_admin okoloamaraa seri\n\n83L80N3 ccrthwtd openview sirti\n\n8491 cde32wsxzaq1 oyeneye sitalan\n\n8591 chelyabinsk p0l!@#nms skl1971\n\n8888888 chera98888 p3j4nt4n slamat\n\n8ublic chiaro p5blic snmc-read\n\n8urlib chumburidze p9EGn25D snmp\n\ncisco pUbhic snmpd\n\nAKdGmjQO cisco-adsl parrral snmptrap\n\nANYCOM clingendael pass solaris\n\nAdmin cme_1823 password sonjaGRIESEL7475@31\n\nAfoltz-PB commread pgnred sovam\n\nAllahu community picpu sp3ctr0\n\nAndrey131201 commwrite polaris stanislavl\n\nBl234353 control polmrtg stopsign\n\nC0de corba polsnmp superuser\n\nC0mmunity[hezt00a1 core porneste switch\n\n\n-----\n\nC0mmunity[hezt00aa3 cp8S52aA pounette t1HAI2nai\n\nC0mmunity[hezt00b1 cpecwr99 power222 talgat\n\nC495y5m6T1 cpecww99 ppb(260685) tasevski1980\n\nCISCO cs1bhS8W pqblic tech\n\nCONSIP_MIB csi-rain pqpq-1957 telecom\n\nCR52401 cucurigu pr1ap1014 temp\n\nD1g!T da123456 pr1v4t3 test\n\nDNOT?ISTLE dasakirov priemnaja test123\n\nDNOTHISTLE debug privat test2\n\nE142BERLINO deeplomat provision tiv0li\n\nEC_IMCO default proxy tivoli\n\nET0021B7E49CC9 dilbert prtgmail topnet\n\nG1Mme1nf0 diver pu6lik toto29+\n\nGINL-!M3npEFF dk0208 pu?hi? trap\n\nGN0CR3AD dollys pu?l trappss\n\nGSBTBMPLS! drazen024 pu?l)c traps\n\nGWAN_g,2b?l?m0nit0r efimerida pu?lb udelcakil\n\nGWAN_gl0baL??k?? elchin2491 pu?lib undefined\n\nGWAN_gl0bal_m0gid0r elen24 pu?lic uragan\n\nGWAN_gl0bal_m0nit0? eman72 pu?lik user\n\nGWAN_gl0bal_m0nit0r embassy pu?lyc vakvouk2008\n\nGWAN_gl0bal_mxJ?6?v enable puBlic vanoord-ro\n\nGulNozMeh f6PF3T9T pu lic vfczyz\n\nHDDBELBXL fabian pub?ic victor\n\nHITMAN fake2011 pubdic vizirenok\n\nILMI fastanefnd1 pubhic vkananovich\n\nIntermec field publ vpnaccount\n\nJedeee71 field-service publ)c vt100num\n\nJoJo finance publ1c w03kdpopmail\n\nKBRlog3CPRK forescout publ?3 wallace\n\nL#39YWh7N16w fourthmile publac world\n\nLcxuidtg freekevin publhc write\n\nMailbox fubar publi# writeletters\n\nManyasha fwrocmn publi+ xs159109\n\n\n-----\n\nNURTENEKREM g0v53vM3 publia yOpZpXjI\n\nNoGaH$@! germanos publib yellow\n\nOrigEquipMfr gestione public!!! z4885645\n\nP@SSW0RD gsoficom14 public1 zafar\n\nPRIVATE gu#3Gst. public2 zskmail\n\nPUBLIC guest public3 zxcvbn\n\nPetr0fc gulbalam public? zzzzz\n\nPetr0fac gwendal publig\n\nPetr0fac? hello publik\n\nThe scanner fetches SNMP agent SysName property and checks if the property is readonly or\nwrite-access is available. Then it fetches SNMP SysDescription property.\n\nInterestingly, when the module finds a Cisco snmp agent, it starts own TFTP server and transfers\nCisco device configuration via TFTP.\n\nCISCO configuration dumper function call graph\n\nNext it checks host for SIP service. That is accomplished by sending OPTIONS request to the\nremote host on port 5060 from hardcoded source port 11122:\n\nOPTIONS sip:smap@localhost SIP/2.0\nVia: SIP/2.0/UDP %Local IP%:11122;branch=z9hG4bK.51125;rport;alias\nFrom: ;tag=3a539be23b6269ec\nTo: sip:IPPhone@localhost\nCall-ID: 1638708638@%Local IP%\nCSeq: 3471 OPTIONS\nContact:\nContent-Length: 0\nMax-Forwards: 70\nUser-Agent: IPPhone 0.67\n\n\n-----\n\nNext it tries to work with NetBIOS (SMB) protocol of the remote target, the code includes full own\nimplementation of the protocol negotiatiation and communication with the remote host. The\nmodule establishes SMB NULL session, which doesn’t require authentication and sends further\nqueries.\n\nThe scanning module connects to LLSRPC pipe, which is used to be available via SMB NULL\nsession on Windows 2000 before SP4. If the attacker connects to Microsoft Windows 2000\nServer-based system through a null session, it is possible to use the Llsrpc named pipe to add or\nto delete licenses, and to create new license groups. However, availability of LLSRPC pipe is\nchecked only to detect the remote OS Service Pack version. There are few other methods in the\ncode that provide reliable detection of Service Pack 1,2,3 of Windows 2000.\n\nNext step is to detect remote OS default language. That is accomplished by connecting to\nSpoolss pipe and querying the name of the service. The response is normally sent in system\ndefault language, which is detected by the module. Here is a list of languages, which might\nindicate which systems attackers are interested in (hardcoded in the malware):\n\nUNKNOWN English Spanish Italian\n\nFrench German Portuguese – Brazilian Portuguese\n\nHungarian Finnish Dutch Danish\n\nSwedish Polish Czech Turkish\n\nJapanese Chinese Traditional Chinese Traditional – Taiwan Korean\n\nRussian\n\nSo far, the module collects the following information over SMB:\n\nTarget Name\nNetBIOS Domain Name\nNetBIOS Computer Name\nDNS Domain Name\nDNS Computer Name\nLanguage\nService Pack\nOS Version\nOS Major Version Number\nOS Minor Version Number\nOS Build\nOS Language ID\nOS Version (alternative detection method)\nOS Language (alternative detection method)\n\nThe module has another unique feature, it checks if the system is vulnerable for MS08-067\nvulnerability. It creates a path, part of which includes a unique string “..spider3” which we haven’t\nseen previously. The module is capable of constructing tcpbind shellcode for different versions\nof remote OS to check if the exploit works.\n\nThere is a portscanner in the module and it checks ports from the embedded list:\n\n\n-----\n\n8080, 8800\n\nWhile most of the ports look standard, some of them are not very common. We decided to\ninvestigate which services are running on those ports.\n\n156 is some SQL Server port, however we don’t know any software running on port 156\n456 is probably a typo of 465 – SMTP over SSL\n912 is for VMWare Authorization Service\n990 is used by FTPS\n995 is for POP3S\n1043 can be used by BOINC software or Microsoft IIS\n1194 is a standard port for OpenVPN\n1352 Lotus Notes/Domino RPC\n1433 MS SQL Server\n2481 Oracle Server\n3306 MySQL Server\n5432 PostgreSQL\n8080 HTTP (alternate)\n8800 HTTP (SunWebAdmin)\n\nIf ports 80 or 8080 are open, then the module sends simple HTTP request to test if the remote\nwebserver is available and if it is running MS Excahnge server. MS Exchange is probed with the\nfollowing HTTP request:\n\nGET /ews/exchange.asmx HTTP/1.0\n\nCollected information and logs are never saved to a file on disk, instead it is compressed using\nZlib compress2 method and uploaded to the server.\n\n### MSExploit module\n\nKnown variants:\n\n**MD5** **Compilation date**\n\n51900a2bb1202225aabc2ee5a64dbe42 2012.06.26 15:11:48 (GMT)\n\n#### Summary\n\nThe file is a PE DLL file without exported functions, compiled with Microsoft Visual Studio 2010.\n\nAll the functionality is implemented in the DllMain function.\n\nThis module is used to infect other computers in local area network by using old exploit for\nvulnerability referred as MS08-067. It checks remote OS version, locale, SP version, crafts a\npacket with exploit code and pushes to the target. It injects an executable payload, which drops\nanother module known as “Frog” (full description of Frog is available in a separate chapter). The\nlater is a backdoor component which provides capability to run arbitrary executable on the\nremote target.\n\n#### DllMain function\n\n\n-----\n\ninternal plugin framework. The main function of the module is named “task_msexploit” and is\nregistered in the framework. Then, it starts the framework main loop, effectively parsing the\nresource data and executing the list of actions encoded in the resource.\n\nThe decoded resource data for the known sample can be represented as the following script:\n\nSetOption(conn_a.VERSION_ID, [6] “11997”)\nSetOption(conn_a.VER_SESSION_ID, %removed%)\nSetOption(conn_a.SEND_DELAY_TIME, [5] “2000”)\nSetOption(conn_a.D_CONN, [60] “microsoftosupdate.com;microsoftmsdn.com;microsoftcheck.com”)\nSetOption(conn_a.D_MODE, 0x0033)\nSetOption(conn_a.D_NAME, [18] “/cgi-bin/ms/flush”)\nSetOption(conn_a.D_PASS, 0x00)\nSetOption(conn_a.D_RPRT, [3] “80”)\nSetOption(conn_a.D_SPRT, [3] “80”)\nSetOption(conn_a.D_USER, [21] “%removed%”)\nSetOption(conn_a.J_CONN, [60] “microsoftosupdate.com;microsoftmsdn.com;microsoftcheck.com”)\nSetOption(conn_a.J_MODE, 0x0033)\nSetOption(conn_a.J_NAME, [18] “/cgi-bin/ms/check”)\nSetOption(conn_a.J_PASS, 0x00)\nSetOption(conn_a.J_RPRT, [3] “80”)\nSetOption(conn_a.J_SPRT, [3] “80”)\nSetOption(conn_a.J_USER, [21] “%removed%”)\nSetOption(msexploit_loc, 147456 bytes PE file )\nSetOption(msexploit_ip)\nSetOption(msexploit_ip, [16] “%Target IP%”)\nCall(task_msexploit)\n\n#### Main function (task_msexploit)\n\nThe config defines parameters for the method task_msexploit, which includes the following:\n\nmsexploit_loc – a payload to be pushed if exploit worked successfully;\nmsexploit_ip – an array of IPs to attack.\n\nThen the module gets local proxy settings, starting from MS Internet Explorer settings, then\nparsing Opera profile files (if exist) and finally getting proxy settings from quite suspicious\nregistry keys:\n\nHKCUSoftwareMicrosoftWindowsCurrentVersionExplorerAdvancedMapMenuConfigGrps\nHKLMSoftwareMicrosoftWindowsCurrentVersionExplorerAdvancedMapMenuConfigGrps\nHKCUSoftwareWow6432NodeMicrosoftWindowsCurrentVersionExplorerAdvancedMapMenuConfigGrps\nHKLMSoftwareWow6432NodeMicrosoftWindowsCurrentVersionExplorerAdvancedMapMenuConfigGrps\n\nIt seems that MapMenuConfigGrps registry value doesn’t exist on standard Windows system.\nWe suspect that this registry key is set by a malicious module during operation and is used to\nstore proxy server parameters.\n\n\n-----\n\nand user-specific, i.e.:\n\nC:Documents and SettingsAll UsersApplication Data\nC:Documents and SettingsusernameApplication Data\n\nThe “adt.dat” file is an encrypted INI-file of known credentials of users in current domain and\nattacked organization. When decrypted this file looks like this:\n\n[user] login = “%User1%”\ndomain = “%Domain%”\npassword = “%Password2%”\nadmin = “1”\n\n[user] login = “%User2%”\ndomain = “%Domain%”\npassword = “%Password2%”\nadmin = “1”\n\nThis information is checked against local domain controller to find active users with Admin\nprivileges. Verified account is used for optional functionality to establish a NetBIOS connection\nwith remote host to change remote registry. However, the only setting that is changed is\n**MapMenuConfigGrps value mentioned above. It is set to local parameters of system proxy server**\nwhich were acquired before. This is done right after the main attack procedure which uses\nvulnerability from MS08-067 Security Bulletin.\n\nThe MS08-067 attack procedure uses code identical to the code of scanning for vulnerable hosts\nin Netscan module. It starts with pinging the host with ICMP Echo requests and checking host\navailability. Then it does complex OS fingerprinting using several different approaches to guess\nOS version, OS language and Service Pack version. After that it crafts special packet and embeds\na payload from AAA config (binary parameter named msexploit_loc, see above).\n\nIn the end of exploitation process, the module checks availability of the remote host by sending\nICMP Echo requests again.\n\nThis module doesn’t change local registry, nor does it created any local files.\n\nAfter completing remote attack, the module sends logs to the C&C server. The connection\noptions are retrieved from the configuration (resource):\n\n**Option name** **Description**\n\nD_CONN List of C&C domain names, separated by\n‘;’\n\nD_RPRT C&C server port\n\nD_NAME Relative URL to send request to\n\nThe data send to the C&C server is compressed with Zlib and encrypted with a modified PKZIP\nstream cipher, and then it is Base64-encoded.\n\n### DASvcInstall module\n\nKnown variants:\n\n\n-----\n\n7ade5d2a88c1eeefe47b501b19c383ef 2012.06.26 15:11:34 (GMT)\n\n#### Summary\n\nThe file is a PE DLL file without exported functions, compiled with Microsoft Visual Studio 2010.\n\nAll the functionality is implemented in the DllMain function. This module is used to infect other\ncomputers in local area network by another module known as “Frog” (full description of Frog is\navailable in a separate chapter), which is embedded in current executable.\n\nThe later is a backdoor component which provides capability to run arbitrary executable on the\nremote target. To infect other computers current module uses adt.dat password database file.\nThis contains credentials of administrator accounts. The credentials are used to access system\nadministrative share and remotely install the backdoor as a service.\n\n#### DllMain function\n\nWhen loaded, the module retrieves its resource of type “BBB” and name “AAA”, and starts an\ninternal plugin framework. The main function of the module is named “task_da_svcinstall” and is\nregistered in the framework. Then, it starts the framework main loop, effectively parsing the\nresource data and executing the list of actions encoded in the resource.\n\nThe decoded resource data for the known sample can be represented as the following script:\n\nSetOption(conn_a.VERSION_ID, [6] “11997”)\nSetOption(conn_a.VER_SESSION_ID, %removed%)\nSetOption(conn_a.SEND_DELAY_TIME, [5] “2000”)\nSetOption(conn_a.D_CONN, [60] “microsoftosupdate.com;microsoftmsdn.com;microsoftcheck.com”)\nSetOption(conn_a.D_MODE, 0x0033)\nSetOption(conn_a.D_NAME, [18] “/cgi-bin/ms/flush”)\nSetOption(conn_a.D_PASS, 0x00)\nSetOption(conn_a.D_RPRT, [3] “80”)\nSetOption(conn_a.D_SPRT, [3] “80”)\nSetOption(conn_a.D_USER, [21] “%removed%”)\nSetOption(conn_a.J_CONN, [60] “microsoftosupdate.com;microsoftmsdn.com;microsoftcheck.com”)\nSetOption(conn_a.J_MODE, 0x0033)\nSetOption(conn_a.J_NAME, [18] “/cgi-bin/ms/check”)\nSetOption(conn_a.J_PASS, 0x00)\nSetOption(conn_a.J_RPRT, [3] “80”)\nSetOption(conn_a.J_SPRT, [3] “80”)\nSetOption(conn_a.J_USER, [21] “%removed%”)\nSetOption(da_svc_exe_loc, 103424 bytes of Frog backdoor)\nSetOption(da_svc_exe_name, “testsvc_00.exe”)\nSetOption(da_svc_name, “testsvc_00_name”)\nSetOption(da_svc_send_proxy, 0x0079)\nSetOption(da_svc_host)\nSetOption(da_svc_host, [15] “%Target1_IP%”)\n\n\n-----\n\nSetOption(da_svc_host, [16] %Target3_IP% )\nCall(task_da_svcinstall)\n\n#### Main function (task_da_svcinstall)\n\nThe config defines parameters for the method task_da_svcinstall, which includes the following:\n\nda_svc_exe_loc – a payload with “Frog” backdoor to be pushed to the remote host;\nda_svc_exe_name – defines filename that will be used to store the backdoor;\nda_svc_name – defines service name that will be used to setup the backdoor service;\nda_svc_send_proxy – if this value is set to 0x79, remote host proxy preferences will be\ncopied from current host to the remote registry;\nda_svc_host – is a list of target hosts to attack.\n\nThen the module gets local proxy settings, starting from MS Internet Explorer settings, then\nparsing Opera profile files (if exist) and finally getting proxy settings from quite suspicious\nregistry keys:\n\nHKCUSoftwareMicrosoftWindowsCurrentVersionExplorerAdvancedMapMenuConfigGrps\nHKLMSoftwareMicrosoftWindowsCurrentVersionExplorerAdvancedMapMenuConfigGrps\nHKCUSoftwareWow6432NodeMicrosoftWindowsCurrentVersionExplorerAdvancedMapMenuConfigGrps\nHKLMSoftwareWow6432NodeMicrosoftWindowsCurrentVersionExplorerAdvancedMapMenuConfigGrps\n\nIt seems that MapMenuConfigGrps registry value doesn’t exist on standard Windows system.\nWe believe that this registry key is set by a malicious module during operation and is used to\nstore proxy server parameters.\n\nAfter that, the module attempts to find %AppData%adt.dat. Two variants are checked – common\nand user-specific, i.e.:\n\nC:Documents and SettingsAll UsersApplication Data\nC:Documents and SettingsusernameApplication Data\n\nThe “adt.dat” file is an encrypted INI-file of known credentials of users in current domain and\nattacked organization. When decrypted this file looks like this:\n\n[user] login = “%User1%”\ndomain = “%Domain%”\npassword = “%Password2%”\nadmin = “1”\n\n[user] login = “%User2%”\ndomain = “%Domain%”\npassword = “%Password2%”\nadmin = “1”\n\nThis information is checked against local domain controller to find active users with Admin\nprivileges. Verified account is used for optional functionality to establish a NetBIOS connection\nwith remote host to change remote registry. However, the only setting that are changed is\n**MapMenuConfigGrps value mentioned above. It is set to local parameters of system proxy server**\nwhich were acquired before.\n\n\n-----\n\nservice is running. If it does the module uses Service Control Manager to stop the remote service.\nThen it copies Frog backdoor file embedded in AAA config/script to the remote path\n%Target%ADMIN$%SYSTEM%testsvc_00.exe.\n\nAfter that it starts the service using Service Control Manager and checks if the Frog backdoor\nsuccessfully started by querying its status over named pipe %Target%pipenetNtControlListener\nor via direct TCP connection on port 4444.\n\nCurrent module has some extra features that are not being used according to embedded config.\nIn addition to function called task_da_svcinstall it has 3 others:\n\ntask_da_svcuninstall- to remove the installed Frog service and its file;\ntask_da_svcstatus- to check the remote Frog service status via Service Control Manager;\ntask_da_rem_proxy – transfer current proxy preferences to the remote host.\n\nThis module doesn’t change local registry, nor does it created any local files.\n\nAfter completing remote attack, the module sends logs to the C&C server. The connection\noptions are retrieved from the configuration (resource):\n\n**Option name** **Description**\n\nD_CONN List of C&C domain names, separated by\n‘;’\n\nD_RPRT C&C server port\n\nD_NAME Relative URL to send request to\n\nThe data send to the C&C server is compressed with Zlib and encrypted with a modified PKZIP\nstream cipher, and then it is Base64-encoded.\n\n### Frog module\n\nKnown variants:\n\n**MD5** **Compilation date**\n\n595e29a21ecaa4dfcb3a5db18401a9a8 2012.05.28 08:56:10 (GMT)\n\n#### Summary\n\nThe file is a PE DLL file without two exported functions (ServiceMainand WinMessage), compiled\nwith Microsoft Visual Studio 2010.\n\nThis module is used to backdoor current computer and is used in pair with remote exploit\nmodules (i.e. ms_exploit). It is capable of running arbitrary executable code by saving a file\ncoming from another local machine or a C&C and starting it as a new process (EXE), loading it\nfrom disk to memory as a DLL or mapping it directly from memory and running in a “diskless”\nmode. It is designed to be lightweight module, which fits in 100Kb of data, doesn’t create any\nlogs and isn’t linked with any external libraries.\n\n#### DllMain\n\n\n-----\n\nresource and parses config parameters. Unlike most of other modules, config parameters for this\nmodule has different format, it is not a script-like config, but plain binary structure with integer\nand string values.\n\n#### ServiceMain\n\nIf current module is started by the system during Windows boot as a service, then ServiceMain\nfunction will be called by the system. The code in the function fetches Registry value from\nHKLMSOFTWAREMicrosoftWindows NTCurrentVersionSvcHostepvsvcsAuthCapabilitis, if this\nvalue is not set it will be set right away. The value is 20 bytes binary hash value of system\ndependent information (i.e. username, hostname). It is used as system ID.\n\nAfter that the module creates three independent threads:\n\nNamedPipeThread (server mode)\nThis thread creates a named pipe .pipenetNtControlListener (pipe name defined in the\n“AAA” config) and waits for incoming connections.\nTCPThread (server mode)\nThis thread opens a listening TCP port 4444 (port number defined in the “AAA” config) and\nwaits for incoming connections.\nCnCThread (client mode)\nThis thread sends a port requests to C&C server URL http://www.new-driverupgrade.com/cgi-bin/frog (defined in “AAA” config), containing current system\ninformation, including current user name, computer name, local ip address, domain name,\nsystem ID and more, gets and interprets a response.\n\nWhile NamedPipeThread and TCPThread work in server mode, which means that they are\nwaiting for incoming client connections and requests, the last thread CnCThread actively\nconnects to the C&C, uploads current system information and expects a response. The logics of\nprocessing transmitted data for all threads are similar. They can either send out data about\ncurrent system or receive and run an executable module. There are three variants of executables\nthat these modules can handle:\n\nEXE\nThe received module is stored on disk in %TEMP%system32uid.%Current Date and Time\nXORed with 0xA4F2%.tmp and started in a separate process with CreateProcess API.\nDLL\nThe received module is stored on disk in %TEMP%system32uid.%Current Date and Time\nXORed with 0xA4F2%.tmp and loaded in current process with LoadLibrary API.\nPE-IN-MEMORY\nThe received module is kept in memory of current process using own PE file loader.\n\n#### WinMessage function\n\nThis function combines DllMain and ServiceMain functions excluding system service manager\nroutines.\n\nThis module changes local registry and sets current system ID, as described above, it is also\ncapable of creating local files. It doesn’t make any local reports nor does it send execution logs\nto the C&C server. The only information sent to the C&C server is general system info during first\n\n\n-----\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2013/2013.01.14.Red_October_Campaign/securelist.com-Red%20October%20Detailed%20Malware%20Description%204%20Second%20Stage%20of%20Attack.pdf"
    ],
    "report_names": [
        "securelist.com-Red October Detailed Malware Description 4 Second Stage of Attack"
    ],
    "threat_actors": [
        {
            "id": "4b076dcb-516e-42fb-9c8f-f153902cd5e9",
            "created_at": "2022-10-25T16:07:23.708745Z",
            "updated_at": "2025-03-27T02:02:09.935617Z",
            "deleted_at": null,
            "main_name": "Hidden Lynx",
            "aliases": [
                "Aurora Panda",
                "Group 8",
                "Hidden Lynx",
                "Operation SMN"
            ],
            "source_name": "ETDA:Hidden Lynx",
            "tools": [
                "AGENT.ABQMR",
                "AGENT.AQUP.DROPPER",
                "AGENT.BMZA",
                "AGENT.GUNZ",
                "BlackCoffee",
                "HiKit",
                "MCRAT.A",
                "Mdmbot.E",
                "Moudoor",
                "Naid",
                "PNGRAT",
                "Trojan.Naid",
                "ZoxPNG",
                "gresim"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "f8dddd06-da24-4184-9e24-4c22bdd1cbbf",
            "created_at": "2023-01-06T13:46:38.626906Z",
            "updated_at": "2025-03-27T02:00:02.877001Z",
            "deleted_at": null,
            "main_name": "Tick",
            "aliases": [
                "Stalker Taurus",
                "PLA Unit 61419",
                "Nian",
                "BRONZE BUTLER",
                "REDBALDKNIGHT",
                "STALKER PANDA",
                "G0060"
            ],
            "source_name": "MISPGALAXY:Tick",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "761d1fb2-60e3-46f0-9f1c-c8a9715967d4",
            "created_at": "2023-01-06T13:46:38.269054Z",
            "updated_at": "2025-03-27T02:00:02.789278Z",
            "deleted_at": null,
            "main_name": "APT3",
            "aliases": [
                "TG-0110",
                "Group 6",
                "Buckeye",
                "Boyusec",
                "BORON",
                "BRONZE MAYFAIR",
                "Red Sylvan",
                "GOTHIC PANDA"
            ],
            "source_name": "MISPGALAXY:APT3",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "cf7fc640-acfe-41c4-9f3d-5515d53a3ffb",
            "created_at": "2023-01-06T13:46:38.228042Z",
            "updated_at": "2025-03-27T02:00:02.775905Z",
            "deleted_at": null,
            "main_name": "APT1",
            "aliases": [
                "GIF89a",
                "G0006",
                "PLA Unit 61398",
                "Group 3",
                "TG-8223",
                "Comment Group",
                "ShadyRAT",
                "COMMENT PANDA",
                "Comment Crew",
                "Byzantine Candor",
                "Brown Fox"
            ],
            "source_name": "MISPGALAXY:APT1",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "a7aefdda-98f1-4790-a32d-14cc99de2d60",
            "created_at": "2023-01-06T13:46:38.281844Z",
            "updated_at": "2025-03-27T02:00:02.792526Z",
            "deleted_at": null,
            "main_name": "APT17",
            "aliases": [
                "G0025",
                "AURORA PANDA",
                "Group 72",
                "G0001",
                "HELIUM",
                "Group 8",
                "Hidden Lynx",
                "Tailgater Team",
                "BRONZE KEYSTONE"
            ],
            "source_name": "MISPGALAXY:APT17",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "b69037ec-2605-4de4-bb32-a20d780a8406",
            "created_at": "2023-01-06T13:46:38.790766Z",
            "updated_at": "2025-03-27T02:00:02.919758Z",
            "deleted_at": null,
            "main_name": "MUSTANG PANDA",
            "aliases": [
                "TEMP.HEX",
                "TA416",
                "TANTALUM",
                "Twill Typhoon",
                "Earth Preta",
                "Stately Taurus",
                "LuminousMoth",
                "Polaris",
                "BRONZE PRESIDENT",
                "HoneyMyte",
                "Red Lich"
            ],
            "source_name": "MISPGALAXY:MUSTANG PANDA",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "06f622cb-3a78-49cf-9a4c-a6007a69325f",
            "created_at": "2022-10-25T16:07:23.315239Z",
            "updated_at": "2025-03-27T02:02:09.733197Z",
            "deleted_at": null,
            "main_name": "APT 3",
            "aliases": [
                "APT 3",
                "Bronze Mayfair",
                "Buckeye",
                "Gothic Panda",
                "Group 6",
                "Operation Clandestine Fox",
                "Operation Clandestine Fox, Part Deux",
                "Operation Clandestine Wolf",
                "Operation Double Tap",
                "Red Sylvan",
                "TG-0110",
                "UPS Team"
            ],
            "source_name": "ETDA:APT 3",
            "tools": [
                "APT3 Keylogger",
                "Agent.dhwf",
                "BKDR_HUPIGON",
                "Backdoor.APT.CookieCutter",
                "Badey",
                "Bemstour",
                "CookieCutter",
                "Destroy RAT",
                "DestroyRAT",
                "DoublePulsar",
                "EXL",
                "EternalBlue",
                "HTran",
                "HUC Packet Transmit Tool",
                "Hupigon",
                "Hupigon RAT",
                "Kaba",
                "Korplug",
                "LaZagne",
                "MFC Huner",
                "OSInfo",
                "Pirpi",
                "PlugX",
                "RedDelta",
                "RemoteCMD",
                "SHOTPUT",
                "Sogu",
                "TIGERPLUG",
                "TTCalc",
                "TVT",
                "Thoper",
                "Xamtrav",
                "remotecmd",
                "shareip",
                "w32times"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "d4e7cd9a-2290-4f89-a645-85b9a46d004b",
            "created_at": "2022-10-25T16:07:23.419513Z",
            "updated_at": "2025-03-27T02:02:09.790389Z",
            "deleted_at": null,
            "main_name": "Bronze Butler",
            "aliases": [
                "Bronze Butler",
                "CTG-2006",
                "Operation ENDTRADE",
                "RedBaldNight",
                "Stalker Panda",
                "Stalker Taurus",
                "TEMP.Tick",
                "Tick"
            ],
            "source_name": "ETDA:Bronze Butler",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "9002 RAT",
                "AngryRebel",
                "Blogspot",
                "Daserf",
                "Datper",
                "Elirks",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "HOMEUNIX",
                "HidraQ",
                "HomamDownloader",
                "Homux",
                "Hydraq",
                "Lilith",
                "Lilith RAT",
                "McRAT",
                "MdmBot",
                "Mimikatz",
                "Minzen",
                "Moudour",
                "Muirim",
                "Mydoor",
                "Nioupale",
                "PCRat",
                "POISONPLUG.SHADOW",
                "Roarur",
                "RoyalRoad",
                "ShadowPad Winnti",
                "ShadowWali",
                "ShadowWalker",
                "SymonLoader",
                "WCE",
                "Wali",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "XShellGhost",
                "XXMM",
                "gsecdump",
                "rarstar"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "bf0489c5-1c07-41e6-91c9-855ad96ccc6a",
            "created_at": "2022-10-25T16:47:55.541639Z",
            "updated_at": "2025-03-27T02:05:17.253496Z",
            "deleted_at": null,
            "main_name": "BRONZE BUTLER",
            "aliases": [
                "Daserf",
                "Stalker Panda ",
                "Tick ",
                "CTG-2006 "
            ],
            "source_name": "Secureworks:BRONZE BUTLER",
            "tools": [
                " DGet",
                " Daserf",
                " Datper",
                " Gofarer",
                " MSGet",
                " Mimikatz",
                " RarStar",
                " Screen Capture Tool",
                " ShadowPad",
                " T-SMB",
                " WinRAR",
                " Windows Credential Editor",
                " gsecdump",
                " xmm downloader",
                " xxmm",
                "ABK"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "3aaf0755-5c9b-4612-9f0e-e266ef1bdb4b",
            "created_at": "2022-10-25T16:07:23.480196Z",
            "updated_at": "2025-03-27T02:02:09.826059Z",
            "deleted_at": null,
            "main_name": "Comment Crew",
            "aliases": [
                "APT 1",
                "BrownFox",
                "Byzantine Candor",
                "Byzantine Hades",
                "Comment Crew",
                "Comment Panda",
                "GIF89a",
                "Group 3",
                "Operation Oceansalt",
                "Operation Seasalt",
                "Operation Siesta",
                "Shanghai Group",
                "TG-8223"
            ],
            "source_name": "ETDA:Comment Crew",
            "tools": [
                "Auriga",
                "Cachedump",
                "Chymine",
                "CookieBag",
                "Darkmoon",
                "GDOCUPLOAD",
                "GLOOXMAIL",
                "GREENCAT",
                "Gen:Trojan.Heur.PT",
                "GetMail",
                "Hackfase",
                "Hacksfase",
                "Helauto",
                "Kurton",
                "LETSGO",
                "LIGHTBOLT",
                "LIGHTDART",
                "LOLBAS",
                "LOLBins",
                "LONGRUN",
                "Living off the Land",
                "Lslsass",
                "MAPIget",
                "ManItsMe",
                "Mimikatz",
                "MiniASP",
                "Oceansalt",
                "Pass-The-Hash Toolkit",
                "Poison Ivy",
                "ProcDump",
                "Riodrv",
                "SPIVY",
                "Seasalt",
                "ShadyRAT",
                "StarsyPound",
                "TROJAN.COOKIES",
                "TROJAN.FOXY",
                "TabMsgSQL",
                "Tarsip",
                "Trojan.GTALK",
                "WebC2",
                "WebC2-AdSpace",
                "WebC2-Ausov",
                "WebC2-Bolid",
                "WebC2-Cson",
                "WebC2-DIV",
                "WebC2-GreenCat",
                "WebC2-Head",
                "WebC2-Kt3",
                "WebC2-Qbp",
                "WebC2-Rave",
                "WebC2-Table",
                "WebC2-UGX",
                "WebC2-Yahoo",
                "Wordpress Bruteforcer",
                "bangat",
                "gsecdump",
                "pivy",
                "poisonivy",
                "pwdump",
                "zxdosml"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716498,
    "ts_updated_at": 1743041685,
    "ts_creation_date": 1545363271,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/c38d19048cb7d66480d4e12c61fc0c3c8ebbc78d.pdf",
        "text": "https://archive.orkl.eu/c38d19048cb7d66480d4e12c61fc0c3c8ebbc78d.txt",
        "img": "https://archive.orkl.eu/c38d19048cb7d66480d4e12c61fc0c3c8ebbc78d.jpg"
    }
}