{
    "id": "e2ba199d-8564-42e3-b000-e0923bfb2f3e",
    "created_at": "2023-01-12T15:04:38.457331Z",
    "updated_at": "2025-03-27T02:11:00.26334Z",
    "deleted_at": null,
    "sha1_hash": "79895ebba66b2efc70846ffc4dcd8d682d1d4ad9",
    "title": "2020-06-22 - Web skimming with Google Analytics",
    "authors": "",
    "file_creation_date": "2022-05-29T01:17:29Z",
    "file_modification_date": "2022-05-29T01:17:29Z",
    "file_size": 1287928,
    "plain_text": "# Web skimming with Google Analytics\n\n**[securelist.com/web-skimming-with-google-analytics/97414/](https://securelist.com/web-skimming-with-google-analytics/97414/)**\n\nAuthors\n\n[Victoria Vlasova](https://securelist.com/author/victoria-vlasova/)\n\nWeb skimming is a common class of attacks generally aimed at online shoppers. The\nprinciple is quite simple: malicious code is injected into the compromised site, which collects\nand sends user-entered data to a cybercriminal resource. If the attack is successful, the\ncybercriminals gain access to shoppers’ payment information.\n\nTo make the data flow to a third-party resource less visible, fraudsters often register domains\nresembling the names of popular web services, and in particular, Google Analytics (googleanatytics[.]com, google-analytcsapi[.]com, google-analytc[.]com, google-anaiytlcs[.]com,\ngoogle-analytics[.]top, google-analytics[.]cm, google-analytics[.]to, google-analytics-js[.]com,\ngooglc-analytics[.]com, etc.). But attack of this kind were also found to sometimes use the\nauthentic service.\n\nTo harvest data about visitors using Google Analytics, the site owner must configure the\ntracking parameters in their account on analytics.google.com, get the tracking ID (trackingId,\na string like this: UA-XXXX-Y), and insert it into the web pages together with the tracking\n\n\n-----\n\ncode (a special snippet of code). Several tracking codes can rub shoulders on one site,\nsending data about visitors to different Analytics accounts.\n\nRecently, we identified several cases where this service was misused: attackers injected\nmalicious code into sites, which collected all the data entered by users, and then sent it via\nAnalytics. As a result, the attackers could access the stolen data in their Google Analytics\naccount. We found about two dozen infected sites worldwide. The victims included stores in\nEurope and North and South America selling digital equipment, cosmetics, food products,\nspare parts etc.\n\nThe screenshot below shows how the infection looks — malicious code with the attacker’s\ntracking code and tracking ID:\n\n**_Screenshot 1_**\n\nThe attacker tries to hide their malicious activity using a classic anti-debugging technique.\nScreenshot 2 shows code for checking whether Developer mode is enabled in the visitor’s\nbrowser. The code in the screenshot above is executed only if the result is negative.\n\n\n-----\n\n**_Screenshot 2_**\n\nCuriously, the attackers left themselves a loophole — the option to monitor the script in\nDebug mode. If the browser’s local storage (localStorage) contains the value\n**‘debug_mode’==’11’, the malicious code will spring into life even with the developer tools**\nopen, and will go as far as to write comments to the console in clumsy English with errors. In\nscreenshot 3, the line with the ‘debug_mode’ check follows the implementation of the RC4\nencryption algorithm (used to encrypt the harvested data before sending it).\n\n\n-----\n\n**_Screenshot 3_**\n\nIf the anti-debugging is passed, the script collects everything anyone inputs on the site (as\nwell as information about the user who entered the data: IP address, UserAgent, time zone).\nThe collected data is encrypted and sent using the Google Analytics Measurement Protocol.\nThe collection and sending process is shown in screenshot 4.\n\n**_Screenshot 4_**\n\nThe stolen data is sent by invoking the send event method in the ‘eventAction’ field.\n\nThe function signature in this case is:\n\n\n1\n\n2\n\n3\n\n4\n\n5\n\n\nga('send', 'event', {\n\n'eventCategory': 'Category', //Protocol Parameter: ec; Value type: text; Max Lenght:\n150 Bytes\n\n'eventAction': 'Action',  //Protocol Parameter: ea; Value type: text; Max Lenght: 500\nBytes\n\n'eventLabel': 'Label'   //Protocol Parameter: el; Value type: text; Max Lenght: 500\nBytes\n\n});\n\n\nThis leads to an HTTP request being sent to the URL\n\nhttps[:]//www.google-analytics.com/collect?<parameters>&ea=packed_stolen_data&\n<parameters>\n\n\n-----\n\nIn the above-described case, malicious code is inserted into a script on the infected site in\n“readable” form. In other cases, however, the injection can be obfuscated. Malicious code\nalso can be downloaded from a third-party resource. Screenshot 5 shows an example\nobfuscation option. In this variant, a call to a malicious script from\nfirebasestorage.googleapis[.]com is inserted into the infected site.\n\n**_Screenshot 5_**\n\nAfter deobfuscation, we obtain a similar script with the same distinctive comments. Part of its\ncode is presented in screenshot 6 (a different tracking ID is used).\n\n\n-----\n\n**_Screenshot 6_**\n\n## What’s the danger\n\n[Google Analytics is an extremely popular service (used on more than 29 million sites,](https://trends.builtwith.com/analytics/Google-Analytics)\naccording to BuiltWith) and is blindly trusted by users: administrators write *.googleanalytics.com into the Content-Security-Policy header (used for listing resources from which\nthird-party code can be downloaded), allowing the service to collect data. What’s more, the\nattack can be implemented without downloading code from external sources.\n\n## How to avoid the issues\n\n**Users:**\n\nInstall security software. Kaspersky solutions detect malicious scripts used in such\nattacks as HEUR:Trojan-PSW.Script.Generic.\n\n**Webmasters:**\n\nDo not install web applications and CMS components from untrusted sources. Keep all\nsoftware up to date. Follow news about vulnerabilities and take recommended actions\nto patch them.\n\n\n-----\n\nCreate strong passwords for all administration accounts.\nLimit user rights to the minimum necessary. Keep track of the number of users who\nhave access to service interfaces.\nFilter user-entered data and query parameters to prevent third-party code injection.\nFor e-commerce sites, it is recommended to use PCI DSS-compliant payment\ngateways.\n\n## IOCs\n\n[firebasestorage.googleapis[.]com/v0/b/bragvintage-f929b.appspot.com/o/*](https://opentip.kaspersky.com/firebasestorage.googleapis.com%2Fv0%2Fb%2Fbragvintage-f929b.appspot.com%2Fo%2F*/)\n\n[firebasestorage.googleapis[.]com/v0/b/canature-5fab3.appspot.com/o/*](https://opentip.kaspersky.com/firebasestorage.googleapis.com%2Fv0%2Fb%2Fcanature-5fab3.appspot.com%2Fo%2F*/)\n\n[firebasestorage.googleapis[.]com/v0/b/ericeirasurfskate-559bf.appspot.com/o/*](https://opentip.kaspersky.com/firebasestorage.googleapis.com%2Fv0%2Fb%2Fericeirasurfskate-559bf.appspot.com%2Fo%2F*/)\n\n[firebasestorage.googleapis[.]com/v0/b/gluten-8e34e.appspot.com/o/*](https://opentip.kaspersky.com/firebasestorage.googleapis.com%2Fv0%2Fb%2Fgluten-8e34e.appspot.com%2Fo%2F*/)\n\n[firebasestorage.googleapis[.]com/v0/b/laser-43e6f.appspot.com/o/*](https://opentip.kaspersky.com/firebasestorage.googleapis.com%2Fv0%2Fb%2Flaser-43e6f.appspot.com%2Fo%2F*/)\n\n[firebasestorage.googleapis[.]com/v0/b/movile-720cd.appspot.com/o/*](https://opentip.kaspersky.com/firebasestorage.googleapis.com%2Fv0%2Fb%2Fmovile-720cd.appspot.com%2Fo%2F*/)\n\n[firebasestorage.googleapis[.]com/v0/b/plumb-99e97.appspot.com/o/*](https://opentip.kaspersky.com/firebasestorage.googleapis.com%2Fv0%2Fb%2Fplumb-99e97.appspot.com%2Fo%2F*/)\n\n[firebasestorage.googleapis[.]com/v0/b/redfox-64c35.appspot.com/o/*](https://opentip.kaspersky.com/firebasestorage.googleapis.com%2Fv0%2Fb%2Fredfox-64c35.appspot.com%2Fo%2F*/)\n\n[firebasestorage.googleapis[.]com/v0/b/tictoc-9677e.appspot.com/o/*](https://opentip.kaspersky.com/firebasestorage.googleapis.com%2Fv0%2Fb%2Ftictoc-9677e.appspot.com%2Fo%2F*/)\n\n[Security Websites](https://securelist.com/tag/security-websites/)\n[Website Hacks](https://securelist.com/tag/website-hacks/)\n\nAuthors\n\n[Victoria Vlasova](https://securelist.com/author/victoria-vlasova/)\n\nWeb skimming with Google Analytics\n\nYour email address will not be published. Required fields are marked *\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-06-22 - Web skimming with Google Analytics.pdf"
    ],
    "report_names": [
        "2020-06-22 - Web skimming with Google Analytics.pdf"
    ],
    "threat_actors": [
        {
            "id": "3fad11c6-4336-4b28-a606-f510eca5452e",
            "created_at": "2022-10-25T16:07:24.346573Z",
            "updated_at": "2025-03-27T02:02:10.183211Z",
            "deleted_at": null,
            "main_name": "Turbine Panda",
            "aliases": [
                "APT 26",
                "Black Vine",
                "Bronze Express",
                "Group 13",
                "JerseyMikes",
                "KungFu Kittens",
                "PinkPanther",
                "Shell Crew",
                "Turbine Panda",
                "WebMasters"
            ],
            "source_name": "ETDA:Turbine Panda",
            "tools": [
                "Agent.dhwf",
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "Derusbi",
                "Destroy RAT",
                "DestroyRAT",
                "FF-RAT",
                "FormerFirstRAT",
                "Hurix",
                "Kaba",
                "Korplug",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Mivast",
                "PlugX",
                "RbDoor",
                "RedDelta",
                "RibDoor",
                "Sakula",
                "Sakula RAT",
                "Sakurel",
                "Sogu",
                "StreamEx",
                "TIGERPLUG",
                "TVT",
                "Thoper",
                "Winnti",
                "Xamtrav",
                "cobeacon",
                "ffrat"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535878,
    "ts_updated_at": 1743041460,
    "ts_creation_date": 1653787049,
    "ts_modification_date": 1653787049,
    "files": {
        "pdf": "https://archive.orkl.eu/79895ebba66b2efc70846ffc4dcd8d682d1d4ad9.pdf",
        "text": "https://archive.orkl.eu/79895ebba66b2efc70846ffc4dcd8d682d1d4ad9.txt",
        "img": "https://archive.orkl.eu/79895ebba66b2efc70846ffc4dcd8d682d1d4ad9.jpg"
    }
}