{
    "id": "e9a303a2-8e11-4736-a9bb-ab012e3140ae",
    "created_at": "2023-01-12T15:00:47.872234Z",
    "updated_at": "2025-03-27T02:17:02.271142Z",
    "deleted_at": null,
    "sha1_hash": "32832f302cf4b3f1c3a85a0f84f6a899461b4380",
    "title": "2022-06-02 - WinDealer dealing on the side",
    "authors": "",
    "file_creation_date": "2022-08-18T03:26:09Z",
    "file_modification_date": "2022-08-18T03:26:09Z",
    "file_size": 1164052,
    "plain_text": "# WinDealer dealing on the side\n\n**securelist.com/windealer-dealing-on-the-side/105946**\n\nAuthors\n\nGReAT\n\n## Introduction\n\nLuoYu is a lesser-known threat actor that has been active since 2008. It primarily goes after\ntargets located in China, such as foreign diplomatic organizations established in the country,\nmembers of the academic community, or companies from the defense, logistics and\ntelecommunications sectors. In their initial disclosures on this threat actor, [TeamT5 identified](https://jsac.jpcert.or.jp/archive/2021/pdf/JSAC2021_301_shui-leon_en.pdf)\nthree malware families: SpyDealer, Demsty and WinDealer. The actor behind these families\nis capable of targeting Windows, Linux and macOS machines, as well as Android devices.\n\nIn previous years, Kaspersky investigated LuoYu’s activities and was able to confirm the\nconnection between Demsty and WinDealer. On January 27, we delivered a joint\npresentation with TeamT5 and ITOCHU Corporation at Japan Security Analyst Conference\n(JSAC) to provide an update on the actor’s latest activities. In this article, we will focus on\none of the most groundbreaking developments: the fact that LuoYu has the ability to perform\n[man-on-the-side attacks.](https://en.wikipedia.org/wiki/Man-on-the-side_attack)\n\n\n-----\n\n## Delivery method\n\nIn the past, LuoYu used watering-hole attacks (for instance, on local news websites) to infect\ntheir targets. Seeing that some variants of their Android malware impersonate a popular\nmessaging app in Asia, it is also likely that malicious APKs are distributed in a variety of\nways, including social engineering to convince users to install fake updates for their\napplications.\n\nIn 2020, we discovered a whole new distribution method for the WinDealer malware that\nleverages the automatic update mechanism of select legitimate applications. In one case we\ninvestigated, we noticed that a signed executable qgametool.exe (MD5\n[f756083b62ba45dcc6a4d2d2727780e4), compiled in 2012, deployed WinDealer on a target](https://opentip.kaspersky.com/f756083b62ba45dcc6a4d2d2727780e4/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\nmachine. This program contains a hardcoded URL that it uses to check for updates, as\nshown in the following screenshot:\n\n**_Update URL hardcoded in qgametool.exe_**\n\nThe executable located at this URL\n(hxxp://download.pplive[.]com/PPTV(pplive)_forap_1084_9993.exe, MD5\n[270902c6bb6844dc25ffaec801393245) is benign, but our telemetry shows that on rare](https://opentip.kaspersky.com/270902c6bb6844dc25ffaec801393245/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[occasions, a WinDealer sample (MD5 ce65092fe9959cc0ee5a8408987e3cd4) is delivered](https://opentip.kaspersky.com/ce65092fe9959cc0ee5a8408987e3cd4/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\ninstead.\n\n**_Observed WinDealer infection flow_**\n\n\n-----\n\n[We also identified online message board posts where Chinese-speaking users reported the](https://bbs.kafan.cn/thread-2157062-1-1.html)\ndiscovery of malware under the same name – PPTV(pplive)_forap_1084_9993.exe – on their\nmachine. The posted information was complete enough for us to confirm that they had\nindeed received a sample of WinDealer.\n\nLeaving the mystery of the delivery method aside for now, let’s look at the capabilities of the\nmalware itself.\n\n## WinDealer’s technical description\n\nWinDealer is a modular malware platform. It starts execution by locating an embedded DLL\nfile placed in its resources by looking for a hardcoded pattern, and proceeds to decode it\nusing a 10-byte XOR key.\n\n**_Layout of the encrypted data_**\n\nWinDealer’s logic is spread over the initial EXE and its companion DLL: the former contains\nthe setup of the program as well as network communications, while the orders sent by the\nC2 are implemented in the latter. The malware possesses the following capabilities:\n\nFile and file system manipulation: reading, writing and deleting files, listing directories,\nobtaining disk information;\nInformation gathering: collecting hardware details, network configuration and/or\nkeyboard layout, listing running processes, installed applications and configuration files\nof popular messaging applications (Skype, QQ, WeChat and Wangwang);\nDownload and upload of arbitrary files;\nArbitrary command execution;\nSystem-wide search across text files and Microsoft Word documents;\nScreenshot capture;\nNetwork discovery via ping scan;\n\n\n-----\n\nBackdoor maintenance: set up or remove persistence (via the registry s RUN key),\nconfiguration updates.\n\n[A variant we discovered (MD5 26064e65a7e6ce620b0ff7b4951cf340) also featured the](https://opentip.kaspersky.com/26064e65a7e6ce620b0ff7b4951cf340/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\nability to list available Wi-Fi networks. Overall, WinDealer is able to collect an impressive\namount of information, even when compared to other malware families. And yet, the most\nextraordinary aspect of WinDealer lies elsewhere.\n\n## The impossible infrastructure\n\nThe latest WinDealer sample we discovered in 2020 doesn’t contain a hardcoded C2 server\nbut instead relies on a complex IP generation algorithm to determine which machine to\ncontact. The details of this algorithm are left as an exercise to the reader, but the end result\nis that the IP address is selected at random from one of these two ranges:\n\n113.62.0.0/15 (AS4134, CHINANET XIZANG PROVINCE NETWORK)\n111.120.0.0/14 (AS4134, CHINANET GUIZHOU PROVINCE NETWORK)\n\nOnce the IP address has been selected, communications take place either over UDP port\n6999 or TCP port 55556. In an even weirder twist, a research partner shared with us an\n[additional WinDealer sample (MD5 d9a6725b6a2b38f96974518ec9e361ab) that](https://opentip.kaspersky.com/d9a6725b6a2b38f96974518ec9e361ab/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\ncommunicates with the hardcoded URL “http://www[.]microsoftcom/status/getsign.asp”. This\ndomain is obviously invalid and cannot resolve to anything in normal circumstances – yet the\nmalware expects a response in a predetermined format (“\\x11\\x22\\x??\\x33\\x44”).\n\nPackets exchanged with the C2 server contain a header (described in the next table)\nfollowed by AES-encrypted data. They leverage a homemade binary protocol containing\nmagic numbers and flags, making it easy to recognize and filter packets on a large scale.\n\n**Offset** **Description** **Sample**\n**value (in**\n**hex)**\n\n0x00 Magic number 06 81 DA 91\nCE C7 9F 43\n\n0x08 Target identifier 57 5B 73 B2\n\n0x0C Flag set by the attacker. Its exact meaning remains unclear 00 or 0B or\n16\n\n\n0x0D Connection type or backdoor command identifier\n\n0 = initial connection\n\n1 = subsequent connection\n\nOthers = backdoor command identifiers\n\n\n00\n\n\n-----\n\n0x0E Unknown static value 14\n\n0x0F Unknown value 00\n\n\n0x10 Payload\n\nInitial connection: the generated AES key and its CRC32,\nencrypted using RSA-2048 with a hardcoded public key.\n\nAll other packets: payload size followed by encrypted payload\nusing AES-128 in ECB mode with the generated AES key.\n\n## The man-on-the-side attack\n\n\n03 4D 5D 44\nC3 1E 0A DA\n\nA3 4A 86 A3\nCC ED 67 38\n\n…\n\n\nPutting all the pieces together, WinDealer’s infrastructure is nothing short of extraordinary:\n\nIt appears to be distributed via plain HTTP requests that normally return legitimate\nexecutables.\nIt communicates with IP addresses selected randomly inside a specific AS.\nIt can interact with non-existent domain names.\n\nIt is very hard to believe that an attacker would be able to control the 48,000 IP addresses of\nthe aforementioned IP ranges, or even a significant portion of them. The only way to explain\nthese seemingly impossible network behaviors is by assuming the existence of a man-onthe-side attacker who is able to intercept all network traffic and even modify it if needed.\n\n[Such capabilities are not unheard of: the QUANTUM program revealed in 2014 was the first](https://blog.fox-it.com/2015/04/20/deep-dive-into-quantum-insert/)\nknown instance. The general idea is that when the attacker sees a request for a specific\nresource on the network, it tries to reply to the target faster than the legitimate server. If the\nattacker wins the “race”, the target machine will use the attacker-supplied data instead of the\nnormal data. This is consistent with the scenario described earlier in this article, where the\ntarget receives an infected executable instead of the normal one. Automatic updaters are\nprime targets for such attacks as they perform frequent requests – it doesn’t matter if the\nattackers don’t win most races, as they can try again until they succeed, guaranteeing that\nthey will infect their targets eventually. This class of attack is particularly devastating because\nthere is nothing users can do to protect themselves, apart from routing traffic through another\nnetwork. This can be done with the use of a VPN, but these may be illegal depending on the\njurisdiction and would typically not be available to Chinese-speaking targets.\n\nConfirming our assessment, we later discovered a downloader utility (MD5\n[4e07a477039b37790f7a8e976024eb66) that uses the same unique user-agent as](https://opentip.kaspersky.com/4e07a477039b37790f7a8e976024eb66/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\nWinDealer samples we analyzed (“BBB”), tying it weakly to LuoYu.\n\n\n-----\n\n**_A downloader utility and WinDealer of 2021 use the unique user-agent “BBB”_**\n\nThe downloader periodically retrieves and runs an executable from\nhxxp://www.baidu[.]com/status/windowsupdatedmq.exe. This URL normally returns a 404\nerror and we consider it extremely unlikely that the attackers have control over this domain.\n\nBased on all the evidence laid out above, we speculate that the attackers may have the\nfollowing capabilities over AS4134:\n\nIntercepting all network traffic, which allows them to receive backdoor responses to\nrandom IP addresses without having to deploy actual C2 servers.\nInjecting arbitrary TCP and UDP packets on the network, a capability through which\nthey can send orders to WinDealer.\nFull control over the DNS, meaning they can provide responses for non-existent\ndomains.\nEither QUANTUMINSERT capabilities or the ability to modify the contents of HTTP\npackets on the fly, thanks to which they can achieve remote, zero-click malware\ninstallation by abusing auto-update mechanisms. One noteworthy observation is that\nthe attackers specifically target plain HTTP sessions, indicating that they may not have\nthe ability to break or downgrade HTTPS.\n\n## WinDealer’s targets\n\nOur analysis of WinDealer reveals that it specifically looks for popular applications in Asia,\nsuch as QQ, WeChat and WangWang. It also contains references to registry keys created by\nSogou programs. This indicates to us that the LuoYu APT is predominantly focused on\nChinese-speaking targets and organizations related to China. Our telemetry confirms that the\nvast majority of LuoYu targets are located in China, with occasional infections in other\ncountries such as Germany, Austria, the United States, Czech Republic, Russia and India.\n\nIn recent months, LuoYu has started to widen its scope to companies and users in East Asia\nand their branches located in China.\n\n\n-----\n\n**_Geographic distribution of WinDealer targets_**\n\n## Conclusion\n\nWith this report, we recognize LuoYu as an extremely sophisticated threat actor able to\nleverage capabilities available only to the most mature attackers. We can only speculate as\nto how they were able to obtain such capabilities. They could have compromised routers on\nthe route to (or inside) AS4134. Alternatively, they may use signals intelligence methods\nunknown to the general public. They may even have access (legitimate or fraudulent) to law\nenforcement tools set up at the ISP level and are abusing them to perform offensive\noperations. Overall, a threat actor is leveraging capabilities that could be compared (but are\ndistinct) from the QUANTUMINSERT program in order to infect targets located in China.\n\nMan-on-the-side attacks are devastating because they do not require any interaction with the\ntarget to lead to a successful infection: simply having a machine connected to the internet is\nenough. They can only be detected through careful network monitoring, which is outside of\nthe realm of everyday users, or if an endpoint security program catches the payload when it\nis deployed on the attacked computer.\n\nWhatever the case, the only way for potential targets to defend against such intrusions is to\nremain extremely vigilant and have robust security procedures involving regular antivirus\nscans, analysis of outbound network traffic and extensive logging to detect anomalies.\n\n## Indicators of Compromise\n\n**WinDealer samples**\n\n**MD5: ce65092fe9959cc0ee5a8408987e3cd4**\n\n**SHA-1: 87635d7632568c98c0091d4a53680fd920096327**\n\n**SHA-256: 27c51026b89c124a002589c24cd99a0c116afd73c4dc37f013791f757ced7b7e**\n\n\n-----\n\n**MD5: 0c8663bf912ef4d69a1473597925feeb**\n**SHA-1: 78294dfc4874b54c870b8daf7c43cfb5d8c211d0**\n\n**SHA-256: db034aeb3c72b75d955c02458ba2991c99033ada444ebed4e2a1ed4c9326c400**\n\n**MD5: 1bd4911ea9eba86f7745f2c1a45bc01b**\n\n**SHA-1: f64c63f6e17f082ea254f0e56a69b389e35857fd**\n\n**SHA-256: 25cbfb26265889754ccc5598bf5f21885e50792ca0686e3ff3029b7dc4452f4d**\n\n**MD5: 5a7a90ceb6e7137c753d8de226fc7947**\n\n**SHA-1: 204a603c409e559b65c35208200a169a232da94c**\n\n**SHA-256: 1e9fc7f32bd5522dd0222932eb9f1d8bd0a2e132c7b46cfcc622ad97831e6128**\n\n**MD5: 73695fc3868f541995b3d1cc4dfc1350**\n\n**SHA-1: 158c7382c88e10ab0208c9a3c72d5f579b614947**\n\n**SHA-256: ea4561607c00687ea82b3365de26959f1adb98b6a9ba64fa6d47a6c19f22daa4**\n\n**MD5: 76ba5272a17fdab7521ea21a57d23591**\n\n**SHA-1: 6b831413932a394bd9fb25e2bbdc06533821378c**\n\n**SHA-256: ecd001aeb6bcbafb3e2fda74d76eea3c0ddad4e6e7ff1f43cd7709d4b4580261**\n\n**MD5: 8410893f1f88c5d9ab327bc139ff295d**\n\n**SHA-1: 64a1785683858d8b6f4e7e2b2fac213fb752bae0**\n\n**SHA-256: 318c431c56252f9421c755c281db7bd99dc1efa28c44a8d6db4708289725c318**\n\n**MD5: cc7207f09a6fe41c71626ad4d3f127ce**\n\n**SHA-1: 84e749c37978f9387e16fab29c7b1b291be93a63**\n\n**SHA-256: 28df5c75a2f78120ff96d4a72a3c23cee97c9b46c96410cf591af38cb4aed0fa**\n\n**MD5: e01b393e8897ed116ba9e0e87a4b1da1**\n\n**SHA-1: 313b231491408bd107cecf0207868336f26d79ba**\n\n**SHA-256: 4a9b37ca2f90bfa90b0b8db8cc80fe01d154ba88e3bc25b00a7f8ff6c509a76f**\n\n**MD5: ef25d934d12684b371a17c76daf3662c**\n\n**SHA-1: b062773bdd9f8433cbd6e7642226221972ecd4e1**\n\n**SHA-256: 08530e8280a93b8a1d51c20647e6be73795ef161e3b16e22e5e23d88ead4e226**\n\n**MD5: faa8eaed63c4e9f212ef81e2365dd9e8**\n\n**SHA-1: 0d3a5725b6f740929b51f9a8611b4f843e2e07b1**\n\n**SHA-256: b9f526eea625eec1ddab25a0fc9bd847f37c9189750499c446471b7a52204d5a**\n\n[APT](https://securelist.com/tag/apt/)\n[Chinese-speaking cybercrime](https://securelist.com/tag/chinese-speaking-cybercrime/)\n[Google Android](https://securelist.com/tag/google-android/)\n[Instant Messengers](https://securelist.com/tag/instant-messengers/)\n[Linux](https://securelist.com/tag/linux/)\n\n\n-----\n\n[Malware Descriptions](https://securelist.com/tag/malware-descriptions/)\n[Mobile Malware](https://securelist.com/tag/mobile-malware/)\n[Non-Windows Malware](https://securelist.com/tag/non-windows-malware/)\n[Targeted attacks](https://securelist.com/tag/targeted-attacks/)\n\nAuthors\n\nGReAT\n\nWinDealer dealing on the side\n\nYour email address will not be published. Required fields are marked *\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-06-02 - WinDealer dealing on the side.pdf"
    ],
    "report_names": [
        "2022-06-02 - WinDealer dealing on the side.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "b72c2616-cc7c-4c47-a83d-6b7866b94746",
            "created_at": "2023-01-06T13:46:39.425297Z",
            "updated_at": "2025-03-27T02:00:03.08718Z",
            "deleted_at": null,
            "main_name": "Red Nue",
            "aliases": [
                "LuoYu"
            ],
            "source_name": "MISPGALAXY:Red Nue",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535647,
    "ts_updated_at": 1743041822,
    "ts_creation_date": 1660793169,
    "ts_modification_date": 1660793169,
    "files": {
        "pdf": "https://archive.orkl.eu/32832f302cf4b3f1c3a85a0f84f6a899461b4380.pdf",
        "text": "https://archive.orkl.eu/32832f302cf4b3f1c3a85a0f84f6a899461b4380.txt",
        "img": "https://archive.orkl.eu/32832f302cf4b3f1c3a85a0f84f6a899461b4380.jpg"
    }
}