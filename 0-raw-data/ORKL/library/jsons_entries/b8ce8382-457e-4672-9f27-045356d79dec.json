{
    "id": "b8ce8382-457e-4672-9f27-045356d79dec",
    "created_at": "2023-01-12T14:59:46.107858Z",
    "updated_at": "2025-03-27T02:05:23.501388Z",
    "deleted_at": null,
    "sha1_hash": "9f385cdaf13acbd8f493bc88561685dded9b9208",
    "title": "2021-05-05 - Ousaban- Private photo collection hidden in a CABinet",
    "authors": "",
    "file_creation_date": "2022-05-28T18:11:36Z",
    "file_modification_date": "2022-05-28T18:11:36Z",
    "file_size": 409793,
    "plain_text": "# Ousaban: Private photo collection hidden in a CABinet\n\n**[welivesecurity.com/2021/05/05/ousaban-private-photo-collection-hidden-cabinet/](https://www.welivesecurity.com/2021/05/05/ousaban-private-photo-collection-hidden-cabinet/)**\n\nAnother in our occasional series demystifying Latin American banking trojans\n\n[ESET Research](https://www.welivesecurity.com/author/esetresearch/)\n5 May 2021 - 11:30AM\n\nAnother in our occasional series demystifying Latin American banking trojans\n\n\nMay 5, 2021\n\n\nOusaban is a Latin American banking trojan active exclusively in Brazil. ESET has been tracking this malware\nfamily since 2018. In common with most other LATAM banking trojans, Ousaban uses overlay windows to steal\ncredentials and more from financial institutions. However, unlike most other LATAM banking trojans, Ousaban’s\ndevelopers have extended the use of overlay windows to steal credentials from popular regional email services.\nIn this installment of our series, we examine its main features and many connections to other Latin American\nbanking trojan families.\n\n## Characteristics\n\nOusaban is written in Delphi, as are the vast majority of the other Latin American banking trojans ESET is\ntracking. And, as do many of them, Ousaban shows signs of active and continuous development.\n\n\n-----\n\nThe name ESET assigned to this family is a portmanteau of two words **ousadia, which means boldness in**\nPortuguese, and “banking trojan”. The reason for such a name is that for a very long time, Ousaban was\ndistributed alongside the images (some of them obscene) shown in Figure 1. In the most recent campaigns\ndistributing Ousaban, this is no longer the case.\n\n_Figure 1. Various images distributed alongside the Ousaban banking trojan_\n\nOusaban is also known as Javali, a name assigned by Kaspersky. A recent article about Ousaban can be found\n[here. ESET has also been able to attribute Ousaban to the campaigns described in this blogpost from 2018.](https://seguranca-informatica.pt/latin-american-javali-trojan-weaponizing-avira-antivirus-legitimate-injector-to-implant-malware/)\nEven though some sources claim Ousaban is active in Europe, ESET has never observed any campaign\nspreading this banking trojan outside of Brazil.\n\nOusaban protects its executables with either Themida or Enigma binary obfuscators. Additionally, most EXEs\nare enlarged, using binary padding, to approximately 400 MB, likely in order to evade detection and automated\nprocessing.\n\nMost recent Ousaban variants contain a string table to hold their strings, storing this table in their .rsrc sections.\nOne of the resources contains a zlib-compressed list of strings delimited by newline characters.\n\nIts backdoor capabilities are very similar to a typical Latin American banking trojan – simulating mouse and\nkeyboard actions and logging keystrokes. The latest variants communicate with C&C servers using\n[RealThinClient – a protocol also used by Grandoreiro.](https://rtc.teppi.net/)\n\nThe typical Latin American banking trojan attacks users of financial institutions using overlay windows crafted\nspecifically for its targets and Ousaban is no exception. Interestingly though, its targets include several email\nservices that it has overlay windows ready for as well, as illustrated in Figure 2.\n\n\n-----\n\n_Figure 2. Overlay window design for the UOL email service_\n\nTo achieve persistence, Ousaban either creates a LNK file or a simple VBS loader in the startup folder, or it\nmodifies the Windows registry Run key.\n\n## Distribution and execution\n\nOusaban is distributed mainly through phishing emails (such as the one in Figure 3). The threat actor behind\nOusaban cycles through multiple distribution chains. These chains share some common characteristics, mainly:\n\nDLL side-loading is used to execute a binary payload\nCAB archives are sometimes used instead of ZIP\nA configuration file distributed inside an archive with one stage is required by the next stage\nAn injector, unique to Ousaban, may be used\n\n_Figure 3. Recent spam email distributing Ousaban (a rough translation is provided on the right)_\n\n\n-----\n\n### MSI with JavaScript\n\nThis distribution chain, illustrated in Figure 4, is quite straightforward. The victim is misled into executing an MSI\nattached to the phishing email. When executed, the MSI launches an embedded JavaScript downloader that\ndownloads a ZIP archive and extracts its contents. It then executes the legitimate application, which side-loads\nthe Ousaban banking trojan.\n\n_Figure 4. Simple Ousaban distribution chain_\n\n### Multistage MSI\n\nRecently, ESET has observed a [new distribution chain spreading Ousaban massively. It is much more](https://twitter.com/ESETresearch/status/1376490532445294594)\ncomplicated than the one described above. The whole process is illustrated in Figure 5.\n\nThe first two stages are almost identical. In both, the core of the stage is contained in an archive (ZIP or CAB)\nand contains:\n\nA legitimate application\nAn encrypted injector\nAn encrypted downloader\nAn encrypted configuration file\nLegitimate files\n\nThe legitimate application, when executed, side-loads the injector. The injector locates, decrypts and executes\nthe downloader. The downloader decrypts the configuration file to obtain a URL leading to a remote\nconfiguration. The remote configuration contains a URL leading to the next stage archive. The downloader\ndownloads the next stage archive, extracts its contents and executes the legitimate application.\n\nThe final stage is slightly different, as it decrypts and executes the actual Ousaban banking trojan instead of a\ndownloader. The third configuration file leads to a remote configuration with C&C server IP address and port.\nThe archive with the last stage contains one more malware-related file – a support module that alters various\nsettings of the victim’s machine. Finally, the archives for all three stages include additional files – a single\nlegitimate executable in the first-stage archive, 14 legitimate files in the second-stage archive, and 13 legitimate\nfiles in the third-stage archive plus an embedded archive containing a further 102 legitimate files.\n\n\n-----\n\n-----\n\n_Figure 5. Ousaban’s complex distribution chain_\n\n**Support module**\n\nOusaban loads this module to make it easier for the threat actor to connect to the victim’s machine. It mainly:\n\n[Modifies the RDP settings to use RDPWrap, a utility to allow multiple RDP connections to Home editions](https://github.com/stascorp/rdpwrap)\nof the Windows OS\nModifies firewall settings to allow all RDP connections\nCreates a new account with administrative privileges\n\nThe module contains the RDPWrap binaries stored in its .rsrc section. It then changes the RDP settings directly\nin the Windows registry at:\n\nHKLM\\SYSTEM\\CurrentControlSet\\Services\\TermService\\\nHKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\\n\nThe module then uses netsh.exe to modify the Windows firewall to allow all TCP and UDP traffic directed to port\n3389, the standard port for RDP. Finally, it creates a new account Administrat0r with administrative privileges.\nWe hypothesize that the threat actor wants to have a second way to access the victim’s machine; the threat\nactor is then not limited by the capabilities of the Ousaban banking trojan and can perform any malicious\nactivity.\n\n## Cryptography\n\nOusaban utilizes three cryptographic schemes overall. Its strings are encrypted with an algorithm used by the\nvast majority of Latin American banking trojans we have analyzed (we have previously described it in detail\n[here). All communications between Ousaban and its C&C server are encrypted using the standard AES cipher](https://www.welivesecurity.com/2019/10/03/casbaneiro-trojan-dangerous-cooking/)\nwith a hardcoded key.\n\nThe final algorithm is used in the previously mentioned injector specific to this family. We provide a Python\nimplementation in Figure 6.\n\n\n-----\n\n1\n\n2\n\n3\n\n4\n\n5\n\n6\n\n7\n\n8\n\n9\n\n10\n\n\ndef decrypt(data, key):\n\ndata_dec = str()\n\nkey_len = len(key)\n\nfor i, c in enumerate(data):\n\nif i % 2 != 0:\n\ndata_dec += chr(key[i % key_len ^ c ^ ((key_len - (i & key_len)) & 0xFF)])\n\nelse\n\ndata_dec += chr(key[i % key_len] ^ c ^ (i & 0xFF))\n\nreturn data_dec\n\n\n_Figure 6. Algorithm used by Ousaban’s injector to decrypt its payloads_\n\n## Remote configuration\n\nOusaban relies on remote configuration to obtain its next stage URLs and the C&C address and port to use.\nOusaban used to store its remote configuration on YouTube, similar to Casbaneiro, but lately it has started using\nGoogle Docs instead.\n\nThe remote configuration is in JSON format with the values being encrypted by the same algorithm used for\nstrings, but with a different key. The fields have the following meaning:\n\nhost = C&C domain\nlink = next stage URL\nporta = C&C port or 0 (the default HTTP port 80 is then used)\nvers = Ousaban version\n\nExamples of the remote configuration are provided in Figure 7 and Figure 8.\n\n_Figure 7. Ousaban remote configuration on YouTube_\n\n_Figure 8. Ousaban remote configuration on Google Docs_\n\n\n-----\n\n## Similarities with other LATAM banking trojans\n\nWe have already mentioned some similarities between Ousaban and other Latin American banking trojans\npreviously analyzed in this series (like the same string decryption algorithm). During our analysis, we discovered\nadditional links to the other families, mainly:\n\n[Some Ousaban downloaders contain the same string obfuscation code as Amavaldo](https://www.welivesecurity.com/2019/08/01/banking-trojans-amavaldo/)\n[Ousaban has been distributed by the same malicious advertisements as Mispadu in the past](https://www.welivesecurity.com/2019/11/19/mispadu-advertisement-discounted-unhappy-meal/)\n[The JavaScript files it uses are similar to Vadokrist,](https://www.welivesecurity.com/2021/01/21/vadokrist-wolf-sheeps-clothing/) [Mekotio,](https://www.welivesecurity.com/2020/08/13/mekotio-these-arent-the-security-updates-youre-looking-for/) [Casbaneiro and](https://www.welivesecurity.com/2019/10/03/casbaneiro-trojan-dangerous-cooking/) [Guildma](https://www.welivesecurity.com/2020/03/05/guildma-devil-drives-electric/)\nThe PowerShell files it occasionally uses for distribution (aside from the recent methods described in this\n[blogpost) are similar to Amavaldo,](https://www.welivesecurity.com/2019/08/01/banking-trojans-amavaldo/) [Casbaneiro and](https://www.welivesecurity.com/2019/10/03/casbaneiro-trojan-dangerous-cooking/) [Mekotio](https://www.welivesecurity.com/2020/08/13/mekotio-these-arent-the-security-updates-youre-looking-for/)\n\n[We analyzed the interestingly close cooperation between these malware families in depth in our white paper](https://www.welivesecurity.com/2020/10/01/latam-financial-cybercrime-competitors-crime-sharing-ttps/)\npresented at the Virus Bulletin 2020 conference.\n\n## Conclusion\n\nIn this installment of our series, we looked at Ousaban, a Latin American banking trojan targeting only Brazil.\nThis malware family has been active since at least 2018 and shares typical characteristics of this type of threat\n– it is written in Delphi, contains backdoor functionality and attacks using overlay windows.\n\nWe have covered its most typical features, distribution and execution methods and the structure of its remote\nconfiguration. We also discovered several leads that suggest Ousaban is linked to some other Latin American\nbanking trojans.\n\n_For any inquiries, contact us at threatintel@eset.com. Indicators of Compromise can also be found in our_\n_GitHub repository._\n\n## Indicators of Compromise (IoCs)\n\n### Hashes\n\n**SHA-1** **Description** **ESET detection name**\n\n\nC52BC5B0BDFC7D4C60DF60E88835E3145F7FB34F Ousaban\nbanking trojan\n\nD04ACFAF74861DDC3B12E75658863DA65C03013F Ousaban JS\ndownloader\n\n9A6A4BF3B6E974E367982E5395702AFF8684D500 Ousaban JS\ndownloader\n\n3E8A0B6400F2D02B6B8CD917C279EA1388494182 Ousaban MSI\ndownloader\n\n6946BFB8A519FED8EC8C30D9A56619F4E2525BEA Ousaban\ninjector\n\nE5DD2355E85B90D2D648B96C90676604A5C3AE48 Ousaban\nsupport\nmodule\n\n**Abused legitimate applications**\n\n\nWin32/Spy.Ousaban.G\n\nJS/TrojanDownloader.Banload.AAP\n\nJS/TrojanDownloader.Banload.AAP\n\nWin32/Spy.Ousaban.W\n\nWin32/Spy.Ousaban.W\n\nWin32/Spy.Ousaban.AB\n\n\n-----\n\n**Example SHA-1** **EXE name** **DLL name**\n\nBA5493B08354AEE85151B7BBD15150A1C3F03D1D Avira.SystrayStartTrigger.exe Avira.OE.NativeCore.dll\n\n7F6C820B00FC8C628E2420C388BBB9096A547DAA AudioGrabber.exe StarBurn.dll\n\nC5D5CF1B591C40344B20370C5EE5275356D312EC PlGen.exe bass_fx.dll\n\n53045B8047CED049BBC7EBCB3D3299D2C465E8B9 BlazeDVD.exe SkinScrollBar.dll\n\nA6118D354D512DC29965E368F6C78AA3A42A27AD ImageGrabber.exe StarBurn.dll\n\nF9C71277CF05738275261D60A9E938CBA7232E0D nvsmartmaxapp.exe nvsmartmax.dll\n\n### Recent configuration file URLs\n\nhttps://docs.google[.]com/document/d/1o9MlOhxIJq9tMOuUHJiw2eprQ-BGCA_ERnbF54dZ25w/edit\n\nhttps://docs.google[.]com/document/d/1nQqifeYFsCcI7m-L1Y1oErkp50c-y670nfk7NTKOztg/edit\n\nhttps://docs.google[.]com/document/d/13A6EBLMOOdvSL3u6IfyrPWbYREXNRVdDTiKzC6ZQx7U/edit\n\nhttps://docs.google[.]com/document/d/1UiuqrzI_rrtsJQHqeSkp0sexhwU_VSje8AwS-U6KBPk/edit\n\nhttps://docs.google[.]com/document/d/1VKxF3yKbwQZive-ZPCA4dAU1zOnZutJxY2XZA0YHa3M/edit\n\nhttps://docs.google[.]com/document/d/19bXTaiFdY5iUqUWXl92Js7i9RoZSLJqcECgpp_4Kda4/edit\n\nhttps://docs.google[.]com/document/d/1DDDmJzBVcNWhuj8JMRUVb7JlrVZ5kYBugR_INSS96No/edit\n\nhttps://docs.google[.]com/document/d/1UbfOcHm-T9GCPiitqDRh5TNwZRNJ8_miEpLW-2ypU-I/edit\n\nhttps://docs.google[.]com/document/d/1d1903AvDBYgOo0Pt9xBBnpCHwSerOpIi4l1b6M4mbT4/edit\n\nhttps://docs.google[.]com/document/d/1JLuJKoxcd0vRqut8UeBjFJXzMDQ9OiY2ItoVIRq6Gw8/edit\n\nhttps://docs.google[.]com/document/d/1EOwVDlYPV3gE7PSnLZvuTgUQXvOSN9alyN5aMw7bGeI/edit\nhttps://docs.google[.]com/document/d/18sc6rZjk529iYF2iBTsmuNXvqDqTBSH45DhSZpuLv_U/edit\n\n## MITRE ATT&CK techniques\n\n_[Note: This table was built using version 8 of the MITRE ATT&CK framework.](https://attack.mitre.org/resources/versions/)_\n\n**Tactic** **ID** **Name** **Description**\n\n\nResource\nDevelopment\n\n\n[T1583.001](https://attack.mitre.org/versions/v8/techniques/T1583/001/) Acquire Infrastructure: Domains Ousaban operators register\ndomains to be used as C&C\nservers.\n\n\n[T1587.001](https://attack.mitre.org/versions/v8/techniques/T1587/001/) Develop Capabilities:\nMalware\n\n\nOusaban is operated by the same\ngroup that develops it.\n\n\nInitial Access [T1566.001](https://attack.mitre.org/versions/v8/techniques/T1566/001/) Phishing: Spearphishing\nAttachment\n\nExecution [T1059.001](https://attack.mitre.org/versions/v8/techniques/T1059/001/) Command and Scripting Interpreter:\nPowerShell\n\n\nOusaban’s initial downloader\nis most commonly distributed\nas a spam attachment.\n\nOusaban uses PowerShell in\nsome distribution chains.\n\n\n[T1059.003](https://attack.mitre.org/versions/v8/techniques/T1059/003/) Command and\nScripting Interpreter:\nWindows Command\nShell\n\n[T1059.007](https://attack.mitre.org/versions/v8/techniques/T1059/007/) Command and\nScripting Interpreter:\nJavaScript/JScript\n\n\nOusaban uses the cmd.exe to\nexecute the legitimate applications\nthat side-load the main Ousaban\npayload.\n\nOusaban uses JavaScript in some\ndistribution chains.\n\n\n-----\n\n**Tactic** **ID** **Name** **Description**\n\n\n[T1204.002](https://attack.mitre.org/versions/v8/techniques/T1204/002/) User Execution:\nMalicious File\n\n\nOusaban relies on the victim to\nexecute the distributed MSI file.\n\n\nPersistence [T1098](https://attack.mitre.org/versions/v8/techniques/T1098/) Account Manipulation Ousaban registers a new local\nadministrator account on the\nvictim’s machine.\n\n\n[T1547.001](https://attack.mitre.org/versions/v8/techniques/T1547/001/) Boot or Logon\nAutostart Execution:\nRegistry Run Keys /\nStartup Folder\n\n\nOusaban achieves persistence\nusing the Run key or startup folder.\n\n\nDefense\nEvasion\n\n\n[T1140](https://attack.mitre.org/versions/v8/techniques/T1140/) Deobfuscate/Decode Files or\nInformation\n\n\nOusaban payloads and\nstrings are encrypted.\n\n\n[T1574.002](https://attack.mitre.org/versions/v8/techniques/T1574/002/) Hijack Execution Flow:\nDLL Side-Loading\n\n[T1562.001](https://attack.mitre.org/versions/v8/techniques/T1562/001/) Impair Defenses:\nDisable or Modify\nTools\n\n[T1562.004](https://attack.mitre.org/versions/v8/techniques/T1562/004/) Impair Defenses:\nDisable or Modify\nSystem Firewall\n\n[T1027.001](https://attack.mitre.org/versions/v8/techniques/T1027/001/) Obfuscated Files or\nInformation: Binary\nPadding\n\n[T1027.002](https://attack.mitre.org/versions/v8/techniques/T1027/002/) Obfuscated Files or\nInformation: Software\nPacking\n\n[T1218.007](https://attack.mitre.org/versions/v8/techniques/T1218/007/) Signed Binary Proxy\nExecution: Msiexec\n\n\nOusaban is often executed by this\ntechnique.\n\nOusaban modifies the RDP settings\nof the victim’s machine.\n\nOusaban modifies Windows firewall\nsettings.\n\nOusaban frequently uses binary\npadding.\n\nOusaban binaries are protected by\nThemida or Enigma packers.\n\nOusaban uses the MSI format for\nexecution.\n\n\nCredential\nAccess\n\n\n[T1056.001](https://attack.mitre.org/versions/v8/techniques/T1056/001/) Input Capture: Keylogging Ousaban can capture\nkeystrokes.\n\n\nDiscovery [T1010](https://attack.mitre.org/versions/v8/techniques/T1010/) Application Window Discovery Ousaban looks for bank- and\nemail-related windows based\non their window names and\ntitles.\n\n\n[T1518.001](https://attack.mitre.org/versions/v8/techniques/T1518/001/) Software Discovery:\nSecurity Software\nDiscovery\n\n[T1082](https://attack.mitre.org/versions/v8/techniques/T1082/) System Information\nDiscovery\n\n\nOusaban collects information about\nthe security software installed on\nthe victim’s machine.\n\nOusaban collects basic information\nabout the victim’s machine, such as\ncomputer name and Windows\nversion.\n\n\n[T1113](https://attack.mitre.org/versions/v8/techniques/T1113/) Screen Capture Ousaban can take screenshots.\n\n\nCommand\nand Control\n\n\n[T1132.002](https://attack.mitre.org/versions/v8/techniques/T1132/002/) Data Encoding: Non-Standard\nEncoding\n\n\nOusaban uses RealThinClient\nthat provides non-standard\nencryption.\n\n\n-----\n\n**Tactic** **ID** **Name** **Description**\n\n\n[T1219](https://attack.mitre.org/versions/v8/techniques/T1219/) Remote Access\nSoftware\n\n\nOusaban installs RDPWrap on the\nvictim’s machine.\n\n\nExfiltration [T1041](https://attack.mitre.org/versions/v8/techniques/T1041/) Exfiltration Over C2 Channel Ousaban exfiltrates data via\nC&C server.\n\n5 May 2021 - 11:30AM\n\n### Sign up to receive an email update whenever a new article is published in our Ukraine Crisis – Digital Security Resource Center\n\n Newsletter\n\n Discussion\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-05-05 - Ousaban- Private photo collection hidden in a CABinet.pdf"
    ],
    "report_names": [
        "2021-05-05 - Ousaban- Private photo collection hidden in a CABinet.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535586,
    "ts_updated_at": 1743041123,
    "ts_creation_date": 1653761496,
    "ts_modification_date": 1653761496,
    "files": {
        "pdf": "https://archive.orkl.eu/9f385cdaf13acbd8f493bc88561685dded9b9208.pdf",
        "text": "https://archive.orkl.eu/9f385cdaf13acbd8f493bc88561685dded9b9208.txt",
        "img": "https://archive.orkl.eu/9f385cdaf13acbd8f493bc88561685dded9b9208.jpg"
    }
}