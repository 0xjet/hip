{
    "id": "8f1f3b4b-8852-40df-9dd6-d34f5f5856f5",
    "created_at": "2023-01-12T15:03:07.395522Z",
    "updated_at": "2025-03-27T02:16:26.511662Z",
    "deleted_at": null,
    "sha1_hash": "19f96fb13fab03915cf0cf3a301dc9941e8dd5ea",
    "title": "2015-07-13 - Revisiting The Bunitu Trojan",
    "authors": "",
    "file_creation_date": "2022-05-28T02:30:10Z",
    "file_modification_date": "2022-05-28T02:30:10Z",
    "file_size": 633253,
    "plain_text": "# Revisiting The Bunitu Trojan\n\n**[blog.malwarebytes.com/threat-analysis/2015/07/revisiting-the-bunitu-trojan/](https://blog.malwarebytes.com/threat-analysis/2015/07/revisiting-the-bunitu-trojan/)**\n\nhasherezade July 13, 2015\n\nThis post describes the infection process of the latest version of the Bunitu Proxy Trojan as\nseen delivered by the Neutrino Exploit Kit via a malvertising campaign.\n\nWe will start from a high-level overview of the issue and used elements. Then, we will dive\ndeeper in the used techniques of hiding and obfuscating the modules.\n\n## What is Bunitu Proxy and why is it dangerous?\n\nAs its name suggests, Bunitu Proxy is a Trojan that exposes the infected computer to be\nused as a proxy for remote clients. It is done in a few steps:\n\n1. Installs itself on the machine\n2. Opens ports for the remote connections\n3. Registers itself in the remote server (clients database) informing about its address and\n\nopen ports\n4. Accepts connections coming on the exposed ports and bypasses the traffic\n\nIt may have various consequences for the infected user. Basically, it uses his/her resources\nand slows down the network traffic. But it may also frame him/her in some illegal activities\ncarried by the attackers due to the fact that the infected client’s IP is the one visible from the\n\n\n-----\n\noutside.\n\n**_[Read more: Who’s Behind Your Proxy? Uncovering Bunitu’s Secrets](https://blog.malwarebytes.org/botnets/2015/08/whos-behind-your-proxy-uncovering-bunitus-secrets/)_**\n\n**How is the infection carried?**\n\nBunitu has been dropped from various exploit kits. On June 10th 2015, as Websense\n[Security Labs described in their post, it was dropped by the Angler Exploit Kit. This time, a](http://community.websense.com/blogs/securitylabs/archive/2015/06/10/large-malvertizing-campaign-leads-to-angler-ek-amp-bunitu-malware.aspx)\nsimilar payload is distributed by Neutrino EK.\n\n## Role of Neutrino EK\n\nA malvertising from Adcash (they have been notified and the problem is already fixed)\nredirected users to the Neutrino EK via a compromised site and rotator.\n\nThe below screenshot from Fiddler Web Debugger, shows the chain of URLs on the way of\ndropping the malicious payload:\n\nThe rotator (.eu domain) does its job of switching to a new sub-domain every few minutes.\nThis technique is often used to bypass blacklists because the malicious URLs are ‘moving\ntargets’:\n\n\n-----\n\nAnd the landing page carried the exploit:\n\nAt this stage, users of [Malwarebytes Anti-Exploit were protected – the product detected and](https://www.malwarebytes.org/antiexploit/?utm_source=blog&utm_medium=social)\nstopped the malicious activity.\n\n\n-----\n\nBut if deployed on a vulnerable, unprotected machine, infection followed further – the\npayload was dropped and deployed.\n\n## Payload: Bunitu Proxy\n\n### Infection symptoms\n\nLooking at the payload from outside, we will see just a typical installer (with an NSIS installer\nicon).\n\n[It pretends to be a legitimate piece of software – scamming an existing product: ManyCam](https://download.manycam.com/)\nby [Visicom Media.](http://www.vmn.net/)\n\nAfter dropping the malicious DLL (described in details further), the installer tries to run it.\nThen we witness the attempt of opening the ports for incoming connections.\n\nWindows Firewall alerts about this attempt (it seems that at this level it relies on social\nengineering – only under Windows XP it managed to suppress these messages to maintain\nstealth).\n\nAlso, after the successful setup, when the computer is restarted, the persistent module runs\nagain – triggering a similar alert:\n\n\n-----\n\nIf we see the details of the running process (rundll32) i.e. in Process Explorer, it will reveal\nthe module that has been loaded:\n\n\n-----\n\nand the open ports (chosen randomly at the time of installation):\n\nIf we keep it running for some time, we may even see the clients, that connected via our\nunwanted proxy (in the below case, july1.exe was used as the name of the installer)\n\n### Technical details\n\nTo hide its real intentions, the installer uses several layers of protection. It takes several\nmodules to run before the malicious DLL (serving as proxy) is revealed. Let’s go deeper!\n\n**Flow:**\n```\ninstaller.exe-> unpacks and loads:\n  lithiasis.dll, function: Avidness -> decrypts and runs using RunPE technique:\n     stub_unpacked.exe -> unpacks and loads:\n       ynfucvu.dll, function: ynfucvu-> perform all the malicious activities\n\n```\n**_installer.exe_**\n\nUnpacks several files into %APPDATA%/Local/Temp/\n\n_It seems that not all of them play a role in unpacking the payload – some are dropped only to_\n_make “noise”_\n\n[random].tmp, i.e.: nsn4CB0.tmp\n\n\n-----\n\npictures\nscript (javascript, YUI module): index(5).php\n**dalookerzmeoajrhja144**\n**UncryptedStub._ini**\n\n[random].tmp/lithiasis.dll (i.e. nse474E.tmp/lithiasis.dll)\n\nThen, it loads the dropped module: lithiasis.dll into memory and executes the function\ncalled – in the analyzed case – Avidness (responsible for further unpacking).\n\n**_lithiasis.dll, Avidness_**\n\n(real name of the module: __Intelerino.dll)\n\n– is unpacked and loaded by the installer.exe\n\n– is obfuscated\n\n– uses files:\n\n**dalookerzmeoajrhja144 – packed list of functions that are going to be loaded in order**\nto do further unpacking\n**UncryptedStub._ini – packed executable (I refer to it as: stub_unpacked.exe)**\n\nKeys used to decrypt the files:\n\n**dalookerzmeoajrhja144 – “dalookerzmeoajrhja144”**\n**UncryptedStub._ini – “9JKjPZSpEL8uHmkHNlXhwhDc9jRTGN”**\n\nFiles are encrypted with obfuscated, custom XOR based algorithms. For each file the used\nalgorithm is slightly different. Below you can see sample python scripts for decoding the files:\n\n[Bunitu Proxy – decoding scripts (github)](https://gist.github.com/hasherezade/430ecbdf2dd1f0d935be)\n\n**#1 Decrypting functions**\n\n\n-----\n\n```\ndef decode1(data, key, max_key):\n  l = len(key)\n  j = 0 #key index\n  decoded = bytearray()\n  for i in range(0, len(data)):\n    decoded.append(data[i] ^ key[j % l])\n    if (i > 0):\n      j += 1\n    if (j == max_key):\n      j = 0\n  return decoded\n\n```\n**#2 Decrypting PE file**\n\n\n-----\n\nresult – a new PE file (stub_unpacked.exe):\n\n\n-----\n\n```\ndef decode2(data, key, max_key):\n  j = 0 #key index\n  prev_j = 0\n  decoded = bytearray()\n  for i in range(0, len(data)):\n    val = data[i] + prev_j\n    val = ((val ^ key[j]) ^ key[prev_j]) % 256\n    decoded.append(val)\n    prev_j = j\n    j = j + 1\n    if (j == max_key):\n      j = 0\n  return decoded\n\n```\nAfter decrypting the new executable: stub_unpacked.exe – it loads it into the memory using\n“RunPE” technique (unmaps the installer.exe and loads the new PE section by section on it’s\nplace).\n\n**_stub_unpacked.exe_**\nIts main role is to unpack from inside the “heart” of the malware: module ynfucvu.dll. It also\nloads and deploys it.\nMakes following registry keys (Winlogon Notify):\n\nThe key ‘zinkraxx’ is used to uniquely identify the installation. It is made by following simple\nalgorithm:\n\n\n-----\n\nIt uses RDTSC (an instruction that reads time-stamp counter into EDX:EAX). Then part of\nthe result (EAX) is processed and writen into a buffer. This buffer is then stored in the\nregistry.\nAfter unpacking the DLL it drops it in %APPDATA%/Local folder:\n\nThen, it loads in the memory and enters in the function ynfucvu of ynfucvu.dll – using JMP\nEAX:\n\n**_ynfucvu.dll, ynfucvu_**\n\nThis is the Bunitu Proxy module – malicious part of the full package. It is independent from\nother modules. Once installed, it is loaded on system startup, using rundll32.exe. The entry\npoint is in the function ynfucvu.\n\n\n-----\n\nIt carries all the network operations – registers the client on the server, opens ports and\nserves as a proxy.\nTechniques used by the Bunitu Proxy module haven’t changed much from June 10th, when it\nwas described by Websense Security Lab. Even the xor-ed value is exactly same!\n\n[compare with the WebSense analysis:](http://community.websense.com/blogs/securitylabs/archive/2015/06/10/large-malvertizing-campaign-leads-to-angler-ek-amp-bunitu-malware.aspx)\n\n\n-----\n\nThis module is slightly obfuscated – i.e. domains used to resolve C&Cs are given in a plain\ntext. Only their addresses are calculated on the fly – to make difficult finding where they are\nreferred. As we see below: the address of the string is calculated on the stack (this DLL is\nalways loaded on the same, predefined base – what makes calculation on the addresses\neasy).\n\nIt is also responsible for creating registry keys used for persistence and tries to be invisible\nfor the firewall – by adding itself to the list of Authorized Applications (but effectiveness of it\nvaries depending on the version of Windows).\n\n### Analyzed sample\n\n[Original sample (installer) md5=542f7b96990de6cd3b04b599c25ebe57 ; payload](https://www.virustotal.com/en/file/14cf87a14700a36d19e4fb98034437adc054417facb45356f296fe0cfe5d28f4/analysis/)\n[(ynfucvu.dll) md5=1bf287bf6cbe4d405983d1431c468de7](https://www.virustotal.com/en/file/a5090acf84510573ac48de030cf59400813a54cd4af42d1de4bcee9d6ee44cb0/analysis/)\n\n## Conclusion\n\nIt seems that this malware is being actively distributed through various exploit kits. However,\nthe mutation of the core is not so fast, as we see our sample is very similar to the one\nobserved a month ago. Still, the used packing, composed of many layers gave it advantage\nof low detection rates in early days after the release.\n\nOn the other hand, the good news is that it’s not an entirely stealthy piece of malware\n(except on Windows XP), so a cautious user can notice some of the alarming symptoms.\n\n**_Part II:_** **_[Who’s Behind Your Proxy? Uncovering Bunitu’s Secrets](https://blog.malwarebytes.org/botnets/2015/08/whos-behind-your-proxy-uncovering-bunitus-secrets/)_**\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2015/2015-07-13 - Revisiting The Bunitu Trojan.pdf"
    ],
    "report_names": [
        "2015-07-13 - Revisiting The Bunitu Trojan.pdf"
    ],
    "threat_actors": [
        {
            "id": "732bfd4b-8c15-42a5-ac4b-14a9a4b902e9",
            "created_at": "2022-10-25T16:07:23.38079Z",
            "updated_at": "2025-03-27T02:02:09.771357Z",
            "deleted_at": null,
            "main_name": "Bahamut",
            "aliases": [],
            "source_name": "ETDA:Bahamut",
            "tools": [
                "Bahamut",
                "DownPaper"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "f99641e0-2688-47b0-97bc-7410659d49a0",
            "created_at": "2023-01-06T13:46:38.802141Z",
            "updated_at": "2025-03-27T02:00:02.922907Z",
            "deleted_at": null,
            "main_name": "Bahamut",
            "aliases": [],
            "source_name": "MISPGALAXY:Bahamut",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "ada9e5d3-1cb2-4b70-a3c8-96808c304ac8",
            "created_at": "2022-10-25T15:50:23.6515Z",
            "updated_at": "2025-03-27T02:00:55.513513Z",
            "deleted_at": null,
            "main_name": "Windshift",
            "aliases": [
                "Windshift",
                "Bahamut"
            ],
            "source_name": "MITRE:Windshift",
            "tools": [
                "WindTail"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535787,
    "ts_updated_at": 1743041786,
    "ts_creation_date": 1653705010,
    "ts_modification_date": 1653705010,
    "files": {
        "pdf": "https://archive.orkl.eu/19f96fb13fab03915cf0cf3a301dc9941e8dd5ea.pdf",
        "text": "https://archive.orkl.eu/19f96fb13fab03915cf0cf3a301dc9941e8dd5ea.txt",
        "img": "https://archive.orkl.eu/19f96fb13fab03915cf0cf3a301dc9941e8dd5ea.jpg"
    }
}