{
    "id": "6512ba30-463d-49bf-a082-5d26c92d5418",
    "created_at": "2023-01-12T15:01:41.245001Z",
    "updated_at": "2025-03-27T02:05:58.374423Z",
    "deleted_at": null,
    "sha1_hash": "f9f67de1478abf96521e13a36e03d20f56829344",
    "title": "2020-05-15 - DBatLoader",
    "authors": "",
    "file_creation_date": "2022-05-28T15:30:12Z",
    "file_modification_date": "2022-05-28T15:30:12Z",
    "file_size": 73940,
    "plain_text": "# DBatLoader\n\n**malpedia.caad.fkie.fraunhofer.de/details/win.dbatloader**\n\n## This Delphi loader misuses Cloud storage services, such as Google Drive to download the Delphi stager component. The Delphi stager has the actual payload embedded as a resource and starts it.\n\n [TLP:WHITE] win_dbatloader_auto (20201014 | autogenerated rule brought to you by yara-signator)\n\n\n-----\n\n```\nrule win_dbatloader_auto {\n  meta:\n    author = \"Felix Bilstein - yara-signator at cocacoding dot com\"\n    date = \"2020-10-14\"\n    version = \"1\"\n    description = \"autogenerated rule brought to you by yara-signator\"\n    tool = \"yara-signator v0.5.0\"\n    signator_config = \"callsandjumps;datarefs;binvalue\"\n    malpedia_reference =\n\"https://malpedia.caad.fkie.fraunhofer.de/details/win.dbatloader\"\n    malpedia_rule_date = \"20201014\"\n    malpedia_hash = \"a7e3bd57eaf12bf3ea29a863c041091ba3af9ac9\"\n    malpedia_version = \"20201014\"\n    malpedia_license = \"CC BY-SA 4.0\"\n    malpedia_sharing = \"TLP:WHITE\"\n  /* DISCLAIMER\n   * The strings used in this rule have been automatically selected from the\n   * disassembly of memory dumps and unpacked files, using YARA-Signator.\n   * The code and documentation is published here:\n   * https://github.com/fxb-cocacoding/yara-signator\n   * As Malpedia is used as data source, please note that for a given\n   * number of families, only single samples are documented.\n   * This likely impacts the degree of generalization these rules will offer.\n   * Take the described generation method also into consideration when you\n   * apply the rules in your use cases and assign them confidence levels.\n   */\n  strings:\n    $sequence_0 = { 8b4504 03c5 8be8 8bc5 2b442414 }\n      // n = 5, score = 600\n      //  8b4504        | mov         eax, dword ptr [ebp +\n4]\n      //  03c5         | add         eax, ebp\n      //  8be8         | mov         ebp, eax\n      //  8bc5         | mov         eax, ebp\n      //  2b442414       | sub         eax, dword ptr [esp +\n0x14]\n    $sequence_1 = { 6681e1ff0f 0fb7c9 03c1 0110 }\n      // n = 4, score = 600\n      //  6681e1ff0f      | and         cx, 0xfff\n      //  0fb7c9        | movzx        ecx, cx\n      //  03c1         | add         eax, ecx\n      //  0110         | add         dword ptr [eax], edx\n    $sequence_2 = { 8b542404 8b5228 8bc6 03d0 8915???????? 6a00 6a01 }\n      // n = 7, score = 600\n      //  8b542404       | mov         edx, dword ptr [esp +\n4]\n      //  8b5228        | mov         edx, dword ptr [edx +\n0x28]\n      //  8bc6         | mov         eax, esi\n      //  03d0         | add         edx, eax\n      //  8915????????     |           \n      //  6a00         | push        0\n      //  6a01         | push        1\n    $sequence_3 = { e8???????? 89442418 8bdd 83c308 8b7c2418 4f }\n      // n = 6, score = 600\n\n```\n\n-----\n\n```\n      //  e8????????      |           \n      //  89442418       | mov         dword ptr [esp +\n0x18], eax\n      //  8bdd         | mov         ebx, ebp\n      //  83c308        | add         ebx, 8\n      //  8b7c2418       | mov         edi, dword ptr [esp +\n0x18]\n      //  4f          | dec         edi\n    $sequence_4 = { e8???????? 50 8b4308 50 8b430c 03c6 50 }\n      // n = 7, score = 600\n      //  e8????????      |           \n      //  50          | push        eax\n      //  8b4308        | mov         eax, dword ptr [ebx +\n8]\n      //  50          | push        eax\n      //  8b430c        | mov         eax, dword ptr [ebx +\n0xc]\n      //  03c6         | add         eax, esi\n      //  50          | push        eax\n    $sequence_5 = { 89442420 df6c241c d835???????? e8???????? 89442418 }\n      // n = 5, score = 600\n      //  89442420       | mov         dword ptr [esp +\n0x20], eax\n      //  df6c241c       | fild        qword ptr [esp +\n0x1c]\n      //  d835????????     |           \n      //  e8????????      |           \n      //  89442418       | mov         dword ptr [esp +\n0x18], eax\n    $sequence_6 = { 8b4500 03c6 0fb70b 6681e1ff0f 0fb7c9 }\n      // n = 5, score = 600\n      //  8b4500        | mov         eax, dword ptr [ebp]\n      //  03c6         | add         eax, esi\n      //  0fb70b        | movzx        ecx, word ptr [ebx]\n      //  6681e1ff0f      | and         cx, 0xfff\n      //  0fb7c9        | movzx        ecx, cx\n    $sequence_7 = { 8b5c2404 81c3f8000000 8b442404 0fb77806 }\n      // n = 4, score = 600\n      //  8b5c2404       | mov         ebx, dword ptr [esp +\n4]\n      //  81c3f8000000     | add         ebx, 0xf8\n      //  8b442404       | mov         eax, dword ptr [esp +\n4]\n      //  0fb77806       | movzx        edi, word ptr [eax +\n6]\n    $sequence_8 = { 8944240c 8b44240c 894834 8b44240c 05f8000000 }\n      // n = 5, score = 200\n      //  8944240c       | mov         dword ptr [esp +\n0xc], eax\n      //  8b44240c       | mov         eax, dword ptr [esp +\n0xc]\n      //  894834        | mov         dword ptr [eax +\n0x34], ecx\n      //  8b44240c       | mov         eax, dword ptr [esp +\n0xc]\n      //  05f8000000      | add         eax, 0xf8\n\n```\n\n-----\n\n```\n    $sequence_9 { 50 8b442410 8b4034 50 e8???????? }\n      // n = 5, score = 200\n      //  50          | push        eax\n      //  8b442410       | mov         eax, dword ptr [esp +\n0x10]\n      //  8b4034        | mov         eax, dword ptr [eax +\n0x34]\n      //  50          | push        eax\n      //  e8????????      |           \n    $sequence_10 = { e9???????? 90 90 90 90 90 90 }\n      // n = 7, score = 200\n      //  e9????????      |           \n      //  90          | nop         \n      //  90          | nop         \n      //  90          | nop         \n      //  90          | nop         \n      //  90          | nop         \n      //  90          | nop         \n    $sequence_11 = { 90 90 81ca80000000 eb52 90 }\n      // n = 5, score = 200\n      //  90          | nop         \n      //  90          | nop         \n      //  81ca80000000     | or         edx, 0x80\n      //  eb52         | jmp         0x54\n      //  90          | nop         \n    $sequence_12 = { 90 90 90 83ca10 8bc2 c3 }\n      // n = 6, score = 200\n      //  90          | nop         \n      //  90          | nop         \n      //  90          | nop         \n      //  83ca10        | or         edx, 0x10\n      //  8bc2         | mov         eax, edx\n      //  c3          | ret         \n    $sequence_13 = { 33c0 89442440 df6c243c d835???????? e8???????? }\n      // n = 5, score = 200\n      //  33c0         | xor         eax, eax\n      //  89442440       | mov         dword ptr [esp +\n0x40], eax\n      //  df6c243c       | fild        qword ptr [esp +\n0x3c]\n      //  d835????????     |           \n      //  e8????????      |           \n    $sequence_14 = { 8b44241c 8b4024 e8???????? 50 8b442420 8b4008 50 }\n      // n = 7, score = 200\n      //  8b44241c       | mov         eax, dword ptr [esp +\n0x1c]\n      //  8b4024        | mov         eax, dword ptr [eax +\n0x24]\n      //  e8????????      |           \n      //  50          | push        eax\n      //  8b442420       | mov         eax, dword ptr [esp +\n0x20]\n      //  8b4008        | mov         eax, dword ptr [eax +\n8]\n      //  50          | push        eax\n    $sequence_15 = { 83c4c0 8bf0 8d3c24 b910000000 }\n\n```\n\n-----\n\n```\n      // n 4, score 200\n      //  83c4c0        | add         esp, -0x40\n      //  8bf0         | mov         esi, eax\n      //  8d3c24        | lea         edi, [esp]\n      //  b910000000      | mov         ecx, 0x10\n    $sequence_16 = { 52 50 8b442410 8b403c 99 }\n      // n = 5, score = 200\n      //  52          | push        edx\n      //  50          | push        eax\n      //  8b442410       | mov         eax, dword ptr [esp +\n0x10]\n      //  8b403c        | mov         eax, dword ptr [eax +\n0x3c]\n      //  99          | cdq         \n    $sequence_17 = { 8bea 8bd8 90 90 }\n      // n = 4, score = 200\n      //  8bea         | mov         ebp, edx\n      //  8bd8         | mov         ebx, eax\n      //  90          | nop         \n      //  90          | nop         \n    $sequence_18 = { 022e 310500000000 0c00 0000 94 }\n      // n = 5, score = 200\n      //  022e         | add         ch, byte ptr [esi]\n      //  310500000000     | xor         dword ptr [0], eax\n      //  0c00         | or         al, 0\n      //  0000         | add         byte ptr [eax], al\n      //  94          | xchg        eax, esp\n    $sequence_19 = { 6800200000 8b44240c 8b4050 50 }\n      // n = 4, score = 200\n      //  6800200000      | push        0x2000\n      //  8b44240c       | mov         eax, dword ptr [esp +\n0xc]\n      //  8b4050        | mov         eax, dword ptr [eax +\n0x50]\n      //  50          | push        eax\n    $sequence_20 = { 8bd8 33c0 55 68???????? 64ff30 648920 90 }\n      // n = 7, score = 200\n      //  8bd8         | mov         ebx, eax\n      //  33c0         | xor         eax, eax\n      //  55          | push        ebp\n      //  68????????      |           \n      //  64ff30        | push        dword ptr fs:[eax]\n      //  648920        | mov         dword ptr fs:[eax],\nesp\n      //  90          | nop         \n    $sequence_21 = { 51 b910000000 f3a5 59 }\n      // n = 4, score = 200\n      //  51          | push        ecx\n      //  b910000000      | mov         ecx, 0x10\n      //  f3a5         | rep movsd      dword ptr es:[edi],\ndword ptr [esi]\n      //  59          | pop         ecx\n    $sequence_22 = { 8b442418 8b403c 99 030424 13542404 }\n      // n = 5, score = 200\n      //  8b442418       | mov         eax, dword ptr [esp +\n\n```\n\n-----\n\n```\n0x18]\n      //  8b403c        | mov         eax, dword ptr [eax +\n0x3c]\n      //  99          | cdq         \n      //  030424        | add         eax, dword ptr [esp]\n      //  13542404       | adc         edx, dword ptr [esp +\n4]\n    $sequence_23 = { 8d3c24 b910000000 f3a5 90 90 90 }\n      // n = 6, score = 200\n      //  8d3c24        | lea         edi, [esp]\n      //  b910000000      | mov         ecx, 0x10\n      //  f3a5         | rep movsd      dword ptr es:[edi],\ndword ptr [esi]\n      //  90          | nop         \n      //  90          | nop         \n      //  90          | nop         \n  condition:\n    7 of them and filesize < 54214656\n}\n\n## [TLP:WHITE] win_dbatloader_w0  (20211012 | Detects cryptographic routine)\nrule win_dbatloader_w0 {\n  meta:\n    author = \"Daniel Plohmann <daniel.plohmann<at>fkie.fraunhofer.de>\"\n    date = \"2021-10-12\"\n    version = \"1\"\n    description = \"Detects cryptographic routine\"\n    malpedia_reference =\n\"https://malpedia.caad.fkie.fraunhofer.de/details/win.dbatloader\"\n    malpedia_rule_date = \"20211012\"\n    malpedia_hash = \"\"\n    malpedia_version = \"20211012\"\n    malpedia_license = \"CC BY-SA 4.0\"\n    malpedia_sharing = \"TLP:WHITE\"\n  strings:\n    /*\n                   loc_413930:\n    8D 45 E4           lea   eax, [ebp+var_1C]\n    8B 55 F8           mov   edx, [ebp+var_8]\n    8A 54 1A FF          mov   dl, [edx+ebx-1]\n    0F B7 CF           movzx  ecx, di\n    C1 E9 08           shr   ecx, 8\n    32 D1             xor   dl, cl\n    */\n    $xor_decrypt = { 8D 45 E4 8B 55 F8 8A 54 1A FF 0F B7 CF C1 E9 08 32\nD1 }\n  condition:\n    all of them\n}\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-05-15 - DBatLoader.pdf"
    ],
    "report_names": [
        "2020-05-15 - DBatLoader.pdf"
    ],
    "threat_actors": [
        {
            "id": "3f86085e-95c5-4007-8bd7-86ad330ce4eb",
            "created_at": "2022-10-25T16:07:24.457008Z",
            "updated_at": "2025-03-27T02:02:10.238521Z",
            "deleted_at": null,
            "main_name": "Bismuth",
            "aliases": [
                "Canvas Cyclone"
            ],
            "source_name": "ETDA:Bismuth",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535701,
    "ts_updated_at": 1743041158,
    "ts_creation_date": 1653751812,
    "ts_modification_date": 1653751812,
    "files": {
        "pdf": "https://archive.orkl.eu/f9f67de1478abf96521e13a36e03d20f56829344.pdf",
        "text": "https://archive.orkl.eu/f9f67de1478abf96521e13a36e03d20f56829344.txt",
        "img": "https://archive.orkl.eu/f9f67de1478abf96521e13a36e03d20f56829344.jpg"
    }
}