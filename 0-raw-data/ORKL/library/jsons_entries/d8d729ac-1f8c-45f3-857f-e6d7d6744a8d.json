{
    "id": "d8d729ac-1f8c-45f3-857f-e6d7d6744a8d",
    "created_at": "2023-01-12T15:10:55.309618Z",
    "updated_at": "2025-03-27T02:15:26.128524Z",
    "deleted_at": null,
    "sha1_hash": "d1df4dd83a766b1b0d3e9f45933cfb51dda35ba8",
    "title": "2022-12-20 - Nokoyawa Ransomware- Rust or Bust",
    "authors": "",
    "file_creation_date": "2022-12-29T00:40:23Z",
    "file_modification_date": "2022-12-29T00:40:23Z",
    "file_size": 610873,
    "plain_text": "# Nokoyawa Ransomware: Rust or Bust\n\n**[zscaler.com/blogs/security-research/nokoyawa-ransomware-rust-or-bust](https://www.zscaler.com/blogs/security-research/nokoyawa-ransomware-rust-or-bust)**\n\n## Key Points\n\n_Nokoyawa is a 64-bit Windows-based ransomware family that emerged in February_\n2022\nThe threat group behind Nokoyawa performs double extortion ransomware attacks:\nexfiltrating sensitive information from organizations, followed by file encryption and a\nransom payment demand\nNokoyawa was initially written in the C programming language using Elliptic Curve\nCryptography (ECC) with SECT233R1 and Salsa20 for file encryption\nIn September 2022, Nokoyawa was rewritten in the Rust programming language\nusing ECC with the Curve25519 and Salsa20 for file encryption\nThe Rust-based Nokoyama ransomware 2.0 provides threat actors with runtime\nflexibility via a configuration parameter that is passed via the command-line\n\nNokoyawa ransomware was discovered in February 2022, sharing code with another\n[ransomware family known as Karma. Nokoyawa ransomware’s](https://www.sentinelone.com/labs/nokoyawa-ransomware-new-karma-nemty-variant-wears-thin-disguise/) [lineage can further be](https://www.fortinet.com/blog/threat-research/nokoyawa-variant-catching-up)\ntraced back to Nemty ransomware. The original version of Nokoyawa ransomware was\nwritten in the C programming language and file encryption utilized asymmetric Elliptic Curve\n[Cryptography (ECC) with Curve SECT233R1 (a.k.a. NIST B-233) using the Tiny-ECDH](https://github.com/kokke/tiny-ECDH-c)\nopen source library combined with a per file Salsa20 symmetric key. Nokoyawa\nransomware 2.0 still uses Salsa20 for symmetric encryption, but the elliptic curve was\nreplaced with Curve25519.\n\n\n-----\n\nNokoyawa 2.0 was developed using the Rust programming language and appears to have\nbeen created in late September 2022. Nokoyawa is not the first ransomware family to be\nrewritten in Rust. Previously, the developers of the ransomware\nfamilies _[Hive and](https://www.microsoft.com/en-us/security/blog/2022/07/05/hive-ransomware-gets-upgrades-in-rust/)_ _[Agenda/Qilin ported their code from the Go (a.k.a. Golang) programming](https://www.trendmicro.com/en_us/research/22/l/agenda-ransomware-uses-rust-to-target-more-vital-industries.html)_\n[language to Rust. In addition, the author of RansomExx converted the ransomware code](https://securityintelligence.com/posts/ransomexx-upgrades-rust/)\nfrom C++ to Rust. Another ransomware family compiled in Rust is BlackCat/ALPHV. The\nincrease in the popularity of the Rust programming language may be due to its emphasis on\nperformance and concurrency, which can make a ransomware’s file encryption more\nefficient. Similar to the previous version of Nokoyawa, the Rust variant is compiled only for\n64-bit versions of Windows.\n\nThis blog provides a technical analysis of Nokoyawa 2.0 including its new configuration,\nencryption algorithms, and data leak site.\n\n## Technical Analysis\n\nNokoyawa 2.0 cannot be executed without providing the required command-line arguments.\nWhen run without arguments, Nokoyawa will print the following help message shown in\nFigure 1.\n\nFigure 1. Nokoyawa 2.0 ransomware command-line help\n\nThe command-line arguments --file (to encrypt a single file) and --dir (to encrypt a directory)\nare identical to the previous version of Nokoyawa. However, Nokoyawa 2.0 requires a\nconfiguration file to execute the ransomware via the --config command-line argument. The\nconfiguration parameter is a Base64 encoded JSON object that has the following keys and\nvalues shown in Table 1.\n\n**Key** **Value Format** **Description**\n\n\n_NOTE_NAME_ <filename> (will be\nappended with .txt)\n\n\nRansom note filename\n\n\n_NOTE_CONTENT_ Base64 encoded text Ransom note content\n\n\n_EXTENSION_ <8 characters> (without a\nperiod)\n\n\nEncrypted file extension (also used as\nthe Salsa20 nonce)\n\n\n-----\n\n_ECC_PUBLIC_ Base64 encoded binary\ndata\n\n\nCurve25519 public key\n\n\n_SKIP_EXTS_ JSON array File extensions that will not be\nencrypted\n\n_SKIP_DIRS_ JSON array Directories that will not be encrypted\n\nTable 1. Nokoyawa 2.0 configuration parameters\n\nThe decision by the Nokoyawa malware author to pass a full configuration file via the\ncommand-line is a unique design choice. This is indicative that the malware author has\ndeveloped the ransomware to be flexible for mulitiple threat actors who are likely paid as\naffiliates to compromise organizations and deploy the ransomware in return for a\npercentage of the profit.\n\n## Encryption Algorithms\n\n[Nokoyawa 2.0 uses Curve25519 (via the open source x25519_dalek Rust library) for](https://docs.rs/x25519-dalek/0.2.1/x25519_dalek/)\nasymmetric encryption and Salsa20 for symmetric encryption. Nokoyawa first generates an\nephemeral Curve25519 key pair. The ephemeral private key is used to generate a shared\nsecret using a Diffie-Hellman key exchange with the Curve25519 public key that was\npassed via the config command-line parameter. The result is used as a Salsa20 key and\nthe file extension is used as the nonce, which must be 8 bytes (as described in Table 1).\nFigure 2 shows an example file encrypted by Nokoyawa 2.0.\n\n\n-----\n\nFigure 2. Nokayawa 2.0 encrypted file content and footer\n\nAs shown in Figure 2, the 32-byte ephemeral public key (blue) and the 8-byte nonce (red)\nare appended as a 40-byte footer at the end of the encrypted file. Similar to most\nransomware families, Nokoyawa encrypts the file in chunks based on the file's size. If the\nfile's size is less than or equal to 0x80000 (524,288) bytes, the full file will be encrypted.\nOtherwise the code implements an algorithm that determines the number of blocks and the\nblock offsets to encrypt in the file. Each block will be encrypted in chunks of 0x80000 bytes\n(yellow) followed by blocks of unencrypted bytes (green) as highlighted in Figure 2. Since\nNokoyawa only partially encrypts files larger than 0x80000 bytes, encryption is very fast.\n\nThreatLabz has developed a proof-of-concept tool to decrypt files encrypted by Nokoyawa\n2.0 if the Curve25519 private key is accessible. This decryption tool is available in our\n[GitHub tools repository here.](https://github.com/threatlabz/tools/tree/main/nokoyawa)\n\n## Ransom Note\n\nAs previously mentioned in Table 1, the Nokyawa ransomware note filename and content is\npassed via the configuration command-line parameter. An example Nokoyawa ransom note\nis shown in Figure 3.\n\n\n-----\n\nFigure 3. Nokoyawa ransom note\n\n## Ransom portal\n\nNokoyawa ransom notes contain a link to a TOR hidden service as shown in Figure 4.\n\n\n-----\n\nFigure 4. Nokoyawa ransom chat portal\n\nThe same TOR hidden service also hosts a data leak site. Currently, only one victim is listed\non the site as shown in Figure 5. This may suggest that Nokoyawa is not currently\ncompromising a large number of organizations, or the threat actors may only perform\ndouble extortion for a subset of victims.\n\nFigure 5. Nokoyawa leak site\n\n## Conclusion\n\nThe Nokoyawa threat actor continues to update the ransomware and launch new attacks.\nThe development of Nokoyawa 2.0 using the Rust programming language is likely designed\nto improve file encryption speed and to better evade antivirus and EDR products. The group\nhas long claimed to perform double extortion attacks without offering much proof, until now.\n\n## Cloud Sandbox Detection\n\n\n-----\n\nIn addition to sandbox detections, Zscaler’s multilayered cloud security platform detects\nindicators related to Nokoyawa at various levels with the following threat names:\n\n[Win64.Ransom.NOKOYAWA](https://threatlibrary.zscaler.com/threats/53bff672-df71-43ee-8cb6-ce3fb9d810f4)\n\n## Indicators of Compromise\n\nSHA256 Description\n\n7095beafff5837070a89407c1bf3c6acf8221ed786e0697f6c578d4c3de0efd6 Nokoyawa\nransomware\nRust sample\n\n47c00ac29bbaee921496ef957adaf5f8b031121ef0607937b003b6ab2a895a12 Nokoyawa\nransomware\nRust sample\n\n259f9ec10642442667a40bf78f03af2fc6d653443cce7062636eb750331657c4 Nokoyawa\nransomware\nRust sample\n\n# Security Research\n\n\n-----\n\n# Ransomware\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-12-20 - Nokoyawa Ransomware- Rust or Bust.pdf"
    ],
    "report_names": [
        "2022-12-20 - Nokoyawa Ransomware- Rust or Bust.pdf"
    ],
    "threat_actors": [
        {
            "id": "20c759c2-cd02-45bb-85c6-41bde9e6a7cf",
            "created_at": "2024-01-18T02:02:34.189827Z",
            "updated_at": "2025-03-27T02:02:09.937024Z",
            "deleted_at": null,
            "main_name": "HomeLand Justice",
            "aliases": [
                "Karma",
                "Storm-842",
                "Void Manticore"
            ],
            "source_name": "ETDA:HomeLand Justice",
            "tools": [
                "BABYWIPER",
                "BiBi Wiper",
                "BiBi-Linux Wiper",
                "BiBi-Windows Wiper",
                "Cl Wiper",
                "LowEraser",
                "No-Justice Wiper",
                "Plink",
                "PuTTY Link",
                "RevSocks",
                "W2K Res Kit"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "6e23ce43-e1ab-46e3-9f80-76fccf77682b",
            "created_at": "2022-10-25T16:07:23.303713Z",
            "updated_at": "2025-03-27T02:02:09.727245Z",
            "deleted_at": null,
            "main_name": "ALPHV",
            "aliases": [
                "ALPHV",
                "ALPHVM",
                "BlackCat Gang",
                "UNC4466"
            ],
            "source_name": "ETDA:ALPHV",
            "tools": [
                "ALPHV",
                "ALPHVM",
                "BlackCat",
                "GO Simple Tunnel",
                "GOST",
                "Impacket",
                "LaZagne",
                "MEGAsync",
                "Mimikatz",
                "Munchkin",
                "Noberus",
                "PsExec",
                "Remcom",
                "RemoteCommandExecution",
                "WebBrowserPassView"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536255,
    "ts_updated_at": 1743041726,
    "ts_creation_date": 1672274423,
    "ts_modification_date": 1672274423,
    "files": {
        "pdf": "https://archive.orkl.eu/d1df4dd83a766b1b0d3e9f45933cfb51dda35ba8.pdf",
        "text": "https://archive.orkl.eu/d1df4dd83a766b1b0d3e9f45933cfb51dda35ba8.txt",
        "img": "https://archive.orkl.eu/d1df4dd83a766b1b0d3e9f45933cfb51dda35ba8.jpg"
    }
}