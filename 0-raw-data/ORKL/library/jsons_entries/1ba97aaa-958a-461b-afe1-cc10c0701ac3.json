{
    "id": "1ba97aaa-958a-461b-afe1-cc10c0701ac3",
    "created_at": "2023-06-05T02:07:50.703132Z",
    "updated_at": "2025-03-27T02:14:58.847179Z",
    "deleted_at": null,
    "sha1_hash": "61ebbd5bef0a1d6aef747cd0b84da2a3c7e63238",
    "title": "2023-05-25 - COSMICENERGY- New OT Malware Possibly Related To Russian Emergency Response Exercises",
    "authors": "",
    "file_creation_date": "2023-06-04T13:03:15Z",
    "file_modification_date": "2023-06-04T13:03:15Z",
    "file_size": 2095531,
    "plain_text": "# COSMICENERGY: New OT Malware Possibly Related To Russian Emergency Response Exercises\n\n**mandiant.com/resources/blog/cosmicenergy-ot-malware-russian-response**\n\nMandiant identified novel operational technology (OT) / industrial control system (ICS)-oriented malware, which we track as\nCOSMICENERGY, uploaded to a public malware scanning utility in December 2021 by a submitter in Russia. The malware\nis designed to cause electric power disruption by interacting with IEC 60870-5-104 (IEC-104) devices, such as remote\nterminal units (RTUs), that are commonly leveraged in electric transmission and distribution operations in Europe, the\nMiddle East, and Asia.\n\nCOSMICENERGY is the latest example of specialized OT malware capable of causing cyber physical impacts, which are\nrarely discovered or disclosed. What makes COSMICENERGY unique is that based on our analysis, a contractor may have\ndeveloped it as a red teaming tool for simulated power disruption exercises hosted by Rostelecom-Solar, a Russian cyber\nsecurity company. Analysis into the malware and its functionality reveals that its capabilities are comparable to those\n[employed in previous incidents and malware, such as INDUSTROYER and](https://www.welivesecurity.com/2017/06/12/industroyer-biggest-threat-industrial-control-systems-since-stuxnet/) [INDUSTROYER.V2, which were both malware](https://www.mandiant.com/resources/blog/industroyer-v2-old-malware-new-tricks)\nvariants deployed in the past to impact electricity transmission and distribution via IEC-104.\n\nThe discovery of COSMICENERGY illustrates that the barriers to entry for developing offensive OT capabilities are lowering\nas actors leverage knowledge from prior attacks to develop new malware. Given that threat actors use red team tools and\npublic exploitation frameworks for targeted threat activity in the wild, we believe COSMICENERGY poses a plausible threat\nto affected electric grid assets. OT asset owners leveraging IEC-104 compliant devices should take action to preempt\npotential in the wild deployment of COSMICENERGY.\n\n## COSMICENERGY Overview\n\n[COSMICENERGY’s capabilities and overall attack strategy appear reminiscent of the 2016 INDUSTROYER incident, which](https://www.eset.com/int/industroyer/)\n[issued IEC-104 ON/OFF commands to interact with RTUs and, according to one analysis, may have made use of an](https://www.virusbulletin.com/conference/vb2018/abstracts/anatomy-attack-detecting-and-defeating-crashoverride/)\nMSSQL server as a conduit system to access OT. Leveraging this access, an attacker can send remote commands to affect\nthe actuation of power line switches and circuit breakers to cause power disruption. COSMICENERGY accomplishes this\nvia its two derivative components which we track as PIEHOP and LIGHTWORK (see appendices for technical analyses)\n\n\n-----\n\nPIEHOP is a disruption tool written in Python and packaged with PyInstaller that is capable of connecting to a user\nsupplied remote MSSQL server for uploading files and issuing remote commands to a RTU. PIEHOP utilizes\nLIGHTWORK to issue the IEC-104 commands \"ON\" or \"OFF\" to the remote system and then immediately deletes the\nexecutable after issuing the command. The sample of PIEHOP we obtained contains programming logic errors that\nprevent it from successfully performing its IEC-104 control capabilities, but we believe these errors can be easily\ncorrected.\nLIGHTWORK is a disruption tool written in C++ that implements the IEC-104 protocol to modify the state of RTUs over\nTCP. It crafts configurable IEC-104 Application Service Data Unit (ASDU) messages, to change the state of RTU\nInformation Object Addresses (IOAs) to ON or OFF. LIGHTWORK utilizes positional command line arguments for\ntarget device, port, and IEC-104 command.\n\nFigure 1: COSMICENERGY execution chain\nCOSMICENERGY lacks discovery capabilities, which implies that to successfully execute an attack the malware operator\nwould need to perform some internal reconnaissance to obtain environment information, such as MSSQL server IP\naddresses, MSSQL credentials, and target IEC-104 device IP addresses. The sample of LIGHTWORK we obtained\nincludes eight hardcoded IEC-104 information object addresses (IOA), which typically correlate with input or output data\nelements on a device and may correspond to power line switches or circuit breakers in an RTU or relay configuration.\nHowever, IOA mappings often differ between manufacturers, devices, and even environments. For this reason, the\nparticular actions intended by the actor are unclear without further knowledge about the targeted assets.\n\n## COSMICENERGY Possibly Associated With Russian Government-Funded Power Disruption and Emergency Response Exercises\n\nDuring our analysis of COSMICENERGY, we identified a comment in the code that indicated the sample uses a module\nassociated with a project named “Solar Polygon” (Figure 2). We searched for the unique string and identified a single match\nto a cyber range (aka polygon) developed by Rostelecom-Solar, a Russian cyber security company that received a\n[government subsidy in 2019 to begin training cyber security experts and conducting electric power disruption and](https://tadviser.com/index.php/Project:Cyber_%E2%80%8B_%E2%80%8B_police_of_Russia_for_information_security_training)\nemergency response exercises.\n\n\n-----\n\nFigure 2: PIEHOP comment referring to “Solar Polygon”\nAlthough we have not identified sufficient evidence to determine the origin or purpose of COSMICENERGY, we believe that\nthe malware was possibly developed by either Rostelecom-Solar or an associated party to recreate real attack scenarios\nagainst energy grid assets. It is possible that the malware was used to support exercises such as the ones hosted by\n[Rostelecom-Solar in 2021 in collaboration with the Russian Ministry of Energy or in 2022 for the St.Petersburg’s](https://news.itmo.ru/en/university_live/achievements/news/12646/)\nInternational Economic Forum (SPIEF).\n\nHowever, given the lack of conclusive evidence, we consider it also possible that a different actor - either with or without\npermission - reused code associated with the cyber range to develop this malware. Threat actors regularly adapt and make\nuse of red team tools - such as commercial and publicly available exploitation frameworks - to facilitate real world attacks,\n[like TEMP.Veles’ use of METERPRETER during the TRITON attack. There are also many examples of nation-state actors](https://www.mandiant.com/resources/blog/Mandiant-approach-to-operational-technology-security)\nleveraging contractors to develop offensive capabilities, as shown most recently in contracts between Russia’s Ministry of\nDefense and NTC Vulkan. These observations leave open the possibility that COSMICENERGY was developed with\nmalicious intent, and at a minimum that it can be used to support targeted threat activity in the wild.\n\n## COSMICENERGY Shares Similarities with Existing OT Malware\n\nAlthough COSMICENERGY does not directly overlap with any previously observed malware families, its capabilities are\ncomparable to those employed in previous incidents and malware. The most significant similarities we identified are with\nINDUSTROYER and INDUSTROYER.V2, which were both malware variants deployed in the past to impact electricity\ntransmission and distribution. COSMICENERGY also has notable technical similarities with other OT malware families that\nhave been developed or packaged using Python or that have utilized open-source libraries for OT protocol implementation,\n[including IRONGATE,](https://www.mandiant.com/resources/blog/irongate-ics-malware) [TRITON, and](https://www.mandiant.com/resources/blog/attackers-deploy-new-ics-attack-framework-triton) [INCONTROLLER. Further analyses of these similarities are available via Mandiant](https://www.mandiant.com/resources/blog/incontroller-state-sponsored-ics-tool)\nAdvantage.\n\nWith regards to these similarities, we highlight the following trends which could manifest in future OT malware:\n\n_Abuse of insecure by design protocols: While OT-oriented malware families can be purpose built for a particular target_\nenvironment, malware that takes advantage of insecure by design OT protocols, such as LIGHTWORK’s abuse of the\nIEC-104 protocol, can be modified and employed multiple times to target multiple victims.\n_Use of open source libraries for protocol implementation: The availability of open source projects that implement OT_\nprotocols can lower the barrier of entry for actors attempting to interact with OT devices. However, proprietary OT\nprotocols will likely continue to require custom protocol implementations.\n_Use of Python for malware development and/or packaging: We expect to continue to observe attackers compiling or_\npackaging their OT malware via methods such as PyInstaller (IRONGATE) or Py2Exe (TRITON) given the\nproliferation of OT malware developed or packaged using Python in recent years.\n\n## Outlook\n\nWhile COSMICENERGY’s capabilities are not significantly different from previous OT malware families’, its discovery\nhighlights several notable developments in the OT threat landscape. First, the discovery of new OT malware presents an\nimmediate threat to affected organizations, since these discoveries are rare and because the malware principally takes\nadvantage of insecure by design features of OT environments that are unlikely to be remedied any time soon. Second, as\nCOSMICENERGY was potentially developed as part of a red team, this discovery suggests that the barriers to entry are\nlowering for offensive OT threat activity since we normally observe these types of capabilities limited to well resourced or\nstate sponsored actors. Lastly, we emphasize that although the samples of COSMICENERGY we obtained are potentially\nred team related, threat actors regularly leverage contractors and red team tools in real world threat activity, including during\nOT attacks.\n\nFor these reasons, OT defenders and asset owners should take mitigating actions against COSMICENERGY to preempt in\nthe wild deployment and to better understand common features and capabilities that are frequently deployed in OT\nmalware. Such knowledge can be useful when performing threat hunting exercises and deploying detections to identify\nmalicious activity within OT environments.\n\n\n-----\n\n_If you need support responding to related activity, please contact_ _[Mandiant Consulting. Further analysis of](https://www.mandiant.com/services/incident-response)_\n_[COSMICENERGY is available as part of Mandiant Advantage Threat Intelligence.](https://www.mandiant.com/advantage/threat-intelligence)_\n\n## Discovery Methods\n\nWe provide at-risk organizations with the following discovery methods to conduct threat hunts for tactics, techniques, and\nprocedures (TTPs) implemented derived from the toolset:\n\nEstablish collection and aggregation of host-based logs for crown jewels systems such as human-machine interfaces\n(HMI), engineering workstations (EWS), and OPC client servers within their environments and review logs for the\nevidence of Python script or unauthorized code execution on these systems.\nIdentify and investigate the creation, transfer, and/or execution of unauthorized Python-packaged executables (e.g.,\nPyInstaller or Py2Exe) on OT systems or systems with access to OT resources.\nMonitor systems with access to OT resources for the creation of legitimate temporary folders, files, artifacts, and\nexternal libraries required as evidence of the execution of packaged Python scripts.\n\nCreation of temporary “_MEIPASS” PyInstaller folder.\nMonitor MSSQL Servers with access to OT systems and networks for evidence of:\n\nReconnaissance and enumeration activity of MSSQL servers and\ncredentials.\nUnauthorized network connections to MSSQL servers (TCP/1433) and irregular or unauthorized authentication.\nEnablement and usage of SQL extended stored procedures for Windows shell command execution:\n\nFigure 3: PIEHOP SQL command\nCertutil command usage:\n\n“certutil -hashfile”\n“certutil -decode”\nTransfer, creation, staging, and decoding of base64 encoded executables.\n\n## Appendix A: COSMICENERGY Overview\n\nTable 1: COSMICENERGY overview\n\n**Filename** **Description** **Hash**\n\n\nr3_iec104_control.exe PIEHOP\nPyInstaller\nexecutable\n\nr3_iec104_control PIEHOP\nPython\ncompiled\nbytecode\nentry point\n\nr3_iec104_control.py Decompiled\nPIEHOP\nentry point\nPython script\n\n\n**MD5: cd8f394652db3d0376ba24a990403d20**\n\n**SHA1: bc07686b422aa0dd01c87ccf557863ee62f6a435**\n\n**SHA256:**\n358f0f8c23acea82c5f75d6a2de37b6bea7785ed0e32c41109c217c48bf16010\n\n**MD5: f716b30fc3d71d5e8678cc6b81811db4**\n\n**SHA1: e91e4df49afa628fba1691b7c668af64ed6b0e1d**\n\n**SHA256:**\n7dc25602983f7c5c3c4e81eeb1f2426587b6c1dc6627f20d51007beac840ea2b\n\n**MD5: c018c54eff8fd0b9be50b5d419d80f21**\n\n**SHA1: 4d7c4bc20e8c392ede2cb0cef787fe007265973b**\n\n**SHA256:**\n8933477e82202de97fb41f4cbbe6af32596cec70b5b47da022046981c01506a7\n\n\n-----\n\niec104_mssql_lib.pyc PIEHOP\nPython\ncompiled\nbytecode\n\niec104_mssql_lib.py Decompiled\nPIEHOP\nPython script\n\nOT_T855_IEC104_GR.exe LIGHTWORK\nexecutable\n\n\n**MD5: adfa40d44a58e1bc909abca444f7f616**\n\n**SHA1: a9b5b16769f604947b9d8262841aa3082f7d71a2**\n\n**SHA256:**\n182d6f5821a04028fe4b603984b4d33574b7824105142b722e318717a688969e\n\n**MD5: 2b86adb6afdfa9216ef8ec2ff4fd2558**\n\n**SHA1: 20c9c04a6f8b95d2f0ce596dac226d56be519571**\n\n**SHA256:**\n90d96bb2aa2414a0262d38cc805122776a9405efece70beeebf3f0bcfc364c2d\n\n**MD5: 7b6678a1c0000344f4faf975c0cfc43d**\n\n**SHA1: 6eceb78acd1066294d72fe86ed57bf43bc6de6eb**\n\n**SHA256:**\n740e0d2fba550308344b2fb0e5ecfebdd09329bdcfaa909d3357ad4fe5552532\n\n\n## Appendix B: PIEHOP Technical Analysis\n\nPIEHOP (filename: r3_iec104_control.exe) (MD5: cd8f394652db3d0376ba24a990403d20) is a disruption tool written in\nPython and packaged with PyInstaller version 2.1+ that has the capability to connect to a user supplied remote MSSQL\nserver for uploading files and issuing remote commands to a RTU.\n\nPIEHOP expects its main function to be called via another Python file, supplying either the argument control=True or\n```\nupload=True. At a minimum, it requires the following arguments: oik, user, and pwd, and if called with control=True, it\n\n```\nmust also be supplied with iec104:\n\nFigure 4: PIEHOP command-line example\nIn the sample analyzed, PIEHOP’s entry point c018c54eff8fd0b9be50b5d419d80f21 (r3_iec104_control.py) calls PIEHOP’s\nmain function, supplying the argument control=True. The file c018c54eff8fd0b9be50b5d419d80f21 (r3_iec104_control.py)\nimports the \"iec104_mssql_lib\" module, which is contained within the extracted contents as\nadfa40d44a58e1bc909abca444f7f616 (iec104_mssql_lib.pyc):\n\nFigure 5: PIEHOP decompiled entry point\n2b86adb6afdfa9216ef8ec2ff4fd2558 (iec104_mssql_lib.py) implements PIEHOP’s primary capabilities and contains many\ndeveloper-supplied comments for the included code. Notably, the main function contains logic flaws that cause it to only be\nable to connect to an MSSQL server and upload OT_T855_IEC104_GR.exe (LIGHTWORK) to it, before immediately\nattempting to clean itself up.\n\nIf the main function is called with upload=True only, it will only perform its cleanup routine and immediately terminate.\nIf the main function is called with control=True only, it will take the path that is intended for upload=True, connect to\nthe MSSQL server and, upload OT_T855_IEC104_GR.exe.\nIf both upload=True and control=True are supplied to the main function, it will immediately fail due to attempting to\nutilize command line arguments that were not parsed yet.\n\nIf implemented correctly, PIEHOP can connect to a user supplied remote MSSQL server for uploading LIGHTWORK and\nissuing remote commands specifically targeting RTU, and then delete itself. PIEHOP utilizes LIGHTWORK to execute the\nIEC-104 commands \"ON” or \"OFF\" on the remote system and immediately deletes the executable after issuing the\n\n\n-----\n\ncommands.\n\n\nFigure 6:\n\n\n-----\n\nPIEHOP main function\n\n## Appendix C: LIGHTWORK Technical Analysis\n\nLIGHTWORK (filename: OT_T855_IEC104_GR.exe) (MD5: 7b6678a1c0000344f4faf975c0cfc43d) is a disruption tool\nwritten in C++ that implements the IEC-104 protocol to modify the state of RTUs over TCP. It crafts configurable IEC-104\nASDU messages, to change the state of RTU IOAs to ON or OFF. This sample works in tandem with PIEHOP, which sets\nup the execution. LIGHTWORK takes the following positional command line arguments:\n```\n   <ip_address> <port> <command> [either ON (1) or OFF (0)]\n\n```\nFigure 7: LIGHTWORK command line example\nUpon execution, LIGHTWORK begins by sending a “C_IC_NA_1 – station interrogation command” to the specified target\nstation retrieving the status of the target station. Next, it sends a “C_SC_NA_1 – single command” to each hardcoded IOA\nto modify the state of the target station’s IOA (OFF or ON). Last, it sends a single “C_CS_NA_1 – clock synchronization\ncommand” to the target station, which synchronizes the remote station time clock with the time clock for the device issuing\nthe commands.\n\nFigure 8: [NetworkMiner - LIGHTWORK IEC-104 traffic](https://www.netresec.com/?page=NetworkMiner)\nIf executed successfully, LIGHTWORK provides the operator the following command-line output:\n\nFigure 9: LIGHTWORK usage output\n\n\n-----\n\n## Appendix D: YARA Signatures\n```\n rule M_Hunting_PyInstaller_PIEHOP_Module_Strings\n {\n   meta:\n      author = \"Mandiant\"\n      date = \"2023-04-11\"\n      description = \"Searching for PyInstaller files with a custom Python script/module associated\n with PIEHOP.\"\n   strings:\n      $lib = \"iec104_mssql_lib\" ascii\n   condition:\n      uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550 and\n      $lib\n }\n rule M_Hunting_Disrupt_LIGHTWORK_Strings\n {\n   meta:\n      author = \"Mandiant\"\n      description = \"Searching for strings associated with IEC-104 used in LIGHTWORK.\"\n      date = \"2023-04-19\"\n   strings:\n      $s1 = \"Connecting to: %s:%i\\n\" ascii wide nocase\n      $s2 = \"Connected!\" ascii wide nocase\n      $s3 = \"Send control command C_SC_NA_1\" ascii wide nocase\n      $s4 = \"Connect failed!\" ascii wide nocase\n      $s5 = \"Send time sync command\" ascii wide nocase\n      $s6 = \"Wait ...\" ascii wide nocase\n      $s7 = \"exit 0\" ascii wide nocase\n   condition:\n      filesize < 5MB and\n      uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550 and\n      all of them\n }\n\n Appendix E: MITRE ATT&CK\n\n```\n_[T1140: Deobfuscate/Decode Files or Information](https://attack.mitre.org/techniques/T1140/)_\n\n\n-----\n\nAdversaries may use Obfuscated Files or Information to hide artifacts of an intrusion from analysis. They may require\nseparate mechanisms to decode or deobfuscate that information depending on how they intend to use it. Methods for doing\nthat include built-in functionality of malware or by using utilities present on the system.\n\n_[T0807: Command-Line Interface](https://attack.mitre.org/techniques/T0807/)_\n\nAdversaries may utilize command-line interfaces (CLIs) to interact with systems and execute commands. CLIs provide a\nmeans of interacting with computer systems and are a common feature across many types of platforms and devices within\ncontrol systems environments. Adversaries may also use CLIs to install and run new software, including malicious tools that\nmay be installed over the course of an operation.\n\n_[T0809: Data Destruction](https://attack.mitre.org/techniques/T0809/)_\n\nAdversaries may perform data destruction over the course of an operation. The adversary may drop or create malware,\ntools, or other non-native files on a target system to accomplish this, potentially leaving behind traces of malicious activities.\nSuch non-native files and other data may be removed over the course of an intrusion to maintain a small footprint or as a\nstandard part of the post-intrusion cleanup process.\n\n_[T0831: Manipulation of Control](https://attack.mitre.org/techniques/T0831/)_\n\nAdversaries may manipulate physical process control within the industrial environment. Methods of manipulating control can\ninclude changes to set point values, tags, or other parameters. Adversaries may manipulate control systems devices or\npossibly leverage their own, to communicate with and command physical control processes. The duration of manipulation\nmay be temporary or longer sustained, depending on operator detection.\n\n_[T0855: Unauthorized Command Message](https://attack.mitre.org/techniques/T0855/)_\n\nAdversaries may send unauthorized command messages to instruct control system assets to perform actions outside of\ntheir intended functionality, or without the logical preconditions to trigger their expected function. Command messages are\nused in ICS networks to give direct instructions to control systems devices. If an adversary can send an unauthorized\ncommand message to a control system, then it can instruct the control systems device to perform an action outside the\nnormal bounds of the device's actions. An adversary could potentially instruct a control systems device to perform an action\nthat will cause an Impact\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2023/2023-05-25 - COSMICENERGY- New OT Malware Possibly Related To Russian Emergency Response Exercises.pdf"
    ],
    "report_names": [
        "2023-05-25 - COSMICENERGY- New OT Malware Possibly Related To Russian Emergency Response Exercises.pdf"
    ],
    "threat_actors": [
        {
            "id": "5fb9f77b-1273-4658-884e-49f5f511dcd7",
            "created_at": "2022-10-25T15:50:23.591795Z",
            "updated_at": "2025-03-27T02:00:55.503775Z",
            "deleted_at": null,
            "main_name": "TEMP.Veles",
            "aliases": [
                "TEMP.Veles",
                "XENOTIME"
            ],
            "source_name": "MITRE:TEMP.Veles",
            "tools": [
                "Mimikatz",
                "PsExec",
                "TRITON"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "20012494-3f05-48ce-8c0f-92455e46a4f9",
            "created_at": "2022-10-25T16:07:24.319939Z",
            "updated_at": "2025-03-27T02:02:10.169843Z",
            "deleted_at": null,
            "main_name": "TEMP.Veles",
            "aliases": [
                "ATK 91",
                "Xenotime"
            ],
            "source_name": "ETDA:TEMP.Veles",
            "tools": [
                "Cryptcat",
                "HatMan",
                "Mimikatz",
                "NetExec",
                "PsExec",
                "SecHack",
                "TRISIS",
                "TRITON",
                "Trisis",
                "Triton",
                "Wii"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "0f09b73e-caa9-40e6-bd0b-c13503e4e94c",
            "created_at": "2023-01-06T13:46:39.001286Z",
            "updated_at": "2025-03-27T02:00:02.974113Z",
            "deleted_at": null,
            "main_name": "TEMP.Veles",
            "aliases": [
                "Xenotime",
                "G0088",
                "ATK91"
            ],
            "source_name": "MISPGALAXY:TEMP.Veles",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1685930870,
    "ts_updated_at": 1743041698,
    "ts_creation_date": 1685883795,
    "ts_modification_date": 1685883795,
    "files": {
        "pdf": "https://archive.orkl.eu/61ebbd5bef0a1d6aef747cd0b84da2a3c7e63238.pdf",
        "text": "https://archive.orkl.eu/61ebbd5bef0a1d6aef747cd0b84da2a3c7e63238.txt",
        "img": "https://archive.orkl.eu/61ebbd5bef0a1d6aef747cd0b84da2a3c7e63238.jpg"
    }
}