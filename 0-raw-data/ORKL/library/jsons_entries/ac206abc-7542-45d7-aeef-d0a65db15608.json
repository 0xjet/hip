{
    "id": "ac206abc-7542-45d7-aeef-d0a65db15608",
    "created_at": "2023-01-12T15:01:52.856065Z",
    "updated_at": "2025-03-27T02:06:01.062559Z",
    "deleted_at": null,
    "sha1_hash": "3e0fc1b99f7eb659661a7fd9bcee6b045d1c682b",
    "title": "2022-03-01 - DiskKill-HermeticWiper and NotPetya (Dis)similarities",
    "authors": "",
    "file_creation_date": "2022-05-28T17:55:15Z",
    "file_modification_date": "2022-05-28T17:55:15Z",
    "file_size": 342541,
    "plain_text": "# DiskKill/HermeticWiper and NotPetya (Dis)similarities\n\n**[marcoramilli.com/2022/03/01/diskkill-hermeticwiper-and-notpetya-dissimilarities/](https://marcoramilli.com/2022/03/01/diskkill-hermeticwiper-and-notpetya-dissimilarities/)**\n\nView all posts by marcoramilli March 1, 2022\n\nMany security researchers, professional cybersecurity analysts and cybsec organizations\n[realized great analyses on DiskKill (HermeticWiper), some of my favorite are HERE,](https://blog.talosintelligence.com/2022/02/threat-advisory-hermeticwiper.html) [HERE](https://www.netskope.com/blog/netskope-threat-coverage-hermeticwiper)\n[and HERE. Today what I’d like to do, is to focus on specific HermeticWiper characteristics](https://yoroi.company/research/diskkill-hermeticwiper-a-disruptive-cyber-weapon-targeting-ukraines-critical-infrastructures/)\nand looking for similarities (or differences) to another similar (and well known) cyber attack\nhappened in Ukraine few years ago: NotPetya. But let’s start to highlights some interesting\ncharacteristics that DiskKill has implemented.\n\n**The Crash Dump Handling**\n\nApplications have bugs and eventually they might crash. The Crash Dump capability in\nMicrosoft Windows is quite useful to understand the type of crash and what stimulated (or, in\nsimple cases, caused) the application crash. In this way developers can investigate memory\ndumps to increase security and stability of the developed system (or application). Starting\nwith Windows Server 2008 and Windows Vista with Service Pack 1 (SP1), Windows Error\nReporting (WER) can be configured so that full user-mode dumps are collected and stored\nlocally after a user-mode application crashes. On the other hand crash bumps let to\ncybersecurity analysts the chance to figure out how the system (application) works or, in\nspecific scenarios, if some vulnerabilities could be exploited to take control over the\nmalicious code. Threat Actors behind DiskKill decided to disable this functionality avoiding to\n[leak such information. As described in Yoroi report (HERE) threat actor behind Hermetic](http://www.yoroi.company/)\n\n\n-----\n\nWiper modified the following RegKey\n```\nHKLM\\SYSTEM\\CurrentControlSet\\Control\\CrashControl in order to disable crash\n\n```\ndumps on the target system avoiding memory and stacks investigations.\n\nCrashDump disabling\n\n**100 Is The Number !**\n\nIt happens that DiskKill erases “only” the first 100 hard drive available on the target system.\nSo, if you have really important files you can emulate 100 “empty” HD and store your files on\nthe 101 ;). I believe this is another interesting characteristic of this specific wiper. The\nfollowing image shows the loop to 100.\n\nImage from [HERE](https://yoroi.company/research/diskkill-hermeticwiper-a-disruptive-cyber-weapon-targeting-ukraines-critical-infrastructures/)\n\n**Living Off The Land Binaries**\n\nA quite used techniques from many threat actors is to load legit independent binaries to use\ntheir functionalities in order to accomplish their target. In this specific case threat actors\nbehind DiskKill (ab)used a legit driver from EaseUS Partition Master to read and to overwrite\nspecific disk area. I found the usage of that specific `EaseUS driver (not the use of LOLBas)`\nquite characteristic and specific for this wiper so far.\n\n\n-----\n\nImage From ESET [tweets](https://twitter.com/ESETresearch/status/1496581912940396551/photo/1)\n\n**HermeticWiper VS NotPetya**\n\nBefore getting into details about similarities between DiskKill and NotPetya, two important\ncyber attacks against Ukraine, it would be interesting to remind a little bit of history:\n\n“In June 2017, a new variant of Petya was used for a global cyberattack, primarily targeting\nUkraine. The new variant propagates via the EternalBlue exploit, which is generally believed\nto have been developed by the U.S. National Security Agency (NSA), and was used earlier\nin the year by the WannaCry ransomware. Kaspersky Lab referred to this new version as\nNotPetya to distinguish it from the 2016 variants, due to these differences in operation” (from\n[Wikipedia).](https://en.wikipedia.org/wiki/Petya_(malware))\n\nBoth of the Malware have destructive capabilities and both of them targeted the state of\nUkraine, but beside that what do they have in common ? Let’s take a closer look by\ncomparing the two malwares in the following table.\n\n**Functionality** **HermeticWiper / DiskKill** **NotPetya**\n\n\nProcess\nHashes and\nProcess\nPrivilege\nChecks\n\n\nNO\n\n\nYes. Checks for specific security\nvendors\n\n1. 0x6403527E\n\n2. 0x23214B44\n\n3. 0x651B3005\n\n\n-----\n\nCredential\nTheft\n\nToken\nImpersonation\n\nMalware\nPropagation\n(Trojanized)\n\nRemote\nExecution\n\n\nNO\n\nYes.\n\n1. As an argument to the DLL\n\n2. Communication via a named pipe\nfrom the credential theft module\n\nNO Yes. `OpenProcessToken and`\n```\n                 GetTokenInformation is used to\n\n```\ngrab the `TokenSessionId for`\nterminal service sessions.\n\nNo Trojanized\n\nYes.\n\n1. Network node enumeration\n\n2. SMB copy and remote execution\n\n3. SMB exploitation via EternalBlue\n\nNo\n\nYes.\n```\n                 C:\\Windows\\dllhost.dat \\                  accepteula -s -d\n                 C:\\Windows\\System32\\rundll32.exe\n                 “C:\\Windows\\perfc.dat”,#1 18\n                 “””\n\n```\n\nMBR\nRansomware Yes.\n\nBy looping (to 100) the\n```\n         “\\.\\PhysicalDrive” and\n\n```\noverwriting the first 512 bytes\nof each disk through mounted\n```\n         LOLBas\n\n```\nUsing\n```\n         “CryptAcquireContextW”\n\n```\nand `“CryptGenRandom”`\nWindows syscalls.\n\nDelete\nShadowCoipes Yes.\n\nthroush `ServicesActive`\n```\n         vss\n\n```\n\nYes.\n\nBy focusing on `\\.\\PhysicalDrive0`\n(boot one). It uses `XOR encoding with`\nkey `0x7 .`\n\nMFT encryption on its own bootloader\n\nNo\n\n\nNTFS and FAT\nSpecific\nroutines\n\n\nYes No\n\n\n-----\n\nMulti Thread\n\ncomparative table\n\n**Conclusion**\n\n\nYes.\n\nUsed to perform quick MBR\ndestruction\n\n\nYes.\n\nUsed for functionalities,\ncommunications and propagation\n\n\nTo my understanding DiskKill samples are quite different from NotPetya Ransomware.\nNotPetya looks a more complex and well structured software while HermeticWiper looks like\nmore simple ad “slapdashed” with a single intent: to wipe Master Boot Records. On the other\nhand DiskKill takes care about wiping speed (multi thread structure) while NotPetya is most\ninterested in lateral movements (through CVEs), C2 communications and modularity. It’s\nhard to tell if the threat actor is the same or not, but the two families looks like quite different\nto me.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-03-01 - DiskKill-HermeticWiper and NotPetya (Dis)similarities.pdf"
    ],
    "report_names": [
        "2022-03-01 - DiskKill-HermeticWiper and NotPetya (Dis)similarities.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535712,
    "ts_updated_at": 1743041161,
    "ts_creation_date": 1653760515,
    "ts_modification_date": 1653760515,
    "files": {
        "pdf": "https://archive.orkl.eu/3e0fc1b99f7eb659661a7fd9bcee6b045d1c682b.pdf",
        "text": "https://archive.orkl.eu/3e0fc1b99f7eb659661a7fd9bcee6b045d1c682b.txt",
        "img": "https://archive.orkl.eu/3e0fc1b99f7eb659661a7fd9bcee6b045d1c682b.jpg"
    }
}