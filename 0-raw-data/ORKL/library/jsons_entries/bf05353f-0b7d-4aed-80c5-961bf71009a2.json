{
    "id": "bf05353f-0b7d-4aed-80c5-961bf71009a2",
    "created_at": "2023-01-12T15:06:38.695786Z",
    "updated_at": "2025-03-27T02:09:18.418224Z",
    "deleted_at": null,
    "sha1_hash": "bf9667787e08ab01a0710b70a9097ecf74c1e847",
    "title": "2022-03-16 - Qakbot infection with Cobalt Strike and VNC activity",
    "authors": "",
    "file_creation_date": "2022-05-28T00:23:13Z",
    "file_modification_date": "2022-05-28T00:23:13Z",
    "file_size": 7148057,
    "plain_text": "# SANS ISC: InfoSec Handlers Diary Blog - SANS Internet Storm Center SANS Site Network Current Site SANS Internet Storm Center Other SANS Sites Help Graduate Degree Programs Security Training Security Certification Security Awareness Training Penetration Testing Industrial Control Systems Cyber Defense Foundations DFIR Software Security Government OnSite Training InfoSec Handlers Diary Blog\n\n**isc.sans.edu/diary/rss/28448**\n\n## Qakbot infection with Cobalt Strike and VNC activity\n\n**Published: 2022-03-16**\n\n**Last Updated: 2022-03-16 05:27:22 UTC**\n\n**by** [Brad Duncan (Version: 1)](https://isc.sans.edu/handler_list.html#brad-duncan)\n\n[0 comment(s)](https://isc.sans.edu/forums/diary/Qakbot+infection+with+Cobalt+Strike+and+VNC+activity/28448/#comments)\n**_Introduction_**\n\nOn Monday 2022-03-14, I infected a vulnerable Windows host with Qakbot (Qbot) malware.\nApproximately 17 hours later, the infected host generated traffic for Cobalt Strike and VNC\n(Virtual Network Computing) activity. Like Cobalt Strike, VNC provides remote access to an\ninfected host.\n\nDLL files used for Qakbot infections have tags in the code that identify the malware sample's\ndistribution channel. In this case, the distribution tag was obama166.\n\nToday's diary provides a quick review of the infection activity.\n\n\n-----\n\n_Shown above: Flow chart for Qakbot infection activity on Monday 2022-03-14._\n\n**_Images From the Infection_**\n\n\n-----\n\n_Shown above: Example of email for obama166 distribution Qakbot on Monday 2022-03-14._\n\n\n-----\n\n_Shown above: Downloading a zip archive from link in an email._\n\n\n-----\n\n_Shown above: Excel spreadsheet extracted from downloaded zip archive._\n\n_Shown above: DLL files downloaded for Qakbot infection._\n\n\n-----\n\n_Shown above: Traffic from the infection filtered in Wireshark._\n\n_Shown above: New Qakbot DLL saved to the infected Windows host shortly after the initial_\n_infection._\n\n_Shown above: More traffic from the Qakbot infection filtered in Wireshark._\n\n\n-----\n\n_Shown above: TCP traffic over port 65400 associated with this Qakbot infection._\n\n_Shown above: Data binary saved to disk at C:\\u\\ from the Qakbot infection._\n\n\n-----\n\n_Shown above: Cobalt Strike activity started about 17 hours after the initial Qakbot infection._\n\n_Shown above: TCP SYN segments for VNC traffic caused by this Qakbot infection._\n\n\n-----\n\n_Shown above: First TCP stream for the VNC activity._\n\n_Shown above: Second TCP stream for the VNC activity._\n\n\n-----\n\n_Shown above: Third TCP stream for the VNC activity (10 MB of data)._\n\n_Shown above: ETPRO alerts in Security Onion for the VNC traffic from this infection._\n\n\n-----\n\n_Shown above: Registry update made by the Qakbot infection._\n\n**_Indicators of Compromise (IOCs)_**\n\nLink from email for zip download:\n\nhxxp://eaglio[.]org/apm/3/s2Fmok83x.zip\n\nTraffic generated by Excel macro for Qakbot DLL files:\n\nhxxp://101.99.95[.]190/6537991.dat\nhxxp://146.70.81[.]64/6537991.dat\nhxxp://190.14.37[.]12/6537991.dat\n\nQakbot C2 traffic:\n\n201.170.181[.]247 port 443 - HTTPS traffic\nport 443 - www.openssl[.]org - HTTPS traffic (connectivity check)\n23.111.114[.]52 port 65400 - TCP traffic\n76.169.147[.]192 port 32103 - HTTPS traffic\n103.87.95[.]131 port 2222 - HTTPS traffic\n86.98.27[.]253 port 443 - HTTPS traffic\nvarious IP addresses over various ports - attempted TCP connections\n\nCobalt Strike traffic:\n\n190.123.44[.]113 port 4444 - runfs[.]icu - HTTPS traffic\n\n\n-----\n\nVNC module traffic:\n\n45.153.241[.]142 port 443 - encoded/encrypted traffic and beacon channels\n\nRule hits on VNC module traffic:\n\nETPRO MALWARE VNCStartServer USR Variant CnC Beacon\nETPRO MALWARE VNCStartServer BOT Variant CnC Beacon\n\nMalware retrieved from the infected Windows client:\n\nSHA256 hash: ba80720c42704e8e1a73e60906f6f289ba763365c8f6b16ccf47aac8a687b83e\n\nFile size: 92,828 bytes\nFile location: hxxp://eaglio[.]org/apm/3/s2Fmok83x.zip\nFile name: ClaimDetails-1699343128-Mar-14.zip\n\nSHA256 hash: 5a6157eefc8d0b1089a5bfdee351379b27baff4c40b432fd22e0cbe1f6102fab\n\nFile size: 120,410 bytes\nFile name: ClaimDetails-1699343128-Mar-14.xlsb\n\nSHA256 hash:\n47fe3cbab19b43579e3312d90f7a8c7021c84e228e7c8ef97d39a1a7a261ea01\n\nFile size: 408,576 bytes\nFile location: hxxp://101.99.95[.]190/6537991.dat\nFile location: C:\\Biloa\\Dopaters1.ocx\nFile type: PE32 executable (DLL) (GUI) Intel 80386, for MS Windows\nRun method: regsvr32.exe [filename]\n\nSHA256 hash:\n8751f8aedc65a10826071515b4b7896a8800152b8e3bcbbe9e8a64970deb9b49\n\nFile size: 408,576 bytes\nFile location: hxxp://146.70.81[.]64/6537991.dat\nFile location: C:\\Biloa\\Dopaters2.ocx\nFile type: PE32 executable (DLL) (GUI) Intel 80386, for MS Windows\nRun method: regsvr32.exe [filename]\n\nSHA256 hash: 7312353bab71ecefec6888bb804afd71f67178ded4ce41960924d3d6f7400320\n\nFile size: 408,576 bytes\nFile location: hxxp://190.14.37[.]12/6537991.dat\nFile location: C:\\Biloa\\Dopaters3.ocx\nFile type: PE32 executable (DLL) (GUI) Intel 80386, for MS Windows\n\n\n-----\n\nRun method: regsvr32.exe [filename]\n\nSHA256 hash: 7264fc1e81ff854b769f8e19ced247fb95210a58ddd5edce4a6275ddc38e5298\n\nFile size: 920,064 bytes\nFile location: C:\\Users\\\n\n_[username]\\AppData\\Roaming\\Microsoft\\Hezuky\\bbcdipimaxckk.dll_\nFile type: PE32 executable (DLL) (GUI) Intel 80386, for MS Windows\nRun method: regsvr32.exe [filename]\n\nNote: No binaries for Cobalt Strike or the VNC activity were found on the infected Windows\nhost.\n\n**_Final words_**\n\nThis infection shows some changes in Qakbot.\n\nEarlier this year, Qakbot samples created a scheduled task that pointed to an additional\nregistry update with base64 code used to re-create the Qakbot binary after a reboot. I no\nlonger see that with recent Qakbot samples.\n\nAlso, this infection didn't stay persistent after logging out or doing a reboot. Normally,\nQakbot keeps the active DLL in memory. If a victim logs our or reboots, Qakbot saves the inmemory DLL to disk and creates a registry update at\n**_HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run. After rebooting and/or logging_**\nback in, this registry update loads the DLL, then Qakbot deletes the registry update and\nerases the DLL that had been saved to disk.\n\nIn this case, a Qakbot DLL was already saved to disk long before I tried logging\nout/rebooting. Furthermore, the infection did not persist after I logged out.\n\nThere's also a data binary stored at a `C:\\u\\ directory created by Qakbot. From a forensic`\npoint of view, things are noticeably different with recent Qakbot infections. Not drastically\ndifferent, but the changes are noticeable.\n\nA pcap of the infection traffic along with malware (Excel file and DLL) from an infected host\n[can be found here.](https://www.malware-traffic-analysis.net/2022/03/16/index.html)\n\n--Brad Duncan\nbrad [at] malware-traffic-analysis.net\n\n[Keywords: VNC](https://isc.sans.edu/tag.html?tag=VNC) [Qbot](https://isc.sans.edu/tag.html?tag=Qbot) [Qakbot](https://isc.sans.edu/tag.html?tag=Qakbot) [malspam](https://isc.sans.edu/tag.html?tag=malspam) [CobaltStrike](https://isc.sans.edu/tag.html?tag=CobaltStrike) [Cobalt Strike](https://isc.sans.edu/tag.html?tag=Cobalt%20Strike)\n[0 comment(s)](https://isc.sans.edu/forums/diary/Qakbot+infection+with+Cobalt+Strike+and+VNC+activity/28448/)\n\nJoin us at SANS! Attend [with Brad Duncan in starting](https://isc.sans.edu/diary/rss/28448)\n\n\n-----\n\nTop of page\n√ó\n\n[Diary Archives](https://isc.sans.edu/diaryarchive.html)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-03-16 - Qakbot infection with Cobalt Strike and VNC activity.pdf"
    ],
    "report_names": [
        "2022-03-16 - Qakbot infection with Cobalt Strike and VNC activity.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535998,
    "ts_updated_at": 1743041358,
    "ts_creation_date": 1653697393,
    "ts_modification_date": 1653697393,
    "files": {
        "pdf": "https://archive.orkl.eu/bf9667787e08ab01a0710b70a9097ecf74c1e847.pdf",
        "text": "https://archive.orkl.eu/bf9667787e08ab01a0710b70a9097ecf74c1e847.txt",
        "img": "https://archive.orkl.eu/bf9667787e08ab01a0710b70a9097ecf74c1e847.jpg"
    }
}