{
    "id": "c6918ec8-554f-4468-bc81-47b5c56ccc8d",
    "created_at": "2023-01-12T15:07:31.931567Z",
    "updated_at": "2025-03-27T02:17:27.55822Z",
    "deleted_at": null,
    "sha1_hash": "8095389db59381cbf56f1944572dd1114d612d5b",
    "title": "2018-11-16 - Analyzing OilRig’s Ops Tempo from Testing to Weaponization to Delivery",
    "authors": "",
    "file_creation_date": "2022-05-28T00:35:01Z",
    "file_modification_date": "2022-05-28T00:35:01Z",
    "file_size": 1592129,
    "plain_text": "# Analyzing OilRig's Ops Tempo from Testing to Weaponization to Delivery\n\n**[unit42.paloaltonetworks.com/unit42-analyzing-oilrigs-ops-tempo-testing-weaponization-delivery/](https://unit42.paloaltonetworks.com/unit42-analyzing-oilrigs-ops-tempo-testing-weaponization-delivery/)**\n\nRobert Falcone, Kyle Wilhoit November 16, 2018\n\nBy [Robert Falcone and](https://unit42.paloaltonetworks.com/author/robertfalcone/) [Kyle Wilhoit](https://unit42.paloaltonetworks.com/author/kyle-wilhoit/)\n\nNovember 16, 2018 at 8:00 AM\n\n[Category: Unit 42](https://unit42.paloaltonetworks.com/category/unit42/)\n\nTags: [BONDUPDATER,](https://unit42.paloaltonetworks.com/tag/bondupdater/) [OilRig,](https://unit42.paloaltonetworks.com/tag/oilrig/) [Testing](https://unit42.paloaltonetworks.com/tag/testing/)\n\nThis post is also available in: 日本語 [(Japanese)](https://unit42.paloaltonetworks.jp/unit42-analyzing-oilrigs-ops-tempo-testing-weaponization-delivery/)\n\nGaining insight into an adversary’s operational tempo in the early phases of the attack lifecycle can be very difficult. Typically,\nthere are far fewer data points available to analyze in the reconnaissance and weaponization phases for a researcher to use to\ndetermine how quickly an adversary operates prior to direct interaction with a target in the delivery phase. While continuing\n[research on the August 2018 attacks on a middle eastern government that delivered BONDUPDATER, Unit 42 researchers](https://blog.paloaltonetworks.com/2018/09/unit42-oilrig-uses-updated-bondupdater-target-middle-eastern-government/)\nobserved OilRig’s testing activities and with high confidence links this testing to the creation of the weaponized delivery document\nused in this attack.\n\nClearly, OilRig incorporates a testing component within their development process, as we have previously observed OilRig\n[performing testing activities on their delivery documents and their TwoFace webshells. This testing component often involves](https://blog.paloaltonetworks.com/2017/04/unit42-oilrig-actors-provide-glimpse-development-testing-efforts/)\nmaking small modifications to their delivery documents and submitting these files to online public anti-virus scanning tools to\ndetermine the maliciousness of a submitted file and to figure out how to evade these detections. Providing a free and quick antivirus testing service, using these online scanners aids an attacker in understanding which anti-virus engine detects their\nmalware, thus giving the attacker a metaphorical “quality assurance service.”\n\nTo determine OilRig’s operational tempo, we compared the creation times of the files created during testing, the creation time of\nthe delivery document and the time in which the spear-phishing email was sent in the attack. We found that OilRig began its\ntesting activities just under 6 days prior to the targeted attack and performed three waves of testing attempts on August 20th,\n21, and 26th. The tester created the final test file less than 8 hours before the creation time of a delivery document, which wasst\nthen delivered via a spear-phishing email 20 minutes later.\n\nOilRig’s Testing Activities\n\n[While investigating recent attacks performed by the threat actor group OilRig using their new Bondupdater version, Unit 42](https://blog.paloaltonetworks.com/2018/09/unit42-oilrig-uses-updated-bondupdater-target-middle-eastern-government/)\nresearchers searched for additional Microsoft Office documents used by OilRig hoping to locate additional malware being used in\nother attacks during the same time period. We focused on the functionality and pivoting off the original OilRig Microsoft\ndocuments found during our recent investigation.\n\nUnit 42 researchers found 11 additional samples that were submitted across several public anti-virus testing sites, as seen in\nTable 1. These samples appeared to have been created by OilRig during their development and testing activities, all of which\nshare many similarities with the delivery document used in the recent OilRig attack against a Middle Eastern government,\n\n\n-----\n\nN56.15.doc (7cbad6b3f505a199d6766a86b41ed23786bbb99dab9cae6c18936afdc2512f00) that we have also included in Table\n1. During this testing, we saw document filenames that contain the C2 we witnessed in the targeted attack above, specifically the\nfilenames XLS-withyourface.xls and XLS-withyourface – test.xls. The similarities in metadata, macro code, and the filenames\ncontaining the C2 domain name leads us to believe these files were in fact OilRig testing their code prior to use in the targeted\nattack that happened on August 26th. It is interesting to note that while all the testing files were Microsoft Excel documents, the\nactual file used in the targeted attack was a Microsoft Word document.\n\n\n**Hash** **Last**\n**Modified/Save**\n**Date**\n\n6f522b1be1f2b6642c292bb3fb57f523ebedeb04f0d18efa2a283e79f3689a9f 8/20/2018\n19:30:13\n\n9b6ebc44e4452d8c53c21b0fdd8311bac10dc672309b67d7f214fbd2a08962ce 8/20/2018\n19:31:54\n\na5bec7573b743932329b794042f38571dd91731ae50757317bdaf9e820ec8d5e 8/20/2018\n19:38:51\n\n6719e80361950cdb10c4a4fcccc389c2a26eaab761c202870353fe65e8f954a3 8/21/2018\n6:24:52\n\n056ffc13a7a2e944f7ab8c99ea9a2d1b429bbafa280eb2043678aa8b259999aa 8/21/2018\n7:58:16\n\n216ffed357b5fe4d71848c79f77716e9ecebdd010666cdb9edaadf7a8c9ec576 8/21/2018\n8:03:22\n\n687027d966667780ab786635b0d4274b651f27d99717c5ba95e139e94ef114c3 8/21/2018\n8:08:36\n\n364e2884251c151a29071a5975ca0076405a8cc2bab8da3e784491632ec07f56 8/21/2018\n8:18:36\n\n66d678b097a2245f60f3d95bb608f3958aa0f5f19ca7e5853f38ea79885b9633 8/26/2018\n5:43:07\n\n70ff20f2e5c7fd90c6bfe92e28df585f711ee4090fc7669b3a9bd024c4e11702 8/26/2018\n5:45:04\n\n7cbad6b3f505a199d6766a86b41ed23786bbb99dab9cae6c18936afdc2512f00 8/26/2018\n13:34:00\n\n\n**Average**\n**Detection**\n**Count on**\n**First Public**\n**Submission**\n\n\n**Filename**\n\n\n22 XLSwithyourface.xls\n\n16 XLSwithyourface.xls\n\n6 XLSwithyourface.xls\n\n4 XLSwithyourface test.xls\n\n18 sss.xls\n\n5 sss.xls\n\n17 sss.xls\n\n9 sss.xls\n\n11 sss - Copy.xls\n\n7 sss - Copy.xls\n\n38 N56.15.doc\n\n\n_Table 1 Files generated during testing activities and the document delivered in the related targeted attack_\n\nThe metadata within the Microsoft Excel spreadsheets seen in Table 1 shows the OilRig developer began creating these\ntesting documents on August 20, six days prior to the related targeted attack. All of the testing activity performed by OilRig\noccurred prior to their attack on August 26th. When cross referencing the ‘Last Modified Date’ dates across the testing and\nattack activity, it is easy to draw a timeline of activity, as seen in the timeline in Figure 1.\n\n\n-----\n\n_Figure 1 Timeline of Testing and Attack Activity_\n\nOn August 20, 22 anti-virus engines detected the first iteration of XLS-withyourface.xls as malicious, as seen in the chart in\nFigure 2. Over the next seven minutes, the tester created two more samples whose detections lowered from 16 detections to six,\nrespectively. Ultimately, the detection count was lowest early on August 21, still five days prior to the targeted attack. The timeline\nin Figure 1 shows a gap in testing activity between August 21st and August 26th, when the tester stopped their activities.\nHowever, they later continued by making modifications to the Excel document just prior to the attack on August 26 . The lastth\niteration of testing occurring less than 8 hours before the creation time of the Word delivery document used in the targeted attack.\n\n\n-----\n\n_Figure 2 Detection rate compared to the insertions and deletions that were performed in each iteration of testing_\n\nThe chart in Figure 2 shows the detection rate of the file fell or rose as the tester modified the spreadsheet during each iteration\nof testing. These changes in detection rates allow the tester to determine if the modified portion of the file was causing detection.\nWhen analyzing this testing activity, we compared the number of changes performed in each iteration, specifically the number of\nlines inserted and deleted based on the GitHub file diff, to the number of detections to determine if the amount of changes had an\nobvious effect on the detection rate. Figure 2 shows that iterations 1 and 2, with only minimal changes, resulted in a massive\ndrop in detections, whereas iterations 3 and 4, with a large number of changes, resulted in a small drop and large increase in\ndetections.\n\nAt a high level, the quantity of changes is not necessarily important to the tester, rather the quality of the changes helps the tester\nlower the detection rate while providing information on how to evade these detections. An example of a quality change was the\nremoval of the line of code that runs the dropped VBScript using “wscript” in Iteration 2, which lowered the detection rate from 16\nto 6. Ultimately, the tester used the knowledge gained from these testing iterations to create a delivery document that was more\ndifficult to detect and likely to result in a successful attack. For details on the changes made in each iteration, please reference\nthe analysis in the Appendix.\n\nWhat Did OilRig Learn?\n\nDuring OilRig’s development efforts, the actors were clearly learning and adapting their development techniques. We continually\nwitnessed the attackers submit their files to testing services only to make changes and resubmit to determine the specific\ncontents of the file that cause anti-virus detections. The OilRig actors used the knowledge learned in this process to develop a\ndelivery document that would evade detection, thus increasing the chances of a successful attack.\n\nDoing a differential comparison between each of the documents, allowed Unit 42 researchers to watch each iteration of code,\ngiving a unique perspective into not only how OilRig performed their testing, but also what the actors may have learned during\ntheir efforts to lower the detection of their delivery documents. While it’s impossible for us to say for certain what OilRig learned\n,we can make some assumptions as to what they likely learned:\n\nSeveral detections of the macro hinged on the generic call to the built-in Shell function to run a dropped VBScript.\nRunning commands in a hidden window (vbHide flag) using the Shell function results in additional detections than when\nusing a visible window (vbNormalFocus flag).\n\n\n-----\n\nIncluding the string powershell within the VBScript that the macro would write to the system caused several detections.\nUsing string obfuscation on the “powershell” string and the “wscript” string within the command run using the Shell function\nwould result in fewer detections.\n\nWhat Did We Learn?\n\nSimilar to the way OilRig learned to better circumvent detections, we as researchers also learned as we looked at each of the\niterations. Providing us with learning opportunities helps us understand the threat actor’s techniques and capabilities, as well as\nbetter pro-actively build protection mechanisms.\n\nWe learned that OilRig:\n\nMade changes to documents and quickly uploaded the file for testing, with an average of 33 seconds between the file\ncreation times and the testing time.\nWas not concerned about maintaining the macro’s functionality during testing efforts, as the changes made by the tester in\nmany iterations made the macro no longer work as intended.\nWill change the functions to run dropped VBScripts, specifically in this case from the Shell object to the built-in Shell\nfunction.\nWill add sleep functionality in an attempt to evade sandboxes, specifically in this case using the Wait function.\nHas a preferred string obfuscation technique, which involves replacing a string with each character in hexadecimal form that\nare concatenated together.\n\nAfter performing this analysis, we believe the OilRig actors used the macro from the malicious Excel document as the basis for\n[the malicious Word document we discussed in our blog. We believe with high confidence that this macro was used to create the](https://blog.paloaltonetworks.com/2018/09/unit42-oilrig-uses-updated-bondupdater-target-middle-eastern-government/)\ndelivery document based on the following similarities:\n\nUsed the same string obfuscation technique that represents a string by its individual hex values concatenated together, as\nthis technique is present in both the testing Excel documents and the Word document used in OilRig’s recent attack from\nour previous blog.\nObfuscated the “powershell” and “cmd.exe” strings within the embedded VBScript using this string obfuscation technique,\nwhich was tested in Iteration 4 of these testing activities.\nObfuscated the command run by the built-in Shell function using this string obfuscation technique, which was tested in\nIteration 8 of these testing activities.\n\nIt appears that OilRig actors modified the macro used in the testing activity to create the weaponized delivery document. The\nmodifications involved adding a function named “HGHG” to save the obfuscated BONDUPDATER PowerShell script to a file.\nOilRig also changed the variable used to store the VBScript to a variable named “A” in the weaponized Word document instead\nof “DDDD” as witnessed in the testing Excel documents. Lastly, the actors removed the function “AA” from the macro, as this\nfunction displays a hidden spreadsheet that would contain the decoy content, which is specific to Excel and not needed for the\nWord document.\n\nConclusion\n\nAttackers and groups routinely use file and URL scanning services to help develop and modify their malware to evade detections.\n[We were already familiar with OilRig’s testing and development efforts as discussed in our previous blog, and we continually](https://blog.paloaltonetworks.com/2017/04/unit42-oilrig-actors-provide-glimpse-development-testing-efforts/)\nwatch for changes to OilRig’s development techniques to give us insight into their methods. Gaining this developmental insight\nsheds light on OilRig’s advanced capabilities, giving us a more complete threat actor profile.\n\nClosely examining the development methodologies of attack groups gives researchers unique opportunities to develop an\nunderstanding of actor tools, tactics, and procedures. Comparison between what malware is eventually used in active campaigns\nversus in-development malware allows us to understand what adaptations and modifications were made to each iteration of\nmalware. Additionally, witnessing specific functionality changes within the malware itself, we attempt to make correlations\nbetween the new and old functionality. We were also able to gain insight into OilRig’s operational tempo by comparing the\ntimestamps of files created during testing and the file delivered in an actual attack. We determined that OilRig began their testing\nactivities 6 days prior to an attack, which ended 8 hours before the creation of the document that the actors delivered via a spearphish email 20 minutes later.\n\nWhile OilRig remains active, Palo Alto Networks customers are protected from this threat in the following ways:\n\n[AutoFocus customers can track these samples with the Bondupdater_Docs](https://autofocus.paloaltonetworks.com/#/tag/Unit42.Bondupdater_Docs)\nWildFire detects all current OilRig Bondupdater_Docs files with malicious verdicts.\n\n\n-----\n\nTraps blocks all of the files currently associated with Bondupdater_Docs\n\nAppendix\n\nThis appendix contains the analysis we performed on each iteration of testing. Before the analysis of each iteration, we have\nincluded some additional information about the files and the detection rate, as seen and described in Table 1.\n\n**Field** **Description**\n\nFiles The SHA256 hashes of the two files we compared to determine the changes made\n\nFilenames The filenames of the two files compared\n\nDelta The time difference between the “Modified” timestamp found within the metadata of each file\n\nPositives The detection rate of the two files compared together, which provides an idea of how the changes in that testing\niteration effected the overall detection\n\n_Table 1 Additional data provided for each Iteration of testing_\n\nThe analysis portion of each iteration includes a description of the changes made to the macro in the delivery document. These\nchanges are also visualized in screenshots of diffs between the two files compared in that iteration. When looking at the diff\nscreenshots, lines with a red background were removed from a file, while lines with a green background were added to the file.\n\nIteration 0\n\nThe first known file associated with this testing activity does not appear to be the original document created by the actor. We\nbelieve this is the case because this Excel spreadsheet contains a stream named __SRP_0 that appears to have artifacts from a\nprevious version of this delivery document. The __SRP_0 stream contains artifacts, specifically a series of base64 encoded\nstrings that when decoded are almost an exact copy of the BONDUPDATER PowerShell payload named “AppPool.ps1” that was\ndropped by 7cbad6b3f505a199d6766a86b41ed23786bbb99dab9cae6c18936afdc2512f00 discussed in our blog discussing\nOilRig’s attack on a middle eastern government in August 2018. In Figure 2 below, we compared the decoded base64 strings\nfrom __SRP_0  to the “AppPool.ps1” file that was discussed in our previous blog, which shows the exact same content (including\n“withyourface[.]com” C2) with the only differences being newlines and spaces.\n\n_Figure 2 Comparison of previous BONDUPDATER payload with payload extracted from cached stream_\n\nWhen we analyzed this specific sample, we noticed that the tester has changed the method in which the PowerShell payload is\ndropped to the system from the malicious Word document discussed in our blog. Instead of writing the AppPool.ps1 file from the\nmacro, the macro in this malicious Excel document only writes the AppPool.vbs, which the macro will run using “wscript”. The\nVBScript is then responsible for writing AppPool.ps1 to the system, which is the main difference from the Word document’s\nmethod discussed in our previously mentioned blog.\n\nAlso, it appears the tester removed the BONDUPDATER payload from the sample altogether, as the AppPool.vbs script uses an\nempty variable named “mysrc” that it would have used to store the base64 encoded payload, which it would decode and save to\nthe AppPool.ps1 file.\n\nAs mentioned earlier, we believe this testing activity preceded the attack that used the Word delivery document discussed in our\nblog. We also believe that this was not the only round of testing performed by the threat group, as the BONDUPDATER tool\nexisting in the SRP 0 stream suggests that the tester had created a prior document that contained the payload that was\n\n\n-----\n\nremoved from this testing activity. It is possible that the tester had previously performed testing activities on the PowerShell\npayload and removed it to isolate their current testing activities on the macro portion of the delivery document.\n\nIteration 1\n\n**Files** 6f522b1be1f2b6642c292bb3fb57f523ebedeb04f0d18efa2a283e79f3689a9f ..\n9b6ebc44e4452d8c53c21b0fdd8311bac10dc672309b67d7f214fbd2a08962ce\n\n**Filenames** XLS-withyourface.xls -> XLS-withyourface.xls\n\n**Delta** 1 minute 41 seconds\n\n**Positives** 22 -> 16\n\nIn this iteration, the tester made one simple change, which involved removing the string “powershell.exe” from being written to the\nAppPool.vbs file. This change essentially breaks the installation process, as the VBScript would no longer be able to run the\nAppPool.ps1 run correctly; however, the tester made this change to determine if detection stemmed from this string. The diff in\nthe screenshot in Figure 3 does not make the missing “powershell.exe” string immediately apparent, however, if you look for\n“Shell0” on line 24 you can see “powershell.exe -exec bypass” in the left (red) text and “ -exec bypass” in the right (green) text.\n\n_Figure 3 Screenshot of diff between files related to Iteration 1_\n\nIteration 2\n\n**Files** 9b6ebc44e4452d8c53c21b0fdd8311bac10dc672309b67d7f214fbd2a08962ce ..\na5bec7573b743932329b794042f38571dd91731ae50757317bdaf9e820ec8d5e\n\n**Filenames** XLS-withyourface.xls -> XLS-withyourface.xls\n\n**Delta** 6 minutes 57 seconds\n\n**Positives** 16 -> 6\n\nIn this iteration, the tester removed the line responsible for running the AppPool.vbs script using the wscript application. As you\ncan see in Figure 4, the tester just removed the entire line of code and replaced it with a new line.\n\n\n-----\n\n_Figure 4 Screenshot of diff between files related to Iteration 2_\n\nIteration 3\n\n**Files** a5bec7573b743932329b794042f38571dd91731ae50757317bdaf9e820ec8d5e ..\na5bec7573b743932329b794042f38571dd91731ae50757317bdaf9e820ec8d5e\n\n**Filenames** XLS-withyourface.xls -> XLS-withyourface.xls\n\n**Delta** 10 hours 46 minutes 1 second\n\n**Positives** 6 -> 4\n\nIn this iteration, the tester made fairly significant changes to the macro. First, the tester introduced a line of code that would sleep\nfor 10 seconds after creating the “C:\\ProgramData\\WindowsAppPool” folder and before writing the AppPool.vbs file to this folder,\nwhich can be seen in Figure 5 at line 12. The bottom of Figure 5 and continued into Figure 6 shows that the tester also added the\nbase64 encoded BONDUPDATER PowerShell payload to the DDDD variable instead of the VBScript seen in previous versions\nof this macro. The base64 encoded BONDUPDATER included here is the exact same payload in the first testing sample’s cached\n__SRP_0 stream mentioned in Iteration 0. Figure 7 also shows that the tester removed the line that set the Shell0 variable to\ncontain the “wscript.shell” object that it would theoretically use to run the VBScript.\n\n_Figure 5 Screenshot of diff between files related to Iteration 3 showing sleep code and other objects added_\n\n\n-----\n\n_Figure 6 Screenshot of diff between files related to Iteration 3 showing changes to variable used to store VBScript_\n\n_Figure 7 Screenshot of diff between files related to Iteration 3 showing removal of the ‘wscript.shell’ object_\n\nIteration 4\n\n**Files** 6719e80361950cdb10c4a4fcccc389c2a26eaab761c202870353fe65e8f954a3 ..\n056ffc13a7a2e944f7ab8c99ea9a2d1b429bbafa280eb2043678aa8b259999aa\n\n**Filenames** XLS-withyourface.xls -> sss.xls\n\n**Delta** 1 hour 33 minutes 24 seconds\n\n**Positives** 4 -> 18\n\nIn this iteration, the tester replaces the base64 encoded PowerShell script in the macro with the VBScript that it replaced in the\nprevious iteration. The tester also removed some lines of code that instantiated the “Scripting.FileSystemObject” and\n“Wscript.Shell” objects (line 17 and 18 in Figure 8).\n\n\n-----\n\n_Figure 8 Screenshot of diff between files related to Iteration 4 showing VBScript added back to the macro_\n\nIt appears that the tester reintroduced the VBScript to the macro, albeit with slight modification. The two modifications to the\nVBScript stored in the DDDD variable come in the form of obfuscating two of the strings within the script, specifically the\n“powershell” (line 24 in Figure 9) and “cmd.exe” (line 25 in Figure 9) strings. Instead, both of these strings were constructed one\ncharacter at a time using the hexadecimal value for each character and concatenated together. For instance, the “powershell”\nstring was replaced with the following:\n\n\n1\n2\n3\n4\n\n\nChr(CLng(\"&H70\")) & Chr(CLng(\"&H6f\")) & Chr(CLng(\"&H77\")) &\nChr(CLng(\"&H65\")) & Chr(CLng(\"&H72\")) & Chr(CLng(\"&H73\")) &\nChr(CLng(\"&H68\")) & Chr(CLng(\"&H65\")) & Chr(CLng(\"&H6c\")) &\nChr(CLng(\"&H6c\"))\n\n\nThe tester also added a line (line 29 in Figure 9) that uses the built-in Shell function to run the “AppPool.vbs” script using the\nwscript application. The tester used the “vbHide” flag in the call to the Shell function, which will run the command in a hidden\nwindow.\n\n\n-----\n\n_Figure 9 Screenshot of diff between files related to Iteration 4 showing string obfuscation and use of the built-in Shell function_\n\nIteration 5\n\n**Files** 056ffc13a7a2e944f7ab8c99ea9a2d1b429bbafa280eb2043678aa8b259999aa ->\n216ffed357b5fe4d71848c79f77716e9ecebdd010666cdb9edaadf7a8c9ec576\n\n**Filenames** sss.xls -> sss.xls\n\n**Delta** 5 minutes 6 seconds\n\n**Positives** 18 -> 5\n\nIn this iteration, the tester removes the call to the built-in Shell function that runs the “AppPool.vbs” script using wscript that they\nintroduced in the previous iteration. Figure 10 shows that the tester removed the code on line 29 by replacing it with an empty\nline.\n\n_Figure 10 Screenshot of diff between files related to Iteration 5 showing removal the call to the Shell function_\n\n\n-----\n\nIteration 6\n\n**Files** 216ffed357b5fe4d71848c79f77716e9ecebdd010666cdb9edaadf7a8c9ec576 ->\n687027d966667780ab786635b0d4274b651f27d99717c5ba95e139e94ef114c3\n\n**Filenames** sss.xls -> sss.xls\n\n**Delta** 5 minutes 14 seconds\n\n**Positives** 5 -> 17\n\nIn this iteration, the tester reintroduces the call to the built-in Shell function that they removed in the prior iteration. However, the\ntester did not include the command to run by omitting the string to run the “AppPool.vbs” script using wscript. Figure 11 shows\nthat the call to the Shell function has a blank command parameter. The detection rate increased considerably, which suggests\nthat the detection rate was not based on the command itself, rather detection stemmed on the generic call to the built-in Shell\nfunction.\n\n_Figure 11 Screenshot of diff between files related to Iteration 6 showing the use of an empty command in the Shell function_\n\nIteration\n\n**Files** 687027d966667780ab786635b0d4274b651f27d99717c5ba95e139e94ef114c3 ->\n364e2884251c151a29071a5975ca0076405a8cc2bab8da3e784491632ec07f56\n\n**Filenames** sss.xls -> sss.xls\n\n**Delta** 10 minutes\n\n**Positives** 17 -> 9\n\nIn this iteration, the tester reintroduces the command to run the “AppPool.vbs” script using wscript to the call to the built-in Shell\nfunction, as seen in Figure 12. However, this time the tester uses the “vbNormalFocus” flag instead of the “vbHide” flag, which\nruns the command in a visible command prompt window. This change lowers the detection rate by 8, which suggests that the use\nof the “vbHide” flag within the Shell function was considered malicious by several vendors.\n\n_Figure 12 Screenshot of diff between files related to Iteration 7 showing use of a visible window when running command_\n\nIteration 8\n\n**Files** 364e2884251c151a29071a5975ca0076405a8cc2bab8da3e784491632ec07f56 ->\n66d678b097a2245f60f3d95bb608f3958aa0f5f19ca7e5853f38ea79885b9633\n\n**Filenames** sss.xls -> sss - Copy.xls\n\n**Delta** 4 days 21 hours 24 minutes 31 seconds\n\n**Positives** 9 -> 11\n\n\n-----\n\nThis iteration of testing was performed well after the previous iteration with the newly generated file being created almost 5 days\nafter its predecessor. This large delta in file creation times could suggest a new round of testing activities; however, the filename\nfor this newly generated file is “sss - Copy.xls” while the previous file was named “sss.xls”. Comparing these two filenames\nsuggests that the tester may have copied the file generated in the previous iteration to use as a basis for this current iteration of\ntesting. Due to the filenames and the changes made to the macros in these two documents, we are treating this activity as part of\nthe ongoing testing efforts.\n\nIn this iteration, the tester made a few changes to multiple portions of the macro. First, the tester removed the line of code that\nwould have the macro sleep for 10 seconds, which was first introduced in iteration 3. Figure 13 shows the removal of this line of\ncode, which uses the “Application.Wait” function to sleep for 10 seconds.\n\n_Figure 13 Screenshot of diff between files related to Iteration 8 showing removal of the sleep functionality_\n\nThe next modification made by the tester involved obfuscating the string “wscript “ within the command run within the Shell\nfunction. The tester uses the same string obfuscation technique used in previous iterations by replacing the string with each\ncharacter in hexadecimal form concatenated together. Figure 14 shows the obfuscated string “Chr(CLng(\"&H77\")) &\nChr(CLng(\"&H73\")) & Chr(CLng(\"&H63\")) & Chr(CLng(\"&H72\")) & Chr(CLng(\"&H69\")) & Chr(CLng(\"&H70\")) &\nChr(CLng(\"&H74\")) & Chr(CLng(\"&H20\"))” used to represent “wscript “.\n\nFigure 14 also shows the tester changed the variable name used to store the ActiveSheet object that represents the current\nExcel worksheet. The tester changed this variable name from “sh” to “Sh” (line 41), which the tester also changed in each\npreceding line (lines 43, 45 and 47) when using the object.\n\n_Figure 14 Screenshot of diff between files related to Iteration 8 showing use of string obfuscation on command and modified_\n_variable name_\n\nIteration 9\n\n**Files** 66d678b097a2245f60f3d95bb608f3958aa0f5f19ca7e5853f38ea79885b9633 ->\n70ff20f2e5c7fd90c6bfe92e28df585f711ee4090fc7669b3a9bd024c4e11702\n\n\n-----\n\n**Filenames** sss - Copy.xls -> sss - Copy.xls\n\n**Delta** 1 minute 57 seconds\n\n**Positives** 11 -> 7\n\nIn the last iteration of testing, the tester removes the entire line of code used to call the Shell function used to call the\n“AppPool.vbs” script that included the obfuscated “wscript” string. Figure 15 shows that the tester merely removed the entire line\nand did not replace it with any code, which suggests that the macro would never run the VBScript file that it saves to the system.\n\n_Figure 15 Screenshot of diff between files related to Iteration 9 showing removal of the Shell command_\n\n**Get updates from**\n\n**Palo Alto**\n\n**Networks!**\n\nSign up to receive the latest news, cyber threat intelligence and research from us\n\n[By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement.](https://www.paloaltonetworks.com/legal-notices/terms-of-use)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-11-16 - Analyzing OilRig’s Ops Tempo from Testing to Weaponization to Delivery.pdf"
    ],
    "report_names": [
        "2018-11-16 - Analyzing OilRig’s Ops Tempo from Testing to Weaponization to Delivery.pdf"
    ],
    "threat_actors": [
        {
            "id": "cffb3c01-038f-4527-9cfd-57ad5a035c22",
            "created_at": "2022-10-25T15:50:23.38055Z",
            "updated_at": "2025-03-27T02:00:55.459558Z",
            "deleted_at": null,
            "main_name": "OilRig",
            "aliases": [
                "COBALT GYPSY",
                "IRN2",
                "APT34",
                "Helix Kitten",
                "Evasive Serpens",
                "Hazel Sandstorm",
                "EUROPIUM",
                "ITG13"
            ],
            "source_name": "MITRE:OilRig",
            "tools": [
                "ISMInjector",
                "RDAT",
                "Systeminfo",
                "QUADAGENT",
                "OopsIE",
                "Tasklist",
                "certutil",
                "ZeroCleare",
                "POWRUNER",
                "netstat",
                "ipconfig",
                "LaZagne",
                "BONDUPDATER",
                "SideTwist",
                "PsExec",
                "SEASHARPEE",
                "Mimikatz",
                "RGDoor",
                "ftp"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "67709937-2186-4a32-b64c-a5693d40ac77",
            "created_at": "2023-01-06T13:46:38.495593Z",
            "updated_at": "2025-03-27T02:00:02.848206Z",
            "deleted_at": null,
            "main_name": "OilRig",
            "aliases": [
                "IRN2",
                "Hazel Sandstorm",
                "EUROPIUM",
                "TA452",
                "Earth Simnavaz",
                "Cobalt Gypsy",
                "Crambus",
                "Helix Kitten",
                "APT 34",
                "APT34",
                "ATK40",
                "G0049",
                "Evasive Serpens",
                "Twisted Kitten"
            ],
            "source_name": "MISPGALAXY:OilRig",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "8f9c8a6e-f6b6-431b-bedd-94fdeea5474a",
            "created_at": "2024-05-01T02:03:08.022974Z",
            "updated_at": "2025-03-27T02:05:17.310877Z",
            "deleted_at": null,
            "main_name": "COBALT GYPSY",
            "aliases": [
                "CHRYSENE ",
                "Crambus ",
                "EUROPIUM ",
                "Hazel Sandstorm ",
                "Helix Kitten ",
                "ITG13 ",
                "OilRig ",
                "Yellow Maero ",
                "APT34 "
            ],
            "source_name": "Secureworks:COBALT GYPSY",
            "tools": [
                " Helminth",
                " Jason",
                " MacDownloader",
                " PoisonFrog",
                " RGDoor",
                " ThreeDollars",
                " TinyZbot",
                " Toxocara",
                " Trichuris",
                " TwoFace",
                "Glimpse"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "b6436f7b-6012-4969-aed1-d440e2e8b238",
            "created_at": "2022-10-25T16:07:23.91517Z",
            "updated_at": "2025-03-27T02:02:10.027531Z",
            "deleted_at": null,
            "main_name": "OilRig",
            "aliases": [
                "APT 34",
                "ATK 40",
                "Chrysene",
                "Cobalt Gypsy",
                "Crambus",
                "DEV-0861",
                "EUROPIUM",
                "Earth Simnavaz",
                "Evasive Serpens",
                "Hazel Sandstorm",
                "Helix Kitten",
                "IRN2",
                "ITG13",
                "Scarred Manticore",
                "Storm-0861",
                "TA452",
                "Twisted Kitten",
                "UNC1860",
                "Yellow Maero"
            ],
            "source_name": "ETDA:OilRig",
            "tools": [
                "AMATIAS",
                "Agent Drable",
                "Agent Injector",
                "AgentDrable",
                "Alma Communicator",
                "BONDUPDATER",
                "CACTUSPIPE",
                "Clayslide",
                "CypherRat",
                "DNSExfitrator",
                "DNSpionage",
                "DROPSHOT",
                "DistTrack",
                "DropperBackdoor",
                "Fox Panel",
                "GREYSTUFF",
                "GoogleDrive RAT",
                "HighShell",
                "HyperShell",
                "ISMAgent",
                "ISMDoor",
                "ISMInjector",
                "Jason",
                "Karkoff",
                "LIONTAIL",
                "LOLBAS",
                "LOLBins",
                "LONGWATCH",
                "LaZagne",
                "Living off the Land",
                "MailDropper",
                "Mimikatz",
                "MrPerfectInstaller",
                "OILYFACE",
                "OopsIE",
                "POWBAT",
                "POWRUNER",
                "Plink",
                "Poison Frog",
                "PowerExchange",
                "PsList",
                "PuTTY Link",
                "QUADAGENT",
                "RDAT",
                "RGDoor",
                "SEASHARPEE",
                "Saitama",
                "Saitama Backdoor",
                "Shamoon",
                "SideTwist",
                "SpyNote",
                "SpyNote RAT",
                "StoneDrill",
                "TONEDEAF",
                "TONEDEAF 2.0",
                "ThreeDollars",
                "TwoFace",
                "VALUEVAULT",
                "Webmask",
                "WinRAR",
                "ZEROCLEAR",
                "ZeroCleare",
                "certutil",
                "certutil.exe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536051,
    "ts_updated_at": 1743041847,
    "ts_creation_date": 1653698101,
    "ts_modification_date": 1653698101,
    "files": {
        "pdf": "https://archive.orkl.eu/8095389db59381cbf56f1944572dd1114d612d5b.pdf",
        "text": "https://archive.orkl.eu/8095389db59381cbf56f1944572dd1114d612d5b.txt",
        "img": "https://archive.orkl.eu/8095389db59381cbf56f1944572dd1114d612d5b.jpg"
    }
}