{
    "id": "c63ce570-1355-4267-8003-080cab2103d5",
    "created_at": "2022-10-25T16:48:24.705388Z",
    "updated_at": "2025-03-27T02:10:04.934519Z",
    "deleted_at": null,
    "sha1_hash": "5020098299aac9de9130653e3df183221d6a2c74",
    "title": "Roaming Mantis: an Anatomy of a DNS Hijacking Campaign",
    "authors": "",
    "file_creation_date": "2019-08-23T16:35:52Z",
    "file_modification_date": "2019-08-23T16:35:52Z",
    "file_size": 4164773,
    "plain_text": "### Roaming Mantis:\n#### an Anatomy of a DNS Hijacking Campaign\n\n###### Suguru Ishimaru Manabu Niseki Hiroaki Ogawa GReAT APAC NTT-CERT Professional Service Kaspersky Lab NTT SC Labs\n McAfee\n\n\n-----\n\n##### ContentsRoaming Mantis\n\n\n###### 1. Introduction\n\n 2. What is Roaming Mantis\n\n 3. MoqHao and SMShing\n 4. Attribution\n 5. Conclusions\n\n\n-----\n\n## $ whoami\n\n###### Introduction of ourselves\n\n\n-----\n\n##### Who are we..?\n\n Suguru Ishimaru Manabu Niseki\n\n###### GReAT APAC NTT-CERT\n\n\n##### Hiroaki Ogawa\n\n###### Professional Service\n\n\n-----\n\n## $ man roamingmantis\n\n###### What is Roaming Mantis\n\n\n-----\n\n##### What is Roaming Mantis?\n\n\n\n###### • Cyber criminal campaign\n\n • Compromised routers\n\n • Targeted multi platform and\n\n multiple language\n\n • Started since early 2018\n\n\n###### Multilingual Malicious APK\n\n Phishing site\n\n Web mining\n\n\n###### Malicious APK\n\n\n-----\n\n##### What is Roaming Mantis?\n\n\n###### Compromised router\n\n Roaming\n\n Bugdroid’s color\n\n Mistakes (BUG)\n\n Mantis\n\n\n-----\n\n```\n         少爺\n\n##### Roaming Mantis aka (Shaoye)\n\n###### • ５７東森財經新聞台: 「少爺殭屍」網路擴散！全球百萬筆個資遭竊 (2018/06/07)\n\n • https://www.youtube.com/watch?v=NEVMxhXG2lE\n\n • TWNCERT: Shaoye Botnet Affecting Network Devices in Asia-Pacific (2018/06/14)\n\n • https://www.nccst.nat.gov.tw/NewsRSSDetail?lang=en&RSSType=news&seq=16111\n\n TWNCERT says:\n\n • At least 6,000 mobile devices are infected with malicious apps, leaking more than 1 million pieces of personal information.\n • The infection spreads to 55 countries in the world and South Korea being the main target has a victim rate of 75%\n\n```\n\n-----\n\n##### Compromised routers\n\n\n-----\n\n##### Compromised routers\n\n\n-----\n\n##### Rogue DNS servers\n\n|Col1|A|B|C|D|\n|---|---|---|---|---|\n|Primary|1.53.252.215 (Vietnam)|171.244.3.110 (Vietnam)|118.30.28.38 (China)|42.112.35.45 (Vietnam)|\n|Secondary|1.53.252.164 (Vietnam)|171.244.3.111 (Vietnam)|118.30.28.39 (China)|42.112.35.55 (Vietnam)|\n\n\n-----\n\n##### Korea is the first priority target\n\n\n###### 168.126.63.1 (Korea Telecom / Korea) 203.248.252.2 (LG DACOM Corporation / Korea)\n 219.250.36.130 (SK Broadband Co Ltd / Korea)\n\n\n###### Note: they are legitimate DNS servers in Korea\n\n\n-----\n\n##### DNS changer\n\n###### • My handmade honeypot (which impersonates a Korean router) observed a DNS changer payload via 205.209.174.238.\n\n • Roaming Mantis DNS changer takes 2 steps.\n 1. Taking a fingerprint of a target.\n\n\n-----\n\n##### JS DNS changer\n\n###### The router’s DNS setting is potentially compromised if the device reads the URL query of the DNS changer from localnet under a router with the following conditions:\n\n • No authentication for router panel from localnet\n\n • The device has an admin session for the router panel\n\n • Simple ID and password (or default) for router panel like admin:admin / user:user\n\n\n-----\n\n##### KSN data for detection of rogue DNS (1 – 19 Aug 2019)\n\n###### 98,000+ detections based on KSN data.\n\n 1. Russia\n 2. India\n 3. Vietnam\n 4. Bangladesh\n 5. Japan\n 6. Kazakhstan\n 7. Indonesia\n 8. Pakistan\n 9. Taiwan\n\n\n-----\n\n##### Landing page\n\n\n-----\n\n##### Using Taiwanese hosts as landing pages\n\n###### • HiNet:\n\n • 1.171.153.177, 1.171.154.9, 1.171.156.75\n • 1.171.158.91, 1.171.169.160, 1.171.169.201\n • 1.171.171.34, 1.171.174.228, 1.171.175.167\n • Etc.\n\n • SEEDNET:\n\n • 175.181.255.52\n • 112.104.27.225, 112.104.26.33\n\n\n-----\n\n##### Targeted multi platform\n\n###### Malicious APK file(MoqHao)\n\n Phishing\n\n Mining\n\n\n###### Phishing\n\n\n-----\n\n##### Accessing a landing page with iOS\n\n\n-----\n\n##### Accessing a landing page with Android\n\n\n-----\n\n## $ file moqhao.apk\n\n###### MoqHao and SMShing\n\n\n-----\n\n##### MoqHao via SMShing\n\n###### • MoqHao (alias: Shaoye and XLoader) is spreading via SMShing which impersonates Japanese logistics brands in Japan.\n\n\n-----\n\n##### Spreading chain\n\n###### • An infected Android device sends a SMS with a bit.ly link.\n\n\n\n###### •\n\n\n-----\n\n##### Phishing website in Japan\n\n\n###### iOS\n\n\n###### Android\n\n\n###### k(M H )\n\n\n-----\n\n##### In July 2019, new target is …\n\n\n-----\n\n```\n黑貓宅急便\n\n##### is targeted in Taiwan\n\n###### • Since early July 2019, MoqHao SMShing is started targeting 黑貓宅急便 in Taiwan.\n\n```\n\n-----\n\n```\n黑貓宅急便\n\n##### landing page\n\n```\n\n###### Apple phishing\n\n\n-----\n\n##### Phishing website in Taiwan\n\n###### iOS\n\n\n###### Android\n\n\n###### smartcat apk(MoqHao)\n\n\n-----\n\n##### Android malware MoqHao (smartcat.apk)\n\n###### MoqHao contains encrypted payload executed by loader module:\n\n\n###### Loader module\n\n Encrypted payload\n\n\n-----\n\n##### Android malware MoqHao\n\n###### MoqHao payload module is a backdoor.\n\n 20[th] backdoor commands 4,000+ stolen info\n 1. sendSms 12. showHome\n 2. setWifi 13. getnpki • IP\n 3. gcont 14. http • Language\n 4. lock 15. onRecordAction • ID (email)\n 5. bc 16. call • Password\n 6. setForward 17. get_apps • Name\n 7. getForward 18. show_fs_float_ • Address\n 8. hasPkg window •\n 9. setRingerMode 19. Ping •\n 10. setRecEnable 20. getPhoneState • Bank info\n\n\n\n###### • IP\n\n • Language\n\n • ID (email)\n\n • Password\n\n • Name\n\n • Address\n\n • Credit card info\n\n • Tow factor auth\n\n • Bank info\n\n\n-----\n\n##### Improving crypto algorithm of loader module\n\n\n###### Skip 4bytes\n\n +\n\n Zlib\n\n +\n\n Base64\n\n\n###### Base64\n\n\n###### import sys\n Base64import zlib Zlib Skip 4bytes DES\n +import base64+ + Key “xieurjke”\n\n Zlib Base64 Zlib +\n data = open(sys.argv[1], \"rb\").read()\n + ZIP\n dec_z = zlib.decompress(data[4:])\n Base64\n dec_b = base64.b64decode(dec_z)\n\n\n-----\n\n##### Wrong design (vulnerability?) in old versions\n\n###### Read email subject and decrypt real C2 destination\n\n Wrong design\n\n If someone send a Email to there…?\n\n\n-----\n\n##### Fixed wrong design in 2019\n\n\n###### #!/usr/bin/env python\n xor + sub Base64 + DES(EBC)\n\n from Crypto.Cipher import DES import sys import base64\n\n enc = base64.urlsafe_b64decode(sys.argv[1]) key = b\"Ab5d1Q32\"\n\n des = DES.new(key,2,key) dec = des.decrypt(enc) print(dec)\n\n\n###### Crypto Algorithm\n Apr 2019\n\n Base64.urlsafe + DES (CBC)\n\n\n###### import sys\n\n key = b\"\n Fixed\n\n\n-----\n\n## $ whois\n\n###### Attribution\n\n\n-----\n\n##### The goal of the attacker\n\n###### Of course… Get the money!\n\n\n-----\n\n##### Creating account from stolen information\n\n|Col1|Col2|\n|---|---|\n\n\n###### the C2\n\n\n###### Billing\n\n\n-----\n\n##### Stealing authentication code\n\n###### EC Sites/Payment Service SMS Carrier Billing\n\n\n-----\n\n##### Abusing stolen information\n\n\n-----\n\n##### Money earning and money laundering technique\n\n###### By money launderer (Money mule phase)\n Shopping\n EC sites\n with\n payment\n Stolen credit\n service\n card\n\n Stolen credit card\n\nNikkei 2019/6/6\n\n\n-----\n\n##### How to recruit a money Launderer\n\n\n###### “If you have an iPhone, there is a job. Get rewards just by purchasing a game item! No cost at all.”\n\n\n-----\n\n## $ shutdown –h now\n\n###### Conclusions\n\n\n-----\n\n##### Conclusions\n\n\n###### THE ROAMING MANTIS\n\n Targets Taiwan via SMShing\n\n Is rapidly improving\n\n Has strong financial motivationRoaming    Mantis\n\n\n-----\n\n##### Example of IoCs\n\n###### Malicious smartcat.apk Type A (MoqHao/XLoader) and its modules c2dea0e63bd58062824fd960c6ff5d10 APK file 720c9528f2bb436fa3ca2196af718332 APK file 11ab174bf1dbac0418a14853bae5f1ae ¥classes.dex 95aa090211fd06bbd2d2c310d0742371 ¥classes.dex 2275e5b5186fdfddd64cbb653cc7c5e2 ¥assets¥?¥????? (Encrypted payload) 14eb70a63a16612ec929b552fced6190 ¥assets¥?¥????? (Encrypted payload) 710b672224653ad7e31bd081031928b4 Decrypted payload(.dex) 7d41ef4c8e39d4dd8ca937d23521254aDecrypted payload(.dex)\n\n Suspicious hardcoded accounts id538254835 m.vk.com id538255725 m.vk.com id538256404 m.vk.com 09261074305103529133 blogger com\n\n\n-----\n\n##### References security-intelligence/a-look-into-the###### connection-between-xloader-and-fakespy- and-their-possible-ties-with-the-yanbian- gang/ 2. https://securelist.com/roaming-mantis- uses-dns-hijacking-to-infect-android- smartphones/85178/ 3. https://securelist.com/roaming-mantis- dabbles-in-mining-and-phishing- multilingually/85607/ 4. https://securelist.com/roaming-mantis- part-3/88071/ 5. https://securelist.com/roaming-mantis- part-iv/90332/ 6. https://securingtomorrow.mcafee.com/ other-blogs/mcafee-labs/moqhao l t d d id t ti\n\n\n-----\n\n# Let’s Talk?\n\n###### Suguru Ishimaru Manabu Niseki GReAT APAC NTT-CERT Kaspersky Lab NTT SC Labs\n\n Hiroaki Ogawa\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        },
        {
            "id": "5910e58f-4bc9-4e4e-9dbb-887804094a01",
            "created_at": "2022-10-25T16:32:58.457399Z",
            "updated_at": "2022-10-25T16:32:58.457399Z",
            "deleted_at": null,
            "name": "OTX",
            "url": "https://otx.alienvault.com",
            "description": "Alienvault Open Threat Exchange (OTX)",
            "reports": null
        }
    ],
    "references": [
        "https://hitcon.org/2019/CMT/slide-files/d2_s1_r1.pdf"
    ],
    "report_names": [
        "d2_s1_r1.pdf"
    ],
    "threat_actors": [
        {
            "id": "f9bc28d0-ce98-4991-84ae-5036e5f9d4e3",
            "created_at": "2022-10-25T16:07:24.546437Z",
            "updated_at": "2025-03-27T02:02:10.277573Z",
            "deleted_at": null,
            "main_name": "Roaming Mantis",
            "aliases": [
                "Roaming Mantis Group",
                "Shaoye"
            ],
            "source_name": "ETDA:Roaming Mantis",
            "tools": [
                "MoqHao",
                "Roaming Mantis",
                "SmsSpy",
                "Wroba",
                "XLoader"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "8f350ed9-134e-4160-b63d-701f562ba64a",
            "created_at": "2022-10-25T16:07:24.589322Z",
            "updated_at": "2025-03-27T02:02:10.292236Z",
            "deleted_at": null,
            "main_name": "Yanbian Gang",
            "aliases": [],
            "source_name": "ETDA:Yanbian Gang",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "4c5a35bf-f483-463e-aea0-89a795698cff",
            "created_at": "2023-01-06T13:46:39.198624Z",
            "updated_at": "2025-03-27T02:00:03.019375Z",
            "deleted_at": null,
            "main_name": "Yanbian Gang",
            "aliases": [],
            "source_name": "MISPGALAXY:Yanbian Gang",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "c94cb0e9-6fa9-47e9-a286-c9c9c9b23f4a",
            "created_at": "2023-01-06T13:46:38.823793Z",
            "updated_at": "2025-03-27T02:00:02.928254Z",
            "deleted_at": null,
            "main_name": "Roaming Mantis",
            "aliases": [
                "Roaming Mantis Group"
            ],
            "source_name": "MISPGALAXY:Roaming Mantis",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1666716504,
    "ts_updated_at": 1743041404,
    "ts_creation_date": 1566578152,
    "ts_modification_date": 1566578152,
    "files": {
        "pdf": "https://archive.orkl.eu/5020098299aac9de9130653e3df183221d6a2c74.pdf",
        "text": "https://archive.orkl.eu/5020098299aac9de9130653e3df183221d6a2c74.txt",
        "img": "https://archive.orkl.eu/5020098299aac9de9130653e3df183221d6a2c74.jpg"
    }
}