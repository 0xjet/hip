{
    "id": "524658d2-ac51-4bb7-8413-f5f1d0fcb5a0",
    "created_at": "2023-01-12T15:07:25.43235Z",
    "updated_at": "2025-03-27T02:09:29.397397Z",
    "deleted_at": null,
    "sha1_hash": "032be1e1d2596dc62cc77c4641609f4a9ed0b0d1",
    "title": "2021-01-12 - Slamming The Backdoor On BazarLoader",
    "authors": "",
    "file_creation_date": "2022-05-28T16:08:20Z",
    "file_modification_date": "2022-05-28T16:08:20Z",
    "file_size": 17881059,
    "plain_text": "# Slamming The Backdoor On BazarLoader\n\n**[blog.minerva-labs.com/slamming-the-backdoor-on-bazarloader](https://blog.minerva-labs.com/slamming-the-backdoor-on-bazarloader)**\n\n## Minerva Labs Blog\n\nNews & Reports\n\n[Tweet](https://twitter.com/share)\n\nIt seems like Trickbot’s creators are trying to up their game in 2021. A new version of\nBazarBackdoor is being distributed through a malicious Excel file that drops and executes\nBazarLoader. The new and improved binary contains new surprises for both security\nproducts and researchers.\n\n\n-----\n\nBefore executing any malicious code, a couple of anti-emulation techniques are used. First,\n[the malware calls SetFileAttributesA with the parameters “C:\\windows\\Explorer.exe” and](https://docs.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-setfileattributesa)\nFILE_ATTRIBUTE_NORMAL (0x80) and if the function succeeds the malware will exit.\n[Secondly, the malware calls the function WriteFileGather with the invalid handle 0, and exits](https://docs.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-writefilegather)\nif the return value is not 0.\n\nAfter the anti-emulation checks Bazar will load a resource (ID is 0x1e55 in our sample) and\n[decrypt its content using a modified RC4 algorithm and a hardcoded key. The malware’s](https://en.wikipedia.org/wiki/RC4)\nauthor changed the algorithm’s hardcoded value of the secret state’s permutation from 256\nto 30, thus rendering most of the key provided by the malware unused.\n\nThe RC4 functions and the hardcoded key:\n\n\n-----\n\nAfter the decryption of the next payload, it is copied to a newly allocated RWX section, and\nexecution is transferred. The decrypted code reflectively decodes and load the final payload,\n[which is obfuscated using Control Flow Flattening, a compiler-based obfuscation technique:](https://github.com/obfuscator-llvm/obfuscator/wiki/Control-Flow-Flattening)\n\nAs part of a dynamic analysis of the payload, we have observed a few peculiar behaviors:\n\nThe malware spawns the process “ping 8.8.8.8 -n 2”, probably to verify internet\nconnectivity.\nThe malware copies itself to the directory\n“C:\\Users\\CurrentUser\\Pictures\\RandomlyGenerated” and executes itself from there.\nBazar door tries to read the disk version of ntdll.dll, probably in order to perform\n[usermode unhooking through dll remapping. (similar to conti ransomware).](https://blog.minerva-labs.com/conti-ransomware-built-to-bypass-edrs-prevented-by-minerva?hsLang=en-us)\nThe Loader tries to inject its payload into an operating system process, in our sample\nthe process chosen was cmd.exe.\n\n\n-----\n\n**The Conti connection:**\n\n[Many sources has reported a link between Conti ransomware, which we profiled last fall,](https://blog.minerva-labs.com/conti-ransomware-built-to-bypass-edrs-prevented-by-minerva?hsLang=en-us)\nand Bazar loader. We have observed a striking similarity between the packer of a Conti\n[sample from last October (VirusTotal Link) and the new sample in question, specifically in the](https://www.virustotal.com/gui/file/3c59357228902b1f1202af674960632b821a640f1968341498f6b557d82c8e1b/detection)\nmodification of RC4 to decrypt a payload from the resource section.\n\nBazar loader has greatly matured as a stealthy first-stage malware, as can be seen by\nprevious versions of the malware, its development team is very active. It is safe to assume\nthis would not be the last we hear of it.\n\nMinerva Labs prevents Bazar Backdoor with our Hostile Environment Simulation and\nInjection Prevention modules:\n\n\n-----\n\n**IOCs:**\n\n**Hash:**\n\nd362c83e5a6701f9ae70c16063d743ea9fe6983d0c2b9aa2c2accf2d8ba5cb38\n\n**IPs:**\n\n54[.]184[.]178[.]68\n\n**RC4 Key:**\n\nYfsQptT(y6*V_Avqg^08%vSG9jj%XWo136@bgbaDqHh@ZvSQzD?\ns!^Cl06@9rr83f*WpgB5c^!”.\n\n[« Previous Post](https://blog.minerva-labs.com/must-attend-2021-cybersecurity-conferences?hsLang=en-us)\n[Next Post](https://blog.minerva-labs.com/the-curious-case-of-flashhelperservice?hsLang=en-us) »\n\n### Interested in Minerva? Request a Demo Below\n\n## Related Posts\n\n\n-----\n\n## Conti Ransomware - Built to bypass EDRs, Prevented by Minerva\n\n[Read More >>](https://blog.minerva-labs.com/conti-ransomware-built-to-bypass-edrs-prevented-by-minerva?hsLang=en-us)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-01-12 - Slamming The Backdoor On BazarLoader.pdf"
    ],
    "report_names": [
        "2021-01-12 - Slamming The Backdoor On BazarLoader.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536045,
    "ts_updated_at": 1743041369,
    "ts_creation_date": 1653754100,
    "ts_modification_date": 1653754100,
    "files": {
        "pdf": "https://archive.orkl.eu/032be1e1d2596dc62cc77c4641609f4a9ed0b0d1.pdf",
        "text": "https://archive.orkl.eu/032be1e1d2596dc62cc77c4641609f4a9ed0b0d1.txt",
        "img": "https://archive.orkl.eu/032be1e1d2596dc62cc77c4641609f4a9ed0b0d1.jpg"
    }
}