{
    "id": "dfe8d19b-93fb-4f22-b2d7-c1b706e109e4",
    "created_at": "2023-01-12T14:59:33.984722Z",
    "updated_at": "2025-03-27T02:05:30.569855Z",
    "deleted_at": null,
    "sha1_hash": "d86a1bde31600630868da854dae3482187f007fc",
    "title": "2022-06-05 - Loading GootLoader",
    "authors": "",
    "file_creation_date": "2022-06-13T04:01:12Z",
    "file_modification_date": "2022-06-13T04:01:12Z",
    "file_size": 939104,
    "plain_text": "# Loading GootLoader\n\n**[dinohacks.blogspot.com/2022/06/loading-gootloader.html](https://dinohacks.blogspot.com/2022/06/loading-gootloader.html)**\n\nNiranjan Hegde\n\n**_Disclaimer: Opinions expressed are solely my own. None of the ideas expressed in_**\n**_this blog post are shared, supported, or endorsed in any manner by my employer._**\n\nIn this blog, I will be taking a look at the initial GootLoader sample\n(MD5: 4dd369b5e028beebe3aa5c980960c502,\nSha256: c1029f0b5f4f6dfbe0fe656f075cbb5ccc2fc308087db21438d73394b75ea020).\n\nAvailable here: https://bazaar.abuse.ch/sample/c1029f0b5f4f6dfbe0fe656f075cbb5ccc2fc308\n087db21438d73394b75ea020/\n\nThe sample is a javascript program which is meant to be executed in windows using\nwscript.exe.\n\nOpening the sample in a text editor, it appears to look like jquery library 3.6.0 (screenshot\nbelow).\n\n\n-----\n\nComparing the sample with jqeury 3.6.0 downloaded from https://code.jquery.com/jquery3.6.0.js, differences can be observed.\n\nThe following lines shows the code inserted to create the sample:\n\nOne important thing to mention about javascript: If a variable is declared without keywords\nsuch as var, it will be treated as global variable.\n\nAfter reading the code, following points can be observed:\n\nFunction seat07() is incrementing a variable in a loop. The incremented variable is not\nreferred in any part of the code. This is most likely done to increase the execution time\nand thus timeout sandbox detection. Commenting out the function would speed up the\nexecution.\nFunction gone068() contains the obfuscated string which is likely deobfuscated and\nexecuted. Generally, deobfuscated string would require one of the following to be\nexecuted:\n\neval()\nfunction constructor\nwindow object\nIt would be interesting to see how deobfuscated string is executed in this sample.\nFunction law1() and present4() are quite interesting because they are accessing array\nelements and making a call. They could be used to call deobfuscating routine and\nexecute the deobfuscated string.\n\nAfter adding breakpoints and running the program in a javascript debugger, first layer of the\nGootLoader becomes clear:\n\nFollowing points can be observed:\n\nDeobfuscated strings are executed using function constructor.\nIt contains obfuscated string which needs to be deobfuscated.\nIt also seems to be accessing the registry: HKEY_CURRENT_USER\n\nDeobfuscating the string in first layer reveals the second layer of GootLoader:\nThe following points can be noted:\n\nIt checks if the environment variable userdnsdomain is set which would indicate that\nthe system is part of AD.\nIf active directory is set, then it would add the string \"4173581\" to parameter value in its\nrequests.\nThe C2 communication would look something like this:\n\n\n-----\n\nGET request to server with path: test.php?zgntopmtyplqx=\nThe parameter will be <random value>4173581 if computer is part of AD\notherwise only <random value>\nIf the http response status code is anything other than 200, it would sleep for\n12345 milliseconds and check for another domain.\nIf the http response status code is 200, then it would look for the string :\n\"@<parameter value sent>@\" in the response text.\n\nif it is not present, then it will sleep for 23232 milliseconds.\nIf it is present, then it will do the following:\n\nRemove the string \"@<parameter value sent>@\" in the response\ntext.\nResponse text is likely to be series of numbers which are parsed as\nintegers then converted to ascii strings which are then deobfuscated.\n\nIf you are interested to read about this campaign, you can read the following blogs:\n\nhttps://news.sophos.com/en-us/2021/03/01/gootloader-expands-its-payload-deliveryoptions/\n[https://thedfirreport.com/2022/05/09/seo-poisoning-a-gootloader-story/](https://thedfirreport.com/2022/05/09/seo-poisoning-a-gootloader-story/)\n\n[You can also follow the twitter account: https://twitter.com/GootLoaderSites to get updates](https://twitter.com/GootLoaderSites)\nabout the C2 server used by this campaign.\n\nIn this blog, I used a debugger to deobfuscate the sample. There is a decoder script for this\ncampaign available\nat: [https://github.com/hpthreatresearch/tools/blob/main/gootloader/decode.py](https://github.com/hpthreatresearch/tools/blob/main/gootloader/decode.py)\n\nYou can also read the blog that explains how this decoder script was\nwritten: https://threatresearch.ext.hp.com/tips-for-automating-ioc-extraction-from-gootloadera-changing-javascript-malware/\n\nHave a nice Day!\n\n## AUDI SQLi Labs Lesson 1 walkthrough\n\n Kioptrix Level 1 walkthrough\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-06-05 - Loading GootLoader.pdf"
    ],
    "report_names": [
        "2022-06-05 - Loading GootLoader.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535573,
    "ts_updated_at": 1743041130,
    "ts_creation_date": 1655092872,
    "ts_modification_date": 1655092872,
    "files": {
        "pdf": "https://archive.orkl.eu/d86a1bde31600630868da854dae3482187f007fc.pdf",
        "text": "https://archive.orkl.eu/d86a1bde31600630868da854dae3482187f007fc.txt",
        "img": "https://archive.orkl.eu/d86a1bde31600630868da854dae3482187f007fc.jpg"
    }
}