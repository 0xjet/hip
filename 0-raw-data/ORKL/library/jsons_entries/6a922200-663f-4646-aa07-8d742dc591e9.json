{
    "id": "6a922200-663f-4646-aa07-8d742dc591e9",
    "created_at": "2023-01-12T14:59:40.478476Z",
    "updated_at": "2025-03-27T02:05:35.680744Z",
    "deleted_at": null,
    "sha1_hash": "26c2dc16478c2d6f12d27c739ca741ff6f6638ad",
    "title": "2022-02-16 - A Modern Ninja- Evasive Trickbot Attacks Customers of 60 High-Profile Companies",
    "authors": "",
    "file_creation_date": "2022-05-28T23:50:20Z",
    "file_modification_date": "2022-05-28T23:50:20Z",
    "file_size": 1468442,
    "plain_text": "# A Modern Ninja: Evasive Trickbot Attacks Customers of 60 High-Profile Companies\n\n**[research.checkpoint.com/2022/a-modern-ninja-evasive-trickbot-attacks-customers-of-60-high-profile-companies/](https://research.checkpoint.com/2022/a-modern-ninja-evasive-trickbot-attacks-customers-of-60-high-profile-companies/)**\n\nFebruary 16, 2022\n\nFebruary 16, 2022\n_Research by: Aliaksandr Trafimchuk, Raman Ladutska_\n\n[This research comes as a follow-up to our previous article on Trickbot, “When Old Friends Meet Again: Why Emotet](https://research.checkpoint.com/2021/when-old-friends-meet-again-why-emotet-chose-trickbot-for-rebirth/)\nChose Trickbot For Rebirth” where we provided an overview of the Trickbot infrastructure after its takedown. Check Point\nResearch (CPR) now sheds some light on the technical details of key Trickbot modules.\n\nTrickbot is a sophisticated and versatile malware with more than 20 modules that can be downloaded and executed on\ndemand. Such modules allow the execution of all kinds of malicious activities and pose great danger to the customers of\n60 high-profile financial (including cryptocurrency) and technology companies, mainly located in the United States. For a\nfull list of the targeted companies, see the Appendix. These brands are not the victims but their customers might be the\ntargets.\n\n_Figure 1 – Several companies whose customers are targeted by Trickbot_\n\n\n-----\n\nWe previously discussed the de centralized and effective Trickbot infrastructure, and now we see that the malware is very\nselective in how it chooses its targets. Various tricks – including anti-analysis – implemented inside the modules show the\nauthors’ highly technical background and explain why Trickbot remains a very prevalent malware family.\n\nBelow is a heat-map with the percentage of organizations that were affected by Trickbot in each country in 2021:\n\n_Figure 2 – Percentage of impacted organizations by Trickbot (the darker the color – the higher the impact)_\n\nBelow is a table that shows the percentage of organizations affected by Trickbot in each region:\n\n**Region** **Organizations affected** **Percentage**\n\nWorld 1 of every 45 2.2%\n\nAPAC 1 of every 30 3.3%\n\nLatin America 1 of every 47 2.1%\n\nEurope 1 of every 54 1.9%\n\nAfrica 1 of every 57 1.8%\n\nNorth America 1 of every 69 1.4%\n\nThere is a lot of attention currently going to the possible detention of TrickBot gang members. This investigation may have\nlong-term consequences for malware operators. We have decided to approach this issue differently: from the history of\nrise and fall of different malware operations, we know that although malware may become inactive, its technical aspects\nare often re-used in other successors.\n\nWe explore the technical details of key TrickBot modules and explain how they operate. No matter what awaits TrickBot\nbotnet, the thorough efforts put into the development of sophisticated TrickBot code will likely not be lost and the code\nwould find its usage in the future.\n\n\n-----\n\nIn this article, we focus on the three key modules below and describe Trickbot s anti analysis techniques:\n\ninjectDll\ntabDll\npwgrabc\n\n## injectDll: web-injects module\n\nWeb-injects cause a lot of harm to victims because such modules steal banking and credential data and could cause great\nfinancial damage via wire transfers. Add Trickbot’s cherry-picking of victims, and the menace becomes even more\ndangerous.\n\nThe injectDll module performs browser data injection, including JavaScript which targets customers of 60 high-profile\ncompanies in the financial (including cryptocurrency) and technology spheres.\n\nNot only does this module target high-profile organizations, it also features several anti-analysis techniques which we\ndescribe below.Before the takedown in October 2020, the injectDll module had a configuration built from two config types\n“sinj” and “dinj” (located at the end of the module):\n\n_Figure 3 – Configuration of the injectDLL module in 2020_\n\nNow web-injects come with the “winj” config from C2:\n\n_Figure 4 – Configuration of the injectDLL module in 2021_\n\nAnd they may look like this:\n\n_Figure 5 – Web-inject from the injectDLL module_\n\nWe can recognize a well-known web-injects format from Zeus (https://www.malware.unam.mx/en/content/zeus-analysisconfiguration-file-attacked-banking-internet). The payload which is injected to the page is minified (making the code size\nsmaller makes the code unreadable), obfuscated, and contains anti-deobfuscation techniques. These techniques are\nbased on JavaScript function string representation and its comparison with a hardcoded Regular Expression which should\nmatch the obfuscated function code. If the representation of the function doesn’t match the browser, the tab process\ncrashes (we describe the technique later in this article).\n\nIf all the checks passed successfully, the script constructs the URL of the second stage web-inject, in this case:\n```\nhttps://myca.adprimblox.fun/E4BFFED4E95C646B0EB2072FB593CA3D/dmaomzs1e5cl/6vpixf7ug8h5sli7gqwj/jquery3 5 1 min js\n\n```\n\n-----\n\nThis URL is built from %BOTID%, and two decoded constants. The C2 server strictly checks that the URL must end with\n“6vpixf7ug8h5sli7gqwj/jquery-3.5.1.min.js”. If the client tries to access any non-existent endpoint, the C2 server blocks\nnetwork packets of the researcher’s external IP for a period of time.\n\nThe name of the script disguises itself as a well-known legitimate JavaScript jQuery library. The “second” stage web-inject\nis heavier than the first stage and is only loaded from the targeted page (for example, Amazon or some banking’s page)\nso as not to reveal the C2 servers. Its payload is also minified and obfuscated, contains a few layers of anti-deobfuscation\ntechniques, and contains the code which grabs the victim’s keystrokes and web form submit actions.\n\nThe “second” stage of the web-inject, which targets a legitimate “https://sellercentral.amazon.com/ap/signin” site, collects\ninformation from the login action and saves the “ap_email” and “ap_password” fields for a C2 payload. The payload is sent\nto another C2 server, which is decrypted (as other strings in the script) using RC4:\n\n```\nhttps://akama.pocanomics.com/ws/v2/batch\n\n```\n\n_Figure 6 – Example of the prepared payloads_\n\nThe assembled HTTP request’s payload looks like this:\n\n```\nm=login&[email protected]&pass=pass&b=E4BFFED4E95C646B0EB2072FB593CA3C&q=sipdialm&v=8may&w=1\n\n```\n\nWhere the “login” and “pass” fields hold captured credentials, the “b” field holds %BOT_ID%, and the “v” (and probably\n“w”) field is the version. (Note – we are not sure about the purpose of these fields.)\n\nThis payload is then encrypted using XOR with an “ahejHKuD5H83UpkQgJK” key. The pseudocode of the payload\nencryption algorithm is shown below:\n\n```\nlet to_send = b64encode(xor_with(unescape(encodeURIComponent(payload)), ‘ahejHKuD5H83UpkQgJK’));\n\n```\n\n## Anti-Deobfuscation technique\n\nUsually a researcher tries to analyze minified and obfuscated JavaScript code using tools like JavaScript Beautifiers,\ndeobfuscators like de4js, and so on.\n\nAfter we applied these tools, we noticed that although the code became more readable, it also stopped working.\n\nIn the screenshot below, we’ve marked two places in red. The first one is a function which is very simple and performs\n“return ‘newState’. The second red mark expects the function to be obfuscated.\n\n\n-----\n\n_Figure 7 – Anti-deobfuscation tricks in the code_\n\nHere is the deobfuscated function representation (this means after calling the .toString() function):\n\n_Figure 8 – Deobfuscated function_\n\nAnd here is how it must look to pass the anti-deobfuscation trick:\n\n_Figure 9 – Obfuscated function_\n\n## Anti-Analysis Technique\n\nAnother anti-analysis technique we encountered is one that prevents a researcher from sending automated requests to\nCommand-and-Control servers to get fresh web-injects. If there is no “Referer” header in the request, the server will not\nanswer with a valid web-inject. Here is an example of a valid request:\n\n\n-----\n\nThe response looks like the one shown below:\n\n_Figure 11 – Response received from a Command-and-Control server of the injectDLL module_\n\n## tabDLL module\n\nThe purpose of this DLL is to grab the user’s credentials and spread the malware via network share. It grabs credentials in\n5 steps:\n\n1. Enables storing user credential information in the LSASS application.\n2. Injects the “Locker” module into the “explorer.exe” application.\n3. From the infected “explorer.exe”, forces the user to enter login credentials to the application and then locks the\n\nuser’s session.\n4. The credentials are now stored in the LSASS application memory.\n5. Grabs the credentials from the LSASS application memory using the mimikatz technique.\n\nThe credentials are then reported to C2. Lastly, it uses the EternalRomance exploit to spread via the SMBv1 network\nshare.\n\nThese steps are summarized in the diagram below:\n\n\n-----\n\n_Figure 12 – Steps to grab a user’s credentials as executed by the “tabDll” module_\n\nThe obfuscation level decreased when a botnet operator used a random key for string encryption algorithm. We\nencountered such a case with a low obfuscation level when the string “GetCurrentProcess” became easily readable:\n\n_Figure 13 – Low level of obfuscation_\n\nAnother example below:\n\n\n-----\n\n_Figure 14 – No key is used for the obfuscation_\n\nIn this case, no key is used for decryption. However, these cases remain rare throughout the modules and samples.\n\n## pwgrabc module\n\nThe pwgrabc is a credential stealer for various applications. This is the full list of targeted applications:\n\nChrome\nChromeBeta\nEdge\nEdgeBeta\nFirefox\nInternet Explorer\nOutlook\nFilezilla\nWinSCP\nVNC\nRDP\nPutty,\nTeamViewer\nPrecious\nGit\nOpenVPN\nOpenSSH\nKeePass\nAnyConnect\nRDCMan\n\n## Conclusion\n\nBased on our technical analysis, we can see that Trickbot authors have the skills to approach the malware development\nfrom a very low level and pay attention to small details. Trickbot attacks high-profile victims to steal the credentials and\nprovide its operators access to the portals with sensitive data where they can cause greater damage\n\n\n-----\n\nMeanwhile, from our previous research, we know that the operators behind the infrastructure are very experienced with\nmalware development on a high level as well.\n\nThe combination of these two factors has already led to more than 140,000 infected victims after the takedown, several 1\nplace rankings in top malware prevalence lists, and collaboration with Emotet – all within a year.\n\nTrickbot remains a dangerous threat that we will continue to monitor, along with other malware families.\n\n## Check Point Protections\n\n[Check Point Provides Zero-Day Protection across Its Network, Cloud, Users and Access Security Solutions. Whether](https://www.checkpoint.com/infinity-vision/zero-day-protection/)\nyou’re in the cloud, the data center, or both, Check Point’s Network Security solutions simplify your security without\nimpacting network performance, provide a unified approach for streamlined operations, and enable you to scale for\n[continued business growth. Quantum provides the best zero-day protection while reducing security overhead.](https://www.checkpoint.com/quantum/network-security-solutions/)\n\nCheck Point Harmony Network Protections:\n\nTrojan-Banker.Win32.TrickBot\n\nThreat Emulation protections:\n\nBanker.Win32.Trickbot.TC\n\nTrickbot.TC\n\nBotnet.Win32.Emotet.TC.*\n\nEmotet.TC.*\n\nTS_Worm.Win32.Emotet.TC.*\n\nTrojan.Win32.Emotet.TC.*\n\n## Appendix – The list of targeted companies (via web-injects)\n\n**Company** **Field**\n\nAmazon E-commerce\n\nAmericanExpress Credit Card Service\n\nAmeriTrade Financial Services\n\nAOL Online service provider\n\nAssociated Banc-Corp Bank Holding\n\nBancorpSouth Bank\n\nBank of Montreal Investment Banking\n\nBarclays Bank Delaware Bank\n\nBlockchain.com Cryptocurrency Financial Services\n\nCanadian Imperial Bank of Commerce Financial Services\n\nCapital One Bank Holding\n\nCard Center Direct Digital Banking\n\nCentennial Bank Bank Holding\n\n\nst\n\n\n-----\n\nChase Consumer Banking\n\nCiti Financial Services\n\nCitibank Digital Banking\n\nCitizens Financial Group Bank\n\nCoamerica Financial Services\n\nColumbia Bank Bank\n\nDesjardins Group Financial Services\n\nE-Trade Financial Services\n\nFidelity Financial Services\n\nFifth Third Bank\n\nFundsXpress IT Service Management\n\nGoogle Technology\n\nGoToMyCard Financial Services\n\nHawaiiUSA Federal Credit Union Credit Union\n\nHuntington Bancshares Bank Holding\n\nHuntington Bank Bank Holding\n\nInteractive Brokers Financial Services\n\nJPMorgan Chase Investment Banking\n\nKeyBank Bank\n\nLexisNexis Data mining\n\nM&T Bank Bank\n\nMicrosoft Technology\n\nNavy Federal Credit Union\n\npaypal Financial Technology\n\nPNC Bank Bank\n\nRBC Bank Bank\n\nRobinhood Stock Trading\n\nRoyal Bank of Canada Financial Services\n\nSchwab Financial Services\n\nScotiabank Canada Bank\n\nSunTrust Bank Bank Holding\n\nSynchrony Financial Services\n\nSynovus Financial Services\n\nT. Rowe Price Investment Management\n\n\n-----\n\nTD Bank Bank\n\nTD Commercial Banking Financial Services\n\nTIAA Insurance\n\nTruist Financial Bank Holding\n\nU.S. Bancorp Bank Holding\n\nUnionBank Commercial Banking\n\nUSAA Financial Services\n\nVanguard Investment Management\n\nWells Fargo Financial Services\n\nYahoo Technology\n\nZoomInfo Software as a service\n\n## IOCs\n```\nmyca.adprimblox.fun\nakama.pocanomics.com\n524A79E37F6B02741A7B6A429EBC2E33306068BDC55A00222B6C162F396E2736\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-02-16 - A Modern Ninja- Evasive Trickbot Attacks Customers of 60 High-Profile Companies.pdf"
    ],
    "report_names": [
        "2022-02-16 - A Modern Ninja- Evasive Trickbot Attacks Customers of 60 High-Profile Companies.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535580,
    "ts_updated_at": 1743041135,
    "ts_creation_date": 1653781820,
    "ts_modification_date": 1653781820,
    "files": {
        "pdf": "https://archive.orkl.eu/26c2dc16478c2d6f12d27c739ca741ff6f6638ad.pdf",
        "text": "https://archive.orkl.eu/26c2dc16478c2d6f12d27c739ca741ff6f6638ad.txt",
        "img": "https://archive.orkl.eu/26c2dc16478c2d6f12d27c739ca741ff6f6638ad.jpg"
    }
}