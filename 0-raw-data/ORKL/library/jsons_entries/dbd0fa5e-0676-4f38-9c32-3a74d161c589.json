{
    "id": "dbd0fa5e-0676-4f38-9c32-3a74d161c589",
    "created_at": "2023-01-12T15:07:28.437379Z",
    "updated_at": "2025-03-27T02:16:25.969442Z",
    "deleted_at": null,
    "sha1_hash": "294226c788d711b900ebfc91c4b2f7fec21f8044",
    "title": "2019-01-05 - Getting 'rid' of pre-installed Malware on my YellYouth Android Tablet",
    "authors": "",
    "file_creation_date": "2022-05-28T16:16:24Z",
    "file_modification_date": "2022-05-28T16:16:24Z",
    "file_size": 94931,
    "plain_text": "# ...stuff I do and things I like...\n\n**[mulliner.org/blog/blosxom.cgi/security/yellyouth_android_malware.html](https://www.mulliner.org/blog/blosxom.cgi/security/yellyouth_android_malware.html)**\n\n\n-----\n\nIn November I bought a cheap Android Tablet for a wall-mounted display (see this blog\npost: [Android InfoPanel). After a couple of days (or weeks?) suddenly some overlay](https://www.mulliner.org/blog/blosxom.cgi/projects/android_infopanel.html)\nads and warnings from Google Play about malicious apps appeared. I didn't have time\nto investigate so I just tried to close the apps and ads. This got more complicated since\nall of it was in Chinese. I ended up navigating the menu of what looked like a 3rd-party\napp store to uninstall an app named Retipuj that was flag by Google Play for ad-fraud.\nAll of this using Google Translate on my phone.\n\nI bought this Chinese Android tablet (yellyouth) for a project and it randomly\ninstalls apps in the background. Apps that are flagged by google play as \"adfraud\". The \"fun part\" was using google translate on my phone to navigate their\napp market app.\n\n[â€” Collin Mulliner (@collinrm) December 14, 2018](https://twitter.com/collinrm/status/1073659698270879748?ref_src=twsrc%5Etfw)\n\nThis solution worked for a couple of days. Returning back from my Holiday trip I was\ngreeted by overlay ads once again. Luckily I had some time on my hands to\ninvestigate. Here a short write-up.\n\nPart 1, observations and hoping for an easy way out:\n\nI found one app that I didn't install (com.hero.filter), I uninstalled it via adb\n_uninstall com.hero.filter. I tried Googling the package name but without success._\n\nRemoving the app didn't seem to do anything. Judging by the task bar there still\nseem to be a number of apps running but checking via Settings/Apps and on the\nfilesystem (/data/apps) no apps are installed. Every now and then a pop-up\nappears that looks like a 3rd party market trying to download and install apps.\nInstallation is blocked by Google Play (verified apps I assume).\n\nPart 2, looking at processes:\n\nI found two interesting looking processes net.atlas.utopia and\n_android.hb.uys.pbuild looking at the SeLinux context they seem to be platform_\napps (u:r:platform_app:s0). These could be candidates (spoiler - they are). Using\n_pm list packages -f I determined that net.atlas.utopia is install in /system/priv-_\napp/Kyz2203 with the data in /data/data/net.atlas.utopia.\n\npm list packages -f (only showing some interesting packages):\n```\npackage:/data/app/com.hero.filter-1/base.apk=com.hero.filter\npackage:/system/app/AutoDialer/AutoDialer.apk=com.example\npackage:/system/priv-app/Kyz2203/Kyz2203.apk=net.atlas.utopia\npackage:/system/priv-app/reanimation/reanimation.apk=android.hb.uys.pbuild\n\n```\n\n-----\n\nPart 3, a quick peak into net.atlas.utopia:\n\nPermissions: this app has like every permission you can think off including install\nand delete packages, send SMS, read and write any setting and file. Further it\nhas a number of app permissions that correspond to lenovo, oppo, huawei, and\nhtc devices.\n\nThe app registers intent filters for a number of events: boot up, time zone\nchange, packages install/remove, outgoing calls, etc. It basically monitors\neverything that is going on on the device. Pretty shitty.\n\nThe data directory also contained a dex file with the name whatsappui1.dex. A\nquick Google search on whatsappui1 has one hit on team cymru's hash list:\n[whatsappui1 with not much details but identify the file as being associated with](https://totalhash.cymru.com/analysis/?d8087bc3ad65590fc7eb1fdcc7a995871405e80d)\nad-based malware.\n\nThe most interesting thing I found in this app is the use of a 3rd party library\n[called DroidPlugin. DroidPlugin is a plugin framework for Android that allows to](https://github.com/DroidPluginTeam/DroidPlugin)\nrun any third-party apk without installation, modification or repackage. Seems like\nthe perfect tool for malware distribution.\n\nPart 4, a quick peak into android.hb.uys.pbuild:\n\nPermissions are very similar to the net.atlas.utopia including the permissions\ncorresponding to specific device manufacturers.\n\nThe manifest contains traces of ad related things. The library directory contains\nlibiohook.so. The library contains symbols from Cydia Substrate. The library\nname appears in various search results that indicate ad related malware.\n\nThe asset directory contains a certificate ky_dsa_public.crt with no interesting\nissuer. jar file that contains a dex file and two .png files that contain ascii/text.\n\nPart 5, getting rid of it all:\n\nHow do we get rid of pre-installed software? The system partition is read-only so\nwe can't uninstall it! The best idea, that does not involve rooting and flashing new\nfirmware, is disabling the package using the package manager (pm disable\nnet.atlas.utopia) this however requires system privileges. You don't have system\nprivileges without rooting. You can disable apps via Settings but you can only\ndisable them if they are in the list. The ones we want to disable are not in the list.\n\n\n-----\n\nHow do we get system? The tablet still runs a 3.10.72 kernel so it might be\n[vulnerable to dirtycow. I checked using the tools from timwr and yes it is](https://github.com/timwr/CVE-2016-5195)\nvulnerable to dirtycow. Using my modified version of run-as as shown in my\nSafetyNet Talk we can become the system user and disable any package we\nwant by running: pm disable PACKAGE.\n\nHere the list of packages I disabled, so far no APKs are getting installed and I\nhaven't seen any more ads.\n\npm list packages -d\n```\npackage:com.mediatek.schpwronoff\npackage:android.hb.uys.pbuild\npackage:com.mediatek.ygps\npackage:com.android.htmlviewer\npackage:com.android.browser\npackage:com.hero.filter\npackage:com.example\npackage:com.svox.pico\npackage:com.opera.max.global\npackage:com.android.dreams.phototable\npackage:net.atlas.utopia\npackage:com.mediatek.weather\npackage:com.opera.max.loader\npackage:com.qihoo.appstore\npackage:com.fw.upgrade.sysoper\npackage:com.android.vpndialogs\n\n```\nPart 7, Dirtycow trickery:\n\n[As described on my slides you can modify run-as.c from timwr to become any](https://www.mulliner.org/collin/publications/InsideAndroidsSafetyNetAttestation_mulliner44con.pdf#page=74)\nUID with almost any SELinux context (depending on the device's SeLinux\npolicy!). For our purpose we can become any UID and context that we require.\nBelow some notes on how this works.\n\nDirtycow lets you overwrite any file that is how you replace /system/bin/run-as\nwith your own binary. The binary cannot be bigger then the one you are\noverwriting. This might be a problem when you have a very very small run-as (9k\nin my case).\n```\n1|shell@KT107:/data/local/tmp $ ls -al /system/bin/run-as           \n-rwsr-s--- root   shell    9444 2018-09-27 03:44 run-as\n\n```\nThe workaround I took was not using ndk-build to build run-as.c and instead manually\nrunning arm gcc. This will reduce the binary size due to discarding complier flags used\nby the ndk. Another solution would be to just load a shared library from run-as to keep\nthe binary size small. Once you have my version of run-as you can become (almost)\nany user.\n\n\n-----\n\n```\nshell@KT107:/data/local/tmp $ run as 1000 u:r:platform_app:s0\nshell@KT107:/data/local/tmp $ id\nuid=1000(system) gid=1000(system)\ngroups=1003(graphics),1004(input),1007(log),1011(adb),1015(sdcard_rw),1028(sdcard\n context=u:r:platform_app:s0\n\n```\nSystem (UID 1000) allows you to poke around /data/app/* and /data/data. If you want\nto explore /data/data/APP you need to assume the UID and context of that app.\n```\nshell@KT107:/data/data $ ls -al\ndrwxr-x--x u0_a13  u0_a13      u:object_r:app_data_file:s0\nnet.atlas.utopia\nrun-as 10013 u:r:platform_app:s0\nshell@KT107:/data/data $ id\nuid=10013(u0_a13) gid=10013(u0_a13)\ngroups=1003(graphics),1004(input),1007(log),1011(adb),1015(sdcard_rw),1028(sdcard\n context=u:r:platform_app:s0\nshell@KT107:/data/data/net.atlas.utopia $ ls -al\ndrwx------ u0_a13  u0_a13      2017-12-31 19:00 Plugin\ndrwxrwx--x u0_a13  u0_a13      2017-12-31 19:00 app_dex\ndrwxrwx--x u0_a13  u0_a13      2017-12-31 19:00 cache\ndrwxrwx--x u0_a13  u0_a13      2017-12-31 19:00 databases\ndrwx------ u0_a13  u0_a13      2017-12-31 19:00 fankingbox\nlrwxrwxrwx install install      2015-12-31 19:00 lib -> /data/applib/net.atlas.utopia\ndrwxrwx--x u0_a13  u0_a13      2019-01-03 15:56 shared_prefs\n-rw------- u0_a13  u0_a13    9572 2019-01-03 15:54 whatsappui1.dex\n\n```\nBelow is my patch for run-as.c. My version sets the UID from the first argument and the\nSELinux context from the second argument.\n\n\n-----\n\n```\n  run as crm.c 2019 01 03 17:54:41.153471054 0500\n+++ run-as.c 2019-01-03 17:58:39.378353437 -0500\n@@ -28,6 +28,8 @@\n {\n     LOGV(\"uid %s %d\", argv[0], getuid());\n+ int duid = atoi(argv[1]);\n+\n     if (setresgid(0, 0, 0) || setresuid(0, 0, 0)) {\n          LOGV(\"setresgid/setresuid failed\");\n     }\n@@ -56,7 +58,7 @@\n                   LOGV(\"dlsym setcon error %s\", error);\n              } else {\n                   setcon_t * setcon_p = (setcon_t*)setcon;\n- ret = (*setcon_p)(\"u:r:shell:s0\");\n+ ret = (*setcon_p)(argv[2]);\n                   ret = (*getcon_p)(&secontext);\n                   LOGV(\"context %d %s\", ret, secontext);\n              }\n@@ -66,6 +68,12 @@\n          LOGV(\"no selinux?\");\n     }\n+ if (setresgid(duid, duid, duid) || setresuid(duid, duid, duid)) {\n+ LOGV(\"setresgid/setresuid failed\");\n+ }\n+ LOGV(\"uid %d\", getuid());\n+\n     system(\"/system/bin/sh -i\");\n-}\n\\ No newline at end of file\n+}\n+\n\n```\nConclusions:\n\nOverall I would have preferred to not get pre-installed malware on my Android\nTablet as I would rather have spent my time on my InfoPanel app or on other\nprojects. However it was impossible for me to ignore this issue and simply buy a\ndifferent tablet. Tracking down the malware still was kinda fun. It was the first\ntime I experienced the issue of pre-installed malware first hand. I' also fairly\nhappy that I didn't have to modify the firmware since this would have cost way\nmore time. The most interesting thing I found was definitely the DroidPlugin\nproject that allows running APKs without installing them. I wish I had more time to\nreverse engineer all the different apps and how they work together. I uploaded a\nzip file containing most components I talked about in this blog post here:\n[yellyouth.zip.](https://www.mulliner.org/android/feed/yellyouth.zip)\n\n\n-----\n\nI hope I finally disabled all of the components and have an ad free device.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-01-05 - Getting 'rid' of pre-installed Malware on my YellYouth Android Tablet.pdf"
    ],
    "report_names": [
        "2019-01-05 - Getting 'rid' of pre-installed Malware on my YellYouth Android Tablet.pdf"
    ],
    "threat_actors": [
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673536048,
    "ts_updated_at": 1743041785,
    "ts_creation_date": 1653754584,
    "ts_modification_date": 1653754584,
    "files": {
        "pdf": "https://archive.orkl.eu/294226c788d711b900ebfc91c4b2f7fec21f8044.pdf",
        "text": "https://archive.orkl.eu/294226c788d711b900ebfc91c4b2f7fec21f8044.txt",
        "img": "https://archive.orkl.eu/294226c788d711b900ebfc91c4b2f7fec21f8044.jpg"
    }
}