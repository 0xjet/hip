{
    "id": "aaf5777c-3629-4fab-a5fd-900c0f7676f4",
    "created_at": "2023-01-12T15:05:14.78188Z",
    "updated_at": "2025-03-27T02:08:41.309818Z",
    "deleted_at": null,
    "sha1_hash": "6c9d11d54e38691591de52ddd96f3fc12b239b7a",
    "title": "2022-08-07 - Vulnerabilities In E-Commerce Solutions - Hunting On Big Apples",
    "authors": "",
    "file_creation_date": "2022-09-01T10:23:25Z",
    "file_modification_date": "2022-09-01T10:23:25Z",
    "file_size": 1959067,
    "plain_text": "# Vulnerabilities in E-Commerce Solutions - Hunting on Big Apples\n\n**[resecurity.com/blog/article/vulnerabilities-in-e-commerce-solutions-hunting-on-big-apples](https://resecurity.com/blog/article/vulnerabilities-in-e-commerce-solutions-hunting-on-big-apples)**\n\n[Back](https://resecurity.com/blog)\nVulnerability Intelligence\n\n7 Aug 2022\nWEB-appication security, vulnerability, bugs, payment systems\n\n\n-----\n\nResecurity is working on numerous penetration testing and red teaming exercises for\nmajor Fortune 500, the security used by web applications still remains one of the key\ncomponents which often leaves the door wide open for attackers.\n\nThe exploitation of certain vulnerabilities by experienced bad actors may lead to fatal\nevents which leads to a data breaches.\n\nSuch issues can be especially meaningful for online-services and e-commerce whom work\nwith customers globally, this is also what creates a compliance risk.\n\nEven big technology companies are affected by the insecurity of web applications and\ninvest in timely identification of vulnerabilities to mitigate potential risks.\n\nIn this research post, Ahmad Halabi will share some of the recent vulnerability findings\nwhich have been timely reported to Apple Security for further patching. Similar issues have\nbeen identified on multiple projects providing online-shopping functions and e-commerce.\n\n## The Target\n\nWhen you come across a big Asset like Apple or Microsoft, you have to know from where\nto start and what to check. For us, we were looking for a target that is considered an\nimportant asset to Apple and contains valuable private information so the bounty will be\nworthy.\n\n[For example: https://applepaysupplies.com/](https://applepaysupplies.com/)\n\nhttps://applepaysupplies.com/\n\nApple Pay Supplies: allows you to order Apple related Kits such as `Apple Pay Decals Kit`\nand `Apple Pay Signage Kit`.\n\n\n-----\n\n## Studying The Application Structure\n\nWe began with checking the target website as a normal user who wants to order a kit. By\nturning on Burp Suite, we were able to intercept all the traffic of this website and\nproceeded with an order by navigating to `Place Order`.\n\nAfter that we filled the Shipping Information and submitted the order.\n\nThe shipping Information included: Full name, Company, Address information (Country,\nCity, Street, Zip code) and Phone Number.\n\nThere's a track order feature so after submitting your order you're able to track it.\n\nTo track the order, we have to put our email address and the order number that gets\nassigned once the order is created.\n\nWe noticed here two interesting variables that required investigation, `Order Number and`\n```\nEmail .\n\n## Identifying The Vulnerability - Chaining IDOR With Rate Limit Discloses Shipping Information.\n\n```\n**_1 Step:st_**\n\nAfter hitting the `Submit button to track the Order Status, the page showed my Order`\ndetails, we noticed this URL in the browser tab:\n\nhttps://applepaysupplies.com/trackorder?\norder_id=APP1162306&email=my.test.email@gmail.com&language_id=1\n\nTracking Your Order\n\n\n**_2nd Step:_**\n\nHere we thought about an IDOR vulnerability chained with a Rate Limit mechanism to\nguess the `order_id of an Apple user, we already know the users email ID.`\n\n\n-----\n\nWe start analyzing the `order_id value:` `APP1162306 by generating multiple Orders and`\ncomparing their `order_id values.`\n```\n   APP characters are fixed.\n\n```\nWe have 7 numbers after `APP which can be brute forced.`\n\n**_3 Step:rd_**\n\nWe then navigated to the target URL https://applepaysupplies.com/trackorder?\norder_id=APP1162306&email=my.test.email@gmail.com&language_id=1 but the\nsurprising thing was how it displayed a blank page rather than the Order Details that were\nshown after hitting the `Submit button.`\n\nBlank Page\n\nWe were not able to perform the attack by hitting `Submit button nor were we able to`\nintercept the request as the Application was using a front-end fetching mechanism via a\nJavaScript thus no backend request was related to the target URL. So, we needed to\nanalyze the JavaScript Files / Burp History and check for an API to see how the data is\nbeing fetched and retrieved.\n\n\n**_4 Step:th_**\n\nAfter some Recon and Analysis, we found an API that interacts with the backend,\nit fetches the Order Information.\n\nAlternative Request: https://applepaysupplies.com/api/Home/GetOrderStatus?\norderno=APP1162306&email=my.test.email@gmail.com\n\nThis API Request is responsible for Fetching the Order Status Details.\n\nGet Order Status Details\n\n**_5 Step:th_**\n\n\n-----\n\nNow it was easy to proceed, we can now start generating 7 numbers wordlist to brute force\nthe Order number in a numerical order to get the Valid Order Status Details.\n\nSetting up Attack in Intruder\n\nLuckily there was no Rate Limit Protection in place so we could brute force the Order\nNumber of any valid Apple User, we then disclose their Shipping Address Information.\n\nFound Valid orderno and disclosed Shipping\n\nInformation\n\n## Reporting\n\nWe made a detailed PoC and Reported this Vulnerability to Apple.\nAfter a while, Apple Fixed the Vulnerability and Requested us to check the Fix.\n\n## Checking The Fix\n\nApple fixed the Vulnerability by removing the API call responsible for fetching the Order\nStatus Details (/api/Home/GetOrderStatus). So now users can only use the main\nFunctionality \"Track Order\".\n\nRemoving /api/Home/GetOrderStatus\n\n\n-----\n\nInstead of the removed API endpoint, they used the Track Order request\n(https://applepaysupplies.com/trackorder?\norder_id=APP1162306&email=my.test.email@gmail.com) to fetch the status details.\n\nHowever they enhanced the Track Order Functionality. They used CryptoJS Library to\nencrypt the values since now they are being sent and fetched from the Client Side.\n\n## Bypassing The Fix\n\n**1 Step:st**\n\nWe checked the website again. we already knew the main endpoint to track orders\n[(https://applepaysupplies.com/trackorder) that accepts GET request with the following](https://applepaysupplies.com/trackorder%60)\nparameters: `order_id which stands for the Order Number and` `email .`\n\n\n**2nd Step:**\n\nWe start by analyzing the Request.\n\nUsing Burp Suite, we tried sending a GET request to the target URL:\n\nhttps://applepaysupplies.com/trackorder?\norder_id=APP1162306&email=my.test.email@gmail.com\n\nThis time the response was not showing the Order Status nor did it display the Shipping\ndetails of this valid order.\n\nNo Order Status Details in the Response\n\nThis was protection implemented by Apple when they Fixed the old bug. Now,\nwe're unable to use Intruder to brute force the `Order Number` as before with the previous\nbug and the API Endpoint.\n\n**3 Step:rd**\n\n\n-----\n\nNow we analyzed the Client Side Behavior.\n\nWe opened the request (https://applepaysupplies.com/trackorder?\norder_id=APP1162306&email=my.test.email@gmail.com) in the browser.\n\nOnce opened we noticed a delay while showing the order details. It took 1–2 seconds after\nloading to display the order details.\n\nThis behavior explains why we were not able to see the shipping details on the request\nlevel in Burp Suite.\n\n**4 Step:th**\n\nNext, we started analyzing the JavaScript Files.\n\nAfter checking JavaScript files, we could see how the application was using a Library\ncalled `CryptoJS to encrypt the` `Email and the` `Order Number while requesting an`\norder status. By using this technique, Apple has made it difficult to brute force the Order\nNumber.\n\nWe analyzed how the Encryption is implemented within the Application, and with the help\n[of our Friend Max (h1 Profile), We wrote a script to encrypt the required values using the](https://hackerone.com/executor)\nCryptoJS library as the Application did, we could then brute force the Order Number again.\n\nScript to Encrypt the values with CryptoJS\n\nand Brute Force the Order Number\n\n\n-----\n\nWith the advantage of the absence of Rate Limit protection against this GET endpoint, we\ncould brute force the Order Number successfully and once again disclose the Shipping\nInformation.\n\nBrute Force Succeeded and Disclosure of\n\nShipping Information\n\n## Reporting\n\nApple requested us to send the Bypass Details in a New Report since the Old Fix is\nSuccessful and the Vulnerability is now found in a different Endpoint.\nApple confirmed the Vulnerability.\nApple Took some time to implement a new Fix.\n\n## Confirming The Fix\n\nApple kept the Crypto JS Library in place, They just enhanced and increased the\nEncryption Level to make it even harder to break.\n\nApple didn’t implement a Rate Limit Protection, but they Increased the Length of the Order\nNumber.\n\nBefore, the Order Number was made up of: APP + 7 numbers.\n\nNow, the Order Number is made up of: APP + 28 Characters & Numbers.\n\nExample: `APPF68CAA9D1F174F91B61ECC7568D7`\n\nBrute Forcing 28 Random Characters is unfeasible even if you were able to decrypt their\nEncryption.\n\nWe can now consider the vulnerability is fixed and Reported back to Them.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-08-07 - Vulnerabilities In E-Commerce Solutions - Hunting On Big Apples.pdf"
    ],
    "report_names": [
        "2022-08-07 - Vulnerabilities In E-Commerce Solutions - Hunting On Big Apples.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535914,
    "ts_updated_at": 1743041321,
    "ts_creation_date": 1662027805,
    "ts_modification_date": 1662027805,
    "files": {
        "pdf": "https://archive.orkl.eu/6c9d11d54e38691591de52ddd96f3fc12b239b7a.pdf",
        "text": "https://archive.orkl.eu/6c9d11d54e38691591de52ddd96f3fc12b239b7a.txt",
        "img": "https://archive.orkl.eu/6c9d11d54e38691591de52ddd96f3fc12b239b7a.jpg"
    }
}