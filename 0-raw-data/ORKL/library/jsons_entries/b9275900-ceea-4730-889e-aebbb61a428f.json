{
    "id": "b9275900-ceea-4730-889e-aebbb61a428f",
    "created_at": "2022-10-25T16:48:18.082391Z",
    "updated_at": "2025-03-27T02:17:15.029765Z",
    "deleted_at": null,
    "sha1_hash": "6414a4f78cf5ce842d11dca9429ebafc9da64a18",
    "title": "",
    "authors": "",
    "file_creation_date": "0001-01-01T00:00:00Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 1155623,
    "plain_text": "# How to perform long term monitoring of careless threat actors\n\n###### Daniel Lunghi (@thehellu)\n\n\n-----\n\n## Outline\n\n### • Introduction\n • Malware analysis and classification\n • Pivoting on the samples\n • Pivoting on the infrastructure\n • Telemetry and links with known threat actors\n • Bonus\n • Conclusion\n\n\n-----\n\n## Introduction\n\n\n-----\n\n## Introduction\n\n### • This talk focuses on the methodology of long term threat\n actor monitoring\n • Examples are based on a Trend Micro investigation published\n on February 18, 2020\n\n###### Operation DRBControl - Uncovering a Cyberespionage Campaign Targeting Gambling Companies in Southeast Asia\n\n### • Goals:\n\n#### • Establish Tactics, Technics and Procedures (TTP) of a threat actor\n • Help incident response/detection\n • Get as much context as possible\n\n\n-----\n\n## Introduction\n\n### • Investigation started on July 2019, after Talent-Jump\n technologies brought interesting samples to us\n\n • The samples were found in a gambling company in\n Philippines\n\n • No obvious link to a known threat actor\n\n\n-----\n\n# Malware analysis and classification\n\n\n-----\n\n## Malware analysis and classification\n\n### • Goals:\n\n#### • Extract IOCs (domain names, IP addresses, file names, registry keys…)\n • List the malware features\n • Find the malware family, if known\n\n### • How:\n\n#### • Pick your favorite disassembler\n • Classification: Yara, TLSH, search\n engines…\n\n\n-----\n\n## Malware analysis and classification\n\n### • Initial triaging result:\n\n#### • 4 different families, of which 3 are unknown\n • Only known family was found in October 2019\n\n### • Let’s focus on “Type 1” malware, but the methodology is the\n same for other families\n\n\n-----\n\n## Malware analysis and classification\n\n### • Malware is packed and uses DLL side-loading\n\n\n-----\n\n## Malware analysis and classification\n\n### • Malware is written using C++, it support plugins, class names\n can be extracted from RTTI information and are self- explanatory\n\n#### • CHPKeylog\n • CHPScreen\n • CHPAvi\n • CHPCmd\n • CHPExplorer\n • CHPRegedit\n\n\n-----\n\n## Malware analysis and classification\n\n### • Samples contain a version number\n\n##### Version number Compilation date\n\n 1.0 May 2019\n\n 8.0 July 2019\n\n 9.0 August 2019\n\n### • Shows fast development pace of the threat actor\n\n|Version number|Compilation date|\n|---|---|\n|1.0|May 2019|\n|8.0|July 2019|\n|9.0|August 2019|\n\n\n-----\n\n# Pivoting from samples\n\n\n-----\n\n## Pivoting from samples\n\n### • “Easy” pivoting : unique strings\n\n#### • Query on search engine (sandbox results)\n • “content” modifier on VirusTotal or similar malware repositories\n • Yara rules for more complex queries\n • RetroHunt for past malwares\n###  Fail, malware is packed\n\n\n-----\n\n## Pivoting from samples\n\n### • Algorithm for network communication encryption uses a\n substitution table of 256 bytes\n • 256 bytes hardcoded in a specific order\n • Yara rule written, alerting added and RetroHunt launched  New samples found, all relevant\n\n\n-----\n\n## Pivoting from samples\n\n### • On March 23th, an alert matching this substitution table is\n raised\n • The related sample is not a malware  The Yara rule is prone to false positives\n\n\n-----\n\n## Pivoting from samples\n\n### • We found source code posted on February 27, 2015 on\n CodeProject.com matching the assembly code\n\n  Don’t discard possibility of code reuse, even with few\n\n\n-----\n\n## Pivoting from samples\n\n### • Metadata in different file formats is also useful\n\n#### • VERSIONINFO structure from the PE format contains information on\n filename, description, version, etc\n • Documents contain metadata (title, author name, …)\n\n### • In this particular investigation, we could find several related\n samples by leveraging metadata\n\n#### • 2 malware samples had “HaoZipUpdate” as original filename\n • 4 malicious documents had “Dell_20170514745” as author\n\n\n-----\n\n## Pivoting from samples\n\n#### • Legitimate HaoZipUpdate was patched\n\n\n-----\n\n## Pivoting from samples\n\n### • Mutexes might be used for correlation\n\n#### • SFX archive dropping Trochilus malware named “diskshawin.exe”\n uses mutexes with unique names (“cc5d64b344700e403e2sse”, “cc5d6b4700e403e2sse” and “cc5d6b4700032eSS”)\n • A BbsRAT sample named “diskwinshadow.exe” found in a public\n sandbox report also uses these mutexes\n • That BbsRAT sample has “bot.googlerenewals.net” as C&C, which is\n listed in a report from ClearSky on Winnti threat actor\n\n\n-----\n\n# Pivoting from infrastructure\n\n\n-----\n\n## Pivoting from infrastructure\n\n### • Passive DNS : database of historical links between IP\n addresses and domain names\n • Some threat actors reuse their servers or domain names for\n multiple campaigns\n • Needs to be handled with caution, it is prone to false\n positives and false negatives\n\n\n-----\n\n## Pivoting from infrastructure\n\n### • IP addresses history for domain name\n update.mircosoftdefender.com as seen on PassiveTotal\n\n\n-----\n\n## Pivoting from infrastructure\n\n### • Truncated list of domain names history for IP address\n 43.228.126.172 as seen on PassiveTotal\n\n\n-----\n\n## Pivoting from infrastructure\n\n### • Some threat actors register their domain names in bulk  Creation Date timestamp for those domains is close\n • mircosoftdefender.com created on 2018-08-09 at 08:40:27\n • By filtering on registrar and name server, we find 3 additional\n domains created on same date between 08:40 and 08:41\n\n#### • dinohonevice.com\n • luxespiremag.com\n • googleusermessage.com\n\n\n-----\n\n## Pivoting from infrastructure\n\n### • Many more techniques\n\n#### • TLS certificate tracking\n • Correlation through metadata (web server version, hosting provider,\n HTTP headers …)\n • Search of domain names/IP addresses on public sandboxes results\n • HTTP static content tracking\n\n\n-----\n\n## Pivoting\n\n### • All those techniques needs to be reiterated when new IOCs\n are found\n\n#### Domain name\n\n Sample IP address\n\n\n-----\n\n# Telemetry and further links\n\n\n-----\n\n## Telemetry\n\n### • As an AV, we have telemetry from our customers (if enabled)\n\n • Spear-phishing emails sent on May 2019\n\n#### • Different company, also in South-East Asia\n • Also in gambling/betting industry\n###  Confirmation of the targeted industry and location\n\n\n-----\n\n## Links with known threat actors\n\n### • Links with Winnti\n\n#### • Shared mutexes, which means probably code sharing for a dropper\n • We noticed a binary being downloaded from an IP address by the\n threat actor: Passive DNS for that IP address showed domains related to Winnti\n\n### • Links with EmissaryPanda/LuckyMouse\n\n#### • We found a sample from the HyperBro family, which is used\n exclusively by this threat actor\n\n\n-----\n\n# Using malware features to our advantage\n\n\n-----\n\n## Using malware features to our advantage\n\n### • Type 1 malware has a secondary C&C channel\n\n\n-----\n\n## Using malware features to our advantage\n\n### • To read and write to the repository, the malware uses a\n hardcoded API key\n\n\n-----\n\n## Using malware features to our advantage\n\n### • “bin.asc” is a new malware family using Dropbox as C&C\n (analysis is available in our paper)\n • 142 different directories, of which 129 contain a “bin.asc” file\n • ~50 post-exploitation tools found in the repository\n\n#### • Mimikatz, Quarks PwDump\n • Nbtscan\n • Privilege escalation tools\n • UAC bypass\n\n\n-----\n\n## Using malware features to our advantage\n\n\n-----\n\n## Using malware features to our advantage\n\n### • On March 2020, we noticed a new campaign using Type 1\n malware family\n • After extracting Dropbox API key, we noticed permissions\n had been modified\n • Token was not allowed to list directories  Threat actor reacted to our publication\n\n\n-----\n\n# Conclusion\n\n\n-----\n\n## Conclusion\n\n### • Started from ~20 samples of 4 different malware families, 5\n\n domain names and 3 IP addresses\n\n • After the investigation:\n\n\n\n#### • 8 different malware families\n\n • 19 domain names, 9 IP addresses\n\n • Tens of different samples\n\n • Infection vector found\n\n\n\n#### • List of post exploitation tools\n\n • Victimology confirmed\n\n • Links with two known threat actors\n\n\n-----\n\n## Conclusion\n\n### • Threat intelligence enrich knowledge of a threat actor\n\n • It needs access to big amount of data\n\n • It requires diverse skills\n\n • Each security vendor has its own perspective of the attack\n  Collaboration is welcome\n\n\n-----\n\n## Acknowledgements\n\n### • Cédric Pernet and Kenney Lu, my dear colleagues\n\n • Our boss Ziv for giving us enough time to dig\n\n • Researchers at Talent-Jump technologies for sharing samples\n\n • Bernard Pivot\n\n\n-----\n\nThreats detected and blocked globally by\nTrend Micro in 2018. Created with real data\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        }
    ],
    "references": [
        "https://www.sstic.org/media/SSTIC2020/SSTIC-actes/pivoter_tel_bernard_ou_comment_monitorer_des_attaq/SSTIC2020-Slides-pivoter_tel_bernard_ou_comment_monitorer_des_attaquants_ngligents-lunghi.pdf"
    ],
    "report_names": [
        "SSTIC2020-Slides-pivoter_tel_bernard_ou_comment_monitorer_des_attaquants_ngligents-lunghi.pdf"
    ],
    "threat_actors": [
        {
            "id": "e3492534-85a6-4c87-a754-5ae4a56d7c8c",
            "created_at": "2022-10-25T15:50:23.819113Z",
            "updated_at": "2025-03-27T02:00:55.552554Z",
            "deleted_at": null,
            "main_name": "Threat Group-3390",
            "aliases": [
                "Threat Group-3390",
                "Earth Smilodon",
                "TG-3390",
                "Emissary Panda",
                "BRONZE UNION",
                "APT27",
                "Iron Tiger",
                "LuckyMouse"
            ],
            "source_name": "MITRE:Threat Group-3390",
            "tools": [
                "Systeminfo",
                "gsecdump",
                "PlugX",
                "ASPXSpy",
                "Cobalt Strike",
                "Mimikatz",
                "Impacket",
                "gh0st RAT",
                "certutil",
                "China Chopper",
                "HTTPBrowser",
                "Tasklist",
                "netstat",
                "SysUpdate",
                "HyperBro",
                "ZxShell",
                "RCSession",
                "ipconfig",
                "Clambling",
                "pwdump",
                "NBTscan",
                "Pandora",
                "Windows Credential Editor"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "4c68ccd0-caba-4189-9ead-86ac4c2d9b70",
            "created_at": "2024-05-01T02:03:07.930196Z",
            "updated_at": "2025-03-27T02:05:17.251237Z",
            "deleted_at": null,
            "main_name": "BRONZE ATLAS",
            "aliases": [
                "Axiom",
                "BARIUM ",
                "Blackfly ",
                "CTG-2633",
                "GREF",
                "Group 72 ",
                "Red Kelpie ",
                "TG-2633 ",
                "Wicked Panda ",
                "Winnti",
                "APT41 "
            ],
            "source_name": "Secureworks:BRONZE ATLAS",
            "tools": [
                " CCleaner v5.33 backdoor",
                " ChinaChopper",
                " Cobalt Strike",
                " Dicey MSDN",
                " ForkPlayground",
                " HUC Proxy Malware (Htran)",
                " Mimikatz",
                " PipeMon",
                " PlugX",
                " PortReuse",
                " Powershell Empire",
                " RCMD",
                " RbDoor",
                " SPEEDBOAT",
                " ShadowPad",
                " Sidewalk",
                " Speculoos",
                " TeamViewer",
                " Winnkit",
                " Winnti",
                " reg save",
                " vssadmin",
                "Acehash"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "c63ab035-f9f2-4723-959b-97a7b98b5942",
            "created_at": "2023-01-06T13:46:38.298354Z",
            "updated_at": "2025-03-27T02:00:02.798255Z",
            "deleted_at": null,
            "main_name": "APT27",
            "aliases": [
                "TG-3390",
                "EMISSARY PANDA",
                "TEMP.Hippo",
                "Budworm",
                "Group 35",
                "BRONZE UNION",
                "Lucky Mouse",
                "Iron Taurus",
                "GreedyTaotie",
                "Red Phoenix",
                "ZipToken",
                "Iron Tiger",
                "G0027",
                "Earth Smilodon"
            ],
            "source_name": "MISPGALAXY:APT27",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "5c13338b-eaed-429a-9437-f5015aa98276",
            "created_at": "2022-10-25T16:07:23.582715Z",
            "updated_at": "2025-03-27T02:02:09.875151Z",
            "deleted_at": null,
            "main_name": "Emissary Panda",
            "aliases": [
                "APT 27",
                "ATK 15",
                "Bronze Union",
                "Budworm",
                "Earth Smilodon",
                "Emissary Panda",
                "Group 35",
                "Iron Taurus",
                "Iron Tiger",
                "LuckyMouse",
                "Operation DRBControl",
                "Operation Iron Tiger",
                "Operation PZChao",
                "Operation SpoiledLegacy",
                "Operation StealthyTrident",
                "Red Phoenix",
                "TEMP.Hippo",
                "TG-3390",
                "ZipToken"
            ],
            "source_name": "ETDA:Emissary Panda",
            "tools": [
                "ASPXSpy",
                "ASPXTool",
                "Agent.dhwf",
                "AngryRebel",
                "Antak",
                "CHINACHOPPER",
                "China Chopper",
                "Destroy RAT",
                "DestroyRAT",
                "FOCUSFJORD",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "HTTPBrowser",
                "HTran",
                "HUC Packet Transmit Tool",
                "HighShell",
                "HttpBrowser RAT",
                "HttpDump",
                "HyperBro",
                "HyperSSL",
                "HyperShell",
                "Kaba",
                "Korplug",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Mimikatz",
                "Moudour",
                "Mydoor",
                "Nishang",
                "OwaAuth",
                "PCRat",
                "PlugX",
                "ProcDump",
                "PsExec",
                "RedDelta",
                "SEASHARPEE",
                "Sensocode",
                "SinoChopper",
                "Sogu",
                "SysUpdate",
                "TIGERPLUG",
                "TVT",
                "Thoper",
                "Token Control",
                "TokenControl",
                "TwoFace",
                "WCE",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "Xamtrav",
                "ZXShell",
                "gsecdump",
                "luckyowa"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "e254cf33-e7f5-407b-a8a1-1a856a9f1c71",
            "created_at": "2025-01-21T02:00:03.599871Z",
            "updated_at": "2025-03-27T02:00:03.480307Z",
            "deleted_at": null,
            "main_name": "Operation DRBControl",
            "aliases": [],
            "source_name": "MISPGALAXY:Operation DRBControl",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "6d2910b0-9fea-46a2-84e6-a043b1e023e4",
            "created_at": "2022-10-25T16:07:23.946958Z",
            "updated_at": "2025-03-27T02:02:10.044112Z",
            "deleted_at": null,
            "main_name": "Operation DRBControl",
            "aliases": [],
            "source_name": "ETDA:Operation DRBControl",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716498,
    "ts_updated_at": 1743041835,
    "ts_creation_date": 0,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/6414a4f78cf5ce842d11dca9429ebafc9da64a18.pdf",
        "text": "https://archive.orkl.eu/6414a4f78cf5ce842d11dca9429ebafc9da64a18.txt",
        "img": "https://archive.orkl.eu/6414a4f78cf5ce842d11dca9429ebafc9da64a18.jpg"
    }
}