{
    "id": "9e911ff8-3377-4c37-82b0-faea58a8e3a3",
    "created_at": "2022-10-25T16:48:15.971897Z",
    "updated_at": "2025-03-27T02:05:53.284498Z",
    "deleted_at": null,
    "sha1_hash": "c4ae8b83af1017eedec9009c3ca08cb731f7ecda",
    "title": "Microsoft Word - Trustwave - ATM Malware Analysis Briefing - June 2 2009",
    "authors": "",
    "file_creation_date": "2009-06-02T10:29:44Z",
    "file_modification_date": "2009-06-02T10:29:44Z",
    "file_size": 77888,
    "plain_text": "### Automated Teller Machine (ATM) Malware Analysis Briefing\n\n Date: May 28, 2009\n\n**Copyright © 2009 Trustwave. All Rights Reserved.**\n\n\n-----\n\n|Col1|Col2|\n|---|---|\n|Author|Trustwave SpiderLabs|\n|Subject|Malware Analysis Briefing Report|\n|Project|Automated Teller Machine Malware Analysis|\n|||\n\n\n# Malware Snapshot\n\n|Malware Sample Properties|Col2|\n|---|---|\n|Malware Sample Name|lsass.exe|\n|Compressed|Yes No|\n|Obfuscated|Yes No|\n|Armored|Yes No|\n|Rootkit|Yes No|\n|Target Platform|Windows Unix|\n|Target application|ATM card Track and PIN data processing software|\n|File size of sample malware per this report|50176 bytes|\n|File type / Compiler|PE32 Executable / Borland Delphi 6.0 - 7.0|\n|File creation / installation date|July 25th 2007|\n|MD5 Checksum|695551C68C06591C3074377D4B27682E|\n|SHA1 Checksum|982F62C76EBDD71E31A9F61CE86FAAD7814B2568|\n|Sizes of other known versions of this malware|41984 bytes 49664 bytes|\n|MD5 Checksums of other known versions|113DC62206EFF20111C8CEBCDDD397FB 26A5A6E9F85656B28E2698676AEE114B D222B730441ABA903EF3F5517D071C58|\n|||\n\n\n-----\n\n### Malware Sample Properties\n\n\n**Description:**\n\n\nTrustwave’s SpiderLabs performed the analysis of malicious software (malware) found\ninstalled on compromised ATMs (Automated Teller Machines) in the Eastern European\nregion. This malware captures magnetic stripe data and PIN codes from the private memory\nspace of transaction-processing applications installed on a compromised ATM. The\ncompromised ATMs discussed in this briefing ran Microsoft’s Windows XP operating system.\n\nThe malware contains advanced management functionality allowing the attacker to fully\ncontrol the compromised ATM through a customized user interface built into the malware.\nThis interface is accessible by inserting controller cards into the ATM’s card reader.\nSpiderLabs analysts do not believe the malware includes networking functionality that\nwould allow it to send harvested data to other, remote locations via the Internet. The\nmalware does, however, allow for the output of harvested card data via the ATM’s receipt\nprinter or by writing the data to an electronic storage device (possibly using the ATM’s card\nreader). Analysts also discovered code indicating that the malware could eject the cashdispensing cassette.\n\nWhat follows is a high-level summary of the key features identified during Trustwave’s indepth analysis of the malware sample. It is, however, believed that this is a relatively early\nversion of the malware and that subsequent versions have seen significant additions to its\nfunctionality.\n\n\n-----\n\n## Card Data Harvesting Malware - lsass.exe\n\n\n## Method of Infection of the ATM\n\nThe malware is installed and activated through a dropper file (a file that an attacker can use to\ndeploy tools onto a compromised system) by the name of `isadmin.exe. It is a Borland`\nDelphi Rapid Application Development (RAD) executable and is essentially a replacement for\nthe original isadmin.exe utility written by Bill Stewart (www.westmesatech.com/wast.html).\n\nThe dropper binary contains a Data Resource (RCDATA) named PACKAGEINFO which in turn\ncontains the actual malware.\n\nExecuting the dropper file produces the malware file `lsass.exe within the` `C:\\WINDOWS`\ndirectory of the compromised system and does so via functionality provided by a Windows API\n(Application Programming Interface).\n\nOnce the malware is extracted, the dropper proceeds to manipulate the 'Protected Storage'\nservice—this normally handles the legitimate `lsass.exe` executable, located in the\n`C:\\WINDOWS\\system32` directory—to point towards the newly created malware. The\nservice is also configured to automatically restart in the event that it crashes, ensuring that the\nmalware remains active.\n\n## Targeting Track Data\n\nThe malware itself is also a Borland Delphi Graphic User Interface (GUI)-compiled executable,\nlaunched as a Microsoft Windows service. It contains the ability to enumerate the available\nprinting devices. Once active, the malware intercepts ATM transactions by injecting code into\ntargeted processes through the binary modification of these processes in memory.\n\nThe first process targeted by the malware appears to be a system-messaging utility, while the\nother is a form of ATM software service.\n\nOnce it resides in the memory, the malware polls the transaction message queue looking for\ntrack 2 data from the current transaction. It then performs a level of validation and\nmanipulation against this track data to determine whether the transaction is the attacker’s\ntrigger or controller card or a valid transaction involving track data that the malware collects\nby recording it in a file. The trigger cards (either a master function card or a single function\ncard) allow an attacker to interact with and control both the malware and the ATM.\n\nWhen the parsing routine fails to identify a trigger card, the malware stores the transaction\ninformation in a temporary file named `tr12 in the` `C:\\WINDOWS directory. The malware`\nharvests transactions as well as balance enquiries provided the currency indicated is American\nDollar (USD), Russian Rouble (RUR) or the Ukrainian Hryvnia (UAH).\n\nAdditionally, the malware harvests what is believed to be key or PIN data, saving the\ninformation in a file C:\\WINDOWS\\kl.\n\n## Primary Command Options and Functionality\n\nWhen a trigger card is detected, a small window appears giving the user 10 seconds to select\none of 10 command options using the ATM’s keypad.\n\n\n-----\n\n|Option|Function|Possible Description|\n|---|---|---|\n|0|Restore Logs|Restore the log files to the condition prior to the malware’s operation.|\n|1|Uninstall|To uninstall itself, the malware will: • Delete the trl2 and kl log files • Remove the malicious service • Restore the original lsass.exe executable • Finally, delete the malicious lsass.exe file|\n|2|Display Stats|Creates and displays a window presenting statistics (numbers of transactions, cards, keys) and version numbers of components (“Agilis” and “Agent”).|\n|3|Delete Logs|Deletes the harvesting log files C:\\WINDOWS\\trl2 and C:\\WINDOWS\\kl|\n|4|Reboot ATM|Adjusts the privileges of the malware and then forces a full system reboot.|\n|5|Test Printer|This command seems to be for testing the ATM’s receipt printer by printing Hello and 123456789.|\n|6|Print Collected Data|Print the harvested data, in an encrypted format, via the ATM receipt printer. The malware uses the DES algorithm for encryption.|\n|7|Secondary Menu|This option will present the user with a window displaying a challenge and wait for the corresponding response to be entered. Further details of this secondary menu are provided below.|\n|8|Supply Manager Information|The malware tries to access the ATM-vendor-software’s user interface, authenticate using a default-password and then waits for another pop-up window that can be used to retrieve information about bills/cash present in the ATM at the time of access.|\n|9|Unclear/Possibly writing to a smart card|Appears to be associated with memory card reader/writer functionality that may be used to transfer the harvested data directly to a card injected into a compromised ATM.|\n\n\n-----\n\n## Secondary Command Menu Options\n\nCommand option 7 presents the user with a challenge window and allows the user 30 seconds\nto input a corresponding valid response using the ATM’s keypad.\n\nIf the response provided by the ATM user agrees with the malware’s expectation, the following\ncommand menu is displayed.\n\nThere is evidence that the malware is executing the ATM API call which is probably related to\ncassette dispensing when the ‘dispense cassette’ options are selected.\n\n## Conclusion \n\nGiven the impact this malware can have on an infected ATM environment, Trustwave highly\nrecommends ALL financial institutions with ATMs under management perform analysis of their\nenvironment to identify if this malware or similar malware is present.\n\nTrustwave collected multiple version of this malware and therefore, feels that over time it will\nevolve. It will also begin to propagate to a more wide-spread population of ATMs, thus a\nproactive approach in prevention and identification will be necessary to prevent future attacks.\n\n\n-----\n\n## Contacts\n\n\n### The following individuals are the lead contacts for Trustwave’s SpiderLabs Incident Response Team:\n\n|USA Contact Information|Col2|\n|---|---|\n|Contact Name:|Colin Sheppard|\n|Contact Phone:|312.873.7474|\n|Contact Fax:|312.443.1620|\n|Contact E-Mail Address:|csheppard@trustwave.com|\n|Address:|70 W Madison St Suite 1050 Chicago, IL 60602|\n\n|EMEA Contact Information|Col2|\n|---|---|\n|Contact Name:|Stephen Venter|\n|Contact Phone:|+44 207 070 5982|\n|Contact Fax:|+44 845 456 9612|\n|Contact E-Mail Address:|sventer@trustwave.com|\n|Address:|8th floor, Westminster Tower 3 Albert Embankment London, UK SE1 7SP|\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "6fc23d14-23a6-4870-8fad-b291b182596f",
            "created_at": "2022-10-25T16:07:18.480113Z",
            "updated_at": "2022-10-25T16:07:18.480113Z",
            "deleted_at": null,
            "name": "ETDA",
            "url": "https://apt.etda.or.th",
            "description": "Threat Group Cards: A Threat Actor Encyclopedia",
            "reports": null
        }
    ],
    "references": [
        "https://www.wired.com/images_blogs/threatlevel/2009/06/trustwave-security-alert-atm-malware-analysis-briefing.pdf"
    ],
    "report_names": [
        "trustwave-security-alert-atm-malware-analysis-briefing.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716495,
    "ts_updated_at": 1743041153,
    "ts_creation_date": 1243938584,
    "ts_modification_date": 1243938584,
    "files": {
        "pdf": "https://archive.orkl.eu/c4ae8b83af1017eedec9009c3ca08cb731f7ecda.pdf",
        "text": "https://archive.orkl.eu/c4ae8b83af1017eedec9009c3ca08cb731f7ecda.txt",
        "img": "https://archive.orkl.eu/c4ae8b83af1017eedec9009c3ca08cb731f7ecda.jpg"
    }
}