{
    "id": "1572e066-4282-41d5-9abb-45768dbb4acc",
    "created_at": "2023-01-12T15:11:00.504352Z",
    "updated_at": "2025-03-27T02:15:37.908682Z",
    "deleted_at": null,
    "sha1_hash": "99787c45996fb1de43efd01d1168eb5cecc7a7a1",
    "title": "2022-01-11 - Unpacking Dridex malware",
    "authors": "",
    "file_creation_date": "2022-05-27T18:58:11Z",
    "file_modification_date": "2022-05-27T18:58:11Z",
    "file_size": 1611687,
    "plain_text": "# Unpacking Dridex malware\n\n**muha2xmad.github.io/unpacking/dridex/**\n\n### Muhammad Hasan Ali\n\nMalware Analysis learner\n\n2 minute read\n\n**As-salamu Alaykum**\n\n## Introducton\n\n\nJanuary 11, 2022\n\n\nDridex is a famous banking Trojan which appeared around 2011 and is still very active today.\nThis is because of its evolution and its complex architecture, which is based on proxy layers\nto hide the main command and control servers (C&C). The APT known as TA505 is\n[associated to Dridex. 1](https://cyber-anubis.github.io/malware%20analysis/dridex/)\n\nMD5: 6A8401448A5BD2B540850F811B20A66D\n\n## Static\n\nOpen it in `DiE to see` `Entropy . It’s too high and if we open the sample in` `IDA .` `IDA will`\npop up a warning which means that the sample is packed. After it’s opened in `IDA we see`\nthat it’s less number of functions and no imports.\n\n\n-----\n\nFigure(1):\n\n## Unpacking Process\n\nThen open the sample with `x32dbg and set 3 breakpoints` `VirtualAlloc and`\n```\nVirtualProtect and CreateProcessInternalW . Then press F9 to hit the first BP. We\n\n```\nhit `VirtualAlloc then` `Execute till return and dump` `EAX . We see that’s empty.`\nThen run again and `Execute till return and dump` `EAX . Then run again for the third`\ntime and `Execute till return and dump` `EAX . We notice that there’s a PE header`\nstarts with `MZ magic byte which we can assume that’s our unpacked file. Don’t close`\n```\nx32dbg yet Follow in memory map and save it then open it in pestudio . It shows that\n\n```\nwe didn’t finish the unpacking process.\n\n\n-----\n\nFigure(2):\n\nWe keep doing the same steps till we hit `VirtualProtect BP. then` `Execute till`\n```\nretrun then we look at the second parameter which will change the permission at this\n\n```\nmemory location which is `10000000 .`\n\nFigure(3):\n\nIf you `follow in Memory Map you will see` `RWC which means that it still writing which still`\nunpacking.\n\nFigure(4):\n\n\n-----\n\nThen run again which will hit `VirtualProtect again. Then` `Execute till return and it`\npoints at the same location `10000000, but this time shows us it’s only` `R in memory map.`\nNow we don’t know that if it’s done or not. So `run again and` `Execute till return we`\nsee it points at another location but in the same region of memory of `10000000 which is`\n```\n10001000 .\n\n```\nFigure(5):\n\nThis the 3rd time to hit `VirtualProtect BP we keep doing the same steps which will point`\nat another locations but in the same region of memory of `10000000 . and in the 6th one we`\n**stop. We press** `F9 to run. It shows us` `EXCEPTION_BREAKPOINT it’s done unpacking.`\n**Don’t close the debugger.**\n\nFigure(6):\n\n**Now we hit** `VirtualAlloc 3 times and` `VirtualProtect 6 times at the 6th one we`\n**finished unpacking. We will restore the snapshot and do it again till hit**\n```\nVirtualProtect at the 6th time and Execute till return .\n\n```\n\n-----\n\nThen open `Process Hacker tool to to save the unpacked file.`\n\nFigure(7):\n\n## Unmapping\n\n[Then we repair the unapcked file to restore the imports table. As we did Here and save it.](https://muha2xmad.github.io/malware-analysis/unpacking/emotet-part-2/#unmap-the-unpacked-file)\nThen open it in `pestudio if you unmapped it right, will show the imports table and you`\ncould analyze it easy.\n\n## Article quote\n\nاﻟﻨﻌﯿﻢُ ﻻ ﯾُﺪرك ﺑﺎﻟﻨﻌﯿﻢ\n\n## REF\n\n1- [https://cyber-anubis.github.io/malware%20analysis/dridex/](https://cyber-anubis.github.io/malware%20analysis/dridex/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-01-11 - Unpacking Dridex malware.pdf"
    ],
    "report_names": [
        "2022-01-11 - Unpacking Dridex malware.pdf"
    ],
    "threat_actors": [
        {
            "id": "99cb4e5b-8071-4f9e-aa1d-45bfbb6197e3",
            "created_at": "2023-01-06T13:46:38.860754Z",
            "updated_at": "2025-03-27T02:00:02.937438Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "SectorJ04 Group",
                "Dudear",
                "G0092",
                "ATK103",
                "Hive0065",
                "Spandex Tempest",
                "GRACEFUL SPIDER",
                "GOLD TAHOE",
                "CHIMBORAZO",
                "SectorJ04"
            ],
            "source_name": "MISPGALAXY:TA505",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "5e6b31a6-80e3-4e7d-8b0a-d94897ce9b59",
            "created_at": "2024-06-19T02:03:08.128175Z",
            "updated_at": "2025-03-27T02:05:17.400394Z",
            "deleted_at": null,
            "main_name": "GOLD TAHOE",
            "aliases": [
                "SectorJ04 ",
                "Spandex Tempest ",
                "TA505 ",
                "FIN11 "
            ],
            "source_name": "Secureworks:GOLD TAHOE",
            "tools": [
                " Cobalt Strike",
                " FlawedAmmy",
                " Get2",
                " GraceWire",
                " Malichus",
                " SDBbot",
                " ServHelper",
                " TrueBot",
                "Clop"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "75d4d6a9-b5d1-4087-a7a0-e4a9587c45f4",
            "created_at": "2022-10-25T15:50:23.5188Z",
            "updated_at": "2025-03-27T02:00:55.489882Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "TA505",
                "Hive0065",
                "Spandex Tempest",
                "CHIMBORAZO"
            ],
            "source_name": "MITRE:TA505",
            "tools": [
                "AdFind",
                "Azorult",
                "FlawedAmmyy",
                "Mimikatz",
                "Dridex",
                "TrickBot",
                "Get2",
                "FlawedGrace",
                "Cobalt Strike",
                "ServHelper",
                "Amadey",
                "SDBbot",
                "PowerSploit"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "e447d393-c259-46e2-9932-19be2ba67149",
            "created_at": "2022-10-25T16:07:24.28282Z",
            "updated_at": "2025-03-27T02:02:10.159466Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "ATK 103",
                "Chimborazo",
                "Gold Evergreen",
                "Gold Tahoe",
                "Graceful Spider",
                "Hive0065",
                "Operation Tovar",
                "Operation Trident Breach",
                "SectorJ04",
                "Spandex Tempest",
                "TA505",
                "TEMP.Warlock"
            ],
            "source_name": "ETDA:TA505",
            "tools": [
                "Amadey",
                "AmmyyRAT",
                "AndroMut",
                "Azer",
                "Bart",
                "Bugat v5",
                "CryptFile2",
                "CryptoLocker",
                "CryptoMix",
                "CryptoShield",
                "Dridex",
                "Dudear",
                "EmailStealer",
                "FRIENDSPEAK",
                "Fake Globe",
                "Fareit",
                "FlawedAmmyy",
                "FlawedGrace",
                "FlowerPippi",
                "GOZ",
                "GameOver Zeus",
                "GazGolder",
                "Gelup",
                "Get2",
                "GetandGo",
                "GlobeImposter",
                "Gorhax",
                "GraceWire",
                "Gussdoor",
                "Jaff",
                "Kasidet",
                "Kegotip",
                "Kneber",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Locky",
                "MINEBRIDGE",
                "MINEBRIDGE RAT",
                "MirrorBlast",
                "Neutrino Bot",
                "Neutrino Exploit Kit",
                "P2P Zeus",
                "Peer-to-Peer Zeus",
                "Philadelphia",
                "Philadephia Ransom",
                "Pony Loader",
                "Rakhni",
                "ReflectiveGnome",
                "Remote Manipulator System",
                "RockLoader",
                "RuRAT",
                "SDBbot",
                "ServHelper",
                "Shifu",
                "Siplog",
                "TeslaGun",
                "TiniMet",
                "TinyMet",
                "Trojan.Zbot",
                "Wsnpoem",
                "Zbot",
                "Zeta",
                "ZeuS",
                "Zeus"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536260,
    "ts_updated_at": 1743041737,
    "ts_creation_date": 1653677891,
    "ts_modification_date": 1653677891,
    "files": {
        "pdf": "https://archive.orkl.eu/99787c45996fb1de43efd01d1168eb5cecc7a7a1.pdf",
        "text": "https://archive.orkl.eu/99787c45996fb1de43efd01d1168eb5cecc7a7a1.txt",
        "img": "https://archive.orkl.eu/99787c45996fb1de43efd01d1168eb5cecc7a7a1.jpg"
    }
}