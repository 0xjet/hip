{
    "id": "655624f8-5469-4c83-9679-9e1f711ffc33",
    "created_at": "2023-01-12T14:59:18.252539Z",
    "updated_at": "2025-03-27T02:12:03.962052Z",
    "deleted_at": null,
    "sha1_hash": "3c9d56e73b45611fc14a2c46c70dbab84812f0f1",
    "title": "2022-02-15 - Vulnerable Exchange server hit by Squirrelwaffle and financial fraud",
    "authors": "",
    "file_creation_date": "2022-05-28T00:30:52Z",
    "file_modification_date": "2022-05-28T00:30:52Z",
    "file_size": 2888927,
    "plain_text": "# Vulnerable Exchange server hit by Squirrelwaffle and financial fraud\n\n**[news.sophos.com/en-us/2022/02/15/vulnerable-exchange-server-hit-by-squirrelwaffle-and-financial-fraud/](https://news.sophos.com/en-us/2022/02/15/vulnerable-exchange-server-hit-by-squirrelwaffle-and-financial-fraud/)**\n\nFebruary 15, 2022\n\nThe [Sophos Rapid Response team recently investigated an incident where the Squirrelwaffle](https://www.sophos.com/en-us/products/managed-threat-response/rapid-response)\n[malware loader was used in conjunction with the ProxyLogon and](https://news.sophos.com/en-us/2021/03/05/hafnium-advice-about-the-new-nation-state-attack/) [ProxyShell exploits to](https://news.sophos.com/en-us/2021/08/23/proxyshell-vulnerabilities-in-microsoft-exchange-what-to-do/)\ntarget an unpatched Microsoft Exchange server. The attackers leveraged the vulnerable\nserver to mass distribute Squirrelwaffle to both internal and external recipients by inserting\nmalicious replies into employees’ existing email threads (known as email thread hijacking.)\n\n\n-----\n\nSophos has encountered this approach before, but, on this occasion, there was also\nsomething new going on. The incident investigators discovered that while the malicious\nspam campaign was being implemented, the same vulnerable server was also used for a\nfinancial fraud attack using knowledge extracted from a stolen email thread.\n\n## What is Squirrelwaffle?\n\nSquirrelwaffle is a malware loader that is distributed as a malicious office document in spam\ncampaigns. It provides attackers with an initial foothold in a victim’s environment and a\nchannel to deliver and infect systems with other malware. When a recipient opens a\nSquirrelwaffle-infected document and enables macros, a visual basic script typically\ndownloads and executes Cobalt Strike Beacons, giving control of the computer to an\nattacker.\n\n## The twist\n\nIn a typical Squirrelwaffle attack leveraging a vulnerable Exchange server, the attack ends\nwhen defenders detect and remediate the breach by patching the vulnerabilities, removing\nthe attacker’s ability to send emails through the server.\n\nIn the incident investigated by Sophos Rapid Response, however, such remediation wouldn’t\nhave stopped the financial fraud attack because the attackers had exported an email thread\nabout customer payments from the victim’s Exchange server. (Further, as noted below,\npatching isn’t the final solution for remediating vulnerable Exchange servers, you also need\nto [investigate to see if there was any other impact, such as the installation of web shells.)](https://news.sophos.com/en-us/2021/03/25/patching-alone-is-not-enough-investigate-your-exposure-windows/)\n\nUsing knowledge obtained from the thread, the attackers registered a “typo-squatted”\ndomain (one that appears to be the victim’s domain but with a small typo) that they then used\nto reply to the email thread. Moving the conversation out of the victim’s email infrastructure\ngave the attackers operational control over what happened next.\n\nThe attackers replied to the email thread using email addresses from the typo-squatted\ndomain and attempted to redirect the victim’s customer’s payments to themselves.\n\nTo add further legitimacy to the conversation, the attackers copied additional email\naddresses to give the impression that they were requesting support from an internal\ndepartment. In fact, the additional addresses were also created by the attacker under the\ntypo-squatted domain.\n\nThe attackers set the stage for a legitimate financial transaction to be redirected to a bank\naccount under their control:\n\n\n-----\n\nA follow up email references the new banking details and tries to create a sense of urgency.\nThe attackers followed up almost every day for the next six days with the tone growing\nincreasingly agitated:\n\nThe attacker changed their tone after receiving an email indicating that the payment was\nbeing processed:\n\nThe attackers very nearly achieved their goal. The victim organization initiated a transfer of\nmoney to the attackers, however, one of the financial institutions involved in the transaction\nflagged the transaction as fraudulent and so the transfer did not complete.\n\n## Protecting against malicious email attacks\n\nThe single biggest step defenders can take to prevent the compromise and abuse of on\npremises Microsoft Exchange servers is to ensure that they have been patched with the\nmost recent updates from Microsoft.\n\n\n-----\n\nNext, defenders can make it easier for other organizations to determine the legitimacy of\nemails coming from their domain, for instance by implementing industry recognized\nstandards for email authentication, such as SPF (Sender Policy Framework), DKIM\n(DomainKeys Identified Mail), and DMARC (Domain Message Authentication Reporting and\nConformance.) Using these standards can make it harder for an attacker to send spoofed\nemails impersonating your domain.\n\nAs attackers become increasingly skilled at social engineering, creating sophisticated\nphishing lures and impersonation messages, and more, it may be time to start using email\n[security products that integrate artificial intelligence.](https://news.sophos.com/en-us/2021/08/26/get-ai-powered-phishing-protection-with-sophos-email/)\n\nLast but not least, defenders need to protect the recipients of such emails and ensure that\n[users in their organization can spot phishing attempts and know how to report and respond](https://www.sophos.com/en-us/products/phish-threat)\nto them.\n\n## I’ve been attacked – what now?\n\nIf you suspect you have been the target of a Squirrelwaffle or financial fraud attack, there are\nsome practical steps you can take.\n\n[Use the Sophos Rapid Response Squirrelwaffle Incident Guide to help you investigate,](https://news.sophos.com/en-us/2022/02/15/rapid-response-the-squirrelwaffle-incident-guide/)\nanalyze and respond to an incident involving Squirrelwaffle.\nImplement your incident response plan. If you don’t have one or don’t feel you have the\nright resources to contain and neutralize the attack, call on a third party incident\n[response team, such as Sophos Rapid Response.](https://www.sophos.com/en-us/products/managed-threat-response/rapid-response)\nGet patching. Update the software on any vulnerable on premises Microsoft Exchange\nservers – and [check after patching for any web shells left behind by the attackers for](https://news.sophos.com/en-us/2021/03/25/patching-alone-is-not-enough-investigate-your-exposure-windows/)\nlater access.\nIf your domain has been typo-squatted, you can file an abuse complaint with the\ndomain registrar of the typo-squatted domain. This process will vary depending on the\nregistrar.\nIf a malicious spam campaign was conducted from your compromised Exchange\nserver, make sure your organization’s legitimate domain or email infrastructure has\n[been flagged as a spam sender. Check whether you have been blacklisted. You can](https://mxtoolbox.com/blacklists.aspx)\nask to be removed from the list, but it is sometimes worth staying on it until no further\nspam is detected from your domain as that could help to prevent some of your\nlegitimate emails from being inadvertently delivered to external recipients.\n\n## Conclusion\n\nThe combination of Squirrelwaffle, ProxyLogon, and ProxyShell has been encountered by\nthe Sophos Rapid Response team multiple times in the last few months, but this is the first\ntime we have seen attackers use typo-squatting to maintain the ability to send spam once\nthe Exchange server has been remediated.\n\n\n-----\n\n**Kyle Link and Mauricio Valdivieso from the Sophos Rapid Response team also**\n**contributed to this article.**\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-02-15 - Vulnerable Exchange server hit by Squirrelwaffle and financial fraud.pdf"
    ],
    "report_names": [
        "2022-02-15 - Vulnerable Exchange server hit by Squirrelwaffle and financial fraud.pdf"
    ],
    "threat_actors": [
        {
            "id": "529c1ae9-4579-4245-86a6-20f4563a695d",
            "created_at": "2022-10-25T16:07:23.702006Z",
            "updated_at": "2025-03-27T02:02:09.93109Z",
            "deleted_at": null,
            "main_name": "Hafnium",
            "aliases": [
                "Red Dev 13",
                "Silk Typhoon"
            ],
            "source_name": "ETDA:Hafnium",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "7c969685-459b-4c93-a788-74108eab6f47",
            "created_at": "2023-01-06T13:46:39.189751Z",
            "updated_at": "2025-03-27T02:00:03.017103Z",
            "deleted_at": null,
            "main_name": "HAFNIUM",
            "aliases": [
                "ATK233",
                "G0125",
                "Operation Exchange Marauder",
                "Red Dev 13",
                "Silk Typhoon"
            ],
            "source_name": "MISPGALAXY:HAFNIUM",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "2704d770-43b4-4bc4-8a5a-05df87416848",
            "created_at": "2022-10-25T15:50:23.306305Z",
            "updated_at": "2025-03-27T02:00:55.43633Z",
            "deleted_at": null,
            "main_name": "HAFNIUM",
            "aliases": [
                "HAFNIUM",
                "Operation Exchange Marauder",
                "Silk Typhoon"
            ],
            "source_name": "MITRE:HAFNIUM",
            "tools": [
                "Tarrask",
                "ASPXSpy",
                "Impacket",
                "PsExec",
                "China Chopper"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535558,
    "ts_updated_at": 1743041523,
    "ts_creation_date": 1653697852,
    "ts_modification_date": 1653697852,
    "files": {
        "pdf": "https://archive.orkl.eu/3c9d56e73b45611fc14a2c46c70dbab84812f0f1.pdf",
        "text": "https://archive.orkl.eu/3c9d56e73b45611fc14a2c46c70dbab84812f0f1.txt",
        "img": "https://archive.orkl.eu/3c9d56e73b45611fc14a2c46c70dbab84812f0f1.jpg"
    }
}