{
    "id": "553fdeac-af39-4e2f-87c1-c36a837fffe6",
    "created_at": "2023-01-12T15:10:16.060541Z",
    "updated_at": "2025-03-27T02:09:17.985068Z",
    "deleted_at": null,
    "sha1_hash": "13b1a79d1665dcc8dd621644d1162fca485de408",
    "title": "2022-08-19 - Back in Black- Unlocking a LockBit 3.0 Ransomware Attack",
    "authors": "",
    "file_creation_date": "2022-09-01T10:14:03Z",
    "file_modification_date": "2022-09-01T10:14:03Z",
    "file_size": 620902,
    "plain_text": "# Back in Black: Unlocking a LockBit 3.0 Ransomware Attack\n\n**[research.nccgroup.com/2022/08/19/back-in-black-unlocking-a-lockbit-3-0-ransomware-attack](https://research.nccgroup.com/2022/08/19/back-in-black-unlocking-a-lockbit-3-0-ransomware-attack)**\n\nAugust 19, 2022\n\nAuthored by: Ross Inman [(@rdi_x64)](https://www.twitter.com/rdi_x64)\n\n## Summary\n\n tl;dr\n\nThis post explores some of the TTPs employed by a threat actor who were observed\ndeploying LockBit 3.0 ransomware during an incident response engagement.\n\nBelow provides a summary of findings which are presented in this blog post:\n\nInitial access via SocGholish.\nEstablishing persistence to run Cobalt Strike beacon.\nDisabling of Windows Defender and Sophos.\nUse of information gathering tools such as Bloodhound and Seatbelt.\nLateral movement leveraging RDP and Cobalt Strike.\nUse of 7zip to collect data for exfiltration.\nCobalt Strike use for Command and Control.\nExfiltration of data to Mega.\nUse of PsExec to push out ransomware.\n\n## LockBit 3.0\n\nLockBit 3.0 aka “LockBit Black”, noted in June of this year has coincided with a large\nincrease of victims being published to the LockBit leak site, indicating that the past few\nmonths has heralded a period of intense activity for the LockBit collective.\n\n\n-----\n\nIn the wake of the apparent implosion of previous prolific ransomware group CONTI [1], it\nseems that the LockBit operators are looking to fill the void; presenting a continued risk of\nencryption and data exfiltration to organizations around the world.\n\n## TTPs\n\n Initial Access\n\nInitial access into the network was gained via a download of a malware-laced zip file\ncontaining SocGholish. Once executed, the download of a Cobalt Strike beacon was initiated\nwhich was created in the folder `C:\\ProgramData\\VGAuthService with the filename`\n```\nVGAuthService.dll . Along with this, the Windows command-line utility rundll32.exe is\n\n```\ncopied to the folder and renamed to `VGAuthService.exe and used to execute the Cobalt`\nStrike DLL.\n\nPowerShell commands were also executed by the SocGholish malware to gather system\nand domain information:\n```\n   powershell /c nltest /dclist: ; nltest /domain_trusts ; cmdkey /list ;\n   net group 'Domain Admins' /domain ; net group 'Enterprise Admins'\n   /domain ; net localgroup Administrators /domain ; net localgroup\n   Administrators ;\n   powershell /c Get-WmiObject win32_service -ComputerName localhost |\n   Where-Object {$_.PathName -notmatch 'c:\\\\win'} | select Name,\n   DisplayName, State, PathName | findstr 'Running'\n\n## Persistence\n\n```\nA persistence mechanism was installed by SocGholish using the startup folder of the\ninfected user to ensure execution at user logon. The shortcut file `C:\\Users\\`\n```\n<user>\\AppData\\Roaming\\Microsoft\\Windows\\Start\n\n```\n`Menu\\Programs\\Startup\\VGAuthService.lnk` was created and configured to execute the\nfollowing command which will run the Cobalt Strike beacon deployed to the host:\n```\nC:\\ProgramData\\VGAuthService\\VGAuthService.exe\nC:\\ProgramData\\VGAuthService\\VGAuthService.dll,DllRegisterServer\n\n## Defence Evasion\n\n```\nDeployment of a batch script named 123.bat was observed on multiple hosts and was\ndeployed via PsExec. The script possessed the capabilities to uninstall Sophos, disable\nWindows Defender and terminate running services where the service name contained\nspecific strings. The contents of the batch script are provided below:\n\n\n-----\n\nFigure1: 123.bat contents\nThe ransomware binary used also clears key Windows event log files including Application,\nSystem and Security. It also prevents any further events from being written by targeting the\nEventLog service.\n\n## Discovery\n\nBloodhound was executed days after the initial SocGholish infection on the patient zero host.\nThe output file was created in the `C:\\ProgramData\\ directory and had the file extension`\n.bac instead of the usual .zip, however this file was still a zip archive.\n\nA TGS ticket for a single account was observed on patient zero in a text file under\n```\nC:\\ProgramData\\ . It appears the threat actor was gathering TGS tickets for SPNs\n\n```\nassociated with the compromised user.\n\nSeatbelt [2] was also executed on the patient zero host alongside Bloodhound. Securityorientated information about the host gathered by Seatbelt was outputted to the file\n```\nC:\\ProgramData\\seat.txt .\n\n## Lateral Movement\n\n```\nThe following methods were utilized to move laterally throughout the victim network:\n\nCobalt Strike remotely installed temporary services on targeted hosts which executed a\nCobalt Strike beacon. An example command line of what the services were configured\nto run is provided below:\n\n```\nrundll32.exe c:\\programdata\\svchost1.dll,DllRegisterServer\n\n```\n\nRDP sessions were established using a high privileged account the threat actor had\ncompromised prior.\n\n## Collection\n\n\n-----\n\n7zip was deployed by the adversary to compress and stage data from folders of interest\nwhich had been browsed during RDP sessions.\n\n## Command and Control\n\nCobalt Strike was the primary C2 framework utilized by the threat actor to maintain their\npresence on the estate as well as laterally move.\n\n## Exfiltration Using MegaSync\n\nBefore deploying the ransomware to the network, the threat actor began to exfiltrate data to\nMega, a cloud storage provider. This was achieved by downloading Mega sync software onto\ncompromised hosts, allowing for direct upload of data to Mega.\n\n## Impact\n\nThe ransomware was pushed out to the endpoints using PsExec and impacted both servers\nand end-user devices. The ransomware executable was named `zzz.exe and was located`\nin the following folders:\n```\n   C:\\Windows\\\n   C:\\ProgramData\\\n   C:\\Users\\<user>\\Desktop\\\n\n## Recommendations\n\n```\n1. Ensure that both online and offline backups are taken and test the backup plan\n\nregularly to identify any weak points that could be exploited by an adversary.\n2. Restrict internal RDP and SMB traffic so that only hosts that are required to\n\ncommunicate via these protocols are allowed to.\n3. Monitor firewalls for anomalous spikes in data leaving the network.\n4. Block traffic to cloud storage services such as Mega which have no legitimate use in a\n\ncorporate environment.\n5. Provide regular security awareness training.\n\nIf you have been impacted by LockBit, or currently have an incident and would like support,\nplease contact our Cyber Incident Response Team on +44 161 209 5148 or email\ncirt@nccgroup.com.\n\n## Indicators of Compromise\n\n\n**IOC Value** **Indicator**\n**Type**\n\n\n**Description**\n\n\n-----\n\norangebronze[.]com Domain Cobalt Strike C2 server\n\n\n194.26.29[.]13 IP\nAddress\n\n\nCobalt Strike C2 server\n\n\nC:\\ProgramData\\svchost1.dll\nC:\\ProgramData\\conhost.dll\nC:\\ProgramData\\svchost.dll\n\n\nFile Path Cobalt Strike beacons\n\n\nC:\\ProgramData\\VGAuthService\\VGAuthService.dll File Path Cobalt Strike beacon\ndeployed by SocGholish\n\n\nC:\\Windows\\zzz.exe C:\\ProgramData\\zzz.exe\nC:\\Users\\<user>\\Desktop\\zzz.exe\n\nc:\\users\\\n<user>\\appdata\\local\\megasync\\megasync.exe\n\n\nFile Path Ransomware\nExecutable\n\nFile Path Mega sync software\n\n\nC:\\ProgramData\\PsExec.exe File Path PsExec\n\nC:\\ProgramData\\123.bat File Path Batch script to tamper\nwith security software\nand services\n\n\nD826A846CB7D8DE539F47691FE2234F0FC6B4FA0 SHA1\nHash\n\nFigure 2: Indicators of Compromise\n\n## MITRE ATT&CK®\n\n\nC:\\ProgramData\\123.bat\n\n\nTactic Technique ID Description\n\n\nInitial\nAccess\n\n\nDrive-by Compromise T1189 Initial access was gained via\ninfection of SocGholish\nmalware caused by a drive-bydownload\n\n\nExecution Command and Scripting\nInterpreter: Windows\nCommand Shell\n\nExecution Command and Scripting\nInterpreter: PowerShell\n\nExecution System Services: Service\nExecution\n\nExecution System Services: Service\nExecution\n\n\nT1059.003 A batch script was utilized to\nexecute malicious commands\n\nT1059.001 PowerShell was utilized to\nexecute malicious commands\n\nT1569.002 Cobalt Strike remotely created\nservices to execute its payload\n\nT1569.002 PsExec creates a service to\nperform it’s execution\n\n\n-----\n\nPersistence Boot or Logon Autostart\nExecution: Registry Run\nKeys / Startup Folder\n\n\nDefence\nEvasion\n\nDefence\nEvasion\n\n\nImpair Defenses: Disable or\nModify Tools\n\nIndicator Removal on Host:\nClear Windows Event Logs\n\n\nT1547.001 SocGholish established\npersistence through a startup\nfolder\n\nT1562.001 123.bat disabled and\nuninstalled Anti-Virus software\n\nT1070.001 The ransomware executable\ncleared Windows event log files\n\n\nDiscovery Domain Trust Discovery T1482 The threat actor executed\nBloodhound to map out the AD\nenvironment\n\nDiscovery Domain Trust Discovery T1482 A TGS ticket for a single\naccount was observed in a text\nfile created by the threat actor\n\n\nDiscovery System Information\nDiscovery\n\n\nLateral\nMovement\n\nLateral\nMovement\n\n\nSMB/Admin Windows\nShares\n\nRemote Services: Remote\nDesktop Protocol\n\n\nCollection Archive Collected Data:\nArchive via Utility\n\n\nCommand\nand Control\n\n\nApplication Layer Protocol:\nWeb Protocols\n\n\nExfiltration Exfiltration Over Web\nService: Exfiltration to Cloud\nStorage\n\n\nT1082 Seatbelt was ran to gather\ninformation on patient zero\n\nT1021.002 Cobalt Strike targeted SMB\nshares for lateral movement\n\nT1021.001 RDP was used to establish\nsessions to other hosts on the\nnetwork\n\nT1560.001 7zip was utilized to create\narchives containing data from\nfolders of interest\n\nT1071.001 Cobalt Strike communicated\nwith its C2 over HTTPS\n\nT1567.002 The threat actor exfiltrated data\nto Mega cloud storage\n\n\nImpact Data Encrypted for Impact T1486 Ransomware was deployed to\nthe estate and impacted both\nservers and end-user devices\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-08-19 - Back in Black- Unlocking a LockBit 3.0 Ransomware Attack.pdf"
    ],
    "report_names": [
        "2022-08-19 - Back in Black- Unlocking a LockBit 3.0 Ransomware Attack.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536216,
    "ts_updated_at": 1743041357,
    "ts_creation_date": 1662027243,
    "ts_modification_date": 1662027243,
    "files": {
        "pdf": "https://archive.orkl.eu/13b1a79d1665dcc8dd621644d1162fca485de408.pdf",
        "text": "https://archive.orkl.eu/13b1a79d1665dcc8dd621644d1162fca485de408.txt",
        "img": "https://archive.orkl.eu/13b1a79d1665dcc8dd621644d1162fca485de408.jpg"
    }
}