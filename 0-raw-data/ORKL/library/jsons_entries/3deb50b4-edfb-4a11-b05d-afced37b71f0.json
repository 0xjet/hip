{
    "id": "3deb50b4-edfb-4a11-b05d-afced37b71f0",
    "created_at": "2023-01-12T15:03:05.043293Z",
    "updated_at": "2025-03-27T02:05:39.664527Z",
    "deleted_at": null,
    "sha1_hash": "4aa982bf2368e0ba4530ed20787ce182eaee61d8",
    "title": "2021-09-30 - Threat Thursday- xLoader Infostealer",
    "authors": "",
    "file_creation_date": "2022-05-28T23:16:23Z",
    "file_modification_date": "2022-05-28T23:16:23Z",
    "file_size": 2351672,
    "plain_text": "# Threat Thursday: xLoader Infostealer\n\n**[blogs.blackberry.com/en/2021/09/threat-thursday-xloader-infostealer](https://blogs.blackberry.com/en/2021/09/threat-thursday-xloader-infostealer)**\n\nThe BlackBerry Research & Intelligence Team\n\n### Background\n\nxLoader is an information-stealing malware targeting both macOS® and Windows®.\nPreviously sold on underground forums under the name Formbook, xLoader surfaced in\nearly 2020 shortly after Formbook was shut down by its author.\n\nxLoader is sold under a Malware-as-a-Service (MaaS) agreement. Subscribers have\naccess to the administrative panel and executable builds for both Windows and macOS.\nThe authors of xLoader retain full control of command-and-control (C2) infrastructure and\nmalware builds for each target environment.\n\n### Operating System\n\n\n-----\n\n### Risk & Impact\n\n Technical Analysis\n\nFor this report, we analyzed a Windows build of xLoader.\n\n**Sample hash:**\n9f7b903ab126b2a3a0ca3c5977bbf84111f52a6e3a6e43aa127763e1a46b8f2d\n\nThe file is a 32-bit Windows executable, which shows a compile timestamp in 2001. Given\nwhat we know of xLoader’s history, this is clearly a false date and an indication of this\nthreat’s evasive behavior.\n\nBasic static analysis reveals more abnormal features:\n\n1.   Zero imported libraries and functions\n\n2.   No data directory entries\n\n3.   A single executable “.text” section\n\n4.   A very small number of legible strings\n\nThis sample is a very feature-limited build. Perhaps the author adopted a “less is more”\nmindset, believing that a reduced analysis “surface” would help to avoid suspicion. When\nplaced under the analysis microscope, this decision was largely counter-productive as the\nmalware’s simplicity only serves to highlight its unusual features.\n\nDisassembly shows the code is heavily obfuscated:\n\n\n-----\n\n_Figure 1: Obfuscated code flow within the xLoader binary_\n\nTurning to dynamic analysis, when xLoader is launched, it will first manually load ntdll.dll\nfrom disk. This approach of manual mapping is an evasive technique that aims to bypass\nhooks put in place by (poorly implemented) endpoint protection and automated malware\nanalysis environments.\n\nWith access to ntdll, xLoader performs a battery of anti-analysis checks. This includes\nlooking for the following conditions:\n\n1.   The presence of a user-mode debugger\n\n2.   The presence of a kernel-mode debugger\n\n3.   Execution timing checks (rdtsc)\n\n4.   The presence of blacklisted process names\n\n\n-----\n\n5.   The presence of blacklisted modules\n6.   The presence of blacklisted usernames\n7.   The Thread Environment Block (TEB) Wow32Reserved field points to a 64-bit module\n\nAs this last point is a bit more complicated, let’s investigate it a little further.\n\nIn this instance, xLoader is a 32-bit process. Under normal operation, Wow32Reserved in\nthe TEB resolves to a function located in wow64cpu.dll. xLoader will validate the PE header\nof whatever Wow32Reserved points to, and confirm that the expected offset for PE “Magic\nNumber” is 0x20B, indicating a 64-bit (PE32+) module.\n\nAny naïve attempts to intercept API calls made by xLoader, by overwriting\nWow32Reserved, would likely be met with having it point to a user allocated block of\nmemory containing shellcode. This would lack the proper PE header and expected “Magic\nNumber” value.\n\nThe success or failure of each of the seven anti-analysis checks listed above is recorded in\na 16-byte field. Once all checks are completed, the hash value of this field is used to\ndecrypt API strings. Rudimentary attempts to bypass the checks result in incorrect\ndecryption and deliberate self-destruction by way of an unhandled exception.\n\n\n-----\n\n-----\n\n_Figure 2: Roll-call of completed anti-analysis checks employed by xLoader to ward off_\n_unwanted attention_\n\nOnce environmental checks are completed, xLoader obtains a process handle to Windows’\nexplorer.exe (ID 2460 in the below image). The open process request specifically includes\npermission to read or write memory, which is a tell-tale sign of imminent remote code\ninjection:\n\n_Figure 3: Request to open a process with read and write access rights_\n\nIn this scenario, code injection is performed by way of section objects and shared memory\nviews, as well as API calls to NtOpenThread, SetThreadContext, and NtResumeThread.\n\nThe goal of code injection is to spawn a new, legitimate Windows process that will act as an\nunwitting host for a second round of code injection. Legitimate Windows processes\nlaunched by a user during regular operations will have explorer.exe as the parent, thus\nxLoader is doing its best to “blend in.”\n\nxLoader chooses a process at random from an internal list:\n\n\n-----\n\nsvchost.exe\n\nmsiexec.exe\n\nwuauclt.exe\n\nlsass.exe\n\nwlanext.exe\n\nmsg.exe\n\nlsm.exe\n\ndwm.exe\n\nhelp.exe\n\nchkdsk.exe\n\ncmmon32.exe\n\nnbtstat.exe\n\nspoolsv.exe\n\n\ncmstp.exe\n\ncolorcpl.exe\n\ncscript.exe\n\nexplorer.exe\n\nWWAHost.exe\n\nipconfig.exe\n\nmsdt.exe\n\nmstsc.exe\n\nNAPSTAT.EXE\n\nnetsh.exe\n\nNETSTAT.EXE\n\nraserver.exe\n\nwscript.exe\n\n\ntaskhost.exe\n\nrundll32.exe\n\nsystray.exe\n\naudiodg.exe\n\nwininit.exe\n\nservices.exe\n\nautochk.exe\n\nautoconv.exe\n\nautofmt.exe\n\nwuapp.exe\n\ncmd.exe\n\nrdpclip.exe\n\ncontrol.exe\n\n\nAdopting a similar approach as before, the launched process is created in a suspended\nstate. It is then appropriated through use of a section object and a shared view, as well as\nAPI calls to SetThreadContext and NtResumeThread:\n\n_Figure 4: The final benign process launched in a suspended state_\n\nUnder a separate invocation of xLoader, a scan of the active processes in the analysis\nenvironment reveals two suspicious instances, with threads of execution having an unusual\norigin:\n\n_Figure 5: Injected threads with suspicious origins_\n\n\n-----\n\nWith the chain of startup process-injection completed, xLoader deletes itself from disk by\ninvoking cmd.exe:\n\n_Figure 6: Self-deletion using cmd.exe_\n\n### Persistence\n\nPersistence is achieved using the Windows registry, by creating an entry in the\nHKey_Current_User hive: HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\\n<RANDOM> REG_SZ\n\nThis entry points to a copy of itself dropped in a randomly-named subfolder of C:\\Program\nFiles (x86):\n\n_Figure 7: Persistence via Windows Registry HKCU hive_\n\n### Command & Control:\n\nHandling of C2 requests remains the responsibility of the first-stage code running inside\nexplorer.exe. The initial check-in with the channel comprises the following basic host\ninformation:\n\n1.   Handshake bytes (“XLNG”)\n\n2.   Hash of the user’s Windows Security Identifier (SID) (“28BED20C”)\n\n3.   Version of xLoader (“2.3”)\n\n\n-----\n\n4.   Operating system version and bitness (x64)\n5.   Username, Base64 encoded\n\n_Figure 8: Execution context included in the initial C2 POST check-in_\n\nThis host “fingerprint” is encrypted and Base64 encoded prior to transmission.\n\nRepeated sandbox analysis shows xLoader randomly selecting 16 C2 domains from an\nembedded pool of 43, with only one being the genuine C2 host. Other domains may be\nincluded, to make C2 traffic less obvious, or harder to identify against a backdrop of benign\nHTTP requests. Each domain in the set is contacted an equal amount in a round-robin\nfashion. Check-in attempts are made at five-second intervals and continue indefinitely.\n\nThe campaign ID for the analyzed build is “ipa8,” which is included in the GET request:\n\n_Figure 9: GET request to xLoader C2 with encoded host identification_\n\nWhen check-in succeeds, xLoader can be instructed to:\n\nDownload and launch additional payloads\nUpload screenshots\nIntercept and steal user credentials or cookies\nCommence keystroke logging\nTerminate and uninstall\nSteal clipboard contents\n\n### One Tool to Bind Them\n\nSubscription to xLoader includes access to a free Java-based tool called xBinder, that\ncombines Windows and macOS executables into a single, portable .jar file. Given Java’s\nprevalence, this is an attractive feature. It makes crafting email attachments for social\nengineering or watering hole downloads possible avenues for attack.\n\nWithin the .jar file, the macOS and Windows executables are bundled and encrypted using\nAES with a static key. When launched, a runtime probe identifies the host operating system.\nIt then drops and executes the corresponding payload.\n\nA version of xBinder can be found in VirusTotal, indicating a possible leak or accidental\nupload. A handful of analyzed xBinder-generated .jar files contained benign macOS\ncommand line tools, such as “/bin/ls,” together with malicious Windows executables from\nthese different families:\n\n\n-----\n\nAzorult (info stealer)\nSnake (info stealer)\nNeshta (file infector)\nGuloader (downloader)\n\nThis mismatched bundling of benign files together with malicious code from disparate\nmalware families suggests unsanctioned use of xBinder by groups or individuals, rather\nthan paying subscribers.\n\n_Figure 10: xBinder tool for creating Mac and Windows .jar files_\n\n### Conclusion\n\nxLoader promotes itself among the rank-and-file of underground MaaS offerings as cheap,\nhighly functional and resilient. With its evasive and mature binaries for both macOS and\nWindows, together with the provision of a free binding tool that caters to more indiscriminate\ntargeting, xLoader’s offering has appeal for both fledgling cyber criminals and larger, more\norganized groups.\n\n### YARA Rule\n\nThe following YARA rule was authored by the BlackBerry Research & Intelligence Team to\ncatch the threat described in this document:\n\n\n-----\n\nimport \"pe\"\n\nrule xLoaderInfoStealer\n\n{\nstrings:\n$hx_enc_buff = { 57 50 E8 B0 E6 FF FF 8B F8 83 C4 04 80 3F 55 75 79 80 7F 01\n8B 75 73 }\n\ncondition:\n\npe.is_pe and\n\npe.number_of_imported_functions == 0 and\n\npe.number_of_imports == 0 and\n\nall of ($hx*)\n\n}\n\n### Indicators of Compromise (IoCs)\n\n**Network:**\n\nwww[.]abolad[.]com\n\nwww[.]addisonbleu[.]com\n\nwww[.]am-conseil-communication[.]com\n\nwww[.]askaboutaduhelm[.]com\n\nwww[.]astyaviewer[.]com\n\nwww[.]bainrix[.]com\n\nwww[.]beaumontcycleworks[.]com\n\nwww[.]blockchainhub360[.]com\n\nwww[.]calerie[.]coffee\n\nwww[.]calvarirumba[.]com\n\nwww[.]celiktarim[.]com\n\nwww[.]dailygame168[.]com\n\nwww[.]desarrollosolucionesnavarro[.]com (legitimate C2 domain)\n\nwww[.]edwardsrealtyfl[.]rentals\n\nwww[.]golfwifi[.]net\n\nwww[.]guapandglo[.]com\n\nwww[.]hydrarobuxobby[.]com\n\nwww[.]instrumentum[.]store\n\nwww[.]kinnonstudio[.]com\n\nwww[.]lanerbo[.]com\n\nwww[.]littlescampers[.]com\n\nwww[.]mapopi[.]com\n\nwww[.]miotir[.]com\n\nwww[.]mnavn[.]com\n\nwww[.]northwayenterprise[.]com\n\nwww[.]okwideus[.]com\n\nwww[.]oqity[.]com\n\nwww[.]pastelpastrybakery[.]com\n\nwww[.]plastings[.]com\n\nwww[.]poolsnation[.]com\n\nwww[.]privedenim[.]com\n\nwww[.]registernowhd[.]xyz\n\n\n-----\n\nwww[.]rixmusic[.]com\nwww[.]royalposhpups[.]com\nwww[.]rwaafd[.]com\nwww[.]sazekav[.]com\nwww[.]serialmixer[.]icu\nwww[.]tailored2fit[.]online\nwww[.]thebandaiderepair[.]com\nwww[.]therightmilitia[.]com\nwww[.]theutahhomestore[.]com\nwww[.]visions-agency[.]com\nwww[.]votekellykitashima[.]com\nwww[.]xiang-life[.]net\n\n**Registry:**\n\nHKCU\\Software\\Microsoft\\CurrentVersion\\Run\\<RANDOM> (REG_SZ)\n\n**File system:**\n\nC:\\Program Files (x86)\\<RANDOM>\\<Random>.exe\n\n**SHA256:**\n\n9f7b903ab126b2a3a0ca3c5977bbf84111f52a6e3a6e43aa127763e1a46b8f2d (xLoader\nPE)\n693d6f0ac1e3f5e3e5b68c45d2a77bcc9d8976f7b091d5bfa1e719ad8b97fd25 (xBinder\nJAR)\n\n### BlackBerry Assistance\n\nIf you’re battling this malware or a similar threat, you’ve come to the right place, regardless\nof your existing BlackBerry relationship.\n\n[The BlackBerry Incident Response team is made up of world-class consultants dedicated to](https://www.blackberry.com/us/en/services/incident-response)\nhandling response and containment services for a wide range of incidents, including\nransomware and Advanced Persistent Threat (APT) cases.\n\nWe have a global consulting team standing by to assist you by providing around-the-clock\nsupport, if required, as well as local assistance. Please contact us\nhere: https://www.blackberry.com/us/en/forms/cylance/handraiser/emergency-incidentresponse-containment\n\n_For more information about this threat, watch our new demo video,_\n\n[BlackBerry vs. xLoader Infostealer.](https://www.youtube.com/watch?v=XBuViOYhG-k)\n\n\n-----\n\n## About The BlackBerry Research & Intelligence Team\n\nThe BlackBerry Research & Intelligence team examines emerging and persistent threats,\nproviding intelligence analysis for the benefit of defenders and the organizations they serve.\n\nBack\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-09-30 - Threat Thursday- xLoader Infostealer.pdf"
    ],
    "report_names": [
        "2021-09-30 - Threat Thursday- xLoader Infostealer.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535785,
    "ts_updated_at": 1743041139,
    "ts_creation_date": 1653779783,
    "ts_modification_date": 1653779783,
    "files": {
        "pdf": "https://archive.orkl.eu/4aa982bf2368e0ba4530ed20787ce182eaee61d8.pdf",
        "text": "https://archive.orkl.eu/4aa982bf2368e0ba4530ed20787ce182eaee61d8.txt",
        "img": "https://archive.orkl.eu/4aa982bf2368e0ba4530ed20787ce182eaee61d8.jpg"
    }
}