{
    "id": "88ab26d3-f6c2-408b-82e1-e118b11c86db",
    "created_at": "2023-01-12T15:08:35.024455Z",
    "updated_at": "2025-03-27T02:15:41.69806Z",
    "deleted_at": null,
    "sha1_hash": "787718827a99be5409808a496212e3bc4a680d1b",
    "title": "2020-07-13 - Internet Explorer CVE-2019–1367 In the wild Exploitation - prelude",
    "authors": "",
    "file_creation_date": "2022-05-28T03:41:59Z",
    "file_modification_date": "2022-05-28T03:41:59Z",
    "file_size": 353189,
    "plain_text": "# Internet Explorer CVE-2019–1367 In the wild Exploitation — prelude\n\n**[blog.confiant.com/internet-explorer-cve-2019-1367-in-the-wild-exploitation-prelude-ef546f19cd30](https://blog.confiant.com/internet-explorer-cve-2019-1367-in-the-wild-exploitation-prelude-ef546f19cd30)**\n\ntaha aka lordx64 July 13, 2020\n\nPhoto by on\n\n## CVE-2019–1367 background and in-the-wild exploitations\n\n[There are some important aspects to know about CVE-2019–1367 before diving into the](https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-1367)\ntechnical analysis including the intel around it and the series of events following the in-thewild exploitations and Microsoft patches.\n\n[First of all, here is the bug class of this bug based on the Google P0 report:](https://github.com/maddiestone/ConPresentations/raw/master/BluehatIL2020.VariantAnalysis.pdf)\n\n**JScript variable (represented as VAR structure) isn’t properly tracked by garbage**\n**collector**\n\n\n-----\n\nIs it important to understand the bug class. For example Google P0 will work on what they\ncall a Variant Analysis, to discover additional vulnerabilities from the same bug class.\nExample [CVE-2019–1429 is a result of Variant analysis of CVE-2019–1367.](https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-1429)\n\nIn fact, the first in the wild exploitation from this bug class was seen in December 2018,\n[exploiting CVE-2018–8653, discovered by Google TAG Team. This bug was then](https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2018-8653)\n[documented by Mcafee here and by Tetrane](https://www.mcafee.com/blogs/other-blogs/mcafee-labs/ie-scripting-flaw-still-a-threat-to-unpatched-systems-analyzing-cve-2018-8653/) [here.](https://blog.tetrane.com/Analysis_of_CVE_2018_8653_Memory_Management.html)\n\n[Google TAG Team discovered CVE-2019–1367 exploited in the wild by a threat actor. No](https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-1367)\ndetails were given at the time of Microsoft advisory.\n\nBut in a [recent blog Google TAG Team discussed that North Korea or individuals who](https://blog.google/technology/safety-security/threat-analysis-group/identifying-vulnerabilities-and-protecting-you-phishing/)\nworked on North Korea-related issues were the main targets of this in-the-wild exploitations\nbut no more elements were given regarding the threat actors behind these attacks at the\ntime of the reporting.\n\n## Who are these threat actors?\n\nBased on OSINT, and the data following this discovery, it seems that there are two main\n[threat actors known to date caught exploiting CVE-2019–1367:](https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-1367)\n\n: A suspected Korean Peninsula APT actor, considered to be a skill-full, active, long-run\n(+10 years of existence) resourceful (state sponsored?) APT actor.\n\n**Magnitude Exploit KIT: An opportunistic Malvertiser, mostly targeting south Korea.**\nMagnitude EK has been there since 2013, and known to drop very known ransomware\nfamilies including: Locky, Cerber, Magniber, CryptoWall, GranCrab.. Known to rapidly\nintegrate CVE’s into their exploitation chains. Magnitude has been active for many years,\nbelow is an tweet from 2013 showing some of their oldest CVE integrations:\n\n## So what’s CVE-2019–1367 impact?\n\n[CVE-2019–1367 enables Remote Code Execution (RCE) in the context of Internet explorer](https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-1367)\nin all version from 8, 9, 10 and 11 due to a memory corruption in jscript.dll.\n\nThis means victims will ultimately be infected with a malware just by browsing to a web page\naka 1-click exploit : Victims need to click at least one time into a link to get infected (different\nfrom 0-click exploits that requires no user interaction at all).\n\n[A scenario of 1-click exploit attack would be of watering hole type of attack, this is usually a](https://en.wikipedia.org/wiki/Watering_hole_attack#:~:text=Watering%20hole%20is%20a%20computer,more%20of%20them%20with%20malware.)\ntechnique of nation state APTs.\n\nNote: most recent iOS exploits exploited in the wild were found in watering hole\nattacks, targeting certain populations.\n\n\n-----\n\nWe also see 1-click exploit used in malvertising (malicious ads) mostly by cyber crime/FIN\nactors. In the scenario where 1-click exploits are integrated into a chain of redirects like we\nsee everyday in malicious advertising attack, this 1-click exploits could have a 0-click effect,\nsince no user interaction will be required before getting infected.\n\nEven though 1-click exploits are less valuable than 0-click exploits (and less pricey), they can\nhave a similar devastating effect if integrated at the right place.\n\nMicrosoft released a patch and encouraged users to disable jscript.dll (a Legacy dll replaced\nby jscript9.dll) that can still be called with IE-8 compatibility mode enabled. This is typically\nenabled via the following tag:\n\n_<meta http-equiv=”X-UA-Compatible” content=”IE=8\"></meta>_\n\n[To give more context regarding CVE-2019–1367 we draw a timeline of events, that we](https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-1367)\ncollected (based on OSINT)\n\n## Timeline of the events\n\n: from Google TAG Team acknowledged by Microsoft. first time cited as linked to the in\nthe wild exploitation of this bug:\n\n: confirmed that was exploiting this vulnerability:\n\nBased on the above tweet, Google Project Zero maintains a google doc referencing 0-day in[the-wild exploitation where they officially attributed CVE-2019–1367 to DarkHotel APT.](https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-1367)\n\n: Samples from exploits were uploaded to VirusTotal and flagged as by most of the\nsecurity vendors:\n\n: Google Project Zero did a Variant Analysis of which resulted in which a variant of the\nsame bug class:\n\n[In their presentation they gave indication about the root cause of CVE-2019–1367 bug,](https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-1367)\nwhich is as following:\n\n_Function arguments not being tracked by garbage collector during callback, in_\n_jscript.dll._\n\nSo now we have a good lead on what type of object and function we need to look for this\nexploit analysis.\n\n: published details about switching to another 0-day exploit, the attack was called\n“Double Star” as it involves this time a 0-day in Internet Explorer () and a 0-day in\nFireFox (CVE-2019–17026). Same day as Microsoft published the . No more additional\ndetails were given about the vulnerability.\n\n\n-----\n\nBased on Google P0 tweet below, it seems that [CVE-2020–0674 is patching a misfix of the](https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2020-0674)\n[earlier CVE-2019–1367 suggest that](https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-1367) [CVE-2020–0674 is a variant from the same bug class:](https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2020-0674)\n\n: Kang Yang() of Qihoo 360 ATA found that the original proof of concept they sent to\nMicrosoft for was uploaded to VirusTotal. ie, the proof of concept is now available to the\nsecurity community!\n\n[After analysis of this “leak” we confirmed that CVE-2020–0674 is same bug class and is a](https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2020-0674)\nvariant of [CVE-2019–1367 :](https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-1367)\n\n: actors caught exploiting the vulnerability in the wild targeting south Korea, based on a\nreport of (a south Korean Security Vendor)\nhile analyzing recent Exploit KIT attacks from different OSINT sources, we stumbled\nupon a recent attack targeting what seems to be Korean Users. The pcaps of a\nsuccessful attack were generously provided by !\n\nWith bluegas[.]website hosting exploit code and pophot[.]website hosting ransomware:\n\n[After our analysis of the pcaps files, the attack turns out to be exploiting CVE-2019–1367! So](https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-1367)\nwe have now a proper source to analyze this exploit.\n\n: Google TAG Team confirmed in their report that, and are vulnerabilities inside jscript\nand are abusing the Enumerator object. They also give some indications about threat\nactor exploiting these vulnerabilities in the wild. Google stated that attack was targeting\nNorth Korea or individuals who worked on North Korea-related issues. This is inline\nwith Kaspersky reporting above, and in line with Magnitude Exploit Kit Targeting\nKorean users.\n: attacks on japan infrastructures involving “Double Star” exploits, attack attributed\nagain to\n\nWith last.tax-lab[.]net domain hosting exploit code and backdoor\n\n: Another related scripting engine vulnerability patched by Microsoft, caught exploited in\nthe wild by Google. Microsoft assigned, We do not know if this bug is from the same\nbug class as and, as no details were provided by Google or by Microsoft:\n\n: from F-secure released a plain CVE-2020–0674 proof of concept exploit on for\nwindows 7 x64 :\n\n: First write up of by F-secure labs, explaining the vulnerability and ways to exploit in\nx64 systems. This confirms our assumptions of being a variant of (or a missfix depends\non which angle we see it).\n\n\n-----\n\n: from Google TAG Team gave a on 0-day exploitation in the wild and shared and for\nthe first time (AFAIK) important differences between CVE-2019–1367 and CVE-2020–\n0674 bugs. This confirmed directly some of our assumptions after analyzing the POC\nof CVE-2020–0674 that was uploaded to VT see (above timeline in 29th February\n2020), and clearly helped us differentiating between the two bugs.\n\n## Elements we have so far:\n\nThe effort spent in the intel was worth it. At this point we are armed with the following:\n\nWe have pcap files from a successful exploitation.\nProof of concept code of CVE-2020–9674.\nWe know the bug class, and the vulnerable code path for both CVE-2020–0674 and\nCVE-2019–1367.\n\n## CVE-2019–1367 analysis\n\n[For this analysis, we will start writing a POC for the CVE-2019–1367 vulnerability in part1.](https://blog.confiant.com/internet-explorer-cve-2019-1367-exploitation-part-1-7ff08b7dcc8b)\n\nIn [part2 we will discuss how this vulnerability was exploited by Magnitude Exploit Kit and](https://blog.confiant.com/internet-explorer-cve-2019-1367-exploitation-part-2-8143242b5780)\n**DarkHotel APT and shed some lights on the differences.**\n\nFinally [part3 is the shellcode analysis resulting from a successful exploitation of this bug in](https://blog.confiant.com/internet-explorer-cve-2019-1367-exploitation-part-3-a92d3011b38)\nthe wild.\n\nBelow is the table of content broken-down into different parts for readability\n\n## Table of Contents:\n\nCVE-2019–1367 background and in-wild exploitations ()\nVulnerability Analysis + Proof of Concept ()\nExploitation of CVE-2019–1367 ()\nMagnitude Exploit Kit Shell code Analysis ()\n\n## Tools used of the analysis:\n\nIDA Pro v7.5\nWinDBG: TTD feature, javascript engine\nradare2 : r2pipe\nPython3\nMicrosoft Debug symbols.\n\nHappy reading !\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-07-13 - Internet Explorer CVE-2019–1367 In the wild Exploitation - prelude.pdf"
    ],
    "report_names": [
        "2020-07-13 - Internet Explorer CVE-2019–1367 In the wild Exploitation - prelude.pdf"
    ],
    "threat_actors": [
        {
            "id": "1dadf04e-d725-426f-9f6c-08c5be7da159",
            "created_at": "2022-10-25T15:50:23.624538Z",
            "updated_at": "2025-03-27T02:00:55.508759Z",
            "deleted_at": null,
            "main_name": "Darkhotel",
            "aliases": [
                "Darkhotel",
                "DUBNIUM",
                "Zigzag Hail"
            ],
            "source_name": "MITRE:Darkhotel",
            "tools": null,
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "b13c19d6-247d-47ba-86ba-15a94accc179",
            "created_at": "2024-05-01T02:03:08.149923Z",
            "updated_at": "2025-03-27T02:05:17.422065Z",
            "deleted_at": null,
            "main_name": "TUNGSTEN BRIDGE",
            "aliases": [
                "DUBNIUM ",
                "DarkHotel ",
                "CTG-1948 "
            ],
            "source_name": "Secureworks:TUNGSTEN BRIDGE",
            "tools": [
                "Nemim"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "2b4eec94-7672-4bee-acb2-b857d0d26d12",
            "created_at": "2023-01-06T13:46:38.272109Z",
            "updated_at": "2025-03-27T02:00:02.790029Z",
            "deleted_at": null,
            "main_name": "DarkHotel",
            "aliases": [
                "DUBNIUM",
                "Fallout Team",
                "Luder",
                "Tapaoux",
                "Shadow Crane",
                "APT-C-06",
                "SIG25",
                "Karba",
                "Nemim",
                "Nemin",
                "G0012",
                "ATK52",
                "T-APT-02",
                "TUNGSTEN BRIDGE",
                "Zigzag Hail"
            ],
            "source_name": "MISPGALAXY:DarkHotel",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "c0cedde3-5a9b-430f-9b77-e6568307205e",
            "created_at": "2022-10-25T16:07:23.528994Z",
            "updated_at": "2025-03-27T02:02:09.847683Z",
            "deleted_at": null,
            "main_name": "DarkHotel",
            "aliases": [
                "APT-C-06",
                "ATK 52",
                "CTG-1948",
                "Dubnium",
                "Fallout Team",
                "Higaisa",
                "Luder",
                "Operation DarkHotel",
                "Operation Daybreak",
                "Operation Inexsmar",
                "Operation PowerFall",
                "Operation The Gh0st Remains the Same",
                "SIG25",
                "Shadow Crane",
                "T-APT-02",
                "Tungsten Bridge",
                "Zigzag Hail"
            ],
            "source_name": "ETDA:DarkHotel",
            "tools": [
                "Asruex",
                "DarkHotel",
                "DmaUp3.exe",
                "GreezeBackdoor",
                "Karba",
                "Nemain",
                "Nemim",
                "Ramsay",
                "Retro",
                "Tapaoux",
                "Trojan.Win32.Karba.e",
                "Virus.Win32.Pioneer.dx",
                "igfxext.exe",
                "msieckc.exe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536115,
    "ts_updated_at": 1743041741,
    "ts_creation_date": 1653709319,
    "ts_modification_date": 1653709319,
    "files": {
        "pdf": "https://archive.orkl.eu/787718827a99be5409808a496212e3bc4a680d1b.pdf",
        "text": "https://archive.orkl.eu/787718827a99be5409808a496212e3bc4a680d1b.txt",
        "img": "https://archive.orkl.eu/787718827a99be5409808a496212e3bc4a680d1b.jpg"
    }
}