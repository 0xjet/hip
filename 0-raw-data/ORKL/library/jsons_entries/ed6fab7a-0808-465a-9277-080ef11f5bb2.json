{
    "id": "ed6fab7a-0808-465a-9277-080ef11f5bb2",
    "created_at": "2023-01-12T15:08:58.043934Z",
    "updated_at": "2025-03-27T02:05:24.339968Z",
    "deleted_at": null,
    "sha1_hash": "e40903130f26c4c3d113953ca40f01451614339d",
    "title": "2022-09-28 - Chaos Is A Go-Based Swiss Army Knife Of Malware",
    "authors": "",
    "file_creation_date": "2022-10-02T12:26:00Z",
    "file_modification_date": "2022-10-02T12:26:00Z",
    "file_size": 1500468,
    "plain_text": "# Chaos is a Go-based Swiss army knife of malware\n\n**blog.lumen.com/chaos-is-a-go-based-swiss-army-knife-of-malware/**\n\n[Black Lotus Labs\nPosted On September 28, 2022](https://blog.lumen.com/author/black-lotus-labs/)\n\n[0](https://blog.lumen.com/chaos-is-a-go-based-swiss-army-knife-of-malware/#respond)\n\n## Executive Summary\n\n\nSeptember 28, 2022\n\n\nThe prevalence of malware written in Go programming language has increased dramatically in recent years due to its\nflexibility, low antivirus detection rates and difficulty to reverse-engineer. Black Lotus Labs, the threat intelligence arm\nof Lumen Technologies, recently uncovered a multifunctional Go-based malware that was developed for both Windows\nand Linux, as well as a wide array of software architectures used in devices ranging from small office/home office\n(SOHO) routers to enterprise servers. We discovered and analyzed roughly 100 samples of the malware, named\nChaos by the actor, which was written in Chinese and leverages China-based infrastructure for command and control.\nChaos functionality includes the ability to enumerate the host environment, run remote shell commands, load additional\nmodules, automatically propagate through stealing and brute forcing SSH private keys, as well as launch DDoS\nattacks. Using Lumen global network visibility, Black Lotus Labs enumerated the C2s and targets of several distinct\nChaos clusters, including a successful compromise of a GitLab server and a spate of recent DDoS attacks targeting\nthe gaming, financial services and technology, and media and entertainment industries – as well as DDoS-as-a-service\nproviders and a cryptocurrency exchange. While the botnet infrastructure today is comparatively smaller than some of\nthe leading DDoS malware families, Chaos has demonstrated rapid growth in the last few months. Given the suitability\nof the Chaos malware to operate across a range of consumer and enterprise devices, its multipurpose functionality and\n\n\n-----\n\nthe stealth profile of the network infrastructure behind it, we assess with moderate confidence this activity is the work of\na cybercriminal actor that is cultivating a network of infected devices to leverage for initial access, DDoS attacks and\ncrypto mining.\n\n## Introduction\n\nThe potency of the Chaos malware stems from a few factors: first, it is designed to work across several architectures,\nincluding: ARM, Intel (i386), MIPS and PowerPC – in addition to both Windows and Linux operating systems. Second,\n[unlike largescale ransomware distribution botnets like Emotet that leverage spam to spread and grow, Chaos](https://blog.lumen.com/emotet-redux/?utm_source=referral&utm_medium=black+lotus+labs+page)\npropagates through known CVEs and brute forced as well as stolen SSH keys.\n\nIn the course of our analysis, we frequently observed source file names incorporating “Chaos” as well as references to\nChaos in various function names, and self-signed X.509 certificates. We assess, based on code and function overlap,\n[Chaos is the evolution of the DDoS malware Kaiji. At this point in time, we also assess this campaign is distinct from](https://malpedia.caad.fkie.fraunhofer.de/details/elf.kaiji)\n[the Chaos ransomware builder which was previously referenced here.](https://www.trendmicro.com/en_us/research/21/h/chaos-ransomware-a-dangerous-proof-of-concept.html)\n\n### Technical Details\n\nFigure 1: Chaos infection chain\n\nAt a high level, the Chaos infection chain can be summarized as follows: Chaos is installed on a host device,\nestablishes persistence and beacons out to the embedded C2. The host then receives one or more staging commands\ndepending on the sample and the host environment: these include commands to initialize propagation through\nexploiting a known CVE, to automatically propagate through SSH via brute-forcing or leveraging stolen SSH keys and\nto begin IP spoofing. Based on the first set of commands, the host may receive a number of additional execution\ncommands including performing propagation via the designated CVE and specified target lists, further exploitation of\nthe current target, launching a specific type of DDoS attack against a specified domain or IP and port, and performing\ncrypto mining.\n\n## Staging Commands\n\nBecause we first discovered Chaos through analyzing samples from a public malware repository, we have not yet\nascertained the initial access vector. However, we determined that once on an infected Windows device, Chaos\ncreates a mutex by binding to a UDP port that is determined by the first few digits of the device’s MAC address,\nignoring leading zeros. For example, with the MAC address 08-00-2x-xx-xx-xx, the port becomes 0x8002 or 32770.\nThis method of converting to hex obscures the port from being readily discernible in the code, perhaps to shield it from\nanalysis. If the sample is unsuccessful at binding to the port, then the program exits, likely to ensure that only one\ninstance of the malware runs concurrently on the infected machine.\n\n\n-----\n\nFigure 2: Method that generates the host port to bind to in a Windows device\n\nIn its first outreach to the C2, Chaos decodes the Base64-encoded C2 and port combination and sends a beacon that\nincludes the word “online,” the Windows version and the architecture of the host. Next, it creates a registry key for\npersistence at the following path: HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run and\ncopies itself to the file \\Program Data\\Microsoft\\csrss.exe. It then adds to the newly created registry key under the\n\n\n-----\n\nname Administrator and attempts to complete a TLS handshake with the C2. The handshake process loops until it\nmakes contact, at which point it gathers additional information about the infected host. If the Windows version fails, the\nstring “windwos 未知“ is sent in its place. (Note the typo in “windows.” The Chinese characters translate to “unknown.”)\n\nFigure 3: Snapshot of strings for different Windows versions\n\nOnce an infected machine establishes a socket with the hardcoded C2, the C2 responds with a set of staging\ncommands, including initialization commands and commands to trigger automatic propagation via SSH.\n\nThe staging commands consist of fileprot, keypassword and ipspoof. First, the fileprot command sets a new port for\naccessing additional files on the C2 that are used by other commands: password.txt, download.sh and cve.txt. The\nkeypassword provides the AES password and initialization vector needed to decrypt the three additional files. The\npassword was commonly set as “1234567812345678.”\n\nThe keypassword function also calls two functions used in compromising additional machines through SSH by using\nkeys stolen from the infected host, brute force or via the downloaded password.txt file: chaos.ssh and chaos.sshboom.\nThe chaos.ssh function reads the private key from /root/.ssh/id_rsa and then parses /root/.ssh/known_hosts and\n/root/.bash_history for the IP address of any lateral device. If it finds an IP, it tries to connect to the new address using\nthe SSH key. If successful, it assesses whether the new device is a Linux system by running uname –s, making the\nresponse all uppercase and searching for ‘LINUX.’ If ‘LINUX’ is not found, it closes the connection. If ‘LINUX’ is found,\nit then downloads the download.txt file from the IP:port location set by the fileport command.\n\nThe chaos.sshboom function is similar to the chaos.ssh function, except it downloads http://IP:PORT/passwords.txt\nand decrypts it, similar to the runcve command, using AES Cipher Block Chaining with information supplied by the\nkeypassword command. The password file contains commonly used passwords used to brute force other devices\nexposed on the internet.\n\nIf either the SSH stealing or brute-forcing attempts are successful, the download file is triggered. The download file\ncontains the IP address and port of a staging server that hosts copies of Chaos compiled for various architectures,\nsuch as x86, x86-64, AMD64, MIPS, MIPS64, ARMv5-ARMv8, AArch64 and PowerPC. Chaos uses the staging server\nnot to control the bots, but to iterate through the infection process outlined above in an effort to further propagate the\nbotnet.\n\nFigure 4: Snippet from the download.sh bash script showing Chaos modules for various architectures\n\n## Execution Commands and Additional Modules\n\n\n-----\n\nWe observed that, after receiving the initial set of commands from the C2, bots would sporadically receive additional\ncommands that included executing propagation through exploitation of pre-determined CVEs on target ranges, further\nexploiting the current target, launching DDoS attacks or initiating crypto mining. Over the course of a few days, one bot\nreceived more than 70 different commands.\n\nThe command to activate CVE exploitation is called runcve. In the command, runcve includes an IP supplied by the C2\nthat iterates upwards by a single digit in an attempt to move laterally by exploiting the CVE defined in the cve.txt file.\n[Among the samples we analyzed were reported CVEs for Huawei (CVE-2017-17215) and Zyxel (CVE-2022-30525)](https://www.huawei.com/en/psirt/security-notices/huawei-sn-20171130-01-hg532-en)\npersonal firewalls, both of which leveraged unauthenticated remote command line injection vulnerabilities. However,\n[the CVE file appears trivial for the actor to update, and we assess it is highly likely the actor leverages other CVEs. In](https://twitter.com/0xrb/status/1524652485327339520)\nthe example below, the two CVEs referenced do not contain any exploit code, but instead the phrase, in Chinese,\n“Here is the command to execute” along with a command to exploit the Zyxel CVE and a command to exploit the\nHuawei CVE.\n\nFigure 5: CVE commands from a recent Chaos sample\n\nIn addition to the new functionality the Chaos malware exhibits detailed above, the malware also includes capabilities\npreviously documented in the original Kaiji botnet: establish a reverse shell, initiate crypto mining and launch DDoS\nattacks.\n\n[The reverse shell module was an open source pearl script copied from GitHub. The script was designed to run on bash](https://gist.github.com/paul91/60371b437658093e826e)\nshells that come natively installed on Linux systems and allows an actor to run arbitrary commands on an infected\ndevice. In Chaos, the module enables the threat actor to upload, download or modify files on an infected machine.\n\n[In one instance, we received a command to download the Monero cryptocurrency miner software xmrig, along with a](https://github.com/xmrig/xmrig)\nconfiguration file. Once installed, the miner ran in the background and began to utilize the infected machine’s CPU to\ngenerate Monero for the threat actor using the following wallet ID:\n84vmv5GjgtK9hgo1Fa2fpmDykqhphzsFwcdPmodDGJPhZK3NuVdjYvhJcZfDpu1djC256zTdGM8msF2o4xxtrXm2LXwrutT.\n\n[Finally, over the course of our analysis, we observed Chaos deploying the following DDoS modules: “ddostf” and](https://blog.malwaremustdie.org/2016/01/mmd-0048-2016-ddostf-new-elf-windows.html) Bill\nGates/Setag. The “ddostf” module, which was first reported in 2016 by MalwareMustDie, enables an actor to direct\nbots to perform various types of DDoS attacks against the domain or IP and port combination of its intended targets. In\none instance, we observed a FreeBSD-compiled sample hosted on a staging server that we identified as being a Bill\nGates/Setag sample. We suspect the threat actor may have acquired the Bill Gates DDoS malware to leverage it\nspecifically against FreeBSD servers, which were not otherwise covered in the Chaos codebase.\n\n## Differences Between Windows and Linux Versions\n\n\n-----\n\nWe observed several differences between the Windows and Linux versions of the malware: how Chaos establishes\npersistence, how it beacons to the C2 and how it responds to the ipspoof command.\n\nContrasted with the persistence method for Windows described above, to establish persistence in Linux, Chaos copies\nitself to the file path /etc/id.services.conf and creates a file /etc/32678 with the contents:\n\n#!/bin/sh\n\nwhile [ 1 ]; do\n\nsleep 60\n\n/etc/id.services.conf\n\ndone.\n\nThe Linux version also employs a slightly different beacon than the Windows version as described above: the uname\nfunction still gathers the operating system information, but it does not appear to send the architecture information. If the\ncall to unname fails, a response in Chinese is sent: 获取失败, which translates in English to “GET failed.”\n\nWhile the Windows version ignores the ipspoof command and likely does not implement IP spoofing functionality at\nthis time, the Linux version uses the command to set the socket option to IP_HDRINCL to use the IP sent with the\ncommand. The ipspoof command sets headers to an IP based on an altered version of the second octet of the bot IP:\nthe second octet is one less than the infected IP and it is sent 30 times, subtracting one digit from the last IP each time.\nWe assess this is meant to spoof the header during a DDoS attack to appear as if the packets are coming from a\nrange of IPs rather than a single bot.\n\n## Correlations to the Kaiji Botnet\n\nBased upon our analysis of the functions within the more than 100 samples we analyzed for this report, we assess\nChaos is the next iteration of the Kaiji botnet. Kaiji was originally discovered in 2020 targeting Linux-based AMD and\ni386 servers by leveraging SSH brute forcing to infect new bots and then launch DDoS attacks.\n\n[Since the most recent Kaiji report, Chaos has evolved the original capabilities to include modules for new](https://www.trendmicro.com/en_us/research/20/f/xorddos-kaiji-botnet-malware-variants-target-exposed-docker-servers.html)\narchitectures, as well as the Windows OS. Chaos also leverages additional propagation mechanisms, including CVE\nexploitation and SSH key harvesting.\n\n\n-----\n\nFigure 6: Comparison of select Kaiji (left) and Chaos (right) functions\n\n### Black Lotus Labs Telemetry\n\nOnce we analyzed the Chaos functions outlined above, we associated other samples with the malware and compiled a\nlist of embedded command and control domains the bots would communicate with once infected. Using Black Lotus\nLabs global telemetry, we identified hundreds of unique IP addresses representing compromised Chaos bots from midJune through mid-July – before a marked uptick in staging server C2s. While the bots were most heavily concentrated\nin Europe, they were distributed across the globe, with hotspots in North and South America, as well as Asia Pacific.\n(Note: We did not observe any bots located in Australia or New Zealand.)\n\nFigure 7: Global distribution of Chaos bots during the snapshot from mid-June to mid-July\n\n## Chaos Self-Signed Certificates\n\nWhile analyzing the IP address of a staging server hosting additional modules, we noted it had an abnormal selfsigned certificate that displayed the organization name of “Chaos”.\n\nFigure 8: Example of a Chaos self-signed certificate\n\nWe then searched for IP addresses with similar self-signed certificates that contained the word “Chaos” in the\norganization name and discovered 15 active nodes at the time. The earliest certificate was generated on April 16,\n2022; we assess this was when the Chaos activity cluster was first launched in the wild. Since then, the number of\nChaos self-signed certificates has shown marked growth; the total more than doubled in May with 39 and we tallied 93\nin the month of August. September has already surpassed August with 111 as of Sept. 27. We observed interactions\n\n\n-----\n\nwith these servers from both embedded Linux devices as well as enterprise servers, such as one in Europe that was\nhosting an instance of GitLab. Like the Chaos bots depicted in the heatmap above, the majority of the entities\ncommunicating with the staging servers were located in Europe with few devices distributed globally.\n\nFigure 9: Month by month breakdown of new Chaos certificates based on first observation in the wild\n\n## Recent DDoS Targets\n\nOver the first few weeks of September, our Chaos host emulator received multiple DDoS commands targeting roughly\ntwo dozen organizations’ domains or IPs. Using our global telemetry, we identified multiple DDoS attacks that coincide\nwith the timeframe, IP and port from the attack commands we received. Attack types were generally multi-vector\nleveraging UDP and TCP/SYN across multiple ports, often increasing in volume over the course of multiple days.\nTargeted entities included gaming, financial services and technology, media and entertainment, and hosting. We even\nobserved attacks targeting DDoS-as-a-service providers and a crypto mining exchange. Collectively, the targets\nspanned EMEA, APAC and North America.\n\nOne gaming company was targeted for a mixed UDP, TCP and SYN attack over port 30120. Beginning September 1 –\nSeptember 5, the organization received a flood of traffic over and above its typical volume. A breakdown of traffic for\nthe timeframe before and through the attack period shows a flood of traffic sent to port 30120 by approximately 12K\ndistinct IPs – though some of that traffic may be indicative of IP spoofing.\n\nFigure 10: Gaming company DDoS attack volume\n\nA few of the targets included DDoS-as-a-service providers. One markets itself as a premier IP stressor and booter that\noffers CAPTCHA bypass and “unique” transport layer DDoS capabilities. In mid-August, our visibility revealed a\nmassive uptick in traffic roughly four times higher than the highest volume registered over the prior 30 days. This was\nfollowed on September 1 by an even larger spike of more than six times the normal traffic volume.\n\n\n-----\n\nFigure 11: DDoS-as-a-service organization incoming attack volume\n\n## Conclusion\n\nWhile the shift to Go-based malware has been underway for the last few years, there are few strains that demonstrate\nthe breadth of Chaos in terms of the wide array of architectures and operating systems it was designed to infect. Not\nonly does it target enterprise and large organizations but also devices and systems that aren’t routinely monitored as\npart of an enterprise security model, such as SOHO routers and FreeBSD OS. And with a significant evolution from its\npredecessor, Chaos is achieving rapid growth since the first documented evidence of it in the wild.\n\nBlack Lotus Labs has null-routed the Chaos C2s across the Lumen global backbone and added the IoCs from this\ncampaign into the threat intelligence feed that fuels the Lumen Connected Security portfolio. We will continue to\nmonitor for new infrastructure, targeting activity and expanding TTPs, as well as collaborate with the security research\ncommunity to share findings related to this activity.\n\nWe encourage the community to monitor for and alert on these and any similar IoCs. We also advise the following:\n\nNetwork defenders: One of the main ways Chaos spreads is through exploitation of known vulnerabilities. Ensure\neffective patch management of newly discovered CVEs. Use the IoCs outlined in this report to monitor for a\nChaos infection, as well as connections to any suspicious infrastructure.\nConsumers with SOHO routers: Follow best practices of regularly rebooting routers and installing security\nupdates and patches. Users should leverage properly configured and updated EDR solutions on hosts and\nregularly update software consistent with vendor patches where applicable.\nRemote workers: Change default passwords and disable remote root access on machines that don’t require it.\nStore SSH keys securely and only on devices that require them.\n\nWe recommend that businesses consider comprehensive Secure Access Service Edge (SASE) and DDoS\nmitigation protections to bolster their security postures and enable robust detection on network-based\ncommunications.\n\n[For additional IoCs associated with this campaign, please visit our GitHub page.](https://github.com/blacklotuslabs/IOCs/blob/main/Chaos_IoCs.txt)\n\nIf you would like to collaborate on similar research, please contact us on Twitter @BlackLotusLabs.\n\nThis analysis was performed by Danny Adamitis, Steve Rudd and Stephanie Walkenshaw.\n\nThis information is provided “as is” without any warranty or condition of any kind, either express or implied. Use of this\ninformation is at the end user’s own risk.\n\nServices not available everywhere. ©2022 Lumen Technologies. All Rights Reserved.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-09-28 - Chaos Is A Go-Based Swiss Army Knife Of Malware.pdf"
    ],
    "report_names": [
        "2022-09-28 - Chaos Is A Go-Based Swiss Army Knife Of Malware.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536138,
    "ts_updated_at": 1743041124,
    "ts_creation_date": 1664713560,
    "ts_modification_date": 1664713560,
    "files": {
        "pdf": "https://archive.orkl.eu/e40903130f26c4c3d113953ca40f01451614339d.pdf",
        "text": "https://archive.orkl.eu/e40903130f26c4c3d113953ca40f01451614339d.txt",
        "img": "https://archive.orkl.eu/e40903130f26c4c3d113953ca40f01451614339d.jpg"
    }
}