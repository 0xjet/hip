{
    "id": "03f1e22c-795e-477a-bbca-02f0b2f46c6c",
    "created_at": "2023-01-12T15:09:50.353155Z",
    "updated_at": "2025-03-27T02:12:11.143378Z",
    "deleted_at": null,
    "sha1_hash": "41c0c7330d761499ccfa63096469a46d397377bd",
    "title": "2020-02-14 - LokiBot- dissecting the C&C panel deployments",
    "authors": "",
    "file_creation_date": "2022-05-28T19:45:40Z",
    "file_modification_date": "2022-05-28T19:45:40Z",
    "file_size": 790790,
    "plain_text": "# LokiBot: dissecting the C&C panel deployments\n\n**[virusbulletin.com/virusbulletin/2020/02/lokibot-dissecting-cc-panel-deployments/](https://www.virusbulletin.com/virusbulletin/2020/02/lokibot-dissecting-cc-panel-deployments/)**\n\n### Aditya K Sood\n\nTable of contents\n\nIntroduction\n\nLokiBot C&C panel: characteristics\n\nLokiBot C&C panel: components\n\nEmpirical analysis: C&C deployments\n\nInferences\n\nConclusion\n\nReferences\n\n## Introduction\n\nFirst advertised as an information stealer and keylogger when it appeared in underground\nforums in 2015, LokiBot has added various capabilities over the years and has affected\nmany users worldwide. LokiBot is deployed as a botnet, where a number compromised\nsystems installed with the malware connect with command-and-control (C&C) servers in\norder to send stolen data and receive commands from the botnet operator.\n\nLokiBot has been distributed via phishing campaigns that include malicious attachments or\nembedded URLs [1]. More recently it has also been found to hide its source code in image\nfiles [2], using the technique known as steganography. LokiBot installs itself via a\ndownloaded zipped file, which is deleted (in order to avoid detection) once the system has\nbeen infected. The malware steals credentials from the compromised system. The stolen\ndata is compressed and exfiltrated via an HTTP channel to a C&C panel.\n\nIn this research, we conducted an analysis of the URL structure of the LokiBot C&C panels\nand how these have evolved over time, concentrating on the C&C panel entry points. In this\npaper the ‘entry point’ refers to the web access point used by the botnet operator to\nmanage the botnet. This is basically a PHP web-based C&C panel component that gives\nthe botnet operator administrator capabilities. We also highlight the gate component that is\nused as an entry point for the bots to communicate and transmit data. The gate can be\nconsidered one of the primary components of the C&C panel design because it provides\ngateway and filtering functionalities. In the majority of cases the gate component resides on\nthe same server as the C&C panel, but it can be configured or changed accordingly.\n\n\n-----\n\nThe aim of this research is to build intelligence for detection and prevention solutions\nincluding security analytics.\n\n## LokiBot C&C panel: characteristics\n\nIn this section we look at the characteristics of the LokiBot C&C panel. A number of pointers\nare provided below:\n\nThe LokiBot C&C panel is designed to use HTTP protocol as its communication\nmechanism.\nThe C&C panel is entirely developed using PHP. The LokiBot C&C panel v3.0 base is\nbuilt using PHP, which is used in conjunction with C++ and C# (the malware is written\nin these languages).\nThe LokiBot C&C panel consists of two main components: the main administrative\npanel used by the botnet operator to administer the botnet, and the gate component\nthat provides filtering capabilities so that data received from the compromised\nsystems can be examined and bots can be verified. Other components are developed\nto ease the handling and management of stolen data from the compromised\nmachines. (The C&C panel components are discussed in detail in the next section.)\nThe data exfiltrated from the compromised endpoints is sent to the C&C panel in a\ncompressed format over HTTP. The data is received by the gate component, which\nvalidates the authenticity of the data by checking the identity of the bot before the data\nis processed by the backend database and retrieved by the main C&C panel for the\nbotnet operator to use it.\nLokiBot transmits data in zipped format and data log files are decrypted using a\ncustom encryption and decryption algorithm that is used in conjunction with a Base-64\nencoding/decoding mechanism.\nThe LokiBot C&C panel can be deployed with anti‑automation mechanisms to restrict\naccount cracking attempts over HTTP. For that, a CAPTCHA is supported by the C&C\npanel. Figure 1 shows an example of a LokiBot C&C panel with CAPTCHA\nimplementation; Figure 2 shows an example of a LokiBot C&C panel without\nCAPTCHA implementation.\n\n\n-----\n\nFigure 1: LokiBot C&C panel with CAPTCHA.\n\n\n-----\n\nFigure 2: LokiBot C&C panel without CAPTCHA.\n\n## LokiBot C&C panel: components\n\nThe basic structure of the LokiBot C&C panel with all the related components is outlined in\nTable 1.\n\n|S. No|Component|Details|\n|---|---|---|\n|1|index.php|Main landing page of the C&C panel from where access is granted to the botnet operator.|\n|2|gate.php|Intermediate proxy component that acts as an interface between the main C&C panel and the bots running on the compromised machines.|\n|3|functions.php|Supporting functions such as error_reporting, base64Decrypt and traffic_decrypt are defined in this component.|\n|4|install.php|Web component used to effectively deploy the C&C panel before spreading infections. The component installs the backend database, etc. to handle the stolen data, providing search capability, configuration tasks for the loader and others.|\n|5|settings.php|This component configures the settings of the C&C panel including error handling, authentication, authorization, database configuration and others.|\n|6|auth.php|This is the module deployed to configure the authentication for the C&C panel including how the gate authenticates itself to the C&C panel before storing stolen data in the database.|\n|7|viewer.php|This component provides viewing capability to the botnet operator in the C&C panel so that data management is easy.|\n|8|converter.php|This component provides converting capabilities to handle data in more efficient ways. For example, NetScapeToJson is used to convert cookies to JSON format.|\n|9|search.php|This component provides a search capability to enable the botnet operator to search for and find specific data from the dump of stolen information stored in the backend database.|\n|10|loader.php|This component is used to load the stolen data from the infected machines that is transferred by the gate component into the database and keep updating the records. This component also loads data from the database to the main C&C panel.|\n\n\n-----\n\n|11|logs/|Folder used to store logs about stolen data and system-related errors.|\n|---|---|---|\n|12|tmp/|Temporary folder used to store the modules that are not required after installation of the C&C panel.|\n|13|stealer/|Folder used to store a text file that defines the rules for the bot to steal data from specific URLs and domains. The file is passed to the bot running on the compromised system.|\n|14|assets/|Folder used to store modules related to GeoIP, CSS for effective managing and laying out of data in the C&C panel.|\n\n\nTable 1: LokiBot C&C panel modules and components.\n\nThe LokiBot C&C panel uses a gate component [3], which is written in PHP. Listing 1 shows\nhow the LokiBot gate component extracts the source IP of the bot from which the\nconnection is initiated. The extracted and analysed headers from the incoming HTTP traffic\nare presented below:\n\nX-Forwarded-For (or X-Forwarded-IP) shows that the source IP address is behind a\nproxy or a load balancer.\nHTTP_CF_CONNECTING_IP shows that the source IP address is behind the\nCloudflare Content Delivery Network (CDN).\nX-ProxyUser-IP shows that the source IP address is behind Google Services.\nX-Real-IP shows that the source IP address is behind a load balancer.\n\n\n-----\n\nListing 1: Module used by LokiBot for C&C authentication.\n\nListing 2 shows the basic authentication that can be configured to access the C&C panel.\nForm-based authentication is also supported.\n\nListing 2: Module used by LokiBot for C&C authentication.\n\n\n-----\n\nListing 3 shows how LokiBot decrypts the log files that are received from the compromised\nsystems. The log file is decoded (or decrypted) using the ‘base64Decrypt’ function. The\nzipped file is extracted and passed to the ‘TRAFFIC_DECRYPT’ function, which decrypts\nthe file to retrieve the stolen data. Once that operation is performed, a clean zip file\ncontaining the stolen data is created and then stored in the directory.\n\nListing 3: Module used by LokiBot for C&C authentication.\n\nListing 4 shows the support functions that are defined in the functions.php file. The\n‘base64Decrypt’ and ‘TRAFFIC_DECRYPT’ functions highlight how the data decryption\nroutines are handled in the C&C panel.\n\n\n-----\n\nListing 4: Module used by LokiBot for C&C authentication.\n\nIn the next section we discuss the result of the empirical analysis performed to analyse\nC&C panel URLs.\n\n## Empirical analysis: C&C deployments\n\nWe looked into 1,960 different LokiBot C&C panel URLs deployed in real time. All the\ndeployments of the C&C panels were using PHP as the main component. The complete\nURLs comprised both domain names and IP addresses. Generally, IP addresses are used\nin C&C panels to avoid DNS queries so that DNS traffic can be avoided from the\ncompromised endpoint. This way, the endpoints can connect directly with the C&C panel by\ninitiating the connection to IP address. The data analysis was performed on the primary\nC&C panel component, i.e. the main entry PHP web page that is used by the botnet\noperator to administer the botnet.\n\nTable 2 highlights the C&C components utilizing the PHP page as the entry point for the\nbotnet operators to manage the LokiBot instances in the real world. Table 3 highlights the\npercentage layout of the LokiBot C&C entry points deployed in real time.\n\n**LokiBot C&C entry point** **Server-side language: C&C panel** **Usage**\n\n‘PvqDq929BSx_A_D_M1n_a.php’ PHP 1,861\n\n‘pen.php’ PHP 31\n\n|LokiBot C&C entry point|Server-side language: C&C panel|Usage|\n|---|---|---|\n|‘PvqDq929BSx_A_D_M1n_a.php’|PHP|1,861|\n\n\n-----\n\n|‘desk.php’|PHP|18|\n|---|---|---|\n|‘omc.php’|PHP|12|\n|‘uMc.php’|PHP|17|\n|‘sand.php’|PHP|03|\n|‘Pvq.php’|PHP|12|\n|‘cs.php’|PHP|04|\n|‘loki.php’|PHP|02|\n\n\nTable 2: Deployed LokiBot C&C instances.\n\n**Lokibot C&C entry point** **Percentage**\n\n‘PvqDq929BSx_A_D_M1n_a.php’ 94.95%\n\n‘pen.php’ 1.58%\n\n‘desk.php’ 0.92%\n\n‘omc.php’ 0.61%\n\n‘uMc.php’ 0.87%\n\n‘sand.php’ 0.15%\n\n‘Pvq.php’ 0.61%\n\n‘cs.php’ 0.20%\n\n‘loki.php’ 0.10%\n\nTable 3: Percentage analysis of total instances of LokiBot C&C panels.\n\nThe details presented here highlight the different entry points that are configured for LokiBot\nC&C panel communication.\n\n## Inferences\n\n1. Approximately 95% of LokiBot deployments in real time use\n\n‘PvqDq929BSx_A_D_M1n_a.php’ as the main entry point.\n\n|Lokibot C&C entry point|Percentage|\n|---|---|\n|‘PvqDq929BSx_A_D_M1n_a.php’|94.95%|\n|‘pen.php’|1.58%|\n|‘desk.php’|0.92%|\n|‘omc.php’|0.61%|\n|‘uMc.php’|0.87%|\n|‘sand.php’|0.15%|\n|‘Pvq.php’|0.61%|\n|‘cs.php’|0.20%|\n|‘loki.php’|0.10%|\n\n\n-----\n\n2. The admin in the string PvqDq929BSx_A_D_M1n_a.php is represented as\n\n‘_A_D_M1n_a.php’ to avoid standard-level detections that analyse basic URL\nstructure.\n3. The other C&C entry points – ‘desk.php’, ‘sand.php’, ‘omc.php’, ‘uMc.php’, etc. –\n\nrepresent just 5% of the dataset chosen for analysis, which shows that an obfuscated\nstring is preferred in the resource naming for the C&C entry point.\n4. The majority of the LokiBot C&C deployments are configured over HTTP without TLS,\n\ni.e. a non‑HTTPS channel is used for communication. As a result, all the\ncommunication can be seen over an unencrypted channel. LokiBot does provide\nHTTPS support but it has to be configured explicitly.\n5. From the compromised machines, the stolen data transmitted by the bot is received\n\nby the gate component first, which analyses the data to verify the authenticity of the\nbot. Once the bot identity is established, the stolen data is transmitted to the backend\nstorage so that it can be analysed and accessed in the C&C panel.\n\n## Conclusion\n\nConducting an empirical analysis of LokiBot’s C&C structure helps to build intelligence that\ncan be used to enhance the detection and prevention efficacy of security solutions. It also\nhelps to unearth the advancements in techniques used by the attackers to trigger infections\nand steal data.\n\n## References\n\n[1] Newly Discovered Infostealer Attack Uses LokiBot. Fortinet.\n[https://www.fortinet.com/blog/threat-research/new-infostealer-attack-uses-lokibot.html.](https://www.fortinet.com/blog/threat-research/new-infostealer-attack-uses-lokibot.html)\n\n[2] LokiBot malware now hides its source code in image files. ZDNet.\n[https://www.zdnet.com/article/lokibot-information-stealer-now-hides-malware-in-image-files/.](https://www.zdnet.com/article/lokibot-information-stealer-now-hides-malware-in-image-files/)\n\n[3] Sood, A.K.; Bansal, R. Prosecting the Citadel botnet – revealing the dominance of the\nZeus descendent: part one. https://www.virusbulletin.com/virusbulletin/2014/09/prosectingcitadel-botnet-revealing-dominance-zeus-descendent-part-one.\n\n## Latest articles:\n\n### Cryptojacking on the fly: TeamTNT using NVIDIA drivers to mine cryptocurrency\n\n\n-----\n\nTeamTNT is known for attacking insecure and vulnerable Kubernetes deployments in order\nto infiltrate organizations’ dedicated environments and transform them into attack\nlaunchpads. In this article Aditya Sood presents a new module introduced by…\n\n### Collector-stealer: a Russian origin credential and information extractor\n\nCollector-stealer, a piece of malware of Russian origin, is heavily used on the Internet to\nexfiltrate sensitive data from end-user systems and store it in its C&C panels. In this article,\nresearchers Aditya K Sood and Rohit Chaturvedi present a 360…\n\n### Fighting Fire with Fire\n\nIn 1989, Joe Wells encountered his first virus: Jerusalem. He disassembled the virus, and\nfrom that moment onward, was intrigued by the properties of these small pieces of selfreplicating code. Joe Wells was an expert on computer viruses, was partly…\n\n### Run your malicious VBA macros anywhere!\n\nKurt Natvig wanted to understand whether it’s possible to recompile VBA macros to another\nlanguage, which could then easily be ‘run’ on any gateway, thus revealing a sample’s true\nnature in a safe manner. In this article he explains how he recompiled…\n\n### Dissecting the design and vulnerabilities in AZORult C&C panels\n\nAditya K Sood looks at the command-and-control (C&C) design of the AZORult malware,\ndiscussing his team's findings related to the C&C design and some security issues they\nidentified during the research.\n\n[Bulletin Archive](https://www.virusbulletin.com/virusbulletin/archive)\n\nWe have placed cookies on your device in order to improve the functionality of this site, as\n[outlined in our cookies policy. However, you may delete and block all cookies from this site](https://www.virusbulletin.com/about-vb/privacy-policy/cookies)\nand your use of the site will be unaffected. By continuing to browse this site, you are\n[agreeing to Virus Bulletin's use of data as outlined in our privacy policy.](https://www.virusbulletin.com/about-vb/privacy-policy/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-02-14 - LokiBot- dissecting the C&C panel deployments.pdf"
    ],
    "report_names": [
        "2020-02-14 - LokiBot- dissecting the C&C panel deployments.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "f809bfcb-b200-4988-80a8-be78ef6a52ef",
            "created_at": "2023-01-06T13:46:39.186988Z",
            "updated_at": "2025-03-27T02:00:03.016358Z",
            "deleted_at": null,
            "main_name": "TeamTNT",
            "aliases": [
                "Adept Libra"
            ],
            "source_name": "MISPGALAXY:TeamTNT",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "c3ca592f-0669-49bd-ab5c-310007ab2fb4",
            "created_at": "2022-10-25T15:50:23.334495Z",
            "updated_at": "2025-03-27T02:00:55.445098Z",
            "deleted_at": null,
            "main_name": "TeamTNT",
            "aliases": [
                "TeamTNT"
            ],
            "source_name": "MITRE:TeamTNT",
            "tools": [
                "Peirates",
                "MimiPenguin",
                "LaZagne",
                "Hildegard"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673536190,
    "ts_updated_at": 1743041531,
    "ts_creation_date": 1653767140,
    "ts_modification_date": 1653767140,
    "files": {
        "pdf": "https://archive.orkl.eu/41c0c7330d761499ccfa63096469a46d397377bd.pdf",
        "text": "https://archive.orkl.eu/41c0c7330d761499ccfa63096469a46d397377bd.txt",
        "img": "https://archive.orkl.eu/41c0c7330d761499ccfa63096469a46d397377bd.jpg"
    }
}