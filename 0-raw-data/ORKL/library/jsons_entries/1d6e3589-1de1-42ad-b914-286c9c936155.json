{
    "id": "1d6e3589-1de1-42ad-b914-286c9c936155",
    "created_at": "2023-01-12T15:06:34.517141Z",
    "updated_at": "2025-03-27T02:15:37.976138Z",
    "deleted_at": null,
    "sha1_hash": "b7d262d74a2a0d4f52565a12a184a8be5fb30da5",
    "title": "2018-11-15 - tRat- New modular RAT appears in multiple email campaigns",
    "authors": "",
    "file_creation_date": "2022-05-28T19:51:37Z",
    "file_modification_date": "2022-05-28T19:51:37Z",
    "file_size": 801190,
    "plain_text": "# tRat: New modular RAT appears in multiple email campaigns\n\n**[proofpoint.com/us/threat-insight/post/trat-new-modular-rat-appears-multiple-email-campaigns](https://www.proofpoint.com/us/threat-insight/post/trat-new-modular-rat-appears-multiple-email-campaigns)**\n\n\nNovember 15, 2018\n\n\n-----\n\n[Blog](https://www.proofpoint.com/us/blog)\n[Threat Insight](https://www.proofpoint.com/us/blog/threat-insight)\ntRat: New modular RAT appears in multiple email campaigns\n\nNovember 15, 2018 Proofpoint Staff\n\n\n-----\n\n**Overview**\n\n[TA505 is one of the most prolific actors Proofpoint tracks. The group was responsible for hundreds of Dridex campaigns beginning in](https://www.proofpoint.com/us/threat-insight/post/threat-actor-profile-ta505-dridex-globeimposter)\n2014 and massive Locky campaigns in 2016 and 2017, many of which involved hundreds of millions of malicious messages\ndistributed worldwide. More recently, the group has been distributing a variety of remote access Trojans (RATs), among other\ninformation gathering, loading, and reconnaissance tools, including a previously undescribed malware we have dubbed tRat. tRat is a\nmodular RAT written in Delphi and has appeared in campaigns in September and October of this year (one of them by TA505). In this\nblog we discuss the components of these campaigns and provide a brief analysis of the malware.\n\n**Campaigns**\n\nOn September 27, 2018, Proofpoint detected an email campaign in which malicious Microsoft Word documents used macros to\ndownload a previously undocumented RAT. The documents abused the Norton brand, with the document names and embedded\nimage suggesting that they were protected by a security product. Subject lines on the messages reinforced the social engineering,\nstating \"I have securely shared file(s) with you.\" Enabling the embedded macros installed tRat. This particular campaign was spread\nby an unattributed actor, as was an apparently related campaign on September 29 that used a TripAdvisor lure (Figure 2).\n\n_Figure 1: Lure document from campaign on September 27, 2018, using stolen branding and social engineering to trick recipients into_\n_enabling malicious macros_\n\n\n-----\n\n_Figure 2: TripAdvisor lure used in a September 29, 2018, campaign, again using stolen branding and social engineering to trick users_\n_into enabling macros_\n\nOn October 11, we observed another email campaign distributing tRAT, this time by TA505. This campaign was more sophisticated,\nusing both Microsoft Word and Microsoft Publisher files, and varying subject lines and senders. This campaign appeared to target\nusers at commercial banking institutions.\n\nIn this campaign, messages bearing malicious Microsoft Publisher documents purported to be from “Invoicing”, with various sending\naddresses. Example subject lines were \"Inovice (sic) [random digits] - [random digits]\" and had attachments with names such as \"inv399503-03948.pub\". Alternatively, the emails with malicious Microsoft Word attachments appeared to be be from “Vanessa Brito\" with\nvarious actual sending addresses. Attachments were named “Report.doc” in these messages, with example subject lines such as\n\"Call Notification - [random digits] - [random digits]\n\nFigure 3 shows a sample email:\n\n\n-----\n\n_Figure 3: Sample email from campaign on October 11, 2018_\n\nIn all cases, the attachments contained macros that, when enabled, downloaded tRat.\n\n_Figure 4: Sample lure document from October 11, 2018_\n\n\n-----\n\n**Analysis**\n\nWhile we continue to analyze this malware, we have established the functioning of a number of features. In the analyzed sample, tRat\nachieves persistence by copying the binary to:\n\nC:\\Users\\<user>\\AppData\\Roaming\\Adobe\\Flash Player\\Services\\Frame Host\\fhost.exe\n\nNext, tRat creates a LNK file in the Startup directory that executes the binary on startup:\n\nC:\\Users\\<user>\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\bfhost.lnk\n\nMost of tRat’s important strings are stored encrypted and hex-encoded. A Python script is available [1] on our Github that can be used\nto decrypt its strings.\n\ntRat uses TCP port 80 for command and control (C&C) communications; data are encrypted and transmitted hex-encoded. To\ngenerate the decryption key, tRat concatenates three strings and the result is uppercase hex-encoded. The strings from the analyzed\nsample are shown below:\n\n1. \"Fx@%gJ_2oK\"\n2. \"AC8FFF33D07229BF84E7A429CADC33BFEAE7AC4A87AE33ACEAAC8192A68C55A6\"\n3. \"&LmcF#7R2m\"\n\nIt is currently unclear whether these strings change from sample to sample. In addition to generating a key, tRat uses a 1536-byte\ntable in the decryption process. As of this writing, we were not able to ascertain the meaning of all elements of the table or determine\nif it changes. However, we were able to determine that decryption involves XORing various values from the table with the encrypted\ndata. The table indexes are based on the key value, derived as described above. The table [2] from the analyzed sample and a\nPython script [3] is available on our Github that can be used to decrypt the communications.\n\ntRat’s initial phone-home network request is called \"AUTH_INF\". A decrypted example looks like:\n\nMfB5aV1dybxQNLfg:D29A79D6CD2F47389A66BB5F2891D64C8A87F05AE3E1C6C5CBA4A79AA5ECA29F8E8C8FFCA6A2892B8B6E\n\nThis string contains two substrings separated by a \":\". The first substring is a hardcoded identifier stored as an encrypted string. The\nsecond substring contains encrypted system data as shown below:\n\nFASHYEOHAL/nXAiDQWdGwORzt:3A176D130C266A4D\n\nThese data contain the computer name of the infected host, the system username and the tRat bot ID, although we have not yet\ndetermined how the bot ID is generated.\n\nIn response to the AUTH_INF phone-home, the C&C will respond with \"[P]\" or a command list. If tRat receives \"[P],\" it sends \"[G]\" in\nreply. While this appears to operate like a command poll, the precise format of the command list, commands, and module data are\nunknown. Currently, we believe that the only supported command in the loader is \"MODULE,\" which contains at least a module name\nand export name. To receive a module, tRat performs the following sequence of actions:\n\nSend \"[GET_MODULE]\"\nIf \"[WAIT_FOR_AUTH_INF]\" is received, send AUTH_INF data\nIf \"[WAIT_FOR_MODULE_NAME]\" is received, send module name\nThe response could be one of the following:\n\n\"[ERR_MODULE_NOT_FOUND]\"\n\"[ACCESS_DENIED]\"\nModule length\nIf module length is received, send a \"[READY]”\nReceive module\nThe module itself is encrypted similarly to the C&C communications, but appears to use different keys that are sent with the\nmodule\nOnce decrypted, the modules are loaded as a DLL and executed using the received export name\n\nCurrently we have not observed any modules delivered by a C&C, so we are unsure of what functionality they might add.\n\n**Conclusion**\n\nTA505, because of the volume, frequency, and sophistication of their campaigns, tends to move the needle on the email threat\nlandscape. It is not unusual for the group to test new malware and never return to distributing it as they have with BackNet, Cobalt\nStrike, Marap, Dreamsmasher, and even [Bart during their ransomware campaigns. However, we observe these new strains carefully](https://www.proofpoint.com/us/threat-insight/post/New-Bart-Ransomware-from-Threat-Actors-Spreading-Dridex-and-Locky)\n\n\n-----\n\n[as they have also adopted new malware like Locky or less widely distributed malware like FlawedAmmyy at scale following similar](https://www.proofpoint.com/us/threat-insight/post/Dridex-Actors-Get-In-the-Ransomware-Game-With-Locky)\ntests. Moreover, their adoption of RATs this year mirrors a broader shift towards loaders, stealers, and other malware designed to\nreside on devices and provide long-term returns on investment to threat actors.\n\n**Indicators of Compromise (IOCs)**\n\n\n**IOC** **IOC**\n**Type**\n\n\n**Description**\n\n\ncd0f52f5d56aa933e4c2129416233b52a391b5c6f372c079ed2c6eaca1b96b85 SHA256 tRat sample hash, September 27\ncampaign\n\ncdb8a02189a8739dbe5283f8bc4679bf28933adbe56bff6d050bad348932352b SHA256 tRat sample hash, October 11 campaign\n\n51.15.70[.]74 IP C&C\n\n**References**\n\n[1] [https://github.com/EmergingThreats/threatresearch/blob/master/tRat/decrypt_str.py](https://github.com/EmergingThreats/threatresearch/blob/master/tRat/decrypt_str.py)\n\n[2] [https://github.com/EmergingThreats/threatresearch/blob/master/tRat/table](https://github.com/EmergingThreats/threatresearch/blob/master/tRat/table)\n\n[3] [https://github.com/EmergingThreats/threatresearch/blob/master/tRat/decrypt_comms.py](https://github.com/EmergingThreats/threatresearch/blob/master/tRat/decrypt_comms.py)\n\nSubscribe to the Proofpoint Blog\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-11-15 - tRat- New modular RAT appears in multiple email campaigns.pdf"
    ],
    "report_names": [
        "2018-11-15 - tRat- New modular RAT appears in multiple email campaigns.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "99cb4e5b-8071-4f9e-aa1d-45bfbb6197e3",
            "created_at": "2023-01-06T13:46:38.860754Z",
            "updated_at": "2025-03-27T02:00:02.937438Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "SectorJ04 Group",
                "Dudear",
                "G0092",
                "ATK103",
                "Hive0065",
                "Spandex Tempest",
                "GRACEFUL SPIDER",
                "GOLD TAHOE",
                "CHIMBORAZO",
                "SectorJ04"
            ],
            "source_name": "MISPGALAXY:TA505",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "5e6b31a6-80e3-4e7d-8b0a-d94897ce9b59",
            "created_at": "2024-06-19T02:03:08.128175Z",
            "updated_at": "2025-03-27T02:05:17.400394Z",
            "deleted_at": null,
            "main_name": "GOLD TAHOE",
            "aliases": [
                "SectorJ04 ",
                "Spandex Tempest ",
                "TA505 ",
                "FIN11 "
            ],
            "source_name": "Secureworks:GOLD TAHOE",
            "tools": [
                " Cobalt Strike",
                " FlawedAmmy",
                " Get2",
                " GraceWire",
                " Malichus",
                " SDBbot",
                " ServHelper",
                " TrueBot",
                "Clop"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "75d4d6a9-b5d1-4087-a7a0-e4a9587c45f4",
            "created_at": "2022-10-25T15:50:23.5188Z",
            "updated_at": "2025-03-27T02:00:55.489882Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "TA505",
                "Hive0065",
                "Spandex Tempest",
                "CHIMBORAZO"
            ],
            "source_name": "MITRE:TA505",
            "tools": [
                "AdFind",
                "Azorult",
                "FlawedAmmyy",
                "Mimikatz",
                "Dridex",
                "TrickBot",
                "Get2",
                "FlawedGrace",
                "Cobalt Strike",
                "ServHelper",
                "Amadey",
                "SDBbot",
                "PowerSploit"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "e447d393-c259-46e2-9932-19be2ba67149",
            "created_at": "2022-10-25T16:07:24.28282Z",
            "updated_at": "2025-03-27T02:02:10.159466Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "ATK 103",
                "Chimborazo",
                "Gold Evergreen",
                "Gold Tahoe",
                "Graceful Spider",
                "Hive0065",
                "Operation Tovar",
                "Operation Trident Breach",
                "SectorJ04",
                "Spandex Tempest",
                "TA505",
                "TEMP.Warlock"
            ],
            "source_name": "ETDA:TA505",
            "tools": [
                "Amadey",
                "AmmyyRAT",
                "AndroMut",
                "Azer",
                "Bart",
                "Bugat v5",
                "CryptFile2",
                "CryptoLocker",
                "CryptoMix",
                "CryptoShield",
                "Dridex",
                "Dudear",
                "EmailStealer",
                "FRIENDSPEAK",
                "Fake Globe",
                "Fareit",
                "FlawedAmmyy",
                "FlawedGrace",
                "FlowerPippi",
                "GOZ",
                "GameOver Zeus",
                "GazGolder",
                "Gelup",
                "Get2",
                "GetandGo",
                "GlobeImposter",
                "Gorhax",
                "GraceWire",
                "Gussdoor",
                "Jaff",
                "Kasidet",
                "Kegotip",
                "Kneber",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Locky",
                "MINEBRIDGE",
                "MINEBRIDGE RAT",
                "MirrorBlast",
                "Neutrino Bot",
                "Neutrino Exploit Kit",
                "P2P Zeus",
                "Peer-to-Peer Zeus",
                "Philadelphia",
                "Philadephia Ransom",
                "Pony Loader",
                "Rakhni",
                "ReflectiveGnome",
                "Remote Manipulator System",
                "RockLoader",
                "RuRAT",
                "SDBbot",
                "ServHelper",
                "Shifu",
                "Siplog",
                "TeslaGun",
                "TiniMet",
                "TinyMet",
                "Trojan.Zbot",
                "Wsnpoem",
                "Zbot",
                "Zeta",
                "ZeuS",
                "Zeus"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535994,
    "ts_updated_at": 1743041737,
    "ts_creation_date": 1653767497,
    "ts_modification_date": 1653767497,
    "files": {
        "pdf": "https://archive.orkl.eu/b7d262d74a2a0d4f52565a12a184a8be5fb30da5.pdf",
        "text": "https://archive.orkl.eu/b7d262d74a2a0d4f52565a12a184a8be5fb30da5.txt",
        "img": "https://archive.orkl.eu/b7d262d74a2a0d4f52565a12a184a8be5fb30da5.jpg"
    }
}