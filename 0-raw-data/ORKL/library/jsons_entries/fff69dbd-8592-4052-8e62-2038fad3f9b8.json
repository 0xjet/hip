{
    "id": "fff69dbd-8592-4052-8e62-2038fad3f9b8",
    "created_at": "2023-02-02T02:07:42.683323Z",
    "updated_at": "2025-03-27T02:05:37.602355Z",
    "deleted_at": null,
    "sha1_hash": "93cb0f058cf8d7875188397160f9af601f0c3d13",
    "title": "2023-01-26 - New Mimic Ransomware Abuses Everything APIs for its Encryption Process",
    "authors": "",
    "file_creation_date": "2023-02-01T07:55:32Z",
    "file_modification_date": "2023-02-01T07:55:32Z",
    "file_size": 2263640,
    "plain_text": "# New Mimic Ransomware Abuses Everything APIs for its Encryption Process\n\n**[trendmicro.com/en_us/research/23/a/new-mimic-ransomware-abuses-everything-apis-for-its-encryption-p.html](https://www.trendmicro.com/en_us/research/23/a/new-mimic-ransomware-abuses-everything-apis-for-its-encryption-p.html)**\n\nRansomware\n\n\nJanuary 26, 2023\n\n\nTrend Micro researchers discovered a new ransomware that abuses the APIs of a legitimate tool called Everything, a Windows filename\nsearch engine developed by Voidtools that offers quick searching and real-time updates for minimal resource usage.\n\nBy: Nathaniel Morales, Earle Maui Earnshaw, Don Ovid Ladores, Nick Dai, Nathaniel Gregory Ragasa\nJanuary 26, 2023\nRead time: ( words)\n\nTrend Micro researchers discovered a new ransomware that abuses the APIs of a legitimate tool called Everything, a Windows filename\nsearch engine developed by Voidtools that offers quick searching and real-time updates for minimal resource usage. This ransomware (which\nwe named Mimic based on a string we found in its binaries), was first observed in the wild in June 2022 and targets Russian and Englishspeaking users. It is equipped with multiple capabilities such as deleting shadow copies, terminating multiple applications and services, and\nabusing Everything32.dll functions to query target files that are to be encrypted.\n\nIn this blog entry, we will take a closer look at the Mimic ransomware, its components and functions, and its connection to the Conti builder that\nwas leaked in early 2022.\n\nArrival and components\n\nMimic arrives as an executable that drops multiple binaries and a password-protected archive (disguised as Everything64.dll) which when\nextracted, contains the ransomware payload. It also includes tools that are used for turning off Windows defender and legitimate sdel binaries.\n\n\n-----\n\nFigure 1. The Mimic ransomware components\n\n**Filename** **Description**\n\n**7za.exe** **Legitimate 7zip file that is used to extract the payload**\n\n**Everything.exe** **Legitimate Everything application**\n\n**Everything32.dll** **Legitimate Everything application**\n\n**Everything64.dll** **Password protected archive that contains the malicious payloads**\n\nTable 1. Details of the Mimic ransomware components\n\nWhen executed, it will first drop its components to the %Temp%/7zipSfx folder. It will then extract the password protected Everything64.dll to\nthe same directory using the dropped 7za.exe via the following command:\n\n%Temp%\\7ZipSfx.000\\7za.exe\" x -y -p20475326413135730160 Everything64.dll\n\n\n-----\n\nFigure 2. Mimic\n\nransomware’s dropped components\nIt will also drop the session key file session.tmp to the same directory, which will be used for continuing the encryption in case the process is\ninterrupted.\n\nFigure 3. The content of session.tmp\n\nIt will then copy the dropped files to “%LocalAppData%\\{Random GUID}\\”, after which the ransomware will be renamed to bestplacetolive.exe\nand the original files deleted from the %Temp% directory.\n\nBased on our analysis, Mimic supports other command line arguments as shown in table 2.\n\n**Cmdline option** **Acceptable values** **Description**\n\n**-dir** **File path to be encrypted** **Directory for encryption**\n\n**-e**\n\nall Encrypt all (Default)\n\nlocal Encrypt Local files\n\nnet Encrypt files on Network shares\n\nwatch ul:unlocker\n\nCreates a thread with interprocess communication and tries\n\nul1 to unlock certain memory addresses from another process\n\nul2\n\n**-prot** **Protects the ransomware from being killed**\n\n**-pid** **<integer>** **The process identifier (PID) of the previously-running ransomware.**\n\nTable 2. Arguments accepted by Mimic ransomware\n\n## Mimic ransomware analysis\n\nMimic ransomware consists of multiple threads that employ the CreateThread function for faster encryption and render analysis more\nchallenging for security researchers.\n\nWhen executed, it will first register a hotkey (Ctrl + F1, using the RegisterHotKey API) that displays the status logs being performed by the\nransomware.\n\n\n-----\n\nFigure 4. The function used for registering the hotkey\n\nFigure 5. Sample logs that are shown when Ctrl +F1\n\nis pressed\nThe ransomware’s config is located at its overlay and is decrypted using the NOT Operation.\n\nFigure 6. Decryption function for the config\n\nFigure 7. Snippet from a decrypted config\n\nFigure 8 shows a more thorough look at the config and its values.\n\n\n-----\n\nFigure 8. Mimic ransomware config details\nMimic ransomware possesses a plethora of capabilities, including the following:\n\nCollecting system information\nCreating persistence via the RUN key\nBypassing User Account Control (UAC)\nDisabling Windows Defender\nDisabling Windows telemetry\nActivating anti-shutdown measures\nActivating anti-kill measures\nUnmounting Virtual Drives\nTerminating processes and services\nDisabling sleep mode and shutdown of the system\nRemoving indicators\nInhibiting System Recovery\n\n\n-----\n\n## Abusing Everything32 APIs for encryption\n\nMimic uses Everything32.dll, a legitimate Windows filename search engine that can return real time results for queries, in its routine. It abuses\nthe tool by querying certain file extensions and filenames using Everything’s APIs to retrieve the file’s path for encryption.\n\nFigure 9. Overview of the function\n\nthat utilizes Everything API\nIt uses the Everything_SetSearchW function to search for files to be encrypted or avoided using the following search format:\n\n_file:<ext:{list of extension}>file:<!endwith:{list of files/directory to avoid}>wholefilename<!{list of files to avoid}>_\n\nThe following query is used by Mimic to search for files to be encrypted or avoided:\n\nfile:\n<ext:;sql;sqlite;sqlite3;sqlitedb;mdf;mdb;adb;db;db3;dbf;dbs;udb;dbv;dbx;edb;exb;1cd;fdb;idb;mpd;myd;odb;xls;xlsx;doc;docx;bac;bak;back;zip;rar\nfile:<!endwith:QUIETPLACE> <!\"\\steamapps\\\" !\"\\Cache\\\" !\"\\Boot\\\" !\"\\Chrome\\\" !\"\\Firefox\\\" !\"\\Mozilla\\\" !\"\\Mozilla Firefox\\\" !\"\\MicrosoftEdge\\\" !\"\\Intern\nExplorer\\\" !\"\\Tor Browser\\\" !\"\\Opera\\\" !\"\\Opera Software\\\" !\"\\Common Files\\\" !\"\\Config.Msi\\\" !\"\\Intel\\\" !\"\\Microsoft\\\" !\"\\Microsoft Shared\\\"\n!\"\\Microsoft.NET\\\" !\"\\MSBuild\\\" !\"\\MSOCache\\\" !\"\\Packages\\\" !\"\\PerfLogs\\\" !\"\\ProgramData\\\" !\"\\System Volume Information\\\" !\"\\tmp\\\" !\"\\Temp\\\"\n!\"\\USOShared\\\" !\"\\Windows\\\" !\"\\Windows Defender\\\" !\"\\Windows Journal\\\" !\"\\Windows NT\\\" !\"\\Windows Photo Viewer\\\" !\"\\Windows Security\\\"\n!\"\\Windows.old\\\" !\"\\WindowsApps\\\" !\"\\WindowsPowerShell\\\" !\"\\WINNT\\\" !\"\\$WINDOWS.~BT\\\" !\"\\$Windows.~WS\\\" !\":\\Users\\Public\\\" !\":\\Users\\Defa\n!\"C:\\Users\\Win7x32\\AppData\\Local\\{ECD7344E-DB25-8B38-009E-175BDB26EC3D}\" !\"NTUSER.DAT\"> wholefilename:<!\"restore-my-files.txt\"\n!\"boot.ini\" !\"bootfont.bin\" !\"desktop.ini\" !\"iconcache.db\" !\"io.sys\" !\"ntdetect.com\" !\"ntldr\" !\"ntuser.dat\" !\"ntuser.ini\" !\"thumbs.db\" !\"session.tmp\"\n!\"Decrypt_me.txt\"> <!size:0>\n\nFigure 10. The\n\nEverything_SetSearchW API used by Mimic ransomware\nIt then appends the .QUIETPLACE file extension to the encrypted files and, finally, displays the ransom note.\n\n\n-----\n\nFigure 11. Files that were encrypted\n\nby the Mimic ransomware\n\nFigure 12. The Mimic ransom note\n\n## Code from leaked Conti builder\n\n[From our analysis, some parts of the code seemed to be based on, and share several similarities with the Conti ransomware builder that was](https://www.trendmicro.com/vinfo/us/security/news/ransomware-spotlight/ransomware-spotlight-conti)\nleaked in March 2022. For example, the enumeration of the encryption modes shares the same integer for both Mimic and Conti.\n\n\n-----\n\nFigure 13. Similarities between Mimic (top) and the leaked Conti builder (bottom)\n\nThe code related to argument net is also based on Conti. It will use the GetIpNetTable function to read the Address Resolution Protocol (ARP)\ncache and check if IP addresses contain “172.”, “192.168”, “10.”, or “169.” Mimic added a filter to exclude IP addresses that contain “169.254”,\nwhich is the IP range of Automatic Private IP Addressing (APIPA).\n\n\n-----\n\n-----\n\nFigure 14. Comparison of the Mimic (top)\n\nand the leaked Conti builder (bottom) “net” argument\nMimic also uses the Conti code in Windows Share Enumeration, where it employs the NetShareEnum function to enumerate all shares on the\ngathered IP addresses.\n\n\n-----\n\n-----\n\nFigure 15. Comparison of the Mimic (top) and the leaked Conti (bottom) Share Enumeration function\nFinally, Mimic’s port scanning is also based on the Conti builder.\n\n\n-----\n\n-----\n\nFigure 16. Comparison of the Mimic (top) and leaked Conti builder (bottom) port scanning function\n[More information about the behavior of Mimic ransomware can be found in this report.](https://www.trendmicro.com/vinfo/au/threat-encyclopedia/malware/Ransom.Win32.MIMIC.SMZTJJ-A/)\n\n## Conclusion\n\nMimic ransomware, with its multiple bundled capabilities, seems to implement a new approach to speeding up its routine by combining multiple\nrunning threads and abusing Everything’s APIs for its encryption (minimizing resource usage, therefore resulting in more efficient execution).\nFurthermore, the threat actor behind Mimic seems to be resourceful and technically adept, using a leaked ransomware builder to capitalize on\nits various features, and even improve on it for more effective attacks.\n\nTo protect systems from ransomware attacks, we recommend that both individual users and organizations implement best practices such as\napplying data protection, backup, and recovery measures to secure data from possible encryption or erasure. Conducting regular vulnerability\nassessments and patching systems in a timely manner can also minimize the damage dealt by ransomware that abuse exploits.\n\nA multilayered approach can help organizations guard possible entry points into the system (endpoint, email, web, and network). The right\nsecurity solutions can also detect malicious components and suspicious behavior to protect enterprises.\n\n[Trend Micro Vision One™ provides multilayered protection and behavior detection, which helps block questionable behavior and tools](https://www.trendmicro.com/en_us/business/products/detection-response.html)\nearly on before the ransomware can do irreversible damage to the system.\n[Trend Micro Cloud One™ Workload Security protects systems against both known and unknown threats that exploit vulnerabilities. This](https://www.trendmicro.com/en_us/business/products/hybrid-cloud/cloud-one-workload-security.html)\nprotection is made possible through techniques such as virtual patching and machine learning.\n[Trend Micro™ Deep Discovery™ Email Inspector employs custom sandboxing and advanced analysis techniques to effectively block](https://www.trendmicro.com/en_us/business/products/user-protection/sps/email-and-collaboration/email-inspector.html)\nmalicious emails, including phishing emails that can serve as entry points for ransomware.\n[Trend Micro Apex One™ offers next-level automated threat detection and response against advanced concerns such as fileless threats](https://www.trendmicro.com/en_us/business/products/user-protection/sps/endpoint.html)\nand ransomware, ensuring the protection of endpoints.\n\n\n-----\n\n## Indicators of Compromise\n\n**SHA-256** **Version** **Detection name**\n\n08f8ae7f25949a742c7896cb76e37fb88c6a7a32398693ec6c2b3d9b488114be 1.1 Ransom.Win32.MIMIC.SMZTJJ-A\n\n9c16211296f88e12538792124b62eb00830d0961e9ab24b825edb61bda8f564f 1.13 Ransom.Win32.MIMIC.SMZTJJ-A\n\ne67d3682910cf1e7ece356860179ada8e847637a86c1e5f6898c48c956f04590 1.14 Ransom.Win32.MIMIC.THLBGBB\n\nc634378691a675acbf57e611b220e676eb19aa190f617c41a56f43ac48ae14c7 3 Ransom.Win32.MIMIC.THLBGBB\n\nc71ce482cf50d59c92cfb1eae560711d47600541b2835182d6e46e0de302ca6c 3 Ransom.Win32.MIMIC.THLBGBB\n\n7ae4c5caf6cda7fa8862f64a74bd7f821b50d855d6403bde7bcbd7398b2c7d99 3.3 Ransom.Win32.MIMIC.THHAABB\n\na1eeeeae0eb365ff9a00717846c4806785d55ed20f3f5cbf71cf6710d7913c51 3.3 Ransom.Win32.MIMIC.SMZTJJ-A\n\nb0c75e92e1fe98715f90b29475de998d0c8c50ca80ce1c141fc09d10a7b8e7ee 3.3 Ransom.Win32.MIMIC.SMZTJJ-A\n\n1dea642abe3e27fd91c3db4e0293fb1f7510e14aed73e4ea36bf7299fd8e6506 3.4 Ransom.Win32.MIMIC.SMZTJJ-A\n\n4a6f8bf2b989fa60daa6c720b2d388651dd8e4c60d0be04aaed4de0c3c064c8f 3.4 Ransom.Win32.MIMIC.THLBGBB\n\nb68f469ed8d9deea15af325efc1a56ca8cb5c2b42f2423837a51160456ce0db5 3.4 Ransom.Win32.MIMIC.SMZTJJ-A\n\nbb28adc32ff1b9dcfaac6b7017b4896d2807b48080f9e6720afde3f89d69676c 3.4 Ransom.Win32.MIMIC.SMZTJJ-A\n\nbf6fa9b06115a8a4ff3982427ddc12215bd1a3d759ac84895b5fb66eaa568bff 3.4 Ransom.Win32.MIMIC.SMZTJJ-A\n\ned6cf30ee11b169a65c2a27c4178c5a07ff3515daa339033bf83041faa6f49c1 3.4 Ransom.Win32.MIMIC.THLBGBB\n\n480fb2f6bcb1f394dc171ecbce88b9fa64df1491ec65859ee108f2e787b26e03 3.7 Ransom.Win32.MIMIC.SMZTJJ-A\n\n30f2fe10229863c57d9aab97ec8b7a157ad3ff9ab0b2110bbb4859694b56923f 3.9 Ransom.Win32.MIMIC.SMZTJJ-A\n\n2e96b55980a827011a7e0784ab95dcee53958a1bb19f5397080a434041bbeeea 4 Ransom.Win32.MIMIC.SMZTJJ-A\n\n136d05b5132adafc4c7616cd6902700de59f3f326c6931eb6b2f3b1f458c7457 4.2 Ransom.Win32.MIMIC.SMZTJJ-A\n\nc576f7f55c4c0304b290b15e70a638b037df15c69577cd6263329c73416e490e HackTool.Win32.DEFENDERCONTROL.Z\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2023/2023-01-26 - New Mimic Ransomware Abuses Everything APIs for its Encryption Process.pdf"
    ],
    "report_names": [
        "2023-01-26 - New Mimic Ransomware Abuses Everything APIs for its Encryption Process.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1675303662,
    "ts_updated_at": 1743041137,
    "ts_creation_date": 1675238132,
    "ts_modification_date": 1675238132,
    "files": {
        "pdf": "https://archive.orkl.eu/93cb0f058cf8d7875188397160f9af601f0c3d13.pdf",
        "text": "https://archive.orkl.eu/93cb0f058cf8d7875188397160f9af601f0c3d13.txt",
        "img": "https://archive.orkl.eu/93cb0f058cf8d7875188397160f9af601f0c3d13.jpg"
    }
}