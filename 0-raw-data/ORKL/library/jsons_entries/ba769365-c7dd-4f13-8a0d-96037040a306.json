{
    "id": "ba769365-c7dd-4f13-8a0d-96037040a306",
    "created_at": "2023-01-12T15:06:54.82175Z",
    "updated_at": "2025-03-27T02:08:40.812538Z",
    "deleted_at": null,
    "sha1_hash": "43aec4f9e9ef8220fca5fac2ce4d53e1783e7f59",
    "title": "2016-11-08 - Analysis of IOS.GUIINJECT Adware Library",
    "authors": "",
    "file_creation_date": "2022-10-02T12:00:56Z",
    "file_modification_date": "2022-10-02T12:00:56Z",
    "file_size": 538935,
    "plain_text": "# Analysis of iOS.GuiInject Adware Library\n\n**sentinelone.com/blogs/analysis-ios-guiinject-adware-library/**\n\nNovember 8, 2016\n\n### There ain’t no such thing as a free $2 cracked software, especially if one went all-in buying that latest top-notch iOS device!\n\n Our crackers friends know, and if one takes the bet to use an out-of-date insecure jailbroken iOS version to install cracked software, he or she is likely to be abused by the ads injector we describe in this post.\n\n\n-----\n\n### Adware masquerading already targeted Android or iOS. These cracks use poor security practices that could lead to spyware masquerading.\n\n## iOS Application File\n\n### Recently, an iOS App file got our attention on VirusTotal:\n```\n$ openssl dgst -sha256 com.mailtime.MailTimePro-clutch2.ipa\n\nSHA256(com.mailtime.MailTimePro-clutch2.ipa)=\n332cf0a45170d6787dcbefb086f5a5f0f6e920d485e377fe37e900a01c128c8e\n\n The filename reveals we are probably dealing with a cracked software, using Clutch, an iOS cracking toolbox. Let’s decompress the iOS App file (it is a Zip archive):\n$ ditto -xk com.mailtime.MailTimePro-clutch2.ipa com.mailtime.MailTimePro-clutch2\n\n$ cd \"com.mailtime.MailTimePro-clutch2/Payload/MailTime Pro.app/\"\n\n$ find . -type f -exec file {} \\; | grep \"Mach-O\"\n\n(...)\n\n./jailbreak: Mach-O universal binary with 2 architectures\n./jailbreak (for architecture armv7): Mach-O dynamically linked shared library arm\n\n./jailbreak (for architecture arm64): Mach-O 64-bit dynamically linked shared library\n\n./MailTime Pro: Mach-O universal binary with 2 architectures\n\n./MailTime Pro (for architecture armv7): Mach-O executable arm\n\n./MailTime Pro (for architecture arm64): Mach-O 64-bit executable\n\n That jailbreak shared library looks suspicious.\n$ codesign -dvv \"MailTime Pro\" 2>&1 | grep Authority\n\nAuthority=iPhone Developer: nguyen tat hung (T99T9WYY54)\nAuthority=Apple Worldwide Developer Relations Certification Authority\n\nAuthority=Apple Root CA\n\n$ codesign -dvv jailbreak 2>&1 | grep Authority\n\nAuthority=iPhone Developer: nguyen tat hung (T99T9WYY54)\nAuthority=Apple Worldwide Developer Relations Certification Authority\n\nAuthority=Apple Root CA\n\n While nguyen tat hung is a known developer identifier, he is not the expected MailTime developer.\n\n Going further, we find jailbreak dynamic library is added to the original binary imports:\n$ otool -arch arm64 -L \"MailTime Pro\"\n\n(...)\n\n  @executable_path/jailbreak (compatibility version 0.0.0, current version 0.0.0)\n\n Most libraries contain their installation prefix and real name in their imports:\n$ otool -arch arm64 -L jailbreak\n\njailbreak:\n\n  /usr/local/lib/libguiinject.dylib (compatibility version 1.0.0, current version 1.0.0)\n\n(...)\n\n And thanks to assert() macros, project-related information are leaking:\n$ strings -arch arm64 jailbreak | grep -i guiinject\n\n/Users/gtt/Documents/workspaceIOS/guiinject/guiinject/MBProgressHUD.m\n\n/Users/gtt/Documents/workspaceIOS/guiinject/guiinject/SSZipArchive.m\n\nguiinject\n\n## Injected Library\n\n```\n\n-----\n\n### Browsing the symbols, we quickly isolate well known SDKs and Cocoa Pods:\n\n Cocoa Pods\n FileMD5Hash MBProgressHUD SSZipArchive\n\n So many ads stuff for a jailbreak is unusual. Here you have the remaining classes headers.\n\n We run most of the cracked apps on a jailbroken device without problems.\n```\n-[Config getConfig] loads wrap.json from the host program resources:\n{\n\n \"udid\": \"jailbreak\",\n\n \"wait_loop\": \"3\",\n\n \"is_jb\": \"1\",\n\n \"package_name\": \"com.mailtime.MailTimePro\"\n\n}\n\n After several wait_loop launch, the injected code will contact an insecure remote host. Half of the services seem to work.\n\n For example, the coreapi service seems down:\n\n```\n```\nhttp://wrapper.laughworld.net/coreapi/active_device.php?\n\n```\n```\npk=IPANAME&is_jb=1&udid=REDACTED&signature=MD5 :\n{\n\n \"return\": -2,\n\n \"message\": \"DB operator fail!\"\n\n}\nhttp://wrapper.laughworld.net/coreapi/get_list_message.php?\npk=IPANAME&is_jb=1&udid=REDACTED&libver=20160818&app_pk=IPANAME_AGAIN&app_ver=1.2.3&signature=MD5 :\n{\n\n \"return\": 0,\n\n \"messages\": []\n\n}\n\n### While the api service is up:\nhttp://wrapper.laughworld.net/api/com.mailtime.MailTimePro_ads.json :\n{\n\n \"advertising_list\": [\n\n  {\n\n   \"id\": 1,\n\n   \"act_type\": \"0\",\n\n   \"b\": \"<body><iframe style='border:none;padding-left:0px;padding-top:0px;'\nsrc='http://bypassfirewall.net'><p>http://bypassfirewall.net/</p></iframe></body>\",\n\n   \"dp_type\": \"1\",\n\n   \"url\": \"http://bypassfirewall.net\",\n\n   \"hide\": 1,\n\n   \"random_show\": \"5\",\n\n   \"adsnet_name\": \"admob\",\n\n   \"adsnet_id\": \"ca-app-pub-3816529472258726/8039356495\"\n\n  }\n\n ]\n\n}\n\n```\n\n-----\n\n### Most interesting part is the update request:\n```\n-[API getUpdate:withSelector:] connects\n\n to http://wrapper.laughworld.net/api/com.mailtime.MailTimePro_update.json :\n{\n\n \"show_ads\": \"YES\",\n\n \"show_message\": \"YES\",\n\n \"update_message_not\": \"\",\n\n \"update_link\": \"http://google.com\",\n\n \"linkfw\": \"http://wrapper.laughworld.net/lib/DailyUploadDownloadLib.framework.zip\",\n \"namefw\": \"DailyUploadDownloadLib.framework\",\n \"md5fw\": \"f6a51b479516f11ce503ae06f9ffff0f\",\n\n \"script_zip\": \"http://wrapper.laughworld.net/lib/filehost.scr.zip\",\n\n \"script_file\": \"filehost.scr\",\n\n \"md5_script\": \"a9ef52dc75ecbcfce9447237f5154417\"\n\n}\nscript_zip, script_file and md5_script are not implemented. The script_zip URL points to a\n\n password encrypted Zip file, and the md5_script value is not valid (last bytes are wrong).\nlinkfw points to a valid Zip archive. Once downloaded and decompressed, -[guiinject\n_loadPluginAtLocation:] will load the framework and send a run message to its principalClass .\nmd5fw value is used for self-update.\n\n Ads are downloaded, but so far, we don’t see any of them. They are probably rendered in a hidden view.\n\n## Downloaded Framework\n$ openssl dgst -sha256 DailyUploadDownloadLib\n\nSHA256(DailyUploadDownloadLib)= 00ca48ebeda3d93ccf1b8b405fcf4c2062424bbc99425e27f0b65c7ee238780e\n\n$ file DailyUploadDownloadLib\n\nDailyUploadDownloadLib: Mach-O universal binary with 2 architectures\n\nDailyUploadDownloadLib (for architecture armv7): Mach-O dynamically linked shared library arm\n\nDailyUploadDownloadLib (for architecture arm64): Mach-O 64-bit dynamically linked shared library\n\n### The developer identifier is different:\n$ codesign -dvv DailyUploadDownloadLib 2>&1 | grep Authority\n\nAuthority=iPhone Developer: Pham Hiep (8DYXPR6ZBP)\nAuthority=Apple Worldwide Developer Relations Certification Authority\n\nAuthority=Apple Root CA\n\n The User and Organization names are in the framework header:\n$ cat Headers/DailyUploadDownloadLib.h\n\n//\n// DailyUploadDownloadLib.h\n\n// DailyUploadDownloadLib\n\n//\n// Created by GTT Media Hanoi on 9/29/16.\n\n// Copyright © 2016 T&B. All rights reserved.\n\n(...)\n\n This file was automatically generated by Xcode. According to ITviec jobs website, GTT Media and T&B are outsourcing companies.\n\n Once loaded, the framework ask a lib service for two lists of files, on DailyUploads and FileFactory file-hosting sites.\n\n```\n\n-----\n\n```\nhttp://wrapper.laughworld.net/lib/DailyUploadDownloadModule.conf :\n{\n\n \"list\": [\n\n  \"https://dailyuploads.net/hdo3rn24n5tg\",\n\n  \"https://dailyuploads.net/udzjx12rvu0z\",\n\n  \"https://dailyuploads.net/8buwsi2hk9x7\",\n\n  \"https://dailyuploads.net/vgnqrv66hp4l\",\n\n  \"https://dailyuploads.net/mla2ofh3c0z8\",\n\n  \"https://dailyuploads.net/ud2hlgpw9dto\",\n\n  \"https://dailyuploads.net/030p4rn9ll6a\",\n\n  \"https://dailyuploads.net/rsjbhbc6zi0b\",\n\n  \"https://dailyuploads.net/wzrqhpqa7x7w\",\n\n  \"https://dailyuploads.net/dqcl45a61amy\",\n\n  \"https://dailyuploads.net/rhkbzrodo6ou\",\n\n  \"https://dailyuploads.net/cqrakbup91s4\",\n\n  \"https://dailyuploads.net/yxskttjfo4h8\",\n\n  \"https://dailyuploads.net/m6p6maeijff1\",\n\n  \"https://dailyuploads.net/f15g1prokvks\"\n\n ]\n\n}\nhttp://wrapper.laughworld.net/lib/FileFactoryDownloadModule.conf :\n{\n\n \"list\": [\n\n  \"http://filefactory.com/file/ebdz39d8dex/myfile42.encrypt\",\n\n  (...)\n\n  \"http://filefactory.com/file/1ycfrbml51ox/myfile7.encrypt\",\n\n  \"http://filefactory.com/file/1k97tfd8ibu5/kdiff3-0.9.98-MacOSX-64Bit.dmg\",\n\n  \"http://filefactory.com/file/5difpf82yog1/Newsgroup_collection.zip\",\n\n  \"http://filefactory.com/file/6mlwn7iv1mv7/docword.enron.txt.gz\",\n\n  \"http://filefactory.com/file/52sg5aurgkrz/Tiny_Wings__Andreas_Illiger___v2.1_os43_Nitrox.rc330_84.ipa\",\n\n  \"http://filefactory.com/file/6x9iujr8u6a5/php-5.6.14.tar.bz2\",\n\n  \"http://filefactory.com/file/q29tth3j859/iBackupBot-Setup.dmg\",\n\n  \"http://filefactory.com/file/6bcmlwfuw7wl/pokegoppsl.zip\",\n\n  \"http://filefactory.com/file/4qqx4s5l36hn/iPhoneConfigUtility.dmg\",\n\n  \"http://filefactory.com/file/5vqawo60iyb9/googlemobileadssdkios.zip\",\n\n  \"http://filefactory.com/file/560caqad3k9h/mallet-2.0.8RC3.tar.gz\",\n\n  \"http://filefactory.com/file/5ovqpwwp0w7h/609704981.ipa\",\n\n  \"http://filefactory.com/file/1lpoyv8v2y73/Multiplayer_for_Minecraft_PE__v2.0_v2.012_Univ_os80_Locophone-ICPDA.rc333_91.ipa\",\n\n  \"http://filefactory.com/file/2abv5ufb9gav/MtProtoKit-master.zip\",\n\n  \"http://filefactory.com/file/5t8e4px5fod1/577499909.ipa\",\n\n  \"http://filefactory.com/file/4zy55s6qayrh/intel_rst_7_mb_8.1.zip\",\n\n  \"http://filefactory.com/file/12toqn6khwd3/MEAD-3.12.tar.gz\"\n\n ]\n\n}\n\n### The framework also periodically checks the external IP address of the iOS device, using DynDNS.\n\n When the framework is loaded, or when the external IP address changes, a random file from both hosting sites is downloaded. It’s worth noting DailyUploads and FileFactory have affiliation programs (per thousand downloads). Median file size is 15 Mb.\n\n DailyUploads links point to other iOS applications. They are also signed by nguyen tat hung and injected:\n\n```\n\n-----\n\n```\n y j y y p\nipa_jb DailyUploads/com.infinear.call-clutch2.ipa\n\nipa_jb DailyUploads/com.axidep.polyglotvoicereader-clutch2.ipa\n\nipa_jb DailyUploads/com.contrast.mileagelog-clutch2.ipa\n\nipa_jb DailyUploads/com.kymatica.AUFX-Space-clutch2.ipa\n\nipa_jb DailyUploads/co.qapps.calcpro-clutch2.ipa\n\nipa_jb DailyUploads/com.pixiapps.ecoutemobile-clutch2.ipa\n\nipa_jb DailyUploads/com.jhnd.blender-clutch2.ipa\n\nipa_jb DailyUploads/com.jackadam.darksky-rc.ipa\n\nipa_jb DailyUploads/com.markelsoft.Text2Speech-clutch2.ipa\n\nipa_jb DailyUploads/com.giacomoballi.FindTower-clutch2.ipa\n\nipa_jb DailyUploads/com.venderbase.dd-wrt-clutch2.ipa\n\nipa_jb DailyUploads/com.vincenzoaccardi.itracking-clutch2.ipa\n\nipa_jb DailyUploads/com.realvnc.VNCViewer-clutch2.ipa\n\nipa_jb DailyUploads/com.yacreader.yacreader-clutch2.ipa\n\nipa_jb DailyUploads/com.plumamazing.iWatermark-clutch2.ipa\n\n## Abusing the Injected Adware Library\n\n### So, a dynamic library asks a remote host using an insecure protocol for code to execute… What could possibly go wrong?\n\n By intercepting and modifying the update response, we successfully load our code:\n\n This is Arbitrary Code Execution using Man in the Middle attack. We should probably thank crackers, or developers, for explicitly allowing NSAllowsArbitraryLoads (insecure http protocol) in App Transport Security.\n\n## Hundreds of Samples\n\n```\n\n-----\n\n### Using VirusTotal Retrohunt and some Yara rules, we find hundreds of samples.\n\n## Conclusion\n\n### The incentive for jailbreak is research, not piracy. Production devices must stay away from jailbreak and piracy.\n\n Real crackers never monetize their findings, and most developers provide free versions of their products, with their own ads. Those ad revenues go to the author instead of some random selfish cracker.\n\n And while we are on it, for the price of that latest iOS device, people could get hundreds of programs and improve their current device experience. They won’t even have to feel guilty for Apple as the mothership takes its cut on App Store sales.\n\n Conclusions regarding crackers earned money using hidden ads and fake downloads, users wasted data plans, or potential abuses of the injected adware library are left as an exercise to the reader.\n\n For other deep analyses on hacks and attacks, check out SentinelOne’s other Security Research blogs.\n\n SentinelOne unifies next-generation prevention, detection, and response in a single platform to protect user endpoints and critical servers from all types of advanced attacks. Learn more about the SentinelOne Endpoint Protection Platform’s technology.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2016/2016-11-08 - Analysis of IOS.GUIINJECT Adware Library.pdf"
    ],
    "report_names": [
        "2016-11-08 - Analysis of IOS.GUIINJECT Adware Library.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536014,
    "ts_updated_at": 1743041320,
    "ts_creation_date": 1664712056,
    "ts_modification_date": 1664712056,
    "files": {
        "pdf": "https://archive.orkl.eu/43aec4f9e9ef8220fca5fac2ce4d53e1783e7f59.pdf",
        "text": "https://archive.orkl.eu/43aec4f9e9ef8220fca5fac2ce4d53e1783e7f59.txt",
        "img": "https://archive.orkl.eu/43aec4f9e9ef8220fca5fac2ce4d53e1783e7f59.jpg"
    }
}