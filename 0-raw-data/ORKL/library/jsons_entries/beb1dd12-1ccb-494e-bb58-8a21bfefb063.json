{
    "id": "beb1dd12-1ccb-494e-bb58-8a21bfefb063",
    "created_at": "2023-01-12T15:10:01.537806Z",
    "updated_at": "2025-03-27T02:15:38.120134Z",
    "deleted_at": null,
    "sha1_hash": "7d1a2fbff4216633b2a0c365f6162797bc1eedfa",
    "title": "2019-04-02 - New ServHelper Variant Employs Excel 4.0 Macro to Drop Signed Payload",
    "authors": "",
    "file_creation_date": "2022-05-29T01:12:14Z",
    "file_modification_date": "2022-05-29T01:12:14Z",
    "file_size": 629592,
    "plain_text": "# New ServHelper Variant Employs Excel 4.0 Macro to Drop Signed Payload\n\n**[deepinstinct.com/2019/04/02/new-servhelper-variant-employs-excel-4-0-macro-to-drop-signed-payload/](https://www.deepinstinct.com/2019/04/02/new-servhelper-variant-employs-excel-4-0-macro-to-drop-signed-payload/)**\n\nApril 2, 2019\n\n## 100% Prevention Score in the 2022 MITRE ATT&CK Evaluation for\n Enterprise\n\n[Learn more](https://www.deepinstinct.com/news/deep-instinct-shows-100-percent-score-in-mitre-evaluations)\n\nApril 2, 2019 | [Shaul Vilkomir-Preisman](https://www.deepinstinct.com/author/shaul-vilkomir-preisman)\n\n[ServHelper is a recently discovered backdoor associated with TA505. A veteran threat group](https://www.proofpoint.com/us/threat-insight/post/servhelper-and-flawedgrace-new-malware-introduced-ta505)\nthat has also been associated with the infamous Dridex banking malware, the\nGlobeIimposter ransomware, and other high-profile malware campaigns.\n\nDeep Instinct Threat Research unit has recently discovered a new variant of ServHelper that\n[employes an Excel 4.0 macro Dropper. A legacy mechanism still supported by Microsoft](https://outflank.nl/blog/2018/10/06/old-school-evil-excel-4-0-macros-xlm/)\nOffice, and an executable payload signed with a valid digital signature.\n\n[Since this vector came to light it has gained some traction, although it is still not widespread](https://blog.360totalsecurity.com/en/the-analysis-of-the-attack-which-uses-excel-4-0-macro-to-avoid-antivirus-software-detection/)\nand is used by only a handful of threat actors\n\n\n-----\n\n**Attack Flow**\nOnce the malicious Excel sheet is opened the Excel 4.0 macro is executed and msiexec.exe\nis called in order to download and execute the payload.\n\n[caption id=\"attachment_4566\" align=\"aligncenter\" width=\"1092\"]\n\nExcel 4.0 macro snippet, msiexec.exe is called to download and execute the payload.\n(cropped from oledump.py)[/caption]\n\nServHelper’s payload, an NSIS Installer signed with a valid digital signature (further details\non the certificate ahead), is downloaded by msiexec.exe to its temporary folder\n(C:\\Windows\\Installer\\MSI[4-charachter-string].tmp) and executed.\n\nOnce the dropped payload is executed, it will drop a DLL file contained in the installer to\n_\\%TEMP%\\xmlparse.dll, and use rundll32.exe to call the DLL’s exported function “sega”._\n\n[caption id=\"attachment_4565\" align=\"aligncenter\" width=\"360\"]\n\nxmlparse.dll’s exported functions,\n\nfunctions 1-3 are Delphi compiler artifacts, function 4 is not currently used.[/caption]\n\nThe malware will then write a base64 encoded PowerShell script (which is contained in\n_xmlparse.dll as a resource) to \\%TEMP%\\enu1.ps1 and execute it. The script, intended for_\nreconnaissance purposes, checks if a machine is part of a domain and if the user has Admin\nprivileges or is part of the Admin Group.\n\n\n-----\n\n[caption id= attachment_4567 align= aligncenter width= 790 ]\n\nCaption: Decoded reconnaissance PowerShell script.[/caption]\n\nThis information is then reported back to ServHelper’s Command & Control server and if the\nuser is part of a domain, the Command & Control server will also instruct the malware to\ngather a list of other users in the domain.\n\n[caption id=\"attachment_4568\" align=\"aligncenter\" width=\"435\"]\n\nCommand & Control server\n\nresponse with command to gather a list of users in the domain[/caption]\n\nServHelper can receive several types of commands from its Command & Control server,\nincluding:\n\n**shell – execute a shell (cmd.exe)** command and return its output\n**loaddll –download a DLL file and load it using rundll32.exe**\n**persist – write an auto-run registry entry at**\n_HK_CU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\ as “Intel Protect”, returns_\n“persistence established” if successful.\n**slp – enter sleep mode**\n\n\n-----\n\n**selfkill – remove the malware from the infected machine**\n\n[caption id=\"attachment_4564\" align=\"aligncenter\" width=\"886\"]\n\nDiagram showing ServHelper attack flow[/caption]\n\n**Signed Payload and Core**\n\nBoth the NSIS Installer payload and ServHelper’s core DLL are, at the time of writing, signed\nusing a valid signature.\n\n\n-----\n\n[caption id= attachment_4569 align= aligncenter width= 423 ]\n\nServHelper signed using a valid\n\nsignature[/caption]\n\nThe certificate used to sign the malware was issued to “MASLAK LTD” of Uxbridge, Great\nBritain.\n\n[While this appears to be a legitimately registered company, further investigation is required to](https://beta.companieshouse.gov.uk/company/07808258/filing-history)\ndetermine the validity of the certificates or whether they have been compromised and the\npossibility of MASLAK being a shell company.\n\nOur analysis of “MASLAK LTD” certificates reveals another certificate issued by them that\nwas previously used to digitally sign malware, although it has since been revoked (certificate\ndetails are provided in the IOCs section).\n\n**Conclusion**\nTA505 is a highly advanced global threat actor. It employs a vast array of sophisticated,\nconstantly developed malware for different purposes, for which it exploits the most recently\ndiscovered and publicized weak points.\n\n\n-----\n\nThis, factually, pays off for TA505. The evasive and legitimatizing factors described above,\nwhereby a dropper employs a lesser known and poorly detected old-school technique\ncombined with a validly signed payload and malware core, all contribute to its evasiveness.\nWhen this variant first appeared on VirusTotal it was almost completely undetected. Below\nare links to each component’s initial detections at time of upload:\n\n**Dropper**\nhttps://www.virustotal.com/gui/file/63522e00181e6b8d9ae8bfd51f7df8f8ebd0f42323e220472\n69df9c7a71c9b6d/detection/f63522e00181e6b8d9ae8bfd51f7df8f8ebd0f42323e22047269df9c7a71c9b6d-1553181861\n\n**NSIS Payload**\nhttps://www.virustotal.com/gui/file/e0323064f2561ae02f9efae418aeaf433b3fe0e6e3a640a9c\n46ec404d4563de1/detection/fe0323064f2561ae02f9efae418aeaf433b3fe0e6e3a640a9c46ec404d4563de1-1553164241\n\n**DLL Core**\nhttps://www.virustotal.com/gui/file/bee3b2710f7e874ce05e6b8b45cc20e021b9c00ee337238\n598e71e7315128333/detection/fbee3b2710f7e874ce05e6b8b45cc20e021b9c00ee337238598e71e7315128333-1553164241\n\nDeep Instinct Threat Research contacted DigiCert (who operate Thawte CA), and was\nnotified that an investigation into the malicious certificate has been initiated.\n\nDeep Instinct’s customers are fully protected against ServHelper’s activity based on D-Brain\n– Deep Instinct’s [Deep Learning security solution.](https://www.deepinstinct.com/product-overview/)\n\n**Update (4/4/19):**\n\nFollowing conclusion of our initial analysis of the described ServHelper variant, Deep Instinct\nhas noticed an uptick in ServHelper’s activity, with new droppers and infection URLs\nappearing in the wild, a new mildly modified payload and core signed with the same\ncertificate, and an additional Command & Control domain (new indicators have been\nupdated in IOC section).\n\nDeep Instinct has been notified by DigiCert that following Deep Instinct’s report, the\ncertificate used in this ServHelper campaign has been revoked.\n\nIOCs:\n\nExcel 4.0 macro Dropper\n\n63522e00181e6b8d9ae8bfd51f7df8f8ebd0f42323e22047269df9c7a71c9b6d\n\nNSIS Payloads\n\n\n-----\n\ne0323064f2561ae02f9efae418aeaf433b3fe0e6e3a640a9c46ec404d4563de1\n\n302aa690ae61d36769ecdaa3d23ac8fb167e80aed2fe5dbc8938f7b75c655a01\n\nServHelper core DLL\n\nbee3b2710f7e874ce05e6b8b45cc20e021b9c00ee337238598e71e7315128333\n\n2f827084ecc300aea0c84cba8872c9a34e6afce56eea454d74f4dd3144301a2d\n\nEncoded reconnaissance PowerShell script\n\nda7465f14cd8a934668f59974e8836e02a9b1ff948bfe964040b840ab61697dc\n\n“MASLAK LTD” Certificates:\n\nValid\n\nThumbprint (SHA1): 557B9ADADAEF142B7C38AE04F6C1A9FC8E4251C1\nSerial Number: 68DE1F7207D5EDD81E4B62093139340A\n\nRevoked\n\nThumbprint (SHA1): B4CDC78A2FCBE0A70A120D7449F956C7B7507E97\nSerial Number: 3803B0D45F38CEA186D588606C34B63A\n\nPayload URLs:\n\nhxxp://169.239.128[.]104/alg\n\nhxxp://45.63.101[.]210/appservice\n\nhxxp://151.236.23[.]56/appservice\n\nServHelper Command & Control:\n\nhxxp://cdnavupdate[.]icu/jquery/jquery.php\n\nhxxp://afsafasdarm[.]icu/jquery/jquery.php\n\nhxxp://rff3faafefw[.]pw/jquery/jquery.php\n\nhxxp://afwer444sff[.]icu/jquery/jquery.php\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-04-02 - New ServHelper Variant Employs Excel 4.0 Macro to Drop Signed Payload.pdf"
    ],
    "report_names": [
        "2019-04-02 - New ServHelper Variant Employs Excel 4.0 Macro to Drop Signed Payload.pdf"
    ],
    "threat_actors": [
        {
            "id": "99cb4e5b-8071-4f9e-aa1d-45bfbb6197e3",
            "created_at": "2023-01-06T13:46:38.860754Z",
            "updated_at": "2025-03-27T02:00:02.937438Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "SectorJ04 Group",
                "Dudear",
                "G0092",
                "ATK103",
                "Hive0065",
                "Spandex Tempest",
                "GRACEFUL SPIDER",
                "GOLD TAHOE",
                "CHIMBORAZO",
                "SectorJ04"
            ],
            "source_name": "MISPGALAXY:TA505",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "5e6b31a6-80e3-4e7d-8b0a-d94897ce9b59",
            "created_at": "2024-06-19T02:03:08.128175Z",
            "updated_at": "2025-03-27T02:05:17.400394Z",
            "deleted_at": null,
            "main_name": "GOLD TAHOE",
            "aliases": [
                "SectorJ04 ",
                "Spandex Tempest ",
                "TA505 ",
                "FIN11 "
            ],
            "source_name": "Secureworks:GOLD TAHOE",
            "tools": [
                " Cobalt Strike",
                " FlawedAmmy",
                " Get2",
                " GraceWire",
                " Malichus",
                " SDBbot",
                " ServHelper",
                " TrueBot",
                "Clop"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "75d4d6a9-b5d1-4087-a7a0-e4a9587c45f4",
            "created_at": "2022-10-25T15:50:23.5188Z",
            "updated_at": "2025-03-27T02:00:55.489882Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "TA505",
                "Hive0065",
                "Spandex Tempest",
                "CHIMBORAZO"
            ],
            "source_name": "MITRE:TA505",
            "tools": [
                "AdFind",
                "Azorult",
                "FlawedAmmyy",
                "Mimikatz",
                "Dridex",
                "TrickBot",
                "Get2",
                "FlawedGrace",
                "Cobalt Strike",
                "ServHelper",
                "Amadey",
                "SDBbot",
                "PowerSploit"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "e447d393-c259-46e2-9932-19be2ba67149",
            "created_at": "2022-10-25T16:07:24.28282Z",
            "updated_at": "2025-03-27T02:02:10.159466Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "ATK 103",
                "Chimborazo",
                "Gold Evergreen",
                "Gold Tahoe",
                "Graceful Spider",
                "Hive0065",
                "Operation Tovar",
                "Operation Trident Breach",
                "SectorJ04",
                "Spandex Tempest",
                "TA505",
                "TEMP.Warlock"
            ],
            "source_name": "ETDA:TA505",
            "tools": [
                "Amadey",
                "AmmyyRAT",
                "AndroMut",
                "Azer",
                "Bart",
                "Bugat v5",
                "CryptFile2",
                "CryptoLocker",
                "CryptoMix",
                "CryptoShield",
                "Dridex",
                "Dudear",
                "EmailStealer",
                "FRIENDSPEAK",
                "Fake Globe",
                "Fareit",
                "FlawedAmmyy",
                "FlawedGrace",
                "FlowerPippi",
                "GOZ",
                "GameOver Zeus",
                "GazGolder",
                "Gelup",
                "Get2",
                "GetandGo",
                "GlobeImposter",
                "Gorhax",
                "GraceWire",
                "Gussdoor",
                "Jaff",
                "Kasidet",
                "Kegotip",
                "Kneber",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Locky",
                "MINEBRIDGE",
                "MINEBRIDGE RAT",
                "MirrorBlast",
                "Neutrino Bot",
                "Neutrino Exploit Kit",
                "P2P Zeus",
                "Peer-to-Peer Zeus",
                "Philadelphia",
                "Philadephia Ransom",
                "Pony Loader",
                "Rakhni",
                "ReflectiveGnome",
                "Remote Manipulator System",
                "RockLoader",
                "RuRAT",
                "SDBbot",
                "ServHelper",
                "Shifu",
                "Siplog",
                "TeslaGun",
                "TiniMet",
                "TinyMet",
                "Trojan.Zbot",
                "Wsnpoem",
                "Zbot",
                "Zeta",
                "ZeuS",
                "Zeus"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536201,
    "ts_updated_at": 1743041738,
    "ts_creation_date": 1653786734,
    "ts_modification_date": 1653786734,
    "files": {
        "pdf": "https://archive.orkl.eu/7d1a2fbff4216633b2a0c365f6162797bc1eedfa.pdf",
        "text": "https://archive.orkl.eu/7d1a2fbff4216633b2a0c365f6162797bc1eedfa.txt",
        "img": "https://archive.orkl.eu/7d1a2fbff4216633b2a0c365f6162797bc1eedfa.jpg"
    }
}