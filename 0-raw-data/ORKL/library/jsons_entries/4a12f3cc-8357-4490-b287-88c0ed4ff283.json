{
    "id": "4a12f3cc-8357-4490-b287-88c0ed4ff283",
    "created_at": "2023-01-12T14:59:29.804705Z",
    "updated_at": "2025-03-27T02:05:57.327822Z",
    "deleted_at": null,
    "sha1_hash": "fe0f7d0a64a7911aae93315d4f5f4c25c0a772ab",
    "title": "2020-11-05 - Attack of the clones- Git clients remote code execution",
    "authors": "",
    "file_creation_date": "2022-05-28T04:58:46Z",
    "file_modification_date": "2022-05-28T04:58:46Z",
    "file_size": 2866979,
    "plain_text": "# Attack of the clones: Git clients remote code execution\n\n**[blog.blazeinfosec.com/attack-of-the-clones-github-desktop-remote-code-execution/](https://blog.blazeinfosec.com/attack-of-the-clones-github-desktop-remote-code-execution/)**\n\nBlaze Information Security November 5, 2020\n\n**Introduction**\n\nThis post is a rather unusual story of a vulnerability that could be leveraged as a supply\nchain attack and used to attack millions of software developers around the world. It is also a\ntale of a bug collision that paid a bounty to one reporter and assigned the CVE to another!\n\nThe main focus of this blog post is GitHub Desktop. Other Git clients such as GitKraken, GitTower and SourceTree were also found to be vulnerable, however these have different\nexploitation scenarios that require user interaction.\n\n**Brief description of the issue**\n\nAs part of GitHub Desktop's default repository cloning process, among other actions it calls\nthe executable git-lfs.\n\nFrom git-lfs's official page \"Git Large File Storage (LFS) replaces large files such as audio\nsamples, videos, datasets, and graphics with text pointers inside Git, while storing the file\ncontents on a remote server like GitHub.com or GitHub Enterprise.\"\n\ngit-lfs is then called on the current cloned repository, already present in disk.\n\n\n-----\n\nA vulnerability was discovered when cloning a repository with a especially crafted file in the\nroot directory. Upon cloning such malicious repository, code execution is achieved with the\nsame privileges as the affected user running GitHub Desktop.\n\nWhen inspecting the desktop application under Proccess Monitor, it was noticed several\nactions of git-lfs called a git executable from inside the newly cloned repository.\n\nBy placing a malicious git in the root of the malicious repo, a user that clones it will have the\nmalicious git executed by git-lfs, all of this behind the scenes and transparent to the user.\n\nThe cloning process happens normally and there is no visual indication that a malicious\nbinary was ran instead of the original git executable.\n\n**Root cause analysis**\n\nWe attempted to understand the root cause of this vulnerability by reading git-lfs's code. The\nauthors of this write-up tried to put together as much information as possible in order to\nunderstand the cause of the problem.\n\nFrom [https://github.com/git-lfs/git-lfs/blob/master/commands/command_clone.go](https://github.com/git-lfs/git-lfs/blob/master/commands/command_clone.go)\n\nFrom line 23:\n\n\n-----\n\n```\nfunc cloneCommand(cmd cobra.Command, args []string) {\n     requireGitVersion()\n     if git.IsGitVersionAtLeast(\"2.15.0\") {\n          msg := []string{\n              \"WARNING: 'git lfs clone' is deprecated and will not be\nupdated\",\n              \"     with new flags from 'git clone'\",\n              \"\",\n              \"'git clone' has been updated in upstream Git to have\ncomparable\",\n              \"speeds to 'git lfs clone'.\",\n          }\n          fmt.Fprintln(os.Stderr, strings.Join(msg, \"\\n\"))\n     }\n\n```\nThe function above seems to be called when a clone action takes place. Right in the\nbeginning the function calls requireGitVersion() and then checks whether the version is at\nleast 2.15.0.\n\nFrom [https://github.com/git-lfs/git-lfs/blob/master/commands/commands.go](https://github.com/git-lfs/git-lfs/blob/master/commands/commands.go)\n\nLine 537:\n```\nfunc requireGitVersion() {\n     minimumGit := \"1.8.2\"\n     if !git.IsGitVersionAtLeast(minimumGit) {\n          gitver, err := git.Version()\n          if err != nil {\n              Exit(\"Error getting git version: %s\", err)\n          }\n          Exit(\"git version >= %s is required for Git LFS, your version: %s\",\nminimumGit, gitver)\n     }\n}\n\n```\nIt calls !git.IsGitVersionAtLeast(minimumGit) which can be found in https://github.com/gitlfs/git-lfs/blob/master/git/version.go\n\nFrom line 28:\n```\nfunc IsGitVersionAtLeast(ver string) bool {\n     gitver, err := Version()\n     if err != nil {\n          tracerx.Printf(\"Error getting git version: %v\", err)\n          return false\n     }\n     return IsVersionAtLeast(gitver, ver)\n}\n\n```\nVersion() can be found in the same file version.go on line 18:\n\n\n-----\n\n```\nfunc Version() (string, error) {\n     gitVersionOnce.Do(func() {\n          gitVersion, gitVersionErr =\n              subprocess.SimpleExec(\"git\", \"version\")\n     })\n     return gitVersion, gitVersionErr\n}\n\n```\nThe function calling chain is the following:\ncloneCommand() -> requireGitVersion() -> IsGitVersionAtLeast() -> Version()\n\nWe can see that in line 21 in version.go, there is inside the function Version() a call to\nsubprocess.SimpleExec() - it executes the git binary with the argument \"version\".\n\nThere is an implicit assumption from git-lfs that by executing an external binary, the operating\nsystem will first look it up from the system's PATH environment variable. This is the true root\ncause of the vulnerability.\n\nCalling the subprocess 'git' works as intended in GitHub Desktop for MacOS. In Windows,\nhowever, the search order favors the current directory first and only then it searches in the\norder specified in PATH.\n\n**Exploitation**\n\nBy copying calc.exe, renaming it to git.exe and committing/pushing it into the root of the\nrepository, the attacker sets up the crafted repository that will be used to later exploit users.\n\nWhen a developer clones this repository using GitHub Desktop for Windows, its\nsubcomponent git-lfs will work on the cloned folder as its current directory, meaning all\nsubsequent calls to the binary 'git' will be instead calling the malicious git.exe not the one\npresent in the PATH.\n\n\n-----\n\n-----\n\n-----\n\nBelow is a the video of exploiting this issue on GitHub Desktop for Windows:\n\nWatch Video At:\n\nhttps://youtu.be/p8tbHNBbO1U\n\n**Other clients**\n\n\n-----\n\nDuring our research we noticed SourceTree\n\nSourceTree\n\nhttps://youtu.be/zOXUdP50VYM\n\nGitKraken\n\nhttps://youtu.be/RmLCjgc0ppo\n\n\nWatch Video At:\n\nWatch Video At:\n\n\n-----\n\n**Credits**\n\n[The vulnerability was simultaneously discovered and researched by Vitor Fernandes and](https://twitter.com/Rapt00rVF)\nJulio Fort of Blaze Information Security. The independent researcher Dawid Golunski (dobra\nrobota, amigo!) apparently discovered the issue a few days earlier and submitted it to\nMITRE, while Vitor submitted it to GitHub's bug bounty.\n\nVitor collected the bounty from GitHub's program on HackerOne as his report arrived earlier\nand Dawid was assigned the CVE.\n\n**References**\n\n[1] https://docs.microsoft.com/en-us/windows-server/administration/windowscommands/path]\n\n[2] https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012r2-and-2012/cc753427(v=ws.11)\n\n[3] [https://github.com/git-lfs/git-lfs/security/advisories/GHSA-4g4p-42wc-9f3m (Collision with](https://github.com/git-lfs/git-lfs/security/advisories/GHSA-4g4p-42wc-9f3m)\nDawid Golunski)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-11-05 - Attack of the clones- Git clients remote code execution.pdf"
    ],
    "report_names": [
        "2020-11-05 - Attack of the clones- Git clients remote code execution.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535569,
    "ts_updated_at": 1743041157,
    "ts_creation_date": 1653713926,
    "ts_modification_date": 1653713926,
    "files": {
        "pdf": "https://archive.orkl.eu/fe0f7d0a64a7911aae93315d4f5f4c25c0a772ab.pdf",
        "text": "https://archive.orkl.eu/fe0f7d0a64a7911aae93315d4f5f4c25c0a772ab.txt",
        "img": "https://archive.orkl.eu/fe0f7d0a64a7911aae93315d4f5f4c25c0a772ab.jpg"
    }
}