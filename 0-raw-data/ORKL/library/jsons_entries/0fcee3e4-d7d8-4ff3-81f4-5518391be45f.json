{
    "id": "0fcee3e4-d7d8-4ff3-81f4-5518391be45f",
    "created_at": "2023-01-12T14:59:12.324937Z",
    "updated_at": "2025-03-27T02:06:12.535145Z",
    "deleted_at": null,
    "sha1_hash": "32462bb300cfd6696a9795aee3bcbd292ce36828",
    "title": "2019-08-05 - Latest Trickbot Campaign Delivered via Highly Obfuscated JS File",
    "authors": "",
    "file_creation_date": "2022-05-28T15:17:48Z",
    "file_modification_date": "2022-05-28T15:17:48Z",
    "file_size": 196799,
    "plain_text": "# Trickbot Delivered via Highly Obfuscated JS File\n\n**[blog.trendmicro.com/trendlabs-security-intelligence/latest-trickbot-campaign-delivered-via-highly-obfuscated-js-file/](https://blog.trendmicro.com/trendlabs-security-intelligence/latest-trickbot-campaign-delivered-via-highly-obfuscated-js-file/)**\n\nAugust 5, 2019\n\nWe have been tracking Trickbot banking trojan activity and recently discovered a variant of the malware (detected by Trend Micro as\n[TrojanSpy.Win32.TRICKBOT.TIGOCDC) from distributed spam emails that contain a Microsoft Word document with enabled macro. Once the](https://www.trendmicro.com/vinfo/us/threat-encyclopedia/malware/TrojanSpy.Win32.TRICKBOT.TIGOCDC)\ndocument is clicked, it drops a heavily obfuscated JS file (JavaScript) that downloads Trickbot as its payload. This malware also checks for the\nnumber of running processes in the affected machine; if it detects that it’s in an environment with limited processes, the malware will not\nproceed with its routine as it assumes that it is running in a virtual environment.\n\nAside from its information theft capabilities, it also deletes files located in removable and network drives that have particular extensions, after\nwhich the files are replaced with a copy of the malware. Based on our telemetry, this Trickbot campaign has affected the United States the\nmost. It has also distributed spam to China, Canada, and India.\n\n[Figure 1. Infection chain](https://blog.trendmicro.com/content/dam/trendmicro/global/en/migrated/security-intelligence-migration-spreadsheet/trendlabs-security-intelligence/2019/08/fig-1-Trickbot-spam-js-infection-chain.jpg)\n\nFigure 1. Infection chain\n\nIn a sample email, the spam purports to be a subscription notification involving advertising providers, even telling the user that it submitted an\napplication for a three-year subscription and settled a sum of money with the sender. The mail then explains that several more fees will be\ncharged to the user’s card in the coming transactions. It ends by prompting the user to see the attached document for all the settlement and\nsubscription information. The document in question contains the malicious script.\n\nThe distributed Word document presents the user with the following notification (see Figure 2) that states the content can be viewed by\nenabling macro content. It’s worth noting that the document hides the JS script in the document itself and not in the macro. It does this by\ndisguising the script through the same font color as the document background.\n\n[Figure 2. Document asking users to enable macro](https://blog.trendmicro.com/content/dam/trendmicro/global/en/migrated/security-intelligence-migration-spreadsheet/trendlabs-security-intelligence/2019/08/fig-2-trickbot-spam-js-document-enable-macro.jpg)\n\nFigure 2. Document asking users to enable macro\n\nThe script is obfuscated and contains different functions. In order to decrypt a function, it will use another function that will convert it to a single\ncharacter.\n\n[Figure 3. Function for decryption](https://blog.trendmicro.com/content/dam/trendmicro/global/en/migrated/security-intelligence-migration-spreadsheet/trendlabs-security-intelligence/2019/08/fig-3-trickbot-spam-js-decryption-function.png)\n\nFigure 3. Function for decryption\n\nUpon successfully deobfuscating the file, we were able to analyze it and observed some interesting behaviors. Upon execution, it will display a\nfake Microsoft error to trick the user with an error message that pops up after enabling the macro. But actually, the JS file is already running in\nthe background.\n\n[Figure 4. Fake Microsoft error](https://blog.trendmicro.com/content/dam/trendmicro/global/en/migrated/security-intelligence-migration-spreadsheet/trendlabs-security-intelligence/2019/08/fig-4-trickbot-spam-js-fake-ms-error.png)\n\nFigure 4. Fake Microsoft error\n\nFor persistence, the malware creates a copy of itself into the Startup folder as Shell.jse. The JS file also checks for running processes —\nwhat’s particularly notable is the malware’s anti-analysis or evasion characteristic, which checks for the total number of all the running\nprocesses in the victim’s machine, which means it will not proceed with its execution if there are not enough processes running.\n\n\n-----\n\nt e u g p ocesses a e u de, 00 c a acte s ( e gt o t e st g), t e a a e assu es t to be a d cato t at t s u g a\nvirtual or sandbox environment. It will also check for the existence of processes usually used for analysis. Aside from these, the malware\ninspects if the environment it runs in relates to specific usernames.\n\n[Figure 5. A snippet of checked processes and usernames](https://blog.trendmicro.com/content/dam/trendmicro/global/en/migrated/security-intelligence-migration-spreadsheet/trendlabs-security-intelligence/2019/08/fig-5-trickbot-spam-checked-processes-usernames.png)\n\nFigure 5. A snippet of checked processes and usernames\n\n[Figure 6. Code error shown if anything matches the check](https://blog.trendmicro.com/content/dam/trendmicro/global/en/migrated/security-intelligence-migration-spreadsheet/trendlabs-security-intelligence/2019/08/fig-6-trickbot-spam-code-error-shown-checked.jpg)\n\nFigure 6. Code error shown if anything matches the check\n\nHere’s a list of processes and debugging tools the malware checks for in the affected system:\n\nAgentSimulator.exe\nB.exe\nBehaviorDumper\nBennyDB.exe\nctfmon.exe\nDFLocker64\nFrzState2k\ngemu - ga.exe\niexplore.exe\nImmunityDebugger\nLOGSystem.Agent.Service.exe\nlordPE.exe\nProcessHacker\nprocexp\nProcmon\nPROCMON\nProxifier.exe\ntcpdump\nVBoxService\nVBoxTray.exe\nvmtoolsd\nvmware\nVzService.exe\nwindanr.exe\nWireshark\n\nUpon further analysis, we’ve also compiled the usernames the malware checks for based on the following strings:\n\nEmily\nHAPUBWS\nHong Lee\nJohnson\nmilozs\nPeter Wilson\nSystemIT | admin\nVmRemoteGuest\nWIN7 - TRAPS\n\nFor the malware’s payload, it will connect to the URL hxxps://185[.]159[.]82[.]15/hollyhole/c644[.]php then checks for the file to be downloaded.\nIf it is an executable file, it will save the file to %Temp% as {random}.exe and execute it afterwards. If the file is not an executable, it will then\nsave it as {random}.cro in the same folder. The .cro file will then be decoded using certutil.exe, saved as {random}.exe in the same directory,\nand executed. Upon further research, we discovered that the downloaded .exe file is a variant of the Trickbot malware.\n\n[Figure 7. The file is saved, random names get generated, and .cro is decoded using certutil.exe](https://blog.trendmicro.com/content/dam/trendmicro/global/en/migrated/security-intelligence-migration-spreadsheet/trendlabs-security-intelligence/2019/08/fig-7-trickbot-spam-saved-file-random-names-cro-certutil.png)\n\nFigure 7. The file is saved, random names get generated, and .cro is decoded using certutil.exe\n\nAside from stealing system information such as OS, CPU, and memory information; user accounts; installed programs and services; IP\nconfiguration; and network information (configuration, users, and domain settings), this Trickbot variant also gathers the following credentials\nand information from applications and internet browsers.\n\n**Application credentials**\n\nFilezilla\n\n\n-----\n\nc oso t Out oo\nPuTTy\nRemote Desktop (RDP)\nVNC\nWinSCP\n\n**Browser credentials and information (Google Chrome, Internet Explorer, Microsoft Edge, and Mozilla Firefox)**\n\nAutofills\nBilling info data\nBrowsing history\nCredit card data\nHTTP POST responses\nInternet cookies\nUsernames and passwords\n\nThis malware also uses a point-of-sale (PoS) extraction module called psfin32, which identifies PoS-related terms located in the domain of\ninterest. The [module uses LDAP queries to search for PoS information on machines with the following substrings:](https://blog.trendmicro.com/trendlabs-security-intelligence/trickbots-bigger-bag-of-tricks/)\n\n*ALOHA*\n*BOH*\n*CASH*\n*LANE*\n*MICROS*\n*POS*\n*REG*\n*RETAIL*\n*STORE*\n*TERM*\n\nThe variant also appears to drop shadnewdll, a proxy module that intercepts and modifies web traffic on an affected device to create fraudulent\n[bank transactions over the network. Additionally, according to security researcher Brad Duncan, the module shares similarities with the](https://www.bleepingcomputer.com/news/security/trickbot-trojan-gets-icedid-proxy-module-to-steal-banking-info/)\nbanking trojan IcedID, which redirects victims to fake online banking sites or attaches to a browser process to inject fake content in phishing\nschemes.\n\nIn such cases where the malware fails to connect, it will search for files with the following extensions in the removable and network drives.\nThese extensions are file types used by Microsoft Office and OpenDocument:\n\n.doc\n.xls\n.pdf\n.rtf\n.txt\n.pub\n.odt\n.ods\n.odp\n.odm\n.odc\n.odb\n\nFiles with the aforementioned extensions will be saved in the %Temp% folder as ascii.txt. The said files will all then be deleted and replaced\nwith a copy of the malware and the extension .jse (but is actually a JS file).\n\n[Figure 8. Scanning for files and replacing it with a copy of itself](https://blog.trendmicro.com/content/dam/trendmicro/global/en/migrated/security-intelligence-migration-spreadsheet/trendlabs-security-intelligence/2019/08/fig-8-trickbot-spam-scanned-files-replaced-copy-malware.png)\n\nFigure 8. Scanning for files and replacing it with a copy of itself\n\n## Defending Against Trickbot: Trend Micro Recommendations and Solutions\n\nInformation-stealing malware Trickbot has become a cybercriminal mainstay for infecting machines and compromising emails, and has been\nused to [reportedly steal more than 250 million accounts. This new development shows how cybercriminals can constantly tweak an existing](https://www.engadget.com/2019/07/12/trickbot-malware-trickbooster-250-million-email-accounts/)\n[banking trojan to add new capabilities. Users, however, can prevent these attacks by simply following best practices against spam. Aside from](https://www.trendmicro.com/vinfo/ph/security/news/cybercrime-and-digital-threats/infosec-guide-email-threats)\nawareness of the telltale signs of a spam email such as suspicious sender address and glaring grammatical errors, we also recommend that\nusers refrain from opening email attachments from unverified sources.\n\n\n-----\n\nUse s a d e te p ses ca a so be e t o p otect o t at uses a u t aye ed app oac aga st s s b oug t by t eats e c bot e\n[recommend employing endpoint application control that reduces attack exposure by ensuring only files, documents, and updates associated](https://blog.trendmicro.com/en_us/business/products/user-protection/sps/endpoint.html)\n[with whitelisted applications and sites can be installed, downloaded, and viewed. Endpoint solutions powered by XGen™ security such as](http://go.trendmicro.com/sem/sem/www.trendmicro.com/us/business/xgen/index.html)\n[Trend Micro™ Security and](https://blog.trendmicro.com/en_us/forHome/products.html) [Trend Micro Network Defense can detect related malicious files and URLs and protect users’ systems. Trend](https://blog.trendmicro.com/en_us/business/products/network.html)\nMicro™ Smart Protection Suites and [Trend Micro Worry-Free™ Business Security, which have](https://www.trendmicro.com/en_us/small-business/worry-free.html) [behavior monitoring capabilities, can](https://success.trendmicro.com/solution/1122593-configuring-behavior-monitoring-settings-in-apex-one)\nadditionally protect from these types of threats by detecting malicious files such as the document and JS file involved in this campaign, as well\nas blocking all related malicious URLs.\n\nThe [Trend Micro Deep Discovery Inspector protects customers from threats that may lead to C&C connection and data exfiltration via these](https://blog.trendmicro.com/en_us/business/products/network/advanced-threat-protection/inspector.html)\nDDI rules:\n\n1645: Possible Self-Signed SSL certificate detected\n2780: TRICKBOT - HTTP (Request)\n\n**Indicators of Compromise (IoCs)**\n\n\n**SHA-256 and URL** **Trend Micro Pattern**\n**Detection**\n\n0242ebb681eb1b3dbaa751320dea56e31c5e52c8324a7de125a8144cc5270698 TrojanSpy.Win32.\nTRICKBOT.TIGOCDC\n\n16429e95922c9521f7a40fa8f4c866444a060122448b243444dd2358a96a344c Trojan.W97M.\nJASCREX.A\n\n666515eec773e200663fbd5fcad7109e9b97be11a83b41b8a4d73b7f5c8815ff Trojan.W97M.\nJASCREX.AB\n\n41cd7fec5eaad44d2dba028164b9b9e2d1c6ea9d035679651b3b344542c40d45 Trojan.W97M.\nJASCREX.AD\n\n970b135b4c47c12f97bc3d3bbdf325f391b499d03fe19ac9313bcace3a1450d2 Trojan.W97M.\nJASCREX.AC\n\n8537d74885aed5cab758607e253a60433ef6410fd9b9b1c571ddabe6304bb68a TrojanSpy.JS.\nNEMUCOD.BONINGH\n\n970b135b4c47c12f97bc3d3bbdf325f391b499d03fe19ac9313bcace3a1450d2\n\nhxxps://185[.]159[.]82[.]15/hollyhole/c644[.]php\n\n**_[Check Point Research also tweeted about this campaign last July.](https://twitter.com/_CPResearch_/status/1151900514612908033)_**\n\nSpam\n\n\n**Trend Micro Predictive Machine**\n**Learning Detection**\n\nTROJ.Win32.TRX.XXPE50FFF031\n\nDownloader.VBA.TRX.XXVBAF01FF0\n\nDownloader.VBA.TRX.XXVBAF01FF0\n\nDownloader.VBA.TRX.XXVBAF01FF0\n\n\nWe have been tracking Trickbot activity and recently discovered a variant of the malware (detected by Trend Micro as\nTrojanSpy.Win32.TRICKBOT.TIGOCDC) from distributed spam emails that contain a Microsoft Word document with enabled macro.\n\nBy: Noel Anthony Llimos, Michael Jhon Ofiaza August 05, 2019 Read time: ( words)\n\nContent added to Folio\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-08-05 - Latest Trickbot Campaign Delivered via Highly Obfuscated JS File.pdf"
    ],
    "report_names": [
        "2019-08-05 - Latest Trickbot Campaign Delivered via Highly Obfuscated JS File.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535552,
    "ts_updated_at": 1743041172,
    "ts_creation_date": 1653751068,
    "ts_modification_date": 1653751068,
    "files": {
        "pdf": "https://archive.orkl.eu/32462bb300cfd6696a9795aee3bcbd292ce36828.pdf",
        "text": "https://archive.orkl.eu/32462bb300cfd6696a9795aee3bcbd292ce36828.txt",
        "img": "https://archive.orkl.eu/32462bb300cfd6696a9795aee3bcbd292ce36828.jpg"
    }
}