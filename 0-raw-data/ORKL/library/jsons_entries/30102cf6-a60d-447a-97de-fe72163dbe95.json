{
    "id": "30102cf6-a60d-447a-97de-fe72163dbe95",
    "created_at": "2023-01-12T15:01:59.898037Z",
    "updated_at": "2025-03-27T02:09:17.891297Z",
    "deleted_at": null,
    "sha1_hash": "6f431868d3baadcfbfcc721acf4dffda75efa703",
    "title": "2020-08-31 - NetWalker Ransomware in 1 Hour",
    "authors": "",
    "file_creation_date": "2022-05-28T18:02:33Z",
    "file_modification_date": "2022-05-28T18:02:33Z",
    "file_size": 1203420,
    "plain_text": "# NetWalker Ransomware in 1 Hour\n\n**[thedfirreport.com/2020/08/31/netwalker-ransomware-in-1-hour/](https://thedfirreport.com/2020/08/31/netwalker-ransomware-in-1-hour/)**\n\nAugust 31, 2020\n\nThe threat actor logged in through RDP, attempted to run a Cobalt Strike Beacon, and then\ndumped memory using ProcDump and Mimikatz. Next, they RDPed into a Domain\nController, minutes before using PsExec to run the NetWalker ransomware payload on all\nDomain joined systems. The entire intrusion took ~1 hour.\n\n\n-----\n\n## What is NetWalker?\n\nNetWalker, as a ransomware strain, first appeared in August 2019. In its initial version,\nthe ransomware went by the name of Mailto but rebranded to NetWalker towards the\nend of 2019.\n\nThe ransomware operates as a closed-access RaaS — a ransomware-as-a-service\nportal. Other hacker gangs sign up and go through a vetting process, after which they\nare granted access to a web portal where they can build custom versions of the\nransomware.\n\nThe distribution is left to these second-tier gangs, known as affiliates, and each group\ndeploys it as they see fit.\n\nFor more info on NetWalker check out the following posts:\n\n[https://labs.sentinelone.com/netwalker-ransomware-no-respite-no-english-required/](https://labs.sentinelone.com/netwalker-ransomware-no-respite-no-english-required/)\n\nhttps://news.sophos.com/en-us/2020/05/27/netwalker-ransomware-tools-give-insight-intothreat-actor/\n\n[https://threatpost.com/netwalker-ransomware-29m-march/158036/](https://threatpost.com/netwalker-ransomware-29m-march/158036/)\n\n[https://go.crowdstrike.com/rs/281-OBQ-266/images/ReportCSIT-20081e.pdf](https://go.crowdstrike.com/rs/281-OBQ-266/images/ReportCSIT-20081e.pdf)\n\n## Exploitation\n\n[We saw multiple RDP logins around the time of the attack but we believe 198.181.163[.]103](https://www.ultratools.com/tools/ipWhoisLookupResult)\n(possibly IPVanish VPN) to be the source of this intrusion. We will include other IPs that\nlogged into the honeypot on this day in the IOCs section.\n\nThe threat actor logged in using the DomainName\\Administrator account.\n\n## Command & Control\n\nc37.ps1 was dropped and run about 16 minutes after initial login. There didn’t appear to be\nany network connections made while running this script which makes us wonder if the script\nworks or not.\n\nThe script is heavily obfuscated but still looks like Cobalt Strike. When we uploaded the\nscript to VT, Thor said it may also contain Windshield or SplinterRAT.\n\n\n-----\n\nc37.ps1 has a very low detection rate even after 7+ days.\n\nMinutes later they ran c37.exe, which copies itself to a temp directory and then stops. This\nbinary includes Neshta as well as many capabilities as seen below:\n\n[capa](https://www.fireeye.com/blog/threat-research/2020/07/capa-automatically-identify-malware-capabilities.html)\n[After further analysis and a comment from @GaborSzappanos, we were able to confirm that](https://twitter.com/GaborSzappanos)\nboth of these are indeed Cobalt Strike and connect to 173.232.146[.]37 over 443.\n\n\n-----\n\n[The Cobalt Strike server at 173.232.146.37 is using the default cert (146473198) and oddly](https://www.recordedfuture.com/cobalt-strike-servers/)\nenough could not be MiTM. We tried to MiTM this connection multiple times and kept getting\nan error stating SSL session did not authentication successfully.\n\nWe attempted to run c37.ps1 and c37.exe in a few sandboxes and none of them captured\nthe network traffic which tells us that these Beacons include sandbox evasion techniques.\n[Here are a couple runs – https://capesandbox.com/analysis/54494/](https://capesandbox.com/analysis/54494/)\n\n\n-----\n\n[https://app.any.run/tasks/4524fb0c-8e17-4255-8582-35b0e206ff3f/](https://app.any.run/tasks/4524fb0c-8e17-4255-8582-35b0e206ff3f/)\n[https://capesandbox.com/analysis/54493/](https://capesandbox.com/analysis/54493/)\n\nThe c37.exe binary includes shared code from Neshta, poison, BazarBackdoor, XMRig and a\nlarge portion from CobaltStrike according to Intezer.\n\n## Discovery\n\nAdFind was dropped alongside a script named adf.bat. We’ve seen this script in the past and\n[wrote about it here.](https://thedfirreport.com/2020/05/08/adfind-recon/)\n\nWe can see from these lnk files that they opened a few of the txt files output by AdFind. We\ncan also see that domains.txt and ips.log were opened minutes after AdFind being run.\n\n\n-----\n\n[LECmd – Tool by EricZimmerman](https://binaryforay.blogspot.com/2016/02/introducing-lecmd.html)\nA few minutes after AdFind was run, a command prompt was opened and the following\ncommands were either copy and pasted slowly or manually typed.\n```\nnltest /dclist:\nnet group \"Domain Computers\" /DOMAIN\nnet groups \"Enterprise Admins\" /domain\nnet user Administrator\n\n```\nShortly after that, a script named pcr.bat was dropped and executed.\n\nThis script pings a list of hostnames (domains.txt) and writes the output to ips.log. The ping\ncommand they use sends one ping and forces IPv4. This domains.txt file most likely came\nfrom the above AdFind command using the domainlist parameter.\n\n## Credential Access\n\nMimikatz was dropped and then a minute later procdump64.exe was dropped. The threat\nactors then used Procdump to dump lsass using the following command:\n```\nprocdump64.exe -ma lsass.exe lsass.dmp\n\n```\nThis procdump64 binary appears to be compiled with Delphi and does not match known\nhashes. It appears the threat actors rolled their own but included the original instructions.\n\n\n-----\n\nMimikatz was run about a minute later.\n\n## Lateral Movement\n\nThe threat actor RDPed into a Domain Controller (DC) after dumping credentials. Shortly\nafter accessing the DC they dropped ip.list.txt, P100119.ps1, and PsExec.\n\n\n-----\n\nThe threat actor was now ready to execute it’s objective.\n\n## Objectives\n\nThe threat actor used PsExec to mount a share on all systems as the Domain Administrator\nand then execute the ransomware payload using PowerShell. NetWalker was delivered to all\nonline Domain joined systems in the honeypot via the below command:\n\nC:\\psexec.exe @ip-list.txt -d cmd /c “(net use q: /delete /y &; net use q:\n\\\\DomainController\\DomainName /user:DomainName\\administrator ThisWasThePassword &;\npowershell -ExecutionPolicy ByPass -NoLogo -NoProfile -windowstyle hidden -NoExit -File\nq:\\P100119.ps1”\n\nAfter the PowerShell script runs you are left with the following ransom note.\n\n\n-----\n\nThe NetWalker operators asked for $50k within 7 days or $100k after. They were talked\ndown to $35k after the time expired.\n\n## Timeline\n\n\n-----\n\n[Enjoy our report? Please consider donating $1 or more to the project using Patreon. Thank](https://www.patreon.com/thedfirreport)\nyou for your support!\n\n## Detections\n\nET POLICY PsExec service created\n\nPsExec Service Start –\nhttps://github.com/Neo23x0/sigma/blob/master/rules/windows/process_creation/win_psexesv\nc_start.yml\n\n\n-----\n\nSuspicious Use of Procdump –\nhttps://github.com/Neo23x0/sigma/blob/master/rules/windows/process_creation/win_susp_pr\nocdump.yml\n\nMimikatz Use –\nhttps://github.com/Neo23x0/sigma/blob/master/rules/windows/builtin/win_alert_mimikatz_key\nwords.yml\n\nDetects AdFind usage from our case:\n```\ntitle: AdFind Recon\ndescription: Threat Actor using AdFind for reconnaissance.\nauthor: The DFIR Report\ndate: 2019/8/2\nreferences:\n- https://thedfirreport.com/2020/08/03/dridex-from-word-to-domain-dominance/\ntags:\n- attack.remote_system_discovery\n- attack.T1018\nlogsource:\ncategory: process_creation\nproduct: windows\ndetection:\nselection_1:\nCommandLine|contains:\n- adfind -f objectcategory=computer\nselection_2:\nCommandLine|contains:\n- adfind -gcb -sc trustdmp\ncondition: selection_1 or selection_2\nfalsepositives:\n- Legitimate Administrator using tool for Active Directory querying\nlevel: medium\nstatus: experimental\n\n```\nYara rule for Mimikatz [https://github.com/gentilkiwi/mimikatz/blob/master/kiwi_passwords.yar](https://github.com/gentilkiwi/mimikatz/blob/master/kiwi_passwords.yar)\n\n## IOCs\n\n[https://misppriv.circl.lu/events/view/73574](https://misppriv.circl.lu/events/view/73574)\n\n[https://otx.alienvault.com/pulse/5f4c3eb15ea4e24eb5b43a49](https://otx.alienvault.com/pulse/5f4c3eb15ea4e24eb5b43a49)\n```\nc37.ps1 8e030188e0d03654d5e7a7738a9d6a9a e0a37d0c26b351b789caffc8c90b968269982d\n5536be48e4eac81ad77aeade20b28ff8b72275832e6833f5e1b692eb99f312fd13\nc37.exe 531c0c5e943863b00c7157c05603113a caa18377e764a3a27c715b3d69ba2258ee4eb0b2\n4f7dd00a005caf046dd7e494fea25be2264974264d567edfc89122242b7c41bc\nadf.bat 96e1849976d90425e74f075ed6bf8c30 1296a1f8887753ef87910b544727de76ce2adcc5\ne56d45628f0c2bda30ab235657704aac50a8433bdb4215c77a2e0f52f0f31a49\n\n```\n\n-----\n\n```\nmimikatz.exe 5af5e3426926e551ed3acc5bea45eac6\ne24a174fff19d873df0fa5eddd9ec534617ed9d7\nf743c0849d69b5ea2f7eaf28831c86c1536cc27ae470f20e49223cbdba9c677c\npcr.bat 81c965ff526e7afd73c91543fee381a3 b9b83b17fd6d89807dcab7772b1416fa90ca4b0e\nae431797c551c20fe2f3fe1adc08a566edfabf45abbd924f0c8da06381ab6e48\nP100119.ps1 0d890fc8e761b764ba3a04af07197e20 21c0ed7abaafbfd14c777aa370f397e4351654a6\n5ae06a8d117e876476832245039715825fbfbefc0d2463ab6c30295dd1d4afa6\nprocdump64.exe 3b447099ca280dabd22d36f84ebfd3bb\n49fd831a738b21ee0a1b3b62cd15801abe8c32d5\n6a511d4178d6d2f98f8af34311d0e15dc8dc1c4b643e6943f056da6ce242e70d\n\n```\nYara – embedded_win_api – A non-Windows executable contains win32 API functions\nnames – Author: nex\n\nRDP logins on the day of the intrusion\n```\n184.58.243.205\n173.239.199.73\n176.126.85.39\n198.181.163.103\n141.98.81.191\n93.179.69.154\n173.232.146.37\n\n```\ninternal case 1003\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-08-31 - NetWalker Ransomware in 1 Hour.pdf"
    ],
    "report_names": [
        "2020-08-31 - NetWalker Ransomware in 1 Hour.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535719,
    "ts_updated_at": 1743041357,
    "ts_creation_date": 1653760953,
    "ts_modification_date": 1653760953,
    "files": {
        "pdf": "https://archive.orkl.eu/6f431868d3baadcfbfcc721acf4dffda75efa703.pdf",
        "text": "https://archive.orkl.eu/6f431868d3baadcfbfcc721acf4dffda75efa703.txt",
        "img": "https://archive.orkl.eu/6f431868d3baadcfbfcc721acf4dffda75efa703.jpg"
    }
}