{
    "id": "092c0b06-3e3b-409b-ad92-32b0ad53e0ef",
    "created_at": "2023-01-12T15:08:21.218584Z",
    "updated_at": "2025-03-27T02:14:34.179338Z",
    "deleted_at": null,
    "sha1_hash": "5a1e70e93c66b5f4dc5aad97b0fbf2d7ab0fa5cf",
    "title": "2021-12-10 - Log4j2 Vulnerability “Log4Shell” (CVE-2021-44228)",
    "authors": "",
    "file_creation_date": "2022-05-28T23:18:45Z",
    "file_modification_date": "2022-05-28T23:18:45Z",
    "file_size": 414748,
    "plain_text": "# Log4j2 Vulnerability: How to Mitigate CVE-2021-44228\n\n**[crowdstrike.com/blog/log4j2-vulnerability-analysis-and-mitigation-recommendations/](https://www.crowdstrike.com/blog/log4j2-vulnerability-analysis-and-mitigation-recommendations/)**\n\nCrowdStrike Intelligence Team December 10, 2021\n\nLog4j2 is an open-source, Java-based logging framework commonly incorporated into\nApache web servers.\nBetween late November and early December 2021, a critical vulnerability (CVE-202144228) impacting the Log4j2 utility was reported, resulting in several fixes and code\nrevisions from the vendor.\nThe Log4j2 library is used in numerous Apache frameworks services, and as of Dec. 9,\n2021, active exploitation has been identified in the wild (ITW). At the time of this writing,\nCrowdStrike Falcon OverWatch™ and external sources confirm active and ongoing\nattempts to exploit CVE-2021-44228.\nThis vulnerability is being widely exploited in the wild and it is highly advisable to\nassess the use and impact of log4j and patch as soon as possible.\nInformation surrounding the vulnerability, impacted products and in-the-wild exploitation\nis continuing to evolve, and CrowdStrike will update this blog as new information\nbecomes available.\n\n**12/14 UPDATE**\n\n\n-----\n\nApache has released version 2.16.0, which completely removes support for Message\nLookups and disables JNDI by default.\n\nCrowdStrike has identified a malicious Java class file hosted on infrastructure associated\nwith a nation-state adversary. The Java code is used to download known instances of\nadversary-specific tooling and is likely to be used in conjunction with the recently disclosed\nLog4Shell exploit (CVE-2021-44228).\n\n**12/13 UPDATE**\n\nAdditional countermeasures for the Log4j2 vulnerability can be activated to prevent the\nexecution of Java classes if class names are not included in the allowlist, which effectively\nraises the bar for attackers to deliver and run their own code. In response, attackers are\ncurrently working on more complex exploitation scenarios to bypass these restrictions. One\ncommon strategy is to provide a serialized payload that exploits a deserialization\nvulnerability, making use of Java code gadgets that are already present in the class path and\ntherefore trusted. This concept is implemented in the open-source JNDI-Exploit-Kit.1\nCrowdStrike is currently unaware of a reliable method to construct a Log4Shell exploit that\napplies to all potentially vulnerable products.\n\nAs malicious serialized objects, so-called “gadget chains” must be tailored for specific\ntargets; thus, attackers frequently leverage information leaks to obtain information on a host.\nBy passing specially crafted input with nested variables to Log4j2, an attacker can leak\nsensitive system information that can then be used to construct a gadget chain for the host.\nThis information can be exfiltrated through various protocols supported by the Java Naming\nand Directory Interface (JNDI) in a similar fashion to the original attack vectors for CVE2021-44228. To prevent all types of requests, respective Log4j2 applications can be started\nwith setting `log4j2.formatMsgNoLookups=\"true\" .`\n\n**12/10 UPDATE**\n\n\nLog4j2 is an open-source, Java-based, logging framework commonly incorporated into\nApache web servers. According to public sources, Chen Zhaojun of Alibaba officially2\nreported a Log4j2 remote code execution (RCE) vulnerability to Apache on Nov. 24,\n2021.3,4 This critical vulnerability, subsequently tracked as CVE-2021-44228 (aka\n“Log4Shell”), impacts all versions of Log4j2 from 2.0-beta9 to 2.14.1.\n\nAttempts to mitigate CVE-2021-44228 resulted in at least two fixes in release candidates of\nLog4j2 since November 2021. The first of these, on Nov. 29, 2021, included a partial fix by\ndisabling message lookups for logging mechanism API functions. The second, released on5\nDec. 5, 2021, restricted the accesses and protocols that Log4j2 permits via Lightweight\nDirectory Access Protocol (LDAP) and the Java Naming and Directory Interface (JNDI).6\nHowever, industry sources suggest these fixes were incomplete, as the initial release\n\n\n-----\n\ncandidate (Log4j2 2.15.0-rc1) addressing CVE-2021-44228 could be bypassed to achieve\nRCE. As of Dec. 10, 2021, version Log4j2 2.15.0-rc2 is recommended for use; however,\nguidance around this could change as more information is uncovered.\n\nCrowdStrike Intelligence assesses that numerous adversaries have been conducting active,\nwidespread exploitation of CVE-2021-44228 since Dec. 9, 2021. This assessment is made\nwith high confidence based on the trivial nature of the exploit as well as internal and external\ndata sources that indicate a massive increase in traffic, demonstrating scanning/exploitation\nattempts targeting the JNDI and LDAP services (e.g., `jndi:ldap://[host]:`\n```\n[port]/[path] ).7\n\n```\nLog4j2 is a ubiquitous package contained in numerous Apache frameworks (including\nStruts2, Solr, Druid and Flink) that are, in turn, leveraged by an indeterminate number of third\nparties. Depending on respective implementation, server configuration, network8\narchitecture, and other factors, the reliability of CVE-2021-44228 exploits may be impacted.\n\n\nThe vulnerability leverages JNDI, which provides an abstract interface for different name9\nresolution and directory services, such as DNS or LDAP.10 Log4j2 insufficiently sanitizes\nuser-supplied data, potentially allowing an attacker to provide a string that is interpreted as a\nvariable that, when expanded, results in the loading and invocation of a remote Java class\nfile. Whether a particular service is exploitable depends on its specific usage of Log4j2.\n\nThe following example — where `logger is an instantiated Log4j2 logger — demonstrates`\nthe method by which this condition can be triggered by logging specially crafted, attackersupplied data as an error message.\n\n\nTo compromise the target, the JNDI/LDAP URL serves a malicious Java class object that will\nbe deserialized and invoked on the victim host. This action is possible because JNDI does\nnot enforce any security controls on LDAP requests. Also, LDAP, contrary to other JNDI\nprotocols, supports the loading of classes from remote resources. Tools for generating\nsuitable exploit payloads, such as marshalsec, are publicly available.11\n\nBoth of the most popular Java implementations, Oracle JDK and OpenJDK, have shipped\nwith a default setting that should prevent exploitation since 2019; the variable\n```\ncom.sun.jndi.ldap.object.trustURLCodebase is set to false by default, disallowing\n\n```\naccess to remote resources. This setting can be checked to determine if a system has been\nvulnerable, and set to `false as a workaround to prevent attacks, for instance by logging or`\nprinting the return value of:\n\n```\nSystem.getProperty(\"com.sun.jndi.ldap.object.trustURLCodebase\")\n\n```\n\n## Further Mitigation\n\n\n-----\n\nA new version of Log4j 2 published on Dec. 6, 2021, introduces the following new security\ncontrols for JNDI session security controls to restrict access to remote resources:\n```\n   allowedJndiProtocols restricts JNDI protocols to those listed; default: none\n   allowedLdapHosts restricts LDAP requests to listed hosts; default: none\n   allowedLdapClasses lists names of allowed remote Java classes; default: none\n\n```\nTo prevent attacks on a network level, and the vulnerable Java service from downloading a\nmalicious class file via LDAP, outbound connections from affected servers can be limited to\ntrusted hosts and protocols to prevent the vulnerable Java service from downloading a\nmalicious class file via LDAP.\n\nExploitation attempts can be detected by inspecting log files for the characteristic URL\npattern On the network level, the first of the following Snort rules\nimplements the same strategy. The second rule alerts to the characteristic Java class file\nheader transferred over an incoming TCP session. Of note, this second rule serves as an\nemergency rule that presents an additional means of detecting intrusion attempts;, and the\ntarget host and port must be set to the service in question to prevent false positives.\n\nThis vulnerability is being widely exploited in the wild and is highly advisable to assess the\nuse and impact of log4j and patch as soon as possible.\n\n## CrowdStrike Intelligence Confidence Assessment\n\n**High Confidence: Judgments are based on high-quality information from multiple sources.**\nHigh confidence in the quality and quantity of source information supporting a judgment does\nnot imply that that assessment is an absolute certainty or fact. The judgment still has a\nmarginal probability of being inaccurate.\n\n**Moderate Confidence: Judgments are based on information that is credibly sourced and**\nplausible, but not of sufficient quantity or corroborated sufficiently to warrant a higher level of\nconfidence. This level of confidence is used to express that judgments carry an increased\nprobability of being incorrect until more information is available or corroborated.\n\n\n-----\n\n**Low Confidence: Judgments are made where the credibility of the source is uncertain, the**\ninformation is too fragmented or poorly corroborated enough to make solid analytic\ninferences, or the reliability of the source is untested. Further information is needed for\ncorroboration of the information or to fill known intelligence gaps.\n\n## Endnotes\n\n1. https[:]//github[.]com/pimps/JNDI-Exploit-Kit\n2. https://logging.apache.org/Log4j2/2.x/\n3. https://logging.apache.org/Log4j2/2.x/security.html\n4. https://bug.cyberkendra.com/2021/12/09/Log4j22-remote-code-execution/\n5. https://issues.apache.org/jira/browse/Log4j222-3198\n6. https://gitbox.apache.org/repos/asf?p=logging-Log4j2.git;h=c77b3cb\n7. https://www.greynoise.io/viz/query/?gnql=CVE-2021-44228\n8. https://arstechnica.com/information-technology/2021/12/minecraft-and-other-apps-face\nserious-threat-from-new-code-execution-bug/\n9. https[:]//docs.oracle[.]com/javase/tutorial/jndi/overview/index.html\n10. https[:]//ldap.com\n\n11. https[:]//github[.]com/mbechler/marshalsec\n\n**Additional Resources**\n\n_Find out how to stop adversaries targeting your industry — schedule a free 1:1 intel_\n_briefing with a CrowdStrike threat intelligence expert today._\n_To request more information or speak with a CrowdStrike Services representative,_\n_[complete and submit this form.](https://www.crowdstrike.com/services/request-information/)_\n_Learn about the powerful, cloud-native CrowdStrike Falcon® platform by visiting the_\n_product webpage._\n_[Get a full-featured free trial of CrowdStrike Falcon Prevent™ to see for yourself how](https://go.crowdstrike.com/try-falcon-prevent.html)_\n_true next-gen AV performs against today’s most sophisticated threats._\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-12-10 - Log4j2 Vulnerability “Log4Shell” (CVE-2021-44228).pdf"
    ],
    "report_names": [
        "2021-12-10 - Log4j2 Vulnerability “Log4Shell” (CVE-2021-44228).pdf"
    ],
    "threat_actors": [
        {
            "id": "3fff98c9-ad02-401d-9d4b-f78b5b634f31",
            "created_at": "2023-01-06T13:46:38.376868Z",
            "updated_at": "2025-03-27T02:00:02.818071Z",
            "deleted_at": null,
            "main_name": "Cleaver",
            "aliases": [
                "Cobalt Gypsy",
                "G0003",
                "Operation Cleaver",
                "Op Cleaver",
                "Tarh Andishan",
                "Alibaba",
                "TG-2889"
            ],
            "source_name": "MISPGALAXY:Cleaver",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536101,
    "ts_updated_at": 1743041674,
    "ts_creation_date": 1653779925,
    "ts_modification_date": 1653779925,
    "files": {
        "pdf": "https://archive.orkl.eu/5a1e70e93c66b5f4dc5aad97b0fbf2d7ab0fa5cf.pdf",
        "text": "https://archive.orkl.eu/5a1e70e93c66b5f4dc5aad97b0fbf2d7ab0fa5cf.txt",
        "img": "https://archive.orkl.eu/5a1e70e93c66b5f4dc5aad97b0fbf2d7ab0fa5cf.jpg"
    }
}