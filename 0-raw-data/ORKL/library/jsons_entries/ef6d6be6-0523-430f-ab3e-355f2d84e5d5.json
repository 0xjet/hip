{
    "id": "ef6d6be6-0523-430f-ab3e-355f2d84e5d5",
    "created_at": "2022-10-25T16:48:22.755577Z",
    "updated_at": "2025-03-27T02:15:35.552777Z",
    "deleted_at": null,
    "sha1_hash": "297670f9a872410bddc852a030f4a7ec518e167f",
    "title": "",
    "authors": "",
    "file_creation_date": "2020-11-16T15:54:03Z",
    "file_modification_date": "2020-11-16T15:54:09Z",
    "file_size": 10637859,
    "plain_text": "##### RESEARCH\n\n# CHAES:\n\n## Novel Malware Targeting\n Latin American E-Commerce\n\n\n## Latin American E-Commerce\n\n\n-----\n\nThe Cybereason Nocturnus Team has been tracking a threat actor leveraging previously undetected malware\ndubbed “Chaes” to target e-commerce customers in Latin America (LATAM). Chaes malware, which was\nfirst discovered in the middle to late 2020 by Cybereason, is a multistage information stealer that primarily\ntargets Brazil and specifically the Brazilian customers of the largest e-commerce company in Latin America,\n**[MercadoLivre.](https://www.mercadolivre.com.br/)**\n\nIn recent years, the LATAM cybercrime scene has evolved a great deal. Some of the most notorious malware\n[variants that have been prominent in the region over the last year include Grandoreiro, Ursa and Astaroth.](https://malpedia.caad.fkie.fraunhofer.de/details/win.grandoreiro)\nLATAM cybercrime activities demonstrate unique features when it comes to TTP’s and how malware is propagated\non an infected machine. Some of the shared similarities include:\n\n#### • Leveraging of .MSI files as an initial way to start the infection chain\n\n • The use of Delphi as the preferred language to write malware\n\n • Extensive use of LOLBins to execute content\n\n • Downloading additional legitimate tools to expand the malware’s capabilities and for obfuscation\n\nWhen observing the shared behavior and mindset of LATAM-based threat actors, Cybereason researchers\nobserved that the malware authors emphasize the need to stay under the radar as much as possible, and prefer\nto use already-existing tools or legitimate software if it fits their needs.\n\n\n-----\n\n### Key Findings\n\n#### • Targeting the Biggest E-Commerce Company in Latin America: Chaes specifically targets the Brazilian\n\nwebsite of e-commerce company MercadoLivre and its payment page MercadoPago to steal its customers’\nfinancial information. The final payload of Chaes is a Node.Js information stealer that exfiltrates data using\nthe node process.\n\n#### • Credential Stealing, Screen Capture, Browser Monitoring, Reconnaissance: Chaes is designed to steal\n\nsensitive information from the browser such as login credentials, credit card numbers, and other financial\ninformation from MercadoLivre website customers. Chaes also takes screenshots of the infected machine,\nhooks and monitors the Chrome web browser to collect user information from infected hosts.\n\n#### • Multistage Delivery, Multi-Language Malware: Chaes delivery consists of several stages that include use\n\nof LoLbins and other legitimate software, making it very challenging to detect by traditional AV products.\nChaes also has multiple stages and is written in several programming languages including Javascript,\nVbscript, .NET, Delphi and Node.js\n\n#### • Downloads Legitimate Software, Designed for Stealth: Chaes operates using legitimate tools such as\n\nPython, Unrar and Node.js, and Chaes’ stages consist of several techniques such as use of LoLbins, open\nsource tools, fileless parts and legitimate node.js libraries designed to increase the malware’s stealthiness.\n\n#### • Under development: Cybereason observed new versions of Chaes, showing that the authors are\n\nimproving the malware and adding more features\n\n\n**FIGURE 1**\nCybereason Anti-Malware Solution Detects\n\nand Prevents Chaes\n\n\n-----\n\n### Threat Analysis\n\n##### Phase One: Initial Access\n\n**FIGURE 3**\nFirst stage of Deployment\n\nAs with many traditional campaigns, this one begins by sending the victim a phishing email containing a .docx file.\n\n\n-----\n\n**Template Injection Attacks**\n\n\n**FIGURE 4**\nAnnexo.docx phishing mail\n\n\n[After the user clicks the .docx file, a Template Injection Attack occurs. In this technique the adversary is using](https://www.sans.org/reading-room/whitepapers/incident/template-injection-attacks-bypassing-security-controls-living-land-38780)\nMicrosoft Word’s built-in feature to fetch a payload from a remote server, by changing the template target of the\nsettings.xml file embedded in the document and populating this field with a download URL of the next payload:\n\n\n**FIGURE 5**\nTemplate injection attack\n\n\n**FIGURE 6**\nWinword communicating with the C2\n\n\n-----\n\nOnce the .msi file is executed, it drops the following files:\n\n#### • Invisible.vbs: which the malware uses to execute other processes that will take part in the malware’s\n\nframework\n\n#### • Uninstall.dll: and engine.bin which constitutes the “malware engine”\n\n • Hhc.exe, hha.dll and chaes1.bin: which together constitute the malware’s core components\n\nThe .msi file then spawns a Wscript child process using “invisible.vbs” to initiate the execution of the engine.\n[bin content using the LOLBin InstallUtil. It also executes a process named “hhc.exe” which is a legitimate HTML](https://en.wikipedia.org/wiki/Microsoft_Compiled_HTML_Help)\n**[Help (CHM) Help Compiler process. The initial activity can be also seen in detail using the Cybereason Defense](https://en.wikipedia.org/wiki/Microsoft_Compiled_HTML_Help)**\nPlatform:\n\n\n**FIGURE 7**\nThe Cybereason Defense Platform showing the initial deployment\n\n\n**Setting Up the “Malware Engine” and Initial Persistence**\n\nAs mentioned above, the pair of file binaries uninstall.dll and engine.bin serve as the “malware engine” whose key\nobjective is to download additional content and maintain its foothold on the infected machine. Uninstall.dll is a\n.NET based module that receives an AES encrypted binary file as an argument and decrypts it:\n\n\n**FIGURE 8**\nUninstall.dll\n\n\n-----\n\nIn the first iteration of the malware, Uninstall.dll decrypts the engine.bin file which triggers additional download of\na file named “Install.js”:\n\n\n**FIGURE 9**\nInstallUtil download install.js\n\n\nInstall.js is a downloader that further downloads binary payloads and counters for them:\n\n\n**FIGURE 10**\nInstall.js download further binaries\n\n\n-----\n\nThe full list of files that install.js attempts to download include:\n\n**OBSERVED URL** **PURPOSE**\n\nhxxp://cnxtours.com[.]br/ZGkPJCwzO/counter.php Generic counter\n\nhxxp://cnxtours.com[.]br/2GkPJCwz2/counter.php Javascript file counter\n\nhxxp://java-update[.]online/Bv3wsrFB0t/counter.php USB file counter\n\nhxxp://evolved-thief[.]online/pacotes/chaes2.bin Malware component\n\nhxxp://evolved-thief[.]online/pacotes/elektra1.bin Malware component\n\nhxxp://evolved-thief[.]online/pacotes/bom8.bin Observed downloading coinminer\n\nThe following image shows InstallUtil processes downloading files from the C2 server:\n\n\n**TABLE 1**\nInstall.js list of domains\n\n|OBSERVED URL|PURPOSE|\n|---|---|\n|hxxp://cnxtours.com[.]br/ZGkPJCwzO/counter.php|Generic counter|\n|hxxp://cnxtours.com[.]br/2GkPJCwz2/counter.php|Javascript file counter|\n|hxxp://java-update[.]online/Bv3wsrFB0t/counter.php|USB file counter|\n|hxxp://evolved-thief[.]online/pacotes/chaes2.bin|Malware component|\n|hxxp://evolved-thief[.]online/pacotes/elektra1.bin|Malware component|\n|hxxp://evolved-thief[.]online/pacotes/bom8.bin|Observed downloading coinminer|\n\n\n**FIGURE 11**\nInstallUtil downloading additional content\n\n\nAfter the files have been downloaded, they are automatically executed by several chains of processes that include\n_Wscript, Cmd and eventually InstallUtil to decrypt the files in the same way it decrypted engine.bin._\n\nThe files themselves are the artifacts mentioned above - chaes1.bin, hha.dll and hhc.exe.\n\n\n-----\n\nInterestingly, although the code to\ndownload the binaries is in “Install.\n_js” but there is no indication of_\nscript usage. all the activities are\ndone by InstallUtil, which makes\n\nthis script execution technique\nvery unorthodox and much more\nchallenging to find:\n\nAlthough it has some benefits\nwhen it comes to executing\njavascript code using InstallUtil\nas a proxy and additional\npersistence, in some recent\nobservations of Chaes the\nmalware authors have decided\nto drop this stage in the malware\ndeployment.\n\n\n**FIGURE 12**\nThe Cybereason Defense Platform shows the full\n\ncommand lines of InstallUtil\n\n\nNext, the malware creates its first means of persistence using the registry entry CurrentVersion\\run\\Installutil\\ to\nexecute new instances of engine.bin repeatedly. Some of the .bin files such as “elektra1.bin” also contain the hhc.\nexe process and associated malicious files, so as long the engine’s persistence is maintained, the malware does\nnot need to rely on the .msi file to exist.\n\n**Registry Key:**\n\n_Software\\Microsoft\\Windows\\CurrentVersion\\Run\\installutil\\_\n\n**Value:**\n\n_wscript.exe “C:\\Users\\[username]\\AppData\\Roaming\\invisible.vbs” cmd /c cd “C:\\Users\\[username]\\AppData\\_\n_Roaming\\Microsoft\\Network” & “C:\\Windows\\Microsoft.NET\\Framework\\v2.0.50727\\InstallUtil.exe” /u “uninstall.dll” “/_\n_f=engine.bin”_\n\n\n-----\n\n##### Phase Two: Chaes Modules and Malware Deployment\n\n\n**FIGURE 13**\nSecond stage of Deployment\n\n\nThree files that were brought to the machine by the .msi file are hhc.exe, hha.dll and chaes1.bin. As already\n[mentioned, the file hhc.exe belongs to the HTML Help (CHM) Help Compiler and is often used to create CHM](https://en.wikipedia.org/wiki/Microsoft_Compiled_HTML_Help)\nfiles. This process requires the module named “hha.dll” to run.\n\nThe legitimate hha.dll is a 32-bit Windows DLL module developed by Microsoft Corporation for the HTML Help\nsoftware and other related programs.\n\nIn this case, the attackers delivered to the machine their own crafted hha.dll module (unsigned), and took\n[advantage of the DLL search order to load this module into the legitimate hhc.exe process. In this way, the](https://attack.mitre.org/techniques/T1574/001/)\nattackers manage to execute malicious code in the context of a legitimate process without using any injections.\n\n[This technique was already observed in the past in previous research done by Cybereason about financial](https://www.cybereason.com/blog/brazilian-financial-malware-dll-hijacking)\nmalware across the Brazilian cybercrime landscape:\n\n\n**FIGURE 14**\nMalicious hha.dll (left) and legitimate hha.dll (right)\n\n\n-----\n\nThe existence of the module and its identification as malicious can be seen clearly in the Cybereason Defense\nPlatform:\n\n\n**FIGURE 15**\nThe Cybereason platform detected hha.dll as malicious\n\n\n**hha.dll Analysis**\n\nWhen investigating the module, it is clear that it has nothing in common with the legitimate Windows hha.dll\nmodule. The module’s main goal is to decode and unpack the downloaded content from chaes1.bin and load it\ninto memory.\n\n[The module begins by getting a handle to the chaes1.bin file with read permissions using the CreateFileW](https://docs.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-createfilew)\nfunction. It then retrieves the size of the file and allocates new memory accordingly:\n\n\n**FIGURE 16**\nGetting a handle to chaes1.bin\n\n\n-----\n\nAfter getting the handle for chaes1.bin and allocating memory, the module attempts to read the content of\nthe file. If it succeeds in doing so, it sends the newly allocated memory of chaes1.bin and additional obfuscated\nembedded content to another function that deals with unpacking and deobfuscation chaes1.bin.\n\nAfter the routine ends, it produces a new module loaded in memory named “chaes.dll” (also written in Delphi)\nwhich contains the contents of the decoded chaes1.bin:\n\n\n**FIGURE 17**\nDecoding function before (left) and after (right)\n\n\n-----\n\nThe presence of this new dll file now found in the memory of hhc.exe can also be seen in the Cybereason Defense\nPlatform, along with another module named chcopyd1.dll:\n\n\n**FIGURE 18**\nDecoded and fileless chase.dll in the\n\nmemory of hhc.exe\n\n\n**chaes.dll Analysis**\n\nWhen the researchers first inspect chase.dll using Pestudio, it was immediately observed that this module has\n[an executable named “UNRAR” stored in its resources section. UNRAR is a free and open source command-line](https://en.wikipedia.org/wiki/Unrar)\napplication for extracting RAR file archives which adversaries use to extract additional content sent from the C2\nserver as archived files:\n\n\n**FIGURE 19**\nChaes.dll UNRAR in resource section\n\n\n-----\n\nAs expected, chaes.dll loads this executable from its binary and assigns it with 0x40 permissions which is the\nhexadecimal value of the symbolic constant name READ-WRITE-EXECUTE.\n\nUNRAR is not the only file that the malware drops- chaes.dll also drops invisible.vbs, config.ini and instructions.ini:\n\n**TABLE 2**\nFile names dropped by chaes.dll\n\n|FILE NAME|SHA-1Hash|\n|---|---|\n|config.ini|bf3174b0151ff6c1b57398f37c9f381bb2b66a6c|\n|instructions.ini|84f38bf9df9a0153050b371033afc0d8191763bf|\n|unrar.exe|6411159bbf02b44caee6b42390bf866d46aed0e4|\n|invisible.vbs|2182243567bfcefcbc88b4ebcc42ed52e1dd1e69|\n|hxxp://evolved-thief[.]online/pacotes/bom8.bin|Observed downloading coinminer|\n\n\n**Config.ini and Instructions.ini**\n\nAs inferred from its name, config.ini stores the configuration\nfor the C2:\n\n_Instructions.ini stores the_\ninstructions to be sent to the\nC2 server to download the\nadditional content and to deploy\nthe full malware. Like many other\ncommands in this malware, some\nof them will be executed using the\n_invisible.vbs file:_\n\n\n**FIGURE 20**\n\nconfig.ini\n\n\n**FIGURE 21**\ninstructions.ini\n\n\n-----\n\nThe additional files obtained from the C2 server are:\n\n#### • chstea01.rar - this file contains the hhc.exe process, the malicious hha.dll, chaes1.bin and sqlite3.dll (the\n\nfirst hint that SQL will be used by the malware).\n\n#### • fixi2.rar and usb3.rar - these files contain the hhc.exe process, hha.dll and chaes1.bin.\n\n • spm4.rar - this archive contains Python-related files and a large binary file named “load.bin”.\n\nAfter the archived files are downloaded, pythonw.exe uses UNRAR to extract and execute their content:\n\n\n**FIGURE 22**\nspm4.rar (left) and chstea01.rar (right)\n\n\nIn recent versions of Chaes, instructions.ini file turned fileless and is stored in the registry:\n\n\n**FIGURE 23**\nInstructions.ini data fileless in the registry\n\n\n-----\n\n**Chaes Communication with the C2**\n\nThe communication between chase.dll and its C2 server is made up of three repetitive post and requests calls:\n\n#### • NewClient: provides the C2 with information from the victim’s machine (machine name, user name, uid,\n\noperating system version and malware version).\n\n#### • Instructions: sends and receives content that was base64-encoded and then encrypted.\n\n • Config: which is also encoded and encrypted.\n\n\n**FIGURE 24**\nChaes communicates with the C2\n\n\n**FIGURE 25**\nChaes “NewClient.php” communication\n\n\n**Stealing Information from the Browser**\n\nIn addition, the hhc.exe process creates several .sql files named local.sql, these SQL databases are being used\nin order to extract sensitive information from the Chrome browser similar to other traditional information\nstealers, some of the SQL tables are related to credit cards, login credentials of websites and personal\ninformation of a user:\n\n\n**FIGURE 26**\nCredit card related database to extract information from the browser\n\n\n-----\n\n**Additional Persistence**\n\nIn addition to the downloading and executing content, the malware will set another persistence using the registry,\none in the software\\microsoft\\windows\\currentversion\\run\\microsoft _windows html help v6.1.2390_\n\nAnd and second in software\\microsoft\\windows\\currentversion\\run\\microsoft windows html help:\n\n**_Registry key:_**\n\n_Software\\Microsoft\\Windows\\CurrentVersion\\Run\\Microsoft Windows html help v6.1.2390\\_\n\n**_Value:_**\n\n_Wscript “C\\ProgramData\\invisible.vbs” cmd /V:ON /C cd “%APPDATA%\\Microsoft\\HTML Help v6.2.1533\\” & wscript._\n_exe %PROGRAMDATA%\\invisible.vbs “hhc.exe”_\n\n**_Registry key:_**\n\n_Software\\Microsoft\\Windows\\CurrentVersion\\Run\\Microsoft Windows html help\\_\n\n**_Value:_**\n\n_Wscript “C\\ProgramData\\invisible.vbs” cmd /V:ON /C cd “C\\Users\\[username]\\APPDATA\\Roaming\\Microsoft\\HTML_\n_Help v6.2.1533\\” & wscript.exe C:\\PROGRAMDATA\\invisible.vbs “hhc.exe”_\n\n**Second Stage Deployment via Python**\n\nOnce Chaes finishes downloading the additional content and establishing its persistence, the additional content\nactivity starts to initiate the second stage of the malware deployment. First, pythonw.exe injects a module named\n“ModHooksCreateWindow64.dll” into a newly created Chrome process.\n\nThis Chrome browser is a browser that opens silently in the background and without the user knowledge or\nconsent about its existence. This can be seen also using the Cybereason platform:\n\n\n**FIGURE 27**\nDeployment of the malware by pythonw.exe\n\n\n-----\n\n**ModHooksCreateWindow64.dll Analysis**\n\nWhen the team investigated the module, it was observed that its name indicates this module deals with classic\nAPI hooking techniques, this can be seen by the number of JMP codes that appears and with some strings that\nsuggest about it also:\n\n\n**FIGURE 28**\nSetting up the hook JMP\n\n\nWhen the researchers examined the module strings, it was observed that some of the strings and file names have\n[an exact match with an open source project named DDetours, and especially two files named “DDetours.pas” and](https://github.com/MahdiSafsafi/DDetours)\n“InstDecode.pas”. According to its github page: “The DDetours is a library allowing you to hook Delphi and Windows\n_API functions. It provides an easy way to insert and remove hooks.” The malware authors show again their creativity in_\nattempts to stay under the radar when they are using legitimate open source software.\n\nIn addition to the DDetours code, the module also contains several strings that indicate hooking of the function\n_ShowWindow and aim to specifically detect if the Chrome browser is active. This technique was also seen in the_\n**[leaked code of the Carberp Botnet that aims to hook ShowWindow to detect the presence of Internet Explorer:](https://github.com/Artogn/malware-1/blob/master/Carberp%20Botnet/source%20-%20absource/pro/all%20source/RemoteCtl/DrClient/Hook.cpp)**\n\n\n**FIGURE 29**\nShowWindow hooking and Chrome browser\n\n\n-----\n\nOverall, this module grants the malware the capability to perform any API hooking that it desires, and specifically\naims to target the Chrome browser. Browser hooking is the hallmark feature of most financial malware. In the end,\n_pythonw.exe will also download a JavaScript file named “index.js” which is a targeted information stealer written in_\n**[NodeJs:](https://en.wikipedia.org/wiki/Node.js)**\n\n\n**FIGURE 30**\nPythonw.exe downloading index.js infostealer\n\n\n**Downloading the Node.js Component**\n\nAfter setting up the hooking of Chrome, pythonw.exe executes the final piece of the malware framework which is\n[installing NodeJs in the infected machine in a location that contains the path “Microsoft\\Media\\Oz”. Node.js is an](https://nodejs.org/en/)\n**[open-source, cross-platform, back-end JavaScript runtime environment that executes JavaScript code outside](https://nodejs.org/en/)**\na web browser. This is another instance of legitimate software that this malware uses in order to operate and\nexecute its malicious activity.\n\n\nThe node.exe process will be the last\npart of the puzzle, it will be responsible\nfor reacting according to code written in\n“index.js” and sending the collected data\nfrom the infected machine to the C2. This\ncan be seen also using the Cybereason UI:\n\nWhen the full deployment of the malware\nis examined, it was observed that the\ndeployment activity is divided into three\npieces:\n\n#### • Hhc.exe process will mainly act\n\nas the component that keeps the\nmalware maintenance, persistence\nand downloader of the additional\ncomponents.\n\n#### • Pythonw.exe will be the process that\n\ndeploys the downloaded content and\nexecutes it.\n\n\n**FIGURE 31**\nEnd of the malware deployment\n\n\n\n#### • And eventually, node.exe will be the process that receives the data according to “index.js” and send it to C2.\n\n\n-----\n\n##### Phase Three: Targeted Node.js Malware\n\n_Index.js is a Node.js based information stealer that keeps being updated and evolved during the last months. To_\nthis date the last update was observed in the beginning of November 2020. The main goal of this script is to\nact as the main orchestrator of the Chaes’s main goal.\n\n**Master of Puppets**\n\nWhen starting to investigate index.js, at first glance it was observed that the string “puppeteer-core”. This is an\n[indication that this script will be using the Node.js library “Puppeteer”.](https://www.npmjs.com/package/puppeteer)\n\nPuppeteer is a Node library which provides a high-level API to control Chrome or Chromium over the DevTools\nProtocol. Puppeteer runs headless by default, but can be configured to run full (non-headless) Chrome or\nChromium.\n\nIn other words, the script has the ability to execute code that can interact with a remote C2 server with or\nwithout dependence on the Chrome browser being opened by a user.\n\n[The Puppeteer library is also known to be used for performing web scraping, the process of automating data](https://www.digitalocean.com/community/tutorials/how-to-scrape-a-website-using-node-js-and-puppeteer)\ncollection from the web. The process typically deploys a “crawler” that automatically surfs the web and scrapes\ndata from selected pages. Interestingly, we also notice the existence of the variable “mercado_pago_done”. This\nis the first indication that this script will deal with information and data related to Mercado-Pago.\n\n[Mercado Pago is the payment platform for online sales of the company Mercado Livre. Mercado Livre, Inc.](https://en.wikipedia.org/wiki/MercadoLibre)\nis an Argentine company incorporated in the United States that operates online marketplaces dedicated to\ne-commerce and online auctions. According to Wikipedia, Mercado Livre had over 174 million users in Latin\nAmerica, making it the region’s most popular e-commerce site by number of visitors:\n\n\n**FIGURE 32**\nUsage of Puppeteer library\n\n\nIn order to operate, the script will first attempt to connect to the newly created Chrome session, after which\nthis chrome session actions will be dependable on the index.js script. Considering that the Chrome session is\nalready monitored and hooked, it is apparent how deeply the malware has visibility into its activity.\n\n\n**FIGURE 33**\nThe NodeJs malware connect to Chrome browser\n\n\n-----\n\nIn addition, the script contains other multiple functions that are related to communicating and controlling the\nnewly created Chrome browser remotely.\n\n**Data Collecting Functions**\n\nOne of the prominent functions that this info-stealer uses is printReport(). This function gets a web page URL\n\nand information to print as an argument, and then creates an image of this web page to be uploaded to the C2\nserver.\n\nThis function will be used whenever the info-stealer chooses to notify the C2 server about a specific activity.\nThe uploading capabilities are created using another function called “fileUpload” that receives a URL, a\nmessage, and a filename to upload:\n\n\n**FIGURE 34**\nPrintReport function\n\n\nAnother function is loadUID(), which as its name suggests, will locate the UID of the infected machine.\n\nThe UID consists of three parts - random letters, machine name and user name:\n\n\n**FIGURE 35**\nLoadUID function\n\n\n-----\n\n**Accessing the Target**\n\nThe first significant malicious activity performed by the script is to navigate the Chrome browser to\n_mercadopago.com.br and then extract the infected machine’s user financial information. The information_\nextracted is stored in three variables named in Portuguese:\n\n#### • Dinheiro_disponivel: which means “money available”\n\n • Prefil: which means “profile”\n\n • Atividades_item: which means “item activities”\n\n\n**FIGURE 36**\nThe NodeJs malware collects financial information of mercadopago customers\n\n\nAs mentioned previously, Chaes is still under development. In a version that appeared in late 2020, the way to\naddress Mercadopago page become more direct with an attempt to extract data from the following url:\n\n_“https://www.mercadopago.com.br/banking/balance#from-selection=home”:_\n\n\n**FIGURE 37**\nIndex.js version that observed in late 2020\n\n\n-----\n\nThe script will also attempt to navigate and scrape data from: “www.mercadolivre.com.br/credits/consumer/\n_administrator#menu-user”, an online payment section of mercadolivre.com. As with the Mercadopago page, the_\nscript will attempt to read the data from this webpage as well, storing credit card data in two constant variables\nnamed “mcredito_selector” and “mcredito_available”. Then, it will report its findings to the C2 server using the\naforementioned printReport() function:\n\n\n**FIGURE 38**\nThe Node.js malware collects financial information of mercado livre customers\n\n\nAs can be seen in the script, in each of the cases, whether its MercadoLivre or MercadoPago associated pages,\nthe script will use the aforementioned function printReport() to create an image of the targeted webpage\nand eventually send the extracted data to the C2 server. The creation of these images can be seen using the\nCybereason Defense Platform:\n\n\n**FIGURE 39**\n\n\n[After creating the screenshot, the information will be sent to the C2 server using the Multi-Purpose Internet](https://en.wikipedia.org/wiki/MIME)\n**[Mail Extensions (MIME) protocol - an extension to the Internet email protocol that allows users to exchange](https://en.wikipedia.org/wiki/MIME)**\ndifferent kinds of data files such as images, audio, and video. Note, in latest versions of index.js the entire\ncommunication of the node.exe process is encrypted:\n\n\n**FIGURE 40**\nThe Node.js malware sending a packet of information to the C2 server\n\n\n-----\n\nEventually, when the data scraped from the website has been collected, the script sends it as a json file and\nuploads it to the remote C2 server. In the end, the attacker will have information on the victim pulled from\ntheir profile, including their cash balance:\n\n\n**FIGURE 41**\nThe Node.js malware create the json to send information about new customer\n\n\n**Sending Fake Emails**\n\nOnce the user makes a transaction, the script will use a function called sendEmail() to automatically send an\nfake email (allegedly to be on the behalf of Mercado Livre) informing the customer about the purchase that\nthey made. In this fake email, “Mercado Livre” sends the following message:\n\n_“Your order has been successfully billed on our system, Order No.: 112187194961661 generated on_\n_9/22/2020 at 09:33:48 PM Status: APPROVED!_\n\n_Order amount: R $ 4661.22 payment billed in 4X (Boleto Bancário)._\n\n_Attached are the accesses containing the data listed above:_\n\n_Access Key: 3872190867349812064732892309012388561092”_\n\nTo increase the legitimacy of the message, the customer is also informed that the email has been scanned by\n**[Avast and does not contain any virus:](https://en.wikipedia.org/wiki/Avast_Antivirus)**\n\n\n**FIGURE 42**\nThe Node.js malware sendEmail function\n\n\n-----\n\nSendEmail function fake mail\n\n\nThe script also determines if there is any money to extract from the customer, If not, it displays a message\nabout it:\n\n\n**FIGURE 44**\nThe Node.js malware verify if the customer has money\n\n\nAdditionally, the script also extracts the cookies and web data from the MercadoPago site, and stores them as\nconstant variables named “cookies” and “web_data”. This data is also uploaded to the C2 server:\n\n\n**FIGURE 45**\nThe Node.js malware collects cookies and web data of mercado pago web page\n\n\n-----\n\n**Understanding the Endgame**\n\nAfter analyzing the node.js malware\nand the entire deployment **FIGURE 46**\nprocess of Chaes, the researchers Full attack infographic\nrealized the full functionality and\ncapabilities of the malware. The\nmalware opens a Chrome browser,\nmonitors it using hooking, and\nthen controls its activity using\nthe Puppeteer capabilities that\nare stored within the Node.js\nscript. In this way, the malware is\nable to enter MercadoPago and\n\nMercadoLivre payment sections\nwithout the user’s interaction\nor consent. It then scrapes the\ninformation stored in it and sends\nit to a remote C2 server.\n\nThe alarming part in this node.\n_js-based malware is the fact_\nthe majority of this behavior is\nconsidered normal, as the usage\nof the Puppeteer library for web\nscraping is not malicious by nature.\nTherefore, detecting these kinds of\nthreats is much more challenging.\n\n**Evolving Threat**\n\nChaes is a rapidly evolving threat, and in recent months the malware authors appear to have adapted and\nchanged some parts of their framework. Recent versions of Chaes are observed without the usage of InstallUtil\nand with better network encryption. In addition, the final Node.js script “index.js” appears to also be updated and\ncontains: more functionality that is related to controlling the chrome browser, new updated C2 IP/Domains, new\nMercadoPago financial webpage, and removing the fake mail section.\n\nAlthough some versions of Chaes may change in some parts, the endgame goal still remains: under the radar\nactivity accessing MercadoLivre and MercadoPago websites without user’s consent and data exfiltration using node\nprocess. This can also be seen using the Cybereason Defense Platform:\n\n\n-----\n\n**FIGURE 47**\nThe Cybereason Defense Platform shows Chaes accessing MercadoLivre and\n\nMercadoPago websites and data exfiltrated from node.exe process\n\n\n##### Conclusion\n\nIn this research, Cybereason discovered a new and evolving threat in the Latin American cyber crime scene called\nChaes. This malware made its first appearance during the middle to end of 2020, It specifically targets Brazil and the\nlargest e-commerce company in Latin America, Mercado Livre. It is a multistage malware deployment which uses\n\nseveral legitimate Windows processes and open source tools to remain undetected. These components are not\nalways malicious on their own, but when put together they form a stealthy infection chain that is hard to detect.\n\n[Multistage malware that uses such techniques in the LATAM region and specifically in Brazil have already been](https://www.cybereason.com/blog/brazilian-financial-malware-dll-hijacking)\nobserved and investigated by Cybereason in the past years.\n\nChaes demonstrates how sophisticated and creative malware authors in the Latin America region can be when\nattempting to reach their goals. The malware not only serves as a warning sign to information security researchers\nand IT professionals not to take lightly the existence of files that are legitimate in nature, but also raises the concern\nof a possible future trend in using the Puppeteer library for further attacks in other major financial institutions.\n\nCybereason will continue to monitor Chaes’ progress to determine whether it will expand to more e-commerce\ncompanies in the Latin Americas, and whether the popularity of Node.js-based malware will continue to evolve.\n\n\n-----\n\n### MITRE ATT&CK Breakdown\n\n**[Spearphish­](https://attack.mitre.org/techniques/T1192/)** **[Command-](https://attack.mitre.org/techniques/T1059/)** **[Modify](https://attack.mitre.org/techniques/T1112)** **[Registry](https://attack.mitre.org/techniques/T1547/001/)** **[InstallUtil](https://attack.mitre.org/techniques/T1218/004/)** **[Credentials](https://attack.mitre.org/techniques/T1081)** **[Account](https://attack.mitre.org/techniques/T1087)** **[Data from](https://attack.mitre.org/techniques/T1213)** **[Automated](https://attack.mitre.org/techniques/T1020)** **[Data](https://attack.mitre.org/techniques/T1001)**\n**[ing](https://attack.mitre.org/techniques/T1192/)** **[Line](https://attack.mitre.org/techniques/T1059/)** **[Registry](https://attack.mitre.org/techniques/T1112)** **[Run Keys](https://attack.mitre.org/techniques/T1547/001/)** **[in Files](https://attack.mitre.org/techniques/T1081)** **[Discovery](https://attack.mitre.org/techniques/T1087)** **[Information](https://attack.mitre.org/techniques/T1213)** **[Exfiltration](https://attack.mitre.org/techniques/T1020)** **[Obfuscation](https://attack.mitre.org/techniques/T1001)**\n**[Link](https://attack.mitre.org/techniques/T1192/)** **[Interface](https://attack.mitre.org/techniques/T1059/)** **[/ Startup](https://attack.mitre.org/techniques/T1547/001/)** **[Repositories](https://attack.mitre.org/techniques/T1213)**\n\n**[Folder](https://attack.mitre.org/techniques/T1547/001/)**\n\n**[Spearphish­](https://attack.mitre.org/techniques/T1193/)** **[Scripting](https://attack.mitre.org/techniques/T1064)** **[Valid](https://attack.mitre.org/techniques/T1078)** **[Modify](https://attack.mitre.org/techniques/T1112)** **[Credentials](https://attack.mitre.org/techniques/T1555/003/)** **[File and](https://attack.mitre.org/techniques/T1083)** **[Data from](https://attack.mitre.org/techniques/T1005)** **[Data](https://attack.mitre.org/techniques/T1560/)** **[Mail](https://attack.mitre.org/techniques/T1071/003/)**\n**[ing Attach­](https://attack.mitre.org/techniques/T1193/)** **[Accounts](https://attack.mitre.org/techniques/T1078)** **[Registry](https://attack.mitre.org/techniques/T1112)** **[from Web](https://attack.mitre.org/techniques/T1555/003/)** **[Directory](https://attack.mitre.org/techniques/T1083)** **[Local System](https://attack.mitre.org/techniques/T1005)** **Compressed** **[Protocols](https://attack.mitre.org/techniques/T1071/003/)**\n**[ment](https://attack.mitre.org/techniques/T1193/)** **[Browsers](https://attack.mitre.org/techniques/T1555/003/)** **[Discovery](https://attack.mitre.org/techniques/T1083)**\n\n**[JavaScript/](https://attack.mitre.org/techniques/T1059/007/)** **[Scripting](https://attack.mitre.org/techniques/T1064)** **[System](https://attack.mitre.org/techniques/T1082)** **[Data Staged](https://attack.mitre.org/techniques/T1074)** **[Data](https://attack.mitre.org/techniques/T1560/)**\n**[JScript](https://attack.mitre.org/techniques/T1059/007/)** **[Information](https://attack.mitre.org/techniques/T1082)** **[Encrypted](https://attack.mitre.org/techniques/T1560/)**\n\n**[Discovery](https://attack.mitre.org/techniques/T1082)**\n\n**[Python](https://attack.mitre.org/techniques/T1059/006/)** **[DLL Search](https://attack.mitre.org/techniques/T1574/001/)** **[System](https://attack.mitre.org/techniques/T1016)** **[Email](https://attack.mitre.org/techniques/T1114)** **[Exfiltration](https://attack.mitre.org/techniques/T1041/)**\n**[Order](https://attack.mitre.org/techniques/T1574/001/)** **[Network](https://attack.mitre.org/techniques/T1016)** **[Collection](https://attack.mitre.org/techniques/T1114)** **[Over](https://attack.mitre.org/techniques/T1041/)**\n**[Hijacking](https://attack.mitre.org/techniques/T1574/001/)** **[Configuration](https://attack.mitre.org/techniques/T1016)** **[Command](https://attack.mitre.org/techniques/T1041/)**\n\n**[Discovery](https://attack.mitre.org/techniques/T1016)** **[and Control](https://attack.mitre.org/techniques/T1041/)**\n\n**[Channel](https://attack.mitre.org/techniques/T1041/)**\n\n**[Visual Basic](https://attack.mitre.org/techniques/T1059/005/)** **[Msiexec](https://attack.mitre.org/techniques/T1218/007/)**\n\n##### Indicators of Compromise (IOCs)\n\nThe full set of IOCs including C2 Domains, IP addresses, Docx files SHA-1 hashes, Docx files SHA-256 hashes,Msi\nfiles SHA-1 hashes, Msi files SHA-256 hashes, Binary files SHA-1 hashes, Binary files SHA-256 hashes, Archived files\nSHA-1 hashes, Archived files SHA256 hashes, Ini files SHA-1 hashes, Ini files SHA-256 hashes, Scripts SHA-1 hashes,\n[Scripts SHA256 hashes, DLLs SHA-1 hashes, DLLs SHA256 hashes are AVAILABLE FOR DOWNLOAD HERE.](https://www.cybereason.com/hubfs/dam/collateral/iocs/chaes-malware-iocs.pdf)\n\n|INITIAL ACCESS|EXECUTION|PERSISTENCE|PRIVELEGE ESCALATION|DEFENSE EVASION|CREDENTIAL ACCESS|DISCOVERY|COLLECTION|EXFILTRATION|C&C|\n|---|---|---|---|---|---|---|---|---|---|\n|Spearphish­ ing Link|Command- Line Interface|Modify Registry|Registry Run Keys / Startup Folder|InstallUtil|Credentials in Files|Account Discovery|Data from Information Repositories|Automated Exfiltration|Data Obfuscation|\n|Spearphish­ ing Attach­ ment|Scripting||Valid Accounts|Modify Registry|Credentials from Web Browsers|File and Directory Discovery|Data from Local System|Data Compressed|Mail Protocols|\n||JavaScript/ JScript|||Scripting||System Information Discovery|Data Staged|Data Encrypted||\n||Python|||DLL Search Order Hijacking||System Network Configuration Discovery|Email Collection|Exfiltration Over Command and Control Channel||\n||Visual Basic|||Msiexec||||||\n\n\n-----\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "99fdc3ef-333d-48f5-a4a1-becd788c7b80",
            "created_at": "2022-10-25T15:28:29.802983Z",
            "updated_at": "2022-10-25T15:28:29.802983Z",
            "deleted_at": null,
            "name": "MITRE",
            "url": "https://github.com/mitre-attack/attack-stix-data",
            "description": "MITRE ATT&CK STIX Data",
            "reports": null
        },
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        },
        {
            "id": "6fc23d14-23a6-4870-8fad-b291b182596f",
            "created_at": "2022-10-25T16:07:18.480113Z",
            "updated_at": "2022-10-25T16:07:18.480113Z",
            "deleted_at": null,
            "name": "ETDA",
            "url": "https://apt.etda.or.th",
            "description": "Threat Group Cards: A Threat Actor Encyclopedia",
            "reports": null
        },
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        },
        {
            "id": "5910e58f-4bc9-4e4e-9dbb-887804094a01",
            "created_at": "2022-10-25T16:32:58.457399Z",
            "updated_at": "2022-10-25T16:32:58.457399Z",
            "deleted_at": null,
            "name": "OTX",
            "url": "https://otx.alienvault.com",
            "description": "Alienvault Open Threat Exchange (OTX)",
            "reports": null
        }
    ],
    "references": [
        "https://www.cybereason.com/hubfs/dam/collateral/reports/11-2020-Chaes-e-commerce-malware-research.pdf",
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2020/2020.11.17.CHAES/11-2020-Chaes-e-commerce-malware-research.pdf"
    ],
    "report_names": [
        "11-2020-Chaes-e-commerce-malware-research.pdf",
        "11-2020-Chaes-e-commerce-malware-research"
    ],
    "threat_actors": [
        {
            "id": "9f101d9c-05ea-48b9-b6f1-168cd6d06d12",
            "created_at": "2023-01-06T13:46:39.396409Z",
            "updated_at": "2025-03-27T02:00:03.074969Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "CHROMIUM",
                "ControlX",
                "Red Dev 10",
                "RedHotel",
                "Red Scylla",
                "TAG-22",
                "BRONZE UNIVERSITY",
                "AQUATIC PANDA",
                "Charcoal Typhoon",
                "BountyGlad"
            ],
            "source_name": "MISPGALAXY:Earth Lusca",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "6abcc917-035c-4e9b-a53f-eaee636749c3",
            "created_at": "2022-10-25T16:07:23.565337Z",
            "updated_at": "2025-03-27T02:02:09.868522Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Bronze University",
                "Charcoal Typhoon",
                "Chromium",
                "Red Dev 10",
                "Red Scylla"
            ],
            "source_name": "ETDA:Earth Lusca",
            "tools": [
                "Agentemis",
                "AntSword",
                "BIOPASS",
                "BIOPASS RAT",
                "BadPotato",
                "Behinder",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "Doraemon",
                "FRP",
                "Fast Reverse Proxy",
                "FunnySwitch",
                "HUC Port Banner Scanner",
                "KTLVdoor",
                "Mimikatz",
                "NBTscan",
                "POISONPLUG.SHADOW",
                "PipeMon",
                "RbDoor",
                "RibDoor",
                "RouterGod",
                "SAMRID",
                "ShadowPad Winnti",
                "SprySOCKS",
                "WinRAR",
                "Winnti",
                "XShellGhost",
                "cobeacon",
                "fscan",
                "lcx",
                "nbtscan"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "d53593c3-2819-4af3-bf16-0c39edc64920",
            "created_at": "2022-10-27T08:27:13.212301Z",
            "updated_at": "2025-03-27T02:00:55.529662Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Earth Lusca",
                "TAG-22",
                "Charcoal Typhoon",
                "CHROMIUM",
                "ControlX"
            ],
            "source_name": "MITRE:Earth Lusca",
            "tools": [
                "Mimikatz",
                "PowerSploit",
                "Tasklist",
                "certutil",
                "Cobalt Strike",
                "Winnti for Linux",
                "Nltest",
                "NBTscan",
                "ShadowPad"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1666716502,
    "ts_updated_at": 1743041735,
    "ts_creation_date": 1605542043,
    "ts_modification_date": 1605542049,
    "files": {
        "pdf": "https://archive.orkl.eu/297670f9a872410bddc852a030f4a7ec518e167f.pdf",
        "text": "https://archive.orkl.eu/297670f9a872410bddc852a030f4a7ec518e167f.txt",
        "img": "https://archive.orkl.eu/297670f9a872410bddc852a030f4a7ec518e167f.jpg"
    }
}