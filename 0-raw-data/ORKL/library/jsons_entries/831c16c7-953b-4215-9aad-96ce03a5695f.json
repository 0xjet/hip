{
    "id": "831c16c7-953b-4215-9aad-96ce03a5695f",
    "created_at": "2023-01-12T14:59:59.163885Z",
    "updated_at": "2025-03-27T02:12:03.963306Z",
    "deleted_at": null,
    "sha1_hash": "0188be2ca0765f05ea309d8ecb8ec099cdb70d00",
    "title": "2021-03-02 - Rapid7’s InsightIDR Enables Detection And Response to Microsoft Exchange Zero-Day",
    "authors": "",
    "file_creation_date": "2022-05-27T22:37:58Z",
    "file_modification_date": "2022-05-27T22:37:58Z",
    "file_size": 454647,
    "plain_text": "# Rapid7’s InsightIDR Enables Detection And Response to Microsoft Exchange Zero-Day\n\n**[blog.rapid7.com/2021/03/03/rapid7s-insightidr-enables-detection-and-response-to-microsoft-exchange-0-day](https://blog.rapid7.com/2021/03/03/rapid7s-insightidr-enables-detection-and-response-to-microsoft-exchange-0-day)**\n\nAndrew Christian March 3, 2021\n\n_Last updated at Thu, 18 Mar 2021 13:34:41 GMT_\n\nStarting February 27, 2021, Rapid7 has observed a notable increase in the exploitation of\n[Microsoft Exchange through existing detections in InsightIDR’s Attacker Behavior Analytics](https://www.rapid7.com/products/insightidr/)\n(ABA). The Managed Detection and Response (MDR) identified multiple, related\ncompromises in the past 72 hours. In most cases, the attacker is uploading an “eval”\nwebshell, commonly referred to as a “chopper” or “China chopper”. With this foothold, the\nattacker would then upload and execute tools, often for the purpose of stealing credentials.\nFurther investigative efforts have identified overlap in attacker techniques and infrastructure.\n\n## Summary\n\nAt close to midnight UTC on February 27, 2021, Managed Detection and Response SOC\nanalysts began observing alerts for the following ABA detections in InsightIDR:\n\nAttacker Tool - China Chopper Webshell Executing Commands\nAttacker Technique - ProcDump Used Against LSASS\n\n\n-----\n\n[Upon further inspection of Enhanced Endpoint Telemetry data produced by InsightAgent,](https://blog.rapid7.com/2020/10/15/introducing-enhanced-endpoint-telemetry-eet-in-insightidr/)\nRapid7 analysts identified that attackers had successfully compromised several systems and\nnoted that they were all on-premise Microsoft Exchange servers with web services\naccessible to the public Internet. Exposing web services to the public internet is a common\npractice for customers with on-premise instances of Microsoft Exchange to provide their\nusers with email services over the web through Outlook Web Access (OWA).\n\nUsing Project Sonar, Rapid7's Labs team was able to identify how target-rich an environment\nattackers have to work with: Nearly 170,000 servers vulnerable to a different recent\n[Exchange CVE (for which proof-of-concept exploit code is readily available) were exposed to](https://github.com/sourceincite/CVE-2021-24085)\nthe public internet.\n\nWith the compromise identified, our team of Customer Advisors alerted our customers to this\nactivity. Meanwhile, our analysts quickly began performing deeper inspection of the logs\nuploaded to InsightIDR along with collecting additional forensic information directly from the\ncompromised endpoints. Within a very short period of time, our analysts were able to identify\nhow the attackers were executing commands, where they were coming from, and what tools\nthey were using. This information allowed Rapid7 to provide proactive, actionable steps to\n\n\n-----\n\nour customers to thwart the attack . Additionally, our analysts worked jointly with our Threat\nIntelligence and Detection Engineering (TIDE) team to review the collected data for the\npurpose of immediately developing and deploying additional detections for customers.\n\n[Three days later, on March 2, 2021, Microsoft acknowledged and released information on the](https://www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers/)\nexploitation of 0-day vulnerabilities in Microsoft Exchange by an actor they refer to as\n\"hafnium.\" They also released patches for Microsoft Exchange 2013, 2016 and 2019 (CVE2021-26855, [CVE-2021-26857,](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-26857) [CVE-2021-26858,](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-26858) [CVE-2021-27065, as well as others).](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-27065)\n\nDespite this vulnerability being unknown to the public, Rapid7 was able to identify the\nattacker's presence on systems to help defend against the use of these 0-day exploits with\nour Attacker Behavior Analytics library.\n\n**Rapid7 recommends that everyone running Microsoft Exchange apply these patches**\n**immediately as they are being exploited in the wild by a sophisticated adversary.**\n\n## Technical Analysis of Attacker Activity\n\n1. Automated scanning to discover vulnerable Exchange servers from the following\n\nDigitalOcean IP addresses:\n\n165.232.154.116\n157.230.221.198\n161.35.45.41\n\n2. Analysis of Internet Information Services (IIS) logs shows a POST request is then made\nfrom the scanning DigitalOcean IP to multiple paths and files:\n\n/ecp/y.js\n/rpc/\n/owa/auth/signon.aspx\n/aspnet_client/system_web/<random_name>.aspx\nIIS Path ex: /aspnet_client/system_web/TInpB9PE.aspx\nFile system path ex: C:\\inetpub\\wwwroot\\aspnet_client\\system_web\\TInpB9PE.aspx\n/aspnet_client/aspnet_iisstart.aspx\nFile system path: C:\\inetpub\\wwwroot\\aspnet_client\\aspx_iisstart.aspx\n/aspnet_client/aspx_client.aspx\nFile system path: C:\\inetpub\\wwwroot\\aspnet_client\\aspx_client.aspx\n/aspnet_client/aspnet.aspx\nFile system path: C:\\inetpub\\wwwroot\\aspnet_client\\aspnet.aspx\n\nIn some cases, additional dynamic link libraries (DLLs) and compiled aspx files are created\nshortly after the webshells are first interacted with via POST requests in the following\nlocations:\n\n\n-----\n\nC:\\Windows\\Microsoft.NET\\Framework64\\<version>\\Temporary ASP.NET Files\\root\\\nC:\\Windows\\Microsoft.NET\\Framework64\\<version>\\Temporary ASP.NET Files\\owa\\\n\n3. Next, a command executes, attempting to delete the “Administrator” from the “Exchange\nOrganization administrators” group:\n\ncmd /c cd /d C:\\\\inetpub\\\\wwwroot\\\\aspnet_client\\\\system_web&net group \"Exchange\nOrganization administrators\" administrator /del /domain&echo [S]&cd&echo [E]\n\n4. With the command executed, and the webshell successfully uploaded, interaction with the\nwebshell will begin from a different IP.\n\nWe have monitored interaction from 45.77.252[.]175\n\n5. Following the POST request, multiple commands are executed on the asset:\n\na. Lsass.exe dumping using procdump64.exe and C:\\Temp\\update.exe\n[(MD5: f557a178550733c229f1087f2396f782):](https://www.virustotal.com/gui/file/173ac2a1f99fe616f5efa3a7cf72013ab42a68f7305e24ed795a98cb08046ee1/detection)\n\ncmd /c cd /d C:\\\\root&procdump64.exe -accepteula -ma lsass.exe lsass.dmp&echo\n\n[S]&cd&echo [E]\n\nb. Reconnaissance commands:\n\nwhoami.exe\nping.exe\ntasklist.exe\nquser.exe\nquery.exe\n\n**Indicators Of Compromise (IOCs)**\n\n**Type** **Value**\n\nIP Address 165.232.154.116\n\nIP Address 157.230.221.198\n\nIP Address 161.35.45.41\n\nIP Address 45.77.252.175\n\nIP Address 104.248.49[.]97\n\nIP Address That Interacts with Uploaded Webshells 194.87.69[.]35\n\nURL /ecp/y.js\n\n\n-----\n\n**Type** **Value**\n\nURL /ecp/DDI/DDIService.svc/GetList\n\nURL /ecp/DDI/DDIService.svc/SetObject\n\nURL /owa/auth/errorEE.aspx\n\nURL /owa/auth/logon.aspx\n\nURL /owa/auth/errorFE.aspx\n\nURL /aspnet_client/aa.aspx\n\nURL /aspnet_client/iis\n\nURL /iistart.aaa\n\nURL /owa/iistart.aaa\n\nUser Agent python-requests/2.25.1\n\nUser Agent antSword/v2.1\n\n## References\n\n Update: March 7, 2021\n\nMicrosoft [published tools to help identify servers potentially compromised by HAFNIUM.](https://github.com/microsoft/CSS-Exchange/tree/main/Security)\nUpon review of the checks within the tools, Rapid7 identified the following additional preexisting detections within InsightIDR’s Attacker Behavior Analytics that would have alerted\ncustomers to this malicious actor in their environment:\n\nAttacker Technique - PowerShell New-MailboxExportRequest (Created March 14,\n2019)\nAttacker Technique - PowerShell Remove-MailboxExportRequest (Created Dec. 15,\n2020)\nAttacker Technique - Compressing Mailbox With 7zip (Created Dec. 15, 2020)\nAttacker Technique - PowerShell Download Cradles (Created Jan. 3, 2019)\n\nThese previously existing detections are based on observed attacker behavior seen by our\nIncident Response (IR), Managed Detection and Response, and Threat Intelligence and\nDetection Engineering (TIDE) teams. Through continuous collaboration across the Detection\nand Response practice, we help ensure our clients continue to have coverage for the latest\ntechniques being used by malicious actors.\n\n## Update March 18 2021\n\n\n-----\n\n[Widespread exploitation of vulnerable on-premises Exchange servers is ongoing. Microsoft](https://blog.rapid7.com/2021/03/03/mass-exploitation-of-exchange-server-zero-day-cves-what-you-need-to-know/)\nhas released a \"One-Click Exchange On-premises Mitigation Tool\" (EOMT.ps1) that may be\nable to automate portions of both the detection and patching process. Microsoft has said the\ntool is intended \"to help customers who do not have dedicated security or IT teams to apply\nthese security updates...This new tool is designed as an interim mitigation for customers who\nare unfamiliar with the patch/update process or who have not yet applied the on-premises\nExchange security update.\" They have tested the tool across Exchange Server 2013, 2016,\nand 2019 deployments. See Microsoft's blog on the tool for details and directions:\nhttps://msrc-blog.microsoft.com/2021/03/15/one-click-microsoft-exchange-on-premisesmitigation-tool-march-2021/\n\nWe continue to encourage on-premises Exchange Server users to prioritize patching and\nmonitoring for indicators of compromise on an emergency basis.\n\n_We'd like to extend a huge thank-you to everyone who helped contribute to this blog post:_\n\n_Robert Knapp_\n_Shazan Khaja_\n_Lih Wern Wong_\n_Tiffany Anders_\n_Andrew Iwamaye_\n_Rashmi Joshi_\n_Daniel Lydon_\n_Dan Kelly_\n_Carlo Anez Mazurco_\n_Eoin Miller_\n_Charlie Stafford_\n_The Rapid7 MVM Team_\n\n\n-----\n\n## Never miss a blog\n\nGet the latest stories, expertise, and news about security today.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-03-02 - Rapid7’s InsightIDR Enables Detection And Response to Microsoft Exchange Zero-Day.pdf"
    ],
    "report_names": [
        "2021-03-02 - Rapid7’s InsightIDR Enables Detection And Response to Microsoft Exchange Zero-Day.pdf"
    ],
    "threat_actors": [
        {
            "id": "529c1ae9-4579-4245-86a6-20f4563a695d",
            "created_at": "2022-10-25T16:07:23.702006Z",
            "updated_at": "2025-03-27T02:02:09.93109Z",
            "deleted_at": null,
            "main_name": "Hafnium",
            "aliases": [
                "Red Dev 13",
                "Silk Typhoon"
            ],
            "source_name": "ETDA:Hafnium",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "7c969685-459b-4c93-a788-74108eab6f47",
            "created_at": "2023-01-06T13:46:39.189751Z",
            "updated_at": "2025-03-27T02:00:03.017103Z",
            "deleted_at": null,
            "main_name": "HAFNIUM",
            "aliases": [
                "ATK233",
                "G0125",
                "Operation Exchange Marauder",
                "Red Dev 13",
                "Silk Typhoon"
            ],
            "source_name": "MISPGALAXY:HAFNIUM",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "2704d770-43b4-4bc4-8a5a-05df87416848",
            "created_at": "2022-10-25T15:50:23.306305Z",
            "updated_at": "2025-03-27T02:00:55.43633Z",
            "deleted_at": null,
            "main_name": "HAFNIUM",
            "aliases": [
                "HAFNIUM",
                "Operation Exchange Marauder",
                "Silk Typhoon"
            ],
            "source_name": "MITRE:HAFNIUM",
            "tools": [
                "Tarrask",
                "ASPXSpy",
                "Impacket",
                "PsExec",
                "China Chopper"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535599,
    "ts_updated_at": 1743041523,
    "ts_creation_date": 1653691078,
    "ts_modification_date": 1653691078,
    "files": {
        "pdf": "https://archive.orkl.eu/0188be2ca0765f05ea309d8ecb8ec099cdb70d00.pdf",
        "text": "https://archive.orkl.eu/0188be2ca0765f05ea309d8ecb8ec099cdb70d00.txt",
        "img": "https://archive.orkl.eu/0188be2ca0765f05ea309d8ecb8ec099cdb70d00.jpg"
    }
}