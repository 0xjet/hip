{
    "id": "a96ae33f-e2cf-4011-a18e-10333acc0148",
    "created_at": "2023-01-12T15:07:04.060378Z",
    "updated_at": "2025-03-27T02:05:43.194311Z",
    "deleted_at": null,
    "sha1_hash": "8fc999a1392b2a42e1f05a2b3bf998f536737dd9",
    "title": "2022-03-11 - In-depth Technical Analysis of Colibri Loader Malware",
    "authors": "",
    "file_creation_date": "2022-05-25T14:39:10Z",
    "file_modification_date": "2022-05-25T14:39:10Z",
    "file_size": 524661,
    "plain_text": "# In-depth Technical Analysis of Colibri Loader Malware\n\n**[cloudsek.com/in-depth-technical-analysis-of-colibri-loader-malware](https://cloudsek.com/in-depth-technical-analysis-of-colibri-loader-malware/)**\n\nMarah Aboud March 10, 2022\n\nOn 27 August 2021, cybersecurity researchers discovered a malware loader dubbed Colibri\nbeing sold on an underground Russian forum. The actors claim that the loader is stealthy and\ncan be used to target Windows systems, to drop other malware onto the infected system.\n\n### Features of the Colibri loader malware\n\nThe features of the loader, as listed in the advertisement, include the following:\n\nThe loader is written in C/ ASM.\nIt works on Windows operating systems including Windows servers.\nThe loader does not have dependencies, indicating that the loader works without\nrelying on other entities from the system.\nThe loader does not have an IAT (Import Address Table) that contains used WinAPI\nfunctions.\nColibri loader has only two sections in the PE structure namely the “.text” (code\nsection) and the “.reloc” (relocation section).\nAll the strings in the loader as well as the connection channel between the C2 server\nand the loader are encrypted.\n\n\n-----\n\n_Threat actor’s post on the cybercrime forum_ _about the Colibri Malware Loader_\n\n_Threat actor’s post on the cybercrime forum_\n\n## Technical Analysis of Colibri\n\n**Unpacking the loader**\n\nColibri loader comes packed in a trojanized executable file. By using x64dbg (debugger) and\nputting breakpoints on the function VirtualAlloc we were able to extract the actual payload of\nthe Colibri loader.\n\n**Packed sample** 74c4f24e9c025d55c4dd8aca8b91fce3\n\n**Colibri unpacked sample** 58FEE16BBEA42A378F4D87D0E8A6F9C8\n\n### The self-modifying code in the malware\n\nBy testing the extracted payload with PEStudio it is evident that the payload has only two\nsections, .text (Code Section) and .reloc (Relocation Section). The results of scanning the\npayload also show the existence of a self-modifying section in the code. This implies that the\npayload is capable of dynamically resolving other parts of the code that are not accessible\nthrough static analysis of the payload.\n\nBy running the payload in an IDA debugger we will be able to resolve the self-modifying code\nsection of the payload.\n\n\n-----\n\n_Two sections that exist in the payload, besides the self-modifying property_\n\n_The self-modifying code_\n\n\n-----\n\n_Dynamically resolved code section_\n\n### IAT dynamic resolving\n\nTo avoid detection by AVs statically, the payload’s author hashes all WinAPI functions,\nignoring the Import Address Table (IAT), which aids in recognising the malware’s activity\nstatically. The payload resolves the function names dynamically using XOR and Shift\noperations. After resolving the function name, the address of the function is stored in eax\nregister and a call function is created.\n\n_Dehashing the function name_\n\n_Dehashing the function names_\n\n### Kill itself if there is already a running instance process of it\n\n\n-----\n\nBefore running on the system, the payload creates a mutex by calling the function\nCreateMutexW and then tests if there is an instance of the payload already running on the\ninfected system. If there is an existing running process of payload on the system, the payload\ncalls the ExitProcess function and exits the execution. If there is no instance of the payload\nrunning on the system, the payload continues the execution and calls the Sleep function to\nsleep for 3 seconds as a simple way to evade protection.\n\n_Check the existence of the payload on the system_\n\n### The connection with the C2 server\n\nTo make the static analysis more difficult and to evade detection, the author of this malware\nhas encrypted all the strings. After resolving the function names dynamically and using the\ndebugger, the strings extracted from the payload will have the following artifacts:\n\nIP address of the C2 server 80.92.205.102\nURL with another payload to be downloaded /gate.php\n\nThe payload first initializes the use of WinInet functions by calling InternetOpenW, followed\nby which it opens the HTTP section with the function InternetConnectW. The payload\ncreates an HTTP request by calling the function HttpOpenRequestW under the following\nparameters:\n\n\n-----\n\nThe type of request: `/GET`\nName of the target object: `/gate.php?type=check&uid=59045F4FF04F133112200`\nHTTP version to be used in the request: `HTTP/1.1`\n\nAfter this, the payload sends the GET request to the server by calling the function\nHttpSendRequestW. Then, the payload calls the function `InternetQueryDataAvailable`\nto determine the amount of requested data. Based on the results of the previous function\ncalls, the payload reads the data by calling the function `InternetReadFile .Our`\nassumption is that the payload requests the C2 server and downloads another payload on the\nsystem.\n\nThe payload calls the function `CryptStringToBinary,to decrypt dataafter downloading the`\ndata from the C2 server, which indicates that the data could be encrypted.\n\n_GET request to the C2 server_\n\n## Indicators of Compromise – Colibri Loader Malware\n\n**MD5** 74c4f24e9c025d55c4dd8aca8b91fce3\n\n58FEE16BBEA42A378F4D87D0E8A6F9C8\n\n**IP** 80.92.205.102\n\n**URL** 80.92.205.102/gate.php?\ntype=check&uid=59045F4FF04F133112200\n\n## Conclusion\n\nColibri loader is a type of malware that is used to load more types of malware into the\ninfected system. This loader has multiple techniques that help avoid detection. This includes,\nomitting the IAT (Import Address Table) along with the encrypted strings to make the\n\n\n-----\n\nanalysis more difficult. Like any other loader malware, the Colibri can be used to install\ninformation-stealing malware which may result in substantial loss of sensitive information.\nThus, users should be wary of any unknown files on their systems.\n\n[Marah Aboud](https://cloudsek.com/author/marah-aboud/)\nMarah is an MTech Cyber Security student, interested in\nmalware and reverse engineering. She is passionate about\nthreat intelligence research. Listening to music, travelling,\nmeeting new friends are parts of her personality.\n\n[Hansika Saxena](https://cloudsek.com/author/hansika-saxena/)\nTotal Posts: 2\nHansika joined CloudSEK’s Editorial team as a Technical\nWriter and is a B.Sc (Hons) student at the University of\nDelhi. She was previously associated with Youth India\nFoundation for a year.\n\n[Janet Jose](https://cloudsek.com/author/janet-jose/)\nCyber Intelligence Editor, CloudSEK\nTotal Posts: 2\nShe is a Cyber Intelligence Editor at CloudSEK. A lawyer by\ntraining and a content writer by choice, she prefers to write\non matters concerning current affairs, security, and human\nfrailty.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-03-11 - In-depth Technical Analysis of Colibri Loader Malware.pdf"
    ],
    "report_names": [
        "2022-03-11 - In-depth Technical Analysis of Colibri Loader Malware.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536024,
    "ts_updated_at": 1743041143,
    "ts_creation_date": 1653489550,
    "ts_modification_date": 1653489550,
    "files": {
        "pdf": "https://archive.orkl.eu/8fc999a1392b2a42e1f05a2b3bf998f536737dd9.pdf",
        "text": "https://archive.orkl.eu/8fc999a1392b2a42e1f05a2b3bf998f536737dd9.txt",
        "img": "https://archive.orkl.eu/8fc999a1392b2a42e1f05a2b3bf998f536737dd9.jpg"
    }
}