{
    "id": "bf635cca-400f-4ac8-a4c9-518de7b4ea23",
    "created_at": "2022-10-25T16:48:20.923486Z",
    "updated_at": "2025-03-27T02:13:57.143612Z",
    "deleted_at": null,
    "sha1_hash": "bead11e2acc0a0690136d7963bb52e8fd93bb80b",
    "title": "",
    "authors": "",
    "file_creation_date": "2020-02-24T08:12:16Z",
    "file_modification_date": "2020-02-24T08:12:16Z",
    "file_size": 2465452,
    "plain_text": "# Cyberwarfare: A deep dive into the latest Gamaredon Espionage Campaign\n\n**[blog.yoroi.company/research/cyberwarfare-a-deep-dive-into-the-latest-gamaredon-espionage-campaign](https://blog.yoroi.company/research/cyberwarfare-a-deep-dive-into-the-latest-gamaredon-espionage-campaign/)**\n\nZLAB-YOROI 2020-02-17\n\n## Introduction\n\nGamaredon Group is a Cyber Espionage persistent operation attributed to Russians FSB (Federal Security Service) in\na long-term military and geo-political confrontation against the Ukrainian government and more in general against the\nUkrainian military power.\n\nGamaredon has been active since 2014, and during this time, the modus operandi has remained almost the same. The\nmost used malware implant is dubbed Pteranodon or Pterodo and consists of a multistage backdoor designed to collect\nsensitive information or maintaining access on compromised machines. It is distributed in a spear phishing campaign\nwith a weaponized office document that appears to be designed to lure military personnel.\n\nIn the recent months, Ukrainian CERT (CERT-UA) reported an intensification of Gamaredon Cyberattacks against\n[military targets. The new wave dates back to the end of November 2019 and was first analyzed by Vitali Kremez.](https://labs.sentinelone.com/pro-russian-cyberspy-gamaredon-intensifies-ukrainian-security-targeting/)\nStarting from those findings, Cybaze-Yoroi ZLab team decided to deep dive into a technical analysis of the latest\nPterodo implant.\n\n## Technical Analysis\n\nThe complex infection chain begins with a weaponized Office document named “f.doc”. In the following table the initial\nmalware information is provided.\n\n\n-----\n\n#### Hash 76ea98e1861c1264b340cf3748c3ec74473b04d042cd6bfda9ce51d086cb5a1a\n\n Threat Gamaredon Pteranodon weaponized document\n\n\n#### Brief Description\n\n\n#### Doc file weaponized with Exploit\n\n\n#### Ssdeep 768:u0foGtYZKQ5QZJQ6hKVsEEIHNDxpy3TI3dU4DKfLX9Eir:uG1aKQ5OwCrItq3Tg‐ GfLt9r\n\nTable 1. Information about initial dropper\n\nThe decoy document is written using the ukrainian language mixed to many special chars aimed to lure the target to\nclick on it, and, once opened, it appears as in the following figure.\n\nFigure 1. Overview of the document\n\nThe document leverages the common exploit aka template injection and tries to download a second stage from\n“hxxp://win-apu.]ddns.]net/apu.]dot”.\n\n\n-----\n\nFigure 2. URL used by document to download the second stage\n\nThanks to this exploit (Remote Code Execution exploit) the user interaction is not required, in fact the “enable macro”\nbutton is not shown. The downloaded document has a “.dot” extension, used by Microsoft Office to save templates for\ndifferent documents with similar formats. Basic Information on the “.dot” file are provided:\n\n#### Hash e2cb06e0a5c14b4c5f58d0e56a1dc10b6a1007cf56c77ae6cb07946c3dfe82d8\n\n Threat Gamaredon Pteranodon loader dot file\n\n Brief Description Dot file enabling the infection of the Gamaredon Pteranodon\n\n Ssdeep 768:5KCB8tnh7oferuHpC0xw+hnF4J7EyKfJ:oI8XoWruHpp/P4\n\nTable 2. Information about second stage\n\nIf we decide to open the document, we see that the document is empty, but it requires the enabling of the macro.\n\nFigure 3. Overview of the second stage document\n\nThe body of the macro can be logically divided into two distinct parts:\n\nThe first one is the setting of the registry key “HKEY_CURRENT_USER\\Software\\Microsoft\\Office\\” &\n_Application.Version & _”\\Word\\Security\\” and the declaration of some other variables, such as the dropurl “get-_\nicons.]ddns.net”;\nThe second one is the setting of the persistence mechanism through the writing of the vbs code in the Startup\nfolder with name “templates.vbs”. This vbs is properly the macro executed by the macro engine of word\n\n\n-----\n\nFigure 4. Code of the “template.vbs” stored in the Startup folder\n\nThe evidence of the written file in the Startup folder:\n\nFigure 5. Evidence of the “template.vbs” file in the Startup folder\n\nAnalyzing the content of “templates.vbs” it is possible to notice that it define a variable containing a URL like “hxxp://get_icons.]ddns.]net/ADMIN-PC_E42CAF54//autoindex.]php” obtained from “hxp://get-icons.]ddns.]net/” & NlnQCJG & “_” &_\nuRDEJCn & “//autoindex.]php”, where “NlnQCJG” is the name that identifies the computer on the network and\n“uRDEJCn” is the serial number of drive in hexadecimal encoding. From this URL it tries to download another stage\nthen storing it into “C:\\Users\\admin\\AppData\\Roaming\\” path with random name. At the end, “templates.vbs” script will\nforce the machine to reboot.\n\nFigure 6. Function used to force machine reboot\n\nThe dropped sample is an SFX archive, like the tradition of Gamaredon implants.\n\n\n-----\n\n#### Hash c1524a4573bc6acbe59e559c2596975c657ae6bbc0b64f943fffca663b98a95f\n\n Threat Gamaredon Pteranodon implant SFX archive\n\n\n#### Brief De‐ scrip‐ tion\n\n Ss‐ deep\n\n\n#### SFX Archive First Stage\n\n 24576:zXwOrRsTQlIIIIwIEuCRqKlF8kmh/ZGg4kAL/WUKN7UMOtcv:zgwR/lIIIIwI6RqoukmhxGgZ+WUKZUMv\n\n\nTable 3. Information about first SFX archive\n\nBy simply opening the SFX archive, it is possible to notice two different files that are shown below and named\nrespectively “8957.cmd” and “28847”.\n\nFigure 7. Content of the Gamaredon Pteranodon SFX archive\n\nWhen executed, the SFX archive will be extracted and the “8957.cmd” will be run. The batch script looks like the\nfollowing screen:\n\nFigure 8. Bat script source code (with junk instructions)\n\nIt contains several junk instructions with the attemption to make the analysis harder. Cleaning the script we obtain:\n\n\n-----\n\nFigure 9. Batch script source code (cleaned)\n\nAt this point, the batch script renames the “28847” file in “28847.exe”, opens it using “pfljk,fkbcerbgblfhs” as password\nand the file contained inside the “28847.exe” file will be renamed in “WuaucltIC.exe”. Finally, it will be run using “post.php” as argument.\n\nThe fact that the “28847.exe” file can be opened makes us understand that the “28847” file is another SFX file. Some\nstatic information about SFX are:\n\n#### Hash 3dfadf9f23b4c5d17a0c5f5e89715d239c832dbe78551da67815e41e2000fdf1\n\n Threat Gamaredon Pteranodon implant SFX archive\n\n Brief Description SFX Archive Second Stage\n\n Ssdeep 24576:vmoO8itbaZiW+qJnmCcpv5lKbbJAiUqKXM:OoZwxVvfoaPu\n\nTable 4. Information about the second SFX archive\n\nExploring it, it is possible to see several files inside of it, as well as the 6323 file. The following figure shows a complete\nlist.\n\nIn this case, the SFX archive contains 8 files: five of them are legit DLLs\nused by the “6323” executable to interoperate with the OLE format\ndefined and used by Microsoft Office. The “ExcelMyMacros.txt” and\n“wordMacros.txt” files contain further macro script, described next. So,\nstatic analysis on the “6323” file shown as its nature: it is written using\nMicrosoft Visual Studio .NET, therefore easily to reverse. Before reversing\nthe executable, it is possible to clean it allowing the size reduction and\nthe junk instruction reduction inside the code. The below image shows\nthe information about the sample before and after the cleaning.\n\nFigure 10. Content of the second SFX archive\n\n\n-----\n\nFigure 11. Static information about .NET sample before and after the cleaning\n\nThe source code looks as follows.\n\nFigure 12. Part of .NET sample source code\n\nThe first check performed is on the arguments: if the arguments length is equal to zero, the malware terminates the\nexecution. After that, the malware checks if the existence of the files “ExcelMyMacros.txt” and “wordMacros.txt” in the\nsame path where it is executed: if true then it reads their contents otherwise it will exit.\n\n\n-----\n\nFigure 13. Function used by .NET sample to check the presence of the “WordMacros.txt” and the “ExcelMyMacros.txt” files”\n\nPart of the content of the variable “xVGlMEP”:\n\n\n-----\n\nFigure 14.Piece of the “WordMacros.txt” code\n\nThere is a thin difference between the two files.\n\nFigure 15. Difference between “WordMacros.txt” and “ExcelMyMacros.txt” files”\n\nAs visible in the previous figure, the only difference between the files are in the variable, registry key and path used by\nWord rather than by Excel. Finally the macros are executed using the Office engine like in the following figure.\n\n\nSo let’s start to dissect the macros. For a better comprehension we will be considering\nonly one macro and in the specific case we will analyze “wordMacros.txt” ones. First\nof all the macro will set the registry key\n“HKEY_CURRENT_USER\\Software\\Microsoft\\Office\\” & Application.Version &\n_”\\Word\\Security\\” and then will set up two scheduled tasks that will start respectively\nevery 12 and 15 minutes: the first one will run a “IndexOffice.vbs” in the path\n“%APPDATA%\\Microsoft\\Office\\” and the second one will run “IndexOffice.exe” in the\nsame path.\n\n\nFigure 16. Winword with malicious\n\nmacro\n\n\n-----\n\nFigure 17. Registry keys and Scheduled tasks set by malware\n\nFinally, the malware will write the “IndexOffice.txt” file in the “%APPDATA%\\Microsoft\\Office\\” path. The following figure\nshows what has been previously described:\n\nFigure 18. Part of “IndexOffice.txt” file\n\nThe script will check the presence of the “IndexOffice.exe” artifact: if true then it will delete it and it will download a new\nfile/script from “hxxp://masseffect.]space/<PC_Name>_<Hex_Drive_SN>/post.]php”.\n\n\n-----\n\nFigure 19. Domain “masseffect.]space” declaration and use of the Encode function\n\nThe malware tries to save the C2 response and encoding it using Encode function. This function accepts three\nparameters: the input file, the output file and the arrKey; arrKey is calculated thanks to GetKey function that accepts as\ninput the Hexadecimal value of the Driver SN installed on the machine and returns the key as results. Part of Encode\nfunction and complete code of GetKey function are shown below.\n\nFigure 20. Encode function\n\n\n-----\n\nFigure 21. Function GetKey\n\nVisiting the web page relative to C2, it shows a “Forbidden message” so this means that the domain is still active but\nrefuses incoming requests.\n\nFigure 22. Browser view of the URL “masseffect.]space”\n\n## Conclusion\n\nGamaredon cyberwarfare operations against Ukraine are still active. This technical analysis reveals that the modus\noperandi of the Group has remained almost identical over the years.\n\nThe massive use of weaponized Office documents, Office template injection, sfx archives, wmi and some VBA macro\nstages that dinamically changes, make the Pterodon attack chain very malleable and adaptive. However, the\nintroduction of a .Net component is a novelty compared to previous Pterodon samples.\n\n## Indicator of Compromise\n\nHashes\n\n76ea98e1861c1264b340cf3748c3ec74473b04d042cd6bfda9ce51d086cb5a1a\ne2cb06e0a5c14b4c5f58d0e56a1dc10b6a1007cf56c77ae6cb07946c3dfe82d8\ndef13f94cdf793df3e9b42b168550a09ee906f07f61a3f5c9d25ceca44e8068c\nc1524a4573bc6acbe59e559c2596975c657ae6bbc0b64f943fffca663b98a95f\n86977a785f361d4f26eb3e189293c0e30871de3c93b19653c26a31dd4ed068cc\n\n\n-----\n\n3dfadf9f23b4c5d17a0c5f5e89715d239c832dbe78551da67815e41e2000fdf1\n2f310c5b16620d9f6e5d93db52607f21040b4829aa6110e22ac55fab659e9fa1\n145a61a14ec6d32b105a6279cd943317b41f1d27f21ac64df61bcdd464868edd\nad61df516fb038e806d13d9cc968abaf55eae3b52780d20976ed4e0db440d87b\nf66e820de46bc0d2053c7d24169deb9424f5fdc6973935b108030b03184fcba5\n40cd2384824ae960a85fc540a763c342c4dc5c9226308d9eb690c98a302fa7a2\n\nPersistence\n\n%AppData%\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\templates.vbs\n\nURL\n\nhxxp://win-apu.]ddns.]net/apu.]dot/\nhxxp://get-icons.]ddns.]net/apu.]dot/\n\nC2\n\nhxxp://masseffect.]space/\n\n### Yara Rule\n\n\n-----\n\n```\nrule Gamaredon_Campaign_January_2020_Initial_Dropper {\n     meta:\n     description = \"Yara Rule for Gamaredon_f_doc\"\n     author = \"Cybaze Zlab_Yoroi\"\n     last_updated = \"2020-02-14\"\n     tlp = \"white\"\n     category = \"informational\"\n     strings:\n     $a1 = { 4B 03 }\n     $a2 = { 8E DA 30 14 DD 57 EA 3F }\n     $a3 = { 3B 93 46 0F AF B0 2B 33 }\n     $a4 = { 50 4B 03 04 14 00 06 00 08 }\n  condition:\n     all of them\n}\nrule Gamaredon_Campaign_January_2020_Second_Stage {\n     meta:\n     description = \"Yara Rule for Gamaredon_apu_dot\"\n     author = \"Cybaze Zlab_Yoroi\"\n     last_updated = \"2020-02-14\"\n     tlp = \"white\"\n     category = \"informational\"\n     strings:\n     $a1 = \"Menu\\\\Programs\\\\Startup\\\\\\\"\"\n     $a2 = \"RandStrinh\"\n     $a3 = \".txt\"\n     $a4 = \"templates.vbs\"\n     $a5 = \"GET\"\n     $a6 = \"Encode = 1032\"\n     $a7 = \"WShell=CreateObject(\\\"WScript.Shell\\\")\"\n     $a8 = \"Security\"\n     $a9 = \"AtEndOfStream\"\n     $a10 = \"GenRandom\"\n     $a11 = \"SaveToFile\"\n     $a12 = \"Sleep\"\n     $a13 = \"WinMgmts:{(Shutdown,RemoteShutdown)}!\"\n     $a14 = \"Scripting\"\n     $a15 = \"//autoindex.php\"\n  condition:\n     11 of ($a*)\n}\nrule Gamaredon_Campaign_January_2020_SFX_Stage_1 {\n     meta:\n     description = \"Yara Rule for Gamaredon SFX stage 1\"\n     author = \"Cybaze Zlab_Yoroi\"\n     last_updated = \"2020-02-14\"\n     tlp = \"white\"\n     category = \"informational\"\n     strings:\n     $a1 = { 4D 5A }\n     $a2 = { FF 75 FC E8 F2 22 01 00 }\n     $a3 = { FE DE DB DB FE D5 D5 D6 F8 }\n     $a4 = { 22 C6 24 A8 BE 81 DE 63 }\n     $a5 = { CF 4F D0 C3 C0 91 B0 0D }\n  condition:\n     all of them\n}\nrule Gamaredon_Campaign_January_2020_SFX_Stage_2 {\n     meta:\n     description = \"Yara Rule for Gamaredon SFX stage 2\"\n     author = \"Cybaze Zlab_Yoroi\"\n     last_updated = \"2020-02-14\"\n\n```\n\n-----\n\n```\n     tlp = \"white\"\n     category = \"informational\"\n     strings:\n     $a1 = { 4D 5A }\n     $a2 = { 00 E9 07 D4 FD FF 8B 4D F0 81 }\n     $a3 = { B7 AB FE B2 B1 B5 FA 9B 11 80 }\n     $a4 = { 81 21 25 E0 38 03 FA F0 AF 11 }\n     $a5 = { 0A 39 DF F7 40 8D 7B 44 52 }\n  condition:\n     all of them\n}\nrule Gamaredon_Campaign_January_2020_dot_NET_stage {\n     meta:\n     description = \"Yara Rule for Gamaredon dot NET stage\"\n     author = \"Cybaze Zlab_Yoroi\"\n     last_updated = \"2020-02-14\"\n     tlp = \"white\"\n     category = \"informational\"\n     strings:\n     $a1 = { 4D 5A }\n     $a2 = \"AssemblyCompanyAttribute\"\n     $a3 = \"GetDrives\"\n     $a4 = \"Aversome\"\n     $a5 = \"TotalMilliseconds\"\n     $s1 = { 31 01 C6 01 F2 00 29 01 5C 03 76 }\n     $s2 = { 79 02 38 03 93 03 B5 03 }\n     $s3 = { 00 07 00 00 11 00 00 72 01 }\n     $s4 = { CD DF A6 EF 66 0E 44 D7 }\n  condition:\n     all of ($a*) and 2 of ($s*)\n}\n\n```\n_This blog post was authored by Davide Testa, Luigi Martire and Antonio Pirozzi of Cybaze-Yoroi ZLAB._\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2020/2020.02.17.Cyberwarfare_Gamaredon_Campaign/Cyberwarfare_%20A%20deep%20dive%20into%20the%20latest%20Gamaredon%20Espionage%20Campaign.pdf"
    ],
    "report_names": [
        "Cyberwarfare_ A deep dive into the latest Gamaredon Espionage Campaign"
    ],
    "threat_actors": [
        {
            "id": "81bd7107-6b2d-45c9-9eea-1843d4b9b308",
            "created_at": "2022-10-25T15:50:23.320841Z",
            "updated_at": "2025-03-27T02:00:55.441723Z",
            "deleted_at": null,
            "main_name": "Gamaredon Group",
            "aliases": [
                "Gamaredon Group",
                "IRON TILDEN",
                "Primitive Bear",
                "ACTINIUM",
                "Armageddon",
                "Shuckworm",
                "DEV-0157",
                "Aqua Blizzard"
            ],
            "source_name": "MITRE:Gamaredon Group",
            "tools": [
                "QuietSieve",
                "Pteranodon",
                "PowerPunch"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "d5156b55-5d7d-4fb2-836f-861d2e868147",
            "created_at": "2023-01-06T13:46:38.557326Z",
            "updated_at": "2025-03-27T02:00:02.861124Z",
            "deleted_at": null,
            "main_name": "Gamaredon Group",
            "aliases": [
                "Aqua Blizzard",
                "Actinium",
                "DEV-0157",
                "Blue Otso",
                "G0047",
                "PRIMITIVE BEAR",
                "Shuckworm",
                "Trident Ursa",
                "UAC-0010",
                "Winterflounder",
                "ACTINIUM",
                "BlueAlpha",
                "IRON TILDEN"
            ],
            "source_name": "MISPGALAXY:Gamaredon Group",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "61940e18-8f90-4ecc-bc06-416c54bc60f9",
            "created_at": "2022-10-25T16:07:23.659529Z",
            "updated_at": "2025-03-27T02:02:09.912404Z",
            "deleted_at": null,
            "main_name": "Gamaredon Group",
            "aliases": [
                "Actinium",
                "Aqua Blizzard",
                "Armageddon",
                "Blue Otso",
                "BlueAlpha",
                "Callisto",
                "DEV-0157",
                "Iron Tilden",
                "Operation STEADY#URSA",
                "Primitive Bear",
                "SectorC08",
                "Shuckworm",
                "Trident Ursa",
                "UAC-0010",
                "Winterflounder"
            ],
            "source_name": "ETDA:Gamaredon Group",
            "tools": [
                "Aversome infector",
                "BoneSpy",
                "DessertDown",
                "DilongTrash",
                "DinoTrain",
                "EvilGnome",
                "FRAUDROP",
                "Gamaredon",
                "GammaDrop",
                "GammaLoad",
                "GammaSteel",
                "Gussdoor",
                "ObfuBerry",
                "ObfuMerry",
                "PlainGnome",
                "PowerPunch",
                "Pteranodon",
                "Pterodo",
                "QuietSieve",
                "Remote Manipulator System",
                "Resetter",
                "RuRAT",
                "SUBTLE-PAWS",
                "UltraVNC"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "236a8303-bf12-4787-b6d0-549b44271a19",
            "created_at": "2024-06-04T02:03:07.966137Z",
            "updated_at": "2025-03-27T02:05:17.410356Z",
            "deleted_at": null,
            "main_name": "IRON TILDEN",
            "aliases": [
                "Aqua Blizzard ",
                "Armageddon",
                "Blue Otso ",
                "BlueAlpha ",
                "Dancing Salome ",
                "Gamaredon",
                "Gamaredon Group",
                "Hive0051 ",
                "Primitive Bear ",
                "Shuckworm ",
                "Trident Ursa ",
                "UAC-0010 ",
                "UNC530 ",
                "WinterFlounder ",
                "ACTINIUM "
            ],
            "source_name": "Secureworks:IRON TILDEN",
            "tools": [
                "Pterodo"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1666716500,
    "ts_updated_at": 1743041637,
    "ts_creation_date": 1582531936,
    "ts_modification_date": 1582531936,
    "files": {
        "pdf": "https://archive.orkl.eu/bead11e2acc0a0690136d7963bb52e8fd93bb80b.pdf",
        "text": "https://archive.orkl.eu/bead11e2acc0a0690136d7963bb52e8fd93bb80b.txt",
        "img": "https://archive.orkl.eu/bead11e2acc0a0690136d7963bb52e8fd93bb80b.jpg"
    }
}