{
    "id": "2b525ad7-87b0-489b-80a7-a53d2569fc4f",
    "created_at": "2023-01-12T15:11:00.997108Z",
    "updated_at": "2025-03-27T02:05:59.959132Z",
    "deleted_at": null,
    "sha1_hash": "90dabe0f4a291d8425209b8c3e9a322d6c18c74b",
    "title": "2022-11-08 - ShortAndMalicious- StrelaStealer aims for mail credentials",
    "authors": "",
    "file_creation_date": "2022-11-28T19:03:28Z",
    "file_modification_date": "2022-11-28T19:03:28Z",
    "file_size": 176755,
    "plain_text": "# #ShortAndMalicious: StrelaStealer aims for mail credentials\n\n**[medium.com/@DCSO_CyTec/shortandmalicious-strelastealer-aims-for-mail-credentials-a4c3e78c8abc](https://medium.com/@DCSO_CyTec/shortandmalicious-strelastealer-aims-for-mail-credentials-a4c3e78c8abc)**\n\nDCSO CyTec Blog November 21, 2022\n\n[DCSO CyTec Blog](https://medium.com/@DCSO_CyTec?source=post_page-----a4c3e78c8abc--------------------------------)\n\nNov 8\n\n\n4 min read\n\nStrela surface-to-air missile launcher (Source: Wikipedia)\nIn our newest category #ShortAndMalicious _DCSO CyTec aims to briefly highlight new and interesting samples we_\ncome across in our daily hunt for malware.\n\nFor the first entry in the series, we take a brief look at an undocumented custom malware we have been analysing\nunder the moniker “StrelaStealer” (“Стрела” == arrow) which appears to be purpose-built to steal mail login data.\n\nPDB path contained in StrelaStealer samples\n_DCSO CyTec first discovered StrelaStealer early November 2022 distributed via ISO files with what appears to be_\nSpanish targets based on used lure documents. It is unclear at this point in time if StrelaStealer is part of a targeted\nattack.\n\n_Blog authored by and ._\n\n## Execution via polyglot\n\n[StrelaStealer samples are distributed in ISO files with varying content. In one instance, StrelaStealer uses a](https://www.virustotal.com/gui/file/be9f84b19f02f16b7d8a9148a68ad8728cc169668f2c59f918d019bce400d90e)\n[renamed msinfo32.exe to sideload StrelaStealer as slc.dll. Another, more interesting variant distributes StrelaStealer](https://hijacklibs.net/entries/microsoft/built-in/slc.html)\nas a DLL/HTML polyglot.\n\n[Polyglots files are files that are valid as two or more different file formats. In this case, StrelaStealer uses a file that is](https://en.wikipedia.org/wiki/Polyglot_(computing))\nboth valid as a DLL as well as an HTML page.\n\nExecution of StrelaStealer via polyglot\nThe ISO file contains two files, one `Factura.lnk and the polyglot` `x.html file. The LNK file then executes`\n```\nx.html twice, once as a DLL and a second time as an HTML file.\n\n```\n\n-----\n\nParsed LNK file command to execute the polyglot\nInspecting `x.html then shows that it simply contains HTML code appended to the DLL file:`\n\nAppended HTML code\nDouble-clicking it opens the browser and displays the lure document:\n\nLure document rendered by Firefox\n\n## Malware analysis\n\nStrelaStealer samples are DLL files, with the main functionality triggered by calling its main export function named\n```\nStrela or s . While its code is not obfuscated, strings are encrypted with a cyclic xor with a hardcoded key:\n\n```\nHardcoded xor key\nOnce executed, StrelaStealer attempts to locate and steal mail login data from Thunderbird and Outlook.\n\nFor Thunderbird, StrelaStealer searches for `logins.json and` `key4.db in the`\n```\n%APPDATA%\\Thunderbird\\Profiles\\ directory and sends the file contents to its C2.\n\n```\nFor Outlook, StrelaStealer enumerates the registry\nkey HKCU\\SOFTWARE\\Microsoft\\Office\\16.0\\Outlook\\Profiles\\Outlook\\9375CFF0413111d3B88A00104B2A6676\\\nin order to find the values `IMAP User,` `IMAP Server and` `IMAP Password . StrelaStealer then decrypts the`\n```\nIMAP Password using CryptUnprotectData before sending the triple to its C2.\n\n## Communication\n\n```\nCommunication is done using plain HTTP POSTs, with the payload encrypted using the same xor key as for the\nstrings. C2 server and resource name are hardcoded and so far all samples were configured for the same one:\n```\nhxxp://193.106.191[.]166/server.php\n\n```\n[The IP address is hosted on known Russian bulletproof hosting “Kanzas LLC” with the /24 likely being hosted in](https://www.spamhaus.org/sbl/query/SBL578934)\nMoscow.\n\nStolen files from Thunderbird are sent home in the following format:\n```\n[prefix \"FF\"][DWORD size logins.json][contents of logins.json][contents of key4.db]\n\n```\nOutlook data uses the following format:\n```\n[prefix \"OL\"][Server1,User1,Password1][Server2,User2,Password2]...\n\n```\nWhen sending home data, StrelaStealer checks for the last two bytes of the response to be `KH which appears to`\nsignal a successful transfer and causes StrelaStealer to quit, otherwise it retries to send the data again after a 1\nsecond sleep.\n\n## IoCs\n\n[As usual, you can find below the IoCs. We share a MISP event on our GitHub.](https://github.com/DCSO/Blog_CyTec/blob/main/2022_11__short_and_malicious_strela_stealer/misp.event.json)\n```\nfa1295c746e268a3520485e94d1cecc77e98655a6f85d42879a3aeb401e5cf15c8eb6efc2cd0bd10d9fdd4f644ebbebdebaff376ece9\n\n## MITRE ATT&CK\nT1003   - Credential Dumping T1041   - Exfiltration Over C2 ChannelT1041   - Exfiltration Over\nCommand and Control ChannelT1059.003 - Windows Command ShellT1071   - Standard Application Layer\nProtocolT1566.001 - Spearphishing AttachmentT1574.002 - DLL Side-Loading\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-11-08 - ShortAndMalicious- StrelaStealer aims for mail credentials.pdf"
    ],
    "report_names": [
        "2022-11-08 - ShortAndMalicious- StrelaStealer aims for mail credentials.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536260,
    "ts_updated_at": 1743041159,
    "ts_creation_date": 1669662208,
    "ts_modification_date": 1669662208,
    "files": {
        "pdf": "https://archive.orkl.eu/90dabe0f4a291d8425209b8c3e9a322d6c18c74b.pdf",
        "text": "https://archive.orkl.eu/90dabe0f4a291d8425209b8c3e9a322d6c18c74b.txt",
        "img": "https://archive.orkl.eu/90dabe0f4a291d8425209b8c3e9a322d6c18c74b.jpg"
    }
}