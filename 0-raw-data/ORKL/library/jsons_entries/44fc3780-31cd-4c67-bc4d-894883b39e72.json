{
    "id": "44fc3780-31cd-4c67-bc4d-894883b39e72",
    "created_at": "2023-01-12T15:04:44.884699Z",
    "updated_at": "2025-03-27T02:06:02.831082Z",
    "deleted_at": null,
    "sha1_hash": "7b5848994583148e2a3b90def36096790e0ade45",
    "title": "2020-11-30 - German users targeted with Gootkit banker or REvil ransomware",
    "authors": "",
    "file_creation_date": "2022-05-28T02:32:58Z",
    "file_modification_date": "2022-05-28T02:32:58Z",
    "file_size": 1840074,
    "plain_text": "# German users targeted with Gootkit banker or REvil ransomware\n\n**[blog.malwarebytes.com/threat-analysis/2020/11/german-users-targeted-with-gootkit-banker-or-revil-ransomware/](https://blog.malwarebytes.com/threat-analysis/2020/11/german-users-targeted-with-gootkit-banker-or-revil-ransomware/)**\n\nThreat Intelligence Team November 30, 2020\n\n_This blog post was authored by Hasherezade and Jérôme Segura_\n\nOn November 23, we received an alert from a partner about a resurgence of Gootkit\ninfections in Germany. Gootkit is a very capable banking Trojan that has been around since\n2014 and possesses a number of functionalities such as keystroke or video recording\ndesigned to steal financially-related information.\n\nIn this latest campaign, threat actors are relying on compromised websites to socially\nengineer users by using a decoy forum template instructing them to download a malicious\nfile.\n\nWhile analyzing the complex malware loader we made a surprising discovery. Victims\nreceive Gootkit itself or, in some cases, the REvil (Sodinokibi) ransomware. The decision to\nserve one or the other payload happens after a check with the criminal infrastructure.\n\n## Gootkit attacks observed in Germany\n\n[Security researcher TheAnalyst was the first to publicly identify an active campaign in](https://twitter.com/ffforward)\nNovember using a sophisticated loader that was eventually attributed to Gootkit, a banking\nTrojan not observed in the wild for some time. Germany’s Computer Emergency Response\n\n\n-----\n\nTeam [CERT-Bund later](https://www.bsi.bund.de/DE/Themen/Cyber-Sicherheit/Aktivitaeten/CERT-Bund/certbund_node.html) [confirmed that German users were being targeted via compromised](https://twitter.com/certbund/status/1330231816796729347?s=20)\nwebsites.\n\nAround the same time, we started receiving reports from some of our partners and their ISPs\nabout Gootkit-related traffic. We were able to confirm Gootkit detections within our telemetry\nthat were all located in Germany.\n\nFigure 1: Gootkit infections in Germany in the wake of the campaign\nAfter a couple of days, we remediated over 600 unique machines that had been\ncompromised.\n\n## Fake forum template on hacked websites\n\nThe initial loader is spread via hacked websites using an interesting search engine\noptimization (SEO) technique to customize a fake template that tries to trick users to\ndownload a file.\n\nThe template mimics a forum thread where a user asks in German for help about a specific\ntopic and receives an answer which appears to be exactly what they were looking for. It’s\nworth noting that the hacked sites hosting this template are not German (only the template\n\n\n-----\n\nis); they simply happen to be vulnerable and are used as part of the threat actor s\ninfrastructure.\n\nFigure 2: Compromised site loads decoy template to trick victims\nThis fake forum posting is conditionally and dynamically created if the correct victim browses\n[the compromised website. A script removes the legitimate webpage content from the DOM](https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model/Introduction)\nand adds its own content (the template showing a link to a file to download)\n\n\n-----\n\nFigure 3: A view of the HTML code behind the decoy template\nThere is a server-side check prior to each visit to the page to determine if the user has\nalready been served the fake template or not, in which case the webserver will return\nlegitimate content instead.\n\n## Fileless execution and module installation\n\nThe infection process starts once the victim executes a malicious script inside the zip archive\nthey just downloaded.\n\n\n-----\n\nFigure\n\n4: Malicious script, heavily obfuscated\nThis script is the first of several stages that leads to the execution of the final payload. The\nfollowing diagram shows a high level overview:\n\n\n-----\n\nFigure 5: Infection flow\n\n**Stage 1 – The first JavaScript**\n\nThe first JavaScript is the module that has to be manually executed by the victim, and it has\nbeen obfuscated in order to hide its real intentions. The obfuscation consists of three layers\nwhere one decodes content for the next.\n\n[The first stage (a version with cleaned formatting available here) decodes the next element:](https://gist.github.com/malwarezone/823e3bacec3fc048db119c82e4cc8e72#file-test-js)\n\nFigure 6: First stage script\n\nThe [decoded output is a comma-separated array of JavaScript blocks:](https://gist.github.com/malwarezone/823e3bacec3fc048db119c82e4cc8e72#file-deobf1-js)\n\n\n-----\n\nFigure 7:\n\nDecoded comma-separated array of scripts\nThere are four elements in the array that are referenced by their indexes. For example, the\nelement with the index 0 means “constructor”, 1 is another block of JavaScript code, 2 is\nempty, 3 is a wrapper that causes a call to a supplied code.\n\nBlock 1 is responsible for reading/writing registry keys under\n“HKEY_CURRENT_USER\\SOFTWARE\\<script-specific name>”. It also deobfuscates and\nruns [another block of code:](https://gist.github.com/malwarezone/823e3bacec3fc048db119c82e4cc8e72#file-deobf2-js)\n\n\n-----\n\nFigure 8: Third JavaScript layer\nThis fragment of code is responsible for connecting to the C2. It fetches the domains from\nthe list, and tries them one by one. If it gets a response, it runs it further.\n\nThe above downloader script is the first stage of the loading process. Functionality-wise it is\nalmost identical in all the dropped files. The differentiation between the variants starts in the\nnext part, which is another JavaScript fetched from the C2 server.\n\n**Stage 2 – The second JavaScript (downloaded from the C2)**\n\nThe expected response from the server is a decimal string, containing a pseudorandom\nmarker used for validation. It needs to be removed before further processing. The marker\nconsists of “@[request argument]@”.\n\n\n-----\n\nFigure 9: GET request\n\nwith C2 server\nAfter conversion to ASCII, the next JavaScript is revealed, and the code is executed. This\nJavaScript comes with an embedded PE payload which may be either a loader for Gootkit, or\nfor the REvil ransomware. There are also some differences in the algorithm used to\ndeobfuscate it.\n\n[Example for the Gootkit variant (commented,](https://gist.github.com/malwarezone/f5b86308bd7ae33e8bad72686a91f2e5#file-commented_script-ps1) [full)](https://gist.githubusercontent.com/malwarezone/9ca378668a21e778a86ebfc00486fb1c/raw/a0c88b7d00be661fe49a98efc14d22f916f10198/dec1.js)\n\nFigure 10: The downloaded JavaScript\nThe downloaded code chunk is responsible for installing the persistent elements. It also runs\na Powershell script that reads the storage, decodes it and runs it further.\n\n**Stage 3 – The stored payload and the decoding Powershell**\n\n\n-----\n\nThe authors diversified the method of encoding and storing the payload. During our tests we\nobserved two ways of encoding. In one of them, the PE is stored as a Base64 encoded\nstring, and in the other as a hexadecimal string, obfuscated by having certain numbers\nsubstituted by a pattern.\n\nThe payload is usually stored as a list of registry keys, yet we also observed a variant in\nwhich similar content was written into a TXT file.\n\nExample of the payload stored in a file:\n\nFigure\n\n11: Payload as a file on disk\nThe content of the file is an obfuscated Powershell script that runs another Base64\nobfuscated layer that finally decodes the .NET payload.\n\nExample of the Powershell script that runs to deobfuscate the file:\n```\n\"C:\\Windows\\SysWOW64\\WindowsPowerShell\\v1.0\\powershell.exe\" -ExecutionPolicy Bypass windowstyle hidden -Command \"IEX (([System.IO.File]::ReadAllText('C:\\Users\\\n[username]\\bkquwxd.txt')).Replace('~',''));\"\n\n```\nBelow we will study two examples of the loader: One that leads to execution of the REvil\nransomware, and another that leads to the execution of Gootkit.\n\n## Example 1—Loading REvil ransomware\n\nThe example below shows the variant in which a PE file was encoded as an obfuscated\nhexadecimal string. In the analyzed case, the whole flow led to execution of REvil\n[ransomware. The sandbox analysis presenting this case is available here.](https://app.any.run/tasks/b5146ffd-328f-4d6f-9bf7-c544d02f1d47/)\n\nExecution of the second stage JavaScript leads to the payload being written to the registry,\nas a list of keys. The content is encoded as hexadecimal, and mildly obfuscated.\n\n\n-----\n\nFigure 12: Fragment of the payload stored in the registry, encoded as a hexadecimal string\nobfuscated with a pattern\nAfter writing the keys, the JavaScript deploys a PowerShell command that is responsible for\ndecoding and running the stored content.\n\nFigure 13:\n\nThe JS component deploys PowerShell with a Base64 encoded script\n[Decoded content of the script:](https://gist.github.com/malwarezone/0a16db66fe2251bc84a55dc3e4a0241c#file-deobf-ps1)\n\n\n-----\n\nFigure 14:\n\nDecoded content\nIt reads the content from the registry keys and deobfuscates it by substituting patterns. In the\ngiven example, the pattern “!@#” in the hexadecimal string was substituted by “1000”, then\nthe PE was decoded and loaded with the help of .NET Reflection.\n\nThe next stage PE file (.NET):\n\nREvil loader:\n[(0e451125eaebac5760c2f3f24cc8112345013597fb6d1b7b1c167001b17d3f9f)](https://www.virustotal.com/gui/file/0e451125eaebac5760c2f3f24cc8112345013597fb6d1b7b1c167001b17d3f9f/detection)\n\nThe .NET loader comes with a hardcoded string that is the next stage PE: the final malicious\npayload. The Setup function called by the PowerShell script is responsible for decoding and\nrunning the next PE:\n\nFigure\n\n15: Hardcoded string (PE)\n\n\n-----\n\nFigure 16: Deploying the payload\n[The loader runs to the next stage with the help of Process Hollowing – one of the classic](https://blog.malwarebytes.com/threat-analysis/2018/08/process-doppelganging-meets-process-hollowing_osiris/)\nmethods of PE injection.\n\nFigure 17: REvil ransom note\n\n## Example 2 – Loading Gootkit\n\nIn an other common variant, the payload is saved as Base64. The registry keys compose a\nPowerShell script in the following format:\n```\n$Command =\n[System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String(\"\n[content]\")); Invoke-Expression $Command;Start-Sleep -s 22222;\n\n```\n\n-----\n\nFigure 18: Registry key storing payload\nAfter decoding the base64-encoded content, we get another PowerShell script:\n\nFigure 19: More PowerShell\nIt comes with yet another Base64-encoded piece that is further decompressed and loaded\nwith the help of Reflection Assembly. It is the .NET binary, similar to the previous one.\n\nGootkit loader:\n[(973d0318f9d9aec575db054ac9a99d96ff34121473165b10dfba60552a8beed4)](https://www.virustotal.com/gui/file/973d0318f9d9aec575db054ac9a99d96ff34121473165b10dfba60552a8beed4/detection)\n\nThe script calls a function “Install1” from the .NET module. This function loads another PE,\nthat is embedded inside as a base64 encoded buffer:\n\n\n-----\n\nFigure 20: Another buffer Figure 21:\n\nDeploying the payload\nThis time the loader uses another method of PE injection, manual loading into the parent\nprocess.\n\nThe revealed payload is a Gootkit first stage binary:\n[60aef1b657e6c701f88fc1af6f56f93727a8f4af2d1001ddfa23e016258e333f. This PE is written](https://www.virustotal.com/gui/file/60aef1b657e6c701f88fc1af6f56f93727a8f4af2d1001ddfa23e016258e333f/detection)\nin Delphi. In its resources we can find another PE\n[(327916a876fa7541f8a1aad3c2270c2aec913bc8898273d545dc37a85ef7307f ), obfuscated](https://www.virustotal.com/gui/file/327916a876fa7541f8a1aad3c2270c2aec913bc8898273d545dc37a85ef7307f/detection)\nby XOR with a single byte. It is further loaded by the first one.\n\n## Loader like matryoshka dolls with a side of REvil\n\nThe threat actors behind this campaign are using a very clever loader that performs a\nnumber of steps to evade detection. Given that the payload is stored within the registry under\na randomly-named key, many security products will not be able to detect and remove it.\n\nHowever, the biggest surprise here is to see this loader serve REvil ransomware in some\ninstances. We were able to reproduce this flow in our lab once, but most of the time we saw\nGootkit.\n\nThe REvil group has very strict rules for new members who must pass the test and verify as\nRussian. One thing we noticed in the REvil sample we collected is that the ransom note still\npoints to decryptor.top instead of decryptor.cc, indicating that this could be an older sample.\n\nBanking Trojans represent a vastly different business model than ransomware. The latter has\nreally flourished during the past few years and has earned criminals millions of dollars in part\nthanks to large ransom payments from high profile victims. We’ve seen banking malware (i.e.\nEmotet) turn into loaders for ransomware where different threat actors can specialize in what\nthey do best. Time will tell what this return of Gootkit really means and how it might evolve.\n\n\n-----\n\n## Detection and protection\n\nMalwarebytes prevents, detects and removes Gootkit and REvil via our different protection\nlayers. As we collect indicators of compromise we are able to block the distribution sites so\nthat users do not download the initial loader.\n\nOur behavior-based anti-exploit layer also blocks the malicious loader without any signatures\nwhen the JavaScript is opened via an archiving app such as WinRar or 7-Zip.\n\nFigure 22: Blocking on script execution\nIf a system is already infected with Gootkit, Malwarebytes can remediate the infection by\ncleaning up the registry entries where Gootkit hides:\n\n\n-----\n\nFigure 23: Detection of payload hidden in registry\nFinally, we also detect and stop the REvil (Sodinokibi) ransomware:\n\nREvil ransomware blocked heuristically\n\n## Indicators of Compromise\n\n**Compromised websites downloading JavaScript loader:**\n\n\nFigure 24:\n\n\n-----\n\ndocs.anscommerce[.]com\nellsweb[.]net\nentrepasteles[.]supercurro.net\nm-uhde[.]de\ngames.usc[.]edu\ndoedlinger-erdbau[.]at\n\n**3rd stage JavaScript C2s:**\n\nbadminton-dillenburg[.]de\nalona[.]org[.]cy\naperosaintmartin[.]com\n\n**Variant 1 (Gootkit):**\n\n1. NET loader\n\n[[973d0318f9d9aec575db054ac9a99d96ff34121473165b10dfba60552a8beed4]](https://www.virustotal.com/gui/file/973d0318f9d9aec575db054ac9a99d96ff34121473165b10dfba60552a8beed4/detection)\n[2. Delphi PE [60aef1b657e6c701f88fc1af6f56f93727a8f4af2d1001ddfa23e016258e333f]](https://www.virustotal.com/gui/file/60aef1b657e6c701f88fc1af6f56f93727a8f4af2d1001ddfa23e016258e333f/detection)\n3. PE stored in resources\n\n[[327916a876fa7541f8a1aad3c2270c2aec913bc8898273d545dc37a85ef7307f]](https://www.virustotal.com/gui/file/327916a876fa7541f8a1aad3c2270c2aec913bc8898273d545dc37a85ef7307f/detection)\n\n**Variant 2 (REvil):**\n\n1. NET loader\n\n[[0e451125eaebac5760c2f3f24cc8112345013597fb6d1b7b1c167001b17d3f9f]](https://www.virustotal.com/gui/file/0e451125eaebac5760c2f3f24cc8112345013597fb6d1b7b1c167001b17d3f9f/detection)\n2. Delphi PE\n\n[[d0e075a9346acbeca7095df2fc5e7c28909961184078e251f737f09b8ef892b6] – the](https://www.virustotal.com/gui/file/d0e075a9346acbeca7095df2fc5e7c28909961184078e251f737f09b8ef892b6/detection)\nransomware\n3. PE stored in resources\n\n[[a7e363887e9a7cc7f8de630b12005813cb83d6e3fc3980f735df35dccf5a1341] – a](https://www.virustotal.com/gui/file/a7e363887e9a7cc7f8de630b12005813cb83d6e3fc3980f735df35dccf5a1341/details)\nhelper component\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-11-30 - German users targeted with Gootkit banker or REvil ransomware.pdf"
    ],
    "report_names": [
        "2020-11-30 - German users targeted with Gootkit banker or REvil ransomware.pdf"
    ],
    "threat_actors": [
        {
            "id": "67fbc7d7-ba8e-4258-b53c-9a5d755e1960",
            "created_at": "2022-10-25T16:07:24.077859Z",
            "updated_at": "2025-03-27T02:02:10.101173Z",
            "deleted_at": null,
            "main_name": "Promethium",
            "aliases": [
                "APT-C-41",
                "Promethium",
                "StrongPity"
            ],
            "source_name": "ETDA:Promethium",
            "tools": [
                "StrongPity",
                "StrongPity2",
                "StrongPity3",
                "Truvasys"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "cbede712-4cc3-47c6-bf78-92fd9f1beac6",
            "created_at": "2022-10-25T15:50:23.777222Z",
            "updated_at": "2025-03-27T02:00:55.544919Z",
            "deleted_at": null,
            "main_name": "PROMETHIUM",
            "aliases": [
                "PROMETHIUM",
                "StrongPity"
            ],
            "source_name": "MITRE:PROMETHIUM",
            "tools": [
                "Truvasys",
                "StrongPity"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "4660477f-333f-4a18-b49b-0b4d7c66d482",
            "created_at": "2023-01-06T13:46:38.511962Z",
            "updated_at": "2025-03-27T02:00:02.852307Z",
            "deleted_at": null,
            "main_name": "PROMETHIUM",
            "aliases": [
                "StrongPity",
                "G0056"
            ],
            "source_name": "MISPGALAXY:PROMETHIUM",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535884,
    "ts_updated_at": 1743041162,
    "ts_creation_date": 1653705178,
    "ts_modification_date": 1653705178,
    "files": {
        "pdf": "https://archive.orkl.eu/7b5848994583148e2a3b90def36096790e0ade45.pdf",
        "text": "https://archive.orkl.eu/7b5848994583148e2a3b90def36096790e0ade45.txt",
        "img": "https://archive.orkl.eu/7b5848994583148e2a3b90def36096790e0ade45.jpg"
    }
}