{
    "id": "49ec4218-c264-4fde-bda4-db3ef2d225d8",
    "created_at": "2023-01-12T15:10:15.938765Z",
    "updated_at": "2025-03-27T02:10:07.469748Z",
    "deleted_at": null,
    "sha1_hash": "fc48b82ce60e22a8513ef5fc9e7d7caa188930c9",
    "title": "2019-10-18 - TrickBot variant “Anchor_DNS” communicating over DNS",
    "authors": "",
    "file_creation_date": "2022-05-28T19:18:26Z",
    "file_modification_date": "2022-05-28T19:18:26Z",
    "file_size": 581031,
    "plain_text": "# TrickBot variant “Anchor_DNS” communicating over DNS\n\n**[hello.global.ntt/zh-cn/insights/blog/trickbot-variant-communicating-over-dns](https://hello.global.ntt/zh-cn/insights/blog/trickbot-variant-communicating-over-dns)**\n\nSecurity division of NTT Ltd.\n\nby Security division of NTT Ltd.\n\n06 July 2020\n\nWe’ve seen a TrickBot variant exclusively communicating over DNS. This variant is used in a\ncampaign named Anchor_DNS, and we’re seeing it deployed on targets in the financial\nsector as well as high impact servers such as AD controllers.\n\n\n-----\n\nIn this blog post, we ll go through the workflow taken by the actors in order to reach an\nAnchor_DNS infection, technically analyse the sample, and provide recommendations for\ndetection.\n\n**TrickBot Group workflow**\n\nThe deployment workflow of Anchor_DNS begins with the typical distribution methods of\nTrickBot, such as mail-spam and malware droppers. The TrickBot campaigns related to this\nactivity are common ones like, tot548, ser501 etc. When an infection has taken place, the\nactors attempt to move laterally in the network using Trickbot's automated spreading\nmodules or via manual actions.\n\nOur theory is that the actor investigates the newly infected victims and classifies their\nimportance. If the victim is of high importance, the TrickBot operator might decide to migrate\nthis victim to the Anchor_DNS campaign.\n\nIf deemed not interesting, the main working group’s standard operating procedure will take\nplace, which typically includes activities such as password stealing, bank session hijacking\nand ransomware encryption among others.\n\n**Tactics behind the actors of Anchor DNS**\n\n\n-----\n\nThe insight into the actors behind Anchor_DNS TTPs is limited due to the small subset of\nvictims compared to normal TrickBot infections; however, we’ve observed certain activity.\n\nThe actor has deployed remote administration tools such as Metasploit Meterpreter and,\nthrough them, deployed selected malware. The malware type depends on the target, but\nfrom what we’ve seen, ransomware and POS-oriented ones are prevalent.\n\nBased on the above, our theory is that the deployment of tools from the Anchor_DNS C2 is,\nat least partially, on-request by premium customers of the TrickBot group.\n\n**Technical analysis**\n\nThe following analysis is based on the Virustotal submitted Anchor_DNS TrickBot sample\nf7278cd22070f0418ac75b599b8bcc524ee9d6adbda4103d149c9484cdaeb4f3 which has\nsubmission countries Arab Emirates and Germany:\n\n\n-----\n\nSubmission countries for an in-the-wild URL for the executable also has South Korea as a\nsubmitter:\n\nBoth the South Korea and the United Arab Emirates submitters occur in the Hacking team\ndatabase leak released by Wikileaks [1][2] indicating either that the submitters have\nexperienced previous intrusions, or that they are part of a widespread products automated\nVirustotal submissions.\n\n\n-----\n\n**Installation**\n\nUpon execution, the malware will perform a few steps in order to ensure persistence.\n\nFirst, the malware copies itself to the first allowed location of:\n\nC:\\Windows\\SysWOW64\\\nC:\\Windows\\\nC:\\Users\\\\AppData\\Roaming\\\n\nThe destination filename is each time randomly generated; examples are:\n\ngsmpgyda.exe\npwpowcrn.exe\nmntsbdyh.exe\nOnce copied, the file at the original path is deleted.\n\nThe newly created file is executed with the -i flag which initiates the setup of a scheduled\ntask named \"WinRAR autoupdate#83029\", which executes the dropped sample with\nparameter –u every fifteen minutes.\n\nThe –u option will perform standard communication with the C2 server, utilizing subdomain\nnames to send data and resolved IPs as receival of data.\n\n**Data streams**\n\nAnchor_DNS stores key strings for the malware base64 encoded as data streams written to\nthe malware file.\n\nThose are:\n\n**$FILE: C:\\Windows\\SysWOW64\\mntsbdyh.exe (malware-location)**\n**$GUID: /anchor_dns/DESKTOP-**\nC7FF9D5_W629200.03FCAA33763A8FE5CF0BF6FD99F5D2C/\n**$TASK: WinRAR autoupdate#83029**\n\nThe $GUID data will be used during the connection towards the C2 server, $TASK is, as\npreviously mentioned, the task name used for the scheduled task and $FILE is the current\nlocation of the malware.\n\n**Communication over DNS**\n\nC2 communication is performed over DNS which has previously not been seen by TrickBot.\n\nThe malware has three communication types, each are assigned a number:\n\nType 0 (Send data)\nType 1 (Prepare for receival of data)\n\n\n-----\n\nType 2 (Receive data)\n\n**Communication base structure:**\n\nThe client sends data using subdomains while the server responds with resolved IPs as\nresponse.\n\nSubdomains are XOR encoded, observed key is 0xb9:\n\nThe three phases of communication all follow a basic structure, which consists of the\nmessage type and a 16-byte generated UUID:\n\n\n-----\n\nThe generated UUID is unique for each lookup and most likely used make sure that\nmessages are only handled once.\n\nIn the following three sections, we’ll discuss the structure and function of each message\ntype.\n\n**Sending of data (type 0):**\n\nMessage type 0 is the sending of data which is structured as follows:\n\n\n-----\n\nAs can be seen, the structure is fairly similar to the URI structure of the normal TrickBot\nvariant which communicates over HTTP, example from Malware Traffic analysis;\n\n\n-----\n\nPrepare for receival of data (type 1):\n\nThe message type 1 is used in connection of message type 2 in order to receive data:\n\n\n-----\n\nReceive data (type 2):\n\nMessage type 2 which is the receival of data looks like this:\n\n\n-----\n\nThe C2 sends its data through the resolved IP addresses which can be like this:\n\nThe type 2 message will loop over until all data is received and action is taken.\n\nThen it’ll start over with a type 0 message.\n\nThe documentation of this protocol is not complete, and we encourage fellow researchers to\nanalyse it in detail.\n\n\n-----\n\n**Why communicate over DNS?**\n\nIt’s questionable why one would want to have C2 traffic over DNS, when the organization\nalready is successfully infected with the regular TrickBot variant. From the attackers’ point of\nview, we see the following potential motivations:\n\nSeparate C2 infrastructure – if cleanup of the network is made with the help of network\nforensics, it’s possible that this previously undocumented variant remains undetected.\nDNS monitoring is lacking in certain organizations.\nImportant systems such as AD controllers are often expected to perform DNS requests,\nbut not HTTP(S) traffic to unknown destinations.\n\n**Has my organization been infected?**\n\nBesides having an effective security posture, monitoring for any of the following may help\nuncover an Anchor_DNS infection:\n\nDNS lookups containing the string “anchor_dns” XOR encoded\nDNS anomalies\nEndpoint monitoring of among other things, scheduled tasks\n\n**Summary**\n\nWe’re continuously monitoring the actions of the Trickbot authors and their innovations to\nstay hidden while infecting victims around the world. This new TrickBot variant has been\npublicly unknown until now.\n\nWe hope this documentation encourages researchers to further investigate and document its\nbehavior, as well as for potentially targeted organizations to keep this research in mind.\n\nWe help customers detect, prevent and remediate TrickBot infections via our threat detection\nservices delivered from multiple 24/7 SOCs around the world.\n\nIOCs:\n\n**References:**\n\n[1] https://wikileaks.org/hackingteam/emails/emailid/78668\n\n\n-----\n\n[[2] https://wikileaks.org/hackingteam/emails/emailid/1078610](https://wikileaks.org/hackingteam/emails/emailid/1078610)\n\nSecurity division of NTT Ltd.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-10-18 - TrickBot variant “Anchor_DNS” communicating over DNS.pdf"
    ],
    "report_names": [
        "2019-10-18 - TrickBot variant “Anchor_DNS” communicating over DNS.pdf"
    ],
    "threat_actors": [
        {
            "id": "a3687241-9876-477b-aa13-a7c368ffda58",
            "created_at": "2022-10-25T16:07:24.496902Z",
            "updated_at": "2025-03-27T02:02:10.256629Z",
            "deleted_at": null,
            "main_name": "Hacking Team",
            "aliases": [],
            "source_name": "ETDA:Hacking Team",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "e90c06e4-e3e0-4f46-a3b5-17b84b31da62",
            "created_at": "2023-01-06T13:46:39.018236Z",
            "updated_at": "2025-03-27T02:00:02.978356Z",
            "deleted_at": null,
            "main_name": "Hacking Team",
            "aliases": [],
            "source_name": "MISPGALAXY:Hacking Team",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "5a0483f5-09b3-4673-bb5a-56d41eaf91ed",
            "created_at": "2023-01-06T13:46:38.814104Z",
            "updated_at": "2025-03-27T02:00:02.925972Z",
            "deleted_at": null,
            "main_name": "MageCart",
            "aliases": [],
            "source_name": "MISPGALAXY:MageCart",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536215,
    "ts_updated_at": 1743041407,
    "ts_creation_date": 1653765506,
    "ts_modification_date": 1653765506,
    "files": {
        "pdf": "https://archive.orkl.eu/fc48b82ce60e22a8513ef5fc9e7d7caa188930c9.pdf",
        "text": "https://archive.orkl.eu/fc48b82ce60e22a8513ef5fc9e7d7caa188930c9.txt",
        "img": "https://archive.orkl.eu/fc48b82ce60e22a8513ef5fc9e7d7caa188930c9.jpg"
    }
}