{
    "id": "06558f5c-9f1b-4da8-bf81-635fd25ec3e4",
    "created_at": "2023-01-12T15:02:15.673823Z",
    "updated_at": "2025-03-27T02:15:00.023132Z",
    "deleted_at": null,
    "sha1_hash": "995a148031821a3d612dbb8504ed844feda651d0",
    "title": "2019-10-02 - Another Lazarus Injector",
    "authors": "",
    "file_creation_date": "2022-05-28T17:33:41Z",
    "file_modification_date": "2022-05-28T17:33:41Z",
    "file_size": 314632,
    "plain_text": "# Another Lazarus Injector\n\n**norfolkinfosec.com/another-lazarus-injector/**\n\nnorfolk October 2, 2019\n\nRecently, a VirusTotal submitter uploaded a file that was digitally signed with the same\ncertificate as two [previously reported Lazarus tools. Like one of those tools, this newly](https://twitter.com/KevinPerlow/status/1136994848341409792)\nuploaded malware appears to act as an injector, although it behaves significantly differently.\n\nThis blog post offers a brief analysis of the features and purpose of this injection tool, as well\n[as a comparison with a previously identified injection tool that behaves significantly](https://norfolkinfosec.com/the-lazarus-injector/)\ndifferently and likely serves a different operational purpose.\n\n**Update 20 October, 2019: A small section towards the bottom of this post has been updated**\n[to reflect this malware’s strong resemblance to a file described in a US-CERT Report in late](https://www.us-cert.gov/ncas/alerts/TA18-275A)\n2018. The file in that report served as an injector for the FASTCash AIX malware. Given this\nfile’s similarity, it is highly likely that this file is intended to perform a similar function, but on a\nWindows environment.\n\nMD5: 89081f2e14e9266de8c042629b764926\n\nSHA1: 730c1b9e950932736fc4b02cbdb4e4e891485ac2\n\nSHA256: 39cbad3b2aac6298537a85f0463453d54ab2660c913f4f35ba98fffeb0b15655\n\nCuriously, this file contains a compilation stamp of 2018-06-13 06:17:06 but was digitally\nsigned on 7:43 AM 6/20/2019. The digital signature of this file matches the signature used on\n[two Lazarus tools discussed in open source and on this blog. These factors suggest that the](https://twitter.com/KevinPerlow/status/1136994848341409792)\ntool may have been developed last year but continues to be deployed in contemporary\nintrusions, which could explain the recent signing dates.\n\nOperation\n\nThe injector expects four command line parameters to be present on operation:\n\n– The path of the injector, which under normal circumstances is automatically part of the\ncommand line\n\n– An integer value (1 or 2) that specifies the operational mode (inject or eject)\n\n– A process identifier (PID) value that specifies a target process\n\n– A path to the DLL to be injected into the target PID\n\nThe malware first checks that there are a total of four parameters present before validating\ntheir content. Next, it uses the PathFileExistsA API call to validate the path to the DLL to be\ninjected. The injector also contains debugging messages. These items are all visible in the\nimage below.\n\n\n-----\n\n**Check**\n\n**for total command line arguments and DLL path validity**\n\nNext, the malware checks that an integer has been supplied as a PID and that either the\ninteger 1 or the integer 2 have been supplied for the operational argument. Curiously,\ndynamic debugging suggests that the PID check will still pass as long as an integer is the\nfirst digit (for example, passing “94a” will still cause the malware to attempt to inject or eject a\nDLL from a process with an invalid PID, although this will fail the OpenProcess attempts).\n\nThe malware operates in two one of two ways:\n\n1 – Will attempt to open a process, write a target DLL to virtual memory, and run the DLL by\ncreating a thread\n\n2 – Will attempt to open a process, enumerate its modules, and remove the target DLL if\nfound in the process\n\n\n-----\n\n**Operational parameter check**\n\nThe process for injecting the payload is relatively routine: The injector passes the specified\nPID into the OpenProcess API, allocates a section of memory via VirtualAllocEx, uses\nWriteProcessMemory to write the DLL to this location, resolves the NtCreateThreadEx API\nvia GetProcAddress, and creates a thread to run the payload.\n\nThe process for (and concept of) ejecting the payload is a bit more notable. The malware\npasses the specified PID as an argument for CreateToolHelp32Snapshot, which will also\nenumerate the modules present in the target process. The injector will then use\nModule32First and Module32Next to cycle through these modules, checking if any match the\n\n\n-----\n\nfile path of the DLL specified upon execution. If found, the malware resolves the FreeLibrary\nAPI call and uses this to remove the module.\n\n**Code block for cycling through modules** **to identify DLL**\n\nFollowing the attempt to inject or eject the payload, the malware will terminate. The malware\nalso has a logging function, which will try to write timestamped logging messages at\nc:\\Intel\\tmp3AC.tmp that indicate whether certain tasks passed or failed. Note that these are\n_not the same as the debugging messages. Examples include:_\n\n[2019-10-01 19:07:51.294] Injection : Succeed\n\n[2019-10-01 19:46:11.821] Ejection : Finding Process or Module failed. error = 18\n\nThis blog notes that this logging file path and format generally match previously observed\npaths and formats for DPRK tooling.\n\nDifferences with Previously Reported Injector\n\nAs noted earlier, while this file’s purpose is to inject payloads into a target process, there are\nsome key operational and design differences between this malware and a previously\nreported one.\n\n– The file analyzed in this post does not contain a way to delete payloads from disk, whereas\nthe previously reported injector does.\n\n– The file analyzed in this post allows the user to specify a target process, rather than\ndefaulting to explorer.exe\n\n\n-----\n\n– The file analyzed in this post contains significant debugging and logging messages.\n\n– The previously analyzed file used a file size check to ensure that the injected DLL\ncontained data, whereas this file does not.\n\nWhile the files are highly likely part of the same adversary’s toolset, these differences do\nsuggest that the may serve different purposes and may have been written by different\nauthors, although that is speculation given the lack of additional context currently available\nfor the file analyzed in this post.\n\n**Update 20 October 2019: As noted in the original version of this post, this file operates**\nsignificantly differently from the previously identified injector. One of the biggest differences is\nin functionality- the file described in this post can inject a payload into a specified process.\n\nA simple comparison of the features in this malware with a file described in a US-CERT\nReport from late 2018 reveals that they serve nearly identical purposes (but for different\noperating systems). In that report, researchers describe an injector used to deploy a payload\nthat hooks the send and receive functions of a target process in order to intercept ISO 8583\nfinancial messages. This would explain the need to specify the process by PID, as the\nprocess name might vary from environment to environment.\n\nThe file described by US-CERT is designed for UNIX systems, whereas the file in this blog\npost is designed for Windows systems. This would suggest that the threat actors responsible\nlikely have a FASTCash payload for Windows operating systems as well.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-10-02 - Another Lazarus Injector.pdf"
    ],
    "report_names": [
        "2019-10-02 - Another Lazarus Injector.pdf"
    ],
    "threat_actors": [
        {
            "id": "679e335a-38a4-4db9-8fdf-a48c17a1f5e6",
            "created_at": "2023-01-06T13:46:38.820429Z",
            "updated_at": "2025-03-27T02:00:02.927526Z",
            "deleted_at": null,
            "main_name": "FASTCash",
            "aliases": [],
            "source_name": "MISPGALAXY:FASTCash",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535735,
    "ts_updated_at": 1743041700,
    "ts_creation_date": 1653759221,
    "ts_modification_date": 1653759221,
    "files": {
        "pdf": "https://archive.orkl.eu/995a148031821a3d612dbb8504ed844feda651d0.pdf",
        "text": "https://archive.orkl.eu/995a148031821a3d612dbb8504ed844feda651d0.txt",
        "img": "https://archive.orkl.eu/995a148031821a3d612dbb8504ed844feda651d0.jpg"
    }
}