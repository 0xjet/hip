{
    "id": "726bbf73-581e-4b43-9710-34da286d9ef3",
    "created_at": "2023-01-12T15:08:55.413545Z",
    "updated_at": "2025-03-27T02:06:12.231918Z",
    "deleted_at": null,
    "sha1_hash": "204a99706bfe72cf1715b578439b2e03ccef64ef",
    "title": "2021-01-26 - TrickBot’s Survival Instinct Prevails — What’s Different About the TrickBoot Version-",
    "authors": "",
    "file_creation_date": "2022-05-28T19:31:47Z",
    "file_modification_date": "2022-05-28T19:31:47Z",
    "file_size": 1337741,
    "plain_text": "# What's Different About the TrickBoot Version?\n\n**[securityintelligence.com/posts/trickbot-survival-instinct-trickboot-version/](https://securityintelligence.com/posts/trickbot-survival-instinct-trickboot-version/)**\n\n[Home&nbsp/](https://securityintelligence.com/) [Data Protection](https://securityintelligence.com/category/topics/data-protection/)\nTrickBot’s Survival Instinct Prevails — What’s Different About the TrickBoot Version?\n\n[Data Protection January 26, 2021](https://securityintelligence.com/category/topics/data-protection/)\nBy [Nir Shwarts 9 min read](https://securityintelligence.com/author/nir-shwarts/)\n\n\n-----\n\nOctober 2020 saw the TrickBot Trojan, a prominent cybercrime gang s tool of choice, suffer a\n[takedown attempt by security vendors and law enforcement. Unfortunately, the takedown](https://www.zdnet.com/article/microsoft-says-it-took-down-94-of-trickbots-command-and-control-servers/)\nwas not effective, and beyond coming back to life shortly after, TrickBot’s operators released\na new and more persistent version of the malware.\n\n[In this post, IBM Trusteer examines the new TrickBot version versus its precedent and looks](https://securityintelligence.com/news/trickbot-using-bazarbackdoor-to-gain-full-access-to-targeted-networks/)\ninto the components its developers kept or modified.\n\n## TrickBot Returns\n\nWhat can be said about the TrickBot banking malware and botnet that has not been covered\nyet by the security community? After it emerged in 2016, built upon the ruins of the Dyre\nTrojan, TrickBot’s developers have not laid down their cyber-arms. Looking back at the past\ntwo years, not only has TrickBot continued to plague the online banking applications that\ncater to businesses, it has also ventured into collaborations with other elite cybercrime\ngangs. Additionally, it has worked with Ryuk and other ransomware on big game hunting\nattacks, deployed cryptominers and was a concerning factor in election interference in 2020.\n\nLike many other botnets, TrickBot has garnered a lot of attention from law enforcement and\n[suffered a takedown attempt in October 2020. Unfortunately, despite losing a large](https://www.zdnet.com/article/trickbot-botnet-survives-takedown-attempt-but-microsoft-sets-new-legal-precedent/)\nproportion of its infrastructure, TrickBot not only re-emerged, but it also launched a new, and\nmore persistent version than ever, using a UEFI/BIOS bootkit to help it remain undetected on\n[infected devices. This bootkit was dubbed TrickBoot by those who first analyzed and](https://eclypsium.com/2020/12/03/trickbot-now-offers-trickboot-persist-brick-profit/)\nreported about it.\n\nOur team at IBM Trusteer research examined what changed between the two most recent\nversions of the TrickBot malware. Let’s take a closer look at some of the components that\nkeep TrickBot persistent and stealthy over time.\n\n## Compared Components\n\nThis comparison will look into a few major components from previous versions 1000512 and\n1000513 versus the newer version 100003. Unusually, the version number jumped\nbackward.\n\nPersistence mechanism\nInjection technique\nBot configuration with a random twist\nMutex naming concept\nCompromise check\n\n## Persistence Mechanism – Modified in New Version\n\n\n-----\n\nMost malicious software developers implement some sort of persistence mechanism to\nensure the malware is not wiped from the device on reboot. TrickBot’s long-standing\npersistence method uses a scheduled task that is set to run on set time lapses. This tactic\nwas modified in the newer version.\n\nIn the previous version, the scheduled task appeared under the name Clean Master.\n\n_Figure 1: TrickBot’s scheduled task created under the task directory_\n\nThis task’s executable file’s path is directly in the ‘Programs’ menu:\n\n_Figure 2: Task’s executable location_\n\nThe malware further copies itself into a new subdirectory as part of its stealth tactics, thereby\nmaking Clean Master appear as yet another legitimate program and not suspicious at first\nsight.\n\nIn the new version, although TrickBot maintained the persistence mechanism of using the\nWindows Task Scheduler as the way to reload the malware, the task’s destination is now\nchanged to a batch file. This is a stealthier choice by TrickBot’s developers, helping the\nmalware evade scans by antivirus and security tools that typically look for malicious\nexecutables in the autorun and task scheduler.\n\n_Figure 3: Autorun snippet of the new task_\n\nA quick look into the batch file location exposes TrickBot’s executable, named ‘newb’ in this\ncase.\n\n\n-----\n\n_Figure 4: TrickBot’s batch file along its executable_\n\nFurther in the batch file, we also see an obfuscated script:\n\n_Figure 5: A part of TrickBot’s obfuscated batch file_\n\nDe-obfuscating the script reveals its more obvious purpose as running the TrickBot\nexecutable (newb.exe) from the following patch:\n\nstart C:\\Users\\[name here]\\AppData\\Roaming\\Identities1793959193\\newb.exe\n\n## Choice of Injection Mechanism – Retained\n\nThe injection of malicious code into legitimate Windows processes is one of the most\n[common tactics malware developers use. The code injection can take different forms, but a](https://securityintelligence.com/dridexs-cold-war-enter-atombombing/)\nhighly popular way to implement code injection is process hollowing, in which legitimate\ncontent is removed and replaced by the attacker’s code.\n\nTrickBot uses process hollowing as its code injection tactic, and that has remained the same\nin the previous and current versions of the malware. This method has a couple of\nadvantages:\n\nAllows for the termination of the main suspicious process\nPresents the malware’s operations as being performed by legitimate processes\n\nHere’s what TrickBot’s process hollowing does:\n\n1. Creates process wermgr.exe in suspend mode using CreateProcessInternalW. This\n\nWindows process is inherently responsible for handling errors.\n2. Allocates memory for its payload shellcode using NtAllocateVirtualMemory\n\n\n-----\n\n3. Writes into memory using NtWriteVirtualMemory\n4. Reads remote process’s Process Environment Block (PEB) using\n\nNtQueryInformationProcess\n5. Reads first module wermgr.exe’s address using the PEB structure\n6. Goes to the 0xF0+0x28=0x118 offset in the wermgr.exe address to find its entry point:\n\n_Figure 6: Wermgr’s entry-point address_\n\n1. Writes a trampoline to the entry point 0x80F0 and the module’s base address to jump\n\nto the shellcode using NtWriteVirtualMemory. A [trampoline is a small piece of code](https://en.wikipedia.org/wiki/Trampoline_(computing)#:~:text=The%20trampoline%20is%20a%20small,variables%20of%20the%20enclosing%20function.)\nwhich is constructed on the fly on the stack when the address of a nested function is\ntaken.\n2. Calls NtResumeThread to resume the thread.\n\n_Figure 7: Example of TrickBot’s trampoline_\n\n## Bot Configuration Receives Randomization Twist\n\nBot configuration is the way the malware configures its own file on initial setup when a new\nmachine is infected or when it is updated on infected devices. The initial configuration\ncontains data such as encryption keys, IDs, credentials, URLs and communication patterns it\nwill use to send information to its botmaster.\n\nBot configurations are easy to modify and are changed by malware operators in their various\ncampaigns and attacks, offering agility and stealth.\n\nTrickBot’s initial configuration elements are traditionally split between its embedded XML\n‘mcconf’ configuration file and Base64 encrypted strings stored within the unpacked TrickBot\ncore. The ‘mcconf’ file contains a list of C2 server IP addresses, along with the TrickBot\nversion number, Bot ID and default modules. Remaining configuration elements such as\ninstall directory and scheduled task name are stored as custom Base64 encoded strings.\n\nTrickBot retained the same bot configuration scheme from its previous versions and\ncontinued to use the same one in current versions, only this time, it added some\nrandomization to data inside the file to delay detection and analysis.\n\nWhen we looked at the details, we saw that only task names have been modified, but all the\ndata and purposes remain the same. We will come back to task names later.\n\n\n-----\n\n_Figure 8: TrickBot configuration elements from decrypted base64 strings — excerpt_\n_comparison from previous and current versions_\n\nTrickBot’s configuration is embedded within the unpacked TrickBot core binaries. The\nextraction process takes place as follows:\n\n1. Upon execution, TrickBot is unpacked. TrickBot makes use of a variety of different\n\npacking techniques; in this case, the malware is stored as a resource of the parent\nexecutable and decrypted using a modified implementation of the RC4 cipher with a\nhardcoded key embedded within the file. This technique is also commonly used by\nEmotet.\n\nThe only difference between the standard RC4 and this modified version is the change of the\nstandard RC4 constant value from 256 to 1147.\n\n1. The resulting binary is the TrickBot Loader. This is a highly obfuscated binary that\n\ndecrypts its other functions and payloads as required using a XOR operation. This\nloader is responsible for decrypting and loading the TrickBot core binaries. The loader\ndecrypts the appropriate 32/64 bit core binary using XOR and decompresses it using\nan LZO algorithm.\n2. Within the TrickBot core binary, the ‘mcconf’ configuration file is embedded and\n\nencrypted using AES and XOR. The binary also contains a list of custom base64\nencoded strings separated by the NULL byte ‘\\x00’.\n\n\n-----\n\n_Figure 9: Part of the encoded TrickBot configuration, separated by NULL bytes_\n\n1. The last string is picked to become a custom Base64 encoding index.\n2. When required, every string the malware calls is then pushed to a Base64 decoding\n\nfunction that uses the custom index to decode the configuration. This way, the specific\nconfiguration is in plaintext only when it’s used, which can make both dynamic and\nstatic analysis by outsiders take longer.\n\nThe Base64 binary data encoding uses an index table of 64 characters, which typically\nincludes basic characters such as:\nABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\n\nWith TrickBot’s configuration, the index table used in our sample was:\n\n3GjYRHFAKkzMws2IuZpiJOqamWgSBh14nE0N8x9LbXQt5yUPvedVcl6ofTD/+rC7\n\nA closer look revealed that TrickBot’s encryption methods are customized by its developers.\nFor example, Trickbot uses different implementation for the RC4 cipher and a modified\nBase64 decoding algorithm, incorporating a custom table in order to make analysis more\ndifficult. These choices are likely there since most crypto detection scripts are not likely to\nfind such functions automatically.\n\n## Bot Configuration Changes\n\nIn the beginning of this section, we mentioned that only task names in the bot configuration\nwere modified. These names change frequently and, in the newer samples, task names are\nappended a randomized 10-digit number that modifies the name each time. For example, for\nthe task name ‘identities’ we will now see a string like ‘Identities1793959193’. The developer\nlikely uses this random twist to eliminate the ability to search for constants with detection\ntools.\n\nThe randomization itself is achieved by a couple of additional calculations and XOR\noperations on two values that TrickBot fetches. In this case, it uses the result that is\nproduced at that moment from the computer’s processor’s read time-stamp counter\ncommand (RDTSC[1]) and the result from the Windows GetTickCount [2] function.\n\n## Fully Randomized Mutex Naming – Retained\n\nThe mutex — the mutual exclusion object that synchronizes access to a resource — is very\ncommonly used by malware developers. As a result, mutexes are part of the indicators of\ncompromise to look for when trying to determine if a device has been infected by specific\nmalware. Searching for mutexes is also something malware does to ensure it does not reinfect a device and cause instability, or to kill the processes of a rival malware.\n\n\n-----\n\nTrickBot uses a mutex naming algorithm to create random, unique mutexes across infected\ndevices that it manages to control. Since mutexes are a definitive indicator of compromise,\nTrickBot’s developers were creative in creating the algorithm used here, staying away from\nrelying on system artifacts that can be more easily figured out.\n\nIn current versions, TrickBot’s mutexes are created as fully randomized 32-digits consisting\nof a 16- byte globally unique identifier (GUID).\n\n_Figure 10: An example of a TrickBot mutex name_\n\nIn the process of creating the mutex name, ‘get_random’, TrickBot splits it into two parts:\n\n1. Random [8 Random bytes]\n2. Related [8 Related bytes]\n\nTo randomize the strings, TrickBot uses the GetTickCount function and the RDTSC assembly\ninstruction.\n\n_Figure 11: TrickBot’s simple get_random function_\n\nThe second part, or ‘related part’, is built upon the first. It’s a combination of some XORing\noperations of the first, ‘random part’ with the computer’s volume C serial number. Finally, the\nWindows StringFromCLSID [3] function is used to give the mutex its GUID form.\n\nWhat’s important in the mutex name here is not the value, but the correlation between its first\nand second halves.\n\n## Previous Version Checks\n\nBefore the TrickBot malware infects a device, it runs a detection process to ensure that\ndevice has not already been infected.\n\nThis detection takes us back to TrickBot’s mutex, which is what it looks for on the device.\nSince mutex names are randomized, it cannot directly look for a name. Rather, it examines\nthe relation between the first half and the second half of the mutex and then infers whether\n\n\n-----\n\nthe resulting GUID has or has not been generated in the past.\n\nLet’s take a closer look at the mutex enumeration process that TrickBot performs:\n\n1. It. begins by enumerating all system handles. In Windows-based devices, a handle is a\n\npointer to an object, such as a mutex, a file, etc. The malware does that by calling the\nZwQueryInformation Native API[4] with SYSTEM_HANDLE_INFORMATION (0x10) as\nthe parameter.\n2. Next, it uses the NtQueryObject function it queries for information about each object,\n\nand in our case each handle, to search mutex names.\n3. Then it uses the OpenProcess function to open the process the mutex handle belongs\n\nto.\n4. Lastly, it uses the DuplicateHandle function to duplicate the handle to that mutex so it\n\ncan access it.\n\nNote that the first two functions are Windows Native APIs belonging to the NTDLL.dll library.\nUsually, when calling a Windows API function from the KERNEL32.dll, it calls its Windows\nNative API counterpart function in NTDLL.dll that address the Windows kernel.\n\nAt this point, if the device is deemed infected, TrickBot initiates an ExitProcess to abandon a\nsecond installation of the malware.\n\n## TrickBot Lives On – A Reminder to Stay Vigilant\n\nAs we kick off 2021, the TrickBot Trojan and the cybercrime syndicate around it are in full\nswing, operating on the bank fraud front as well as high-stakes ransomware attacks.\n\nIf your security team detects TrickBot on networked devices, those should become high\npriority to clean or reimage as needed. This malware can be a foot in the door for a number\nof attacks, the worst of which can be an all-out ransomware and extortion operation against\nyour organization.\n\nIBM Trusteer fights threats like TrickBot and has been helping customers mitigate attacks\nsince 2006. Our fraud detection and advanced risk-based authentication help banks protect\nconsumers and businesses, and our research team is pivotal in detecting highly modular,\nmodern-day malware like TrickBot and its components.\n\nTo learn more about IBM Trusteer, visit [www.ibm.com/security/fraud-protection/trusteer.](https://www.ibm.com/security/fraud-protection/trusteer)\n\n_[1] RDTSC loads the current value of the processor’s time-stamp counter into the EDX:EAX_\n_registers._\n\n_[2] Retrieves the number of milliseconds that have elapsed since the system was started, up_\n_to 49.7 days._\n\n\n-----\n\n_[3] The StringFromCLSID function converts a CLSID into a string of printable characters._\n_Different CLSIDs will convert to different strings._\n\n_[4] The Native API is a lightweight application programming interface (API) used by Windows_\n_NT and user mode applications._\n\n[Malware |](https://securityintelligence.com/tag/malware/) [TrickBot |](https://securityintelligence.com/tag/trickbot/) [Trojan](https://securityintelligence.com/tag/trojan/)\n[Nir Shwarts](https://securityintelligence.com/author/nir-shwarts/)\nMalware Research-Reverse Engineering, IBM Security\n\nNir Shwarts is a contributor for SecurityIntelligence.\n\n\n-----\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-01-26 - TrickBot’s Survival Instinct Prevails — What’s Different About the TrickBoot Version-.pdf"
    ],
    "report_names": [
        "2021-01-26 - TrickBot’s Survival Instinct Prevails — What’s Different About the TrickBoot Version-.pdf"
    ],
    "threat_actors": [
        {
            "id": "f8dddd06-da24-4184-9e24-4c22bdd1cbbf",
            "created_at": "2023-01-06T13:46:38.626906Z",
            "updated_at": "2025-03-27T02:00:02.877001Z",
            "deleted_at": null,
            "main_name": "Tick",
            "aliases": [
                "Stalker Taurus",
                "PLA Unit 61419",
                "Nian",
                "BRONZE BUTLER",
                "REDBALDKNIGHT",
                "STALKER PANDA",
                "G0060"
            ],
            "source_name": "MISPGALAXY:Tick",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d4e7cd9a-2290-4f89-a645-85b9a46d004b",
            "created_at": "2022-10-25T16:07:23.419513Z",
            "updated_at": "2025-03-27T02:02:09.790389Z",
            "deleted_at": null,
            "main_name": "Bronze Butler",
            "aliases": [
                "Bronze Butler",
                "CTG-2006",
                "Operation ENDTRADE",
                "RedBaldNight",
                "Stalker Panda",
                "Stalker Taurus",
                "TEMP.Tick",
                "Tick"
            ],
            "source_name": "ETDA:Bronze Butler",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "9002 RAT",
                "AngryRebel",
                "Blogspot",
                "Daserf",
                "Datper",
                "Elirks",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "HOMEUNIX",
                "HidraQ",
                "HomamDownloader",
                "Homux",
                "Hydraq",
                "Lilith",
                "Lilith RAT",
                "McRAT",
                "MdmBot",
                "Mimikatz",
                "Minzen",
                "Moudour",
                "Muirim",
                "Mydoor",
                "Nioupale",
                "PCRat",
                "POISONPLUG.SHADOW",
                "Roarur",
                "RoyalRoad",
                "ShadowPad Winnti",
                "ShadowWali",
                "ShadowWalker",
                "SymonLoader",
                "WCE",
                "Wali",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "XShellGhost",
                "XXMM",
                "gsecdump",
                "rarstar"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "bf0489c5-1c07-41e6-91c9-855ad96ccc6a",
            "created_at": "2022-10-25T16:47:55.541639Z",
            "updated_at": "2025-03-27T02:05:17.253496Z",
            "deleted_at": null,
            "main_name": "BRONZE BUTLER",
            "aliases": [
                "Daserf",
                "Stalker Panda ",
                "Tick ",
                "CTG-2006 "
            ],
            "source_name": "Secureworks:BRONZE BUTLER",
            "tools": [
                " DGet",
                " Daserf",
                " Datper",
                " Gofarer",
                " MSGet",
                " Mimikatz",
                " RarStar",
                " Screen Capture Tool",
                " ShadowPad",
                " T-SMB",
                " WinRAR",
                " Windows Credential Editor",
                " gsecdump",
                " xmm downloader",
                " xxmm",
                "ABK"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673536135,
    "ts_updated_at": 1743041172,
    "ts_creation_date": 1653766307,
    "ts_modification_date": 1653766307,
    "files": {
        "pdf": "https://archive.orkl.eu/204a99706bfe72cf1715b578439b2e03ccef64ef.pdf",
        "text": "https://archive.orkl.eu/204a99706bfe72cf1715b578439b2e03ccef64ef.txt",
        "img": "https://archive.orkl.eu/204a99706bfe72cf1715b578439b2e03ccef64ef.jpg"
    }
}