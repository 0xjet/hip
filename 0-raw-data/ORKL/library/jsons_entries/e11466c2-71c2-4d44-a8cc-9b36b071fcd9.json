{
    "id": "e11466c2-71c2-4d44-a8cc-9b36b071fcd9",
    "created_at": "2023-01-12T14:59:20.530496Z",
    "updated_at": "2025-03-27T02:17:23.119271Z",
    "deleted_at": null,
    "sha1_hash": "7371abcd7e40ef2149ae71453c1090176bcfd192",
    "title": "2021-06-29 - Not Laughing- Malicious Office Documents using LoLBins",
    "authors": "",
    "file_creation_date": "2022-05-28T19:07:13Z",
    "file_modification_date": "2022-05-28T19:07:13Z",
    "file_size": 1628910,
    "plain_text": "# Not Laughing: Malicious Office Documents using LoLBins\n\n**[netskope.com/blog/not-laughing-malicious-office-documents-using-lolbins](https://www.netskope.com/blog/not-laughing-malicious-office-documents-using-lolbins)**\n\nGhanashyam Satpathy June 29, 2021\n\n_[Co-authored by Ghanashyam Satpathy and](https://www.netskope.com/blog/author/gsatpathy)_ _[Jenko Hwong](https://www.netskope.com/blog/author/jenkohwong)_\n\n## Summary\n\nAttackers have long used phishing emails with malicious Microsoft Office documents, often\n[hosted in popular cloud apps like Box and Amazon S3 to increase the chances of a](https://www.netskope.com/blog/cloud-and-threat-report-cloudy-with-a-chance-of-malware)\nsuccessful lure. The techniques being used with Office documents are continuing to evolve.\n\n[In August – September of 2020, we analyzed samples that used advanced techniques like:](https://www.netskope.com/blog/you-can-run-but-you-cant-hide-detecting-malicious-office-documents)\n\n1. Constructing a PowerShell script at runtime.\n2. Constructing WMI namespaces at runtime.\n3. Using VBA logic obfuscation to evade static and signature-based detections.\n\n[In January 2021, we examined samples that use obfuscation and embedded XSL scripts to](https://www.netskope.com/blog/you-can-run-but-you-cant-hide-advanced-emotet-updates)\ndownload payloads.\n\nIn this blog post, we will examine a new set of malicious Office documents using additional\ntechniques to evade signature-based threat detection, including:\n\n1 Embedded base64 payloads\n\n\n-----\n\n2. Code injection\n\nThis is the first time we have seen attackers using Office documents that use both VBA and\nLoLbins ( certutil.exe and `mavinject.exe ). This blog post provides a default teardown`\nof how these techniques are being used by the Lazarus Group.\n\n## Analysis\n\nIn this blog post, we examine a malicious Microsoft Word document linked to the Lazarus\nGroup:\n\n**MD5**\n\n```\n648dea285e282467c78ac184ad98fd77\n\n```\n\n**SHA-1**\n\n```\n5c194ec7cfe33dd738fca71adf960c85e6ed7646\n\n```\n\n**SHA-256**\n\n```\n8e1746829851d28c555c143ce62283bc011bbd2acfa60909566339118c9c5c97\n\n```\n\nThe techniques used in the sample include:\n\nEmbedded payload in base64\nDecoding the base64 payload using `certutil.exe`\nUsing `mavinject.exe for code injection`\n\n`Mavinject.ext` and `certutil.exe` are Windows LoLbins (living off the land binaries),\nused by this sample to connect to the C&C servers and download next stage payloads.\n\n### Embedded base64 payload\n\nThe sample is a Word document (screenshot below) that prompts the user to click the\n“Enable Content” button. The macro code has an auto-trigger routine to execute as soon as\n“Enable Content” is clicked.\n\n\n-----\n\nThe initial payload is stored inside the VBA code as a base64 encoded string. The base64\nstring is saved into a file on the local disk and later decoded back into a PE file. For decoding\nit uses `certutil.exe, a Windows utility installed as part of Certificate Services that is used`\nto configure Certificate Services, backup and restore CA components, and verify certificates\nand key pairs. The VBA code references `certutil.exe using a wildcard string`\n( certut* ) inside the VBA code. The use of a wildcard is to evade simple pattern match on\n```\ncertutil.exe . The VBA script invokes certutil.exe with the -decode command line\n\n```\noption to decode the base64 encoded data.\n\nThe following screenshot shows the VBA project. The base64 string can be seen inside the\nVBA code. The VBA Function `WLQGQifZzoSMZHc is invoked inside Document_Open():`\n\n\n-----\n\nThe sample writes the base64 content into a file at location `C:\\Drivers and names it:`\n```\nDriverGFC.tmp . It then copies certutil.exe from system location to c:\\Drivers\n\n```\nlocation and renames it as `DriverUpdateRx.exe . It refers to` `certutil using a wildcard`\n\n\n-----\n\nas `certut .exe while copying it from the system location. This is done to evade`\nsignatures that key off of the string “ certutil .” The original payload is renamed to\n```\nDriverCLHD.tmp . The command executed at runtime is shown below:\n\"C:\\Windows\\System32\\cmd.exe\" /c copy /b C:\\Windows\\system32\\certut*.exe\nc:\\Drivers\\DriverUpdateRx.exe\n\"C:\\Windows\\System32\\cmd.exe\" /c copy /b\nc:\\Drivers\\DriverGFC.tmp+c:\\Drivers\\DriverGFXCoin.tmp c:\\Drivers\\DriverCLHD.tmp & del\nc:\\Drivers\\DriverGFC.tmp & del c:\\Drivers\\DriverGFXCoin.tmp\n\n```\nIt decodes the file content using `certutil (now copied to` `DriverUpdateRx.exe ) with`\nthe `-decode option.`\n\nThis creates the output file `DriverGFY.db . After decoding, the sample deletes the`\n```\nDriverUpdateRx.exe from C:\\Drivers location and creates another copy of\nDriverGFY.db as DriverGFY.db.dll . The technique the attacker is using here is\n\n```\n[Deobfuscate/Decode Files or Information from the Mitre ATT&CK Framework.](https://attack.mitre.org/techniques/T1140/)\n\nThe command executed at runtime is shown below:\n```\n\"C:\\Windows\\System32\\cmd.exe\" /c c:\\Drivers\\DriverUpdateRx.exe -decode\nc:\\Drivers\\DriverCLHD.tmp c:\\Drivers\\DriverGFY.db & del c:\\Drivers\\DriverCLHD.tmp &\ndel c:\\Drivers\\DriverUpdateRx.exe\n\"C:\\Windows\\System32\\cmd.exe\" /c copy /b c:\\Drivers\\DriverGFY.db\nc:\\Drivers\\DriverGFY.db.dll\n\n```\nUsing the WMI utility, it gets the handle to the running instance of `Explorer.exe . Following`\nis the VBA code snippet:\n```\nSet vQSppIeZ = GetObject(\"winmgmts:\\\\.\\root\\cimv2\")\nSet HfXHePNP = vQSppIeZ.ExecQuery(\"Select * from Win32_Process where\nname='explorer.exe'\")\n\n```\nUsing `mavinject.exe (Microsoft Application Virtualization Injector), it does code injection`\ninto `explorer.exe with its payload` `DriverGFY.db . The technique the attacker is using`\n[here is Process Injection in the Mitre ATT&CK Framework.](https://attack.mitre.org/techniques/T1055/)\n\nThe command executed at runtime for doing code injection is shown below:\n```\n\"C:\\Windows\\System32\\cmd.exe\" /c mavinject.exe 568 /injectrunning\nc:\\Drivers\\DriverGFY.db\n\n```\nThe following is a screenshot of the HexEdit view of the payload after it has been decoded\nusing `certutil.exe :`\n\n\n-----\n\nThe SysMon capture of Process Injection into `Explorer.exe is:`\n\n\n-----\n\nThe screenshot of payload code shows a reference to download the next stage payload. The\nExported function InitUpdate downloads from allgraphicart[.]com.\n\n## Netskope Detection\n\nAt Netskope, we apply a hybrid approach to malicious Office document detection that\nleverages a combination of heuristics and supervised machine learning to identify malicious\ncode embedded in documents. Netskope Advanced Threat Protection provides proactive\ncoverage against zero-day samples including APT and other malicious Office documents\nusing both our ML and heuristic-based static analysis engines, as well as our cloud sandbox.\nThe following screenshot shows the detection for `648DEA285E282467C78AC184AD98FD77,`\nindicating it was detected by both Netskope AV and the Netskope Advanced Heuristic\nEngine. The indicators section shows the reasons it was detected as malicious: the sample\nauto executes the macro code described in this blog post, writes files to the system, and\nexecutes system APIs.\n\n\n-----\n\n## Conclusion\n\n[In addition to the techniques covered in our previous blog posts, the sample we analyzed in](https://www.netskope.com/blog/you-can-run-but-you-cant-hide-detecting-malicious-office-documents)\nthis post uses two additional techniques that leverage LoLBins:\n\n1. Using `certutil.exe to decode an enclosed base64 payload to PE file.`\n2. Using `mavinject.exe to inject the payload into` `explorer.exe .`\n\nNetskope Advanced Threat Protection includes a custom Microsoft Office file analyzer and a\nsandbox to detect campaigns like APT that are in active development and are using new\nOffice documents to spread. We will continue to provide updates on this threat as it evolves.\n\n## IOCs\n\n### Sample 1: 648DEA285E282467C78AC184AD98FD77\n\n**Dropped executable file**\n\n```\nC:\\Drivers\\DriverGFY.db\n\n```\n\n**DNS requests**\n\ndomain allgraphicart[.]com\n\n**Connections**\n\n\n-----\n\nip 155.138.135[.]1\n\nip 184.24.77[.]69\n\n_Thank you to Zhi Xu and Benjamin Chang for helping analyze the sample files and_\n_contributing to this blog._\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-06-29 - Not Laughing- Malicious Office Documents using LoLBins.pdf"
    ],
    "report_names": [
        "2021-06-29 - Not Laughing- Malicious Office Documents using LoLBins.pdf"
    ],
    "threat_actors": [
        {
            "id": "2864e40a-f233-4618-ac61-b03760a41cbb",
            "created_at": "2023-12-01T02:02:34.272108Z",
            "updated_at": "2025-03-27T02:02:10.209072Z",
            "deleted_at": null,
            "main_name": "WildCard",
            "aliases": [],
            "source_name": "ETDA:WildCard",
            "tools": [
                "RustDown",
                "SysJoker"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "32a223a8-3c79-4146-87c5-8557d38662ae",
            "created_at": "2022-10-25T15:50:23.703698Z",
            "updated_at": "2025-03-27T02:00:55.528031Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "Lazarus Group",
                "Labyrinth Chollima",
                "HIDDEN COBRA",
                "Guardians of Peace",
                "NICKEL ACADEMY",
                "Diamond Sleet"
            ],
            "source_name": "MITRE:Lazarus Group",
            "tools": [
                "RawDisk",
                "Proxysvc",
                "BADCALL",
                "FALLCHILL",
                "WannaCry",
                "HOPLIGHT",
                "TYPEFRAME",
                "Dtrack",
                "HotCroissant",
                "HARDRAIN",
                "Dacls",
                "KEYMARBLE",
                "TAINTEDSCRIBE",
                "AuditCred",
                "netsh",
                "ECCENTRICBANDWAGON",
                "AppleJeus",
                "BLINDINGCAN",
                "ThreatNeedle",
                "Volgmer",
                "Cryptoistic",
                "RATANKBA",
                "Bankshot",
                "Torisma",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "9e767b38-12ae-4ef7-9878-5ce1701066d7",
            "created_at": "2024-05-01T02:03:08.131819Z",
            "updated_at": "2025-03-27T02:05:17.413497Z",
            "deleted_at": null,
            "main_name": "NICKEL ACADEMY",
            "aliases": [
                "COVELLITE ",
                "CTG-2460 ",
                "Diamond Sleet ",
                "Guardians of Peace",
                "HIDDEN COBRA ",
                "High Anonymous",
                "Labyrinth Chollima ",
                "NNPT Group",
                "New Romanic Cyber Army Team",
                "Temp.Hermit ",
                "The Lazarus Group ",
                "UNC577 ",
                "Who Am I?",
                "Whois Team",
                "ZINC ",
                "Black Artemis "
            ],
            "source_name": "Secureworks:NICKEL ACADEMY",
            "tools": [
                " DarkMessenger",
                " Destover",
                " Duuzer",
                " HOPLIGHT",
                " Joanap",
                " KorHigh",
                " LiveJinx",
                " Volgmer",
                "Brambul"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "8bc1a044-a23b-4904-903c-13f463605cb3",
            "created_at": "2024-05-01T02:03:08.136237Z",
            "updated_at": "2025-03-27T02:05:17.415795Z",
            "deleted_at": null,
            "main_name": "NICKEL GLADSTONE",
            "aliases": [
                "Bluenoroff ",
                "CTG-6459 ",
                "Citrine Sleet ",
                "HIDDEN COBRA ",
                "Lazarus Group",
                "Sapphire Sleet ",
                "Stardust Chollima ",
                "APT38 "
            ],
            "source_name": "Secureworks:NICKEL GLADSTONE",
            "tools": [
                " Bankshot",
                " CATCH22",
                " CCGC_Proxy",
                " Cur1Agent",
                " Ratankba",
                " Server_TrafficForwarder",
                " Wcry",
                "AlphaNC"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "a2b92056-9378-4749-926b-7e10c4500dac",
            "created_at": "2023-01-06T13:46:38.430595Z",
            "updated_at": "2025-03-27T02:00:02.831633Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "Operation DarkSeoul",
                "APT38",
                "ATK117",
                "DEV-1222",
                "G0032",
                "APT 38",
                "Stardust Chollima",
                "APT-C-26",
                "ATK3",
                "Diamond Sleet",
                "Hidden Cobra",
                "Unit 121",
                "Subgroup: Bluenoroff",
                "NICKEL GLADSTONE",
                "DEV-0139",
                "Andariel",
                "Operation Troy",
                "COVELLITE",
                "TA404",
                "Lazarus group",
                "Dark Seoul",
                "G0082",
                "NewRomanic Cyber Army Team",
                "Bluenoroff",
                "Appleworm",
                "Nickel Academy",
                "COPERNICIUM",
                "Hastati Group",
                "Bureau 121",
                "Operation AppleJeus",
                "Whois Hacking Team",
                "Citrine Sleet",
                "Sapphire Sleet",
                "Group 77",
                "Labyrinth Chollima",
                "Operation GhostSecret",
                "BeagleBoyz"
            ],
            "source_name": "MISPGALAXY:Lazarus Group",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "256a6a2d-e8a2-4497-b399-628a7fad4b3e",
            "created_at": "2023-11-30T02:00:07.299845Z",
            "updated_at": "2025-03-27T02:00:03.257794Z",
            "deleted_at": null,
            "main_name": "WildCard",
            "aliases": [],
            "source_name": "MISPGALAXY:WildCard",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f32df445-9fb4-4234-99e0-3561f6498e4e",
            "created_at": "2022-10-25T16:07:23.756373Z",
            "updated_at": "2025-03-27T02:02:09.966155Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "APT-C-26",
                "ATK 3",
                "Appleworm",
                "Citrine Sleet",
                "DEV-0139",
                "Diamond Sleet",
                "Gleaming Pisces",
                "Gods Apostles",
                "Gods Disciples",
                "Group 77",
                "Guardians of Peace",
                "Hastati Group",
                "Hidden Cobra",
                "ITG03",
                "Jade Sleet",
                "Labyrinth Chollima",
                "Lazarus Group",
                "NewRomanic Cyber Army Team",
                "Operation 99",
                "Operation AppleJeus",
                "Operation AppleJeus sequel",
                "Operation Blockbuster: Breach of Sony Pictures Entertainment",
                "Operation CryptoCore",
                "Operation Dream Job",
                "Operation Dream Magic",
                "Operation Flame",
                "Operation GhostSecret",
                "Operation In(ter)caption",
                "Operation LolZarus",
                "Operation Marstech Mayhem",
                "Operation No Pineapple!",
                "Operation North Star",
                "Operation Phantom Circuit",
                "Operation Sharpshooter",
                "Operation Ten Days of Rain / DarkSeoul",
                "Operation Troy",
                "SectorA01",
                "Slow Pisces",
                "TA404",
                "TraderTraitor",
                "UNC2970",
                "UNC4034",
                "UNC4736",
                "UNC4899",
                "UNC577",
                "Whois Hacking Team"
            ],
            "source_name": "ETDA:Lazarus Group",
            "tools": [
                "3CX Backdoor",
                "3Rat Client",
                "3proxy",
                "AIRDRY",
                "ARTFULPIE",
                "ATMDtrack",
                "AlphaNC",
                "Alreay",
                "Andaratm",
                "AngryRebel",
                "AppleJeus",
                "Aryan",
                "AuditCred",
                "BADCALL",
                "BISTROMATH",
                "BLINDINGCAN",
                "BTC Changer",
                "BUFFETLINE",
                "BanSwift",
                "Bankshot",
                "Bitrep",
                "Bitsran",
                "BlindToad",
                "Bookcode",
                "BootWreck",
                "BottomLoader",
                "Brambul",
                "BravoNC",
                "Breut",
                "COLDCAT",
                "COPPERHEDGE",
                "CROWDEDFLOUNDER",
                "Castov",
                "CheeseTray",
                "CleanToad",
                "ClientTraficForwarder",
                "CollectionRAT",
                "Concealment Troy",
                "Contopee",
                "CookieTime",
                "Cyruslish",
                "DAVESHELL",
                "DBLL Dropper",
                "DLRAT",
                "DRATzarus",
                "DRATzarus RAT",
                "Dacls",
                "Dacls RAT",
                "DarkComet",
                "DarkKomet",
                "DeltaCharlie",
                "DeltaNC",
                "Dembr",
                "Destover",
                "DoublePulsar",
                "Dozer",
                "Dtrack",
                "Duuzer",
                "DyePack",
                "ECCENTRICBANDWAGON",
                "ELECTRICFISH",
                "Escad",
                "EternalBlue",
                "FALLCHILL",
                "FYNLOS",
                "FallChill RAT",
                "Farfli",
                "Fimlis",
                "FoggyBrass",
                "FudModule",
                "Fynloski",
                "Gh0st RAT",
                "Ghost RAT",
                "Gopuram",
                "HARDRAIN",
                "HIDDEN COBRA RAT/Worm",
                "HLOADER",
                "HOOKSHOT",
                "HOPLIGHT",
                "HOTCROISSANT",
                "HOTWAX",
                "HTTP Troy",
                "Hawup",
                "Hawup RAT",
                "Hermes",
                "HotCroissant",
                "HotelAlfa",
                "Hotwax",
                "HtDnDownLoader",
                "Http Dr0pper",
                "ICONICSTEALER",
                "Joanap",
                "Jokra",
                "KANDYKORN",
                "KEYMARBLE",
                "Kaos",
                "KillDisk",
                "KillMBR",
                "Koredos",
                "Krademok",
                "LIGHTSHIFT",
                "LIGHTSHOW",
                "LOLBAS",
                "LOLBins",
                "Lazarus",
                "LightlessCan",
                "Living off the Land",
                "MATA",
                "MBRkiller",
                "MagicRAT",
                "Manuscrypt",
                "Mimail",
                "Mimikatz",
                "Moudour",
                "Mydoom",
                "Mydoor",
                "Mytob",
                "NACHOCHEESE",
                "NachoCheese",
                "NestEgg",
                "NickelLoader",
                "NineRAT",
                "Novarg",
                "NukeSped",
                "OpBlockBuster",
                "PCRat",
                "PEBBLEDASH",
                "PLANKWALK",
                "POOLRAT",
                "PSLogger",
                "PhanDoor",
                "Plink",
                "PondRAT",
                "PowerBrace",
                "PowerRatankba",
                "PowerShell RAT",
                "PowerSpritz",
                "PowerTask",
                "Preft",
                "ProcDump",
                "Proxysvc",
                "PuTTY Link",
                "QUICKRIDE",
                "QUICKRIDE.POWER",
                "Quickcafe",
                "QuiteRAT",
                "R-C1",
                "ROptimizer",
                "Ratabanka",
                "RatabankaPOS",
                "Ratankba",
                "RatankbaPOS",
                "RawDisk",
                "RedShawl",
                "Rifdoor",
                "Rising Sun",
                "Romeo-CoreOne",
                "RomeoAlfa",
                "RomeoBravo",
                "RomeoCharlie",
                "RomeoCore",
                "RomeoDelta",
                "RomeoEcho",
                "RomeoFoxtrot",
                "RomeoGolf",
                "RomeoHotel",
                "RomeoMike",
                "RomeoNovember",
                "RomeoWhiskey",
                "Romeos",
                "RustBucket",
                "SHADYCAT",
                "SHARPKNOT",
                "SIGFLIP",
                "SIMPLESEA",
                "SLICKSHOES",
                "SORRYBRUTE",
                "SUDDENICON",
                "SUGARLOADER",
                "SheepRAT",
                "SierraAlfa",
                "SierraBravo",
                "SierraCharlie",
                "SierraJuliett-MikeOne",
                "SierraJuliett-MikeTwo",
                "SimpleTea",
                "SimplexTea",
                "SmallTiger",
                "Stunnel",
                "TAINTEDSCRIBE",
                "TAXHAUL",
                "TFlower",
                "TOUCHKEY",
                "TOUCHMOVE",
                "TOUCHSHIFT",
                "TOUCHSHOT",
                "TWOPENCE",
                "TYPEFRAME",
                "Tdrop",
                "Tdrop2",
                "ThreatNeedle",
                "Tiger RAT",
                "TigerRAT",
                "Trojan Manuscript",
                "Troy",
                "TroyRAT",
                "VEILEDSIGNAL",
                "VHD",
                "VHD Ransomware",
                "VIVACIOUSGIFT",
                "VSingle",
                "ValeforBeta",
                "Volgmer",
                "Vyveva",
                "W1_RAT",
                "Wana Decrypt0r",
                "WanaCry",
                "WanaCrypt",
                "WanaCrypt0r",
                "WannaCry",
                "WannaCrypt",
                "WannaCryptor",
                "WbBot",
                "Wcry",
                "Win32/KillDisk.NBB",
                "Win32/KillDisk.NBC",
                "Win32/KillDisk.NBD",
                "Win32/KillDisk.NBH",
                "Win32/KillDisk.NBI",
                "WinorDLL64",
                "Winsec",
                "WolfRAT",
                "Wormhole",
                "YamaBot",
                "Yort",
                "ZetaNile",
                "concealment_troy",
                "http_troy",
                "httpdr0pper",
                "httpdropper",
                "klovbot",
                "sRDI"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535560,
    "ts_updated_at": 1743041843,
    "ts_creation_date": 1653764833,
    "ts_modification_date": 1653764833,
    "files": {
        "pdf": "https://archive.orkl.eu/7371abcd7e40ef2149ae71453c1090176bcfd192.pdf",
        "text": "https://archive.orkl.eu/7371abcd7e40ef2149ae71453c1090176bcfd192.txt",
        "img": "https://archive.orkl.eu/7371abcd7e40ef2149ae71453c1090176bcfd192.jpg"
    }
}