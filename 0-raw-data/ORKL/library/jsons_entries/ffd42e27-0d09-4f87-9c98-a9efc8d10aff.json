{
    "id": "ffd42e27-0d09-4f87-9c98-a9efc8d10aff",
    "created_at": "2023-01-12T15:07:01.66259Z",
    "updated_at": "2025-03-27T02:15:35.453866Z",
    "deleted_at": null,
    "sha1_hash": "afee85333976d02cf0fe1e5b1a2d973283a0121d",
    "title": "2022-07-21 - The Return of Candiru- Zero-days in the Middle East",
    "authors": "",
    "file_creation_date": "2022-08-18T03:32:28Z",
    "file_modification_date": "2022-08-18T03:32:28Z",
    "file_size": 702031,
    "plain_text": "# The Return of Candiru: Zero-days in the Middle East\n\n**[decoded.avast.io/janvojtesek/the-return-of-candiru-zero-days-in-the-middle-east/](https://decoded.avast.io/janvojtesek/the-return-of-candiru-zero-days-in-the-middle-east/)**\n\nby [Jan VojtěšekJuly 21, 20226 min read](https://decoded.avast.io/author/janvojtesek/)\n\n\nJuly 21, 2022\n\n\nWe recently discovered a zero-day vulnerability in Google Chrome ( CVE-2022-2294 ) when it was\nexploited in the wild in an attempt to attack Avast users in the Middle East. Specifically, a large portion\nof the attacks took place in Lebanon, where journalists were among the targeted parties.\n\nThe vulnerability was a memory corruption in WebRTC that was abused to achieve shellcode\n[execution in Chrome’s renderer process. We reported this vulnerability to Google, who patched it on](https://chromereleases.googleblog.com/2022/07/stable-channel-update-for-desktop.html)\nJuly 4, 2022.\n\nBased on the malware and TTPs used to carry out the attack, we can confidently attribute it to a\nsecretive spyware vendor of many names, most commonly known as Candiru. (A name the threat\n[actors chose themselves, inspired by a horrifying parasitic fish of the same name.)](https://en.wikipedia.org/wiki/Candiru_(fish))\n\n[After Candiru was exposed by Microsoft and](https://www.microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/) [CitizenLab in July 2021, it laid low for months, most likely](https://citizenlab.ca/2021/07/hooking-candiru-another-mercenary-spyware-vendor-comes-into-focus/)\ntaking its time to update its malware to evade existing detection. We’ve seen it return with an updated\ntoolset in March 2022, targeting Avast users located in Lebanon, Turkey, Yemen, and Palestine via\nwatering hole attacks using zero-day exploits for Google Chrome. We believe the attacks were highly\ntargeted.\n\n## Exploit Delivery and Protection\n\nThere were multiple attack campaigns, each delivering the exploit to the victims in its own way.\n\nIn Lebanon, the attackers seem to have compromised a website used by employees of a news agency.\nWe can’t say for sure what the attackers might have been after, however often the reason why\nattackers go after journalists is to spy on them and the stories they’re working on directly, or to get to\ntheir sources and gather compromising information and sensitive data they shared with the press.\n\nInterestingly, the compromised website contained artifacts of persistent XSS attacks, with there being\npages that contained calls to the Javascript function `alert along with keywords like` `test . We`\nsuppose that this is how the attackers tested the XSS vulnerability, before ultimately exploiting it for\nreal by injecting a piece of code that loads malicious Javascript from an attacker-controlled domain.\nThis injected code was then responsible for routing the intended victims (and only the intended victims)\nto the exploit server, through several other attacker-controlled domains.\n\nThe malicious code injected into the compromised website, loading further Javascript from\n```\nstylishblock[.]com\n\n```\nOnce the victim gets to the exploit server, Candiru gathers more information. A profile of the victim’s\nbrowser, consisting of about 50 data points, is collected and sent to the attackers. The collected\ninformation includes the victim’s language, timezone, screen information, device type, browser plugins,\n\n\n-----\n\nreferrer, device memory, cookie functionality, and more. We suppose this was done to further protect\nthe exploit and make sure that it only gets delivered to the targeted victims. If the collected data\nsatisfies the exploit server, it uses RSA-2048 to exchange an encryption key with the victim. This\nencryption key is used with AES-256-CBC to establish an encrypted channel through which the zeroday exploits get delivered to the victim. This encrypted channel is set up on top of TLS, effectively\nhiding the exploits even from those who would be decrypting the TLS session in order to capture\nplaintext HTTP traffic.\n\n## Exploits and Vulnerabilities\n\nWe managed to capture a zero-day exploit that abused a heap buffer overflow in WebRTC to achieve\nshellcode execution inside a renderer process. This zero-day was chained with a sandbox escape\nexploit, which was unfortunately further protected and we were not able to recover it. We extracted a\nPoC from the renderer exploit and sent it to Google’s security team. They fixed the vulnerability,\n[assigning it CVE-2022-2294 and releasing a patch in Chrome version](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-2294) `103.0.5060.114 (Stable`\nchannel).\n\nWhile the exploit was specifically designed for Chrome on Windows, the vulnerability’s potential was\nmuch wider. Since the root cause was located in WebRTC, the vulnerability affected not only other\nChromium-based browsers (like Microsoft Edge) but also different browsers like Apple’s Safari. We do\nnot know if Candiru developed exploits other than the one targeting Chrome on Windows, but it’s\n[possible that they did. Our Avast Secure Browser was patched on July 5. Microsoft adopted the](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-2294)\n[Chromium patch on July 6, while Apple released a patch for Safari on July 20. We encourage all other](https://support.apple.com/en-us/HT213341)\nWebRTC integrators to patch as soon as possible.\n\n[At the end of the exploit chain, the malicious payload (called DevilsTongue, a full-blown spyware)](https://www.microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/)\nattempts to get into the kernel using another zero-day exploit. This time, it is targeting a legitimate\nsigned kernel driver in a [BYOVD (Bring Your Own Vulnerable Driver) fashion. Note that for the driver to](https://www.eset.com/int/about/newsroom/press-releases/research/esets-research-into-bring-your-own-vulnerable-driver-details-attacks-on-drivers-in-windows-core-1/)\nbe exploited, it has to be first dropped to the filesystem (Candiru used the path\n```\nC:\\Windows\\System32\\drivers\\HW.sys ) and loaded, which represents a good detection\n\n```\nopportunity.\n\nThe driver is exploited through IOCTL requests. In particular, there are two vulnerable IOCTLs:\n```\n0x9C40648C can be abused for reading physical memory and 0x9C40A4CC for writing physical\n\n```\nmemory. We reported this to the driver’s developer, who acknowledged the vulnerability and claimed to\nbe working on a patch. Unfortunately, the patch will not stop the attackers, since they can just continue\nto exploit the older, unpatched driver. We are also discussing a possible revocation, but that would not\nbe a silver bullet either, because Windows doesn’t always check the driver’s revocation status. Driver\nblocklisting seems to be the best solution for now.\n\n\n-----\n\nOne of the vulnerable ioctl handlers\nWhile there is no way for us to know for certain whether or not the WebRTC vulnerability was exploited\nby other groups as well, it is a possibility. Sometimes zero-days get independently discovered by\nmultiple groups, sometimes someone sells the same vulnerability/exploit to multiple groups, etc. But\nwe have no indication that there is another group exploiting this same zero-day.\n\nBecause Google was fast to patch the vulnerability on July 4, Chrome users simply need to click the\nbutton when the browser prompts them to “restart to finish applying the update.” The same procedure\nshould be followed by users of most other Chromium-based browsers, including Avast Secure\nBrowser. Safari users should update to version `15.6 .`\n\n## Indicators of Compromise (IoCs)\n\nInfrastructure\n\nDomains\n\n\n-----\n\n```\nwebs-update[.]com\n\n```\n\nFilesystem\n\nDevilsTongue paths\n\n```\nC:\\Windows\\System32\\drivers\\HW.sys.dat\n\n```\n\nAll `.dll files might also appear with an additional` `.inf extension (e.g.`\n```\nC:\\Windows\\System32\\migration\\netiopmig.dll.inf )\n\n```\n[Hijacked CLSIDs (persistence mechanism)](https://attack.mitre.org/techniques/T1546/015/)\n\n\n-----\n\nRegistry keys Legitimate default values\n\n```\n HKEY_LOCAL_MACHINE\\SOFTWARE\\Classes\\CLSID\\\n {4590F811-1D3A-11D0-891F 00AA004B2E24}\\InprocServer32\n HKEY_LOCAL_MACHINE\\SOFTWARE\\Classes\\CLSID\\\n {4FA18276-912A-11D1-AD9B 00C04FD8FDFF}\\InprocServer32\n HKEY_LOCAL_MACHINE\\SOFTWARE\\Classes\\CLSID\\\n {7C857801-7381-11CF-884D 00AA004B2E24}\\InProcServer32\n HKEY_LOCAL_MACHINE\\SOFTWARE\\Classes\\CLSID\\\n {CF4CC405-E2C5-4DDD-B3CE 5E7582D8C9FA}\\InprocServer32\n\n```\n[IoCs are also available in our IoC repository.](https://github.com/avast/ioc/tree/master/Candiru)\n\n```\n%systemroot%\\system32\\wbem\\wbemprox.dll\n\n```\n```\n%systemroot%\\system32\\wbem\\wbemcore.dll\n\n```\n```\n%systemroot%\\system32\\wbem\\wbemsvc.dll\n\n```\n```\n%systemroot%\\system32\\wbem\\wmiutils.dll\n\n```\n\n[Tagged asCandiru,](https://decoded.avast.io/tag/candiru/) [CVE-2022-2294,](https://decoded.avast.io/tag/cve-2022-2294/) [exploit,](https://decoded.avast.io/tag/exploit/) [Google Chrome,](https://decoded.avast.io/tag/google-chrome/) [zero-day](https://decoded.avast.io/tag/zero-day/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-07-21 - The Return of Candiru- Zero-days in the Middle East.pdf"
    ],
    "report_names": [
        "2022-07-21 - The Return of Candiru- Zero-days in the Middle East.pdf"
    ],
    "threat_actors": [
        {
            "id": "9f101d9c-05ea-48b9-b6f1-168cd6d06d12",
            "created_at": "2023-01-06T13:46:39.396409Z",
            "updated_at": "2025-03-27T02:00:03.074969Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "CHROMIUM",
                "ControlX",
                "Red Dev 10",
                "RedHotel",
                "Red Scylla",
                "TAG-22",
                "BRONZE UNIVERSITY",
                "AQUATIC PANDA",
                "Charcoal Typhoon",
                "BountyGlad"
            ],
            "source_name": "MISPGALAXY:Earth Lusca",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "38f8da87-b4ba-474b-83e6-5b04d8fb384b",
            "created_at": "2024-02-02T02:00:04.032871Z",
            "updated_at": "2025-03-27T02:00:03.294203Z",
            "deleted_at": null,
            "main_name": "Caramel Tsunami",
            "aliases": [
                "SOURGUM",
                "Candiru"
            ],
            "source_name": "MISPGALAXY:Caramel Tsunami",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "6abcc917-035c-4e9b-a53f-eaee636749c3",
            "created_at": "2022-10-25T16:07:23.565337Z",
            "updated_at": "2025-03-27T02:02:09.868522Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Bronze University",
                "Charcoal Typhoon",
                "Chromium",
                "Red Dev 10",
                "Red Scylla"
            ],
            "source_name": "ETDA:Earth Lusca",
            "tools": [
                "Agentemis",
                "AntSword",
                "BIOPASS",
                "BIOPASS RAT",
                "BadPotato",
                "Behinder",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "Doraemon",
                "FRP",
                "Fast Reverse Proxy",
                "FunnySwitch",
                "HUC Port Banner Scanner",
                "KTLVdoor",
                "Mimikatz",
                "NBTscan",
                "POISONPLUG.SHADOW",
                "PipeMon",
                "RbDoor",
                "RibDoor",
                "RouterGod",
                "SAMRID",
                "ShadowPad Winnti",
                "SprySOCKS",
                "WinRAR",
                "Winnti",
                "XShellGhost",
                "cobeacon",
                "fscan",
                "lcx",
                "nbtscan"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "d53593c3-2819-4af3-bf16-0c39edc64920",
            "created_at": "2022-10-27T08:27:13.212301Z",
            "updated_at": "2025-03-27T02:00:55.529662Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Earth Lusca",
                "TAG-22",
                "Charcoal Typhoon",
                "CHROMIUM",
                "ControlX"
            ],
            "source_name": "MITRE:Earth Lusca",
            "tools": [
                "Mimikatz",
                "PowerSploit",
                "Tasklist",
                "certutil",
                "Cobalt Strike",
                "Winnti for Linux",
                "Nltest",
                "NBTscan",
                "ShadowPad"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673536021,
    "ts_updated_at": 1743041735,
    "ts_creation_date": 1660793548,
    "ts_modification_date": 1660793548,
    "files": {
        "pdf": "https://archive.orkl.eu/afee85333976d02cf0fe1e5b1a2d973283a0121d.pdf",
        "text": "https://archive.orkl.eu/afee85333976d02cf0fe1e5b1a2d973283a0121d.txt",
        "img": "https://archive.orkl.eu/afee85333976d02cf0fe1e5b1a2d973283a0121d.jpg"
    }
}