{
    "id": "e2437d15-3cd7-4e5b-bff7-31f21876a5d7",
    "created_at": "2023-01-12T15:02:13.582921Z",
    "updated_at": "2025-03-27T02:06:03.169244Z",
    "deleted_at": null,
    "sha1_hash": "e184521c9de3bb8d48efa3a0872dce4158700d39",
    "title": "2020-10-14 - FakeMBAM- Backdoor Delivered Through Software Updates",
    "authors": "",
    "file_creation_date": "2022-05-29T01:17:43Z",
    "file_modification_date": "2022-05-29T01:17:43Z",
    "file_size": 1829759,
    "plain_text": "# FakeMBAM: Backdoor delivered through software updates\n\n**[decoded.avast.io/janvojtesek/fakembam-backdoor-delivered-through-software-updates/](https://decoded.avast.io/janvojtesek/fakembam-backdoor-delivered-through-software-updates/)**\n\nOctober 14, 2020\n\nby [Jan VojtěšekOctober 14, 202022 min read](https://decoded.avast.io/author/janvojtesek/)\n\nMany applications can be updated automatically and without any user interaction. This is commonly\nconsidered a good practice from the security point of view, since it allows for quick distribution of\npatches for critical vulnerabilities. However, automatic updates also carry an additional risk because\nthey allow the software developers to push arbitrary code to users’ machines. Unfortunately, users\noften have no choice but to trust the developers that they will only use the update channel for its\nintended purpose and that they will protect it from malicious third parties.\n\nIn this blog post, we’ll show that this trust might sometimes be misplaced. Specifically, we’ll show how\none torrent client and three adblockers surreptitiously installed the FakeMBAM backdoor through\nautomatic updates. We reverse engineered this backdoor and describe its inner workings in the\nsecond part of this post.\n\n## An unexpected infection vector\n\n[We recently reported on a fake Malwarebytes installer that we detected on over 100,000 machines](https://blog.avast.com/fake-malwarebytes-installation-files-distributing-coinminer)\nprotected by Avast. This installer attempted to pass itself off as the legitimate Malwarebytes installer,\nmimicking it to a great extent – it was distributed under the same filename, it used the same icon and it\ncreated a Malwarebytes installation directory containing legitimate PE files digitally signed by\nMalwarebytes. However, that was all just a pretense, because the installer did not actually install\nMalwarebytes. In fact, the installer’s main purpose was to open a backdoor to attacker-controlled\nservers in order to give its operators the ability to push additional malicious payloads to the infected\nmachines.\n\n\n-----\n\nA map illustrating the distribution of Avast users protected from the FakeMBAM backdoor. The\nbackdoor is most active in Russia, Ukraine and Kazakhstan.\nIn our first report, we stated that we did not know how this fake installer was being distributed. Since\nthen, we spent some time reverse engineering the malware and investigating its infection vector. We\nfound that the fake installer was pushed to the victims’ machines through automatic updates of one\ntorrent client ( download[.]studio ) and three adblockers ( netshieldkit[.]com,\n```\nmyadblock[.]com and netadblock[.]com ). Listed on the websites of these applications are three\n\n```\ndifferent companies that are supposedly behind these applications, “Sigma Software”, “GRAND\nMEDIA, TOV” and “Birmon Software”. However, based on high code similarities and shared\ninfrastructure (and on the fact that they all distributed the very same piece of malware), we consider it\nvery likely that there is one actor behind all four applications.\n\n### Download Studio\n\nTo investigate the infection vector used to distribute the fake installer, we first turned to the metadata\nthat was submitted to us when we detected the installer in the wild. This provided us with two\nimportant clues: The installers were supposed to be executed with the command line arguments `/SP-`\n```\n/VERYSILENT /SUPPRESSMSGBOXES /NORESTART /NOCANCEL /NOICONS, by a process named\ndstudio-gui.exe . The first clue suggested that the installer was not supposed to be spread through\n\n```\nsocial engineering, because the above arguments instruct Inno Setup to install software silently in the\nbackground. The second clue hinted at the possible suspect: Download Studio.\n\n\n-----\n\nA screenshot of the Download Studio product page.\nDownload Studio is a free torrent client popular in Russia and Ukraine. It features an embedded library\nof torrent files, offering a wide selection of movies, software, video games, music and more. As is\nusually the case with torrent downloaders, there is a lot of copyrighted material that can be easily\ndownloaded for free using this software, which seems to be the main reason why it is so widespread.\nDownload Studio is detected by some anti-malware software as a potentially unwanted program (PUP)\nor as riskware, because it encourages illegal behavior and puts its users at risk through downloading\ntorrents of unknown origin.\n\n\n-----\n\nA screenshot of Download Studio’s movie library.\nTo clear up some potential confusion, let us state that there is also another piece of software named\n[Download Studio: a download manager developed by Conceiva. Apart from the name, this software](http://www.conceiva.com/products/downloadstudio/default.asp)\nhas nothing in common with the torrent client described in this blog post and there is therefore no\nreason to doubt its legitimacy. In the rest of this blog post, the name Download Studio will denote the\ntorrent client described in the previous paragraph.\n\nSince Download Studio can be used to download various software, it would make sense to think that\nthe fake Malwarebytes installer was distributed through it as a regular torrent file (after all there were\n609 results when we searched for “Malwarebytes” inside Download Studio). However, that would not\nexplain the command line arguments that we observed in the wild. They simply indicated that running\nthe installer was not a user-initiated action and that the user might not have been aware of the installer\nat all. Furthermore, the number of users that we protected from the fake installer matched our\nestimates of the number of Avast users running Download Studio, which made it look like Download\nStudio itself was somehow responsible. Therefore, we decided to reverse engineer it to see if it\ncontained hidden malicious code.\n\nWe immediately found some evident code similarities with the FakeMBAM backdoor. Both Download\nStudio and the backdoor were developed using the Qt framework and they both used the very same\nstring obfuscation methods. One of the obfuscation methods was particularly interesting, because it\nwas not very effective at, well, obfuscation. It consisted of XORing the obfuscated string twice with the\nsame mask, so the plaintext was clearly visible in the disassembly.\n\n\n-----\n\n-----\n\nObfuscation of the string `.tmp as seen in Download Studio (left) and in the FakeMBAM backdoor`\n(right).\nOther code similarities were found in a piece of code that computed HMAC of custom HTTP headers\nor in a piece of code that created scheduled tasks using the `ITaskService` COM interface. We also\nfound that Download Studio contained a string with the exact command line arguments that we\nmentioned earlier. These arguments were used to execute application updates silently in the\nbackground. By reverse engineering Download Studio, we also found that the application updates are\nsupposed to be executed from a temporary directory the name of which can be described by the\nregular expression `ds-\\d{7}\\.tmp, which further matched our metadata from detections of the fake`\ninstaller.\n\nDisassembled snippet of Download Studio, showing the code responsible for execution of automatic\nupdates.\nAt this point, it seemed almost certain that the backdoor was distributed through the automatic updates\nof Download Studio. However, we wanted to be absolutely sure that this was the case, so we\nmonitored the updates and logged the filename and hash of each observed update. This gave us the\nfollowing list:\n\n\n-----\n\nSHA-256 filename\n```\n 16d0559067f3cc0ab19e22b935ac90d44897f09f3426f858498dfd7e667c4bda updater.exe\n 1d77fdc7f1b1efc8bdb0938cacc713baa70a2549412ce0be18adf2ebd133cb70 updater                                         full.exe\n 333dd34d3efc4ded71b36f5fc38bce67de71f80b7fab43358a36e8ba7d4df0f0 updater.exe\n 5822d2b9717cc2a87ba54173587a3808e17f5961f42f5b1702c4a75950ecd4f6 updater.exe\n 6754c5e7d3c03f4e2bf29b013b1a0d532b7f4e8e145da82e6973376785938f65 DS-updater                                         1.8.0.0                                         full.exe\n 9c112b452ce839536a5cd4a3d8f4999adcb03dc3af5cbd86ca3a477c5b75127b updater.exe\n b1acc87c7b010f4aafbe03cd70a6452679de07ef31bc2d5701de63d573654615 updater.exe\n b3359c92cd87bd39ecbf8159666f2c7e123903751654bb8aefd714e23f8e7f7f updater.exe\n b4039b6a15af681d7c02d1ff798f41023a378668b32132761c8cdffd648a5a5d DS-updater                                         1.8.0.0.exe\n c759c6fffe3d32424f8b29b58ee5cb11d68be5f27e50ba1d1a4755fb56602f7d updater.exe\n dfb1a78be311216cd0aa5cb78759875cd7a2eeb5cc04a8abc38ba340145f72b9 MBSetup.exe\n f2caa14fd11685ba28068ea79e58bf0b140379b65921896e227a0c7db30a0f2c MBSetup.exe\n\n```\nJust based on the filenames alone, the last two entries immediately stand out. Indeed, while all the\nprevious entries correspond to legitimate updates of Download Studio, the last two hashes are the\nfake Malwarebytes installers that we have been investigating. They were executed in the same way as\nall the other automatic updates, silently in the background and without the users’ awareness.\n\nThis means that someone tried to infect all users of Download Studio with the FakeMBAM backdoor.\nWhile we do not know precisely what happened behind the scenes, there are three possible scenarios\nthat come to mind. The first one would be that the developers of Download Studio wished to\n“monetize” their large install base in a very unethical way. Code reuse between Download Studio and\nthe FakeMBAM backdoor would suggest that this could be the case. Another explanation is that the\nbackdoor was spread by a group of rogue employees who acted without the knowledge of the rest of\nthe company. Finally, it is also possible that some unknown attacker hacked Download Studio and\ncarried out a successful supply chain attack.\n\nWe were looking for some answers and so we reached out to the developers of Download Studio,\nasking about the backdoor. They claimed that they detected a security incident on their continuous\nintegration server in August 2020 and that they have since thoroughly investigated this incident and\nput additional security measures in place. They did not respond to our additional inquiries about how\nmany of their users could be impacted by this incident and if they notified the impacted users.\n\n### Adblockers\n\nDownload Studio was not the only software that distributed the FakeMBAM backdoor. We also found\nthree adblockers whose automatic updates were abused in the same fashion. These adblockers are\nNetShield Kit ( netshieldkit[.]com ), My AdBlock ( myadblock[.]com ) and Net AdBlock\n\n\n-----\n\n( netadblock[.]com ).\n\nA screenshot of the NetShield Kit product page.\nWhile these adblockers are being advertised as three different products, they are almost the same\nunder the hood. The ad blocking itself is implemented in Golang, using the open-source adblock\npackage. The websites offering downloads of the individual adblockers also look very similar and are\neven hosted from the same IP address ( 62.112.11[.]43 ). It seems like two more adblockers might\nbe launched in the future, since `adblockpro[.]net and` `adblockfree[.]com also resolve to this`\nIP address.\n\n\n-----\n\nDomain names corresponding to all three adblockers resolve to the same IP address.\nWe also identified code similarities between the adblockers and Download Studio, which suggests that\nthey were developed by the same group. What’s more, some installers of Download Studio also\npresent an opt-out offer to install My AdBlock.\n\n\n-----\n\nAn installer for Download\n\nStudio that offers the installation of My AdBlock.\nSame as with Download Studio, we do not know if the primary purpose of these adblockers is to\nspread malware. But if this is a supply chain attack or an action of rogue employees, it would be hard\nto explain why the domain `bitminer[.]tech (which hosted XMRig-based coinminers not unlike the`\nones distributed by the FakeMBAM backdoor) used to resolve to the same IP address as the websites\nof these adblockers. Also very suspicious-looking is the FAQ section on the NetShield Kit website.\n\nA screenshot of the FAQ section from the NetShield Kit website.\nThere might be another “catch” that is not mentioned in this answer.\n\n## Analysis of the FakeMBAM backdoor\n\nNow that we’ve shown how the fake Malwarebytes installer is delivered to its victims, let’s examine\nwhat it actually does. When the malicious installer is executed, it creates a fake Malwarebytes\ninstallation directory where it hides the FakeMBAM backdoor. This directory is made to look identical to\nthe legitimate Malwarebytes installation directory, the only difference being one added malicious DLL\nfile, one maliciously modified DLL file and a new `data.pak file containing random-looking data.`\n\n\n-----\n\nComparison of a legitimate Malwarebytes installation directory with the fake installation directory\ncreated by the malware.\nEven though the fake installer is supposed to be executed silently in the background, the malware\nauthors still tried to make it appear as if it is the legitimate Malwarebytes installer, in an attempt to fool\nanyone who would actually analyze it. However, there are still some noticeable differences. First of all,\nunlike the legitimate installer, the fake installer is not digitally signed. The fake installer was also\ncreated using Inno Setup, which makes it look different than the legitimate Malwarebytes installer. The\ndefault installation directory varies slightly as well. While the fake installer installs itself into\n```\n%ProgramFiles%\\Malwarebytes (or %ProgramFiles(x86)%\\Malwarebytes on 64-bit Windows),\n\n```\nthe legitimate Malwarebytes usually gets installed to `%ProgramFiles%\\Malwarebytes\\Anti-`\n```\nMalware\\ . This distinction was probably introduced deliberately by the malware authors, who wanted\n\n```\nto avoid a clash between the malware and the legitimate Malwarebytes.\n\n\n-----\n\nThe setup wizard (left) has the typical Inno Setup look, which makes it look different than the legitimate\nMalwarebytes installer (right).\nPacked inside the fake installer are all the usual PE files that one would expect in a Malwarebytes\ninstallation directory. All of those except for the two malicious DLLs are validly signed by either\nMalwarebytes or Microsoft. The first of the two malicious DLL files is called `Qt5WinExtras.dll . As`\nthe name suggests, it is part of the [Qt framework and a DLL with the same name can also be found in](https://www.qt.io/)\na legitimate Malwarebytes installation. This malicious DLL file looks almost the same as the legitimate\n\n\n-----\n\n```\nQt5WinExtras.dll, the only important difference is in the function\nsetCurrentProcessExplicitAppUserModelID, where the malware authors inserted a call to a\n\n```\nfunction exported from `Qt5Help.dll .`\n\nBindiff between the legitimate and backdoored `Qt5WinExtras.dll . 1793 out of 1795 functions are`\nperfect matches.\n```\nQt5Help.dll is the other malicious DLL file. Unlike Qt5WinExtras.dll, a file named\nQt5Help.dll cannot be found in a legitimate Malwarebytes installation directory. This DLL file was\n\n```\nadded by the cybercriminals and it implements the actual backdoor functionality. Note that the main\nMalwarebytes executable, `mbam.exe, imports` `Qt5WinExtras.dll and calls the exported function`\n```\nsetCurrentProcessExplicitAppUserModelID . As described above, Qt5WinExtras.dll in turn\n\n```\nimports `Qt5Help.dll and calls a function that exposes the malicious functionality. This means that`\nrunning the legitimate `mbam.exe executable while having these two DLL files planted in the same`\ndirectory will inevitably pass the control flow to the FakeMBAM backdoor that’s hidden in\n```\nQt5Help.dll .\n\n```\nThe installation process of Inno Setup executables is guided by their setup scripts. These scripts are\ncompiled inside the installers, but they can be extracted and decompiled. The script embedded in the\nfake Malwarebytes installer is relatively simple. First, it copies all the files that are packed inside the\ninstaller into the installation directory. Then, it creates some registry values, among others\n```\nHKLM\\SOFTWARE\\Malwarebytes\\LicenseKey, where a random-looking hexadecimal string gets\n\n```\nstored. As we’ll see later, this string is read by `Qt5Help.dll and it contains the malware’s initial`\nconfiguration, in an encrypted form. Next, `mbam.exe is added to the Windows Firewall’s exclusions.`\nFinally, `mbam.exe gets executed with the command line argument` `/install . As was already`\nmentioned, this is the legitimate `mbam.exe, digitally signed by Malwarebytes. Due to the way the`\nmalicious DLL files have been planted in the same directory, it will inevitably load and execute the\nmain malicious payload, which is hidden inside `Qt5Help.dll .`\n\nA snippet taken from the fake installer’s Inno setup script.\n\n### Qt5Help.dll\n```\nQt5Help.dll is responsible for the backdoor’s persistence, configuration updates and delivery of\n\n```\nadditional payloads. It was developed using the Qt framework and it uses functionality provided by the\nframework for cryptographic operations, as well as for interaction with the underlying operating system.\n\n\n-----\n\nOnly basic obfuscation is used – most noticeable are encrypted strings, which get constructed on the\nstack and are decrypted at run-time using elementary obfuscation methods, such as a simple XOR\ncipher with a one-byte key.\n\nAn obfuscated string that is\n\nconstructed on the stack, encrypted with a simple XOR cipher.\nSpecific actions performed by `Qt5Help.dll are determined by the command line arguments. If the`\ncurrent process was spawned with the `/install argument,` `Qt5Help.dll will create a new service`\ndesigned to automatically start `mbam.exe during system startup. If` `/remove,` `/start or` `/stop`\nwere passed on the command line, this service will get deleted, started or stopped, respectively.\n\nIf there are no command line arguments, `Qt5Help.dll assumes that it is already being executed in`\na service process and calls `StartServiceCtrlDispatcher . As mentioned above, the Inno Setup`\nscript initially executes `mbam.exe with the` `/install command line argument. This installs the`\nservice and immediately starts it. The service name of the newly created malicious service is\n```\nMBAMSvc and the display name is Malwarebytes Service . The legitimate Malwarebytes service is\n\n```\nnamed `MBAMService, so this can be seen as yet another attempt to mimic Malwarebytes without`\nactually choosing a conflicting service name.\n\nDecompiled\n\nsnippet of `Qt5Help.dll showing the creation of the malicious service.`\n\n\n-----\n\nWhen the malware is executed as a service, it enters an infinite loop where it polls the C&C server for\nconfiguration updates. The malware’s configuration is saved as an encrypted hexadecimal string in the\nregistry, under `HKLM\\SOFTWARE\\Malwarebytes\\LicenseKey (or`\n```\nHKLM\\SOFTWARE\\Wow6432Node\\Malwarebytes\\LicenseKey on 64-bit Windows). The configuration\n\n```\ncan be decrypted using AES in CTR mode with the key `cefd8928fd7411b4c9cef7ec35cc827c and`\nthe IV `260743d9b464883ecc7f144bfa06e36d (as can be seen in this CyberChef recipe). The key`\nand IV are generated as MD5 digests of the hard-coded strings `MGZ_th#l}`\n```\n{JmC^!:4525719127089151290 and ?0@1!elVN]9L.)2. respectively, which means that they are\n\n```\nthe same for all victims.\n\nRegistry values created by the backdoor in `HKLM\\SOFTWARE\\Malwarebytes .`\nConfiguration updates are performed via HTTP GET requests using custom HTTP headers. The\nmalware makes requests containing the `X-Build-ID and` `X-Build-Sign headers, where` `X-`\n```\nBuild-ID is set to the malware’s build number concatenated with the MD5 hexadecimal digest of the\n\n```\nencrypted payload configuration (will be described later) and `X-Build-Sign is set to the` HMACSHA256 authentication code of the X-Build-ID header computed using the hard-coded key\n```\nJXaZy7brRJ . The C&C server checks the HMAC’s validity and returns the 404 (Not Found)\n\n```\nresponse code if it is invalid. Otherwise, if the signature is valid, the C&C server responds with the\n```\n204 (No Content) status code. However, this doesn’t mean that the C&C server does not send\n\n```\nback any data. It simply means that the response body is empty. The actual response from the C&C\nserver is encoded in the custom `X-Payload HTTP response header. When the malware sees such a`\nheader, it updates its configuration with the header’s decrypted content.\n\n\n-----\n\nFiddler capture of C&C\n\ncommunication. Note the `X-Payload response header, which contains the updated configuration.`\nThe decrypted configuration is a JSON string that contains up to five keys in the top-level object. The\nfollowing keys are supported by the malware:\n\nkey description\n\n`api` An array of C&C URLs that are regularly being queried for configuration updates.\n\n`params` The replacement for placeholders in the distributed malicious payloads (will be\nexplained later). This configuration parameter is currently only used so that the\nmalware can quickly rotate mining pool IP addresses without having to update the\nentire malicious payload.\n\n`refresh` The number of seconds the backdoor waits before querying the C&C server again. The\ndefault value is 7200 (two hours).\n\n`hash` This seems to be a hash of some part of the configuration. Unfortunately, we were not\nable to determine how this hash is computed, since it is generated by the C&C server\nand the malware itself does not verify it at all. The malware only compares this value\nwith the `hash of the previous configuration to see if there were any changes. Based`\non the observed length of the hash, this seems to be an MD5 digest.\n\n`extra` Extra malicious payloads to be downloaded. This is an array of three values: `url,`\n```\n       hash and arguments . Upon receiving a configuration containing this key, the\n\n```\nmalware downloads a file from `url, checks that its MD5 digest matches` `hash and if`\nit does, executes it while passing it `arguments on the command line.`\n\n\n-----\n\nAn example configuration distributed by\n\nthe C&C server.\n\n### Persistent payloads\n\nThe FakeMBAM backdoor might also drop some persistent payloads, which it will reinstall in regular\nintervals in case they get removed or terminated. So far, the only persistent payloads we have seen\nwere cryptocurrency miners, but the malware is able to handle multiple persistent payloads at the\nsame time, so other malicious payloads may be added in the future.\n\nPersistent payloads are stored encrypted in a file named `data.pak, located in the fake`\nMalwarebytes installation directory. Decryption can be performed using AES in CTR mode using the\nsame key and IV as for decrypting the configuration. When decrypted, the `data.pak file should start`\nwith the magic bytes `71 72 65 73 ( qres ), which identifies the file format: Qt binary resource. This`\nis basically a custom archive format that can be unpacked using API functions provided by the Qt\nframework.\n\nThe `data.pak archive always contains a file named` `config.json, which holds the payload`\nconfiguration. In the example `config.json shown below, there is only one payload, named` `app5 .`\nTo install this payload, the malware first extracts all the files from the `app5 directory in the`\n```\ndata.pak archive into payload['path'] ( C:\\ProgramData\\VMware\\VMware Tools\\ in this\n\n```\ncase). Then, it performs several setup actions based on the values of `payload['type'] and`\n```\npayload['pre'], which will be explained later. When all the setup actions are finished, the backdoor\n\n```\nexecutes the file specified as `payload['file'][0] while passing it` `payload['file'][1] on the`\ncommand line. For the example configuration shown below, the command line of\n```\n\"C:\\ProgramData\\VMware\\VMware Tools\\vm3dservice.exe\" /detach would get executed.\n\n```\n\n-----\n\nAn example payload configuration that\n\ndescribes a coinminer payload.\nThe third element of `payload['file'] specifies the method used to execute the payload. The`\nmalware can either run the payload directly by creating a new process, or it can create a one-time\nscheduled task that will execute the payload in one minute and automatically delete the task afterward.\nThe payload can also be executed either in the security context of the malicious service or with lower\nprivileges. To lower the privileges, the malware attempts to steal the access token of an active user\nand to execute the payload with the stolen token. There are several techniques used to steal the\ntoken, for example, using the API functions\n```\nWTSGetActiveConsoleSessionId / WTSEnumerateSessions together with WTSQueryUserToken or\n\n```\nusing `OpenProcessToken on the` `explorer.exe process. All in all, there are six methods in which`\nthe persistent payload can be executed:\n\nmethod description\n\n1 Execute the payload in a scheduled task using a stolen token and if that fails, fall back to\ndirect execution (also using a stolen token).\n\n2 Execute the payload in a scheduled task in the current security context and if that fails, fall\nback to direct execution (also in the current security context).\n\n\n-----\n\n3 Execute the payload in a scheduled task using a stolen token.\n\n4 Execute the payload directly using a stolen token.\n\n5 Execute the payload in a scheduled task in the current security context.\n\n6 Execute the payload directly in the current security context.\n\nThe `payload['type'] configuration parameter allows the malware to perform some custom actions`\nbased on the type of the payload. Currently, there is only one custom action specified and it is\nperformed only if `payload['type'] equals` `1 . If that is the case, the malware searches for a file`\nnamed `config.json inside the current persistent payload and replaces all occurrences of the`\nplaceholder `{params} with the value of` `params from the volatile configuration. This is used to`\nspecify the mining pool URL in the XMRig config file.\n\nXMRig’s `config.json file used by the malicious miner. Note the`\n```\n{params} placeholder, which will get substituted by the malware with a real mining pool URL.\n\n```\nThe final configuration parameter left to describe is `payload['pre'] . This is an array describing`\nvarious setup actions that the malware is going to perform before actually running the persistent\npayload. Each action is fully specified by its integer type and a string that should be interpreted in the\ncontext of the specific type. Currently, the malware supports three setup action types:\n\ntype description\n\n1 Terminate processes with the given name. Based on the configuration observed in the wild,\nthis is used to terminate previous instances of the persistent payload, not to terminate wellknown malware analysis tools.\n\n2 Delete a scheduled task with the given name using the `ITaskService COM interface.`\n\n3 Create a Windows Defender exclusion for the given filesystem path. The exclusion is added\nusing the `IGroupPolicyObject COM interface, by creating a new Group Policy Object that`\nmodifies `HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Exclusions\\Paths .`\n\n## Conclusion\n\n\n-----\n\nThis blog post reports how cybercriminals abused the update process of Download Studio and three\nadblockers in an attempt to deliver the FakeMBAM backdoor to hundreds of thousands of victims. It\nalso presents technical analysis of this backdoor, with special attention given to documenting how the\nmalware stores and protects its configuration and what the individual configuration parameters\nrepresent. This information should help incident responders deal with this piece of malware. The C&C\ncommunication protocol was also documented, which should help create network-based detection\nrules, as well as implement trackers that would monitor the C&C activity.\n\n### Indicators of Compromise\n\n[The full list of IoCs is available at https://github.com/avast/ioc/tree/master/FakeMBAM.](https://github.com/avast/ioc/tree/master/FakeMBAM)\n\nSHA-256 filename\n```\n 391817d625e14d6b5b0115b7215c07d9ef6612cccdb1d6891626fdd5609506bf Qt5Help.dll\n 02be0f263b95017caa20f0fed861d2126e81ec176d542cc7415074f48965f2e0 Qt5WinExtras.dll\n dfb1a78be311216cd0aa5cb78759875cd7a2eeb5cc04a8abc38ba340145f72b9 MBSetup2.exe\n f2caa14fd11685ba28068ea79e58bf0b140379b65921896e227a0c7db30a0f2c MBSetup.exe\n\n```\n**C&C URLs**\n\nURL\n\n```\nhttps://dq96vx43jmub5.cloudfront[.]net/get/data\n\n```\n\n**Download URLs**\n\nURL\n\n```\nhttp://dl.bytestech[.]dev/1/mbsetup.exe\n\n```\n```\nhttp://dl.bytestech[.]dev/2/mbsetup.exe\n\n```\n```\nhttp://dl.bytestech[.]dev/3/mbsetup.exe\n\n```\n```\nhttp://dl.bytestech[.]dev/mbsetup2.exe\n\n```\n\n-----\n\n```\nhttp://dl.cloudnetbytes[.]com/3/mbsetup.exe\n\n```\n\n**Miner payloads**\n\nSHA-256\n\n```\nc6a8623e74f5aad94d899770b4a2ac5ef111e557661e09e62efc1d9a3eb1201c\n\n```\n```\nfea67139bc724688d55e6a2fde8ff037b4bd24a5f2d2eb2ac822096a9c214ede\n\n```\n```\nb3755d85548cefc4f641dfb6af4ccc4b3586a9af0ade33cc4e646af15b4390e7\n\n```\n```\n7f7b6939ae77c40aa2d95f5bf1e6a0c5e68287cafcb3efb16932f88292301a4d\n\n```\n```\nc90899fcaab784f98981ce988ac73a72b0b1dbceb7824f72b8218cb5783c6791\n\n```\n```\na4447559249f3ce04be4c6d28fc15946cbb8513da76ba522f635bda6a60bedcc\n\n```\n```\n8536d573c4180f5df09f183b9434636127127b2134fbf5dced0360ec6d4ee772\n\n```\n```\n61b194c80b6c2d2c97920cd46dd62ced48a419a09179bae7de3a9cfa4305a830\n\n```\n```\n589377832b1f1e6be2bdbef1753f30e3907c89a680f7f327999d9a1b510aa4ae\n\n```\n```\nd7a06cba490da60cfbf6f120c33652393f7a1b9176170e57c6cc3649530fca6a\n\n```\n```\naf49b57c1fc4781a7a38457c0b4a595dbb6b5bd7bc4ccafe15fb6b8ae29e17f8\n\n```\n```\n55869621fb2321ab8c8684d10c49e50e6a0b131f215ac0bbfe7c398d08fbea34\n\n```\n```\nf761242dfa8cf57faaae2c659f450bcbdc3253134556141eb6e0e282fbd98aa1\n\n```\n```\n269e14bb368ef26f47416a8fcd7f556bece57f5b6113986dc733c2230efdf398\n\n```\n```\nbeb718a13ef88b2d7f2126226217e76ea773af609aeae870f55e8eb6ed4c497b\n\n```\n```\n70830ed1357efd6b373faeaa52701369e2ae7bf9ad74e2f9355b5499ecef1123\n\n```\n```\n277cb64e6cd1155c21f6f169d77036ea6e4a36288494f2dfc39d2e76191197d9\n\n```\n```\nf8288ecb42478dd37335669a956b4e1adb3400928e1ec440a24882163a9cbbe8\n\n```\n```\nedd918e7fe5dbb8e66464939c4a62132d5a3ba17d081c56f0a23beffb2c0ca0c\n\n```\n```\n4c36a69540ffb7ac3655170148fe9f358bf0fc926baa7ef96611a7688727f76f\n\n```\n```\n468968df636c3a3b7ef85b0ff528aeb403eaae7c943e4eebfbe5b98de19ff711\n\n```\n```\na10277ffaec4e691cb1fa51fd65d2b7e045b138b0689ad7f5e0b79d855822df6\n\n```\n\n**data.paks**\n\nSHA-256\n\n```\n3036593e424bd4628593131b445408ba6a4039ef08e2fcdda1558010cc39ef37\n\n```\n```\n43bcec1d5149d43afbb4439eb88f59dcdbf1de363828a022e4a0b6474440223c\n\n```\n```\n503e1b04708db7bf22935beee235965e503c370692904fb0c37344fd29696036\n\n```\n\n-----\n\n```\n624ae4069182064f1801beec52dee3195f15a306ccaaba4a798a5b1823fe0df8\n\n```\n```\n709e71ec3837520552e76c72796c6422a0713da88e227ac423d80e6f727c32a9\n\n```\n```\n7223641157529b6152503f4cf3cd2bbe358e325ebf0cef3b3930e058012c9de4\n\n```\n```\n768ceff0ddc67c5ea8858c6b1e80ddcac0907ded692efd33502c85eff370852a\n\n```\n```\n893b242669d076f2460a789f951611dc58ab73c47f7b582fe504d7ecd0d18f29\n\n```\n```\n931e705984f60011b18aa0c38fb18f2040b87233dd94b506e7f20e504da58b6d\n\n```\n```\n97e57ce2aded883a2eefc4a5cf60d162b98a3637abb2424e77083820c76422fa\n\n```\n```\n97f8cd6db13a4e17d1aa84ce8950c153156b50f2eb29f5e3cd1a4496f50e7e0a\n\n```\n```\n9734166814c8db737d472241e72bde437236da59a94d4991bb81589ce9271fad\n\n```\n\n**Private mining pool IP addresses**\n\nIP address\n\n\n-----\n\n**Registry**\n\nValue\n\n```\nHKLM\\SOFTWARE\\Wow6432Node\\Malwarebytes\\LicenseKey\n\n```\n```\nHKLM\\SOFTWARE\\Malwarebytes\\LicenseKey\n\n```\n\n[Tagged asanalysis,](https://decoded.avast.io/tag/analysis/) [backdoor,](https://decoded.avast.io/tag/backdoor/) [FakeMBAM,](https://decoded.avast.io/tag/fakembam/) [malware,](https://decoded.avast.io/tag/malware/) [torrent,](https://decoded.avast.io/tag/torrent/) [updates](https://decoded.avast.io/tag/updates/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-10-14 - FakeMBAM- Backdoor Delivered Through Software Updates.pdf"
    ],
    "report_names": [
        "2020-10-14 - FakeMBAM- Backdoor Delivered Through Software Updates.pdf"
    ],
    "threat_actors": [
        {
            "id": "529c1ae9-4579-4245-86a6-20f4563a695d",
            "created_at": "2022-10-25T16:07:23.702006Z",
            "updated_at": "2025-03-27T02:02:09.93109Z",
            "deleted_at": null,
            "main_name": "Hafnium",
            "aliases": [
                "Red Dev 13",
                "Silk Typhoon"
            ],
            "source_name": "ETDA:Hafnium",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "7c969685-459b-4c93-a788-74108eab6f47",
            "created_at": "2023-01-06T13:46:39.189751Z",
            "updated_at": "2025-03-27T02:00:03.017103Z",
            "deleted_at": null,
            "main_name": "HAFNIUM",
            "aliases": [
                "ATK233",
                "G0125",
                "Operation Exchange Marauder",
                "Red Dev 13",
                "Silk Typhoon"
            ],
            "source_name": "MISPGALAXY:HAFNIUM",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "2704d770-43b4-4bc4-8a5a-05df87416848",
            "created_at": "2022-10-25T15:50:23.306305Z",
            "updated_at": "2025-03-27T02:00:55.43633Z",
            "deleted_at": null,
            "main_name": "HAFNIUM",
            "aliases": [
                "HAFNIUM",
                "Operation Exchange Marauder",
                "Silk Typhoon"
            ],
            "source_name": "MITRE:HAFNIUM",
            "tools": [
                "Tarrask",
                "ASPXSpy",
                "Impacket",
                "PsExec",
                "China Chopper"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535733,
    "ts_updated_at": 1743041163,
    "ts_creation_date": 1653787063,
    "ts_modification_date": 1653787063,
    "files": {
        "pdf": "https://archive.orkl.eu/e184521c9de3bb8d48efa3a0872dce4158700d39.pdf",
        "text": "https://archive.orkl.eu/e184521c9de3bb8d48efa3a0872dce4158700d39.txt",
        "img": "https://archive.orkl.eu/e184521c9de3bb8d48efa3a0872dce4158700d39.jpg"
    }
}