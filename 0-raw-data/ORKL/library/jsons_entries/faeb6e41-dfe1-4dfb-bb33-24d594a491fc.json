{
    "id": "faeb6e41-dfe1-4dfb-bb33-24d594a491fc",
    "created_at": "2023-01-12T15:09:57.464526Z",
    "updated_at": "2025-03-27T02:09:29.993383Z",
    "deleted_at": null,
    "sha1_hash": "c3df48ffe6550f78e6ce051d7b820b7df351781a",
    "title": "2016-05-12 - Hancitor and Ruckguv Reappear, Updated and With Vawtrak On Deck",
    "authors": "",
    "file_creation_date": "2022-05-28T00:31:08Z",
    "file_modification_date": "2022-05-28T00:31:08Z",
    "file_size": 347015,
    "plain_text": "# Hancitor and Ruckguv Reappear, Updated and With Vawtrak On Deck\n\n**[proofpoint.com/us/threat-insight/post/hancitor-ruckguv-reappear](https://www.proofpoint.com/us/threat-insight/post/hancitor-ruckguv-reappear)**\n\nMay 12, 2016\n\n\n-----\n\n[Blog](https://www.proofpoint.com/us/blog)\n[Threat Insight](https://www.proofpoint.com/us/blog/threat-insight)\nHancitor and Ruckguv Reappear, Updated and With Vawtrak On Deck\n\n\n-----\n\nMay 12, 2016 Axel F, Matthew Mesa\n\n**Overview**\n\nProofpoint researchers have recently observed the re-emergence of two malware downloaders that\nhad largely disappeared for several months. Hancitor (also known as Tordal and Chanitor) and\nRuckguv have reappeared in campaigns distributing Pony and Vawtrak with significant updates and\nincreased functionality. We have also been tracking an actor experimenting with various loaders,\nproviding insights into these evolving components of malware ecosystems.\n\n**Hancitor Analysis**\n\nStarting on April 28, we observed one of the Vawtrak actors (using ID 80, 81, 82) utilizing an updated\nversion of the Hancitor downloader. The last time that we saw this downloader used by one of the\nVawtrak affiliates was April 2015, when it was downloading an older version of Vawtrak. We believe\nthis is the same actor now using the updated downloader.\n\nIn this case, the Hancitor loader is dropped by a macro in the Microsoft Word email attachment.\nHancitor, in turn, downloads a Pony module and Vawtrak.\n\n\n-----\n\n_Figure 1: Example email spreading Vawtrak on April 28th via new loader has subject “FW: debt fax_\n_from [company name]” and attachment 175415626.doc (random numbers)_\n\nIn the year since we last observed the downloader in Proofpoint data, Hancitor has been overhauled\nand updated. Notable changes and functionality include:\n\nA rewrite of the network communication protocol\nThe ability to download and execute a Pony DLL module (and perhaps any DLL) from within the\nHancitor process\n\nBefore this update, the Hancitor command-and-control (C&C) check-in (such as with sample MD5:\nf472c00abef3324460989972362458e1) used a pipe-separated POST data format such as “<GUID>|\n<BUILD>|<PCINFO>|<IP>”. The updated Hancitor submits similar information to the C&C, but in a\ndifferent format. Specifically, the new POST data format is\n“GUID=&BUILD=&INFO=&IP=&TYPE=1&WIN=”.\n\n\n-----\n\n_Figure 2: Example Hancitor C&C check-in_\n\n**Parameter** **Description**\n\nGUID A 19-digit identifier generated with the UuidCreate Windows API (in early versions of\nthe updated Hancitor) or derived from the output of GetAdaptersAddresses Windows\nAPI (latest version seen on May 10).\n\nBUILD A hardcoded 4-digit number that appears to represent the software version. These are\nnot updated in sequential order. Observed build numbers include 2804, and 0905\n\nINFO The info shows the computer name, account name, and domain in the “[computer\nname] @ [domain]\\[account]” format\n\nIP External IP address of the infected machine, determined from api.ipify[.]org\n\nTYPE Hardcoded value set to “1”\n\nWIN Windows major and minor versions, followed by the system architecture in the “[major].\n\n[minor] ([architecture])” format where architecture is x32 or x64.\n\n_Table 1: Explanation of the parameters submitted to the C&C server by the updated Hancitor_\n\nIn response to the infected client check-in, the C&C server can respond with a series of JSONformatted commands for the client to perform, formatted as shown in Figure 2. The meaning of each\ncommand is explained in Table 2.\n\n**Command** **Description**\n\n{r:[URL]} Download and run an executable from URL\n\n{u:} Unimplemented\n\n{d:} Terminate malware process and delete backing file\n\n{l:[URL]} Download module (DLL) from a URL, write it to current process memory, and execute it\n\n{n:} Nothing to do\n\n\n-----\n\n_Table 2: Commands sent by the C&C server_\n\nThe ability to download and execute a DLL module from within the Hancitor process is a new function\nof the updated malware. The DLL is downloaded to heap memory, written directly into the Hancitor\nprocess (using VirtualAllocEx and WriteProcessMemory) and executed from there using the\nCreateThread Windows API. Thus, the module is not written to the disk, and no files or persistence\nmechanisms are created for it. So far, we have observed only Pony downloaded as a module, but\nother DLLs could be loaded similarly.\n\n_Figure 3: Module DLL written to current process and executed from there_\n\n_Figure 4: Pseudocode shows Hancitor downloading a DLL module, writing it to current process_\n_memory, and executing it_\n\n**Ruckguv Analysis**\n\nOn May 4, shortly after the updated Hancitor was first seen downloading Vawtrak, the same actor was\nobserved using a new version of Ruckguv downloader. Before this, the last time that we saw this\ndownloader was in December 2015, loading a Cryptowall payload. Similar to the updated Hancitor, the\nupdated Ruckguv was dropped by a macro in the Word document. Ruckguv, in turn, downloaded a\nPony module and Vawtrak.\n\n\n-----\n\n_Figure 5: Example email spreading Vawtrak on May 4th via new loader has subject “FW: [company_\n_website] irs notification” and attachment irs_468718228.doc (random numbers)_\n\nSince we last saw the downloader in Proofpoint data, Ruckguv has also been overhauled and updated.\nNotable changes and new malware features include:\n\nPayload URLs are no longer encoded with ROT13\nDownloaded payload is written to the system with one possible file name instead of three\nMore robust download code, instead of simply calling the URLDownloadToFileA API\nThe ability to download and run a Pony DLL as a module\n\nThe old version of Ruckguv (for example, MD5: 1c319670a717305f7373c8529092f8c3) encoded its\npayload URLs stored in the malware binary with ROT13, and decoded them at run-time. This is no\nlonger the case; but other strings, such as DLL names used by the malware are now ROT13-encoded\ninstead.\n\nThe downloaded payload is now written to the %APPDATA%\\csrss_[volume_serial].exe file, where\nvolume_serial is an eight-character string is generated with GetVolumeInformationA. Previously, the\npayload was also written to the %APPDATA% folder, but with one of three possible filenames,\nincluding csrss_nn.exe, WindowsDriver_nn.exe, or Frifox_nn.exe, where nn was a random two-digit\nnumber.\n\n\n-----\n\n_Figure 6: Code snippet showing filename generation for the downloaded payload_\n\nThe old version of the malware simply downloaded the payload with the URLDownloadToFileA\nWindows API, which “downloads bits from the Internet and saves them to a file.” The new version\nreworked that functionality to instead use the InternetOpen, InternetOpenUrl, CreateFile, and WriteFile\nfunctions. The use of these functions allows for further customization, such as setting the User-Agent\nto “Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0)”. Additionally the downloaded file\nsize is now checked; if it is less than 2,000 bytes, it is considered a failed download and the loader\nattempts an alternative download location. This check may incidentally or intentionally help against\nwhite hat hackers that may alter/neuter the malware payload sites, such as those described in the\n“STUPID LOCKY” incident [2].\n\n_Figure 7: Code snippet showing the attempt to download the payload from an initial location, followed_\n_by a download file size check_\n\n\n-----\n\nFinally, the updated Ruckguv added the ability to download and run a DLL (we have only observed\nPony DLL being downloaded so far). The DLL is downloaded to the\n%APPDATA%\\wsrv_[volume_serial].dll location. The DLL is encrypted with a 10-byte RC4 key\n(“NJB#6452^&” in our sample). The DLL file is then read with ReadFile and executed from within the\nparent Ruckguv process by allocating memory, writing it to the parent process and jumping to its entry\npoint.\n\n_Figure 8: Code snippet showing the DLL file name generation and DLL download_\n\n**Other Loaders and Actor Details**\n\nThis Vawtrak actor has also been experimenting with H1N1 Loader as the initial payload dropped by\nmacro documents. Like the other loaders discussed, it is used to download a Pony DLL and Vawtrak\nexecutable. However, H1N1 can also steal credentials. H1N1 also received updates recently, which\nare discussed on the KernelMode forums [1].\n\nThe Vawtrak botnets IDs described here (80, 81, and 82) target primarily U.S. financial organizations\nwith their injects, although a few Canadian and UK organizations have also been targeted. Previously\na typical campaign would consist of only a handful of unique documents and several hundred thousand\nemail messages. Starting in April, the actor started using many unique documents for their campaigns\n—some days using as many as tens of thousands of documents, likely as an attempt to evade\ndetections. We first observed this Vawtrak variant [last September. It’s notable for its modularity (it](https://www.proofpoint.com/us/threat-insight/post/In-The-Shadows)\nincluded a Pony stealer, a debug module, an inject module, and a back connect module).\n\nVawtrak may also download TinyLoader, which we have previously observed installing AbaddonPOS\nmalware. We have also recently observed Vawtrak downloading the spambot used to send these\ncampaigns (Send-Safe Enterprise Mailer).\n\n**Conclusion**\n\nMalware loaders often don't receive the same attention as their payload malware. Yet loaders like\nHancitor, Ruckguv, Pony, and others are critical parts of the malware ecosystem. Not only are they\nincorporating increasing functionality on their own, but they also help threat actors evade detection\n\n\n-----\n\nbecause of their small download size. They also increase actors flexibility, allowing them to rapidly\nswap out payloads as campaigns evolve or differentiate payloads by geolocation, IP, or other\ninstructions provided by C&C infrastructure.\n\nAnd to that end, updates to loaders bear watching for anyone looking to stay ahead of savvy actors.\n\n**References**\n\n**Indicators of Compromise (IOC)**\n\n\n**IOC** **IOC**\n**Type**\n\n9b3fa5dc3b340e0df08d26dd53cd3aa83212950b2d41cf1b1e5a6dd1acd0e4df SHA56\nHash\n\n5ec4ba1a97500e664af6896f4c02846ca6777e671bb600103dc8d49224e38f48 SHA56\nHash\n\nb19ec186f59b1f72c768ed2fcd8344d75821e527870b71e8123db96f683f1b68 SHA56\nHash\n\nec9a14f442bbb549388c7a36f8f221fab4f8d3578540ad528f9cb12d35e73fa5 SHA56\nHash\n\n\n**Description**\n\nDocument\nthat dropped\nHancitor on\nApril 28\n\nHancitor\n\nPony\n(Hancitor\nmodule)\n\nVawtrak\n(Hancitor\npayload)\n\n\n\n[hxxp://hadfanawass[.]com/sl/gate.php] URL Hancitor C2\n\n[hxxp://rophenreswi[.]ru/sl/gate.php] URL Hancitor C2\n\n[hxxp://mihesfitons[.]ru/sl/gate.php] URL Hancitor C2\n\n[hxxps://krrewiaog3u4npcg[.]onion.to/sl/gate.php] URL Hancitor C2\n\n[hxxp://quoapps[.]es/pm.dll] URL Hancitor\ndownloading\nPony\n\n[hxxp://posturepals[.]es/inst1.exe] URL Hancitor\ndownloading\nVawtrak\n\n\nb1ba251cf4f494a00ff0d64a50004d839928dac816afb81c33af51622baf2c12 SHA256\nHash\n\n0b6e868c196c7ad80fac72a7d02159cfa4f72ad657604cd3e5eb03c796df01ba SHA56\nHash\n\n2ccebf5fee30073e849895c6e43f6519017f226281c80177d72febcfbaf1f0d3 SHA56\nHash\n\n\nDocument\nthat dropped\nRuckguv on\nMay 4\n\nRuckguv\n\nPony\n(Ruckguv\nmodule)\n\n\n-----\n\n9b11304e4362a8fbe2ee91d8e31d7ae5774019aaeef9240c6878da78bdf0bfa9 SHA56\nHash\n\n\nVawtrak\n(Ruckguv\npayload)\n\n\n\n[hxxp://logimax[.]net[.]in/ii.exe] URL Ruckguv\ndownloading\nVawtrak\n\n[hxxp://tourjacket[.]me/ii.exe] URL Ruckguv\ndownloading\nVawtrak\n\n[hxxp://urbanrecreation[.]eu/ii.exe] URL Ruckguv\ndownloading\nVawtrak\n\n[hxxp://tantrix[.]com[.]tr/pm.dll] URL Ruckguv\ndownloading\nPony\n\n[hxxp://therapeutica[.]com[.]br/pm.dll] URL Ruckguv\ndownloading\nPony\n\n[hxxp://therapeutica[.]com[.]br/pm.dll] URL Ruckguv\ndownloading\nPony\n\n_Select ET Signatures that would fire on such traffic:_\n\n2819959 || ETPRO TROJAN Hancitor Dropper Checkin\n\n2819978 || ETPRO TROJAN Tordal/Hancitor/Chanitor\n\n2021997 || ET POLICY External IP Lookup api.ipify.org\n\n2014411 || ET TROJAN Fareit/Pony Downloader Checkin 2\n\n2022225 || ET TROJAN Vawtrak HTTP CnC Beacon\n\n2813060 || ETPRO TROJAN Vawtrak Retrieving Module\n\nSubscribe to the Proofpoint Blog\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2016/2016-05-12 - Hancitor and Ruckguv Reappear, Updated and With Vawtrak On Deck.pdf"
    ],
    "report_names": [
        "2016-05-12 - Hancitor and Ruckguv Reappear, Updated and With Vawtrak On Deck.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536197,
    "ts_updated_at": 1743041369,
    "ts_creation_date": 1653697868,
    "ts_modification_date": 1653697868,
    "files": {
        "pdf": "https://archive.orkl.eu/c3df48ffe6550f78e6ce051d7b820b7df351781a.pdf",
        "text": "https://archive.orkl.eu/c3df48ffe6550f78e6ce051d7b820b7df351781a.txt",
        "img": "https://archive.orkl.eu/c3df48ffe6550f78e6ce051d7b820b7df351781a.jpg"
    }
}