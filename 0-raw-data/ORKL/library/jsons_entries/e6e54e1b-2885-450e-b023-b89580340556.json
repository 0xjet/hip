{
    "id": "e6e54e1b-2885-450e-b023-b89580340556",
    "created_at": "2023-01-12T15:06:46.767337Z",
    "updated_at": "2025-03-27T02:06:05.503162Z",
    "deleted_at": null,
    "sha1_hash": "a07861dd98ff036baca25964796b40dafcec7d3c",
    "title": "2015-06-18 - So Long, and Thanks for All the Domains",
    "authors": "",
    "file_creation_date": "2022-05-28T02:07:35Z",
    "file_modification_date": "2022-05-28T02:07:35Z",
    "file_size": 563673,
    "plain_text": "# So Long, and Thanks for All the Domains\n\n**[securityblog.switch.ch/2015/06/18/so-long-and-thanks-for-all-the-domains/](https://securityblog.switch.ch/2015/06/18/so-long-and-thanks-for-all-the-domains/)**\n\nJune 18, 2015\n\nWhile Trojans like Dyre and Dridex are dominating malware-related news, we take the time\nto have a closer look at Tinba (Tiny Banker, Zusy, Illi), yet another Trojan which targets\nWindows users. In the first part of this post, we give a short historical review, followed by\nhints about how to detect (and remove) this threat on an infected system. In the second part,\nwe have a look at a portion of the Trojan’s code which enhances its communication\nresilience, and how we can leverage these properties for defensive purposes.\n\nTinba is a fine piece of work, initially purely written in assembly. [CSIS discovered it back in](https://www.csis.dk/en/csis/news/3566/)\nMay 2012, and it contained WebInject capability and rootkit functionality in a binary of just 20\nKB. The source code of Tinba leaked in July 2014, helping bad guys to create their own,\nextended versions.\n\n\n-----\n\nThe source code of Tinba leaked in July 2014. Shown are some preparations to hook\nZwQueryDirectoryFile.\n[Tinba on steroids was discovered in September 2014. Two main features are worth noting:](http://securityintelligence.com/tinba-malware-reloaded-and-attacking-banks-around-the-world)\nFirst, each binary comes with a public key to check incoming control messages for\nauthenticity and integrity. Second, there is a domain generation algorithm (DGA), which we\nwill discuss later. In October 2014, Tinba entered Switzerland, mainly to phish for credit card\ninformation.\n\nTinba tried to phish credit card information.\nLike other commodity Trojans, Tinba checks whether it is running in a virtual\n[machine/sandboxed environment by checking the hard-disk size or looking for](http://joe4security.blogspot.ch/2014/12/new-sandbox-evasion-tricks-spot-with.html) user\ninteraction. According to abuse.ch, there was an intense distribution of Tinba in Switzerland\n[early this year. Such spam campaigns can happen again at any time, so it is of use to know](https://www.abuse.ch/?p=9095)\nhow to detect Tinba on an infected system and remove it.\n\nEven though Tinba has the ability to hide directories and files (rootkit functionality),\ncybercriminals were wondering why they should bother using it. Why not simply hide\ndirectories and files with the “hidden” flag, which works for most users? Thus, it is relatively\n\n\n-----\n\nsimple for a computer-savvy user to remove this version of Tinba from an infected (see\ninstructions below).\n\nA randomly named\n\ndirectory, which contains the Trojan itself, can be hidden by setting its attributes to “hidden”.\n\nDisclaimer: We recommend completely re-installing the infected system. Very often, malware\ndoes mean things, even installing other malware, such that the two steps given below might\nnot be sufficient to clean your system. Also, having a state-of-the-art anti-virus product\ninstalled helps to prevent infections.\n\nStep 1: Remove the malicious entry in the Windows registry.\n\nFollow [these steps to start the Registry Editor and read the warnings.](https://support.microsoft.com/en-us/kb/136393)\n[Navigate to the following key:](https://msdn.microsoft.com/en-us/library/windows/desktop/aa376977%28v=vs.85%29.aspx)\nHKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\nDelete the weird randomly named entry, here C1B5D40E, pointing to a file called\n_bin.exe in the directory C:\\Users\\USERNAME\\AppData\\Roaming\\C1B5D40E._\n\nStep 2: Remove the directory containing the malicious file (named bin.exe) or the\nmalicious file itself.\n\n[Follow the steps described for Windows Vista/7 or for](http://windows.microsoft.com/en-us/windows/show-hidden-files#show-hidden-files=windows-7) [Windows 8.1 to show](http://blogs.msdn.com/b/zxue/archive/2012/03/08/win8-howto-19-show-hidden-files-folders-and-drives.aspx)\nhidden files in Windows Explorer.\nOpen Windows Explorer, type %AppData%, and hit Enter. Depending on the\nWindows version, you will end up in a slightly different directory than the one\ngiven below in the picture.\nYou will see a hidden directory, here C1B5D40E. Within this directory, there is a\nfile usually called bin.exe – the Trojan itself. The malicious entry in the Windows\nregistry points to this file.\nDelete the randomly named hidden directory (or the file bin.exe in that directory)\nand reboot.\n\n\n-----\n\nWindows 7: %AppData% resolves to C:\\Users\\USERNAME\\AppData\\Roaming. A randomly\nnamed directory will be there, but hidden from the eyes of an ordinary user.\n[It was mentioned above that a DGA was added to the Trojan’s capabilities. The criminals](http://en.wikipedia.org/wiki/Domain_generation_algorithm)\nwant to enhance its resilience by making it harder for law enforcement agencies and security\nexpoerts to execute a takedown or takover. Based on some well-defined input values, the\nDGA simply generates a bunch of domain names. Input values can be anything like a date,\na foreign exchange reference rate at a certain time or a seed. Tinba uses an initial domain, a\nseed value and a couple of predefined top-level domains, such as .biz, .com, .in, .net, .pw,\n.ru, .space and .us.\n\n[In the case of Tinba, the DGA has been reverse-engineered by garage4hackers,](http://garage4hackers.com/entry.php?b=3086) Johannes\nBader and others, and we would like to take this opportunity to say “thank you” for sharing.\nThe DGA may change, of course. Looking at its main routines on a regular basis, or rather\nchecking the generated domains against the predictions given by the reverse-engineered\nscripts, is thus essential. Currently, the (inner) main loop of the DGA still is consistent with\nthe one provided by garage4hackers in September 2014.\n\n\n-----\n\nA quick check of the inner main loop of the DGA for modifications: this part still produces the\nsame output as the equivalent one from September 2014.\nWould it not be nice to leverage a malicious feature like this for a security control? Yes it\n[would, and we can! A DNS firewall can be built using](https://deepthought.isc.org/article/AA-00525/0) DNS Response Policy Zones (RPZ).\n[The RPZ gets populated by several means, one of them might be the output from DGA’s. By](https://deepthought.isc.org/article/AA-00520/0/When-maintaining-a-DNS-RPZ-how-do-I-put-infected-users-into-a-walled-garden.html)\nmonitoring malware that employs a DGA and extracting necessary input values, malicious\n[domains can be computed and collected, for example in the DGArchive by Daniel Plohmann.](https://dgarchive.caad.fkie.fraunhofer.de/)\nThese collections can be fed into an RPZ, and by operating a DNS firewall, end users (and\nSwiss universities in our case) can be protected – not necessarily from being infected, but\nhopefully from becoming victims of fraud.\n\nSample SHA-256:\ne4627c1ea318a93305bc3b91d3f0a197547093882baff81ad11876a0b9e1e268\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2015/2015-06-18 - So Long, and Thanks for All the Domains.pdf"
    ],
    "report_names": [
        "2015-06-18 - So Long, and Thanks for All the Domains.pdf"
    ],
    "threat_actors": [
        {
            "id": "649b5b3e-b16e-44db-91bc-ae80b825050e",
            "created_at": "2022-10-25T15:50:23.290412Z",
            "updated_at": "2025-03-27T02:00:55.431037Z",
            "deleted_at": null,
            "main_name": "Dragonfly",
            "aliases": [
                "TEMP.Isotope",
                "DYMALLOY",
                "Berserk Bear",
                "TG-4192",
                "Crouching Yeti",
                "IRON LIBERTY",
                "Energetic Bear",
                "Ghost Blizzard"
            ],
            "source_name": "MITRE:Dragonfly",
            "tools": [
                "MCMD",
                "Impacket",
                "CrackMapExec",
                "Backdoor.Oldrea",
                "Mimikatz",
                "PsExec",
                "Trojan.Karagany",
                "netsh"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "1a76ed30-4daf-4817-98ae-87c667364464",
            "created_at": "2022-10-25T16:47:55.891029Z",
            "updated_at": "2025-03-27T02:05:17.408867Z",
            "deleted_at": null,
            "main_name": "IRON LIBERTY",
            "aliases": [
                "ATK6 ",
                "BROMINE ",
                "CASTLE ",
                "Crouching Yeti ",
                "DYMALLOY ",
                "Dragonfly ",
                "Energetic Bear / Berserk Bear ",
                "Ghost Blizzard ",
                "TEMP.Isotope ",
                "TG-4192 ",
                "ALLANITE "
            ],
            "source_name": "Secureworks:IRON LIBERTY",
            "tools": [
                " Ddex Loader",
                " Havex",
                " Karagany",
                " Loek",
                " MCMD",
                " Sysmain",
                " xfrost",
                "ClientX"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "3a0be4ff-9074-4efd-98e4-47c6a62b14ad",
            "created_at": "2022-10-25T16:07:23.590051Z",
            "updated_at": "2025-03-27T02:02:09.878211Z",
            "deleted_at": null,
            "main_name": "Energetic Bear",
            "aliases": [
                "ATK 6",
                "Blue Kraken",
                "Crouching Yeti",
                "Dragonfly",
                "Electrum",
                "Energetic Bear",
                "Ghost Blizzard",
                "Group 24",
                "ITG15",
                "Iron Liberty",
                "Koala Team",
                "TG-4192"
            ],
            "source_name": "ETDA:Energetic Bear",
            "tools": [
                "Backdoor.Oldrea",
                "CRASHOVERRIDE",
                "Commix",
                "CrackMapExec",
                "CrashOverride",
                "Dirsearch",
                "Dorshel",
                "Fertger",
                "Fuerboos",
                "Goodor",
                "Havex",
                "Havex RAT",
                "Hello EK",
                "Heriplor",
                "Impacket",
                "Industroyer",
                "Karagany",
                "Karagny",
                "LightsOut 2.0",
                "LightsOut EK",
                "Listrix",
                "Oldrea",
                "PEACEPIPE",
                "PHPMailer",
                "PsExec",
                "SMBTrap",
                "Subbrute",
                "Sublist3r",
                "Sysmain",
                "Trojan.Karagany",
                "WSO",
                "Webshell by Orb",
                "Win32/Industroyer",
                "Wpscan",
                "nmap",
                "sqlmap",
                "xFrost"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536006,
    "ts_updated_at": 1743041165,
    "ts_creation_date": 1653703655,
    "ts_modification_date": 1653703655,
    "files": {
        "pdf": "https://archive.orkl.eu/a07861dd98ff036baca25964796b40dafcec7d3c.pdf",
        "text": "https://archive.orkl.eu/a07861dd98ff036baca25964796b40dafcec7d3c.txt",
        "img": "https://archive.orkl.eu/a07861dd98ff036baca25964796b40dafcec7d3c.jpg"
    }
}