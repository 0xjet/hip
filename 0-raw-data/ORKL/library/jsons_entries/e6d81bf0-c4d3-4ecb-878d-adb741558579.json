{
    "id": "e6d81bf0-c4d3-4ecb-878d-adb741558579",
    "created_at": "2023-01-12T15:08:28.094071Z",
    "updated_at": "2025-03-27T02:05:26.231087Z",
    "deleted_at": null,
    "sha1_hash": "e490f7834588c12f803503d9ce9498aaaaad4038",
    "title": "2022-06-07 - Phishing Campaigns featuring Ursnif Trojan on the Rise",
    "authors": "",
    "file_creation_date": "2022-06-18T23:17:41Z",
    "file_modification_date": "2022-06-18T23:17:41Z",
    "file_size": 3614810,
    "plain_text": "# Phishing Campaigns featuring Ursnif Trojan on the Rise\n\n**mcafee.com/blogs/other-blogs/mcafee-labs/phishing-campaigns-featuring-ursnif-trojan/**\n\n[McAfee Labs](https://www.mcafee.com/blogs/author/mcafee-labs/)\nJun 07, 2022\n\n6 MIN READ\n\nAuthored by Jyothi Naveen and Kiran Raj\n\n\nJune 8, 2022\n\n\nMcAfee Labs have been observing a spike in phishing campaigns that utilize Microsoft office macro capabilities. These malicious documents\nreach victims via mass spam E-mail campaigns and generally invoke urgency, fear, or similar emotions, leading unsuspecting users to\npromptly open them. The purpose of these spam operations is to deliver malicious payloads to as many people as possible.\n\nA recent spam campaign was using malicious word documents to download and execute the Ursnif trojan. Ursnif is a high-risk trojan designed\nto record various sensitive information. It typically archives this sensitive data and sends it back to a command-and-control server.\n\nThis blog describes how attackers use document properties and a few other techniques to download and execute the Ursnif trojan.\n\n## Threat Summary\n\nThe initial attack vector is a phishing email with a Microsoft Word document attachment.\nUpon opening the document, VBA executes a malicious shellcode\nShellcode downloads the remote payload, Ursnif, and invokes rundll32.exe to execute it.\n\n## Infection Chain\n\nThe malware arrives through a phishing email containing a Microsoft Word document as an attachment. When the document is opened and\nmacros are enabled, Word downloads a DLL (Ursnif payload). The Ursnif payload is then executed using rundll32.exe\n\n\n-----\n\nFigure 1- flowchart of infection chain\n\n## Word Analysis\n\nMacros are disabled by default and the malware authors are aware of this and hence present an image to entice the victims into enabling\nthem.\n\nFigure 2- Image of what the user sees upon opening the document\n\n## VBA Macro Analysis of Word Document\n\nAnalyzing the sample statically with ‘oleId’ and ‘olevba’ indicates the suspicious vectors..\n\n\n-----\n\nFigure 3- Oleid output\n\nFigure 4- Olevba output\n\nThe VBA Macro is compatible with x32 and x64 architectures and is highly obfuscated as seen in Figure-5\n\nFigure 5- Obfuscated VBA macro\nTo get a better understanding of the functionality, we have de-obfuscated the contents in the 2 figures shown below.\n\n\n-----\n\nFigure 6- De-obfuscated VBA macro (stage 1)\n\nFigure 7- De-obfuscated VBA macro (stage 2)\nAn interesting characteristic of this sample is that some of the strings like CLSID, URL for downloading Ursnif, and environment variables\nnames are stored in custom document properties in reverse. As shown in Figure-7, VBA function\n“ActiveDocument.CustomDocumentProperties()” is used to retrieve the properties and uses “StrReverse” to reverse the contents.\n\nWe can see the document properties in Figure-8\n\n\n-----\n\nFigure 8- Document properties\n\n## Payload Download and Execution:\n\nThe malicious macro retrieves hidden shellcode from a custom property named “Company” using the “cdec” function that converts the\nshellcode from string to decimal/hex value and executes it. The shellcode is shown below.\n\nFigure 9- Raw Company property\n\nThe shellcode is written to memory and the access protection is changed to PAGE_EXECUTE_READWRITE.\n\nFigure 10- Code of\n\nVirtualProtect Figure 11- Shellcode’s memory\n\nand protection after calling VirtualProtect()\nAfter adding the shellcode in memory, the environment variable containing the malicious URL of Ursnif payload is created. This Environment\nvariable will be later used by the shellcode.\n\n\n-----\n\nFigure 12- Environment\n\nvariable set in Winword.exe space\nThe shellcode is executed with the use of the SetTimer API. SetTimer creates a timer with the specified time-out value mentioned and notifies\na function when the time is elapsed. The 4th parameter used to call SetTimer is the pointer to the shellcode in memory which will be invoked\nwhen the mentioned time is elapsed.\n\nFigure 13- SetTimer\n\nfunction (Execution of shellCode)\nThe shellcode downloads the file from the URL stored in the environmental variable and stores it as ” y9C4A.tmp.dll ” and executes it with\nrundll32.exe.\n\nURL hxxp://docmasterpassb.top/kdv/x7t1QUUADWPEIQyxM6DT3vtrornV4uJcP4GvD9vM/\n\nCMD rundll32 “C:\\Users\\user\\AppData\\Local\\Temp\\y9C4A.tmp.dll”,DllRegisterServer\n\nFigure 14- Exports of Downloaded DLL\n\n\n-----\n\nAfter successful execution of the shellcode, the environment variable is removed.\n\nEnvironment Variable\n\n## IOC\n\n\nFigure 15- Removal of\n\n\n**TYPE** **VALUE** **PRODUCT** **DETECTION NAME**\n\n\nMain Word\nDocument\n\nDownloaded\ndll\n\nURL to\ndownload\ndll\n\n\n6cf97570d317b42ef8bfd4ee4df21d217d5f27b73ff236049d70c37c5337909f McAfee\nLiveSafe\nand Total\nProtection\n\n41ae907a2bb73794bb2cff40b429e62305847a3e1a95f188b596f1cf925c4547 McAfee\nLiveSafe\nand Total\nProtection\n\n\nX97M/Downloader.CJG\n\nUrsnif-FULJ\n\n\nhxxp://docmasterpassb.top/kdv/x7t1QUUADWPEIQyxM6DT3vtrornV4uJcP4GvD9vM/ WebAdvisor Blocked\n\n\n## MITRE Attack Framework\n\n**Technique ID** **Tactic** **Technique Details** **Description**\n\n**T1566.001** Initial Access Spear phishing Attachment Manual execution by user\n\n**T1059.005** Execution Visual Basic Malicious VBA macros\n\n**T1218.011** Defense Evasion Signed binary abuse Rundll32.exe is used\n\n**T1027** Defense Evasion Obfuscation techniques VBA and powershell base64 executions\n\n**T1086** Execution Powershell execution PowerShell command abuse\n\n## Conclusion\n\nMacros are disabled by default in Microsoft Office applications, we suggest keeping it that way unless the document is received from a trusted\nsource. The infection chain discussed in the blog is not limited to Word or Excel. Further threats may use other live-off-the-land tools to\ndownload its payloads.\n\nMcAfee customers are protected against the malicious files and sites detailed in this blog with McAfee LiveSafe/Total Protection and McAfee\nWeb Advisor.\n\n[McAfee Labs Threat Research Team](https://www.mcafee.com/blogs/author/mcafee-labs/)\nMcAfee Labs is one of the leading sources for threat research, threat intelligence, and cybersecurity thought leadership. See our blog posts\nbelow for more information.\n\n### More from McAfee Labs\n\n[Instagram credentials Stealers: Free Followers or Free Likes](https://www.mcafee.com/blogs/other-blogs/mcafee-labs/instagram-credentials-stealers-free-followers-or-free-likes/%20)\n\n\n-----\n\nAuthored by Dexter Shin Instagram has become a platform with over a billion monthly active users. Many...\n\nJun 10, 2022 |  6 MIN READ\n\n[Instagram credentials Stealer: Disguised as Mod App](https://www.mcafee.com/blogs/other-blogs/mcafee-labs/instagram-credentials-stealer-disguised-as-mod-app/%20)\n\nAuthored by Dexter Shin McAfee’s Mobile Research Team introduced a new Android malware targeting Instagram users who...\n\nJun 10, 2022 |  4 MIN READ\n\n[Crypto Scammers Exploit: Elon Musk Speaks on Cryptocurrency](https://www.mcafee.com/blogs/other-blogs/mcafee-labs/crypto-scammers-exploit-elon-musk-speaks-on-cryptocurrency/%20)\n\nBy Oliver Devane Update: In the past 24 hours (from time of publication) McAfee has identified 15...\n\nMay 25, 2022 |  4 MIN READ\n\n[Scammers are Exploiting Ukraine Donations](https://www.mcafee.com/blogs/other-blogs/mcafee-labs/scammers-are-exploiting-ukraine-donations/%20)\n\nAuthored by Vallabh Chole and Oliver Devane Scammers are very quick at reacting to current events, so...\n\nApr 01, 2022 |  7 MIN READ\n\n[Imposter Netflix Chrome Extension Dupes 100k Users](https://www.mcafee.com/blogs/other-blogs/mcafee-labs/imposter-netflix-chrome-extension-dupes-100k-users/%20)\n\nAuthored by Oliver Devane, Vallabh Chole, and Aayush Tyagi McAfee has recently observed several malicious Chrome Extensions...\n\nMar 10, 2022 |  8 MIN READ\n\n\n-----\n\nAuthored by Oliver Devane and Vallabh Chole  Notifications on Chrome and Edge, both desktop browsers, are commonplace,...\n\nFeb 25, 2022 |  5 MIN READ\n\n[Emotet’s Uncommon Approach of Masking IP Addresses](https://www.mcafee.com/blogs/other-blogs/mcafee-labs/emotets-uncommon-approach-of-masking-ip-addresses/%20)\n\nIn a recent campaign of Emotet, McAfee Researchers observed a change in techniques. The Emotet maldoc was...\n\nFeb 04, 2022 |  4 MIN READ\n\n[HANCITOR DOC drops via CLIPBOARD](https://www.mcafee.com/blogs/other-blogs/mcafee-labs/hancitor-doc-drops-via-clipboard/%20)\n\nHancitor, a loader that provides Malware as a Service, has been observed distributing malware such as FickerStealer,...\n\nDec 13, 2021 |  6 MIN READ\n\n[‘Tis the Season for Scams](https://www.mcafee.com/blogs/other-blogs/mcafee-labs/tis-the-season-for-scams/%20)\n\n‘Tis the Season for Scams\n\nNov 29, 2021 |  18 MIN READ\n\n[The Newest Malicious Actor: “Squirrelwaffle” Malicious Doc.](https://www.mcafee.com/blogs/other-blogs/mcafee-labs/the-newest-malicious-actor-squirrelwaffle-malicious-doc/%20)\n\nAuthored By Kiran Raj Due to their widespread use, Office Documents are commonly used by Malicious actors...\n\nNov 10, 2021 |  4 MIN READ\n\n\n-----\n\n[Social Network Account Stealers Hidden in Android Gaming Hacking Tool](https://www.mcafee.com/blogs/other-blogs/mcafee-labs/social-networks-account-stealer-hidden-in-android-gaming-hacking-tool/%20)\n\nAuthored by: Wenfeng Yu McAfee Mobile Research team recently discovered a new piece of malware that specifically...\n\nOct 19, 2021 |  6 MIN READ\n\n[Malicious PowerPoint Documents on the Rise](https://www.mcafee.com/blogs/other-blogs/mcafee-labs/malicious-powerpoint-documents-on-the-rise/%20)\n\nAuthored by Anuradha M McAfee Labs have observed a new phishing campaign that utilizes macro capabilities available...\n\nSep 21, 2021 |  6 MIN READ\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-06-07 - Phishing Campaigns featuring Ursnif Trojan on the Rise.pdf"
    ],
    "report_names": [
        "2022-06-07 - Phishing Campaigns featuring Ursnif Trojan on the Rise.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536108,
    "ts_updated_at": 1743041126,
    "ts_creation_date": 1655594261,
    "ts_modification_date": 1655594261,
    "files": {
        "pdf": "https://archive.orkl.eu/e490f7834588c12f803503d9ce9498aaaaad4038.pdf",
        "text": "https://archive.orkl.eu/e490f7834588c12f803503d9ce9498aaaaad4038.txt",
        "img": "https://archive.orkl.eu/e490f7834588c12f803503d9ce9498aaaaad4038.jpg"
    }
}