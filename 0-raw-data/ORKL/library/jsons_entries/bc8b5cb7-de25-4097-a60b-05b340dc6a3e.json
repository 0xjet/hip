{
    "id": "bc8b5cb7-de25-4097-a60b-05b340dc6a3e",
    "created_at": "2023-01-12T15:01:09.051205Z",
    "updated_at": "2025-03-27T02:06:06.139612Z",
    "deleted_at": null,
    "sha1_hash": "2c701e4458f8f52cc124c06774222cd5c8ed46a2",
    "title": "2021-11-18 - The Pitfall of Threat Intelligence Whitelisting- Specter Botnet is 'taking over' Top Legit DNS Domains By Using ClouDNS Service",
    "authors": "",
    "file_creation_date": "2022-05-29T01:21:20Z",
    "file_modification_date": "2022-05-29T01:21:20Z",
    "file_size": 383056,
    "plain_text": "# The Pitfall of Threat Intelligence Whitelisting: Specter Botnet is 'taking over' Top Legit DNS Domains By Using ClouDNS Service\n\n**blog.netlab.360.com/the-pitfall-of-threat-intelligence-whitelisting-specter-botnet-is-taking-over-top-legit-dns-domains-**\nby-using-cloudns-service/\n\nHui Wang November 18, 2021\n\n18 November 2021 / [DNS](https://blog.netlab.360.com/tag/dns/)\n\n## Abstract\n\nIn order to reduce the possible impact of false positives, it is pretty common practice for\nsecurity industry to whitelist the top Alexa domains such as `www.google.com,`\n```\nwww.apple.com, www.qq.com, www.alipay.com .\n\n```\nAnd we have seen various machine learning detection models that bypass data when they\nsees these popular Internet business domains.\n\nThe security war between the white and black never ends, white hats want to see “black” in\nthe data, while hackers always try to blend in and appear “ white\". In the follow article, we will\nsee an interesting case which shows that the white we see is not necessarily white.\n\nOur BotMon tracking system recently highlighted that the Specter botnet family started to use\ntwo domains `api.github.com and` `www.ibm.com as C2 domains for its control`\ncommunicate, while everyone knows for sure there is just no way for these FQDN to be\nmalicious. The hacker utilized a pretty bizarre feature from one public DNS provider\nClouDNS to make this all possible.\n\nDoing this will definitely bring troubles to IoC based treat intelligence security, as the C2 are\nabsolutely white.\n\n## Origins\n\n[We first disclosed the Specter botnet back in September last year (September 2020). The](https://blog.netlab.360.com/ghost-in-action-the-specter-botnet/)\nbotnet is a remote control trojan (RAT) for Linux platforms with flexible configuration and\nhighly modular/plugin-based, It is consist of three major modules: Dropper, Loader, and\nPlugin, with the main functions determined by the Loader & Plugin, and this botnet has\nalways been active since our disclosure.\n\nIn September this year, our BotMon's C2 auto-extraction system alerted us that there was an\nupdate of Specter's sample and the auto-extracted C2 was `api.github.com on its port`\n```\n80 .\n\n```\n\n-----\n\nThere is no need to explains what api.github.com is, although we have seen many malware\nusing github.com before, they pretty much all just use its web service to download their own\nmalicious programs.\n\nBut here how can Specter uses api.github.com as its C2 communication node and passes\ncontrol traffic back and forth between github and its bots? Was github hacked, or was it a bug\nin our own C2 auto-extraction module?\n\nWe took a close look at the sample (md5: 2aec3f06abd677f5f129ddb55d2cde67 ), and saw\nthat the Specter update focused on the structure of the C2 configuration file, the C2 config in\nthe previous versions could be located by searching the `SpectCF string. The new version`\neliminated this. The following is the decrypted C2 configuration file of this sample, the green\npart is the C2: api.github.com:80 mentioned above.\n\nThe data in red is the new from this update, and what is it? After parsing in small-end format,\nweI found that they are the following 4 IP addresses, belonging to the DNS Hosting provider\n[ClouDNS](https://www.cloudns.net/)\n```\n85.159.233.158\n108.59.1.30\n217.182.183.225\n185.206.180.169\n\n```\nThe new Specter sample send dns request to C2 using the following code snippet, which has\nthe logic to craft the dns request packets and the ask the DNS IPs described above about\nthe FQDN to finally get the C2 address.\n\n\n-----\n\nReaders can use the dig command below on their own and see the difference quite clearly\nby comparing their output.\n```\ndig api.github.com @8.8.8.8\ndig api.github.com @85.159.233.158\n\n```\nAt this point the fog clears and the C2 `api.github.com used by Specter is actually a`\nsubdomain under ZONE `github.com registered with the DNS Hosting provider ClouDNS.`\nAs long as the hacker uses the resolution server provided by ClouDNS, the resolution of\n```\napi.github.com can be any IP the hacker picks.\n\n```\nGithub was not hacked, the Specter botnet operator did not enter the wrong C2 domin, our\nC2 auto-extraction was not buggy, but the white domain api.github.com did indeed become a\nworking C2 domain for this botnet. And this totally legit domain can easily deceive malware\nanalysts and is a great challenge for security tools based on black and white list rules.\n\n## ClouDNS\n\nGiven the above exploitation process, let’s explore ClouDNS a little bit more here.\n\n[ClouDNS is a global managed DNS service provider based in Europe, offering services](https://www.cloudns.net/about-us/)\nincluding GeoDNS, Anycast DNS and DNS DDoS protection.\n\nClouDNS allows arbitrary registration of DNS Zones and the addition of sub-domain\nresolution. We registered(and later removed after test) a DNS Zone named `nsa.gov,`\nadded a sub-level domain name `test and resolved to` `16.16.16.16 . ClouDNS assigned`\nus 4 Name Servers to resolve this domain name, as shown below.\n\n\n-----\n\nOnce created successfully, the Name Servers assigned by the platform can be used to\nresolve the domain name we created.\n\nTheoretically, we can register any Zone on ClouDNS that is not registered or not restricted by\nClouDNS, and the aforementioned Specter C2 `api.github.com is a domain name`\ngenerated in this way.\n\nNot only that, but ClouDNS also has a \"mysterious logic\" in determining whether a domain is\n\"registered\" or not. As mentioned earlier, `github.com was already registered on ClouDNS`\nby the Specter gang, but when we tried to re-register the github.com Zone, we were able to\n\n\n-----\n\ndo so, just with a different batch of NSs than the Specter gang, as shown here.\n\nSo, ClouDNS supports creating same zones as long as they are on their different NS\nServers, this is pretty bizarre behavior.\n\nIn fact, based on our test, not only ClouDNS, but also some other DNS hosting\nproviders, have similar \"vulnerabilities\" in the verification of hosted domains, this is not\nthe topic to be covered in this article though.\n\n## Explore ClouDNS Random Registration ZONEs\n\nBased on our own Passive DNS data, we selected the TOP 1M popular second-level\ndomains and did some serious tests. We wanted to find out how many SLDs of domains in\nthe existing DNS system were registered with ClouDNS as new Zones and how many of\nthem could be malicious.\n\nThe results of the probe showed that there were approximately `300 second-level domains`\nthat were registered in bad faith. Some of the maliciously registered SLDs in ClouDNS are as\nfollows.\n\n\n-----\n\n```\nakadns.net\nonedrive.com\nplivo.com\nsafe.com\nconsalud.cl\ngodaddysites.com\nshopee.com\njsdelivr.net\nafraid.org\nrumahweb.com\nmydomain.com\ncrypto.com\neq.edu.au\nadnxs.com\nwebcindario.com\nweb.com\nlamborghini.com\nmanager-magazin.de\ntoto.com\nmigalhas.com.br\ngoogleadservices.com\nexample.com\ndlink.com\nwhitehouse.gov\ndomain.com\ngooglesyndication.com\nfb.com\npayeer.com\nya.ru\nmql5.com\naaa.com\nhola.com\nwukong.com\nmihanblog.com\nwpengine.com\njumia.ma\nprotonmail.com\ntasnimnews.com\nnintendo.com\ntabnak.ir\nlichess.org\ndigitalocean.com\nasriran.com\namazon.com.br\nakamaized.net\nyjc.ir\noffice.net\n4399.com\nopera.com\nwp.com\nytimg.com\navast.com\ncloudflare.com\nplaystation.com\nhespress.com\n\n```\n\n-----\n\n```\nleagueoflegends.com\nwixsite.com\nskype.com\ngooglevideo.com\nwp.pl\nwix.com\nsamsung.com\ndoubleclick.net\nweebly.com\nudemy.com\nspeedtest.net\ngodaddy.com\nzoom.us\nespn.com\nspotify.com\namazonaws.com\nadobe.com\nwordpress.com\napple.com\nmsn.com\ngithub.com\noffice.com\nalipay.com\nnetflix.com\n360.cn\namazon.com\nqq.com\n\n```\nIn addition, we also selected the popular TOP 1M FQDNs across to check against ClouDNS,\nand the results showed that there are over `300 FQDNs that can generate non-normal`\nresolution in ClouDNS, and after clean up, we found that at least `192 FQDNs are`\nmaliciously registered.\n\n## Summary\n\nWe have yet to see other malicious actors using this technique on a large scale, however,\nthis is an important reminder for us that there are cases of malicious behavior being carried\nout under the cover of apparently normal network behavior.\n\n## Contact us\n\n[Readers are always welcomed to reach us on Twitter or email us to netlab at 360 dot cn.](https://twitter.com/360Netlab)\n\n## IOC\n\n**Sample MD5**\n```\n0ffa01708fd0c67c78e9055b8839d24d\n162c245378b2e21bdab6ef35dfaad6b1\n2aec3f06abd677f5f129ddb55d2cde67\n\n```\n\n-----\n\n**CC**\n```\n45.141.70.5\nwww.ibm.com @pns101.cloudns.net\napi.github.com @ns103.cloudns.net\n\n```\n[360 Netlab Blog - Network Security Research Lab at 360](https://blog.netlab.360.com/)\n\n—\nThe Pitfall of Threat Intelligence Whitelisting: Specter Botnet is 'taking over' Top Legit DNS\nDomains By Using ClouDNS Service\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-11-18 - The Pitfall of Threat Intelligence Whitelisting- Specter Botnet is 'taking over' Top Legit DNS Domains By Using ClouDNS Service.pdf"
    ],
    "report_names": [
        "2021-11-18 - The Pitfall of Threat Intelligence Whitelisting- Specter Botnet is 'taking over' Top Legit DNS Domains By Using ClouDNS Service.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535669,
    "ts_updated_at": 1743041166,
    "ts_creation_date": 1653787280,
    "ts_modification_date": 1653787280,
    "files": {
        "pdf": "https://archive.orkl.eu/2c701e4458f8f52cc124c06774222cd5c8ed46a2.pdf",
        "text": "https://archive.orkl.eu/2c701e4458f8f52cc124c06774222cd5c8ed46a2.txt",
        "img": "https://archive.orkl.eu/2c701e4458f8f52cc124c06774222cd5c8ed46a2.jpg"
    }
}