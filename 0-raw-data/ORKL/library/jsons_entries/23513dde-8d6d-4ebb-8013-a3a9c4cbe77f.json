{
    "id": "23513dde-8d6d-4ebb-8013-a3a9c4cbe77f",
    "created_at": "2023-01-12T15:06:23.480198Z",
    "updated_at": "2025-03-27T02:05:36.663951Z",
    "deleted_at": null,
    "sha1_hash": "9f64c8153660981a1aabcfda38485b7e366a4aae",
    "title": "2020-08-16 - Manual Unpacking IcedID Write-up",
    "authors": "",
    "file_creation_date": "2022-05-28T15:23:29Z",
    "file_modification_date": "2022-05-28T15:23:29Z",
    "file_size": 1052631,
    "plain_text": "# Manual Unpacking IcedID Write-up\n\n**[kienmanowar.wordpress.com/2020/08/16/manual-unpacking-icedid-write-up/](https://kienmanowar.wordpress.com/2020/08/16/manual-unpacking-icedid-write-up/)**\n\n**Sample hash:**\n\n\nAugust 16, 2020\n\n\n_SHA256: 76cd290b236b11bd18d81e75e41682208e4c0a5701ce7834a9e289ea9e06eb7e_\n\n**Tools:**\n\n[PE files static analysis: PortExAnalyzer;](https://github.com/katjahahn/PortEx) [PE-bear](https://github.com/hasherezade/pe-bear-releases)\n[Debugger & plugin: x64dbg +](https://github.com/x64dbg/x64dbg) [ScyllaHide Anti-Anti-Debug](https://github.com/x64dbg/ScyllaHide)\n[Aplib decompress: aplib-ripper](https://github.com/herrcore/aplib-ripper)\n\n## 1. Static Analysis\n\nThow the sample to PortEx Analyzer, tool will analyse file with a special focus on\nmalformation. We get the results:\n\nThe section .text has high entropy, so may be the sample is packed:\n\n\n-----\n\nThis sample is PE32 with ASLR enabled (can quickly disable this feature by using\n[setdllcharacteristics):](https://blog.didierstevens.com/2010/10/17/setdllcharacteristics/)\n\nThis sample reveals information about the pdb path:\n\nSome anomalies were identified by PortEx:\n\n\n-----\n\n## 2. Dynamic Analysis\n\nLoad specimen to x64dbg, for unpacking process, we set breakpoints at some common\nAPIs:\n```\n   VirtualAlloc\n   VirtualProtect\n   CreateProcessInternalW\n   WriteProcessMemory\n\n```\nAfter placing the breakpoints like above picture, press `F9` to execute. First hit at\n```\nVirtualAlloc :\n\n```\nExecute till Return ( Ctrl+F9 ) and Follow in dump the allocated memory (return in `EAX`\nregister):\n\nContinue run with `F9, hit the second call to` `VirtualAlloc` and observe changes in the\nallocated memory. We see new bytes value was written to this location and it is likely a\nshellcode:\n\n\n-----\n\nOnce again, `Ctrl+F9 and Follow in dump the new allocated memory:`\n\nLet’s continue execute and hit the third call to `VirtualAlloc, some bytes were written to`\nthe new allocated memory. They do not look like shellcode but could be some data that\nmalicious code uses:\n\nContinuing to execute the call to the `VirtuallAlloc` function, we have a newly allocated\nmemory:\n\n\n-----\n\nPress `F9, we break at` `VirtualProtect . The newly allocated device has been filled with`\nbytes. I spotted a PE file that has been compressed using aPlib because the PE magic bytes\n\n`MZ` become `M8Z .`\n\nFollow this section in the Memory Map and dump it to file:\n\n## 3. Decompress dumped file\n\nFrom the command line, simply need to pass dumped file to aprip.py . The tool will do its\njob and each extracted file will be written to a file “dump0.bin”, “dump1.bin”, …\n\n\n-----\n\nCheck `dump0.bin (21dd005162c62af26f3f59e2ebcb345c) with PE-bear:`\n```\nAddressOfEntryPoint = 0x0000163D\n\n```\nValid IATs:\n\n**End!**\n\nm4n0w4r\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-08-16 - Manual Unpacking IcedID Write-up.pdf"
    ],
    "report_names": [
        "2020-08-16 - Manual Unpacking IcedID Write-up.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535983,
    "ts_updated_at": 1743041136,
    "ts_creation_date": 1653751409,
    "ts_modification_date": 1653751409,
    "files": {
        "pdf": "https://archive.orkl.eu/9f64c8153660981a1aabcfda38485b7e366a4aae.pdf",
        "text": "https://archive.orkl.eu/9f64c8153660981a1aabcfda38485b7e366a4aae.txt",
        "img": "https://archive.orkl.eu/9f64c8153660981a1aabcfda38485b7e366a4aae.jpg"
    }
}