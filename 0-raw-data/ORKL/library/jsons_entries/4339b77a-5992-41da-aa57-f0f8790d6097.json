{
    "id": "4339b77a-5992-41da-aa57-f0f8790d6097",
    "created_at": "2022-10-25T16:48:22.791652Z",
    "updated_at": "2025-03-27T02:09:07.965198Z",
    "deleted_at": null,
    "sha1_hash": "0120f4f065c62bcd218bbc21bc729bd3645adf14",
    "title": "Have I Got Newsforyou: Analysis Of Flamer C&C Server",
    "authors": "Symantec",
    "file_creation_date": "2012-09-17T13:20:07Z",
    "file_modification_date": "2012-09-17T13:20:20Z",
    "file_size": 4238903,
    "plain_text": "## Security Response\n\n# Have I Got Newsforyou: Analysis of Flamer C&C Server\n\n#### Symantec Security Response\n\n### Overview\n\n#### Contents W32.Flamer is a sophisticated cyber espionage tool that targeted\nOverview............................................................. 1 the Middle East. It is modular in design and contains some novel\nBackground......................................................... 2 functionality, most notably its ability to spread across networks using\nThe server........................................................... 3 [a previously unknown man-in-the-middle attack against Windows](http://www.symantec.com/connect/blogs/w32flamer-microsoft-windows-update-man-middle)\nThe home directory............................................. 6 [Update. Symantec has performed a detailed forensic analysis of two](http://www.symantec.com/connect/blogs/w32flamer-microsoft-windows-update-man-middle)\nStress testing in applications........................ 6 [of the command-and-control (C&C) servers used in the W32.Flamer](http://www.symantec.com/security_response/writeup.jsp?docid=2012-052811-0308-99)\nCleaning up.................................................... 7 attacks from earlier this year.\nDisabling logging........................................... 7\nThe Web application........................................... 7 Based on our analysis, we were able to uncover details such as when\nAuthors.......................................................... 8 the servers were operational, what entities were targeted, nicknames\nProtocols........................................................ 9 of those involved in the attack, and techniques used by the attackers\nStolen Data.................................................. 11 to avoid discovery should the command-and-control server be\nActivity......................................................... 13 compromised.\nPayload........................................................ 14\n\nAnalysis of these C&C servers was performed as a joint effort between\n\nThe control panel.............................................. 14\n\n[Symantec, CERT-Bund/BSI, IMPACT, and Kaspersky. This paper](https://www.bsi.bund.de/CERT-Bund)\n\nThe database..................................................... 16\n\nfocuses on the detailed forensic examination Symantec carried out on\n\nSchema....................................................... 16\n\nthe C&C server images.\n\nConclusion........................................................ 18\nResources ......................................................... 19\n\n\n-----\n\n### Background\n\nThe first server was set up on May 18, 2012, and, just five hours after it was set up, it recorded the first\ninteraction with a Flamer-compromised client. The server would go on to control at least a few hundred\ncompromised clients over the next few weeks. The second server was set up on March 25, 2012, and controlled\nover a thousand clients in a period of just over one week.\n\nThe servers had been set up to record a minimal amount of information in case of discovery. The systems were\nconfigured to disable any unnecessary logging events and entries in the database were deleted at regular\nintervals. Existing log files were securely deleted from the servers on a regular basis. These steps were taken in\norder to hamper any investigation should the server fall into the hands of investigators or law enforcement.\n\nHowever, the attackers were not thorough enough, as files revealing the entire history of the servers’ setup were\navailable and a limited\nset of encrypted records Figure 1\nin the database revealed Data security compartmentalization used by W32.Flamer attackers\nthat compromised clients\nhad been connecting\nfrom the Middle East. We\nwere also able to recover\nthe nicknames of four\nauthors—D***, H*****,\nO******, and R***—who\nhad worked on the code\nat various stages and on\ndiffering aspects of the\nproject.\n\nOn both servers commandand-control activity\nhappens through a\nWeb application called\nNewsforyou. It processes\nthe W32.Flamer client\ninteractions and provides\na simple control panel.\nThe control panel allows\nthe attackers to upload\npackages of code to\ndeliver to compromised\nclients, and download\npackages containing\nstolen client data.\nHowever, in a technique\nnot previously seen\nbefore the uploaded and\ndownloaded packages are\nencrypted, so infiltrating\nthe command-and-control\nserver does not reveal\nthe code or the stolen\nclient data. The command\n\n-----\n\nand-control server simply serves as a proxy for the data and the data is encrypted and decrypted offline by the\nattackers using keys unique to each client. This application also contains functionality to communicate with\nclients compromised by malware other than Flamer. The Web application was designed to be a framework for\nsupporting different malware campaigns.\n\nIn addition to avoiding the compromise of their operations, preventing both the uploading of rogue code and\nviewing of stolen data, the setup also maintains a clear distinction of roles. The roles include those responsible\nfor setting up the server (admins), those responsible for uploading packages and downloading stolen data\nthrough the control panel (operators), and those holding the private key with the ability to decrypt the stolen\ndata (attack coordinators). The operators themselves may actually be completely unaware of the contents in the\nstolen data. This is due to design of the process to use data security compartmentalization techniques, as shown\nin Figure 1.\n\nDespite these techniques, we were still able to determine that one of the servers delivered a module instructing\n[Flamer to commit suicide and wipe itself off computers in late May 2012, an action we also witnessed through](http://www.symantec.com/connect/blogs/flamer-urgent-suicide)\ncompromised honeypots.\n\nFinally, access to the control panel required a password which is stored as a hash. Despite brute force attempts\nat reversing the hash to plain text, we were unable to determine the plain text password.\n\nWhat follows is a thorough analysis of one of the command-and-control servers, detailing the server setup, the\nWeb application developed by at least four separate authors since 2006, the control panel used by the operators,\nand the database that helps drive the application. The report also includes key information about a second\nserver, but in-depth details have been omitted to maintain the brevity of this report. The functionality and\nstructure of both servers is identical. The differences are mainly in the amount of data and number of clients the\nservers were exposed to.\n\n### The server\n\n File system\n\nThe following table details the important locations relevant to the investigation of the command-and-control\nservers.\n\nTable 1\n\n##### Location Description\n\n/root/.bash_history Contains a history of root user commands\n\n/var/spool/crontabs/root Scripts set up to run at regular intervals\n\n//home/[USERNAME] Operator home directory, contains various scripts\n\n/var/www/htdocs/newsforyou Command-and-Control Web application\n\n/var/lib/mysql MySQL database\n\n### Server setup\n\nThe first sign of activity from the attackers on the first server was May 18, 2012. At 11:26 (UTC) the first\nscheduled job was run and a little over two hours later the server was fully operational. A malicious package was\nuploaded to the server at 13:53. The first recorded interaction with a W32.Flamer compromised client was at\n16:15, when stolen data was uploaded to the server.\n\nIn comparison, the second server saw initial activity on March 25, 2012, and was fully operational on the same\nday.\n\n|Table 1|Col2|\n|---|---|\n|Location /root/.bash_history|Description Contains a history of root user commands|\n|/var/spool/crontabs/root|Scripts set up to run at regular intervals|\n|//home/[USERNAME]|Operator home directory, contains various scripts|\n|/var/www/htdocs/newsforyou|Command-and-Control Web application|\n|/var/lib/mysql|MySQL database|\n|||\n\n\n-----\n\nDuring the server set up, the attackers installed various applications and tested connections to the MySQL\ndatabase which supported their custom Web application. The end goal was to install a command-and-control\napplication called Newsforyou which interacted with compromised W32.Flamer clients.\n\nAn important step taken by the attackers was to hide traces of their activity on the server. They did this by\ndisabling logging and securely removing existing log files. The attackers, however, did not clear out the history\nof commands issued through the console by the administrator (root) account. This data was visible and was\nretrieved from the /root/.bash_history file, which revealed these activities. The following table lists and\ndescribes, in brief, a subset of commands that are most relevant to the server set up:\n\nTable 2\n\n##### Command Executed Description\n\nnetstat –an Checks open network connections\n\ntelnet localhost 3306 Tests MySQL server is accepting connections\n\nnano apache2.conf Configures Web server\n\nadduser [USERNAME] Adds user [USERNAME]\n\ncrontab /etc/cron.newsforyou Cronjob executes scripts at regular intervals\n\nopenssl req -newkey rsa:1024 -nodes -x509 -days Creates SSL key\n\npython __main__.py 0 2 1 \"127.0.0.1\" 100 100 Simulator test to add entry (stolen data)\n\npython __main__.py 2 1-2 1 \"127.0.0.1\" 100 Simulator test to retrieve news entry (payload)\n\nnano /etc/apache2/ports.conf Configures Web server to listen on TCP port 443\n\ncp /home/[USERNAME]/LogWiper_fixed.txt /LogWiper.sh Prepares log wiper file as BASH script\n\nsh /LogWiper.sh Wipes logs and disables logging services\n\nmkdir /var/www/common/ Creates folders to be used in redirection\n\nmkdir /var/www/wp-content/ Creates folders to be used in redirection\n\nmkdir /var/www/pages/ Creates folders to be used in redirection\n\nmkdir /var/www/services/ Creates folders to be used in redirection\n\nnano /etc/apache2/sites-enabled/default-ssl Sets up URL redirects\n\nmkdir -p /var/www/cgi-bin Creates folders to be used in redirection\n\nmkdir -p /var/www/htdocs/newsforyou Create Web appplication folder\n\nphp5 ../DB_creation_script.php Creates database\n\n/etc/init.d/apache2 restart Restarts Web server\n\niptables -A INPUT -p tcp --dport 22 -j ACCEPT Accepts connections on TCP port 22(SSH)\n\niptables -A INPUT -p tcp --dport 443 -j ACCEPT Accepts connections on TCP port 443(HTTPS)\n\nFollowing these commands, the Apache server was configured to listen on TCP ports 443 and 8080. The firewall\nwas also reconfigured to allow connections over SSH and HTTPS. Logging activities were disabled and existing\nlog files were securely deleted where necessary. The server is now ready to interact with compromised Flamer\nclients through the Newsforyou application.\n\nThe attackers also set up some URL redirections to disguise the true nature of the requests to an inexperienced\neye. They would appear to look like legitimate requests for regular looking folder names. An example of one of\nthe redirect rules is shown below:\n\n_/etc/apache2/sites-available/default-ssl_\n\n|Table 2|Col2|\n|---|---|\n|Command Executed netstat –an|Description Checks open network connections|\n|telnet localhost 3306|Tests MySQL server is accepting connections|\n|nano apache2.conf|Configures Web server|\n|adduser [USERNAME]|Adds user [USERNAME]|\n|crontab /etc/cron.newsforyou|Cronjob executes scripts at regular intervals|\n|openssl req -newkey rsa:1024 -nodes -x509 -days|Creates SSL key|\n|python __main__.py 0 2 1 \"127.0.0.1\" 100 100|Simulator test to add entry (stolen data)|\n|python __main__.py 2 1-2 1 \"127.0.0.1\" 100|Simulator test to retrieve news entry (payload)|\n|nano /etc/apache2/ports.conf|Configures Web server to listen on TCP port 443|\n|cp /home/[USERNAME]/LogWiper_fixed.txt /LogWiper.sh|Prepares log wiper file as BASH script|\n|sh /LogWiper.sh|Wipes logs and disables logging services|\n|mkdir /var/www/common/|Creates folders to be used in redirection|\n|mkdir /var/www/wp-content/|Creates folders to be used in redirection|\n|mkdir /var/www/pages/|Creates folders to be used in redirection|\n|mkdir /var/www/services/|Creates folders to be used in redirection|\n|nano /etc/apache2/sites-enabled/default-ssl|Sets up URL redirects|\n|mkdir -p /var/www/cgi-bin|Creates folders to be used in redirection|\n|mkdir -p /var/www/htdocs/newsforyou|Create Web appplication folder|\n|php5 ../DB_creation_script.php|Creates database|\n|/etc/init.d/apache2 restart|Restarts Web server|\n|iptables -A INPUT -p tcp --dport 22 -j ACCEPT|Accepts connections on TCP port 22(SSH)|\n|iptables -A INPUT -p tcp --dport 443 -j ACCEPT|Accepts connections on TCP port 443(HTTPS)|\n\n\n-----\n\n```\n    ScriptAlias /cgi-bin/ /var/www/cgi-bin/\n    <Directory “/var/www/cgi-bin”>\n       AllowOverride None\n       Options +ExecCGI -MultiViews +SymLinksIfOwnerMatch\n       Order allow,deny\n       Allow from all\n       RewriteEngine on\n       RewriteRule ^counter\\.cgi$ /newsforyou/index.php\n    </Directory>\n\n### Scheduled tasks\n\n```\nA cronjob was set up to periodically delete files from the file system and remove older entries from the database:\n\n_/etc/cron.newsforyou_\n\n|Table 3|Col2|\n|---|---|\n|Repeat Interval 2 minutes|Command /var/www/htdocs/newsforyou/UnloadChecker.php >> /var/log/newsforyou.log|\n|6 hours|* python /home/[USERNAME]/pycleaner/Eraser.py|\n|@Midnight|php /home/[USERNAME]/delete.php|\n\n\nUnloadChecker.php, which is\nexecuted every two minutes,\nretrieves data uploaded from the\ncompromised computer and places\nit in a tar archive. The archive\ncould then be downloaded by the\noperators. Eraser.py is a script used\nto wipe certain files and content\nfrom folders. On one of the servers\nthe operators made an error when\nsetting up the scheduled task. They\nused the folder name pycleaner\nwhen creating the task, but this\nfolder does not exist. The folder\ncontaining the script is pycleanscr.\nAs a result, the Eraser.py script was\nnever automatically executed.\n\nFigure 2 illustrates the simple setup\nnow in place for communicating with\nW32.Flamer compromised clients.\n\nThe next sections discuss the files\nand applications of most interest to\nthe investigation, along with their\nlocations. The analysis begins in the\nhome directory of the unique added\nuser, a folder that is created once\nthe user is added during the initial\nset up. The usernames here were\n\n\nFigure 2\n##### Communications between C&C server and compromised computers\n\n\n-----\n\nshort three-letter names, unique to each server.\n\n### The home directory\n\n_Location: /home/[USERNAME]_\n\nThe following table contains the location and a brief description of the files and folders present in the user’s\nhome directory:\n\nTable 4\n\n##### File/Directory Description\n\n./.bashrc Standard .bashrc with no modifications\n\nSimulator/ Python application used to test the Newsforyou application\n\npycleanscr/ Python application used to free up disk space if necessary\n\n./LogWiper_fixed.txt Script which disables logging and securely deletes specific log files\n\n./RequestHandler.php Used in the Newsforyou Web application\n\n./Delete.php PHP script which delete files and entries in the MySQL database\n\n### Stress testing the application\n\n Simulator\n\nThis application consists of a set of Python scripts, which are used to stress test the Newsforyou application.\nThis application was only present on one of the servers. The application connects to a chosen server and issues\nvarious queries that conform to the C&C server protocol. The tests performed during the set up were to add an\nentry (stolen data) and to retrieve a news entry (payload).\n\nA point of interest here is the presence of dnslocation.info as part of the HTTP request header the script builds in\na file named Connection.py. This is a known Flamer C&C server domain, indicating that the code is being shared\nand used to test across various C&C servers. The timestamp on this file supports this idea as it is stamped March\n22, 2012.\n\nWhen a Python script is executed, a compiled Python file (.pyc) is generated. Examining these files, we confirmed\nthis application was executed on May 18 which corroborates our finding about the system configuration date.\n\n|Table 4|Col2|\n|---|---|\n|File/Directory ./.bashrc|Description Standard .bashrc with no modifications|\n|Simulator/|Python application used to test the Newsforyou application|\n|pycleanscr/|Python application used to free up disk space if necessary|\n|./LogWiper_fixed.txt|Script which disables logging and securely deletes specific log files|\n|./RequestHandler.php|Used in the Newsforyou Web application|\n|./Delete.php|PHP script which delete files and entries in the MySQL database|\n|||\n\n\n-----\n\n### Cleaning up\n\n pycleanscr\n\npycleanscr checks how much free disk space is available on the root partition. It deletes the files in /var/www/\nhtdocs/newsforyou/tmp/ if the amount of the disk space in use is greater than 75 percent.\n\n### Delete.php\n\nDeletes entries in the news_entries table of the MySQL database and securely deletes the files referenced by\nthat entry on disk that are older than 30 days.\n\n### Disabling logging\n\n LogWiper_fixed.txt\n\nThis .txt file is renamed to a .sh BASH script and run to disable logging services, to securely delete any prior log\nfiles created, and to disable logging in two particular applications required by the attackers: Apache and SSH.\n\nTable 5\n\n##### Log files deleted Services disabled Services with logging disabled\n\n/var/log/wtmp Rsyslog Apache\n\n/var/log/lastlog Sysklogd SSH\n\n/var/run/utmp Msyslog\n\n/var/log/mail.* syslog-ng\n\n/var/log/syslog*\n\n/var/log/messages\n\nhidden files in /root and /\nhome\n\n/var/log/auth/*\n\n/var/log/apache2/*\n\nFiles are securely deleted using Shred, a tool that repeatedly overwrites files to prevent their recovery, even\nforensically.\n\nThe next section will discuss the Web application processing the compromised W32.Flamer client requests.\n\n### The Web application\n\n_Location: /var/www/htdocs/newsforyou/_\n\nThe Newsforyou application is written in PHP and contains the primary command-and-control functionality split\ninto two parts: the main module and the control panel. The control panel is a basic user interface which allows\npackages to be uploaded and installed on chosen W32.Flamer clients. It also allows for the retrieval of stolen\ndata that had been uploaded from these clients.\n\n|Table 5|Col2|Col3|\n|---|---|---|\n|Log files deleted /var/log/wtmp|Services disabled Rsyslog|Services with logging disabled Apache|\n|/var/log/lastlog|Sysklogd|SSH|\n|/var/run/utmp|Msyslog||\n|/var/log/mail.*|syslog-ng||\n|/var/log/syslog*|||\n|/var/log/messages|||\n|hidden files in /root and / home|||\n|/var/log/auth/*|||\n|/var/log/apache2/*|||\n\n\n-----\n\nThe table below describes the layout and offers a brief description of the components of the Newsforyou\napplication:\n\nTable 6\n\n##### Directories Description\n\n/newsforyou Main command and control application\n\n/newsforyou/news Encrypted packages distributed to all infected clients*\n\n/newsforyou/ads Encrypted packages distributed to chosen infected clients**\n\n/newsforyou/entries Encrypted data uploaded from infected clients**\n\n/newsforyou/files Temporary location for files when creating unloads\n\n/newsforyou/tmp Temporary files (database exports, tar archives)\n\n/newsforyou/bak Archives generated when unloading\n\n/newsforyou/CP Control panel\n\n*Symmetric encryption with known key\n**Asymmetric encryption with known public key, private key unknown\n\nThe application is designed to resemble a simple news/blog application. This approach may serve to disguise\nthe true nature of the application from any automation or casual inspection. Although the code was running on\na Linux server, it is likely some of the command-and-control servers were running Windows, or at least that the\ncode was developed and tested on Windows computers.\n\nThe following comment was present in one of the PHP files:\n```\n    -- This function was added by D***, returns a true/false value\n    depending on if this is a Windows box\n\n### Authors\n\n```\nThe PHP source code references four authors, identified in the table below, and also attributes to them\nparticular functionality within the code:\n\nTable 7\n\n##### @author Edited Files Dates Control Panel Protocols Database Cleanup Encryption\n\n12/4/2006\nD*** 33 X X X X X\n01/23/2007\n\nH***** 10 09/02/2007 X X X X\n\nO****** 4 12/3/2006 X\n\nR*** 1 2011 X\n\nIt is clear that D*** and H***** had the most input into the project, having edited the most files in the\napplication. O****** and R*** were tasked with database and cleanup operations and could easily have had little\nor no understanding of the inner workings of the application.\n\nHowever, D*** and H***** have direct involvement in handling interactions with clients, as they worked on the\nprotocols and also worked on the control panel that the operators used. It is likely D*** and O****** knew each\nother, as they both worked on the same files and during a similar time period in December 2006.\n\n|Col1|Col2|\n|---|---|\n|Table 6||\n|Directories /newsforyou|Description Main command and control application|\n|/newsforyou/news|Encrypted packages distributed to all infected clients*|\n|/newsforyou/ads|Encrypted packages distributed to chosen infected clients**|\n|/newsforyou/entries|Encrypted data uploaded from infected clients**|\n|/newsforyou/files|Temporary location for files when creating unloads|\n|/newsforyou/tmp|Temporary files (database exports, tar archives)|\n|/newsforyou/bak|Archives generated when unloading|\n|/newsforyou/CP|Control panel|\n\n|Table 7|Col2|Col3|Col4|Col5|Col6|Col7|Col8|\n|---|---|---|---|---|---|---|---|\n|@author D***|Edited Files 33|Dates 12/4/2006 01/23/2007|Control Panel X|Protocols X|Database X|Cleanup X|Encryption X|\n|H*****|10|09/02/2007|X|X|X||X|\n|O******|4|12/3/2006|||X|||\n|R***|1|2011||||X||\n\n\n-----\n\nH***** is responsible for the SignupProtocol, while D*** is involved in the OldProtocol (Flamer), both of which\nwill be discussed in more detail in the next section.\n\n### Protocols\n\nThe main module communicating with the compromised clients is index.php. It deciphers the protocol then\nlogs, decodes, and processes requests. Four protocols have been identified, of which three are in use. The Red\nprotocol has not been implemented yet.\n\nThe existence of three supported protocols, along with one protocol under development, confirms the C&C\nserver’s requirement to communicate with multiple evolutions (variants) of W32.Flamer or additional cyberespionage malware families currently unknown to the public.\n\n\n-----\n\nThese protocols are identified in the table below:\n\nTable 8\n\n##### Protocol Identifier Protocol Request\n\nPROTOCOL_OLD* HTTPS UNIQUE_NUMBER=[DIGITS]&PASSWORD=LifeStyle2\n\nPROTOCOL_SIGNUP HTTPS uid=[DIGITS]&action=[DIGITS]\n\nPROTOCOL_OLD_E** HTTP NOT(uid=[DIGITS]&action=[DIGITS])\n\nPROTOCOL_RED N/A N/A\n\n*Used by W32.Flamer\n**PROTOCOL_OLD with custom encryption over HTTP\n\nSpecific requests handled by the application are:\n\nTable 9\n\n##### Request Functionality\n\nGetNewsHandler Responsible for sending news to compromised clients\n\nAddEntryHandler Responsible for storing entries (stolen data) from compromised clients\n\nGetAdHandler Responsible for sending ads to compromised clients\n\nThe possibility that multiple Trojans, or at least evolutions of W32.Flamer, are at work here is backed up by the\nfact that four different IDs are used internally to identify them:\n\n|Table 8|Col2|Col3|\n|---|---|---|\n|Protocol Identifier PROTOCOL_OLD*|Protocol HTTPS|Request UNIQUE_NUMBER=[DIGITS]&PASSWORD=LifeStyle2|\n|PROTOCOL_SIGNUP|HTTPS|uid=[DIGITS]&action=[DIGITS]|\n|PROTOCOL_OLD_E**|HTTP|NOT(uid=[DIGITS]&action=[DIGITS])|\n|PROTOCOL_RED|N/A|N/A|\n||||\n\n|Table 9|Col2|\n|---|---|\n|Request GetNewsHandler|Functionality Responsible for sending news to compromised clients|\n|AddEntryHandler|Responsible for storing entries (stolen data) from compromised clients|\n|GetAdHandler|Responsible for sending ads to compromised clients|\n|||\n\n|Table 10|Col2|Col3|Col4|\n|---|---|---|---|\n|Client CLIENT_TYPE_SP|Internal ID 1|Protocol PROTOCOL_OLD|Threat Unknown|\n|CLIENT_TYPE_SPE|2|PROTOCOL_OLD_E|Unknown|\n|CLIENT_TYPE_FL|3|PROTOCOL_OLD|W32.Flamer|\n|CLIENT_TYPE_IP|6|PROTOCOL_SIGNUP|Unknown|\n|N/A|N/A|PROTOCOL_RED|Unknown|\n|||||\n\n\n-----\n\nIt is likely here that CLIENT_TYPE_SP, CLIENT_TYPE_SPE, and CLIENT_TYPE_FL implemented by D*** are evolutions\nof the same threat. However, CLIENT_TYPE_IP which is implemented by H***** appears to come after the in-use\nFlamer protocol, which suggests that either new variants exist that we are unaware of, or there is a separate Trojan\nat work. They also included an unrecognized fallback for clients.\n\n### Stolen Data\n\nCompromised clients upload stolen data to the entries directory. Files stored in this directory are encrypted with a\npublic key stored in the database. These files cannot be decrypted without the corresponding private key. There was\na file of 157,548 bytes still left on the server that the operators did not have the opportunity to download.\n\nThe stolen data is encrypted with this public key on the server, thus requiring the corresponding unknown private key\nto decrypt:\n```\n    -----BEGIN PUBLIC KEY----    MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAtZslxFiR9KJE05Nhh7Xk\n    +lVVpD9F6AQnvZeknDiwL3SBjZB/dB/LLXtwiet8LUS6JYCXnaIq4NxW1PymwGFZ\n    zuc/B3p+ZAFPt06veOHOfaMAI0KDMb+laNPINvn/jJ8TfvCaUMUuMEY4sayh0xwD\n    MwSAazMYI8rvaaS/BqhI/6vPN6D02UIpwT1TSBVeRRoPBHuYE7A93b8vJw9sBGIp\n    KXZ90sgP1CjdAmCbhYelelninKdeTKCGvd5YXt86grWgEVf5WXzxXi3ZK1T4w0Yt\n    mNhUEAwS7zCdtZ+Ak8b0M83wAirASvPZiBl6qF8hqCT5pKkwgBG//kk8JicboLsM\n    VQIDAQAB\n    -----END PUBLIC KEY----\n```\nBased on timestamps seen on the first server in the /newsforyou/bak directory we determined that the operators\ndownloaded the stolen data on four separate dates in May.\n\n|Col1|Col2|\n|---|---|\n|Table 11||\n|Date 2012-05-22|Stolen data files 112|\n|2012-05-23|12|\n|2012-05-24|11|\n\n\nHere is a snippet of code that identified connecting clients:\n\n\n2012-05-30 43\n\n\n-----\n\nA total of around 75 MB of stolen data was found in the backups on one of the servers (server #1). Although the\ntiming data is limited here, the timestamps of these backups suggest that the operators could be in the EMEA region.\nThere was a four-day delay from the initial setup to when the operators began to retrieve stolen data. This is a\npossible indicator that the information about the new server had to take time to filter down to them.\n\nFigure 3.1\n##### Megabytes of stolen data by date, server #1\n\nIn comparison, the other server (server #2) saw a massive 5.7 GB of stolen data:\n\nFigure 3.2\n##### Megabytes of stolen data by date, server #2\n\n\nA total of around 75 MB of stolen data was found in the backups on one of the servers (server #1). Although the\n\n\n-----\n\n### Activity\n\nBy examining the files in the bak directories, specifically the number of files contained within the backup archives\ncreated each day, it is possible to obtain an indication of the activity of the C&C server, which can be seen in the\nchart below:\n\nFigure 4.1\n##### Number of backup archives created each day, server #1\n\nFigure 4.2\n##### Number of backup archives created each day, server #2\n\nOn the first server, there is a clear increase in activity around May 20, which then drops off. This is to be expected as\ncomputers are cleared up.\n\nOn the second server the Flamer operation is in full flow and huge volumes of files are being created on the system.\n\n\n-----\n\n### Payload\n\nThe news directory contains a compressed and encrypted file for distribution to the compromised clients connecting\nto the server. This file is encrypted with a known symmetric key retrieved from the database.\n\nTable 12\n\n##### MD5 Filename File size\n\n0xfccd97e2513089e74ba707bbf4c1b0e5 59c5452fb2ba21091513ccdc1e0ec7fd 204,024 bytes\n\n[This is the browse32.ocx Flamer module, the sole purpose of which is to remove all known traces of the Flamer](http://www.symantec.com/connect/blogs/flamer-urgent-suicide)\nmalware from the compromised client.\n\nThe payload is encrypted with this symmetric key:\n```\n       R&^T&IOHIO%^&^E%@#$UIO*()\n\n### The control panel\n\n```\nAccess to the Flamer control panel requires authentication:\n\nFigure 5\n##### Control panel login page\n\nThe following credentials are used to gain access to the control panel (only the MD5 password hash is available;\nattempts to crack the password were unsuccessful):\n\nUsername: username\nPassword Hash: 27934e96d90d06818674b98bec7230fa\n\nThe control panel for interacting with Flamer-compromised computers is very basic. The simple interface allows the\noperators to upload packages and download encrypted data stolen from the compromised clients. The operator is\nrequired to upload specially crafted tar.gz files. The archived filename needs to follow a specific format, which is\nparsed and then stored in the ads or news directory, depending on the file extension used.\n\nThe filename format for these packages is as follows:\n```\n       [USER _ TYPE] _ [USER _ ID] _ [PRIORITY] _ [TEMP _ FLAG][OPTIONAL _ AND _ IGNORED].news\n       [USER _ TYPE] _ [USER _ ID] _ [EXPIRY _ TIME] _ [AD _ NAME].ad\n\n```\n|Table 12|Col2|Col3|\n|---|---|---|\n|MD5 0xfccd97e2513089e74ba707bbf4c1b0e5|Filename 59c5452fb2ba21091513ccdc1e0ec7fd|File size 204,024 bytes|\n||||\n\n\n-----\n\nThe following is a screen shot of the control panel that allows the operator to upload data to the server:\n\nFigure 6\n##### Control panel data upload screen\n\nThis approach to uploading packages and downloading data fits the profile of military and intelligence operations.\nA typical control panel is easy to use and self-explanatory. The operator has full control over what to do with the\ncompromised clients and has the ability to retrieve and inspect the stolen information. The Flamer control panel\nprovides limited capabilities to the operator, preventing them from viewing and interpreting the information being\nexchanged.\n\nThis approach would help prevent operators from knowing what is contained within the packages or the significance\nof the data being exchanged between clients and the attackers. Such a design would also serve as a defensive\nmeasure as it would prevent arbitrary packages from being uploaded and prevent downloaded data being from being\ninspected by unknown parties that may have gained access to the control panel.\n\nThe following screen on the control panel allows the user to view and download backed up data from the server:\n\nFigure 7\n##### Control panel screen for downloading stolen data\n\n\n-----\n\nThe tar.gz contains all the relevant stolen data and details of where the information was stolen from. The private key\nis required here to inspect the encrypted data.\n\n### The database\n\n_Location: /var/lib/mysql_\n\nThe database is used to store the relevant data about connecting clients, packages to send to the clients, some\nlogging and settings required for encryption, and authentication to access the control panel.\n\nTable 13\n\n##### Database User Password\n\nMySQL news_user news_pass\n\n### Schema\n\nThe database is used to store the relevant data about connecting clients, packages to send to the clients, some\nlogging and settings required for encryption, and authentication to access the control panel.\n\nFigure 8\n##### Newsforyou application database schema\n\n|Table 13|Col2|Col3|\n|---|---|---|\n|Database MySQL|User news_user|Password news_pass|\n\n\n-----\n\nThe session_log, log, and client_log are all encrypted using the keys stored in the settings table shown below and\nwere successfully decrypted:\n\nTable 14\n\n##### Variable Value\n\nis_online True\n\ncp_user username\n\ncp_hash 8 27934e96d90d06818674b98bec7230fa\n\nmax_backup_size 52428800\n\nversion 1.4.11.4.1\n\nminimum_unload_size 1572864\n\nunload_flag 0\n\ngeneral_key acK3xKMoJzsa9AVvtg59+OT4RM/x5MQ3bO2p0j+5Jd0=\n\nsession_key 13eZ+Now4Pt5ATpPv3WUv1E8UrvJReVMD0pO0MTQqoI=\n\nThe database is regularly emptied by the delete.php script; there is limited data in it. The following table gives a brief\ndescription of the tables found in the database:\n\nTable 15\n\n##### Table Records Record Id Encryption Description\n\nsettings 11 11 N Configuration values listed in the table below\n\nsession_log 8 1144 Y Encrypted session log\n\nclient_log 4 1071 Y Encrypted client log\n\nlog 213 21259 Y Encrypted logs\n\nnews_entries 1 1 N Entries in newsforyou/news (payloads)\n\nblog_entries 1 189 N Entries in newsforyou/entries (stolen data)\n\nads 0 n/a N Ad files in newsforyou/ads/\n\nbackup 4 4 N Backup files in newsforyou/bak/\n\nThe session_log table contains details of all connections to the server while client_log only contains connections\nwith a recognized protocol (e.g. valid compromised computers).\n\nExamining the data in the table indicates that 1071 valid requests were recorded from compromised clients. A\ndecrypted client log entry contains the following information:\n```\n    CLIENT _ ID:[UUID]\n    CLIENT _ TYPE:3\n    CLIENT _ VERSION:0\n    REQUEST _ TYPE:0\n    RAW _ REQUEST:UNIQUE _ NUMBER=[UUID]&PASSWORD=LifeStyle2&ACTION=1&FILE _\n    NAME=&FILE _ SIZE=0\n    PROTOCOL:1\n\n```\nThe four encrypted requests in the database on the first server are W32.Flamer client requests, which use the old\nprotocol:\n\n    - CLIENT = 3 = CLIENT_TYPE_FL\n\n    - PROTOCOL = 1 = OLD_PROTOCOL\n\n|Table 14|Col2|\n|---|---|\n|Variable is_online|Value True|\n|cp_user|username|\n|cp_hash 8|27934e96d90d06818674b98bec7230fa|\n|max_backup_size|52428800|\n|version|1.4.11.4.1|\n|minimum_unload_size|1572864|\n|unload_flag|0|\n|general_key|acK3xKMoJzsa9AVvtg59+OT4RM/x5MQ3bO2p0j+5Jd0=|\n|session_key|13eZ+Now4Pt5ATpPv3WUv1E8UrvJReVMD0pO0MTQqoI=|\n\n|Table 15|Col2|Col3|Col4|Col5|\n|---|---|---|---|---|\n|Table settings|Records 11|Record Id 11|Encryption N|Description Configuration values listed in the table below|\n|session_log|8|1144|Y|Encrypted session log|\n|client_log|4|1071|Y|Encrypted client log|\n|log|213|21259|Y|Encrypted logs|\n|news_entries|1|1|N|Entries in newsforyou/news (payloads)|\n|blog_entries|1|189|N|Entries in newsforyou/entries (stolen data)|\n|ads|0|n/a|N|Ad files in newsforyou/ads/|\n|backup|4|4|N|Backup files in newsforyou/bak/|\n||||||\n\n\n-----\n\nThe additional sessions logged are likely attributed to researchers who had discovered the whereabouts of the\ncommand-and-control servers.\n\nTable 16\n\n##### IP Address Organization Country client_log\n\n77.42.[REMOVED] LIBANTELECOM Lebanon Y\n\n37.8. [REMOVED] Israel Haifa Hadara Technologies Private Shareholding Company Israel Y\n\n37.75. [REMOVED] Orange Palestine Group Co. for Technological Inves Palestine Y\n\n79.212. [REMOVED] Deutsche Telekom AG Germany N\n\n95.211. [REMOVED] LeaseWeb B.V. Netherlands N\n\nThe session_log data contained three separate HTTP_HOST values, indicating multiple Flamer C&C server URLs were\nused to access this server.\n\nAlthough only one encrypted file existed in the newsforyou/entries folder (the stolen data uploaded from the\ncompromised clients), the database reveals that 189 records had been created. The other 188 files had already been\nremoved from the server. The entry left on the server had been successfully stolen from the computer located in\nIsrael.\n\nA final point to note here is in relation to the entry in the news_entries table. Only one record ever existed: the\nmalicious payload to clean the computers up, uploaded on May 18, 2012, at 13.43:45. This server only served up one\npackage and it was uploaded as soon as the server had been initially configured. The last time a compromised client\nconnected to the server was Friday, June 1, 2012, at 11:42:47, and the last log recorded in the database was Friday,\nJune 1, 2012, at 11:46:01.\n\n### Conclusion\n\nExamining the W32.Flamer servers has provided additional insight into the architecture of not only the threat, but\nalso into the command structure of the entities behind it. The server code was written and updated by at least four\nseparate individuals, indicating a continuing development effort to support W32.Flamer and, potentially, new or\nadditional threats of a similar nature. The command-and-control Web application has been in active development for\nmany years, possibly as early as 2006, which is well before Flamer’s earliest seen compilation date in 2010.\n\nThe operators of the C&C servers may be a group of less senior individuals, working on a need-to-know basis, as the\noperator is not required (nor has the permission) to interpret the value or purpose of the incoming data. Only the\nattackers have the permission to access and interpret this data. This separation of operational and attacker visibility\nand roles indicates that this is the work of a highly organized and sophisticated group. The likelihood of a large and\nwell-funded entity’s involvement in Flamer is corroborated by the use of the unique certificate weakness used to\nhijack the Windows Update feature to spread across networks.\n\nThey were also careful to unload and archive data where necessary, remove duplicate files, and delete unnecessary\nfiles to prevent the server from running out of disk space. This was an ongoing development up to 2011. R***’s edits\nin the source code suggest the concern was less about updating protocols and more about ensuring there was ample\nroom on the servers for the stolen data to be uploaded to, begging the question of how much data was actually being\nstolen.\n\nThis investigation simply provides a snapshot in time of the Flamer attack campaign. Considering that logging was\ndisabled and data was wiped clean in such a thorough manner, the remaining clues make it virtually impossible to\ndetermine the entity behind the campaign. There is little doubt that the larger project involving cyber-espionage\ntools, such as Flamer, will continue to evolve and retrieve information from the designated targets.\n\n|Table 16|Col2|Col3|Col4|\n|---|---|---|---|\n|IP Address 77.42.[REMOVED]|Organization LIBANTELECOM|Country Lebanon|client_log Y|\n|37.8. [REMOVED]|Israel Haifa Hadara Technologies Private Shareholding Company|Israel|Y|\n|37.75. [REMOVED]|Orange Palestine Group Co. for Technological Inves|Palestine|Y|\n|79.212. [REMOVED]|Deutsche Telekom AG|Germany|N|\n|95.211. [REMOVED]|LeaseWeb B.V.|Netherlands|N|\n|||||\n\n\n-----\n\n### Resources\n\nFlamer: Highly Sophisticated and Discreet Threat Targets the Middle East\n[http://symantec.com/connect/blogs/flamer-highly-sophisticated-and-discreet-threat-targets-middle-east](http://symantec.com/connect/blogs/flamer-highly-sophisticated-and-discreet-threat-targets-middle-east)\n\nPainting a Picture of W32.Flamer\n[http://symantec.com/connect/blogs/painting-picture-w32flamer](http://symantec.com/connect/blogs/painting-picture-w32flamer)\n\nFlamer: A Recipe for Bluetoothache\n[http://symantec.com/connect/blogs/flamer-recipe-bluetoothache](http://symantec.com/connect/blogs/flamer-recipe-bluetoothache)\n\nW32.Flamer: Spreading Mechanism Tricks and Exploits\n[http://symantec.com/connect/blogs/w32flamer-spreading-mechanism-tricks-and-exploits](http://symantec.com/connect/blogs/w32flamer-spreading-mechanism-tricks-and-exploits)\n\nW32.Flamer: Leveraging Microsoft Digital Certificates\n[http://symantec.com/connect/blogs/w32flamer-leveraging-microsoft-digital-certificates](http://symantec.com/connect/blogs/w32flamer-leveraging-microsoft-digital-certificates)\n\nW32.Flamer: Microsoft Windows Update Man-in-the-Middle\n[http://symantec.com/connect/blogs/w32flamer-microsoft-windows-update-man-middle](http://symantec.com/connect/blogs/w32flamer-microsoft-windows-update-man-middle)\n\nW32.Flamer: Enormous Data Collection\n[http://symantec.com/connect/blogs/w32flamer-enormous-data-collection](http://symantec.com/connect/blogs/w32flamer-enormous-data-collection)\n\nFlamer: Urgent Suicide\n[http://symantec.com/connect/blogs/flamer-urgent-suicide](http://symantec.com/connect/blogs/flamer-urgent-suicide)\n\n\n-----\n\nAny technical information that is made available by Symantec Corporation is the copyrighted work of Symantec Corporation and is owned by Symantec\nCorporation.\n\nNO WARRANTY . The technical information is being delivered to you as is and Symantec Corporation makes no warranty as to its accuracy or use. Any use of the\ntechnical documentation or the information contained herein is at the risk of the user. Documentation may include technical or other inaccuracies or typographical\nerrors. Symantec reserves the right to make changes without prior notice.\n\n**About Symantec**\nSymantec is a global leader in\nproviding security, storage and\nsystems management solutions to\n\n\nFor specific country offices and contact numbers, please visit our Web site. For product\ninformation in the U.S., call\ntoll-free 1 (800) 745 6054.\n\n\nSymantec Corporation\nWorld Headquarters\n350 Ellis Street\nMountain View, CA 94043 USA\n+1 (650) 527-8000\nwww.symantec.com\n\n\n**About Symantec**\nSymantec is a global leader in\nproviding security, storage and\nsystems management solutions to\nhelp businesses and consumers\nsecure and manage their information.\nHeadquartered in Mountain View, Calif.,\nSymantec has operations in more\nthan 40 countries. More information\nis available at www.symantec.com.\n\nCopyright © 2012 Symantec Corporation. All rights reserved.\nSymantec and the Symantec logo are trademarks or registered\ntrademarks of Symantec Corporation or its affiliates in the\nU.S. and other countries. Other names may be trademarks of\ntheir respective owners.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        },
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/6ujt4gi1c962id9o4iviesurww2grbxi",
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2012/2012.05.18.Flamer_CnC/w32_flamer_newsforyou.pdf"
    ],
    "report_names": [
        "w32_flamer_newsforyou"
    ],
    "threat_actors": [
        {
            "id": "eb3f4e4d-2573-494d-9739-1be5141cf7b2",
            "created_at": "2022-10-25T16:07:24.471018Z",
            "updated_at": "2025-03-27T02:02:10.24394Z",
            "deleted_at": null,
            "main_name": "Cron",
            "aliases": [],
            "source_name": "ETDA:Cron",
            "tools": [
                "Catelites",
                "Catelites Bot",
                "CronBot",
                "TinyZBot"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716502,
    "ts_updated_at": 1743041347,
    "ts_creation_date": 1347888007,
    "ts_modification_date": 1347888020,
    "files": {
        "pdf": "https://archive.orkl.eu/0120f4f065c62bcd218bbc21bc729bd3645adf14.pdf",
        "text": "https://archive.orkl.eu/0120f4f065c62bcd218bbc21bc729bd3645adf14.txt",
        "img": "https://archive.orkl.eu/0120f4f065c62bcd218bbc21bc729bd3645adf14.jpg"
    }
}