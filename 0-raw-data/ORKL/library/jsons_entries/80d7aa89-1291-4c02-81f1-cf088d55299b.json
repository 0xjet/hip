{
    "id": "80d7aa89-1291-4c02-81f1-cf088d55299b",
    "created_at": "2023-01-12T15:10:45.748452Z",
    "updated_at": "2025-03-27T02:08:40.385032Z",
    "deleted_at": null,
    "sha1_hash": "54d657423c503e8d44d370f9f1e06d442bd4db2a",
    "title": "2019-09-17 - Nemty Ransomware 1.0- A Threat in its Early Stage",
    "authors": "",
    "file_creation_date": "2022-05-28T19:03:00Z",
    "file_modification_date": "2022-05-28T19:03:00Z",
    "file_size": 190948,
    "plain_text": "# Nemty Ransomware Analysis: Technical Details & IOCs\n\n**[fortinet.com/blog/threat-research/nemty-ransomware-early-stage-threat.html](https://www.fortinet.com/blog/threat-research/nemty-ransomware-early-stage-threat.html)**\n\nSeptember 17, 2019\n\nIn 2019, FortiGuard Labs was investigating the Sodinokibi ransomware family, when we\ncame across the newly discovered Nemty Ransomware. Interestingly, as we analyzed this\n[new malware, we also encountered an artifact embedded in its binary that we were very](https://www.fortinet.com/resources/cyberglossary/malware?utm_source=blog&utm_campaign=malware)\n[much familiar with since it was also used by the GandCrab ransomware before the threat](https://www.fortinet.com/blog/threat-research/gandcrab-honor-among-thieves?utm_source=blog&utm_campaign=gandcrab-honor-among-thieves)\n[actors’ announced retirement. It is also interesting to see that the Nemty ransomware is](https://www.fortinet.com/blog/threat-research/gandcrab-threat-actors-retire?utm_source=blog&utm_campaign=gandcrab-threat-actors-retire)\nbeing distributed using the same method as Sodinokibi, a malware that has strong\nsimilarities to GandCrab.\n\n[This report discusses the technical aspects of the new ransomware, including some](https://www.fortinet.com/resources/cyberglossary/ransomware?utm_source=blog&utm_campaign=ransomware)\nirregularities that make us think that it is still in its early stage of development.\n\n## Discovery\n\nThe first sample that we were able to analyze came from a link that was shared by\nthe [@BotySrt Twitter bot account, which posts Pastebin links leading to the Sodinokibi and](https://twitter.com/BotySrt)\nBuran malware families.\n\nFigure 1. Link that was supposed to lead to a Sodinokibi payload\n\n\n-----\n\n[The links lead to Powershell scripts that execute embedded malware payloads](https://www.fortinet.com/blog/threat-research/offense-and-defense-a-tale-of-two-sides-powershell?utm_source=blog&utm_campaign=offense-and-defense-a-tale-of-two-sides-powershell)\nusing [Reflective PE Injection. We collected the links that were tagged as Sodinokibi,](https://powersploit.readthedocs.io/en/latest/CodeExecution/Invoke-ReflectivePEInjection/)\nexpecting to extract samples of that ransomware. However, as we were running our\nautomation to extract the embedded binaries, we found an unsupported file, and as we\ninvestigated further, we discovered it was the new Nemty ransomware instead.\n\n## A GandCrab Flashback\n\nIn our initial analysis of the ransomware, we found a link embedded in its binary which we\nare very familiar with. It is a statement that was actually used by GandCrab when it was\nhaving its vaccine war with Ahnlab, as we detailed previously in our article discussing the\n[evolution of GandCrab v4.x.](https://www.fortinet.com/blog/threat-research/a-chronology-of-gandcrab-v4-x?utm_source=blog&utm_campaign=a-chronology-of-gandcrab-v4-x)\n\nFigure 2. Embedded link leading to an image\n\nFigure 3. GandCrab’s version of the image\n\nThe similarities end there, however, so it is hard to say early on if there is any real relation to\nthe two. But the inclusion of this artifact, combined with the fact that it is being distributed by\nthe same group as Sodinokibi (which many see as the reincarnation of GandCrab) makes us\ncurious.\n\n## Technical Analysis\n\nIt’s interesting that GandCrab and Nemty have something in common. But to understand\nwhat makes Nemty unique, we’ll have to engage in a technical analysis. Here’s what we\nfound:\n\n### Obfuscation\n\nThe strings used throughout Nemty’s execution are obfuscated using a combination of\n[simple base64 encoding and RC4 encryption. And to express their unsurprising animosity](https://www.fortinet.com/resources/cyberglossary/encryption?utm_source=blog&utm_campaign=encryption)\ntowards the security industry, this variant use ‘f**kav\\x00’ as its vulgar RC4 encryption key.\n\nFigure 4. String decryption using base64 and RC4 algorithm\n\n### Nemty’s File Encryption Methods\n\nNemty ransomware uses a combination of AES-128 in CBC mode, RSA-2048, and the\nunusual RSA-8192 for its file encryption and key protection. The following steps summarize\nits encryption process.\n\n1. Generate a 32-byte value using a pseudo-random algorithm. This value is added to\n\nthe configuration information later on. The first 16 bytes are used as the main AES key\nfor file encryption.\n\n\n-----\n\nFigure 5. Function to generate random characters\n\n2. Generate an RSA-2048 key pair.\n\n[3. Decrypt and import the embedded RSA-8192 Public Key using the same RC4-base64](https://www.fortinet.com/resources/cyberglossary/public-key-infrastructure?utm_source=blog&utm_campaign=public-key-infrastructure)\nfunction.\n\nFigure 6. Embedded RSA-8192 Public Key\n\n4. Include the generated Private Key from step 2 to the configuration file, which also contains\nother information gathered from the system (discussed in the next section)\n\n5. Encrypt the configuration file using RSA-8192 Public Key imported in step 3 and encode it\nin base64.\n\nNOTE: Using RSA encryption with 8192 bits of key size is very unusual. In fact, this may be\nthe first time that we have seen a ransom malware use such a strong – albeit overkill and\ninefficient for its purpose – encryption algorithm to protect information. In most cases, 2048\nand 4096 key sizes are more than enough to secure any message. Using the longer key size\nadds a large overhead due to significantly longer key generation and encryption times. And\nlastly, RSA-8192 can only encrypt 1024 bytes at a time, even less if we consider the\nreserved size for padding. Since the configuration’s size will surely be more than that due to\nthe fact that it contains the encoded Private Key (from step 4), the malware cuts the\ninformation into chunks of 1000 (0x3e8) bytes and performs multiple operations of the RSA8192 until the entire information is encrypted\n\n6. Generate another 16-byte key using the same algorithm used in step 1. This is the IV\n(Initialization Vector) for the AES-128 CBC mode encryption. A new IV is generated for every\nfile.\n\n7. Encrypt the file content using the main AES Key from step 1 and the current IV.\n\n8. Encrypt the current IV using RSA-2048 with the locally generated Public Key generated in\nstep 2 and encode it in base64.\n\n9. Append the encrypted IV to the file.\n\nFigure 7. File encryption process\n\nFigure 8. Structure of encrypted file\n\nThis means that, as of now, file decryption is not practically possible without the threat actor’s\nRSA Private Key pair of the embedded RSA Public Key.\n\nFigure 9. File decryption process\n\n\n-----\n\nThe screenshot below shows files that it avoids during its encryption process. Notice that\n“boot.ini” is being compared twice. This is clearly an error, which implies that this malware\nmay be in its early stages.\n\nFigure 10. Whitelisted folders\n\nIt also avoids files with specific extensions, as listed in the next image, although it is done in\na very unusual and rather inefficient way using case-insensitive string comparison.\n\nFigure 11. Whitelisted file extensions\n\nThe confusion continues when it checks to see if the IP address of the victim is located in\nRussia, Belarus, Kazakhstan, Tajikistan, or Ukraine by accessing hxxp://api.dbip.com/v2/free/{IP address}/countryName. Ironically, regardless of the result, it still proceeds\nto the file encryption stage.\n\n### Victim Configuration File\n\nThe configuration file, as referred to in the malware’s ransom note, acts as the victim’s\nidentification and key for file decryption. The information is assembled and written in JSON\nformat to %USERPROFILE%/{FileID}.nemty, wherein the FileID is _NEMTY_{7 random\n_characters} (e.g. _NEMTY_NIZ8NSt_.nemty). In generating the random characters, it uses_\nthe same algorithm used in generating the AES Key and IVs.\n\nFigure 12. Configuration file in JSON format\n\nFigure 13. Configuration file information descriptions\n\nThe UserID is set to a value hardcoded in the binary. This is possibly an affiliate ID, which\n[means that Nemty is possibly being sold as a Ransomware-as-a-Service (RaaS).](https://www.fortinet.com/blog/threat-research/ransomware-as-a-service-rampant-in-the-underground-black-market?utm_source=blog&utm_campaign=ransomware-as-a-service-rampant-in-the-underground-black-market)\n\n## Nemty’s Ransom Note and Payment Page\n\nFigure 14. Ransom note\n\nThe payment page is hosted in the Tor network for anonymity, which has become a standard\nfor ransomware operations. To get to the main payment page, the victim must upload the\nencrypted configuration file and an encrypted file for a decryption test. As of this writing, the\nthreat actors are demanding $1000 in bitcoin in exchange for the decryption of the victim’s\nfiles.\n\nThere is a function to send the encrypted configuration to exfiltrate the configuration data\nfrom the victim’s machine, although it clearly has not yet been practically implemented. This\nis because the hardcoded IP address, which is supposed to be the threat actors’ C2 server,\n\n\n-----\n\nis actually the victim system s loopback address, 127.0.0.1. It is possible that they simply\nhave not configured an operational server to receive the data yet, which is another clue that\nthis ransomware is still in the development stage.\n\nFigure 15. Function for sending configuration data\n\nAs a result, all information needed for decryption and identification have to be manually\nsubmitted by the victim.\n\nFigure 16. Upload pages for test decryption\n\nThe payment page supports the Russian language, which is very unusual and confusing.\nConsidering the embedded image with the Russian statement that was discussed later, it is\neasy to assume that the developers of Nemty are of Russian descent. Normally, they would\navoid infecting Russian users so as to not attract attention from authorities in their region.\nHowever, this does not seem to be the case for this ransomware.\n\nFigure 17. Main payment page\n\n## Conclusion\n\nNemty Ransomware is a file-encrypting malware that is being actively distributed. Although it\nis interesting to think that it may have some relation to GandCrab and Sodinokibi, aside from\nthe insulting Russian statement and the similar distribution method, we have not found any\ncompelling evidence to tie them together.\n\nIt also appears that this malware may be yet another RaaS (Ransomware-as-a-Service) due\nto the existence of a possible affiliate ID. This means we might be seeing more of this\nmalware being distributed through other means pretty soon.\n\nWe have also discussed several irregularities and inefficiencies in its code, implying that it is\nstill in its early stage of development. Despite that, however, in its current state, it can still\ncarry out file encryption on a victim’s system, making it a real threat..\n\n_As of this writing, a new version of this malware has been found and is already being_\n_analyzed. FortiGuard Labs will be releasing a new report about it._\n\n-= FortiGuard Lion Team =\n## Solutions to Protect Against Nemty\n\nFortinet customers are protected by the following:\n\nSamples are detected by our W32/Gen.NVV!tr.ransom signature\nFortiSandbox rates the malware’s behavior as high risk\n\n\n-----\n\n## IOCs for Nemty Ransomware\n\n267a9dcf77c33a1af362e2080aaacc01a7ca075658beb002ab41e0712ffe066e (Nemty\nransomware from Powershell) - W32/Gen.NVV!tr.ransom\nhxxps://pastebin.com/raw/NE3TJ3z1 (link to the Powershell loader)\n127.0.0.1:9050/public/gate?data={encrypted configuration}\n\n_[Learn more about FortiGuard Labs and the FortiGuard Security Services portfolio.](https://www.fortinet.com/fortiguard/threat-intelligence/threat-research.html?utm_source=nreleaseblog&utm_campaign=2018-q2-fortiguardlabs-cta)_ _Sign_\n_up for our weekly FortiGuard Threat Brief._\n\n_[Read about the FortiGuard Security Rating Service, which provides security audits and best](https://www.fortinet.com/support-and-training/support-services/fortiguard-security-subscriptions/security-rating.html?utm_source=blog&utm_campaign=2018-blog-security-rating-service)_\n_practices._\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-09-17 - Nemty Ransomware 1.0- A Threat in its Early Stage.pdf"
    ],
    "report_names": [
        "2019-09-17 - Nemty Ransomware 1.0- A Threat in its Early Stage.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536245,
    "ts_updated_at": 1743041320,
    "ts_creation_date": 1653764580,
    "ts_modification_date": 1653764580,
    "files": {
        "pdf": "https://archive.orkl.eu/54d657423c503e8d44d370f9f1e06d442bd4db2a.pdf",
        "text": "https://archive.orkl.eu/54d657423c503e8d44d370f9f1e06d442bd4db2a.txt",
        "img": "https://archive.orkl.eu/54d657423c503e8d44d370f9f1e06d442bd4db2a.jpg"
    }
}