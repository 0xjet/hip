{
    "id": "72ff445a-d0ec-4f37-b988-5c4e2ec25154",
    "created_at": "2023-01-12T15:04:48.089023Z",
    "updated_at": "2025-03-27T02:17:23.443911Z",
    "deleted_at": null,
    "sha1_hash": "6d0ce9f7a10641a65c3f6bb3737a958ad41e9a26",
    "title": "2020-05-11 - New MacOS Dacls RAT Backdoor Shows Lazarus’ Multi-Platform Attack Capability",
    "authors": "",
    "file_creation_date": "2022-05-28T15:25:04Z",
    "file_modification_date": "2022-05-28T15:25:04Z",
    "file_size": 129778,
    "plain_text": "# Lazarus’ MacOS Dacls RAT Shows Multi-Platform Ability\n\n**[blog.trendmicro.com/trendlabs-security-intelligence/new-macos-dacls-rat-backdoor-show-lazarus-multi-platform-attack-capability](https://blog.trendmicro.com/trendlabs-security-intelligence/new-macos-dacls-rat-backdoor-show-lazarus-multi-platform-attack-capability)**\n\nMalware\n\n\nMay 11, 2020\n\n\nWe found an application sample in April called TinkaOTP, and our investigation showed the application bearing a striking resemblance to Dacls\nremote access trojan (RAT), a Windows and Linux backdoor discovered in December 2019.\n\nBy: Gabrielle Joyce Mabutas, Fujisawa Kazuki May 11, 2020 Read time: ( words)\n\nA one-time password (OTP) system involves the use of a generated password that can only be used once to log in and access specific online\nservices. Often managed by a third-party provider, this rolling password system aims to reduce unauthorized intrusions to systems via\ncompromised accounts.\n\nWe found an application sample in April called TinkaOTP that seemed like a normal OTP authentication tool. However, further investigation\nshowed the application bearing a striking resemblance to Dacls remote access trojan (RAT), a Windows and Linux backdoor that 360 Netlab\n[discovered in December 2019. The strings that the trojan’s command and control (C&C) server uses to communicate with the storage samples](https://blog.netlab.360.com/dacls-the-dual-platform-rat-en/)\nlinks it to previous deployments by the cybercriminal group Lazarus.\n\n**The Lazarus link**\n\nAfter running the TinkaOTP application, the sample appeared as a Disk iMaGe (DMG) application bundle meant to be mounted and run.\nLaunching the app initially didn’t reveal any suspicious behavior, but it dropped a hidden file ~/Library/.mina in the Library folder, along with a\nLaunchDaemon /Library/LaunchDaemons/com.aex-loop.agent.plist set to run the hidden file on startup.\n\nFigure 1. TinkaOTP dropping a hidden file\n\nAnother comparison showed that the main mach-o executable of the bundle —/Contents/MacOS/TinkaOTP — was a repackaged version of\n[another OTP tool called MinaOTP, an open-source authentication tool available at GitHub.](https://github.com/MinaOTP/MinaOTP-MAC)\n\nFigure 2. TinkaOTP (left) and MinaOTP (right, image taken from GitHub)\n\nFigure 3. Disassembly of TinkaOTP’s main executable showed direct references to MinaOTP modules, as well as the shell command for\ncopying the malicious hidden file\n\nTracing the origin of the hidden .mina file showed that it is a copy of an included resource, renamed SubMenu.nib, from the application bundle\nand where the main backdoor functions were contained. It also has the same links to Lazarus’ Windows and Linux predecessors: the presence\nof the hardcoded strings c_2910.cls and k_3872.cls. Both strings were previously used during C&C communication to the domain\nthevagabondsatchel[.]com as the sample storage of the cybercriminal group, as reported by 360 Netlab researchers.\n\n\n-----\n\ngu e St gs used to co u cate t t e C&C\n\nFigure 5. Same HTTP Post message format as Windows and Linux backdoor discovered\n\nWe also found another variant with an executable that drops the main backdoor payload. The SubMenu.nib is nowhere to be found, but it\ndownloads the payload from a hardcoded address and extracts it into the hidden payload to be run. A look into the address,\nloneeaglerecords[.]com, revealed that the domain has been registered and existing for 11 years, but the issued HTTPS certificate is fairly\nrecent. The domain is assigned to 50[.]87[.]144[.]227, an IP investigated to have hosted different kinds of Windows malware such as ADWIND\nand URSNIF. Despite the differences, the hidden payload downloaded is the same in both variants.\n\nFigure 6. Payload address of another variant\n\nThe group appeared to have made this version as a quick follow-up to the Windows/Linux Dacls RAT variants. This was confirmed by\nmatching the latest IP assignment and HTTP certificate from the download address of the new variant.\n\n**Backdoor and persistence routines**\n\nThe backdoor installation sequence shows that it’s meant for persistence via /LaunchAgents/com.aex-loop.agent.plist and\n_/Library/LaunchDaemons/com.aex-loop.agent.plist. It initiates the configuration file /Library/Caches/com.applestore.db to set the C&C server IP_\nand for remote session information. Loading the bot plugins, this enables connection to the server to open and wait for commands, update the\nconfiguration file based on the commands received, and encrypt the file via AES CBC. If the configuration file already exists, it will decrypt\nonce a new session starts.\n\nFigure 7. Related code disassembly for persistence\n\nOnce installed, it checks if an existing configuration file exists. If not, it creates a config file and writes data related to the setup such as C&C\nserver addresses and other C&C session information. The initial C&C server IPs — 67[.]43[.]239[.]146 and 185[.]62[.]58[.]207 — the bot\nconnects to are hardcoded in the backdoor file and written to the config file. The config file will then be dropped as\n_/Library/Caches/com.applestore.db and encrypted. Once completed, the backdoor proceeds to load the plugins responsible for specific_\nfunctions.\n\nFigure 8. Initial server IPs written on the config file. The file may have the IPs rewritten to an updated IP address of a new server.\n\nFigure 9. Dropping the config file and encrypting with AES CBC\n\nA look into the server IPs also showed that the domain hosts legitimate traffic; blocking the said domains may have side effects for other sites.\n\n**Attack routines upon infection**\n\nDuring the initial analysis of the disassembled codes, the strings used to load the IPs and plugins appear to be missing characters. However, a\ncloser inspection of the first characters showed that these strings were intentionally separated — likely an effort to evade detection.\n\nFigure 10. Evading detection\n\nAfter receiving a response from the server, it will check the headers to determine the plugins to run, with each plugin templated to load their\nrespective functions on initialization. Comparing the plugins used for MacOS and its Windows/Linux variants showed some differences and\nadditional capabilities.\n\nFigure 11. Scanning headers\n\n**Plugin Name** **String** **Functions**\n\nPlugin_CMD /bin/bash -    Execute received commands\n\n                         -    Capability of Reverse Shell\n\n\n-----\n\nPlugin_FILE plugin_file -    Scan directories\n\n                          -    Download files\n\n                         -    Open, write, and delete\n\nPlugin_PROCESS plugin_process -    Collect data on running processes\n\n                         -    Create process\n\n                        -    Terminate process\n\nPlugin_TEST plugin_test -    Check network access to specified address issued by server\n\nPlugin_RP2Pv plugin_reverse_p2p -    Setup network proxy between bot and server\n\nPlugin_LOGSEND logsend -    Connect to log server\n\n                        -    Scan system\n\n                         -    Send collected logs\n\nPLUGIN_SOCKS plugin_socks -    Start Socks4 Thread to setup SSL connection\n\nTable 1. Plugin templates and functions\n\nThe bash/cmd plugin is used for executing shell commands in the form of appending them as a bash script and then running it on the terminal.\nBased on the arguments set in the packet received, it also has the capability to run a reverse shell.\n\nFigure 12. The bash/cmd plugin\n\nThe file plugin runs the same functions as the Windows and Linux variants: it can read, write, delete, and download files, as well as scan a\ndirectory for a specific file.\n\nFigure 13. The file plugin\n\nLooking into the arguments shows that the process plugin comes from the received packet to execute functions such as collecting process\ninformation, running a new process, and terminating a running one. The process information collected includes the username, user ID, group\nID, and process parent ID of the target process.\n\nWhereas the other plugins may directly call and execute for the arguments’ function passed by the server, the process plugin differs in that the\nserver indirectly calls the function from the plugin itself; the location of the process plugin functions’ addresses are first called prior to the\nexecution.\n\nFigure 14. The process plugin\n\nFigure 15. Process plugin formatting the collected information before sending\n\nThe test plugin attempts to connect to a provided address to check access to the network. Meanwhile, the reverse P2P plugin creates a proxy\nserver to bridge the C&C and the client. This creates another connection to another C&C specified in the commands to act as a proxy,\nredirecting traffic from the infected machine to the real C&C server.\n\nFigure 16. The test plugin\n\nFigure 17. The reverse P2P plugin\n\nThe logsend plugin collects system information by scanning the system using function start_scan_worm and send data to the log server\nspecified. Meanwhile, the socks plugin creates a connection via socks4 for Secure Sockets Layer-related (SSL) transactions. This plugin was\nnot observed in the Windows/Linux variants.\n\n\n-----\n\ngu e 8 e ogse d p ug\n\nFigure 19. The socks plugin\n\n**Conclusion**\n\nThe discovery of the Windows/Linux variants and analysis of this routine has shown Lazarus’ range of expertise. As mentioned in a previous\nLazarus [discovery involving MacOS, this shift in focus towards attacking multiple operating systems indicate an expansion of targets. It also](https://blog.trendmicro.com/trendlabs-security-intelligence/mac-backdoor-linked-to-lazarus-targets-korean-users/)\nshows that they’re experimenting for future-related cases, highlighted by the additional plugin that has not been observed in similar routines.\n\nTo note, shortly after our first discovery of Lazarus’ interest in MacOS in 2019 via poisoned spreadsheets, the group was able to follow up with\nfileless [AppleJeus, showing a rapid development in research. Related to this routine, the dropper from the first variant’s only implemented](https://securelist.com/operation-applejeus-sequel/95596/)\nevasion method was the use of copying the payload into a hidden file; the second variant improved on this by downloading the payload\ninstead. While considerably not as sophisticated yet, given how the AppleJeus malware quickly followed with a fileless version, we could\nexpect the group to deploy a similar execution of this routine soon.\n\nWe also suspect that the group may be targeting specific users for bot distribution, taking advantage of users’ needs for layered security. OTP\nauthentication tools have also been used to manage cryptocurrency wallets and exchanges, another common target for fraud by the\ncybercriminal group. The group might also be expanding to mobile platforms. Considering that the original MinaOTP source contains a\n[separate project called MinaOTP-iOS, the group might be planning to rebuild a repurposed version of this for mobile. We will continue](https://github.com/MinaOTP/MinaOTP-iOS)\nmonitoring Lazarus deployments and activities.\n\nTo protect systems from this type of threat, users should only download apps from official and legitimate marketplaces. Users can also\n[consider multilayered security solutions such as Trend Micro Antivirus for Mac, which provides comprehensive security and multi-device](https://blog.trendmicro.com/en_us/forHome/products/antivirus-for-mac.html)\nprotection against cyberthreats.\n\nEnterprises can take advantage of Trend Micro’s [Smart Protection Suites with XGen™ security, which infuses high-fidelity machine](https://blog.trendmicro.com/en_us/business/products/user-protection/sps.html)\nlearning into a blend of threat protection techniques to eliminate security gaps across any user activity or endpoint.\n\n**Indicators of Compromise (IOCs)**\n\n**SHA256** **Filename** **Detection**\n\n846d8647d27a0d729df40b13a644f3bffdc95f6d0e600f2195c85628d59f1dc6 /Contents/Resources/Base.lproj/SubMenu.nib Backdoor.MacO\n\nd3235a29d254d0b73ff8b5445c962cd3b841f487469d60a02819c0eb347111dd TinkaOTP.dmg Backdoor.MacO\n\ne5b842784cc3e9bc0376915d2d823c3e4e076d29b5fb98ea69ff9a56b0f4a54a\n\n216a83e54cac48a75b7e071d0262d98739c840fd8cd6d0b48a9c166b69acd57d\n\n7e8a086319a218732dde5a749afdd9813d3047eaeef511e0374ca64fd8d0d033\n\n899e66ede95686a06394f707dd09b7c29af68f95d22136f0a023bfd01390ad53\n\nfea0bd961d8d72642a3e1cb92b6ac084a9680eaef816ad414e282f6ea87d52c6 TinkaOTP.app Backdoor.MacO\n\n7b8792025aacff5dacb3a9121ec2f5bfa33d5932d1f43b9ad0d518c55c6e1298 /Contents/MacOS/TinkaOTP Backdoor.MacO\n\n90fbc26c65e4aa285a3f7ee6ff8a3a4318a8961ebca71d47f51ef0b4b7829fd0\n\n**URL**\n\nhttps[://]loneeaglerecords[.]com/wp-content/uploads/2020/01/images[.]tgz.001       Malware accomplice\n\n**MITRE ATT&CK Framework**\n\nThose highlighted in yellow are characteristics observed during analysis, while those in green are possible actions based on observed C&C\nserver commands. [MITRE_framework_Lazarus_Dacls_RAT_backdoor_MacOS](https://blog.trendmicro.com/content/dam/trendmicro/global/en/migrated/trendlabs-security-intelligence-07/files/2020/05/Mitre-01.jpg)\n\nTags\n\n[Malware |](https://blog.trendmicro.com/en_us/research.html?category=trend-micro-research:threats/malware) [Endpoints |](https://blog.trendmicro.com/en_us/research.html?category=trend-micro-research:environments/endpoints) [Research](https://blog.trendmicro.com/en_us/research.html?category=trend-micro-research:article-type/research)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-05-11 - New MacOS Dacls RAT Backdoor Shows Lazarus’ Multi-Platform Attack Capability.pdf"
    ],
    "report_names": [
        "2020-05-11 - New MacOS Dacls RAT Backdoor Shows Lazarus’ Multi-Platform Attack Capability.pdf"
    ],
    "threat_actors": [
        {
            "id": "a2b92056-9378-4749-926b-7e10c4500dac",
            "created_at": "2023-01-06T13:46:38.430595Z",
            "updated_at": "2025-03-27T02:00:02.831633Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "Operation DarkSeoul",
                "APT38",
                "ATK117",
                "DEV-1222",
                "G0032",
                "APT 38",
                "Stardust Chollima",
                "APT-C-26",
                "ATK3",
                "Diamond Sleet",
                "Hidden Cobra",
                "Unit 121",
                "Subgroup: Bluenoroff",
                "NICKEL GLADSTONE",
                "DEV-0139",
                "Andariel",
                "Operation Troy",
                "COVELLITE",
                "TA404",
                "Lazarus group",
                "Dark Seoul",
                "G0082",
                "NewRomanic Cyber Army Team",
                "Bluenoroff",
                "Appleworm",
                "Nickel Academy",
                "COPERNICIUM",
                "Hastati Group",
                "Bureau 121",
                "Operation AppleJeus",
                "Whois Hacking Team",
                "Citrine Sleet",
                "Sapphire Sleet",
                "Group 77",
                "Labyrinth Chollima",
                "Operation GhostSecret",
                "BeagleBoyz"
            ],
            "source_name": "MISPGALAXY:Lazarus Group",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f32df445-9fb4-4234-99e0-3561f6498e4e",
            "created_at": "2022-10-25T16:07:23.756373Z",
            "updated_at": "2025-03-27T02:02:09.966155Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "APT-C-26",
                "ATK 3",
                "Appleworm",
                "Citrine Sleet",
                "DEV-0139",
                "Diamond Sleet",
                "Gleaming Pisces",
                "Gods Apostles",
                "Gods Disciples",
                "Group 77",
                "Guardians of Peace",
                "Hastati Group",
                "Hidden Cobra",
                "ITG03",
                "Jade Sleet",
                "Labyrinth Chollima",
                "Lazarus Group",
                "NewRomanic Cyber Army Team",
                "Operation 99",
                "Operation AppleJeus",
                "Operation AppleJeus sequel",
                "Operation Blockbuster: Breach of Sony Pictures Entertainment",
                "Operation CryptoCore",
                "Operation Dream Job",
                "Operation Dream Magic",
                "Operation Flame",
                "Operation GhostSecret",
                "Operation In(ter)caption",
                "Operation LolZarus",
                "Operation Marstech Mayhem",
                "Operation No Pineapple!",
                "Operation North Star",
                "Operation Phantom Circuit",
                "Operation Sharpshooter",
                "Operation Ten Days of Rain / DarkSeoul",
                "Operation Troy",
                "SectorA01",
                "Slow Pisces",
                "TA404",
                "TraderTraitor",
                "UNC2970",
                "UNC4034",
                "UNC4736",
                "UNC4899",
                "UNC577",
                "Whois Hacking Team"
            ],
            "source_name": "ETDA:Lazarus Group",
            "tools": [
                "3CX Backdoor",
                "3Rat Client",
                "3proxy",
                "AIRDRY",
                "ARTFULPIE",
                "ATMDtrack",
                "AlphaNC",
                "Alreay",
                "Andaratm",
                "AngryRebel",
                "AppleJeus",
                "Aryan",
                "AuditCred",
                "BADCALL",
                "BISTROMATH",
                "BLINDINGCAN",
                "BTC Changer",
                "BUFFETLINE",
                "BanSwift",
                "Bankshot",
                "Bitrep",
                "Bitsran",
                "BlindToad",
                "Bookcode",
                "BootWreck",
                "BottomLoader",
                "Brambul",
                "BravoNC",
                "Breut",
                "COLDCAT",
                "COPPERHEDGE",
                "CROWDEDFLOUNDER",
                "Castov",
                "CheeseTray",
                "CleanToad",
                "ClientTraficForwarder",
                "CollectionRAT",
                "Concealment Troy",
                "Contopee",
                "CookieTime",
                "Cyruslish",
                "DAVESHELL",
                "DBLL Dropper",
                "DLRAT",
                "DRATzarus",
                "DRATzarus RAT",
                "Dacls",
                "Dacls RAT",
                "DarkComet",
                "DarkKomet",
                "DeltaCharlie",
                "DeltaNC",
                "Dembr",
                "Destover",
                "DoublePulsar",
                "Dozer",
                "Dtrack",
                "Duuzer",
                "DyePack",
                "ECCENTRICBANDWAGON",
                "ELECTRICFISH",
                "Escad",
                "EternalBlue",
                "FALLCHILL",
                "FYNLOS",
                "FallChill RAT",
                "Farfli",
                "Fimlis",
                "FoggyBrass",
                "FudModule",
                "Fynloski",
                "Gh0st RAT",
                "Ghost RAT",
                "Gopuram",
                "HARDRAIN",
                "HIDDEN COBRA RAT/Worm",
                "HLOADER",
                "HOOKSHOT",
                "HOPLIGHT",
                "HOTCROISSANT",
                "HOTWAX",
                "HTTP Troy",
                "Hawup",
                "Hawup RAT",
                "Hermes",
                "HotCroissant",
                "HotelAlfa",
                "Hotwax",
                "HtDnDownLoader",
                "Http Dr0pper",
                "ICONICSTEALER",
                "Joanap",
                "Jokra",
                "KANDYKORN",
                "KEYMARBLE",
                "Kaos",
                "KillDisk",
                "KillMBR",
                "Koredos",
                "Krademok",
                "LIGHTSHIFT",
                "LIGHTSHOW",
                "LOLBAS",
                "LOLBins",
                "Lazarus",
                "LightlessCan",
                "Living off the Land",
                "MATA",
                "MBRkiller",
                "MagicRAT",
                "Manuscrypt",
                "Mimail",
                "Mimikatz",
                "Moudour",
                "Mydoom",
                "Mydoor",
                "Mytob",
                "NACHOCHEESE",
                "NachoCheese",
                "NestEgg",
                "NickelLoader",
                "NineRAT",
                "Novarg",
                "NukeSped",
                "OpBlockBuster",
                "PCRat",
                "PEBBLEDASH",
                "PLANKWALK",
                "POOLRAT",
                "PSLogger",
                "PhanDoor",
                "Plink",
                "PondRAT",
                "PowerBrace",
                "PowerRatankba",
                "PowerShell RAT",
                "PowerSpritz",
                "PowerTask",
                "Preft",
                "ProcDump",
                "Proxysvc",
                "PuTTY Link",
                "QUICKRIDE",
                "QUICKRIDE.POWER",
                "Quickcafe",
                "QuiteRAT",
                "R-C1",
                "ROptimizer",
                "Ratabanka",
                "RatabankaPOS",
                "Ratankba",
                "RatankbaPOS",
                "RawDisk",
                "RedShawl",
                "Rifdoor",
                "Rising Sun",
                "Romeo-CoreOne",
                "RomeoAlfa",
                "RomeoBravo",
                "RomeoCharlie",
                "RomeoCore",
                "RomeoDelta",
                "RomeoEcho",
                "RomeoFoxtrot",
                "RomeoGolf",
                "RomeoHotel",
                "RomeoMike",
                "RomeoNovember",
                "RomeoWhiskey",
                "Romeos",
                "RustBucket",
                "SHADYCAT",
                "SHARPKNOT",
                "SIGFLIP",
                "SIMPLESEA",
                "SLICKSHOES",
                "SORRYBRUTE",
                "SUDDENICON",
                "SUGARLOADER",
                "SheepRAT",
                "SierraAlfa",
                "SierraBravo",
                "SierraCharlie",
                "SierraJuliett-MikeOne",
                "SierraJuliett-MikeTwo",
                "SimpleTea",
                "SimplexTea",
                "SmallTiger",
                "Stunnel",
                "TAINTEDSCRIBE",
                "TAXHAUL",
                "TFlower",
                "TOUCHKEY",
                "TOUCHMOVE",
                "TOUCHSHIFT",
                "TOUCHSHOT",
                "TWOPENCE",
                "TYPEFRAME",
                "Tdrop",
                "Tdrop2",
                "ThreatNeedle",
                "Tiger RAT",
                "TigerRAT",
                "Trojan Manuscript",
                "Troy",
                "TroyRAT",
                "VEILEDSIGNAL",
                "VHD",
                "VHD Ransomware",
                "VIVACIOUSGIFT",
                "VSingle",
                "ValeforBeta",
                "Volgmer",
                "Vyveva",
                "W1_RAT",
                "Wana Decrypt0r",
                "WanaCry",
                "WanaCrypt",
                "WanaCrypt0r",
                "WannaCry",
                "WannaCrypt",
                "WannaCryptor",
                "WbBot",
                "Wcry",
                "Win32/KillDisk.NBB",
                "Win32/KillDisk.NBC",
                "Win32/KillDisk.NBD",
                "Win32/KillDisk.NBH",
                "Win32/KillDisk.NBI",
                "WinorDLL64",
                "Winsec",
                "WolfRAT",
                "Wormhole",
                "YamaBot",
                "Yort",
                "ZetaNile",
                "concealment_troy",
                "http_troy",
                "httpdr0pper",
                "httpdropper",
                "klovbot",
                "sRDI"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535888,
    "ts_updated_at": 1743041843,
    "ts_creation_date": 1653751504,
    "ts_modification_date": 1653751504,
    "files": {
        "pdf": "https://archive.orkl.eu/6d0ce9f7a10641a65c3f6bb3737a958ad41e9a26.pdf",
        "text": "https://archive.orkl.eu/6d0ce9f7a10641a65c3f6bb3737a958ad41e9a26.txt",
        "img": "https://archive.orkl.eu/6d0ce9f7a10641a65c3f6bb3737a958ad41e9a26.jpg"
    }
}