{
    "id": "b368a074-b823-43ea-bb10-7b19226290f5",
    "created_at": "2023-01-12T15:08:51.353437Z",
    "updated_at": "2025-03-27T02:11:33.897847Z",
    "deleted_at": null,
    "sha1_hash": "6147083dec6b409f498a88ceb3f9be717513a35a",
    "title": "2017-01-10 - Client Maximus- New Remote Overlay Malware Highlights Rising Malcode Sophistication in Brazil",
    "authors": "",
    "file_creation_date": "2022-05-28T03:51:39Z",
    "file_modification_date": "2022-05-28T03:51:39Z",
    "file_size": 1668172,
    "plain_text": "# New Remote Overlay Malware Highlights Rising Malcode Sophistication in Brazil\n\n**securityintelligence.com/client-maximus-new-remote-overlay-malware-highlights-rising-malcode-sophistication-in-**\nbrazil/\n\nJanuary 10, 2017\n\n[Home&nbsp/](https://securityintelligence.com/) [Banking & Finance](https://securityintelligence.com/category/topics/banking-financial-services-industry/)\nClient Maximus: New Remote Overlay Malware Highlights Rising Malcode Sophistication in\nBrazil\n\n\n-----\n\n[Banking & Finance January 10, 2017](https://securityintelligence.com/category/topics/banking-financial-services-industry/)\nBy [Or Safran co-authored by Lior Keshet,](https://securityintelligence.com/author/or-safran/) [Limor Kessem 7 min read](https://securityintelligence.com/author/limor-kessem/)\nThe [Brazilian malware landscape is notorious for its plethora of Delphi-based code and](https://securityintelligence.com/the-brazilian-malware-landscape-a-dime-a-dozen-and-going-strong/)\noverall lack of sophistication. But much like the Russian-speaking malware scene, Brazilian\ncybergangs have been using better malware, such as the recently discovered Client\nMaximus, in their attacks.\n\n[In the summer of 2016, malware like Zeus Panda and](https://securityintelligence.com/panda-is-one-hungry-bear-a-heavyweight-banking-trojan-rolls-into-brazil/) [Sphinx were spotted in Brazil. Those](https://securityintelligence.com/brazil-cant-catch-a-break-after-panda-comes-the-sphinx/)\nwere followed by intensifying infection campaigns, all targeting Brazilian banks and payment\n[platforms, according to data from IBM X-Force Security Research. Later in the year year, our](https://www.ibm.com/security/xforce/research.html)\nresearchers spotted a new, [real-time phishing attack in Brazil, which introduced automation](https://securityintelligence.com/new-live-interactive-phishing-attacks-emerge-brazil/)\nand agility to classic phishing attacks.\n\n[It quickly became clear that cybercriminals in Brazil are collaborating with counterparts from](https://www.theregister.co.uk/2016/04/01/cybercrime_collaboration/)\nother, more sophisticated threat landscapes and importing code and expertise to launch\nattacks in their own country.\n\n## Enter Client Maximus\n\nWe recently encountered a case in Brazil that reflects this ongoing trend. Client Maximus is a\nnew malware code that appears to have been written specifically for attacks on Brazilian\n[banks. The malware was recently analyzed alongside other components related to it, leading](https://securityintelligence.com/exposing-av-disabling-drivers-just-in-time-for-lunch/)\nto further findings and a greater overall understanding of the growing sophistication of\ncybercrime tools in Brazil.\n\nThe purpose of the Client Maximus malware is financial fraud. As such, its code aspires to\ncreate the capabilities that most banking Trojans have, which allow attackers to monitor\nvictims’ web navigation and interrupt online banking session at will. After taking over a\n\n\n-----\n\nvictim s banking session, an attacker operating this malware can initiate a fraudulent\ntransaction from the account and use social engineering screens to manipulate the unwitting\nvictim into authorizing it.\n\n[Read the white paper: How to outsmart Fraudsters with Cognitive Fraud Detection](https://www-01.ibm.com/marketing/iwm/dre/signup?source=mrs-form-9451&S_PKG=ov54550)\n\n## Initial Infection Routine\n\nThe initial infection begins with a malicious, obfuscated WScript. Upon deobfuscating the\nscript, we discovered that its goal is to download and execute JavaScript on the target\nendpoint.\n\n_Figure 1: Initial script run by new remote overlay malware_\n\nThe JavaScript fetched by the malicious code here is a larger snippet that runs several\nantivirus checks and eventually downloads and executes the actual malware. The malware\naims to:\n\n1. Monitor which bank is accessed in the user’s open browser windows;\n2. Remotely control the user’s endpoint at will; and\n3. Overlay fake persistent windows on top of the user’s web browser application.\n\nThe attacker sets up the malware to commit financial fraud.\n\n## Malware Deployment\n\nClient Maximus is deployed on the endpoint in two different ways. The first method calls for it\nto be deployed as a custom NSIS Installer. The malware binary is a custom-compiled version\nof Nullsoft Scriptable Install System (NSIS), which extracts three files into %TEMP% folder.\nThe first file is system.dll, the second file is a malicious dynamic link library (DLL) and the\nthird is the encrypted payload.\n\nSystem.dll is part of a plug-in for the NSIS installer. It’s actually a legitimate DLL the malware\nleverages to call its own malicious DLL. After the malware loads the malicious DLL into its\nown process memory space and calls it using the aforementioned plug-in, the malicious DLL\nis used to decrypt the payload and load it into the process memory. The activity is\nsubsequently performed by the now-decrypted file.\n\nThe Client Maximus malware binary is usually deployed to the current user’s AppData folder\nwith a unique name that depends on the dropper. Unlike most financial malware, the\nmalware itself creates its persistence from the location it runs from. It neither generates a\nnew name nor copies itself to a new location.\n\n\n-----\n\nIn most cases the malware s persistence is set under the endpoint s run key (HKCU hive),\npointing to the malware’s NSIS binary. In some cases, persistence is achieved by setting a\nlink file to the malware binary’s path under the user’s startup folder.\n\nClient Maximus can also be deployed via DLL hijacking and new technology file system\n(NTFS) alternate data streams (ADS). In this second deployment style, the malware uses a\nlegitimate binary file, signed by a leading technology vendor, with a malicious DLL in the\nsame folder.\n\n### DLL Hijacking Dresses Malware Up in Sheep’s Clothing\n\nWhile there are many forms of DLL hijacking, the author of Client Maximus used the search\npath method to achieve it. This method relies on the binary to load DLLs from the\napplication’s current working directory before searching in other directories. It then replaces\nthe original DLL the application tries to load with another DLL, which causes the application\nto load a different DLL from the original, legitimate program intended to load.\n\nIn our case, when Client Maximus is deployed on the infected system, it also creates a\nmalicious DLL, the name of which is determined by the internal name of the aforementioned\nlegitimate library. That causes the legitimate executable to load the malicious DLL and\nexecute it while creating the illusion that the original, harmless file is performing normal\nactivity.\n\nBelow are some examples of legitimate binaries and the malicious DLL they hijack:\n\n**agestore.exe (signed by Microsoft) with malicious DLL name dbghelp.dll**\n\nMalicious DLL MD5: 31e2cd4728be52c50b8501e91d062cfc\n**AcroTextExtractorexe (signed by Adobe) with malicious DLL name query.dll**\n\nMalicious DLL MD5: 94a72a13eec55a8a7db64e468b17875e\n**cermgr.exe (signed by Microsoft) with malicious DLL name cryptui.dll**\n\nMalicious DLL MD5: 3dbe5192c62fad86033d596296865221\n**vprintproxy.exe (signed by VMware) with malicious DLL name vmwarebase.dll**\n\nMalicious DLL MD5: 35e1218a4a2c45005e73ccc0e511691c\n\nThe malicious DLL inside the legitimate process tries to load the encrypted payload from an\nNTFS ADS. We assume the malware author used NTFS ADS to remain hidden from the user\nor antivirus tools, although this method is not new.\n\nWe can use the Sysinternals Process Monitor to see when it actually loads the NTFS ADS\nwhile Windows continues to show this file as empty. In the image below, e2iU0L appears to\nbe of size 0 KB, although it does have contents in reality. We can also see that a file named\ndbghelp.dll is being used to perform the DLL-hijacking.\n\n\n-----\n\n_Figure 2: Filename dbghelp.dll being used to perform the DLL-hijacking_\n\nIn the next image, we can see that the malware (s9TLNV.exe) reads the encrypted payload\nusing an NTFS-stream:\n\n_Figure 3: Malware file (s9TLNV.exe) reading the encrypted payload using an NTFS-stream_\n\n## Client Maximus: The Fraud M.O.\n\nAfter the malware is fully installed on the target endpoint, it is designed to allow a remote\nattacker to take control of the endpoint based on a triggered action from the victim. Much like\nother financial malware, the trigger is navigation to a targeted bank’s website.\n\n### Monitoring Window Titles to Zero In on Relevant Banks\n\nTo determine which sites the victim is accessing, the malware constantly monitors the titles\nof windows opened in the browser, hashes the titles and compares the hashes against a\npredefined list of hashes. Once a target match is detected, the malware connects to the\nattacker’s remote server to notify the fraudster, who can then initiate a remote access\nsession using the malware’s remote-access Trojan (RAT) component.\n\n_Figure 4: The malware prints the victim’s windows and sends the data to the fraudster_\n\nAs a first step in the process described above, the malware monitors the victim’s activity,\nwaiting for a targeted banking session to take place in the browser. To enable the monitoring,\nthe malware takes the following actions:\n\nFirst, it registers to windows events that indicate the creation of new windows or window title\nchange.\n\n_Figure 5: Hooking windows events to monitor window title changes_\n\nUpon each of these events, the malware checks the new window title, using the\nSendMessage application program interface (API), with the “WM_GETTEXT” window\nmessage, which allows the malware to obtain each window’s title.\n\n_Figure 6: Monitoring window titles using the SendMessage API_\n\n\n-----\n\nFinally, the malware hashes the obtained window title and compares it to a list of prehashed\ntargets. If the current hash matches one of the entries on the list, the malware initiates a\nnetwork communication with the fraudster’s control server. The author chose to work with\nhashes in this case to hide the real target list from researchers.\n\n### The Logical Flow of the Fraudulent Transaction\n\nThe logical flow of the fraudulent transaction is facilitated by overlay screens the fraudster\nuses to trick the victim into providing authentication elements.\n\nThe flow of events for this new malware is no different than previous malicious code\ncategorized under the remote overlay family:\n\n1. The malware monitors browser windows and waits for a target match.\n2. The victim accesses a targeted bank, at which point the malware notifies the attacker.\n3. The attacker initiates a remote access session to the infected machine.\n4. The victim performs the initial login to the bank account.\n5. The attacker takes the session over by blocking the victim’s access to the browser’s\n\nscreen, then presents the victim with social engineering screens that cannot be\nminimized and request more information.\n6. The victim unwittingly provides the attacker with authentication elements.\n7. The attacker finalizes a fraudulent transaction.\n\n## Fraud Continues to Evolve\n\n[In the past year, we have borne witness to an escalating threat landscape in Brazil,](https://securityintelligence.com/media/ibm-x-force-special-report-2016-rio-olympics-threat-landscape/)\nintroducing new coding styles to malware projects and revamping popular tools such as the\nremote overlay Trojan. As we move into 2017, Brazilian banks and payment providers should\nprepare for continued threat evolution in the country and plan ahead to detect and counter\nfinancial threats in new and improved forms.\n\nBanks wishing to protect their customers from evolving threats are invited to learn more\n[about the IBM Security Trusteer Fraud Protection Suite and to read our white paper, “How to](https://www-03.ibm.com/software/products/en/trusteer-fraud-protection-suite)\nOutsmart Fraudsters with Cognitive Fraud Detection.”\n\nIndividuals looking for tips on protecting themselves from remote overlay malware and other\n[banking Trojans are invited to read our malware mitigation article.](https://securityintelligence.com/mitigating-malware-modern-mobile-world/)\n\n[Or Safran](https://securityintelligence.com/author/or-safran/)\nMalware Researcher, IBM Trusteer\n\nOr Safran is a contributor for SecurityIntelligence.\n\n\n-----\n\n-----\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-01-10 - Client Maximus- New Remote Overlay Malware Highlights Rising Malcode Sophistication in Brazil.pdf"
    ],
    "report_names": [
        "2017-01-10 - Client Maximus- New Remote Overlay Malware Highlights Rising Malcode Sophistication in Brazil.pdf"
    ],
    "threat_actors": [
        {
            "id": "e90ec9cb-9959-455d-b558-4bafef64d645",
            "created_at": "2022-10-25T16:07:24.222081Z",
            "updated_at": "2025-03-27T02:02:10.14365Z",
            "deleted_at": null,
            "main_name": "Sphinx",
            "aliases": [
                "APT-C-15"
            ],
            "source_name": "ETDA:Sphinx",
            "tools": [
                "AnubisSpy",
                "Backdoor.Oldrea",
                "Bladabindi",
                "Fertger",
                "Havex",
                "Havex RAT",
                "Jorik",
                "Oldrea",
                "PEACEPIPE",
                "njRAT",
                "yellowalbatross"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536131,
    "ts_updated_at": 1743041493,
    "ts_creation_date": 1653709899,
    "ts_modification_date": 1653709899,
    "files": {
        "pdf": "https://archive.orkl.eu/6147083dec6b409f498a88ceb3f9be717513a35a.pdf",
        "text": "https://archive.orkl.eu/6147083dec6b409f498a88ceb3f9be717513a35a.txt",
        "img": "https://archive.orkl.eu/6147083dec6b409f498a88ceb3f9be717513a35a.jpg"
    }
}