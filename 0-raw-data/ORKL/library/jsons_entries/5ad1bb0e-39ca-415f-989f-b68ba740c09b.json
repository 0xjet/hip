{
    "id": "5ad1bb0e-39ca-415f-989f-b68ba740c09b",
    "created_at": "2023-01-12T15:10:00.341643Z",
    "updated_at": "2025-03-27T02:05:23.554591Z",
    "deleted_at": null,
    "sha1_hash": "da1cf3e83c4459ff6dedd36ba13144e3a994bcaa",
    "title": "2021-06-10 - Are Virtual Machines the New Gold for Cyber Criminals-",
    "authors": "",
    "file_creation_date": "2022-05-28T23:12:09Z",
    "file_modification_date": "2022-05-28T23:12:09Z",
    "file_size": 1751778,
    "plain_text": "# Are Virtual Machines the New Gold for Cyber Criminals?\n\n**[mcafee.com/blogs/other-blogs/mcafee-labs/are-virtual-machines-the-new-gold-for-cyber-criminals/](https://www.mcafee.com/blogs/other-blogs/mcafee-labs/are-virtual-machines-the-new-gold-for-cyber-criminals/)**\n\nJune 10, 2021\n\n## Introduction\n\nVirtualization technology has been an IT cornerstone for organization for years now. It\nrevolutionized the way organizations can scale up IT systems in a heartbeat, allowing then to\nbe more agile as opposed to investing into dedicated “bare-metal” hardware. To the outside\nuntrained eye, it might seem that there are different machines on the network, while in fact all\nthe “separate” machines are controlled by a hypervisor server. Virtualization plays such a big\nrole nowadays that it isn’t only used to spin up servers but also anything from virtual\napplications to virtual user desktops.\n\nThis is something cyber criminals have been noticing too and we have seen an increased\ninterest in hypervisors. After all, why attack the single virtual machine when you can go after\nthe hypervisor and control all the machines at once?\n\nIn recent months several high impact CVEs regarding virtualization software have been\nreleased which allowed for Remote Code Execution (RCE); initial access brokers are offering\ncompromised VMware vCenter servers online, as well as ransomware groups developing\nspecific ransomware binaries for encrypting ESXi servers.\n\n## VMware CVE-2021-21985 & CVE-2021-21986\n\n\n-----\n\nOn the 25 of May [VMware disclosed a vulnerability impacting VMware vCenter servers](https://www.vmware.com/security/advisories/VMSA-2021-0010.html)\nallowing for Remote Code Execution on internet accessible vCenter servers, version 6.5,6.7\nand 7.0. VMware vCenter is a management tool, used to manage virtual machines and ESXi\nservers.\n\nCVE-2021-21985 is a remote code execution (RCE) vulnerability in the vSphere Client via\nthe Virtual SAN (vSAN) Health Check plugin. This plugin is enabled by default. The\ncombination of RCE and default enablement of the plugin resulted in this being scored as a\ncritical flaw with a CVSSv3 score of 9.8.\n\nAn attacker needs to be able to access vCenter over TCP port 443 to exploit this\nvulnerability. It doesn’t matter if the vCenter is remotely exposed or when the attacker has\ninternal access.\n\nThe same exploit vector is applicable for CVE-2021-21986, which is an authentication\nmechanism issue in several vCenter Server Plug-ins. It would allow an attacker to run plugin\nfunctions without authentication. This leads to the CVE being scored as a ‘moderate\nseverity’, with a CVSSv3 score of 6.5.\n\nWhile writing this blog, a Proof-of-Concept was discovered that will test if the vulnerability\nexists; it will not execute the remote-code. The Nmap plugin can be downloaded from this\nlocation: [https://github.com/alt3kx/CVE-2021-21985_PoC.](https://github.com/alt3kx/CVE-2021-21985_PoC)\n\nSearching with the Shodan search engine, narrowing it down to the TCP 443 port, we\nobserve that close to 82,000 internet accessible ESXi servers are exposed. Zooming in\nfurther on the versions that are affected by these vulnerabilities, almost\n55,000 publicly accessible ESXi servers are potentially vulnerable to CVE-2021-21985 and\nCVE-2021-21986, providing remote access to them and making them potential candidates\nfor ransomware attacks, as we will read about in the next paragraphs.\n\n## Ransomware Actors Going After Virtual Environments\n\nRansomware groups are always trying to find ways to hit their victims where it hurts. So, it is\nonly logical that they are adapting to attacking virtualization environments and the native\nUnix/Linux machines running the hypervisors. In the past, ransomware groups were quick to\n[abuse earlier CVEs affecting VMware. But aside from the disclosed CVEs, ransomware](https://www.zdnet.com/article/ransomware-gangs-are-abusing-vmware-esxi-exploits-to-encrypt-virtual-hard-disks/#ftag=RSSbaffb68)\ngroups have also adapted their binaries specifically to encrypt virtual machines and their\nmanagement environment. Below are some of the ransomware groups we have observed.\n\n### DarkSide Ransomware\n\n\n-----\n\n_Figure 1. Screenshot from the DarkSide ransomware group, explicitly mentioning its Linux-_\n_based encryptor and support for ESXi and NAS systems_\n\nMcAfee Advanced Threat Research (ATR) analyzed the DarkSide Linux binary in our recent\n[blog and we can confirm that a specific routine aimed at virtual machines is present in it.](https://www.mcafee.com/blogs/other-blogs/mcafee-labs/darkside-ransomware-victims-sold-short/)\n\n_Figure 2. DarkSide VMware Code routine_\n\nFrom the configuration file of the DarkSide Linux variant, it becomes clear that this variant is\nsolely designed to encrypt virtual machines hosted on an ESXi server. It searches for the\ndisk-files of the VMs, the memory files of the VMs (vmem), swap, logs, etc. – all files that are\nneeded to start a VMware virtual machine.\n\n\n-----\n\n[Demo of Darkside encrypting an ESXi server: https://youtu.be/SMWIckvLMoE](https://youtu.be/SMWIckvLMoE)\n\n### Babuk Ransomware\n\nBabuk announced on an underground forum that it was developing a cross-platform binary\naimed at Linux/UNIX and ESXi or VMware systems:\n\n_Figure 3. Babuk ransomware claiming to have built a Linux-based ransomware binary_\n_capable of encrypting ESXi servers_\n\nThe malware is written in the open-source programming language Golang, most likely\nbecause it allows developers to have a single codebase to be compiled into all major\noperating systems. This means that, thanks to static linking, code written in Golang on a\nLinux system can run on a Windows or Mac system. That presents a large advantage to\nransomware gangs looking to encrypt a whole infrastructure comprised of different systems\narchitecture.\n\n\n-----\n\nAfter being dropped on the ESXi server, the malware encrypts all the files on the system:\n\nThe malware was designed to target ESXi environments as we guessed, and it was\nconfirmed when the Babuk team returned the decryptor named d_esxi.out. Unfortunately,\nthe decryptor has been developed with some errors, which cause corruption in victim’s files:\n\nOverall, the decryptor is poor as it only checks for the extension “.babyk” which will miss any\nfiles the victim has renamed to recover them. Also, the decryptor checks if the file is more\nthan 32 bytes in length as the last 32 bytes are the key that will be calculated later with other\nhardcoded values to get the final key. This is bad design as those 32 bytes could be trash,\ninstead of the key, as the customer could make things, etc. It does not operate efficiently by\nchecking the paths that are checked in the malware, instead it analyzes everything. Another\nerror we noticed was that the decryptor tries to remove a ransom note name that is NOT the\nsame that the malware creates in each folder. This does not make any sense unless,\nperhaps, the Babuk developers/operators are delivering a decryptor that works for a different\nversion and/or sample.\n\n\n-----\n\nThe problems with the Babuk decryptor left victims in horrible situations with permanently\ndamaged data. The probability of getting a faulty decryptor isn’t persuading victims to pay up\nand this might be one of the main reasons that Babuk announced that it will stop encrypting\ndata and only exfiltrate and extort from now on.\n\n## Initial-Access-Brokers Offering VMware vCenter Machines\n\nIt is not only ransomware groups that show an interest in virtual systems; several initial\naccess brokers are also trading access to compromised vCenter/ESXi servers on\nunderground cybercriminal forums. The date and time of the specific offering below overlaps\nwith the disclosure of CVE-2021-21985, but McAfee ATR hasn’t determined if this specific\nCVE was used to gain access to ESXi servers.\n\n_Figure 4. Threat Actor selling access to thousands of vCenter/ESXi servers_\n\n\n-----\n\n_Figure 5. Threat actor offering compromised VMware ESXi servers_\n\n## Patching and Detection Advice\n\nVMware urges users running VMware vCenter and VMware Cloud Foundation affected by\n[CVE-2021-21985 and CVE-2021-21986 to apply its patch immediately. According to](https://www.vmware.com/security/advisories/VMSA-2021-0010.html)\nVMware, a malicious actor with network access to port 443 may exploit this issue to execute\ncommands with unrestricted privileges on the underlying operating system that hosts\nvCenter Server. The disclosed vulnerabilities have a critical CVSS base score of 9.8.\n\nHowever, we do understand that VMware infrastructure is often installed on business-critical\nsystems, so any type of patching activity usually has a high degree of impact on IT\noperations. Hence, the gap between vulnerability disclosure and patching is typically high.\nWith the operating systems on VMware being a closed system they lack the ability to natively\ninstall workload protection/detection solutions. Therefore, the defenses should be based on\nstandard cyber hygiene/risk mitigation practices and should be applied in the following order\nwhere possible.\n\n1. Ensure an accurate inventory of vCenter assets and their corresponding software\n\nversions.\n2. Secure the management plane of the vCenter infrastructure by applying strict network\n\naccess control policies to allow access only from special management networks.\n3. Disable all internet access to vCenter/VMware Infrastructure.\n4 Apply the released VMware patches\n\n\n-----\n\n5. McAfee Network Security Platform (NSP) offers signature sets for detection of CVE\n2021-21985 and CVE-2021-21986.\n\n## Conclusion\n\nVirtualization and its underlying technologies are key in today’s infrastructures. With the\nrelease of recently discovered vulnerabilities and an understanding of their criticality, threat\nactors are shifting focus. Proof can be seen in underground forums where affiliates recruit\npentesters with knowledge of specific virtual technologies to develop custom ransomware\nthat is designed to cripple these technologies. Remote Desktop access is the number one\naccess vector in many ransomware cases, followed by edge-devices lacking the latest\nsecurity updates, making them vulnerable to exploitation. With the latest VMware CVEs\nmentioned in this blog, we urge you to take the right steps to secure not only internet\nexposed systems, but also internal systems, to minimize the risk of your organization losing\nits precious VMs, or gold, to cyber criminals.\n\nSpecial thanks to Thibault Seret, Mo Cashman, Roy Arnab and Christiaan Beek for their\ncontributions.\n\n[ATR Operational Intelligence Team](https://www.mcafee.com/blogs/author/atr-operational-intelligence-team/)\nMcAfee’s Advanced Threat Research Operational Intelligence team operates globally around\nthe clock, keeping watch of the latest cyber campaigns and actively tracking the most\nimpactful cyber threats.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-06-10 - Are Virtual Machines the New Gold for Cyber Criminals-.pdf"
    ],
    "report_names": [
        "2021-06-10 - Are Virtual Machines the New Gold for Cyber Criminals-.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536200,
    "ts_updated_at": 1743041123,
    "ts_creation_date": 1653779529,
    "ts_modification_date": 1653779529,
    "files": {
        "pdf": "https://archive.orkl.eu/da1cf3e83c4459ff6dedd36ba13144e3a994bcaa.pdf",
        "text": "https://archive.orkl.eu/da1cf3e83c4459ff6dedd36ba13144e3a994bcaa.txt",
        "img": "https://archive.orkl.eu/da1cf3e83c4459ff6dedd36ba13144e3a994bcaa.jpg"
    }
}