{
    "id": "14186cd3-cbeb-4f77-b266-2ff039f05681",
    "created_at": "2023-01-12T15:02:29.541375Z",
    "updated_at": "2025-03-27T02:05:59.118247Z",
    "deleted_at": null,
    "sha1_hash": "563a0dac7fbe297332b36755f71eb65cddaaa794",
    "title": "2015-07-14 - TeslaCrypt 2.0 disguised as CryptoWall",
    "authors": "",
    "file_creation_date": "2022-05-28T19:36:09Z",
    "file_modification_date": "2022-05-28T19:36:09Z",
    "file_size": 754841,
    "plain_text": "# TeslaCrypt 2.0 disguised as CryptoWall\n\n**[securelist.com/teslacrypt-2-0-disguised-as-cryptowall/71371/](https://securelist.com/teslacrypt-2-0-disguised-as-cryptowall/71371/)**\n\nAuthors\n\nFedor Sinitsyn\n\nThe TeslaCrypt family of ransomware encryptors is a relatively new threat: its samples were\n[first detected in February 2015. Since then the malware has been widely portrayed in](https://blog.kaspersky.com/teslacrypt-ransomware-targets-gamers) mass\nmedia as the ‘curse’ of computer gamers because it targets many game-related file types\n(game saves, user profiles, etc.). The Trojan’s targets have included people in the US,\nGermany, Spain and other countries.\n\nTeslaCrypt is still in the active development phase: in the past months, its appearance, the\nname shown to victims (the malware can mimic CryptoLocker and has used the names\nTeslaCrypt and AlphaCrypt), extensions of encrypted files (.ecc, .ezz, .exx), as well as\nimplementation details, have all changed.\n\nKaspersky Lab recently discovered the latest version of the Trojan – TeslaCrypt 2.0. This\nversion is different from previous ones in that it uses a significantly improved encryption\nscheme, which means that it is currently impossible to decrypt files affected by TeslaCrypt. It\nalso uses an HTML page instead of a GUI. Incidentally, the HTML page was copied from\nanother Trojan – Cryptowall.\n\n\n-----\n\n_Kaspersky Lab products detect malware from the TeslaCrypt family as Trojan-_\n_Ransom.Win32.Bitman. The latest version of the Trojan that is discussed in this paper is_\n_detected as Trojan-Ransom.Win32.Bitman.tk, its MD5-hash:_\n_1dd542bf3c1781df9a335f74eacc82a4_\n\n## Evolution of the threat\n\nEach TeslaCrypt sample has an internal version of the malware. The first sample we found\nwas version 0.2.5. It had borrowed its graphical interface, including the window header, from\nanother encrypting ransomware program – CryptoLocker.\n\n_TeslaCrypt 0.2.5_\n\nBy version 0.4.0, the developers of TeslaCrypt had completely changed the malware’s\nappearance.\n\n\n-----\n\n_TeslaCrypt 0.4.0_\n\nThe following features of the malware family remain the same, regardless of the version:\n\nThe Trojan independently generates a new, unique Bitcoin address and a private key\nfor it. The address is used both as a victim ID and to receive payments from the victim.\nThe AES-256-CBC algorithm is used to encrypt files; all files are encrypted with the\nsame key.\nFiles larger than 0x10000000 bytes (~268 MB) are not encrypted.\nC&C servers are located on the Tor network; the malware communicates with the\nC&Cs via public tor2web services.\nFiles encrypted by the malware include many extensions matching files used in\ncomputer games.\nThe Trojan deletes shadow copies.\nIn spite of the scary stories about RSA-2048 shown to victims, this encryption algorithm\nis not used by the malware in any form.\n\n\n-----\n\nThe Trojan was written in C++, built using Microsoft s compiler, with cryptographic\nalgorithm implementation taken from the OpenSSL library.\n\n### Notable facts\n\nEarly versions of TeslaCrypt (0.2.5 – 0.3.x) were designed to check whether a bitcoin\npayment had been successfully made on the site http://blockchain.info. If the payment\nwas received, the malware reported this to the command server and received a key to\ndecrypt the files. This scheme was vulnerable, since an expert could send a request to\nthe C&C and get the necessary key without making a payment.\nVersions 0.2.5 – 0.3.x saved the decryption key (with other data) in their own service\nfile, key.dat. The area containing the key was zeroed out in the file only after\ncompleting encryption, making it possible to save the key by interrupting the\nencryptor’s operation (e.g., by turning off the computer). After this, the key could be\nextracted from key.dat and used to decrypt all files.\nIn version 0.4.0 the file key.dat was renamed to storage.bin, and the decryption key\nwas not stored openly but as a multiplicative inverse modulo the order of the standard\nelliptic curve secp256k1. On completing encryption, the key was overwritten with\nrandom bytes rather than zeros, but it was still possible to extract the key before the\n[area was overwritten. This was implemented in our RakhniDecryptor utility.](https://support.kaspersky.com/10556)\n\n## The present\n\nRecently a sample of the Trojan with internal version 2.0.0 caught our attention. So what was\ndifferent this time?\n\nThe first thing that caught the eye was that TeslaCrypt no longer has code responsible for\nrendering the GUI (the application window). Instead, after encrypting the files the Trojan\nopens an HTML page in the browser. The page was fully copied from another infamous\nransomware program – CryptoWall 3.0.\n\n\n-----\n\nThe page that opens when a victim follows one of the links provided by the cybercriminals is\nalso identical to the CryptoWall payment page, with one exception: the URLs lead to a\nTeslaCrypt server – the authors of the malware were certainly not going to let their rivals get\ntheir victims’ money.\n\n\n-----\n\n_TeslaCrypt initializes a string with text about CryptoWall_\n\nWhy use this false front? We can only guess – perhaps the attackers wanted to impress the\ngravity of the situation on their victims: files encrypted by CryptoWall still cannot be\ndecrypted, which is not true of many TeslaCrypt infections.\n\nIn any event, this is not the only change from the previous version of TeslaCrypt. The\nencryption scheme has been improved again and is now even more sophisticated than\n[before. Keys are generated using the ECDH algorithm. The cybercriminals introduced it in](https://en.wikipedia.org/wiki/Elliptic_curve_Diffie%E2%80%93Hellman)\nversions 0.3.x, but in this version it seems more relevant because it serves a specific\npurpose, enabling the attackers to decrypt files using a ‘master key’ alone. More about this in\ndue course.\n\n## The TeslaCrypt 2.0 encryption scheme\n\n### Generation of key data\n\nThe Trojan uses two sets of keys – ‘master keys’ that are unique for each infected system\nand ‘session keys’ that are generated each time the malware is launched on the system.\n\n**Master key generation**\n\nLet Q be a standard secp256k1 elliptic curve (“SECG curve over a 256 bit prime field”) and G\nbe the generator of a cyclic subgroup of points on this curve.\n\nLet malware_pub be the attackers’ public key contained in the Trojan’s body (it is a point on\nthe Q curve, stored as two separate coordinates – x and y).\n\nWhen infecting a system, the Trojan generates:\n\ninstall_id – the infection identifier – a random 8-byte sequence.\n**master_btc_priv – the private master key – a random 32-byte sequence, which is sent**\nto the C&C.\n**master_btc_pub = master_btc_priv * G (point on the curve) – the public master key;**\nstored in encrypted files.\nbtc_address – a bitcoin address used to receive the ransom payment – generated\nusing the standard Bitcoin algorithm, based on master_btc_pub.\n**master_ecdh_secret = ECDH(malware_pub, master_btc_priv) – a “shared master**\nkey”, required for decryption if master_btc_priv is lost or does not reach the C&C; not\nsaved anywhere in this form.\n**master_ecdh_secret_mul = master_ecdh_secret * master_btc_priv – a number**\nthat can be used to recover master_btc_priv; stored in the system.\n\n\n-----\n\n**Note**\nmaster_btc_priv (in accordance with the Bitcoin operating principle) is a private key that is\nneeded to ‘withdraw’ the Bitcoins sent to the newly created address btc_address.\n\n**Session key generation**\n\nEvery time it is launched (when first infecting a computer or, e.g., after a reboot), the Trojan\ngenerates new copies of:\n\n**session_priv – a private session key – random 32 bytes. Used to encrypt files, not**\nsaved anywhere\n**session_pub = session_priv * G – a public session key. Stored in encrypted files.**\n**session_ecdh_secret = ECDH(master_btc_pub, session_priv) – a “shared session**\nkey” – needed to decrypt files, not saved anywhere in this form.\n**session_ecdh_secret_mul = session_ecdh_secret * session_priv – a number that**\ncan be used to recover session_ecdh_secret. Stored in encrypted files.\n\n### Key data saved in the system\n\nUnlike previous version of the malware, TeslaCrypt 2.0.0 does not use key.dat or storage.bin\nto store data. Instead, it uses the system registry: an install_id value is stored in\nHKCU\\Software\\msys\\ID, and the following structure is added to HKCU\\Software\\\n<install_id>\\data:\n\nIn the familiar syntax of the C programming language, the structure can be described as\nfollows:\n\n\n-----\n\nHere is what it looks like on an infected system:\n\n### File encryption\n\n\n-----\n\nStarting from version 0.3.5, TeslaCrypt affects both regular drives connected to the system\nand all file resources available on the network (shares), even if they are not mounted as\ndrives with letters of their own. Few other encryptors can boast this functionality.\n\nEach file is encrypted using the AES-256-CBC algorithm with session_priv as a key. An\nencrypted file gets an additional extension, “.zzz”. A service structure is added to the\nbeginning of the file, followed by encrypted file contents. The structure has the following\nformat:\n\nThe same structure in C language syntax:\n\n### File decryption\n\nThe authors of TeslaCrypt 2.0.0 completely removed the file decryption feature that was\npresent in earlier versions of the malware. Based on analyzing the encryption scheme\ndescribed above, we can suggest the following algorithms for decrypting the files:\n\n1. If master_btc_priv is known, do the following:\n\nRead session_pub from the encrypted file;\nCalculate session_ecdh_secret = ECDH(session_pub, master_btc_priv);\nRead session_ecdh_secret_mul from the encrypted file;\nCalculate session_priv = session_ecdh_secret_mul / session_ecdh_secret;\nDecrypt the file using the session_priv key.\n\n\n-----\n\n2. If master_btc_priv is unknown, but malware_priv is known (and the only people who\n\nknow it are the cybercriminals who added the corresponding malware_pub to the\nTrojan’s body):\n\nRead master_btc_pub from the registry or encrypted file;\nCalculate master_ecdh_secret = ECDH(master_btc_pub, malware_priv);\nRead master_ecdh_secret_mul from the encrypted file\nCalculate master_btc_priv = master_ecdh_secret_mul / master_ecdh_secret;\nWith master_btc_priv known, perform the steps from item 1.\n\n[To get a full understanding of the subject matter, it is worth reading about the Diffie-Hellman](https://en.wikipedia.org/wiki/Diffie%E2%80%93Hellman_key_exchange)\n[algorithm and ECDH – its version for elliptic curves. For example, this is a good resource.](http://andrea.corbellini.name/2015/05/30/elliptic-curve-cryptography-ecdh-and-ecdsa/)\n\n## Other features\n\n### Evading detection\n\nThe Trojan implements a detection evasion technique based on using COM objects. We first\nsaw it used in TeslaCrypt version 0.4.0, but since then it has been slightly modified.\nPseudocode generated based on version 2.0.0 looks like this:\n\n\n-----\n\n### C&C communication\n\nThe Trojan’s sample contains a static list of C&C addresses. The servers are actually on the\nTor network, but communication with them is carried out through the Web using tor2web\nservices.\n\nBefore TeslaCrypt version 0.4.1, server requests were sent in plaintext; in subsequent\nversions they were encrypted using the AES-256-CBC algorithm, with a SHA256 hash of a\nstatic string from the malicious program’s body used as a key.\n\nThe pseudocode screenshot below shows the process of creating an HTTP request to be\nsent by the Trojan when infecting a system.\n\n## Distribution\n\n[Malware from the TeslaCrypt family is known to](https://isc.sans.edu/diary/Exploit+kits+(still)+pushing+Teslacrypt+ransomware/19581) [be distributed using exploit kits such as](https://threatpost.com/angler-exploit-kit-pushing-new-unnamed-ransomware/112751)\nAngler, Sweet Orange and Nuclear. This method of distributing malware works as follows:\nwhen a victim visits an infected website, an exploit’s malicious code uses vulnerabilities in\nthe browser (usually in plugins) to install target malware in the system.\n\n\n-----\n\n_Geographical distribution of users attacked by malware from the TeslaCrypt family_\n\n## Recommendations\n\nTo protect data from encrypting ransomware, we advise users to backup all their important\nfiles regularly. Backup copies should be stored on drives that can only be written to as part of\nthe process of backing up data. For example, home users can use external hard drives,\nphysically disconnecting them from the computer immediately after creating backup copies.\n\nPromptly updating software (particularly browser plugins and the browser itself) is also\nextremely important, since vendors are always striving to close any vulnerabilities that are\nexploited by cybercriminals.\n\nIf malware did find its way into the system, an up-to-date antivirus product with updated\ndatabases and activated protection modules can help to stop it from doing any harm. This is\nespecially true of the proactive protection module, which is the last line of defense against 0day threats.\n\n[Financial malware](https://securelist.com/tag/financial-malware/)\n[Malware Descriptions](https://securelist.com/tag/malware-descriptions/)\n[Malware Statistics](https://securelist.com/tag/malware-statistics/)\n[Malware Technologies](https://securelist.com/tag/malware-technologies/)\n[Ransomware](https://securelist.com/tag/ransomware/)\n[Trojan](https://securelist.com/tag/trojan/)\n\nAuthors\n\n\n-----\n\nFedor Sinitsyn\n\nTeslaCrypt 2.0 disguised as CryptoWall\n\nYour email address will not be published. Required fields are marked *\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2015/2015-07-14 - TeslaCrypt 2.0 disguised as CryptoWall.pdf"
    ],
    "report_names": [
        "2015-07-14 - TeslaCrypt 2.0 disguised as CryptoWall.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535749,
    "ts_updated_at": 1743041159,
    "ts_creation_date": 1653766569,
    "ts_modification_date": 1653766569,
    "files": {
        "pdf": "https://archive.orkl.eu/563a0dac7fbe297332b36755f71eb65cddaaa794.pdf",
        "text": "https://archive.orkl.eu/563a0dac7fbe297332b36755f71eb65cddaaa794.txt",
        "img": "https://archive.orkl.eu/563a0dac7fbe297332b36755f71eb65cddaaa794.jpg"
    }
}