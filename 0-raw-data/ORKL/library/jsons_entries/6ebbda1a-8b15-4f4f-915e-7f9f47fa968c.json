{
    "id": "6ebbda1a-8b15-4f4f-915e-7f9f47fa968c",
    "created_at": "2023-01-12T15:04:12.853792Z",
    "updated_at": "2025-03-27T02:05:20.664193Z",
    "deleted_at": null,
    "sha1_hash": "6a1d8729a8ad327b8179b5eb9b1e66e4fe4d2467",
    "title": "2018-03-30 - Reflow JavaScript Backdoor",
    "authors": "",
    "file_creation_date": "2022-05-28T19:17:40Z",
    "file_modification_date": "2022-05-28T19:17:40Z",
    "file_size": 52928,
    "plain_text": "# Reflow JavaScript Backdoor\n\n**kahusecurity.com/posts/reflow_javascript_backdoor.html**\n\nA script was left behind on a compromised machine. This led to the discovery of a Windows\nbackdoor written in JavaScript and the C&C backend scripts. Unfortunately I can't post too\nmuch details because the victim's organization name is present in the files.\n\nThe backdoor script is less than 2KB and the only indication of its presence on a\ncompromised PC is a running process called \"wscript.exe\", which is a legitimate Windows\nprogram. The main part of the script contains an endless do-loop awaiting commands after\npassing the query string \"reflow\" to the C&C else it sleeps for 4 hours.\n\nThe callback to the C&C looks like this:\n\nI wanted to find out more so I searched for code snippets in various search engines and\nVirusTotal but that led me nowhere. I turned to Recorded Future and found exactly what I\nwas looking for. In case you don't know Recorded Future (https://www.recordedfuture.com)\nhelps to enrich your raw data with useful contextualized and correlated threat intelligence.\nWhat I like best is its ability to find things that search engines can't because it's been\nremoved from paste sites or posted to a private forum, as examples.\n\nThe results I got show three hits to matching files that were deleted back in December\n2017. The cached data and link back to the original source helped me recover a\ncompressed file with the C&C package.\n\nThere are four main scripts (3 PHP and 1 JavaScript files) in the package that are copied to\na web server. The web server may be attacker-controlled or compromised by some means.\nThe main script, index.php, contains an SVG animation that looks like this when a visitor\nhappens to visit the page.\n\nThis script shows that when \"reflow\" is passed to the page, contents of a malicious\nJavaScript file (renamed as a PNG file) is sent to the victim PC and eval'd by the backdoor\nscript. The malicious script uses WMI to obtain the system Information then sends that info\nback as part of its authentication method.\n\n\n-----\n\nHere you can see the malicious script running an endless loop waiting for commands such\nas upload, download, and execute.\n\nThe \"mAuth\" function generates short random strings, concatenates them along with the\nsystem info and passes that to the C&C in a cookie after Base64-encoding it. These\nrandom strings are important as they are used as markers to identify instructions contained\nbetween them.\n\nData is transmitted back to the C&C using AJAX. There's a function called \"FillHeader\" that\npopulates the HTTP header.\n\nAgain, this is what the HTTP request looks like when the victim PC checks in:\n\nPerforming a Base64-decode on the cookie value results in the 2nd line. Repeating the\nBase64-decode on the string after the second caret reveals the system info.\n\nOne of the PHP scripts appears to be a template which is modified with HTML code to\nmake the page look legitimate (e.g. it contain parts of an organization's actual webpage).\nThe script is renamed and referenced by the index.php script. This script has all the\nfunctions responsible for uploading and downloading files as well as creating activity logs.\nAmong the log files are victim's IP addresses, what files have been uploaded and\ndownloaded, session information, etc.\n\nThe \"Authentication\" function reads in the cookie value from victims and parses out the\nsystem info, and defines variables used to create the log filenames. The victim's username\nand computer name are MD5-hashed and used as part of the log filenames. When a victim\nPC connects to the C&C, three files are created on the C&C server:\n\nThe last PHP script in their package is used to interact with and send commands to the\nvictim PCs. Note the timezone and interesting login method.\n\nThe available commands are quite limited but is more than enough to upload additional,\nmore powerful tools to the victim PC and gain further access into their network. And finally,\nif the attackers sense they are about to be discovered, they can delete all the important log\n\n\n-----\n\nfiles with another set of commands built into this script.\n\nI don't have any attribution information on these scripts but it doesn't seem to be related to\nyour-typical-crime-gang. It appears that this campaign is still ongoing as other files show\nupdated timestamps.\n\nPosted on: 03/30/2018\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-03-30 - Reflow JavaScript Backdoor.pdf"
    ],
    "report_names": [
        "2018-03-30 - Reflow JavaScript Backdoor.pdf"
    ],
    "threat_actors": [
        {
            "id": "ce10c1bd-4467-45f9-af83-28fc88e35ca4",
            "created_at": "2022-10-25T15:50:23.458833Z",
            "updated_at": "2025-03-27T02:00:55.475188Z",
            "deleted_at": null,
            "main_name": "APT34",
            "aliases": null,
            "source_name": "MITRE:APT34",
            "tools": [
                "netstat",
                "Systeminfo",
                "PsExec",
                "SEASHARPEE",
                "Tasklist",
                "Mimikatz",
                "POWRUNER",
                "certutil"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "cffb3c01-038f-4527-9cfd-57ad5a035c22",
            "created_at": "2022-10-25T15:50:23.38055Z",
            "updated_at": "2025-03-27T02:00:55.459558Z",
            "deleted_at": null,
            "main_name": "OilRig",
            "aliases": [
                "COBALT GYPSY",
                "IRN2",
                "APT34",
                "Helix Kitten",
                "Evasive Serpens",
                "Hazel Sandstorm",
                "EUROPIUM",
                "ITG13"
            ],
            "source_name": "MITRE:OilRig",
            "tools": [
                "ISMInjector",
                "RDAT",
                "Systeminfo",
                "QUADAGENT",
                "OopsIE",
                "Tasklist",
                "certutil",
                "ZeroCleare",
                "POWRUNER",
                "netstat",
                "ipconfig",
                "LaZagne",
                "BONDUPDATER",
                "SideTwist",
                "PsExec",
                "SEASHARPEE",
                "Mimikatz",
                "RGDoor",
                "ftp"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "67709937-2186-4a32-b64c-a5693d40ac77",
            "created_at": "2023-01-06T13:46:38.495593Z",
            "updated_at": "2025-03-27T02:00:02.848206Z",
            "deleted_at": null,
            "main_name": "OilRig",
            "aliases": [
                "IRN2",
                "Hazel Sandstorm",
                "EUROPIUM",
                "TA452",
                "Earth Simnavaz",
                "Cobalt Gypsy",
                "Crambus",
                "Helix Kitten",
                "APT 34",
                "APT34",
                "ATK40",
                "G0049",
                "Evasive Serpens",
                "Twisted Kitten"
            ],
            "source_name": "MISPGALAXY:OilRig",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "b6436f7b-6012-4969-aed1-d440e2e8b238",
            "created_at": "2022-10-25T16:07:23.91517Z",
            "updated_at": "2025-03-27T02:02:10.027531Z",
            "deleted_at": null,
            "main_name": "OilRig",
            "aliases": [
                "APT 34",
                "ATK 40",
                "Chrysene",
                "Cobalt Gypsy",
                "Crambus",
                "DEV-0861",
                "EUROPIUM",
                "Earth Simnavaz",
                "Evasive Serpens",
                "Hazel Sandstorm",
                "Helix Kitten",
                "IRN2",
                "ITG13",
                "Scarred Manticore",
                "Storm-0861",
                "TA452",
                "Twisted Kitten",
                "UNC1860",
                "Yellow Maero"
            ],
            "source_name": "ETDA:OilRig",
            "tools": [
                "AMATIAS",
                "Agent Drable",
                "Agent Injector",
                "AgentDrable",
                "Alma Communicator",
                "BONDUPDATER",
                "CACTUSPIPE",
                "Clayslide",
                "CypherRat",
                "DNSExfitrator",
                "DNSpionage",
                "DROPSHOT",
                "DistTrack",
                "DropperBackdoor",
                "Fox Panel",
                "GREYSTUFF",
                "GoogleDrive RAT",
                "HighShell",
                "HyperShell",
                "ISMAgent",
                "ISMDoor",
                "ISMInjector",
                "Jason",
                "Karkoff",
                "LIONTAIL",
                "LOLBAS",
                "LOLBins",
                "LONGWATCH",
                "LaZagne",
                "Living off the Land",
                "MailDropper",
                "Mimikatz",
                "MrPerfectInstaller",
                "OILYFACE",
                "OopsIE",
                "POWBAT",
                "POWRUNER",
                "Plink",
                "Poison Frog",
                "PowerExchange",
                "PsList",
                "PuTTY Link",
                "QUADAGENT",
                "RDAT",
                "RGDoor",
                "SEASHARPEE",
                "Saitama",
                "Saitama Backdoor",
                "Shamoon",
                "SideTwist",
                "SpyNote",
                "SpyNote RAT",
                "StoneDrill",
                "TONEDEAF",
                "TONEDEAF 2.0",
                "ThreeDollars",
                "TwoFace",
                "VALUEVAULT",
                "Webmask",
                "WinRAR",
                "ZEROCLEAR",
                "ZeroCleare",
                "certutil",
                "certutil.exe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535852,
    "ts_updated_at": 1743041120,
    "ts_creation_date": 1653765460,
    "ts_modification_date": 1653765460,
    "files": {
        "pdf": "https://archive.orkl.eu/6a1d8729a8ad327b8179b5eb9b1e66e4fe4d2467.pdf",
        "text": "https://archive.orkl.eu/6a1d8729a8ad327b8179b5eb9b1e66e4fe4d2467.txt",
        "img": "https://archive.orkl.eu/6a1d8729a8ad327b8179b5eb9b1e66e4fe4d2467.jpg"
    }
}