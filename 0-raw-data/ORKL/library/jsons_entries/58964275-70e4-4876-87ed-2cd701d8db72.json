{
    "id": "58964275-70e4-4876-87ed-2cd701d8db72",
    "created_at": "2023-01-12T15:05:48.583596Z",
    "updated_at": "2025-03-27T02:16:14.171414Z",
    "deleted_at": null,
    "sha1_hash": "3cb67a41b9eecf91d1b074836157ed1baafb5988",
    "title": "2020-07-05 - How to stop MortiAgent Malware using the snort rule-",
    "authors": "",
    "file_creation_date": "2022-05-29T01:37:22Z",
    "file_modification_date": "2022-05-29T01:37:22Z",
    "file_size": 55525,
    "plain_text": "# How to stop MortiAgent Malware using the snort rule ?\n\n**[live.paloaltonetworks.com/t5/custom-signatures/how-to-stop-mortiagent-malware-using-the-snort-rule/td-p/326590](https://live.paloaltonetworks.com/t5/custom-signatures/how-to-stop-mortiagent-malware-using-the-snort-rule/td-p/326590#)**\n\nMay 7, 2020\n\nI want to stop the MortiAgent malware by applying /using snort rule & also using yara rule?\n\nHow to configure this in Palo alto ?\n\nBelow are snort & Yara Rules:\n\n1. The below SNORT rule can be used to detect the MoriAgent Beacon.\n\nalert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg:\" MoriAgent Beacon\n\nHTTP Request\"; content:\"/Index.php?i=\"; depth:200; content:\"&t=\"; within:64;\n\ncontent:\"HTTP/1.1\"; within:64; content:\"Content-Type: application/json\"; within:32;\n\ncontent:\"Content-Length: 0\"; within:90; threshold:type limit,track by_src,count\n\n1,seconds 120; sid:1000001; rev:001;)\n\n2. Below are YARA rules to detect POWERSTATS.\n\nYARA rule to detect the substitution table used in PowerShell code.\n\nrule SubstitutionTable_in_PowerShell {\n\nmeta:\n\ndescription = \"Detect the substitution table used in PowerShell code (2019-2020)\"\n\nhash = \"A18016AF1E9ACDA5963112EE8BEEB28B\"\n\nstrings:\n\n$a1 = \"Replace('(','a'\"\n\n$a2 = \"Replace(')','b'\"\n\n$a3 = \"Replace('{','c'\"\n\n$a4 = \"Replace('}','d'\"\n\n$a5 = \"Replace('[','e'\"\n\n$a6 = \"Replace(']','f'\"\n\ncondition:\n\n$a1 and\n\n$a2 in (@a1..@a1+200) and\n\n$a3 in (@a1..@a1+200) and\n\n$a4 in (@a1..@a1+200) and\n\n$a5 in (@a1..@a1+200) and\n\n$a6 in (@a1..@a1+200) and\n\nfilesize < 100000\n\n}\nYARA rule to detect PowerStats backdoor.\n\nrule POWERSTATS_JscriptLauncher {\n\nmeta:\n\n\n-----\n\ndescription = POWERSTATS Jscript Launcher\nhash = \"6C97A39A7FFC292BAF8BE1391FCE7DA0\"\nstrings:\n$a1 = \"$s=(get-content\"\n$a2 = \"Get('Win32_Process').Create(cm\"\n$a3 = \"var cm=\"\ncondition:\nall of them and filesize < 600\n}\n\nYARA rule to detect PowerStats de-obfuscated\nrule POWERSTATSLite {\nmeta:\nhash = \"A18016AF1E9ACDA5963112EE8BEEB28B\"\nstrings:\n$a1 = \"$global:key\"\n$a2 = \"$global:time\"\n$a3 = \"webreq = [System.Net.WebRequest]::Create($url)\"\ncondition:\nall of them and filesize < 3000\n}\n\nYARA rule to detect MoriAgent implant\nrule MoriAgent {\nmeta:\ndescription = \"C++ MuddyWater implant\"\nhash = \"12755B210EC1171045144480ACD05AA8\"\nstrings:\n$f1 = \"|x7d873iqq\" ascii fullword\n$f2 = \"ljyfiiwnskt\" ascii fullword\n$f3 = \"htssjhy\" ascii fullword\n$f4 = \"kwjjfiiwnskt\" ascii fullword\n$f5 = \"hqtxjxthpjy\" ascii fullword\n$f6 = \"\\\\XFXyfwyzu\" ascii fullword\n$f7 = \"\\\\XFHqjfszu\" ascii fullword\n$f8 = \"ZmilXzwkm{{Umuwz\" ascii fullword\n$f9 = \"^qz|}itXzw|mk|\" ascii fullword\n$f10 = \"_zq|mXzwkm{{Umuwz\" ascii fullword\n$content = \"Content-Type: application/json\" ascii fullword\ncondition:\n\n\n-----\n\nuint16(0) == 0x5A4D and filesize < 2MB and\n$content and 5 of ($f*)\n}\n\nYARA rule to detect PowerStats Implants\nrule POWERSTATS_Implants\n{ meta:\ndescription = \"Detects all POWERSTATS implants\"\nhash = \"A18016AF1E9ACDA5963112EE8BEEB28B\"\nhash = \"409558610BE62655FBA0B1F93F2D9596\" hash =\n\"DD32B95F865374C31A1377E31FA79E87\" strings:\n$a1 = \"if ($resp -ne $null){\"\n$a2 = \"out = $_.Exception.Message\"\n$a3 = \"IEX $cmd -ErrorAction SilentlyContinue\"\ncondition:\nall of them and filesize < 50000\n}\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-07-05 - How to stop MortiAgent Malware using the snort rule-.pdf"
    ],
    "report_names": [
        "2020-07-05 - How to stop MortiAgent Malware using the snort rule-.pdf"
    ],
    "threat_actors": [
        {
            "id": "2ed8d590-defa-4873-b2de-b75c9b30931e",
            "created_at": "2023-01-06T13:46:38.730137Z",
            "updated_at": "2025-03-27T02:00:02.903261Z",
            "deleted_at": null,
            "main_name": "MuddyWater",
            "aliases": [
                "Boggy Serpens",
                "Mango Sandstorm",
                "TEMP.Zagros",
                "Static Kitten",
                "G0069",
                "TA450",
                "Earth Vetala",
                "Seedworm",
                "COBALT ULSTER",
                "ATK51"
            ],
            "source_name": "MISPGALAXY:MuddyWater",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "31e69945-6c1e-40c3-ba8e-a77e81dd142a",
            "created_at": "2024-05-01T02:03:08.047377Z",
            "updated_at": "2025-03-27T02:05:17.326452Z",
            "deleted_at": null,
            "main_name": "COBALT ULSTER",
            "aliases": [
                "ENT-11 ",
                "ITG17 ",
                "MERCURY ",
                "Mango Sandstorm ",
                "MuddyWater ",
                "STAC 1171 ",
                "Seedworm ",
                "Static Kitten ",
                "TEMP.Zagros ",
                "UNC3313 ",
                "Yellow Nix ",
                "Earth Vetala "
            ],
            "source_name": "Secureworks:COBALT ULSTER",
            "tools": [
                " Canopy",
                " CrackMapExec",
                " CredNinja",
                " Empire",
                " FORELORD",
                " Koadic",
                " LaZagne",
                " Ligolo",
                " MKL64",
                " Metasploit",
                " Mimikatz",
                " MiniDump",
                " Mori",
                " MuddyC2Go",
                " MuddyC3",
                " PhonyC2",
                " Plink",
                " PowGoop",
                " PowerStats",
                " RemoteUtilities",
                " Revsocks",
                " ScreenConnect",
                " SimpleHelp",
                " Small Sieve",
                " Syncro",
                " Venom Proxy",
                " WMIExec",
                "AnyDesk"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "02e1c2df-8abd-49b1-91d1-61bc733cf96b",
            "created_at": "2022-10-25T15:50:23.308924Z",
            "updated_at": "2025-03-27T02:00:55.437268Z",
            "deleted_at": null,
            "main_name": "MuddyWater",
            "aliases": [
                "MuddyWater",
                "Earth Vetala",
                "Static Kitten",
                "Seedworm",
                "TEMP.Zagros",
                "Mango Sandstorm",
                "TA450"
            ],
            "source_name": "MITRE:MuddyWater",
            "tools": [
                "STARWHALE",
                "POWERSTATS",
                "Out1",
                "PowerSploit",
                "Small Sieve",
                "Mori",
                "Mimikatz",
                "LaZagne",
                "PowGoop",
                "CrackMapExec",
                "ConnectWise",
                "SHARPSTATS",
                "RemoteUtilities",
                "Koadic"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "3c430d71-ab2b-4588-820a-42dd6cfc39fb",
            "created_at": "2022-10-25T16:07:23.880522Z",
            "updated_at": "2025-03-27T02:02:10.010443Z",
            "deleted_at": null,
            "main_name": "MuddyWater",
            "aliases": [
                "ATK 51",
                "Boggy Serpens",
                "Cobalt Ulster",
                "ITG17",
                "Mango Sandstorm",
                "MuddyWater",
                "Operation BlackWater",
                "Operation Earth Vetala",
                "Operation Quicksand",
                "Seedworm",
                "Static Kitten",
                "T-APT-14",
                "TA450",
                "TEMP.Zagros",
                "Yellow Nix"
            ],
            "source_name": "ETDA:MuddyWater",
            "tools": [
                "Agentemis",
                "BugSleep",
                "CLOUDSTATS",
                "ChromeCookiesView",
                "Cobalt Strike",
                "CobaltStrike",
                "CrackMapExec",
                "DELPHSTATS",
                "EmPyre",
                "EmpireProject",
                "FruityC2",
                "Koadic",
                "LOLBAS",
                "LOLBins",
                "LaZagne",
                "Living off the Land",
                "MZCookiesView",
                "Meterpreter",
                "Mimikatz",
                "MuddyC2Go",
                "MuddyRot",
                "Mudwater",
                "POWERSTATS",
                "PRB-Backdoor",
                "PhonyC2",
                "PowGoop",
                "PowerShell Empire",
                "PowerSploit",
                "Powermud",
                "QUADAGENT",
                "SHARPSTATS",
                "SSF",
                "Secure Socket Funneling",
                "Shootback",
                "Smbmap",
                "Valyria",
                "chrome-passwords",
                "cobeacon",
                "prb_backdoor"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535948,
    "ts_updated_at": 1743041774,
    "ts_creation_date": 1653788242,
    "ts_modification_date": 1653788242,
    "files": {
        "pdf": "https://archive.orkl.eu/3cb67a41b9eecf91d1b074836157ed1baafb5988.pdf",
        "text": "https://archive.orkl.eu/3cb67a41b9eecf91d1b074836157ed1baafb5988.txt",
        "img": "https://archive.orkl.eu/3cb67a41b9eecf91d1b074836157ed1baafb5988.jpg"
    }
}