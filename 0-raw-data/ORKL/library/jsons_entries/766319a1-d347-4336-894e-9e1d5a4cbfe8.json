{
    "id": "766319a1-d347-4336-894e-9e1d5a4cbfe8",
    "created_at": "2023-01-12T15:10:40.720442Z",
    "updated_at": "2025-03-27T02:05:45.415368Z",
    "deleted_at": null,
    "sha1_hash": "4a6aae965839ca78dcbe12d8f9faf077a580777f",
    "title": "2022-04-07 - Revenge RAT Malware is back- From Microsoft Excel macros to Remote Access Trojan",
    "authors": "",
    "file_creation_date": "2022-06-13T04:01:32Z",
    "file_modification_date": "2022-06-13T04:01:32Z",
    "file_size": 3886033,
    "plain_text": "# Revenge RAT malware is back\n\n**[perception-point.io/revenge-rat-back-from-microsoft-excel-macros/](https://perception-point.io/revenge-rat-back-from-microsoft-excel-macros/)**\n\nApril 7, 2022\n\n[First observed in 2016, Revenge RAT is a malware that is classified as a Remote Access](https://any.run/malware-trends/revenge)\nTrojan. This means that threat actors usually use it to remotely control infected PCs, surveil\nusers by capturing keystrokes, watching them via webcam, or even listening to their\nmicrophones.\n\nThrough Revenge RAT malware, threat actors can remotely execute malicious tasks on the\nuser’s computer and steal any sensitive data available to them.\n\n## The Revenge RAT Malware Phishing Email\n\n[Like almost every other attack these days, Revenge RAT malware is delivered via email, the](https://perception-point.io/channel-coverage/email-security/)\nnumber one attack vector for [cyberattacks.](https://perception-point.io/cyberattacks-are-becoming-more-sophisticated/)\n\nThe user receives an email that appears to be an urgent invoice request. The email instructs\nthe user to open up the attached invoice, an Excel file, and enable both editing and content,\nin order to “view” the content of the invoice. In reality, enabling editing and content activates\nthe attack chain flow, which we will explore further later on in this post.\n\nIt is important to note that there are some obvious warning signs within the email:\n\n\n-----\n\n1. The email subject is the exact name of the attached file, which indicates a low effort\n\nattempt by the threat actor to manipulate the user or convince them that the invoice is\nreal.\n2. The email contains an explanation of how to open the document, which usually\n\n[indicates that the threat actor is employing a social engineering technique by trying to](https://us.norton.com/internetsecurity-emerging-threats-what-is-social-engineering.html)\nget the user to perform the exact commands required to execute the malware.\n\nFigure1: Revenge RAT malware phishing email\n\n\n-----\n\n## The Revenge RAT Malware Attack Flow\n\nThe components of the Revenge RAT malware attack occur throughout multiple stages. The\nimage below shows the steps involved in the attack:\n\n\n-----\n\nFigure 2: Revenge RAT malware attack flow\n**Step 1: First, the XLS file (“QuickBooks Invoice Enclosed 10001144747631.xls”) is used in**\nthe attack vector by executing the macros it contains to run mshta.exe on a file located on\nthe C2 server.\n\n**Step 2: Then, “Enc.txt” (the executed file) executes another file on the C2 server using**\nPowerShell.\n\n**Step 3: Next, the executed file (“Server.txt”) creates a folder located on the user’s computer;**\ninside, 4 files are created as the file starts execution of one of the its new files.\n\n**Step 4: The first file executed (“IICOZODNLSRPOHUBAJWZFK.ps1”) creates a task that will**\nrun on the user’s computer every 3 minutes and will execute\n“IICOZODNLSRPOHUBAJWZFK.vbs”. This command contains code to execute\n“IICOZODNLSRPOHUBAJWZFK.hta” that will then execute\n“YHZYJGKGYAFXQEZFSRCPPY.ps1” (containing obfuscated Revenge RAT malware).\n\n**Step 5: Upon the execution of “YHZYJGKGYAFXQEZFSRCPPY.ps1”, two files within the file**\nare used to run the Revenge RAT malware.\n\n**Step 6: The Revenge RAT malware communicates with the C2 server and the threat actor**\nobtains a new C&C computer for his collection.\n\n\n-----\n\nBelow we provide a detailed analysis of files and commands used during the various stages\nof the Revenge RAT malware attack.\n\n## Initial Access\n\n[The initial document, “QuickBooks Invoice Enclosed 10001144747631.xls”, contains macros.](https://support.microsoft.com/en-us/office/quick-start-create-a-macro-741130ca-080d-49f5-9471-1e5fb3d581a8#:~:text=If%20you%20have%20tasks%20in,your%20mouse%20clicks%20and%20keystrokes.)\nThe creator of the document sets these commands to perform an action or a set of actions\nwithin the Excel document.\n\nIn the email, the threat actor explains that in order to view the content of the document the\nuser must enable editing and enable content. Included in the document are two warning\nsigns that there may be macros.\n\nOpening up the document, the user sees a clean Excel sheet and must click on “Enable\nEditing” and “Enable Content.” Once clicked, the malicious macro code begins to work.\n\nThe macro code is obfuscated within other text, making it difficult for most users to\nunderstand:\n\nFigure 3: The obfuscated code\nThree [replace functions act to replace embedded strings within the](https://support.microsoft.com/en-us/office/find-or-replace-text-and-numbers-on-a-worksheet-0e304ca5-ecef-4808-b90f-fdb42f892e90#:~:text=Find%20%26%20Replace%20dialog-,To%20replace%20text%20or%20numbers%2C%20press%20Ctrl%2BH%2C%20or,Click%20Replace%20or%20Replace%20All.)\n“WHBKJDFVRUXXYRDLFLHVGG” variable. The program then runs the content of the\nvariable by triggering the “Create” method under the Win32_Process class (WMI class\nrepresents a process on an operating system).\n\nThe de-obfuscated string looks like this:\n\nFigure 4: The de-obfuscated code\nThe macros execute “Mshta.exe”, which is a known signed Microsoft program. It can proxy\nexecution of malware (execute HTML applications files) and establish a connection with the\nC2 server in order to download a file named “Enc.txt” (which is an additional payload for the\nattack chain).\n\n\n-----\n\nFigure 5: Mshta.exe\n\nFigure 6: Enc.txt\nEnc.txt is yet another obfuscated file; it contains a script tag which will be executed through\nmshta.exe:\n\nFigure 7: Script tag within Enc.txt\nThe script is written in Visual Basic, which we know because there is a “language” indicator\n[in the opening tag. By the end of the script, it executes a PowerShell command, which](https://docs.microsoft.com/en-us/powershell/scripting/overview?view=powershell-7.2#:~:text=PowerShell%20is%20a%20cross%2Dplatform,Windows%2C%20Linux%2C%20and%20macOS.)\ndownloads another file from the C2 server and executes its content.\n\nBelow are the variables (and their values) of the PowerShell command:\n\nAHJTRRXVBYENECJTZIBQCT: StreamReader Class Object\nARYSWDUYBLHGDITSWDFEOG: WebRequest Class Object\nTESIORILDCDTLCYOWDHSGO: Create, (invoked from WebRequest) creates web\nrequest to the other file located on the C2 server\nKGHJKOKAPLPTBRQZIRBJZS: GetResponse\nBKCOKSGBGDNXDEAXSBNVJU: GetResponseStream\nZUVEOIPLZEGADWFECARLXA: ReadToEnd\n\nFigure 8: Variables and their values of PowerShell command\n\nFigure 9: PowerShell command\n\n\n-----\n\n## Defense Evasion\n\nIn order to evade defense measures, the Revenge RAT malware contains “Server.txt”, which\nis an obfuscated PowerShell file containing several variables. These variables represent four\nmalicious files that are created on the user’s computer.\n\nThe file starts its execution by checking if the folder it wants to create already exists. If it\ndoesn’t, then it creates the folder.\n\nFigure 10: Folder path “C:\\ProgramData\\IICOZODNLSRPOHUBAJWZFK”:\n\nFigure 11: 4 malicious files in the newly created folder\n\n## The Malware Kill Chain Process\n\nBelow is explanation of what each file does during the Revenge RAT malware kill chain\nprocess:\n\nFigure 12: IICOZODNLSRPOHUBAJWZFK.ps1: Schedules new tasks, which execute\nIICOZODNLSRPOHUBAJWZFK.vbs every 3 minutes.\n\nFigure 13: IICOZODNLSRPOHUBAJWZFK.vbs execution\n\nFigure 14: IICOZODNLSRPOHUBAJWZFK.vbs: Uses “mshta.exe”, the script executing\nIICOZODNLSRPOHUBAJWZFK.hta\n\n\n-----\n\nFigure 15: IICOZODNLSRPOHUBAJWZFK.hta: Similar to enc.txt, the file contains a script\nsection that executes the PowerShell command that runs\nYHZYJGKGYAFXQEZFSRCPPY.ps1\n\nFigure 16: YHZYJGKGYAFXQEZFSRCPPY.ps1: Contains two obfuscated files that are\nstored inside 2 variables (H5[Lime.dll], H6[Client.exe]). Once de-obfuscated, the files are run\nby a command crafted during the execution process of the file, which combines several\nvariables in order to execute the next command:\n“`Assembly:Load(Lime.dll).GetType(T.K).GetMethod(L).Invoke($null ,[object[]]\n(“C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\jsc.exe”, client.exe))`”\n\nFigure 17: The command being executed above injects the malware into a program and runs\nthe malware, impersonating a legitimate process (also known as “Process Injection”)\n\nFigure 18:The legitimate process is jsc.exe, a JavaScript compiler program signed by\nMicrosoft\n\n## C&C Server Connection\n\nAs previously mentioned, the command executes the Revenge RAT malware. We managed\nto extract the executable file from the obfuscated PowerShell file to provide a better overview\nof the payload.\n\nThe screenshot below shows basic information of the payload executable:\n\n\n-----\n\nFigure 19: Payload executable information\nWe can see that the code is actually compiled with .NET, meaning we can open the\nexecutable in DnSpy and view the code. Surprisingly, this malware’s code is readable and\nnot obfuscated.\n\nOne of the functions present in the code is “Config”, which contains the configuration of the\nRAT:\n\n\n-----\n\nFigure 20: Configuration of the RAT\n\n## Revenge RAT malware Config Class\n\nBelow are the members of the config class and their functionality:\n\nHost: C&C Server\nPort: C&C Port\nID: Unique ID of the installed RAT\nKey: Magic string used as a separator to split data on the packets\nCurrentMutex: Mutex placed by the RAT on the system\nSplitter: Magic string used as packet end string\nStopwatch(): Member function used to reset stopwatch\n\n## From computer to C2 server\n\nThe first packet sent from the user’s computer to the C2 server contains lots of sensitive data\nrelated to the user’s computer. The data collected using a custom class presents the code\nnamed “IdGenerator”. Below are some of the methods the class uses to retrieve sensitive\n\n\n-----\n\ndata:\n\nGetHardDiskSerialNumber: Get hard disk serial number\nGetIp: Get IP address\nGetCamera: Get information about the camera\nGetSystem: Get processor information\nGetCpu: Get CPU information\nGetAV: Get the antiviruses installed on the system\nGetActiveWindow: Get active window or window of the application used by the user\n\nFigure 21: The first packet sent: InformationRevenge-RATTVJfYWhtZWQ=RevengeRATX0IwQTAzOUM1Revenge-RAT169.254.102.77RevengeRATREVTS1RPUC0zQUs1RTBVIC8gRmxhcmUtVk0=Revenge-RATNoRevengeRATTWljcm9zb2Z0IFdpbmRvd3MgMTAgUHJvIDY0Revenge\n\n-----\n\nRATSW50ZWwoUikgQ29yZShUTSkgaTUtOTQwMEYgQ1BVIEAgMi45MEdIeg==RevengeRAT4294496256Revenge-RATV2luZG93cyBEZWZlbmRlcg==Revenge-RATTi9BRevengeRAT2222Revenge-RATUHJvZ3JhbSBNYW5hZ2VyRevenge-RATZW4tVVM=RevengeRATFalse!@#%^NYAN#!@$\nThis packet contains everything the RAT malware collected using the function we explained\nabove. Now, when the malware establishes its connection, it can send commands that the\nuser’s malware agent will handle.\n\n## C&C Commands Execution\n\nOne of the classes within the code is called “PacketHandler”; it contains a function called\n“Handler”. “Handler” is in charge of handling all received C&C commands. The C2 server can\nsend 5 commands to the user’s computer:\n\nPNC: Ping/Heartbeat command, which makes sure the connection is still alive.\nP: Sends the name of the current working window on the user’s computer.\nIE: Checks for installed plugin in the registry of the user’s computer under\n“HKCU\\Software\\”\nLP: If the plugin in IE command isn’t found, the malware creates a new registry key\nunder “HKCU\\Software\\” named after the RAT mutex (base64 encoded) with a subkey,\nnamed after the value inside of it (MD5 hashed) and the value of the subkey. This\nbecomes a dll file sent on this command in order to maintain persistence and for further\nexecution.\n\nFigure 22: “Handler” function\n\n\n-----\n\nFigure 23: UNV: Uninstalls and restarts the RAT; it also creates a script saved in the\ntemporary folder on the user’s computer that, once it’s run by the malware, deletes the\noriginal “jsc.exe” file.\n\n## Recommendations\n\nRevenge RAT malware causes a massive problems when deployed on a highly valued\n[employee’s computer. Most likely delivered via a phishing email, it targets the individual](https://perception-point.io/how-to-prevent-phishing-attacks/)\nperson. It also requires the user’s attention to run the macros in order to initiate the attack.\n\nTo avoid falling victim to this type of attack, we recommend the following steps to mitigate\nyour organization’s risk:\n\n1. Educate your employees on the need for email security and the risk of opening suspicious\nemails and attachments.\n\n2. Run email security drills every few months, to ensure that employees know what to look\nfor in a suspicious email.\n\n3. Create a process for employees to follow when they receive a suspicious email or link.\n\n4. Disable macros in Microsoft Office applications.\n\nFor more information about how to protect your organization against malware attacks\n[delivered via phishing emails, read our Advanced Email Security guide today.](https://perception-point.io/wp-content/uploads/Advanced-Email-Security.pdf)\n\n[Here’s some related content you may enjoy: How to Prevent Malware Attacks](https://perception-point.io/how-to-prevent-malware-attacks/)\n\n## IOCs\n\n### IP Address:\n\n45.147.230.231:2222\n\n### URLs:\n\nhxxp[://]45[.]147[.]230[.]231/a/Enc[.]txt\n\nhxxp[://]45[.]147[.]230[.]231/a/Server[.]txt\n\n### Samples SHA-256:\n\nClient.exe – f6b2c58f9846adcb295edd3c8a5beaec31fff3bc98f6503d04e95be3f9f072e8\n\nLime.dll – 9fca9b70d87c1b81bbb48209986e59d9cf92ab3f5bfd5fecf432caf0c3fed444\n\n\n-----\n\nYHZYJGKGYAFXQEZFSRCPPY.ps1 –\n37a94b72cec528ffaa6fb82559ba2dc0b82bc1270edc85e7cee98d16f6b9c242\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-04-07 - Revenge RAT Malware is back- From Microsoft Excel macros to Remote Access Trojan.pdf"
    ],
    "report_names": [
        "2022-04-07 - Revenge RAT Malware is back- From Microsoft Excel macros to Remote Access Trojan.pdf"
    ],
    "threat_actors": [
        {
            "id": "e3492534-85a6-4c87-a754-5ae4a56d7c8c",
            "created_at": "2022-10-25T15:50:23.819113Z",
            "updated_at": "2025-03-27T02:00:55.552554Z",
            "deleted_at": null,
            "main_name": "Threat Group-3390",
            "aliases": [
                "Threat Group-3390",
                "Earth Smilodon",
                "TG-3390",
                "Emissary Panda",
                "BRONZE UNION",
                "APT27",
                "Iron Tiger",
                "LuckyMouse"
            ],
            "source_name": "MITRE:Threat Group-3390",
            "tools": [
                "Systeminfo",
                "gsecdump",
                "PlugX",
                "ASPXSpy",
                "Cobalt Strike",
                "Mimikatz",
                "Impacket",
                "gh0st RAT",
                "certutil",
                "China Chopper",
                "HTTPBrowser",
                "Tasklist",
                "netstat",
                "SysUpdate",
                "HyperBro",
                "ZxShell",
                "RCSession",
                "ipconfig",
                "Clambling",
                "pwdump",
                "NBTscan",
                "Pandora",
                "Windows Credential Editor"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "c63ab035-f9f2-4723-959b-97a7b98b5942",
            "created_at": "2023-01-06T13:46:38.298354Z",
            "updated_at": "2025-03-27T02:00:02.798255Z",
            "deleted_at": null,
            "main_name": "APT27",
            "aliases": [
                "TG-3390",
                "EMISSARY PANDA",
                "TEMP.Hippo",
                "Budworm",
                "Group 35",
                "BRONZE UNION",
                "Lucky Mouse",
                "Iron Taurus",
                "GreedyTaotie",
                "Red Phoenix",
                "ZipToken",
                "Iron Tiger",
                "G0027",
                "Earth Smilodon"
            ],
            "source_name": "MISPGALAXY:APT27",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536240,
    "ts_updated_at": 1743041145,
    "ts_creation_date": 1655092892,
    "ts_modification_date": 1655092892,
    "files": {
        "pdf": "https://archive.orkl.eu/4a6aae965839ca78dcbe12d8f9faf077a580777f.pdf",
        "text": "https://archive.orkl.eu/4a6aae965839ca78dcbe12d8f9faf077a580777f.txt",
        "img": "https://archive.orkl.eu/4a6aae965839ca78dcbe12d8f9faf077a580777f.jpg"
    }
}