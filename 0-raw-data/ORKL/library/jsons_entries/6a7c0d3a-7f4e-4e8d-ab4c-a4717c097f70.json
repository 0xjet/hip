{
    "id": "6a7c0d3a-7f4e-4e8d-ab4c-a4717c097f70",
    "created_at": "2023-01-12T15:06:33.628928Z",
    "updated_at": "2025-03-27T02:09:18.395807Z",
    "deleted_at": null,
    "sha1_hash": "01a8b9d04f3b8f4fe52b4a38826a32cd3f4c8b4e",
    "title": "2022-09-07 - Bumblebee Returns With New Infection Technique",
    "authors": "",
    "file_creation_date": "2022-10-02T12:09:00Z",
    "file_modification_date": "2022-10-02T12:09:00Z",
    "file_size": 4219293,
    "plain_text": "# Bumblebee Returns with New Infection Technique\n\n**[blog.cyble.com/2022/09/07/bumblebee-returns-with-new-infection-technique/](https://blog.cyble.com/2022/09/07/bumblebee-returns-with-new-infection-technique/)**\n\n## Delivers Payload Using Post Exploitation Framework\n\n\nSeptember 7, 2022\n\n\nDuring our routine threat-hunting exercise, Cyble Research & Intelligence Labs (CRIL) came across a\n[Twitter post wherein a researcher mentioned an interesting infection chain of the Bumblebee loader](https://twitter.com/Max_Mal_/status/1564607613693747204)\nmalware being distributed via spam campaigns.\n\nBumblebee is a replacement for the BazarLoader malware, which acts as a downloader and delivers\nknown attack frameworks and open-source tools such as Cobalt Strike, Shellcode, Sliver, Meterpreter,\netc. It also downloads other types of malware such as ransomware, trojans, etc.\n\n## Technical Details\n\nThe initial infection starts with a spam email that has a password-protected attachment that contains a\n.VHD (Virtual Hard Disk) extension file.\n\n\n-----\n\nThe VHD file contains two files. The first is named Quote.lnk and the second is a hidden file\n“imagedata.ps1”. The LNK shortcut file has the parameters to execute the file “imagedata.ps1”, which\nfurther loads the Bumblebee payload in the memory of the PowerShell. Figure 1 shows the VHD file and\nits contents, along with LNK file properties.\n\nFigure 1 – Content of VHD and the properties of LNK file\nThe following target command line is used by the LNK for executing the PowerShell Script\n“imagedata.ps1”\n\n_C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe -ep bypass -file imagedata.ps1_\n\n### First Stage PowerShell Loader\n\nUpon execution of the “imagedata.ps1” file, it hides the PowerShell window and runs the PowerShell\ncode stealthily in the background. By default, the malware uses the –windowstyle hidden PowerShell\ncommand for hiding the PowerShell window. However, in this case, the malware uses an alternate\ncommand, ShowWindow, to evade detection by Anti-virus scanners. The figure below shows the code\nsnippet used for hiding the PowerShell window.\n\n\n-----\n\nFigure 2 – Code snippet to hide the PowerShell window\nThe PowerShell script contains strings that are split into multiple lines and concatenated later for\nexecution. This is one of the techniques used by the malware to evade detection by Anti-virus products.\nThe figure below shows the obfuscated Base64 encoded streams that are normalized using the “insert”\nand “remove” keywords and stored in a list, as shown below.\n\nFigure 3 – Obfuscated Base64 encoded streams\nNext, the malware iterates through the list of normalized Base64 elements, concatenates, decodes them\nusing [System.Convert]::FromBase64String method, and finally performs the gzip decompression\noperation using the [System.IO.Compression.CompressionMode]::Decompress method. The gzip\ndecompressed data contains the second stage of the PowerShell script, which is further executed by the\n“Invoke-Expression”, as shown below.\n\n\n-----\n\nFigure 4 – Decompressing and invoking Second stage PowerShell script\n\n### Second Stage PowerShell Loader\n\nThis PowerShell script contains a large code block that loads the embedded DLL payload into the\nmemory of “powershell.exe”. The second stage PowerShell code also employs the same obfuscation\ntechnique used in the first stage, as shown below.\n\n\n-----\n\nFigure 5 – Obfuscated Second stage PowerShell script\n[The malware utilizes the PowerSploit module for its execution. The PowerSploit is an open-source post-](https://github.com/PowerShellMafia/PowerSploit)\n[exploitation framework in which the malware uses a method, Invoke-ReflectivePEInjection, for reflectively](https://github.com/PowerShellMafia/PowerSploit/blob/master/CodeExecution/Invoke-ReflectivePEInjection.ps1)\nloading the DLL into the PowerShell Process. This methodvalidates the embedded file and performs\nmultiple checks to ensure that the file is loaded properly on the executing system.\n\nThe image below shows the code similarities between the second stage PowerShell script present in the\nmemory of “PowerShell.exe” and the Invoke-ReflectivePEInjection code from GitHub.\n\n\n-----\n\nFigure 6 – Code similarities\nThe second stage PowerShell script contains a byte array in which the first byte is replaced with 0x4d to\nget the actual PE DLL file, as shown below. This DLL file is the final Bumblebee payload that performs\nother malicious activities.\n\nFigure 7 – Embedded payload\nThe image below showcases the DLL payload (LdrAddx64.dll) injected into the memory of Powershell\nprocess by using the Invoke-ReflectivePEInjection function. The DLL is reflectively loaded and avoids\ndetection by tools used to identify the DLLs of the active/running processes.\n\n\n-----\n\nFigure 8 – Presence of injected DLL in PowerShell memory\n\n### Bumblebee payload\n\nFigure 9 shows the file information of the final Bumblebee malware payload. Based on our static analysis,\nwe found that the payload is a 64-bit, DLL binary compiled with a Microsoft Visual C/C++ compiler.\n\nFigure 9 – Payload file details\n\n\n-----\n\n[In June 2022, we published a technical blog on the Bumblebee loader. Our research indicates that the](https://blog.cyble.com/2022/06/07/bumblebee-loader-on-the-rise/)\npayload behaviour of the current variant under our analysis is similar to the one we analyzed earlier.\n\n## Conclusion\n\nBumblebee, a recently developed malware loader, has quickly become a key component in a wide range\nof cyberattacks, besides replacing the existing BazarLoader. In an attempt to stay a step ahead of\ncybersecurity entities, Threat Actors (TAs) are constantly adapting new techniques and continuously\nmonitoring to stay updated on the defense mechanisms employed by enterprises. Similarly, TAs behind\nthe sophisticated Bumblebee loader keep updating its capabilities in order to strengthen its evasive\nmaneuvers and anti-analysis tricks.\n\nCRIL has been closely monitoring the Bumblebee malware group and other similar TA groups for a better\nunderstanding of their motivations and keeping our readers well-informed on the latest cybercrime news\nand cybersecurity challenges.\n\n## Our Recommendations\n\nRefrain from opening untrusted links and email attachments without first verifying their authenticity.\nEducate employees in terms of protecting themselves from threats like phishing’s/untrusted URLs.\nAvoid downloading files from unknown websites.\nUse strong passwords and enforce multi-factor authentication wherever possible.\nTurn on the automatic software update feature on your computer, mobile, and other connected\ndevices.\nUse a reputed antivirus and internet security software package on your connected devices,\nincluding PC, laptop, and mobile.\nBlock URLs that could spread the malware, e.g., Torrent/Warez.\nMonitor the beacon on the network level to block data exfiltration by malware or TAs.\nEnable Data Loss Prevention (DLP) Solutions on the employees’ systems.\n\n## MITRE ATT&CK® Techniques\n\n**Tactic** **Technique ID** **Technique Name**\n\n**Initial Access** [T1566](https://attack.mitre.org/techniques/T1566/) Phishing\n\n\n**Execution** [T1204](https://attack.mitre.org/techniques/T1204/)\n\n[T1059](https://attack.mitre.org/techniques/T1059/001/)\n\n**Privilege Escalation** [T1574](https://attack.mitre.org/techniques/T1574/002/)\n\n[T1055](https://attack.mitre.org/techniques/T1055/)\n\n**Defence Evasion** [T1027](https://attack.mitre.org/techniques/T1027/002/)\n\n[T1497](https://attack.mitre.org/techniques/T1497/)\n\n[T1574](https://attack.mitre.org/techniques/T1574/002/)\n\n**Discovery** [T1012](https://attack.mitre.org/techniques/T1012/)\n\n[T1082](https://attack.mitre.org/techniques/T1082/)\n\n[T1518](https://attack.mitre.org/techniques/T1518/001/)\n\n\nUser Execution\n\nPowerShell\n\nDLL Side-Loading\n\nProcess Injection\n\nObfuscated Files or Information\n\nVirtualization/Sandbox Evasion\n\nDLL Side-Loading\n\nQuery Registry\n\nSystem Information Discovery\n\nSecurity Software Discovery\n\n\n-----\n\n## Indicators Of Compromise (IoC)\n\n**Indicators** **Indicator**\n**Type**\n\n\n**Description**\n\nVHD file\n\nLNK file\n\nPS1 file –\nStage 1\n\nPS1 file –\nStage 2\n\nBumblebee\nDLL\npayload\n\n\n59fc33d849f9ad2ab4e4b7fe4b443a33\ne4ed0f94e8ad9aeeb019e6d253e2eefa83b51b5a\n2102214c6a288819112b69005737bcfdf256730ac859e8c53c9697e3f87839f2\n\nb3b877f927898a457e35e4c6a6710d01\n8ed3dfa1ece8dbad0ccc8be8c1684f5a3de08ccb\n1285f03b8dbe35c82feef0cb57b3e9b24e75efabba0589752c2256a8da00ad85\n\n254d757d0f176afa59ecea28822b3a71\n3e59fff860826055423dde5bbd8830cceae17cf3\n0ff8988d76fc6bd764a70a7a4f07a15b2b2c604138d9aadc784c9aeb6b77e275\n\n225b9fb42b5879c143c56ef7402cbcbc\n03369886e9fc4b7eacc390045aa9c4b7fffad69a\ndb91155087bd2051b7ac0576c0994e9fffb5225c26ea134cb2f38e819f385730\n\nda6feac8dff2a44784be3d078f2d4ac3\nc0f43d1d3e87b0e8b86b4b9e91cb55b4a1893b48\n9bd9da44cc2d259b8c383993e2e05bbe1bcdac917db563b94e824b4b1628e87c\n\n\nMD5\nSHA1\nSha256\n\nMD5\nSHA1\nSha256\n\nMD5\nSHA1\nSha256\n\nMD5\nSHA1\nSha256\n\nMD5\nSHA1\nSha256\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-09-07 - Bumblebee Returns With New Infection Technique.pdf"
    ],
    "report_names": [
        "2022-09-07 - Bumblebee Returns With New Infection Technique.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535993,
    "ts_updated_at": 1743041358,
    "ts_creation_date": 1664712540,
    "ts_modification_date": 1664712540,
    "files": {
        "pdf": "https://archive.orkl.eu/01a8b9d04f3b8f4fe52b4a38826a32cd3f4c8b4e.pdf",
        "text": "https://archive.orkl.eu/01a8b9d04f3b8f4fe52b4a38826a32cd3f4c8b4e.txt",
        "img": "https://archive.orkl.eu/01a8b9d04f3b8f4fe52b4a38826a32cd3f4c8b4e.jpg"
    }
}