{
    "id": "a2f5ca22-ef8d-4597-9938-21e4195b2609",
    "created_at": "2023-01-12T15:05:02.800468Z",
    "updated_at": "2025-03-27T02:09:17.890312Z",
    "deleted_at": null,
    "sha1_hash": "90eaa3c7c4126fef5dfd7a0c047ca02152739fed",
    "title": "2021-06-28 - Hancitor Continues to Push Cobalt Strike",
    "authors": "",
    "file_creation_date": "2022-05-28T18:03:59Z",
    "file_modification_date": "2022-05-28T18:03:59Z",
    "file_size": 2651654,
    "plain_text": "# Hancitor Continues to Push Cobalt Strike\n\n**[thedfirreport.com/2021/06/28/hancitor-continues-to-push-cobalt-strike/](https://thedfirreport.com/2021/06/28/hancitor-continues-to-push-cobalt-strike/)**\n\nJune 28, 2021\n\nFirst observed in 2014, Hancitor (also known as Chanitor and Tordal) is a downloader\ntrojan that has been used to deliver multiple different malware such as Pony, Vawtrak,\nand DELoader. [[1]](https://digital.nhs.uk/cyber-alerts/2016/cc-678)\n\nHere’s some great write ups on Hancitor:\n\n[Binary Defense – Analysis of Hancitor – When Boring Begets Beacon – Binary Defense](https://www.binarydefense.com/analysis-of-hancitor-when-boring-begets-beacon)\n\nGroup IB – Connecting the Bots: Hancitor fuels Cuba Ransomware Operations (groupib.com)\n\nUnit 42 – Recent Hancitor Infections Use Cobalt Strike and a Network Ping Tool\n(paloaltonetworks.com)\n\n## Case Summary\n\nIn this short intrusion, the threat actor gained initial access on a system through a maldoc\ncampaign which made use of the Hancitor downloader. The first-stage DLL, which was\ndropped by a malicious Word document, attempted to download multiple malware payloads\n\n\n-----\n\non the beachhead system, including Ficker Stealer. In addition, a Cobalt Strike beacon\npayload was downloaded, and deployed to perform post-exploitation activities. Once inside\nthe target environment, port scans and a large amount of ICMP traffic was observed–to\nidentify additional active systems. After about 20 minutes, the threat actor copied a batch\nscript file and DLL file to another system using the SMB protocol. A remote service was\ninstalled to start the batch file, which executed the Cobalt Strike shellcode-embedded DLL.\nOn the second compromised system, various discovery-related commands were executed\nbefore going silent. The threat actors were evicted before completing their mission.\n\n## Services\n\nWe offer multiple services including a Threat Feed service which tracks Command and\nControl frameworks such as Cobalt Strike, Metasploit, Empire, PoshC2, etc. More\n[information on this service and others can be found here. One of the Cobalt Strike servers](https://thedfirreport.com/services/)\nused in this intrusion was known about as far back as February and the other 2 were added\nto our Threat Feed on 5/20/21.\n\nWe also have artifacts available from this case such as pcaps, memory captures, files, Kape\n[packages, and more, under our Security Researcher and Organization services.](https://www.patreon.com/thedfirreport)\n\n## Timeline\n\n\n-----\n\n-----\n\n[Analysis and reporting completed by @pigerlin and](https://twitter.com/pigerlin) **[@v3t0_](https://twitter.com/v3t0_)**\n\n[Reviewed by @_pete_0](https://twitter.com/_pete_0)\n\n## MITRE ATT&CK v9\n\n Initial Access\n\nThe Hancitor malware was embedded in a macro-based Word document. This single-paged\ndocument contained a picture with instructions, attempting to lure the victim into enabling\nmacros.\n\nWhen the macro was enabled, the infection chain started, and the first-stage Hancitor DLL\nwas dropped to disk.\n\nReviewing the macro we can see that in sub yyy (towards the bottom) content within the\ndocument is being copied and used to create a file object by sub xxx which then is executed\nby the shell call to rundll32.\n\n\n-----\n\n-----\n\nLooking at the strings of the word document, we can see that there s an embedded OLE\nobject, which appears to be a PE file.\n\n## Execution\n\nThe malicious Hancitor DLL in the OLE object, named “rem.r”, was executed via rundll32.exe\nby passing the entry point “ESLMJYVFM”.\n\n\n-----\n\n[The botnet ID and C2 were extracted using Hatching Triage:](https://tria.ge/)\n\nLater on in the intrusion, the threat actor used the following command to execute a Cobalt\nStrike Beacon on another machine:\n```\nrundll32.exe c:\\programdata\\95.dll,TstSec 11985756\n\n## Defense Evasion\n\n```\nOn the beachhead system, the malicious Hancitor DLL injected into the svchost.exe process.\nThe code was injected into multiple instances of svchost.exe.\n\nMemory analysis also shows suspicious memory protections (page_execute_readwrite) and\nregions of the particular process.\n\nFinally, when looking at the process tree, we can identify the unusual parent-child process\nrelationship of rundll32.exe starting svchost.exe.\n\nThe svchost.exe process, in turn, injected a Cobalt Strike beacon into multiple rundll32.exe\ninstances. One of the injected rundll32.exe instance was also observed connecting to the\nCobalt Strike C2 server.\n\n\n-----\n\nIn addition, the malicious 95.dll, which was observed during the lateral movement phase, is\nalso designed to evade automated sandbox analysis. This DLL is crafted in such a way that\nit wouldn’t show malicious behavior if an exported function is not called by passing a specific\nparameter. The DLL contains the Cobalt Strike shellcode and will only execute if the\n“11985756” parameter is passed to the TstSec function.\n\n[After extracting the Cobalt Strike shellcode from 95.dll and emulating it via scdbg, we found](http://sandsprite.com/blogs/index.php?uid=7&pid=152)\nthat it’s connecting to 162.244.83[.]95 over port 8080.\n\nSince 95.dll was executed by rundll32.exe, and from the host logs, it is evident that\nrundll32.exe connected to 162.244.83[.]95 over port 8080.\n\nPacket analysis to the IP address mentioned above, shows that it’s downloading the Cobalt\nStrike beacon by initiating a HTTP GET request to /hVVH URI.\n\n\n-----\n\nOnce downloaded, the stager allocates a new memory region inside the current rundll32.exe\nprocess and loads it into the memory and starts the C2 activity.\n\n## Discovery\n\nOn the beachhead system, the threat actor started exploring their options to move laterally\nwithin the target network. The logged-on user account was utilized to interact with IPC$\nshares.\n\nFor one specific system, for which the threat actor showed interest, the contents of the C$\nshare was listed–we assess, to verify if the account had access permissions to the share\nbefore copying the malware to it:\n\nThe threat actor also pinged one of the Active Directory domain controllers from the\nbeachhead machine.\n\nA high amount of ICMP traffic, targeting various Class-A subnets ranges, was observed and\nused to identify other active systems within the environment.\n\nOn the second system, to which the adversary laterally moved (see section below), the\nfollowing discovery commands were executed:\n\n\n-----\n\n```\nnltest /domain_trusts\nnet view /domain\nnet time\n\n## Lateral Movement\n\n```\nThe injected svchost process dropped two files: a batch-file named: “95.bat” and a DLL-file\nnamed: “95.dll”. Both files were copied to the ProgramData folder of another system within\nthe environment.\n\nThe content of the batch file can be seen below–it executes the transferred DLL and then\ndeletes itself:\n\nTo execute the batch file, the threat actor installed, and started, a remote service on the other\nsystem.\n\n\n-----\n\n## Credential Access\n\nAn attempt to open lsass.exe process was observed on the system where lateral movement\noccurred but there were no signs of successful read attempts.\n\n## Command and Control\n\nIn the network traffic, we can identify a data stream pattern that is distinctive to Hancitor\nmalware.\n\nFirst, the malware performed a lookup of the external IP-address of the infected system (1).\nThis was followed by Hancitor C2 traffic, sent via HTTP POST requests, which included\nunique attributes of the infected system, such as hostname and username information (2).\n\nHancitor then attempted to download additional malware. This included the info-stealer\nknown as “Ficker Stealer” (4), for which the DNS traffic corresponds to a recent article posted\nby [Brad. However, in our case, the post infection HTTP traffic of Ficker Stealer was not](https://unit42.paloaltonetworks.com/hancitor-infections-cobalt-strike/)\nobserved.\n\n\n-----\n\nHancitor also attempted to download Cobalt Strike stagers (.bin files) (3), and Cobalt Strike\ntraffic was sent both encrypted and unencrypted (5).\n\n**Hancitor**\n\nvaethemanic[.]com/8/forum.php\ntembovewinated[.]ru/8/forum.php\nprournauseent[.]ru/8/forum.php\n\n**Cobalt Strike**\n\n216.250.248[.]88\nConfig:\n```\n\"x64\": \n\"config\": \n\"Jitter\": 0,\n\"Method 2\": \"POST\",\n\"Beacon Type\": \"0 (HTTP)\",\n\"Watermark\": 0,\n\"Method 1\": \"GET\",\n\"Polling\": 60000,\n\"C2 Server\": \"216.250.248.88,/ga.js\",\n\"Port\": 80,\n\"Spawn To x64\": \"%windir%\\\\sysnative\\\\rundll32.exe\",\n\"Spawn To x86\": \"%windir%\\\\syswow64\\\\rundll32.exe\",\n\"C2 Host Header\": \"\",\n\"HTTP Method Path 2\": \"/submit.php\"\n\"x86\": \n\"config\": \n\"Jitter\": 0,\n\"Method 2\": \"POST\",\n\"Beacon Type\": \"0 (HTTP)\",\n\"Watermark\": 0,\n\"Method 1\": \"GET\",\n\"Polling\": 60000,\n\"C2 Server\": \"216.250.248.88,/ptj\",\n\"Port\": 80,\n\"Spawn To x64\": \"%windir%\\\\sysnative\\\\rundll32.exe\",\n\"Spawn To x86\": \"%windir%\\\\syswow64\\\\rundll32.exe\",\n\"C2 Host Header\": \"\",\n\"HTTP Method Path 2\": \"/submit.php\"\n\n```\n162.244.83[.]95\n\nConfig:\n\n\n-----\n\n```\n x64 : \n\"sha1\": \"93d1f927eae5d7cee5a36c4b5570fedd1e04f362\",\n\"uri_queried\": \"/WZSY\",\n\"sha256\": \"0e5f353721f618b1d1ec89570443a4a42ae5e41d466f9a022ace75bf74ff9dcd\",\n\"config\": \n\"HTTP Method Path 2\": \"/submit.php\",\n\"C2 Host Header\": \"\",\n\"Watermark\": 0,\n\"Spawn To x86\": \"%windir%\\\\syswow64\\\\rundll32.exe\",\n\"Method 1\": \"GET\",\n\"Spawn To x64\": \"%windir%\\\\sysnative\\\\rundll32.exe\",\n\"Polling\": 60000,\n\"C2 Server\": \"162.244.83.95,/fwlink\",\n\"Port\": 8080,\n\"Method 2\": \"POST\",\n\"Jitter\": 0,\n\"Beacon Type\": \"0 (HTTP)\"\n\"x86\": \n\"sha1\": \"d8f0bda5ee2416d7059b9ff58aa6c7f5357d3a6d\",\n\"uri_queried\": \"/Vdn4\",\n\"sha256\": \"c0ef889bda5881d8c5441ba7bed8655851d9f734d1ede2bb934f2c5060b65e61\",\n\"config\":\n\"HTTP Method Path 2\": \"/submit.php\",\n\"C2 Host Header\": \"\",\n\"Watermark\": 0,\n\"Spawn To x86\": \"%windir%\\\\syswow64\\\\rundll32.exe\",\n\"Method 1\": \"GET\",\n\"Spawn To x64\": \"%windir%\\\\sysnative\\\\rundll32.exe\",\n\"Polling\": 60000,\n\"C2 Server\": \"162.244.83.95,/match\",\n\"Port\": 8080,\n\"Method 2\": \"POST\",\n\"Jitter\": 0,\n\"Beacon Type\": \"0 (HTTP)\"\n\n```\n80.209.242[.]9\n```\nja3: 72a589da586844d7f0818ce684948eea\nja3s: ae4edc6faf64d08308082ad26be60767\nCertificate:[6e:ce:5e:ce:41:92:68:3d:2d:84:e2:5b:0b:a7:e0:4f:9c:b7:eb:7c ]\nNot Before: 2015/05/20 14:26:24\nNot After: 2025/05/17 14:26:24\nIssuer Org\nSubject Common\nSubject Org\nPublic Algorithm:rsaEncryption\n\n```\nConfig:\n\n\n-----\n\n```\n\"x86\":\n\"sha256\": \"57d4976c4daee794299e5e7c6374db3494e9a1df1f967aa9010624099ed6da16\",\n\"time\": 1621526952543.7,\n\"sha1\": \"0aea959b387c58f1ac47fb6946d1330cab301c2e\",\n\"md5\": \"494db8c61916acc6ae99b868d4869089\",\n\"config\":\n\"Port\": 80,\n\"Spawn To x64\": \"%windir%\\\\sysnative\\\\rundll32.exe\",\n\"Spawn To x86\": \"%windir%\\\\syswow64\\\\rundll32.exe\",\n\"Beacon Type\": \"0 (HTTP)\",\n\"C2 Server\": \"80.209.242.9,/match\",\n\"HTTP Method Path 2\": \"/submit.php\",\n\"Method 2\": \"POST\",\n\"Method 1\": \"GET\",\n\"Polling\": 60000,\n\"Jitter\": 0\n\"x64\":\n\"sha256\": \"e468e4c9226f47815dee0bfd35a2b065e7375a7be228845e35607ea00c87b6ac\",\n\"time\": 1621526967489.4,\n\"sha1\": \"db3a7c60fc281a200a3cf1554bae5f99491fa744\",\n\"md5\": \"b4589d6f80fa1131e8ab7504793f878b\",\n\"config\":\n\"Port\": 80,\n\"Spawn To x64\": \"%windir%\\\\sysnative\\\\rundll32.exe\",\n\"Spawn To x86\": \"%windir%\\\\syswow64\\\\rundll32.exe\",\n\"Beacon Type\": \"0 (HTTP)\",\n\"C2 Server\": \"80.209.242.9,/updates.rss\",\n\"HTTP Method Path 2\": \"/submit.php\",\n\"Method 2\": \"POST\",\n\"Method 1\": \"GET\",\n\"Polling\": 60000,\n\"Jitter\": 0\n\"x86\":\n\"sha256\": \"e9a95e09e762020f23d238b364be8b5b61c6662099f5bdf4ac5a102bd31fec98\",\n\"time\": 1621526949089.5,\n\"sha1\": \"45d1f56ccbe33d0f8c727ef2c740fdd1b3eee01b\",\n\"md5\": \"d1f6ba82ba87e4a957e73160773e782a\",\n\"config\":\n\"Port\": 443,\n\"Spawn To x64\": \"%windir%\\\\sysnative\\\\rundll32.exe\",\n\"Spawn To x86\": \"%windir%\\\\syswow64\\\\rundll32.exe\",\n\"Beacon Type\": \"8 (HTTPS)\",\n\"C2 Server\": \"80.209.242.9,/ca\",\n\"HTTP Method Path 2\": \"/submit.php\",\n\"Method 2\": \"POST\",\n\"Method 1\": \"GET\",\n\"Polling\": 60000,\n\"Jitter\": 0\n\"x64\":\n\"sha256\": \"0fdf544145bd491fa7a19b24875f0231f414fbde07e50e1af219d063c08989f9\",\n\"time\": 1621526962664.6,\n\n```\n\n-----\n\n```\n sha1 : 67213613a61c9552955e068ad417e48b7bad8fa6,\n\"md5\": \"a4e1f497c424a259d2b52d6414a6365f\",\n\"config\":\n\"Port\": 443,\n\"Spawn To x64\": \"%windir%\\\\sysnative\\\\rundll32.exe\",\n\"Spawn To x86\": \"%windir%\\\\syswow64\\\\rundll32.exe\",\n\"Beacon Type\": \"8 (HTTPS)\",\n\"C2 Server\": \"80.209.242.9,/ca\",\n\"HTTP Method Path 2\": \"/submit.php\",\n\"Method 2\": \"POST\",\n\"Method 1\": \"GET\",\n\"Polling\": 60000,\n\"Jitter\": 0\n\n## Impact\n\n```\nIn this intrusion we did not see a final action on objectives.\n\n## IOC’s\n\n**Files**\n```\n95.dll\n98b2fff45a9474d61c1bd71b7a60712b\n3b0ec4b6ad3cf558cac6b2c6e7d8024c438cfbc5\n7b2144f2b5d722a1a8a0c47a43ecaf029b434bfb34a5cffe651fda2adf401131\n95.bat\n5b3c525c2883ba588d0cfe848c0151b3\n012c934a2e4536398ac2c3a1614a3927709e7d61\n28b3b7d1421b39ad747d3ddfe2322bfe505a00f43d0adab80671e9c442f1472e\nrem.r\nf7b1fc5b175b40bcddf6170ed265b442\nf67c640d6b00c7bcd0d498c8de1b6eee6868d41f\n50b63958880b915219d5364d08593dce44effd49a0f25f7b0609cab8f1e0ec5d\n0520_656407893761.doc\n632c214b5a3f8bdfa91197e121f41db1\n9744884a328416906de484acbe1200a83cb7b5fa\nd43ec0226fd6af4d0848cd1fa2329b93fb73341814dd8536c53b6da0e31b3844\n\n```\n**Network**\n\n\n-----\n\n```\ntembovewinated[.]ru\nprournauseent[.]ru\nsweyblidian[.]com\nvaethemanic[.]com\nq09pi7[.]ru\n 216.250.248[.]88\n162.244.83[.]95\n80.209.242[.]9\n\n## Detections\n\n```\n**Suricata**\n\nET POLICY External IP Lookup (ipfy.org)\n\nET INFO Suspicious Empty SSL Certificate – Observed in Cobalt Strike\n\nET INFO GENERIC SUSPICIOUS POST to Dotted Quad with Fake Browser 1\n\nET NETBIOS DCERPC SVCCTL – Remote Service Control Manager Access\n\nET TROJAN Observed Cobalt Strike User-Agent\n\nETPRO TROJAN Tordal/Hancitor/Chanitor Checkin\n\nETPRO TROJAN Cobalt Strike Beacon Observed\n\n**Snort**\n```\nBinary Defense Created - alert tcp any any -> any $HTTP_PORTS (msg:\"Possible Hancitor\nCheckin\"; flow:established,to_server; content:\"POST\"; http_method;content:\"GUID=\";\nhttp_client_body; content:\"&BUILD=\"; http_client_body; content:\"&INFO=\";\nhttp_client_body; content:\"&EXT=\"; http_client_body; content:\"&IP=\";\nhttp_client_body; content:\"&WIN=\"; http_client_body; reference:md5,\n3c3a9a00b60c85c507ece4b4025d0f72; classtype:trojan-activity; sid:210611; rev:1;)\n\n```\n**Sigma**\n\nhttps://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_susp_s\nvchost.yml\n\nhttps://github.com/SigmaHQ/sigma/blob/master/rules/windows/network_connection/sysmon_\nrundll32_net_connections.yml\n\nhttps://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_trust_di\nscovery.yml\n\n**YARA**\n\n\n-----\n\n```\n/\nYARA Rule Set\nAuthor: The DFIR Report\nDate: 2021-06-27\nIdentifier: 4301 Hancitor\nReference: https://thedfirreport.com\n*/\n/* Rule Set ----------------------------------------------------------------- */\nimport \"pe\"\nrule sig_95_dll_cobalt_strike {\nmeta:\ndescription = \"file 95.dll\"\nauthor = \"The DFIR Report\"\nreference = \"https://thedfirreport.com\"\ndate = \"2021-06-24\"\nhash1 = \"7b2144f2b5d722a1a8a0c47a43ecaf029b434bfb34a5cffe651fda2adf401131\"\nstrings:\n$s1 = \"TstDll.dll\" fullword ascii\n$s2 = \"!This is a Windows NT windowed dynamic link library\" fullword ascii\n$s3 = \"AserSec\" fullword ascii\n$s4 = \"`.idata\" fullword ascii /* Goodware String - occured 1 times */\n$s5 = \"vEYd!W\" fullword ascii\n$s6 = \"[KpjrRdX&b\" fullword ascii\n$s7 = \"XXXXXXHHHHHHHHHHHHHHHHHHHH\" fullword ascii /* Goodware String - occured 2\ntimes */\n$s8 = \"%$N8 2\" fullword ascii\n$s9 = \"%{~=vP\" fullword ascii\n$s10 = \"it~?KVT\" fullword ascii\n$s11 = \"UwaG+A\" fullword ascii\n$s12 = \"mj_.%/2\" fullword ascii\n$s13 = \"BnP#lyp\" fullword ascii\n$s14 = \"(N\\\"-%IB\" fullword ascii\n$s15 = \"KkL{xK\" fullword ascii\n$s16 = \")[IyU,\" fullword ascii\n$s17 = \"|+uo6\\\\\" fullword ascii\n$s18 = \"@s?.N^\" fullword ascii\n$s19 = \"R%jdzV\" fullword ascii\n$s20 = \"R!-q$Fl\" fullword ascii\ncondition:\nuint16(0) == 0x5a4d and filesize < 100KB and\n( pe.imphash() == \"67fdc237b514ec9fab9c4500917eb60f\" and ( pe.exports(\"AserSec\") and\npe.exports(\"TstSec\") ) or all of them )\n}\nrule cobalt_strike_shellcode_95_dll {\nmeta:\ndescription = \"Cobalt Strike Shellcode\"\nauthor = \"The DFIR Report\"\nreference = \"https://thedfirreport.com\"\ndate = \"2021-06-23\"\nhash = \"7b2144f2b5d722a1a8a0c47a43ecaf029b434bfb34a5cffe651fda2adf401131\"\n\n```\n\n-----\n\n```\nstrings:\n$str_1 = { E8 89 00 00 00 60 89 E5 31 D2 64 8B 52 30 8B 52 }\n$str_2 = \"/hVVH\"\n$str_3 = \"User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64;\nTrident/5.0; BOIE9;ENGB)\"\ncondition:\n3 of them\n}\n\n```\n**MITRE**\n\nUser Execution – T1204\nWeb Protocols – T1071.001\nDynamic-link Library Injection – T1055.001\nRemote System Discovery – T1018\nNetwork Service Scanning – T1046\nWindows Service – T1543.003\nDomain Trust Discovery – T1482\nSystem Time Discovery – T1124\nNetwork Share Discovery – T1135\nFile Deletion – T1070.004\n\nInternal case 4301\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-06-28 - Hancitor Continues to Push Cobalt Strike.pdf"
    ],
    "report_names": [
        "2021-06-28 - Hancitor Continues to Push Cobalt Strike.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535902,
    "ts_updated_at": 1743041357,
    "ts_creation_date": 1653761039,
    "ts_modification_date": 1653761039,
    "files": {
        "pdf": "https://archive.orkl.eu/90eaa3c7c4126fef5dfd7a0c047ca02152739fed.pdf",
        "text": "https://archive.orkl.eu/90eaa3c7c4126fef5dfd7a0c047ca02152739fed.txt",
        "img": "https://archive.orkl.eu/90eaa3c7c4126fef5dfd7a0c047ca02152739fed.jpg"
    }
}