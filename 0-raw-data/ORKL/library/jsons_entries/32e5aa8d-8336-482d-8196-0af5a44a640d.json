{
    "id": "32e5aa8d-8336-482d-8196-0af5a44a640d",
    "created_at": "2023-01-12T15:03:56.171839Z",
    "updated_at": "2025-03-27T02:05:38.488182Z",
    "deleted_at": null,
    "sha1_hash": "af81fa43c0547d1510acba7afd93825bc6d282d2",
    "title": "2019-01-14 - Juicy Potato (abusing the golden privileges)",
    "authors": "",
    "file_creation_date": "2022-05-28T17:05:16Z",
    "file_modification_date": "2022-05-28T17:05:16Z",
    "file_size": 347960,
    "plain_text": "# Juicy Potato (abusing the golden privileges)\n\n**github.com/ohpe/juicy-potato**\n\nohpe\n\n_[A sugared version of RottenPotatoNG, with a bit of juice, i.e. another Local Privilege](https://github.com/breenmachine/RottenPotatoNG)_\n**_Escalation tool, from a Windows Service Accounts to NT AUTHORITY\\SYSTEM_**\n\n## Summary\n\n[RottenPotatoNG and its](https://github.com/breenmachine/RottenPotatoNG) [variants leverages the privilege escalation chain based on BITS](https://github.com/decoder-it/lonelypotato)\n[service having the MiTM listener on](https://github.com/breenmachine/RottenPotatoNG/blob/4eefb0dd89decb9763f2bf52c7a067440a9ec1f0/RottenPotatoEXE/MSFRottenPotato/MSFRottenPotato.cpp#L126) `127.0.0.1:6666 and when you have`\n```\nSeImpersonate or SeAssignPrimaryToken privileges. During a Windows build review we\n\n```\nfound a setup where `BITS was intentionally disabled and port` `6666 was taken.`\n\n[We decided to weaponize RottenPotatoNG: Say hello to Juicy Potato.](https://github.com/breenmachine/RottenPotatoNG)\n\nFor the theory, see Rotten Potato - Privilege Escalation from Service Accounts to\nSYSTEM and follow the chain of links and references.\n\nWe discovered that, other than `BITS there are a several COM servers we can abuse. They`\njust need to:\n\n1. be instantiable by the current user, normally a \"service user\" which has impersonation\n\nprivileges\n2. implement the `IMarshal interface`\n3. run as an elevated user (SYSTEM, Administrator, ...)\n\n\n-----\n\n[After some testing we obtained and tested an extensive list of interesting CLSID s on several](https://github.com/ohpe/juicy-potato/blob/master/CLSID/README.md)\nWindows versions.\n\n## Juicy details\n\nJuicyPotato allows you to:\n\n**Target CLSID**\n\n_[pick any CLSID you want. Here you can find the list organized by OS.](https://github.com/ohpe/juicy-potato/blob/master/CLSID/README.md)_\n\n**COM Listening port**\n\n_define COM listening port you prefer (instead of the marshalled hardcoded 6666)_\n\n**COM Listening IP address**\n\n_bind the server on any IP_\n\n**Process creation mode**\n\n_depending on the impersonated user's privileges you can choose from:_\n```\n      CreateProcessWithToken (needs SeImpersonate )\n      CreateProcessAsUser (needs SeAssignPrimaryToken )\n      both\n\n```\n**Process to launch**\n\n_launch an executable or script if the exploitation succeeds_\n\n**Process Argument**\n\n_customize the launched process arguments_\n\n**RPC Server address**\n\n_for a stealthy approach you can authenticate to an external RPC server_\n\n**RPC Server port**\n\n_useful if you want to authenticate to an external server and firewall is blocking port_\n```\n   135 ...\n\n```\n**TEST mode**\n\n_mainly for testing purposes, i.e. testing CLSIDs. It creates the DCOM and prints the_\n_user of token. See_ _[here for testing](https://github.com/ohpe/juicy-potato/blob/master/Test/README.md)_\n\n## Usage\n\n\n-----\n\n```\nT:\\>JuicyPotato.exe\nJuicyPotato v0.1\nMandatory args:\n-t createprocess call: <t> CreateProcessWithTokenW, <u> CreateProcessAsUser, <*> try\nboth\n-p <program>: program to launch\n-l <port>: COM server listen port\nOptional args:\n-m <ip>: COM server listen address (default 127.0.0.1)\n-a <argument>: command line argument to pass to program (default NULL)\n-k <ip>: RPC server ip address (default 127.0.0.1)\n-n <port>: RPC server listen port (default 135)\n-c <{clsid}>: CLSID (default BITS:{4991d34b-80a1-4291-83b6-3328366b9097})\n-z only test CLSID and print token's user\n\n## Example\n\n Final thoughts\n\n```\nIf the user has `SeImpersonate or` `SeAssignPrimaryToken privileges then you are`\n**SYSTEM.**\n\nIt's nearly impossible to prevent the abuse of all these COM Servers. You could think to\nmodify the permissions of these objects via `DCOMCNFG but good luck, this is gonna be`\nchallenging.\n\n\n-----\n\nThe actual solution is to protect sensitive accounts and applications which run under the\n```\nSERVICE accounts. Stopping DCOM would certainly inhibit this exploit but could have a\n\n```\nserious impact on the underlying OS.\n\n## Binaries buildbuild passingpassing\n\n[An automatic build is available. Binaries can be downloaded from the Artifacts section here.](https://ci.appveyor.com/project/ohpe/juicy-potato/build/artifacts)\n\n[Also available in BlackArch.](https://blackarch.org/)\n\n## Authors\n\n[Andrea Pierini](https://twitter.com/decoder_it)\n[Giuseppe Trotta](https://twitter.com/Giutro)\n\n## References\n\n\nbuildbuild passingpassing\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-01-14 - Juicy Potato (abusing the golden privileges).pdf"
    ],
    "report_names": [
        "2019-01-14 - Juicy Potato (abusing the golden privileges).pdf"
    ],
    "threat_actors": [
        {
            "id": "760f2827-1718-4eed-8234-4027c1346145",
            "created_at": "2023-01-06T13:46:38.670947Z",
            "updated_at": "2025-03-27T02:00:02.888195Z",
            "deleted_at": null,
            "main_name": "Kimsuky",
            "aliases": [
                "Thallium",
                "G0086",
                "APT43",
                "Springtail",
                "Sparkling Pisces",
                "Velvet Chollima",
                "Black Banshee",
                "Operation Stolen Pencil",
                "Emerald Sleet",
                "THALLIUM"
            ],
            "source_name": "MISPGALAXY:Kimsuky",
            "tools": [
                "RevClient",
                "xrat",
                "QUASARRAT",
                "RDP Wrapper",
                "TightVNC",
                "BabyShark"
            ],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "191d7f9a-8c3c-442a-9f13-debe259d4cc2",
            "created_at": "2022-10-25T15:50:23.280374Z",
            "updated_at": "2025-03-27T02:00:55.423485Z",
            "deleted_at": null,
            "main_name": "Kimsuky",
            "aliases": [
                "Kimsuky",
                "Black Banshee",
                "Velvet Chollima",
                "Emerald Sleet",
                "THALLIUM",
                "APT43",
                "TA427"
            ],
            "source_name": "MITRE:Kimsuky",
            "tools": [
                "schtasks",
                "Amadey",
                "Brave Prince",
                "CSPY Downloader",
                "gh0st RAT",
                "AppleSeed",
                "NOKKI",
                "QuasarRAT",
                "Gold Dragon",
                "PsExec",
                "KGH_SPY",
                "Mimikatz",
                "BabyShark"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "71a1e16c-3ba6-4193-be62-be53527817bc",
            "created_at": "2022-10-25T16:07:23.753455Z",
            "updated_at": "2025-03-27T02:02:09.963016Z",
            "deleted_at": null,
            "main_name": "Kimsuky",
            "aliases": [
                "APT 43",
                "Black Banshee",
                "Emerald Sleet",
                "ITG16",
                "KTA082",
                "Kimsuky",
                "Larva-24005",
                "Operation Baby Coin",
                "Operation Covert Stalker",
                "Operation DEEP#DRIVE",
                "Operation DEEP#GOSU",
                "Operation Kabar Cobra",
                "Operation Mystery Baby",
                "Operation Red Salt",
                "Operation Smoke Screen",
                "Operation Stealth Power",
                "Operation Stolen Pencil",
                "SharpTongue",
                "Sparkling Pisces",
                "Springtail",
                "TA406",
                "TA427",
                "Thallium",
                "UAT-5394",
                "Velvet Chollima"
            ],
            "source_name": "ETDA:Kimsuky",
            "tools": [
                "AngryRebel",
                "AppleSeed",
                "BITTERSWEET",
                "BabyShark",
                "BoBoStealer",
                "CSPY Downloader",
                "Farfli",
                "FlowerPower",
                "Gh0st RAT",
                "Ghost RAT",
                "Gold Dragon",
                "GoldDragon",
                "GoldStamp",
                "JamBog",
                "KGH Spyware Suite",
                "KGH_SPY",
                "KPortScan",
                "KimJongRAT",
                "Kimsuky",
                "LATEOP",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Lovexxx",
                "MailPassView",
                "Mechanical",
                "Mimikatz",
                "MoonPeak",
                "Moudour",
                "MyDogs",
                "Mydoor",
                "Network Password Recovery",
                "PCRat",
                "ProcDump",
                "PsExec",
                "ReconShark",
                "Remote Desktop PassView",
                "SHARPEXT",
                "SWEETDROP",
                "SmallTiger",
                "SniffPass",
                "TODDLERSHARK",
                "TRANSLATEXT",
                "Troll Stealer",
                "TrollAgent",
                "VENOMBITE",
                "WebBrowserPassView",
                "xRAT"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535836,
    "ts_updated_at": 1743041138,
    "ts_creation_date": 1653757516,
    "ts_modification_date": 1653757516,
    "files": {
        "pdf": "https://archive.orkl.eu/af81fa43c0547d1510acba7afd93825bc6d282d2.pdf",
        "text": "https://archive.orkl.eu/af81fa43c0547d1510acba7afd93825bc6d282d2.txt",
        "img": "https://archive.orkl.eu/af81fa43c0547d1510acba7afd93825bc6d282d2.jpg"
    }
}