{
    "id": "ac81e441-423f-45af-b17e-e2f5a3e702bf",
    "created_at": "2023-01-12T15:02:04.146766Z",
    "updated_at": "2025-03-27T02:16:16.783813Z",
    "deleted_at": null,
    "sha1_hash": "7f4c16915b9ac21e84838fa518c6515a88611414",
    "title": "2019-08-19 - GAME OVER- Detecting and Stopping an APT41 Operation",
    "authors": "",
    "file_creation_date": "2022-05-28T17:30:58Z",
    "file_modification_date": "2022-05-28T17:30:58Z",
    "file_size": 87827,
    "plain_text": "# GAME OVER: Detecting and Stopping an APT41 Operation\n\n**[fireeye.com/blog/threat-research/2019/08/game-over-detecting-and-stopping-an-apt41-operation.html](https://www.fireeye.com/blog/threat-research/2019/08/game-over-detecting-and-stopping-an-apt41-operation.html)**\n\nThreat Research\n\nAlex Pennino, Matt Bromiley\n\nAug 19, 2019\n\n6 mins read\n\nAdvanced Persistent Threats (APTs)\n\nThreat Research\n\n\n-----\n\nIn August 2019, FireEye [released the Double Dragon report on our newest graduated](https://www.fireeye.com/resources/apt41-dual-espionage-and-cyber-crime-operation)\nthreat group, APT41. A China-nexus dual espionage and financially-focused group, APT41\ntargets industries such as gaming, healthcare, high-tech, higher education,\ntelecommunications, and travel services. APT41 is known to adapt quickly to changes and\ndetections within victim environments, often recompiling malware within hours of incident\nresponder activity. In multiple situations, we also identified APT41 utilizing recently-disclosed\nvulnerabilities, often weaponzing and exploiting within a matter of days.\n\nOur knowledge of this group’s targets and activities are rooted in our Incident Response and\nManaged Defense services, where we encounter actors like APT41 on a regular basis. At\neach encounter, FireEye works to reverse malware, collect intelligence and hone our\ndetection capabilities. This ultimately feeds back into our Managed Defense and Incident\nResponse teams detecting and stopping threat actors earlier in their campaigns.\n\n[In this blog post, we’re going to examine a recent instance where FireEye Managed Defense](https://www.fireeye.com/mandiant/managed-detection-and-response.html)\ncame toe-to-toe with APT41. Our goal is to display not only how dynamic this group can be,\nbut also how the various teams within FireEye worked to thwart attacks within hours of\ndetection – protecting our clients’ networks and limiting the threat actor’s ability to gain a\nfoothold and/or prevent data exposure.\n\n**GET TO DA CHOPPA!**\n\nIn April 2019, FireEye’s Managed Defense team identified suspicious activity on a publiclyaccessible web server at a U.S.-based research university. This activity, a snippet of which is\n[provided in Figure 1, indicated that the attackers were exploiting CVE-2019-3396, a](https://nvd.nist.gov/vuln/detail/CVE-2019-3396)\nvulnerability in Atlassian Confluence Server that allowed for path traversal and remote code\nexecution.\n\nSnippet of PCAP showing attacker attempting CVE-2019-3396 vulnerability\n\nFigure 1: Snippet of PCAP showing attacker attempting CVE-2019-3396 vulnerability\n\nThis vulnerability relies on the following actions by the attacker:\n\nCustomizing the _template field to utilize a template that allowed for command\nexecution.\nInserting a cmd field that provided the command to be executed.\n\nThrough custom JSON POST requests, the attackers were able to run commands and force\nthe vulnerable system to download an additional file. Figure 2 provides a list of the JSON\ndata sent by the attacker.\n\n\n-----\n\nSnippet of HTTP POST requests exploiting CVE-2019-3396\n\n\nFigure 2: Snippet of HTTP POST requests exploiting CVE-2019-3396\n\nAs shown in Figure 2, the attacker utilized a template located at\nhxxps[:]//github[.]com/Yt1g3r/CVE-2019-3396_EXP/blob/master/cmd.vm. This publiclyavailable template provided a vehicle for the attacker to issue arbitrary commands against\nthe vulnerable system. Figure 3 provides the code of the file cmd.vm.\n\nCode of cmd.vm, used by the attackers to execute code on a vulnerable Confluence\nsystem\n\nFigure 3: Code of cmd.vm, used by the attackers to execute code on a vulnerable\nConfluence system\n\nThe HTTP POST requests in Figure 2, which originated from the IP address 67.229.97[.]229,\nperformed system reconnaissance and utilized Windows certutil.exe to download a file\nlocated at hxxp[:]//67.229.97[.]229/pass_sqzr.jsp and save it as test.jsp (MD5:\n84d6e4ba1f4268e50810dacc7bbc3935). The file test.jsp was ultimately identified to be a\nvariant of a **[China Chopper webshell.](https://www.fireeye.com/resources/breaking-down-china-chopper-web-shell-part-i)**\n\n**A Passive Aggressive Operation**\n\n\n-----\n\nShortly after placing test.jsp on the vulnerable system, the attackers downloaded two\nadditional files onto the system:\n\n64.dat (MD5: 51e06382a88eb09639e1bc3565b444a6)\nIns64.exe (MD5: e42555b218248d1a2ba92c1532ef6786)\n\nBoth files were hosted at the same IP address utilized by the attacker, 67[.]229[.]97[.]229.\nThe file Ins64.exe was used to deploy the HIGHNOON backdoor on the system. HIGHNOON\nis a backdoor that consists of multiple components, including a loader, dynamic-link library\n(DLL), and a rootkit. When loaded, the DLL may deploy one of two embedded drivers to\nconceal network traffic and communicate with its command and control server to download\nand launch memory-resident DLL plugins. This particular variant of HIGHNOON is tracked as\nHIGHNOON.PASSIVE by FireEye. (An exploration of passive backdoors and more analysis\n[of the HIGHNOON malware family can be found in our full APT41 report).](https://content.fireeye.com/apt-41/rpt-apt41)\n\nWithin the next 35 minutes, the attackers utilized both the test.jsp web shell and the\nHIGHNOON backdoor to issue commands to the system. As China Chopper relies on HTTP\nrequests, attacker traffic to and from this web shell was easily observed via network\nmonitoring. The attacker utilized China Chopper to perform the following:\n\nMovement of 64.dat and Ins64.exe to C:\\Program Files\\Atlassian\\Confluence\nPerforming a directory listing of C:\\Program Files\\Atlassian\\Confluence\nPerforming a directory listing of C:\\Users\n\nAdditionally, FireEye’s FLARE team reverse engineered the custom protocol utilized by the\nHIGHNOON backdoor, allowing us to decode the attacker’s traffic. Figure 4 provides a list of\nthe various commands issued by the attacker utilizing HIGHNOON.\n\nDecoded HIGHNOON commands issued by the attacker\n\nFigure 4: Decoded HIGHNOON commands issued by the attacker\n\n**Playing Their ACEHASH Card**\n\nAs shown in Figure 4, the attacker utilized the HIGHNOON backdoor to execute a\n[PowerShell command that downloaded a script from PowerSploit, a well-known PowerShell](https://github.com/PowerShellMafia/PowerSploit)\nPost-Exploitation Framework. At the time of this blog post, the script was no longer available\nfor downloading. The commands provided to the script – “privilege::debug\nsekurlsa::logonpasswords exit exit” – indicate that the unrecovered script was likely a copy of\n[Invoke-Mimikatz, reflectively loading Mimikatz 2.0 in-memory. Per the observed HIGHNOON](https://raw.githubusercontent.com/mattifestation/PowerSploit/master/Exfiltration/Invoke-Mimikatz.ps1)\noutput, this command failed.\n\nAfter performing some additional reconnaissance, the attacker utilized HIGHNOON to\ndownload two additional files into the C:\\Program Files\\Atlassian\\Confluence directory:\n\n\n-----\n\nc64.exe (MD5: 846cdb921841ac671c86350d494abf9c)\nF64.data (MD5: a919b4454679ef60b39c82bd686ed141)\n\nThese two files are the dropper and encrypted/compressed payload components,\nrespectively, of a malware family known as ACEHASH. ACEHASH is a credential theft and\npassword dumping utility that combines the functionality of multiple tools such as Mimikatz,\nhashdump, and Windows Credential Editor (WCE).\n\nUpon placing c64.exe and F64.data on the system, the attacker ran the command\n\nc64.exe f64.data \"9839D7F1A0 -m”\n\nThis specific command provided a password of “9839D7F1A0” to decrypt the contents of\nF64.data, and a switch of “-m”, indicating the attacker wanted to replicate the functionality of\nMimikatz. With the correct password provided, c64.exe loaded the decrypted and\ndecompressed shellcode into memory and harvested credentials.\n\nUltimately, the attacker was able to exploit a vulnerability, execute code, and download\ncustom malware on the vulnerable Confluence system. While Mimikatz failed, via ACEHASH\nthey were able to harvest a single credential from the system. However, as Managed\nDefense detected this activity rapidly via network signatures, this operation was neutralized\nbefore the attackers progressed any further.\n\n**Key Takeaways From This Incident**\n\nAPT41 utilized multiple malware families to maintain access into this environment;\nimpactful remediation requires full scoping of an incident.\nFor effective Managed Detection & Response services, having coverage of both\nEndpoint and Network is critical for detecting and responding to targeted attacks.\nAttackers may weaponize vulnerabilities quickly after their release, especially if they\nare present within a targeted environment. Patching of critical vulnerabilities ASAP is\ncrucial to deter active attackers.\n\n**Detecting the Techniques**\n\nFireEye detects this activity across our platform, including detection for certutil usage,\nHIGHNOON, and China Chopper.\n\n**Detection** **Signature Name**\n\n**China Chopper** FE_Webshell_JSP_CHOPPER_1\n\nFE_Webshell_Java_CHOPPER_1\n\n\n-----\n\nFE_Webshell_MSIL_CHOPPER_1\n\n**HIGHNOON.PASSIVE** FE_APT_Backdoor_Raw64_HIGHNOON_2\n\nFE_APT_Backdoor_Win64_HIGHNOON_2\n\n**Certutil Downloader** CERTUTIL.EXE DOWNLOADER (UTILITY)\n\nCERTUTIL.EXE DOWNLOADER A (UTILITY)\n\n**ACEHASH** FE_Trojan_AceHash\n\n**Indicators**\n\n**Type** **Indicator** **MD5 Hash (if applicable)**\n\nFile test.jsp 84d6e4ba1f4268e50810dacc7bbc3935\n\nFile 64.dat 51e06382a88eb09639e1bc3565b444a6\n\nFile Ins64.exe e42555b218248d1a2ba92c1532ef6786\n\nFile c64.exe 846cdb921841ac671c86350d494abf9c\n\nFile F64.data a919b4454679ef60b39c82bd686ed141\n\nIP Address 67.229.97[.]229 N/A\n\n[Looking for more? Join us for a webcast on August 29, 2019 where we detail more of](https://www.brighttalk.com/webcast/7451/366611)\n[APT41’s activities. You can also find a direct link to the public APT41 report here.](https://content.fireeye.com/apt-41/rpt-apt41/)\n\n**Acknowledgements**\n\nSpecial thanks to Dan Perez, Andrew Thompson, Tyler Dean, Raymond Leong, and Willi\nBallenthin for identification and reversing of the HIGHNOON.PASSIVE malware.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-08-19 - GAME OVER- Detecting and Stopping an APT41 Operation.pdf"
    ],
    "report_names": [
        "2019-08-19 - GAME OVER- Detecting and Stopping an APT41 Operation.pdf"
    ],
    "threat_actors": [
        {
            "id": "4c68ccd0-caba-4189-9ead-86ac4c2d9b70",
            "created_at": "2024-05-01T02:03:07.930196Z",
            "updated_at": "2025-03-27T02:05:17.251237Z",
            "deleted_at": null,
            "main_name": "BRONZE ATLAS",
            "aliases": [
                "Axiom",
                "BARIUM ",
                "Blackfly ",
                "CTG-2633",
                "GREF",
                "Group 72 ",
                "Red Kelpie ",
                "TG-2633 ",
                "Wicked Panda ",
                "Winnti",
                "APT41 "
            ],
            "source_name": "Secureworks:BRONZE ATLAS",
            "tools": [
                " CCleaner v5.33 backdoor",
                " ChinaChopper",
                " Cobalt Strike",
                " Dicey MSDN",
                " ForkPlayground",
                " HUC Proxy Malware (Htran)",
                " Mimikatz",
                " PipeMon",
                " PlugX",
                " PortReuse",
                " Powershell Empire",
                " RCMD",
                " RbDoor",
                " SPEEDBOAT",
                " ShadowPad",
                " Sidewalk",
                " Speculoos",
                " TeamViewer",
                " Winnkit",
                " Winnti",
                " reg save",
                " vssadmin",
                "Acehash"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "c7d9878a-e691-4c6f-81ae-84fb115a1345",
            "created_at": "2022-10-25T16:07:23.359506Z",
            "updated_at": "2025-03-27T02:02:09.752427Z",
            "deleted_at": null,
            "main_name": "APT 41",
            "aliases": [
                "BrazenBamboo",
                "Bronze Atlas",
                "Double Dragon",
                "Earth Baku",
                "Grayfly",
                "Operation ColunmTK",
                "Operation CuckooBees",
                "Operation ShadowHammer",
                "Red Kelpie",
                "SparklingGoblin",
                "TA415",
                "TG-2633"
            ],
            "source_name": "ETDA:APT 41",
            "tools": [
                "9002 RAT",
                "ADORE.XSEC",
                "ASPXSpy",
                "ASPXTool",
                "AceHash",
                "Agent.dhwf",
                "Agentemis",
                "AndroidControl",
                "AngryRebel",
                "AntSword",
                "BIOPASS",
                "BIOPASS RAT",
                "BLUEBEAM",
                "Barlaiy",
                "BlackCoffee",
                "Bladabindi",
                "BleDoor",
                "CCleaner Backdoor",
                "CHINACHOPPER",
                "COLDJAVA",
                "China Chopper",
                "ChyNode",
                "Cobalt Strike",
                "CobaltStrike",
                "Crackshot",
                "CrossWalk",
                "CurveLast",
                "CurveLoad",
                "DAYJOB",
                "DBoxAgent",
                "DEADEYE",
                "DEADEYE.APPEND",
                "DEADEYE.EMBED",
                "DEPLOYLOG",
                "DIRTCLEANER",
                "DUSTTRAP",
                "Derusbi",
                "Destroy RAT",
                "DestroyRAT",
                "DodgeBox",
                "DragonEgg",
                "ELFSHELF",
                "EasyNight",
                "Farfli",
                "FunnySwitch",
                "Gh0st RAT",
                "Ghost RAT",
                "HDD Rootkit",
                "HDRoot",
                "HKDOOR",
                "HOMEUNIX",
                "HUI Loader",
                "HidraQ",
                "HighNoon",
                "HighNote",
                "Homux",
                "Hydraq",
                "Jorik",
                "Jumpall",
                "KEYPLUG",
                "Kaba",
                "Korplug",
                "LATELUNCH",
                "LOLBAS",
                "LOLBins",
                "LightSpy",
                "Living off the Land",
                "Lowkey",
                "McRAT",
                "MdmBot",
                "MessageTap",
                "Meterpreter",
                "Mimikatz",
                "MoonBounce",
                "MoonWalk",
                "Motnug",
                "Moudour",
                "Mydoor",
                "NTDSDump",
                "PACMAN",
                "PCRat",
                "PINEGROVE",
                "PNGRAT",
                "POISONPLUG",
                "POISONPLUG.SHADOW",
                "POTROAST",
                "PRIVATELOG",
                "PipeMon",
                "PlugX",
                "PortReuse",
                "ProxIP",
                "ROCKBOOT",
                "RbDoor",
                "RedDelta",
                "RedXOR",
                "RibDoor",
                "Roarur",
                "RouterGod",
                "SAGEHIRE",
                "SPARKLOG",
                "SQLULDR2",
                "STASHLOG",
                "SWEETCANDLE",
                "ScrambleCross",
                "Sensocode",
                "SerialVlogger",
                "ShadowHammer",
                "ShadowPad Winnti",
                "SinoChopper",
                "Skip-2.0",
                "SneakCross",
                "Sogu",
                "Speculoos",
                "Spyder",
                "StealthReacher",
                "StealthVector",
                "TERA",
                "TIDYELF",
                "TIGERPLUG",
                "TOMMYGUN",
                "TVT",
                "Thoper",
                "Voldemort",
                "WIDETONE",
                "WINNKIT",
                "WINTERLOVE",
                "Winnti",
                "WyrmSpy",
                "X-Door",
                "XDOOR",
                "XMRig",
                "XShellGhost",
                "Xamtrav",
                "ZXShell",
                "ZoxPNG",
                "certutil",
                "certutil.exe",
                "cobeacon",
                "gresim",
                "njRAT",
                "pwdump",
                "xDll"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "4d5f939b-aea9-4a0e-8bff-003079a261ea",
            "created_at": "2023-01-06T13:46:39.04841Z",
            "updated_at": "2025-03-27T02:00:02.985296Z",
            "deleted_at": null,
            "main_name": "APT41",
            "aliases": [
                "G0096",
                "Grayfly",
                "BARIUM",
                "BRONZE ATLAS",
                "BRONZE EXPORT",
                "Red Kelpie",
                "HOODOO",
                "Brass Typhoon",
                "TA415",
                "WICKED SPIDER",
                "WICKED PANDA",
                "G0044",
                "Earth Baku"
            ],
            "source_name": "MISPGALAXY:APT41",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "e698860d-57e8-4780-b7c3-41e5a8314ec0",
            "created_at": "2022-10-25T15:50:23.287929Z",
            "updated_at": "2025-03-27T02:00:55.43005Z",
            "deleted_at": null,
            "main_name": "APT41",
            "aliases": [
                "APT41",
                "Wicked Panda",
                "Brass Typhoon",
                "BARIUM"
            ],
            "source_name": "MITRE:APT41",
            "tools": [
                "ASPXSpy",
                "BITSAdmin",
                "PlugX",
                "Impacket",
                "gh0st RAT",
                "netstat",
                "PowerSploit",
                "ZxShell",
                "KEYPLUG",
                "ipconfig",
                "sqlmap",
                "China Chopper",
                "ShadowPad",
                "MESSAGETAP",
                "Mimikatz",
                "certutil",
                "njRAT",
                "Cobalt Strike",
                "pwdump",
                "BLACKCOFFEE",
                "ROCKBOOT",
                "dsquery",
                "Winnti for Linux",
                "DUSTTRAP",
                "Derusbi",
                "ftp"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535724,
    "ts_updated_at": 1743041776,
    "ts_creation_date": 1653759058,
    "ts_modification_date": 1653759058,
    "files": {
        "pdf": "https://archive.orkl.eu/7f4c16915b9ac21e84838fa518c6515a88611414.pdf",
        "text": "https://archive.orkl.eu/7f4c16915b9ac21e84838fa518c6515a88611414.txt",
        "img": "https://archive.orkl.eu/7f4c16915b9ac21e84838fa518c6515a88611414.jpg"
    }
}