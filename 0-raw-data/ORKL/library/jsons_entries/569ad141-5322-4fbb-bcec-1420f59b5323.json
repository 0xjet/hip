{
    "id": "569ad141-5322-4fbb-bcec-1420f59b5323",
    "created_at": "2022-10-25T16:48:16.961446Z",
    "updated_at": "2025-03-27T02:14:38.883133Z",
    "deleted_at": null,
    "sha1_hash": "0a977831b7d744518f28166129f70d575f59c706",
    "title": "",
    "authors": "",
    "file_creation_date": "2019-04-23T04:02:12Z",
    "file_modification_date": "2019-04-23T04:02:12Z",
    "file_size": 4402732,
    "plain_text": "# FINTEAM: Trojanized TeamViewer Against Government Targets\n\n**research.checkpoint.com/finteam-trojanized-teamviewer-against-government-targets**\n\nApril 22, 2019\n**Introduction**\n\n\nApril 22, 2019\n\n\nRecently, Check Point researchers spotted a targeted attack against officials within government finance authorities and representatives in several\nembassies in Europe. The attack, which starts with a malicious attachment disguised as a top secret US document, weaponizes TeamViewer, the popular\nremote access and desktop sharing software, to gain full control of the infected computer.\n\nBy investigating the entire infection chain and attack infrastructure, we were able to track previous operations that share many characteristics with this\nattack’s inner workings. We also came across an online avatar of a Russian speaking hacker, who seems to be in charge of the tools developed and used\nin this attack.\n\nIn this article, we will discuss the infection chain, those targeted, the tools used and a possible attribution to one of the hackers behind the attack.\n\n**The Infection Chain**\n\nThe infection flow starts with an XLSM document with malicious macros, which is sent to potential victims via e-mail under the subject “Military Financing\nProgram”:\n\n**Email subject: military financing program**\n\n**File name: “Military Financing.xlsm”**\n\n**SHA-256:**\n\nefe51c2453821310c7a34dca30540\n\n21d0f6d453b7133c381d75e3140901efd12\n\n**Fig 1: Decoy document**\n\nThe well-crafted document bears the logo of the U.S Department of State, and is marked as Top Secret. Although the attackers have worked hard to\nmake the document appear convincing, they seem to have overlooked some Cyrillic artifacts (such as the Workbook name) that were left in the document,\nand could potentially reveal more information about the source of this attack.\n\n\n-----\n\n**Fig 2: The infection chain**\n\nOnce the macros are enabled, two files are extracted from hex encoded cells within the XLSM document:\n\n1. A legitimate AutoHotkeyU32.exe program.\n2. AutoHotkeyU32.ahk→an AHK script which sends a POST request to the C&C server and can receive additional AHK script URLs to download and\n\nexecute.\n\nThree different AHK scripts are awaiting on the server for the next stage:\n\n1. hscreen.ahk: Takes a screenshot of the victim’s PC and uploads it to the C&C server.\n2. hinfo.ahk: Sends the victim’s username and computer information to the C&C server.\n3. htv.ahk: Downloads a malicious version of TeamViewer, executes it and sends the login credentials to the C&C server.\n\nThe malicious TeamViewer DLL (TV.DLL) is loaded via the DLL side-loading technique, and is used to add more “functionality” to TeamViewer by hooking\nwindows APIs called by the program.\n\n**Modified functionality includes:**\n\n\n-----\n\nHiding the interface of TeamViewer, so that the user would not know it is running.\nSaving the current TeamViewer session credentials to a text file.\nAllowing the transfer and execution of additional EXE or DLL files.\n\n**Fig 3: MoveFileW function hook: adds payload “execute” and “inject” functionality.**\n\nThe following is a demonstration of how it actually works:\n\n\n-----\n\n**Fig 4: Remote payload execution demo**\n\n**Victims**\n\nAs described in the infection flow, one of the first uses of the AutoHotKey scripts is to upload a screenshot from the compromised PC.\n\nThe directory which those screenshots were uploaded to was left exposed, and could have been viewed by browsing to the specific URL:\n\n**Fig 5: Open directory with victims’ screenshots**\n\nHowever, those screenshot files were deleted periodically from the server, and eventually the\n“open directory” view was disabled.\n\nUntil that time, we were able to ascertain some of the victims of these attacks, as most of the\nscreenshots included identifying information.\n\nFrom the targets we have observed in our own telemetry, as well as the information we have\ngathered from the server, we were able to compose a partial list of countries, where officials were\ntargeted:\n\nNepal\nGuyana\nKenya\nItaly\nLiberia\nBermuda\nLebanon\n\nIt is hard to tell if there are geopolitical motives behind this campaign by looking solely at the list of\ncountries it was targeting, since it was not after a specific region and the victims came from\ndifferent places in the world.\n\nNevertheless, the observed victims list reveals a particular interest of the attacker in the public\nfinancial sector, as they all appear to be handpicked government officials from several revenue\nauthorities.\n\n**Previous Campaigns**\n\nWhile all campaigns observed from this threat actor utilized a trojanized version of TeamViewer, the features of the malicious DLL have changed, and the\nfirst stage of the infection has evolved over time.\n\nDelivery\n\n\n-----\n\nThe initial infection vector used by the threat actor also changed over time, during 2018 we have seen multiple uses of self extracting archives instead of\nmalicious documents with AutoHotKey, which displayed a decoy image to the user.\n\nFor example, the self-extracting archive “Положение о прокуратуре города(приказом прокурора края)_25.12.2018.DOC.exe” (translated into\n**“Regulations on the city prosecutor’s office (by order of the regional prosecutor)_25.12.2018.DOC.exe”) displays the following image:**\n\n**Fig 6: SFX archive decoy image**\n\nThis image shows officials from Kazakhstan, and was taken from the [website of Kazakhstan’s Ministry of Foreign Affairs. The original name of the](http://mfa.gov.kz/ru/content-view/v-baku-prezentovali-knigu-nursultan-nazarbaev-biografia-na-azerbajdzanskom-azyke)\nexecutable and the decoy content it displays seem to suggest that it was targeting Russian speaking victims.\n\nThere were also other instances in which related campaigns were after Russian speakers, one of the weaponized Excel documents had instructions on\nhow to enable content for the macros to run in fluent Russian:\n\n**Fig 7: Russian decoy document**\n\nSHA-256: 67d70754c13f4ae3832a5d655ff8ec2c0fb3caa3e50ac9e61ffb1557ef35d6ee\n\nAfterwards, it would display finance-related Russian content:\n\n\n-----\n\n**Fig 8: Russian decoy document – after macros are enabled**\n\nAlthough both examples of the different delivery methods described above show an exclusive targeting of Russian speakers, the recurring financial and\npolitical themes that they use highlight the attacker’s interest in the financial world once more.\n\n**The Payload**\n\nThroughout the campaigns multiple changes to the functionality of the malicious TeamViewer DLL, were introduced. Below are the feature highlights of\neach version:\n\n**First Variant (?-2018)**\n\nRemote control via TeamViewer\nSend & execute file.\nSends basic system information.\nAbility to self-delete.\nUsage of config.bin configuration file\n\n**Second Variant (2018)**\n\nIntroduced a new C&C command system.\nPartial list of the commands, can be viewed using the internal help command (which also provides multiple artifacts in Russian):\n\n**Fig 9: Help commands found in malicious DLL**\n\n\n-----\n\nChrome history of banks, online shops and crypto markets The DLL can be requested to return a list of all online services from a predefined list.\n(See Appendix)\nConfiguration file was replaced by embedded configuration.\n\n**Third Variant – as observed in the current campaign (2019)**\n\nRemoved the command system.\nAdded DLL execution feature.\nRelies on external AutoHotKey scripts for information gathering and TeamViewer credential exfiltration.\n\n**Attribution**\n\nAlthough in such campaigns it is usually unclear who is behind the attack, in this case we were able to locate a user who appears to be behind the\naforementioned activity active in several online forums, or is at least the creator of the tools used in the attack.\n\nBy following the trail from the previous campaigns we were able to find a `CyberForum[.]ru` user that goes by the name “EvaPiks”.\n\nIn multiple instances, the user would suggest, or be advised by other users to use, some of the techniques we witnessed throughout the campaigns.\n\nThe following are translated snippets from some of the threads in the forum:\n\n**Fig 10: EvaPiks – suggested macro code**\n\nThe macro code suggested by EvaPiks in the above thread was actually used in the latest attack, and some of the variable names such as “hextext” were\nnot even changed.\n\nIn the following screenshot, we see EvaPiks suggesting a Delphi code snippet that “works great”:\n\n\n-----\n\n**Fig 11: EvaPiks suggested PHP code**\n\n**Fig 12: Panel URL found in DLL code**\n\nIn addition to the similar Delphi usage, the URL mentioned in the forum `(newpanel_gate/gate.php)` was used in one of the attacks.\n\nBack in 2017, EvaPiks was the one seeking advice on the forum, with questions about API function call interception:\n\n**Fig 13: EvaPiks – seeking Delphi hooking advise on the forums**\n\n**Fig 14: Hooks found in DLL code**\n\nThe same hooking technique of `CreateMutexA` and `SetWindowTextW` functions was utilized\nin the sample we have observed as well.\n\nAn additional screenshot from the forum reveals how EvaPiks is experimenting with new\nfeatures, some of which were integrated into the malicious DLLs:\n\n\n-----\n\n**Fig 15: EvaPiks – development PC screenshot from the forums**\n\nBesides `CyberForum[.]ru`, we also found out that this avatar was active on an illegal Russian carding forum, strengthening the notion that their forum\nactivity is not for “educational purposes” only:\n\n**Fig 16: EvaPiks – complaining about a fellow user on a carding forum**\n\n**The Attack Infrastructure**\n\nAt one point or another, all the samples observed utilized the same web hosting company: HostKey, except some of the samples from the first variant.\n\n[see appendix B for a list of URLs]\n\nAdditionally, we observed the following login panels, on the C&C servers utilized by the malicious DLLs:\n\n\n-----\n\n**Fig 17: Cyber Industries login panel hosted on 193.109.69[.]5**\n\n**Fig 18: login panel hosted on 146.0.72[.]180**\n\n**Summary**\n\nOn the one hand, from the findings we have described, this appears to be a well thought-out attack that carefully selects a handful of victims and uses\ntailored decoy content to match the interests of its target audience.\n\nOn the other hand, some aspects of this attack were carried out with less caution, and have exposed details that are usually well disguised in similar\ncampaigns, such as the personal information and online history of the perpetrator, as well as the outreach of their malicious activity.\n\nThe malicious DLL allows the attacker to send additional payloads to a compromised machine and remotely run them. Since we were not able find such a\npayload and know what other functionalities it introduces besides the ones provided in the DLL, the real intentions of the latest attack remain unclear.\n\nHowever, the activity history of the developer behind the attack in underground carding forums and the victim’s characteristics may imply that the attacker\nis financially motivated.\n\n———————————————————————————————————————————————————————————————————————\n**Check Point’s SandBlast**\n\nThe malware used in this attack was caught using [Check Point’s Threat Emulation and](https://www.checkpoint.com/products/threat-emulation-sandboxing/https:/www.checkpoint.com/products/threat-emulation-sandboxing/) [Threat Extraction.](https://www.checkpoint.com/products/threat-extraction/)\n\nThreat Emulation is an innovative zero-day threat sandboxing capability, used by [SandBlast Network to deliver the best possible catch rate for threats,](https://www.checkpoint.com/products/advanced-network-threat-prevention/)\nand is virtually immune to attackers’ evasion techniques. As part of the Check Point [SandBlast Zero-Day Protection solution, Threat Emulation prevents](https://www.checkpoint.com/solutions/zero-day-protection/)\ninfections from new malware and targeted attacks. The Threat Extraction capability removes exploitable content, including active content and embedded\nobjects, reconstructs files to eliminate potential threats, and promptly delivers sanitized content to users to maintain business flow.\n\n**IOCs**\n\n**DLLs**\n\n`013e87b874477fcad54ada4fa0a274a2\n\n799AB035023B655506C0D565996579B5\n\ne1167cb7f3735d4edec5f7219cea64ef\n\n6cc0218d2b93a243721b088f177d8e8f\n\naad0d93a570e6230f843dcdf20041e1e\n\n1e741ebc08af09edc69f017e170b9852\n\nc6ae889f3bee42cc19a728ba66fa3d99\n\n1675cdec4c0ff49993a1fcbdfad85e56\n\n72de32fa52cc2fab2b0584c26657820f\n\n44038b936667f6ce2333af80086f877f`\n\n**Documents**\n\n`4acf624ad87609d476180ecc4c96c355\n\n4dbe9dbfb53438d9ce410535355cd973`\n\n\n-----\n\n**C&Cs**\n\n`1c-ru[.]net/check/license\n\nintersys32[.]com/3307/\n\n146.0.72[.]180/3307/\n\n146.0.72[.]180/newcpanel_gate/gate.php\n\n185.70.186[.]145/gate.php\n\n185.70.186[.]145/index.php\n\n193.109.69[.]5/3307/gate.php\n\n193.109.69[.]5/9125/gate.php`\n\n**Appendix A: Yara Rule**\n\n`rule \"TeamViwer_backdoor\"\n{\n\nmeta:\ndate = \"2019-04-14\"\ndescription = \"Detects malicious TeamViewer DLLs\"\n\nstrings:\n\n// PostMessageW hook function\n$x1 = {55 8b ec 8b 45 0c 3d 12 01 00 00 75 05 83 c8 ff eb 12 8b 55 14 52 8b 55 10 52 50 8b 45 08 50 e8}\n\ncondition:\nuint16(0) == 0x5a4d and $x1\n}`\n\n**Appendix B: Online services of interest**\n\n**Banks**\n\n`bankofamerica.com,pacwestbancorp.com,alipay.com,cbbank.com,firstrepublic.com,chase.com\n\ncitibank.com,bankamerica.com,wellsfargo.com,citicorp.com,pncbank.com,us.hsbc.com,bnymellon.com\n\nusbank.com,suntrust.com,statestreet.com,capitalone.com,bbt.com,tdbank.com,rbs.com,regions.com\n\n53.com,ingdirect.com,keybank.com,ntrs.com,www4.bmo.com,usa.bnpparibas.com,mufg.jp,aibgroup.com\n\ncomerica.com,zionsbank.com,mibank.com,bbvabancomerusa.com,huntington.com,bank.etrade.com,synovus.com\n\nbancopopular.com,navyfcu.org,schwab.com,rbcbankusa.com,colonialbank.com,hudsoncitysavingsbank.com,db.com\n\npeoples.com,ncsecu.org,associatedbank.com,bankofoklahoma.com,mynycb.com,firsthorizon.com,firstcitizens.com\n\nastoriafederal.com,firstbankpr.com,commercebank.com,cnb.com,websterbank.com,fbopcorporation.com\n\nfrostbank.com,guarantygroup.com,amtrust.com,nypbt.com,wbpr.com,fult.com,penfed.org,tcfbank.com,lehman.com\n\nbancorpsouthonline.com,valleynationalbank.com,thesouthgroup.com,whitneybank.com,susquehanna.net,citizensonline.com\n\nucbh.com,raymondjames.com,firstbanks.com,wilmingtontrust.com,bankunited.com,thirdfederal.com,wintrustfinancial.com\n\nsterlingsavingsbank.com,boh.com,arvest.com,eastwestbank.com,efirstbank.com,theprivatebank.com,flagstar.com\n\nbecu.org,umb.com,firstmerit.com,corusbank.com,svb.com,prosperitybanktx.com,washingtonfederal.com\n\nucbi.com,metlife.com,ibc.com,cathaybank.com,trustmark.com,centralbancompany.com,umpquabank.com\n\npcbancorp.com,schoolsfirstfcu.org,mbfinancial.com,natpennbank.com,fnbcorporation.com,fnfg.com,golden1.com\n\nhancockbank.com,firstcitizensonline.com,ubsi-wv.com,firstmidwest.com,oldnational.com,ottobremer.org\n\nfirstinterstatebank.com,northwestsavingsbank.com,easternbank.com,suncoastfcu.org,santander.com\n\neverbank.com,bostonprivate.com,firstfedca.com,english.leumi.co.il,aacreditunion.org,rabobank.com\n\nparknationalbank.com,provbank.com,alliantcreditunion.org,capitolbancorp.com,newalliancebank.com\n\njohnsonbank.com,doralbank.com,fcfbank.com,pinnaclebancorp.net,providentnj.com,oceanbank.com\n\nssfcu.org,capfed.com,iberiabank.com,sdccu.com,americafirst.com,hncbank.com,bfcfinancial.com\n\namcore.com,nbtbank.com,centralpacificbank.com,banksterling.com,bannerbank.com,firstmerchants.com,communitybankna.com\n\nhsbc.com,rbs.co.uk,bankofinternet.com,ally.com,bankofindia.co.in,boi.com.sg,unionbankofindia.co.in,bankofindia.uk.com\n\nunionbankonline.co.in,hdfcbank.com,axisbank.com,icicibank.com,paypal.com,pnm.com,wmtransfer.com,skrill.com,neteller.com\n\npayeer.com,westernunion.com,payoneer.com,capitalone.com,moneygram.com,payza.com`\n\n**Crypto Markets**\n\n`blockchain.info,cryptonator.com,bitpay.com,bitcoinpay.com,binance.com,bitfinex.com,okex.com\n\nhuobi.pro,bitflyer.jp,bitstamp.net,kraken.com,zb.com,upbit.com,bithumb.com,bittrex.com,bitflyer.jp\n\netherdelta.com,hitbtc.com,poloniex.com,coinone.co.kr,wex.nz,gate.io,exmo.com,exmo.me,yobit.net\n\nkorbit.co.kr,kucoin.com,livecoin.net,cex.io,c-cex.com,localbitcoins.net,localbitcoins.com,luno.com\n\nallcoin.com,anxpro.com,big.one,mercatox.com,therocktrading.com,okcoin.com,bleutrade.com,exchange.btcc.com\n\nbitkonan.com,coinbase.com,bitgo.com,greenaddress.it,strongcoin.com,xapo.com\n\nelectrum.org,etherscan.io,myetherwallet.com,bitcoin.com`\n\n**Online Shops**\n\n\n-----\n\nebay,amazon,wish.com,aliexpress,flipkart.com,rakuten.com,walmart.com\n\ntarget.com,bestbuy.com,banggood.com,tinydeal.com,dx.com,zalando,jd.com\n\njd.id,gearbest.com,lightinthebox.com,miniinthebox.co`\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2019/2019.04.22.FINTEAM/FINTEAM%20Trojanized%20TeamViewer%20Against%20Government%20Targets.pdf"
    ],
    "report_names": [
        "FINTEAM Trojanized TeamViewer Against Government Targets"
    ],
    "threat_actors": [
        {
            "id": "a66438a8-ebf6-4397-9ad5-ed07f93330aa",
            "created_at": "2022-10-25T16:47:55.919702Z",
            "updated_at": "2025-03-27T02:05:17.412024Z",
            "deleted_at": null,
            "main_name": "IRON VIKING",
            "aliases": [
                "ATK14 ",
                "BlackEnergy Group",
                "Blue Echidna ",
                "CTG-7263 ",
                "ELECTRUM ",
                "FROZENBARENTS ",
                "Hades/OlympicDestroyer ",
                "IRIDIUM ",
                "Qudedagh ",
                "Sandworm Team ",
                "Seashell Blizzard ",
                "TEMP.Noble ",
                "Telebots ",
                "Voodoo Bear ",
                "APT44 "
            ],
            "source_name": "Secureworks:IRON VIKING",
            "tools": [
                " BlackEnergy",
                " GCat",
                " GreyEnergy",
                " Industroyer",
                " KillDisk",
                " NotPetya",
                " PSCrypt",
                " TeleBot",
                " TeleDoor",
                " xData",
                "BadRabbit"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "b3e954e8-8bbb-46f3-84de-d6f12dc7e1a6",
            "created_at": "2022-10-25T15:50:23.339976Z",
            "updated_at": "2025-03-27T02:00:55.446795Z",
            "deleted_at": null,
            "main_name": "Sandworm Team",
            "aliases": [
                "Sandworm Team",
                "ELECTRUM",
                "Telebots",
                "IRON VIKING",
                "BlackEnergy (Group)",
                "Quedagh",
                "Voodoo Bear",
                "IRIDIUM",
                "Seashell Blizzard",
                "FROZENBARENTS",
                "APT44"
            ],
            "source_name": "MITRE:Sandworm Team",
            "tools": [
                "Bad Rabbit",
                "Mimikatz",
                "Exaramel for Linux",
                "Exaramel for Windows",
                "GreyEnergy",
                "PsExec",
                "Prestige",
                "P.A.S. Webshell",
                "VPNFilter",
                "Cyclops Blink",
                "SDelete",
                "AcidRain",
                "Industroyer",
                "Industroyer2",
                "BlackEnergy",
                "Cobalt Strike",
                "NotPetya",
                "KillDisk",
                "PoshC2",
                "Impacket",
                "Invoke-PSImage",
                "Olympic Destroyer"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "3a0be4ff-9074-4efd-98e4-47c6a62b14ad",
            "created_at": "2022-10-25T16:07:23.590051Z",
            "updated_at": "2025-03-27T02:02:09.878211Z",
            "deleted_at": null,
            "main_name": "Energetic Bear",
            "aliases": [
                "ATK 6",
                "Blue Kraken",
                "Crouching Yeti",
                "Dragonfly",
                "Electrum",
                "Energetic Bear",
                "Ghost Blizzard",
                "Group 24",
                "ITG15",
                "Iron Liberty",
                "Koala Team",
                "TG-4192"
            ],
            "source_name": "ETDA:Energetic Bear",
            "tools": [
                "Backdoor.Oldrea",
                "CRASHOVERRIDE",
                "Commix",
                "CrackMapExec",
                "CrashOverride",
                "Dirsearch",
                "Dorshel",
                "Fertger",
                "Fuerboos",
                "Goodor",
                "Havex",
                "Havex RAT",
                "Hello EK",
                "Heriplor",
                "Impacket",
                "Industroyer",
                "Karagany",
                "Karagny",
                "LightsOut 2.0",
                "LightsOut EK",
                "Listrix",
                "Oldrea",
                "PEACEPIPE",
                "PHPMailer",
                "PsExec",
                "SMBTrap",
                "Subbrute",
                "Sublist3r",
                "Sysmain",
                "Trojan.Karagany",
                "WSO",
                "Webshell by Orb",
                "Win32/Industroyer",
                "Wpscan",
                "nmap",
                "sqlmap",
                "xFrost"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "8941e146-3e7f-4b4e-9b66-c2da052ee6df",
            "created_at": "2023-01-06T13:46:38.402513Z",
            "updated_at": "2025-03-27T02:00:02.824555Z",
            "deleted_at": null,
            "main_name": "Sandworm",
            "aliases": [
                "G0034",
                "IRIDIUM",
                "Blue Echidna",
                "FROZENBARENTS",
                "Seashell Blizzard",
                "IRON VIKING",
                "ELECTRUM",
                "TeleBots",
                "UAC-0113",
                "UAC-0082",
                "APT44",
                "Quedagh",
                "VOODOO BEAR",
                "TEMP.Noble"
            ],
            "source_name": "MISPGALAXY:Sandworm",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1666716496,
    "ts_updated_at": 1743041678,
    "ts_creation_date": 1555992132,
    "ts_modification_date": 1555992132,
    "files": {
        "pdf": "https://archive.orkl.eu/0a977831b7d744518f28166129f70d575f59c706.pdf",
        "text": "https://archive.orkl.eu/0a977831b7d744518f28166129f70d575f59c706.txt",
        "img": "https://archive.orkl.eu/0a977831b7d744518f28166129f70d575f59c706.jpg"
    }
}