{
    "id": "1d408a60-b4d1-4b45-b13b-1f3b9f7fd8b7",
    "created_at": "2023-01-12T15:07:59.582091Z",
    "updated_at": "2025-03-27T02:05:33.203945Z",
    "deleted_at": null,
    "sha1_hash": "996ecb5243334327dc2d8e625a4ddb72fc116e81",
    "title": "2015-03-20 - Threat Spotlight- PoSeidon, A Deep Dive Into Point of Sale Malware",
    "authors": "",
    "file_creation_date": "2022-05-27T18:58:55Z",
    "file_modification_date": "2022-05-27T18:58:55Z",
    "file_size": 2096486,
    "plain_text": "# Threat Spotlight: PoSeidon, A Deep Dive Into Point of Sale Malware\n\n**blogs.cisco.com/security/talos/poseidon**\n\nTalos Group March 20, 2015\n\n_[This post was authored by Andrea Allievi,](http://blogs.cisco.com/author/AndreaAllievi)_ _[Ben Baker,](http://blogs.cisco.com/author/benbaker)_ _[Nick Biasini,](http://blogs.cisco.com/author/NickBiasini)_ _[JJ Cummings,](http://blogs.cisco.com/author/jjcummings)_ _Douglas_\n_Goddard,_ _[William Largent,](http://blogs.cisco.com/author/WilliamLargent)_ _[Angel Villegas, and](http://blogs.cisco.com/author/AngelVillegas)_ _[Alain Zidouemba](http://blogs.cisco.com/author/AlainZidouemba)_\n\n_Cisco’s Security Solutions (CSS) consists of information security experts with a unique blend_\n_of law enforcement, enterprise security and technology security backgrounds. The team_\n_works directly with Cisco’s Talos Security Intelligence & Research Group to identify known_\n_and unknown threats, quantify and prioritize risk, and minimize future risk._\n\nWhen consumers make purchases from a retailer, the transaction is processed through\nPoint-of-Sale (PoS) systems. When a credit or debit card is used, a PoS system is used to\nread the information stored on the magnetic stripe on the back of the credit card. Once this\ninformation gets stolen from a merchant, it can be encoded into a magnetic stripe and used\nwith a new card. Criminal markets exist for this valuable information because the attackers\nare able to easily monetize stolen credit card data. Incidents involving PoS malware have\nbeen on the rise affecting many large organizations as well as small mom-and-pop\n\n\n-----\n\nestablishments and garnering a lot of media attention. The presence of large amounts of\nfinancial and personal information ensures that these companies and their retail PoS\nsystems will remain attractive targets.\n\n## Overview\n\nThere is a new malware family targeting PoS systems, infecting machines to scrape memory\nfor credit card information and exfiltrate that data to servers, also primarily .ru TLD, for\nharvesting and likely resale. This new malware family, that we’ve nicknamed PoSeidon, has\n\n\n-----\n\na few components to it, as illustrated by the diagram below:\n\nAt a high level, it starts with a Loader binary that upon being executed will first try to maintain\npersistence on the target machine in order to survive a possible system reboot. The Loader\nthen contacts a command and control server, retrieving a URL which contains another binary\nto download and execute. The downloaded binary, FindStr, installs a keylogger and scans\nthe memory of the PoS device for number sequences that could be credit card numbers.\nUpon verifying that the numbers are in fact credit card numbers, keystrokes and credit card\nnumbers are encoded and sent to an exfiltration server.\n\n## Technical details\n\n Keylogger\n\nThe file with SHA256\n334079dc9fa5b06fbd68e81de903fcd4e356b4f2d0e8bbd6bdca7891786c39d4 could perhaps\nbe at the source of the PoS system compromise. We call this file KeyLogger based on\n\n\n-----\n\ndebugging information found in the binary:\n\nUpon execution, this file copies itself to either %SystemRoot%\\system32\\<filename>.exe or\n_%UserProfile%\\<filename>.exe and adds registry entry under HKLM (or_\n_HKCU)\\Software\\Microsoft\\Windows\\CurrentVersion\\Run._\n\nThe file also opens HKCU\\Software\\LogMeIn Ignition and enumerates the keys for the\naccount sub key, opens it and deletes the PasswordTicket Value and obtains the Email\nValue. Also deletes registry tree HKCU\\Software\\LogMeIn Ignition\\<key>\\Profiles\\* .\n\nThe file sends to an exfiltration server by POSTing data to one of these URIs:\n\nwondertechmy[.]com/pes/viewtopic.php\nwondertechmy[.]ru/pes/viewtopic.php\nwondwondnew[.]ru/pes/viewtopic.php\n\nThe URI format is\n\n_uid=%I64u&win=%d.%d&vers=%s_\n\nThe Keylogger component was potentially used to steal passwords and could have been the\ninitial infection vector.\n\n## Loader\n\nThe loader for the PoSeidon PoS malware gets its name from debugging information found\nin the binary:\n\n\n-----\n\nUpon being run, Loader checks to see if it’s being executed with one of these two file names:\n\nWinHost.exe\nWinHost32.exe\n\nIf it is not, it will make sure that no Windows service is running with the name WinHost.\n_Loader will copy itself to %SystemRoot%\\System32\\WinHost.exe, overwriting any file in that_\nlocation that would happen to have the same name. Next, Loader will start a service named\nWinHost.\n\nThis is done so that it remains running in memory even if the current user logs off. If Loader\nis not able to install itself as a service, it will try to find other instances of itself running in\nmemory and terminate them. Subsequently, it will copy itself to\n_%UserProfile%\\WinHost32.exe and install the registry key_\n_HKCU\\Microsoft\\Windows\\CurrentVersion\\Run\\\\WinHost32. Finally, it will create a new_\nprocess to execute %UserProfile%\\WinHost32.exe.\n\nNow that persistence has been achieved, Loader will delete itself by running the following\ncommand:\n\ncmd.exe /c del <path_to_itself> >> NUL\n\n\n-----\n\nThe instance of Loader running in memory attempt to read configuration data at\n_%SystemRoot%\\System32\\WinHost.exe.cfg. This file can hold a list of URLs to be added to_\na list of hardcoded URLs already contained in Loader.\n\nLoader then attempts to contact one of the hardcoded C&C server:\n\nlinturefa.com\nxablopefgr.com\ntabidzuwek.com\nlacdileftre.ru\ntabidzuwek.com\nxablopefgr.com\nlacdileftre.ru\nweksrubaz.ru\nlinturefa.ru\nmifastubiv.ru\nxablopefgr.ru\ntabidzuwek.ru\n\nAssociated IP Addresses:\n\n151.236.11.167\n185.13.32.132\n185.13.32.48\nREDACTED at request of Federal Law Enforcement\n31.184.192.196\n91.220.131.116\n91.220.131.87\n\nIf one of the domains above resolve to an IP address an HTTP POST is made using the\nfollowing user-agent string:\n\n_Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0; SLCC2; .NET CLR_\n_2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0)_\n\nPOST data is sent to either:\n\n<IP ADDRESS>/ldl01/viewtopic.php\n\n\n-----\n\n<IP ADDRESS>/pes2/viewtopic.php\n\nPOST data follows the format:\n\n_uid=%I64u&uinfo=%s&win=%d.%d&bits=%d&vers=%s&build=%s_\n\nLoader expects the following response from the C&C server:\n\n_{<CommandLetter>:<ArgumentString>}_\n\nExample response:\n\n{R:http://badguy.com/malwarefilename.exe}\n{b:pes13n|373973303|https://01.220.131.116/ldl01/files/pes13n.exe}\n\nIt’s by fetching and executing the executable referenced in the server response that the\nsecond part of PoSeidon finds its way to the PoS device.\n\n## FindStr\n\nThe loader for the PoSeidon PoS malware gets its name from debugging information found\nin the binary:\n\n\n-----\n\nAn embedded PE is extracted through shellcode and execution continues with the\nembedded binary. This file installs a minimal keylogger that is implemented similarly to the\n[description found here. The data intercepted by this keylogger will later be sent to an](http://www.codeproject.com/Articles/297312/Minimal-Key-Logger-using-RAWINPUT)\nexfiltration server.\n\nThe PE then cycles through all running processes on the PoS device to look for processes\nwith a security token not associated with the “NT AUTHORITY” domain name. It iterates\nthrough all read/write pages within those processes for credit card info.\n\nThe malware only looks for number sequences that start with:\n\n6, 5, 4 with a length of 16 digits (Discover, Visa, Mastercard)\n3 with a length of 15 digits (AMEX)\n\nIt then uses the [Luhn algorithm to verify that the numbers are actually credit or debit card](http://en.wikipedia.org/wiki/Luhn_algorithm)\nnumbers as shown by the code segment below:\n\n\n-----\n\nNext, DNS resolution is attempted for the domains below. These are some of the known data\nexfiltration servers:\n\n_quartlet.com_\n_horticartf.com_\n_kilaxuntf.ru_\n_dreplicag.ru_\n_fimzusoln.ru_\n_wetguqan.ru_\n\nIf one of the domains above resolve to an IP address an HTTP POST is made using the\nfollowing user-agent string:\n\n_Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0; SLCC2; .NET CLR_\n_2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0)_\n\n\n-----\n\nPOST data is sent to:\n\n_<IP ADDRESS>/pes13/viewtopic.php_\n\nData follows the following format:\n\n_oprat=2&uid=%I64u&uinfo=%s&win=%d.%d&vers=%s_\n\noptional POST data (data: credit card numbers, logs: keylogger data)\n\n_&data=<XORed_with_0x2A_then_base64_data_unk>_\n\n_&logs=<XORed_with_0x2A_then_base64_data_unk>_\n\nCredit card numbers and keylogger data is sent to the exfiltration server after being XORed\nand base64 encoded.\n\nThe expect response from the exfiltration server is:\n\n\n-----\n\nThis mechanism allows for the the malware to update itself, based on commands received\nfrom the exfiltration server.\n\n## Loader vs FindStr\n\nComparing an unpacked copy of Loader version 11.4 to an unpacked copy of FindStr\n[version 7.1 with Bindiff shows that 62% of the functionality in both samples is the same. The](http://www.zynamics.com/bindiff.html)\nactors behind this malware probably developed some core functionality and compiled it into a\nlibrary to be used by other projects they are developing.\n\n## IOC\n\n\n-----\n\nClick for Endpoint IOC Version\n[Win.Trojan.PoSeidon.RegistryItem.ioc](https://alln-extcloud-storage.cisco.com/Cisco_Blogs:ciscoblogs/Win.Trojan.PoSeidon.RegistryItem.ioc_1.txt)\n\n[Win.Trojan.PoSeidon.ProcessItem.ioc](https://alln-extcloud-storage.cisco.com/Cisco_Blogs:ciscoblogs/Win.Trojan.PoSeidon.ProcessItem.ioc_1.txt)\n\n[Win.Trojan.PoSeidon.FileItem.ioc](https://alln-extcloud-storage.cisco.com/Cisco_Blogs:ciscoblogs/Win.Trojan.PoSeidon.FileItem.ioc_2.txt)\n\nDomains\n\nlinturefa.com\nxablopefgr.com\ntabidzuwek.com\nlinturefa.ru\nxablopefgr.ru\ntabidzuwek.ru\nweksrubaz.ru\nmifastubiv.ru\nlacdileftre.ru\nquartlet.com\nhorticartf.com\nkilaxuntf.ru\ndreplicag.ru\nfimzusoln.ru\nwetguqan.ru\n\nIP Addresses:\n\n151.236.11.167\n185.13.32.132\n185.13.32.48\n\n\n-----\n\nREDACTED at request of Federal Law Enforcement\n31.184.192.196\n91.220.131.116\n91.220.131.87\nREDACTED at request of Federal Law Enforcement\n\n**Conclusion**\n\nPoSeidon is another in the growing number of Point-of-Sale malware targeting PoS systems\nthat demonstrate the sophisticated techniques and approaches of malware authors.\nAttackers will continue to target PoS systems and employ various obfuscation techniques in\nan attempt to avoid detection. As long as PoS attacks continue to provide returns, attackers\nwill continue to invest in innovation and development of new malware families. Network\nadministrators will need to remain vigilant and adhere to industry best practices to ensure\ncoverage and protection against advancing malware threats.\n\nSnort Rules: 33836-33852. Please refer to Defense Center or FIREsight management\nconsole for updated information.\n\n**Protecting Users from These Threats**\n\nWe encourage organizations to consider security best\npractices, starting with a threat-centric approach.\nGiven the dynamic threat landscape, we advocate\nthis threat-centric and operationalized approach that\nimplements protections across the extended network\n– and across the full attack continuum – before,\nduring, and after an attack. This approach is\npredicated upon superior visibility, continuous control,\nand advanced threat protection across the extended\nnetwork and the entire attack continuum\n\nShare:\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2015/2015-03-20 - Threat Spotlight- PoSeidon, A Deep Dive Into Point of Sale Malware.pdf"
    ],
    "report_names": [
        "2015-03-20 - Threat Spotlight- PoSeidon, A Deep Dive Into Point of Sale Malware.pdf"
    ],
    "threat_actors": [
        {
            "id": "b23e717c-0b27-47e0-b3c8-4defe6dd857f",
            "created_at": "2023-01-06T13:46:38.367369Z",
            "updated_at": "2025-03-27T02:00:02.815758Z",
            "deleted_at": null,
            "main_name": "APT33",
            "aliases": [
                "ATK35",
                "Peach Sandstorm",
                "TA451",
                "APT 33",
                "Elfin",
                "Refined Kitten",
                "MAGNALLIUM",
                "HOLMIUM",
                "COBALT TRINITY",
                "G0064"
            ],
            "source_name": "MISPGALAXY:APT33",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "e5ff825b-0456-4013-b90a-971b93def74a",
            "created_at": "2022-10-25T15:50:23.824058Z",
            "updated_at": "2025-03-27T02:00:55.553346Z",
            "deleted_at": null,
            "main_name": "APT33",
            "aliases": [
                "APT33",
                "HOLMIUM",
                "Elfin",
                "Peach Sandstorm"
            ],
            "source_name": "MITRE:APT33",
            "tools": [
                "PowerSploit",
                "AutoIt backdoor",
                "PoshC2",
                "Mimikatz",
                "NanoCore",
                "DEADWOOD",
                "StoneDrill",
                "POWERTON",
                "LaZagne",
                "TURNEDUP",
                "NETWIRE",
                "Pupy",
                "ftp",
                "Shamoon"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673536079,
    "ts_updated_at": 1743041133,
    "ts_creation_date": 1653677935,
    "ts_modification_date": 1653677935,
    "files": {
        "pdf": "https://archive.orkl.eu/996ecb5243334327dc2d8e625a4ddb72fc116e81.pdf",
        "text": "https://archive.orkl.eu/996ecb5243334327dc2d8e625a4ddb72fc116e81.txt",
        "img": "https://archive.orkl.eu/996ecb5243334327dc2d8e625a4ddb72fc116e81.jpg"
    }
}