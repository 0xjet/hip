{
    "id": "a862fdab-9112-45d3-84a8-05cdc98ec989",
    "created_at": "2023-01-12T15:03:48.177819Z",
    "updated_at": "2025-03-27T02:16:13.975913Z",
    "deleted_at": null,
    "sha1_hash": "537f7cbeb9c3f774c1c835d31761baa3a6f8131c",
    "title": "2022-06-21 - MuddyWater’s “light” first-stager targetting Middle East",
    "authors": "",
    "file_creation_date": "2022-07-02T23:14:16Z",
    "file_modification_date": "2022-07-02T23:14:16Z",
    "file_size": 762974,
    "plain_text": "# MuddyWater’s “light” first-stager targetting Middle East\n\n**[lab52.io/blog/muddywaters-light-first-stager-targetting-middle-east/](https://lab52.io/blog/muddywaters-light-first-stager-targetting-middle-east/)**\n\nSince the last quarter of 2020 MuddyWater has mantained a “long-term” infection campaign\ntargeting Middle East countries. We have gathered samples from November 2020 to January\n2022, and due to the recent samples found, it seems that this campaign might still be\ncurrently active. The latest campaigns of the Muddy Water threat group, allegedly sponsored\nby the Iranian government and linked to the Iranian revolutionary guard (the main armed\nforces of the Iranian government), could be framed within the dynamics of maintaining Iran’s\nregional sovereignty.\n\nThis infection campaign always starts with a compressed file wrapping a malicious Word\ndocument containing VBA macros.\n\nMalicious\n\ndocument sample\nWhile our oldest sample looks a little more sophisticated based on the content of the\ndocument, which seems more specifically crafted for Arabic speakers as shown in the\nprevious image, the rest of them contain generic English message to enable macros.\n\n\n-----\n\nsample\n\n\n_Malicious document_\n\n_Malicious_\n\n\n_document sample_\nAlthough it has not been possible to clearly identify their specific target, it has been observed\nthat these campaigns have been directed against countries such as Pakistan, Kazahstan,\nArmenia, Syria, Israel, Bahrain, Turkey, South Africa, Sudan, etc. Many of these countries\nmay be of interest to the alleged Iranian threat actor, as some of them have been involved in\nrecent internal conflicts, or are implicated in nuclear energy improvement, or may serve as\nstrategic footholds for the development and influence of Iranian interests in other parts of the\nworld.\n\n\n-----\n\nThe macros are very concise and their only purpose is to write a not-so-much obfuscated\nVBS script into a file located in C:\\ProgramData or the Windows Startup folder, with names\nsuch as Temp_[3-5 random chars].txt.\n\nMalicious VBA macro code\nThe dropped script is a small RAT which allows to execute commands via cmd. It first calls a\nrecon function which executes whoami, and sets a country code which is already present in\nthe script. The result of this will then be part of the URI used for the C2 contact. The set of\ndifferent country codes found in the gathered samples are the following, and might indeed\nreveal the targets for each campaign:\n\nPK –> Pakistan\nAR –> Argentina\n\n\n-----\n\nAM –> Armenia\nSY –> Syria\nIL –> Israel\nBH –> Bahrain\nTR –> Turkey\nSA –> Saudi Arabia\nSD –> Sudan\nKK –> Kazakhstan\n\nCode snippet from dropped VB Script (Deobfuscated)\n\n_Code snippet from dropped VB Script (Obfuscated)_\n\nAfter building the recon string, it will execute its main function. This function first executes\nexplorer.exe (without apparent functional reason), and then calls a function to choose one IP\nfrom an array which will rotate in case of the chosen IP not replying to the subsequent C2\nconnection. This connection to the C2 server will use an HTTP GET request using the\nfollowing structure:\n\n_http://{ IP_address }/getCommand?guid={ recon_string }_\n\nHTTP GET\n\ncommunication from VBS sample\nAs aforementioned, in the case of an empty reply, it will rotate the IP address and try again\nwith the next. Otherwise it will deobfuscate the reply and call a function to execute it by\ncreating a WScript.Shell object to call cmd:\n\n\n-----\n\nAs also seen on the deobfuscated snippet, it will output the result into a txt file and\nimmediately read its content to return it to the calling function in order to include the result\nand send it to the C2 server. The next contact will use the POST HTTP method and will\nfollow a slightly different structure and the command output in the body:\n\n_http://{ IP_address }/getTargetInfo?guid={ recon_string }&status={ flag_value }_\n\n_HTTP POST_\n\n_communication from VBS sample_\nInterestingly, the value renamed by us as “flag_value” will be included as the “state” value\nwithin the POST request. In the script file, it is a variable that is initialized to 0 in every\ncollected sample, and is always set to 1 before executing the received command and\nsending the result in the POST request. Other than this, it is not modified or used in the script\nfile. However, it is checked during the renamed “whoami_wrap” for the initial host recon at\nthe beginning of the script. It is compared with the value 126, and in case of resolving True, it\nwill display the following message box.\n\n\n-----\n\nMalicious VBS\n\n“alternative functionality”\nThe only implemented functionality in every analyzed sample is the #1, which will use WMI to\ndisplay the following information about the infected system:\n\nCode snippet for the “alternative functionality”\nSuch a small script with incomplete functionality, after almost two years being used for\ndifferent campaigns could suggest that the attackers might modify its functionality in a later\nstage, based on the obtained information from the infected host or, at least, use it to\ndownload and drop the next infection stage.\n\n——————————————————————————————————————\nIndicators of compromise\n\n**2020**\n\nورشة عمل تدریبیة.zip\n\n4e8a2b592ed90ed13eb604ea2c29bfb3fbc771c799b3615ac84267b85dd26d1c\n\negojt7.vbs\n\nae6dba7da3c8b2787b274c660e0b522ce8ebda89b1864d8a2ac2c9bb2bd4afa6\n\n\n-----\n\n185.117.73.]52\n\n**2021**\n\nfbd2a9f400740610febd5a1ae7448536dd95f37b85dfd2ca746e11a51086bd4b\n\nTemp_UFNCR335.vbs\n\n2245fc9d9aea07b0ffdac792d4851ceed851a3bf1d528384e94306e59e3abd16\n\n84d523833db6cc74a079b12312da775d4281bf1034b2af0203c9d14c098e6f29\n\nTemp_WNJJ6.vbs\n\ncab75e26febd111dd5483666c215bb6b56059f806f83384f864c51ceddd0b1cf\n\nمشروع.zip\n\nfaa6258d7bd355329a9ad69e15b2857d24f9ac11a9782d1a215149938460ac4b\n\nمشروع.doc\n\n2f2492b7bb55f7a12f7530c9973c9b81fdd5e24001e4a21528ff1d5b47e3446e\n\nTemp_K40.vbs\n\ned4b523a0eecc5de172a97eb8acb357bc1f4807efec761ec2764f20ef028cc63\n\nprojectvpn.doc\n\nea24c5a8b976919d4c8c4779dc0b7ef887373f126c4732edf9023b827b4e4dc4\n\nTemp_WZW4.txt\n\n1d133cc388415592e2e2246e6fb1903690068577fc82e2ae682ba0a661cea0dd\n\n107.174.68.]60\n\n192.227.147.]152\n\n**2022**\n\nyeni yönerge.doc\n\ndba90bd5fdf0321a28f21fccb3a77ee1ed5d73e863e4520ce8eb8fca670189c3\n\nTemp_FU4.txt\n\n0b4d660335b55d96ddf4c76664341ed52519639161a0a0a1aa0ae82951feba01\n\n\n-----\n\nCustomers with Lab52 s APT intelligence private feed service already have more tools and\nmeans of detection for this campaign.\n\nIn case of having threat hunting service or being client of S2Grupo CERT, this intelligence\nhas already been applied.\n\nIf you need more information about Lab52’s private APT intelligence feed service, you can\n[contact us through the following link](https://lab52.io/contact)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-06-21 - MuddyWater’s “light” first-stager targetting Middle East.pdf"
    ],
    "report_names": [
        "2022-06-21 - MuddyWater’s “light” first-stager targetting Middle East.pdf"
    ],
    "threat_actors": [
        {
            "id": "2ed8d590-defa-4873-b2de-b75c9b30931e",
            "created_at": "2023-01-06T13:46:38.730137Z",
            "updated_at": "2025-03-27T02:00:02.903261Z",
            "deleted_at": null,
            "main_name": "MuddyWater",
            "aliases": [
                "Boggy Serpens",
                "Mango Sandstorm",
                "TEMP.Zagros",
                "Static Kitten",
                "G0069",
                "TA450",
                "Earth Vetala",
                "Seedworm",
                "COBALT ULSTER",
                "ATK51"
            ],
            "source_name": "MISPGALAXY:MuddyWater",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "31e69945-6c1e-40c3-ba8e-a77e81dd142a",
            "created_at": "2024-05-01T02:03:08.047377Z",
            "updated_at": "2025-03-27T02:05:17.326452Z",
            "deleted_at": null,
            "main_name": "COBALT ULSTER",
            "aliases": [
                "ENT-11 ",
                "ITG17 ",
                "MERCURY ",
                "Mango Sandstorm ",
                "MuddyWater ",
                "STAC 1171 ",
                "Seedworm ",
                "Static Kitten ",
                "TEMP.Zagros ",
                "UNC3313 ",
                "Yellow Nix ",
                "Earth Vetala "
            ],
            "source_name": "Secureworks:COBALT ULSTER",
            "tools": [
                " Canopy",
                " CrackMapExec",
                " CredNinja",
                " Empire",
                " FORELORD",
                " Koadic",
                " LaZagne",
                " Ligolo",
                " MKL64",
                " Metasploit",
                " Mimikatz",
                " MiniDump",
                " Mori",
                " MuddyC2Go",
                " MuddyC3",
                " PhonyC2",
                " Plink",
                " PowGoop",
                " PowerStats",
                " RemoteUtilities",
                " Revsocks",
                " ScreenConnect",
                " SimpleHelp",
                " Small Sieve",
                " Syncro",
                " Venom Proxy",
                " WMIExec",
                "AnyDesk"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "02e1c2df-8abd-49b1-91d1-61bc733cf96b",
            "created_at": "2022-10-25T15:50:23.308924Z",
            "updated_at": "2025-03-27T02:00:55.437268Z",
            "deleted_at": null,
            "main_name": "MuddyWater",
            "aliases": [
                "MuddyWater",
                "Earth Vetala",
                "Static Kitten",
                "Seedworm",
                "TEMP.Zagros",
                "Mango Sandstorm",
                "TA450"
            ],
            "source_name": "MITRE:MuddyWater",
            "tools": [
                "STARWHALE",
                "POWERSTATS",
                "Out1",
                "PowerSploit",
                "Small Sieve",
                "Mori",
                "Mimikatz",
                "LaZagne",
                "PowGoop",
                "CrackMapExec",
                "ConnectWise",
                "SHARPSTATS",
                "RemoteUtilities",
                "Koadic"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "3c430d71-ab2b-4588-820a-42dd6cfc39fb",
            "created_at": "2022-10-25T16:07:23.880522Z",
            "updated_at": "2025-03-27T02:02:10.010443Z",
            "deleted_at": null,
            "main_name": "MuddyWater",
            "aliases": [
                "ATK 51",
                "Boggy Serpens",
                "Cobalt Ulster",
                "ITG17",
                "Mango Sandstorm",
                "MuddyWater",
                "Operation BlackWater",
                "Operation Earth Vetala",
                "Operation Quicksand",
                "Seedworm",
                "Static Kitten",
                "T-APT-14",
                "TA450",
                "TEMP.Zagros",
                "Yellow Nix"
            ],
            "source_name": "ETDA:MuddyWater",
            "tools": [
                "Agentemis",
                "BugSleep",
                "CLOUDSTATS",
                "ChromeCookiesView",
                "Cobalt Strike",
                "CobaltStrike",
                "CrackMapExec",
                "DELPHSTATS",
                "EmPyre",
                "EmpireProject",
                "FruityC2",
                "Koadic",
                "LOLBAS",
                "LOLBins",
                "LaZagne",
                "Living off the Land",
                "MZCookiesView",
                "Meterpreter",
                "Mimikatz",
                "MuddyC2Go",
                "MuddyRot",
                "Mudwater",
                "POWERSTATS",
                "PRB-Backdoor",
                "PhonyC2",
                "PowGoop",
                "PowerShell Empire",
                "PowerSploit",
                "Powermud",
                "QUADAGENT",
                "SHARPSTATS",
                "SSF",
                "Secure Socket Funneling",
                "Shootback",
                "Smbmap",
                "Valyria",
                "chrome-passwords",
                "cobeacon",
                "prb_backdoor"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535828,
    "ts_updated_at": 1743041773,
    "ts_creation_date": 1656803656,
    "ts_modification_date": 1656803656,
    "files": {
        "pdf": "https://archive.orkl.eu/537f7cbeb9c3f774c1c835d31761baa3a6f8131c.pdf",
        "text": "https://archive.orkl.eu/537f7cbeb9c3f774c1c835d31761baa3a6f8131c.txt",
        "img": "https://archive.orkl.eu/537f7cbeb9c3f774c1c835d31761baa3a6f8131c.jpg"
    }
}