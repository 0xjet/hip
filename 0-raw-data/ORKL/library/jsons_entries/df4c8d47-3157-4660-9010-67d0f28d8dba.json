{
    "id": "df4c8d47-3157-4660-9010-67d0f28d8dba",
    "created_at": "2023-01-12T15:00:01.276955Z",
    "updated_at": "2025-03-27T02:05:40.001933Z",
    "deleted_at": null,
    "sha1_hash": "c4b0199daf3d0f8edaf79da32606b24935e4c602",
    "title": "2022-03-16 - Uncompromised- When REvil comes knocking",
    "authors": "",
    "file_creation_date": "2022-05-27T23:25:13Z",
    "file_modification_date": "2022-05-27T23:25:13Z",
    "file_size": 228451,
    "plain_text": "# See what it's like to have a partner in the fight.\n\n**redcanary.com/blog/uncompromised-kaseya/**\n\n[We’re rewinding the clock a bit to tell the tale of how we detected and helped prevent REvil](https://attack.mitre.org/software/S0496/)\n(aka Sodinokibi) activity associated with zero days in Kaseya’s IT management software\n[last year, before we or anyone else knew about the vulnerabilities, their impact, or the](https://threatpost.com/kaseya-patches-zero-day-exploits/167548/)\nseverity of follow-on ransomware attacks. For some, this story is a stark reminder of the\nimportance of incident response planning and intelligence. For others—practitioners tasked\nwith defending networks large and small—it also brings into focus the efficacy of developing\nbroad, behavior-based detections.\n\n## How it started\n\nJust after 1 PM (ET) on July 2, 2021, an adversary leveraged the Kaseya Virtual System\nAdministrator (VSA) agent `agentmon.exe to launch the command processor and execute`\na variety of malicious actions. Within five minutes, the Red Canary detection engineering\nteam was investigating events generated by this suspicious activity.\n\n\n-----\n\nThe command-line arguments in question included two groupings of conspicuously\nsuspicious actions, both of which were caught by existing Red Canary detection analytics:\n\n1.\n\n1. Multiple commands designed to disable Windows Defender security features\n2. The relocation and execution of the Windows Certificate Authority Utility\n\n( certutil.exe ) to decode a `.crt file`\n\nWhile the purpose of the former commands is self-evident (the adversary wanted to evade\ndefensive controls), the latter activity requires some explanation.\n\n**Sidebar: Decoding malicious payloads with** `certutil.exe`\n\n[Nearly five years ago, then detection engineer manager Joe Moles committed a new](https://redcanary.com/authors/joe-moles/)\ndetection analytic to our detector repo that looked for adversaries leveraging\n\n`certutil.exe` [to decode malicious payloads. Adversaries consistently use this utility to](https://redcanary.com/threat-detection-report/techniques/obfuscated-files-information/)\ndeliver malicious payloads, and we’ve observed this behavior in hundreds of confirmed\nthreat detections since initially developing the detection analytic.\n\n## The ultimate payload\n\nAll of this activity was merely pretense. Less than an hour after detecting the initial defense\nevasion and execution activity, we observed a series of malicious registry modifications.\n\nThanks to research conducted by our Intelligence team in late 2020 and open source\n[reports by the likes of Unit 42, we were immediately able to associate these registry](https://unit42.paloaltonetworks.com/ransomware-threat-assessments/7/)\nmodifications with a known ransomware threat called REvil, based on the following registry\n\n\n-----\n\nmodification paths:\n```\n   Software\\blacklivesmatter\n   software\\wow6432node\\blacklivesmatter\n\n```\n[Within 12 minutes of this threat occurring, the Red Canary Incident Handling team was](https://redcanary.com/solutions/post-breach/)\nproactively reaching out to the affected customer to help them begin responding to the\nincident. Unfortunately, the customer’s security team was off for the holiday weekend and\nwere part of a legacy customer group that hadn’t upgraded their contract to include access\nto [Automate. Recognizing the severity of the situation, we activated Automate, developed](https://redcanary.com/blog/introducing-automate-security-automation/)\nsome custom playbooks, and started automatically banning hashes, collecting forensics\npackages, and isolating endpoints within roughly two hours of the initial threat occurring.\n\n## Additional detections\n\nIn isolation, this was just a single instance of an adversary using the Kaseya IT\nmanagement platform to deliver a malicious payload. In fact, this wasn’t the first time we’d\n[observed adversaries abusing Kaseya in an effort to deliver ransomware.](https://redcanary.com/blog/its-all-fun-and-games-until-ransomware-deletes-the-shadow-copies/)\n\nHowever, just 23 minutes after the first threat occurred, we observed the same behavior in a\nsecond customer environment. Roughly an hour after the initial threat, we detected this\nbehavior in a third environment. This process—excepting the response complications for\nthe first customer—effectively repeated itself across two more customers and dozens of\nendpoints over the span of three days.\n\n## Internal and external intelligence\n\nLess than an hour and a half after the initial threat occurred, the Red Canary Threat\nResearch and Intelligence teams had finished reverse engineering the ransomware payload\nand began drafting up their findings.\n\nWhile we were working incidents across multiple customers, initial public information started\nto appear on Reddit and Twitter roughly an hour after we initially detected the threat.\nKaseya eventually acknowledged the incidents in a formal announcement roughly two-anda-half hours after our first detections.\n\n## Customer communication\n\nA little more than six hours after the initial threat occurred, the Red Canary Threat\nIntelligence team had compiled everything we knew about this incident—information drawn\nfrom customer detections, reverse engineering, and open source reporting, to name a few\nsources—into a bulletin that we promptly sent to every Red Canary customer.\n\n## In retrospect\n\n\n-----\n\nIn the days that followed the incident, we learned that REvil had exploited a series of four\nzero-day vulnerabilities in Kaseya, which ultimately enabled the group to gain initial access,\nupload the malicious payload, bypass security controls, and execute the payload. Kaseya\nwould eventually patch these vulnerabilities on July 11.\n\nA zero day is just a means to an end. It might provide an adversary access, elevate their\nprivileges, or help them perform a variety of other actions. That aside, the exploitation of\nany vulnerability—known or unknown—is just one part of a much broader campaign that\n[almost certainly involves other activity. By developing a robust behavioral detection](https://redcanary.com/products/detect/)\nprogram, security teams can achieve a level of defense in depth that offers visibility into—\nand protection against—a wide variety of threats, regardless of the techniques at hand.\n\nRelated Articles\n\nDetection and response\n\n### ChromeLoader: a pushy malvertiser\n\nDetection and response\n\n### Intelligence Insights: May 2022\n\nDetection and response\n\n### The Goot cause: Detecting Gootloader and its follow-on activity\n\nDetection and response\n\n### Marshmallows & Kerberoasting\n\n**Subscribe to our blog**\n\nOur website uses cookies to provide you with a better browsing experience. More\n[information can be found in our Privacy Policy.](https://redcanary.com/privacy-policy)\n\nX\n\n**Privacy Overview**\n\n\n-----\n\nThis website uses cookies to improve your experience while you navigate through the\nwebsite. Out of these cookies, the cookies that are categorized as necessary are stored on\nyour browser as they are essential for the working of basic functionalities of the website. We\nalso use third-party cookies that help us analyze and understand how you use this website.\nThese cookies will be stored in your browser only with your consent. You also have the\noption to opt-out of these cookies. But opting out of some of these cookies may have an\neffect on your browsing experience.\n\nNecessary cookies are absolutely essential for the website to function properly. This category\nonly includes cookies that ensures basic functionalities and security features of the website.\nThese cookies do not store any personal information.\n\nAny cookies that may not be particularly necessary for the website to function and is used\nspecifically to collect user personal data via analytics, ads, other embedded contents are\ntermed as non-necessary cookies. It is mandatory to procure user consent prior to running\nthese cookies on your website.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-03-16 - Uncompromised- When REvil comes knocking.pdf"
    ],
    "report_names": [
        "2022-03-16 - Uncompromised- When REvil comes knocking.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535601,
    "ts_updated_at": 1743041140,
    "ts_creation_date": 1653693913,
    "ts_modification_date": 1653693913,
    "files": {
        "pdf": "https://archive.orkl.eu/c4b0199daf3d0f8edaf79da32606b24935e4c602.pdf",
        "text": "https://archive.orkl.eu/c4b0199daf3d0f8edaf79da32606b24935e4c602.txt",
        "img": "https://archive.orkl.eu/c4b0199daf3d0f8edaf79da32606b24935e4c602.jpg"
    }
}