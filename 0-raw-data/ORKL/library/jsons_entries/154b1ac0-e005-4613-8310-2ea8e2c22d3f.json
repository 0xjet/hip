{
    "id": "154b1ac0-e005-4613-8310-2ea8e2c22d3f",
    "created_at": "2023-01-12T15:09:41.635893Z",
    "updated_at": "2025-03-27T02:06:07.157589Z",
    "deleted_at": null,
    "sha1_hash": "0784dec61da73f5edee4b99823b4a258733f432e",
    "title": "2017-12-30 - Analysis DarkSky Botnet",
    "authors": "",
    "file_creation_date": "2022-05-28T03:11:51Z",
    "file_modification_date": "2022-05-28T03:11:51Z",
    "file_size": 960799,
    "plain_text": "# Анализ ботнета DarkSky – Telegraph\n\n**telegra.ph/Analiz-botneta-DarkSky-12-30**\n\nims0rry December 30, 2017\n\n## Анализ ботнета DarkSky\n\nims0rry\n\nВся информация предоставлена исключительно в ознакомительных целях. Ни\nадминистрация, ни автор не несут ответственности за любой возможный вред,\nпричиненный материалами данной статьи.\n\n### Админ-панель\n\n**Оболочка**\n\nСразу хочется отметить, что в плане внешности, панелька очень даже неплохая.\n\nТут же отмечу, что имеются некоторые баги:\n\n1) Я запускал файл на дедике - он отстучал в двух разных ботов, хотя по данным они\nидентичны\n\n2) Неправильно определяется версия Windows: на дедике Windows Server 2012 R2, а в\nпанели Win8/10x64\n\nПрисутствует удобная настройка панели, страница тасков, логов, последних действий.\n\n**Внутренности**\n\n\n-----\n\nВот тут уже начинается темная сторона этого продукта. Из серьезных недоработок я\nнашел:\n\n1) Update - автообновление панели, которое можно использовать как бекдор\n\nКласс:\n\nИспользование:\n\nВозможно, сделано это ненамеренно, но риск остается.\n\n2) Уязвимость к SQL-инъекциям - хоть и используется mysqli, но толку от него ноль:\n\nДанные вставляются в принятом формате (я где-то видел метод, который регулярками\nчто-то либо сравнивает, либо чистит, но регулярки, я слышал, не спасают):\n\n3) \"Шифрование данных\" - это HEX. Если уж заявили о шифровании, нужно его сделать\nадекватно, а не так, чтобы все это через любой онлайн-декодер расшифровывалось:\n\n### Анализ файла\n\n**PE**\n\nСмотрим через PE-сканнеры:\n\nФайл ничем не запакован, ЯП - Delphi.\n\n**Данные**\n\n\n-----\n\nОткрываем файл в IDA и первое, на что обращаем внимание - строки:\n\nОчень много hex-строк, а как мы уже знаем, в софте именно это является основным\nшифрованием данных. При декодировании можно найти пару интересных строк:\n\nUser-Agent с которым делается http-запрос:\n\nХост на который привязан лоадер:\n\n\n-----\n\nПараметры:\n\n\n-----\n\nА тут мы видим что лоадер использует стандартную автозагрузку:\n\n\n-----\n\n**Функции**\n\nОсновной метод выглядит так:\n\n\n-----\n\nПроисходят DLL-проверки (чек на песочницу, виртуалку и т.д.), далее происходит\nзапуск в памяти массива байт (предпоследняя строчка).\n\nНа графе выглядит примерно так:\n\n\n-----\n\nТеперь нам нужно отыскать то, что запускается в памяти:\n\nПереходим:\n\nДалее открываем функцию Main этого массива (sub_420434):\n\n\n-----\n\n-----\n\n-----\n\nВ функции sub_4213B8 происходит запрос к серверу, там же мы видим захексованный\nхост и параметры:\n\n\n-----\n\n-----\n\n-----\n\nДалее в цикле происходит запрос текущих тасков и их выполнение. По названиям\nстрок (str_load, str_udp, str_method_http) не трудно догадаться что первое - это таск\nзагрузки и запуска файла, второе - udp-flood, третье - http-flood.\n\nСмотрим функции по порядку:\n\n**Загрузка и запуск файла**\n\n**Загрузка:**\n\n\n-----\n\n-----\n\n-----\n\n**Запуск:**\n\n### UDP-flood\n\n\n-----\n\n### HTTP-flood\n\n\n-----\n\nВ цикле стартуют потоки этой функции:\n\nРеализация довольно громоздкая, можно было сделать куда проще и эффективнее.\n\n### Ссылки\n\nСорцы панели + семпл - [https://github.com/ims0rry/DarkSky-botnet](https://github.com/ims0rry/DarkSky-botnet)\n\n\n-----\n\nПродажник - [https://lolzteam.net/threads/314749/](https://lolzteam.net/threads/314749/)\n\n----------------------------\nАвтор @ims0rry\n\n[https://t.me/ims0rryblog](https://t.me/ims0rryblog)\n\n\n-----",
    "language": "RU",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-12-30 - Analysis DarkSky Botnet.pdf"
    ],
    "report_names": [
        "2017-12-30 - Analysis DarkSky Botnet.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536181,
    "ts_updated_at": 1743041167,
    "ts_creation_date": 1653707511,
    "ts_modification_date": 1653707511,
    "files": {
        "pdf": "https://archive.orkl.eu/0784dec61da73f5edee4b99823b4a258733f432e.pdf",
        "text": "https://archive.orkl.eu/0784dec61da73f5edee4b99823b4a258733f432e.txt",
        "img": "https://archive.orkl.eu/0784dec61da73f5edee4b99823b4a258733f432e.jpg"
    }
}