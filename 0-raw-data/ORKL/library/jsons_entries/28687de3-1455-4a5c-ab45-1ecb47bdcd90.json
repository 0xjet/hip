{
    "id": "28687de3-1455-4a5c-ab45-1ecb47bdcd90",
    "created_at": "2022-10-25T16:48:21.752403Z",
    "updated_at": "2025-03-27T02:16:37.178395Z",
    "deleted_at": null,
    "sha1_hash": "3342a5172b2ecde86762dd35f61057006dbb7448",
    "title": "Operation Daybreak",
    "authors": "",
    "file_creation_date": "2019-03-12T04:22:30Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 246568,
    "plain_text": "# Operation Daybreak\n\n**securelist.com/operation-daybreak/75100**\n\nBy Costin Raiu, Anton Ivanov on June 17, 2016. 6:00 am\n\nEarlier this year, we deployed new technologies in Kaspersky Lab products to identify\nand block zero-day attacks. This technology already proved its effectiveness earlier\n[this year, when it caught an Adobe Flash zero day exploit (CVE-2016-1010). Earlier this](https://securelist.com/blog/research/73255/the-mysterious-case-of-cve-2016-0034-the-hunt-for-a-microsoft-silverlight-0-day/)\nmonth, our technology caught another zero-day Adobe Flash Player exploit deployed\nin targeted attacks. We believe the attacks are launched by an APT Group we track\nunder the codename “ScarCruft”.\n\nScarCruft is a relatively new APT group; victims have been observed in Russia, Nepal,\nSouth Korea, China, India, Kuwait and Romania. The group has several ongoing\noperations, utilizing multiple exploits — two for Adobe Flash and one for Microsoft\nInternet Explorer.\n\nOperation Daybreak appears to have been launched by ScarCruft in March 2016 and\nemploys a previously unknown (0-day) Adobe Flash Player exploit. It is also possible\nthat the group deployed another zero day exploit, CVE-2016-0147, which was patched\nin April.\n\nThis exploit caught by our technologies highlights a few very interesting evasion\nmethods, some of which we haven’t seen before. We describe them below.\n\n## Operation Daybreak general information\n\nOperation Daybreak appears to have been launched by unknown attackers to infect\nhigh profile targets through spear-phishing e-mails. To date, we have observed more\nthan two dozen victims for these attacks.\n\nAlthough the exact attack vector remains unknown, the targets appear to receive a\nmalicious link which points to a hacked website where the exploitation kit is hosted.\nThe hacked web server hosting the exploit kit is associated with the ScarCruft APT\nand used in another line of attacks. Certain details, such as using the same\ninfrastructure and targeting, make us believe that Operation Daybreak is being done\nby the ScarCruft APT group.\n\nThe ScarCruft APT group is a relatively new player and managed to stay under the\nradar for some time. In general, their work is very professional and focused. Their\ntools and techniques are well above the average. Prior to the discovery of Operation\nDaybreak, we observed the ScarCruft APT launching a series of attacks in Operation\nErebus. Operation Erebus leverages another Flash Player exploit (CVE-2016-4117)\nthrough the use of watering hole attacks.\n\nIn the case of Operation Daybreak, the hacked website hosting the exploit kit\nperforms a couple of browser checks before redirecting the visitor to a server\n\n\n-----\n\nimplemented in JS.\n\nThe parameters sent to the “ap.php” script are randomly generated on each hit, so\nthe second stage payload gets encrypted differently each time. This prevents easy\ndetection by MD5 or signatures of the second stage payload.\n\nThe exploitation process consists of three Flash objects. The Flash object that triggers\nthe vulnerability in Adobe Flash Player is located in second SWF delivered to the\nvictim.\n\nAt the end of the exploitation chain, the server sends a legitimate PDF file to user –\n“china.pdf”. The “china.pdf” file shown to the victims in the last stage of the attack\nseems to be written in Korean:\n\n_Decoy document shown to victims_\n\nThe document text talks about disagreements\nbetween China and “The North” over nuclear\nprograms and demilitarization.\n\n## Vulnerability technical details\n\nThe vulnerability (CVE-2016-4171) is located in the code which parses the ExecPolicy\nmetadata information.\n\nThis is what the structure looks like:\n\nThis structure also contains an array of\nitem_info structures:\n\nThe documentation says the following\nabout these structures:\n\n\n-----\n\n_are interpreted as key/value pairs of indices into the_\n_string table of the constant pool. If the value of key is_\n_zero, this is a keyless entry and only carries a value.”_\n\nIn the exploit used by the ScarCruft group, we have\nthe following item_info structures:\n\n_Item_info array in exploit object_\n\nThe code that triggers the\nvulnerability parses this\nstructure and, for every key\nand value members, tries to\nget the respective string\nobject from string constant\npool. The problem relies on\nthe fact that the “.key” and\n“.value” members are used as\nindexes without any kind of\nboundary checks. It is easy to\nunderstand that if key or\nvalue members are larger than string constant pool array, a memory corruption\nproblem appears. It is also important to mention that this member’s (value, key) are\ndirectly read from SWF object, so an attacker can easily use them to implement\narbitrary read/write operations.\n\n_Getting object by index from constant pool without any checks_\n\n\n-----\n\naddresses to achieve full remote code execution.\n\n## Bypassing security solutions through DDE\n\nThe Operation Daybreak attack employs multiple stages, which are all outstanding in\nsome way. One of them attracted our attention because it implements a bypass for\nsecurity solutions we have never seen before.\n\nIn the first stage of the attack, the decrypted shellcode executed by the exploit\ndownloads and executes a special DLL file. This is internally called “yay_release.dll”:\n\n_Second stage DLL internal name and export_\n\nThe code of this module is loaded directly into the exploited application and has\nseveral methods of payload execution. One of method uses a very interesting\ntechnique of payload execution which is designed mostly to bypass modern antimalware products. This uses an interesting bug in the Windows DDE component. It is\nnot a secret that anti-malware systems trigger on special system functions that are\ncalled in the context of potential vulnerable applications to make a deeper analysis of\nAPI calls such as CreateProcess, WinExec or ShellExecute.\n\nFor instance, such defense technologies trigger if a potentially vulnerable application\nsuch as Adobe Flash starts other untrusted applications, scripts interpreters or even\nthe command console.\n\nTo make execution of payload invisible for these defense systems, the threat actors\nused the Windows DDE interface in a very clever way. First, they register a special\nwindow for it:\n\nIn the window procedure, they post WM_DDE_EXECUTE messages with commands:\n\n\n-----\n\n_Sending WM_DDE_EXECUTE message to window_\n\nThe attackers used the following commands:\n\nThe main idea here is that if you create a LNK to an executable or command, then use\nthe ShowGroup method, the program will be executed. This is an undocumented\nbehavior in Microsoft Windows.\n\nIn our case, a malicious VBS was executed, which installs a next stage payload stored\nin CAB file:\n\n_Malicious VBS used in the attack_\n\nWe have reported this “creative” abuse of DDE to Microsoft’s security team.\n\nThe final payload of the attack is a CAB file with the following MD5:\n\n8844a537e7f533192ca8e81886e70fbc\n\n\n-----\n\nDLL files:\n\nMD5 Filename\n\na6f14b547d9a7190a1f9f1c06f906063 cfgifut.dll\n\ne51ce28c2e2d226365bc5315d3e5f83e cldbct.dll\n\n067681b79756156ba26c12bc36bf835c cryptbase.dll\n\nf8a2d4ddf9dc2de750c8b4b7ee45ba3f msfte.dll\n\nThe file cldbct.dll (e51ce28c2e2d226365bc5315d3e5f83e) connects to the following\nC2:\n\nhXXp://webconncheck.myfw[.]us:8080/8xrss.php\n\nThe modules are signed by an invalid digital certificates listed as “Tencent Technology\n(Shenzhen) Company Limited” with serial numbers, copied from real Tencent\ncertificates:\n\n5d 06 88 f9 04 0a d5 22 87 fc 32 ad ec eb 85 b0\n71 70 bd 93 cf 3f 18 9a e6 45 2b 51 4c 49 34 0e\n\n_Invalid digital signature on malware samples_\n\nThe malware deployed in this attack is\nextremely rare and apparently reserved\nonly for high profile victims. Our products\ndetect it as well as other malware from\nScarCruft as\n**HEUR:Trojan.Win32.ScarCruft.gen.**\n\n## Victims:\n\nAlthough our visibility is rather limited, some of the victims of these attacks include:\n\nA law enforcement agency in an Asian country\nOne of the largest trading companies in Asia and in the world\nA mobile advertising and app monetization company in the USA\nIndividuals related to the International Association of Athletics Federations\nA restaurant located in one of the top malls in Dubai\n\n\n-----\n\nstill very active.\n\n## Conclusions:\n\nNowadays, in-the-wild Flash Player exploits are becoming rare. This is because in\nmost cases they need to be coupled with a Sandbox bypass exploit, which makes\nthem rather tricky.\n\nAdditionally, Adobe has been doing a great job at implementing new mitigations to\nmake exploitation of Flash Player more and more difficult.\n\nNevertheless, resourceful threat actors such as ScarCruft will probably continue to\ndeploy zero-day exploits against their high profile targets.\n\nAs usual, the best defense against targeted attacks is a multi-layered approach.\nWindows users should combine traditional anti-malware technologies with patch\nmanagement, host intrusion detection and, ideally, whitelisting and default-deny\nstrategies. According to a study by the Australian DSD, 85% of the targeted attacks\nanalysed could have been stopped by four simple defense strategies. While it’s\nimpossible to achieve 100% protection, in practice and most cases all you have to do\nis increase your defenses to the point where it becomes too expensive for the\nattacker – who will just give up and move on to other targets.\n\nKaspersky products detect flash exploit as HEUR:Exploit.SWF.Agent.gen also our AEP\n(Automatic Exploit Prevention) component can successfully detect this attack.\nPayloads are detected with HEUR:Trojan.Win32.ScarCruft.gen verdict.\n\n_* More information about the ScarCruft APT group is available to customers of Kaspersky_\n_Intelligent Services._\n\n## Indicators of compromise:\n\n### Malicious IPs and hostnames:\n\n212.7.217[.]10\nreg.flnet[.]org\nwebconncheck.myfw[.]us\n\n### MD5s:\n\n3e5ac6bbf108feec97e1cc36560ab0b6\n\na6f14b547d9a7190a1f9f1c06f906063\n\ne51ce28c2e2d226365bc5315d3e5f83e\n\n067681b79756156ba26c12bc36bf835c\n\n\n-----\n\n8844a537e7f533192ca8e81886e70fbc\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2016/2016.06.17.Operation_Daybreak/Operation%20Daybreak.pdf"
    ],
    "report_names": [
        "Operation Daybreak"
    ],
    "threat_actors": [
        {
            "id": "bbe36874-34b7-4bfb-b38b-84a00b07042e",
            "created_at": "2022-10-25T15:50:23.375277Z",
            "updated_at": "2025-03-27T02:00:55.457787Z",
            "deleted_at": null,
            "main_name": "APT37",
            "aliases": [
                "APT37",
                "InkySquid",
                "ScarCruft",
                "Group123",
                "TEMP.Reaper",
                "Ricochet Chollima"
            ],
            "source_name": "MITRE:APT37",
            "tools": [
                "BLUELIGHT",
                "CORALDECK",
                "KARAE",
                "SLOWDRIFT",
                "ROKRAT",
                "SHUTTERSPEED",
                "POORAIM",
                "HAPPYWORK",
                "Final1stspy",
                "Cobalt Strike",
                "NavRAT",
                "DOGCALL",
                "WINERACK"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "552ff939-52c3-421b-b6c9-749cbc21a794",
            "created_at": "2023-01-06T13:46:38.742547Z",
            "updated_at": "2025-03-27T02:00:02.906537Z",
            "deleted_at": null,
            "main_name": "APT37",
            "aliases": [
                "ScarCruft",
                "Venus 121",
                "Moldy Pisces",
                "Group 123",
                "APT 37",
                "Group123",
                "Operation Daybreak",
                "Operation Erebus",
                "Red Eyes",
                "TA-RedAnt",
                "InkySquid",
                "Reaper Group",
                "Ricochet Chollima",
                "ATK4",
                "G0067"
            ],
            "source_name": "MISPGALAXY:APT37",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f0bccc3d-ad77-49c4-8dfd-8a8a8d6fba26",
            "created_at": "2024-05-01T02:03:08.134022Z",
            "updated_at": "2025-03-27T02:05:17.415028Z",
            "deleted_at": null,
            "main_name": "NICKEL FOXCROFT",
            "aliases": [
                "Group 123 ",
                "Moldy Pisces ",
                "RICOCHET CHOLLIMA ",
                "Reaper ",
                "ScarCruft ",
                "APT37 "
            ],
            "source_name": "Secureworks:NICKEL FOXCROFT",
            "tools": [
                "ROKRAT"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "c0cedde3-5a9b-430f-9b77-e6568307205e",
            "created_at": "2022-10-25T16:07:23.528994Z",
            "updated_at": "2025-03-27T02:02:09.847683Z",
            "deleted_at": null,
            "main_name": "DarkHotel",
            "aliases": [
                "APT-C-06",
                "ATK 52",
                "CTG-1948",
                "Dubnium",
                "Fallout Team",
                "Higaisa",
                "Luder",
                "Operation DarkHotel",
                "Operation Daybreak",
                "Operation Inexsmar",
                "Operation PowerFall",
                "Operation The Gh0st Remains the Same",
                "SIG25",
                "Shadow Crane",
                "T-APT-02",
                "Tungsten Bridge",
                "Zigzag Hail"
            ],
            "source_name": "ETDA:DarkHotel",
            "tools": [
                "Asruex",
                "DarkHotel",
                "DmaUp3.exe",
                "GreezeBackdoor",
                "Karba",
                "Nemain",
                "Nemim",
                "Ramsay",
                "Retro",
                "Tapaoux",
                "Trojan.Win32.Karba.e",
                "Virus.Win32.Pioneer.dx",
                "igfxext.exe",
                "msieckc.exe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "9b02c527-5077-489e-9a80-5d88947fddab",
            "created_at": "2022-10-25T16:07:24.103499Z",
            "updated_at": "2025-03-27T02:02:10.108504Z",
            "deleted_at": null,
            "main_name": "Reaper",
            "aliases": [
                "APT 37",
                "ATK 4",
                "Cerium",
                "Crooked Pisces",
                "Geumseong121",
                "Group 123",
                "ITG10",
                "InkySquid",
                "Moldy Pisces",
                "Opal Sleet",
                "Operation Are You Happy?",
                "Operation Battle Cruiser",
                "Operation Black Banner",
                "Operation Daybreak",
                "Operation Dragon messenger",
                "Operation Erebus",
                "Operation Evil New Year",
                "Operation Evil New Year 2018",
                "Operation Fractured Block",
                "Operation Fractured Statue",
                "Operation FreeMilk",
                "Operation Golden Bird",
                "Operation Golden Time",
                "Operation High Expert",
                "Operation Holiday Wiper",
                "Operation Korean Sword",
                "Operation North Korean Human Right",
                "Operation Onezero",
                "Operation Rocket Man",
                "Operation SHROUDED#SLEEP",
                "Operation STARK#MULE",
                "Operation STIFF#BIZON",
                "Operation Spy Cloud",
                "Operation Star Cruiser",
                "Osmium",
                "Red Eyes",
                "Ricochet Chollima",
                "Ruby Sleet",
                "ScarCruft",
                "TA-RedAnt",
                "TEMP.Reaper",
                "Venus 121"
            ],
            "source_name": "ETDA:Reaper",
            "tools": [
                "Agentemis",
                "BLUELIGHT",
                "Backdoor.APT.POORAIM",
                "CARROTBALL",
                "CARROTBAT",
                "CORALDECK",
                "Cobalt Strike",
                "CobaltStrike",
                "DOGCALL",
                "Erebus",
                "Exploit.APT.RICECURRY",
                "Final1stSpy",
                "Freenki Loader",
                "GELCAPSULE",
                "GOLDBACKDOOR",
                "GreezeBackdoor",
                "HAPPYWORK",
                "JinhoSpy",
                "KARAE",
                "KevDroid",
                "Konni",
                "MILKDROP",
                "N1stAgent",
                "NavRAT",
                "Nokki",
                "Oceansalt",
                "POORAIM",
                "PoohMilk",
                "PoohMilk Loader",
                "RICECURRY",
                "RUHAPPY",
                "RokRAT",
                "SHUTTERSPEED",
                "SLOWDRIFT",
                "SOUNDWAVE",
                "SYSCON",
                "Sanny",
                "ScarCruft",
                "StarCruft",
                "Syscon",
                "VeilShell",
                "WINERACK",
                "ZUMKONG",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716501,
    "ts_updated_at": 1743041797,
    "ts_creation_date": 1552364550,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/3342a5172b2ecde86762dd35f61057006dbb7448.pdf",
        "text": "https://archive.orkl.eu/3342a5172b2ecde86762dd35f61057006dbb7448.txt",
        "img": "https://archive.orkl.eu/3342a5172b2ecde86762dd35f61057006dbb7448.jpg"
    }
}