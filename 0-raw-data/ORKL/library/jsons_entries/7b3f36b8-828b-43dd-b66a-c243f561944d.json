{
    "id": "7b3f36b8-828b-43dd-b66a-c243f561944d",
    "created_at": "2023-01-12T15:02:19.569157Z",
    "updated_at": "2025-03-27T02:05:23.26432Z",
    "deleted_at": null,
    "sha1_hash": "4ff54582e119a91cc7ad1ce7ce63c6415dd358bd",
    "title": "2022-08-10 - BlueSky Ransomware- Fast Encryption via Multithreading",
    "authors": "",
    "file_creation_date": "2022-09-12T12:01:02Z",
    "file_modification_date": "2022-09-12T12:01:02Z",
    "file_size": 2691647,
    "plain_text": "# BlueSky Ransomware: Fast Encryption via Multithreading\n\n**unit42.paloaltonetworks.com/bluesky-ransomware/**\n\nMuhammad Umer Khan, Lee Wei, Yang Ji, Wenjun Hu August 10, 2022\n\nBy [Muhammad Umer Khan,](https://unit42.paloaltonetworks.com/author/muhammad-umer-khan/) [Lee Wei,](https://unit42.paloaltonetworks.com/author/lee-wei/) [Yang Ji and](https://unit42.paloaltonetworks.com/author/yang-ji/) [Wenjun Hu](https://unit42.paloaltonetworks.com/author/wenjun-hu/)\n\nAugust 10, 2022 at 12:00 PM\n\n[Category: Malware,](https://unit42.paloaltonetworks.com/category/malware-2/) [Ransomware](https://unit42.paloaltonetworks.com/category/ransomware/)\n\nTags: [babuk,](https://unit42.paloaltonetworks.com/tag/babuk/) [BlueSky Ransomware,](https://unit42.paloaltonetworks.com/tag/bluesky-ransomware/) [Cloud-Delivered Security Services,](https://unit42.paloaltonetworks.com/tag/cloud-delivered-security-services/) [conti ransomware,](https://unit42.paloaltonetworks.com/tag/conti-ransomware/) Cortex\nXDR, [Investigation and Response,](https://unit42.paloaltonetworks.com/tag/investigation-and-response/) [next-generation firewall,](https://unit42.paloaltonetworks.com/tag/next-generation-firewall/) [Powershell,](https://unit42.paloaltonetworks.com/tag/powershell/) [RedLine infostealer,](https://unit42.paloaltonetworks.com/tag/redline-infostealer/)\n[threat intelligence,](https://unit42.paloaltonetworks.com/tag/threat-intelligence/) [URL filtering,](https://unit42.paloaltonetworks.com/tag/url-filtering/) [WildFire](https://unit42.paloaltonetworks.com/tag/wildfire/)\n\nThis post is also available in: 日本語 [(Japanese)](https://unit42.paloaltonetworks.jp/bluesky-ransomware/)\n\n## Executive Summary\n\nBlueSky ransomware is an emerging family that has adopted modern techniques to evade security\ndefenses.\n\nRansomware is a malicious program designed to encrypt a user’s data and demand a ransom for\nthe decryption. BlueSky ransomware predominantly targets Windows hosts and utilizes\nmultithreading to encrypt files on the host for faster encryption.\n\nIn our analysis, we found code fingerprints from samples of BlueSky ransomware that can be\nconnected to the [Conti ransomware group. In particular, the multithreaded architecture of BlueSky](https://unit42.paloaltonetworks.com/conti-ransomware-gang/)\nbears code similarities with Conti v3 and the network search module is an exact replica of it\n\n\n-----\n\n[However, in another respect, BlueSky more closely resembles Babuk Ransomware. Both use](https://chuongdong.com/reverse%20engineering/2021/01/16/BabukRansomware-v3/)\n[ChaCha20, an algorithm for file encryption, along with Curve25519 for key generation.](https://en.wikipedia.org/wiki/ChaCha20-Poly1305)\n\n[According to research done by CloudSEK, PowerShell scripting is used to drop and download](https://cloudsek.com/threatintelligence/tracking-the-operators-of-the-newly-emerged-bluesky-ransomware/)\nBlueSky ransomware from a fake website to encrypt data. After successful encryption, BlueSky\nRansomware renames the encrypted files with the file extension .bluesky and drops a ransom note\nfile named # DECRYPT FILES BLUESKY #.txt and # DECRYPT FILES BLUESKY #.html.\n\nPalo Alto Networks customers receive protections from BlueSky ransomware and other types of\n[ransomware through Cortex XDR, the](https://www.paloaltonetworks.com/cortex/cortex-xdr) [Next-Generation Firewall and](https://www.paloaltonetworks.com/network-security/next-generation-firewall) cloud-delivered security\n[services including WildFire. The](https://www.paloaltonetworks.com/network-security/next-generation-firewall) [Advanced URL Filtering subscription provides real-time URL](https://www.paloaltonetworks.com/network-security/advanced-url-filtering)\nanalysis and malware prevention for BlueSky ransomware.\n\n[If you think you may have been impacted by a cyber incident, the Unit 42 Incident Response team](https://www.paloaltonetworks.com/unit42/respond/incident-response)\nis available 24/7/365. You can also take preventative steps by requesting any of our cyber risk\nmanagement services.\n\nRelated Unit 42 Topics [Ransomware,](https://unit42.paloaltonetworks.com/category/ransomware/) [Conti Ransomware](https://unit42.paloaltonetworks.com/tag/conti-ransomware/)\n\n## Table of Contents\n\nInitial Dropper\n\nLocal Privilege Escalation\n\nRansomware Payload\n\nRansom Note\n\nAnti-Analysis Techniques\n\nRansomware Artifacts\n\nFile Encryption\n\nRedLine Infostealer Association\n\nConclusion\n\nIndicators of Compromise\n\nMITRE TTPs\n\nAdditional Resources\n\n## Initial Dropper\n\nAs shown in Figure 1, BlueSky ransomware is initially dropped by the PowerShell script start.ps1,\nwhich is hosted at hxxps://kmsauto[.]us/someone/start.ps1. The initial dropper is Base64-encoded\nand then DEFLATE-compressed, which is common behavior observed among PowerShell\ndroppers.\n\n\n-----\n\nFigure 1. Initial dropper.\nAfter extracting the embedded Base64-encoded stream from start.ps1, the decoded and\nuncompressed data stream led to yet another PowerShell script called stage.ps1. This script\ncontained countless irrelevant comments in an attempt to conceal malicious activity. After removing\nthese excessive comments, we discovered that start.ps1 downloaded a number of payloads from\nhxxps://kmsauto[.]us/someone/ based on the user’s privileges, as shown in Figure 2.\n\n\n-----\n\nFigure 2. Initial dropper (decoded).\n\n## Local Privilege Escalation\n\nBefore downloading additional payloads to perform local privilege escalation, the PowerShell script,\nstage.ps1, determines if it is being executed as a privileged user. If so, it moves to the next step\nand downloads and executes the ransomware payload. If not, it uses the following techniques to\nescalate local privileges, depending on the version of the host operating system. If the version of\nthe host operating system is earlier than Windows 10, such as Windows 7, 8 or XP, then the script\nwill download and execute a modified version of the local privilege escalation tool called\n[JuicyPotato. If the host is running Windows 10 or later, then the script will download and execute](https://github.com/ohpe/juicy-potato)\n[ghost.exe and spooler.exe to exploit local privilege escalation vulnerabilities CVE-2020-0796 and](https://nvd.nist.gov/vuln/detail/cve-2020-0796)\n[CVE-2021-1732 respectively.](https://nvd.nist.gov/vuln/detail/CVE-2021-1732)\n\n## Ransomware Payload\n\nAfter gaining additional privileges, stage.ps1 downloads the final BlueSky ransomware payload\nfrom hxxps://kmsauto[.]us/someone/l.exe and saves it locally to the filesystem as javaw.exe,\nattempting to masquerade as a legitimate Windows application. Eventually, the sample executes\nfrom the file path %APPDATA%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\javaw.exe.\n\n\n-----\n\n## Ransom Note\n\nBlueSky drops the ransom note as a text file named # DECRYPT FILES BLUESKY #.txt and an\nHTML file named # DECRYPT FILES BLUESKY #.html in a local directory where it has encrypted\nfiles successfully and renamed them with the file extension .bluesky. The content of # DECRYPT\nFILES BLUESKY #.html is shown in Figure 3.\n\nFigure 3. BlueSky ransom note.\n\n## Anti-Analysis Techniques\n\nBlueSky implements multiple anti-analysis techniques, including string encryption, API obfuscation\nand anti-debugging mechanisms, allowing it to obfuscate Windows API function names and use\nindirect calls for resolving APIs. Additionally, BlueSky encodes API names using DJB hashing\nfunctions as shown in Figure 4, hindering malware analysis.\n\n\n-----\n\nFigure 4. DJB hash matching.\n\n## Ransomware Artifacts\n\nBlueSky generates a unique user ID by computing the MD5 hash over the combined Volume\nInformation, Machine GUID, Product ID and Install Date values, as shown in Figure 5. Furthermore,\nit uses the same ID for generating the mutex Global\\<32-byte ID>.\n\n\n-----\n\nFigure 5. Unique ID calculation.\nIt creates the registry key HKCU\\Software\\<32-byte ID> to store registry entries completed,\nRECOVERY BLOB and x25519_public to fingerprint its ransomware operations. Once the\nencryption process is completed, the registry entry completed is set with a value of 1. RECOVERY\nBLOB is a fingerprint identifier for the compromised organization, which is encrypted by the\nChaCha20 encryption algorithm. The structure of the RECOVERY BLOB is shown in Table 1.\n\n**Offset** **Data** **Size**\n\n0x00 Curve25519 public key 0x20\n\n0x20 Cryptographic random value 0x0C\n\n0x2C Curve25519 secret key 0x20\n\n0x4C Unique user ID 0x10\n\n0x5C Hardcoded RC4-decoded bytes 0x10\n\n0x6C Unknown DWORD 0x04\n\n\n-----\n\n**Offset** **Data** **Size**\n\n0x70 Unknown DWORD 0x04\n\n0x74 Constant value 0x1000 0x04\n\n_Table 1. Recovery blob structure._\n\nThe RECOVERY BLOB is then encrypted with ChaCha20 as shown in Figure 6 and stored in\nHKCU\\Software\\<32-byte ID>\\RECOVERY.\n\nFigure 6. Recovery blob encryption.\n\n## File Encryption\n\nUnlike other ransomware, which normally contains a list of file extensions to identify eligible files for\nencryption, BlueSky consists of a list of extensions that are negated in the file encryption process.\nThe file extensions used in BlueSky are listed below:\n\nldf, scr, icl, 386, cmd, ani, adv, theme, msi, rtp, diagcfg, msstyles, bin, hlp, shs, drv, wpx, bat, rom,\nmsc, lnk, cab, spl, ps1, msu, ics, key, msp, com, sys, diagpkg, nls, diagcab, ico, lock, ocx, mpa, cur,\ncpl, mod, hta, exe, ini, icns, prf, dll, bluesky, nomedia, idx\n\nDirectory names excluded from encryption:\n\n$recycle.bin, $windows.~bt, $windows.~ws, boot, windows, windows.old, system volume\ninformation, perflogs, programdata, program files, program files (x86), all users, appdata, tor\nbrowser\n\nFilenames excluded from encryption:\n\n# decrypt files bluesky #.txt, # decrypt files bluesky #.html, ntuser.dat, iconcache.db, ntuser.dat.log,\nbootsect.bak, autorun.inf, bootmgr, ntldr, thumbs.db\n\nAs shown in Figure 7, BlueSky uses a multithreaded queue for encryption. It starts multiple threads\n– one responsible for file encryption, another for enumerating files on the local file system and\nmounted network shares to be added into the queue. This multithreaded architecture bears code\nsimilarities with Conti (Ransomware) v3. In particular, the network search module is an exact replica\n\n\n-----\n\nof Conti v3. However, there are certain differences in the file encryption routine. For instance, Conti\nv3 uses RSA- and AES-based file encryption, whereas BlueSky utilizes Curve25519- and\nChaCha20-based file encryption.\n\nFigure 7. Ransomware queues.\n[The file encryption of BlueSky is similar to Babuk Ransomware – both use Curve25519 to generate](https://chuongdong.com/reverse%20engineering/2021/01/16/BabukRansomware-v3/)\na public key for the host and generate a shared key with the public key of the attacker. After\ngenerating an elliptic curve key pair, BlueSky computes a hash of the shared key, and uses it to\ngenerate a file encryption key for the ChaCha20 algorithm. Finally, it reads the file buffer, encrypts it\nwith ChaCha20 and replaces the contents of the original file, as shown in Figure 8.\n\nFigure 8. File encryption routine.\n\n## RedLine Infostealer Association\n\n\n-----\n\nAll samples we observed related to BlueSky ransomware were hosted at an active domain named\nkmsauto[.]us. When hunting for more samples related to BlueSky ransomware, we observed that\nseveral malware samples associated with the RedLine infostealer were hosted on the same\ndomain. Although we did not find any code overlap between RedLine and BlueSky ransomware,\nsimilarities in the initial stages were observed, as both these families use a PowerShell downloader\nas the initial vector.\n\n## Conclusion\n\nRansomware authors are adopting modern advanced techniques such as encoding and encrypting\nmalicious samples, or using multi-staged ransomware delivery and loading, to evade security\ndefenses. BlueSky ransomware is capable of encrypting files on victim hosts at rapid speeds with\nmultithreaded computation. In addition, the ransomware adopts obfuscation techniques, such as\nAPI hashing, to slow down the reverse engineering process for the analyst.\n\nIt is very likely that ransomware attacks will continue to grow with advanced encryption techniques\nand delivery mechanisms.\n\n[Palo Alto Networks customers with Cortex XDR, the](https://www.paloaltonetworks.com/cortex/cortex-xdr) [Next-Generation Firewall and](https://www.paloaltonetworks.com/network-security/next-generation-firewall) Advanced URL\nFiltering benefit from protections against the attacks discussed in this article. Additionally, the\n[malicious indicators (domains, URLs and hashes) can be prevented with our DNS Security and](https://www.paloaltonetworks.com/products/threat-detection-and-prevention/dns-security)\n[WildFire services.](https://www.paloaltonetworks.com/products/secure-the-network/wildfire)\n\nIf you think you may have been impacted or have an urgent matter, get in touch with the Unit 42\nIncident Response team or call:\n\nNorth America Toll-Free: 866.486.4842 (866.4.UNIT42)\nEMEA: +31.20.299.3130\nAPAC: +65.6983.8730\nJapan: +81.50.1790.0200\n\nIf you have cyber insurance, you can request Unit 42 by name. You can also take preventative\n[steps by requesting any of our cyber risk management services, such as our](https://www.paloaltonetworks.com/unit42/assess) Ransomware\nReadiness Assessment.\n\n## Indicators of Compromise\n\n**SHA256 Hashes** **Description**\n\n\n2280898cb29faf1785e782596d8029cb471537ec38352e5c17cc263f1f52b8ef\n3e035f2d7d30869ce53171ef5a0f761bfb9c14d94d9fe6da385e20b8d96dc2fb\n840af927adbfdeb7070e1cf73ed195cf48c8d5f35b6de12f58b73898d7056d3d\nb5b105751a2bf965a6b78eeff100fe4c75282ad6f37f98b9adcd15d8c64283ec\nc75748dc544629a8a5d08c0d8ba7fda3508a3efdaed905ad800ffddbc8d3b8df\ne75717be1633b5e3602827dc3b5788ff691dd325b0eddd2d0d9ddcee29de364f\n\n\nBlueSky\nRansomware\nPayloads\n\n\n-----\n\n08f491d46a9d05f1aebc83d724ca32c8063a2613250d50ce5b7e8ba469680605 Obfuscated\nPowerShell\nDownloader\n\n969a4a55bb5cabc96ff003467bd8468b3079f5c95c5823985416c019eb8abe2f PowerShell\nDownloader\n(decoded)\n\nc4e47cba1c5fedf9ba522bc2d2de54a482e0ac29c98358390af6dadc0a7d65ce CVE-20200796\nSMBGhost\nPrivilege\nEscalation\nExploit\n\ncf64c08d97e6dfa5588c5fa016c25c4131ccc61b8deada7f9c8b2a41d8f5a32c JuicyPotato\n\n6c94a1bc67af21cedb0bffac03019dbf870649a182e58cc5960969adf4fbdd48 CVE-20211732\nPrivilege\nEscalation\nExploit\n\n_RedLine_\n\n\n58db85f0c86640b4c3a2584e9ef5696c526190faf87eaa19085737685bc9e7f5\n9ca0e858ff6f163a128fb699d2b801b6b13a2eb1d6cd995302effa5f587cd8d8\naecfc82fa44790e0533f0bece0a1ab0860b163838646aa0c019187a37326d477\nbe3e665d389e8b85ceda1e2fc80a41a247de27d1d0b13ee0c2574c1e36ebc6d4\n\n4d696c106f568b99308565172116933c0e26ce2e9ace003a110e8bde0216ddab\naa7ff8badcffdff66df6d30bde51b6e3c960be0a3719b73d3875af8e1173bd94\n\n0dfe7a93ff40834c072c7fdd9381771b1086b67f545fa83c766b2d67a911e47b\n1a30e0d65a8a09abc3feb1c86a0619845fc6ab9bdba3ae8800ecec55a647910e\n624f129189a05897c176e9feb519521c1b6ef528b0b52e1a7a3290e5a2313a6b\nfe2e5df2fae90fb90b56e4ea268e8ca68f46dc3365c22b840d865193a48be189\n\nURLs\n\nhxxps://kmsauto[.]us/someone/l.exe\nhxxps://kmsauto[.]us/app1.bin\nhxxps://kmsauto[.]us/server.txt\nhxxps://kmsauto[.]us/encoding.txt\nhxxps://kmsauto[.]us/all.txt\nhxxps://kmsauto[.]us/someone/spooler.exe\nhxxps://kmsauto[.]us/sti/sti.bin\nhxxps://kmsauto[.]us/someone/potato.exe\nhxxps://kmsauto[.]us/someone/ghost.exe\nhxxps://kmsauto[.]us/someone/start.ps1\n\n\nPowerShell\nDownloader\n\nMSIL\nDownloader\n\nPayloads\n\n\n-----\n\nRansom Note URLs\n\nhttp://ccpyeuptrlatb2piua4ukhnhi7lrxgerrcrj4p2b5uhbzqm2xgdjaqid.onion\n\nRegistry Paths\n\nHKCU\\Software\\<32-byte hex string>\\completed\nHKCU\\Software\\<32-byte hex string>\\recoveryblob\nHKCU\\Software\\<32-byte hex string>\\x25519_public\n\n## MITRE TTPs\n\n**ID** **Technique** **Description**\n\n\n[T1486](https://attack.mitre.org/techniques/T1486) Data Encrypted for\nImpact\n\n[T1140](https://attack.mitre.org/techniques/T1140) Deobfuscate/Decode\nFiles or Information\n\n[T1083](https://attack.mitre.org/techniques/T1083) File and Directory\nDiscovery\n\n\nBlueSky can use CreateIoCompletionPort(),\nPostQueuedCompletionStatus() and\nGetQueuedCompletionPort() to rapidly encrypt files.\n\nBlueSky downloader base64-decodes and decompresses data\nto unpack the next stage payload.\n\nBlueSky ransomware payload encrypts ransom note with rc4based encryption, and it uses a custom encryption scheme to\nencrypt embedded strings.\n\nBlueSky can discover files on a local system.\n\n\n[T1106](https://attack.mitre.org/techniques/T1106) [Native API](https://attack.mitre.org/techniques/T1106) BlueSky has used API calls during execution.\n\n\n[T1135](https://attack.mitre.org/techniques/T1135) Network Share\nDiscovery\n\n[T1027](https://attack.mitre.org/techniques/T1027) Obfuscated Files or\nInformation\n\n## Additional Resources\n\n\nBlueSky can enumerate remote open SMB network shares using\nNetShareEnum().\n\nBlueSky can use API obfuscation to protect its functionality from\nanalysis.\n\n\n[Tracking the Operators of the Newly Emerged BlueSky Ransomware – by](https://cloudsek.com/threatintelligence/tracking-the-operators-of-the-newly-emerged-bluesky-ransomware/) [CloudSEK](https://cloudsek.com/)\n[Conti Ransomware Source Code – on GitHub @gharty03](https://github.com/gharty03/Conti-Ransomware)\n[Babuk Ransomware v3 – by](https://chuongdong.com/reverse%20engineering/2021/01/16/BabukRansomware-v3) [Chuong Dong](https://chuongdong.com/)\n[2022 Unit 42 Ransomware Threat Report](https://start.paloaltonetworks.com/unit-42-ransomware-threat-report.html)\n[2022 Unit 42 Incident Response Report](https://start.paloaltonetworks.com/2022-unit42-incident-response-report)\n\n**Get updates from**\n\n**Palo Alto**\n\n**Networks!**\n\nSign up to receive the latest news, cyber threat intelligence and research from us\n\n\n-----\n\n[By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement.](https://www.paloaltonetworks.com/legal-notices/terms-of-use)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-08-10 - BlueSky Ransomware- Fast Encryption via Multithreading.pdf"
    ],
    "report_names": [
        "2022-08-10 - BlueSky Ransomware- Fast Encryption via Multithreading.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535739,
    "ts_updated_at": 1743041123,
    "ts_creation_date": 1662984062,
    "ts_modification_date": 1662984062,
    "files": {
        "pdf": "https://archive.orkl.eu/4ff54582e119a91cc7ad1ce7ce63c6415dd358bd.pdf",
        "text": "https://archive.orkl.eu/4ff54582e119a91cc7ad1ce7ce63c6415dd358bd.txt",
        "img": "https://archive.orkl.eu/4ff54582e119a91cc7ad1ce7ce63c6415dd358bd.jpg"
    }
}