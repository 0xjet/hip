{
    "id": "2f7e35e6-2842-47ac-b308-efb5601f7931",
    "created_at": "2023-01-12T15:02:16.580059Z",
    "updated_at": "2025-03-27T02:17:23.409033Z",
    "deleted_at": null,
    "sha1_hash": "7f0669e44fc2961775115815946f2f743c5ed365",
    "title": "Anti-UPX Unpacking Technique",
    "authors": "",
    "file_creation_date": "2022-03-15T17:39:47Z",
    "file_modification_date": "2022-03-15T17:39:47Z",
    "file_size": 400582,
    "plain_text": "### blogs.jpcert.or.jp /en/2022/03/anti_upx_unpack.html\n\n# Anti-UPX Unpacking Technique\n\n朝長 [秀誠 (Shusei Tomonaga)](https://blogs.jpcert.or.jp/en/shu_tom/)\n\nMarch 15, 2022\n\nMalware targeting Windows OS (PE format) has a variety of obfuscation and packing techniques in place\nso that they complicate the code analysis processes. On the other hand, there are only a few types of\npacking techniques for Linux-targeting malware (ELF format), and it is mainly UPX-based. This blog\narticle explains the details of Anti-UPX Unpacking technique, which is often applied to Linux-targeting\nmalware.\n\n## Malware with Anti-UPX Unpacking Technique\n\nThe most well-known malware using Anti-UPX Unpacking technique is Mirai and its variants, which target\nIoT devices. Figure 1 shows the headers of UPX-packed binary and Mirai. The normal UPX packing uses\n“UPX!” as a magic number, while Mirai assigns a different value to each sample.\n\nFigure 1: UPX-packed binary (left) and Mirai header (right)\n\nUPX-packed binary contains the following information in the header. Normally, only “l_magic” is altered,\nbut “p_filesize” and “p_blocksize” are also zero-padded in some samples.\n```\nstruct l_info    // 12-byte trailer in header for loader (offset 116)\n{\n  uint32_t l_checksum;\n  uint32_t l_magic;  // magic number = \"UPX!\"\n  uint16_t l_lsize;\n  uint8_t l_version;\n  uint8_t l_format;\n};\nstruct p_info    // 12-byte packed program header follows stub loader\n{\n  uint32_t p_progid;\n  uint32_t p_filesize;\n\n```\n\n-----\n\n```\n  uint32_t p_blocksize;\n};\n\n```\nBesides Mirai, there are many other types of malware using this technique, including BoSSaBot (seen\naround 2014), as well as some coin miners and SBIDIOT malware, more recently. This is also applied to\nsome types of malware which were used by Lazarus group. Figure 2 shows a part of ELF-VSingle’s code,\nwhich is associated with the group. The magic number is replaced with “MEMS”.\n\nFigure 2: ELF_VSingle header\n\n## Unpacking Anti-UPX Unpacking binary\n\nBinary based on Anti-UPX Unpacking technique cannot be unpacked using the normal upx command.\nHowever, it is actually easy to unpack it. In most cases, the only change made to such binary is its magic\nnumber “UPX!”. You can unpack it with upx command by changing this value back to “UPX!”. Figure 3\nshows the process of changing the magic number in order to unpack it using upx command.\n\n\n-----\n\nFigure 3: Example of unpacking binary\n\nWe have created a tool that enables unpacking binary with Anti-UPX Unpacking techniques. This tool is\nintended for this purpose only, and it may not work otherwise.\n\n\n-----\n\n**JPCERTCC/upx-mod - GitHub** [https://github.com/JPCERTCC/upx-mod/releases/tag/v4.00-beta](https://github.com/JPCERTCC/upx-mod/releases/tag/v4.00-beta)\n\nFigure 4: Sample use of upx_mod command\n\n## Detect Anti-UPX Unpacking Technique\n\nBinary packed with this technique can be identified manually, just by looking at the code. In order to avoid\noversight, we recommend Yara-based automatic detection like below. This rule does not detect binary\npacked with normal UPX.\n```\nrule upx_antiunpack_elf32 {\n   meta:\n    description = \"Anti-UPX Unpacking technique to magic renamed for\nELF32\"\n    author = \"JPCERT/CC Incident Response Group\"\n   condition:\n    uint32(0) == 0x464C457F and\n    uint8(4) == 1 and\n    (\n     (\n      for any magic in (uint32(filesize - 0x24)) : (magic ==\n\n```\n\n-----\n\n```\nuint32(uint16(0x2C) uint16(0x2A) + uint16(0x28) + 4)) and\n      not for any magic in (0x21585055, 0) : (magic ==\nuint32(uint16(0x2C) * uint16(0x2A) + uint16(0x28) + 4))\n     )\n     or\n     (\n      for any magic in (uint32(filesize - 0x24)) : (magic ==\nuint32(uint16be(0x2C) * uint16be(0x2A) + uint16be(0x28) + 4)) and\n      not for any magic in (0x21585055, 0) : (magic ==\nuint32(uint16be(0x2C) * uint16be(0x2A) + uint16be(0x28) + 4))\n     )\n    )\n}\nrule upx_antiunpack_elf64 {\n   meta:\n    description = \"Anti-UPX Unpacking technique to magic renamed for\nELF64\"\n    author = \"JPCERT/CC Incident Response Group\"\n   condition:\n    uint32(0) == 0x464C457F and\n    uint8(4) == 2 and\n    (\n     (\n      for any magic in (uint32(filesize - 0x24)) : (magic ==\nuint32(uint16(0x36) * uint16(0x38) + uint16(0x34) + 4)) and\n      not for any magic in (0x21585055, 0) : (magic ==\nuint32(uint16(0x36) * uint16(0x38) + uint16(0x34) + 4))\n     )\n     or\n     (\n      for any magic in (uint32(filesize - 0x24)) : (magic ==\nuint32(uint16be(0x36) * uint16be(0x38) + uint16be(0x34) + 4)) and\n      not for any magic in (0x21585055, 0) : (magic ==\nuint32(uint16be(0x36) * uint16be(0x38) + uint16be(0x34) + 4))\n     )\n    )\n}\n\n## In closing\n\n```\nMany attack groups use malware based on Anti-UPX Unpacking technique. It is easy to unpack such\nmalware, but you may waste your time in unpacking process unless you notice this feature beforehand.\nWhen you analyse packed ELF binary, we recommend checking first whether it uses Anti-UPX\nUnpacking technique.\n\n\n-----\n\nShusei Tomonaga\n(Translated by Yukako Uchida)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/AV Tech/Anti-UPX Unpacking Technique.pdf"
    ],
    "report_names": [
        "Anti-UPX Unpacking Technique.pdf"
    ],
    "threat_actors": [
        {
            "id": "e034b94b-9655-42c4-a72e-a58807dce299",
            "created_at": "2022-10-25T16:07:24.133537Z",
            "updated_at": "2025-03-27T02:02:10.118581Z",
            "deleted_at": null,
            "main_name": "Rocket Kitten",
            "aliases": [
                "Group 83",
                "NewsBeef",
                "Newscaster",
                "Operation Newscaster",
                "Operation Woolen-GoldFish",
                "Parastoo",
                "Rocket Kitten"
            ],
            "source_name": "ETDA:Rocket Kitten",
            "tools": [
                "CoreImpact (Modified)",
                "FireMalv",
                "Ghole",
                "Gholee"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "8faa11f5-2a14-479c-9ea8-3779e6de9749",
            "created_at": "2022-10-25T15:50:23.814205Z",
            "updated_at": "2025-03-27T02:00:55.551798Z",
            "deleted_at": null,
            "main_name": "Ajax Security Team",
            "aliases": [
                "Ajax Security Team",
                "Operation Woolen-Goldfish",
                "AjaxTM",
                "Rocket Kitten",
                "Flying Kitten",
                "Operation Saffron Rose"
            ],
            "source_name": "MITRE:Ajax Security Team",
            "tools": [
                "sqlmap",
                "Havij"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "32a223a8-3c79-4146-87c5-8557d38662ae",
            "created_at": "2022-10-25T15:50:23.703698Z",
            "updated_at": "2025-03-27T02:00:55.528031Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "Lazarus Group",
                "Labyrinth Chollima",
                "HIDDEN COBRA",
                "Guardians of Peace",
                "NICKEL ACADEMY",
                "Diamond Sleet"
            ],
            "source_name": "MITRE:Lazarus Group",
            "tools": [
                "RawDisk",
                "Proxysvc",
                "BADCALL",
                "FALLCHILL",
                "WannaCry",
                "HOPLIGHT",
                "TYPEFRAME",
                "Dtrack",
                "HotCroissant",
                "HARDRAIN",
                "Dacls",
                "KEYMARBLE",
                "TAINTEDSCRIBE",
                "AuditCred",
                "netsh",
                "ECCENTRICBANDWAGON",
                "AppleJeus",
                "BLINDINGCAN",
                "ThreatNeedle",
                "Volgmer",
                "Cryptoistic",
                "RATANKBA",
                "Bankshot",
                "Torisma",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "8bc1a044-a23b-4904-903c-13f463605cb3",
            "created_at": "2024-05-01T02:03:08.136237Z",
            "updated_at": "2025-03-27T02:05:17.415795Z",
            "deleted_at": null,
            "main_name": "NICKEL GLADSTONE",
            "aliases": [
                "Bluenoroff ",
                "CTG-6459 ",
                "Citrine Sleet ",
                "HIDDEN COBRA ",
                "Lazarus Group",
                "Sapphire Sleet ",
                "Stardust Chollima ",
                "APT38 "
            ],
            "source_name": "Secureworks:NICKEL GLADSTONE",
            "tools": [
                " Bankshot",
                " CATCH22",
                " CCGC_Proxy",
                " Cur1Agent",
                " Ratankba",
                " Server_TrafficForwarder",
                " Wcry",
                "AlphaNC"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "b0261705-df2e-4156-9839-16314250f88a",
            "created_at": "2023-01-06T13:46:38.373617Z",
            "updated_at": "2025-03-27T02:00:02.817313Z",
            "deleted_at": null,
            "main_name": "Rocket Kitten",
            "aliases": [
                "Operation Woolen-Goldfish",
                "Thamar Reservoir",
                "Timberworm",
                "TEMP.Beanie",
                "Operation Woolen Goldfish"
            ],
            "source_name": "MISPGALAXY:Rocket Kitten",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "a2b92056-9378-4749-926b-7e10c4500dac",
            "created_at": "2023-01-06T13:46:38.430595Z",
            "updated_at": "2025-03-27T02:00:02.831633Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "Operation DarkSeoul",
                "APT38",
                "ATK117",
                "DEV-1222",
                "G0032",
                "APT 38",
                "Stardust Chollima",
                "APT-C-26",
                "ATK3",
                "Diamond Sleet",
                "Hidden Cobra",
                "Unit 121",
                "Subgroup: Bluenoroff",
                "NICKEL GLADSTONE",
                "DEV-0139",
                "Andariel",
                "Operation Troy",
                "COVELLITE",
                "TA404",
                "Lazarus group",
                "Dark Seoul",
                "G0082",
                "NewRomanic Cyber Army Team",
                "Bluenoroff",
                "Appleworm",
                "Nickel Academy",
                "COPERNICIUM",
                "Hastati Group",
                "Bureau 121",
                "Operation AppleJeus",
                "Whois Hacking Team",
                "Citrine Sleet",
                "Sapphire Sleet",
                "Group 77",
                "Labyrinth Chollima",
                "Operation GhostSecret",
                "BeagleBoyz"
            ],
            "source_name": "MISPGALAXY:Lazarus Group",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f32df445-9fb4-4234-99e0-3561f6498e4e",
            "created_at": "2022-10-25T16:07:23.756373Z",
            "updated_at": "2025-03-27T02:02:09.966155Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "APT-C-26",
                "ATK 3",
                "Appleworm",
                "Citrine Sleet",
                "DEV-0139",
                "Diamond Sleet",
                "Gleaming Pisces",
                "Gods Apostles",
                "Gods Disciples",
                "Group 77",
                "Guardians of Peace",
                "Hastati Group",
                "Hidden Cobra",
                "ITG03",
                "Jade Sleet",
                "Labyrinth Chollima",
                "Lazarus Group",
                "NewRomanic Cyber Army Team",
                "Operation 99",
                "Operation AppleJeus",
                "Operation AppleJeus sequel",
                "Operation Blockbuster: Breach of Sony Pictures Entertainment",
                "Operation CryptoCore",
                "Operation Dream Job",
                "Operation Dream Magic",
                "Operation Flame",
                "Operation GhostSecret",
                "Operation In(ter)caption",
                "Operation LolZarus",
                "Operation Marstech Mayhem",
                "Operation No Pineapple!",
                "Operation North Star",
                "Operation Phantom Circuit",
                "Operation Sharpshooter",
                "Operation Ten Days of Rain / DarkSeoul",
                "Operation Troy",
                "SectorA01",
                "Slow Pisces",
                "TA404",
                "TraderTraitor",
                "UNC2970",
                "UNC4034",
                "UNC4736",
                "UNC4899",
                "UNC577",
                "Whois Hacking Team"
            ],
            "source_name": "ETDA:Lazarus Group",
            "tools": [
                "3CX Backdoor",
                "3Rat Client",
                "3proxy",
                "AIRDRY",
                "ARTFULPIE",
                "ATMDtrack",
                "AlphaNC",
                "Alreay",
                "Andaratm",
                "AngryRebel",
                "AppleJeus",
                "Aryan",
                "AuditCred",
                "BADCALL",
                "BISTROMATH",
                "BLINDINGCAN",
                "BTC Changer",
                "BUFFETLINE",
                "BanSwift",
                "Bankshot",
                "Bitrep",
                "Bitsran",
                "BlindToad",
                "Bookcode",
                "BootWreck",
                "BottomLoader",
                "Brambul",
                "BravoNC",
                "Breut",
                "COLDCAT",
                "COPPERHEDGE",
                "CROWDEDFLOUNDER",
                "Castov",
                "CheeseTray",
                "CleanToad",
                "ClientTraficForwarder",
                "CollectionRAT",
                "Concealment Troy",
                "Contopee",
                "CookieTime",
                "Cyruslish",
                "DAVESHELL",
                "DBLL Dropper",
                "DLRAT",
                "DRATzarus",
                "DRATzarus RAT",
                "Dacls",
                "Dacls RAT",
                "DarkComet",
                "DarkKomet",
                "DeltaCharlie",
                "DeltaNC",
                "Dembr",
                "Destover",
                "DoublePulsar",
                "Dozer",
                "Dtrack",
                "Duuzer",
                "DyePack",
                "ECCENTRICBANDWAGON",
                "ELECTRICFISH",
                "Escad",
                "EternalBlue",
                "FALLCHILL",
                "FYNLOS",
                "FallChill RAT",
                "Farfli",
                "Fimlis",
                "FoggyBrass",
                "FudModule",
                "Fynloski",
                "Gh0st RAT",
                "Ghost RAT",
                "Gopuram",
                "HARDRAIN",
                "HIDDEN COBRA RAT/Worm",
                "HLOADER",
                "HOOKSHOT",
                "HOPLIGHT",
                "HOTCROISSANT",
                "HOTWAX",
                "HTTP Troy",
                "Hawup",
                "Hawup RAT",
                "Hermes",
                "HotCroissant",
                "HotelAlfa",
                "Hotwax",
                "HtDnDownLoader",
                "Http Dr0pper",
                "ICONICSTEALER",
                "Joanap",
                "Jokra",
                "KANDYKORN",
                "KEYMARBLE",
                "Kaos",
                "KillDisk",
                "KillMBR",
                "Koredos",
                "Krademok",
                "LIGHTSHIFT",
                "LIGHTSHOW",
                "LOLBAS",
                "LOLBins",
                "Lazarus",
                "LightlessCan",
                "Living off the Land",
                "MATA",
                "MBRkiller",
                "MagicRAT",
                "Manuscrypt",
                "Mimail",
                "Mimikatz",
                "Moudour",
                "Mydoom",
                "Mydoor",
                "Mytob",
                "NACHOCHEESE",
                "NachoCheese",
                "NestEgg",
                "NickelLoader",
                "NineRAT",
                "Novarg",
                "NukeSped",
                "OpBlockBuster",
                "PCRat",
                "PEBBLEDASH",
                "PLANKWALK",
                "POOLRAT",
                "PSLogger",
                "PhanDoor",
                "Plink",
                "PondRAT",
                "PowerBrace",
                "PowerRatankba",
                "PowerShell RAT",
                "PowerSpritz",
                "PowerTask",
                "Preft",
                "ProcDump",
                "Proxysvc",
                "PuTTY Link",
                "QUICKRIDE",
                "QUICKRIDE.POWER",
                "Quickcafe",
                "QuiteRAT",
                "R-C1",
                "ROptimizer",
                "Ratabanka",
                "RatabankaPOS",
                "Ratankba",
                "RatankbaPOS",
                "RawDisk",
                "RedShawl",
                "Rifdoor",
                "Rising Sun",
                "Romeo-CoreOne",
                "RomeoAlfa",
                "RomeoBravo",
                "RomeoCharlie",
                "RomeoCore",
                "RomeoDelta",
                "RomeoEcho",
                "RomeoFoxtrot",
                "RomeoGolf",
                "RomeoHotel",
                "RomeoMike",
                "RomeoNovember",
                "RomeoWhiskey",
                "Romeos",
                "RustBucket",
                "SHADYCAT",
                "SHARPKNOT",
                "SIGFLIP",
                "SIMPLESEA",
                "SLICKSHOES",
                "SORRYBRUTE",
                "SUDDENICON",
                "SUGARLOADER",
                "SheepRAT",
                "SierraAlfa",
                "SierraBravo",
                "SierraCharlie",
                "SierraJuliett-MikeOne",
                "SierraJuliett-MikeTwo",
                "SimpleTea",
                "SimplexTea",
                "SmallTiger",
                "Stunnel",
                "TAINTEDSCRIBE",
                "TAXHAUL",
                "TFlower",
                "TOUCHKEY",
                "TOUCHMOVE",
                "TOUCHSHIFT",
                "TOUCHSHOT",
                "TWOPENCE",
                "TYPEFRAME",
                "Tdrop",
                "Tdrop2",
                "ThreatNeedle",
                "Tiger RAT",
                "TigerRAT",
                "Trojan Manuscript",
                "Troy",
                "TroyRAT",
                "VEILEDSIGNAL",
                "VHD",
                "VHD Ransomware",
                "VIVACIOUSGIFT",
                "VSingle",
                "ValeforBeta",
                "Volgmer",
                "Vyveva",
                "W1_RAT",
                "Wana Decrypt0r",
                "WanaCry",
                "WanaCrypt",
                "WanaCrypt0r",
                "WannaCry",
                "WannaCrypt",
                "WannaCryptor",
                "WbBot",
                "Wcry",
                "Win32/KillDisk.NBB",
                "Win32/KillDisk.NBC",
                "Win32/KillDisk.NBD",
                "Win32/KillDisk.NBH",
                "Win32/KillDisk.NBI",
                "WinorDLL64",
                "Winsec",
                "WolfRAT",
                "Wormhole",
                "YamaBot",
                "Yort",
                "ZetaNile",
                "concealment_troy",
                "http_troy",
                "httpdr0pper",
                "httpdropper",
                "klovbot",
                "sRDI"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535736,
    "ts_updated_at": 1743041843,
    "ts_creation_date": 1647365987,
    "ts_modification_date": 1647365987,
    "files": {
        "pdf": "https://archive.orkl.eu/7f0669e44fc2961775115815946f2f743c5ed365.pdf",
        "text": "https://archive.orkl.eu/7f0669e44fc2961775115815946f2f743c5ed365.txt",
        "img": "https://archive.orkl.eu/7f0669e44fc2961775115815946f2f743c5ed365.jpg"
    }
}