{
    "id": "7f831832-462a-46ad-8d93-2b7e8b3839c3",
    "created_at": "2023-01-12T14:59:08.033917Z",
    "updated_at": "2025-03-27T02:06:10.292022Z",
    "deleted_at": null,
    "sha1_hash": "6a01fe261149432d2549ef89d6eb02c2462f30f5",
    "title": "2021-08-02 - New sophisticated RAT in town- FatalRat analysis",
    "authors": "",
    "file_creation_date": "2022-05-27T22:17:18Z",
    "file_modification_date": "2022-05-27T22:17:18Z",
    "file_size": 2180850,
    "plain_text": "# New sophisticated RAT in town: FatalRat analysis\n\n**[cybersecurity.att.com/blogs/labs-research/new-sophisticated-rat-in-town-fatalrat-analysis](https://cybersecurity.att.com/blogs/labs-research/new-sophisticated-rat-in-town-fatalrat-analysis)**\n\n[1. AT&T Cybersecurity](https://cybersecurity.att.com/)\n[2. Blog](https://cybersecurity.att.com/blogs)\n\nAugust 2, 2021 | [Ofer Caspi](https://cybersecurity.att.com/blogs/author/ofer-caspi)\n_This blog was written by Ofer Caspi and Javi Ruiz._\n\n## Summary\n\nAT&T Alien Labs™ has recently observed the presence of a new remote access trojan (RAT)\nmalware in its threat analysis systems. The malware, known as FatalRAT (Firstly [named by](https://urldefense.com/v3/__https://twitter.com/c3rb3ru5d3d53c/status/1396821380256178179__;!!BhdT!0VBQ4oPQtWljVtTRSQfB5C_O6U46lbDFbQBZM068w7b7wckv_yV2zHNmEGV5XQ%24)\n[@c3rb3ru5d3d53c), appears to be distributed via forums and Telegram channels, hidden in](https://twitter.com/LittleRedBean2/status/1391012054228742148)\ndownload links that attempt to lure the user via software or media articles.\n\n## Key takeaways:\n\nAT&T Alien Labs performed a malware analysis of the FatalRAT threat.\nWe have observed a new spreading mechanism via Telegram channels.\nAnalyzed samples are capable of performing defense evasion techniques, obtaining\nsystem persistence, logging user keystrokes, collecting system information, exfiltrating\nover encrypted command and control (C&C) channel.\n\n## Analysis\n\n\n-----\n\nFatalRAT is a remote access trojan with a wide set of capabilities that can be executed\nremotely by an attacker. The malware runs several tests before fully infecting a system,\nchecking the existence of multiple virtual machine products, disk space, number of physical\n[processors, and more (T1497.001).](https://attack.mitre.org/techniques/T1497/001/)\n\nFigure 1. AntiVM techniques from a system report.\n\nOne of the tests run by FatalRAT involves checking for existence of virtual machine services,\nas shown in figure 2.\n\nFigure 2. AntiVM techniques includes searching for services.\n\nAnother includes querying the registry, as shown in figure 3.\n\n\n-----\n\nFigure 3. AntiVM techniques - registry check.\n\nIf the machine passes the malware AntiVM tests, FatalRAT will then starts its malicious\nactivity.\n\n[First, it decrypts each of the configuration strings separately (T1027). These configuration](https://attack.mitre.org/techniques/T1027/)\nstrings include the Command and Control (C&C) address, new malware file name, service\nname, and other settings.\n\nFigure 4. Decrypting configuration strings.\n\nFigure 5 shows the routine used by FatalRAT for decrypting strings.\n\n\n-----\n\nFigure 5. Strings decryption routine.\n\nThe malware will disable the ability to lock the computer by using CTRL+ALT+DELETE. For\nthis purpose, the registry key DisableLockWorkstation is set to “1” as shown in figure 6\n[(T1112).](https://attack.mitre.org/techniques/T1112/)\n\nFigure 6. Disable computer lockdown.\n\n[After the computer lockdown is disabled, the malware activates a keylogger (T1056.001).](https://attack.mitre.org/techniques/T1056/001/)\nSee figure 7.\n\nFigure 7. FatalRat keylogger.\n\n\n-----\n\n[FatalRat can persist either by modifying the registry (T1547.001) or by creating a new](https://attack.mitre.org/techniques/T1547/001/)\n[service (T1569.002). If persistence is done by modifying the registry, it will create the value](https://attack.mitre.org/techniques/T1569/002/)\n'Software\\Microsoft\\Windows\\CurrentVersion\\Run\\SVP7' to execute the malware at boot\ntime. When using setting service for persistence, FatalRat will retrieve the description from\nits configuration as seen above in figure 4.\n\nFigure 8. FatalRat registry persistence.\n\n[The malware collects information from an infected machine and sends it to the C&C (T1020),](https://attack.mitre.org/techniques/T1020/)\nas shown in figure 9. This includes external IP address, username, and other information\nabout the victim.\n\nAdditionally, as a defense evasion technique, FatalRAT identifies all security products\nrunning on the machine by iterating through all running processes and searching for the\n[existence of a predefined list of security products (T1562.001), as shown in figure 10.](https://attack.mitre.org/techniques/T1562/001/)\n\nFigure 9. Collecting information.\n\n\n-----\n\nFigure 10. Security product process search.\n\nFurthermore, to make it easier for the attacker to detect which security products are installed,\nit will convert the process name above to a product name before sending the list to the C&C.\nSee figure 11.\n\nFigure 11. Security product process to name.\n\n\n-----\n\nTo communicate back to the C&C, the malware uses an arithmetic routine to encrypt the data\nsent between the victim and the attacker. This encryption includes a one-byte XOR key and\n[the addition of a constant to the obtained value (121 in this case) (T1573.001). See figure 12.](https://attack.mitre.org/techniques/T1573/001/)\n\nFigure 12. C&C communication decrypting routine.\n\nThe encrypted message is then sent to the C&C as seen in the config from figure 4 through\nport 8081.\n\nFigure 13. Encrypted communication between infected host and C&C.\n\nThe malware then waits for the attacker’s commands, of which it supports a wide range. For\nexample, it has several routines to handle different browsers. Some of these routines include\ndeleting user info for specific browsers (Edge, 360Secure Browser, QQBrowser,\nSogouBrowser, and Firefox). For Chrome, it will query for user info and then delete the\ncontent. Deleting saved information will force the user to input, for example, user and\n[password which the malware can capture with its keylogger. (T1119)](https://attack.mitre.org/techniques/T1119/)\n\n\n-----\n\nFigure 14. Parsing C&C command.\n\nSome of the commands FatalRat supports are shown below.\n\nSpreading itself on the victim network by brute-forcing weak passwords through IPC$. If\nsuccessful, the malware copies itself to the dedicated folder as %Folder%\\hackshen.exe and\nwill execute the copied file remotely. See figures 15-17.\n\n\n-----\n\nFigure 15. Weak user and password for brute force.\n\nFigure 16. Brute force loop.\n\n\n-----\n\nFigure 17. Copy and execute remote computer on successful brute-force attack.\n\nEither steal stored data (for chrome for example) or delete saved information with a handler\nfor different browsers. See figure 18.\n\nFigure 18. Malware handlers for different browser.\n\nFatalRat also includes additional commands, for the following:\n\nKeylogger\n\n\n-----\n\nChange resolution\nUninstall UltraViewer\nDownload and install AnyDesk\nExecute shell commands\nModify registry keys\nDownload and execute a file\n\nFigure 19. More available commands.\n\n## Recommended actions\n\n1. Do not click links or install software from unknown sources.\n2. Install an antivirus and keep your system updated.\n3. Always use an endpoint detection and response (EDR) solution or enable system log\n\nmonitoring to allow SIEM correlation.\n4. Monitor network traffic to command and control (C&C) patterns.\n\n## Conclusion\n\nThe newly identified FatalRat malware has been using techniques like obfuscation, antisandbox and antivirus evasion, encrypted configurations, logging user keystrokes, system\npersistence, login brute force, collection of system data, and encrypted communications with\ncommand and control server. Alien Labs has discovered multiple samples in the past few\nmonths, with a slight dip in July. However, we expect to continue to see the presence of\nFatalRat and its variants in our samples in the near future. AT&T Alien Labs will continue to\nmonitor this threat and update intelligence as activity emerges.\n\n## Detection methods\n\n\n-----\n\nThe following associated detection methods are in use by Alien Labs. They can be used by\nreaders to tune or deploy detections in their own environments or for aiding additional\nresearch.\n\n\nSURICATA IDS SIGNATURES\n\n```\nalert tcp $HOME_NET any -> $EXTERNAL_NET any (msg:\"AV TROJAN FatalRAT CnC Request\";\nflow:established,to_server; dsize:300<>500; content:\"|BF BC 95|\"; startswith;\ncontent:\"|8D 8E 8E 5E 90 8E 8E 2C 1B 80 8E E6 02 A7 6D FC C6 00 06 4F 0E 97|\";\ndistance:1; within:22; threshold:type limit, count 1, seconds 3600, track by_src;\nreference:md5,99fc53d3d4c2c31fd5b5f0f15dbdeab4; classtype:trojan-activity;\nsid:4002633; rev:1;)\n\n```\n```\n2033093: ET TROJAN FatalRAT CnC Activity\n\n```\n\nYARA RULES\n\n\n-----\n\n```\nrule FatalRAT_unpacked\n{\n  meta:\n    author = \"AT&T Alien Labs\"\n    sha256 = \"ec0dcfe2d8380a4bafadb3ed73b546cbf73ef78f893e32202042a5818b67ce56\"\n    type = \"malware\"\n    description = \"Detects FatalRAT, unpacked malware.\"\n    copyright = \"Alienvault Inc. 2021\"\n  strings:\n    $decrypt_func = {EC 0F B6 45 10 99 B9 AB 05 00 00 56 F7 F9 8B 75 0C 80 C2\n3D 85 F6 76 0F 8B 45 08 8A 08 32 CA 02 CA 88 08 40 4E 75 F4 5E 5D C3}\n    $s1 = \"SVP7-Thread running...\"\n    $s2 = \"nw_elf.dll\"\n  condition:\n    uint16(0) == 0x5a4d and all of them\n}\n\n```\n\n## Associated Indicators of Compromise (IOCs)\n\nThe following technical indicators are associated with the reported intelligence. A list of\n[indicators is also available in the OTX Pulse. Please note, the pulse may include other](https://otx.alienvault.com/pulse/60f02d70854fe24789907049)\nactivities related but out of the scope of the report.\n\nTYPE INDICATOR\n\nSHA256 e52af19dce25d51f9cf258613988b8edc583f7c7e134d3e1b834d9aab9c7c4c4\n\nSHA256 dc026cd76891d1f84f44f6789ac0145a458e2c704a7bc50590ec08966578edb3\n\n\n-----\n\nSHA256 cb450f82c49eadd597a87645f9f30c52c03c6ed9425386af5b321664fe3a6da0\n\nSHA256 210990e36122e0facc7c74373569f052fa0651ab06644330fe00b685793ee0fd\n\nSHA256 34f37327a0154d644854a723e0557c733931e2366a19bdb4cfe6f6ae6770c50f\n\nSHA256 ec0dcfe2d8380a4bafadb3ed73b546cbf73ef78f893e32202042a5818b67ce56\n\nSHA256 b01719e59675236df1a0e1a78cdd97455c0cf18426c7ec0f52df1f3a78209f65\n\nSHA256 72cd668d9bc442f522556807390d4f7e32966bef20ef1a831bf36a5ab213191e\n\nSHA256 1cabdb7ab1cbd0526498d15839c780850a41a8c917b65581fad9e7dbdedd5e0f\n\nSHA256 5453911d6f597d65ab542ec25723a7d87b2292c2e2a52a40d3a32032f6117acd\n\nSHA256 826d07108a1223140e6a58b44722404009ac2e82df0acfd7d1f5bf29b56526b6\n\nSHA256 337841b5ade52ba853a30eb8ab04dede64d89808893fb6e0412247950295152\n\nSHA256 17075832426b085743c2ba811690b525cf8d486da127edc030f28bb3e10e0734\n\n\nIP\nADDRESS\n\n\n103.119.44[.]152\n\n\nIP\nADDRESS\n\n\n103.119.44[.]93\n\n\nIP\nADDRESS\n\n\n103.119.44[.]100\n\n\n## Mapped to MITRE ATT&CK\n\n[The findings of this report are mapped to the following MITRE ATT&CK Matrix techniques:](https://attack.mitre.org/)\n\n\n-----\n\nTA0001: Initial Access\n\nT1566: Phishing\n\nT1566.002: Spearphishing Link\nTA0005: Defense Evasion\n\nT1027: Obfuscated Files or Information\n\nT1027.002: Software Packing\nT1497: Virtualization/Sandbox Evasion\n\nT1497.001: System Checks\nT1112: Modify Registry\nT1562: Impair Defenses\n\nT1562.001: Impair Defenses: Disable or Modify Tools\nTA0002: Execution\n\nT1569: System Services\n\nT1569.002: Service Execution\nTA0009: Collection\n\nT1056: Input Capture\n\nT1056.001: Keylogging\nT1119: Automated Collection\nTA0010: Exfiltration\n\nT1020: Automated Exfiltration\nTA0011: Command and Control\n\nT1573: Encrypted Channel\n\nT1573.001: Encrypted Channel: Symmetric Cryptography\n\n### Share this with others\n\nTags: [malware,](https://cybersecurity.att.com/blogs/tag/malware) [yara,](https://cybersecurity.att.com/blogs/tag/yara) [alien labs,](https://cybersecurity.att.com/blogs/tag/alien+labs) [otx,](https://cybersecurity.att.com/blogs/tag/otx) [otx pulse,](https://cybersecurity.att.com/blogs/tag/otx+pulse) [brute force attack,](https://cybersecurity.att.com/blogs/tag/brute+force+attack) [remote access trojan,](https://cybersecurity.att.com/blogs/tag/remote+access+trojan)\n[fatalrat,](https://cybersecurity.att.com/blogs/tag/fatalrat) [weak passwords](https://cybersecurity.att.com/blogs/tag/weak+passwords)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-08-02 - New sophisticated RAT in town- FatalRat analysis.pdf"
    ],
    "report_names": [
        "2021-08-02 - New sophisticated RAT in town- FatalRat analysis.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535548,
    "ts_updated_at": 1743041170,
    "ts_creation_date": 1653689838,
    "ts_modification_date": 1653689838,
    "files": {
        "pdf": "https://archive.orkl.eu/6a01fe261149432d2549ef89d6eb02c2462f30f5.pdf",
        "text": "https://archive.orkl.eu/6a01fe261149432d2549ef89d6eb02c2462f30f5.txt",
        "img": "https://archive.orkl.eu/6a01fe261149432d2549ef89d6eb02c2462f30f5.jpg"
    }
}