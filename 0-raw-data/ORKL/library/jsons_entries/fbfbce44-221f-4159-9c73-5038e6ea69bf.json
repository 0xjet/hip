{
    "id": "fbfbce44-221f-4159-9c73-5038e6ea69bf",
    "created_at": "2022-10-25T16:48:19.588823Z",
    "updated_at": "2025-03-27T02:05:39.100023Z",
    "deleted_at": null,
    "sha1_hash": "072f9c047f3568d1f31f5fe9ff90b2dbbe24134a",
    "title": "",
    "authors": "",
    "file_creation_date": "2020-12-07T09:44:09Z",
    "file_modification_date": "2020-12-07T09:44:09Z",
    "file_size": 279973,
    "plain_text": "# Russian State-Sponsored Actors Exploiting Vulnerability in\n\n VMware[® ]Workspace ONE Access Using Compromised\n\n Credentials \n\n### Summary\n\nRussian state-sponsored malicious cyber actors are exploiting a vulnerability in VMware[®][1] Access and VMware Identity\nManager[2] products [1], allowing the actors access to protected data and abusing federated authentication. VMware\nreleased a patch for the Command Injection Vulnerability captured in CVE-2020-4006 on December 3[rd] 2020. NSA\nencourages National Security System (NSS), Department of Defense (DoD), and Defense Industrial Base (DIB) network\nadministrators to prioritize mitigation of the vulnerability on affected servers.\n\nPassword-based access to the web-based management interface of the device is required to exploit the vulnerability, so\nusing a strong and unique password lowers the risk of exploitation. The risk is lowered further if the web-based\nmanagement interface is not accessible from Internet. The vulnerability affects the following products [2]:\n\n######  VMware Access[®][3] 20.01 and 20.10 on Linux[®][4]\n  VMware vIDM[®][5] 3.3.1, 3.3.2, and 3.3.3 on Linux\n  VMware vIDM Connector 3.3.1, 3.3.2, 3.3.3, 19.03\n  VMware Cloud Foundation[®][6] 4.x\n  VMware vRealize Suite Lifecycle Manager[®][7] 8.x\n\nThe exploitation (T1190[8]) via command injection (T1059) led to installation of a web shell (T1505.003) and follow-on\nmalicious activity where credentials in the form of SAML authentication assertions were generated and sent to Microsoft[®9]\nActive Directory Federation Services (ADFS) (T1212), which in turn granted the actors access to protected data (TA0009).\n\nIt is critical when running products that perform authentication that the server and all the services that depend on it are\nproperly configured for secure operation and integration. Otherwise, SAML assertions could be forged, granting access to\nnumerous resources. If integrating authentication servers with ADFS, NSA recommends following Microsoft’s best\npractices, especially for securing SAML assertions and requiring multi-factor authentication [3] [4].\n\n### Mitigation Actions\n\n##### Patch\n\nUpdate affected systems to the latest version as soon as possible according to VMware’s instructions at [KB81754](https://kb.vmware.com/s/article/81754) [1] [5].\nReview and harden configurations and monitoring of federated authentication providers.\n\n1 VMware® is a registered trademark of VMware, Inc.\n2 VMware® Workspace ONE Access, formerly VMware Identity Manager (vIDM), are noted throughout as VMware Access or vIDM\n3 VMware Access® is a registered trademark of VMware, Inc.\n4 Linux® is a registered trademark of Linus Torvalds.\n5 VMware vIDM® is a registered trademark of VMware, Inc.\n6 VMware Cloud Foundation® is a registered trademark of VMware, Inc.\n7 VMware vRealize Suite Lifecycle Manager® is a registered trademark of VMware, Inc.\n8 T1190 and similar references are MITRE® ATT&CK® techniques and tactics. MITRE and ATT&CK are registered trademarks of The MITRE Corporation.\n9 Microsoft® is a registered trademark of Microsoft Corporation.\n\n\n-----\n\n##### Workaround\n\n[According to VMware’s Knowledge Base article KB81731, critical portions of this activity can be blocked by disabling the](https://kb.vmware.com/s/article/81731)\nconfigurator service using the following procedures for Linux-based appliances [6]:\n\n1. Use ssh to connect to the appliance using “sshuser” credentials configured during installation or when updated\n\nlater.\n\n2. Switch to root by typing su and provide “root” credentials configured during installation or when updated later.\n\n3. Run the following commands:\n```\n    cd /opt/vmware/horizon/workspace\n    mkdir webapps.tmp\n    mv conf/Catalina/localhost/cfg.xml webapps.tmp\n    service horizon-workspace restart\n\n```\n4. Repeat steps for all Linux-based appliances affected by CVE-2020-4006.\n\nFor Windows-based servers:\n\n1. Log in as Administrator.\n\n2. Open a Command Prompt window and run the following commands:\n```\n    net stop “VMwareIDMConnector”\n    cd \\VMware\\VMwareIdentityManager\\Connector\\opt\\vmware\\horizon\\workspace\n    mkdir webappstmp\n    move webapps\\cfg webappstmp\n    move conf\\Catalina\\localhost\\cfg.xml webappstmp\n    net start “VMwareIDMConnector”\n\n```\n3. Repeat steps for all Windows-based servers affected by CVE-2020-4006.\n\nVMware’s KB81731 lists steps to revert the workaround if needed.\n\nThis workaround should only be a temporary fix until able to fully patch the system. In addition, review and harden\nconfigurations and monitoring of federated authentication providers.\n\n##### Detection\n\nNetwork-based indicators are unlikely to be effective at detecting exploitation since the activity occurs exclusively inside\nan encrypted transport layer security (TLS) tunnel associated with the web interface. However, indications of this activity\nmay be caught in server logs. The presence of an “exit” statement followed by any 3-digit number, such as “exit 123”,\nwithin the configurator.log would suggest that exploitation activity may have occurred on the system. This log can be\nfound at /opt/vmware/horizon/workspace/logs/configurator.log on the server. Other commands along with encoded scripts\nmay also be present. If such logs are detected, incident response actions should be followed. Additional investigation of\nthe server, especially for web shell malware, is recommended (see the NSA CSI “Detect and Prevent Web Shell Malware”\n\n[7]).\n\nRegularly monitor authentication logs for anomalous authentications, especially successful ones that leverage established\ntrusts but that come from unusual addresses or contain unusual properties.\n\n\n-----\n\n##### Further Guidance\n\nExploiting the vulnerability requires authenticated password-based access to the management interface of the device,\nwhich is encrypted with TLS. That interface typically runs over port 8443, but it could be over any user-defined port. NSA\nrecommends that NSS, DoD, and DIB network administrators limit the accessibility of the management interface on\nservers to only a small set of known systems and block it from direct Internet access (see “Performing Out-of-Band\nManagement” [8]).\n\nSince the server requires that passwords be intentionally chosen upon installation, there are no known default passwords.\nSetting the password to a strong unique password would make it more difficult to exploit, but would likely not mitigate an\nexisting compromise.\n\nIt is critical when running products that perform authentication that the server and all the services that depend on it are\nproperly configured for secure operation and integration. Otherwise, SAML assertions could be forged, granting access to\nnumerous resources. If integrating authentication servers with ADFS, NSA recommends following Microsoft’s best\npractices, especially for securing SAML assertions and requiring multi-factor authentication [3] [4].\n\n### Works Cited\n\n[1] VMware patch KB81754. [Online] Available at: [https://kb.vmware.com/s/article/81754](https://kb.vmware.com/s/article/81754)\n\n[2] VMware. VMware Security Advisory VMSA-2020-0027. [Online] Available at:\n\n[https://www.vmware.com/security/advisories/VMSA-2020-0027.html](https://www.vmware.com/security/advisories/VMSA-2020-0027.html)\n\n[[3] Microsoft. Best practices for securing Active Directory Federation Services. [Online] https://docs.microsoft.com/en-us/windows-](https://docs.microsoft.com/en-us/windows-server/identity/ad-fs/deployment/best-practices-securing-ad-fs)\n\n[server/identity/ad-fs/deployment/best-practices-securing-ad-fs](https://docs.microsoft.com/en-us/windows-server/identity/ad-fs/deployment/best-practices-securing-ad-fs)\n\n[[4] Microsoft. Best Practices for Secure Planning and Deployment of AD FS. [Online] https://docs.microsoft.com/en-us/windows-](https://docs.microsoft.com/en-us/windows-server/identity/ad-fs/design/best-practices-for-secure-planning-and-deployment-of-ad-fs)\n\n[server/identity/ad-fs/design/best-practices-for-secure-planning-and-deployment-of-ad-fs](https://docs.microsoft.com/en-us/windows-server/identity/ad-fs/design/best-practices-for-secure-planning-and-deployment-of-ad-fs)\n\n[[5] NSA. Update and Upgrade Software Immediately. [Online] Available at: https://www.nsa.gov/cybersecurity-guidance](https://www.nsa.gov/cybersecurity-guidance)\n\n[6] VMware. WMware Workspace ONE Access, VMware Identity Manager, VMware Identity Manager Connector Workaround\n\n[Instructions for CVE-2020-4006 (81731). [Online] Available at: https://kb.vmware.com/s/article/81731](https://kb.vmware.com/s/article/81731)\n\n[[7] NSA. Detect and Prevent Web Shell Malware. [Online] Available at: https://www.nsa.gov/cybersecurity-guidance](https://www.nsa.gov/cybersecurity-guidance)\n\n[[8] NSA. Performing Out-of-Band Network Management. [Online] Available at: https://www.nsa.gov/cybersecurity-guidance](https://www.nsa.gov/cybersecurity-guidance)\n\n##### Disclaimer of Endorsement\n\nThe information and opinions contained in this document are provided \"as is\" and without any warranties or guarantees. Reference herein to any specific\ncommercial products, process, or service by trade name, trademark, manufacturer, or otherwise, does not constitute or imply its endorsement,\nrecommendation, or favoring by the United States Government, and this guidance shall not be used for advertising or product endorsement purposes.\n\n##### Purpose\n\nThis document was developed in furtherance of NSA’s cybersecurity missions, including its responsibilities to identify and disseminate threats to\nNational Security Systems, Department of Defense, and Defense Industrial Base information systems, and to develop and issue cybersecurity\nspecifications and mitigations. This information may be shared broadly to reach all appropriate stakeholders.\n\n##### Contact\n\n[Client Requirements / General Cybersecurity Inquiries: Cybersecurity Requirements Center, 410-854-4200, Cybersecurity_Requests@nsa.gov](mailto:Cybersecurity_Requests@nsa.gov)\n[Media inquiries / Press Desk: Media Relations, 443-634-0721, MediaRelations@nsa.gov](mailto:MediaRelations@nsa.gov)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5910e58f-4bc9-4e4e-9dbb-887804094a01",
            "created_at": "2022-10-25T16:32:58.457399Z",
            "updated_at": "2022-10-25T16:32:58.457399Z",
            "deleted_at": null,
            "name": "OTX",
            "url": "https://otx.alienvault.com",
            "description": "Alienvault Open Threat Exchange (OTX)",
            "reports": null
        },
        {
            "id": "4e039bf8-7239-4999-8ec0-eb202d1465af",
            "created_at": "2022-12-04T11:19:36.52593Z",
            "updated_at": "2022-12-04T11:19:36.52593Z",
            "deleted_at": null,
            "name": "ORKL",
            "url": "https://github.com/ORKL/library",
            "description": "ORKL Community Contributed Content",
            "reports": null
        }
    ],
    "references": [
        "https://media.defense.gov/2020/Dec/07/2002547071/-1/-1/0/CSA_VMWARE%20ACCESS_U_OO_195076_20.PDF"
    ],
    "report_names": [
        "CSA_VMWARE%20ACCESS_U_OO_195076_20.PDF"
    ],
    "threat_actors": [],
    "ts_created_at": 1666716499,
    "ts_updated_at": 1743041139,
    "ts_creation_date": 1607334249,
    "ts_modification_date": 1607334249,
    "files": {
        "pdf": "https://archive.orkl.eu/072f9c047f3568d1f31f5fe9ff90b2dbbe24134a.pdf",
        "text": "https://archive.orkl.eu/072f9c047f3568d1f31f5fe9ff90b2dbbe24134a.txt",
        "img": "https://archive.orkl.eu/072f9c047f3568d1f31f5fe9ff90b2dbbe24134a.jpg"
    }
}