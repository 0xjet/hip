{
    "id": "e869f443-9f30-4fb4-95fe-bc996830d414",
    "created_at": "2023-01-12T15:07:41.798313Z",
    "updated_at": "2025-03-27T02:05:58.778389Z",
    "deleted_at": null,
    "sha1_hash": "612974f561833c0c63f5c4970b0c192145bf9f49",
    "title": "2021-07-06 - Cybereason vs. REvil Ransomware- The Kaseya Chronicles",
    "authors": "",
    "file_creation_date": "2022-05-28T00:32:20Z",
    "file_modification_date": "2022-05-28T00:32:20Z",
    "file_size": 1428283,
    "plain_text": "# Cybereason vs. REvil Ransomware: The Kaseya Chronicles\n\n**[cybereason.com/blog/cybereason-vs-revil-ransomware-the-kaseya-chronicles](https://www.cybereason.com/blog/cybereason-vs-revil-ransomware-the-kaseya-chronicles)**\n\nAs a spate of ransomware attacks continue to dominate the headlines in recent months, the\ninfamous REvil ransomware gang has upped the ante significantly with a wide ranging\noperation that is suspected to have impacted thousands of small-to-midsize businesses\nthrough the compromise of a leading IT services provider.\n\n[Reports indicate that the REvil gang’s supply chain attack exploited the Kaseya VSA remote](https://www.reuters.com/technology/hackers-demand-70-million-liberate-data-held-by-companies-hit-mass-cyberattack-2021-07-05/)\nmanagement service to propagate the ransomware to multiple targets by way of Managed\nService Providers who use the software to service clients across the globe.\n\n[REvil is the same threat actor who hit meatpacking giant JBS with a ransomware attack at](https://www.cnbc.com/2021/06/02/russian-linked-cybercriminal-group-revil-behind-meatpacker-jbs-attack.html)\nthe beginning of June, shutting down a good portion of the company’s production capabilities\nand threatened to create supply chain disruptions and sharp cost of goods increases.\n\nBack in April of 2019, the Cybereason Nocturnus team first encountered and analyzed the\nREvil ransomware (aka Sodinokibi, Sodin), a notoriously aggressive and highly evasive\nthreat that takes many measures to maintain obfuscation and prevent detection by security\ntools.\n\n## Cybereason Detects and Blocks REvil Ransomware\n\n\n-----\n\nThe [Cybereason Defense Platform has consistently proven to detect and block REvil](https://www.cybereason.com/platform#graphic)\nransomware. Cybereason customers have been protected from this threat since it emerged\n[in 2019, as are the customers of our Managed Services Provider partners in the wake of the](https://www.cybereason.com/managed-security-service-provider-partners)\nKaseya supply chain compromise:\n\n_The Cybereason Defense Platform Detects and Blocks REvil Ransomware_\n\nOver time, REvil has become the largest ransomware cartel operating in operation to date.\nSubsequent attacks attributed to the REvil gang include a March 2021 attack against\nTaiwanese multinational electronics corporation Acer where the assailants demanded a\nrecord breaking $50 million ransom.\n\nIn April, [the REvil gang attempted to extort Apple following an attack against one of the tech](https://www.cybereason.com/blog/sodinokibi-ransomware-gang-extorts-apple-through-supply-chain-attack)\ngiant’s business partners with a $50 million ransom demand with the additional threats to\nincrease the ransom demand to $100 million and release exfiltrated data from the target\nshould the payment not be made promptly.\n\n[Much like the DarkSide ransomware gang that struck Colonial Pipeline in early May, the](https://www.cybereason.com/blog/inside-the-darkside-ransomware-attack-on-colonial-pipeline)\n[REvil gang follows the double extortion trend, where the threat actors first exfiltrates](https://www.cybereason.com/blog/rise-of-double-extortion-shines-spotlight-on-ransomware-prevention)\nsensitive information stored on a victim’s systems before launching the encryption routine.\n\nAfter the ransomware encrypts the target’s data and issues the ransom demand for payment\nin exchange for the decryption key, the threat actors make the additional threat of publishing\nthe exfiltrated data online should the target refuse to make the ransom payment.\n\nThis means the target is still faced with the prospect of having to pay the ransom regardless\nof whether or not they employed data backups as a precautionary measure, and\nunderscores the need to take a prevention-first security posture.\n\n## REvil’s Kaseya Attack\n\nAt the time of publication of this report, the exact chain of events that enabled at least 1000\nbusinesses to be infected by the REvil ransomware is not entirely clear. According to\n[Huntress’s investigation, one possibility is the exploitation of the web interface of Kaseya’s](https://thehackernews.com/2021/07/revil-used-0-day-in-kaseya-ransomware.html)\nVSA Servers (software used by Kaseya customers to monitor and manage their\ninfrastructure), which enabled authentication bypass and remote code execution.\n\nIn addition, The Dutch Institute for Vulnerability Disclosure (DIVD) has revealed that it had\n[alerted Kaseya on a number of zero-day vulnerabilities in the VSA software (CVE-2021-](https://csirt.divd.nl/2021/07/04/Kaseya-Case-Update-2/)\n30116) which are used in the ransomware attacks.\n\n\n-----\n\n_Screenshot from the REvil Website_\n\n## The Flow of the Alleged Supply-Chain Attack\n\n_Full attack tree as shown in the Cybereason Defense Platform_\n\nOnce the attackers gain access to the targeted environment, the Kaseya Agent Monitor\n(agentmon.exe) is used to write a base 64 decoded file named “agent.crt” (The ransomware\ndropper) to the path “c:\\kworking\\”\n\n\n-----\n\nAfter it writes the encoded payload to disk, agentmon.exe executes the following command\nline which contains the following commands:\n\n_Full command line executed by “agentmon.exe”_\n\n**Ping is executed a random number of times (in each instance we observed the -n**\nparameter is different). This may function as a sleep timer before the next instructions\nare executed:\n\n_Ping command line_\n\n**PowerShell command is executed to disable Windows built-in security and Antivirus**\nsettings on the machine:\n\n_Powershell command line disabling Windows built-in security and antivirus settings_\n\n**“CertUtil.exe” is copied to “C:\\Windows\\cert.exe”. CertUtil.exe is an admin command**\nline tool intended by Microsoft to be used for manipulating certification authority (CA)\n[data and components. CertUtil.exe is popular as a LoLBin (living off the land binaries)](https://lolbas-project.github.io/lolbas/Binaries/Certutil/)\nand is often used by attackers. The name change is probably used as an attempt to\nevade detection rules for the process. In addition a random number is echoed to the\nend of “cert.exe”, probably to change the hash of the file.\n\n\n-----\n\nCert.exe (renamed CertUtil.exe) is used to decode the previously dropped agent.crt file to\n“agent.exe”, which is then executed:\n\n_Renaming CertUtil.exe and execution of dropper_\n\n## The Ransomware Dropper (agent.exe)\n\nThe ransomware dropper (agent.exe) is signed with the certificate “PB03 TRANSPORT\nLTD.” The Certificate appears to have only been used by REvil malware that was deployed\nduring this attack:\n\n_The certificate used to sign REvil ransomware_\n\n[To add a layer of stealth, the attackers used a technique called DLL Side-Loading. Agent.exe](https://attack.mitre.org/techniques/T1574/002/)\ndrops an outdated version that is vulnerable to DLL Side-Loading of “msmpeng.exe” - the\n[Windows Defender executable.](https://en.wikipedia.org/wiki/Microsoft_Defender)\n\nThe dropper then writes the ransomware payload to disk as the model “mpsvc.dll” to make\n“msmpeng.exe” load and execute it:\n\n\n-----\n\n_Extraction and execution of the payload in ida_\n\n## The Ransomware Payload (mpsvc.dll)\n\nSimilar to the agent.exe dropper binary, the ransomware payload DLL is also signed with the\nsame certificate. Analysis of the DLL binary showed that it is the REVIL ransomware. Once\nthe execution is passed to the module, it executes the command “netsh advfirewall firewall\nset rule group=”Network Discovery” new enable=Yes”, which changes the firewall settings to\nallow local windows systems to be discovered. Then, it starts to encrypt the files on the\nsystem, eventually dropping the following ransom note:\n\n_REvil ransom note_\n\n\n-----\n\n## CYBEREASON DETECTION AND PREVENTION\n\nRansomware attacks are on the rise. A recently released report by Cybereason, titled\n_[Ransomware: The True Cost to Business, detailed how malicious actors are fine-tuning their](https://www.cybereason.com/ebook-ransomware-the-true-cost-to-business)_\nransomware campaign tactics, and how both the frequency and severity of successful\nransomware attacks have tremendous impact on victim organizations and their ability to\nconduct business.\n\nThe full REvil attack involving Kesaya is presented in the Cybereason Defense Platform\n[process tree as an automatically generated Malop™ for a complete view of the attack](https://www.cybereason.com/platform#malop)\nnarrative:\n\n_Full attack tree as shown in the Cybereason Defense Platform_\n\nThe Cybereason Defense Platform delivers multi-layer protection that is proven to detect and\nblock REvil ransomware since it emerged in 2019, and continues to allow defenders to\nprotect their organizations from this evolving threat:\n\n\n-----\n\n_Cybereason AI-based NGAV and Anti-Ransomware detects and prevents REvil ransomware_\n\n## SECURITY RECOMMENDATIONS\n\n[Kaseya released a VSA Detection Tool which analyzes the system in order to detect if](https://kaseya.app.box.com/s/0ysvgss7w48nxh8k1xt7fqhbcjxhas40)\nany related IOCs are present\n[Enable the Anti-Ransomware feature on Cybereason NGAV and set protection mode to](https://www.cybereason.com/platform/anti-ransomware)\n_Prevent -_ [more information for customers can be found here](https://nest.cybereason.com/documentation/product-documentation/190/anti-ransomware-settings#set-protection-mode)\nEnable Anti-Malware feature on Cybereason NGAV, set to Prevent and set the\ndetection mode to Moderate and Above - more information for customers can be found\nhere\nKeep Systems Fully Patched: Make sure your systems are patched in order to mitigate\nvulnerabilities\nRegularly Backup Files to a Remote Server: Restoring your files from a backup is the\nfastest way to regain access to your data\nUse Security Solutions: Protect your environment using organizational firewalls,\nproxies, web filtering, and mail filtering\n\n## Ransomware Prevention Capabilities are Key\n\nThe best ransomware defense for organizations is to focus on preventing a ransomware\ninfection in the first place. Organizations need visibility into the more subtle Indicators of\nBehavior (IOBs) that allow detection and prevention of a ransomware attack at the earliest\nstages.\n\n[Cybereason delivers industry leading ransomware protection via multi-layered prevention,](https://www.cybereason.com/prevent-ransomware)\ndetection and response, including:\n\n**[Anti Ransomware Prevention and Deception: Cybereason uses a combination of](https://www.cybereason.com/platform/anti-ransomware)**\nbehavioral detections and proprietary deception techniques surface the most complex\nransomware threats and end the attack before any critical data can be encrypted.\n**Intelligence-Based Antivirus: Cybereason blocks known ransomware variants**\nleveraging an ever-growing pool of threat intelligence based on previously detected\nattacks.\n**[NGAV: Cybereason NGAV is powered by machine learning and recognizes malicious](https://www.cybereason.com/platform/endpoint-prevention)**\ncomponents in code to block unknown ransomware variants prior to execution.\n**Fileless Ransomware Protection: Cybereason disrupts attacks utilizing fileless and**\nMBR-based ransomware that traditional antivirus tools miss.\n**[Endpoint Controls: Cybereason hardens endpoints against attacks by managing](https://www.cybereason.com/platform/endpoint-controls)**\nsecurity policies, maintaining device controls, implementing personal firewalls and\nenforcing whole-disk encryption across a range of device types, both fixed and mobile.\n\n\n-----\n\n**Behavioral Document Protection: Cybereason detects and blocks ransomware**\nhidden in the most common business document formats, including those that leverage\nmalicious macros and other stealthy attack vectors.\n\nCybereason is dedicated to teaming with defenders to end cyber attacks from endpoints to\nthe enterprise to everywhere - including modern ransomware. Learn more about\nransomware defense here or [schedule a demo today to learn how your organization can](https://www.cybereason.com/request-a-demo)\n[benefit from an operation-centric approach to security.](https://www.cybereason.com/blog/the-cybereason-malop-achieving-operation-centric-security)\n\n## Indicators of Compromise\n\n**Ransomware Dropper**\n\nSHA256\n\n41581b41c599d1c5d1f9f1d6923a5e1e1ee47081adfc6d4bd24d8a831554ca8e\n\nD55f983c994caa160ec63a59f6b4250fe67fb3e8c43a388aec60a4a6978e9f1e\n\nSHA1\n\n49a5a9e2c000add75ff74374311247d820baa1a8\n\n5162f14d75e96edb914d1756349d6e11583db0b0\n\n**Ransomware Payload**\n\nSHA256\n\n8dd620d9aeb35960bb766458c8890ede987c33d239cf730f93fe49d90ae759dd\n\ne2a24ab94f865caeacdf2c3ad015f31f23008ac6db8312c2cbfb32e4a5466ea2\n\nSHA1\n\n656c4d285ea518d90c1b669b79af475db31e30b1\n\ne1d689bf92ff338752b8ae5a2e8d75586ad2b67b\n\n\n-----\n\nAbout the Author\n\n**Tom Fakterman**\n\nTom Fakterman, Cyber Security Analyst with the Cybereason Nocturnus Research Team,\nspecializes in protecting critical networks and incident response. Tom has experience in\nresearching malware, computer forensics and developing scripts and tools for automated\ncyber investigations.\n\n[All Posts by Tom Fakterman](https://www.cybereason.com/blog/authors/tom-fakterman)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-07-06 - Cybereason vs. REvil Ransomware- The Kaseya Chronicles.pdf"
    ],
    "report_names": [
        "2021-07-06 - Cybereason vs. REvil Ransomware- The Kaseya Chronicles.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536061,
    "ts_updated_at": 1743041158,
    "ts_creation_date": 1653697940,
    "ts_modification_date": 1653697940,
    "files": {
        "pdf": "https://archive.orkl.eu/612974f561833c0c63f5c4970b0c192145bf9f49.pdf",
        "text": "https://archive.orkl.eu/612974f561833c0c63f5c4970b0c192145bf9f49.txt",
        "img": "https://archive.orkl.eu/612974f561833c0c63f5c4970b0c192145bf9f49.jpg"
    }
}