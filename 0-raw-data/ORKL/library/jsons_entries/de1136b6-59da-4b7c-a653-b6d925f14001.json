{
    "id": "de1136b6-59da-4b7c-a653-b6d925f14001",
    "created_at": "2023-01-12T15:08:42.248104Z",
    "updated_at": "2025-03-27T02:05:35.026065Z",
    "deleted_at": null,
    "sha1_hash": "170bdedc31964c2b7dc1f4c5fa1a181bd724934e",
    "title": "2022-03-31 - eSentire Threat Intelligence Malware Analysis- CaddyWiper",
    "authors": "",
    "file_creation_date": "2022-05-29T00:53:29Z",
    "file_modification_date": "2022-05-29T00:53:29Z",
    "file_size": 2888834,
    "plain_text": "# eSentire Threat Intelligence Malware Analysis: CaddyWiper\n\n**[esentire.com/blog/esentire-threat-intelligence-malware-analysis-caddywiper](https://www.esentire.com/blog/esentire-threat-intelligence-malware-analysis-caddywiper)**\n\nFirst discovered by ESET researchers in March 2022, CaddyWiper malware is a new type of\nwiper malware used by Russian threat actors to target Ukrainian organizations, and the\nfourth wiper identified since the invasion of the Ukraine. Unlike ransomware, the only\nobjective of using wiper malware is to damage files, data, hard drives, or entire programs\nand cause as much destruction as possible in the targeted organization’s endpoints and\nnetwork.\n\neSentire’s Threat Intelligence (TI) team assesses with high confidence that as the hybrid war\nbetween Russia and Ukraine continues, threat actors will continue developing more\ndestructive malware with the goal to disrupt the operations in Ukrainian infrastructure since\nthe wiping malware does not need to be sophisticated to perform the basic wiping\ncapabilities.\n\n## Key Takeaways\n\neSentire TI assesses that CaddyWiper has a low level of sophistication compared to\nthe other wipers observed targeting Ukrainian organizations (HermeticWiper).\n\n\n-----\n\nCaddyWiper specifically doesn t target Domain Controllers to keep the foothold on the\nvictim’s network to be able to obtain credentials, move laterally and infect more\nmachines.\neSentire TI assesses that it’s probable that this is done to keep the foothold on the\nDomain Controller and gain access to other machines on the network.\neSentire’s Threat Response Unit (TRU) is currently implementing the detections\ndeveloped to identify CaddyWiper malware activities across MDR for Endpoint,\nperforming global threat hunts against the IOCs associated with the CaddyWiper\nmalware, and actively monitoring for any signs of compromise.\n\n## Case Study\n\n[The destructive malware named CaddyWiper was first reported by ESET Researchers on](https://twitter.com/ESETresearch/status/1503436420886712321?s=20&t=9fWLU5NluwqmWqf8d0zD8g)\nMarch 14, 2022. The malware was first detected at 11:38 a.m. local time (5:38 a.m. EST)\ntargeting organizations in Ukraine. According to ESET, the infection mechanism is similar to\nthe HermeticWiper malware in that it operates via Default Domain Policy.\n\n_Exhibit 1:_\n\n_First CaddyWiper detection by ESET_\n\n\n-----\n\n## Technical Analysis on CaddyWiper\n\neSentire TI has observed 4 CaddyWiper samples targeting Ukrainian organizations in the\nwild including a UPX packed version. CaddyWiper is the fourth wiper observed targeting\nUkrainian organizations since January 2022.\n\nCaddyWiper is a PE32 (32-bit) executable written in C++ programming language with a file\nsize of 9.00 KB (9,216 bytes). The compilation timestamp for all the wiper samples dates to\nMarch 14, 2022 (on the same day when the first attacks were observed).\n\nThe malware samples do not appear to be digitally signed except for one sample (SHA-256:\n1e87e9b5ee7597bdce796490f3ee09211df48ba1d11f6e2f5b255f05cc0ba176). The file is\nsigned by TrustAsia (Exhibit 2).\n\n\n-----\n\n_Exhibit 2: Digital Signature details_\n\n\n-----\n\nThe wiper uses stackstrings, which is the technique used by malware developers to\n“conceal” the strings from an analyst (Exhibit 3).\n\n_Exhibit 3: Stackstrings used in CaddyWiper_\n\nThe wiper checks if the infected machine is a Domain Controller via the\n**[DsRoleGetPrimaryDomainInformation API. The API gets state data for the computer,](https://docs.microsoft.com/en-us/windows/win32/api/dsrole/nf-dsrole-dsrolegetprimarydomaininformation)**\nwhich includes the state of the directory service installation and domain data. If the infected\nmachine is not a Domain Controller, the malware recursively wipes the files in C:\\Users and\n_D:\\ directories. Additionally, CaddyWiper attempts to wipe the files in the driver letters_\nalphabetically starting from D:\\ drive until it reaches Z:\\ drive (Exhibit 4).\n\nWhile running the sample on the sandbox machine, the malware did not wipe all the files\ncompletely in the mentioned folders, except for shortcut files. The sample also skips wiping\nthe files under C:\\ drive.\n\n\n-----\n\n_Exhibit 4: CaddyWiper wipes the drives from D to Z letters_\n\nIf the infected machine is the Domain Controller, the wiper will exit (Exhibit 5).\n\n\n-----\n\n_Exhibit 5: The malware doesn't proceed with executing the wiping instructions on a Domain_\n_Controller_\n\nThe jump to the function responsible for wiping the files is not taken. Instead, it will exit via\nthe RtlExitUserThread command (Exhibit 6).\n\n_The jump to the function responsible for wiping the files is not taken. Instead, it will exit via_\n_the RtlExitUserThread command (Exhibit 6)._\n\nThe wiper enumerates through the files, takes ownership of the files overrides File\n[Permissions with SeTakeOwnershipPrivilege and](https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4672) **[AdjustTokenPrivileges APIs and](https://docs.microsoft.com/en-us/windows/win32/api/securitybaseapi/nf-securitybaseapi-adjusttokenprivileges)**\noverwrites 10485760 bytes of data with zeroes (Exhibit 7).\n\n\n-----\n\n_Exhibit 7: The wiper is overwriting 10485760 bytes of data with 0's_\n\n[After the malware finishes overwriting the files, it uses the DeviceIoControl API with the](https://docs.microsoft.com/en-us/windows/win32/api/ioapiset/nf-ioapiset-deviceiocontrol)\n[control code IOCTL_DISK_SET_DRIVE_LAYOUT_EX to access the extended information](https://docs.microsoft.com/en-us/windows/win32/api/winioctl/ni-winioctl-ioctl_disk_set_drive_layout_ex)\nabout the drive's partitions (decrements from Physical Drive 9 to Physical Drive 0).\nSpecifically, it accesses the data on the Master Boot Record (MBR) and GUID Partition Table\n(GPT) partitions of the hard drives to proceed with the wiping process.\n\n_Exhibit 8: Decrementing loop (the wiper decrements the drives from 9 to 0)_\n\nWe assess that the wiper sample does not have any similarities with the previous wipers\n(WhisperGate, HermeticWiper, IsaacWiper) that were used to target Ukrainian organizations.\nThe only distinctive characteristic of CaddyWiper is that it does not target Domain\n\n\n-----\n\nControllers. We believe it s probable that this is done to keep the foothold on the Domain\nController to gain access to other machines on the network and that CaddyWiper was\ndeveloped within one month or less.\n\n## What eSentire is doing about it\n\nOur Threat Response Unit (TRU) combines threat intelligence gleaned from research,\nsecurity incidents, and the external threat landscape to create actionable outcomes for our\ncustomers. We are taking a holistic response approach to combat all malware by deploying\ncountermeasures, such as:\n\nImplementing the detections to identify CaddyWiper malware activities across eSentire\nMDR for Endpoint solutions.\nPerforming global threat hunts against the IOCs associated with the CaddyWiper\nmalware\nActively monitoring for any signs of compromise.\n\nOur detection content is backed by investigation runbooks, ensuring our SOC cyber analysts\nrespond rapidly to any intrusion attempts. In addition, our Threat Response Unit closely\nmonitors the threat landscape and addresses capability gaps and conducts retroactive threat\nhunts to assess customer impact.\n\n## Recommendations from eSentire’s Threat Response Unit (TRU)\n\nWe recommend implementing the following controls to help secure your organization against\nthe CaddyWiper malware:\n\nAddress security issues in Active Directory: thoroughly reviewing and securing\nSYSVOL permissions, patching any known vulnerabilities, implementing LeastPrivilege Administrative Models.\nIf working with organizations based in Ukraine, perform access control review on the\ntraffic.\nConfirm that all the devices are protected with Endpoint Detection and Response\n(EDR) solutions.\n\nWhile the Tactics, Techniques, and Procedures (TTPs) used by adversaries grow in\nsophistication, they lead to a limited set of choke points at which critical business decisions\nmust be made. Intercepting the various attack paths utilized by the modern threat actor\nrequires actively monitoring the threat landscape, developing, and deploying endpoint\ndetection, and the ability to investigate logs & network data during active intrusions.\n\neSentire’s Threat Response Unit (TRU) is a world-class team of threat researchers who\ndevelop new detections enriched by original threat intelligence and leverage new machine\nlearning models that correlate multi-signal data and automate rapid response to advanced\n\n\n-----\n\nthreats.\n\nIf you’re not currently engaged with an MDR provider, eSentire MDR can help you reclaim\nthe advantage and put your business ahead of disruption.\n\nLearn what it means to have an elite team of Threat Hunters and Researchers that works for\nyou. [Connect with an eSentire Security Specialist.](https://www.esentire.com/get-started)\n\n## Appendix\n\n### Sources\n\n Indicators of Compromise\n\n**Name** **File Hash (SHA-256)**\n\nCaddyWiper ea6a416b320f32261da8dafcf2faf088924f99a3a84f7b43b964637ea87aef72\n\nCaddyWiper a294620543334a721a2ae8eaaf9680a0786f4b9a216d75b55cfd28f39e9430ea\n\nCaddyWiper 1e87e9b5ee7597bdce796490f3ee09211df48ba1d11f6e2f5b255f05cc0ba176\n\nCaddyWiper f1e8844dbfc812d39f369e7670545a29efef6764d673038b1c3edd11561d6902\n(UPX\npacked)\n\n### Yara Rules\n```\nimport \"pe\"\nimport \"hash\"\nimport \"math\"\nrule CaddyWiper_1: detection\nCaddyWiper_a294620543334a721a2ae8eaaf9680a0786f4b9a216d75b55cfd28f39e9430ea\n{\ncondition:\n  for any i in (0..pe.number_of_sections - 1): (\n    hash.md5(pe.sections[i].raw_data_offset,\n    pe.sections[i].raw_data_size) == \n    \"f0d4c11521fc3891965534e6c52e128b\" and\n    pe.sections[i].name == \".text\") and\n  for any i in (0..pe.number_of_sections - 1): (\n    math.entropy(pe.sections[i].raw_data_offset, pe.sections[i].raw_data_size) >=\n5 and\n    pe.sections[i].name == \".text\") and\n  pe.imports(\"netapi32.dll\", \"DsRoleGetPrimaryDomainInformation\") and\n  uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550 and\n  filesize < 11KB\n}\n\n```\n|Name|File Hash (SHA-256)|\n|---|---|\n|CaddyWiper|ea6a416b320f32261da8dafcf2faf088924f99a3a84f7b43b964637ea87aef72|\n|CaddyWiper|a294620543334a721a2ae8eaaf9680a0786f4b9a216d75b55cfd28f39e9430ea|\n|CaddyWiper|1e87e9b5ee7597bdce796490f3ee09211df48ba1d11f6e2f5b255f05cc0ba176|\n|CaddyWiper (UPX packed)|f1e8844dbfc812d39f369e7670545a29efef6764d673038b1c3edd11561d6902|\n\n\n-----\n\n```\nrule CaddyWiper: detection CaddyWiper_2\n{\nmeta:\n  hash = \"f1e8844dbfc812d39f369e7670545a29efef6764d673038b1c3edd11561d6902\"\nstrings:\n  $packer = \"UPX0\" ascii nocase\n  $packer1 = \"UPX1\" ascii nocase\n  $packer2 = \"UPX2\" ascii nocase\n  $function = \"DsRoleGetPrimaryDomainInformation\" ascii nocase\ncondition:\n  uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550 \n  and (3 of ($packer*) and $function) \n  and filesize < 26KB\n}\n\n### Skip To:\n\n```\nKey Takeaways\nCase Study\nTechnical Analysis on CaddyWiper\nWhat eSentire is doing about it\nRecommendations from eSentire’s Threat Response Unit (TRU)\nAppendix\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-03-31 - eSentire Threat Intelligence Malware Analysis- CaddyWiper.pdf"
    ],
    "report_names": [
        "2022-03-31 - eSentire Threat Intelligence Malware Analysis- CaddyWiper.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536122,
    "ts_updated_at": 1743041135,
    "ts_creation_date": 1653785609,
    "ts_modification_date": 1653785609,
    "files": {
        "pdf": "https://archive.orkl.eu/170bdedc31964c2b7dc1f4c5fa1a181bd724934e.pdf",
        "text": "https://archive.orkl.eu/170bdedc31964c2b7dc1f4c5fa1a181bd724934e.txt",
        "img": "https://archive.orkl.eu/170bdedc31964c2b7dc1f4c5fa1a181bd724934e.jpg"
    }
}