{
    "id": "3f55fc39-fcd4-441f-9c04-c0545c11840f",
    "created_at": "2023-01-12T15:07:40.710666Z",
    "updated_at": "2025-03-27T02:17:05.593487Z",
    "deleted_at": null,
    "sha1_hash": "9cbb819e481cf18685ec02092228f16dd5aad1a6",
    "title": "2022-05-03 - A new BluStealer Loader Uses Direct Syscalls to Evade EDRs",
    "authors": "",
    "file_creation_date": "2022-05-29T10:38:16Z",
    "file_modification_date": "2022-05-29T10:38:16Z",
    "file_size": 781985,
    "plain_text": "# A new BluStealer Loader Uses Direct Syscalls to Evade EDRs\n\n**[blog.minerva-labs.com/a-new-blustealer-loader-uses-direct-syscalls-to-evade-edrs](https://blog.minerva-labs.com/a-new-blustealer-loader-uses-direct-syscalls-to-evade-edrs)**\n\n[Tweet](https://twitter.com/share)\n\n\n-----\n\n[BluStealer malware was first detected in May 2021 by James_inthe_box. Back then, it was](https://twitter.com/James_inthe_box/status/1395824249605025792)\ndelivered through a phishing mail, either as an attachment or a Discord link leading to the\n[malware download URL. According to Avast 2021 analysis, it “consists of a core written in](https://decoded.avast.io/anhho/blustealer/)\nVisual Basic and the C# .NET inner payload(s). The VB core reuses a large amount of code\n[from a 2004 SpyEx project. Its capabilities to steal crypto wallet data, swap crypto addresses](http://www.a1vbcode.com/app-2530.asp)\npresent in the clipboard, find and upload document files, exfiltrate data through SMTP and\nthe Telegram Bot API, as well as anti-analysis/anti-VM tactics”\n\nBluStealer authors are not staying behind, and in their latest version, they implement what\nwas one of 2021’s biggest trends - the use of direct syscalls to bypass EDRs.\n\nThe latest version seems to have a pdf icon inserted to it, which would indicate that the\ndelivery is via email, with the intention of tricking the user into executing the .exe loader while\n\nthinking it's a pdf.\n\n_Figure 1 - First Stage Icon_\n\nThe first stage loader is created with NSIS (Nullsoft Scriptable Install System), a professional\nopen-source system used to create Windows installers, which drops three files to the user’s\ntemp folder:\n\n1. rwzhmby.exe - second stage loader file\n\n1. mhxbnyunxz – third stage loader file\n\n1. 3amz20m5vs – BluStealer malware\n\nIt then executes the rwzhmby.exe with\nC:\\Users\\username\\AppData\\Local\\Temp\\mhxbnyunxz.\n\n_Figure 2 – Second Stage execution Command Line_\n\nThe second stage loader reads the mhxbnyunxz and then allocates new memory, decrypts\nevery byte read from mhxbnyunxz and continues to the decrypted code.\n\n\n-----\n\n_Figure 3 - Read and Allocate Memory for Third Stage_\n\nThe decrypted code (third stage) from mhxbnyunxz is the most interesting part. It is the main\nBluStealer loader and is responsible for gaining persistency, creating the necessary\nenvironment, and finally executing the malware itself.\n\nBluStealer Environment:\n\nThe loader checks if the C:\\Users\\username\\AppData\\Roaming\\rmfyvviyify folder exists. If it\ndoesn’t, it creates it and then creates a copy of the second stage rwzhmby.exe file to the\nfolder under the name juvhkpig.exe.\n\n_Figure 4 - Copied file to newly created folder_\n\nPersistency:\n\nAfter creating a folder and copying rwzhmby.exe to it, the loader creates a new\nHKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\wnyutmbcgovbty registry key,\nwhich will run the malware every time the user logs on.\n\n\n-----\n\n_Figure 5 – Registry Persistency_\n\nMain Payload Execution:\n\nThe main payload seems to arrive in the 3amz20m5vs file. The loader first reads the file into\nallocated memory and then decrypts it. The only thing left is then to execute it. The malware\nuses a Process Hallowing Technique with a twist to execute the main payload a malware .\nSome of the API calls used for Process Hollowing were switched to direct syscalls.\n\n_Figure 6 - Direct Syscall Function_\n\nThe List of Standard API calls used in the Process Hollowing technique:\n\n1. CreateProcessA – the loader runs ---first file ---- in suspended mode.\n2. NtQueryInformationProcess\n3. ReadProcessMemory\n4. NtUnmapViewOfSection – called by direct syscall (0x002a)\n5. VirtualAllocEx\n6. WriteProcessMemory - called by direct syscall (0x003a)\n7. GetThreadContext\n8. SetThreadContext\n9. ResumeThread - - called by direct syscall (0x0052)\n\nImplementing an evasion technique like Process Hollowing while partly changing API calls to\ndirect syscall is likely to confuse and bypass security products that rely on a specific set of\nAPI calls for detection.\n\nThe injected file is the final stage. Its original file name is firebed.exe and it is BluStealer\nitself. It seems to have been compiled on Apr 7th 2022, which might indicate that the author\nis constantly working on the stealer’s capabilities. As a first step it creates a\n\n\n-----\n\nC:\\Users\\Public\\3046414246424646303030333036463242464246463030303330 folder\nwhich will contain the stolen data before the exfiltration. The injected file, firebed.exe, is also\ncopied to this folder under the name misguise.exe.\n\nPersistence capabilities have been changed since the previous version was released in\nSeptember 2021. Our sample creates a\nHKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\boos registry key which\nexecutes\nC:\\Users\\Public\\3046414246424646303030333036463242464246463030303330\\misguise.exe\n\nThe new version of BluStealer is able to steal credentials from the following browsers:\n\nIridium\n7Star\nCent Browser\nChedot\nVivaldi\n\nKometa\nElements Browser\nEpic Privacy Browser\nSleipnir5\nCitrio\n\nCoowon\nliebao\nQIP Surf\nOrbitum\nAmigo\n\nTorch\nYandex Browser\nComodo Dragon\n360Browser\nMaxthon3\n\nK-Melon\nSputnik\nNichrome\nCocCoc\nUran\n\nChromodo\nAtom\nBrave Browser\n\n\n-----\n\nMicrosoft Edge\nChromium\n\nGoogle Chrome\nOpera\nMozilla Firefox\n\nMany people store different credentials in their browsers so stealing this type of data might\nendanger both private and corporate users.\n\nIt also steals doc files (.txt, .xls, .xlsx,.doc, .docx, .pdf, .utc, .rtf) and personal data from email\napplications such as “MailMaster” and “ThunderBird” .\n\nZcash crypto wallet was added to last year's list and the current list of wallet keys that can\nbe stolen is:\n\n1. Zcash\n2. Armory\n3. Bytecoin\n4. Jaxx Liberty\n5. Exodus\n6. Electrum\n7. Atomic\n8. Guarda\n9. Coinomi\n\nThe last step is exfiltrating the collected data through SMTP.\n\nIt is worth mentioning, that Loader implementing such evasive injection technique can allow it\nto will bypass most security products, Including AVs &EDRs. By changing the main payload\nfile, the loader can potentially one might execute different types of malwares, including\nransomware.\n\n\n-----\n\n_Figure 7 - BluStealer Execution Flow_\n\nMinerva Labs prevents the main payload from being executed by preventing the use of direct\nsyscalls execution:\n\n_Figure 8 - Minerva Labs Prevention_\n\nIOC’s\n\n\n-----\n\n1. 790F4DA318B3A9592F4B35B73528DE2C - rwzhmby.exe\n\n1. 122C0AA6F0362E3F6F11FF83E3A608C4 - mhxbnyunxz\n\n1. 43E7B7F7D9E59C3256CF7E5CE114FC53 - 3amz20m5vs\n\n1. 953B2013A8B0D4BE5368A65FC74C93F4 - firebed.exe/ misguise.exe\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-05-03 - A new BluStealer Loader Uses Direct Syscalls to Evade EDRs.pdf"
    ],
    "report_names": [
        "2022-05-03 - A new BluStealer Loader Uses Direct Syscalls to Evade EDRs.pdf"
    ],
    "threat_actors": [
        {
            "id": "75455540-2f6e-467c-9225-8fe670e50c47",
            "created_at": "2022-10-25T16:07:23.740266Z",
            "updated_at": "2025-03-27T02:02:09.955585Z",
            "deleted_at": null,
            "main_name": "Iridium",
            "aliases": [],
            "source_name": "ETDA:Iridium",
            "tools": [
                "CHINACHOPPER",
                "China Chopper",
                "LazyCat",
                "Powerkatz",
                "SinoChopper",
                "reGeorg"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "0661a292-80f3-420b-9951-a50e03c831c0",
            "created_at": "2023-01-06T13:46:38.928796Z",
            "updated_at": "2025-03-27T02:00:02.953963Z",
            "deleted_at": null,
            "main_name": "IRIDIUM",
            "aliases": [],
            "source_name": "MISPGALAXY:IRIDIUM",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "9f101d9c-05ea-48b9-b6f1-168cd6d06d12",
            "created_at": "2023-01-06T13:46:39.396409Z",
            "updated_at": "2025-03-27T02:00:03.074969Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "CHROMIUM",
                "ControlX",
                "Red Dev 10",
                "RedHotel",
                "Red Scylla",
                "TAG-22",
                "BRONZE UNIVERSITY",
                "AQUATIC PANDA",
                "Charcoal Typhoon",
                "BountyGlad"
            ],
            "source_name": "MISPGALAXY:Earth Lusca",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "a66438a8-ebf6-4397-9ad5-ed07f93330aa",
            "created_at": "2022-10-25T16:47:55.919702Z",
            "updated_at": "2025-03-27T02:05:17.412024Z",
            "deleted_at": null,
            "main_name": "IRON VIKING",
            "aliases": [
                "ATK14 ",
                "BlackEnergy Group",
                "Blue Echidna ",
                "CTG-7263 ",
                "ELECTRUM ",
                "FROZENBARENTS ",
                "Hades/OlympicDestroyer ",
                "IRIDIUM ",
                "Qudedagh ",
                "Sandworm Team ",
                "Seashell Blizzard ",
                "TEMP.Noble ",
                "Telebots ",
                "Voodoo Bear ",
                "APT44 "
            ],
            "source_name": "Secureworks:IRON VIKING",
            "tools": [
                " BlackEnergy",
                " GCat",
                " GreyEnergy",
                " Industroyer",
                " KillDisk",
                " NotPetya",
                " PSCrypt",
                " TeleBot",
                " TeleDoor",
                " xData",
                "BadRabbit"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "b3e954e8-8bbb-46f3-84de-d6f12dc7e1a6",
            "created_at": "2022-10-25T15:50:23.339976Z",
            "updated_at": "2025-03-27T02:00:55.446795Z",
            "deleted_at": null,
            "main_name": "Sandworm Team",
            "aliases": [
                "Sandworm Team",
                "ELECTRUM",
                "Telebots",
                "IRON VIKING",
                "BlackEnergy (Group)",
                "Quedagh",
                "Voodoo Bear",
                "IRIDIUM",
                "Seashell Blizzard",
                "FROZENBARENTS",
                "APT44"
            ],
            "source_name": "MITRE:Sandworm Team",
            "tools": [
                "Bad Rabbit",
                "Mimikatz",
                "Exaramel for Linux",
                "Exaramel for Windows",
                "GreyEnergy",
                "PsExec",
                "Prestige",
                "P.A.S. Webshell",
                "VPNFilter",
                "Cyclops Blink",
                "SDelete",
                "AcidRain",
                "Industroyer",
                "Industroyer2",
                "BlackEnergy",
                "Cobalt Strike",
                "NotPetya",
                "KillDisk",
                "PoshC2",
                "Impacket",
                "Invoke-PSImage",
                "Olympic Destroyer"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "3a0be4ff-9074-4efd-98e4-47c6a62b14ad",
            "created_at": "2022-10-25T16:07:23.590051Z",
            "updated_at": "2025-03-27T02:02:09.878211Z",
            "deleted_at": null,
            "main_name": "Energetic Bear",
            "aliases": [
                "ATK 6",
                "Blue Kraken",
                "Crouching Yeti",
                "Dragonfly",
                "Electrum",
                "Energetic Bear",
                "Ghost Blizzard",
                "Group 24",
                "ITG15",
                "Iron Liberty",
                "Koala Team",
                "TG-4192"
            ],
            "source_name": "ETDA:Energetic Bear",
            "tools": [
                "Backdoor.Oldrea",
                "CRASHOVERRIDE",
                "Commix",
                "CrackMapExec",
                "CrashOverride",
                "Dirsearch",
                "Dorshel",
                "Fertger",
                "Fuerboos",
                "Goodor",
                "Havex",
                "Havex RAT",
                "Hello EK",
                "Heriplor",
                "Impacket",
                "Industroyer",
                "Karagany",
                "Karagny",
                "LightsOut 2.0",
                "LightsOut EK",
                "Listrix",
                "Oldrea",
                "PEACEPIPE",
                "PHPMailer",
                "PsExec",
                "SMBTrap",
                "Subbrute",
                "Sublist3r",
                "Sysmain",
                "Trojan.Karagany",
                "WSO",
                "Webshell by Orb",
                "Win32/Industroyer",
                "Wpscan",
                "nmap",
                "sqlmap",
                "xFrost"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "6abcc917-035c-4e9b-a53f-eaee636749c3",
            "created_at": "2022-10-25T16:07:23.565337Z",
            "updated_at": "2025-03-27T02:02:09.868522Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Bronze University",
                "Charcoal Typhoon",
                "Chromium",
                "Red Dev 10",
                "Red Scylla"
            ],
            "source_name": "ETDA:Earth Lusca",
            "tools": [
                "Agentemis",
                "AntSword",
                "BIOPASS",
                "BIOPASS RAT",
                "BadPotato",
                "Behinder",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "Doraemon",
                "FRP",
                "Fast Reverse Proxy",
                "FunnySwitch",
                "HUC Port Banner Scanner",
                "KTLVdoor",
                "Mimikatz",
                "NBTscan",
                "POISONPLUG.SHADOW",
                "PipeMon",
                "RbDoor",
                "RibDoor",
                "RouterGod",
                "SAMRID",
                "ShadowPad Winnti",
                "SprySOCKS",
                "WinRAR",
                "Winnti",
                "XShellGhost",
                "cobeacon",
                "fscan",
                "lcx",
                "nbtscan"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "8941e146-3e7f-4b4e-9b66-c2da052ee6df",
            "created_at": "2023-01-06T13:46:38.402513Z",
            "updated_at": "2025-03-27T02:00:02.824555Z",
            "deleted_at": null,
            "main_name": "Sandworm",
            "aliases": [
                "G0034",
                "IRIDIUM",
                "Blue Echidna",
                "FROZENBARENTS",
                "Seashell Blizzard",
                "IRON VIKING",
                "ELECTRUM",
                "TeleBots",
                "UAC-0113",
                "UAC-0082",
                "APT44",
                "Quedagh",
                "VOODOO BEAR",
                "TEMP.Noble"
            ],
            "source_name": "MISPGALAXY:Sandworm",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d53593c3-2819-4af3-bf16-0c39edc64920",
            "created_at": "2022-10-27T08:27:13.212301Z",
            "updated_at": "2025-03-27T02:00:55.529662Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Earth Lusca",
                "TAG-22",
                "Charcoal Typhoon",
                "CHROMIUM",
                "ControlX"
            ],
            "source_name": "MITRE:Earth Lusca",
            "tools": [
                "Mimikatz",
                "PowerSploit",
                "Tasklist",
                "certutil",
                "Cobalt Strike",
                "Winnti for Linux",
                "Nltest",
                "NBTscan",
                "ShadowPad"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "7bd810cb-d674-4763-86eb-2cc182d24ea0",
            "created_at": "2022-10-25T16:07:24.1537Z",
            "updated_at": "2025-03-27T02:02:10.126127Z",
            "deleted_at": null,
            "main_name": "Sandworm Team",
            "aliases": [
                "APT 44",
                "ATK 14",
                "BE2",
                "Blue Echidna",
                "CTG-7263",
                "FROZENBARENTS",
                "IRIDIUM",
                "Iron Viking",
                "Quedagh",
                "Sandworm",
                "Sandworm Team",
                "Seashell Blizzard",
                "TEMP.Noble",
                "UAC-0082",
                "UAC-0113",
                "UAC-0125",
                "UAC-0133",
                "Voodoo Bear"
            ],
            "source_name": "ETDA:Sandworm Team",
            "tools": [
                "AWFULSHRED",
                "ArguePatch",
                "BIASBOAT",
                "Black Energy",
                "BlackEnergy",
                "CaddyWiper",
                "Colibri Loader",
                "Cyclops Blink",
                "CyclopsBlink",
                "DCRat",
                "DarkCrystal RAT",
                "Fobushell",
                "GOSSIPFLOW",
                "Gcat",
                "IcyWell",
                "Industroyer2",
                "JaguarBlade",
                "JuicyPotato",
                "Kapeka",
                "KillDisk.NCX",
                "LOADGRIP",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "ORCSHRED",
                "P.A.S.",
                "PassKillDisk",
                "Pitvotnacci",
                "PsList",
                "QUEUESEED",
                "RansomBoggs",
                "RottenPotato",
                "SOLOSHRED",
                "SwiftSlicer",
                "VPNFilter",
                "Warzone",
                "Warzone RAT",
                "Weevly"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536060,
    "ts_updated_at": 1743041825,
    "ts_creation_date": 1653820696,
    "ts_modification_date": 1653820696,
    "files": {
        "pdf": "https://archive.orkl.eu/9cbb819e481cf18685ec02092228f16dd5aad1a6.pdf",
        "text": "https://archive.orkl.eu/9cbb819e481cf18685ec02092228f16dd5aad1a6.txt",
        "img": "https://archive.orkl.eu/9cbb819e481cf18685ec02092228f16dd5aad1a6.jpg"
    }
}