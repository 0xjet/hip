{
    "id": "857d3fe1-077b-49ee-9aa7-12543c90f317",
    "created_at": "2023-01-12T15:05:12.766901Z",
    "updated_at": "2025-03-27T02:09:38.828322Z",
    "deleted_at": null,
    "sha1_hash": "f21ae1bb0496ec5d3c7d4bbc5aa646c75b3f9cbb",
    "title": "2022-04-25 - Industroyer2 IEC-104 Analysis",
    "authors": "",
    "file_creation_date": "2022-05-28T02:39:25Z",
    "file_modification_date": "2022-05-28T02:39:25Z",
    "file_size": 489270,
    "plain_text": "# Industroyer2 IEC-104 Analysis\n\n**netresec.com/**\n\nErik Hjelmvik\n\n,\n\nMonday, 25 April 2022 10:35:00 (UTC/GMT)\n\n\nApril 25, 2022\n\n\nThe Industroyer2 malware was hardwired to attack a specific set of electric utility substations\nin Ukraine. It seems to have been custom built to open circuit breakers, which would\neffectively cut the power from the substation.\n\nAfter connecting to an RTU in a substation the malware would immediately start changing\nthe outputs at specific addresses without first having to enumerate which IOAs that were\navailable on the targeted device. This custom-built malware seems to know what IOAs to use\nat each station, as well as what type of output each specific IOA controls.\n\n**UPDATE 2022-04-26**\n\nUpon popular demand we've decided to release three PCAP files with IEC-104 traffic from\nour own sandbox execution of the Industroyer2 malware. Please feel free to use these\ncapture files to verify our findings using any tool of your choice. The capture files can be\ndownloaded from here:\n[https://www.netresec.com/files/Industroyer2-Netresec.zip](https://www.netresec.com/files/Industroyer2-Netresec.zip)\n\n[These PCAP files are shared under a CC BY 4.0 license, which allows you to redistribute](https://creativecommons.org/licenses/by/4.0/)\nthem as long as you give appropriate credit.\n\n\n-----\n\n**UPDATE 2022-04-29**\n\n[A PNG image in the original CERT-UA security alert #4435 turned out to actually include the](https://cert.gov.ua/article/39518)\nIOAs targeted by the non-public 108_100.exe Industroyer2 version. The IOAs disclosed in\nCERT-UAs alert have now been included in this blog post as well.\n\n**Backstory**\n\nI was looking at a [public sandbox execution of a presumed Industroyer2 malware sample two](https://www.joesandbox.com/analysis/609861/0/html)\nweeks ago. At first glance the malware sample, which was named “40_115.exe”, didn't do\nmuch. It just printed the text below to the console and then terminated the process.\n\n19:46:06:0106> T281 00006800\n19:46:06:0247> RNM 0015\n19:46:06:0294> 10.82.40.105: 2404: 3\n19:46:06:0294> T65 00006800\n19:46:06:0341> 10.82.40.105 M68B0 SGCNT 44\n19:46:06:0497> RNM 0015\n19:46:06:0544> T113 00006800\n19:46:06:0544> 192.168.122.2: 2404: 2\n19:46:06:0544> 192.168.122.2 M68B0 SGCNT 8\n19:46:06:0591> RNM 0015\n19:46:06:0653> 192.168.121.2: 2404: 1\n19:46:06:0700> 192.168.121.2 M68B0 SGCNT 16\n19:46:21:0747> 192.168.122.2 M6812\n19:46:21:0747> 10.82.40.105 M6812\n19:46:21:0794> 192.168.121.2 M6812\n\nI later noticed that it also sent TCP SYN packets to three different [RFC1918 addresses, but](https://datatracker.ietf.org/doc/html/rfc1918)\nnever received a response.\n\n_Image:_ _[Wireshark showing Industroyer2 trying to reach TCP port 2404](https://www.wireshark.org/)_\n\n[TCP port 2404 is used by the SCADA protocol IEC 60870-5-104, also known as IEC-104,](https://en.wikipedia.org/wiki/IEC_60870-5)\nwhich is primarily used to monitor and control electricity transmission and distribution\nsystems. IEC-104 is also the only Industrial Control System (ICS) protocol implemented in\nIndustroyer2 [according to ESET. The previous version of Industroyer, which was used to cut](https://www.welivesecurity.com/2022/04/12/industroyer2-industroyer-reloaded/)\nthe power in Ukraine in 2016, additionally supported the IEC 61850 and OPC DA protocols\n[according to the CRASHOVERRIDE report from Dragos.](https://www.dragos.com/wp-content/uploads/CrashOverride-01.pdf)\n\n\n-----\n\nIndustroyer2 s IEC-104 client didn t receive any SYN+ACK response in the sandbox\nexecution I was looking at, so I couldn't tell what it was trying to do. I therefore decided to set\nup my own sandbox with a built-in IEC-104 server (also known as a slave, RTU or IED). My\nsandbox execution confirmed that Industroyer2 was indeed trying to communicate with these\nthree IP addresses using IEC-104. I also noticed that it was very specific about which\noutputs (or IOAs) it wanted to access on those servers in order to turn these outputs either\nON or OFF.\n\n**Station Address 1 at 192.168.121.2**\n\nThe Industroyer2 malware spawned three separate threads when started, one thread for\neach IEC-104 server to contact. The malware would communicate with all three servers in\nparallel if all of them were available. However, in order to simplify my analysis I decided to\nonly respond to one of the IPs at a time, starting with IP address 192.168.121.2.\n\nThe thread that connected to IP address 192.168.121.2 toggled all outputs between 1250\nand 1265 to OFF at Station Address 1 (also known as “ASDU address” or “common\naddress”). Judging from the command type used (ID 46 with short pulse duration) these\noutputs likely control circuit breakers, which are used to disconnect the power from an\nelectric utility substation.\n\n\n-----\n\n_[Image: PCAP file with IEC-104 traffic to 192.168.121.2 in NetworkMiner](https://www.netresec.com/?page=NetworkMiner)_\n\n**Station Address 2 at 192.168.122.2**\n\nOn 192.168.122.2 the malware targeted station address 2, where it toggled outputs between\n1101 and 1108 to OFF.\n\n\n-----\n\n_[Image: PCAP file with IEC-104 traffic to 192.168.122.2 in NetworkMiner](https://www.netresec.com/?page=NetworkMiner)_\n\n**Station Address 3 at 10.82.40.105**\n\nThe malware toggled a great deal of outputs on 10.82.40.105, which had station address 3.\nBut in contrast to the other stations, many of these outputs were toggled to the “ON” state\nrather than “OFF”.\n\n\n-----\n\n_[Image: PCAP file with IEC-104 traffic to 10.82.40.105 in NetworkMiner](https://www.netresec.com/?page=NetworkMiner)_\n\nYet, after setting those outputs to “ON” it proceeded with setting outputs to “OFF” for several\nother IOAs on station address 3.\n\n\n-----\n\n_[Image: PCAP file with IEC-104 traffic to 10.82.40.105 in NetworkMiner](https://www.netresec.com/?page=NetworkMiner)_\n\nIn each thread Industroyer2 paused for approximately 3 seconds between each accessed\nIOA. This delay seems to have been hard coded since the malware didn't seem to care\nwhether or not the IEC-104 server responded with an OK message, such as ACT or\nACTTERM, or an error message, like “unknown common address of ASDU”. Each thread\nwould simply proceed with setting an IOA every 3 seconds no matter what the server\nresponded.\n\nThe specific order in which the IOAs were accessed was also very deterministic, the exact\nsame sequence of IOAs was used every time. I verified this behavior by running the malware\nmultiple times as well as by comparing my results to an execution of the same sample on a\n[different sandbox (thanks for the PCAP Joe and](https://twitter.com/jfslowik) [Dan).](https://twitter.com/dan_gunter)\n\n**What Did the Attackers Know?**\n\nThe fact that the malware toggled these specific outputs, rather than just randomly turning\noutputs ON or OFF, indicates that the threat actors had technical knowledge about the\nspecific substation(s) they were attacking. Not only did the attackers know the IP addresses,\nstation addresses and IOAs of each targeted output. They also knew what ASDU Type ID to\n\n\n-----\n\nuse for each respective output. For IOA 1101 to 1404 the Type ID 46 was used (also known\nas \"double command\" or C_DC_NA_1) while for IOAs from 130202 and above it used Type\nID 45 (also known as “single command” or C_SC_NA_1).\n\n[As you can see in the previous screenshots, NetworkMiner nicely parses and presents the](https://www.netresec.com/?page=NetworkMiner)\nIEC-104 commands issued by Industroyer2. But I noticed that the malware also printed all\nsent and received commands to the console when executed. For example, the following\noutput was printed to the console by the Industroyer2 thread communicating with station\naddress 2 on 192.168.122.2:\n\n11:51:56:0163> T65 00006800\n11:51:56:0201> RNM 0003\n11:51:56:0241> 192.168.122.2: 2404: 2\n11:51:56:0267> 192.168.122.2 M68B0 SGCNT 8\n11:51:56:0297> 192.168.122.2 M6813\n\nThe string “192.168.122.2: 2404: 2” above reveals that “2404” is the target port and “2” is the\nstation address. The “SGCNT 8” string additionally tells us that there were 8 outputs to be\ntoggled on that station. The other two stations had SGCNT 16 and 44.\n\nThe malware also printed very detailed information about each sent and received IEC-104\ncommand, such as in the example below where the output at IOA 1104 was successfully\nturned off at station address 2 (here referred to as “ASDU:2”).\n\nMSTR ->> SLV 192.168.122.2:2404\nx68 x0E x02 x00 x08 x00 x2E x01 x06 x00 x02 x00 x50 x04 x00 x05\n\nI |Length:16 bytes | Sent=x1 | Received=x4\nASDU:2 | OA:0 | IOA:1104 |\nCause: (x6) | Telegram type: (x2E)\n\nMSTR <<- SLV 192.168.122.2:2404\nx68 x0E x08 x00 x04 x00 x2E x01 x47 x00 x02 x00 x50 x04 x00 x05\n\nI |Length:16 bytes | Sent=x4 | Received=x2\nASDU:2 | OA:0 | IOA:1104 |\nCause: (x47) | Telegram type: (x2E)\nNote that the Type ID values were also logged to the console by Industroyer2, but it used the\nterm “Telegram type” instead of “Type ID”.\n\n**Static Analysis**\n\nThe following three Unicode strings can be found in the 40_115.exe binary:\n\n\n-----\n\n10.82.40.105 2404 3 0 1 1 PService_PPD.exe 1 D:\\OIK\\DevCounter 0 1 0 0 1 0 0 44\n130202 1 0 1 1 1 160921 1 0 1 1 2 160923 1 0 1 1 3 160924 1 0 1 1 4 160925 1 0 1 1\n5 160927 1 0 1 1 6 160928 1 0 1 1 7 190202 1 0 1 1 8 260202 1 0 1 1 9 260901 1 0 1\n1 10 260902 1 0 1 1 11 260903 1 0 1 1 12 260904 1 0 1 1 13 260905 1 0 1 1 14\n260906 1 0 1 1 15 260907 1 0 1 1 16 260908 1 0 1 1 17 260909 1 0 1 1 18 260910 1 0\n1 1 19 260911 1 0 1 1 20 260912 1 0 1 1 21 260914 1 0 1 1 22 260915 1 0 1 1 23\n260916 1 0 1 1 24 260918 1 0 1 1 25 260920 1 0 1 1 26 290202 1 0 1 1 27 338501 1 0\n1 1 28 1401 0 0 0 1 29 1402 0 0 0 1 30 1403 0 0 0 1 31 1404 0 0 0 1 32 1301 0 0 0 1\n33 1302 0 0 0 1 34 1303 0 0 0 1 35 1304 0 0 0 1 36 1201 0 0 0 1 37 1202 0 0 0 1 38\n1203 0 0 0 1 39 1204 0 0 0 1 40 1101 0 0 0 1 41 1102 0 0 0 1 42 1103 0 0 0 1 43 1104\n0 0 0 1 44\n\n192.168.122.2 2404 2 0 1 1 PService_PPD.exe 1 \"D:\\OIK\\DevCounter\" 0 1 0 0 1 0 0 8\n1104 0 0 0 1 1 1105 0 0 0 1 2 1106 0 0 0 1 3 1107 0 0 0 1 4 1108 0 0 0 1 5 1101 0 0 0 1\n6 1102 0 0 0 1 7 1103 0 0 0 1 8\n\n192.168.121.2 2404 1 0 1 1 PService_PPD.exe 1 \"D:\\OIK\\DevCounter\" 0 1 0 0 1 0 0\n16 1258 0 0 0 1 1 1259 0 0 0 1 2 1260 0 0 0 1 3 1261 0 0 0 1 4 1262 0 0 0 1 5 1265 0\n0 0 1 6 1252 0 0 0 1 7 1253 0 0 0 1 8 1254 0 0 0 1 9 1255 0 0 0 1 10 1256 0 0 0 1 11\n1257 0 0 0 1 12 1263 0 0 0 1 13 1264 0 0 0 1 14 1250 0 0 0 1 15 1251 0 0 0 1 16\n\nAfter having analyzed the IEC-104 traffic from the binary it's obvious that this is the IEC-104\nconfiguration that has been hard-coded into the binary. For example, the substring\n“10.82.40.105 2404 3” in the first Unicode string refers to the IP, port and station number of\nthe first target.\n\nThe “16 1258 [...]” section in the third Unicode string above tells us that there are 16 outputs\nconfigured for station address 1, where the first one to be set is at IOA 1258. Thus, we can\neasily verify that all accessed IOAs on all three stations were hard-coded into the binary.\n\n**Additional Substations Targeted**\n\nThe malware sample I've analyzed has the following properties:\n\nFilename: 40_115.exe\nMD5: 7c05da2e4612fca213430b6c93e76b06\nSHA1: fdeb96bc3d4ab32ef826e7e53f4fe1c72e580379\nSHA256: d69665f56ddef7ad4e71971f06432e59f1510a7194386e5f0e8926aea7b88e00\nCompiled: 2022-03-23 10:07:29 UTC\n\nBut there is an additional Industroyer2 sample called “108_100.exe” (MD5\n[3229e8c4150b5e43f836643ec9428865), which has been mentioned by ESET as well as](https://www.welivesecurity.com/2022/04/12/industroyer2-industroyer-reloaded/)\n[CERT-UA. I haven't been able to access that binary though, so I don't yet know which IP](https://cert.gov.ua/article/39518)\n[addresses it was designed to target. However, a few screenshots [1] [2] [3] published by](https://www.welivesecurity.com/wp-content/uploads/2022/04/Figure-4a-%E2%80%93-Hardcoded-configuration-found-in-Industroyer2-sample-1.png)\nESET reveal that the 108 100 exe malware sample was hard coded to access 8 different\n\n\n-----\n\nstation addresses, 5 of which were on the 10.0.0.0/8 network and 3 on the 192.168.0.0/16\n[net. An image in CERT-UA's alert #4435 from April 12 reveals the targeted IOAs for these 8](https://cert.gov.ua/article/39518)\nstations.\n\nTargets hard-coded in 108_100.exe ordered by station address:\n\nSA#1, 192.x.x.x, 12 IOAs (1101-1104, 1201-1204, 1301-1304)\nSA#2, 10.x.x.x, 12 IOAs (1101-1104, 1201-1204, 1301-1304)\nSA#3, 192.x.x.x, 18 IOAs (1103-1104, 1201-1204, 1301-?, 38601-38607)\nSA#4, 10.x.x.x, 34 IOAs (16501, 16603, 26502, 38507-38513, 38519-38524 and\nmore...)\nSA#5, 192.x.x.x, 10 IOAs (1101-1103, 1201-1204, 1301-1303)\nSA#6, 10.x.x.x, 8 IOAs (1101-1104, 1201-1204)\nSA#7, 10.x.x.x, 8 IOAs (1101-1104, 1201-1204)\nSA#8, 10.x.x.x, 8 IOAs (1101-1104, 1201-1204)\n\nWe can compare those station addresses, IP addresses and IOAs to the ones targeted by\nthe 40_115.exe sample, which was analyzed in this blog post.\n\nSA#1, 192.168.121.2, 16 IOAs (1250-1265)\nSA#2, 192.168.122.2, 8 IOAs (1101-1108)\nSA#3, 10.82.40.105, 44 IOAs (1101-1104, 1201-1204, 1301-1304, 1401-1404, 130202,\n160921-160928, 190202, 260202, 260901-260920, 290202, 338501)\n\nThere doesn't seem to be any overlap across the two sets (except for possibly station\naddress 1 which is on the 192.x.x.x network in both configs but has different IOAs). This\nindicates that the 108_100.exe Industroyer2 version was hard coded to attack a different set\nof targets than the 40_115.exe sample that I've analyzed.\n\n**More ICS blog posts from Netresec**\n\nIf you'd like to find our earlier work in the field of ICS/SCADA security, then check out these\n(slightly older but still very relevant) blog posts:\n\n2011: [Monitor those Control System Networks!](https://netresec.com/?b=1185A14)\n[2012: SCADA Network Forensics with IEC-104](https://netresec.com/?b=1284162)\n[2014: Full Disclosure of Havex Trojans](https://netresec.com/?b=14ABDA4)\n[2014: Observing the Havex RAT](https://netresec.com/?b=14BE342)\n[2015: From 4SICS with ICS PCAP Files](https://netresec.com/?b=15BE77F)\n\nPosted by Erik Hjelmvik on Monday, 25 April 2022 10:35:00 (UTC/GMT)\n\n[Tags: #IEC-104 #60870-5-104 #ICS #ICS #SCADA #PCAP](https://www.netresec.com/?page=Blog&tag=IEC-104)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-04-25 - Industroyer2 IEC-104 Analysis.pdf"
    ],
    "report_names": [
        "2022-04-25 - Industroyer2 IEC-104 Analysis.pdf"
    ],
    "threat_actors": [
        {
            "id": "5cbf6c32-482d-4cd2-9d11-0d9311acdc28",
            "created_at": "2023-01-06T13:46:38.39927Z",
            "updated_at": "2025-03-27T02:00:02.823829Z",
            "deleted_at": null,
            "main_name": "ENERGETIC BEAR",
            "aliases": [
                "DYMALLOY",
                "TG-4192",
                "Crouching Yeti",
                "Group 24",
                "Havex",
                "IRON LIBERTY",
                "Blue Kraken",
                "ALLANITE",
                "Koala Team",
                "G0035",
                "ATK6",
                "ITG15",
                "Ghost Blizzard",
                "BERSERK BEAR"
            ],
            "source_name": "MISPGALAXY:ENERGETIC BEAR",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535912,
    "ts_updated_at": 1743041378,
    "ts_creation_date": 1653705565,
    "ts_modification_date": 1653705565,
    "files": {
        "pdf": "https://archive.orkl.eu/f21ae1bb0496ec5d3c7d4bbc5aa646c75b3f9cbb.pdf",
        "text": "https://archive.orkl.eu/f21ae1bb0496ec5d3c7d4bbc5aa646c75b3f9cbb.txt",
        "img": "https://archive.orkl.eu/f21ae1bb0496ec5d3c7d4bbc5aa646c75b3f9cbb.jpg"
    }
}