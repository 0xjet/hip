{
    "id": "4512004a-fa38-4853-8d4a-116b576e066c",
    "created_at": "2022-10-25T16:48:22.746448Z",
    "updated_at": "2025-03-27T02:06:12.978077Z",
    "deleted_at": null,
    "sha1_hash": "1461452398e57d541209eb6bc29e0743369b373b",
    "title": "Htran And The Advanced Persistent Threat",
    "authors": "Dell Secureworks",
    "file_creation_date": "2013-09-26T00:54:50Z",
    "file_modification_date": "2013-09-26T00:54:50Z",
    "file_size": 160795,
    "plain_text": "**URL:** [http://www.secureworks.com/research/threats/htran/](http://www.secureworks.com/research/threats/htran/)\n**Date: August 3, 2011**\n**Author: Joe Stewart, Director of Malware Research, Dell SecureWorks Counter Threat Unit Research Team**\n\nWhile researching one of the malware families involved in the RSA breach disclosed in March 2011, Dell SecureWorks CTU\nobserved an interesting pattern in the network traffic of a related sample (MD5:53ba6845f57f8e9ef600ef166be3be14). When the\nsample under analysis attempted to connect to the C2 server at my.amazingrm.com (203.92.45.2), the server returned a succinct plain-text error message instead of the expected HTTP-formatted response:\n\n[SERVER]connection to funn\n\nAlthough the message was seemingly truncated, this pattern was enough to correlate the error string to a known (and fairly\nold) program called \"HUC Packet Transmit Tool\", or \"HTran\", for which source code can be readily found on the Internet:\n[http://read.pudn.com/downloads199/sourcecode/windows/935255/htran.cpp__.htm](http://read.pudn.com/downloads199/sourcecode/windows/935255/htran.cpp__.htm)\n\nHTran is a rudimentary connection bouncer, designed to redirect TCP traffic destined for one host to an alternate host. The\nsource code copyright notice indicates that HTran was authored by \"lion\", a well-known Chinese hacker and member of\n[\"HUC\", the Honker Union of China. The purpose of this type of tool is to disguise either the true source or destination of In-](http://en.wikipedia.org/wiki/Honker_Union)\nternet traffic in the course of hacking activity.\n\nHTran contains several debugging messages throughout the source code that are sent to the console or to the connecting\nclient in order to diagnose connection issues. The part of the HTran source code that generated the error message seen in the\ntrojan C2 response is shown below:\n\nif(client_connect(sockfd2,host,port2)==0)\n{\nclosesocket(sockfd2);\nsprintf(buffer,\"[SERVER]connection to %s:%d error\\r\\n\", host, port2);\nsend(sockfd1,buffer,strlen(buffer),0);\n\nThe code is written so that if the connection bouncer is unable to connect to the hidden destination in order to relay the incoming traffic, the formatted error message containing the target host and port parameters will be sent to the connecting client. As\nlong as there are no connection issues, HTran might be a useful tool to hide a trojan C2's true location - but, in the case of any\nconnection downtime between the HTran host and the hidden C2, HTran will betray the location of the hidden C2 host.\n\nInstances of HTran on multiple hosts could theoretically be chained together in order to add extra layers of obfuscation. However, in case of the final endpoint C2 being unavailable for any reason, the last link in the HTran chain will still pass its connection failure message up the chain, rendering all of the other layers of obfuscation useless. This tiny bit of error debugging\ncode left in by the author can be quite useful if one wants to track HTran-bounced hacking activity to its source.\n\n## HTran Survey\n\nArmed with the knowledge of HTran's transient error message formatting, Dell SecureWorks CTU was able to locate TCP\npacket captures containing HTran connection errors in response to traffic from other APT-related malware that had been previously executed in our sandnet. The following Snort signatures can be used by other organizations to search for HTran connection error messages in transit on their networks:\n\nalert tcp $EXTERNAL_NET any -> $HOME_NET any (msg:\"HTran Connection Redirect Failure Message\"; flow:established,from_server; dsize:\n<80; content:\"|5b|SERVER|5d|connection|20|to|20|\"; depth:22; reference:url,www.secureworks.com/research/threats/htran/;\nsid:1111111111;)\nalert tcp $EXTERNAL_NET any -> $HOME_NET any (msg:\"HTran Connection Redirect Failure Message (Unicode)\";\nflow:established,from_server; dsize:<160;\ncontent:\"|5b00|S|00|E|00|R|00|V|00|E|00|R|005d00|c|00|o|00|n|00|n|00|e|00|c|00|t|00|i|00|o|00|n|002000|t|00|o|002000|\";\ndepth:44; reference:url,www.secureworks.com/research/threats/htran/; sid:1111111112;)\n\nIn addition to locating historical packet captures containing evidence of HTran connection failures, Dell SecureWorks CTU\n\n\n-----\n\nbe seen in the following table:\n\n**Malware C2**\n**IP/Port**\n\n**12.38.236.41:443**\n\n**173.244.209.196:443**\n\n\n**epod.businessconsults.net**\n**hapyy2010.lflinkup.net**\n**info.businessconsults.net**\n**pop.businessconsults.net**\n**ssa.businessconsults.net**\n**sys.businessconsults.net**\n\n**bbs.india-videoer.com**\n**itiupdated.dyndns.info**\n**news.india-videoer.com**\n**www.india-videoer.com**\n\n\n**1daa3e392d1fea79badfbcd86d765d32**\n**855cea7939936e86016a0aedee1d2c24 [123.120.102.251:443]**\n\n\n**Hidden Destination**\n**Associated Hostnames** **Host-Related Malware Hashes**\n**IP/Port**\n\n\n**3493fc0e4a76b9d12b68afc46cab7f34**\n**fd4a4ac08f5a7271fbd9b8157d30244e**\n**51744d77fc8f874934d2715656e1a2df**\n\n\n**112.65.87.58:443**\n**58.247.25.108:443**\n\n\n**204.45.228.140:80**\n**00b9619613bc82f5fe117c2ca394a328**\n**204.45.228.140:443 [create301.dyndns.info]**\n\n\n**123.120.106.136:8080**\n**123.120.117.98:9000**\n**123.120.126.73:8080**\n**123.120.127.146:9000**\n\n\n**207.225.36.69:443**\n\n\n**leets.hugesoft.org**\n**rouji.freespirit.acmetoy.com**\n**slnoa.newsonet.net**\n**sos.businessconsults.net**\n**trb.arrowservice.net**\n**ug-aa.hugesoft.org**\n**www.optimizon.com**\n\n\n**cca75af9786d7364866f40b80dddcc5c 58.247.240.91:80**\n\n\n**212.125.200.197:443[inter.earthsolution.org ]** **3a3bf6cab9702d0835e8425f4e9d7a9c**\n\n**quick.earthsolution.org**\n\n\n**223.167.5.10:8000**\n**223.167.5.250:8000**\n**223.167.5.254:8000**\n\n**112.64.214.174:443**\n\n\n**bah001.blackcake.net**\n**caci2.infosupports.com**\n**doa.bigdepression.net**\n**lucy2.businessconsults.net**\n**lucy2.infosupports.com**\n**lucy.blackcake.net**\n**lucy.businessconsults.net**\n**mantech.blackcake.net** **03557c3e5c87e6a121c58f664b0ebf18**\n\n**212.125.200.204:443news.businessconsults.net** **8a873136b6e4dd70ff9470288ff99d93** **112.64.214.174:443**\n\n**qiao1.bigdepression.net** **bbf4212f979c32eb6bc43bd8ba5996f9**\n**qiao2.bigdepression.net**\n**qiao3.bigdepression.net**\n**qiao4.bigdepression.net**\n**qiao5.bigdepression.net**\n**qiao6.bigdepression.net**\n**sports.businessconsults.net**\n**srs.infosupports.com**\n\n**220.110.70.51:443** **nsweb.hostent.org** **c9067c06bb9e8a5304b93687c59e4e15 125.215.189.114:40781**\n\n**argentinia.faqserv.com**\n**epaserver.toythieves.com**\n**mailserver.instanthq.com**\n**mailserver.sendsmtp.com**\n**moiserver.myftp.info**\n**mosfdns.ddns.ms**\n**office.lflink.com** **121.229.201.158:10009**\n\n**60.249.150.162:443**\n\n**san.www1.biz** **121.229.201.238:10009**\n**seoulsummit.ddns.ms**\n**songs.longmusic.com**\n**sysinfo.mynumber.org**\n**timeforbeat.ns01.us**\n**www.cpear.ddns.us**\n**yahoo2.epac.to**\n\n**aar.bigdepression.net**\n**conn.gxdet.com**\n**db.billten.net**\n**ddbb.gxdet.com**\n**info.billten.net**\n**info.dcfrr.com**\n**info.helpngr.net**\n**info.new-soho.com** **056310138cb5ed295f0df17ac591173d**\n**info.scitence.net** **45a66ae3537488f7d63622ded64461e0**\n\n**64.255.101.100** **112.64.213.249:443**\n\n**mail.new-soho.com** **92e28cec1c82f5d82cbd80c64050c5ca**\n**mailsrv.scitence.net** **ec4d34c742d2d5714c600517f05c2253**\n\n\n-----\n\n**68.96.31.136**\n\n**72.167.34.54:443**\n\n\n**techniq.whandjg.net**\n**webmail.dcfrr.com**\n**webmail.whandjg.net**\n\n**gee.safalife.com**\n**ghma.earthsolution.org**\n**hav.earthsolution.org**\n**java.earthsolution.org**\n**quiet.earthsolution.org**\n**special.earthsolution.org**\n**visual.earthsolution.org**\n**vop.earthsolution.org**\n**vope.purpledaily.com**\n\n**catalog.earthsolution.org**\n**ou2.infosupports.com**\n**ou3.infosupports.com**\n**ou7.infosupports.com**\n**www2.wikaba.com**\n**yang1.infosupports.com**\n**yang2.infosupports.com**\n\n\n**3a3bf6cab9702d0835e8425f4e9d7a9c**\n**7cb055ac3acbf53e07e20b65ec9126a1 [223.167.5.10:8000]**\n\n**47a76cf2e60960405a492bc7f41b0483 58.247.27.232:443**\n\n\n_HTran Survey Results_\n\nThe hostnames in the table were gathered using passive DNS records showing that at one point in time they pointed to the IP\naddress in question. The hostnames may currently be pointed at different IP addresses than shown, as they are rotated frequently. The domains involved are all known to be connected to a variety of different Advanced Persistent Threat (APT) trojans. In cases where a related sample has been analyzed by Dell SecureWorks CTU, the MD5 hash of the sample is provided.\n\nThe survey of HTran traffic shows a clear pattern that can be seen by analyzing the Autonomous System Number (ASN) owner of each hidden IP address:\n\n17621 |  112.64.213.249 |CNCGROUP-SH China Unicom Shanghai network\n17621 |  112.64.214.174 |CNCGROUP-SH China Unicom Shanghai network\n17621 |   112.65.87.58 |CNCGROUP-SH China Unicom Shanghai network\n4134 | 121.229.201.158 |CHINANET-BACKBONE No.31,Jin-rong Street\n4134 | 121.229.201.238 |CHINANET-BACKBONE No.31,Jin-rong Street\n4808 | 123.120.106.136 |CHINA169-BJ CNCGROUP IP network China169 Beijing Province Network\n4808 |  123.120.117.98 |CHINA169-BJ CNCGROUP IP network China169 Beijing Province Network\n4808 |  123.120.126.73 |CHINA169-BJ CNCGROUP IP network China169 Beijing Province Network\n4808 | 123.120.127.146 |CHINA169-BJ CNCGROUP IP network China169 Beijing Province Network\n4515 | 125.215.189.114 |ERX-STAR PCCW IMSBiz\n60055 |   223.167.5.10 |CNCGROUP-SH China Unicom Shanghai network\n60055 |  223.167.5.250 |CNCGROUP-SH China Unicom Shanghai network\n60055 |  223.167.5.254 |CNCGROUP-SH China Unicom Shanghai network\n17621 |  58.247.240.91 |CNCGROUP-SH China Unicom Shanghai network\n17621 |  58.247.25.108 |CNCGROUP-SH China Unicom Shanghai network\n17621 |  58.247.27.232 |CNCGROUP-SH China Unicom Shanghai network\n\n_Autonomous System Owner By HTran IP Address_\n\nEvery hidden IP address observed in the HTran error messages captured during our survey is located on just a few different\nnetworks in the People's Republic of China (PRC). In almost every case, the observable C2 is in a different country, most likely\nthe same country in which the victim institution is located.\n\n\n-----\n\nIt's not surprising that hackers using a Chinese hacking tool might be operating from IP addresses in the PRC. Most of the\nChinese destination IPs belong to large ISPs, making further attribution of the hacking activity difficult or impossible without\nthe cooperation of the PRC government.\n\n## Conclusion\n\nOver the past ten years, we have seen dozens of families of trojans that have been implicated in the theft of documents, email\nand computer source code from governments, industry and activists. Typically when hacking or malware traffic is reported\non the Internet, the location of the source IP is not a reliable indicator of the true origin of the activity, due to the wide variety\nof programs designed to tunnel IP traffic through other computers. However, occasionally we get a chance to peek behind the\ncurtain, either by advanced analysis of the traffic and/or its contents, or due to simple programmer/user error. This is one of\nthose cases where we were lucky enough to observe a transient event that showed a deliberate attempt to hide the true origin\nof an APT. This particular hole in the operational security of a certain group of APT actors may soon be closed, however it is\nimpossible for them to erase the evidence gathered before that time. It is our hope that every institution potentially impacted\nby APT activity will make haste to search out signs of this activity for themselves before the window of opportunity closes.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        },
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/aqhzvj2a5vo91dgqjflh7nk4pm8aowon",
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2011/2011.08.03.HTran/HTran_and_the_Advanced_Persistent_Threat.pdf"
    ],
    "report_names": [
        "HTran_and_the_Advanced_Persistent_Threat"
    ],
    "threat_actors": [],
    "ts_created_at": 1666716502,
    "ts_updated_at": 1743041172,
    "ts_creation_date": 1380156890,
    "ts_modification_date": 1380156890,
    "files": {
        "pdf": "https://archive.orkl.eu/1461452398e57d541209eb6bc29e0743369b373b.pdf",
        "text": "https://archive.orkl.eu/1461452398e57d541209eb6bc29e0743369b373b.txt",
        "img": "https://archive.orkl.eu/1461452398e57d541209eb6bc29e0743369b373b.jpg"
    }
}