{
    "id": "5839a5f1-ce65-4bcd-8d0d-38776e149287",
    "created_at": "2022-10-25T16:48:14.948986Z",
    "updated_at": "2025-03-27T02:16:25.792839Z",
    "deleted_at": null,
    "sha1_hash": "a8f25ee9620859fd0cbdae1bc08155fbec9ae0cf",
    "title": "",
    "authors": "",
    "file_creation_date": "2014-08-22T09:48:52Z",
    "file_modification_date": "2014-08-22T09:48:52Z",
    "file_size": 3853794,
    "plain_text": "# Ge#ng&Windows&to&Play&with&Itself\n\n###### A\"Hacker’s\"Guide\"to\"Windows\"API\"Abuse\"\n \" Brady\"Bloxham\" Founder/Principal\"Security\"Consultant\"\n @silentbreaksec\" hCp://www.silentbreaksecurity.com\"\n hCp://www.blacksquirrel.io\"\"\n\n\n-----\n\n## Background\n\n#### • Shorten\"the\"gap\"between\" penetraHon\"test\"and\"actual\"aCack\"\n\n • Few\"covert\"persistence\"tools\"\n\n • Reduce\"reliance\"on\"Metasploit\"\n\n\n-----\n\n## Got&a&lot&to&cover\n\n#### • DLL\"InjecHon\"\n\n • Persistence\"\n\n • Throwback\"\n\n • Lots\"of\"demos\"along\"the\"way\"\n\n\n-----\n\n## DLL&Injec?on\n\n#### • TradiHonal\"methods\"\n\n###### • CreateRemoteThread()\"\n • NtCreateThreadEx()\"\n • RtlCreateUserThread()\"\n • NtQueueApcThread\"()\"\n\n • Can\"blue\"screen\"certain\"OSes\"\n • Code\"Cave\"\n\n • Suspend\"process\"\n • Inject\"code\"\n • Change\"EIP\"to\"locaHon\"of\"injected\"code\"\n • Resume\"process\"\n • Difficult\"on\"x64\"\n\n\n-----\n\n## AddMonitor()\n\n#### • +\"\n\n###### • Injects\"into\"spoolsv.exe\"\n • Doesn’t\"require\"matching\"\" architecture\"\n • Easy\"to\"use\"\n\n#### • \\\"\n\n###### • Dll\"must\"be\"on\"disk\"\n • Requires\"administrator\"privs\"\n\n\n-----\n\n## Dll&Injec?on&Demo\n\n\n-----\n\n## Persistence\n\n#### • Lots\"of\"persistence\"in\"Windows\"\n\n###### • Service\"\"\n • Run\"keys\"\n • Schtasks\"\n • …\"\n\n#### • And\"lots\"sHll\"to\"find…\"\n • Lots\"of\"techniques\"\n\n###### • Process\"monitor\"\n • Hook\"LoadLibrary()\"\n\n\n-----\n\n-----\n\n## Persistence\n\n##### • 1[st]\"Technique\"\n\n###### • Requires\"VMware\"Tools\"be\"installed\"\n • Just\"drop\"a\"dll\"to\"disk\"\n • c:\\windows\\system32\\wbem\\ntdsapi.dll\"\n • Note:\"Dll\"must\"export\"same\"funcHons\"as\"\" real\"ntdsapi.dll\"\n\n##### • 2[nd]\"Technique\"\n\n###### • VMware\"patched\"in\"ESXi\"5.5\"\n • Requires\"VMware\"Tools\"be\"installed\"\"\n • Just\"drop\"a\"dll\"to\"disk\"\n • c:\\windows\\system32\\wbem\\tpgenlic.dll\"\n • c:\\windows\\system32\\wbem\\thinmon.dll\"\n\n\n### Windows(\n\n\n-----\n\n## Persistence\n\n#### • 3[rd]\"Technique\"\n\n###### • HKLM\\SYSTEM\\CurrentControlSet\\Control\\Print\\Monitors\\\"\n\n • Create\"a\"new\"key\"\"\n • Create\"a\"new\"value\"named\"Driver\"with\"the\"dll\"name\"\n • Create\"as\"many\"as\"you\"like\"\n\n\n-----\n\n## Persistence&Demo\n\n\n-----\n\n## Windows&API&HTTP&Cheatsheet\n\n#### • WinHTTP\"\n\n###### • Intended\"for\"services\"\n • Does\"not\"pull\"user\"proxy\"seings\"\n • Supports\"impersonaHon\"\n\n#### • WinINet\"\n\n###### • More\"robust\"in\"proxy\"environment\"\"\n\n • Variety\"of\"flags\"that\"enable/disable\"funcHonality\"automaHcally\"\n • Prompts\"user\"for\"password\"if\"authenHcaHon\"is\"required\"\n • Uses\"IE\"seings\"\n\n\n-----\n\n## What&is&Throwback?\n\n#### • C++\"HTTP/S\"beaconing\"backdoor\"\n\n • PHP\"control\"panel\"w/\"MySQL\"backend\"\n\n • Built\"for\"stealth\"\n\n • Persistence\"built\\in\"\n\n###### • Dll\"\"\n • Exe\"\n\n\n-----\n\n###### Infected(User (\n\n Attacker\n\n\n###### Proxy(/(Firewall\n\n\n###### ThrowbackLP\n\n\n-----\n\n## Throwback&Features\n\n###### • Robust\"proxy\"detecHon\"\n\n • Distributed\"LPs\"\"\n\n • Uses\"MSGRPC\"to\"generate\"MSF\"payloads\"\n\n • RC4\"encrypted\"comms\"\"\n\n • Implements\"reflecHve\"dll\"injecHon\"\n\n • String\"encrypHon\"\n\n\n-----\n\n## Throwback\n\n\n-----\n\n## Throwback&Demo\n\n\n-----\n\n## Going&Forward…\n\n#### • Community\"based\"project!!!\"\n\n • Create\"modules\"\n\n###### • Keylogger,\"Mimikatz,\"Hashdump,\"etc.\"\n • Various\"transport\"methods\"\n\n#### • AddiHonal\"persistence\"techniques\"\n\n • ModificaHon\"of\"comms\"\n\n\n-----\n\n## The&End&Shameless&Plug\n\n##### • Interested\"in\"wriHng\"custom\"malware/backdoors?\"\n\n###### • Dark\"Side\"Ops:\"Custom\"PenetraHon\"TesHng\"\n • Blackhat\"Europe\"and\"East\"Coast\"Trainings\"\n\n##### • Pen\"test\"networks\"from\"your\"browser\"\n\n###### • hCps://www.blacksquirrel.io\" \"\n\n##### • Silent\"Break\"Security\"\n\n###### • Blackbox/Red\"Team\"Pen\"TesHng\"\n • brady@silentbreaksecurity.com\"\n • @silentbreaksec\"\n • hCps://github.com/silentbreaksec\"\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "99fdc3ef-333d-48f5-a4a1-becd788c7b80",
            "created_at": "2022-10-25T15:28:29.802983Z",
            "updated_at": "2022-10-25T15:28:29.802983Z",
            "deleted_at": null,
            "name": "MITRE",
            "url": "https://github.com/mitre-attack/attack-stix-data",
            "description": "MITRE ATT&CK STIX Data",
            "reports": null
        }
    ],
    "references": [
        "https://www.defcon.org/images/defcon-22/dc-22-presentations/Bloxham/DEFCON-22-Brady-Bloxham-Windows-API-Abuse-UPDATED.pdf"
    ],
    "report_names": [
        "DEFCON-22-Brady-Bloxham-Windows-API-Abuse-UPDATED.pdf"
    ],
    "threat_actors": [
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1666716494,
    "ts_updated_at": 1743041785,
    "ts_creation_date": 1408700932,
    "ts_modification_date": 1408700932,
    "files": {
        "pdf": "https://archive.orkl.eu/a8f25ee9620859fd0cbdae1bc08155fbec9ae0cf.pdf",
        "text": "https://archive.orkl.eu/a8f25ee9620859fd0cbdae1bc08155fbec9ae0cf.txt",
        "img": "https://archive.orkl.eu/a8f25ee9620859fd0cbdae1bc08155fbec9ae0cf.jpg"
    }
}