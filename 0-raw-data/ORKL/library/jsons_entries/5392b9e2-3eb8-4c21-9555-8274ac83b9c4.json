{
    "id": "5392b9e2-3eb8-4c21-9555-8274ac83b9c4",
    "created_at": "2023-01-12T15:04:38.374514Z",
    "updated_at": "2025-03-27T02:16:25.888514Z",
    "deleted_at": null,
    "sha1_hash": "a5c54e6e9034d7cb9bd9772a51df68a91d84bbb1",
    "title": "2022-03-10 - Diavol the Enigma of Ransomware",
    "authors": "",
    "file_creation_date": "2022-05-28T17:58:52Z",
    "file_modification_date": "2022-05-28T17:58:52Z",
    "file_size": 2706356,
    "plain_text": "# Diavol the Enigma of Ransomware\n\n**medium.com/walmartglobaltech/diavol-the-enigma-of-ransomware-1fd78ffda648**\n\nJason Reaves March 10, 2022\n\n[Jason Reaves](https://medium.com/@jason.reaves?source=post_page-----1fd78ffda648--------------------------------)\n\nMar 10\n\n\n4 min read\n\nBy: Jason Reaves and Joshua Platt\n\nDiavol ransomware was first publicly reported by Fortinet in July 2021 [1]. The posting included a technical analysis of the file that was\nallegedly dropped from a previous engagement in June 2021. According to the blog, the Diavol variant was found along side a Conti (v3)\nsample, which had also been spread during the same attack. In a follow-up article by IBM-Xforce, the researchers concluded a stronger link\nexisted between the development of Diavol and the operators behind Trickbot malware.\n\nWhile multiple samples have been found in the wild, they appear to contain development artifacts. It was clear the locker was utilized but there\nwas no mention of a leak site and nothing had been identified publicly. After analyzing the binary, we spotted some interesting infrastructure\nand began to investigate. The domain name enigma-hq[.]net stood out and was associated with ‘195.123.221[.]248’. According to passive\nDNS records an update had occurred and enigma-hq[.]net was changed to diavol-news[.]net:\n\nCredit:\nThe HTML revealed a TOR mirror along with the web mirror pointing to ‘diavol-news[.]net’:\n```\n<input type=\"text\" id=\"blogpostsearch-search\" class=\"search\" name=\"BlogPostSearch[search]\" placeholder=\"Search\"><p class=\"helpblock help-block-error\"></p><button type=\"submit\"><i class=\"fa fa-search\"></i></button>  </form></div>              \n</div><div class=\"col-md-4 search_fix\">                <div class=\"row\">                  <div\nclass=\"col-md-4\">                    <a class=\"pull-left\" href=\"https://xhtnringfhbflc6d.onion\" ref=\"noopener\nnoreferrer\">Tor mirror</a>                  </div>                  <div class=\"col-md-4\">   \n<a class=\"pull-center\" href=\"https://diavol-news.net\" ref=\"noopener noreferrer\">Web mirror</a>                  \n</div>                                  </div>              </div>         \n</div>      </div>\n\n```\n\n-----\n\nDiavol Test Leak Site\n\n## Technical Overview\n\nDiavol comes with an interesting assortment of code blocks onboard to accomplish various tasks:\n\nThe BITMAP objects contain the code while the JPEG objects contain the imports that need to be resolved.\n\n\n-----\n\nLoading BITMAP\n\nFixing imports from JPEG\nThe objects were previously detailed in the Fortinet blog but here is an overview from our own analysis of a recent sample:\n\n\n-----\n\nThere is two interesting pieces that we discovered from our analysis, one is that because of the way VSSMOD works you can plug and play\nvarious ways to wipe shadow copies and the other is the way file encryption works.\n\n## Shadow copies\n\nFor one of the samples we analyzed the shadow copies were wiped using WinAPI which doesn’t appear to be used very often by ransomware:\n\nAfter calling CreateVssBackupComponents you can use the IVssBackupComponents class [5] which can then be leveraged to delete\nsnapshots.\n\n## Encryption\n\nFile encryption in Diavol is interesting, it has a routine for decoding the onboard RSA public key and importing it before encrypting the key that\nwill be used to encrypt the files. The file encryption key is 2048 bytes long and is randomly generated however the encryption is simply XORing\nthe files in chunks of 2048:\n\n\n-----\n\nSince the file encryption key is being used across multiple files and is simply a XOR operation we can abuse known plaintext vulnerabilities to\nrecover files.\n\nA = ClearText\nB = EncryptedFile1\nC = EncryptedFile2\n\nkey = A[:2048] ^ B[:2048]\nDecodedFileChunk = key[:2048] ^ C[:2048]\n\nWe can test this using files from a sandbox run [6] along with a random MSI file which has a semi static first chunk of bytes, it won’t be a clean\ndecrypt by any means but would prove out our hypothesis:\n\n>>> clear= open(‘a4ce1d7dfc5ab1fdee8cd0eb97d19c88a04deb8fe6b7b58413a9e2c93eb4a79d.msi’, ‘rb’).read()\n>>> b = bytearray(open(‘powerpointmui.msi.lock64’, ‘rb’).read())\n>>> c = open(‘sharepointdesignermui.msi.lock64’, ‘rb’).read()\n>>> key= bytearray(a[:2048])\n>>> for i in range(len(test)):\n… test[i] ^= b[i]\n…\n>>> temp = bytearray(c)\n>>> for i in range(len(temp)):\n… temp[i] ^= test[i%len(test)]\n>>> temp[:5000]\nbytearray(b’\\xd0\\xcf\\x11\\xe0\\xa1\\xb1\\x1a\\xe1\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00>\\x00\\x03\\x00\\xfe\\xff\\t\\x00\\x\n\\x00\\x00\\x00.\\x00\\x00\\x00/\\x00\\x00\\x000\\x00\\x00\\x001\\x00\\x00\\x002\\x00\\x00\\x003\\x00\\x00\\x004\\x00\\x00\\x005\\x00\\x00\\x006\\x00\\x00\\x007\\x\n<..snip..>\n%\\x00\\x00\\x00&\\x00\\x00\\x00\\’\\x00\\x00\\x00(\\x00\\x00\\x00)\\x80\\x00\\x00*\\x00\\x00\\x00+\\x00\\x00\\x00,\\x80\\x00\\x00\\x00\\x00\\x00.\\x00\\x01\\x00/\\x80\\x00\\x000\\x00\\x00\\x00=\\x00\\x02\\x01\\x12\\x00\\x00\\x007\\x80\\x00\\x00\\xcb\\x7f\\xff\\xff5\\x00\\x00\\x006\\x00\\x00\\x007\n5\\xc5lD)>\\xb2D\\xd1\\xb7\\xff\\xff\\xfe\\xff\\xff\\xff\\xfe\\xff\\xff\\xffG\\x00\\x00\\x00H\\x00\\x00\\x00I\\x00\\x00\\x00J\\x00\\x00\\x00K\\x00\\x00\\x00L\\x00\\x00\\x00M\n\\x15\\xc5lD\\t;\\xe4E@H\\x00\\x00e\\x00\\x00\\x00f\\x00\\x00\\x00g\\x00\\x00\\x00h\\x00\\x00\\x00i\\x00\\x00\\x00j\\x00\\x00\\x00k\\x00\\x00\\x00l\\x00\\x00\\x00m\n\\x00\\x10\\x84\\xff\\xff\\x91\\xfb\\x00\\x00\\x12\\x05\\x00\\x00o\\x05\\xff\\xff\\x14\\xfa\\x00\\x00\\x95\\x06\\x00\\x00\\xe9\\x06\\x00\\x00\\x97\\x07\\x00\\x00\\xe7\\x07\\x\n\n<..snip..>\n\n\\xff7\\xffh\\xff\\xb4\\xff\\xff\\xff\\xb7\\xff\\x8b\\xff\\xb6\\xff\\xff\\xff\\xb1\\xffh\\xff)\\xff\\xff\\xff\\xb3\\xff\\x8b\\xff\\xc6\\xff\\x8b\\xff\\xad\\xff\\xff\\xff\\xac\\xff\\xff\\xff\\xaf\\xff\\xff\\xff\\\n\nIt appears to have worked and since the file encryption key is generated on a per infection basis we simply only need to abuse this technique\nto recover 2048 bytes once in order to then recover all the files on the system.\n\n## References\n\n1: [https://www.fortinet.com/blog/threat-research/diavol-new-ransomware-used-by-wizard-spider](https://www.fortinet.com/blog/threat-research/diavol-new-ransomware-used-by-wizard-spider)\n\n2: [https://heimdalsecurity.com/blog/is-diavol-ransomware-connected-to-wizard-spider/](https://heimdalsecurity.com/blog/is-diavol-ransomware-connected-to-wizard-spider/)\n\n\n-----\n\n3 ttps //secu ty te ge ce co [/posts/a a ys s o d a o](https://securityintelligence.com/posts/analysis-of-diavol-ransomware-link-trickbot-gang/) a so a e t c bot ga g/\n\n4: [https://labs.vipre.com/conti-ransomware-part-2-utilizing-server-message-block-smb-to-share-infection/](https://labs.vipre.com/conti-ransomware-part-2-utilizing-server-message-block-smb-to-share-infection/)\n\n5: [https://docs.microsoft.com/en-us/windows/win32/api/vsbackup/nl-vsbackup-ivssbackupcomponents](https://docs.microsoft.com/en-us/windows/win32/api/vsbackup/nl-vsbackup-ivssbackupcomponents)\n\n6: [https://app.any.run/tasks/27db4430-59e5-48c5-8191-f3491f13b3c4#](https://app.any.run/tasks/27db4430-59e5-48c5-8191-f3491f13b3c4#)\n\n7: [https://www.bleepingcomputer.com/news/security/fbi-links-diavol-ransomware-to-the-trickbot-cybercrime-group/](https://www.bleepingcomputer.com/news/security/fbi-links-diavol-ransomware-to-the-trickbot-cybercrime-group/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-03-10 - Diavol the Enigma of Ransomware.pdf"
    ],
    "report_names": [
        "2022-03-10 - Diavol the Enigma of Ransomware.pdf"
    ],
    "threat_actors": [
        {
            "id": "63061658-5810-4f01-9620-7eada7e9ae2e",
            "created_at": "2022-10-25T15:50:23.752974Z",
            "updated_at": "2025-03-27T02:00:55.538582Z",
            "deleted_at": null,
            "main_name": "Wizard Spider",
            "aliases": [
                "Wizard Spider",
                "UNC1878",
                "TEMP.MixMaster",
                "Grim Spider",
                "FIN12",
                "GOLD BLACKBURN",
                "ITG23",
                "Periwinkle Tempest",
                "DEV-0193"
            ],
            "source_name": "MITRE:Wizard Spider",
            "tools": [
                "TrickBot",
                "AdFind",
                "BITSAdmin",
                "Bazar",
                "LaZagne",
                "Nltest",
                "GrimAgent",
                "Dyre",
                "Ryuk",
                "Conti",
                "Emotet",
                "Rubeus",
                "Mimikatz",
                "Diavol",
                "PsExec",
                "Cobalt Strike"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "761d1fb2-60e3-46f0-9f1c-c8a9715967d4",
            "created_at": "2023-01-06T13:46:38.269054Z",
            "updated_at": "2025-03-27T02:00:02.789278Z",
            "deleted_at": null,
            "main_name": "APT3",
            "aliases": [
                "TG-0110",
                "Group 6",
                "Buckeye",
                "Boyusec",
                "BORON",
                "BRONZE MAYFAIR",
                "Red Sylvan",
                "GOTHIC PANDA"
            ],
            "source_name": "MISPGALAXY:APT3",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f6f91e1c-9202-4497-bf22-9cd5ef477600",
            "created_at": "2023-01-06T13:46:38.86765Z",
            "updated_at": "2025-03-27T02:00:02.938998Z",
            "deleted_at": null,
            "main_name": "WIZARD SPIDER",
            "aliases": [
                "FIN12",
                "UNC2053",
                "Pistachio Tempest",
                "TEMP.MixMaster",
                "GOLD BLACKBURN",
                "Periwinkle Tempest",
                "DEV-0193",
                "Storm-0193",
                "Trickbot LLC",
                "DEV-0237"
            ],
            "source_name": "MISPGALAXY:WIZARD SPIDER",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "e6a21528-2999-4e2e-aaf4-8b6af14e17f3",
            "created_at": "2022-10-25T16:07:24.422115Z",
            "updated_at": "2025-03-27T02:02:10.216817Z",
            "deleted_at": null,
            "main_name": "Wizard Spider",
            "aliases": [
                "DEV-0193",
                "Gold Blackburn",
                "Gold Ulrick",
                "Grim Spider",
                "ITG23",
                "Operation BazaFlix",
                "Periwinkle Tempest",
                "TEMP.MixMaster",
                "Wizard Spider"
            ],
            "source_name": "ETDA:Wizard Spider",
            "tools": [
                "AdFind",
                "Agentemis",
                "Anchor_DNS",
                "BEERBOT",
                "BazarBackdoor",
                "BazarCall",
                "BazarLoader",
                "Cobalt Strike",
                "CobaltStrike",
                "Conti",
                "Diavol",
                "Dyranges",
                "Dyre",
                "Dyreza",
                "Dyzap",
                "Gophe",
                "Invoke-SMBAutoBrute",
                "KEGTAP",
                "LaZagne",
                "LightBot",
                "PowerSploit",
                "PowerTrick",
                "PsExec",
                "Ryuk",
                "SessionGopher",
                "TSPY_TRICKLOAD",
                "Team9Backdoor",
                "The Trick",
                "TheTrick",
                "Totbrick",
                "TrickBot",
                "TrickLoader",
                "TrickMo",
                "Upatre",
                "bazaloader",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "bc119938-a79c-4e5f-9d4d-dc96835dfe2e",
            "created_at": "2024-06-04T02:03:07.799286Z",
            "updated_at": "2025-03-27T02:05:17.337094Z",
            "deleted_at": null,
            "main_name": "GOLD BLACKBURN",
            "aliases": [
                "Periwinkle Tempest ",
                "Wizard Spider ",
                "ITG23 "
            ],
            "source_name": "Secureworks:GOLD BLACKBURN",
            "tools": [
                " Buer Loader",
                " Dyre",
                " Team9",
                " TrickBot",
                "BazarLoader"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "06f622cb-3a78-49cf-9a4c-a6007a69325f",
            "created_at": "2022-10-25T16:07:23.315239Z",
            "updated_at": "2025-03-27T02:02:09.733197Z",
            "deleted_at": null,
            "main_name": "APT 3",
            "aliases": [
                "APT 3",
                "Bronze Mayfair",
                "Buckeye",
                "Gothic Panda",
                "Group 6",
                "Operation Clandestine Fox",
                "Operation Clandestine Fox, Part Deux",
                "Operation Clandestine Wolf",
                "Operation Double Tap",
                "Red Sylvan",
                "TG-0110",
                "UPS Team"
            ],
            "source_name": "ETDA:APT 3",
            "tools": [
                "APT3 Keylogger",
                "Agent.dhwf",
                "BKDR_HUPIGON",
                "Backdoor.APT.CookieCutter",
                "Badey",
                "Bemstour",
                "CookieCutter",
                "Destroy RAT",
                "DestroyRAT",
                "DoublePulsar",
                "EXL",
                "EternalBlue",
                "HTran",
                "HUC Packet Transmit Tool",
                "Hupigon",
                "Hupigon RAT",
                "Kaba",
                "Korplug",
                "LaZagne",
                "MFC Huner",
                "OSInfo",
                "Pirpi",
                "PlugX",
                "RedDelta",
                "RemoteCMD",
                "SHOTPUT",
                "Sogu",
                "TIGERPLUG",
                "TTCalc",
                "TVT",
                "Thoper",
                "Xamtrav",
                "remotecmd",
                "shareip",
                "w32times"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535878,
    "ts_updated_at": 1743041785,
    "ts_creation_date": 1653760732,
    "ts_modification_date": 1653760732,
    "files": {
        "pdf": "https://archive.orkl.eu/a5c54e6e9034d7cb9bd9772a51df68a91d84bbb1.pdf",
        "text": "https://archive.orkl.eu/a5c54e6e9034d7cb9bd9772a51df68a91d84bbb1.txt",
        "img": "https://archive.orkl.eu/a5c54e6e9034d7cb9bd9772a51df68a91d84bbb1.jpg"
    }
}