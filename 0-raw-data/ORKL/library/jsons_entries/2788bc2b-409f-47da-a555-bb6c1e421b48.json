{
    "id": "2788bc2b-409f-47da-a555-bb6c1e421b48",
    "created_at": "2022-10-25T16:48:15.35257Z",
    "updated_at": "2025-03-27T02:09:20.72473Z",
    "deleted_at": null,
    "sha1_hash": "a64d2206e1e103ad29c72db4046f85bd46769eb7",
    "title": "蔓灵花APT组织利用恶意CHM文档针对国内研究机构的攻击活动分析",
    "authors": "",
    "file_creation_date": "2020-10-26T07:27:40Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 692285,
    "plain_text": "# 蔓灵花APT组织利⽤恶意CHM⽂档针对国内研究机构的攻击活动分析\n\n**mp.weixin.qq.com/s/9O4nZV-LNHuBy2ihg2XeIw**\n\n## 背景\n\n近期，奇安信安全能力中心捕获到针对特定单位群体展开的定向攻击活动，通过分析发现其为“蔓灵花”APT组织。该组织\n最早在2016由美国安全公司Forcepoint进行了披露，并且命名为“BITTER”。\n\n蔓灵花（BITTER）APT组织是一个长期针对亚洲地区进行攻击活动的APT组织。主要针对目标区域的政府、军工业、电\n力、核工业等单位进行攻击，试图窃取敏感数据。\n\n## 攻击活动分析\n\n### 1、攻击⽅式\n\n该组织主要采用鱼叉钓鱼的方式，对相关目标单位的个人直接发送嵌入了攻击诱饵的钓鱼邮件。本次攻击行动中使用的\n诱饵为rar压缩包，而压缩包里携带恶意的chm文档。本次捕获的攻击样本为“主要指标情况说明.chm”后，整体的攻击流\n程如下图所示：\n\n### 2、功能模块汇总\n\n**样本名称** **功能描述**\n\n**主要指标情况说明.chm** 诱饵⽂档\n\nmsapp 执⾏cmd命令\n\nmsixxxx.tmp 下载程序：由msiexec下载执⾏，结合⽩程序实现命令执⾏\n\ndlhost 窃密模块：窃取资料，将收集到的数据上传到C2服务器：72.11.134.216\n\nmsas 远控模块：主要功能为上传⽤户数据并接收C2指令执⾏\n\nmsass 下载程序：上传⽤户数据，根据c2返回的控制指令下载执⾏后续攻击模块\n\n\n-----\n\n样本分析\n\nmsixxxx.tmp为msiexec.exe从网络下载的msi安装包产生的临时文件，该程序实际上为Advanced Installer安装程序中附\n带的文件，17.2.0.0版本的该程序带有数字签名，文件的数字签名信息如下：\n\n带有数字签名的白程序，可以实现执行任意命令，将要执行的命令和该文件一起打包为msi格式的安装包，再通过\nmsiexec.exe下载安装，即可实现远程命令执行，完整的攻击命令如下：\n\n通过这种方式下载的模块汇总：\n\n名称 下载地址\n\n**msass** http[:]//webmailcgwip.com/xingsu/msass\n\n**dlhost** http[:]//webmailcgwip.com/xingsu/dlhost\n\n**msas** http[:]//webmailcgwip.com/xingsu/msass\n\n对http[:]//webmailcgwip.com/目标进行分析，其所关联的载荷能力可能为msass、msapp、dlhost和msas。\n\n**dlhost**\n\n该文件的主要功能窃取数据，根据配置信息，会将特定后缀的文件上传到72.11.134.216服务器，特定的后缀列表为：\n\n**neat（键盘记录模块的记录文件使用的扩展**\n名）,txt，ppt，pptx，pdf，doc，docx，xls，xlsx，zip，z7，rtf.txt，apk，jpg，jpeg，logins.json，key3.db。\n\n\n-----\n\n包含了浏览器密码，办公文档，压缩包，图像，手机应用等软件敏感数据。\n\n敏感文件上传，火狐浏览器相关的文件。\n\n**msapp模块**\n\n该模块由msiexec下载执行，执行了以下cmd命令后就退出，功能为通过MSI安装程序进行远程加载执行链接给定的MSI\n文件。\n\n**msass 模块**\n\nmsass负责与c2进行通信获取其他模块执行，解密后的配置信息如下：\n\n\n-----\n\n获取主机名、计算机名、操作系统名、机器GUID并发送到c2。\n\n接收控制指令，从中搜索Yes file，如果找到Yes file 则继续从其后搜索[] 标志，提取其中的字符。\n\n将提取到的字符拼接到url后边，同时也拼接到木马所在目录后边，拼接出的url处下载文件到木马目录，随后将其重命名\n为.exe结尾的文件名，最后调用ShellExecuteA执行，完成下载执行功能。\n\n**msas 模块**\n\n**msas是一个开源项目** **DarkAgent进行修改的远控模块，保留了该开源项目的大部分功能，如：文件管理、进程管理、**\n命令执行。下面是样本中的远控与 **DarkAgent的差异:**\n\n配置信息如下，解密后的控制链接地址为http[:]//pichostfrm.net\n\n\n-----\n\n## IoC\n\n**C2**\n\n72.11.134.216\n\n162.0.229.203\n\npichostfrm.net\n\nwebmailcgwip.com\n\n**MD5**\n\n34ae127d269b718933a248c990faba03\n\n660a678cd7202475cf0d2c48b4b52bab\n\nf4daf0eccf9972bdefb79fbf9f7fb6ee\n\na39aa2ecbbb50c97727503e23ce7b8c6\n\n29ed7d64ce8003c0139cccb04d9af7f0（带签名的白文件）\n\n**PDB:**\n\ng:\\visualstudioprojects_cn\\remotetool\\remotetool\\obj\\release\\microsoftservices.pdb\n\n## 总结\n\n蔓灵花组织长期针对我国重要政企部门和敏感单位进行定向攻击。虽然国内外各安全厂商都曾对其攻击活动有过披露，\n但却并未阻止其进行攻击的步伐。\n\n提醒国内相关企业和单位务必引起重视，提高警惕，加强自身安全防御措施，减少不必要的损失。\n\n目前，基于奇安信天擎终端一体化管理系统能针对此APT攻击团伙做出精准检测与拦截。\n\n参考资料\n\nhttps://ti.qianxin.com/blog/articles/analysis-of-apt-campaign-bitter/\n\nhttps://www.freebuf.com/articles/database/192726.html\n\n\n-----",
    "language": "ZH",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2020/2020.10.22.Bitter_CHM_APT/Bitter_CHM_APT_CN.pdf"
    ],
    "report_names": [
        "Bitter_CHM_APT_CN"
    ],
    "threat_actors": [
        {
            "id": "bf6cb670-bb69-473f-a220-97ac713fd081",
            "created_at": "2022-10-25T16:07:23.395205Z",
            "updated_at": "2025-03-27T02:02:09.777308Z",
            "deleted_at": null,
            "main_name": "Bitter",
            "aliases": [
                "T-APT-17",
                "TA397"
            ],
            "source_name": "ETDA:Bitter",
            "tools": [
                "Artra Downloader",
                "ArtraDownloader",
                "Bitter RAT",
                "BitterRAT",
                "Dracarys"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "655f7d0b-7ea6-4950-b272-969ab7c27a4b",
            "created_at": "2022-10-27T08:27:13.133291Z",
            "updated_at": "2025-03-27T02:00:55.490812Z",
            "deleted_at": null,
            "main_name": "BITTER",
            "aliases": [
                "T-APT-17"
            ],
            "source_name": "MITRE:BITTER",
            "tools": [
                "ZxxZ"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1666716495,
    "ts_updated_at": 1743041360,
    "ts_creation_date": 1603697260,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/a64d2206e1e103ad29c72db4046f85bd46769eb7.pdf",
        "text": "https://archive.orkl.eu/a64d2206e1e103ad29c72db4046f85bd46769eb7.txt",
        "img": "https://archive.orkl.eu/a64d2206e1e103ad29c72db4046f85bd46769eb7.jpg"
    }
}