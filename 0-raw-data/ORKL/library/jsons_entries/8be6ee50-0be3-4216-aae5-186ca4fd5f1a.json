{
    "id": "8be6ee50-0be3-4216-aae5-186ca4fd5f1a",
    "created_at": "2023-04-05T02:09:33.531425Z",
    "updated_at": "2025-03-27T02:05:23.29754Z",
    "deleted_at": null,
    "sha1_hash": "e87ebd5ddd4b76de3fd543dd19f20f3930540d4f",
    "title": "2023-03-09 - DUCKTAIL- Threat Operation Re-emerges with New LNK, PowerShell, and Other Custom Tactics to Avoid Detection",
    "authors": "",
    "file_creation_date": "2023-04-03T08:51:30Z",
    "file_modification_date": "2023-04-03T08:51:30Z",
    "file_size": 3889335,
    "plain_text": "# DUCKTAIL: Threat Operation Re-emerges with New LNK, PowerShell, and Other Custom Tactics to Avoid Detection\n\n**deepinstinct.com/blog/ducktail-threat-operation-re-emerges-with-new-lnk-powershell-and-other-custom-tactics-to-**\navoid-detection\n\nMarch 9, 2023\n\n## Deep Instinct Included in the 2022 Gartner® Magic Quadrant™ for\n Endpoint Protection Platforms (EPP)\n\n[Learn more](https://www.deepinstinct.com/blog/who-is-the-only-new-vendor-in-the-2022-gartner-magic-quadrant-for-endpoint-protection-platforms)\n\nDUCKTAIL is the name given to a malware operation that was previously focused on\ntargeting individuals and organizations that operate on Facebook’s Business Ads\nplatform\nThe initial infection starts with a malicious LNK that executes PowerShell to download\nmalware hosted on a public file-sharing service\nThe DUCKTAIL operation has changed their custom malware to be compiled as a .NET\nCore 5\nThe final payload has been changed from custom-made malware to commodity\nmalware during the experimental phase\n\n[WithSecure reported on the DUCKTAIL operation in two separate reports in 2022 (1,](https://labs.withsecure.com/content/dam/labs/docs/WithSecure_Research_DUCKTAIL.pdf) [2).](https://labs.withsecure.com/content/dam/labs/docs/WithSecure_Research_DUCKTAIL_Returns.pdf)\n\nShortly after the first publication, which carefully detailed their TTPs, the threat operation\nwent silent.\n\nAfter the publication revealed their tactics for a second time, they again went silent. It was at\nthis time that Deep Instinct observed the operation experimenting with changing the initial\ninfection from an archive containing a malicious executable to an archive containing a\nmalicious LNK file that would start the infection chain (we’ll describe this below).\n\nDeep Instinct observed the operation becoming operational again at the beginning of\nFebruary 2023.\n\n### Initial Experiments Observed by Deep Instinct\n\nIn October 2022 the DUCKTAIL operation was observed by the Threat Reseach team at\nDeep Instinct pushing their custom .NET malware in their usual infection chain, as was\ndescribed by WithSecure in the previously mentioned reports.\n\nThe payload with the hash 27c76c08e4d3a17056e0d22cbe1f6e59 was signed by a nowrevoked certificate for a fake business created by the threat actor:\n\n\n-----\n\nFigure 1: Signed DUCKTAIL malware with now-revoked certificate.\nThe payload was inside an archive (870dc03ba3120e4ecfb799b519ec1a50) with decoy\nimages and videos:\n\n\n-----\n\nFigure 2: Directory tree inside the archive file containing malware and decoy files.\nAs described by WithSecure, the malware exfiltrated data via a Telegram bot, in this case via\nan HTTP request to: hxxps://api.telegram.org/bot5448616453:AAHJdBSZdnpmhl5_xYzf0uL_clkJzggXCSw/sendMessage_\n\nThe exact same payload was observed in parallel in another infection chain that Deep\nInstinct determined was used for testing purposes to bypass detections and improve the\nnumber of successful infections.\n\nWhile the final payload is the same, the new alternative infection chain began with an archive\n(ece3728e2893c9dd70fb519ac80070b6) containing only an LNK file without any decoy files.\n\nThe LNK file is calling PowerShell to download and execute another PowerShell script which\nis hosted on Discord:\n\nFigure 3: LNK file contents.\nThe PowerShell command inside the LNK is lightly obfuscated using simple tricks like adding\nquotes concatenation and string replace which are used to bypass static detections\n\n\n-----\n\nThe downloaded 2nd-stage PowerShell (238fbb5ac0af956e8d07cf0f716e0d83) is also lightly\nobfuscated using the same replace trick plus a custom function for download and execution\nwhich should bypass some static detections.\n\nWhen executed, the 2nd-stage PowerShell downloads the exact same signed payload\n(27c76c08e4d3a17056e0d22cbe1f6e59) which has been observed in the old infection chain.\nAdditionally, a benign archive file with decoy files is also downloaded. Both files are hosted\non Discord. Finally, the 2nd-stage PowerShell deletes the initial LNK file to cover its tracks:\n\nFigure 4: 2nd-stage PowerShell script contents.\n\n### Deep Instinct Observes More DUCKTAIL Experiments:\n\nFrom November to December 2022 the DUCKTAIL operation seemed to have switched\nsolely to the LNK infection chain while continuing to experiment with it. We observed the\nfollowing experiments:\n\n_Inflation of LNK files:_\n\nThe LNK file (5da77aeb1d6ec4d7c9b8408cab3feecc) has a size of almost 300 MB.\n\nWhile the functionality is the same as the previous LNK file, this file has zero bytes appended\nto it. This [technique is growing in popularity among threat actors because of file-size limits at](https://www.deepinstinct.com/blog/the-russian-spyagent-a-decade-later-and-rat-tools-remain-at-risk)\nvarious vendors and sandboxes.\n\n_Change to initial PowerShell command inside LNK:_\n\nThe initial PowerShell script inside the LNK files has been completely changed to heavily rely\non concatenation with the combination of extracting a single character from the “$PSHOME”\nvariable.\n\nThe “$PSHOME” in PowerShell translates to the directory where “powershell.exe” is located,\nfor example\n```\n“C:\\WINDOWS\\System32\\WindowsPowerShell\\v1.0\\.”\n\n```\nBelow is an example of an extracted and edited version of a new LNK\n(e03635ef5c57b4884f619108499971e4):\n\nFigure 5: New PowerShell script with added analysis comments\n\n\n-----\n\n_Changes to public hosting storage:_\nAt first, the DUCKTAIL operation used Discord to host the next stages of the attack. At some\npoint the operation shifted to other public storage providers such as “transfer.sh,” GitHub,\nand Google Drive.\n\nAdditionally, the use of dedicated attacker-controlled domains were observed (see\nappendix).\n\nOne such example is the domain “techhint24[.]com” which is shown in figure 5.\n\nPreviously, WithSecure observed archives with the malicious executable hosted at Dropbox,\niCloud, and MediaFire. In addition, Deep Instinct observed the current archives with LNK\nhosted at attacker-controlled domains and in free subdomains that would redirect to\nDropBox, such as [status-refund-taxes[.]web[.]app which been observed by](https://urlscan.io/responses/2488fc206f5f705efac84cc66ef7f38be3d6ed52bb68d89b7acd4073a3ae1da7/)\n[@JAMESWT_MHT:](https://twitter.com/JAMESWT_MHT/status/1599795248720678913)\n\nFigure 6: Redirect to download file from DropBox found at “status-refund-taxes[.]web[.]app”\n_Changes to final payload:_\n\nDuring infection chain experiments the threat actor used their own custom .NET malware,\nlikely due to the revocation of their certificate and the growing detection rate for the malware.\nAt some point the operation switched to different payloads.\n\nIn the example shown in figure 7, the payload was Doenerium stealer. In other instances,\nVidar stealer was observed. This change might indicate that threat actor is exploring new\nways to monetize their attacks.\n\n### Back to Action – New wave of attack in February 2023:\n\nAfter doing the experiments at the end of 2022, there was no sign of new activity in 2023\nuntil the middle of February.\n\nThe operation is back with an infection chain that combines all the features in the\nexperiments, while the final payload is once again the custom malware with yet another new\nvalid certificate:\n\n\n-----\n\nFigure 7: New certificate\n\ninformation.\nThe actor made an OpSec mistake and added the email address of a domain that was\nregistered by him at cakoithaivuong[.]site.\n\nIn addition to the new LNK infection chain, the old infection chain consisting of archives\ncontaining malicious executables and decoy files is also active.\n\nIn this wave, the custom DUCKTAIL malware functionality remains the same but is being\ndistributed as a 64bit .NET Core 5 binary:\n\nFigure 8: Metadata of new DUCKTAIL binary showing it is a .NET Core 5 binary.\n\n\n-----\n\nIn case you missed the previous reports on DUCKTAIL, the purpose of the malware is to\nsteal browser cookies and exfiltrate them through Telegram. If a Facebook session cookie is\nfound, the malware checks if the Facebook account is a business account. If it is, the\nmalware tries to add the attacker’s email as an admin and finance editor.\n\nBelow is a scheme showing the new DUCKTAIL infection chain:\n\nFigure 9: Illustration of new DUCKTAIL infection chain\n\n### Additional Information:\n\n_Delivery mechanism:_\n\nWithSecure initially observed that individuals have been targeted via LinkedIn. During our\n[research, we have identified two threads in Reddit (1,](https://www.reddit.com/r/PowerShell/comments/zap628/can_anyone_please_tell_me_what_this_malicious/) [2) which discuss a suspicious LNK file](https://www.reddit.com/r/answers/comments/z6anio/what_does_this_code_do/)\nthat is spread via link to an archive hosted on Google drive. The link is added to various\n[threads on Reddit as can be seen in archived version of one of those posts.](https://web.archive.org/web/20221201234010/https:/www.reddit.com/r/BitcoinMining/comments/za1xd7/sharing_my_google_sheets_work_template_of/)\n\n_Monetization:_\n\nWhile WithSecure detailed the malware functionality which specifically targets the Facebook\nAds platform there is a missing piece on what the threat actor does once they gain access to\nbusiness Facebook Ads accounts.\n\nWhile it might be possible to get the credit card information that is used for paying for ads in\nthe compromised accounts this doesn’t seem plausible. There are far better, cheaper, and\neasier ways to gain credit card information.\n\nOne of the initial samples (138831ebee49d667748c4babe5ea2445) has been inside an\narchive (7e8f1c84347586e8b9b62d7493c6017c). This archive has been hosted on the\ndomain aicokgroup[.]com.\n\nWe have identified the following Facebook page that lists this domain as their homepage:\n\n\n-----\n\nFigure 10: Facebook page with aicokgroup[.]com\n[One of the posts has an Amazon short URL which is no longer active. An archived version](https://web.archive.org/web/20201127135324/https:/www.amazon.com/dp/B07DCKYJ5D)\nshows that the link is for AICOK Juicer machine:\n\nFigure 11: Amazon item from link in Facebook group.\nWhile we are not sure whether AICOK is a real company or a shell company made by the\nthreat actor, their items seem to be “white label” products. For example, the same juicer is\n[listed now as another brand on Amazon:](https://www.amazon.com/HOUSNAT-Professional-Masticating-Extractor-Vegetable/dp/B09FL43JJG?ref_=ast_sto_dp)\n\n\n-----\n\nFigure 12: Amazon listing for same item but a different brand.\nOn the same Facebook page there is another post which is a job ad for a Facebook Ads\nManager:\n\n\n-----\n\nFigure 13: Facebook post for Facebook Ads Manager.\n[While investigating the AICOK lead, we came across another Facebook page which is](https://www.facebook.com/AICOKGROUP)\nrelated to AICOK with a nearly identical post. The only difference is that this page had a\ndifferent domain:\n\n\n-----\n\nFigure 14: Another Facebook post for Facebook Ads Manager. Comment mentions this is a\nvirus.\nThe second domain, aicok[.]cc, no longer exists. However, there is a similar domain\n[(aicook[.]cc) which redirects to aicookhome[.]com. We have found another Facebook page](https://www.facebook.com/Aicookhome)\nwhich contains those domains:\n\n\n-----\n\nFigure 15: Facebook page of AICOOK\nThe page mentions that there were scams on Facebook for their brand “AICOOK,” while the\nDUCKTAIL Facebook pages are called “AICOK.”\n\nSince we have only identified one such instance, we can’t assess exactly whether this is a\none-time event or whether this is the usual operational method of DUCKTAIL.\n\nThere could a couple theories for what could be happening:\n\n1. Pure scam – AICOK was imitating AICOOK. DUCKTAIL would buy Ads for “AICOK”\n\nand unsuspecting victims would order items and never receive them. In addition, the\nfake shop would look for Ad Managers while infecting them with malware.\n\n\n-----\n\n2. Drop shipping / Affiliate program / White-label sale – AICOOK has an affiliate program.\n\nDUCKTAIL have pushed ads from stolen Facebook Ads accounts to promote the sale\nof various items. As seen in figures 9 and 10, the AICOK item price is much higher,\nalthough it is the same item. The reason for this could be that either they directly sold\nthe white-label item from the factory as the AICOK brand mimicking AICOOK, or they\ndid drop shipping for AICOOK items, buying them at the original price and selling at a\nmuch higher price for profit. Or simply as an affiliate and gained revenue from every\nitem sold while maximizing the profit by pushing a lot of ads from compromised\nFacebook Ads accounts.\n\n### MITRE ATT&CK:\n\n**Tactic** **Technique** **Description** **Observable**\n\n\nDiscovery T1057\nProcess\nDiscovery\n\nT1012 Query\nRegistry\n\nT1083 File\nand Directory\nDiscovery\n\nT1622\nDebugger\nEvasion\n\n\nIf there are\nless than 150\nrunning\nprocesses\nthe malware\nwon’t\nexecute.\n\nMalware tries\nto identify\ndefault\nbrowser.\n\nMalware tries\nto steal\nbrowser\ncookies from\nspecific\nlocations.\n\nMalware\nchecks if\ndebugger is\npresent.\n\n\nbool flag = Process.GetProcesses().Count() >\n\nregistryKey = Registry.LocalMachine.OpenSub\n\nstring text = Path.Combine(Environment.GetFo\n\nbool flag = DataChecker.DetectDebugger() || D\n\n\n-----\n\n**Tactic** **Technique** **Description** **Observable**\n\n\nPingReply pingReply = ping.Send(text, num, a\n\n4bef9919457b22db15a8f40277c45197300754\n\nhxxps://api.telegram.org/bot5448616453:AAHJ\n\n312e8a10903141991d4d3c4571b16fc4528b62\n\n312e8a10903141991d4d3c4571b16fc4528b62\n\nhttps://web.archive.org/web/20221201234010/\n\n\nDefense\nEvasion\n\n\nT1016.001\nSystem\nNetwork\nConfiguration\nDiscovery:\nInternet\nConnection\nDiscovery\n\nT1027.001\nObfuscated\nFiles or\nInformation:\nBinary\nPadding\n\n\nExfiltration T1567\nExfiltration\nOver Web\nService\n\nT1587.001\nDevelop\nCapabilities:\nMalware\n\nT1588.003\nObtain\nCapabilities:\nCode Signing\nCertificates\n\n\nInitial\nAccess\n\n\nT1566 .002\nPhishing:\nSpearphishing\nLink\n\n\nMalware tries\nto ping IP\naddress in\nHEX format\nto check\ninternet\nconnectivity.\n\nLNK files are\nartificially\ninflated to\nthe size of\n~300mb\n\nMalware\nuses\nTelegram\nAPI to\nexfiltrate\ndata\n\nDUCKTAIL\ncustom .NET\nmalware\n\nThreat actor\ncreated fake\norganizations\nand received\ncertificates\nfor them\nwhile signing\nmalware.\n\nThreat actor\nposted links\nto archives\nwith\nmalicious\nLNK files on\nReddit\n\n\n-----\n\n**Tactic** **Technique** **Description** **Observable**\n\n\nExecution T1204.002\nUser\nExecution:\nMalicious File\n\n\n312e8a10903141991d4d3c4571b16fc4528b62\n\nbool flag2 = Directory.GetFiles(text2).Any((strin\n\n\nCredential\nAccess\n\n### IOCs\n\n\nT1539 Steal\nWeb Session\nCookie\n\n\nDUCKTAIL\ncustom .NET\nmalware\n\nMalware\nsteals\ncookies from\nlocal\nbrowsers\n\n\nThe full list of IOCs can be found on our GitHub:\n[https://github.com/deepinstinct/DuckTail_IOCs](https://github.com/deepinstinct/DuckTail_IOCs)\n\n[Back To Blog](https://www.deepinstinct.com/blog)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2023/2023-03-09 - DUCKTAIL- Threat Operation Re-emerges with New LNK, PowerShell, and Other Custom Tactics to Avoid Detection.pdf"
    ],
    "report_names": [
        "2023-03-09 - DUCKTAIL- Threat Operation Re-emerges with New LNK, PowerShell, and Other Custom Tactics to Avoid Detection.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1680660573,
    "ts_updated_at": 1743041123,
    "ts_creation_date": 1680511890,
    "ts_modification_date": 1680511890,
    "files": {
        "pdf": "https://archive.orkl.eu/e87ebd5ddd4b76de3fd543dd19f20f3930540d4f.pdf",
        "text": "https://archive.orkl.eu/e87ebd5ddd4b76de3fd543dd19f20f3930540d4f.txt",
        "img": "https://archive.orkl.eu/e87ebd5ddd4b76de3fd543dd19f20f3930540d4f.jpg"
    }
}