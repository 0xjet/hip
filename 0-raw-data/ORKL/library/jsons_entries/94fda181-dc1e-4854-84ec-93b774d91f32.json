{
    "id": "94fda181-dc1e-4854-84ec-93b774d91f32",
    "created_at": "2023-01-12T15:04:21.017994Z",
    "updated_at": "2025-03-27T02:05:56.82613Z",
    "deleted_at": null,
    "sha1_hash": "64cbbb1246b5e851bef6b16fdd28aaf9d311dfde",
    "title": "2016-03-23 - Gozi ISFB Sourceccode",
    "authors": "",
    "file_creation_date": "2022-05-28T01:26:31Z",
    "file_modification_date": "2022-05-28T01:26:31Z",
    "file_size": 236965,
    "plain_text": "# malware/windows/gozi-isfb at master · gbrindisi/malware\n · GitHub\n\n**[github.com/gbrindisi/malware/tree/master/windows/gozi-isfb](https://github.com/gbrindisi/malware/tree/master/windows/gozi-isfb)**\n\ngbrindisi\n\n### master\n\n malware / windows / gozi-isfb /\n\n Failed to load latest commit information.\n\n . .\n\n AcDll\n\n BcClient\n\n Builder\n\n\n-----\n\n### Common\n\n Handle\n\n KeyLog\n\n Lib32\n\n Lib64\n\n RsaKey\n\n SocksLib\n\n ZipLib\n\n apdepack\n\n client\n\n crypto\n\n cryptor\n\n dname\n\n release(builder)\n\n\n-----\n\n### x64/release(builder)\n\n zconv\n\n Config.exe\n\n ReadMe.txt\n\n appack.exe\n\n av.c\n\n bkinst.h\n\n build.bat\n\n build_crm.bat\n\n builder.h\n\n client.ini\n\n config.h\n\n config.txt\n\n\n-----\n\n### crm.h\n\n crm.rc\n\n crm.vcproj\n\n crm_b.rc\n\n crm_dbg.rc\n\n crm_u.rc\n\n cschar.c\n\n desktop.c\n\n dll.c\n\n dll.def\n\n dll.h\n\n dll.vcproj\n\n dname.txt\n\n encrypts bat\n\n\n-----\n\n### exe.c\n\n format.txt\n\n id.h\n\n install.c\n\n isfb.sln\n\n masm64.rules\n\n ntdll.h\n\n pack_dll.bat\n\n pack_exe.bat\n\n private.key\n\n private.key.txt\n\n public.key\n\n public.key.txt\n\n\n-----\n\n### resource.h\n\n testconf.bin\n\n testconf.txt\n\n upack_dll.bat\n\n zconv.txt\n\n## ReadMe.txt\n\n\n-----\n\n```\nISFB программа бот предназначенная для анализа и модификации HTTP\nтраффика на компьютере клиента.\nПоддерживает все 32х и 64х битные Windows, начиная с Windows XP.\nПоддерживает все 32х и 64х битные версии Internet Explorer, начиная с\n6.0.\nПоддерживает все 32х и 64х битные версии Mozilla Firefox.\nПОддерживает все 32х битные версии Google Chrome.\nПрограмма способна устанавливаться и работать без привелегий\nадминистратора.\nОбрабатывает весь HTTP траффик браузера в том числе и шифрованый\nHTTPS.\nБот управляется с удаленного сервера, с помощью файлов конфигурации и\nкоманд.\nФайлы конфигурации и команд подписываются посредством RSA. При\nполучении файлов, бот проверяет цифровую подпись,\n и, в случае несоответвия подписи, файл игнорируется.\nПри первом запуске бот инициирует таймер. В дальнейшем, по таймеру,\nбот обращается на управляющий сервер за файлами.\nПоддерживается 2 способа поиска управляющего сервера:\n- перебор заданного списка доменных имен и выбор активного;\n- генерациия динамического списка доменных имен в зависимости от\nтекущей даты и конфигурации системы;\nАнализ траффика производится на основе специально сформированного\nфайла конфигурации, который бот получает с сервера.\nТакой файл может содержать следующие инструкции:\n- подмена HTML страницы целиком\n- замена фрагмента HTML страницы\n- скопировать фрагмент страницы и отправить на сервер\n- найти файл по маске и оправить на сервер\n- сделать скриншот экрана и отправить на сервер\nКроме файла конфигурации бот получает с сервера команды:\nGET_CERTS - экспортировать и выслать сертификаты, установленные\nв системном хранилище Windows. \n              Для XP выгружает, также, неэкспортируемые\nсертификаты.\nGET_COOKIES - собрать cookie FF и IE, SOL-файлы Flash, упаковать\nих с сохранением структуры \n              каталогов и выслать на сервер.\nCLR_COOKIES - удалить cookie FF и IE, SOL-файлы Flash.\nGET_SYSINFO - собрать системную информацию: тип процессора,\nверсию ОС, список процессов, список\n              драйверов, список установленных программ.\nKILL - убить ОС (работает только с правами администратора)\nREBOOT  - перезагрузить ОС\nGROUP=n  - сменить ID группы бота на n\nLOAD_EXE=URL - загрузить файл с указанного URL и запустить его\nLOAD_REG_EXE=URL- загрузить файл с указанного URL, зарегистрировать\nего в autirun и запустить\n\n```\n\n-----\n\n```\nLOAD_UPDATE URL загрузить апдейт программы и запустить\nGET_LOG  - отправить внутренний лог на сервер\nGET_FILES=* - найти все файлы, соответствующие заданной маске, и\nотправить на сервер\nSLEEP=n  - остановить обработку очереди команд на n\nмиллисекунд. (используется при долгих операциях)\nSEND_ALL - отправить все данные из очереди на отправку\nнемедленно. В противном случае, данные оправляются \n              по таймеру.\nLOAD_DLL=URL[,URL] - загрузить по указанному URL DLL и инжектить её в\nпроцесс explorer.exe.\n              первый URL для 32х-битной DLL, второй - для\n64х-битной.\nSOCKS_START=IP:PORT  - запустить сокс4\\5 сервер (при его наличии)\nSOCKS_STOP - остановить сокс4\\5 сервер\nGET_KEYLOG - отправить данные кейлоггера (при его наличии)\nGET_MAIL - активировать граббер E-Mail (при наличии) и\nотправить, полученные от него, данные\nGET_FTP  - активировать граббер FTP (при наличии) и отправить,\nполученные от него, данные\nSELF_DELETE - удалить софт из системы, включая все файлы и ключи\nреестра\nURL_BLOCK=URL - заблокировать доступ ко всем URL удовлетворяющим\nзаданной маске\nURL_UNBLOCK=URL - разблокировать доступ к URL, удовлетворяющим\nзаданной маске, ранее заблокированным командой URL_BLOCK\nFORMS_ON - включить граббер HTTP форм (если есть\nдефайн _ALWAYS_HTTPS, то граббер HTTPs остаётся включен всегда)\nFORMS_OFF - отключить граббер HTTP форм\nKEYLOG_ON[= list] - включить кейлог, для заданного списка\nпроцессов\nKEYLOG_OFF - отключить кейлог\nLOAD_INI=URL - загрузить упакованный INI-файл с указанного URL,\nсохранить его в рееестре и использовать вместо INI-файла,\n                        прикреплённого к софту с\nпомощью билдера. INI-файл должен быть упакован и подписан.\nLOAD_REG_DLL = name, URL[,URL] - загрузить DLL по указанному URL,\nсохранить её под заданным именем и зарегистрировать для\n                        автоматической загрузки после\nкаждого запуска системы\nUNREG_DLL = name - удалить из автоматической загрузки DLL c\nзаданным именем\nТехнические детали\nДропер - программа установки.\nДропер представляет собой исполняемый файл Windows (PE32). В файле, в\nвиде бинарного ресурса, содержятся \nдве упакованые DLL: 32х битный и 64х-битный бот.\nПри старте дропер распаковывает DLL и регистрирует их для\n\n```\n\n-----\n\n```\nавтозапуска. \nDLL распаковываются и регистрируются таким образом, чтобы иметь\nвозможность выполняться при любом уровне привелегий: \n как при администраторе, так и при пользователе.\nDLL - бот.\nБот представляет собой динамически загружаемую библиотеку (DLL). Для\nкаждой архитектуры собирается своя, соответствующаяя DLL.\nDLL-бот загружается во все запускаемые процессы.\nБот состоит из 2х логических компонентов: парсер и сервер. Парсер\nактивируется в контексте процесса-браузера.\nСервер активируется в контексте процесса оболочки (как правило\nexplorer.exe).\nПарсер выполняет следующие функции:\n- отправка/получение данных (получение команд, конфигов; отправка\nформ, файлов)\n- непосредственный перехват, анализ, и модификация HTTP траффика\nСервер (в контексте explorer.exe) выполняет:\n- файловые операции (поиск, создание и удаление файлов)\n- запуск программ, обновление\n- системные функции (перезагрузка, блокировка ОС)\nТаким образом, все операции, требующие привелегий, выполняются\nсервером в контексте explorer.exe, \nа все операции с сетью исключительно из браузера.\nСборка и настройка\nПроект собирается при помощи Microsoft Visual Studio 2005, либо более\nпоздней версии.\nВ проект интегрирован криптор, который используется по-умолчанию. \nВ результате сборки и криптовки получаются следующие файлы:\nRelease\\crm_p.exe\nRelease\\client_p.dll\nx64\\Release\\client_p.dll\nэто упакованные и криптованые версии бота и дропера, причем дропер\n(файл crm_p.exe) содержит в себе два других.\nНекриптованные версии бота лежат там же:\nRelease\\crm.exe\nRelease\\client.dll\nx64\\Release\\client.dll\nКроме бота, проект включает в себя:\nRelease\\dname.exe - утилита для генерации псевдо-случайных доменных\nимен;\nRelease\\rsakey.exe - утилита для подписывания файлов команд и\nконфига;\nconfig.exe - программа конфигуратор.\nОсновные настройки программы находятся в файлах id.h и config.h.\nid.h содержит номер группы бота.\nconfig.h содержит такие параметры как: список управляющих серверов,\n\n```\n\n-----\n\n```\nназвания URL ов для получения команд и конфигов,\n и для отсылки данных, а также различные ключи и параметры влияющие\nна настройку программы.\nСборка с билдером\nСуществует возможность собрать ISFB так, чтобы в дальнейшем\nприкреплять к DLL ключи и файлы настроек,\n не пересобирая проект.\n1. Собрать ISFB в конфигурации Release(Builder) под x86 и x64.\n2. Отредактировать файлы: \\public.key и \\client.ini, содержащие RSAключ и настройки программы соответственно.\n3. В консольном окне выполнить build.bat из папки \\Builder\n4. Забрать готовый installer.exe из папки \\Builder\\Release\nБатник build.bat запускает билдер, который прикрепляет к каджой DLL\n(для х86 и х64) файлы: \n public.key и client.ini.\nВ последствии обе DLL прикрепляются к инсталлеру.\nГотовый инсталлер сохраняется в файл \\Release\\install.exe\nСборка с BK\nСуществует возможность собрать ISFB вместе BK в один исполняемый\nфайл-установщик, так, чтобы в случае\n ошибки при установке BK, устанофщик извлекал DLL и устанавливал их\nотдельно.\nПримечание: папка, содержащая солюшен с BK2 должена находиться в той\nже директории, что и папка, содержащая ISFB.\n1. Собрать BK в конфигурации Release под х86 и х64.\n2. Собрать ISFB в конфигурации Release(Builder) под x86 и x64.\n3. Отредактировать файлы: \\public.key и \\client.ini.\n4. В консольном окне запустить bkbuild.bat из папки \\Builder\n5. Забрать собраный bksetup.exe, содержащий BK, ISFB-DLL и ISFBинсталлер, из \\Builder\\Release\nРабота в режиме инжекта из памяти\nДля работы в режиме инжекта из памяти необходимо установить значение\nфлага _INJECT_AS_IMAGE в файле \\common\\main.h в\n TRUE, и пересобрать проект. В этом случае инсталлер не создает DLL\nна диске, а копирует себя в одну из системных папок \n и регистрируется в Windows AutoRun. \nПри запуске инсталлер инжектит образ DLL, соответствующей\nархитектуры, в Explorer.exe, откуда, в свою очередь,\n сооответствующий образ DLL инектится во все пораждаемые процессы,\nразных архитектур.\nПлагины\n\n```\n\n-----\n\n```\nISFB поддерживает плагины: специально собраные, DLL, экпортирующие\nфункцию PluginRegisterCallbacks и вызывающие\n внутренние функции софта (например, функции отправки данных).\nДля загрузки плагина используется команда:\n LOAD_PLUGIN=URL[,URL] - где первый URL для 32х-битной версии DLL,\nвторой - 64x-битной.\nСофт скачивает DLL соответствующей архитектуры и инжектит её в\nexplorer.exe, затем вызывается функция \n PluginRegisterCallbacks, в которую передаётся указатель на список\nколлбэков (функций), реализованых\n внутри софта, которые может использовать плагин.\nОписание структур и прототипов функций для создания плагинов\nнаходится в файле \\common\\plugin.h\nСостав проекта\n\\AcDLL - библиотека инжектов. Реализует механизм инжекта DLL во все\nпораждаемые процессы, независимо от архитектуры. \n     Поддерживает два режима работы: инжект, непосредственно DLL и\nинжект образа DLL из памяти без создания файла на диске.\n\\ApDepack - библиотека на основе APLIB, релизующая функции\nраспаковки.\n\\BcClient - библиотека клиента для бэкконект сервера.\n\\Client - основная DLL приложения\n\\Common - библоиотека, реализующая общие функции, используемые в\nразных частях проекта. Такие как: чтение файлов, ключей реестра, \n     операции с потоками данных, со строками, с XML, хуки и т.п.\n\\Crypto - библиотека криптографических функций. Реализует следующие\nалгоритмы: CRC32, BASE64, MD5, RSA, RC6, AES, DES, SHA1.\n     Используется для подписи конфиг-файлов и файлов команд, а\nтакже, для саршифровки информации e-mail и ftp аккаунтов.\n\\Dname - программа генерации доменных имён на основе номера группы\nсофта и текущей даты.\n\\Ftp - библиотека FTP-грабберов.\n\\Handle - библиотека, реализующая хэш таблицу. Используется для\nпривязки хэндлов HTTP запросов к внутреннему контексту ISFB.\n     Также, используется кейлоггером, для группировки клавиатурных\nлогов по PID-ам и HWND.\n\\IM - DLL-плагин, реализующая граббер Instant Messangers.\n\\Install - программа-установщик ISFB.\n\\KeyLog - библиотека кейлоггер.\n\\Mail - библиотека E-mail грабберов.\n\\RsaKey - программа для шифрования и цифровой подписи конфиг-файлов и\nфайлов команд.\n\\SocksLib - библиотека, реализующая SOCKS4\\5-сервер.\n\\Sqlite3 - библиотека для работы с БД SQLLite. Используется IMграбберами.\n\\ZConv - программа-конвертер конфигов Zeus в конфиг-файлы ISFB.\n\n```\n\n-----",
    "language": "RU",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2016/2016-03-23 - Gozi ISFB Sourceccode.pdf"
    ],
    "report_names": [
        "2016-03-23 - Gozi ISFB Sourceccode.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535861,
    "ts_updated_at": 1743041156,
    "ts_creation_date": 1653701191,
    "ts_modification_date": 1653701191,
    "files": {
        "pdf": "https://archive.orkl.eu/64cbbb1246b5e851bef6b16fdd28aaf9d311dfde.pdf",
        "text": "https://archive.orkl.eu/64cbbb1246b5e851bef6b16fdd28aaf9d311dfde.txt",
        "img": "https://archive.orkl.eu/64cbbb1246b5e851bef6b16fdd28aaf9d311dfde.jpg"
    }
}