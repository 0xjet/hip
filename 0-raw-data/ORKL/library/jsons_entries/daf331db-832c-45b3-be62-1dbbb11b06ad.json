{
    "id": "daf331db-832c-45b3-be62-1dbbb11b06ad",
    "created_at": "2023-01-12T15:08:04.353098Z",
    "updated_at": "2025-03-27T02:14:11.935466Z",
    "deleted_at": null,
    "sha1_hash": "53e5f80aa8f538dc75107796e8c5e1e154307ec1",
    "title": "2022-04-01 - Dissecting Blackguard Info Stealer",
    "authors": "",
    "file_creation_date": "2022-05-27T23:06:50Z",
    "file_modification_date": "2022-05-27T23:06:50Z",
    "file_size": 2751462,
    "plain_text": "# Dissecting Blackguard Info Stealer\n\n**blog.cyble.com/2022/04/01/dissecting-blackguard-info-stealer/**\n\n## Sophisticated Variant Spotted in the wild\n\n\nApril 1, 2022\n\n\nThere has been a marked increase in Threat Actors (TAs) using Info Stealers to carry out their attacks,\n[and Cyble Research Labs has actively been tracking such threats. Info Stealers are a serious security](https://blog.cyble.com/2021/12/14/cyble-research-labs-analysis-report-of-stealer-malware-family/)\nthreat. The LAPSUS$ data extortion group, which was behind one of the most significant data breaches\n[in recent history, is also suspected of using Info Stealers to gain initial access to the organization’s](https://www.microsoft.com/security/blog/2022/03/22/dev-0537-criminal-actor-targeting-organizations-for-data-exfiltration-and-destruction/)\nnetwork.\n\nRecently Cyble Research Labs discovered a sample belonging to “Blackguard Stealer. “This stealer\nsurfaced in the cybercrime forums in April 2021. We came across multiple variants for this stealer in the\nwild, which highlights that it might be in use by a large number of TAs.\n\n\n-----\n\nFigure 1: Post on a cybercrime forum\nThe stealer is written in C# and is obfuscated using Obfuscar tool which is an open-source .NET\nobfuscation tool. The recent stealer sample has used the sleep() function multiple times to avoid sandbox\ndetection. It uses anti-debugging techniques, which prevent anyone from debugging the sample. It also\nuses an anti-forensic time stomping technique that changes the actual file timestamp to avoid being\nidentified during forensic activities.\n\nFigure 2:\n\nFile details of a recent variant\nThis stealer operates on the Malware-as-a-Service (MaaS) model, in which TAs lease out their software\nto carry out malicious activities. The Blackguard stealer is also available on a monthly and lifetime-based\nsubscription model. The TA has claimed on cybercrime forums that they can add clipper malware (A type\n\n\n-----\n\nof malware that modifies the crypto addresses in the clipboard to the one specified by TA) functionality to\nthe Blackguard stealer on demand. This indicates that the stealer can be customized for financial theft.\n\nFigure 3: Blackguard Stealer web panel from Cyber-Crime Forum\nThe TA stated that the stealer has functionalities to exfiltrate the data shown in the figure below.\n\nFigure 4: Stealer functionalities\n\n## Technical Analysis\n\n\n-----\n\nThe sample (SHA _256: 67843d45ba538eca29c63c3259d697f7e2ba84a3da941295b9207cdb01c85b71)_\nupon execution initially checks for the presence of a debugger and terminates its execution if a debugger\nis identified. The figure below shows the anti-debug function in the malware.\n\nFigure 5: Anti-debug check\nThe malware uses the Sleep() function several times as an anti-sandbox technique during its execution.\n_Thread.Sleep() method causes the current thread to stop the execution for the specified time in_\nmilliseconds. The figure below shows the Sleep() function used during the initial execution.\n\nFigure 6: Sleep() function\nAfter performing the Anti-debug checks, it calls the Start() method, which will call other methods, as seen\nin Figure 7. These methods will initiate the data stealing activity from the victim’s system. The malware\n[creates a directory in “c:\\users\\[username]\\Documents” for storing the stolen data from the victim’s](http://10.10.0.46/file:/c:/users/%5busername%5d/Documents)\nmachines.\n\nThe directory name is generated using the format: Random String + Computer Name + . + Username\n\nFigure 7: Start Method\n\n\n-----\n\nThe TA has encoded a few strings using base64 and gzip compression, so every time, an encoded string\nis passed as a parameter, the decrypt.Get() function is called to get the decoded strings. Figure 8 shows\nthe Decrypt.get() function.\n\nFigure 8: Decrypt.Get() Function\nThis stealer primarily targets browsers such as Chrome, Edge, and Firefox. The malware reads the files\nkey3.db, key4.db, logins.json, and cert9.db to steal browser data such as passwords, credit cards, history,\nand auto-filled data. The malware creates a folder named “Browsers,” where it will save the data in\nseparate .txt files.\n\nFigure 9: Stealing browser data\nUsing the GetDomainDetect() method, the malware enumerates all the .txt files in the “Browser” folder\ncreated in the previous step, reads them, and then checks if the following domains are present which\ninclude popular crypto exchanges and major bank websites. If the malware finds these targeted domains,\nit stores any credentials related to them.\n\n\n-----\n\nFigure 10: Domain Detection\nThe malware copies the victim’s data from the USERPROFILE directory and saves it in a folder named\n“Files.” The USERPROFILE directory contains data specific to multiple users in a system.\n\nFigure 11: Stealing files\nThis stealer has the capability to steal data from cold crypto wallets. A cold wallet stores the data offline\nand is thus more secure. The wallets targeted by the stealer can be seen in Figure 12.\n\n\n-----\n\nFigure 12: Targeted cold crypto wallets\nAfter this, the malware identifies the user’s geolocation by sending a request to\n_hxxps[:]//freegeoip[.]app/xml/. The malware receives the response and then saves it to a file named_\n“Information.txt.”\n\nAdditionally, it saves the system information, as shown in Figure 13.\n\nFigure 13: Information.txt\n\nIt then takes the screenshot of the victim’s system and saves it as “Screen.png” in the directory initially\ncreated by the malware.\n\n\n-----\n\nFigure 14: Screenshot of the system\nThe malware steals credentials from VPNs such as ProtonVPN, OpenVPN, and NordVPN. The malware\nfirst checks whether a VPN is installed or not by checking the directory “C:\\Users\\\n\n_[username]\\AppData\\Local\\[VPN name]. “_\n\nIf it finds a targeted VPN service, it steals the credentials from the configuration files, such as user.config,\netc., and copies the configuration file to the folder used for saving stolen data.\n\nFigure 15: Stealing VPNs credentials for Nord VPN\nThe malware steals data from Steam, a video game digital distribution service. The stealer identifies the\nSteam installation path by checking the registry key value at\n“HKEY_LOCAL_MACHINE\\Software\\Valve\\Steam.”\n\nIf Steam is installed on the machine, the malware steals Steam’s data from loginusers.vdf config file\npresent in the victim’s machine. The malware creates a folder named “Steam” and copies the .vdf file into\nit for its exfiltration purposes.\n\n\n-----\n\nFigure 16: Stealing Steam data from victim’s device\nAfter this, the malware checks for Discord tokens. It first searches for the following directories:\n\n_Discord\\\\Local Storage\\\\leveldb_\n_discordptb\\\\Local Storage\\\\leveldb_\n_Discord Canary\\\\leveldb_\n\nIf it can locate these directories, it checks for files ending with .ldb or .log and extracts Discord tokens\nfrom them using regular expression. Then it creates a folder named “Discord” and will write the stolen\ntokens to “Tokens.txt.”\n\nFigure 17: Stealing Discord tokens\nBlackguard stealer can also steal data from FileZilla. It checks if FileZilla\\recentservers.xml file is present\nin the ApplicationData folder and then extracts Host, Port, User, and Password from the\n“recentserver.xml.” This data is then written to “FileZilla\\FileZilla.log“.\n\nFigure 18: Stealing FileZilla data\n\n\n-----\n\nAfter this, the malware checks for the _Telegram Desktop\\tdata file in the ApplicationData folder. If this is_\npresent on the victim’s system, it creates a folder named “Telegram” which will be used to save files\nstolen from the “Telegram Desktop\\tdata” location.\n\nFigure 19: Stealing Telegram session\nThe TA in this sample is using Telegram for exfiltrating the data. We found the following Telegram API\nused by the malware during our analysis for exfiltrating data.\n\nURL: hxxps[:]//api.telegram.org/bot/sendDocument?chat_id=\n\nThe malware compresses the stolen data before exfiltration. Figure 20 shows the folders created by the\nmalware.\n\nFigure 20:\n\nDirectories Created\n\n## Conclusion\n\nWe have observed and analyzed multiple samples of this Info stealer in the wild. It appears that this\nparticular TA is trying to make the stealer even more evasive with every update, as the anti-analysis and\nobfuscation levels are quite different between the oldest and most recent samples. Info Stealers are\nemerging as a major concern as they are assisting TAs to gain initial access to corporate networks. It is\nthus, increasingly necessary to follow basic cyber-hygiene and security practices as listed below.\n\n## Our Recommendations:\n\n\n-----\n\nAvoid downloading pirated software from warez/torrent websites. The Hack Tool present on sites\nsuch as YouTube, torrent sites, etc., mainly contains such malware.\nUse strong passwords and enforce multi-factor authentication wherever possible.\nTurn on the automatic software update feature on your computer, mobile, and other connected\ndevices.\nUse a reputed anti-virus and internet security software package on your connected devices,\nincluding PC, laptop, and mobile.\nRefrain from opening untrusted links and email attachments without first verifying their authenticity.\nEducate employees in terms of protecting themselves from threats like phishing’s/untrusted URLs.\nBlock URLs that could be used to spread the malware, e.g., Torrent/Warez.\nMonitor the beacon on the network level to block data exfiltration by malware or TAs.\nEnable Data Loss Prevention (DLP) Solution on the employees’ systems.\n\n## MITRE ATT&CK® Techniques \n\n**Tactic** **Technique ID** **Technique Name**\n\n**Execution** [T1204](https://attack.mitre.org/techniques/T1204/) User Execution\n\n\n**Defense Evasion** [T1497.001](https://attack.mitre.org/techniques/T1497/001/)\n\n[T1027](https://attack.mitre.org/techniques/T1027/)\n\n**Credential Access** [T1555](https://attack.mitre.org/techniques/T1555/)\n\n[T1539](https://attack.mitre.org/techniques/T1539/)\n\n[T1552](https://attack.mitre.org/techniques/T1552/)\n\n[T1528](https://attack.mitre.org/techniques/T1528/)\n\n\nVirtualization/Sandbox Evasion: System Checks\n\nObfuscated Files or Information\n\nCredentials from Password Stores\n\nSteal Web Session Cookie\n\nUnsecured Credentials\n\nSteal Application Access Token\n\n\n**Collection** [T1113](https://attack.mitre.org/techniques/T1113/) Screen Capture\n\n\n**Discovery** [T1087](https://attack.mitre.org/techniques/T1087/)\n\n[T1518](https://attack.mitre.org/techniques/T1518/)\n\n[T1057](https://attack.mitre.org/techniques/T1057/)\n\n[T1124](https://attack.mitre.org/techniques/T1124/)\n\n[T1007](https://attack.mitre.org/techniques/T1007/)\n\n[T1614](https://attack.mitre.org/techniques/T1614/)\n\n\nAccount Discovery\n\nSoftware Discovery\n\nProcess Discovery\n\nSystem Time Discovery\n\nSystem Service Discovery\n\nSystem Location Discovery\n\n\n**Command and Control** [T1095](https://attack.mitre.org/techniques/T1095/) Non-Application Layer Protocol\n\n**Exfiltration** [T1041](https://attack.mitre.org/techniques/T1041/) Exfiltration Over C2 Channel\n\n## Indicators of Compromise (IoCs): \n\n**Indicators** **Indicator**\n**type**\n\n\n**Description**\n\n**Stealer**\n**Payload**\n\n\nef8385f6ccc6dc6aa6fa9833e13c1cf3\n2fe6c0b8cef78d409d29fbd0d1260f39874b068e\n5b8d0e358948f885ad1e6fa854f637c1e30036bc217f2c7f2579a8782d472cda\n\n\n**Md5**\n**SHA-1**\n**SHA-**\n**256**\n\n\n-----\n\nd4e02002916f18576204a3f1722a958b\n33ec434ad2c31de93e758b9d53fcf211c5b13702\n9fff9895c476bee0cba9d3e209e841873f1756d18c40afa1b364bd2d8446997c\n\neb6c563af372d1af92ac2b60438d076d\n9895725811ae5fda88629781daaa439c95a4976e\n67843d45ba538eca29c63c3259d697f7e2ba84a3da941295b9207cdb01c85b71\n\na6651dc499e0b9141a6fa0f411f885ea\na421e5753596d4c07ee8df06c2080c03507f7a37\n5ce632f1f10c96a7524bf384015c25681ef4771f09a6b86883a4da309d85452a\n\n\n**Md5**\n**SHA-1**\n**SHA-**\n**256**\n\n**Md5**\n**SHA-1**\n**SHA-**\n**256**\n\n**Md5**\n**SHA-1**\n**SHA-**\n**256**\n\n\n**Stealer**\n**Payload**\n\n**Stealer**\n**Payload**\n\n**Stealer**\n**Payload**\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-04-01 - Dissecting Blackguard Info Stealer.pdf"
    ],
    "report_names": [
        "2022-04-01 - Dissecting Blackguard Info Stealer.pdf"
    ],
    "threat_actors": [
        {
            "id": "52d5d8b3-ab13-4fc4-8d5f-068f788e4f2b",
            "created_at": "2022-10-25T16:07:24.503878Z",
            "updated_at": "2025-03-27T02:02:10.261742Z",
            "deleted_at": null,
            "main_name": "Lapsus$",
            "aliases": [
                "DEV-0537",
                "Strawberry Tempest"
            ],
            "source_name": "ETDA:Lapsus$",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "be5097b2-a70f-490f-8c06-250773692fae",
            "created_at": "2022-10-27T08:27:13.22631Z",
            "updated_at": "2025-03-27T02:00:55.534879Z",
            "deleted_at": null,
            "main_name": "LAPSUS$",
            "aliases": [
                "LAPSUS$",
                "DEV-0537",
                "Strawberry Tempest"
            ],
            "source_name": "MITRE:LAPSUS$",
            "tools": [
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "d4b9608d-af69-43bc-a08a-38167ac6306a",
            "created_at": "2023-01-06T13:46:39.335061Z",
            "updated_at": "2025-03-27T02:00:03.053961Z",
            "deleted_at": null,
            "main_name": "LAPSUS",
            "aliases": [
                "LAPSUS$",
                "DEV-0537",
                "SLIPPY SPIDER",
                "Strawberry Tempest"
            ],
            "source_name": "MISPGALAXY:LAPSUS",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "2347282d-6b88-4fbe-b816-16b156c285ac",
            "created_at": "2024-06-19T02:03:08.099397Z",
            "updated_at": "2025-03-27T02:05:17.390442Z",
            "deleted_at": null,
            "main_name": "GOLD RAINFOREST",
            "aliases": [
                "Strawberry Tempest ",
                "Lapsus$"
            ],
            "source_name": "Secureworks:GOLD RAINFOREST",
            "tools": [
                "Mimikatz"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673536084,
    "ts_updated_at": 1743041651,
    "ts_creation_date": 1653692810,
    "ts_modification_date": 1653692810,
    "files": {
        "pdf": "https://archive.orkl.eu/53e5f80aa8f538dc75107796e8c5e1e154307ec1.pdf",
        "text": "https://archive.orkl.eu/53e5f80aa8f538dc75107796e8c5e1e154307ec1.txt",
        "img": "https://archive.orkl.eu/53e5f80aa8f538dc75107796e8c5e1e154307ec1.jpg"
    }
}