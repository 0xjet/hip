{
    "id": "e133900d-068b-4ffb-9507-983014b8e712",
    "created_at": "2023-01-12T15:09:40.763298Z",
    "updated_at": "2025-03-27T02:08:36.120861Z",
    "deleted_at": null,
    "sha1_hash": "f448be2cac056531b1d3e840564e72f9c79787ad",
    "title": "2019-07-16 - Analysis- Server-side polymorphism & PowerShell backdoors",
    "authors": "",
    "file_creation_date": "2022-05-28T04:51:09Z",
    "file_modification_date": "2022-05-28T04:51:09Z",
    "file_size": 1083601,
    "plain_text": "# Analysis: Server-side polymorphism & PowerShell backdoors\n\n**[gdatasoftware.com/blog/2019/07/35061-server-side-polymorphism-powershell-backdoors](https://www.gdatasoftware.com/blog/2019/07/35061-server-side-polymorphism-powershell-backdoors)**\n\n07/16/2019\n\nG DATA Blog\nMalware actors very rarely stick to the same script for extended periods of time. They constantly modify\nand update their attack methods. Recently we have observed malware that uses server-side\npolymorphism to hide its payload, which consists of a backdoor fully written in PowerShell.\n\n[Last year, we blogged about the Rozena malware and how this backdoor incorporated PowerShell to](https://www.gdatasoftware.com/blog/2018/06/30862-fileless-malware-rozena)\nexecute its shellcode. However, malware authors are not sticking to the same script, constantly\nmodifying and updating their attack methods. This time we’ve observed a new malware that used\nserver-side polymorphism to hide its payload, which is a backdoor that is fully written in PowerShell.\n\n## Initial Attack Vector\n\n\n-----\n\nInception and attack workflow (click to enlarge)\n\nThe sample was obtained as a malicious Visual Basic Script (VBS) attachment from an email, with the\nfile named as “INAIL_Comunica_133113944054522074634191697732.vbs”. By the looks of its\nfilename, it claims to be a notice from an Italian organization for workplace safety insurance called the\nIstituto Nazionale Assicurazione Infortuni sul Lavoro (INAIL).\nUpon execution, this malicious VBS will invoke a downloader written in PowerShell that downloads two\nfiles from its command and control (CNC) servers:\n```\nhxxp://adm.esurf.info/api?wead (SkypeApp64.exe)\nhxxp://space.4fallingstar.info/12.php?vid=pec5 (SearchI32.js)\n\n```\nWhile the URL of the file SkypeApp64.exe was already down as of analysis, the sample remains\nmalicious even without the executable. The CNC server that hosts the file SearchI32.js has server-side\npolymorphism, in which the hosted JavaScript (JS) files are modified each time they are accessed,\nmaking static detection difficult.\nThe file SearchI32.js is an obfuscated JS that invokes another PowerShell downloader that will again\ndownload two files, which are both saved in the default Windows temporary folder %temp%:\n```\nhxxp://green.4107irishivy.info/cryptbody2.php (SearchI32.txt)\nhxxp://green.4107irishivy.info/loadercrypt_823EF8A810513A4071485C36DDAD4CC3.php (SearchI32.js)\n\n## Backdoor Downloads\n\n```\n\n-----\n\nPowerShell Extractor Analyzer’s decoded script block of the\n\nbackdoor (Click to enlarge)\n\nSearchI32.js downloads and executes a new version of itself as a form of persistence. At first glance,\nthe file SearchI32.txt looks like junk. However, it is decrypted and executed by the JS file, and is the\nmain PowerShell backdoor.To skip several deobfuscation stages for unveiling the backdoor, we used\nthe [PowerShell Extractor Analyzer (PEA), a publicly-available tool developed within G DATA to analyze](https://github.com/silenttype/PEA)\nSearchI32.js.\n\nThe first part of the code consists of evasion techniques. The backdoor will first try to check if the\ninfected system’s language is Russian, Ukrainian, Belarusian, or Chinese, and if the system is running\nunder VirtualBox or VMWare (suggensting it is analyzed in a virtual environment - a technique often\nemployed by malware analysts), terminating the execution if either check is matched:\n\nBackdoor evasion techniques: checking the system language and whether it is run in a VM\nAs part of its persistence, it also adds a shortcut file on the startup folder. The shortcut links to the\ndownloaded SearchI32.js, with a description of “Windows Indexing Service” to throw off the user from its\nmalicious behavior. The command-line script host cscript.exe is then used to execute the Searchi32.js.\n\nCredential and information grabbing (click to enlarge)\n\nThe backdoor will then create a System.Net.CredentialCache object to store the obtained information\nfrom the user. This object will be used as for downloading commands from the CNC server and at the\nsame time posting the victim’s information. The collected information is comprised of:\n\n**$bot_id– Created ID for the victim that contains the computer name, computer model, and disk**\ndrive signatures\n**$bot_os– Operating system build version**\n**$ver– Backdoor version**\n\n\n-----\n\n**$psver– PowerShell version**\n\nThe backdoor will use the DownloadString method to obtain the body of the CNC server site, parsing\nthe content for its backdoor commands. The CNC server site body is expected to contain the\ncommands in this form:\n```\n[command]|[URL for the malicious PowerShell script]\n\n```\nThe backdoor will repeatedly access its CNC server and wait for one of the following the commands:\n\n**m1 – Single command execution. Downloads a single string of URL from the CNC and executes**\nit.\n**m  – Multiple command execution. Downloads multiple strings of URL from the CNC and**\nexecutes each string.\n**u   – Downloads and executes an updated version of SearchI32.js and SearchI32.txt from the**\nCNC server.\n\nFor the m1 and m commands, the URL being downloaded will contain the PowerShell script to be\nexecuted for its malicious activity.\n\nWe encountered the backdoor updating several times through its commands, like\n```\nu| hxxp://green.4107irishivy.info/cryptbody2.php|hxxp://green.4107irishivy.info/l2.php\n\n```\nand\n```\nm1| hxxp://red.340airport.com/u2\n\n```\nThe latter of which was the latest URL as of writing, where the JS decryptor/loader and PowerShell\nbackdoor scripts were completely updated. The CNC server domains were updated during analysis\n(e.g. hxxp://green.4107irishivy.info/ to hxxp://green.4107irishivy.info/), making this campaign difficult to\ndetect.\n\nBackdoor command parsing (Click to enlarge)\n\nThe backdoor using its update command (click\n\nto enlarge)\nThe updated version of the backdoor is still similar on how it receives its commands from the CNC\nserver, but had some several updates in its script:\n\n\n-----\n\nAdds the updated JS file to the scheduled tasks using the Windows task scheduler (schtasks.exe),\nfor persistence.\nDropping location of downloaded files has been changed from %temp% to\n%appdata%\\Roaming\\Microsoft\nUsage of a domain generation algorithm (DGA) when it fails to connect to the main CNC server.\n\nUpdated JS decryptor and Backdoor\n\n## Defense is easy\n\nSince this malware uses email attachments as the initial attack vector like many other types of malware,\nit always pays to be safe by validating the source of any emails sent to you that contains attachments or\nlinks to downloads. Never open attachments or links from unvalidated email addresses. Always keep\nyour anti-virus and operating systems up to date, to ensure your systems are protected against these\nnew types of malware\n\n\n-----\n\nIf you are interested to know more of the in-depth analysis of this backdoor campaign, you may visit the\nfollowing link:\n\n## Indicators of Compromise\n\n**URL that attempts to download the executable:**\n\nhxxp://adm.esurf.info/api?wead\n**JS script:**\n\n**Sample hashes:**\n\nd3089f023d0715058773ea0cec037f92a5ce52958fdfe56b53ab291b343cee4f (Initial\ndownload of SearchI32.js)\n20317970e11e1dbdc3142b1c4fdf7258ec2d6cb29ac7d2a5ec21ef8eff38ebcc\n(Succeeding download of SearchI32.js)\n**URLs:**\n\nhxxp://space.4fallingstar.info/l2.php\nhxxp://green.4107irishivy.info/loadercrypt_823EF8A810513A4071485C36DDAD4CC3.php\nhxxp://red.1407cty13pec.com/l2.php\nhxxp://sad.childrensliving.com/l2.php\n**Obfuscated PS1 backdoor:**\n\n**Sample hash:**\n\n1c9d3bcea90d3ac24cef4302fa081d8f6e50a580a74d204923ee9491f0008c6e\n(SearchI32.txt)\n**URLs**\n\nhxxp://space.4fallingstar.info/cryptbody.php\nhxxp://green.4107irishivy.info/cryptbody2.php\nhxxp://red.1407cty13pec.com/cryptbody.php\nhxxp://sad.childrensliving.com/cryptbody2.php\n**Other URLs that were used by the malware:**\n\nhxxp://stats.emeraldsurfwatermanagement.com\nhxxp://green.dddownhole.com\nhxxp://green.nogel.tech\nhxxp://red.340airport.com\nhxxp://wws.rheovesthr.com\nhxxp://red.1407cty13pec.com\n\n**G DATA Security Lab**\n\nVirus-Analyst Team\n\n**Related articles:**\n\n\n-----\n\nWhere we go, we don't need files: Analysis of fileless malware \"Rozena\"\n\nFileless malware leverages exploits to run malicious commands or launch scripts directly from memory\nusing legitimate system tools such as Windows…\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-07-16 - Analysis- Server-side polymorphism & PowerShell backdoors.pdf"
    ],
    "report_names": [
        "2019-07-16 - Analysis- Server-side polymorphism & PowerShell backdoors.pdf"
    ],
    "threat_actors": [
        {
            "id": "77b28afd-8187-4917-a453-1d5a279cb5e4",
            "created_at": "2022-10-25T15:50:23.768278Z",
            "updated_at": "2025-03-27T02:00:55.5423Z",
            "deleted_at": null,
            "main_name": "Inception",
            "aliases": [
                "Inception Framework",
                "Cloud Atlas"
            ],
            "source_name": "MITRE:Inception",
            "tools": [
                "PowerShower",
                "VBShower",
                "LaZagne"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "2c7ecb0e-337c-478f-95d4-7dbe9ba44c39",
            "created_at": "2022-10-25T16:07:23.690871Z",
            "updated_at": "2025-03-27T02:02:09.921431Z",
            "deleted_at": null,
            "main_name": "Goblin Panda",
            "aliases": [
                "1937CN",
                "Conimes",
                "Cycldek",
                "Goblin Panda"
            ],
            "source_name": "ETDA:Goblin Panda",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "Agent.dhwf",
                "BackDoor-FBZT!52D84425CDF2",
                "BlueCore",
                "BrowsingHistoryView",
                "ChromePass",
                "CoreLoader",
                "Custom HDoor",
                "Destroy RAT",
                "DestroyRAT",
                "DropPhone",
                "FoundCore",
                "HDoor",
                "HTTPTunnel",
                "JsonCookies",
                "Kaba",
                "Korplug",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "NBTscan",
                "NewCore RAT",
                "PlugX",
                "ProcDump",
                "PsExec",
                "QCRat",
                "RainyDay",
                "RedCore",
                "RedDelta",
                "RoyalRoad",
                "Sisfader",
                "Sisfader RAT",
                "Sogu",
                "TIGERPLUG",
                "TVT",
                "Thoper",
                "Trojan.Win32.Staser.ytq",
                "USBCulprit",
                "Win32/Zegost.BW",
                "Xamtrav",
                "ZeGhost",
                "nbtscan"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "7d553b83-a7b2-431f-9bc9-08da59f3c4ea",
            "created_at": "2023-01-06T13:46:39.444946Z",
            "updated_at": "2025-03-27T02:00:03.093712Z",
            "deleted_at": null,
            "main_name": "GOBLIN PANDA",
            "aliases": [
                "Conimes",
                "Cycldek"
            ],
            "source_name": "MISPGALAXY:GOBLIN PANDA",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536180,
    "ts_updated_at": 1743041316,
    "ts_creation_date": 1653713469,
    "ts_modification_date": 1653713469,
    "files": {
        "pdf": "https://archive.orkl.eu/f448be2cac056531b1d3e840564e72f9c79787ad.pdf",
        "text": "https://archive.orkl.eu/f448be2cac056531b1d3e840564e72f9c79787ad.txt",
        "img": "https://archive.orkl.eu/f448be2cac056531b1d3e840564e72f9c79787ad.jpg"
    }
}