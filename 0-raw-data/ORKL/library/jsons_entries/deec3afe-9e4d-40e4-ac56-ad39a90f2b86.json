{
    "id": "deec3afe-9e4d-40e4-ac56-ad39a90f2b86",
    "created_at": "2023-01-12T15:09:48.805683Z",
    "updated_at": "2025-03-27T02:11:47.764682Z",
    "deleted_at": null,
    "sha1_hash": "1658ed935e15a24e83745109c43e640cd19582e7",
    "title": "2017-05-12 - Global WannaCry ransomware outbreak uses known NSA exploits",
    "authors": "",
    "file_creation_date": "2022-05-28T03:48:56Z",
    "file_modification_date": "2022-05-28T03:48:56Z",
    "file_size": 863013,
    "plain_text": "# Global WannaCry ransomware outbreak uses known NSA exploits\n\n**[blog.emsisoft.com/2017/05/12/wcry-ransomware-outbreak/](http://blog.emsisoft.com/2017/05/12/wcry-ransomware-outbreak/)**\n\nHolger May 12, 2017\n\n[Following the emergence of the Jaff ransomware attack campaign earlier this week, another,](https://blog.emsisoft.com/2017/05/11/jaff-ransomware-the-new-locky/)\neven bigger outbreak is making headlines. The culprit? A new ransomware family called\nWannaCry or WCry.\n\n\n-----\n\nSpotted earlier today, WCry caught the attention of the team due to it being spread via the\nrecently exposed NSA shadow broker exploits. WCry took many businesses and public\ninstitutions by surprise, including telco giant Telefonica in Spain and the National Health\nService in the United Kingdom, and has already infected tens of thousands of systems\nacross the globe.\n\n[Security researcher MalwareTech created](https://twitter.com/MalwareTechBlog) [a map of overall infections and](https://intel.malwaretech.com/botnet/wcrypt) [a real time map of](https://intel.malwaretech.com/WannaCrypt.html)\ninfections to visualise the number of WCry infections, which has surpassed the 350,000\ninfection mark across more than 100 countries worldwide.\n\n## Meet WannaCry Ransomware\n\nThe WCry ransomware, also referred to as WNCry, WannaCry, WanaCrypt0r or Wana\nDecrypt0r, was originally spotted in campaigns in early February 2017, with more campaigns\nfollowing in March. But it wasn’t until now that a global attack had been registered.\n\nIt has been written in C++ and no attempts have been made to hide the majority of the code.\nLike most ransomware families, WCry renames files it encrypts, adding the .WNCRY\nextension.\n\nWhen infecting a system, it presents a ransom screen asking to pay $300 worth of bitcoins:\n\n\n-----\n\nUnlike most ransomware campaigns, which usually target specific regions, WCry is targeting\nsystems around the globe. So it comes as no surprise that the ransomware authors provide\nlocalised ransomware message for more than 20 languages:\n\nBulgarian, Chinese (simplified), Chinese (traditional), Croatian, Czech, Danish, Dutch,\nEnglish, Filipino, Finnish, French, German, Greek, Indonesian, Italian, Japanese,\nKorean, Latvian, Norwegian, Polish, Portuguese, Romanian, Russian, Slovak,\nSpanish, Swedish, Turkish, Vietnamese\n\n## How do you get infected with WCry ransomware?\n\nAt the moment, WCry is primarily spreading via the leaked NSA exploits that the Shadow\nBrokers group released recently. More specifically, French researcher Kaffine was the first to\nsuspect that WCry was being spread via the ETERNALBLUE exploit.\n\nETERNALBLUE exploits a vulnerability in the Microsoft SMBv1 protocol, allowing an attacker\nto take control over systems which:\n\nhave the SMBv1 protocol enabled\nare accessible from the internet and\n\n\n-----\n\n[have not been patched by the MS17-010 fix released back in March 2017](https://technet.microsoft.com/en-us/library/security/ms17-010.aspx)\n\nIn addition, it appears that the malware authors are also taking advantage of\nDOUBLESPEAR, a backdoor that is usually installed via the ETERNALBLUE exploit and\npersisting on the system. So if your system was compromised by ETERNALBLUE previously,\nchances are your system is still vulnerable, even if the initial SMBv1 vulnerability was\npatched.\n\nThe ransomware executable itself can be best described as a dropper that contains all the\ndifferent ransomware components in form of a password protected ZIP archive within its file.\nWhen run, it will start unpacking its components to the directory it was executed in using the\n[hardcoded password “[email protected]”. Closer inspection of the ZIP archive reveals the](http://blog.emsisoft.com/cdn-cgi/l/email-protection)\nfollowing files:\n\n**b.wnry – Ransom desktop wallpaper**\n**c.wnry – Configuration file containing C2 server addresses, BitCoin Wallet etc.**\n**r.wnry – Ransom note**\n**s.wnry – ZIP archive containing the TOR client**\n**t.wnry – The encryption part of the ransomware encrypted using a WanaCry specific**\nformat; can be decrypted using the private key embedded inside the ransomware\nexecutable.\n**u.wnry – Decrypter executable**\n**Taskdl.exe – Deletes all temporary files created during encryption (.WNCRYT)**\n**Taskse.exe – Runs given program in all user sessions**\n**msg* – Language files (currently 28 different languages)**\n\nIn addition the ransomware creates a couple of additional files during its execution:\n\n**00000000.eky – Encryption key for the t.wnry file which stores the actual file encryption**\ncomponent used by the ransomware. It is encrypted using the public key that belongs\nto a private key embedded inside the ransomware.\n**00000000.pky – Public key used by the ransomware to encrypt the generated AES**\nkeys that are used to encrypt the user’s files\n**00000000.res – Command & Control Server (C2) communication results**\n\nA list of all changes made by the ransomware to an infected system, can be found in the\n“Indicators of Compromise” section below.\n\n## WCry key generation and encryption\n\nWCry ransomware uses a combination of RSA and AES-128-CBC to encrypt the victim’s\ndata. To facilitate this process, is uses the Windows CryptoAPI for RSA, but a custom\nimplementation for the AES encryption.\n\n\n-----\n\nInterestingly, the encryption routine is stored in a separate component within the t.wnry file,\nand is itself encrypted using the same method used by the ransomware to encrypt user files.\nThis was likely done to make the malware analysis more difficult. The module is loaded into\nmemory using a custom loader and executed from there, without ever being written to the\nvictim’s disk unencrypted.\n\nWhen WCry arrives on a system, it will first import a hardcoded private RSA key that is used\nto decrypt the file encryption component stored within “t.wnry”. Once done, the ransomware\nwill generate a new private RSA key. That RSA key is then submitted to the malware’s\ncommand and control server and a copy of the generated public key is stored on the system.\n\nThe ransomware then searches all available drives and network shares for files with one of\nthe following extensions:\n\n.der, .pfx, .key, .crt, .csr, .p12, .pem, .odt, .ott, .sxw, .stw, .uot, .3ds, .max, .3dm, .ods,\n.ots, .sxc, .stc, .dif, .slk, .wb2, .odp, .otp, .sxd, .std, .uop, .odg, .otg, .sxm, .mml, .lay,\n.lay6, .asc, .sqlite3, .sqlitedb, .sql, .accdb, .mdb, .db, .dbf, .odb, .frm, .myd, .myi, .ibd,\n.mdf, .ldf, .sln, .suo, .cs, .cpp, .pas, .asm, .js, .cmd, .bat, .ps1, .vbs, .vb, .pl, .dip, .dch,\n.sch, .brd, .jsp, .php, .asp, .rb, .java, .jar, .class, .sh, .mp3, .wav, .swf, .fla, .wmv, .mpg,\n.vob, .mpeg, .asf, .avi, .mov, .mp4, .3gp, .mkv, .3g2, .flv, .wma, .mid, .m3u, .m4u, .djvu,\n.svg, .ai, .psd, .nef, .tiff, .tif, .cgm, .raw, .gif, .png, .bmp, .jpg, .jpeg, .vcd, .iso, .backup,\n.zip, .rar, .7z, .gz, .tgz, .tar, .bak, .tbk, .bz2, .PAQ, .ARC, .aes, .gpg, .vmx, .vmdk, .vdi,\n.sldm, .sldx, .sti, .sxi, .602, .hwp, .snt, .onetoc2, .dwg, .pdf, .wk1, .wks, .123, .rtf, .csv,\n.txt, .vsdx, .vsd, .edb, .eml, .msg, .ost, .pst, .potm, .potx, .ppam, .ppsx, .ppsm, .pps,\n.pot, .pptm, .pptx, .ppt, .xltm, .xltx, .xlc, .xlm, .xlt, .xlw, .xlsb, .xlsm, .xlsx, .xls, .dotx,\n.dotm, .dot, .docm, .docb, .docx, .doc, .c, .h\n\nOnce done, the malware will generate a new 128 bit AES key for every file it found, which is\nencrypted using the public RSA key generated earlier and the RSA-encrypted AES key is\nstored within the header of the encrypted file, together with the file marker “WANACRY!”. The\nAES key is then used to encrypt the file’s content.\n\nUnfortunately, after evaluating the way WCry performs its encryption, there is no way to\nrestore encrypted files without access to the private key generated by the ransomware. So\nit’s not likely a free WCry ransomware decrypter will be available for victims.\n\n## How can I protect myself from WannaCry?\n\nAs an emergency measure, make sure to have the latest security updates installed on your\nWindows computers and servers. Given the scale of the attack, Microsoft even took the\nunusual step to release security patches for “unsupported systems” such as Windows XP\nand Windows Server 2003.\n\n\n-----\n\n[As explained in our ransomware article, the best protection still remains a reliable and](https://blog.emsisoft.com/2015/12/22/how-its-done-right-emsisofts-behavior-blocker-vs-20-crypto-ransomware-families/)\nproven backup strategy, especially since the encryption used by WCry ransomware is\nsecure. The only way to get the data back is through the help of the ransomware author or\nvia restoring from backups. Making sure to install critical windows updates is also a very\nimportant step in protecting a system, as WCry only seems to be spreading via the SMBv1\nexploit currently, which has been patched for 2 months already.\n\nApart from regular backups, you will be glad to hear that the Behavior Blocker technology\n[used by Emsisoft Anti-Malware has proven to be the next best defense, as it has caught the](https://www.emsisoft.com/en/software/antimalware/)\nransomware before the file could execute and thus once again keeping our users protected\nfrom this and hundreds of other ransomware families without the need for signatures.\n\nEmsisoft Anti-Malware users are protected from WannaCry ransomware by our Behavior Blocker.\n\nWe consider ransomware one of the biggest threats of the past year and plan to do our best\nto continue our excellent track record in the next year, to keep our users as protected as\npossible.\n\nIt seems to be an impossible puzzle yet it’s easy to [solve the Rubik’ Cube using algorithms.](https://ruwix.com/the-rubiks-cube/how-to-solve-the-rubiks-cube-beginners-method/)\n\n### Download now: Emsisoft Anti-Malware free trial.\n\nAntivirus software from the world’s leading ransomware experts. Get your free trial today. Try\nIt Now\n\n\n-----\n\n## Indicators of Compromise\n\n### Registry:\n\nHKLMSOFTWAREWanaCrypt0r\nHKLMSOFTWAREMicrosoftWindowsCurrentVersionRun<random>: “”<ransomware\ndirectory>tasksche.exe””\nHKLMSOFTWAREWanaCrypt0rwd: “<ransomware directory>”\nHKUS-1-5-21-677641349-3533616285-3951951702-1000Control\nPanelDesktopWallpaper:\n“%APPDATA%MicrosoftWindowsThemesTranscodedWallpaper.jpg”\nHKUS-1-5-21-677641349-3533616285-3951951702-1000Control\n[PanelDesktopWallpaper: “<ransomware directory>@[email protected]”](http://blog.emsisoft.com/cdn-cgi/l/email-protection)\n\n### File system:\n\n[@[email protected] – Placed inside every folder that contains encrypted files](http://blog.emsisoft.com/cdn-cgi/l/email-protection)\n[@[email protected] – Placed inside every folder that contains encrypted files](http://blog.emsisoft.com/cdn-cgi/l/email-protection)\n[%DESKTOP%@[email protected]](http://blog.emsisoft.com/cdn-cgi/l/email-protection)\n[%DESKTOP%@[email protected]](http://blog.emsisoft.com/cdn-cgi/l/email-protection)\n%APPDATA%torcached-certs\n%APPDATA%torcached-microdesc-consensus\n%APPDATA%torcached-microdescs.new\n%APPDATA%torlock\n%APPDATA%torstate\n<ransomware directory>0000000.eky\n<ransomware directory>0000000.pky\n<ransomware directory>0000000.res\n[<ransomware directory>@[email protected]](http://blog.emsisoft.com/cdn-cgi/l/email-protection)\n[<ransomware directory>@[email protected]](http://blog.emsisoft.com/cdn-cgi/l/email-protection)\n<ransomware directory>b.wnry\n<ransomware directory>c.wnry\n<ransomware directory>f.wnry\n<ransomware directory>msgm_bulgarian.wnry\n<ransomware directory>msgm_chinese (simplified).wnry\n<ransomware directory>msgm_chinese (traditional).wnry\n<ransomware directory>msgm_croatian.wnry\n<ransomware directory>msgm_czech.wnry\n<ransomware directory>msgm_danish.wnry\n<ransomware directory>msgm_dutch.wnry\n<ransomware directory>msgm_english.wnry\n<ransomware directory>msgm_filipino.wnry\n<ransomware directory>msgm_finnish.wnry\n\n\n-----\n\n<ransomware directory>msgm_french.wnry\n<ransomware directory>msgm_german.wnry\n<ransomware directory>msgm_greek.wnry\n<ransomware directory>msgm_indonesian.wnry\n<ransomware directory>msgm_italian.wnry\n<ransomware directory>msgm_japanese.wnry\n<ransomware directory>msgm_korean.wnry\n<ransomware directory>msgm_latvian.wnry\n<ransomware directory>msgm_norwegian.wnry\n<ransomware directory>msgm_polish.wnry\n<ransomware directory>msgm_portuguese.wnry\n<ransomware directory>msgm_romanian.wnry\n<ransomware directory>msgm_russian.wnry\n<ransomware directory>msgm_slovak.wnry\n<ransomware directory>msgm_spanish.wnry\n<ransomware directory>msgm_swedish.wnry\n<ransomware directory>msgm_turkish.wnry\n<ransomware directory>msgm_vietnamese.wnry\n<ransomware directory>r.wnry\n<ransomware directory>s.wnry\n<ransomware directory>t.wnry\n<ransomware directory>TaskDataTorlibeay32.dll\n<ransomware directory>TaskDataTorlibevent-2-0-5.dll\n<ransomware directory>TaskDataTorlibevent_core-2-0-5.dll\n<ransomware directory>TaskDataTorlibevent_extra-2-0-5.dll\n<ransomware directory>TaskDataTorlibgcc_s_sjlj-1.dll\n<ransomware directory>TaskDataTorlibssp-0.dll\n<ransomware directory>TaskDataTorssleay32.dll\n<ransomware directory>TaskDataTortaskhsvc.exe\n<ransomware directory>TaskDataTortor.exe\n<ransomware directory>TaskDataTorzlib1.dll\n<ransomware directory>taskdl.exe\n<ransomware directory>taskse.exe\n<ransomware directory>u.wnry\n[C:@[email protected]](http://blog.emsisoft.com/cdn-cgi/l/email-protection)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-05-12 - Global WannaCry ransomware outbreak uses known NSA exploits.pdf"
    ],
    "report_names": [
        "2017-05-12 - Global WannaCry ransomware outbreak uses known NSA exploits.pdf"
    ],
    "threat_actors": [
        {
            "id": "d4f7cf97-9c98-409c-8b95-b80d14c576a5",
            "created_at": "2022-10-25T16:07:24.561104Z",
            "updated_at": "2025-03-27T02:02:10.281202Z",
            "deleted_at": null,
            "main_name": "Shadow Brokers",
            "aliases": [],
            "source_name": "ETDA:Shadow Brokers",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "171b85f2-8f6f-46c0-92e0-c591f61ea167",
            "created_at": "2023-01-06T13:46:38.830188Z",
            "updated_at": "2025-03-27T02:00:02.929729Z",
            "deleted_at": null,
            "main_name": "The Shadow Brokers",
            "aliases": [
                "Shadow Brokers",
                "ShadowBrokers",
                "The ShadowBrokers",
                "TSB"
            ],
            "source_name": "MISPGALAXY:The Shadow Brokers",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536188,
    "ts_updated_at": 1743041507,
    "ts_creation_date": 1653709736,
    "ts_modification_date": 1653709736,
    "files": {
        "pdf": "https://archive.orkl.eu/1658ed935e15a24e83745109c43e640cd19582e7.pdf",
        "text": "https://archive.orkl.eu/1658ed935e15a24e83745109c43e640cd19582e7.txt",
        "img": "https://archive.orkl.eu/1658ed935e15a24e83745109c43e640cd19582e7.jpg"
    }
}