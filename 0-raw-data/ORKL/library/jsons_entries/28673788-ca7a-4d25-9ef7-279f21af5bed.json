{
    "id": "28673788-ca7a-4d25-9ef7-279f21af5bed",
    "created_at": "2023-01-12T15:05:03.722634Z",
    "updated_at": "2025-03-27T02:12:03.972611Z",
    "deleted_at": null,
    "sha1_hash": "9538bea413abf0cbf6e11b6f07ef12c757a854b9",
    "title": "2021-03-05 - Detect webshells dropped on Microsoft Exchange servers after 0day compromises",
    "authors": "",
    "file_creation_date": "2022-05-28T04:03:20Z",
    "file_modification_date": "2022-05-28T04:03:20Z",
    "file_size": 131252,
    "plain_text": "# Detect webshells dropped on Microsoft Exchange servers after 0day compromises\n\n**github.com/cert-lv/exchange_webshell_detection**\n\ncert-lv\n\n### This project has been discontinued\n\nPlease use Microsoft tools instead:\n\n[Microsoft Safety Scanner](https://docs.microsoft.com/en-us/windows/security/threat-protection/intelligence/safety-scanner-download)\nOther detections and mitigations listed in: https://github.com/microsoft/CSSExchange/tree/main/Security\n\nWhen assessing impact we strongly suggest to assume breach and to preemptively examine\nall MS Exchange servers that were publically exposed since January, even if there are no\nsigns of active compromise.\n\nNote that data exfiltration and configuration changes were possible (and were happening)\njust through SSRF part of the epxloit chain alone (i.e. without achieving code execution,\ndropping any files or spawning new processes on the Exchange host).\n\n### UPD: As of March 13, 2021 Windows Defender is detecting this script itself as a Webshell\n\n\n-----\n\nThis is a false positive, A/V products react to keywords listed in the script.\n```\ndetect_webshells.ps1 is intentionally written as a standalone file using very simple\n\n```\nPowerShell, so that you could inspect it yourself. The keywords that (rightly) trigger A/V are\nlisted on [line 94. If you do not feel confident that you understand what the script is doing, do](https://github.com/cert-lv/exchange_webshell_detection/blob/c6fea9dae261cc4879931ad9c50546fcc0c0df66/detect_webshells.ps1#L94)\nnot run it!\n\nHopefully the fact that antivirus software started detecting this script means it's capable of\ndetecting real webshells as well, making `detect_webshells.ps1 unnecessary. Check that`\nExchange and inetpub directories are not whitelisted though and please realise that\nwebshells where only used for the initial access. Once attackers achieved code execution\nthey usually deployed additional persistence mechanisms - sometimes even removing initial\nwebshell themselves to hide their tracks.\n\nSo don't mistake lack of webshells for lack of compromise - unfortunately your server\nstill might have been hacked and either attackers removed webshell themselves or an\nantivirus did that (without completely booting attackers from your server).\n\nThis script looks for webshells dropped on Microsoft Exchange servers while they were\nvulnerable to following CVE's:\n\n[CVE-2021-26855, pre-auth SSRF, CVSS:3.0 9.1 / 8.4](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-26855)\n[CVE-2021-26857, insecure deserialization leading to privilege escalation to SYSTEM](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-26857)\nlevel, CVSS:3.0 7.8 / 7.2\n[CVE-2021-26858, post-auth file write, CVSS:3.0 7.8 / 7.2](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-26858)\n[CVE-2021-27065, post-auth file write, CVSS:3.0 7.8 / 7.2](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-27065)\n\nInitial activity during January 2021 was attributed to HAFNIUM, however since then other\nthreat actors got hold of these exploits and started using them. Prior to public disclosure &\npatches being published by Microsoft (since 27 February or so) publically exposed Exchange\nservers started being exploited indiscriminately. As such, installing latest Exchange updates\nsoon after Microsoft published them did not fully mitigate the risk of prior compromise,\ntherefore all Exchange servers should be inspected for signs of unauthorized access.\n\n## Running\n```\ndetect_webshells.ps1 will check for the presence of known webshells in typical\n\n```\nlocations:\n```\n   inetpub/wwwroot/aspnet_client/ : system wide location, most common place of\n\n```\ndropped webshells in current attacks; normally does not contain any files at all, so\npresence of anything there is suspicious\n\n\n-----\n\n```\n   $($env:exchangeinstallpath)/Frontend/ : used by more sophisticated attackers\n\n```\nin order to blend in with legitimate Exchange files (webshells could be added as new\nfiles or by modifying existing ones, including `web.config ); most common locations`\nare `/owa/ and` `/ecp/, but webshells could be dropped anywhere within Frontend`\ndirectory\n\n## Interpreting the results\n```\ndetect_webshells.ps1 only looks for webshells and does not attempt to detect past\n\n```\nexploitation events directly (use https://github.com/microsoft/CSSExchange/tree/main/Security and other scripts mentioned below for this), nor is it looking for\nparticularly stealthy threat actors (which could delete webshells after use or avoid dropping\nthem altogether). As such, negative result can only mean absence of evidence of the\ncompromise on this particular host. It does not guarantee that the host was not exploited by\nsome other means.\n\n## More information\n\nWriteups/disclosures (incl. IoC):\n\nhttps://www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchangeservers/\nhttps://www.volexity.com/blog/2021/03/02/active-exploitation-of-microsoft-exchangezero-day-vulnerabilities/\nhttps://blog.rapid7.com/2021/03/03/rapid7s-insightidr-enables-detection-and-responseto-microsoft-exchange-0-day/\n[https://us-cert.cisa.gov/ncas/alerts/aa21-062a](https://us-cert.cisa.gov/ncas/alerts/aa21-062a)\nhttps://msrc-blog.microsoft.com/2021/03/05/microsoft-exchange-server-vulnerabilitiesmitigations-march-2021/\n[https://blog.truesec.com/2021/03/07/exchange-zero-day-proxylogon-and-hafnium/](https://blog.truesec.com/2021/03/07/exchange-zero-day-proxylogon-and-hafnium/)\n\nNotable detection scripts:\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-03-05 - Detect webshells dropped on Microsoft Exchange servers after 0day compromises.pdf"
    ],
    "report_names": [
        "2021-03-05 - Detect webshells dropped on Microsoft Exchange servers after 0day compromises.pdf"
    ],
    "threat_actors": [
        {
            "id": "529c1ae9-4579-4245-86a6-20f4563a695d",
            "created_at": "2022-10-25T16:07:23.702006Z",
            "updated_at": "2025-03-27T02:02:09.93109Z",
            "deleted_at": null,
            "main_name": "Hafnium",
            "aliases": [
                "Red Dev 13",
                "Silk Typhoon"
            ],
            "source_name": "ETDA:Hafnium",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "7c969685-459b-4c93-a788-74108eab6f47",
            "created_at": "2023-01-06T13:46:39.189751Z",
            "updated_at": "2025-03-27T02:00:03.017103Z",
            "deleted_at": null,
            "main_name": "HAFNIUM",
            "aliases": [
                "ATK233",
                "G0125",
                "Operation Exchange Marauder",
                "Red Dev 13",
                "Silk Typhoon"
            ],
            "source_name": "MISPGALAXY:HAFNIUM",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "2704d770-43b4-4bc4-8a5a-05df87416848",
            "created_at": "2022-10-25T15:50:23.306305Z",
            "updated_at": "2025-03-27T02:00:55.43633Z",
            "deleted_at": null,
            "main_name": "HAFNIUM",
            "aliases": [
                "HAFNIUM",
                "Operation Exchange Marauder",
                "Silk Typhoon"
            ],
            "source_name": "MITRE:HAFNIUM",
            "tools": [
                "Tarrask",
                "ASPXSpy",
                "Impacket",
                "PsExec",
                "China Chopper"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535903,
    "ts_updated_at": 1743041523,
    "ts_creation_date": 1653710600,
    "ts_modification_date": 1653710600,
    "files": {
        "pdf": "https://archive.orkl.eu/9538bea413abf0cbf6e11b6f07ef12c757a854b9.pdf",
        "text": "https://archive.orkl.eu/9538bea413abf0cbf6e11b6f07ef12c757a854b9.txt",
        "img": "https://archive.orkl.eu/9538bea413abf0cbf6e11b6f07ef12c757a854b9.jpg"
    }
}