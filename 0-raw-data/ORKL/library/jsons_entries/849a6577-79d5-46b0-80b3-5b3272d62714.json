{
    "id": "849a6577-79d5-46b0-80b3-5b3272d62714",
    "created_at": "2022-10-25T16:48:23.836561Z",
    "updated_at": "2025-03-27T02:16:45.758671Z",
    "deleted_at": null,
    "sha1_hash": "d0791b89c61a793f6d07d7cccc098be64f4f3c73",
    "title": "New Wekby Attacks Use DNS Requests As Command and Control Mechanism - Palo Alto Networks BlogPalo Alto Networks Blog",
    "authors": "",
    "file_creation_date": "2016-07-05T13:15:53Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 556899,
    "plain_text": "### 33\n\n\n**group is known to leverage recently released exploits very shortly after those exploits are**\n\n**[available, such as in the case of HackingTeam’s Flash zero-day exploit.](http://www.volexity.com/blog/?p=158)**\n\n**[The malware used by the Wekby group has ties to the HTTPBrowser malware family, and uses](https://www.zscaler.com/blogs/research/chinese-cyber-espionage-apt-group-leveraging-recently-leaked-hacking-team-exploits-target-financial-services-firm)**\n\n**DNS requests as a command and control mechanism. Additionally, it uses various obfuscation**\n\n**techniques to thwart researchers during analysis. Based on metadata seen in the discussed**\n\n**samples, Palo Alto Networks has named this malware family ‘pisloader’.**\n\n**The pisloader malware family was delivered via HTTP from the following URL. At the time of**\n\n**writing, this URL was still active.**\n\n**_http://globalprint-us[.]com/proxy_plugin.exe_**\n\n**Other samples hosted on this domain include the following:**\n\n**_http://globalprint-us[.]com/proxy_web_plugin.exe_**\n\n**MD5: E4968C8060EA017B5E5756C16B80B012**\n\n**SHA256:**\n\n**8FFBB7A80EFA9EE79E996ABDE7A95CF8DC6F9A41F9026672A8DBD95539FEA82A**\n\n**Size: 126976 Bytes**\n\n**Compile Time: 2016-04-28 00:38:46 UTC**\n\n**This discovered file was found to be an instance of the common Poison Ivy malware family with**\n\n**the following configuration data:**\n\n**Command and Control Address: intranetwabcam[.]com**\n\n**Command and Control Port: 80**\n\n**Password: admin**\n\n**Mutex: )!VoqA.I5**\n\n**The domains witnessed in this attack were all registered very shortly prior to being used. The**\n\n**following domains have been witnessed in this attack:**\n\n**Additionally, the following IP resolutions have been observed.**\n\n**The following sample was discovered initially and is referenced in the subsequent analysis:**\n\n**MD5: E8D58AA76DD97536AC225949A2767E05**\n\n**SHA256: DA3261C332E72E4C1641CA0DE439AF280E064B224D950817A11922A8078B11F1**\n\n**Size: 126976 Bytes**\n\n**Compile Time: 2016-04-27 14:37:34 UTC**\n\n**This particular file has the following metadata properties. The references to ‘pisload2’ led to the**\n\n**naming of this malware family.**\n\n|Col1|POSTED BY: Josh Grunzweig, Mike Scott and Bryan Lee on May 24, 2016 11:30 AM|\n|---|---|\n|33||\n|LLiikkee|FILED IN: Malware, Threat Prevention, Unit 42 TAGGED: command and control, DNS, pisloader, Wekby We have observed an attack led by the APT group Wekby targeting a US-based organization in recent weeks. Wekby is a group that has been active for a number of years, targeting various industries such as healthcare, telecommunications, aerospace, defense, and high tech. The|\n|Tweet||\n|8||\n\n\n## Prevention: Changing the Math of Cybersecurity Through Automated Defense\n\n**[posted by Ryan Gillis on July 4, 2016](http://researchcenter.paloaltonetworks.com/author/ryan-gillis/)**\n\n## Palo Alto Networks News of the Week – July 2, 2016\n\n**[posted by Anna Lough on July 2, 2016](http://researchcenter.paloaltonetworks.com/author/anna-lough/)**\n\n## Channel Scoop – July 1, 2016\n\n**[posted by Lang Tibbils on July 1, 2016](http://researchcenter.paloaltonetworks.com/author/lang-tibbils/)**\n\n## Here’s a Look at the First Palo Alto Networks Intern Tech Week!\n\n**[posted by Courtney Taku on July 1, 2016](http://researchcenter.paloaltonetworks.com/author/courtney-taku/)**\n\n## Recent MNKit Exploit Activity Reveals Some Common Threads\n\n**[posted by Anthony Kasza on June 30, 2016](http://researchcenter.paloaltonetworks.com/author/anthony-kasza/)**\n\n**[MORE →](http://researchcenter.paloaltonetworks.com/archives/)**\n\n\n**Select a Category**\n\n**Select a Month**\n\n**[MORE →](http://researchcenter.paloaltonetworks.com/archives/)**\n\n\n## 8\n\n\n-----\n\n**_Figure 1 pisloader dropper metadata_**\n\n**The initial dropper contains very simple code that is responsible for setting persistence via the**\n\n**Run registry key, and dropping and executing an embedded Windows executable. Limited**\n\n**obfuscation was encountered, where the authors split up strings into smaller sub-strings and**\n\n**used ‘strcpy’ and ‘strcat’ calls to re-build them prior to use. They also used this same technique**\n\n**to generate garbage strings that are never used. This is likely to deter detection and analysis of**\n\n**the sample. The following decompiled code demonstrates this. Comments have been added to**\n\n**show the fully-generated strings.**\n\n**_Figure 2 pisloader dropper building strings and setting persistence_**\n\n**In the above decompiled code, we see that the pisloader is generating the following string,**\n\n**which eventually is called to set the Run registry key.**\n\n**_cmd.exe /c reg add HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run /v lsm /t reg_sz /d_**\n\n**_“%appdata%\\lsm.exe” /f_**\n\n**This particular command will set the**\n\n**HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\lsm registry key with a value of**\n\n**“%appdata%\\lsm.exe”. After this key is set, the malware proceeds to decrypt a two blobs of data**\n\n**with a single-byte XOR key of 0x54. The resulting data is written to the %appdata%\\lsm.exe file**\n\n**path.**\n\n**After this file is written, the malware executes the newly written lsm.exe file, which contains the**\n\n**pisloader payload.**\n\n**The following sample was discovered and is referenced in the subsequent analysis:**\n\n**MD5: 07B9B62FB3B1C068837C188FEFBD5DE9**\n\n**SHA256:**\n\n**456FFFC256422AD667CA023D694494881BAED1496A3067485D56ECC8FEFBFAEB**\n\n**Size: 102400 Bytes**\n\n**Compile Timestamp: 2016-04-27 13:39:02 UTC**\n\n\n-----\n\n**code can be treated as garbage and ignored. The entirety of the function is highlighted in green,**\n\n**where two function offsets are pushed to the stack, followed by a return instruction. This return**\n\n**instruction will point code execution first at the null function, which in turn will point code**\n\n**execution to the ‘next_function’. This technique is used throughout the runtime of the payload,**\n\n**making static analysis difficult.**\n\n**_Figure 3 Obfuscated code witnessed in pisloader_**\n\n**The malware is actually quite simplistic once the obfuscation and garbage code is ignored. It will**\n\n**begin by generating a random 10-byte alpha-numeric header. The remaining data is base32-**\n\n**encoded, with padding removed. This data will be used to populate a subdomain that will be**\n\n**used in a subsequent DNS request for a TXT record.**\n\n**The use of DNS as a C2 protocol has historically not been widely adopted by malware authors.**\n\n**Notable exceptions include the following:**\n\n**[FrameworkPOS](https://blog.gdatasoftware.com/2014/10/23942-new-frameworkpos-variant-exfiltrates-data-via-dns-requests)**\n\n**[C3PRO-RACCOON](https://www.forcepoint.com/sites/default/files/resources/files/report_jaku_analysis_of_botnet_campaign_en_0.pdf)**\n\n**[FeederBot](http://blog.cj2s.de/archives/28-Feederbot-a-bot-using-DNS-as-carrier-for-its-CC.html)**\n\n**[Morto](http://www.symantec.com/connect/blogs/morto-worm-sets-dns-record)**\n\n**[PlugX Variants](http://blog.airbuscybersecurity.com/post/2014/01/PlugX-v2%3A-meet-SController)**\n\n**The use of DNS as a C2 allows pisloader to bypass certain security products that may not be**\n\n**inspecting this traffic correctly.**\n\n\n-----\n\n**_Figure 4 DNS query for TXT record by malware_**\n\n**The pisloader sample will send a beacon periodically that is composed of a random 4-byte**\n\n**uppercase string that is used as the payload. An example of this can be found below:**\n\n**_Figure 5 pisloader DNS beacon request_**\n\n**The malware expects various aspects of the DNS responses to be set in a specific way, or else**\n\n**pisloader will ignore the DNS reply. The following DNS flags must be set. Should any additional**\n\n**flags be set, the response will be ignored.**\n\n**Response**\n\n**Recursion Desired**\n\n**Recursion Available**\n\n**The ‘Questions’ field must be set to a value of 0x1. The ‘Answer Resource Records’ field must**\n\n**be set to a value of 0x1. Additionally, the response query subdomain must match the original**\n\n**DNS request.**\n\n**The remote command and control (C2) server is statically embedded within the malware. A**\n\n**single host of ‘ns1.logitech-usa[.]com’ is found in this specific sample.**\n\n**The C2 server will respond with a TXT record that is encoded similar to the initial request. In the**\n\n**response, the first byte is ignored, and the remaining data is base32-encoded. An example of**\n\n**this can be found below.**\n\n**_Figure 6 Example TXT response by C2 server_**\n\n**The following commands, and their descriptions are supported by the malware:**\n\n**sifo – Collect victim system information**\n\n**drive – List drives on victim machine**\n\n**list – List file information for provided directory**\n\n**upload – Upload a file to the victim machine**\n\n**open – Spawn a command shell**\n\n**Some examples of these commands being used can be seen below. A mock DNS server was**\n\n**used to generate the commands and receive the resulting data.**\n\n**Example sending the ‘drive’ command:**\n\n\n**1**\n**2**\n**3**\n\n\n\n**[+]** **Sending Command: drive | Encoded: CMRZGS5TF**\n\n**[+]** **Raw Data Received: UMAVMGAGD0IE5FY7CDHJOHYRB2LR6A**\n\n**[+]** **Decoded Data Received: A:\\|C:\\|D:\\|**\n\n\n-----\n\n**4**\n**5**\n**6**\n**7**\n**8**\n**9**\n**10**\n**11**\n\n\n\n**[ ]** **Q** **Q Q**\n\n**[+]** **Raw Data Received: HTPDMGAGCCFEQDEMBQHEQE22LDOJXXG33GOQQEG33SOB**\n\n**[+]** **Raw Data Received: BNJWMGAGCDNFXW4LRAEBAWY3BAOJUWO2DUOMQHEZLTMV**\n\n**[+]** **Raw Data Received: UARCMGAGCEFYGQUDIKIM5FYVLTMVZHGXCKN5ZWQICHOJ**\n\n**[+]** **Raw Data Received: UJRAMGAGC0MVUWOXCEMVZWW5DPOA7A**\n\n**[+]** **Decoded Data Received: Microsoft Windows** **[Version** **6.1.7601]**\n**Copyright** **(c)** **2009** **Microsoft Corporation.** **All rights reserved.**\n\n**C:\\Users\\Josh Grunzweig\\Desktop>**\n\n\n**Example sending the ‘sifo’ command:**\n\n\n**1**\n**2**\n**3**\n**4**\n**5**\n\n\n\n**[+]** **Sending Command: sifo | Encoded: CONUWM3Y**\n\n**[+]** **Raw Data Received: FUBWMGAGIANQ6TCNZSFYYTMLRRFYYTKMZGMM6VOSKOFVG**\n\n**[+]** **Raw Data Received: PGHRMGAGIBGJHEWSKPJNICAW2KN5ZWQICHOJ2W46TXMVU**\n\n**[+]** **Raw Data Received: MMAZMGAGI0N46TMLBRFQZTE**\n\n**[+]** **Decoded Data Received: l=172.16.1.153&c=WIN-LJLV2NKIOKP** **[Josh Gr**\n\n\n**Example listing the contents of the C:\\ drive:**\n\n\n**1**\n**2**\n**3**\n**4**\n**5**\n**6**\n**7**\n**8**\n**9**\n**10**\n\n\n\n**[+]** **Sending Command: list** **C:\\ | Encoded: CNRUXG5BAIM5FY**\n\n**[+]** **Raw Data Received: QKTUMGAGLAGB6CIUTFMN4WG3DFFZBGS3T4GIYDCNJPGA**\n\n**[+]** **Raw Data Received: EKNPMGAGL0EAYTIORUGA5DKN34GB6DEMS6**\n\n**[+]** **Raw Data Received: RKMAMGAGLAGF6GC5LUN5SXQZLDFZRGC5D4GIYDAOJPGA**\n\n**[+]** **Raw Data Received: NMSIMGAGL0EAZDCORUGI5DEMD4GI2HYMZSLY**\n\n**[+]** **Raw Data Received: OHRWMGAGLAGB6EE33POR6DEMBRGUXTAMZPGI3CAMJWHI**\n\n**[+]** **Raw Data Received: DPDUMGAGL0GJ6DA7BSGJPA**\n\n**[+]** **Raw Data Received: WIKGMGAGLAGF6GE33PORWWO4T4GIYDCNBPGA3C6MRYEA**\n***** **Truncated***\n\n**[+]** **Decoded Data Received: 0|$Recycle.Bin|2015/03/26** **14:40:57|0|22^1**\n\n\n**The sifo command above uses the printf format string of ‘l=%s&c=%s&o=%s’. This is consistent**\n\n**with previous versions of HTTPBrowser, which is another malware family frequently used by the**\n\n**Wekby group.**\n\n**Additionally, a number of commands themselves, such as the ‘list’, ‘drive’, and ‘upload’**\n\n**commands are consistent with HTTPBrowser. The formatted responses from these commands**\n\n**[are also identical. A known HTTPBrowser sample was spotted with similar metadata as the](https://www.virustotal.com/en/file/9995fe6ff112efb6de6498ace23f42b8d3689f3c890959728cbc888462b9ea0d/analysis/)**\n\n**discussed pisloader sample, which adds further credibility that pisloader is likely a variant of this**\n\n**malware family.**\n\n**[Additionally, the code used to generate these commands is available via GitHub.](https://github.com/pan-unit42/public_tools/tree/master/pisloader/wekby_dns.py)**\n\n**The Wekby group continues to target various high profile organizations using sophisticated**\n\n**malware. The pisloader malware family uses various novel techniques, such as using DNS as a**\n\n**C2 protocol, as well as making use of return-oriented programming and other anti-analysis**\n\n**tactics.**\n\n**Palo Alto Networks customers are protected against this threat in the following ways:**\n\n**WildFire correctly identifies all pisloader samples as malicious**\n\n**[A pisloader AutoFocus tag has been created in order to track this malware family](https://autofocus.paloaltonetworks.com/#/tag/Unit42.Pisloader)**\n\n**All domains/IPs used in this attack have been flagged as malicious.**\n\n**An IPS rule has been created to detect pisloader DNS traffic**\n\n**External Resources**\n\n**https://blog.anomali.com/evasive-maneuvers-the-wekby-group-attempts-to-evade-analysis-**\n\n**via-custom-rop**\n\n**[http://www.volexity.com/blog/?p=158](http://www.volexity.com/blog/?p=158)**\n\n**https://www.secureworks.com/research/threat-group-3390-targets-organizations-for-**\n\n**cyberespionage**\n\n**https://www.zscaler.com/blogs/research/chinese-cyber-espionage-apt-group-leveraging-**\n\n**recently-leaked-hacking-team-exploits-target-financial-services-firm**\n\n**[https://www.fireeye.com/blog/threat-research/2015/07/demonstrating_hustle.html](https://www.fireeye.com/blog/threat-research/2015/07/demonstrating_hustle.html)**\n\n**SHA256 Hashes**\n\n**da3261c332e72e4c1641ca0de439af280e064b224d950817a11922a8078b11f1**\n\n**930772d6af8f43f62ea78092914fa8d6b03e8e3360dd4678eec1a3dda17206ed**\n\n**6852ba95720af64809995e04f4818517ca1bd650bc42ea86d9adfdb018d6b274**\n\n**9200f80c08b21ebae065141f0367f9c88f8fed896b0b4af9ec30fc98c606129b**\n\n**4d62caef1ca8f4f9aead7823c95228a52852a1145ca6aaa58ad8493e042aed16**\n\n**1b341dab023de64598d80456349db146aafe9b9e2ec24490c7d0ac881cecc094**\n\n**456fffc256422ad667ca023d694494881baed1496a3067485d56ecc8fefbfaeb**\n\n\n-----\n\n**ns1.logitech-usa[.]com**\n\n**globalprint-us[.]com**\n\n**intranetwabcam[.]com**\n\n**login.access-mail[.]com**\n\n**glb.it-desktop[.]com**\n\n**local.it-desktop[.]com**\n\n**hi.getgo2[.]com**\n\n## Marcus on May 26, 2016 9:39 AM said\n\n**Great article, well written.**\n\n## Yasir Irfan on May 28, 2016 10:27 PM said\n\n**Very informative and well crafted**\n\n\n## Share your thoughts\n\n|Col1|Marcus on May 26, 2016 9:39 AM said|\n|---|---|\n||Great article, well written.|\n\n|Col1|Yasir Irfan on May 28, 2016 10:27 PM said|\n|---|---|\n||Very informative and well crafted|\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2016/2016.05.24.New_Wekby_Attacks/unit42-new-wekby-attacks-use-dns-requests-as-command-and-control-mechanism.pdf"
    ],
    "report_names": [
        "unit42-new-wekby-attacks-use-dns-requests-as-command-and-control-mechanism"
    ],
    "threat_actors": [
        {
            "id": "a3687241-9876-477b-aa13-a7c368ffda58",
            "created_at": "2022-10-25T16:07:24.496902Z",
            "updated_at": "2025-03-27T02:02:10.256629Z",
            "deleted_at": null,
            "main_name": "Hacking Team",
            "aliases": [],
            "source_name": "ETDA:Hacking Team",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "c8aefee7-fb57-409b-857e-23e986cb4a56",
            "created_at": "2023-01-06T13:46:38.285223Z",
            "updated_at": "2025-03-27T02:00:02.79333Z",
            "deleted_at": null,
            "main_name": "APT18",
            "aliases": [
                "TG-0416",
                "SCANDIUM",
                "PLA Navy",
                "Wekby",
                "G0026",
                "DYNAMITE PANDA"
            ],
            "source_name": "MISPGALAXY:APT18",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "e90c06e4-e3e0-4f46-a3b5-17b84b31da62",
            "created_at": "2023-01-06T13:46:39.018236Z",
            "updated_at": "2025-03-27T02:00:02.978356Z",
            "deleted_at": null,
            "main_name": "Hacking Team",
            "aliases": [],
            "source_name": "MISPGALAXY:Hacking Team",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "e3492534-85a6-4c87-a754-5ae4a56d7c8c",
            "created_at": "2022-10-25T15:50:23.819113Z",
            "updated_at": "2025-03-27T02:00:55.552554Z",
            "deleted_at": null,
            "main_name": "Threat Group-3390",
            "aliases": [
                "Threat Group-3390",
                "Earth Smilodon",
                "TG-3390",
                "Emissary Panda",
                "BRONZE UNION",
                "APT27",
                "Iron Tiger",
                "LuckyMouse"
            ],
            "source_name": "MITRE:Threat Group-3390",
            "tools": [
                "Systeminfo",
                "gsecdump",
                "PlugX",
                "ASPXSpy",
                "Cobalt Strike",
                "Mimikatz",
                "Impacket",
                "gh0st RAT",
                "certutil",
                "China Chopper",
                "HTTPBrowser",
                "Tasklist",
                "netstat",
                "SysUpdate",
                "HyperBro",
                "ZxShell",
                "RCSession",
                "ipconfig",
                "Clambling",
                "pwdump",
                "NBTscan",
                "Pandora",
                "Windows Credential Editor"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "17b92337-ca5f-48bb-926b-c93b5e5678a4",
            "created_at": "2022-10-25T16:07:23.333316Z",
            "updated_at": "2025-03-27T02:02:09.74201Z",
            "deleted_at": null,
            "main_name": "APT 18",
            "aliases": [
                "APT 18",
                "Dynamite Panda",
                "Scandium",
                "TG-0416",
                "Wekby"
            ],
            "source_name": "ETDA:APT 18",
            "tools": [
                "AngryRebel",
                "AtNow",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "HTTPBrowser",
                "HttpBrowser RAT",
                "HttpDump",
                "Moudour",
                "Mydoor",
                "PCRat",
                "Pisloader",
                "QUICKBALL",
                "Roseam",
                "StickyFingers",
                "Token Control",
                "TokenControl",
                "hcdLoader"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716503,
    "ts_updated_at": 1743041805,
    "ts_creation_date": 1467724553,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/d0791b89c61a793f6d07d7cccc098be64f4f3c73.pdf",
        "text": "https://archive.orkl.eu/d0791b89c61a793f6d07d7cccc098be64f4f3c73.txt",
        "img": "https://archive.orkl.eu/d0791b89c61a793f6d07d7cccc098be64f4f3c73.jpg"
    }
}