{
    "id": "5e2fdcfd-e93b-47f6-b437-eab2c464ec7e",
    "created_at": "2023-01-12T15:02:40.760726Z",
    "updated_at": "2025-03-27T02:05:27.264955Z",
    "deleted_at": null,
    "sha1_hash": "81b98601e62a742e4757053b15a774daa71746c0",
    "title": "2018-10-31 - Emotet Awakens With New Campaign of Mass Email Exfiltration",
    "authors": "",
    "file_creation_date": "2022-05-28T15:18:43Z",
    "file_modification_date": "2022-05-28T15:18:43Z",
    "file_size": 119326,
    "plain_text": "# Emotet Awakens With New Campaign of Mass Email Exfiltration\n\n**[blog.kryptoslogic.com/malware/2018/10/31/emotet-email-theft.html](https://blog.kryptoslogic.com/malware/2018/10/31/emotet-email-theft.html)**\n\n[Authored by: Kryptos Logic Vantage Team on Wednesday, October 31, 2018](https://twitter.com/kryptoslogic)\n\nTags: [emotet](https://www.kryptoslogic.com/blog/tag/emotet)\nThe Emotet malware family just raised the stakes by adding email exfiltration to its arsenal,\nthereby escalating its capabilities to cyber espionage. While it has recently made headlines\nfor delivering ransomware payloads to United States infrastructure such as Water Utilities,\nEmotet has laid mostly dormant for the past month. In the past days, however, the mummy\nhas returned just in time for Halloween as we observed a new module capable of exfiltrating\nemail content back to the botnet’s operators.\n\nThis new capability is effectively taking all existing Emotet infections with emails and sending\nthem back to the attacker going back 180 days in mail history.\n\nThis post will examine the new threat payload enabling Emotet mass email capture, examine\nthe exfiltration process, and observe its global distribution.\n\nEven protected systems can be infected by this advanced malware. Be sure to check out\n[Telltale, our free victim notification service if you wish to check if your organization has been](https://telltale.kryptoslogic.com/)\ninfected.\n\n## A Brief Overview of Emotet’s Email Harvesting Module\n\n[Previous Emotet modules already used the Outlook Messaging API to steal contact lists.](https://docs.microsoft.com/en-us/office/client-developer/outlook/mapi/outlook-mapi-reference)\nThis API is, essentially, an interface that allows an application to become email-ready. The\nmost common cases of MAPI usage are Simple MAPI, included in Windows as part of the\ndefault Windows Live email client, or the full MAPI as used by Outlook and Exchange. In\nother words, this API gives an application access to email, if Windows is adequately\nconfigured.\n\n\n-----\n\nThis configuration is the first thing checked by this module. In particular, the registry key\n```\nHKLM\\Software\\Clients\\Mail\\Microsoft Outlook is accessed, and the value\nDllPathEx —the path to the mapi32.dll module—is expected to be defined. If it is not,\n\n```\nthe module does not proceed. Note that the registry key is pretty specific—there are other\nplausible keys, such as `HKLM\\Software\\Clients\\Mail\\Windows Mail, that this module`\nsimply does not care about.\n\nMore specifically, for each email, the previous module queried\n\nSender name and email;\nDestination name and email.\n\nThe new module ( 6cd44f2d00b43d80c08922d99d51cce804a59a54 ), however, is more\nthorough, and also includes email subjects and bodies. It will crawl every email of every\n[subfolder in the interpersonal message (IPM) root folder, and](https://docs.microsoft.com/en-us/office/client-developer/outlook/mapi/ipm-subtree)\n\nVerify whether the email has been sent/received ( PR_MESSAGE_DELIVERY_TIME ) in\nthe last 100e-9 * 15552000000 * 10000 / 3600 / 24 = 180 days;\nIf so, obtain its sender ( PR_SENDER_NAME_W, `PR_SENDER_EMAIL_ADDRESS_W ),`\ndestination ( PR_RECEIVED_BY_NAME_W, `PR_RECEIVED_BY_EMAIL_ADDRESS_W ),`\nsubject ( PR_SUBJECT_W ) and body ( PR_BODY_W ).\nIf the body is longer than 16384 characters, it is truncated to this size plus the string\n```\n   ... .\n\n```\nA structure containing the above email information is then added to a global linked list which,\nupon termination, is written in Base64 encoding to a temporary file.\n\n## How Emotet Actors Are Harvesting Your Emails\n\n**Steps (click to expand)**\n\nIt is important to emphasize that this module can be deployed in any existing Emotet infected\nsystems (See Telltale global threat tracking below) and begin to harvest emails and send\nthem back to the actor. In other words, Emotet will likely, over the next few days, harvest\ncountless emails across tens of thousands of actively infected systems.\n\nHere is how the process works (see also picture above):\n\n1. An infected Emotet loads the module DLL from the command and control (C2) server,\n\nand this DLL injects the payload binary into a new Emotet process;\n2. As described above, the new process scans all the emails, and saves results to a\n\ntemporary file;\n\n\n-----\n\n3. Original module DLL waits for this payload to finish (or kills it after 300 seconds), then\n\nreads the temporary file in its entirety;\n4. Original DLL issues an HTTP request using the WinINet API, which will send the\n\ntemporary file, if it is bigger than 116 bytes, to the C2 server.\n\n## Telltale global threat tracking of Emotet (interactive)\n\n**Tracking of Emotet Infections Worldwide. Even the whales appear infected.**\n\n## Conclusion\n\nEmotet was already a serious threat, incurring costs of up to 1 million dollars for a single\nincident, and recently unleashing ransomware on Onslow Water and Sewer Authority and\nother U.S. cities. The United States is by a wide margin the most affected country, which is\nconsistent with [our earlier report on Emotet. While Emotet’s operators may have simply](https://blog.kryptoslogic.com/malware/2018/08/01/emotet.html)\nmoved to server-side extraction, harvesting data in mass provides a weaponized data-driven\nanalytical capability which should not be underestimated, given how effective surgical email\nleaks have been in the recent past.\n\nProtecting against this actor is non-trivial. Emotet is arguably one of the most advanced\nbotnets ever created. These actors appear to be aware of maintaining and designing very\nresilient and efficient distribution systems. Enterprises should be thinking about how to\nimmediately reduce their risk exposure and act on this actionable intelligence. We’d like to\n[thank our information sharing friends and intelligence partners, including Tim Davies.](https://twitter.com/0xtadavie)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-10-31 - Emotet Awakens With New Campaign of Mass Email Exfiltration.pdf"
    ],
    "report_names": [
        "2018-10-31 - Emotet Awakens With New Campaign of Mass Email Exfiltration.pdf"
    ],
    "threat_actors": [
        {
            "id": "16f2436b-5f84-44e3-a306-f1f9e92f7bea",
            "created_at": "2023-01-06T13:46:38.745572Z",
            "updated_at": "2025-03-27T02:00:02.907444Z",
            "deleted_at": null,
            "main_name": "APT40",
            "aliases": [
                "ISLANDDREAMS",
                "TEMP.Jumper",
                "BRONZE MOHAWK",
                "GADOLINIUM",
                "KRYPTONITE PANDA",
                "TA423",
                "MUDCARP",
                "Gingham Typhoon",
                "TEMP.Periscope",
                "G0065",
                "ATK29",
                "Red Ladon",
                "ITG09"
            ],
            "source_name": "MISPGALAXY:APT40",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "59be3740-c8c7-47aa-84c8-e80d0cb7ea3a",
            "created_at": "2022-10-25T15:50:23.481057Z",
            "updated_at": "2025-03-27T02:00:55.480695Z",
            "deleted_at": null,
            "main_name": "Leviathan",
            "aliases": [
                "MUDCARP",
                "Kryptonite Panda",
                "Gadolinium",
                "BRONZE MOHAWK",
                "TEMP.Jumper",
                "APT40",
                "TEMP.Periscope",
                "Gingham Typhoon"
            ],
            "source_name": "MITRE:Leviathan",
            "tools": [
                "Windows Credential Editor",
                "BITSAdmin",
                "HOMEFRY",
                "Derusbi",
                "at",
                "BLACKCOFFEE",
                "BADFLICK",
                "gh0st RAT",
                "PowerSploit",
                "MURKYTOP",
                "NanHaiShu",
                "Orz",
                "Cobalt Strike",
                "China Chopper"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535760,
    "ts_updated_at": 1743041127,
    "ts_creation_date": 1653751123,
    "ts_modification_date": 1653751123,
    "files": {
        "pdf": "https://archive.orkl.eu/81b98601e62a742e4757053b15a774daa71746c0.pdf",
        "text": "https://archive.orkl.eu/81b98601e62a742e4757053b15a774daa71746c0.txt",
        "img": "https://archive.orkl.eu/81b98601e62a742e4757053b15a774daa71746c0.jpg"
    }
}