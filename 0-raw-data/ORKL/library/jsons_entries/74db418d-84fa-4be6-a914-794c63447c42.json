{
    "id": "74db418d-84fa-4be6-a914-794c63447c42",
    "created_at": "2023-01-12T15:06:30.922833Z",
    "updated_at": "2025-03-27T02:10:31.587131Z",
    "deleted_at": null,
    "sha1_hash": "26a51548f734532ec0a5fcbbe4e991db165a0cb5",
    "title": "2021-05-06 - Ransomware- Hunting for Inhibiting System Backup or Recovery",
    "authors": "",
    "file_creation_date": "2022-05-27T23:17:31Z",
    "file_modification_date": "2022-05-27T23:17:31Z",
    "file_size": 195480,
    "plain_text": "# Ransomware: Hunting for Inhibiting System Backup or Recovery\n\n**[cyborgsecurity.com/cyborg_labs/hunting-ransomware-inhibiting-system-backup-or-recovery/](https://www.cyborgsecurity.com/cyborg_labs/hunting-ransomware-inhibiting-system-backup-or-recovery/)**\n\nMay 6, 2021\n\nRansomware continues to be a hot button issue for organizations around the world. APT\nactors, commodity malware operators and even attackers who had never used ransomware\nbefore started picking up the trend over the last several years. In years past, attackers turned\nto ransomware to exploit an organization’s lack of a good backup plan, disaster recovery\nplan, or coax the victim into paying a ransom to maintain their operations and reduce\ndowntime. However, an unfortunate fact of ransomware infections is how rare full recovery is,\nafter payment occurs.\n\n\nransomware\n\n\n-----\n\nGiven this fact, as well as several vendors and global government organizations highly\nrecommending not paying and instead reverting to recovery options, ransomware infections\nwere becoming less impactful when relying on data encryption alone. This is where the trend\nof stealing and holding a victim’s confidential data for ransom has started to become\n[prevalent amongst ransomware variants, sometimes referred to as ‘doxware.’ Ransomware](https://www.cyborgsecurity.com/cyborg_labs/the-rise-of-doxware-capable-ransomware/)\n“leak sites” are popping up regularly on the dark and clear webs. These leak sites publicly\nshame their victims and threaten to release sensitive information if their demands are not\nmet. This makes ransomware an incredibly formidable foe, requiring organizations to focus\nmore effort on detection and prevention.\n\nFortunately for defenders, there are many common calling cards of ransomware. Cyborg\nSecurity researchers performed research and analysis on more than twenty of the top\nvariants of ransomware, many accounting for highly visible and damaging attacks. In the\nfollowing section we’ll break down one of the most common techniques employed by\nransomware, how to detect the multiple variations that are deployed, give specific\nexamples by variant and how to analyze and attribute observed activity back to the\nspecific variant. Armed with this information defenders will be able to choose the best hunt\nfor their organization that can cast a wide net with as little potential for false positives as\npossible.\n\n## Inhibiting System Recovery – MITRE ATT&CK Technique T1490\n\n[There are several methods that ransomware uses in order to inhibit system recovery, stop](https://attack.mitre.org/techniques/T1490)\nfurther recoveries, and corrupts or deletes available recovery points on a system. The most\ncommon method observed during Cyborg Security’s research was the use of vssadmin to\ndelete “Shadow Copies” from the system. Given this became nearly common place for\nransomware, developers began exploring other options such as utilizing PowerShell, wmic,\nbcdedit, net.exe and wbadmin. The utilization of these built in Windows applications is so\ncommon in ransomware, it’s nearly impossible to attribute the specific ransomware based\nsolely on the method in which it prevents system backups.\n\n## Hypothesis \n\nDynamic analysis utilizing industry leading malware sandboxes, manual analysis, EDR and\nwindows logging, it was noted in some cases, dependent on ransomware variant, process\ncreation events were not logged for each application called within the cmd.exe or\npowershell.exe command. As such searching within the command line of a PowerShell or\nCommand Shell execution must be performed to avoid missing potential attacks. During\nanalysis it was found bcdedit, wmic, vssadmin, powershell and net were all used as a form of\ninhibiting a backup from being taken or utilized for system recovery. Although several\n\n\n-----\n\nvariants utilize the same technique with the same application it was found several utilized\nvariations of commands or utilized the application completely different than another, which\nalso needs to be accounted for within any generated logic.\n\n## Response\n\nThe majority of analyzed ransomware variants did not exhibit unique deployments of this\ntechnique. As such, analysts will need to review source processes, parent processes and\nrelated process executions or creation events for further signs of a ransomware infection and\nattribute the activity to a specific ransomware. The easiest method to attribute the\nransomware variant, if it appears a successful infection is identified, is to search for file write\nevents or analyze other data from the suspected host looking for files created or modified\nwith abnormal extensions. Many ransomware variants make it easy and add the variant’s\nname as the extension, while others use a randomized string and require other artifacts for\nattribution. Other methods can include reviewing services or processes stopped or deleted\nby the ransomware binary or script. Often each variant will choose a specific set of services\nto disable, stop, delete or uninstall applications. If these methods fail, identifying the directory\nand binary name (it’s structure), combined with the already identified artifacts, can assist in\nfinal attribution.\n\n## In-scope Ransomware Variants \n\n-  Ako (Ranzy)\n\n-  Avaddon\n\n-  Conti\n\n-  Lockbit\n\n-  Maze\n\n-  Nemty (Nefilm)\n\n-  ProLock\n\n-  Ragnar\n\n-  RansomExx\n\n-  Ryuk\n\n-  Snatch\n\n-  Sodinokibi (REvil)\n\n-  Darkside\n\n-  Pysa (Mespinoza)\n\n-  Netwalker\n\n## Out-of-Scope Ransomware\n\nMITRE ATT&CK also tracks a number of other ransomware families that use T1490,\nincluding\n\n\n-----\n\n-  BitPaymer (S0570)\n\n-  H1N1 (S0132)\n\n-  InvisiMole (S0260)\n\n-  JCry (S0389)\n\n-  MegaCortex S0576)\n\n-  Olympic Destroyer (S0365)\n\n-  RobbinHood (S0400)\n\n-  WannaCry (S0366)\n\nHowever, for the purposes of this analysis, these malware families will remain out-of-scope.\n\n## Hypothesis Summaries \n\n**By Process Name**\n```\nprocessName equals any of (\"vssadmin.exe\", \"bcdedit.exe\", \"wmic.exe\",\n\"powershell.exe\", \"wbadmin.exe\") \nAND \ncommandLine contains any of (\"recoveryenabled no\", \"IgnoreAllFailures\", \"delete\nshadows\", \"delete systemstatebackup\", resize shadowstorage\", \"_ShadowCopy\",\n\"safeboot minimal\", \"shadowcopy /nointeractive\", \"shadowcopy delete\") \n\n```\n**By Command Line**\n```\nprocessName equals and of (\"cmd.exe\", \"powershell.exe\") \nAND \ncommandLine contains any of (\"vssadmin \", \"vssadmin.exe \", \"bcdedit \", \"bcdedit.exe\n\", \"wmic \", \"wmic.exe \", \"wbadmin \", \"wbadmin.exe \", \"Get-WmiObject \") \nAND \ncommandLine contains any of (\"recoveryenabled no\", \"IgnoreAllFailures\", \"delete\nshadows\", \"delete systemstatebackup\", resize shadowstorage\", \"_ShadowCopy\",\n\"safeboot minimal\", \"shadowcopy /nointeractive\", \"shadowcopy delete\") \n\n## Executions by Application and Variant\n\n```\n**VSSAdmin**\n\n_Families: Ako, Avaddon, Conti, Lockbit, Ragnar, Ryuk, Netwalker_\n```\nvssadmin.exe Delete Shadows /All /Quiet\n\n```\n\n-----\n\n_Families: Nemty, ProLock_\n```\n\"C:\\Windows\\System32\\cmd.exe\" /c vssadmin resize shadowstorage /for=C: /on=C:\n/maxsize=401MB\n\"C:\\Windows\\System32\\cmd.exe\" /c vssadmin resize shadowstorage /for=C: /on=C:\n/maxsize=unbounded\n\n```\n**WMIC (WMI Command Line)**\n\n_Families: Ako, Avaddon, Lockbit_\n```\nwmic.exe SHADOWCOPY /nointeractive =\n\n```\n_Families: Lockbit, Nemty, Ragnar, Ryuk_\n```\nwmic shadowcopy delete\n\n```\n_Families: Maze_\n_Analysis note: This command was a curious find as it’s a defense evasion technique to break_\ndetections relying on the full path of wmic\n```\nC:\\i\\hhwq\\jees\\..\\..\\..\\Windows\\hpn\\a\\..\\..\\system32\\s\\p\\..\\..\\wbem\\vax\\pq\\..\\..\\wmic.\n\n```\n**PowerShell**\n\n_Families: Darkside, Nemty_\n\n_Analysis note: Several samples analyzed of each of these variants utilized obfuscation of the_\nPowerShell command. In some instances it was found deobfuscated in logging, specifically\nin PowerShell logging and EDR, but analysts should be aware its often obfuscated in the\nlogs.\n```\nGet-WmiObject Win32_Shadowcopy | ForEach-Object {$_.Delete();}\n\n```\n**BCDEdit**\n\n_Families: Ako, Avaddon, Lockbit, Nemty, Ragnar, RansomExx, Ryuk, Sodinokibi_\n\n_Analysis note: It is worth noting that the Ragnar ransomware did not perform_\nthe bcdedit command setting “recoveryenabled” to “no” in the samples analyzed.\nAdditionally, in most of the samples analyzed across the variants noted below, the\n\n\n-----\n\ncommands were chained together with an ampersand (&) to run as one command, either\nutilizing powershell.exe or cmd.exe.\n```\nbcdedit /set {default} bootstatuspolicy ignoreallfailures\nbcdedit /set {default} recoveryenabled no\n\n```\n_Families: Snatch_\n```\nc:\\windows\\System32\\bcdedit.exe /set {current} safeboot minimal\n\n```\n**WBAdmin**\n\n_Families: Ako, Avaddon, Lockbit, Ragnar_\n```\nwbadmin DELETE SYSTEMSTATEBACKUP\nwbadmin DELETE SYSTEMSTATEBACKUP -deleteOldest\n\n```\n_Families: Lockbit, Nemty_\n```\nwbadmin delete catalog -quiet\n\n```\n**Net**\n\n_Families: Conti_\n```\nnet stop BackupExecAgentAccelerator /y\nnet stop BackupExecVSSProvider /y\n\n## Conclusion\n\n```\nRansomware deploys a wide array of techniques, often making it difficult to effectively\nhunt for several variants at a time. This is especially true for the early stages of the infection\nchain, such as the Installation phase, to detect, identify and respond as quickly as possible to\nthe potential threat. Hunting for ransomware attempting to inhibit a host’s recovery ability is\none of, if not the best methods for identifying potential ransomware attacks, post-delivery.\nThis is largely due to the limited composition of the commands to carry out the\ntechnique, and its rarity of being observed for legitimate purposes. Although hunting for this\ntechnique may not make it readily apparent which ransomware variant is lurking in your\norganization, it’s certainly one of the best bangs for your hunting and time.\n\n\n-----\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-05-06 - Ransomware- Hunting for Inhibiting System Backup or Recovery.pdf"
    ],
    "report_names": [
        "2021-05-06 - Ransomware- Hunting for Inhibiting System Backup or Recovery.pdf"
    ],
    "threat_actors": [
        {
            "id": "11f52079-26d3-4e06-8665-6a0b3efdc41c",
            "created_at": "2022-10-25T16:07:23.736987Z",
            "updated_at": "2025-03-27T02:02:09.954078Z",
            "deleted_at": null,
            "main_name": "InvisiMole",
            "aliases": [
                "UAC-0035"
            ],
            "source_name": "ETDA:InvisiMole",
            "tools": [
                "InvisiMole"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "12b5d602-4017-4a6f-a2a3-387a6e07a27b",
            "created_at": "2023-01-06T13:46:39.095233Z",
            "updated_at": "2025-03-27T02:00:02.995336Z",
            "deleted_at": null,
            "main_name": "InvisiMole",
            "aliases": [],
            "source_name": "MISPGALAXY:InvisiMole",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535990,
    "ts_updated_at": 1743041431,
    "ts_creation_date": 1653693451,
    "ts_modification_date": 1653693451,
    "files": {
        "pdf": "https://archive.orkl.eu/26a51548f734532ec0a5fcbbe4e991db165a0cb5.pdf",
        "text": "https://archive.orkl.eu/26a51548f734532ec0a5fcbbe4e991db165a0cb5.txt",
        "img": "https://archive.orkl.eu/26a51548f734532ec0a5fcbbe4e991db165a0cb5.jpg"
    }
}