{
    "id": "561d9f82-4410-4a81-addc-e63b5c2c0c98",
    "created_at": "2023-01-12T15:07:50.978634Z",
    "updated_at": "2025-03-27T02:05:47.716966Z",
    "deleted_at": null,
    "sha1_hash": "5a960def9c858342e826a58d5f1f0311d19e52de",
    "title": "2018-09-10 - IBM X-Force Delves Into ExoBot’s Leaked Source Code",
    "authors": "",
    "file_creation_date": "2022-05-28T21:49:12Z",
    "file_modification_date": "2022-05-28T21:49:12Z",
    "file_size": 3045950,
    "plain_text": "# IBM X-Force Delves Into ExoBot's Leaked Source Code\n\n**[securityintelligence.com/ibm-x-force-delves-into-exobots-leaked-source-code/](https://securityintelligence.com/ibm-x-force-delves-into-exobots-leaked-source-code/)**\n\nSeptember 10, 2018\n\n\n-----\n\n[Banking & Finance September 10, 2018](https://securityintelligence.com/category/topics/banking-financial-services-industry/)\nBy [Shahar Tavor co-authored by Limor Kessem 9 min read](https://securityintelligence.com/author/shahar-tavor/)\n[Following the recent source code leak of the Android banking Trojan ExoBot, IBM X-Force](https://securityintelligence.com/news/unknown-actor-leaks-android-malware-exobot-source-code/)\nresearch delved into the malware’s inner workings to help uncover insights into its dynamic\nmechanisms and the features that help criminals use it in cross-channel bank fraud.\n\n## ExoBot Genesis\n\n[ExoBot is Android malware that was based originally on a previous code known as Marcher.](https://securityintelligence.com/marcher-mobile-bot-adds-uk-targets-steps-up-banking-fraud-capabilities/)\nThis code represents a banking Trojan that uses the overlay technique — that is, popping up\nfake windows that hide the original app users open — to trick victims into tapping their\nbanking credentials into a fake interface. After stealing account access details, the malware\ncan also intercept SMS messages and phone calls, thereby enabling criminals to take over\nthe victim’s bank account and other financial accounts at their discretion.\n\nSome of the capabilities that enable ExoBot to facilitate fraudulent activity on infected\ndevices include gaining admin privileges, launching overlay screens, and exfiltrating SMS,\ndata and other information from the infected device.\n\nIn 2016, ExoBot’s developer was selling the malware on the clear web for a while, even\n[advertising an upgrade in May 2017. In January 2018, the actor decided to sell it off in the](https://exchange.xforce.ibmcloud.com/collection/ExoBot-Android-Malware-e112e0be1fefdcfbc013f6202a6fcaff)\nunderground, but by May 2018, the source code was leaked online by an unknown actor.\n\nSource code leaks, especially those of Android malware codes, have happened in the recent\npast. When they do, they give rise to variants and variations of the same malware, lowering\nthe bar for more criminals to enter the mobile malware scene and try their hand at mobile\nbanking fraud.\n\n## Delving Into ExoBot’s Inner Workings\n\nThe following sections describe technical details about ExoBot as analyzed by X-Force\nmobile threat researcher Shahar Tavor.\n\n### Architecture Basics\n\nHaving analyzed ExoBot’s leaked source code, X-Force researchers found the malware to\npossess some notable features, such as dynamic modules loaded at runtime and some antiemulation tricks to evade popular sandboxes.\n\nThe image below illustrates the malware’s architecture. The overall routine occurs as follows:\n\n1. An Android mobile device user unknowingly downloads a loader app via SMS spam or\n\ndirectly from the official store.\n2. The loader app calls back to the attacker’s command-and-control (C&C) server and is\n\nreplied with the most recent version of the malware binary\n\n\n-----\n\n3. ExoBot is fetched and executed on the device.\n4. ExoBot downloads a .dex file from the C&C server. This file is the malware’s main\n\nmodule. This component is central to ExoBot’s functionality, and without it, most\nmalware features would not work.\n5. The attacker can now send commands to the malware; those are handled by the main\n\nmodule.\n\n_Figure 1: ExoBot’s architecture_\n\n## ExoBot’s Infection Routine\n\nExoBot mostly spreads to new devices via SMS spam and sometimes via downloader apps\nthat [make it into the official stores.](https://securityintelligence.com/anubis-strikes-again-mobile-malware-continues-to-plague-users-in-official-app-stores/)\n\n### First Run\n\nAt its first run on a device, ExoBot removes the application icon from the home screen,\nminimizes all running apps, and then shows the home screen so that the infected user\nwouldn’t notice anything new on his or her device.\n\n\n-----\n\n### OpSec Checks\n\nTo evade sandboxes and automated analysis, ExoBot performs several checks before\nrunning:\n\n**Anti-emulation checks — Like other malware, Android malware is often analyzed by**\nmobile threat researchers’ emulators and sandboxes. To dodge the analysis, ExoBot\nchecks the environment’s build model, International Mobile Equipment Identity (IMEI)\nand registered operator.\n**Antidebugging — To evade debugging by automated tools, ExoBot uses the**\nisDebuggerConnected() function to determine if a debugger is attached to the device.\n**Country filter — To limit the reach of local law enforcement, some malware codes**\navoid running in Eastern European countries. ExoBot’s developer included a special list\nof countries where the malware should not run:\n\nArmenia\nAzerbaijan\nBelarus\nCanada\nKazakhstan\nKyrgyzstan\nMoldova\nRussia\nSerbia and Montenegro\nSlovakia\nTajikistan\nTurkmenistan\nUkraine\nUnited States\nUzbekistan\n\nInterestingly, Canada and the U.S. are on the list of countries that would not be targeted.\n\nA second filter is applied by the language set on the device. The following language\nspecifications will make ExoBot stop running on the device:\n\nArmenian\nAzeri (Latin)\nBelarusian\nChinese\nCzech\nIndo-European\nKyrgyz\nRomanian\nRussian\n\n\n-----\n\nSlovak\nTurkish\nUkrainian\nUzbek (Latin)\n\n### Device Admin Request\n\nTo be able to use all of its features, especially locking the user’s screen and changing the\n[lock screen’s password, ExoBot needs to run with admin permissions. Requiring this](https://securityintelligence.com/administrator-credentials-a-security-breach-waiting-to-happen/)\npermission level involves the infected user, and to solicit his or her help, ExoBot displays a\nfake screen that purports to be the GNU General Public License.\n\n_Figure 2: ExoBot asking for admin permissions via a fake GNU page_\n\nBy gaining the admin permission level, ExoBot can also establish its persistence mechanism\nand ensure that the user would not be able to remove the app without disabling the malware\nwith equal permissions. Getting rid of ExoBot involves manually removing it from the device\nadmin apps list. Unfortunately, even after removals, ExoBot will pop up a screen asking the\nuser to activate it.\n\n\n-----\n\n### Obfuscation\n\nTo keep its resources protected, ExoBot’s developer uses two obfuscation techniques:\n\n1. String protection — The malware’s operator can elect to replace all string characters\n\nwith a key of his or her choosing.\n\n_Figure 3: String protection_\n\nThis can be reversed by a decrypt function, which replaces the new key with the default key\nand reverts to the previous string.\n\n_Figure 4: Reversing the string obfuscation_\n\n1. Advanced Encryption Standard (AES) encryption of requests and responses from\n\nthe C&C server, as well as encrypting the malware’s configuration. The encryption was\nimplemented using a hardcoded key and then Base64 encoding.\n\n### ExoBot’s Continuous C&C Communication\n\nWith new infections, ExoBot retrieves modules from the C&C server and then continually\nkeeps in touch with it to check for new tasks assigned by the attacker. If new tasks are found,\nExoBot queues them for execution in a designated file located in in a private folder on disk.\nAll the information in the queue is saved in encrypted form. The queue file is used throughout\nthe malware’s activity and life cycle.\n\nTo keep on top of tasks, ExoBot checks them periodically and by an alarm setup. Requests\nand responses are kept encrypted in JavaScript Object Notation (JSON) format.\n\n_Figure 5: Queue file with pending tasks_\n\n\n-----\n\nUntil a new task is sent through, the malware will continue to update the C&C server with\ninformation about the device, the installed apps and a configuration status.\n\n_Figure 6: ExoBot sends a request with device information to the C&C server_\n\nExoBot’s C&C communication is secured with an SSL.\n\nTo identify devices, each infected device receives a unique MD5 with its identifiers: IMEI,\nbuild model, central processing unit (CPU) and Android ID. The details are transmitted to the\nC&C server under the “I” field inside every JSON request.\n\n### Dynamic Module Loading\n\nUnlike similar malware, ExoBot has a unique method to load its modules in a dynamic way.\nThe image blow shows the code that enables this tactic to work:\n\n_Figure 7: Code snippet showing ExoBot’s dynamic module loading_\n\nThe developer here used the payload to manage module loading. The main module is the\ncomponent that downloads the modules from the C&C on its first run, and it’s also the\ncomponent that handles them later when they are required to run.\n\nModules are loaded to memory in reflection, giving the malware the ability to inspect and\ndynamically call classes, methods and attributes at runtime instead of having to do that at\ncompile time.\n\nThe reflection is implemented using the Android DexClassLoader application programming\ninterface (API), which is a class loader that allows an application to load .jar and APK files.\nThis method can be used to execute code that was not previously installed as part of an\nexisting app and load it into that app during runtime.\n\nNote that ExoBot’s .dex file is still present on disk, but the code is not packed within the APK.\nUsing reflection in this case allows the malware to avoid static analysis of its modules and\nkeep them out of antivirus engines’ sight. Moreover, loading in runtime gives ExoBot added\nagility. It can fetch new modules from the C&C server at any time and add/update its features\neasily and quickly on devices that are already infected.\n\n\n-----\n\n## Module Execution\n\nTo execute modules, ExoBot’s C&C server sends the malware a command with relevant\nparameters alongside the MD5 hash of a .dex file that contains the module to ensure the\ncorrect one is executed:\n\n_data/data/app_package_name/m/md5(module_name).dex_\n\nThe malware then proceeds with the required action on the infected device.\n\nIn some cases, the module may not exist in the malware’s folder on the device, and it will\nlaunch a request to download it from the C&C server.\n\n_Figure 8: ExoBot requesting a module download from the C&C server to get the victim’s_\n_contacts_\n\nNext, ExoBot hashes the required module on disk and compares its MD5 to the one\nattributed to that module on the C&C server. This step is taken to prevent tampering and\nerrors. Upon confirming a match, the malware loads the requested module and reports the\nresult back to the C&C server.\n\n_Figure 9: ExoBot’s request to get contacts from the victim’s texting app_\n\nA result in JSON format contains data returned from the module alongside an API status field\nindicating whether the module is running properly or has failed.\n\n\n-----\n\n### ExoBot s Module List\n\nThe following table shows the modules that enable ExoBot’s capabilities. The first table lists\nthe existing modules, and the second one lists modules that were yet to be added by the\ndeveloper.\n\n\n**Active Module**\n**Name**\n\n\n**Description**\n\n\n**notification** Show notification. A tap on the notification screen will launch a\nspecified app.\n\n**ussd** Execute USSD code.\n\n\n**send_sms**\n**(sms)**\n\n\nSend single SMS from the bot to a specified phone number.\n\n\n**mass_sms** Send SMS to all contacts.\n\n**mass_sms_plus** Send SMS by list of URLs specified in Settings.\n\n**screen_lock_on** Lock device screen with a specified webpage the server sends.\n\n**screen_lock_off** Disable screen lock.\n\n**intercept_on** Send all incoming SMS to attacker’s control panel. Delete SMS from\ndevices older than Android v4.4 (if higher – use the deleted SMS).\n\n**intercept_off** Disable SMS Intercept.\n\n**kill_on** Disable screen permanently, mute sound, change lock screen\npassword. * Parameters: password (Default value: 9990).\n\n**kill_off** Unlock screen and remove lock screen password.\n\n**update_info** Update full bot information (language, operator, list of apps, contacts,\nIMEI, OS version, number, device model).\n\n**sms_redirect** Forward incoming SMS to a specified phone number.\n\n**repeat_inject** Repeat activation of previous overlay.\n\n\n-----\n\n**Active Module**\n**Name**\n\n\n**Description**\n\n\n**get_contacts** Get contacts from an address book of the phone.\n\n**fire_cc** Display a fake screen requesting the victim’s credit card details.\n\nThe following modules are not active as yet:\n\n**Inactive Module Name** **Description**\n\n**unblock_inject** Start showing an overlay for specified app.\n\n**block_inject** Stop showing overlay for specified app.\n\n**admin_phone** Set admin to control bot by SMS.\n\n**api_server** Change API server list.\n\n**request_coordinates** Get current location.\n\n**request_token** Ask for victim’s one-time password/token from a device folder.\n\n## ExoBot’s Overlay Screen Mechanism\n\n[Overlay malware has been around for a while, but the method became popular when GM Bot](https://securityintelligence.com/gm-bot-alive-upgraded-now-android-m/)\nstarted commercializing it in the underground. Ever since GM Bot, various Android banking\nTrojans use the overlay tactic, implementing its use in different ways.\n\nIn ExoBot’s case, the overlay screen pop-up takes place by detecting the foreground app\nand then displaying a custom webpage activity to match that app. In the case of banks,\ncryptocurrency exchanges, payment and shopping apps, the fake screen will match their\nlogin screens.\n\nTo begin, ExoBot gets its target list from the C&C server. The malware scans all the files\nfound under the /proc virtual filesystem to map all running processes the user initiated. It\ndoes not scan apps and processes users cannot launch themselves.\n\n\n-----\n\n_Figure 10: Listing all active processes from /proc_\n\nAt startup, services of the Android operating system run in the bg_non_interactive state. This\nstate means that the service is at low priority at the time and cannot use more than 5 percent\nof the CPU. To determine if an app of interest is running in the foreground, the malware\nchecks if the app’s process ID (PID) is not in the noninteractive state list.\n\n_Figure 11: Looking for processes that run in the foreground_\n\nIf a targeted app is running in the foreground, ExoBot will pop up a new activity on top of the\noriginal app, covering it and prioritizing the fake screen. In the overlay, a custom webpage\nimpersonates the login interface of the original app to phish the victim’s credentials.\n\n## Persistent Credit Card Requests\n\nOn top of targeting banking and other financial applications, social and chat apps, ExoBot\npossesses a module designed to steal payment card information.\n\n\n-----\n\nThis module is tasked with frequent pop-ups of fake screens that require victims to tap their\npayment card details into the activity. The lure is set up as a notification from Google Play, or\nfrom other services for Android-based devices.\n\n## Mobile Malware Continues to Evolve\n\nExoBot’s code leak is just another leak among others that provide cybercriminals with a basis\nfor malware that they can adapt to their own illicit operations and attacks. With this code\nleak, X-Force researchers expect to see ExoBot offspring in the coming months, as well as\nnew actors who will use it in different geographies to target local banks through their mobile\nbanking user base.\n\nTo mitigate the threat of mobile malware, organizations can help protect their apps with IBM\nTrusteer. Those managing employee mobile devices can learn more about IBM’s unified\n[endpoint management (UEM) solution, MaaS360.](https://www.ibm.com/security/mobile/maas360)\n\nAlthough we worked directly with the source code, here are some recent ExoBot samples for\nthose looking to analyze this version:\n\n42751858e99b7add2f4ac9e00e348d40\n285197e39072bda563ccebc0fba78648\n80b5821c7f1649b176381efaadb90f68\nf1ad35e91b45b5375e08666b39ca791b\n3ff9fadb87812571f799a35c13d8490c\n\n[Our team also manages and updates an ExoBot collection on X-Force Exchange.](https://exchange.xforce.ibmcloud.com/collection/ExoBot-Android-Malware-e112e0be1fefdcfbc013f6202a6fcaff)\n\n[Read the white paper: How Digital Banking Is Transforming Fraud Detection](https://www.ibm.com/marketing/iwm/dre/signup?source=urx-18586&S_PKG=ov60471)\n\n[Shahar Tavor](https://securityintelligence.com/author/shahar-tavor/)\nMobile Security Researcher, IBM\n\nMobile security researcher at IBM Security Trusteer group. Shahar is passionate about\nmalware research, mobile security, reverse engineering and Android inte...\n\n\n-----\n\n-----\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-09-10 - IBM X-Force Delves Into ExoBot’s Leaked Source Code.pdf"
    ],
    "report_names": [
        "2018-09-10 - IBM X-Force Delves Into ExoBot’s Leaked Source Code.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536070,
    "ts_updated_at": 1743041147,
    "ts_creation_date": 1653774552,
    "ts_modification_date": 1653774552,
    "files": {
        "pdf": "https://archive.orkl.eu/5a960def9c858342e826a58d5f1f0311d19e52de.pdf",
        "text": "https://archive.orkl.eu/5a960def9c858342e826a58d5f1f0311d19e52de.txt",
        "img": "https://archive.orkl.eu/5a960def9c858342e826a58d5f1f0311d19e52de.jpg"
    }
}