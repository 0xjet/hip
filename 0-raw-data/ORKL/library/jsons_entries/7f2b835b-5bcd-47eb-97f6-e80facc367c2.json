{
    "id": "7f2b835b-5bcd-47eb-97f6-e80facc367c2",
    "created_at": "2023-01-12T15:08:51.300012Z",
    "updated_at": "2025-03-27T02:09:29.478896Z",
    "deleted_at": null,
    "sha1_hash": "913adb962ef79fa0550e8abe517be13560238888",
    "title": "2012-08-02 - Cridex Analysis using Volatility",
    "authors": "",
    "file_creation_date": "2022-05-27T23:20:18Z",
    "file_modification_date": "2022-05-27T23:20:18Z",
    "file_size": 1158930,
    "plain_text": "# Cridex Analysis using Volatility\n\n**[sempersecurus.org/2012/08/cridex-analysis-using-volatility.html](http://www.sempersecurus.org/2012/08/cridex-analysis-using-volatility.html)**\n\n## Update 1 - August 5, 2012 - located at end of post\n\n Update 2 - August 7, 2012 - located at end of post\n\n[I had read previous analysis reports about Cridex from various sites as M86 Security and](http://labs.m86security.com/2012/03/the-cridex-trojan-targets-137-financial-organizations-in-one-go/)\n[Kahu Security. At the time, I filed this under \"another banking trojan\" to track, and moved on](http://www.kahusecurity.com/2012/spear-phish-leads-to-cridex/)\nto to other things. However Cridex once again piqued my interest when I saw an excellent\n[analysis by Kimberly at StopMalvertising. I took particular attention to her listing of the](http://stopmalvertising.com/rootkits/analysis-of-cridex.html)\nCridex C&C servers she observed, as several of these IP blocks were familiar to me. More\non this later.  Having obtained the same Cridex sample analyzed by Kimberly, I was\ninterested to see how Volatility could be used to analyze it. This Cridex sample had MD5\nhash, 734aadd62d0662256a65510271d40048. I executed the sample and dumped the\nmemory for analysis. A copy of this memory dump is linked at the bottom of this post.\n\nUsing the Volatility ['plist' command, we can see a list of the running processes. However it's](http://code.google.com/p/volatility/wiki/CommandReference21#pslist)\n[instructive to use this in conjunction with the 'psscan' command in order to see those](http://code.google.com/p/volatility/wiki/CommandReference21#psscan)\nprocesses that have terminated, are unlinked, or hidden. In this case, no discrepancies\nbetween the two commands jump out at me, but I do notice a couple of things.  First, I see a\nprocess, reader_sl.exe, PID1640 start exactly at the same time as its parent process,\n**_explorer.exe, PID1484. I see that the parent process ID for explorer.exe is 1464, which is_**\n\n\n-----\n\nnot listed in either pslist or psscan . reader_sl.exe is a supposedly a safe process,\nassociated with Adobe Speed Launcher, but the launch chain for this seems odd, so I'll keep\nnote of this for now. Next, I see a second wuauclt.exe process start about 15 seconds after\nthe first. This isn't a major flag, but just something to note.\n\npslist command\n\npsscan command\n\n[The next useful Volatility command that I use for malware analysis is the 'connections' and](http://code.google.com/p/volatility/wiki/CommandReference21#connections)\nthe ['connscan' commands. Again, running both of these will allow you to see variances, as](http://code.google.com/p/volatility/wiki/CommandReference21#connscan)\n'connscan' will show artifacts from previous connections.\n\n\n-----\n\nconnections & connscan commands\n\nNote that 'connections' shows that PID 1484, explorer.exe had an active connection to\nremote IP address 41.168.5.140 on port 8080. 'connscan' shows an artifact of a previous\nconnection by PID 1484 to remote IP address 125.19.103.198, also on port 8080. A quick\n'whois' shows: 41.168.5.140\n\nnetname: NEOTEL\ndescr: NEOTEL PTY LTD\ncountry: ZA\n\n**125.19.103.198**\ndescr: Bharti Tele-Ventures Limited\ndescr: NEW DELHI\ncountry: IN\n\n[Next, running 'sockets' and](http://code.google.com/p/volatility/wiki/CommandReference21#sockets) ['sockscan' will show any listening sockets that may have been](http://code.google.com/p/volatility/wiki/CommandReference21#sockscan)\ninitiated by a running process. As in 'conscan', 'sockscan' will show any detected artifacts\nfrom previous sockets. In this case, we see that PID 1484, explorer.exe, opened a listening\nsocket on port 1038 approx. 2 minutes after PID 1484 was created.\n\n\n-----\n\nsockets and sockscan commands\n\nRunning the 'malfind' command against our two suspect processes yields the following:\n\nmalfind command on PID 1484 & 1640\n\n\n-----\n\nIn this output, we see that the explorer.exe, PID1484 and reader_sl.exe, PID1640 processes\nhave a PE section located at 0x1460000 and 0x3d0000 respectively. By using the \"-D\"\nswitch, 'malfind' can dump those identified segments to a dump directory for further analysis.\n\n[We now enumerate the mutant/mutex objects for the two processes under review. Note that](http://code.google.com/p/volatility/wiki/CommandReference21#mutantscan)\nI used the Volatility 'handles' command, with a subtype selection of \"Mutant\" in order to\nspecifically select the mutant/mutexes associated with PID 1484 and 1640. The ['mutantscan'](http://code.google.com/p/volatility/wiki/CommandReference21#mutantscan)\ncommand will give additional information such as its signaled state, its client ID, and which\nthread acquired the mutant.\n\nprocess mutexes for PID 1484 & 1640\n\nVia some Google queries, we learn that several of these mutex objects have been seen in\nother malware, notably:\n\n746bbf3569adEncrypt\n_SHuassist.mtx\nSHIMLIB_LOG_MUTEX\nXMR8149A9A8\n\nNext, we'll dump the VAD segments of each of these processes, run 'strings', and look for\nanything interesting.\n\n\n-----\n\nvaddump command\n\n'strings' output section from PID 1484, explorer.exe\n\n\n-----\n\n'strings' output section from PID 1640, reader_sl.exe\n\nNote the advantage of dumping the VAD segments as opposed to the entire process\nmemory is that you can see which VAD node section the 'strings' hit was located. In this\nsection, we find a list of banks and financial institutions.  Here is the contents of the Cridex\nconfiguration specifically containing references to financial institutions.\n\nIn addition to the list above, examining these VAD dumps also shows HTML code\nreferencing or representing web pages of various financial organizations. The code seems\nto indicate that these sections are part of the web injection code that is used to obtain\npersonal information from the banking customer. In my test of Cridex, I did not launch a web\nbrowser or continue additional interaction with my infected host. If I had visited a URL\ncontaining these strings, it is believed that Cridex would attempt to log or capture my input,\nand redirect that personal information back to the controller.\n\nWhile we're looking for strings, let's see what shows up for the IP addresses 41.168.5.140 &\n**125.19.103.198 that were seen in the Volatility \"connscan\" command.**\n\n\n-----\n\nSearching for the directory path after the IP addresses gives us another related IP address,\n188.40.0.138:\n\nSo via various string searches and some grepping in the VAD dump directory for PID1484 &\nPID1640 we find these IP addresses of interest:\n\n190.81.107.70\n41.168.5.140\n85.214.204.32\n210.56.23.100\n211.44.250.173\n125.19.103.198\n188.40.0.138\n\n[Maltego lets me draw a pretty picture of the IPs, country of registration, and ASN.](http://www.paterva.com/web5/)\n\n\n-----\n\nCridex IP addresses, ASN, and country of registration.\n\nDoing some additional research, I noted that at one time or another, several domain names\n(now suspended) utilized all of the above listed Cridex IPs (except for 188.40.0.138). In fact,\nthese domains each utilized the same 11 to 14 IP addresses, including the Cridex IPs for\ntheir DNS \"A\" records during their brief activity. Looking at the 'whois' for a sample of these\ndomains shows an entirely different set of IPs used for their NS records... but I digress.\n\ndomain:    VALIDATORONMEE.RU\n\nnserver:    ns1.validatoronmee.ru. 62.213.64.161\n\nnserver:    ns2.validatoronmee.ru. 195.62.52.69\n\nnserver:    ns3.validatoronmee.ru. 62.76.191.172\n\nnserver:    ns4.validatoronmee.ru. 41.66.137.155\n\nnserver:    ns5.validatoronmee.ru. 83.170.91.152\n\nnserver:    ns6.validatoronmee.ru. 85.214.204.32\n\nstate:     REGISTERED, NOT DELEGATED, UNVERIFIED\n\nperson:    Private Person\n\nregistrar:   NAUNET-REG-RIPN\n\nadmin-contact: https://client.naunet.ru/c/whoiscontact\n\ncreated:    2012.04.10\n\npaid-till:   2013.04.10\n\ndomain:    POLUICENOTGO.RU\n\nnserver:    ns1.poluicenotgo.ru. 62.76.41.3\n\nnserver:    ns2.poluicenotgo.ru. 62.213.64.161\n\nnserver:    ns3.poluicenotgo.ru. 195.88.242.10\n\n\n-----\n\nnserver:    ns4.poluicenotgo.ru. 41.66.137.155\nnserver:    ns5.poluicenotgo.ru. 83.170.91.152\nnserver:    ns6.poluicenotgo.ru. 85.214.204.32\nstate:     REGISTERED, NOT DELEGATED, UNVERIFIED\nperson:    Private Person\nregistrar:   NAUNET-REG-RIPN\nadmin-contact: https://client.naunet.ru/c/whoiscontact\ncreated:    2012.04.15\npaid-till:   2013.04.15\n\ndomain:    VITALITYSOMER.RU\nnserver:    ns1.vitalitysomer.ru. 62.213.64.161\nnserver:    ns2.vitalitysomer.ru. 195.62.52.69\nnserver:    ns3.vitalitysomer.ru. 62.76.191.172\nnserver:    ns4.vitalitysomer.ru. 41.66.137.155\nnserver:    ns5.vitalitysomer.ru. 83.170.91.152\nnserver:    ns6.vitalitysomer.ru. 85.214.204.32\nstate:     REGISTERED, NOT DELEGATED, UNVERIFIED\nperson:    Private Person\nregistrar:   NAUNET-REG-RIPN\nadmin-contact: https://client.naunet.ru/c/whoiscontact\ncreated:    2012.04.10\npaid-till:   2013.04.10\n\nThere is much more that you can do with this Cridex memory dump. For example, you can\nuse ['apihooks' on the two processes, then drop into 'volshell' and browse through the pages.](http://code.google.com/p/volatility/wiki/CommandReference21#apihooks)\nYou could find the loaded DLLs, or extract a process of interest.\n\nFor your added research, I've posted a link to the Cridex memory image below. I didn't\nextract other forensic objects for this sample, but as I mentioned in my last post, I plan to do\nthat for other samples going forward.\n-----------------------------------------------------------------------------------------------------------------------------\n## Update 1 - August 5, 2012\n\nIn the comments section, Tamer Hassan posted a question referencing PID 1464. That PID\nis most likely a terminated process where 'psscan' didn't find any associated remnants.\nHowever it might be interesting to search for references to executable files. Since we know\nthat PID 1464 was the parent to PID 1484, it's worth looking for registry artifacts typically\nused by malware. Volatility allows you to carve through the the registry that is resident in\n\n\n-----\n\nmemory and display subkeys, values, and data. In this example, I looked for keys and values\nassociated with \"Software\\Microsoft\\Windows\\CurrentVersion\\Run\" This is accomplished\nvia the ['printkey' command:](http://code.google.com/p/volatility/wiki/CommandReference21#printkey)\n\npython vol.py -f /home/ezio77/cridex.vmem --profile=WinXPSP2x86 printkey -K\n\"Software\\Microsoft\\Windows\\CurrentVersion\\Run\"\n\nSince 'printkey' will go through all hives, you will get multiple hits related to the key in your\nsearch. After displaying multiple hives each with a Last Update date of either 2012-04-12 or\n2012-04-13, you'll see the following:\n\nRegistry: \\Device\\HarddiskVolume1\\Documents and Settings\\Robert\\NTUSER.DAT\nKey name: Run (S)\nLast updated: 2012-07-22 02:31:51\nSubkeys:\nValues:\nREG_SZ    KB00207877.exe : (S) \"C:\\Documents and Settings\\Robert\\Application\nData\\KB00207877.exe\"\n\nPerhaps KB00207877.exe was PID 1464? It's not clear via Volatility at this point, but it's\nmost likely just a copy of the original with an updated registry key. Referring to Microsoft's\n[encyclopedia entry for \"Worm:Win32/Cridex.G\", they reference:](http://www.microsoft.com/security/portal/Threat/Encyclopedia/Entry.aspx?Name=Worm:Win32/Cridex.G#symptoms_link)\n\n**subkey: HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run**\n**Sets value: \"KB<eight-digit number>.exe\"**\n**With data: \"%AppData%\\KB<eight-digit number>.exe\"**\n\nAdditionally, the [VirusTotal analysis for this sample shows references to this naming](https://www.virustotal.com/file/046a7fac35a29f66e37193a2048f6a324754df131bad07c21f87fc814d7763f5/analysis/)\nconvention as well. (Scroll to bottom and select \"Additional Information\")\n\nIn any case, it's good info for further analysis, including examining other registry hives.\n-----------------------------------------------------------------------------------------------------------------------------\n## Update 2 - August 7, 2012\n\nMichael Ligh, was kind enough to drop me a note about the parent of 'explorer.exe'. Michael\nis one of the key contributors to the Volatility project, as well as one of the authors of the\n[\"Malware Analyst's Cookbook and DVD\" . He referenced an excerpt from his book where it](http://www.amazon.com/Malware-Analysts-Cookbook-DVD-Techniques/dp/0470613033/ref=sr_1_1)\nexplains that the parent of 'explorer.exe' is 'userinit.exe', which upon completion, will\nterminate, leaving 'explorer.exe' without a parent. From the [\"Malware Analyst's Cookbook\",](http://www.amazon.com/Malware-Analysts-Cookbook-DVD-Techniques/dp/0470613033/ref=sr_1_1)\npg 585:\n\n\n-----\n\n_Details aren t available for the process with Pid 1536 (which appears to have created_\n_explorer.exe). However, based on what you know about the boot sequence,_\n_Pid 1536 probably belonged to userinit.exe—but it has since exited. Winlogon.exe_\n_launches userinit.exe, which in turn launches explorer.exe. Once userinit.exe is_\n_finished, it terminates, leaving explorer.exe without a parent process. It is still possible_\n_to determine a process’s parent, even after the parent exits, by looking at the_\n__EPROCESS.InheritedFromUniqueProcessId field._\n\nMany thanks Michael!\n\n-----------------------------------------------------------------------------------------------------------------------------[cridex_memdump.zip (40MB)](http://files.sempersecurus.org/dumps/cridex_memdump.zip)\n-----------------------------------------------------------------------------------------------------------------------------\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2012/2012-08-02 - Cridex Analysis using Volatility.pdf"
    ],
    "report_names": [
        "2012-08-02 - Cridex Analysis using Volatility.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "ec14074c-8517-40e1-b4d7-3897f1254487",
            "created_at": "2023-01-06T13:46:38.300905Z",
            "updated_at": "2025-03-27T02:00:02.799108Z",
            "deleted_at": null,
            "main_name": "APT10",
            "aliases": [
                "TA429",
                "STONE PANDA",
                "POTASSIUM",
                "Red Apollo",
                "HOGFISH",
                "Cloud Hopper",
                "BRONZE RIVERSIDE",
                "ATK41",
                "G0045",
                "Menupass Team",
                "happyyongzi",
                "CVNX",
                "Granite Taurus"
            ],
            "source_name": "MISPGALAXY:APT10",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "ba3fff0c-3ba0-4855-9eeb-1af9ee18136a",
            "created_at": "2022-10-25T15:50:23.298889Z",
            "updated_at": "2025-03-27T02:00:55.433541Z",
            "deleted_at": null,
            "main_name": "menuPass",
            "aliases": [
                "menuPass",
                "POTASSIUM",
                "Stone Panda",
                "APT10",
                "Red Apollo",
                "CVNX",
                "HOGFISH",
                "BRONZE RIVERSIDE"
            ],
            "source_name": "MITRE:menuPass",
            "tools": [
                "certutil",
                "FYAnti",
                "UPPERCUT",
                "SNUGRIDE",
                "P8RAT",
                "RedLeaves",
                "SodaMaster",
                "pwdump",
                "Mimikatz",
                "PlugX",
                "PowerSploit",
                "ChChes",
                "cmd",
                "QuasarRAT",
                "AdFind",
                "Cobalt Strike",
                "PoisonIvy",
                "EvilGrab",
                "esentutl",
                "Impacket",
                "Ecipekac",
                "PsExec",
                "HUI Loader"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "04b07437-41bb-4126-bcbb-def16f19d7c6",
            "created_at": "2022-10-25T16:07:24.232628Z",
            "updated_at": "2025-03-27T02:02:10.146043Z",
            "deleted_at": null,
            "main_name": "Stone Panda",
            "aliases": [
                "APT 10",
                "ATK 41",
                "Bronze Riverside",
                "CTG-5938",
                "CVNX",
                "Cuckoo Spear",
                "Earth Kasha",
                "Granite Taurus",
                "Happyyongzi",
                "Hogfish",
                "ITG01",
                "Operation A41APT",
                "Operation Cache Panda",
                "Operation ChessMaster",
                "Operation Cloud Hopper",
                "Operation Cuckoo Spear",
                "Operation New Battle",
                "Operation Soft Cell",
                "Operation TradeSecret",
                "Potassium",
                "Red Apollo",
                "Stone Panda",
                "TA429",
                "menuPass",
                "menuPass Team"
            ],
            "source_name": "ETDA:Stone Panda",
            "tools": [
                "Agent.dhwf",
                "Agentemis",
                "Anel",
                "AngryRebel",
                "BKDR_EVILOGE",
                "BKDR_HGDER",
                "BKDR_NVICM",
                "BUGJUICE",
                "CHINACHOPPER",
                "ChChes",
                "China Chopper",
                "Chymine",
                "CinaRAT",
                "Cobalt Strike",
                "CobaltStrike",
                "DARKTOWN",
                "DESLoader",
                "DILLJUICE",
                "DILLWEED",
                "Darkmoon",
                "DelfsCake",
                "Derusbi",
                "Destroy RAT",
                "DestroyRAT",
                "Ecipekac",
                "Emdivi",
                "EvilGrab",
                "EvilGrab RAT",
                "FYAnti",
                "Farfli",
                "Gen:Trojan.Heur.PT",
                "Gh0st RAT",
                "Ghost RAT",
                "GreetCake",
                "HAYMAKER",
                "HEAVYHAND",
                "HEAVYPOT",
                "HTran",
                "HUC Packet Transmit Tool",
                "Ham Backdoor",
                "HiddenFace",
                "Impacket",
                "Invoke the Hash",
                "KABOB",
                "Kaba",
                "Korplug",
                "LODEINFO",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "MiS-Type",
                "Mimikatz",
                "Moudour",
                "Mydoor",
                "NBTscan",
                "NOOPDOOR",
                "Newsripper",
                "P8RAT",
                "PCRat",
                "PlugX",
                "Poison Ivy",
                "Poldat",
                "PowerSploit",
                "PowerView",
                "PsExec",
                "PsList",
                "Quarks PwDump",
                "Quasar RAT",
                "QuasarRAT",
                "RedDelta",
                "RedLeaves",
                "Rubeus",
                "SNUGRIDE",
                "SPIVY",
                "SharpSploit",
                "SigLoader",
                "SinoChopper",
                "SodaMaster",
                "Sogu",
                "TIGERPLUG",
                "TVT",
                "Thoper",
                "Trochilus RAT",
                "UpperCut",
                "Vidgrab",
                "WinRAR",
                "WmiExec",
                "Wmonder",
                "Xamtrav",
                "Yggdrasil",
                "Zlib",
                "certutil",
                "certutil.exe",
                "cobeacon",
                "dfls",
                "lena",
                "nbtscan",
                "pivy",
                "poisonivy",
                "pwdump"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536131,
    "ts_updated_at": 1743041369,
    "ts_creation_date": 1653693618,
    "ts_modification_date": 1653693618,
    "files": {
        "pdf": "https://archive.orkl.eu/913adb962ef79fa0550e8abe517be13560238888.pdf",
        "text": "https://archive.orkl.eu/913adb962ef79fa0550e8abe517be13560238888.txt",
        "img": "https://archive.orkl.eu/913adb962ef79fa0550e8abe517be13560238888.jpg"
    }
}