{
    "id": "15220e67-01d2-4c37-affe-044194b7be78",
    "created_at": "2023-01-12T15:01:02.07282Z",
    "updated_at": "2025-03-27T02:16:26.455364Z",
    "deleted_at": null,
    "sha1_hash": "ccd4b0c57c48d13332c565e6b6093e08d5aa20a3",
    "title": "2018-11-07 - BCMPUPnP_Hunter- A 100k Botnet Turns Home Routers to Email Spammers",
    "authors": "",
    "file_creation_date": "2022-05-29T01:20:36Z",
    "file_modification_date": "2022-05-29T01:20:36Z",
    "file_size": 521430,
    "plain_text": "# BCMPUPnP_Hunter: A 100k Botnet Turns Home Routers to Email Spammers\n\n**[blog.netlab.360.com/bcmpupnp_hunter-a-100k-botnet-turns-home-routers-to-email-spammers-en/](https://blog.netlab.360.com/bcmpupnp_hunter-a-100k-botnet-turns-home-routers-to-email-spammers-en/)**\n\nHui Wang November 7, 2018\n\n7 November 2018 / [Botnet](https://blog.netlab.360.com/tag/botnet/)\n[This article was co-authored by Hui Wang and](https://twitter.com/huiwangeth) _[RootKiter.](https://twitter.com/RooKiter)_\n\n[Since September 2018, 360Netlab Scanmon has detected multiple scan spikes on TCP port](https://scan.netlab.360.com/#/dashboard?dstport=5431)\n5431, each time the system logged more than 100k scan sources, a pretty large number\ncompared with most other botnets we have covered before.\n\nThe interaction between the botnet and the potential target takes multiple steps, it starts with\n```\ntcp port 5431 destination scan, then moving on to check targetâ€™s UDP port 1900 and\n\n```\nwait for the target to send the proper vulnerable URL. After getting the proper URL, it takes\nanother 4 packet exchanges for the attacker to figure out where the shellcode's execution\nstart address in memory is so a right exploit payload can be crafted and fed to the target.\n\nAt the beginning we were not able to capture a valid sample as the honeypot needs to be\nable to simulate the above scenarios. We had to tweak and customize our honeypot quite a\nfew times, then finally in Oct, we got it right and successfully tricked the botnet to send us the\nsample (we call it BCMUPnP_Hunter).\n\nThe botnet has the following characteristics:\n\nThe amount of infection is very large, the number of active scanning IP in each scan\nevent is about 100,000;\nThe target of infection is mainly router equipment with BroadCom UPnP feature\nenabled.\nSelf-built proxy network (tcp-proxy), the proxy network is implemented by the attacker,\nthe proxy currently communicates with well-known mail servers such as Outlook,\nHotmail, Yahoo! Mail, etc. We highly suspect that the attacker's intention is to send\nspams.\n\n## Scale Assessment\n\n\n-----\n\nThe trend of scanning source IP for `TCP port 5431 in the last 30 days is as follows:`\n\nIt can be seen that the scan activity picks up every 1-3 days. The number of active\nscanning IP in each single event is about 100,000\nAll together we have 3.37 million unique scan source IPs. It is a big number, but it is\nlikely that the IPs of the same infected devices just changed over time.\n[The number of potential infections may reach 400,000 according to Shodan based on](https://www.shodan.io/search?query=Server%3A%20Custom%2F1.0%20UPnP%2F1.0%20Proc%2FVer)\nthe search of banner: `Server: Custom/1.0 UPnP/1.0 Proc/Ver`\n\n\n-----\n\nGeographical distribution for the scanner IPs in the last 7 days (click to enlarge, deeper\nmeans more infected devices).\n\n## Infected Device Information\n\nWe probed the scanners, and 116 different type of infected device information is obtained,\nthe actual infected device type should be more than what displays below:\n\n\n-----\n\n```\nADB Broadband S.p.A, HomeStation ADSL Router\nADB Broadband, ADB ADSL Router\nADBB, ADB ADSL Router\nALSiTEC, Broadcom ADSL Router\nASB, ADSL Router\nASB, ChinaNet EPON Router\nASB, ChinaTelecom E8C(EPON) Gateway\nActiontec, Actiontec GT784WN\nActiontec, Verizon ADSL Router\nBEC Technologies Inc., Broadcom ADSL Router\nBest IT World India Pvt. Ltd., 150M Wireless-N ADSL2+ Router\nBest IT World India Pvt. Ltd., iB-WRA300N\nBillion Electric Co., Ltd., ADSL2+ Firewall Router\nBillion Electric Co., Ltd., BiPAC 7800NXL\nBillion, BiPAC 7700N\nBillion, BiPAC 7700N R2\nBinatone Telecommunication, Broadcom LAN Router\nBroadcom, ADSL Router\nBroadcom, ADSL2+ 11n WiFi CPE\nBroadcom, Broadcom Router\nBroadcom, Broadcom ADSL Router\nBroadcom, D-Link DSL-2640B\nBroadcom, D-link ADSL Router\nBroadcom, DLink ADSL Router\nClearAccess, Broadcom ADSL Router\nComtrend, AR-5383n\nComtrend, Broadcom ADSL Router\nComtrend, Comtrend single-chip ADSL router\nD-Link Corporation., D-Link DSL-2640B\nD-Link Corporation., D-Link DSL-2641B\nD-Link Corporation., D-Link DSL-2740B\nD-Link Corporation., D-Link DSL-2750B\nD-Link Corporation., D-LinkDSL-2640B\nD-Link Corporation., D-LinkDSL-2641B\nD-Link Corporation., D-LinkDSL-2741B\nD-Link Corporation., DSL-2640B\nD-Link, ADSL 4*FE 11n Router\nD-Link, D-Link ADSL Router\nD-Link, D-Link DSL-2640U\nD-Link, D-Link DSL-2730B\nD-Link, D-Link DSL-2730U\nD-Link, D-Link DSL-2750B\nD-Link, D-Link DSL-2750U\nD-Link, D-Link DSL-6751\nD-Link, D-Link DSL2750U\nD-Link, D-Link Router\nD-Link, D-link ADSL Router\nD-Link, DVA-G3672B-LTT Networks ADSL Router\nDARE, Dare router\nDLink, D-Link DSL-2730B\nDLink, D-Link VDSL Router\nDLink, DLink ADSL Router\nDQ Technology, Inc., ADSL2+ 11n WiFi CPE\nDQ Technology, Inc., Broadcom ADSL Router\nDSL, ADSL Router\n\n```\n\n-----\n\n```\nDareGlobal, D Link ADSL Router\nDigicom S.p.A., ADSL Wireless Modem/Router\nDigicom S.p.A., RAW300C-T03\nDlink, D-Link DSL-225\nEltex, Broadcom ADSL Router\nFiberHome, Broadcom ADSL Router\nGWD, ChinaTelecom E8C(EPON) Gateway\nGenew, Broadcom ADSL Router\nINTEX, W150D\nINTEX, W300D\nINTEX, Wireless N 150 ADSL2+ Modem Router\nINTEX, Wireless N 300 ADSL2+ Modem Router\nITI Ltd., ITI Ltd.ADSL2Plus Modem/Router\nInteno, Broadcom ADSL Router\nIntercross, Broadcom ADSL Router\nIskraTEL, Broadcom ADSL Router\nKasda, Broadcom ADSL Router\nLink-One, Modem Roteador Wireless N ADSL2+ 150 Mbps\nLinksys, Cisco X1000\nLinksys, Cisco X3500\nNB, DSL-2740B\nNetComm Wireless Limited, NetComm ADSL2+ Wireless Router\nNetComm, NetComm ADSL2+ Wireless Router\nNetComm, NetComm WiFi Data and VoIP Gateway\nOPTICOM, DSLink 279\nOpticom, DSLink 485\nOrcon, Genius\nQTECH, QTECH\nRaisecom, Broadcom ADSL Router\nRamptel, 300Mbps ADSL Wireless-N Router\nRouter, ADSL2+ Router\nSCTY, TYKH PON Router\nStar-Net, Broadcom ADSL Router\nStarbridge Networks, Broadcom ADSL Router\nTP-LINK Technologies Co., Ltd, 300Mbps Wireless N ADSL2+ Modem Router\nTP-LINK Technologies Co., Ltd, 300Mbps Wireless N USB ADSL2+ Modem Router\nTP-LINK, TP-LINK Wireless ADSL2+ Modem Router\nTP-LINK, TP-LINK Wireless ADSL2+ Router\nTechnicolor, CenturyLink TR-064 v4.0\nTenda, Tenda ADSL2+ WIFI MODEM\nTenda, Tenda ADSL2+ WIFI Router\nTenda, Tenda Gateway\nTenda/Imex, ADSL2+ WIFI-MODEM WITH 3G/4G USB PORT\nTenda/Imex, ADSL2+ WIFI-MODEM WITH EVO SUPPORT\nUTStarcom Inc., UTStarcom ADSL2+ Modem Router\nUTStarcom Inc., UTStarcom ADSL2+ Modem/Wireless Router\nUniqueNet Solutions, WLAN N300 ADSL2+ Modem Router\nZTE, Broadcom ADSL Router\nZTE, ONU Router\nZYXEL, ZyXEL VDSL Router\nZhone, Broadcom ADSL Router\nZhone, Zhone Wireless Gateway\nZoom, Zoom Adsl Modem/Router\nZyXEL, CenturyLink UPnP v1.0\nZyXEL, P-660HN-51\n\n```\n\n-----\n\n```\nZyXEL, ZyXEL xDSL Router\nhuaqin, HGU210 v3 Router\niBall Baton, iBall Baton 150M Wireless-N ADSL2+ Router\niiNet Limited, BudiiLite\niiNet, BoB2\niiNet, BoBLite\n\n## Botnet Workflow\n\n```\nAs mentioned in the beginning, the bot has to go through multiple steps to infect a\nprotentional target, see the following diagram for the workflow, note the Loader is (\n```\n109.248.9.17:4369 )\n\n```\nFigure 1: BCMUPnP_Hunter Infection process (Click to enlarge)\n\n## The Sample\n\nThe sample of the botnet consists of two parts, the shellcode and the Main sample, which\nare described below.\n\n## shellcode\n\n\n-----\n\nThe main function of shellcode is to download the main sample from\nC2( 109.248.9.17:8738 ) and execute it.\n\nThe shellcode has a full length of 432 bytes, very neatly organized and written, some proofs\nbelow (We did not find similar code using search engines). It seems that the author has\nprofound skills and is not a typical script kid:\n\nCode basic: The code has multiple syscall calls for networks, processes, files, etc.\nSome details: `syscall 0x40404 (instead of` `syscall 0 ) and multiple inversion`\noperations were used so bad characters ( \\x00 ) could be avoided; the stack variables\nin the code also have different degrees of multiplexing to optimize the runtime stack\nstructure;\nCode logic: by calling the Loop at various section, the possibility of many failed calls is\nreasonably avoided, and the validity of shellcode execution is guaranteed.\n\nThe complete flow chart is as follows:\n\n\n-----\n\nFigure 2: Shellcode calling graph(Click to enlarge)\n\n## Main Sample\n\nThe main sample includes BroadCom UPnP vulnerability probe and a proxy access network\nmodule, it can parse four instruction codes from C2:\n```\nCommand Code |  Length  | Function\n0x00000000     0x18    The first packet, no practical function\n0x01010101     0x4c    Search for potential vulnerable target\n0x02020202     0x08    Empty current task \n0x03030303     0x108   Access Proxy Network\n\n```\n\n-----\n\n```\n   0x01010101 to enable the port scan task, once the BOT IDs a potential target, the\n\n```\ntarget IP will be reported to the Loader, and then the Loader will complete the\nsubsequent infection process.\n```\n   0x03030303 is for the proxy service, BOT accesses the address provided in the\n\n```\ninstruction and reports the access result to the C2. This can generate real economic\nbenefits. Attackers can use this command to build a proxy network, and then profit from\ndoing things such as sending spam, simulating clicks, and so on.\n\n## Proxy Network and Spam\n\nIn the instructions we have obtained, BCMUPnP_Hunter is used to proxy traffic to the\nfollowing servers:\n```\n104.47.0.33:25\n104.47.12.33:25\n104.47.124.33:25\n104.47.14.33:25\n104.47.33.33:25\n104.47.48.33:25\n104.47.50.33:25\n106.10.248.84:25\n144.160.159.21:25\n188.125.73.87:25\n67.195.229.59:25\n74.6.137.63:25\n74.6.137.64:25\n98.137.159.28:25\n\n```\nThis table shows what we have dug out from our various data sources for the above IPs:\n\nAs can be seen:\n\n\n-----\n\nThese servers are all well-known mail service providers, including Outlook, Hotmail,\nYahoo! Mail;\nFor several months, these servers have provided and only provided TCP25 services;\nIn this case, it appears that the attacker is abusing the email service of these servers;\n\nThis makes us highly skeptical that the attacker is using the proxy network established by\nBCMUPnP_Hunter to send spam.\n\n## Contact Us\n\nRelevant security oragnizations are welcomed to contact netlab[at]360.cn for a full list of\ninfected IP addresses.\n\n[Readers are always welcomed to reach us on twitter, WeChat 360Netlab or email to](https://twitter.com/360Netlab)\nnetlab[at]360.cn.\n\n## Appendix: About the BroadCom UPnP Vulnerability\n\n[UPnP is the acronym for Universal Plug and play, the Universal plug-in protocol. [1] The goal](https://en.wikipedia.org/wiki/Universal_Plug_and_Play)\nof the agreement is to enable home networks (data sharing, communication and\nentertainment) and various devices in the corporate network to seamlessly connect with\neach other and simplify the implementation of related networks. Broadcom UPnP is a\nconcrete implementation of Broadcom's response to the UPnP protocol.\n\nAs Broadcom is in the industry upstream of the supply chain, the implementation is adopted\nby major router manufacturers, including Asus, D-link,zyxel,us Robotics,t p-link,netgear and\nso on.\n\nIn October 2013, security researchers at security research firm DefenseCode discovered the\n[BroadCom UPnP format string vulnerability in the protocol stack . Considering that the](http://defensecode.com/whitepapers/From_Zero_To_ZeroDay_Network_Devices_Exploitation.txt)\nvulnerability affects products from several major router vendors, DefenseCode did not\n[disclose their findings until 2017. The code disclosed this time is of a verification nature[2] An](https://www.defensecode.com/public/DefenseCode_Broadcom_Security_Advisory.pdf)\nattacker must complete the necessary vulnerability analysis and optimize the shellcode\nprocess on the basis of a publicly available document before it can be of practical power.\n\n## IoC\n\nC2\n```\n109.248.9.17 \"Bulgaria/BG\" \"AS58222 Solar Invest UK LTD\" #C2&&Loader\n\n```\nSample MD5\n```\n9036120904827550bf4436a919d3e503\n\n```\nShellcode(Base64 encode):\n\n\n-----\n\n```\nAtYgJSQCD6YBAQEMArUgJSQCD6YBAQEMJ6T/yq+k/+CvoP/kJ6X/4CgG//8kAg+rAQEBDCgE//8kAg+hAQEBDA\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-11-07 - BCMPUPnP_Hunter- A 100k Botnet Turns Home Routers to Email Spammers.pdf"
    ],
    "report_names": [
        "2018-11-07 - BCMPUPnP_Hunter- A 100k Botnet Turns Home Routers to Email Spammers.pdf"
    ],
    "threat_actors": [
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535662,
    "ts_updated_at": 1743041786,
    "ts_creation_date": 1653787236,
    "ts_modification_date": 1653787236,
    "files": {
        "pdf": "https://archive.orkl.eu/ccd4b0c57c48d13332c565e6b6093e08d5aa20a3.pdf",
        "text": "https://archive.orkl.eu/ccd4b0c57c48d13332c565e6b6093e08d5aa20a3.txt",
        "img": "https://archive.orkl.eu/ccd4b0c57c48d13332c565e6b6093e08d5aa20a3.jpg"
    }
}