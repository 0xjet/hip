{
    "id": "860bc398-fb0d-4b25-9f07-951867c56fcd",
    "created_at": "2023-01-12T15:09:08.929439Z",
    "updated_at": "2025-03-27T02:16:25.491684Z",
    "deleted_at": null,
    "sha1_hash": "1e5c5f96a536b0c5bc11d14ea0fa050c38b65ee8",
    "title": "2020-11-09 - An Old Joker’s New Tricks- Using Github To Hide Its Payload",
    "authors": "",
    "file_creation_date": "2022-05-27T23:23:34Z",
    "file_modification_date": "2022-05-27T23:23:34Z",
    "file_size": 1819219,
    "plain_text": "# An Old Joker’s New Tricks: Using Github To Hide Its Payload\n\n**[trendmicro.com/en_us/research/20/k/an-old-jokers-new-tricks--using-github-to-hide-its-payload.html](https://www.trendmicro.com/en_us/research/20/k/an-old-jokers-new-tricks--using-github-to-hide-its-payload.html)**\n\nMobile\n\n\nNovember 9, 2020\n\n\nWe recently detected a new version of the persistent mobile malware Joker on a sample on Google Play. This updated version\nutilizes Github pages and repositories in an attempt to evade detection.\n\nBy: Zhengyu Dong November 09, 2020 Read time: ( words)\n\nThe Joker malware has consistently plagued mobile users since its discovery in 2017. In January 2020, Google removed 1700\ninfected applications from the Play Store — a list that grew over three years. More recently, in September, security company Zscaler\n[found 17 samples that were uploaded to the Google Play Store. Joker has been responsible for a range of malicious activity, from](https://www.zscaler.com/blogs/research/joker-playing-hide-and-seek-google-play)\nsigning unknowing users to premium services and compromising SMS messaging to stealing contacts.\n\nThe malware has become a well-known persistent threat because the authors continually make small changes to seek gaps in\nGoogle's defenses. Previous techniques they have tried include encryption, to hide strings from analysis engines; and “versioning,”\nwhich involves uploading a clean version of the app then adding malicious code via updates. We recently detected a new Joker\nmalware version on a sample on Google Play, which utilizes Github pages and repositories in an attempt to evade detection. The\n[sample was also found and analyzed by security researcher Tatyana Shishkova.](https://twitter.com/sh1shk0va/status/1320860655956697090)\n\nThe app that we analyzed promised wallpapers in HD and 4K quality and was downloaded over a thousand times. It was removed\nfrom the Play Store by Google after it was reported as malicious.\n\n\n-----\n\nFigure 1. A wallpaper app that pushes Joker malware — the URL linking to the app\n\nis already inactive\nPayload Landing\n\nThe most notable difference between this new sample and previous versions is the use of Github and Github Pages to store its\nmalicious payload. This technique has not been seen in any of the earlier Joker malware samples. Fortunately, the Github pages and\nrepositories connected to the malware have all been taken down.\n\nHere are the details of its new storage strategy and other recent developments:\n\n1. It injects malicious code into a new location, not the application class or launcher activity, as seen previously.\n\n2. In the past, Joker usually downloads its payload using injected code. This version first gets a json configuration string from the\nremote server, then decrypts the fields to get the next-stage command and control server (C&C) and the next payload’s entry point\nfunction.\n\n\n-----\n\nThe configuration file is different across various Joker samples. The sample we investigated had the following encrypt fields in json.\n\n3. The malware uses Github Pages to facilitate malicious activity while avoiding URL detection. The C&C used to get the\nconfiguration string is hxxps://surasuke7.github.io/retrofit/static/vega-schema.json. The Github user uses the name surasuke7, and he\nhides the configuration in the repository retrofit. The path is static/vega-schema.json.\n\n4. Github is also used to house the payloads. The first payload C&C is hxxps://cdn.jsdelivr.net/gh/surasuke7/vega@ghpages/releases/v1.5.4/ppk-62.zip (unlike previous versions, the payload landing page is not Aliyun or Amazon). To give more context\nto the URL: jsdelivr is a fast content delivery network (CDN) to help accelerate the access of GitHub, and the URL has a specific\nformat (hxxps://cdn.jsdelivr.net/gh/user/repo@version/file).\n\nThe C&C URL shows that the payload is in surasuke7 user’s Vega repository, in the gh-pages branch, and the file path is\nreleases/v1.5.4/ssp-62.raw. The git commit history shows that this attack flow was already used in early October.\n\n\n-----\n\n5. The payload behaves similar to previous samples. The first payload will check the SIM ISO code before downloading the next\npayload.\n\nInfection Process\n\nOnce the second payload loads into memory, the infection process will run silently without any apparent behavior on the active\ndevice. The following describes and illustrates the process:\n\n1. The malicious payload will call the loadNewJob function to get a new job from the C&C, and the C&C will decide the payload’s\nactions. The following image shows that Joker uses the deviceID in the shared preference file to note if the device is already infected.\n\na. register\n\nThis function is used to register the victim's device to the C&C server, and the server will issue the first job to the device.\n\nb. getJob\n\nThe malicious payload uses this function to request a new job.\n\n\n-----\n\nEither of these would return a Job object, according to its Job class. The json structure should be as follows:\n\nFinally, it runs the job and sends a message to the main handler to launch another malicious module, which would hijack WebView.\n\n2. Joker hijacks WebView via call setWebViewClient to set a customized webViewClient object.\n\n\n-----\n\nAs shown in the screenshot, it mainly overrides onPageFinished, shouldInterceptRequest, and shouldOverrideUrlLoading.\n\nThe intercept could be done in two ways: relay and hack. Each of them would check whether the URL could relay or hack according\nto the C&C response (corresponding to the relays array and the thks array, respectively).\n\nHere are some functions the malware uses to complete its compromise of the victims:\n\na. loadUrl\n\nIf a URL is about to load into the WebView and the check_hack response is True, the malware will send a message to the private\nhandler. This message will call for requestPage function. This function mainly tries to subscribe the user to premium services (see\nnumber 3).\n\nb. intercept\n\nAs mentioned earlier, the malware tries to intercept the request via relay and hack.\n\n**Relay**\n\n\n-----\n\nThis would check whether the final URL can relay. If it can, the malware runs the relay function to redirect users to another URL\nspecified by the C&C.\n\n**Hack**\n\nThis would replace some items in the response body. If the URL cannot relay, at the end of the intercept function, it will try to hack the\nURL using these steps:\n\n- First, the request must be GET, and the current URL should be found in the thks array response from the C&C\n\n- Then, it performs the request and gets an original response\n\n- Finally, it calls the distortContent function to distort the items\n\nc. onPageFinished\n\nThis function will try to run the JS code sent by the C&C (see number 4).\n\n3. The malware also attempts to subscribe compromised victims to premium services.\n\nWhile loading a URL, the malware checks if the SIM operator is AIS (a mobile operator based in Thailand) and if the URL is\nhxxp://ss1.mobilelife.co.th/wis/wap. If both parameters are met, then it will silently subscribe the compromised user to a premium\nservice.\n\nIt uses the following steps:\n\na. Request a confirm code from the operator\n\nb. Read the confirm code from notification or SMS\n\nc. Send a confirm request to the operator with the confirm code\n\nIt performs all the steps described without the user’s knowledge.\n\n4. The malware has the ability to run JS code.\n\n\n-----\n\nSimilar to the way it overrides the shouldInterceptRequest function, it also overrides onPageFinished to trigger a JS code if one page\nhas finished loading.\n\nIt gets an Action object from the C&C response and checks whether these actions could run on the current page. After it gets the\nAction object, it will send a message to the main handler, which would then run the JS code.\n\nHere is the runJs function:\n\nThis would call evaluateJavascript to run the JS code.\n\n\n-----\n\nBecause it implements a JS bridge with JavascriptInterface, it has the ability to run JS code. The commands are passed from the\nC&C. Some of the possible commands:\n\n- addComment - Add comment to current web page\n\n- finish - Finish the web page\n\n- sleep - Make the thread sleep for a specific number of seconds\n\n- getPin - Read the PIN code from a notification\n\n- get – Send a GET request\n\n- submitForm - Submit form data via post request to C&C\n\n- callPhone – Currently unsupported\n\n\n-----\n\nsendSms Send SMS message\n\n- post – Send a POST request\n\nFurther investigation found two other samples associated with surasuke7.github.io, but neither of them is on Google Play.\n\nUsers may be unaware of any compromise at first glance because the Joker malware sample is contained in a functioning app. The\napp promises wallpapers and delivers on that promise — the malware is an unfortunate add-on. This is something we have seen from\nthe Joker malware before — it is repacked into apps, and sometimes (if the app is without SMS permissions), it needs to gain some\npermissions to function. It needs android.permission.BIND_NOTIFICATION_LISTENER_SERVICE to steal pin codes from\nnotifications; and android.permission.READ_PHONE_STATE to get the SIM mobile country code.\n\nJoker is known to only run on devices with a SIM card (and only for specific SIM country codes). This particular sample seems to be\ntargeting users of a mobile operator in Thailand.\n\nThis sample contains other long-running elements of the Joker malware: it uses JS code to run C&C commands, and it subscribes\nusers to a WAP service without their knowledge. But it also shows that, as it has been since 2017, Joker is still evolving. In this\nvariation, the actors seem to be seeking a new and effective method to hide the malware’s payload. Github is a known public\nrepository, and the threat actors probably assume that using it will help them bypass detection. Another notable change is that the\nmalware now hides everything valuable, such as the fraud URL, on C&C servers.\n\nIndicators of Compromise\n\n**SHA 256** **Detection name** **File name**\n\n33f7593f09f078ad5f6568421f4e9189186e0148490cf47501e1f6c136ca9499 AndroidOS_Joker.A com.qmobi.cool.Avatar.Creator\n\nec0826991bed299fe65d889282bd15182b8899774f9913156e8c2d970389e8e3 AndroidOS_Joker.A net.moji.supermarket\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-11-09 - An Old Joker’s New Tricks- Using Github To Hide Its Payload.pdf"
    ],
    "report_names": [
        "2020-11-09 - An Old Joker’s New Tricks- Using Github To Hide Its Payload.pdf"
    ],
    "threat_actors": [
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673536148,
    "ts_updated_at": 1743041785,
    "ts_creation_date": 1653693814,
    "ts_modification_date": 1653693814,
    "files": {
        "pdf": "https://archive.orkl.eu/1e5c5f96a536b0c5bc11d14ea0fa050c38b65ee8.pdf",
        "text": "https://archive.orkl.eu/1e5c5f96a536b0c5bc11d14ea0fa050c38b65ee8.txt",
        "img": "https://archive.orkl.eu/1e5c5f96a536b0c5bc11d14ea0fa050c38b65ee8.jpg"
    }
}