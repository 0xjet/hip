{
    "id": "c30ba58e-3ba9-41f3-ae0c-9290a4f2f34c",
    "created_at": "2023-01-12T15:00:46.486661Z",
    "updated_at": "2025-03-27T02:16:57.911145Z",
    "deleted_at": null,
    "sha1_hash": "082564846d0a6e739967fbc6e35a11d6cc8311e8",
    "title": "2019-11-05 - Brief analysis of Redaman Banking Malware (v0.6.0.2) Sample",
    "authors": "",
    "file_creation_date": "2022-05-28T17:43:34Z",
    "file_modification_date": "2022-05-28T17:43:34Z",
    "file_size": 468501,
    "plain_text": "# Brief analysis of Redaman Banking Malware (v0.6.0.2) Sample\n\n**[peppermalware.com/2019/11/brief-analysis-of-redaman-banking.html](http://www.peppermalware.com/2019/11/brief-analysis-of-redaman-banking.html)**\n\nRedaman is a well-known banking malware, discovered around 2015. Recently I have been\nanalyzing a recent version of the malware (0.6.0.2, not sure if latest version, probably one of\nthe newest). This malware uses some interesting tricks probably introduced in these recent\nversions. In this post I share some notes about the analysis.\n\n**Original Packed Sample:** [2b251483ed7705c60ee12b561280a1fc](https://www.hybrid-analysis.com/sample/b1b2d242c4d43e15ba66c7ae9c8bb317c7d8dcacacb5005f368c554ec844b035)\n**Unpacked Sample (dll):** [2a298a650b50eb89041548e57d72f726](https://app.any.run/tasks/67a9a525-267b-45b1-9642-5032d5b428aa)\n**Virustotal First Submission: 2019-10-11 10:35:13**\n**Related links:**\n\n## Analysis\n\n1. Anti-analysis tricks\n\n1.1. C2 encoded into bitcoin transactions\n1.2. Checks machine name vs user name\n1.3. Encrypted strings\n1.4. Unpacked module needs correct argument to work properly\n1.5. Checks for typical sandboxes files, directories, processes...\n\n\n-----\n\n1.6. Checks for security products\n1.7. Disable Safeboot\n2. Bot commands and malware capabilities\n3. Yara rules\n4. List of encrypted strings\n\n### 1. Anti-analysis tricks\n\n**1.1. C2 encoded into bitcoin transactions**\n\n[This trick, discovered by checkpoint and explained in this post, is really interesting. The](https://research.checkpoint.com/2019/ponys-cc-servers-hidden-inside-the-bitcoin-blockchain/)\nmalware gets the C2 addresses from the bitcoin blockchain. The malware doesn't carry C2\naddresses into the binary. It carries (in the list of encrypted strings) some urls of some\nservices offering APIs related to bitcoin blockchain:\n\n\"viabtc.com\"\n\n\"/res/btc/transactions/addressv2?address=\"\n\"api.blockcypher.com\"\n\n\"/v1/btc/main/addrs/\"\n\"?limit=10\"\n\"blockchain.info\"\n\n\"/rawaddr/\"\n\"blockchain.coinmarketcap.com\"\n\n\"/api/address?address=\"\n\"&symbol=BTC&start=1&limit=10\"\n\nAdditionally, it carries another encrypted string with the C2 schema, a bitcoin address and\nthe C2 uri:\n\n\"http://1N9ALZUgqYzFQGDXvMY5j1c7PGMMGYqUde/index.php\"\n\nThen, the malware composes the blockchain API url, and queries the transactions for the\ngiven bitcoin address, for example:\n\nhttps://api.blockcypher.com/v1/btc/main/addrs/1N9ALZUgqYzFQGDXvMY5j1c7PGMMGYqU\nde?limit=10\n\n[(Find a copy of the json response here: https://pastebin.com/rC9pF2F2)](https://pastebin.com/rC9pF2F2)\n\nThe malware uses some fields of this json response (exactly the values of the transactions)\nto compose the C2 addresses, as explained in the following image (click on the image to\n\n\n-----\n\nexpand):\n\nThe threat actor only needs to perform some new transaction with the given bitcoin address\nto update the C2 list.\n\nThis is quite interesting. A malware could be keeping all kind of information and configs in\nthe blockchain. It could use these APIs such as api.blockcypher.com, etc... or it could\ndownload the blockchain to get all the transactions directly from the blockchain and recover\nall the needed information.\n\nA domain can be sinkholed, but, using this method, it would be hard to forbid the malware to\nget updates.\n\n**1.2. Checks machine name vs user name**\n\nThis is another trick, quite aggresive, that I hadn't seen before. Basically, the malware gets\ntthe computer name and the user name. It removes the \"-PC\" suffix from the computer name,\nthe in compares the computer name (without -PC) with the username (uppercase). If they\nare the same, exit.\n\n\n-----\n\nFrequently, real usual users' machines have computer names like DESKTOP-JMP24OS,\netc... I suppose with this aggresive trick the malware tries to avoid being executed in\nsandboxes, AV emulators, etc...\n\n**1.3. Encrypted strings**\n\n[As explained at welivesecurity' article, the malware decrypts the strings that it is going to use](https://www.welivesecurity.com/wp-content/uploads/2017/02/Read-The-Manual.pdf)\nby using a custom rc4 algorithm.\n\nHere, Im just going to explain how I got the decrypted urls directly from memory and Im\ngoing to share the script that I used to add IDA comments automatically. I used the following\nWindbg commands to dump all the decrypted strings and their positions in the strings' table:\n\nbp <base_unpacked_mod> + 291F5 (at this point, strings were decrypted a moment\nago)\n\nPrint decrypted ascii strings:\n\n.for ($t0=0;@$t0<0x18b;r $t0=@$t0+1){ .printf \"%d \",4*@$t0; da poi\n(<base_unpacked_mod>+2C93C+4*@$t0); .printf \"\\r\\n\"; }\n\nPrint decrypted unicode strings:\n\n.for ($t0=0;@$t0<0xb6;r $t0=@$t0+1){ .printf \"%d \",4*@$t0; du poi\n(<base unpacked mod>+2CF68+4*@$t0); .printf \"\\r\\n\"; }\n\n\n-----\n\nWith these commands, i got the list of strings (ascii and unicode), and I used the following\nIDA python script to set comments foreach part of the code where these strings are being\nused:\n\n**1.4. Unpacked module needs correct argument to work properly**\n\nOnce the malware is unpacked, the real redaman dll is launched with rundll32 and\nDllGetClassObject method is called, and an argument is given:\n\nrundll32 <redaman dll path>, DllGetClassObject <password>\n\nThe given password needs to be correct, if it is not correct, the encrypted strings cant be\ndecrypted and the malware exits.\n\n**1.5. Checks for typical sandboxes files, directories, processes...**\n\nIt checks for the following files or directories at c:\\ or d:\\ : cuckoo, fake_drive, strawberry, tsl,\ntargets.xls, perl, wget.exe\n\n\n-----\n\nIt checks for the following names in the own module name: myapp.exe, self.exe, t.exe\n\n\n-----\n\nAnd for the following processes: vboxservice.exe, python.exe\n\n\n-----\n\n**1.6. Checks for security products**\n\nRedaman uses the WbemScripting.SWbemLocator API to search for intalled security\nproducts:\n\n**1.7. Disable Safeboot**\n\n\n-----\n\nThe malware deletes the current safeboot value:\n\n### 2. Bot commands and malware capabilities\n\nI recommend to read the [welivesecurity' article to learn about the protocol and encryption](https://www.welivesecurity.com/wp-content/uploads/2017/02/Read-The-Manual.pdf)\nused by Redaman banking malware.\n\nIt looks in the newer versions of the malware they have introduced a much longer list of\ncommands that the bot can receive from the C2 and execute. This is the complete list (each\ncommand and name is quite self-explanatory):\n\nkeylogger.last-data\nkeylogger.last-wnd-caption\nkeylogger.last-exe-path\nbotnet-prefix\nbotnet-id\ncc.connect-interval\nscan-files\npost-install-report\ncc.url\nmodules.\nmodules-data.\ndel-module\nunload\nuninstall\nuninstall-lock\nfind-files\ndownload\nshutdown\nreboot\ncc\nget-cc\nbotnet-id\n\n\n-----\n\nprefix\nconnect-interval\nhosts-add\nhosts-clear\ndbo-scan\ncfg-set-str-a\ncfg-set-str-w\ncfg-set-dw\ncfg-get-str-a\ncfg-get-str-w\ncfg-get-dw\ncfg-del-param\nscreenshot\ndns\nset-dns\nget-dns\nkill-process\nlpe-runas-flags\nscards.monitoring-interval\nauto-elevate\nreload\nscard-off\nmodules-off\ndbo-detector-off\nmultiinstance-off\nkeylogger-off\ndns-servers-changed\nhosts-file-changed\nvideo.refresh-interval\nvideo-start\nvideo-stop\ndel-files\n\nAdditionally, in the list of encrypted strings, the malware carries a list of strings to match\nagainst the browser window name. In case of match, it is a target site (most of them bank\nwebsites) to steal credentials from. This is the list of urls of the analyzed sample:\n\nonline.payment.ru\nbankline.ru\n/ic/login.zhtml\n/servlets/ibc\n\n\n-----\n\nfaktura.ru\n/iclient/\nibank2\nbco.vtb24.\nbo.vtb24.\ndbo.vtb.\nelbrus.raiffeisen\nelba.raiffeisen\nhandybank.\nwupos.westernunion\nonline.sberbank.\nminbank.ru\ne-plat.mdmbank.\nlink.alfabank\nclick.alfabank\nib.avangard\nibc.vuzbank.\nibc.ubrr.\nmy.modulbank.\nonline.centrinvest.\ncb.mtsbank.\nvbo.mkb.\ni.bspb.ru\ni.vtb.ru\nbc.rshb.\n/vpnkeylocal\nsci.interkassa\nibank.mmbank.\nblockchain.info\n/wallet/\ncb.asb.by\nbps-sberbank.by\ndbo2.bveb.by\nibank.bsb.by\ncorporate.bgpb.by\nibank.alfa-bank.by\nibank.belinvestbank.by\nib2.ideabank.by\nclient.paritetbank.by\nibank.priorbank.by\nclient.mybank.by\nonline.stbank.by\n\n\n-----\n\nclient.belapb.by\nUnk\nSberBank_PC\nBSS\nBSS_PC\niBank2_PC\nFaktura\nPCB\nInterPro\nRosBank\nSBBO\nINIST\nInversion\nInterbank\niBank2\nBiCrypt\nVTB24\n1C\nSGB\nRaiffeisen\nHandyBank\nWU\nSB_Fiz\nCFT\nWinPost\nSBIS\nClBank\nQiwiCashier\nISCC\nWebMoney\nxTC\niFOBS\nTRANSAQ\nOSMP\nMinBank\nSFT\nMDM\nALBO\nAlfa_Fiz\nAvangard\nIntercassa\nAmikon\n\n\n-----\n\nVuzbank\nUBRR\nModulBank\nCentrInvest\nMTSBank\nMKB\nEL_CLI\nBSPB\nIVTB\nRSHB\nInfocrypt\nMMBank\nBlockchainInfo\nHBClient\nASB\nBPS_SB\nBVEB\nBSB\nBGPB\nALBO_BY\nBelInvest\nIdeaBank\nParitet\nPriorBank\nMyBank\nStBank\nBelAPB\nscDBO\nAvestCSP\n\n### 3. Yara rules\n\n 4. List of encrypted strings\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-11-05 - Brief analysis of Redaman Banking Malware (v0.6.0.2) Sample.pdf"
    ],
    "report_names": [
        "2019-11-05 - Brief analysis of Redaman Banking Malware (v0.6.0.2) Sample.pdf"
    ],
    "threat_actors": [
        {
            "id": "bfded1cf-be73-44f9-a391-0751c9996f9a",
            "created_at": "2022-10-25T15:50:23.337107Z",
            "updated_at": "2025-03-27T02:00:55.445946Z",
            "deleted_at": null,
            "main_name": "FIN7",
            "aliases": [
                "FIN7",
                "GOLD NIAGARA",
                "ITG14",
                "Carbon Spider",
                "ELBRUS",
                "Sangria Tempest"
            ],
            "source_name": "MITRE:FIN7",
            "tools": [
                "Mimikatz",
                "AdFind",
                "JSS Loader",
                "HALFBAKED",
                "REvil",
                "PowerSploit",
                "CrackMapExec",
                "Carbanak",
                "Pillowmint",
                "Cobalt Strike",
                "POWERSOURCE",
                "RDFSNIFFER",
                "SQLRat",
                "Lizar",
                "TEXTMATE",
                "BOOSTWRITE"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "bb8702c5-52ac-4359-8409-998a7cc3eeaf",
            "created_at": "2023-01-06T13:46:38.405479Z",
            "updated_at": "2025-03-27T02:00:02.82533Z",
            "deleted_at": null,
            "main_name": "FIN7",
            "aliases": [
                "JokerStash",
                "ATK32",
                "G0046",
                "Coreid",
                "Carbanak",
                "Sangria Tempest",
                "CARBON SPIDER",
                "GOLD NIAGARA",
                "G0008",
                "ELBRUS",
                "Carbon Spider"
            ],
            "source_name": "MISPGALAXY:FIN7",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "ed3810b7-141a-4ed0-8a01-6a972b80458d",
            "created_at": "2022-10-25T16:07:23.443259Z",
            "updated_at": "2025-03-27T02:02:09.801771Z",
            "deleted_at": null,
            "main_name": "Carbanak",
            "aliases": [
                "Anunak",
                "Carbanak",
                "Carbon Spider",
                "ELBRUS",
                "Gold Waterfall",
                "Sangria Tempest"
            ],
            "source_name": "ETDA:Carbanak",
            "tools": [
                "AVE_MARIA",
                "Agentemis",
                "AmmyyRAT",
                "Antak",
                "Anunak",
                "Ave Maria",
                "AveMariaRAT",
                "BABYMETAL",
                "BIRDDOG",
                "Backdoor Batel",
                "Batel",
                "Bateleur",
                "BlackMatter",
                "Boostwrite",
                "Cain & Abel",
                "Carbanak",
                "Cl0p",
                "Cobalt Strike",
                "CobaltStrike",
                "DNSMessenger",
                "DNSRat",
                "DNSbot",
                "DRIFTPIN",
                "DarkSide",
                "FOXGRABBER",
                "FlawedAmmyy",
                "HALFBAKED",
                "JS Flash",
                "KLRD",
                "MBR Eraser",
                "Mimikatz",
                "Nadrac",
                "Odinaff",
                "POWERPIPE",
                "POWERSOURCE",
                "PsExec",
                "SQLRAT",
                "Sekur",
                "Sekur RAT",
                "SocksBot",
                "SoftPerfect Network Scanner",
                "Spy.Agent.ORM",
                "TEXTMATE",
                "TeamViewer",
                "TiniMet",
                "TinyMet",
                "Toshliph",
                "VB Flash",
                "WARPRISM",
                "avemaria",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535646,
    "ts_updated_at": 1743041817,
    "ts_creation_date": 1653759814,
    "ts_modification_date": 1653759814,
    "files": {
        "pdf": "https://archive.orkl.eu/082564846d0a6e739967fbc6e35a11d6cc8311e8.pdf",
        "text": "https://archive.orkl.eu/082564846d0a6e739967fbc6e35a11d6cc8311e8.txt",
        "img": "https://archive.orkl.eu/082564846d0a6e739967fbc6e35a11d6cc8311e8.jpg"
    }
}