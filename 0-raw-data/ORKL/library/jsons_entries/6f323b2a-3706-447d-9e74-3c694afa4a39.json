{
    "id": "6f323b2a-3706-447d-9e74-3c694afa4a39",
    "created_at": "2023-01-12T15:05:36.012537Z",
    "updated_at": "2025-03-27T02:08:40.536229Z",
    "deleted_at": null,
    "sha1_hash": "5ea88c6d558add9d2ba4e22ca88d608c740e8d4b",
    "title": "2021-02-08 - Long Live, Osiris; Banking Trojan Targets German IP Addresses",
    "authors": "",
    "file_creation_date": "2022-05-27T23:17:35Z",
    "file_modification_date": "2022-05-27T23:17:35Z",
    "file_size": 2547844,
    "plain_text": "# Long Live, Osiris; Banking Trojan Targets German IP Addresses\n\n**[blog.morphisec.com/long-live-osiris-banking-trojan-targets-german-ip-addresses](https://blog.morphisec.com/long-live-osiris-banking-trojan-targets-german-ip-addresses)**\n\nPosted by [Michael Dereviashkin on February 8, 2021](https://blog.morphisec.com/author/michael-dereviashkin)\n\n[Tweet](https://twitter.com/share)\n\n\n-----\n\nDuring the period between January 15 and 20, Morphisec identified a significant campaign\ntargeting multiple German customers from the manufacturing industry. Targeted personnel\nwere redirected to compromised websites that were, and still are, delivering advanced\nfileless downloaders that eventually lead to an Osiris client with a bundled mini-Tor\ncommunicating to a C2 onion Tor panel.\n\nFollowing an additional investigation and sharing some of the TTPs with the community, we\nwere notified of additional targeted countries such as the United States and Korea, which\nwere delivered REvil and other payloads using the same delivery mechanism as described in\nthe report.\n\nIn this blog, we will go over every stage of the attack chain in the German campaign.\n\n## Technical Introduction\n\nThe attack chain is composed of five main stages;\n\nAn obfuscated Javascript downloader from a compromised site\nA Second stage Javascript downloader that takes care of persistence\nA Powershell executed by the Javascript that leads to reflective loading of the next\nstage .NET file\nA fileless .NET loader that’s mapped from the registry and decodes to a new .NET\nhollower in-memory executable, which is responsible for hollowing the Osiris trojan\ninto a legitimate Windows process.\nOsiris connects to its C2 with the help of a mini-Tor bundle.\n\n\n-----\n\n**Figure 1: The Osiris attack chain.**\n\n## Initial Access\n\nThe victim receives a link to a compromised website that contains a download link to a\nmalicious zip file, which then contains a JS file., the web page and the file name translates\nto “collective agreement on-call remuneration ig metal.”\n\nThe download as well as the rest of the attack chain communication will be available only to\nan IP located in Germany.\n\nFigure 2: The compromised website.\n\nThe screen shot above is taken from the compromised website.\n\n### Stage 1 - Javascript downloader\n\n\n-----\n\nThe JavaScript file inside the zip archive:\n\n**Figure 3: The JavaScript file.**\n\nThe screenshot below is a formatted view of the malicious Javascript:\n\n**Figure 4: A formatted view of the malicious JavaScript**\n\nAs seen above, the Javascript code is composed of dictionary generated code and includes\nreal words in order to evade the static file scan used by AV solutions for obfuscation\ndetection. It’s important to note that for every new download of javascript, the JS code won’t\nbe exactly the same, but it will have a similar structure.\n\nIn order to deobfuscate the embedded code in all Javascript stages, the following code\nsnippet can be used:\n\n**Figure 5: Deobfuscating the JavaScript**\n\n\n-----\n\n**Step 2**\n\nThe “prove” variable (the long obfuscated string) actually contains the embedded next step\nobfuscated Javascript code that deobfuscates itself into:\n\n**Figure 6: The \"prove\" variable.**\n\nNote that for every new download of Javascript, the unique id is represented by the registry\npath generated within the “HKCU/<Random 5 letters>.” The “create” function is then called\nwith the Javascript code execution in the next step.\n\n**Step 3**\n\nAs seen on the screenshot below, the Javascript contains three domains that the code\nattempts to communicate with. It’s worth mentioning that they are also compromised (those\ndomains change every couple of days).\n\n**Figure 7: The three compromised domains the code communicates with.**\n\n\n-----\n\nThe parameter for search is also unique per download. The script identifies if the machine is\nlocated in a domain by expending the environment variable %USERDNSDOMAIN%.\nDepending on what it receives, it sends a different get request to the compromised website\nwith a high possibility for a different malware.\n\n### Stage 2 - Javascript persistence\n\nThe second stage formatted Javascript is delivered only to German IP addresses. The code\nalready includes its next stage .NET code, which will be persisted into registry.\n\n**Figure 8: The second stage formatted JavaScript.**\n\n**Figure 9: The JavaScript executing 32-bit Powershell**\n\nAs seen above, the Javascript code will execute 32-bit Powershell using cmd. It identifies the\nOS architecture by validating the program files directory name extension.\n\n\n-----\n\n### Powershell - reflective loading\n\nThe executed Powershell command reflectively loads the next stage .NET executable from\nregistry represented by “HKCU:\\SOFTWARE\\<username>1”, but not before applying a\nminimalistic deobfuscation replacement algorithm on the value of the registry :\n\n**Figure 10: Reflective loading of the next stage.**\n\nA simple search in VirusTotal that is based on the replacement function “chba” will lead to\nprevious versions of the Powershell that are dependent on “HKCU:\\SOFTWARE\\<machine\n**_name>1.”_**\n\n### .NET loader\n\nAs seen from the previous stages, the .NET loader is a small size code that is written to the\nregistry by the second stage Javascript and is loaded to the memory by the third stage\nPowershell reflective loader\n\nFigure 11: The .NET loader\n\nThe .NET loader will add additional persistence and is responsible for decoding the next step\n.NET hollower variant, which is located under “HKCU:\\SOFTWARE\\<machine name>”\n(without the 1).\n\n\n-----\n\n**Figure 12: The .NET hollower variant.**\n\nThe .NET code under <username> is obviously much larger than the loader as it includes\nboth the hollowing functionality and the Osiris code.\n\n**Figure 13: The .NET code containing hollowing and Osiris.**\n\nThis .NET hollower injects the Osiris executable into a legitimate “ImagingDevice” executable\nthat comes preinstalled with Windows as part of the Windows Photo Viewer software.\n\n\n-----\n\n**Figure 14: The .NET hollower injecting Osiris.**\n\n## Osiris TROJAN\n\nFollowing the hollowing, the Osiris executable uses its bundled mini-Tor component to\ncommunicate with a Tor panel. As can be seen below, the banking trojan still implements\nmany of its original banker functionalities.\n\n**Figure 15: The Osiris executable uses a bundled mini-Tor.**\n\n\n-----\n\n**Figure 16: Osiris retains some banker functionality.**\n\n**Figure 17: Some banker functionality in Osiris.**\n\nArtifact file - bundled mini-Tor.\n\n**Figure 18: A bundled mini-Tor.**\n\n## Conclusion\n\n\n-----\n\nThe Osiris trojan attacking German IP addresses continues the trojan s historical use. The\nMorphisec platform blocks Osiris with a zero-trust default-deny approach to endpoint\nsecurity, powered by moving target defense. Customers of Morphisec are thus protected\nfrom Osiris, regardless of what defense evasion techniques the authors deploy.\n\n### IOC:\n\nEC936B6BB7497FFB11577C14A9AB2860EC1DD705DC18225BBDAB5BF57804BDBC JS\n\n72C5EEB8807A4576340485377CACC582A3CA651C4632DB06903C125BE6692968 .NET module <username1>\n\n63C62D6086A6CF2FCBB22A16C06EB0BC870CDB2F0BB029390D3BC815C06A6C6B .NET module <username>\n\n2FC970B717486762F6C890F525329962662074EB632F0827C901FB1081CBD98F - Osiris\n\n91F1023142B7BABF6FF75DAD984C2A35BDE61DC9E61F45483F4B65008576D581 Minitor www.underregnbuen[.]dk/?p=5739 - the compromised website\n\nhxxp://ylnfkeznzg7o4xjf[.]onion/kpanel/connect.php - Osiris C2\n\n[Contact SalesInquire via Azure](http://10.10.0.46/mailto:sales@morphisec.com)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-02-08 - Long Live, Osiris; Banking Trojan Targets German IP Addresses.pdf"
    ],
    "report_names": [
        "2021-02-08 - Long Live, Osiris; Banking Trojan Targets German IP Addresses.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535936,
    "ts_updated_at": 1743041320,
    "ts_creation_date": 1653693455,
    "ts_modification_date": 1653693455,
    "files": {
        "pdf": "https://archive.orkl.eu/5ea88c6d558add9d2ba4e22ca88d608c740e8d4b.pdf",
        "text": "https://archive.orkl.eu/5ea88c6d558add9d2ba4e22ca88d608c740e8d4b.txt",
        "img": "https://archive.orkl.eu/5ea88c6d558add9d2ba4e22ca88d608c740e8d4b.jpg"
    }
}