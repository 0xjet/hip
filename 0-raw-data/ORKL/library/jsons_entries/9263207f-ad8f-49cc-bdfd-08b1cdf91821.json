{
    "id": "9263207f-ad8f-49cc-bdfd-08b1cdf91821",
    "created_at": "2023-01-12T15:05:05.218071Z",
    "updated_at": "2025-03-27T02:16:58.015492Z",
    "deleted_at": null,
    "sha1_hash": "f6610891eafcac8366764cce0b3dd6f3fc4d1c3c",
    "title": "2021-05-13 - Ransomware Groups Use Tor-Based Backdoor for Persistent Access",
    "authors": "",
    "file_creation_date": "2022-05-28T18:16:51Z",
    "file_modification_date": "2022-05-28T18:16:51Z",
    "file_size": 347819,
    "plain_text": "# Ransomware Groups Use Tor-Based Backdoor for Persistent Access\n\n**[secureworks.com/blog/ransomware-groups-use-tor-based-backdoor-for-persistent-access](https://www.secureworks.com/blog/ransomware-groups-use-tor-based-backdoor-for-persistent-access)**\n\nCounter Threat Unit Research Team\n\nIn 2020 and 2021, Secureworks® Counter Threat Unit™ (CTU) researchers observed\nseveral threat groups using the official Tor client to create a backdoor with persistent access\nto compromised networks via Remote Desktop Protocol (RDP). Third-party researchers\n[documented similar activity during a mid-2018 intrusion. The Tor client can be used to create](https://www.allthingsdfir.com/rdp-over-tor/)\na local SOCKS proxy that allows proxy-aware applications to access the Tor network. Tor\n\n\n-----\n\n[can also create Onion Services (originally known as hidden services) that can then be](https://community.torproject.org/onion-services/)\naccessed through the Tor network. The threat actors create an Onion Service that allows a\nremote attacker to connect to the RDP service on the compromised host.\n\nBy default, Tor stores metadata used to maintain a connection to the Tor network in the\n%APPDATA%\\tor directory. The location of this directory can be changed by modifying the\n[DataDirectory directive in the configuration file. An alternative path to a configuration file can](https://2019.www.torproject.org/docs/tor-manual.html.en)\nbe provided to the Tor client at runtime with the -f command-line parameter. The folder's\ncreation time is the moment Tor was first executed by the user. Within this directory, the\n\"lock\" file's modification timestamp matches the time the Tor client was last executed. Tor\nperiodically updates the \"state\" file; its modification timestamp can vary up to a few minutes\nfrom the Tor client's last activity.\n\nWhile running, the Tor client maintains an open session with the Tor network that brokers\ninbound connections to the Onion Service. When a remote attacker connects to the onion\naddress and port pair registered as the Onion Service, the connection is redirected to the IP\naddress and port specified in the HiddenServicePort configuration directive. When the\nHiddenServicePort directive is configured as the loopback IP address (127.0.0.1), the\nconnection is redirected to the localhost.\n\nBeginning in mid-2020, CTU™ researchers analyzed several incidents where threat actors\nleveraged an Onion Service on a compromised system to redirect inbound requests to the\nlocal RDP service. The financially motivated GOLD WATERFALL threat group perpetrated\ntwo of these incidents, one of which included deployment of the Darkside ransomware. The\nthreat actors installed Tor into the C:\\Windows\\Inf\\Usb folder and executed it via the following\ncommand line:\n```\nC:\\Windows\\Inf\\Usb\\Tor\\tor.exe -f C:\\Windows\\Inf\\Usb\\config.dat\n\n```\nTo maintain the Tor client's persistence, GOLD WATERFALL used the Non-Sucking Service\nManager (nssm.exe) to install Tor as a service. Figure 1 shows the Tor configuration.\n\n_Figure 1. Tor configuration used by GOLD WATERFALL. (Source: Secureworks)_\n\nCTU researchers discovered another victim that had a domain controller containing an\nidentical setup installed during or before April 2020. This victim's network was not infected\nwith ransomware. It is unclear if GOLD WATERFALL had access to this host, but at the time\n[the group was a REvil ransomware affiliate.](https://www.secureworks.com/research/revil-sodinokibi-ransomware)\n\n\n-----\n\nIn a separate incident observed in February 2021, a threat actor distributing the Snatch\nransomware set up a Tor backdoor using the configuration in Figure 2. The configuration file\nand other tactics, techniques, and procedures (TTPs) match details in a June 2020 thirdparty [report on Snatch ransomware activity.](https://thedfirreport.com/2020/06/21/snatch-ransomware/)\n\n_Figure 2. Tor configuration used during Snatch ransomware incident. (Source: Secureworks)_\n\nTo keep the Tor client running, the threat actors executed a service.bat Windows batch script\nto create a service using the Service Control (sc.exe) command-line utility (see Figure 3).\n\n_Figure 3. Creation of service to keep Tor client running. (Source: Secureworks)_\nAlthough the threat actors used these backdoors in all of the analyzed intrusions, it is\npossible that the backdoors were created by initial access brokers (IABs) who compromised\nthe victims' networks. The IABs sell the credentials, a summary of the victim's environment\n(number of endpoints, etc.), and the onion address hosted within the network.\n\nThe Windows event log writes the following three events when a threat actor successfully\nauthenticates via RDP exposed using this type of Tor backdoor. The data in the figures is\ncontrived for demonstration purposes.\n\n\n-----\n\nEvent 4624 Logon Type 3 (network) is written to the Security log. The account name is\nthe user whose credentials are compromised, and the workstation name is the\ncomputer name used by the attacker (see Figure 4).\n\n_Figure 4. Windows event 4624 indicates a successful logon. (Source: Secureworks)_\n\n\n-----\n\nEvent 1149 is written to the Terminal Services Remote Connection Manager log. The\nexpected source network address is the remote IP address of the connecting user, but\nthis activity uses loopback address 127.0.0.1 (see Figure 5).\n\n_Figure 5. Windows event 1149 indicates successful RDP authentication. (Source:_\n_Secureworks)_\n\nEvent 25 is written to the Terminal Services Local Session Manager log. This event\nalso contains the anomalous loopback address in the source network address field\n(see Figure 6).\n\n_Figure 6. Windows event 25 indicates successful RDP session reconnection. (Source:_\n_Secureworks)_\n\nTor is designed to operate within adversarial environments where governments or other well[resourced entities attempt to deny or monitor internet communication. Blocking published Tor](https://www.dan.me.uk/tornodes)\nentry nodes at network egress points may be effective against Tor clients that use the default\nprotocol. Tor clients that use bridges and pluggable transports are much more difficult to\n\n\n-----\n\nblock because the infrastructure is more dynamic and cannot be compiled into easily\nconsumed lists. Intrusion prevention systems (IPS) are often capable of performing the deep\npacket inspection necessary to identify obfuscated Tor traffic.\n\nTo mitigate exposure to this threat, CTU researchers recommend that organizations use\navailable controls to review and possibly restrict access using the indicators in Table 1.\nAdditional information about the GOLD WATERFALL threat group that operates the Darkside\n[ransomware is available in the public threat profile.](https://www.secureworks.com/research/threat-profiles/gold-waterfall)\n\nIndicator Type Context\n\n\n4c84fa62a7267a2b3b62dc2059fda48b MD5\nhash\n\neb47854dac531b4723e1c7c8ce65221404de95d1 SHA1\nhash\n\n\n689f01d9a58bba687da177654dedbcd5cf7e525\ncd51be5fe26d1946767b1fce5\n\n\nSHA256\nhash\n\n\n6691b4bf79624963fb2dcb22141998a5 MD5\nhash\n\n046d8a6aaa060cad8c78e531d5c700ec66b0c05a SHA1\nhash\n\n\nfd319f0bd259ccb83fe8992b43525629594a1fd27b\n84c6091ed62d0fd2fe0050\n\n_Table 1. Indicators for this threat._\n\n\nSHA256\nhash\n\n\nWindows batch script\n(service.bat) used to install\nTor backdoor during\nSnatch ransomware\nincident\n\nWindows batch script\n(service.bat) used to install\nTor backdoor during\nSnatch ransomware\nincident\n\nWindows batch script\n(service.bat) used to install\nTor backdoor during\nSnatch ransomware\nincident\n\nTor configuration file\n(libeay32.dat) used during\nSnatch ransomware\nincident\n\nTor configuration file\n(libeay32.dat) used during\nSnatch ransomware\nincident\n\nTor configuration file\n(libeay32.dat) used during\nSnatch ransomware\nincident\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-05-13 - Ransomware Groups Use Tor-Based Backdoor for Persistent Access.pdf"
    ],
    "report_names": [
        "2021-05-13 - Ransomware Groups Use Tor-Based Backdoor for Persistent Access.pdf"
    ],
    "threat_actors": [
        {
            "id": "2646f776-792a-4498-967b-ec0d3498fdf1",
            "created_at": "2022-10-25T15:50:23.475784Z",
            "updated_at": "2025-03-27T02:00:55.479958Z",
            "deleted_at": null,
            "main_name": "BlackTech",
            "aliases": [
                "BlackTech",
                "Palmerworm"
            ],
            "source_name": "MITRE:BlackTech",
            "tools": [
                "Kivars",
                "PsExec",
                "TSCookie",
                "Flagpro",
                "Waterbear"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "334d00aa-7607-4072-9f5b-00d60bae89a7",
            "created_at": "2023-01-06T13:46:39.280703Z",
            "updated_at": "2025-03-27T02:00:03.039315Z",
            "deleted_at": null,
            "main_name": "GOLD WATERFALL",
            "aliases": [],
            "source_name": "MISPGALAXY:GOLD WATERFALL",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d3a7123c-f519-49a0-a234-de24a1ef052a",
            "created_at": "2022-10-25T16:47:55.545211Z",
            "updated_at": "2025-03-27T02:05:17.254744Z",
            "deleted_at": null,
            "main_name": "BRONZE CANAL",
            "aliases": [
                "CTG-6177 ",
                "Circuit Panda ",
                "Palmerworm ",
                "Shrouded Crossbow ",
                "BlackTech"
            ],
            "source_name": "Secureworks:BRONZE CANAL",
            "tools": [
                " DRIGO",
                " Flagpro",
                " Gh0stTimes",
                " PLEAD",
                " Spiderpig",
                " Waterbear",
                "Bifrose"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "75024aad-424b-449a-b286-352fe9226bcb",
            "created_at": "2023-01-06T13:46:38.962724Z",
            "updated_at": "2025-03-27T02:00:02.964002Z",
            "deleted_at": null,
            "main_name": "BlackTech",
            "aliases": [
                "CIRCUIT PANDA",
                "Temp.Overboard",
                "G0098",
                "Red Djinn",
                "HUAPI",
                "Palmerworm",
                "T-APT-03",
                "Manga Taurus",
                "Earth Hundun"
            ],
            "source_name": "MISPGALAXY:BlackTech",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "efa7c047-b61c-4598-96d5-e00d01dec96b",
            "created_at": "2022-10-25T16:07:23.404442Z",
            "updated_at": "2025-03-27T02:02:09.781478Z",
            "deleted_at": null,
            "main_name": "BlackTech",
            "aliases": [
                "BlackTech",
                "Circuit Panda",
                "Earth Hundun",
                "Manga Taurus",
                "Operation PLEAD",
                "Operation Shrouded Crossbow",
                "Operation Waterbear",
                "Palmerworm",
                "Radio Panda",
                "Red Djinn",
                "T-APT-03",
                "TEMP.Overboard"
            ],
            "source_name": "ETDA:BlackTech",
            "tools": [
                "BIFROST",
                "BUSYICE",
                "BendyBear",
                "Bluether",
                "CAPGELD",
                "DRIGO",
                "Deuterbear",
                "Flagpro",
                "GOODTIMES",
                "Gh0stTimes",
                "IconDown",
                "KIVARS",
                "LOLBAS",
                "LOLBins",
                "Linopid",
                "Living off the Land",
                "TSCookie",
                "Waterbear",
                "XBOW",
                "elf.bifrose"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "f7f78592-30a7-45bc-bf71-e283b3c73ee1",
            "created_at": "2024-06-19T02:03:08.137994Z",
            "updated_at": "2025-03-27T02:05:17.404295Z",
            "deleted_at": null,
            "main_name": "GOLD WATERFALL",
            "aliases": [
                ""
            ],
            "source_name": "Secureworks:GOLD WATERFALL",
            "tools": [
                " CANVAS",
                " Cobalt Strike",
                " Darkside",
                "BlackMatter"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "ed3810b7-141a-4ed0-8a01-6a972b80458d",
            "created_at": "2022-10-25T16:07:23.443259Z",
            "updated_at": "2025-03-27T02:02:09.801771Z",
            "deleted_at": null,
            "main_name": "Carbanak",
            "aliases": [
                "Anunak",
                "Carbanak",
                "Carbon Spider",
                "ELBRUS",
                "Gold Waterfall",
                "Sangria Tempest"
            ],
            "source_name": "ETDA:Carbanak",
            "tools": [
                "AVE_MARIA",
                "Agentemis",
                "AmmyyRAT",
                "Antak",
                "Anunak",
                "Ave Maria",
                "AveMariaRAT",
                "BABYMETAL",
                "BIRDDOG",
                "Backdoor Batel",
                "Batel",
                "Bateleur",
                "BlackMatter",
                "Boostwrite",
                "Cain & Abel",
                "Carbanak",
                "Cl0p",
                "Cobalt Strike",
                "CobaltStrike",
                "DNSMessenger",
                "DNSRat",
                "DNSbot",
                "DRIFTPIN",
                "DarkSide",
                "FOXGRABBER",
                "FlawedAmmyy",
                "HALFBAKED",
                "JS Flash",
                "KLRD",
                "MBR Eraser",
                "Mimikatz",
                "Nadrac",
                "Odinaff",
                "POWERPIPE",
                "POWERSOURCE",
                "PsExec",
                "SQLRAT",
                "Sekur",
                "Sekur RAT",
                "SocksBot",
                "SoftPerfect Network Scanner",
                "Spy.Agent.ORM",
                "TEXTMATE",
                "TeamViewer",
                "TiniMet",
                "TinyMet",
                "Toshliph",
                "VB Flash",
                "WARPRISM",
                "avemaria",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535905,
    "ts_updated_at": 1743041818,
    "ts_creation_date": 1653761811,
    "ts_modification_date": 1653761811,
    "files": {
        "pdf": "https://archive.orkl.eu/f6610891eafcac8366764cce0b3dd6f3fc4d1c3c.pdf",
        "text": "https://archive.orkl.eu/f6610891eafcac8366764cce0b3dd6f3fc4d1c3c.txt",
        "img": "https://archive.orkl.eu/f6610891eafcac8366764cce0b3dd6f3fc4d1c3c.jpg"
    }
}