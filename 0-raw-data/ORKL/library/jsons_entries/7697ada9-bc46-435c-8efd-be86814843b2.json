{
    "id": "7697ada9-bc46-435c-8efd-be86814843b2",
    "created_at": "2023-01-12T15:05:59.57193Z",
    "updated_at": "2025-03-27T02:05:37.75266Z",
    "deleted_at": null,
    "sha1_hash": "8c8bd604ac8304ba7f481f462b11b64902d7b8e4",
    "title": "2021-11-04 - Detecting IcedID... Could It Be A Trickbot Copycat-",
    "authors": "",
    "file_creation_date": "2022-05-28T23:17:16Z",
    "file_modification_date": "2022-05-28T23:17:16Z",
    "file_size": 1446427,
    "plain_text": "# Detecting IcedID... Could It Be A Trickbot Copycat?\n\n**[splunk.com/en_us/blog/security/detecting-icedid-could-it-be-a-trickbot-copycat.html](https://www.splunk.com/en_us/blog/security/detecting-icedid-could-it-be-a-trickbot-copycat.html)**\n\nSECURITY\n\n\nNovember 4, 2021\n\n\nBy [Splunk Threat Research Team November 04, 2021](https://www.splunk.com/en_us/blog/author/secmrkt-research.html)\n\nIcedID is a [banking trojan, it is designed to be stealthy and built to collect financial information.](https://www.investopedia.com/terms/b/banker-trojan.asp)\nIcedID harvests user credentials and banking sessions to commit financial crimes, including carding,\nmoney laundering, and transferring of funds to foreign financial institutions. In recent research\npublished by Splunk Threat Research Team (STRT) the inclusion of cryptocurrency exchange\n\n\n-----\n\n[information was also included by Trickbot in the web inject code. IcedID shares many of the same](https://www.splunk.com/en_us/blog/security/detecting-trickbots.html)\n[payloads featured in Emotet or](https://www.europol.europa.eu/newsroom/news/world%E2%80%99s-most-dangerous-malware-emotet-disrupted-through-global-action) [Trickbot and in some cases, IcedID has been observed downloading](https://securityintelligence.com/news/banking-trojans-trickbot-and-iceid-partner-for-distribution-and-development/)\nEmotet or Trickbot, as a way to provide operators a way to use diverse carriers as well.\n\nIcedID targets financial institutions across different countries including banks, payment card\nproviders, and e-commerce sites. IcedID has also been observed deployed in conjunction with other\n[malware payloads such as Valak,](https://blogs.infoblox.com/cyber-threat-intelligence/valak-downloader-infostealer-delivers-icedid-banking/) [Qakbot,](https://www.bleepingcomputer.com/news/security/qbot-malware-is-back-replacing-icedid-in-malspam-campaigns/) [Conti Ransomware. It is clear from studying past](https://thedfirreport.com/2021/05/12/conti-ransomware/)\ncampaigns that the actors behind IcedID have expanded beyond banking information in order to\nextend similar features and coverage as other popular carriers such as Emotet or trickbot and by\ndoing so current iterations of IcedID look more like a copycat or maybe even a successor.\n\n## Spear Phishing Documents\n\nIn a [recent campaign, malicious actors were observed using a document builder to simulate](https://www.jdsupra.com/legalnews/docusign-alert-new-malicious-hacking-5278845/)\n[legitimate DocuSign documents and embedding exploitation code for CVE-2017-8570 to trigger the](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2017-8570)\ninstallation of IcedID. These documents were delivered via spear-phishing technique.\n\nBelow is the screenshot of the phishing campaign (Word and Excel) that will download the IcedID\ndownloader as soon as the user runs the malicious macro document in the targeted host.\n\n\n-----\n\nThis malicious document will download the IcedID loader then drop it as a “.sys” or “.jpg” file and\nexecute it using regsvr32.exe windows application with “-s” parameter like the screenshot below.\n\n\n-----\n\nOther exploitation vectors include running an obfuscated HTML application (.hta) to download the\nDLL loader as a .jpg file then execute it with rundll32.exe windows application with the “PluginInit”\nparameter. Below is the screenshot of the macro code that executes the .hta file and the deobfuscated .hta script shows how it downloads and executes the first payload.\n\n\n-----\n\n## IcedID Initial Downloader (Stage 1)\n\nThe initial IceID loader binary will decrypt another .dll file in memory to download the 2nd stage\npayload (png or .dat) files. This is done by initially connecting to aws.amazon.com to check the\ninternet connection and to prepare its initial C2 communication.\n\n\n-----\n\n## IcedID Payload Loader - PhotoLoader and “License.dat” decrypter) (Stage 2)\n\nOnce the second stage payload is downloaded, It will load a shellcode or headless executable file\nwhich is the main IcedID bot. This shellcode can be extracted either in .png file format (payload\nobfuscated by steganography) or gzip payload format containing a “license.dat” file.\n\nThe next code snippet below shows the .dll in memory locating the .png payload in a randomly\ngenerated directory based on the user name of the compromised machine created in either\n%appdata% or “C:\\Programdata”. If the .png file payload is found in either of those two folder paths,\nit will decrypt the shellcode from the image file if not it tries to download from the C&C server.\n\nFor the gzip file, It uses a similar code to locate the “license.dat” payload, aside from having an\nadditional parameter check “/i” in the syntax line, as seen in the screenshot below.\n\n\n-----\n\n## IcedID .PNG Steganography and “License.dat” Payload\n\nThe PNG payload uses steganography to hide the shellcode inside the PNG. The encrypted\nshellcode and the 8 bytes rc4 decryption keys are placed in the IDAT chunk type structure of the\n[PNG header file. A python script was developed (IceIdPNGShellcodeExtractor.py) to automatically](https://github.com/tccontre/KnowledgeBase/tree/main/malware_re_tools/iceid_stego_shell_decryptor)\nextract the shellcode on the said payload.\n\nFor the “license.dat” IcedID payload, it will decrypt it using its customized decryption algorithm using\nits last 16 bytes as the decryption key. In this case, the [IceIdDecrypt.py tool can be used to decrypt](https://github.com/BinaryDefense/IcedDecrypt)\nlicense.dat and do a static analysis of the file.\n\n## IcedID Core/Main Bot (Stage 3)\n\nThe shellcode or the core IcedID BOT will be injected in either spawned svchost.exe system\nprocessor in msiexec.exe or within the memory space of a rundll32 process that loads the .dll\nshellcode decryptor. After that, it will hook some native API, create a mutex as a mark of its infection,\nand make sure only one instance is running. Below are other notable behaviors seen in this main\nbot.\n\n### Hook Browser:\n\nThis shellcode will try to hook common browsers like firefox and chrome to steal credentials,\ncookies, and sessions saved. The screenshot below shows what it looks like in firefox and chrome\nbrowsers in the compromised machine.\n\n### Desktop Screenshots:\n\nThis code displays the ability to take screenshots of the desktop window of the compromised host.\nThis bitmap image file format will be saved in the temp folder with a .tmp file extension to blend on\nnormal .tmp files activities.\n\n\n-----\n\n### Passff.tar and cookie.tar\n\nIt will also create files named “passff.tar” for the browser history and “cookie.tar” for the browser\ncookies that may contain stolen browser information.\n\n### Stealing Browser Information\n\nIcedID will also download and load a “sqlite64.dll” in the %temp% folder that will be needed for\nparsing firefox and chrome browser database to extract information. Below are SQLite commands\ndecrypted in the shellcode to harvest autofill information from browser .db like cookies, password,\ncompany_name, street_address, city, state, zip code, country_code, phone number, user full name,\nand credit card information.\n\nSELECT host_key, path, is_secure, (case expires_utc when 0 then 0 else (expires_utc / 1000000)\n\n - 11644473600 end), name, length(encrypted_value), encrypted_value FROM cookies\n\n\n-----\n\nSELECT name, value FROM autofill\n\nSELECT guid, company_name, street_address, city, state, zipcode, country_code FROM\nautofill_profiles\n\nSELECT guid, number FROM autofill_profile_phones\n\nSELECT guid, first_name, middle_name, last_name, full_name FROM autofill_profile_names\n\nSELECT card_number_encrypted, length(card_number_encrypted), name_on_card,\nexpiration_month || \"/\" ||expiration_year FROM credit_cards\n\nSELECT origin_url,username_value,length(password_value),password_value FROM logins\nWHERE username_value <> ''\n\nSELECT host, path, isSecure, expiry, name, value FROM moz_cookies\n\nSELECT fieldname, value FROM moz_formhistory\n\n### UAC Bypass\n\nThe following are two functions to Bypass UAC (User Account Control). The Eventvwr and the\nfodhelper UAC bypass technique.\n\n### Harvest Email/Outlook Information and Browser Password Storage\n\nExfiltration tasks also include querying several registry keys related to email client Microsoft Outlook\nto steal user profiles, email signatures, and stored password folders through registry and ActiveMail\nPartners “%u” is the outlook version installed in the machine\n\n\n-----\n\nHKCU\\Software\\Microsoft\\Office\\%u.0\\Outlook\\Profiles\n\nHKCU\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Windows Messaging\nSubsystem\\Profiles\\Outlook\\9375CFF0413111d3B88A00104B2A6676\n\nHKCU\\Software\\Microsoft\\ActiveSync\\Partners\n\nHKCU\\Software\\Microsoft\\Internet Explorer\\IntelliForms\\Storage2\n\n### Recon AV Product\n\nThe following PowerShell commands detect Antivirus Product information.\n\nWMIC /Node:localhost /Namespace:\\\\root\\SecurityCenter2 Path AntiVirusProduct Get *\n/Format:List\n\n### Other Execution and RemoteThread Execution\n\nWe also found chcp command execution and passage of the result to a created pipe. The result of\nthis command line may give the locale country region of the compromised host base on its result.\nFor example, the 437 result means “default code page in the US”.\n\nAnother regsvr32 execution with “/s” parameter to execute DLL payload downloaded from its C2\nserver, copy of itself or decrypted DLL that was dropped in the compromised host.\n\nCode injection into a cmd.exe process.\n\n\n-----\n\n## Persistence\n\nIcedID creates a scheduled task entry to download the file that will decrypt and load the license.dat\nfile using a process spawned via the Rundll32 application, as seen in the screenshot below.\n\nIn addition to using scheduled tasks for spawning processes, the main bot is also capable of creating\na regrun entry for its DLL payload using SHSetValueA API. This will ensure that the DLL will be\nloaded every time a user logs on.\n\n## Create Self Signed Certificate\n\nIcedID will also add certificates into the certificate store that will be saved in the %temp% folder as\npart of its possible proxy communication to its C2 server bound to IP 127.0.0.1 port 54245. The\nscreenshot below shows the decrypted certificate format that IcedID will add to the certificate store in\na .tmp file. This proxy function also compliments the web inject vector as an alternative way to\ncapture traffic and credentials.\n\n\n-----\n\nThe screenshot below shows how IcedID setup proxy from IP 127.0.0.1 port 54245 by listening on\nthe created socket relative to the IP and port mentioned above.\n\nThe following are several detection methods created by STRT to address IcedID. All these\ndetections are encompassed in an Analytic story released in our content updates.\n\n## Detections\n\n\n-----\n\nSuspicious Rundll32 Plugininit (New)\n\n| tstats `security_content_summariesonly` count min(_time) as firstTime max(_time) as lastTime\nfrom datamodel=Endpoint.Processes where Processes.process_name=rundll32.exe\nProcesses.process=*PluginInit* by Processes.process_name Processes.process\nProcesses.parent_process_name Processes.parent_process Processes.process_id\nProcesses.parent_process_id Processes.dest Processes.user\n\n| `drop_dm_object_name(Processes)`\n\n| `security_content_ctime(firstTime)`\n\n| `security_content_ctime(lastTime)`\n\nSuspicious IcedID Rundll32 Cmdline (New)\n\n| tstats `security_content_summariesonly` count min(_time) as firstTime max(_time)\n\nas lastTime from datamodel=Endpoint.Processes where Processes.process_name=rundll32.exe\n\nProcesses.process=*/i:* by Processes.process_name Processes.process\n\nProcesses.parent_process_name Processes.parent_process Processes.process_id\n\nProcesses.parent_process_id Processes.dest Processes.user\n\n| `drop_dm_object_name(Processes)`\n\n| `security_content_ctime(firstTime)`\n\n| `security_content_ctime(lastTime)`\n\n\n-----\n\nRundll32 DNSQuery (New)\n\n`sysmon` EventCode=22 process_name=\"rundll32.exe\"\n\n| stats count min(_time) as firstTime max(_time) as lastTime\n\nby Image QueryName QueryStatus ProcessId direction Computer\n\n| `security_content_ctime(firstTime)`\n\n| `security_content_ctime(lastTime)`\n\n\n-----\n\nRundll32 Process Creating Exe Dll Files (New)\n\n`sysmon` EventCode=11 process_name=\"rundll32.exe\" TargetFilename IN (\"*.exe\", \"*.dll\",)\n\n| stats count min(_time) as firstTime max(_time) as lastTime\n\nby Image TargetFilename ProcessGuid dest user_id\n\n| `security_content_ctime(firstTime)`\n\n| `security_content_ctime(lastTime)`\n\n\n-----\n\nSuspicious IcedID Regsvr32 Cmdline (New)\n\n| tstats `security_content_summariesonly` count min(_time) as firstTime max(_time)\n\nas lastTime from datamodel=Endpoint.Processes where Processes.process_name=regsvr32.exe\n\nProcesses.process=*-s* by Processes.process_name Processes.process\nProcesses.parent_process_name\n\nProcesses.parent_process Processes.process_id Processes.parent_process_id Processes.dest\nProcesses.user\n\n| `drop_dm_object_name(Processes)`\n\n| `security_content_ctime(firstTime)`\n\n| `security_content_ctime(lastTime)`\n\nRundll32 CreateRemoteThread In-Browser (New)\n\n\n-----\n\n`sysmon` EventCode=8 SourceImage = \"*\\\\rundll32.exe\" TargetImage IN (\"*\\\\firefox.exe\",\n\"*\\\\chrome.exe\")\n\n| stats count min(_time) as firstTime max(_time) as lastTime\n\nby SourceImage TargetImage TargetProcessId SourceProcessId StartAddress EventCode\nComputer\n\n| `security_content_ctime(firstTime)`\n\n| `security_content_ctime(lastTime)`\n\nOffice Application Spawn Regsvr32 process (new)\n\n\n-----\n\n| tstats `security_content_summariesonly` count min(_time) as firstTime max(_time) as lastTime\n\nfrom datamodel=Endpoint.Processes where (Processes.parent_process_name = \"winword.exe\"\nOR Processes.parent_process_name\n\n= \"excel.exe\" OR Processes.parent_process_name = \"powerpnt.exe\" OR\nProcesses.parent_process_name = \"outlook.exe\")\n\nProcesses.process_name=regsvr32.exe by Processes.parent_process_name\nProcesses.parent_process Processes.process_name\n\nProcesses.process Processes.process_id Processes.process_guid Processes.user\nProcesses.dest\n\n| `drop_dm_object_name(\"Processes\")`\n\n| `security_content_ctime(firstTime)`\n\n|`security_content_ctime(lastTime)`\n\nRecon AVProduct Through Pwh or WMI (Modified)\n\n`powershell` EventCode=4104 (Message = \"*SELECT*\" OR Message = \"*WMIC*\") AND\n(Message = \"*AntiVirusProduct*\" OR Message = \"*AntiSpywareProduct*\") | stats count min(_time)\nas firstTime max(_time) as lastTime by EventCode Message ComputerName User |\n`security_content_ctime(firstTime)`| `security_content_ctime(lastTime)`\n\n\n-----\n\nCHCP Command Execution (New)\n\n| tstats `security_content_summariesonly` count min(_time) as firstTime max(_time)\n\nas lastTime from datamodel=Endpoint.Processes\n\nwhere Processes.process_name=chcp.com Processes.parent_process_name = cmd.exe\n\nProcesses.parent_process=*/c* by Processes.process_name Processes.process\n\nProcesses.parent_process_name Processes.parent_process Processes.process_id\nProcesses.parent_process_id Processes.dest Processes.user\n\n| `drop_dm_object_name(Processes)`\n\n| `security_content_ctime(firstTime)`\n\n| `security_content_ctime(lastTime)`\n\nCreate Remote Thread In Shell Application (New)\n\n\n-----\n\n`sysmon` EventCode=8 TargetImage IN (\"*\\\\cmd.exe\", \"*\\\\powershell*\")\n\n| stats count min(_time) as firstTime max(_time) as lastTime\n\nby TargetImage TargetProcessId SourceProcessId EventCode StartAddress SourceImage\nComputer | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)`\n\nDrop IcedID License.dat (New)\n\n`sysmon` EventCode= 11 TargetFilename = \"*\\\\license.dat\" AND (TargetFilename=\"*\\\\appdata\\\\*\"\nOR TargetFilename=\"*\\\\programdata\\\\*\")\n\n|stats count min(_time) as firstTime max(_time) as lastTime by TargetFilename EventCode\nprocess_id process_name Computer | `security_content_ctime(firstTime)`\n\n| `security_content_ctime(lastTime)`\n\nIcedID Exfiltrated Archived File Creation (New)\n\n\n-----\n\n`sysmon` EventCode= 11 (TargetFilename = \"*\\\\passff.tar\" OR TargetFilename = \"*\\\\cookie.tar\")\n\n|stats count min(_time) as firstTime max(_time) as lastTime by TargetFilename EventCode\nprocess_id process_name Computer | `security_content_ctime(firstTime)` |\n`security_content_ctime(lastTime)`\n\nSQLite Module In Temp Folder (New)\n\n`sysmon` EventCode= 11 (TargetFilename = \"*\\\\sqlite32.dll\" OR TargetFilename = \"*\\\\sqlite64.dll\")\n(TargetFilename = \"*\\\\temp\\\\*\")\n\n|stats count min(_time) as firstTime max(_time) as lastTime by process_name TargetFilename\nEventCode ProcessId Image process_id process_name Computer\n\n| `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)`\n\n\n**Detection** **Techniques**\n**ID**\n\n\n**Tactics** **Description** **Defense Tactics &**\n**Techniques**\n\n\n-----\n\nPreviously seen\n[command line](https://github.com/splunk/security_content/blob/develop/baselines/previously_seen_command_line_arguments.yml)\narguments (Existing)\n\nEventvwr UAC\nBypass (Existing)\n\nFodHelper UAC\nBypass (Existing)\n\nMshta spawning\n[Rundll32 OR](https://github.com/splunk/security_content/blob/develop/detections/endpoint/mshta_spawning_rundll32_or_regsvr32_process.yml)\nRegsvr32 Process\n(Existing)\n\n\n[T1059](https://attack.mitre.org/techniques/T1059/) Execution Detects for\ncommand\nline\narguments\nwhere\n`cmd.exe /c`\nis used\n\nto execute a\nprogram\n\n\n[T1548.002](https://attack.mitre.org/techniques/T1548/002/) Privilege\nEscalation,\nDefense\nEvasion\n\n[T1548.002](https://attack.mitre.org/techniques/T1548/002/) Privilege\nEscalation,\nDefense\nEvasion\n\n[T1218.005](https://attack.mitre.org/techniques/T1218/005/) Defense\nEvasion\n\n\nDetects uac\nbypass using\neventvwr\n\nDetects uac\nbypass using\nfodhelper\n\nDetects\nsuspicious\nchild process\nof mshta\nparent\nprocess\n\n\nDetect\n\n[D3-SEA](https://d3fend.mitre.org/technique/d3f:ScriptExecutionAnalysis)\n\nScript Execution Analysis\n\nDetect:\n\n[D3-ANET /](https://d3fend.mitre.org/technique/d3f:AuthenticationEventThresholding) [D3-AZET](https://d3fend.mitre.org/technique/d3f:AuthorizationEventThresholding)\n\nAuthentication/Authorization\nEvent Thresholding\n\nDetect:\n\n[D3-ANET /](https://d3fend.mitre.org/technique/d3f:AuthenticationEventThresholding) [D3-AZET](https://d3fend.mitre.org/technique/d3f:AuthorizationEventThresholding)\n\nAuthentication/Authorization\nEvent Thresholding\n\nDetect:\n\nDynamic Analysis\n\n[D3-FAPA](https://d3fend.mitre.org/technique/d3f:FileAccessPatternAnalysis)\n\nFile Access Pattern\n\n[D3-PSA](https://d3fend.mitre.org/technique/d3f:ProcessSpawnAnalysis)\n\nProcess Spawn Analysis\n\n\n-----\n\nOffice Application\n[Spawn rundll32](https://github.com/splunk/security_content/blob/develop/detections/endpoint/office_application_spawn_rundll32_process.yml)\nprocess (Existing)\n\nOffice Document\n[Executing Macro](https://github.com/splunk/security_content/blob/develop/detections/endpoint/office_document_executing_macro_code.yml)\nCode (Existing)\n\n\n[T1566.001](https://attack.mitre.org/techniques/T1566/001/) Initial Access Detects\nsuspicious\nrundll32\nchild process\nof MS office\napplication\n\n[T1566.001](https://attack.mitre.org/techniques/T1566/001/) Initial Access Detects\nsuspicious\nMS office\napp running\nmacro code\n\n\nDetect:\n\nFile Analysis\n\n[D3-DA](https://d3fend.mitre.org/technique/d3f:DynamicAnalysis)\n\nIdentifier Analysis\n\n[D3-HD](https://d3fend.mitre.org/technique/d3f:HomoglyphDetection)\n\nURL Analysis\n\n[D3-UA](https://d3fend.mitre.org/technique/d3f:URLAnalysis)\n\nMessage Analysis\n\nSender MTA Reputation\n\n[D3-SMRA](https://d3fend.mitre.org/technique/d3f:SenderMTAReputationAnalysis)\n\nSender Reputation\n\n[D3-SRA](https://d3fend.mitre.org/technique/d3f:SenderReputationAnalysis)\n\nDetect:\n\nFile Analysis\n\n[D3-DA](https://d3fend.mitre.org/technique/d3f:DynamicAnalysis)\n\nIdentifier Analysis\n\n[D3-HD](https://d3fend.mitre.org/technique/d3f:HomoglyphDetection)\n\nURL Analysis\n\n[D3-UA](https://d3fend.mitre.org/technique/d3f:URLAnalysis)\n\nMessage Analysis\n\nSender MTA Reputation\n\n[D3-SMRA](https://d3fend.mitre.org/technique/d3f:SenderMTAReputationAnalysis)\n\nSender Reputation\n\n[D3-SRA](https://d3fend.mitre.org/technique/d3f:SenderReputationAnalysis)\n\n\n-----\n\nOffice Product\nSpawning MSHTA\n(Existing)\n\nRegistry Keys Used\nFor Persistence\n(Existing)\n\nSchedule Task with\n[Rundll32 Command](https://github.com/splunk/security_content/blob/develop/detections/endpoint/schedule_task_with_rundll32_command_trigger.yml)\nTrigger (Existing)\n\n\n[T1566.001](https://attack.mitre.org/techniques/T1566/001/) Initial Access Detects\nsuspicious\nmshta child\nprocess of\nMS office\napplication\n\n\n[T1547.001](https://attack.mitre.org/techniques/T1547/001/) Persistence,\nPrivilege\nEscalation\n\n[T1053](https://attack.mitre.org/techniques/T1053/) Execution,\nPersistence,\nPrivilege\nEscalation\n\n\nDetects\nmodifications\nto registry\nkeys that\ncan be used\n\nto launch\nan\napplication\nor service at\nsystem\nstartup\n\nDetects\nsuspicious\nscheduled\ntask with\nrundll32\ncommand\n\n\nDetect:\n\nFile Analysis\n\n[D3-DA](https://d3fend.mitre.org/technique/d3f:DynamicAnalysis)\n\nIdentifier Analysis\n\n[D3-HD](https://d3fend.mitre.org/technique/d3f:HomoglyphDetection)\n\nURL Analysis\n\n[D3-UA](https://d3fend.mitre.org/technique/d3f:URLAnalysis)\n\nMessage Analysis\n\nSender MTA Reputation\n\n[D3-SMRA](https://d3fend.mitre.org/technique/d3f:SenderMTAReputationAnalysis)\n\nSender Reputation\n\n[D3-SRA](https://d3fend.mitre.org/technique/d3f:SenderReputationAnalysis)\n\nN/A\n\nDetect\n\n[D3-OSM](https://d3fend.mitre.org/technique/d3f:OperatingSystemMonitoring)\n\nOS Monitoring\n\n[D3-SJA](https://d3fend.mitre.org/technique/d3f:ScheduledJobAnalysis)\n\nScheduled Job Analysis\n\n[D3-OSM](https://d3fend.mitre.org/technique/d3f:SystemFileAnalysis)\n\nOperating System\nMonitoring\n\n\n-----\n\nWinEvent Scheduled\n[Task Created Within](https://github.com/splunk/security_content/blob/develop/detections/endpoint/winevent_scheduled_task_created_within_public_path.yml)\nPublic Path (Existing)\n\nSuspicious Regsvr32\n[Register Suspicious](https://github.com/splunk/security_content/blob/develop/detections/endpoint/suspicious_regsvr32_register_suspicious_path.yml)\nPath (Existing)\n\nAccount Discovery\nWith Net App\n(Existing)\n\nNLTest Domain Trust\nDiscovery (Existing)\n\nRecon AVProduct\n[Through Pwh or](https://github.com/splunk/security_content/blob/develop/detections/endpoint/rundll32_create_remote_thread_to_a_process.yml)\nWMI(Modified)\n\nSuspicious Rundll32\nPlugininit (New)\n\n\n[T1053](https://attack.mitre.org/techniques/T1053/) Execution,\nPersistence,\nPrivilege\nEscalation\n\n[T1218.010](https://attack.mitre.org/techniques/T1218/010/) Defense\nEvasion\n\n\n[T1218.011](https://attack.mitre.org/techniques/T1218/011/) Defense\nEvasion\n\n\nDetects\nsuspicious\nscheduled\ntask created\nin a\nsuspicious\nfile path\n\nDetects\nregsvr32\nexecution\nwith\nsuspicious\nDLL file path\n\n\n[T1087.002](https://attack.mitre.org/techniques/T1087/002/) Discovery detects a\npotential\naccount\ndiscovery\nthrough a\nseries of\ncommands.\n\n[T1482](https://attack.mitre.org/techniques/T1482/) Discovery Detects\nexecution of\n`nltest.exe`\nwith\nsuspicious\nparameter\n\n[T1592](https://attack.mitre.org/techniques/T1592/) Reconnaissance Detects\ncommand to\ngather AV\nproduct info\n\n\nDetects\nPluginInit\nparameter of\nRundll32\nprocess\n\n\nDetect\n\n[D3-OSM](https://d3fend.mitre.org/technique/d3f:OperatingSystemMonitoring)\n\nOS Monitoring\n\n[D3-SJA](https://d3fend.mitre.org/technique/d3f:ScheduledJobAnalysis)\n\nScheduled Job Analysis\n\n[D3-OSM](https://d3fend.mitre.org/technique/d3f:SystemFileAnalysis)\n\nOperating System\nMonitoring\n\nDetect:\n\nDynamic Analysis\n\n[D3-FAPA](https://d3fend.mitre.org/technique/d3f:FileAccessPatternAnalysis)\n\nFile Access Pattern\n\n[D3-PSA](https://d3fend.mitre.org/technique/d3f:ProcessSpawnAnalysis)\n\nProcess Spawn Analysis\n\nN/A\n\nN/A\n\nN/A\n\nN/A\n\n\n-----\n\nSuspicious IcedID\nRundll32 Cmdline\n(New)\n\n[Rundll32 DNSQuery](https://github.com/splunk/security_content/blob/develop/detections/endpoint/rundll32_dnsquery.yml)\n(New)\n\nRundll32 Process\nCreating Exe Dll Files\n(New)\n\nSuspicious IcedID\nRegsvr32 Cmdline\n(New)\n\nRundll32\n[CreateRemoteThread](https://github.com/splunk/security_content/blob/develop/detections/endpoint/rundll32_createremotethread_in_browser.yml)\nIn Browser (New)\n\nOffice Application\n[Spawn Regsvr32](https://github.com/splunk/security_content/blob/develop/detections/endpoint/office_application_spawn_regsvr32_process.yml)\nprocess (new)\n\n\n[T1218.011](https://attack.mitre.org/techniques/T1218/011/) Defense\nEvasion\n\n[T1218.011](https://attack.mitre.org/techniques/T1218/011/) Defense\nEvasion\n\n[T1218.011](https://attack.mitre.org/techniques/T1218/011/) Defense\nEvasion\n\n[T1218.010](https://attack.mitre.org/techniques/T1218/010/) Defense\nEvasion\n\n[T1055](https://attack.mitre.org/techniques/T1055/) Defense\nEvasion,\nPrivilege\nEscalation\n\n\n[T1566.001](https://attack.mitre.org/techniques/T1566/001/) Initial Access Detects\nsuspicious\nregsvr32\nchild process\nof office\napplication\n\n\nDetects\nknown\nIcedID\nrundll32\nparameter.\n\nDetects DNS\nquery from\nrundll32\nprocess\n\nDetects\nrundll32\nprocess\ndropping\nexecutable\nfiles\n\nDetects\nregsvr32\nprocess with\nknown “-s”\nparameter\n\nDetects\nProcess\nInjection to a\nbrowser from\nrundll32\nprocess\n\n\nN/A\n\nN/A\n\nN/A\n\nN/A\n\nN/A\n\nDetect:\n\nFile Analysis\n\n[D3-DA](https://d3fend.mitre.org/technique/d3f:DynamicAnalysis)\n\nIdentifier Analysis\n\n[D3-HD](https://d3fend.mitre.org/technique/d3f:HomoglyphDetection)\n\nURL Analysis\n\n[D3-UA](https://d3fend.mitre.org/technique/d3f:URLAnalysis)\n\nMessage Analysis\n\nSender MTA Reputation\n\n[D3-SMRA](https://d3fend.mitre.org/technique/d3f:SenderMTAReputationAnalysis)\n\nSender\n\n\n-----\n\nRundll32 Create\n[Remote Thread To A](https://github.com/splunk/security_content/blob/develop/detections/endpoint/rundll32_create_remote_thread_to_a_process.yml)\nProcess (New)\n\nCHCP Command\nExecution (New)\n\nCreate Remote\n[Thread In Shell](https://github.com/splunk/security_content/blob/develop/detections/endpoint/create_remote_thread_in_shell_application.yml)\nApplication (New)\n\nDrop IcedID License\ndat (New)\n\nIcedID Exfiltrated\n[Archived File](https://github.com/splunk/security_content/blob/develop/detections/endpoint/icedid_exfiltrated_archived_file_creation.yml)\nCreation (New)\n\nSqlite Module In\nTemp Folder (New)\n\n## Hashes\n\n\n[T1055](https://attack.mitre.org/techniques/T1055/) Defense\nEvasion,\nPrivilege\nEscalation\n\n\nDetects\nprocess\nInjection\nmade by\nrundll32\n\n\n[T1059](https://attack.mitre.org/techniques/T1059/) Execution Detects\nchcp.com\nexecution\n\n\n[T1055](https://attack.mitre.org/techniques/T1055/) Defense\nEvasion,\nPrivilege\nEscalation\n\n\nDetects\nProcess\nInjection in\nShell\nApplication\n\n\n[T1204.002](https://attack.mitre.org/techniques/T1204/002/) Execution Detects\nsuspicious\nlicense.dat\nfile creation\n\n[T1560.001](https://attack.mitre.org/techniques/T1560/001/) Collection Detects\ncreation of\narchived files\nrelated to\nIcedID data\ncollection\n\n[T1005](https://attack.mitre.org/techniques/T1005/) Collection Detects the\ncreation of\nsqlite\nmodule in\n%temp%\nfolder\n\n\nN/A\n\nDetect\n\n[D3-SEA](https://d3fend.mitre.org/technique/d3f:ScriptExecutionAnalysis)\n\nScript Execution Analysis\n\nN/A\n\nDetect:\n\nFile Analysis\n\n[D3-DA](https://d3fend.mitre.org/technique/d3f:DynamicAnalysis)\n\nIdentifier Analysis\n\n[D3-HD](https://d3fend.mitre.org/technique/d3f:HomoglyphDetection)\n\nDetect:\n\nFile Content Rules\n\n[D3-FCR](https://d3fend.mitre.org/technique/d3f:FileContentRules)\n\nFile Hashing\n\n[D3-FH](https://d3fend.mitre.org/technique/d3f:FileHashing)\n\nN/A\n\n\n-----\n\nFile Sha1\n\nTetoomdu64.dll [787447B91095E8BB4F696A69C4B7CBAAF302E8C1](https://www.virustotal.com/gui/file/3ed5d0476d1ce4fd325666072983d295609fe94c5b65d5db47a53f462ac7a4dc/detection)\n\nlicense.dat [ECA410DD57AF16227220E08067C1895C258EB92B](https://www.virustotal.com/gui/file/29d2a8344bd725d7a8b43cc77a82b3db57a5226ce792ac4b37e7f73ec468510e/detection)\n\nXls macro [334E6FFE01A015195C8E63932035684F2537881C](https://www.virustotal.com/gui/file/5eac3e85bfd9da7181a488e33875ddc3479c021fcbeab807bef7bc9da107113a/detection)\n\ndocBorderWin.jpg [C0FC382E3B2811EFCA738BD4EEB00C5A5D9AD82A](https://www.virustotal.com/gui/file/9b6b3b62f816d3b9a63f20ba92006ce20d103adc67c564d4ea780069404656d6/detection)\n\nHta loader [8DCB6C08799EEB06AC4CF2B38A59DBA107D1E24F](https://www.virustotal.com/gui/file/f2853a980ec905710695b3d5e3a6c38ace906f7dcd12b4cb35cbeb621afe3b26/details)\n\nsadl.dll [D44DE47328467E3832F3AE0ADF4E68649A8BE0D2](https://www.virustotal.com/gui/file/05b881b5b349aac2548857ca4f32f94f7211a601d0236f99752cc7e8df1f9668/details)\n\n## Contributors\n\nWe would like to thank the following for their contributions to this post: Teoderick Contreras and Rod\nSoto.\n\nPosted by\n\n**[Splunk Threat Research Team](https://www.splunk.com/en_us/blog/author/secmrkt-research.html)**\n\nThe Splunk Threat Research Team is an active part of a customer’s overall defense strategy by\nenhancing Splunk security offerings with verified research and security content such as use cases,\ndetection searches, and playbooks. We help security teams around the globe strengthen operations\nby providing tactical guidance and insights to detect, investigate and respond against the latest\n\n\n-----\n\nthreats. The Splunk Threat Research Team focuses on understanding how threats, actors, and\nvulnerabilities work, and the team replicates attacks which are stored as datasets in the Attack Data\nrepository.\n\nOur goal is to provide security teams with research they can leverage in their day to day operations\nand to become the industry standard for SIEM detections. We are a team of industry-recognized\nexperts who are encouraged to improve the security industry by sharing our work with the\ncommunity via conference talks, open-sourcing projects, and writing white papers or blogs. You will\nalso find us presenting our research at conferences such as Defcon, Blackhat, RSA, and many\nmore.\n\n[Read more Splunk Security Content.](https://github.com/splunk/security_content)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-11-04 - Detecting IcedID... Could It Be A Trickbot Copycat-.pdf"
    ],
    "report_names": [
        "2021-11-04 - Detecting IcedID... Could It Be A Trickbot Copycat-.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535959,
    "ts_updated_at": 1743041137,
    "ts_creation_date": 1653779836,
    "ts_modification_date": 1653779836,
    "files": {
        "pdf": "https://archive.orkl.eu/8c8bd604ac8304ba7f481f462b11b64902d7b8e4.pdf",
        "text": "https://archive.orkl.eu/8c8bd604ac8304ba7f481f462b11b64902d7b8e4.txt",
        "img": "https://archive.orkl.eu/8c8bd604ac8304ba7f481f462b11b64902d7b8e4.jpg"
    }
}