{
    "id": "e61f1a6d-933a-45fa-ad56-ad8df2eddb05",
    "created_at": "2023-01-12T15:04:24.451946Z",
    "updated_at": "2025-03-27T02:06:13.385084Z",
    "deleted_at": null,
    "sha1_hash": "9ba0e60ac711c0008c9c9d80fe2d73f470fab8db",
    "title": "2021-07-28 - Stylish Magento Card Stealer loads Without Script Tags",
    "authors": "",
    "file_creation_date": "2022-05-28T15:42:41Z",
    "file_modification_date": "2022-05-28T15:42:41Z",
    "file_size": 742138,
    "plain_text": "# Sucuri Blog\n\n**[blog.sucuri.net/2021/07/stylish-magento-card-stealer-loads-without-script-tags.html](https://blog.sucuri.net/2021/07/stylish-magento-card-stealer-loads-without-script-tags.html)**\n\nBen Martin July 28, 2021\n\nRecently one of our analysts, Weston H., found a very interesting credit card stealer in a\nMagento environment which loads a malicious JavaScript without using any script tags. In\nthis post I will go over how it was found, how to decode it and how it works!\n\nOne of our clients was reporting that one of their website visitors was receiving a warning\nfrom their antivirus program when navigating to their checkout page:\n\n\n-----\n\n[Calls were being made to a known malicious domain that was already blacklisted by multiple](https://labs.sucuri.net/blacklist/info/?domain=siteanalitic.space)\nvendors for distributing malware and involvement in carding attacks:\n\nThis certainly indicated that a card stealer was present somewhere on our client’s website.\n\n## Credit Card Stealer in a Magento Website\n\nIn a previous [post I outlined the different types of card stealers that can infect ecommerce](https://blog.sucuri.net/2021/06/credit-card-theft-types-of-swipers.html)\nwebsites. PHP, being a server side programming language, cannot be seen directly by\nantivirus programs so this infection must be JavaScript and visible to the browser.\n\nOur first step in locating such an infection is to query the database for the following string:\n```\n<script\n\n```\n\n-----\n\nHere s an example of why we look for such strings in the database:\n\nTo load JavaScript in the visitor’s browser the attackers usually need to start and end their\ninjection with these tags, and often inject them into the “miscellaneous scripts” or “widgets”\nsection of the admin panel.\n\nWhile there were plenty of <script tags in our client’s database none of them seemed\nmalicious.\n\nNext was to check the checkout page. Once we loaded an item into the cart and navigated to\nthe checkout we could see the JavaScript loading from that blocklisted domain but it was\nnowhere to be seen in the source code. Even searching for a common carding function such\nas atob( that attackers use to base64 encode their payloads returned nothing. So now what?\n\nUpon a manual review of the source of the checkout page my colleague noticed this\nJavaScript:\n\n\n-----\n\nAt first glance it looks like some sort of obfuscated JavaScript related to animation, which\nisn’t all that uncommon to see and often looks malicious when it’s really quite benign.\nHowever, upon closer inspection we uncovered that this was actually the payload of the\ninfection.\n\n## De-Obfuscating Malicious JavaScript\n\nLet’s take apart this code and see what lies behind the obfuscation shall we? First of all, let’s\nclean up this code so that it’s not all in one big chunk so we can better understand what we\nare looking at:\n\nThe malware can be broken down into three main parts:\n\nObfuscated payload\nDecryption function\nExecution and decryption call\n\nIn most injections that we see like this we can simply remove the ‘,’ concatenation and run it\nthrough a base64 decoder but this injection was more complicated and actually required us\nto manually log the individual functions.\n\nOnce we break down each individual function we can utilise the console.log feature of the\nbrowser development console in a sandbox environment like so to de-obfuscate the\ninjection:\n\n\n-----\n\nThe “checkout” function is a dead giveaway here and we can see that it is appending\nJavaScript from the known carding domain pictured above:\n\nSecurity researchers have uncovered roughly 60 carding domains related to these attackers,\nincluding some of the following:\n\n\n-----\n\n```\nblockanalist[.]space \nanaliticsblock[.]space\nanaliticsblock[.]site\nanalistnetwork[.]space\nanalistnetwork[.]site\nsiteanalitics[.]space\nsiteanalitic[.]space\nsite-analitics[.]site\nsite-analitic[.]space\nsite-analitic[.]site\n\n```\nThey are likely registering more as you read this article.\n\n## Conclusion\n\nAttackers are always thinking up new ways to hide and obfuscate their malware. This\nexample showed a creative use of animation CSS styles and the onanimationstart event\nhandler. It allowed the attackers to avoid the use of simple <script tags, which is the first\nthing that us security analysts check when searching for a javascript injection in Magento\nenvironments. This isn’t the first time we have seen such a sneaky credit card swiper and it\ncertainly won’t be the last.\n\nIf you are an ecommerce website owner I would highly recommend following the steps I laid\n[out in a recent post with respect to securing your website environment, specially the](https://blog.sucuri.net/2021/06/credit-card-theft-types-of-swipers.html)\nadministration panel which is where a lot of these attacks originate. We can also help protect\nyour ecommerce website from attacks and hacks.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-07-28 - Stylish Magento Card Stealer loads Without Script Tags.pdf"
    ],
    "report_names": [
        "2021-07-28 - Stylish Magento Card Stealer loads Without Script Tags.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535864,
    "ts_updated_at": 1743041173,
    "ts_creation_date": 1653752561,
    "ts_modification_date": 1653752561,
    "files": {
        "pdf": "https://archive.orkl.eu/9ba0e60ac711c0008c9c9d80fe2d73f470fab8db.pdf",
        "text": "https://archive.orkl.eu/9ba0e60ac711c0008c9c9d80fe2d73f470fab8db.txt",
        "img": "https://archive.orkl.eu/9ba0e60ac711c0008c9c9d80fe2d73f470fab8db.jpg"
    }
}