{
    "id": "07586a75-2250-47d3-8ead-e031c46fe2af",
    "created_at": "2023-01-12T15:10:32.338999Z",
    "updated_at": "2025-03-27T02:14:13.694657Z",
    "deleted_at": null,
    "sha1_hash": "d527a7c52991a4c9e203f4f10dbb451218059ca5",
    "title": "2022-05-03 - Analysis of BlackByte Ransomware's Go-Based Variants",
    "authors": "",
    "file_creation_date": "2022-05-29T01:11:31Z",
    "file_modification_date": "2022-05-29T01:11:31Z",
    "file_size": 5427587,
    "plain_text": "# Analyzing BlackByte Ransomware's Go-Based Variants\n\n**[zscaler.com/blogs/security-research/analysis-blackbyte-ransomwares-go-based-variants](https://www.zscaler.com/blogs/security-research/analysis-blackbyte-ransomwares-go-based-variants)**\n\n## Key Points\n\nBlackByte is a full-featured ransomware family that first emerged around July 2021\nThe ransomware was originally written in C# and later redeveloped in the Go programming language around September 2021\nThe threat group exfiltrates data prior to deploying ransomware and leaks the stolen information if a ransom is not paid\nThe group has demanded multi-million dollar ransoms from some victims\nBlackByte ransomware employs various anti-analysis techniques including a multitude of dynamic string obfuscation algorithms\nIn early versions of the ransomware, file encryption utilized a hardcoded 1,024-bit RSA public key along with a 128-bit AES key\nthat was derived from a file retrieved from a command and control server\nMore recent BlackByte versions use Curve25519 Elliptic Curve Cryptography (ECC) for asymmetric encryption and ChaCha20\nfor symmetric file encryption\n\n## Introduction\n\n_BlackByte is a Ransomware-as-a-Service (RaaS) group that has been targeting corporations worldwide since July 2021. Previous_\nversions of the ransomware were written in C#. More recently, the authors redeveloped the ransomware using the Go programming\n[language. The BlackByte Go variant was used in attacks described in an FBI advisory that warned BlackByte had compromised](https://www.ic3.gov/Media/News/2022/220211.pdf)\nnumerous businesses, including entities in US critical infrastructure sectors. In this post, Zscaler ThreatLabz analyzes two variants of\nthe Go-based implementation of BlackByte ransomware.\n\n## Technical Analysis\n\n Variants\n\nThreatLabz has identified two variants of the Go-based variant of BlackByte. The first variant was seen in-the-wild around September\n2021 and shares many similarities with the C# version including the commands executed to perform lateral propagation, privilege\nescalation, and file encryption algorithms. A more recent Go-based variant was introduced around February 2022. This new variant\nintroduced many additional features and updated the file encryption algorithms. In this blog, for brevity, the Go-based BlackByte\nvariant 1 will be referred to as BlackByte v1 and the second variant will be referred to as BlackByte v2.\n\n## Initialization\n\nBefore BlackByte performs file encryption, the ransomware first performs initialization. Most of these initialization functions are very\nsimilar or identical to the C# variant of BlackByte.\n\n### Mutex Creation\n\n\n-----\n\nBlackByte creates a mutex using a value that is hardcoded in the malware, for example: Global\\7b55551e a59c 4252 a34a\n_5c80372b3014. If the mutex exists, BlackByte will terminate. This ensures that there is only one active instance of BlackByte running_\nat a time.\n\n### Identify System Language\n\nBlackByte ransomware resolves the victim's system language by comparing the language ID values with those shown in Table 1. If\nthe system language matches any from this list, BlackByte will exit without performing file encryption.\n\n**Language ID** **Language**\n\n1049 Russian\n\n1058 Ukrainian\n\n1059 Belarusian\n\n1064 Tajik\n\n1067 Armenian\n\n1068 Azerbaijani Latin\n\n1079 Georgian\n\n1087 Kazakh\n\n1090 Turkmen\n\n1091 Uzbek Latin\n\n2092 Azerbaijani Cyrillic\n\n2115 Uzbek Cyrillic\n\nTable 1. System languages avoided by BlackByte ransomware\n\nThese languages are specifically avoided by BlackByte to prevent encrypting files on systems that are located in Commonwealth of\nIndependent States (CIS) countries. This likely indicates that the threat actors behind BlackByte are located in Eastern Europe and/or\nRussia. This is designed to reduce the threat that local law enforcement in those regions will pursue criminal prosecution against\nthose responsible for BlackByte.\n\n### Enable Long Paths\n\nThe malware executes the following command to avoid issues that may occur when encrypting files with long path names:\n```\nC:\\WINDOWS\\system32\\cmd.exe /c reg add HKLM\\SYSTEM\\CurrentControlSet\\Control\\FileSystem /v LongPathsEnabled /t REG_DWORD /d\n1 /f\n\n### Disable Controlled Folder Access\n\n```\nBlackByte executes the following command to disable controlled folder access:\n```\nSet-MpPreference -EnableControlledFolderAccess Disabled\n\n```\nThe Windows controlled folder access feature is designed to protect data from malicious applications such as ransomware. When\nenabled, files located in the specified protected folders can not be modified by unauthorized applications.\n\n### Delete Shadow Copies\n\n\n-----\n\nSimilar to other ransomware families, BlackByte deletes shadow copies to prevent a victim from easily recovering files from backups.\nThere are two methods that BlackByte uses to delete shadow copies. The first executes the following PowerShell command:\n```\n$x = [System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String('RwBlAHQALQBXAG0AaQBPAGIAagBlAGMAdAAg'+\n'AFcAaQBuADMAMgBfAFMAaABhAGQAbwB3AGMAbwBwAHkAIAB8AC'+'AARgBvAHIARQBhAGMAaAAtAE8AYgBqAGUAYwB0ACAAewAkA'+\n'F8ALgBEAGUAbABlAHQAZQAoACkAOwB9AA=='));Invoke-Expression $x\n\n```\nThe Base64 encoding string when decoded is the following: Get-WmiObject Win32_Shadowcopy | ForEach-Object {$_.Delete();}\n\nBlackByte also executes the commands to delete shadow copies for each drive:\n```\nC:\\WINDOWS\\system32\\cmd.exe /c vssadmin resize shadowstorage /for=<unit>: /on=<unit>: /maxsize=401MB\nC:\\WINDOWS\\system32\\cmd.exe /c vssadmin resize shadowstorage /for=<unit>: /on=<unit>: /maxsize=unbounded\n\n### Process Termination and Stop / Start Services\n\n```\nThe following commands are executed by BlackByte to stop services that may hinder file encryption:\n```\nC:\\WINDOWS\\system32\\sc.exe config SQLTELEMETRY start= disabled\nC:\\WINDOWS\\system32\\sc.exe config SQLTELEMETRY$ECWDB2 start= disabled\nC:\\WINDOWS\\system32\\sc.exe config SQLWriter start= disabled\nC:\\WINDOWS\\system32\\sc.exe config SstpSvc start= disabled\nC:\\WINDOWS\\system32\\sc.exe config MBAMService start= disabled\nC:\\WINDOWS\\system32\\sc.exe config wuauserv start= disabled\n\n```\nBlackByte will also start the following services:\n```\nC:\\WINDOWS\\system32\\sc.exe config Dnscache start= auto\nC:\\WINDOWS\\system32\\sc.exe config fdPHost start= auto\nC:\\WINDOWS\\system32\\sc.exe config FDResPub start= auto\nC:\\WINDOWS\\system32\\sc.exe config SSDPSRV start= auto\nC:\\WINDOWS\\system32\\sc.exe config upnphost start= auto\nC:\\WINDOWS\\system32\\sc.exe config RemoteRegistry start= auto\n\n```\nBlackByte ransomware terminates the following processes shown in Table 2 at the beginning of the execution:\n\nuranium processhacker procmon pestudio procmon64\n\nx32dbg x64dbg cffexplorer procexp64 procexp\n\npslist tcpview tcpvcon dbgview rammap\n\nrammap64 vmmap ollydbg autoruns autorunsc\n\nregmon idaq idaq64 immunitydebugger wireshark\n\ndumpcap hookexplorer importrec petools lordpe\n\nsysinspector proc_analyzer sysanalyzer sniff_hit windbg\n\njoeboxcontrol joeboxserver joeboxserver resourcehacker fiddler\n\nhttpdebugger dumpit rammap rammap64 vmmap\n\nagntsvc cntaosmgr dbeng50 dbsnmp encsvc\n\nexcel firefox firefoxconfig infopath isqlplussvc\n\nmbamtray msaccess msftesql mspub mydesktopqos\n\nmydesktopservice mysqld mysqld-nt mysqld-opt Ntrtscan\n\nocautoupds ocomm ocssd onenote oracle\n\noutlook PccNTMon powerpnt sqbcoreservice sql\n\nsqlagent sqlbrowser sqlservr sqlwriter steam\n\nsynctime tbirdconfig thebat thebat64 thunderbird\n\ntmlisten visio winword wordpad xfssvccon\n\nzoolz filemon nsservice nsctrl\n\n\n-----\n\nTable 2. Process names terminated by BlackByte ransomware\n\nMany of these process names are related to business applications. BlackByte kills these processes to avoid open file handle\npermission issues when performing file encryption of the victim's files. In addition, the list contains a large number of malware analyst\ntools that can be used to reverse engineer the functionality of the ransomware.\n\nBlackByte also terminates the following services that are associated with antivirus products, backup software, and business\napplications including financial software, email clients, and databases as shown below in Table 3.\n\nklvssbridge64 vapiendpoint ShMonitor Smcinst SmcService\n\nSntpService svcGenericHost swi_ TmCCSF tmlisten\n\nTrueKey TrueKeyScheduler TrueKeyServiceHelper WRSVC McTaskManager\n\nOracleClientCache80 mfefire wbengine mfemms RESvc\n\nmfevtp sacsvr SAVAdminService SAVService SepMasterService\n\nPDVFSService ESHASRV SDRSVC FA_Scheduler KAVFS\n\nKAVFSGT kavfsslp klnagent macmnsvc masvc\n\nMBAMService MBEndpointAgent McShield audioendpointbuilder Antivirus\n\nAVP DCAgent bedbg EhttpSrv MMS\n\nekrn EPSecurityService EPUpdateService ntrtscan EsgShKernel\n\n\nmsexchangeadtopology AcrSch2Svc MSOLAP$TPSAMA Intel(R) PROSet\nMonitoring\n\n\nmsexchangeimap4\n\n\nARSM unistoresvc_1af40a ReportServer$TPS MSOLAP$SYSTEM_BGC W3Svc\n\nMSExchangeSRS ReportServer$TPSAMA Zoolz 2 Service MSOLAP$TPS aphidmonitorservice\n\n\nSstpSvc MSExchangeMTA ReportServer$SYSTEM_BGC Symantec System\nRecovery\n\n\nUI0Detect\n\n\nMSExchangeSA MSExchangeIS ReportServer MsDtsServer110 POP3Svc\n\nMSExchangeMGMT SMTPSvc MsDtsServer IisAdmin MSExchangeES\n\n\nEraserSvc11710 Enterprise Client\nService\n\n\nMsDtsServer100 NetMsmqActivator stc_raw_agent\n\n\nVSNAPVSS PDVFSService AcrSch2Svc Acronis CASAD2DWebSvc\n\nCAARCUpdateSvc McAfee avpsus DLPAgentService mfewc\n\nBMR Boot Service DefWatch ccEvtMgr ccSetMgr SavRoam\n\nRTVscan QBFCService QBIDPService Intuit.QuickBooks.FCS QBCFMonitorService\n\nYooIT zhudongfangyu nsService veeam backup\n\nsql memtas vss sophos svc$\n\nmepocs wuauserv\n\nTable 3. Service names terminated by BlackByte ransomware\n\n### Windows Firewall\n\nBlackByte disables the Windows firewall via the command:\n```\nnetsh advfirewall set allprofiles state off\n\n### Windows Defender\n\n```\n\n-----\n\nThe ransomware executes the following command to delete task manager, resource monitor, and stop the Windows Defender service:\n\n**cmd /c del C:\\Windows\\System32\\Taskmgr.exe /f /q & del C:\\Windows\\System32\\resmon.exe /f /q &**\n**powershell -command \"$x = [System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String**\n**('V'+'wBp'+'A'+'G4AR'+'AB'+'lAG'+'YAZQBuAGQA'));Stop-Service -Name $x;Set-Service -StartupType Disabled**\n\nThe Base64 encoded string above decodes to WinDefend.\n\n### Raccine Anti-Ransomware\n\nBlackByte terminates and uninstalls an anti-ransomware product known as Raccine. The Raccine processes that are terminated\nare raccine.exe and raccinesettings.exe. To uninstall Raccine, BlackByte deletes the following registry keys and values:\n\n**HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\Raccine Tray**\n**HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\EventLog\\Application\\Raccine**\n**HKEY_CURRENT_USER\\SOFTWARE\\Raccine**\n**HKEY_LOCAL_MACHINE\\SOFTWARE\\Raccine**\n\nBlackByte then deletes Raccine's scheduled task via the command:\n```\nC:\\WINDOWS\\system32\\schtasks.exe /DELETE /TN \"\\\"Raccine Rules Updater\\\"\" /F\n\n### Privilege Escalation\n\n```\nThe ransomware executes the following commands to disable UAC remote restrictions:\n```\nC:\\WINDOWS\\system32\\cmd.exe /c reg add HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System /v\nLocalAccountTokenFilterPolicy /t REG_DWORD /d 1 /f\n\n```\nBlackByte sets the EnableLinkedConnections registry value to force symbolic links to be written to link logon sessions as follows:\n```\nC:\\WINDOWS\\system32\\cmd.exe /c reg add HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System /v\nEnableLinkedConnections /t REG_DWORD /d 1 /f\n\n```\n[In BlackByte v2, an additional privilege escalation method was added that exploits the CMSTPLUA COM interface to bypass UAC.](https://gist.github.com/api0cradle/d4aaef39db0d845627d819b2b6b30512)\nThe ShellExec method of the interface ICMLuaUtil can be invoked with arbitrary commands with elevated privileges using the\nElevationMoniker Elevation:Administrator!new:{3E5FC7F9-9A51-4367-9063-A120244FBEC7}. This allows BlackByte v2 to\nexecute the svchost.exe process that it injects into with elevated privileges. This privilege escalation technique has also been utilized\nby other [ransomware groups including REvil and LockBit.](https://news.sophos.com/en-us/2020/04/24/lockbit-ransomware-borrows-tricks-to-keep-up-with-revil-and-maze/)\n\n## Lateral Propagation\n\nBlackByte ransomware performs network enumeration and can propagate across a local network. First it executes the following\ncommands to enable network discovery and file and printer sharing:\n```\nC:\\WINDOWS\\system32\\cmd.exe /c netsh advfirewall firewall set rule \"group=\\\"Network Discovery\\\"\" new enable=Yes\nC:\\WINDOWS\\system32\\cmd.exe /c netsh advfirewall firewall set rule \"group=\\\"File and Printer Sharing\\\"\" new enable=Yes\n\n```\nThe following commands are then executed to discover other computers and network file shares:\n```\nnet view\narp -a\n\n```\nBlackByte loads the Active Directory module RSAT-AD-PowerShell and queries for other computers via the following commands:\n```\nC:\\WINDOWS\\System32\\WindowsPowerShell\\v1.0\\powershell.exe Install-WindowsFeature -Name \\\"RSAT-AD-PowerShell\\\" â€“\nIncludeAllSubFeature\npowershell -command \"Import-Module ActiveDirectory;Get-ADComputer -Filter * -Properties * | FT Name\"\n\n```\nIf the -a flag is passed via the command-line, BlackByte attempts to copy itself to remote computer's public folders via the\nadministrative share \\\\<remote_computer_name>\\c$\\Users\\Public\\<filename.exe>. If that attempt is unsuccessful, BlackByte will\ndefault to the path: \\\\<remote_computer_name>\\Users\\Public\\<filename.exe>. BlackByte uses the Windows task scheduler to execute\nthe ransomware on the remote host using the following command:\n```\nC:\\Windows\\system32\\schtasks.exe /Create /S <remote_computername> /TN <taskname> /TR \"C:\\Users\\Public\\<filename> -s\n<passphrase>\" /ru SYSTEM /sc onlogon /RL HIGHEST /f\n\n```\n\n-----\n\nIn BlackByte v2, the filename and task name are pseudorandomly generated using a function that produces eight upper and\nlowercase alphabetic and numeric characters (e.g., BqgDOVYL.exe and KYL8EpE9, respectively). BlackByte v1 uses a hardcoded\nfilename and command-line argument complex.exe -single and the hardcoded task name asd.\n\nAfter scheduling the task, the remote BlackByte binary is executed using the command:\n```\nC:\\Windows\\system32\\schtasks.exe /S <remote_computername> /Run /TN <taskname>\n\n```\nAfter the task is executed, BlackByte deletes the remote task using the command:\n```\nC:\\Windows\\system32\\schtasks.exe /Delete /S <remote_computername> /TN <taskname> /f\n\n```\nBlackByte then deletes the copy of itself on the remote host network share. BlackByte also attempts to access administrative shares\nA$ through Z$ and the folders shown in Table 4.\n\nUsers Backup Veeam Consejo homes\n\nhome media common Storage Server Public\n\nWeb Images Downloads BackupData ActiveBackupForBusiness\n\nBackups NAS-DC DCBACKUP DirectorFiles share\n\nTable 4. Network shares targeted by BlackByte ransomware\n\n### Check for Analysis Tools\n\nThe malware checks the following DLL modules in memory shown in Table 5 and exits if they are present:\n\n**DLL Filename** **Description**\n\nDBGHELP.DLL Windows DbgHelp Library\n\nSbieDll.dll Sandboxie\n\nSxIn.dll Qihu 360 Total Security\n\nSf2.dll Avast Antivirus\n\nsnxhk.dll Avast Antivirus\n\ncmdvrt32.dll COMODO Internet Security\n\nTable 5. DLLs Identified by BlackByte ransomware\n\n### Disable Debugging\n\nBlackByte attempts to prevent debugging tools from monitoring and attaching to various processes by removing the following registry\nvalues under SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options:\n\nvssadmin.exe\nwbadmin.exe\nbcdedit.exe\npowershell.exe\ndiskshadow.exe\nnet.exe\ntaskkill.exe\nwmic.exe\nfsutil.exe\n\n### Process Injection\n\nBlackByte v1 injects the ransomware code in an instance of regedit.exe, while BlackByte v2 injects itself into an instance of\n_svchost.exe. After the process is injected with the ransomware code, the file encryption is then performed in the context of the_\n_regedit.exe or svchost.exe process. BlackByte then deletes its original binary on disk by executing the command:_\n```\nC:\\Windows\\system32\\cmd.exe /c ping 1.1.1.1 -n 10 > Nul & Del <blackbyte_filepath.exe> /F /Q\n\n```\n\n-----\n\nThe ping command is used to delay the file deletion by 10 seconds. The process injection functionality may be able to bypass some\nsecurity software detections.\n\n### Unmount Virtual Machine Images\n\nIn order to identify virtual machines on the victim's system, BlackByte will execute the command:\n```\npowershell Get-VM\n\n```\nIf any virtual machine files are located, BlackByte will attempt to unmount the image by executing the following command line:\n```\npowershell.exe Dismount-DiskImage -ImagePath <filename.vhd>\n\n### Backup Volumes\n\n```\nThe malware executes mountvol.exe to try to mount additional volumes:\n```\nC:\\WINDOWS\\system32\\mountvol.exe A: \\\\?\\Volume{[GUID]}\\\nC:\\WINDOWS\\system32\\mountvol.exe B: \\\\?\\Volume{[GUID]}\\\nC:\\WINDOWS\\system32\\mountvol.exe E: \\\\?\\Volume{[GUID]}\\\nC:\\WINDOWS\\system32\\mountvol.exe F: \\\\?\\Volume{[GUID]}\\\n\n```\nThis is likely an attempt to mount and encrypt backup volumes to further prevent file recovery after encryption.\n\n## File Encryption\n\nBlackByte enumerates all physical drives and network shares skipping files that contain the following substrings in Table 6:\n\nblackbyte ntdetect.com bootnxt ntldr recycle.bin\n\nbootmgr thumbs.db ntuser.dat bootsect.bak autoexec.bat\n\niconcache.db bootfont.bin\n\nTable 6. BlackByte ransomware file substring filter list\n\nBlackByte avoids the following extensions shown in Table 7.\n\nurl msilog log ldf lock\n\ntheme msi sys wpx cpl\n\nadv msc scr key ico\n\ndll hta deskthemepack nomedia msu\n\nrtp msp idx ani 386\n\ndiagcfg bin mod ics com\n\nhlp spl nls cab exe\n\ndiagpkg icl ocx rom prf\n\nthemepack msstyles icns mpa drv\n\ncur diagcab cmd shs\n\nTable 7. File extensions skipped by BlackByte ransomware\n\nBlackByte will also skip files located in the following directories shown in Table 8.\n\nbitdefender trend micro avast software intel common files\n\nprogramdata windowsapps appdata mozilla application data\n\ngoogle windows.old system volume information program files (x86) boot\n\ntor browser windows intel perflogs msocache\n\nTable 8 Directories whitelisted by BlackByte ransomware\n\n\n-----\n\nBlackByte optimizes encryption speed based on the targeted file size according to the following rules:\n\n**Filesize** **Encryption Algorithm**\n\nSize <= 5MB Encrypt the entire file\n\n15MB >= Size > 5MB Encrypt the first 1MB and last 1MB\n\n150MB >= Size > 15MB Encrypt the first 5MB and last 5MB\n\nSize > 150MB Encrypt the first 50MB and last 50MB\n\nBlackByte renames encrypted files with the extension .blackbyte. The ransomware creates a DefaultIcon registry key under\n_HKEY_CLASSES_ROOT\\.blackbyte that points to an icon file, so that every file that is encrypted will show this icon in Windows_\nexplorer. In addition, the registry names s1159 and s2359 are set to BLACKBYTE under HKEY_CURRENT_USER\\Control\n_Panel\\International. These registry values control the time format for AM/PM. As a result, Windows will show BLACKBYTE instead of_\nAM/PM as shown below in Figure 2.\n\nFigure 2. BlackByte AM/PM time format modification\n\nThis time format modification is performed by executing the commands:\n```\nreg add \"HKCU\\Control Panel\\International\" /v s1159 /t REG_SZ /d BLACKBYTE /f\nreg add \"HKCU\\Control Panel\\International\" /v s2359 /t REG_SZ /d BLACKBYTE /f\n\n### File Encryption Algorithms (Variant 1)\n\n```\nBlackByte v1 must be executed with the command line argument -single followed by a SHA256 hash. This hash is combined with a\nTOR onion URL (e.g., [hxxp://7oukjxwkbnwyg7cekudzp66okrchbuubde2j3h6fkpis6izywoj2eqad[.]onion/). The SHA256 hash given as](http://10.10.0.46/hxxp://7oukjxwkbnwyg7cekudzp66okrchbuubde2j3h6fkpis6izywoj2eqad.%5Donion/)\nan argument is concatenated to the onion URL to build the URL of the victim ransom portal that is embedded in the ransom note. This\nURL is substituted in the [LINK] field of the ransom note template.\n\nWhen BlackByte v1 is executed, the malware tries to connect to a hardcoded URL that hosts a file that is involved in the construction\nof an AES key that is used to encrypt a victim's files. An example URL used for this purpose\nwas [hxxps://185.93.6[.]31/mountain.png. The mechanism used to build the AES key is very similar to the C# variant.](http://10.10.0.46/hxxps://185.93.6.31/mountain.%5Dpng)\n\nAfter the content of the file mountain.png is downloaded, BlackByte reads the first 16 bytes of the file into a buffer and 24 bytes at the\n[offset 0x410 of the file into another buffer. These 24 bytes are used as key to create and initialize a NewTripleDESCipher object from](https://github.com/golang/go/blob/master/src/crypto/des/cipher.go)\nthe Go Cryptographic API. This object is used to decrypt the first 16 bytes of the file mountain.png. The resulting 16-byte buffer will be\nused as a PBKDF2 password to derive the AES key that will be used to encrypt the victim's files. The BlackByte PBKDF2 algorithm\nuses SHA1 as the hashing function and 1,000 iterations to derive the AES key. The password is converted to unicode and the unicode\nstring BLACKBYTE_IS_COOL is used as the salt. The following example Python code can be used to derive the AES key used for file\nencryption.\n\n\n-----\n\nFigure 3. Python code to decrypt BlackByte v1 files with the file (e.g., mountain.png) downloaded from the C2 server\n\nVictim's files are encrypted with AES using CBC mode. The first 16 bytes of the PBKDF2 derived key are used as AES key, and the\nsame 16 bytes are used as the initialization vector (IV). The same AES key is used to encrypt all the files on a victim's machine.\n\nThe PBKDF2 password is encrypted with a hardcoded 1,024-bit RSA public key and the resulting RSA-encrypted value is encoded\nwith Base64. This Base64 encoded string is substituted in the [KEY] field in the ransom note template. The threat actor can decrypt\nthe PBKDF2 password with their corresponding RSA private key, derive the AES key, and thereafter, decrypt the victim's encrypted\nfiles. The following is an example RSA public key that was hardcoded in BlackByte:\n```\n -----BEGIN PUBLIC KEY---- MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDUBwECQuQiVGorPYvHrJM\n 11OWV\n E1PS8gaBqIAfPaR1rQHUEXu3iX/da/dCtV8Z27/SIA/ZYUNhTyUsX9Snjz8\n zve90\n QAiG1c/BS81WWRax7M7i1rESStVwOaUDAj5w6cz9GwDMGYI+wve9Qyjtw5R\n 6hr5I\n qlIEig1Wy1X27vUC2wIDAQAB\n -----END PUBLIC KEY----\n### Ransom Note and BlackByte Icon (Variant 1)\n\n```\nThe BlackByte ransom note and an image containing an icon file are stored as Base64 encoded strings in the binary. After the\nencryption of the victim's files, the ransom note is written to a file named BlackByteRestore.txt, and the previously mentioned icon file\nis written to a file named BB.ico. An example BlackByte v1 ransom note template is shown below in Figure 4. The BlackByte logo\n[uses the extended ASCII characters of the 8-bit code page 437 to create 3-D block letters.](https://en.wikipedia.org/wiki/Code_page_437)\n\n\n-----\n\nFigure 4. Go-based BlackByte v1 ransom note template\n\n### File Encryption Algorithms (Variant 2)\n\nThe second variant of BlackByte ransomware does not require a network connection to start encryption. In addition, the ransomware's\ncommand-line parameters were modified. BlackByte v2 requires two command line parameters:\n```\nsample.exe <flags> <passphrase>\n\n```\nThe first parameter is a flag (e.g., -a) that controls specific behaviors of the ransomware (e.g., to propagate across a network), while\nthe second parameter is a passphrase (e.g., 54726956) that is verified before file encryption commences. If BlackByte is not provided\nwith any command-line arguments, the ransomware prints out the phrase BlackByte ransomware, 8-th generation, the most\n_destructive of all ransomware products, real natural disaster. and exits._\n\nBlackByte v2 removed the RSA and AES file encryption algorithms from the ransomware. The encryption algorithms were replaced\nwith Curve25519 elliptic curve cryptography for asymmetric encryption and ChaCha for symmetric algorithm. The Curve25519\n[functions are statically compiled within BlackByte using Go library code. BlackByte generates a random 32-byte buffer per file using](https://cs.opensource.google/go/x/crypto/+/7b82a4e9:curve25519/curve25519.go)\nthe Windows API function RtlGenRandom(). This random value is used as a file's secret key. The file's public key is calculated as\nfollows:\n\nfile_public_key = Curve25519(file_secret_key, base_point = 0x9)\n\nThe threat actor's Curve25519 public key is hardcoded in the binary and stored as a Base64 encoded string. For the sample with the\nSHA256 hash ffc4d94a26ea7bcf48baffd96d33d3c3d53df1bb2c59567f6d04e02e7e2e5aaa, the hardcoded Curve25519 public key was\nthe string:\n\n**2BSTzcpdqRW/a2DRT3TiL9lN5INRmmn1lCQWzZhkfQs=**\n(d81493cdca5da915bf6b60d14f74e22fd94de483519a69f5942416cd98647d0b)\n\nThe shared secret is derived as follows:\n\nshared_secret = Curve25519(file_secret_key, blackbyte_public_key)\n\nThe shared secret is hashed with SHA256 to derive a 32-byte ChaCha encryption key. The ChaCha encryption key is then hashed\nagain with SHA256 to derive the ChaCha nonce (using 12 bytes starting at offset 10). Once the ChaCha key parameters have been\nderived, they will be used to encrypt the file's content. The encrypted data is written to the file (overwriting the original content). Finally,\nthe victim's 32-byte public key is concatenated to the encrypted content of the file. The BlackByte v2 encryption algorithm is shown\nbelow in Figure 5.\n\n\n-----\n\nFigure 5. BlackByte v2 file encryption algorithm\n\nThe threat actor can use the file's public key together with the threat actor's secret key to recover the shared secret and use it to\ndecrypt the encrypted data as follows:\n\nshared_secret = Curve25519(blackbyte_secret_key, file_public_key)\n\nThe following Python code in Figure 6 can be used to decrypt BlackByte encrypted data from a file that has been encrypted if the\nthreat actor's private key is obtained:\n\n\n-----\n\nFigure 6. Python code to decrypt BlackByte v2 files with the threat actor s private key\n\nBlackByte v2 also encrypts the filename after encryption. The encryption is a simple XOR layer with a hardcoded key, followed by\nBase64 encoding as shown in Figure 7.\n\nFigure 7. BlackByte v2 filename encryption\n\nIn the analyzed sample, the XOR key was fuckyou123. After a filename has been encrypted, the file is renamed and the .blackbyte\nextension is concatenated.\n\n### Ransom Note and BlackByte Icon (Variant 2)\n\nBlackByte v2 introduced some improvements to storing the ransom note and icon file. The Base64 encoded blocks for the ransom\nnote and icon file added an XOR-based encryption layer. The XOR key to decrypt the ransom note and icon file is embedded in the\nransomware as an obfuscated string. The icon file is written to the victim's %APPDATA% directory using a randomly generated\nfilename consisting of six upper and lowercase alphabetic and numeric characters (e.g., i2uOJh.ico).\n\nBlackByte v2 contains a hardcoded TOR onion URL and path for the victim portal rather than relying on the command-line for the path\nvalue. BlackByte v2 also added a hardcoded password that is required to access the victim ransom portal. An example password is:\n```\ngkaW_#DD[[email protected]@{bx5pHFA)T5FpMYJC]f|@\n\n```\nThe BlackByte v2 ransom note template is shown below in Figure 8. The [LINK] substring in the ransom note is replaced with the\nhardcoded BlackByte victim URL and the [PASSW] substring is replaced with the victim-specific password for the ransom portal.\n\n\n-----\n\nFigure 8. BlackByte v2 ransom note template\n\nAn example ransom note when populated after file encryption has been performed for BlackByte v2 is shown in Figure 9.\n\nFigure 9. BlackByte v2 ransom note\n\nAfter BlackByte encrypts files, the ransom note is written to each directory, the encrypted files are renamed, and their icons are\nreplaced by the BlackByte icon.\n\n\n-----\n\n## Ransom Portal and Leak Site\n\nWhen a victim accesses the link in the ransom portal, they are instructed to enter the access key from the ransom note as shown in\nFigure 10.\n\nFigure 10. BlackByte victim ransom portal\n\nAfter a victim authenticates, they are provided the ransom demand and instructions how to purchase Bitcoin. There is also a live chat\nfeature as shown in Figure 11.\n\n\n-----\n\nFigure 11. BlackByte ransom negotiation portal\n\nVictims are further pressured to pay the ransom, or risk having their data publicly leaked on their TOR hidden service as shown in\nFigure 12.\n\nFigure 12. BlackByte victim leak site\n\n\n-----\n\n## Print Bombing\n\nIn addition to dropping a ransom note on the victim's machine, the ransomware sends a message to be printed by any connected\nprinters. The printed ransom message is an RTF file with the content shown below:\n```\n {\\rtf1\\ansi\\ansicpg1251\\deff0\\nouicompat\\deflang1049{\\fonttbl{\\f0\\fnil\\fcharset0\n Calibri;}}\n {\\*\\generator Riched20 10.0.19041}\\viewkind4\\uc1 \n \\pard\\sa200\\sl276\\slmult1\\qc\\f0\\fs56\\lang9 Your HACKED by BlackByte team.\\par\n Connect us to restore your system.\\fs22\\par\n \\fs56 Your HACKED by BlackByte team.\\par\n Connect us to restore your system.\\fs22\\par\n \\fs56 Your HACKED by BlackByte team.\\par\n Connect us to restore your system.\\fs22\\par\n \\fs56 Your HACKED by BlackByte team.\\par\n Connect us to restore your system.\\fs22\\par\n \\fs56 Your HACKED by BlackByte team.\\par\n Connect us to restore your system.\\fs22\\par\n \\fs56 Your HACKED by BlackByte team.\\par\n Connect us to restore your system.\\fs22\\par\n \\pard\\sa200\\sl276\\slmult1\\par\n }\n\n```\nIn BlackByte v1, the message is written to the file C:\\Users\\tree.dll and the following command is executed to print it:\n```\nC:\\\\Windows\\\\System32\\\\cmd.exe /c for /l %x in (1,1,75) do start wordpad.exe /p C:\\\\Users\\\\tree.dll\n\n```\nIn addition, a task named Task is created to print the message every hour:\n```\nC:\\WINDOWS\\system32\\schtasks.exe /create /np /sc HOURLY /tn Task /tr \"C:\\Windows\\System32\\cmd.exe \n/c for /l %x in (1,1,75) do start wordpad.exe /p C:\\Users\\tree.dll\" /st 07:00\n\n```\nIn BlackByte v2, the text of the message is written to a file with a random name consisting of six upper and lowercase alphabetic and\nnumeric characters. The task name is also created randomly consisting of eight upper and lowercase alphabetic and numeric\ncharacters. An example task command to print the ransom message is shown below:\n```\nC:\\WINDOWS\\system32\\schtasks.exe /create /np /sc HOURLY /tn 4y77VPNo /tr \"C:\\Windows\\System32\\cmd.exe \n/c for /l %x in (1,1,75) do start %SystemDrive%\\Program Files\\Windows NT\\Accessories\\WordPad.exe /p \nC:\\Users\\1HoWkK.dll\" /st 07:00\n\n## Anti-Analysis / Anti-Forensics Techniques\n\n### String Obfuscation\n\n```\n[Both Go-based BlackByte variants encrypt most strings using a tool similar to AdvObfuscator. Each string is decrypted using a unique](https://github.com/andrivet/ADVobfuscator)\nalgorithm with polymorphic code that implements different operations xor, addition, subtraction, etc. In the examples below, the\nencrypted strings in Figure 13 are built and decrypted from arguments on the stack.\n\n\n-----\n\nFigure 13. BlackByte string obfuscation examples\n\n### Modified UPX Packer\n\n[In addition to string obfuscation, BlackByte samples are typically packed with UPX. In BlackByte v1, all of the samples observed by](https://upx.github.io/)\nThreatLabz were packed with the standard UPX packer and could be unpacked via the command-line parameter -d. The early\nsamples of BlackByte v2 were also packed with the standard UPX packer. However, the most recent BlackByte samples (since March\n2022) are packed with a modified version of UPX. The names of the sections have been renamed from UPX0 and UPX1 to BB0 and\n_BB1, respectively. Figure 14 shows an example BlackByte v2 sample with the modified UPX headers._\n\n\n-----\n\nFigure 14. BlackByte v2 altered UPX header\n\n## Antivirus Detection\n\nDue to BlackByte's anti-analysis features, polymorphic code, and heavy obfuscation many antivirus products have very low detection\nrates. For example, the BlackByte sample with the\nSHA256 534f5fbb7669803812781e43c30083e9197d03f97f0d860ae7d9a59c0484ace4 has an antivirus detection rate of 4/61 at the\ntime of publication.\n\n## Conclusion\n\nBlackByte is a full-featured ransomware family operated by a threat group that continues to breach organizations and demand large\nransom amounts. The threat group also performs double extortion attacks by stealing an organization's files and leaking them online if\nthe ransom is not paid. The ransomware code itself is regularly updated to fix bugs, bypass security software, and hinder malware\nanalysis. The encryption algorithms have also been improved to be more secure and prevent file recovery. This demonstrates that the\nthreat group will likely continue to improve the ransomware and remain a significant threat to organizations.\n\n## Cloud Sandbox Detection\n\n\n-----\n\nZscaler's multilayered cloud security platform detects indicators at various levels, as shown below:\n\n[Win64.Ransom.Blackbyte](https://threatlibrary.zscaler.com/threats/10f1df8d-e747-4990-9ca5-742135bc1f3b)\n\n## Indicators of Compromise\n\nIoC Type Value\n\nBlackByte v1 Packed Sample 1df11bc19aa52b623bdf15380e3fded56d8eb6fb7b53a2240779864b1a6474ad\n\nBlackByte v1 Packed Sample 388163c9ec1458c779849db891e17efb16a941ca598c4c3ac3a50a77086beb69\n\nBlackByte v1 Unpacked Sample 44a5e78fce5455579123af23665262b10165ac710a9f7538b764af76d7771550\n\nBlackByte v1 Unpacked Sample 6f36a4a1364cfb063a0463d9e1287248700ccf1e0d8e280e034b02cf3db3c442\n\nBlackByte v2 Packed Sample ffc4d94a26ea7bcf48baffd96d33d3c3d53df1bb2c59567f6d04e02e7e2e5aaa\n\nBlackByte v2 Packed Sample 9103194d32a15ea9e8ede1c81960a5ba5d21213de55df52a6dac409f2e58bcfe\n\nBlackByte v2 Packed Sample e434ec347a8ea1f0712561bccf0153468a943e16d2cd792fbc72720bd0a8002e\n\nBlackByte v1 Onion URL hxxp://7oukjxwkbnwyg7cekudzp66okrchbuubde2j3h6fkpis6izywoj2eqad.]onion\n\nBlackByte v2 Onion URL hxxp://fyk4jl7jk6viteakzzrxntgzecnz4v6wxaefmbmtmcnscsl3tnwix6yd.]onion\n\nBlackByte v2 Onion URL hxxp://p5quu5ujzzswxv4nxyuhgg3fjj2vy2a3zmtcowalkip2temdfadanlyd.]onion\n\nBlackByte v1 AES Key Seed URL hxxps://185.93.6[.]31/mountain.png\n\n## References\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-05-03 - Analysis of BlackByte Ransomware's Go-Based Variants.pdf"
    ],
    "report_names": [
        "2022-05-03 - Analysis of BlackByte Ransomware's Go-Based Variants.pdf"
    ],
    "threat_actors": [
        {
            "id": "4e453d66-9ecd-47d9-b63a-32fa5450f071",
            "created_at": "2024-06-19T02:03:08.077075Z",
            "updated_at": "2025-03-27T02:05:17.381141Z",
            "deleted_at": null,
            "main_name": "GOLD LOTUS",
            "aliases": [
                "Hecamede ",
                "BlackByte"
            ],
            "source_name": "Secureworks:GOLD LOTUS",
            "tools": [
                " Cobalt Strike",
                " ExByte",
                " MEGA",
                " RDP",
                " SoftPerfect Network Scanner",
                "BlackByte"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673536232,
    "ts_updated_at": 1743041653,
    "ts_creation_date": 1653786691,
    "ts_modification_date": 1653786691,
    "files": {
        "pdf": "https://archive.orkl.eu/d527a7c52991a4c9e203f4f10dbb451218059ca5.pdf",
        "text": "https://archive.orkl.eu/d527a7c52991a4c9e203f4f10dbb451218059ca5.txt",
        "img": "https://archive.orkl.eu/d527a7c52991a4c9e203f4f10dbb451218059ca5.jpg"
    }
}