{
    "id": "9f86863d-6402-442f-9a67-2c7c832e30b7",
    "created_at": "2023-01-12T15:02:07.764956Z",
    "updated_at": "2025-03-27T02:06:09.745111Z",
    "deleted_at": null,
    "sha1_hash": "6c179d7873b78b95d7951e1ba5060e6eb2d618e6",
    "title": "2022-04-11 - Analysis of the SunnyDay ransomware",
    "authors": "",
    "file_creation_date": "2022-05-28T21:49:01Z",
    "file_modification_date": "2022-05-28T21:49:01Z",
    "file_size": 3626542,
    "plain_text": "# Analysis of the SunnyDay ransomware\n\n**[seguranca-informatica.pt/analysis-of-the-sunnyday-ransomware/](https://seguranca-informatica.pt/analysis-of-the-sunnyday-ransomware/)**\n\n**Analysis of the SunnyDay ransomware.**\n\n## Introduction\n\n\nApril 11, 2022\n\n\nWe recently came across a sample of the SunnyDay ransomware. As no significant\ninformation is available on this ransomware, we decided to write about its inner workings and\ntechnical details. As expected, we found some similarities between other ransomware\nsamples such as Ever101, Medusa Locker, Curator, and Payment45. Although it has very\nsimilar features to the mentioned ransomware samples, we are not able to make any\nattribution to its threat group.\n\nSunnyDay is a simple piece of ransomware based on the SALSA20 stream cipher. It comes\nwith an RSA public key blob embedded to encrypt a generated key used by the symmetric\nSALSA20 that will damage all the available files on the machine. One of the reasons\ncriminals are using SALSA20 is because it offers speeds of around 4‚Äì14 cycles per byte in\n_software on modern x86 processors and reasonable hardware performance_ [(Wikipedia).](https://en.wikipedia.org/wiki/Salsa20)\n\nThe main actions executed by SunnyDay during its execution are:\n\n**Deletes shadow copies (VSS)**\n**Terminates and stops target processes and services**\n**Generates a key to encrypt files by using SALSA20 stream cipher**\n**The key is also encrypted with the RSA public key blob and appended at**\n**the end of the encrypted files**\n**The extension ‚Äú.sunnyday‚Äù is appended (name.extension.sunnyday) to the**\n**damaged files**\n**It also contains a self-removing feature**\n\n## Technical details of Sunnyday ransomware\n\n\n-----\n\n**Name: 7862d6e083c5792c40a6a570c1d3824ddab12cebc902ea965393fe057b717c0a.exe**\n**MD5: de6717493246599d8702e7d1fd6914aab5bd015d**\n**Sample:** [Bazaar.abuse.ch](https://bazaar.abuse.ch/sample/7862d6e083c5792c40a6a570c1d3824ddab12cebc902ea965393fe057b717c0a/)\n\nSunnyDay sample is distributed in a form of a 64-bit binary and with the release date of\n**Mar 07 05:47:03 2022 (UTC). According to the sample signatures, it was compiled and**\nlinked with Microsoft Visual C++ via Visual Studio 2019 ‚Äì 16.2.0 preview 4.\n\n**_Figure 1: SunnyDay release date, signature, and tooling details._**\n\nAt the first glance, SunnyDay appears to use typical libraries found on popular ransomware\nsamples. As observed in Figure 2, calls related to Windows CryptoAPI were found; a\nWindows library commonly found in several ransomware families these days. From this view,\nthe ransomware seems using calls from wininet.dll to perform some communication to its C2;\nsomething that will be scrutinized towards the end of the analysis.\n\n\n-----\n\n**_Figure 2: Windows libraries used by SunnyDay ransomware._**\n\nTaking a look at the entropy of the binary, there is no obfuscation in place. Some\nransomware families are not using significant features related to code obfuscation and\nbypassing virtual machines and sandbox environments. In fact, this point moves\nstraightforwardly to its genesis: the principle of causing total destruction in all types of\nsystems and infrastructures not wasting time with useless things.\n\n\n-----\n\n**_Figure 3: Sunnyday binary entropy confirming that it is not packed._**\n\n## Deleted shadow files\n\nOnce running, the ransomware deletes all the shadow files on the machine by using the\n_vssadmin.exe Windows utility._\n```\nProcess created: C:\\Windows\\System32\\vssadmin.exe vssadmin delete shadows /all /quiet\n\n```\nWith this technique in place, it ensures that victims will not recover the damaged File System\nby using shadow copies ‚Äì a common process also used by other ransomware families.\n\n## Stoped services\n\n\n-----\n\nSunnyDay ransomware has hardcoded a list of target services that it tries to stop during its\nexecution. The following image shows it is trying to stop the ‚Äúvmickvexchange‚Äù service via\n[‚ÄúControlService()‚Äù call with the param ‚ÄúSERVICE_STOP‚Äú.](https://docs.microsoft.com/en-us/windows/win32/api/winsvc/nf-winsvc-controlservice)\n\n**_Figure 4: Block of code responsible of stoping a list of target processes._**\n\nThe list of target processes hardcoded inside the binary is presented below.\n\n\n-----\n\n**_Figure 5: Hardcoded services observed in SunnyDay ransomware._**\n\n## Terminated processes\n\nA list of target processes can also be found on the ransomware binary file. As can be seen,\nthe ransomware obtains the double-linked list of processes via\n[‚ÄúCreateToolhel32Snapshot()‚Äú and compares each process with the hardcoded ones. If it](https://docs.microsoft.com/en-us/windows/win32/api/tlhelp32/nf-tlhelp32-createtoolhelp32snapshot)\n[matches, the process is terminated via ‚ÄúTerminateProcess()‚Äù call. In addition, the tree of](https://docs.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess)\n[processes is iterated by using the ‚ÄúProcess32NextW()‚Äù Windows call.](https://docs.microsoft.com/en-us/windows/win32/api/tlhelp32/nf-tlhelp32-process32nextw)\n\n\n-----\n\n**_Figure 6: Block of code responsible of terminate target processes. The process_**\n_‚Äúsvchost.exe‚Äù (right side) is one of the processes present in the snapshot and tested against_\n_the hardcoded strings._\n\nThe complete list of target processes is presented below.\n\n**_Figure 7: Full list of target processes found inside the SunnyDay sample._**\n\n## Skipped file extensions and folders\n\nSome file extensions and folders are bypassed during the ransomware encryption process.\nSome important directories are not damaged during the data encryption process, which may\nallow victims to recover some files in those directories. Also, some popular file extensions\nare untouchable, which can be an advantage for the victims‚Äô side.\n\n\n-----\n\n**_Figure 8: Folders and file extensions skipped during the data encryption process._**\n\n## Data encryption process\n\n[SunnyDay takes advantage of Windows APIs (CryptoAPI) to carry out the encryption](https://docs.microsoft.com/en-us/windows/win32/seccrypto/cryptoapi-system-architecture)\n[process. The ransomware carried a unique RSA public blob (CSP) 2048-bit key and uses](https://docs.microsoft.com/en-us/windows/win32/seccrypto/rsa-schannel-key-blobs)\n[some API calls to extract the blob key to encrypt the Salsa20 key to encode the entire](https://pt.wikipedia.org/wiki/Salsa20)\nvictim‚Äôs files.\n\nSome functions from CryptoAPI are used during this process, namely:\n\n**[CryptAcquireContextW(): The CryptAcquireContext function is used to](https://docs.microsoft.com/en-us/windows/win32/api/wincrypt/nf-wincrypt-cryptacquirecontexta)**\nacquire a handle to a particular key container within a particular cryptographic\nservice provider (CSP).\n**[CryptImportKey(): The CryptImportKey function transfers a cryptographic key](https://docs.microsoft.com/en-us/windows/win32/api/wincrypt/nf-wincrypt-cryptimportkey)**\nfrom a key BLOB into a cryptographic service provider (CSP).\n**[CryptEncrypt(): The CryptEncrypt function encrypts data.](https://docs.microsoft.com/en-us/windows/win32/api/wincrypt/nf-wincrypt-cryptencrypt)**\n**[CryptDestroyKey(): The CryptDestroyKey function releases the handle](https://docs.microsoft.com/en-us/windows/win32/api/wincrypt/nf-wincrypt-cryptdestroykey)**\nreferenced by the hKey parameter.\n**[CryptReleaseContext(): The CryptReleaseContext function releases the](https://docs.microsoft.com/en-us/windows/win32/api/wincrypt/nf-wincrypt-cryptreleasecontext)**\nhandle of a cryptographic service provider (CSP) and a key container.\n\nIn sum, these calls are utilized to extract the public key blob from a qword on the data\nsection and encrypt a newly generated key used by the SALSA20 stream cipher to encode\nall the target files.\n\nThe details associated with the RSA blob can be observed below. The AlgID\n[‚ÄúCALG_RSA_KEYX‚Äù was used, and it is a 2048-bit key with the Public Exponent: 65537 in](https://docs.microsoft.com/en-us/windows/win32/seccrypto/alg-id)\ndecimal.\n\n\n-----\n\n**_Figure 9: Details about the RSA public key blob hardcoded inside the SunnyDay_**\n_ransomware sample._\n\nThe public key is CALG_RSA_KEYX and is hardcoded inside the SunnyDay ransomware\nsample. This is an important detail about this malware as this blob is imported via the\n**CrypImportKey** **API call and it will be used to encrypt the key used by SALSA20 to encode**\nthe victim‚Äôs files. The original RSA public key is present below as well.\n\n**_Figure 10: RSA blob exported to PEM format._**\n\n### Digging into the Public Key Blob Format\n\nPublic key blobs (type PUBLICKEYBLOB) are used to store RSA public keys. They have\nthe following format:\n```\nBLOBHEADER blobheader;\nRSAPUBKEY rsapubkey;\nBYTE modulus[rsapubkey.bitlen/8];\n\n```\nNotice that PUBLICKEYBLOBs are not encrypted, but contain public keys in plaintext form.\n\n\n-----\n\nThe RSAPUBKEY structure contains information specific to the particular public key\ncontained in the key blob. It is defined as follows:\n```\ntypedef struct _RSAPUBKEY {\nDWORD magic;\nDWORD bitlen;\nDWORD pubexp;\n} RSAPUBKEY;\n\n```\nThe following table describes each of the fields in the RSAPUBKEY structure.\n\nThe public key modulus data is located directly after the RSAPUBKEY structure. The size of\nthis data will vary depending on the size of the public key. The number of bytes can be\ndetermined by dividing the value of RSAPUBKEY‚Äòs bitlen field by 8.\n\n**Field** **Description**\n\n**magic** This must always be set to 0x31415352. Notice that this is just an ASCII\nencoding of ‚ÄúRSA1.‚Äù\n\n**bitlen** Number of bits in the modulus. In practice, this must always be a multiple of 8.\n\n**pubexp** The public exponent.\n\nOn the other hand, the SALSA20 stream cipher can be easily identified based on string\n[constant and fixed rotation values. Within this context, criminals used the CryptoPP library](https://www.cryptopp.com/)\nin order to implement the SALSA20 algorithm in C++; a copy of it was performed by its\nauthor as expected.\n\nThese details can be confirmed in the reverse engineering process as presented below.\n\n\n-----\n\n**_Figure 11: Details about CryptoPP library and SALSA20 symmetric cipher._**\n\nAs mentioned above, SALSA20 is easy to recognize, as it uses well-known values for its\ninternal cryptographic operations.\n\n**_Figure 12: Symmetric SALSA20 stream cipher detection._**\n\n\n-----\n\nBelow, some of the SALSA20 values found on the SunnyDay samples can be found in the\n**CryptoPP library.**\n\n\n-----\n\n-----\n\n**_Figure 13: SALSA20 stream cipher details._**\n\nThis ransomware uses a single SALSA20 key to encrypt all the files on a specific\n**[machine. The key is generated via CryptoGenRandom() call and next it is encrypted with](https://docs.microsoft.com/en-us/windows/win32/api/wincrypt/nf-wincrypt-cryptgenrandom)**\nthe RSA 2048-bit key present on the ransomware samples. Finally, the SALSA20 key\n**with 512 bytes is appended at the end of the encrypted files.**\n\n**_Figure 14: Encrypted files with the added nonce and SALSA20 key (512 bytes) encrypted_**\n_with the RSA 2048-bit key._\n\n## The ransomware note\n\nThe ransomware note called ‚Äú!-Recovery_Instructions-!.txt‚Äù file is dropped in each folder\nwith the instructions to recover the damaged files.\n\n**_Figure 15: SunnyDay ransomware note._**\n\n\n-----\n\nAs can be seen, the compromised machines are identified with a randomly generated ID\npresent at the end of the ransomware note file, along with two email addresses.\n```\n[email protected]\n[email protected]\n\n```\nAfter the first contact with threat actors, a quick response from an ‚ÄúOutlook‚Äù address is\nreceived with additional steps, including the total amount to pay in Bitcoin and the wallet\naddress.\n\n**_Figure 16: Additional details including the total to pay in Bitcoin ($160.000) and wallet_**\n_address (1HSFsP9i6zcNgyx7p84UHzDUfC8k5axUrx)._\n\nAs observed below, no transactions are observed on the specific wallet addressed.\n\n**_Figure 17: Bitcoin wallet addressed by criminals._**\n\n## TOR / C2 communication\n\nA link to download a specific TOR browser version was found during the ransomware\nanalysis. Also, a stream of data with some details about the infected machine was observed,\npotentially to notify criminals about new infections.\n```\n- %s|DELIMITER|Name(domain): %s(%s)\\r\\nCPU: %S\\r\\nRAM: %d\\r\\nDisks count: %d\\r\\nFiles\ncount: %d|DELIMITER|\nTor: https://dist.torproject.org/torbrowser/8.5.3/torwin32-0.3.5.8.zip\n\n```\n\n-----\n\n**_Figure 18: Information collected during the ransomware execution._**\n\nAs observed, a lot of information is collected during the ransomware execution, namely:\n\n**machine name**\n**domain**\n**total RAM**\n**total of physical volumes**\n**total of encrypted files**\n**number of CPUs**\n\nThis data is then grouped into a large string that would be sent to a removed server\npresumably hosted over the TOR network. Nonetheless, no hardcoded URLs and .onion\naddresses were observed.\n\nWe believe the C2 server potentially could be available over the TOR network because the\nprocess of downloading and opening the TOR was identified. More details can be observed\nbelow.\n\n\n-----\n\n**_Figure 19: TOR browser hardcoded URL and the execution process after downloading the_**\n_.zip file into the Temp folder._\n\nIn addition, the hardcoded version of the TOR browser is 8.5.3 (8.x), is not available to\ndownload on the official TOR browser webpage as observed below.\n\n\n-----\n\n**_Figure 20: Tor browser version 11x. (April 2022)._**\n\nThe version of Tor Browser 8.5.3 is dated from June 2019 and so we believe that it could be\na lot of junk and unused resources that come from another variant of this ransomware. This\ncan be a clear sign of cooperation between threat groups.\n\n## Self-removing feature\n\nWhen the data encryption process terminates, the malware removes itself from the disk.\n\n**_Figure 21: Self-removing feature identified on the SunnyDay ransomware._**\n\n\n-----\n\nWith this mechanism in place, no artifacts on disk are left, preventing, thus, the binaries can\nbe shared on online sandboxes and automatically submitted by AV/EDRs.\n\n## Similarities between samples\n\nAs observed on a Twitter presented below, SunnyDay seems to follow the same pattern seen\nin other samples of this nature. It looks like a new variant of the Ever101 malware, active\n[since 2021 and also reported by Security Joes last year.](https://shared-public-reports.s3.eu-west-1.amazonaws.com/Secrets_behind_the_mysterious_ever101_ransomware.pdf)\n\n[#Ransomware](https://twitter.com/hashtag/Ransomware?src=hash&ref_src=twsrc%5Etfw)\n\nEA504E669073D9E506FB403E633A68C8\n\nExt: .ever101\n\n[Note: !=READMY=!.txt@BleepinComputer](https://twitter.com/BleepinComputer?ref_src=twsrc%5Etfw) [@demonslay335](https://twitter.com/demonslay335?ref_src=twsrc%5Etfw) [@Amigo_A_](https://twitter.com/Amigo_A_?ref_src=twsrc%5Etfw) [@siri_urz](https://twitter.com/siri_urz?ref_src=twsrc%5Etfw)\n[@malwrhunterteam](https://twitter.com/malwrhunterteam?ref_src=twsrc%5Etfw) [@JAMESWT_MHT](https://twitter.com/JAMESWT_MHT?ref_src=twsrc%5Etfw) [pic.twitter.com/OxQMYWQ5Bs](https://t.co/OxQMYWQ5Bs)\n\n[‚Äî dnwls0719 (@fbgwls245) May 21, 2021](https://twitter.com/fbgwls245/status/1395653548818325510?ref_src=twsrc%5Etfw)\n\nWe believe that SunnyDay can be a new variant or development of the next ransomware\nsamples based on its code analysis and ransomware note structure:\n\n## Final Thoughts\n\nSunnyDay is a new development from other ransomware families and it is able of encrypting\na target machine in a few minutes. This piece of malware takes advantage of the CryptoPP\nlibrary to use the SALSA20 stream cipher during the encryption process and, thus, speed up\nthe entire operation.\n\nBy using a hardcoded public RSA blob that comes with the initial binary, it encrypts a random\nSALSA20 key and appends it at the end of each encrypted file. This blob of 512 bytes is\naccessed during the decryption process by the decryption tool that will use a private key to\ndecrypt the SALSA20 key and then recover the original files.\n\n### Thank you to all who have contributedüòâ\n\n## Indicators of Compromise (IoC)\n```\nName: 7862d6e083c5792c40a6a570c1d3824ddab12cebc902ea965393fe057b717c0a.exe\nMD5: de6717493246599d8702e7d1fd6914aab5bd015d\n\n Mitre Att&ck Matrix\n\n```\n\n-----\n\n## Online sandbox\n\n Yara rule\n\n[Yara rule is available on GitHub.](https://github.com/sirpedrotavares/SI-LAB-Yara_rules/blob/master/sunnyday_ransomware_april_2022)\n\n[Pedro Tavares](https://seguranca-informatica.pt/author/pipocaz/)\n**[Pedro Tavares is a professional in the field of information security working as an Ethical](https://www.linkedin.com/in/sirpedrotavares/)**\nHacker/Pentester, Malware Researcher and also a Security Evangelist. He is also a founding\nmember at CSIRT.UBI and Editor-in-Chief of the security computer blog segurancainformatica.pt.\n\nIn recent years he has invested in the field of information security, exploring and analyzing a\nwide range of topics, such as pentesting (Kali Linux), malware, exploitation, hacking, IoT and\nsecurity in Active Directory networks. He is also Freelance Writer (Infosec. Resources\n[Institute and Cyber Defense Magazine) and developer of the 0xSI_f33d ‚Äì a feed that](https://feed.seguranca-informatica.pt/)\ncompiles phishing and malware campaigns targeting Portuguese citizens.\n\n[Read more here.](https://seguranca-informatica.pt/contacto/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-04-11 - Analysis of the SunnyDay ransomware.pdf"
    ],
    "report_names": [
        "2022-04-11 - Analysis of the SunnyDay ransomware.pdf"
    ],
    "threat_actors": [
        {
            "id": "bfded1cf-be73-44f9-a391-0751c9996f9a",
            "created_at": "2022-10-25T15:50:23.337107Z",
            "updated_at": "2025-03-27T02:00:55.445946Z",
            "deleted_at": null,
            "main_name": "FIN7",
            "aliases": [
                "FIN7",
                "GOLD NIAGARA",
                "ITG14",
                "Carbon Spider",
                "ELBRUS",
                "Sangria Tempest"
            ],
            "source_name": "MITRE:FIN7",
            "tools": [
                "Mimikatz",
                "AdFind",
                "JSS Loader",
                "HALFBAKED",
                "REvil",
                "PowerSploit",
                "CrackMapExec",
                "Carbanak",
                "Pillowmint",
                "Cobalt Strike",
                "POWERSOURCE",
                "RDFSNIFFER",
                "SQLRat",
                "Lizar",
                "TEXTMATE",
                "BOOSTWRITE"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "bb8702c5-52ac-4359-8409-998a7cc3eeaf",
            "created_at": "2023-01-06T13:46:38.405479Z",
            "updated_at": "2025-03-27T02:00:02.82533Z",
            "deleted_at": null,
            "main_name": "FIN7",
            "aliases": [
                "JokerStash",
                "ATK32",
                "G0046",
                "Coreid",
                "Carbanak",
                "Sangria Tempest",
                "CARBON SPIDER",
                "GOLD NIAGARA",
                "G0008",
                "ELBRUS",
                "Carbon Spider"
            ],
            "source_name": "MISPGALAXY:FIN7",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d85adfe3-e1c3-40b0-b8bb-d1bacadc4d82",
            "created_at": "2022-10-25T16:07:23.619566Z",
            "updated_at": "2025-03-27T02:02:09.890982Z",
            "deleted_at": null,
            "main_name": "FIN7",
            "aliases": [
                "APT-C-11",
                "ATK 32",
                "Gold Niagara",
                "ITG14",
                "TAG-CR1"
            ],
            "source_name": "ETDA:FIN7",
            "tools": [
                "7Logger",
                "Agentemis",
                "Anunak",
                "Astra",
                "BIOLOAD",
                "BIRDWATCH",
                "Bateleur",
                "Boostwrite",
                "CROWVIEW",
                "Carbanak",
                "Cobalt Strike",
                "CobaltStrike",
                "DICELOADER",
                "DNSMessenger",
                "FOWLGAZE",
                "HALFBAKED",
                "JSSLoader",
                "KillACK",
                "LOADOUT",
                "Lizar",
                "Meterpreter",
                "Mimikatz",
                "POWERPLANT",
                "POWERSOURCE",
                "RDFSNIFFER",
                "SQLRAT",
                "Sekur",
                "Sekur RAT",
                "TEXTMATE",
                "Tirion",
                "VB Flash",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535727,
    "ts_updated_at": 1743041169,
    "ts_creation_date": 1653774541,
    "ts_modification_date": 1653774541,
    "files": {
        "pdf": "https://archive.orkl.eu/6c179d7873b78b95d7951e1ba5060e6eb2d618e6.pdf",
        "text": "https://archive.orkl.eu/6c179d7873b78b95d7951e1ba5060e6eb2d618e6.txt",
        "img": "https://archive.orkl.eu/6c179d7873b78b95d7951e1ba5060e6eb2d618e6.jpg"
    }
}