{
    "id": "8928b727-9ff7-4b0e-a357-2c42dbfca595",
    "created_at": "2022-10-25T16:48:23.872856Z",
    "updated_at": "2025-03-27T02:08:40.806339Z",
    "deleted_at": null,
    "sha1_hash": "29ceb2ee71d540a7f3f2a496b2e726b2779f485b",
    "title": "",
    "authors": "",
    "file_creation_date": "2015-05-27T11:27:42Z",
    "file_modification_date": "2015-05-27T11:27:42Z",
    "file_size": 597542,
    "plain_text": "# BlackEnergy 3 â€“ Exfiltration of Data in ICS\n Networks\n## Malware Report\n\n\nVersion: 1.0\n\nMay, 2015\n\nThis paper is the result of a research lead by the security researcher David Atch. The authors expect to\nmake revisions to this document after its release due to new findings that might arise.\n\n\n-----\n\n### Executive Summary\n\nAs ICS-CERT published its ICS-ALERT-14-281-01B alert, it triggered the question of the attackers'\ngoal when compromising ICS networks. In order to acquire better understanding of their\nintentions, we analyzed a series of samples related to the BlackEnergy family of malwares. The\nmost interesting sample that produced the findings in this report was BlackEnergy 3, which is\nprobably a private modification of the publicly available BlackEnergy DDOS Bot. After analyzing\nthe malware, we found clues that the attackers might be leveraging the initial infection in order\nto perform data exfiltration from the inner parts of these networks. The module that led us to\nthis conclusion has the ability of serving RPC functions to remote clients in the same network,\nwhich means it is able to send commands to the deeper ends of the same network.\n\nWhen harnessing these capabilities inside ICS environments, which might be considered isolated,\nexfiltration of valuable data can take place, allowing attackers to gain insights regarding network\nstructure and operational processes. This data is considered highly valuable when targeting such\nnetworks, and it is a necessary step before starting a large scale operation.\n\n### Introduction\n\nOn October 29, 2014, the Department of Homeland Security and its Industrial Control Systems\nCyber Emergency Response Team (ICS-CERT) issued an alert titled ICS-ALERT-14-281-01A\nOngoing Sophisticated Malware Campaign Compromising ICS. The alert detailed a _\"campaign_\n_that has compromised numerous industrial control systems (ICSs) environments using a variant_\n_of the BlackEnergy malware\". The analysis done by ICS-CERT indicates that this campaign has_\nbeen ongoing since at least 2011.\n\nThe main attack vector observed was infection of Human-Machine-Interface (HMI) machines in\nICS networks. These machines provide a user interface for interacting and controlling industrial\nnetworks. According to the alert issued by ICS-CERT, various vendors were targeted, including GE\nCIMPLICITY, Advantech/Broadwin WebAccess, and Siemens WinCC.\n\nIt is stated in the alert that ICS-CERT was not able to verify whether the attackers gained deeper\ncontrol into the ICS network. This has led us to investigate this campaign, in an effort to focus on\nthe attackers' true intention.\n\n\n-----\n\nIn our research we managed to find indicators that the attackers aim to perform data exfiltration\nfrom these networks. After studying a series of samples we managed to focus on BlackEnergy 3\n(the third generation of the BlackEnergy family of malwares), which incorporates a mechanism\nthat seems to be designed for this purpose.\n\n### Background\n\nEven though it is believed various HMI vendors were affected, we will provide a short background\nfocused on GE CIMPLICITY, since it includes the most detailed description of the probable attack\nvector.\n\nAccording to the ICS-CERT, the initial infection was of GE CIMPLICITY with direct connection to\nthe internet, by exploiting vulnerability CVE-2014-0751. This vulnerability is assumed to have\nbeen exploited since at least January 2012. This initial infection ultimately allowed the attackers\nto install a BlackEnergy malware on windows machines running GE CIMPLICITY web server.\nAnalysis performed by the ICS-CERT suggests that automated tools were used to discover and\ncompromise these vulnerable systems.\n\nThe vulnerability itself (CVE-2014-0751) allowed for the attackers to execute a malicious .cim file\n(CIMPLICITY screen file) on the HMI machine. The file is hosted on an attacker-controlled server.\nWhen the .cim file executes, it downloads the BlackEnergy installer and performs the installation.\n\nThis also means that the attack is targeted, and that companies that have been running the GE\nCIMPLICITY with direct connection to the internet since 2012, might have been infected with\nBlackEnergy.\n\n### Exfiltration of Data \n\nThe previous sections described the steps performed by the attackers in order to install and\nexecute arbitrary code on HMI machines in ICS networks. In this section we will describe the\ngeneral architecture of the mechanism we have found, which can allow the attackers to leverage\nthe infection, in order to perform data exfiltration from these networks.\n\n\n-----\n\nData exfiltration from these networks has high value as these are considered isolated networks\nperforming sensitive operations related to industrial processes. However, in various cases, these\nnetworks are not completely isolated, as the separation from the outside world is accomplished\nby using a Firewall, which denies connections to the internet. This configuration is illustrated in\nfigure 1 below.\n\n**A** **B**\n\n**A** Infected HMI with\n\nSeparated ICS network Public Internet\ninternet connectivity\n\n**Figure 1: an ICS network separated by a Firewall**\n\nWhile these Firewalls are best configured when denying internet communications, they are\nusually configured to allow the SMB protocol, as this protocol is common and is required for the\nroutinely operation of the network components.\n\nThe mechanism we have found seems to allow for data exfiltration from the separated ICS\nnetwork (component A in figure 1) in this common configuration. This is accomplished by sending\ndata from an infected host with no internet connectivity (found on the separated ICS network),\nto an infected host that _has internet connectivity (component B in figure 1. In relation to the_\nprevious section, this is the HMI machine running GE CIMPLICITY). This is performed by RPC\ncommunication of named pipes over SMB.\n\nIn the following section we will detail the RPC capabilities we have found in BlackEnergy 3, which\nseems to have been designed specifically for this purpose.\n\n\n**A**\n\nSeparated ICS network\n\n\n-----\n\n### RPC Communications Module\n\nWe have used these samples for our analysis:\n\nBlackEnergy 3 Core 73ebb173b948a04bd68c1ce8f5c1d27f54c161c3d255e990fade64d80ba87705\n\nBlackEnergy 3 si plugin \n16d68b740b5d9aa60929e39fd616d31be2c8528d0f1e58db4cbb16976f7cd725\n\nBy reverse engineering the Core module, we have found that its RPC server interface exposes 4\nfunctions, detailed in table 1 below. As mentioned in publicly known information, the si module\nand probably the whole plugin system of BlackEnergy 3 use the same RPC interface to\ncommunicate. However, the plugins do not make use of \"function_2\" and \"function_3\", and\nthese functions seem to be designed for usage by a remote plugin, as they contain information\nregarding the name of the originating host. In addition, 2 of the functions share common\nfunctionality, which indicates that one is intended to be used locally and the other remotely.\n\nfunction_0 Get Command\n\nfunction_1 Send String to Server\n\nfunction_2 Send Command Result\n\nfunction_3 Send File\n\n**Table 1: exposed RPC functions**\n\nThe usage of RPC communications in order to circumvent Firewalls is also known as a technique\nused by attackers.\n\nWhen taking all of these issues into consideration, it heavily indicates that other remote plugins\nare likely to make use of \"function_2\" and \"function_3\". This means that the aim of the authors\nof the malware in designing this interface, was to implement, or to set the ground for remote\nplugins in order to perform data exfiltration specifically in isolated networks.\n\n|function_0|Get Command|\n|---|---|\n|function_1|Send String to Server|\n|function_2|Send Command Result|\n|function_3|Send File|\n\n\n-----\n\nThe following section details the technical scope of the 4 functions mentioned in Table 1. The\nprotocol uses ncacn_np RPC communications over named pipes. The pipe name is\n\\\\Pipe\\\\{AA0EED25-4167-4CBB-BDA8-9A0F5FF93EA8} and it exposes the 4 functions.\n\n### RPC Exposed Functions\n\nThis section details the technical scope of the functions in Table 1.\n\n**function_0(name, unused, out buffer, size, empty)**\n\nPull out stored command.\n\nThe malware will store the last command after each successful connection to the server, the\ncommand must be a string separated by a [space] character, and it will be stored in an internal\nmemory array.\n\nThe RPC function iterates over this array to extract a specific command, which will be stored in\nthe buffer.\n\nThis function is used also by the si plugin.\n\n**function_1(size, string)**\n\nSend string to the server.\n\nThis RPC function will send the provided string using the default C&C mechanism (including all\nthe encryption logic).\n\nThis function is used also by the si plugin.\n\n**function_2(command, computer, result, size)**\n\nSend command results to the server.\n\nThis RPC function will send the specified command and its result to the server.\nThe data that is delivered to the server is stored in the following structure:\n\n**Command Result Structure**\n\n|d Result Structure|Col2|Col3|\n|---|---|---|\n|Field Value|Size|Description|\n|0x4|4 bytes|Type|\n|MODR|4 bytes|Response Type|\n\n\n-----\n\n|Field Value|Size|Description|\n|---|---|---|\n|0x1010000|4 bytes|Version|\n||4 bytes|Overall Structure Size|\n|COMP|4 bytes|Computer Name Field Header|\n|0x14|4 bytes|Field Size|\n||20 bytes|Computer Name|\n|CMDS|4 bytes|Field Header|\n||4 bytes|Field Size|\n|||Command|\n|RESS|4 bytes|Field Header|\n||4 bytes|Field Size|\n\n\nThe structure contains a COMP field which is probably the remote computer name. If this\nfunction would have been used only for local modules this field would have been useless.\n\nAlso this function is not used by the si module.\n\nOne thing we have noticed during the analysis of this function, that it writes the contents of the\nstructure into c:\\1\\[COMP].out, this is probably due to forgotten testing routine.\n\n**function_3(name, date, computer, size, offset, size, data)**\n\nSend a file to the server.\n\nThis RPC function takes a file name and its content and sends them to the server.\nThe data that is delivered to the server is stored in the following structure:\n\n**File Upload Structure**\n\n|ad Structure|Col2|Col3|\n|---|---|---|\n|Field Value|Size|Description|\n|0x3|4 bytes|Type|\n|FILE|4 bytes|Response Type|\n|0x1010000|4 bytes|Version|\n||4 bytes|Overall Structure Size|\n|COMP|4 bytes|Field Header|\n\n\n-----\n\n|Field Value|Size|Description|\n|---|---|---|\n|0x14|4 bytes|Field Size|\n||20 bytes|Computer Name|\n|NAME|4 bytes|Field Header|\n||4 bytes|Field Size|\n|||File Name|\n|DATE|4 bytes|Field Header|\n||4 bytes|Field Size|\n|||Date|\n|DATA|4 bytes|Field Header|\n||4 bytes|Field Size|\n|||File Contents|\n\n\nThe structure contains a COMP field which is probably the remote computer name. If this\nfunction would have been used only for local modules this field would have been useless.\n\n### Summary\n\nIn this research we set out to gain better understanding of the attackers' intentions in the\ncampaign described in ICS-ALERT-14-281-01B. The alert detailed a \"campaign that has\ncompromised numerous industrial control systems (ICSs) environments using a variant of the\nBlackEnergy malware\".\n\nIn order to accomplish this we have analyzed a series of samples related to the BlackEnergy family\nof malwares. The result of the analysis is a discovery of two RPC functions that are not being used\nby the si plugin and looks like they are meant for file and results delivery from remote machines.\nOur research has led us to the conclusion that there may be other undiscovered plugins, which\nwould be responsible for the reconnaissance and data exfiltration from the deeper parts of the\norganizational network.\n\nFinally, we would like to address the malware research community and the ICS industry with a\nwarning that there might be more undiscovered BlackEnergy components in internal networks.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2015/2015.05.27.BlackEnergy3/BlackEnergy-CyberX-Report_27_May_2015_FINAL.pdf"
    ],
    "report_names": [
        "BlackEnergy-CyberX-Report_27_May_2015_FINAL"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716503,
    "ts_updated_at": 1743041320,
    "ts_creation_date": 1432726062,
    "ts_modification_date": 1432726062,
    "files": {
        "pdf": "https://archive.orkl.eu/29ceb2ee71d540a7f3f2a496b2e726b2779f485b.pdf",
        "text": "https://archive.orkl.eu/29ceb2ee71d540a7f3f2a496b2e726b2779f485b.txt",
        "img": "https://archive.orkl.eu/29ceb2ee71d540a7f3f2a496b2e726b2779f485b.jpg"
    }
}