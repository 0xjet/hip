{
    "id": "71f64841-0602-4586-a559-db04c8428b9b",
    "created_at": "2023-01-12T15:09:38.466108Z",
    "updated_at": "2025-03-27T02:16:53.032869Z",
    "deleted_at": null,
    "sha1_hash": "9d155ce1d926aaa3ecc7fff90be0533adfbc8718",
    "title": "2017-05-31 - Writing PCRE's for applied passive network defense [Emotet]",
    "authors": "",
    "file_creation_date": "2022-05-29T01:28:36Z",
    "file_modification_date": "2022-05-29T01:28:36Z",
    "file_size": 425196,
    "plain_text": "# /var/log/notes\n\n**ropgadget.com/posts/defensive_pcres.html**\n\n[31MAY2017 - Writing PCRE's for applied passive network defense [Emotet]](http://ropgadget.com/posts/defensive_pcres.html)\nBy [Jeff White](https://www.linkedin.com/in/jeff-white-459a6416/) [(karttoon)](https://twitter.com/noottrak)\n\nRegular expressions (regex) are a language construct that allow you to define a search pattern. The\nflexibility of this language allows you to craft search patterns for tons of practical applications,\nincluding passive identification of network traffic. Specifically, they can allow you to pattern match on\nURL's so that you may quickly identify malicious sites frequently used by malware command and\ncontrol (C2), domain generation algorithms (DGA's), and other such activities.\n\nI fell in love with using regex as a defensive tool while doing incident response many years ago. The\ndepth of control they provide naturally lends itself to the forensic, analyst, and responder lines of\nwork. This blog may be old hat to most blue teamers out there, but if not, hopefully it serves as an\neducational resource on how you can use data to build PCRE's for network defense.\n\nOver the course of this blog, I'll cover developing Perl compatible regex (PCRE) for the Emotet\nbanking malware download URL's and develop PCRE's that encompass multiple campaigns that can\nthen be used on a proxy device (blocking), in a SIEM (identification), or whatever system you have\nthat supports utilizing these expressions. Emotet is a great candidate for review as it has varying\ndomain structures that are ripe for pattern matching. I'll walk you through how I develop these\nPCRE's, along with refining them, and then finally how they can be vetted for false-positives (FP) to\nmake them ready for production.\n\n[Throughout the blog, I'll be using a Python script I wrote called pcre_check to assit with the analysis.](https://github.com/karttoon/pcre_check/blob/master/pcre_check.py)\nEssentially, all the tool does is take a parameter for a file containing your PCRE's, a parameter for a\nfile containing the URL's, and then some flags for how to display the pattern matches and misses.\nThis is helpful for the rapid development of PCRE's because, more often than naught, you find\nyourself in the midst of developing these when the shit has hit the fan...or at least I always did.\n\nI'll be focusing solely on URL's in this example; however, on the off chance you're not familiar with\nregex, keep in mind that a myriad of tools, all the way down at the byte level and up to the application\nlevel that I'll be covering here can utilize regex. You should absolutely learn the basics at least as it's\nsomething that can be a life saver in your daily toolbox.\n\nBefore I get too much further in, here are a couple of helpful links, that I find myself constantly\nvisiting, which you may find useful if you want to review or build your own PCRE's. I'll try to explain\nthe regex syntax and logic as I go but I'll assume you know the basic structure of the language. If not,\nhit the references below.\n\n[https://regex101.com/ - Lets you test a PCRE (or some other flavors of regex) against a set of](https://regex101.com/)\nstrings you provide on the fly with color and syntax highlighting. It provides extremely helpful\nexplanations that tell you how your PCRE is being evaluated so you can adjust as needed.\n\n\n-----\n\n[http://www.regular-expressions.info/ - This site probably has everything you ever wanted to](http://www.regular-expressions.info/)\nknow about the regex language. A super handy quick reference for when you forget some of\nthe nuances and syntax.\n\nThis will be a long blog, and a little free flowing, as I develop these while enumerating step-by-step.\nBelow are some jumps so you can skip around as needed.\n\nInitial Sample Corpus\n\nThe Emotet banking malware download locations have a lot of different URL structures across their\ndifferent campaigns. It's been popping up on my radar more and more lately so I want to try and\nenumerate the patterns here to further expand what I can catch. That being said, the very first thing I\nneed to do is collect a decent samples of the various campaigns so that I can begin to try and match\nthem. Prior to my current $dayjob, I'd approach this by hitting up multiple blogs from researchers or\nsecurity companies and compile the URL set. When I didn't have access to systems that made this\ntask fairly trivial, I would frequently build them from the below resources.\n\n[Alient Vault Open Threat Exchange (OTX) - An awesome aggregation project that lets you pivot](https://otx.alienvault.com/browse/pulses/?q=emotet&sort=-created)\naround various reports, blogs, and events based on keywords and extract what you need.\nBelow is a screenshot showing a search for \"emotet\"; each of those contain IOC's for URL's\nyou can copy out to build your list.\n\n[Malware don't need Coffee -](http://malware.dontneedcoffee.com/) [Kafeine's site is more focused on exploit kits but almost always](https://twitter.com/kafeine)\nhad a handful of URL's of interest and sometimes links to raw URL dumps on Github.\n\n[Usually just Googling the threat name, \"Emotet domains\", bring you to sites like this one which have](https://www.dodgethissecurity.com/2017/04/12/emotetgeodo-domains/)\nlinks to [Pastebin posts containing loads of samples. The more the better but in general, in my](https://pastebin.com/NQtg2TZc)\nexperience, I'd say between 15-30 URL's is usually enough to make a solid base for an individual\npattern and then you can tweak it during the false-positive (FP) checking phase.\n\n[I've placed 696 Emotet URL's on Github which you can use to follow along or throw in a blocklist.](https://github.com/karttoon/pcre_check/blob/master/emotet_urls)\n\nPattern Recognition / Enumeration\n\n\n-----\n\nOnce you have a decent sample set, the next step is to analyze the data and look for patterns. I ll\nshow the various changes to the PCRE's as I analyze the URL's and you can see how they evolve\ninto the final product after each iteration. To better illustrate this, I'll just focus on the last 20 URL's at\na time but normally I'll have open 3 terminals: top window editing the URL file, middle window with\npcre_check output, bottom window editing the PCRE file. This layout allows me to quickly modify and\nvalidate changes on the fly and significantly reducing the time to turnaround.\n\nBelow is the first run of the script showing that none of the URLs matched and truncated to the last\n20.\n\nRound 1\n\n$ python pcre_check.py -p emotet_pcres -u emotet_urls -n [+] NO HITS [+]\nhttp://12back.com/dw3wz-ue164-qqv/ http://4glory.net/p7lrq-s191-iv/ ...\nhttp://www.melodywriters.com/INVOICE-864339-98261/\nhttp://www.prodzakaz.com.ua/H27560xzwsS/ http://www.stellaimpianti.it/download2467/\nhttp://www.stepstonedev.com/field/download7812/ http://www.surreycountycleaners.com/t5wx-x064mzdb/ http://www.voloskof.net/Sn83160EngQs/ http://www.wildweek.com/EDHFR-08-77623document-May-04-2017/ http://www.ziyufang.studio/project/wpcontent/plugins/nprojects/download5337/ http://wyskocil.de/ORDER-525808-73297/\nhttp://xionglutions.com/NDKBS-51-84402-document-May-03-2017/ http://xionglutions.com/wl7dhuf201-asnw/ http://xyphoid.com/RRT-13279129.dokument/\nhttp://xyphoid.com/SCANNED/MM3431UCNPCEZRO/ http://yildiriminsaat.com.tr/JCV71815736.dokument/ http://zahahadidmiami.com/K38258Q/ http://zeroneed.com/FNN40446899.dokument/ http://ziarahsutera.com/5377959590/ http://zonasacra.com/zH83293YizhQ/\nhttp://zvarga.com/15-12-07/CUST-9405847-8348/ http://zypern-aktiv.de/wpcontent/plugins/wordfence/img9re-a789-stz/\n\nThere are a couple of things that jump out immediately on the first review.\n\nDomains seem unrelated to the URL path, they are most likely compromised sites.\nThe final path can be multiple levels down, so I'll need to account for this.\nAt least 6 different variations can be seen out of the gate.\n\nFor each of the PCRE, I've grown accustomed to starting them with the below structure.\n\n^http:\\/\\/[^\\x2F]+\\/\n\nThis matches any line that begins (\"^\") with \"http://\" followed by any characters, except (\"[^ ]\") forward\nslash (\"\\x2F\"), up to the first foward slash. This ensures we match the domain regardless of what\nTLD or subdomains may be present.\n\nFor ease of illustration, I'm going to group the variations and break them down individually.\n\n**[Group 01]**\n\nhttp://www.surreycountycleaners.com/t5wx-x064-mzdb/ http://xionglutions.com/wl7dh-uf201-asnw/\nhttp://zypern-aktiv.de/wp-content/plugins/wordfence/img9re-a789-stz/\n\n\n-----\n\nFor this pattern, we have 4-5 alpha(lower)numeric, dash, 4-5 alpha(lower)numeric, dash, 3-4\nalpha(lower). We'll also want to account for the last line which has the path multiple levels in. We can\naccomplish this by putting our \"[^\\x2F]+\\/\" section in a group and saying the group can repeat one or\nmore times (eg match everything between the forward slashes until the last one, where our pattern\nis).\n\n^http:\\/\\/([^\\x2F]+\\/)+[a-z0-9]{4,5}-[a-z0-9]{4,5}-[a-z]{3,4}\\/$\n\n**[Group 02]**\n\nhttp://www.melodywriters.com/INVOICE-864339-98261/ http://wyskocil.de/ORDER-525808-73297/\nhttp://zvarga.com/15-12-07/CUST-9405847-8348/\n\nThis next group appears to use a word in caps, dash, 6-7 numbers, dash, 4-5 numbers. We'll need to\naccount for the subpaths again as well. In this case, I prefer to group full words instead of using a\ncharacter range, which helps for trying to be false-positive adverse.\n\n^http:\\/\\/([^\\x2F]+\\/)+(INVOICE|ORDER|CUST)-[0-9]{6,7}-[0-9]{4,5}\\/$\n\n**[Group 03]**\n\nhttp://www.prodzakaz.com.ua/H27560xzwsS/ http://www.voloskof.net/Sn83160EngQs/\nhttp://xyphoid.com/SCANNED/MM3431UCNPCEZRO/ http://zahahadidmiami.com/K38258Q/\nhttp://ziarahsutera.com/5377959590/ http://zonasacra.com/zH83293YizhQ/\n\nI feel this group may end up getting split later. We have one URL which is purely numerical and then\ntwo which have no lowercase letters. We'll cross that bridge as we look at more samples, if\nnecessary. Another thing to note is that this group has a very weak pattern in that it is very generic,\nwhich means it will likely match a lot of legitimate URL's and not hold up during FP testing. We'll\ncross that bridge when we get to it as well.\n\nFor now, it's a mix of 7-15 alphanumeric characters.\n\n^http:\\/\\/([^\\x2F]+\\/)+[a-zA-Z0-9]{7,15}\\/$\n\n**[Group 04]**\n\nhttp://xyphoid.com/RRT-13279129.dokument/ http://yildiriminsaat.com.tr/JCV-71815736.dokument/\nhttp://zeroneed.com/FNN-40446899.dokument/\n\nThis one, and the next three, all look pretty straight forward: 3 alpha(upper), dash, 8 numbers,\nperiod, \"dokument\" string.\n\n^http:\\/\\/([^\\x2F]+\\/)+[A-Z]{3}-[0-9]{8}\\.dokument\\/$\n\n**[Group 05]**\n\nhttp://www.wildweek.com/EDHFR-08-77623-document-May-04-2017/\nhttp://xionglutions.com/NDKBS-51-84402-document-May-03-2017/\n\n\n-----\n\nSimilarly, very structured (which is good for us): 5 alpha(upper), dash, 2 numbers, dash, 5 numbers,\ndash, \"document\" string, dash, \"May\" string, dash, 2 numbers, dash, \"2017\" string. I've defaulted to\nusing \"2017\" as a string since it aligns with their usage of it as a date so it seems unlikely to change.\n\n^http:\\/\\/([^\\x2F]+\\/)+[A-Z]{5}-[0-9]{2}-[0-9]{5}-document-May-[0-9]{2}-2017\\/$\n\n**[Group 06]**\n\nhttp://www.stellaimpianti.it/download2467/ http://www.stepstonedev.com/field/download7812/\nhttp://www.ziyufang.studio/project/wp-content/plugins/nprojects/download5337/\n\nThe string \"download\", 4 numbers.\n\n^http:\\/\\/([^\\x2F]+\\/)+download[0-9]{4}\\/$\n\nI'll throw these into the emotet_pcres file and see how each performs against our target data set of\nknown-bad Emotet sites.\n\n[+] FOUND [+] Count: 24/696 Comment: Group 01 - [ t5wx-x064-mzdb ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+\n\n[a-z0-9]{4,5}-[a-z0-9]{4,5}-[a-z]{3,4}\\/$ [+] FOUND [+] Count: 43/696 Comment: Group 02 - [\nINVOICE-864339-98261 ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+(INVOICE|ORDER|CUST)-[0-9]{6,7}-[0-9]\n{4,5}\\/$ [+] FOUND [+] Count: 177/696 Comment: Group 03 - [ H27560xzwsS ] PCRE:\n^http:\\/\\/([^\\x2F]+\\/)+[a-zA-Z0-9]{7,15}\\/$ [+] FOUND [+] Count: 30/696 Comment: Group 04 - [ RRT13279129.dokument ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+[A-Z]{3}-[0-9]{8}\\.dokument\\/$ [+] FOUND [+]\nCount: 24/696 Comment: Group 05 - [ EDHFR-08-77623-document-May-04-2017 ] PCRE:\n^http:\\/\\/([^\\x2F]+\\/)+[A-Z]{5}-[0-9]{2}-[0-9]{5}-document-May-[0-9]{2}-2017\\/$ [+] FOUND [+] Count:\n62/696 Comment: Group 06 - [ download2467 ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+download[0-9]{4}\\/$\n\nPretty low across the board except for group 3, which is the one I mentioned is too loose to begin\nwith. From here on out, if I don't list a particular group, it implies there was no change to the PCRE.\n\nRound 2\n\nThe next 20 URL's are below.\n\nhttp://web2present.com/Invoice-538878-14610/\nhttp://webbmfg.com/krupy/gallery2/g2data/LUqc663BAyN333-HoO/ http://webbsmail.co.uk/DIDE-1985247-document-May-04-2017/ http://webergy.co.uk/15-14-47/Cust-0910279-3981/\nhttp://webics.org/Cust-951068-69554/ http://websajt.nu/ap6ohc-au152-urttp/\nhttp://wescographics.com/17-40-07/Invoice-5558936-1201/\nhttp://whiteroofradio.com/YD796MJO974-NNW/ http://wightman.cc/ipa0oab-j490-keap/\nhttp://wilstu.com/hHiDSaaP03Y95TIGpIUS4Aa/ http://wingitproductions.org/NUDA-X-52454-DE/\nhttp://wlrents.com/CUST.-Document-YDI-04-GQ389557/\nhttp://wnyil.org/wnyil_transfer/Ups__com__WebTracking__tracknum__4DFH74180493688150/ORDER.Document-SY-92-E736730/ http://wolffy.net/17-00-07/Invoice-9545415-1483/\nhttp://wortis.com/CH760Wcv003-Luh/ http://www.anti-corruption.su/Cust-3708876-8210/\nhttp://www.anti-corruption.su/TNO-59-97413-document-May-04-2017/\nhttp://www.babyo.com.mx/Invoice-583156-73417/ http://www.doodle.tj/yW1NZ-sh00-cH/\nhttp://zypern-aktiv.de/wp-content/plugins/wordfence/img9re-a789-stz/\n\n\n-----\n\nIt looks like we have a few new groups as well. I ll attempt to highlight in red the changes to the\nPCRE's which might make the changes clearer.\n\n**[Group 01] - [ t5wx-x064-mzdb ]**\n\nhttp://websajt.nu/ap6ohc-au152-urttp/ http://wightman.cc/ipa0oab-j490-keap/\nhttp://www.doodle.tj/yW1NZ-sh00-cH/ http://zypern-aktiv.de/wp-content/plugins/wordfence/img9rea789-stz/\n\nYou'll note that the third one now introduces capital letters; it's possible this is a separate campaign\nbut I'll circle back to this later during review. The main changes will be the addition of the capital\nletters and adjustment on the ranges, which will likely be the case for the rest of the groups.\n\nOLD: ^http:\\/\\/([^\\x2F]+\\/)+[a-z0-9]{4,5}-[a-z0-9]{4,5}-[a-z]{3,4}\\/$ NEW: ^http:\\/\\/([^\\x2F]+\\/)+[a-zA-Z09]{4,7}-[a-z0-9]{4,5}-[a-z]{2,5}\\/$\n\n**[Group 02] - [ INVOICE-864339-98261 ]**\n\nhttp://web2present.com/Invoice-538878-14610/ http://webergy.co.uk/15-14-47/Cust-0910279-3981/\nhttp://webics.org/Cust-951068-69554/ http://wescographics.com/17-40-07/Invoice-5558936-1201/\nhttp://wolffy.net/17-00-07/Invoice-9545415-1483/ http://www.anti-corruption.su/Cust-3708876-8210/\nhttp://www.babyo.com.mx/Invoice-583156-73417/\n\nNew strings \"Invoice\" and \"Cust\".\n\nOLD: ^http:\\/\\/([^\\x2F]+\\/)+(INVOICE|ORDER|CUST)-[0-9]{6,7}-[0-9]{4,5}\\/$ NEW:\n^http:\\/\\/([^\\x2F]+\\/)+(INVOICE|ORDER|CUST|Invoice|Cust)-[0-9]{6,7}-[0-9]{4,5}\\/$\n\n**[Group 03] - [ H27560xzwsS ]**\n\nhttp://wilstu.com/hHiDSaaP03Y95TIGpIUS4Aa/\n\nRange adjustment (making this one even more useless).\n\nOLD: ^http:\\/\\/([^\\x2F]+\\/)+[a-zA-Z0-9]{7,15}\\/$ NEW: ^http:\\/\\/([^\\x2F]+\\/)+[a-zA-Z0-9]{7,23}\\/$\n\n**[Group 05] - [ EDHFR-08-77623-document-May-04-2017 ]**\n\nhttp://webbsmail.co.uk/DIDE-19-85247-document-May-04-2017/ http://www.anti-corruption.su/TNO59-97413-document-May-04-2017/\n\nRange adjustment.\n\nOLD: ^http:\\/\\/([^\\x2F]+\\/)+[A-Z]{5}-[0-9]{2}-[0-9]{5}-document-May-[0-9]{2}-2017\\/$ NEW:\n^http:\\/\\/([^\\x2F]+\\/)+[A-Z]{3,5}-[0-9]{2}-[0-9]{5}-document-May-[0-9]{2}-2017\\/$\n\n**[Group 07] - [ LUqc663BAyN333-HoO ]**\n\nhttp://webbmfg.com/krupy/gallery2/g2data/LUqc663BAyN333-HoO/\nhttp://whiteroofradio.com/YD796MJO974-NNW/ http://wortis.com/CH760Wcv003-Luh/\n\nThis cluser is defined by one dash towards the end: 11-14 alphanumeric, dash, 3 alpha.\n\n\n-----\n\nhttp:\\/\\/([ \\x2F]+\\/)+[a-zA-Z0-9]{11,14}-[a-zA-Z]{3}\\/$\n\n**[Group 08] - [ NUDA-X-52454-DE ]**\n\nhttp://wingitproductions.org/NUDA-X-52454-DE/\n\nOnly one sample so I'll match it exactly, 4 alpha(upper), dash, 1 alpha(upper), dash, 5 numbers,\ndash, 2 alpha(upper).\n\n^http:\\/\\/([^\\x2F]+\\/)+[A-Z]{4}-[A-Z]{1}-[0-9]{5}-[A-Z]{2}\\/$\n\n**[Group 09] - [ CUST.-Document-YDI-04-GQ389557 ]**\n\nhttp://wlrents.com/CUST.-Document-YDI-04-GQ389557/\nhttp://wnyil.org/wnyil_transfer/Ups__com__WebTracking__tracknum__4DFH74180493688150/ORDER.Document-SY-92-E736730/\n\nSimilar to Group 2: same word choice, period, dash, \"Document\" string, dash, 2-3 alpha(upper),\ndash, 2 numbers, dash, 7-8 alpha(upper)numeric.\n\n^http:\\/\\/([^\\x2F]+\\/)+(CUST|ORDER)\\.-Document-[A-Z]{2,3}-[0-9]{2}-[A-Z0-9]{7,8}\\/$\n\nNote that the delta in the output after each group is just something I've included after the fact to show\nthe progress for the blog.\n\n[+] FOUND [+] Count: 66/696 (+42) Comment: [Group 01] - [ t5wx-x064-mzdb ] PCRE:\n^http:\\/\\/([^\\x2F]+\\/)+[a-zA-Z0-9]{4,7}-[a-z0-9]{4,5}-[a-z]{2,5}\\/$ [+] FOUND [+] Count: 80/696 (+37)\nComment: [Group 02] - [ INVOICE-864339-98261 ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+\n(INVOICE|ORDER|CUST|Invoice|Cust)-[0-9]{6,7}-[0-9]{4,5}\\/$ [+] FOUND [+] Count: 190/696 (+13)\nComment: [Group 03] - [ H27560xzwsS ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+[a-zA-Z0-9]{7,23}\\/$ [+] FOUND\n\n[+] Count: 30/696 Comment: [Group 04] - [ RRT-13279129.dokument ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+\n\n[A-Z]{3}-[0-9]{8}\\.dokument\\/$ [+] FOUND [+] Count: 59/696 (+35) Comment: [Group 05] - [ EDHFR08-77623-document-May-04-2017 ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+[A-Z]{3,5}-[0-9]{2}-[0-9]{5}-documentMay-[0-9]{2}-2017\\/$ [+] FOUND [+] Count: 62/696 Comment: [Group 06] - [ download2467 ] PCRE:\n^http:\\/\\/([^\\x2F]+\\/)+download[0-9]{4}\\/$ [+] FOUND [+] Count: 15/696 Comment: [Group 07] - [\nLUqc663BAyN333-HoO ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+[a-zA-Z0-9]{11,14}-[a-zA-Z]{3}\\/$ [+] FOUND [+]\nCount: 3/696 Comment: [Group 08] - [ NUDA-X-52454-DE ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+[A-Z]{4}-[A-Z]\n{1}-[0-9]{5}-[A-Z]{2}\\/$ [+] FOUND [+] Count: 20/696 Comment: [Group 09] - [ CUST.-Document-YDI04-GQ389557 ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+(CUST|ORDER)\\.-Document-[A-Z]{2,3}-[0-9]{2}-[A-Z0-9]\n{7,8}\\/$\n\nRound 3\n\nThe next set of 20 URL's.\n\nhttp://theocforrent.com/BG-47535325/zp3x-r88-wuh.view/ http://thepogs.net/rs4eG-Md93-FSZV/\nhttp://thesubservice.com/ORDER.-Document-9543529814/ http://theuntoldsorrow.co.uk/ORDER.-XI80-UY913942/ http://tiger12.com/TGA-48-76252-doc-May-04-2017/ http://timmadden.com.au/qzw1swc740-m/ http://toppprogramming.com/Cust-8328499631/ http://tpsystem.net/TaVS391hyCaD623dJ/ http://transfinity.co.uk/sam/fathers-day/htdocs/b2m-qp699-jxmln/ http://tridentii.com/OY\n\n-----\n\n30676027.dokument/ http://tscoaching.co.uk/l1R-q60-pe/ http://uncover.jp/XwXL806QaDN792-jr/\nhttp://uncover.jp/r-2psl-vo440-lz.doc/ http://visionsoflightphotography.com/FRMLW-RNT-41482-DE/\nhttp://visuals.com/CUST.-VT-38-RH422386/ http://voxellab.com/BBM-07-75350-doc-May-04-2017/\nhttp://vspacecreative.co.uk/O2-view-report-818/c1o-jn07-er.view/\nhttp://wayanad.net/xhW017TRfP646-z/ http://wb0rur.com/ZGAG-59-63863-doc-May-05-2017/\nhttp://www.doodle.tj/yW1NZ-sh00-cH/\n\nOne new variant in this set.\n\n**[Group 01] - [ t5wx-x064-mzdb ]**\n\nhttp://thepogs.net/rs4eG-Md93-FSZV/ http://timmadden.com.au/qzw1s-wc740-m/\nhttp://transfinity.co.uk/sam/fathers-day/htdocs/b2m-qp699-jxmln/ http://tscoaching.co.uk/l1R-q60-pe/\nhttp://www.doodle.tj/yW1NZ-sh00-cH/\n\nRange adjustment and additiona case changes.\n\nOLD: ^http:\\/\\/([^\\x2F]+\\/)+[a-zA-Z0-9]{4,7}-[a-z0-9]{4,5}-[a-z]{2,5}\\/$ NEW: ^http:\\/\\/([^\\x2F]+\\/)+[a-zAZ0-9]{4,7}-[a-zA-Z0-9]{4,5}-[a-zA-Z]{1,5}\\/$\n\n**[Group 02] - [ INVOICE-864339-98261 ]**\n\nhttp://toppprogramming.com/Cust-8328499631/\n\nThis could be a different campaign as it breaks from the double-dashes but it's so similar to group 2\nthat I'll leave it for now and possibly revisit.\n\nThe second dash I'll make optional which should allow the lowest ranges of the numerical sections to\nmatch. I'll use an optinal capturing group (\"(-)?\") for the second dash. Effectively creating a capture\ngroup and then using the \"?\" value after will cause the group to match between zero and one time,\nthus becoming optional.\n\nOLD: ^http:\\/\\/([^\\x2F]+\\/)+(INVOICE|ORDER|CUST|Invoice|Cust)-[0-9]{6,7}-[0-9]{4,5}\\/$ NEW:\n^http:\\/\\/([^\\x2F]+\\/)+(INVOICE|ORDER|CUST|Invoice|Cust)-[0-9]{6,7}(-)?[0-9]{4,5}\\/$\n\n**[Group 04] - [ RRT-13279129.dokument ]**\n\nhttp://tridentii.com/OY-30676027.dokument/\n\nRange adjustment.\n\nOLD: ^http:\\/\\/([^\\x2F]+\\/)+[A-Z]{3}-[0-9]{8}\\.dokument\\/$ NEW: ^http:\\/\\/([^\\x2F]+\\/)+[A-Z]{2,3}-[0-9]\n{8}\\.dokument\\/$\n\n**[Group 05] - [ EDHFR-08-77623-document-May-04-2017 ]**\n\nhttp://tiger12.com/TGA-48-76252-doc-May-04-2017/ http://voxellab.com/BBM-07-75350-doc-May-042017/ http://wb0rur.com/ZGAG-59-63863-doc-May-05-2017/\n\nAdd \"doc\" string to grouping.\n\n\n-----\n\nOLD: http:\\/\\/([ \\x2F]+\\/)+[A-Z]{3,5}-[0-9]{2}-[0-9]{5}-document-May-[0-9]{2}-2017\\/$ NEW:\n^http:\\/\\/([^\\x2F]+\\/)+[A-Z]{3,5}-[0-9]{2}-[0-9]{5}-(document|doc)-May-[0-9]{2}-2017\\/$\n\n**[Group 07] - [ LUqc663BAyN333-HoO ]**\n\nhttp://tpsystem.net/TaVS391hyCaD623-dJ/ http://uncover.jp/XwXL806QaDN792-jr/\nhttp://wayanad.net/xhW017TRfP646-z/\n\nRange adjustment.\n\nOLD: ^http:\\/\\/([^\\x2F]+\\/)+[a-zA-Z0-9]{11,14}-[a-zA-Z]{3}\\/$ NEW: ^http:\\/\\/([^\\x2F]+\\/)+[a-zA-Z0-9]\n{11,15}-[a-zA-Z]{1,3}\\/$\n\n**[Group 08] - [ NUDA-X-52454-DE ]**\n\nhttp://visionsoflightphotography.com/FRMLW-RNT-41482-DE/\n\nRange adjustment.\n\nOLD: ^http:\\/\\/([^\\x2F]+\\/)+[A-Z]{4}-[A-Z]{1}-[0-9]{5}-[A-Z]{2}\\/$ NEW: ^http:\\/\\/([^\\x2F]+\\/)+[A-Z]{4,5}\n[A-Z]{1,3}-[0-9]{5}-[A-Z]{2}\\/$\n\n**[Group 09] - [ CUST.-Document-YDI-04-GQ389557 ]**\n\nhttp://thesubservice.com/ORDER.-Document-9543529814/ http://theuntoldsorrow.co.uk/ORDER.-XI80-UY913942/ http://visuals.com/CUST.-VT-38-RH422386/\n\nCouple of things going on here.\n\nNew grouping of words for second part and first entry is only numerical without dashes, which looks\nsimilar to the new entry for Group 2. To account for these, I'll use optional capturing groups again to\nbuild around them. It makes the rule slightly less accurate but with the other anchors in it, I think it'll\nstill be fairly unique enough to not FP.\n\nNEW: ^http:\\/\\/([^\\x2F]+\\/)+(CUST|ORDER)\\.-Document-[A-Z]{2,3}-[0-9]{2}-[A-Z0-9]{7,8}\\/$ OLD:\n^http:\\/\\/([^\\x2F]+\\/)+(CUST|ORDER)\\.-(Document|XI|VT)((-[A-Z]{2,3})?-[0-9]{2})?-[A-Z0-9]{7,10}\\/$\n\n**[Group 10] - [ zp3x-r88-wuh.view ]**\n\nhttp://theocforrent.com/BG-47535325/zp3x-r88-wuh.view/ http://uncover.jp/r-2psl-vo440-lz.doc/\nhttp://vspacecreative.co.uk/O2-view-report-818/c1o-jn07-er.view/\n\nThe \"doc\" and \"view\" ones may be different campaigns but, again, I'll lump them together for now\nand will separate at the end if necessary: 1-4 alpha(lower)numeric, dash, 3-4 alpha(lower)numeric,\ndash, optional 5 alpha(lower)numeric, dash, 2-3 alpha(lower), period, group \"view\" or \"doc\" strings.\n\n^http:\\/\\/([^\\x2F]+\\/)+[a-z0-9]{1,4}-[a-z0-9]{3,4}(-[a-z0-9]{5})?-[a-z]{2,3}\\.(view|doc)\\/$\n\nThe pcre_check output shows decent coverage improvements.\n\n\n-----\n\n[+] FOUND [+] Count: 93/696 (+27) Comment: [Group 01] - [ t5wx-x064-mzdb ] PCRE:\n^http:\\/\\/([^\\x2F]+\\/)+[a-zA-Z0-9]{4,7}-[a-zA-Z0-9]{4,5}-[a-zA-Z]{1,5}\\/$ [+] FOUND [+] Count: 89/696\n(+9) Comment: [Group 02] - [ INVOICE-864339-98261 ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+\n(INVOICE|ORDER|CUST|Invoice|Cust)-[0-9]{6,7}(-)?[0-9]{4,5}\\/$ [+] FOUND [+] Count: 190/696\nComment: [Group 03] - [ H27560xzwsS ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+[a-zA-Z0-9]{7,23}\\/$ [+] FOUND\n\n[+] Count: 56/696 (+26) Comment: [Group 04] - [ RRT-13279129.dokument ] PCRE:\n^http:\\/\\/([^\\x2F]+\\/)+[A-Z]{2,3}-[0-9]{8}\\.dokument\\/$ [+] FOUND [+] Count: 79/696 (+20) Comment:\n\n[Group 05] - [ EDHFR-08-77623-document-May-04-2017 ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+[A-Z]{3,5}-[09]{2}-[0-9]{5}-(document|doc)-May-[0-9]{2}-2017\\/$ [+] FOUND [+] Count: 62/696 Comment: [Group\n06] - [ download2467 ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+download[0-9]{4}\\/$ [+] FOUND [+] Count: 43/696\n(+28) Comment: [Group 07] - [ LUqc663BAyN333-HoO ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+[a-zA-Z0-9]\n{11,15}-[a-zA-Z]{1,3}\\/$ [+] FOUND [+] Count: 10/696 (+7) Comment: [Group 08] - [ NUDA-X-52454DE ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+[A-Z]{4,5}-[A-Z]{1,3}-[0-9]{5}-[A-Z]{2}\\/$ [+] FOUND [+] Count:\n31/696 (+11) Comment: [Group 09] - [ CUST.-Document-YDI-04-GQ389557 ] PCRE:\n^http:\\/\\/([^\\x2F]+\\/)+(CUST|ORDER)\\.-(Document|XI|VT)((-[A-Z]{2,3})?-[0-9]{2})?-[A-Z0-9]{7,10}\\/$ [+]\nFOUND [+] Count: 3/696 Comment: [Group 10] - [ zp3x-r88-wuh.view ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+\n\n[a-z0-9]{1,4}-[a-z0-9]{3,4}(-[a-z0-9]{5})?-[a-z]{2,3}\\.(view|doc)\\/$\n\nRound 4\n\nThe next 20 sites.\n\nhttp://pinoypiper.com/Sz1Mr-H23-Xw/ http://proiecte-pac.ro/ORDER.-5883789520/\nhttp://proprints.dk/Rech-74779857260/ http://pulmad.ee/B6y-Fb95-NMW/\nhttp://redkitecottages.com/Cust-Document-VMH-46-TJ804065/ http://reichertgroup.com/d0r-tl410cxa/ http://sgbusiness.co.uk/YM-57911235-document-May-03-2017/\nhttp://sign1.no/dhl___status___2668292851/ http://sloan3d.com/Cust-Document-WMV-26EW054554/ http://stacibockman.com/g2c-o179-pocja/ http://streamingair.com/i0A-St59-m/\nhttp://sublevel3.us/G7n-Gh58-y/ http://superalumnos.net/php/ORDER.-HW-84-Y947883/\nhttp://technetemarketing.com/CUST.-8520279770/ http://teed.ru/YG-47124992/bc7za-l30-v.view/\nhttp://texasbrits.com/m3s-r623-x/ http://thegilbertlawoffice.com/m-9q-d054-gu.doc/\nhttp://thenursesagent.com/ORDER.-9592209302/ http://transfinity.co.uk/sam/fathersday/htdocs/b2m-qp699-jxmln/ http://tscoaching.co.uk/l1R-q60-pe/\n\nOne new variant sticks out, otherwise business as usual.\n\n**[Group 01] - [ t5wx-x064-mzdb ]**\n\nhttp://pinoypiper.com/Sz1Mr-H23-Xw/ http://pulmad.ee/B6y-Fb95-NMW/ http://reichertgroup.com/d0rtl410-cxa/ http://stacibockman.com/g2c-o179-pocja/ http://streamingair.com/i0A-St59-m/\nhttp://sublevel3.us/G7n-Gh58-y/ http://texasbrits.com/m3s-r623-x/ http://transfinity.co.uk/sam/fathersday/htdocs/b2m-qp699-jxmln/ http://tscoaching.co.uk/l1R-q60-pe/\n\nHalf of the 20 are for this group. Just some small range adjustments.\n\nOLD: ^http:\\/\\/([^\\x2F]+\\/)+[a-zA-Z0-9]{4,7}-[a-zA-Z0-9]{4,5}-[a-zA-Z]{1,5}\\/$ NEW:\n^http:\\/\\/([^\\x2F]+\\/)+[a-zA-Z0-9]{3,7}-[a-zA-Z0-9]{3,5}-[a-zA-Z]{1,5}\\/$\n\n**[Group 02] - [ INVOICE-864339-98261 ]**\n\n\n-----\n\nhttp://proiecte-pac.ro/ORDER.-5883789520/ http://proprints.dk/Rech-74779857260/\nhttp://technetemarketing.com/CUST.-8520279770/ http://thenursesagent.com/ORDER.-9592209302/\n\nIt should be apparent now that Group 2 and 9 have a bit of overlap and I was going to wait till the end\nto course correct; however, I feel it's just too much at this point so I'm going to split it so the ones\nabove, and previously matched in both groups, with the \"ORDER\" and \"CUST\" strings followed by 10\ndigits are a new unique group. That means I need to edit Group 2 and 9 to avoid these and the\nsimplest way of doing that is removing the previous optional dash, making it absolutely required. See\nGroup 9 and 12 for further iteration details.\n\nOLD: ^http:\\/\\/([^\\x2F]+\\/)+(INVOICE|ORDER|CUST|Invoice|Cust)-[0-9]{6,7}(-)?[0-9]{4,5}\\/$ NEW:\n^http:\\/\\/([^\\x2F]+\\/)+(INVOICE|ORDER|CUST|Invoice|Cust)-[0-9]{6,7}-[0-9]{4,5}\\/$\n\n**[Group 05] - [ EDHFR-08-77623-document-May-04-2017 ]**\n\nhttp://sgbusiness.co.uk/YM-57911235-document-May-03-2017/\n\nThis new one breaks from the two parts separated by a dash. I can add the dash to the character list\nand up the range, or I can opt for a optional grouping and up the range. I'm going to do the latter for\nthe reason that it keeps the structure in tact; for this, I'm not as worried about FP's due to the ending\npart of the pattern being fairly unique.\n\nOLD: ^http:\\/\\/([^\\x2F]+\\/)+[A-Z]{3,5}-[0-9]{2}-[0-9]{5}-(document|doc)-May-[0-9]{2}-2017\\/$ NEW:\n^http:\\/\\/([^\\x2F]+\\/)+[A-Z]{2,5}(-[0-9]{2})?-[0-9]{5,10}-(document|doc)-May-[0-9]{2}-2017\\/$\n\n**[Group 09] - [ CUST.-Document-YDI-04-GQ389557 ]**\n\nhttp://redkitecottages.com/Cust-Document-VMH-46-TJ804065/ http://sloan3d.com/Cust-DocumentWMV-26-EW054554/ http://superalumnos.net/php/ORDER.-HW-84-Y947883/\n\nSimilar to Group 2, I'm going to reverse course on the optional groupings so that the 10 digits are not\ncaptured. To account for the new variants in Group 9, I'm adding an optional grouping for the period\nafter the first word and for the \"Document\" string, then moving the others back into the A-Z grouping\nthat followed.\n\nOLD: ^http:\\/\\/([^\\x2F]+\\/)+(CUST|ORDER)\\.-(Document|XI|VT)((-[A-Z]{2,3})?-[0-9]{2})?-[A-Z0-9]\n{7,10}\\/$ NEW: ^http:\\/\\/([^\\x2F]+\\/)+(CUST|ORDER|Cust)(.)?(-Document)?-[A-Z]{2,3}-[0-9]{2}-[A-Z09]{7,10}\\/$\n\n**[Group 10] - [ zp3x-r88-wuh.view ]**\n\nhttp://thegilbertlawoffice.com/m-9q-d054-gu.doc/\n\nRange adjustment.\n\nOLD: ^http:\\/\\/([^\\x2F]+\\/)+[a-z0-9]{1,4}-[a-z0-9]{3,4}(-[a-z0-9]{5})?-[a-z]{2,3}\\.(view|doc)\\/$ NEW:\n^http:\\/\\/([^\\x2F]+\\/)+[a-z0-9]{1,4}-[a-z0-9]{3,4}(-[a-z0-9]{4,5})?-[a-z]{2,3}\\.(view|doc)\\/$\n\n**[Group 11] - [ dhl___status___2668292851 ]**\n\nhttp://sign1.no/dhl status 2668292851/\n\n\n-----\n\nNot much to work with yet so it s fairly static.\n\n^http:\\/\\/([^\\x2F]+\\/)+dhl___status___[0-9]{10}\\/$\n\n**[Group 12] - [ ORDER.-5883789520 ]**\n\nPrevious set: http://thesubservice.com/ORDER.-Document-9543529814/\nhttp://toppprogramming.com/Cust-8328499631/ Current set: http://proiectepac.ro/ORDER.-5883789520/ http://proprints.dk/Rech-74779857260/\nhttp://technetemarketing.com/CUST.-8520279770/ http://thenursesagent.com/ORDER.-9592209302/\n\nLooking at the data in Group 2 and 9, this pattern will have: string grouping of \"ORDER\", \"RECH\",\n\"CUST\", \"Cust\", optional period, dash, optional \"Document\" string, 10-11 numbers. By the way, \"rech\"\nis shorthand for \"rechnung\", which is German for \"bill\" - you see these variations quite a bit in\nphishing campaigns as they focus on different regions.\n\n^http:\\/\\/([^\\x2F]+\\/)+(ORDER|Rech|CUST|Cust)(.)?(-Document)?-[0-9]{10,11}\\/$\n\nNext iteration below.\n\n[+] FOUND [+] Count: 127/696 (+34) Comment: [Group 01] - [ t5wx-x064-mzdb ] PCRE:\n^http:\\/\\/([^\\x2F]+\\/)+[a-zA-Z0-9]{3,7}-[a-zA-Z0-9]{3,5}-[a-zA-Z]{1,5}\\/$ [+] FOUND [+] Count: 80/696\n(-9) Comment: [Group 02] - [ INVOICE-864339-98261 ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+\n(INVOICE|ORDER|CUST|Invoice|Cust)-[0-9]{6,7}-[0-9]{4,5}\\/$ [+] FOUND [+] Count: 190/696\nComment: [Group 03] - [ H27560xzwsS ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+[a-zA-Z0-9]{7,23}\\/$ [+] FOUND\n\n[+] Count: 56/696 Comment: [Group 04] - [ RRT-13279129.dokument ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+\n\n[A-Z]{2,3}-[0-9]{8}\\.dokument\\/$ [+] FOUND [+] Count: 86/696 (+7) Comment: [Group 05] - [ EDHFR08-77623-document-May-04-2017 ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+[A-Z]{2,5}(-[0-9]{2})?-[0-9]{5,10}(document|doc)-May-[0-9]{2}-2017\\/$ [+] FOUND [+] Count: 62/696 Comment: [Group 06] - [\ndownload2467 ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+download[0-9]{4}\\/$ [+] FOUND [+] Count: 43/696\nComment: [Group 07] - [ LUqc663BAyN333-HoO ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+[a-zA-Z0-9]{11,15}-[azA-Z]{1,3}\\/$ [+] FOUND [+] Count: 10/696 Comment: [Group 08] - [ NUDA-X-52454-DE ] PCRE:\n^http:\\/\\/([^\\x2F]+\\/)+[A-Z]{4,5}-[A-Z]{1,3}-[0-9]{5}-[A-Z]{2}\\/$ [+] FOUND [+] Count: 36/696 (+5)\nComment: [Group 09] - [ CUST.-Document-YDI-04-GQ389557 ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+\n(CUST|ORDER|Cust)(.)?(-Document)?-[A-Z]{2,3}-[0-9]{2}-[A-Z0-9]{7,10}\\/$ [+] FOUND [+] Count:\n3/696 Comment: [Group 10] - [ zp3x-r88-wuh.view ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+[a-z0-9]{1,4}-[a-z0-9]\n{3,4}(-[a-z0-9]{4,5})?-[a-z]{2,3}\\.(view|doc)\\/$ [+] FOUND [+] Count: 3/696 Comment: [Group 11] - [\ndhl___status___2668292851 ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+dhl___status___[0-9]{10}\\/$ [+] FOUND\n\n[+] Count: 31/696 Comment: [Group 12] - [ ORDER.-5883789520 ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+\n(ORDER|Rech|CUST|Cust)(.)?(-Document)?-[0-9]{10,11}\\/$\n\nRound 5\n\nSince there are only 31 URL's left I'm just going to add them all here and close out this phase.\n\nhttp://akhmerov.com/AuHffUo4L1BcEmca0BW5e4UtI/ http://albrightfinancial.com/gescanntesDokument-66764196575/ http://anjep.com/TBWEV-YCAP-91327-DE/ http://arroyave.net/Rech-K682-GO1130/ http://beowulf7.com/kgcee/ http://bitach.com/RIJW-FNFE-86299-DE/\nhttp://bobrow.com/ito-6r-w193-pkr.doc/ http://boningue.com/g843enx500-Jh/\n\n\n-----\n\nhttp://carriedavenport.com/Scan-58146582290/ http://davidberman.com/gescanntes-Dokument85218870046/ http://dentaltravelpoland.co.uk/NUN-63376893/b4fe-nn88-s.view/\nhttp://donnjo.com/Rechnung-IOOY-776-LUV2894/ http://frossweddingcollections.co.uk/qdu-7p-wi523hgnt.doc/ http://froufrouandthomas.co.uk/c644kNg297-uy/ http://gabrielramos.com.br/lxu-3h-ip079zgmg.doc/ http://genxvisual.com/U494KHq064-VK/ http://gestion-arte.com.ar/CLCJY-EMIE-76216DE/ http://imnet.ro/gcxbh/ http://johncarta.com/jexaag/ http://kowalenko.ca/D603ImA780-xxJ/\nhttp://kratiroff.com/Scan-62799108494/ http://lapetitenina.com/eyym/\nhttp://magmaprod.com.br/FcmUZ9GGTFaq2SYC5HTuFgc4v7/ http://masmp.com/rby-4c-rp108sqq.doc/ http://missgypsywhitemoon.com.au/ismpce/ http://music111.com/VAQT-DYBC-27274-DE/\nhttp://myhorses.ca/lb8TApg9aZI6PP5RWRAIdmfU/ http://onlineme.w04.wh-2.com/LD-36666076/ir5rmu75-h.view/ http://phoneworx.co.uk/HLqwOU1uNQ7rWLWkXW6VoMheZf/ http://teed.ru/YG47124992/bc7za-l30-v.view/ http://thegilbertlawoffice.com/m-9q-d054-gu.doc/\n\n**[Group 03] - [ H27560xzwsS ]**\n\nhttp://akhmerov.com/AuHffUo4L1BcEmca0BW5e4UtI/ http://beowulf7.com/kgcee/\nhttp://imnet.ro/gcxbh/ http://johncarta.com/jexaag/ http://lapetitenina.com/eyym/\nhttp://magmaprod.com.br/FcmUZ9GGTFaq2SYC5HTuFgc4v7/\nhttp://myhorses.ca/lb8TApg9aZI6PP5RWRAIdmfU/\nhttp://phoneworx.co.uk/HLqwOU1uNQ7rWLWkXW6VoMheZf/\n\nI'll adjust the ranges on this one but you can see from the above that it looks like two distinct\ncampaigns. I have no doubt now that there will be more in this grouping but since it's almost over 200\nURL's I'll review the entire set at the end.\n\nOLD: ^http:\\/\\/([^\\x2F]+\\/)+[a-zA-Z0-9]{7,23}\\/$ NEW: ^http:\\/\\/([^\\x2F]+\\/)+[a-zA-Z0-9]{4,26}\\/$\n\n**[Group 07] - [ LUqc663BAyN333-HoO ]**\n\nhttp://boningue.com/g843enx500-Jh/ http://froufrouandthomas.co.uk/c644kNg297-uy/\nhttp://genxvisual.com/U494KHq064-VK/ http://kowalenko.ca/D603ImA780-xxJ/\n\nRange adjustment.\n\nOLD: ^http:\\/\\/([^\\x2F]+\\/)+[a-zA-Z0-9]{11,15}-[a-zA-Z]{1,3}\\/$ NEW: ^http:\\/\\/([^\\x2F]+\\/)+[a-zA-Z0-9]\n{10,15}-[a-zA-Z]{1,3}\\/$\n\n**[Group 08] - [ NUDA-X-52454-DE ]**\n\nhttp://anjep.com/TBWEV-YCAP-91327-DE/ http://bitach.com/RIJW-FNFE-86299-DE/ http://gestionarte.com.ar/CLCJY-EMIE-76216-DE/ http://music111.com/VAQT-DYBC-27274-DE/\n\nRange adjustment. Curious these all end with \"DE\" too, possibly region based given the \"Rech\" stuff\nseen previously; will follow-up after.\n\nOLD: ^http:\\/\\/([^\\x2F]+\\/)+[A-Z]{4,5}-[A-Z]{1,3}-[0-9]{5}-[A-Z]{2}\\/$ NEW: ^http:\\/\\/([^\\x2F]+\\/)+[A-Z]\n{4,5}-[A-Z]{1,4}-[0-9]{5}-[A-Z]{2}\\/$\n\n**[Group 09] - [ CUST.-Document-YDI-04-GQ389557 ]**\n\n\n-----\n\nhttp://arroyave.net/Rech-K-682-GO1130/ http://donnjo.com/Rechnung-IOOY-776-LUV2894/\n\nAdded \"Rech\" and \"Rechnung\" to initial string grouping along with expanding some ranges.\n\nOLD: ^http:\\/\\/([^\\x2F]+\\/)+(CUST|ORDER|Cust)(.)?(-Document)?-[A-Z]{2,3}-[0-9]{2}-[A-Z0-9]{7,10}\\/$\nNEW: ^http:\\/\\/([^\\x2F]+\\/)+(CUST|ORDER|Cust|Rech|Rechnung)(.)?(-Document)?-[A-Z]{1,4}-[0-9]\n{2,3}-[A-Z0-9]{6,10}\\/$\n\n**[Group 10] - [ zp3x-r88-wuh.view ]**\n\nhttp://bobrow.com/ito-6r-w193-pkr.doc/ http://dentaltravelpoland.co.uk/NUN-63376893/b4fe-nn88s.view/ http://frossweddingcollections.co.uk/qdu-7p-wi523-hgnt.doc/ http://gabrielramos.com.br/lxu3h-ip079-zgmg.doc/ http://masmp.com/rby-4c-rp108-sqq.doc/ http://onlineme.w04.wh-2.com/LD36666076/ir5r-mu75-h.view/ http://teed.ru/YG-47124992/bc7za-l30-v.view/\nhttp://thegilbertlawoffice.com/m-9q-d054-gu.doc/\n\nRange adjustment.\n\nOLD: ^http:\\/\\/([^\\x2F]+\\/)+[a-z0-9]{1,4}-[a-z0-9]{3,4}(-[a-z0-9]{4,5})?-[a-z]{2,3}\\.(view|doc)\\/$ NEW:\n^http:\\/\\/([^\\x2F]+\\/)+[a-z0-9]{1,5}-[a-z0-9]{2,4}(-[a-z0-9]{4,5})?-[a-z]{1,4}\\.(view|doc)\\/$\n\n**[Group 12] - [ ORDER.-5883789520 ]**\n\nhttp://albrightfinancial.com/gescanntes-Dokument-66764196575/ http://carriedavenport.com/Scan58146582290/ http://davidberman.com/gescanntes-Dokument-85218870046/\nhttp://kratiroff.com/Scan-62799108494/\n\nAdded \"gescanntes\" to initial string grouping (this is Dutch for \"Scanned\") and \"Scan\". Added\n\"Dokument\" to second optional grouping.\n\nOLD: ^http:\\/\\/([^\\x2F]+\\/)+(ORDER|Rech|CUST|Cust)(.)?(-Document)?-[0-9]{10,11}\\/$ NEW:\n^http:\\/\\/([^\\x2F]+\\/)+(ORDER|Rech|CUST|Cust|gescanntes|Scan)(.)?(-Document|-Dokument)?-[0-9]\n{10,11}\\/$\n\nAlright, now I've cleared all of the remaining matches.\n\n[+] FOUND [+] Count: 127/696 Comment: [Group 01] - [ t5wx-x064-mzdb ] PCRE:\n^http:\\/\\/([^\\x2F]+\\/)+[a-zA-Z0-9]{3,7}-[a-zA-Z0-9]{3,5}-[a-zA-Z]{1,5}\\/$ [+] FOUND [+] Count: 80/696\nComment: [Group 02] - [ INVOICE-864339-98261 ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+\n(INVOICE|ORDER|CUST|Invoice|Cust)-[0-9]{6,7}-[0-9]{4,5}\\/$ [+] FOUND [+] Count: 199/696 (+9)\nComment: [Group 03] - [ H27560xzwsS ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+[a-zA-Z0-9]{4,26}\\/$ [+] FOUND\n\n[+] Count: 56/696 Comment: [Group 04] - [ RRT-13279129.dokument ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+\n\n[A-Z]{2,3}-[0-9]{8}\\.dokument\\/$ [+] FOUND [+] Count: 86/696 Comment: [Group 05] - [ EDHFR-0877623-document-May-04-2017 ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+[A-Z]{2,5}(-[0-9]{2})?-[0-9]{5,10}(document|doc)-May-[0-9]{2}-2017\\/$ [+] FOUND [+] Count: 62/696 Comment: [Group 06] - [\ndownload2467 ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+download[0-9]{4}\\/$ [+] FOUND [+] Count: 47/696 (+4)\nComment: [Group 07] - [ LUqc663BAyN333-HoO ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+[a-zA-Z0-9]{10,15}-[azA-Z]{1,3}\\/$ [+] FOUND [+] Count: 14/696 (+4) Comment: [Group 08] - [ NUDA-X-52454-DE ]\nPCRE: ^http:\\/\\/([^\\x2F]+\\/)+[A-Z]{4,5}-[A-Z]{1,4}-[0-9]{5}-[A-Z]{2}\\/$ [+] FOUND [+] Count: 38/696 (+2)\n\n\n-----\n\nComment: [Group 09] - [ CUST.-Document-YDI-04-GQ389557 ] PCRE: http:\\/\\/([ \\x2F]+\\/)+\n(CUST|ORDER|Cust|Rech|Rechnung)(.)?(-Document)?-[A-Z]{1,4}-[0-9]{2,3}-[A-Z0-9]{6,10}\\/$ [+]\nFOUND [+] Count: 11/696 (+1) Comment: [Group 10] - [ zp3x-r88-wuh.view ] PCRE:\n^http:\\/\\/([^\\x2F]+\\/)+[a-z0-9]{1,5}-[a-z0-9]{2,4}(-[a-z0-9]{4,5})?-[a-z]{1,4}\\.(view|doc)\\/$ [+] FOUND [+]\nCount: 3/696 Comment: [Group 11] - [ dhl___status___2668292851 ] PCRE:\n^http:\\/\\/([^\\x2F]+\\/)+dhl___status___[0-9]{10}\\/$ [+] FOUND [+] Count: 35/696 (+4) Comment: [Group\n12] - [ ORDER.-5883789520 ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+\n(ORDER|Rech|CUST|Cust|gescanntes|Scan)(.)?(-Document|-Dokument)?-[0-9]{10,11}\\/$\n\nRound 6\n\nThe next step is to validate the matches with the \"-s\" flag in pcre_check. This will show all of the\nrespective matches under each PCRE. For this phase, I just eyeball it to make sure there is no\noverlap and what's expected in each group is present.\n\nAll of the PCRE's look solid except Group 3, which I already mentioned would need more TLC, as it\noverlaps with other PCRE's.\n\nFor Group 3, I'm going to visually break these down. I'll put 5 examples under each sub-grouping to\nshow how I separated them. Some are very good for matching while others will just have to be left\nbehind. TAKE NOTE BAD GUYS, BEING GENRIC IS GOOD, UNIQUE SNOWFLAKES ARE THE\nFIRST AGAINST THE WALL.\n\n**[Group 03] - [ dhl/paket/com/pkp/appmanager/8376315127 ]**\n\nhttp://8kindsoffun.com/dhl/paket/com/pkp/appmanager/8376315127/\nhttp://balletopia.org/dhl/paket/com/pkp/appmanager/7293445574/\nhttp://cnwconsultancy.com/dhl/paket/com/pkp/appmanager/0622636111/\nhttp://cookieco.com/dhl/paket/com/pkp/appmanager/8333287922/\nhttp://cspdx.com/dhl/paket/com/pkp/appmanager/6213914600/\n\nI think thins one would have stood out earlier had it not been clobbered by the previous PCRE. The\npath is very unique and ends with 10 digits. This PCRE will replace the old one for Group 3 and the\nother new ones will start at Group 13.\n\n^http:\\/\\/([^\\x2F]+\\/)+dhl\\/paket\\/com\\/pkp\\/appmanager\\/[0-9]{10}\\/$\n\n**[Group 13] - [ 6572646300 ]**\n\nhttp://alfareklama.cz/6572646300/ http://algicom.net/6673413599/ http://bourdin.name/0014489972/\nhttp://carbitech.net/dhl/2354409458/ http://dsltech.co.uk/0217183208/ ...\nhttp://oscartvazquez.com/DHL24/15382203695/\n\nI'm going to create a PCRE for this one but I don't expect it to live past the FP check. There is one\nthat stands off from the rest here with 11 numbers instead of 10 - it may be that I just don't have\nenough samples to account for that campaign. Finally, I'll need to exclude the previous set of\nmatches which also end with 10 digits. To do this, I'll use a negative lookbehind to ensure once we\nmatch 10 digits, \"appmanager\" was not in the URL path.\n\n^http:\\/\\/([^\\x2F]+\\/)+(?&LT;!appmanager\\/)[0-9]{10,11}\\/$\n\n\n-----\n\n**[ alpha(lower) ]**\n\nhttp://aifesdespets.fr/kkrxtsmodw/ http://beowulf7.com/kgcee/ http://bunngalow.com/injeutznnb/\nhttp://carbofilms.com/cms/wp-content/upgrade/jcnfkvken/ http://dolphinrunvb.com/yozypdznpb/\n\nI don't see any good patterns in this set or the next one.\n\n**[ alpha(lower)numeric ]**\n\nhttp://benard.ca/z49641l/ http://jaqua.us/hid4kiwcvd84fljkpqpl/\nhttp://krakhud.pl/rguen0ebxndrci41frworbr/ http://micromatrices.com/qwh7zxijifxsnxg20mlwa/\nhttp://patu.ch/bgrvm2wqpjw74hz/\n\n**[Group 14] [ SCANNED/RZ7498WEXEZB ]**\n\nhttp://icaredentalstudio.com/APE88743TZ/ http://lbcd.se/MFV09235UA/\nhttp://lucasliftruck.com/SCANNED/RZ7498WEXEZB/ http://meanconsulting.com/K44975X/\nhttp://sentios.lt/W95941C/ http://triadesolucoes.com.br/SCANNED/RBA6517MHPKCZDEX/\nhttp://xyphoid.com/SCANNED/MM3431UCNPCEZRO/ http://zahahadidmiami.com/K38258Q/\n\nThis group was characterized by alpha(upper)numeric, which normally wouldn't be worth pattern\nmatching, but I can see two patterns in the above that may be worth entertaining. For Group 14, I'll\nmatch on the URL's with \"SCANNED\" string in the path and the unique placement of the digits within\nthe string: 2-3 alpha(upper), 4 digits, 6-9 alpha(upper).\n\n^http:\\/\\/([^\\x2F]+\\/)+SCANNED\\/[A-Z]{2,3}[0-9]{4}[A-Z]{6,9}\\/$\n\n**[Group 15] [ K44975X ]**\n\nhttp://meanconsulting.com/K44975X/ http://sentios.lt/W95941C/\nhttp://zahahadidmiami.com/K38258Q/\n\nFor Group 15, I'll match on 1 alpha(upper), 5 digits, 1 alpha(upper). The non-matched ones in the\nprevious Group 14 may be an expanded part of this campaign but it's such a weak PCRE and prone\nto FP that I'm not going to bother with it. It's highly likely to not make the final cut either way.\n\n^http:\\/\\/([^\\x2F]+\\/)+[A-Z]{1}[0-9]{5}[A-Z]{1}\\/$\n\n**[ alphanumeric long 18-26 ]**\n\nhttp://akhmerov.com/AuHffUo4L1BcEmca0BW5e4UtI/ http://arosa.nl/crm/xs2ckmwotgcml95cxdhbo/\nhttp://crosslink.ca/nWlKL3PdKyi1goahyZfbNr/ http://ideaswebstudio.com/v3mzbzaink00sndmyz/\nhttp://infojass.com/gvtsl7ddrnjkupn50pp/\n\nNothing jumps out at me that would make for a good PCRE. It has a similar structure of alpha, digit,\nalpha but the ranges are very broad which makes it highly prone to FP again.\n\n**[ alphanumeric short 7-14 ]**\n\n\n-----\n\nhttp://akirmak.com/QhS33472le/ http://austinaaron.com/eCjH94174LaN/\nhttp://campanus.cz/N6571iwA/ http://carolsgardeninn.com/vX94098JvVJ/\nhttp://cdoprojectgraduation.com/eaSz15612O/ ... http://www.alfredomartinez.com.mx/Afz3999lDtz/\nhttp://www.kreodesign.pl/test/O77405ccSC/ http://www.prodzakaz.com.ua/H27560xzwsS/\nhttp://www.voloskof.net/Sn83160EngQs/ http://zonasacra.com/zH83293YizhQ/\n\nThis next one follows the same pattern I identified for Group 15: 1-5 alphanumeric, 4-5 digits, 1-5\nalphanumeric. I'll just update Group 15 and see how it fairs in the FP check, but for what it's worth, it\ndoes match every single entry in this category which had 30+.\n\nOLD: ^http:\\/\\/([^\\x2F]+\\/)+[A-Z]{1}[0-9]{5}[A-Z]{1}\\/$ NEW: ^http:\\/\\/([^\\x2F]+\\/)+[A-Za-z]{1,4}[0-9]{4,5}\n\n[a-zA-Z]{1,5}\\/$\n\nRefinement\n\nNow that everything is clustered together, I'll do one final visual inspection to see if any other patterns\njump out that allow us to tighten the rules up and avoid FP's.\n\n**[Group 01] - [ t5wx-x064-mzdb ]**\n\nhttp://12back.com/dw3wz-ue164-qqv/ http://4glory.net/p7lrq-s191-iv/ http://aconai.fr/v4OZ-PR72-gtS/\nhttp://adamkranitz.com/gqj5ijg-y250-ex/ http://allisonhibbard.com/x4b-th601-m/\n\nIn Group 1, we can actually refine this a bit once you see the underlying pattern. Almost every part of\nthis one changed so I'll just go back over it: 1-3 alpha, 1 digit, 1-3 alpha, dash, 1-2 alpha, 2-3 digit,\ndash, 1-5 alpha.\n\nOLD: ^http:\\/\\/([^\\x2F]+\\/)+[a-zA-Z0-9]{3,7}-[a-zA-Z0-9]{3,5}-[a-zA-Z]{1,5}\\/$ NEW:\n^http:\\/\\/([^\\x2F]+\\/)+[a-zA-Z]{1,3}[0-9]{1}[a-zA-Z]{1,3}-[a-zA-Z]{1,2}[0-9]{2,3}-[a-zA-Z]{1,5}\\/$\n\n**[Group 07] - [ LUqc663BAyN333-HoO ]**\n\nhttp://agenity.com/EAVx829uahI723-tv/ http://argoinf.com/YFSR334KgXCe907-z/\nhttp://artmedieval.net/RK415njzzR555-p/ http://autoradio.com.br/fRq804tvz270-tWa/ http://beliefsystems.com/obn247eaC420-Z/\n\nIn Group 7, the first part of the pattern can be refined: 1-4 alphanumeric, 3 digits, 1-5 alphanumeric,\n3 digits.\n\nOLD: ^http:\\/\\/([^\\x2F]+\\/)+[a-zA-Z0-9]{10,15}-[a-zA-Z]{1,3}\\/$ NEW: ^http:\\/\\/([^\\x2F]+\\/)+[a-zA-Z0-9]\n{1,4}[0-9]{3}[a-zA-Z]{1,5}[0-9]{3}-[a-zA-Z]{1,3}\\/$\n\n**[Group 08] - [ NUDA-X-52454-DE ]**\n\nhttp://altius.co.in/EJZB-T-66361-DE/ http://anjep.com/TBWEV-YCAP-91327-DE/\nhttp://aquarthe.com/AIUO-P-70826-DE/ http://bitach.com/RIJW-FNFE-86299-DE/\nhttp://cliftonsecurities.co.uk/YJTX-NMO-51102-DE/\n\nIn Group 8 they all end with \"DE\" so I'll convert that part to a static string.\n\n\n-----\n\nOLD: http:\\/\\/([ \\x2F]+\\/)+[A-Z]{4,5}-[A-Z]{1,4}-[0-9]{5}-[A-Z]{2}\\/$ NEW: http:\\/\\/([ \\x2F]+\\/)+[A-Z]\n{4,5}-[A-Z]{1,4}-[0-9]{5}-DE\\/$\n\n**[Group 09] - [ CUST.-Document-YDI-04-GQ389557 ]**\n\nhttp://archabits.com/ORDER.-AXN-60-X400251/ http://arrosio.com.ar/ORDER.-Document-SF-41F318806/ http://arroyave.net/Rech-K-682-GO1130/ http://avenueevents.co.uk/Cust-PBP-03D683320/ http://babyo.com.mx/Cust-Document-KEQ-04-FF065857/\n\nIn Group 9, every entry entry ends with 1-3 alpha(upper) followed by 4-6 digits.\n\nOLD: ^http:\\/\\/([^\\x2F]+\\/)+(CUST|ORDER|Cust|Rech|Rechnung)(.)?(-Document)?-[A-Z]{1,4}-[0-9]\n{2,3}-[A-Z0-9]{6,10}\\/$ NEW: ^http:\\/\\/([^\\x2F]+\\/)+(CUST|ORDER|Cust|Rech|Rechnung)(.)?(Document)?-[A-Z]{1,4}-[0-9]{2,3}-[A-Z]{1,3}[0-9]{4,6}\\/$\n\nThe final run for the PCRE's before FP testing.\n\n[+] FOUND [+] Count: 127/696 Comment: [Group 01] - [ t5wx-x064-mzdb ] PCRE:\n^http:\\/\\/([^\\x2F]+\\/)+[a-zA-Z]{1,3}[0-9]{1}[a-zA-Z]{1,3}-[a-zA-Z]{1,2}[0-9]{2,3}-[a-zA-Z]{1,5}\\/$ [+]\nFOUND [+] Count: 80/696 Comment: [Group 02] - [ INVOICE-864339-98261 ] PCRE:\n^http:\\/\\/([^\\x2F]+\\/)+(INVOICE|ORDER|CUST|Invoice|Cust)-[0-9]{6,7}-[0-9]{4,5}\\/$ [+] FOUND [+]\nCount: 29/696 (changed to new pattern) Comment: [Group 03] - [\ndhl/paket/com/pkp/appmanager/8376315127 ] PCRE:\n^http:\\/\\/([^\\x2F]+\\/)+dhl\\/paket\\/com\\/pkp\\/appmanager\\/[0-9]{10}\\/$ [+] FOUND [+] Count: 56/696\nComment: [Group 04] - [ RRT-13279129.dokument ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+[A-Z]{2,3}-[0-9]\n{8}\\.dokument\\/$ [+] FOUND [+] Count: 86/696 Comment: [Group 05] - [ EDHFR-08-77623document-May-04-2017 ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+[A-Z]{2,5}(-[0-9]{2})?-[0-9]{5,10}(document|doc)-May-[0-9]{2}-2017\\/$ [+] FOUND [+] Count: 62/696 Comment: [Group 06] - [\ndownload2467 ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+download[0-9]{4}\\/$ [+] FOUND [+] Count: 47/696\nComment: [Group 07] - [ LUqc663BAyN333-HoO ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+[a-zA-Z0-9]{1,4}[0-9]\n{3}[a-zA-Z]{1,5}[0-9]{3}-[a-zA-Z]{1,3}\\/$ [+] FOUND [+] Count: 14/696 Comment: [Group 08] - [\nNUDA-X-52454-DE ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+[A-Z]{4,5}-[A-Z]{1,4}-[0-9]{5}-DE\\/$ [+] FOUND [+]\nCount: 38/696 Comment: [Group 09] - [ CUST.-Document-YDI-04-GQ389557 ] PCRE:\n^http:\\/\\/([^\\x2F]+\\/)+(CUST|ORDER|Cust|Rech|Rechnung)(.)?(-Document)?-[A-Z]{1,4}-[0-9]{2,3}-[AZ]{1,3}[0-9]{4,6}\\/$ [+] FOUND [+] Count: 11/696 Comment: [Group 10] - [ zp3x-r88-wuh.view ]\nPCRE: ^http:\\/\\/([^\\x2F]+\\/)+[a-z0-9]{1,5}-[a-z0-9]{2,4}(-[a-z0-9]{4,5})?-[a-z]{1,4}\\.(view|doc)\\/$ [+]\nFOUND [+] Count: 3/696 Comment: [Group 11] - [ dhl___status___2668292851 ] PCRE:\n^http:\\/\\/([^\\x2F]+\\/)+dhl___status___[0-9]{10}\\/$ [+] FOUND [+] Count: 35/696 Comment: [Group 12]\n\n- [ ORDER.-5883789520 ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+(ORDER|Rech|CUST|Cust|gescanntes|Scan)\n(.)?(-Document|-Dokument)?-[0-9]{10,11}\\/$ [+] FOUND [+] Count: 15/696 Comment: [Group 13] - [\n6572646300 ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+(?&LT;!appmanager\\/)[0-9]{10,11}\\/$ [+] FOUND [+] Count:\n3/696 Comment: [Group 14] [ SCANNED/RZ7498WEXEZB ] PCRE:\n^http:\\/\\/([^\\x2F]+\\/)+SCANNED\\/[A-Z]{2,3}[0-9]{4}[A-Z]{6,9}\\/$ [+] FOUND [+] Count: 60/696\nComment: [Group 15] [ K44975X ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+[A-Za-z]{1,4}[0-9]{4,5}[a-zA-Z]{1,5}\\/$\n\nThat leaves only 30 URL's that I was unable to reliably match - not too shabby! You can find the\n[output of the pcre_check script showing the matches and non-matches HERE.](https://github.com/karttoon/pcre_check/blob/master/emotet_v6_matches)\n\n\n-----\n\nThe current PCRE list is below.\n\n^http:\\/\\/([^\\x2F]+\\/)+[a-zA-Z]{1,3}[0-9]{1}[a-zA-Z]{1,3}-[a-zA-Z]{1,2}[0-9]{2,3}-[a-zA-Z]{1,5}\\/$ [Group\n01] - [ t5wx-x064-mzdb ] ^http:\\/\\/([^\\x2F]+\\/)+(INVOICE|ORDER|CUST|Invoice|Cust)-[0-9]{6,7}-[0-9]\n{4,5}\\/$ [Group 02] - [ INVOICE-864339-98261 ]\n^http:\\/\\/([^\\x2F]+\\/)+dhl\\/paket\\/com\\/pkp\\/appmanager\\/[0-9]{10}\\/$ [Group 03] - [\ndhl/paket/com/pkp/appmanager/8376315127 ] ^http:\\/\\/([^\\x2F]+\\/)+[A-Z]{2,3}-[0-9]{8}\\.dokument\\/$\n\n[Group 04] - [ RRT-13279129.dokument ] ^http:\\/\\/([^\\x2F]+\\/)+[A-Z]{2,5}(-[0-9]{2})?-[0-9]{5,10}(document|doc)-May-[0-9]{2}-2017\\/$ [Group 05] - [ EDHFR-08-77623-document-May-04-2017 ]\n^http:\\/\\/([^\\x2F]+\\/)+download[0-9]{4}\\/$ [Group 06] - [ download2467 ] ^http:\\/\\/([^\\x2F]+\\/)+[a-zA-Z09]{1,4}[0-9]{3}[a-zA-Z]{1,5}[0-9]{3}-[a-zA-Z]{1,3}\\/$ [Group 07] - [ LUqc663BAyN333-HoO ]\n^http:\\/\\/([^\\x2F]+\\/)+[A-Z]{4,5}-[A-Z]{1,4}-[0-9]{5}-DE\\/$ [Group 08] - [ NUDA-X-52454-DE ]\n^http:\\/\\/([^\\x2F]+\\/)+(CUST|ORDER|Cust|Rech|Rechnung)(.)?(-Document)?-[A-Z]{1,4}-[0-9]{2,3}-[AZ]{1,3}[0-9]{4,6}\\/$ [Group 09] - [ CUST.-Document-YDI-04-GQ389557 ] ^http:\\/\\/([^\\x2F]+\\/)+[a-z0-9]\n{1,5}-[a-z0-9]{2,4}(-[a-z0-9]{4,5})?-[a-z]{1,4}\\.(view|doc)\\/$ [Group 10] - [ zp3x-r88-wuh.view ]\n^http:\\/\\/([^\\x2F]+\\/)+dhl___status___[0-9]{10}\\/$ [Group 11] - [ dhl___status___2668292851 ]\n^http:\\/\\/([^\\x2F]+\\/)+(ORDER|Rech|CUST|Cust|gescanntes|Scan)(.)?(-Document|-Dokument)?-[0-9]\n{10,11}\\/$ [Group 12] - [ ORDER.-5883789520 ] ^http:\\/\\/([^\\x2F]+\\/)+(?&LT;!appmanager\\/)[0-9]\n{10,11}\\/$ [Group 13] - [ 6572646300 ] ^http:\\/\\/([^\\x2F]+\\/)+SCANNED\\/[A-Z]{2,3}[0-9]{4}[A-Z]{6,9}\\/$\n\n[Group 14] [ SCANNED/RZ7498WEXEZB ] ^http:\\/\\/([^\\x2F]+\\/)+[A-Za-z]{1,4}[0-9]{4,5}[a-zA-Z]{1,5}\\/$\n\n[Group 15] [ K44975X ]\n\nRule Vetting\n\nThe last step is to check the PCRE's against a corpus of random URL's and see if they appear strict\nenough in their matching to be used in a production environment. This is critical if you plan to use\nthem for blocking instead of just identification. I can't stress enough how important this phase is;\nwhile it's nice to be alerted on access to one of these URL's, it's solid gold if you can prevent attacks\nand C2 from happening in the first place. Of course, with any blocking action, the caveat is that one\nwrong block could spell disaster so these need to be as close to perfect as possible.\n\nIdeally, you want to test against a large amount of URL's from your own environment that most\nclosely resemble what traffic your users generate. Unfortunately that's not always possible, or you\ndon't have users, so you need to either build your own corpus or find someone who can test the\nPCRE's for you.\n\nThere isn't much online in the way of random URL lists or logs but I've put together a few possible\nmethods one could try to compile a fairly random set of URL's, and then I'll detail my preferred\nmethod.\n\nSetup a TOR exit node for TCP/80 and just scrape URL's as they traverse.\nHit up a site like [Lenny Zeltser's blocklist page to get a list of other frequently updated](https://zeltser.com/malicious-ip-blocklists/)\nblocklists. These are mainly malicious though so not quite random.\n[Search Pastebin for \"http\" and pull pull out URL's. They have a Pastebin Scraping API ($24/yr)](https://pastebin.com/api_scraping_faq)\nto pull down the most recent posts. Sometimes you'll find huge lists with little effort.\n[Use some open data sets. Definitely not too random and much more limited in scope.](http://opensource.indeedeng.io/imhotep/docs/sample-data/)\nUse [Twitter Streaming API and filter Tweets for \"http\".](https://dev.twitter.com/streaming/overview)\n\n\n-----\n\nThe Twitter option works nicely and can generate hundreds of thousands of unique URL s per day.\nGiven enough time, you'll have a solid base to test your PCRE's against.\n\nTo do this, you need to [register an app with Twitter and get your API keys. Once you have those, I've](https://apps.twitter.com/)\n[included a Python script, twitter_scraper that you can input them into and run in a continous loop with](https://github.com/karttoon/pcre_check/blob/master/twitter_scraper.py)\na one-liner like the below.\n\nwhile true; do sleep 5; python twitter_scraper.py >> twitter_urls; done\n\n[I've also included 2 million URL's on GitHub, which is just under the 25MB file limit compressed.](https://github.com/karttoon/pcre_check/blob/master/twitter_urls.7z)\nThese are ones that I've scraped in the past few days and should help you get started.\n\nTypically I'll check this every so often and filter out things like URL shortening services or other sites\nthat, for one reason or another, have bubbled up to the top of my domain list. This keeps it filled with\nfairly unique sites and helps improve entropy.\n\nBelow is a GIF of the sites streaming by in real time, showing some of the variety.\n\nOnce we have our list, we can run pcre_check against the URL's and see how our PCRE's fare.\n\n$ python pcre_check.py -u twitter_urls -p emotet_pcres -s [+] FOUND [+] Count: 1290/2000000\nComment: [Group 13] - [ 6572646300 ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+(?&LT;!appmanager\\/)[0-9]\n{10,11}\\/$ [-] MATCH [-] http://db.netkeiba.com/horse/1985105175/ ...\nhttp://www.northernminer.com/news/lukas-lundin-copper-commodity-choice/1003786598/\nhttp://www.oita-trinita.co.jp/news/20170532318/ ... http://www.schuh.co.uk/womens/irregular-choicex-disney-how-do-i-look?-pink-flat-shoes/1364153360/ ... http://www.yutaromiura.com/info/event/2017/0528100324/ http://yapi.ta2o.net/maseli/2017052901/ [+] FOUND [+]\nCount: 2595/2000000 Comment: [Group 15] [ K44975X ] PCRE: ^http:\\/\\/([^\\x2F]+\\/)+[A-Za-z]{1,4}[09]{4,5}[a-zA-Z]{1,5}\\/$ [-] MATCH [-] http://epcaf.com/c2805tw/ ...\nhttp://hobbyostrov.ru/automodels/electro-monster-1-10/tra3602g/ ...\nhttp://monipla.jp/mfpa/card2017ss/ http://ncode.syosetu.com/N0588Q/ ...\nhttp://www.nollieskateboarding.com/fs5050grind/ http://www.profootballweekly.com/2017/05/30/victorcruz-prepared-to-produce-and-mentor-in-chicago-bears-transitioning-wr-corps/a4613p/\n\nUsing the \"-s\" (show matches) flag in pcre_check will allow you to manually review the false\npositives. If the sites don't look legitimate or match a little too perfectly, you'll want to do a little\nmanual research to make sure they are in fact FP's and not true positives you didn't know about. I've\n\n\n-----\n\ntruncated the results but above shows a few under each to give you an idea of the kind of output I m\nlooking for to conclude it's not up-to-par.\n\nAs you can see, Group 13 and 15 have numerous false-positives. This isn't surprising given Group\n13 is simply 10 digits and Group 15 is a small range of alpha, digits, alpha, which continued to repeat\nitself throughout my analysis.\n\nAdditionally, I sent these PCRE's to some fellow miscreant punchers who ran them through over\nbillions of URL's from their environment and received similar output with FP's only for Group 13 and\n15.\n\nThe last check I'll perform for this set is to remove the trailing forward slash (\"/\") that was included in\nthe PCRE's. The reason for this is that, while my Emotet seed list all included the forward slash, the\nURL's I'm scraping may not have it and I just want to try to further identify any potential issues.\n\n$ python pcre_check.py -p emotet_pcres_mod -u twitter_urls\n\nNadda. Fantastic!\n\nWrapping-up\n\nAll in all, 13 total PCRE's make the cut and cover the seen Emotet download URL's. These will\nprovide good historical forensic capability and good passive blocking for future victims of these\ncampaigns.\n\nWith that, the below is the [final list for publishing and available on GitHub, along with all of the above](https://github.com/karttoon/pcre_check/blob/master/emotet_pcres)\niterations.\n\n^http:\\/\\/([^\\x2F]+\\/)+[a-zA-Z]{1,3}[0-9]{1}[a-zA-Z]{1,3}-[a-zA-Z]{1,2}[0-9]{2,3}-[a-zA-Z]{1,5}\\/$ karttoon\n31MAY2017 - Emotet download - [ t5wx-x064-mzdb ] ^http:\\/\\/([^\\x2F]+\\/)+\n(INVOICE|ORDER|CUST|Invoice|Cust)-[0-9]{6,7}-[0-9]{4,5}\\/$ karttoon 31MAY2017 - Emotet\ndownload - [ INVOICE-864339-98261 ] ^http:\\/\\/([^\\x2F]+\\/)+dhl\\/paket\\/com\\/pkp\\/appmanager\\/[0-9]\n{10}\\/$ karttoon 31MAY2017 - Emotet download - [ dhl/paket/com/pkp/appmanager/8376315127 ]\n^http:\\/\\/([^\\x2F]+\\/)+[A-Z]{2,3}-[0-9]{8}\\.dokument\\/$ karttoon 31MAY2017 - Emotet download - [ RRT13279129.dokument ] ^http:\\/\\/([^\\x2F]+\\/)+[A-Z]{2,5}(-[0-9]{2})?-[0-9]{5,10}-(document|doc)-May-[0-9]\n{2}-2017\\/$ karttoon 31MAY2017 - Emotet download - [ EDHFR-08-77623-document-May-04-2017 ]\n^http:\\/\\/([^\\x2F]+\\/)+download[0-9]{4}\\/$ karttoon 31MAY2017 - Emotet download - [ download2467 ]\n^http:\\/\\/([^\\x2F]+\\/)+[a-zA-Z0-9]{1,4}[0-9]{3}[a-zA-Z]{1,5}[0-9]{3}-[a-zA-Z]{1,3}\\/$ karttoon 31MAY2017\n\n- Emotet download - [ LUqc663BAyN333-HoO ] ^http:\\/\\/([^\\x2F]+\\/)+[A-Z]{4,5}-[A-Z]{1,4}-[0-9]{5}DE\\/$ karttoon 31MAY2017 - Emotet download - [ NUDA-X-52454-DE ] ^http:\\/\\/([^\\x2F]+\\/)+\n(CUST|ORDER|Cust|Rech|Rechnung)(.)?(-Document)?-[A-Z]{1,4}-[0-9]{2,3}-[A-Z]{1,3}[0-9]{4,6}\\/$\nkarttoon 31MAY2017 - Emotet download - [ CUST.-Document-YDI-04-GQ389557 ]\n^http:\\/\\/([^\\x2F]+\\/)+[a-z0-9]{1,5}-[a-z0-9]{2,4}(-[a-z0-9]{4,5})?-[a-z]{1,4}\\.(view|doc)\\/$ karttoon\n31MAY2017 - Emotet download - [ zp3x-r88-wuh.view ] ^http:\\/\\/([^\\x2F]+\\/)+dhl___status___[0-9]\n{10}\\/$ karttoon 31MAY2017 - Emotet download - [ dhl___status___2668292851 ]\n^http:\\/\\/([^\\x2F]+\\/)+(ORDER|Rech|CUST|Cust|gescanntes|Scan)(.)?(-Document|-Dokument)?-[0-9]\n{10,11}\\/$ karttoon 31MAY2017 - Emotet download - [ ORDER.-5883789520 ]\n^http:\\/\\/([^\\x2F]+\\/)+SCANNED\\/[A-Z]{2,3}[0-9]{4}[A-Z]{6,9}\\/$ karttoon 31MAY2017 - Emotet\ndownload [ SCANNED/RZ7498WEXEZB ]\n\n\n-----\n\nHopefully this was helpful to some and demonstrated the ease in which these can be created to\nidentify malicious patterns.\n\nThe more the merrier in the sharing community!\n\nCiao!\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-05-31 - Writing PCRE's for applied passive network defense [Emotet].pdf"
    ],
    "report_names": [
        "2017-05-31 - Writing PCRE's for applied passive network defense [Emotet].pdf"
    ],
    "threat_actors": [
        {
            "id": "4b076dcb-516e-42fb-9c8f-f153902cd5e9",
            "created_at": "2022-10-25T16:07:23.708745Z",
            "updated_at": "2025-03-27T02:02:09.935617Z",
            "deleted_at": null,
            "main_name": "Hidden Lynx",
            "aliases": [
                "Aurora Panda",
                "Group 8",
                "Hidden Lynx",
                "Operation SMN"
            ],
            "source_name": "ETDA:Hidden Lynx",
            "tools": [
                "AGENT.ABQMR",
                "AGENT.AQUP.DROPPER",
                "AGENT.BMZA",
                "AGENT.GUNZ",
                "BlackCoffee",
                "HiKit",
                "MCRAT.A",
                "Mdmbot.E",
                "Moudoor",
                "Naid",
                "PNGRAT",
                "Trojan.Naid",
                "ZoxPNG",
                "gresim"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "dabb6779-f72e-40ca-90b7-1810ef08654d",
            "created_at": "2022-10-25T15:50:23.463113Z",
            "updated_at": "2025-03-27T02:00:55.47619Z",
            "deleted_at": null,
            "main_name": "APT1",
            "aliases": [
                "APT1",
                "Comment Crew",
                "Comment Group",
                "Comment Panda"
            ],
            "source_name": "MITRE:APT1",
            "tools": [
                "Seasalt",
                "ipconfig",
                "Cachedump",
                "PsExec",
                "GLOOXMAIL",
                "Lslsass",
                "PoisonIvy",
                "WEBC2",
                "Mimikatz",
                "gsecdump",
                "Pass-The-Hash Toolkit",
                "Tasklist",
                "xCmd",
                "pwdump"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "3fad11c6-4336-4b28-a606-f510eca5452e",
            "created_at": "2022-10-25T16:07:24.346573Z",
            "updated_at": "2025-03-27T02:02:10.183211Z",
            "deleted_at": null,
            "main_name": "Turbine Panda",
            "aliases": [
                "APT 26",
                "Black Vine",
                "Bronze Express",
                "Group 13",
                "JerseyMikes",
                "KungFu Kittens",
                "PinkPanther",
                "Shell Crew",
                "Turbine Panda",
                "WebMasters"
            ],
            "source_name": "ETDA:Turbine Panda",
            "tools": [
                "Agent.dhwf",
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "Derusbi",
                "Destroy RAT",
                "DestroyRAT",
                "FF-RAT",
                "FormerFirstRAT",
                "Hurix",
                "Kaba",
                "Korplug",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Mivast",
                "PlugX",
                "RbDoor",
                "RedDelta",
                "RibDoor",
                "Sakula",
                "Sakula RAT",
                "Sakurel",
                "Sogu",
                "StreamEx",
                "TIGERPLUG",
                "TVT",
                "Thoper",
                "Winnti",
                "Xamtrav",
                "cobeacon",
                "ffrat"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "cf7fc640-acfe-41c4-9f3d-5515d53a3ffb",
            "created_at": "2023-01-06T13:46:38.228042Z",
            "updated_at": "2025-03-27T02:00:02.775905Z",
            "deleted_at": null,
            "main_name": "APT1",
            "aliases": [
                "GIF89a",
                "G0006",
                "PLA Unit 61398",
                "Group 3",
                "TG-8223",
                "Comment Group",
                "ShadyRAT",
                "COMMENT PANDA",
                "Comment Crew",
                "Byzantine Candor",
                "Brown Fox"
            ],
            "source_name": "MISPGALAXY:APT1",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "a7aefdda-98f1-4790-a32d-14cc99de2d60",
            "created_at": "2023-01-06T13:46:38.281844Z",
            "updated_at": "2025-03-27T02:00:02.792526Z",
            "deleted_at": null,
            "main_name": "APT17",
            "aliases": [
                "G0025",
                "AURORA PANDA",
                "Group 72",
                "G0001",
                "HELIUM",
                "Group 8",
                "Hidden Lynx",
                "Tailgater Team",
                "BRONZE KEYSTONE"
            ],
            "source_name": "MISPGALAXY:APT17",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "46a151bd-e4c2-46f9-aee9-ee6942b01098",
            "created_at": "2023-01-06T13:46:38.288168Z",
            "updated_at": "2025-03-27T02:00:02.794118Z",
            "deleted_at": null,
            "main_name": "APT19",
            "aliases": [
                "Black Vine",
                "TEMP.Avengers",
                "PinkPanther",
                "G0073",
                "KungFu Kittens",
                "Group 13",
                "Shell Crew",
                "BRONZE FIRESTONE",
                "G0009",
                "Sunshop Group",
                "DEEP PANDA",
                "Codoso"
            ],
            "source_name": "MISPGALAXY:APT19",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "3aaf0755-5c9b-4612-9f0e-e266ef1bdb4b",
            "created_at": "2022-10-25T16:07:23.480196Z",
            "updated_at": "2025-03-27T02:02:09.826059Z",
            "deleted_at": null,
            "main_name": "Comment Crew",
            "aliases": [
                "APT 1",
                "BrownFox",
                "Byzantine Candor",
                "Byzantine Hades",
                "Comment Crew",
                "Comment Panda",
                "GIF89a",
                "Group 3",
                "Operation Oceansalt",
                "Operation Seasalt",
                "Operation Siesta",
                "Shanghai Group",
                "TG-8223"
            ],
            "source_name": "ETDA:Comment Crew",
            "tools": [
                "Auriga",
                "Cachedump",
                "Chymine",
                "CookieBag",
                "Darkmoon",
                "GDOCUPLOAD",
                "GLOOXMAIL",
                "GREENCAT",
                "Gen:Trojan.Heur.PT",
                "GetMail",
                "Hackfase",
                "Hacksfase",
                "Helauto",
                "Kurton",
                "LETSGO",
                "LIGHTBOLT",
                "LIGHTDART",
                "LOLBAS",
                "LOLBins",
                "LONGRUN",
                "Living off the Land",
                "Lslsass",
                "MAPIget",
                "ManItsMe",
                "Mimikatz",
                "MiniASP",
                "Oceansalt",
                "Pass-The-Hash Toolkit",
                "Poison Ivy",
                "ProcDump",
                "Riodrv",
                "SPIVY",
                "Seasalt",
                "ShadyRAT",
                "StarsyPound",
                "TROJAN.COOKIES",
                "TROJAN.FOXY",
                "TabMsgSQL",
                "Tarsip",
                "Trojan.GTALK",
                "WebC2",
                "WebC2-AdSpace",
                "WebC2-Ausov",
                "WebC2-Bolid",
                "WebC2-Cson",
                "WebC2-DIV",
                "WebC2-GreenCat",
                "WebC2-Head",
                "WebC2-Kt3",
                "WebC2-Qbp",
                "WebC2-Rave",
                "WebC2-Table",
                "WebC2-UGX",
                "WebC2-Yahoo",
                "Wordpress Bruteforcer",
                "bangat",
                "gsecdump",
                "pivy",
                "poisonivy",
                "pwdump",
                "zxdosml"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536178,
    "ts_updated_at": 1743041813,
    "ts_creation_date": 1653787716,
    "ts_modification_date": 1653787716,
    "files": {
        "pdf": "https://archive.orkl.eu/9d155ce1d926aaa3ecc7fff90be0533adfbc8718.pdf",
        "text": "https://archive.orkl.eu/9d155ce1d926aaa3ecc7fff90be0533adfbc8718.txt",
        "img": "https://archive.orkl.eu/9d155ce1d926aaa3ecc7fff90be0533adfbc8718.jpg"
    }
}