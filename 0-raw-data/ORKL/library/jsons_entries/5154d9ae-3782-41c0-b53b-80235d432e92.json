{
    "id": "5154d9ae-3782-41c0-b53b-80235d432e92",
    "created_at": "2023-01-12T15:00:48.332969Z",
    "updated_at": "2025-03-27T02:12:11.122274Z",
    "deleted_at": null,
    "sha1_hash": "acd1f0e2b07b8593945e0ec00c21848a2ac12ca1",
    "title": "2020-01-20 - Behind the scenes of GandCrab’s operation",
    "authors": "",
    "file_creation_date": "2022-05-28T22:03:01Z",
    "file_modification_date": "2022-05-28T22:03:01Z",
    "file_size": 2476836,
    "plain_text": "# Behind the scenes of GandCrab’s operation\n\n**[virusbulletin.com/virusbulletin/2020/01/behind-scenes-gandcrabs-operation/](https://www.virusbulletin.com/virusbulletin/2020/01/behind-scenes-gandcrabs-operation/)**\n\n### AhnLab Security Analysis Team\n\n_AhnLab, South Korea_\n\nTable of contents\n\nAbstract\n\nIntroduction\n\nAnalysis by timeline\n\nScene #01: The prelude to war (GandCrab v2.x)\n\nScene #02: The adversary revealed (GandCrab v4.1.x)\n\nScene #03: GandCrab strikes back\n\nScene #04: GandCrab’s full-on attack\n\nScene #05: Endgame, the last battle\n\nConclusion\n\nReferences\n\n## Abstract\n\nThe GandCrab ransomware was active from January 2018 to May 2019. During its active\nstate, numerous variants were distributed worldwide, causing much damage.\n\nThis report examines the battle that went on between security vendor AhnLab and the\nGandCrab ransomware and includes details about GandCrab that have been unpublished\nuntil now.\n\n## Introduction\n\nThe GandCrab ransomware, which is no longer active, was actively distributed for a little\nover a year. GandCrab variants caused a great deal of damage worldwide, including in\nSouth Korea.\n\nThe GandCrab ransomware shares an interesting history with AhnLab. Like many other\nexamples of ransomware, GandCrab searches for any running or pre-installed anti‑malware\nprogram and when it finds one it interferes with its normal execution and shuts it down.\n\n\n-----\n\nHowever, when it came to AhnLab, GandCrab went the extra mile, specifically targeting the\ncompany and its anti-malware program V3 Lite by mentioning it in its code. It even revealed\na vulnerability in the security program and made attempts to delete it entirely.\n\nTo effectively respond to and protect against GandCrab attacks, the AhnLab Security\nAnalysis Team analysed GandCrab and all its different versions by thoroughly investigating\nthe distributed code, encryption method, restoration method, and the evasive method it\nused to avoid behaviour-based detection. Each time a new attack feature targeting AhnLab\nand V3 was identified, the company’s product developers promptly addressed it to ensure\nmaximum security.\n\nThe interesting conflict between AhnLab and the GandCrab ransomware was widely\ndiscussed in the IT security industry. However, the details that were revealed at the time\nwere only the tip of the iceberg, with more details being kept private for reasons of\nconfidentiality.\n\n## Analysis by timeline\n\n### Scene #01: The prelude to war (GandCrab v2.x)\n\nOn 8 February 2018 AhnLab reported in a blog post [1] the active distribution of GandCrab\nransomware in South Korea. Shortly afterwards, on 17 April, we released a kill switch to the\npublic [2] after having analysed how the ransomware worked. The kill switch prevented the\nencryption of files, thus interfering with GandCrab’s operation.\n\nThis triggered a battle between GandCrab and AhnLab. Three days later, a profanity\ndirected at AhnLab was found within the malware’s mutex name. The GandCrab creator did\nnot stop here but continued to express anger towards the company by changing the host\naddress from ‘google.com’ to ‘ahnlab.com’. The host address was used for C&C server\ncommunication and was randomly adjusted to avoid network filters.\n\nFigure 1: Mutex including profanity directed at AhnLab.\n\n\n-----\n\nThe encryption-blocking method that the kill switch had been based on was patched, and\nchanges were made to the internal version of GandCrab v3.0.0. However, we were able to\nidentify a new method of blocking encryption by utilizing the ransomware’s pop-up\nmessage, and we duly published this finding [3].\n\n### Scene #02: The adversary revealed (GandCrab v4.1.x)\n\nBy July 2018, GandCrab was being distributed by various means including drive-by\ndownloads, email, executable files and fileless malware. There was even a case where a\nmalicious script named ‘ahnlab.txt’ was distributed during a fileless attack using PowerShell.\n\nWhile AhnLab was engaged in battle with GandCrab in Southeast Asia, Fortinet was\nactively analysing and responding to GandCrab in real time halfway across the globe. On 9\nJuly, Fortinet released a method [4] that stopped the malware from infecting the system if\nthere existed a file named ‘<8hex-chars>.lock’ (e.g. ‘2078FBF8.lock’) in the user’s Common\nAppData directory.\n\nBased on the information shared by Fortinet, we were able to confirm that the new method\nwas valid for the latest version of the malware, v4.1.1, as well. On 13 July we released an\nexecutable file tool to the public [5].\n\nThe GandCrab creator retaliated immediately. A sarcastic text directed at both Fortinet and\n_AhnLab was included within the kill switch of v4.1.2, saying that the ‘.lock’ file wasn’t the_\nonly blocking method, following which the file generation logic for the ‘.lock’ file was\nchanged. However, we figured out the logic of v4.1.2 as well as v4.1.3 and updated the tool\naccordingly.\n\n\n-----\n\nFigure 2: Mention of AhnLab and Fortinet in the kill switch.\n\nWhile the kill switch in v4.1.2 mentioned both AhnLab and Fortinet, a slightly modified\ninternal version of v4.1.2 only included an ‘ahnlab’ string (see Figure 3). It also included a\nspecific URL which led to a page containing a profanity directed at AhnLab in Russian (see\nFigure 4).\n\n\n-----\n\nFigure 3: AhnLab string and URL included in a modified version of v4.1.2.\n\nProfanity directed at AhnLab in Russian.\n\n### Scene #03: GandCrab strikes back\n\n\nFigure 4:\n\n\n-----\n\nIn August 2018, the creator of GandCrab officially began to strike back. The creator\ncontacted tech site Bleeping Computer [6] and declared that the upcoming version of the\nGandCrab ransomware would contain a zero-day for AhnLab V3 Lite, also sharing a link to\nthe exploit code. The creator claimed that this was in retaliation for the kill switch having\nbeen released by AhnLab and went on to explain that the kill switch would no longer be\neffective in future versions of GandCrab.\n\nFigure 5: GandCrab creator announces alleged exploit attack of V3 Lite via Bleeping\nComputer [6].\n\nThen, the internal version of v4.2.1 revealed the attack pattern code for V3 Lite products,\nstating that it was a 1:1 score between AhnLab and GandCrab.\n\nFigure 6: GandGrab’s message to AhnLab hidden in GandCrab v4.2.1.\n\nThe alleged attack code that was revealed could trigger a BSOD if V3 Lite was installed in\nthe system, and was executed after encryption. AhnLab released an emergency patch\nimmediately following the exploit.\n\n### Scene #04: GandCrab’s full-on attack\n\nFrom then, the creator of GandCrab made continuous efforts to uninstall the V3 program\nthrough its scripts, with the attempts becoming more sophisticated as time went on.\n\n\n-----\n\nThe first method used by GandCrab to uninstall V3 was by encouraging the user to click. As\nshown in Figure 7, a piece of code was included within the distributed script specifically to\ndrop and run a JS file which deletes the V3 service upon detection.\n\nFigure 7: GandCrab’s distributed script without obfuscation.\n\nThe dropped JS file finds the path to the V3 deletion program and runs the corresponding\nuninstaller according to the user’s Windows version, as shown in Figure 8. Afterwards, it\nchecks for up to 60 seconds whether V3 has been removed.\n\nFigure 8: JavaScript that induces deletion of V3.\n\n\n-----\n\nIf, within that 60-second period, the user clicks the remove button (which is shown by the\nuninstaller), V3 is deleted and the system runs the GandCrab ransomware. This method\nrequires user interaction, meaning that the deletion of the program cannot be done in the\nbackground without the user’s knowledge.\n\nThis limitation led the creator of GandCrab to update its code in September 2018, to enable\nthe deletion of the V3 program without the user’s knowledge, as shown in Figure 9. The\nupgraded method allowed the V3 uninstallation screen to be hidden from the user’s view\nwhile also automating the button-click process to run the GandCrab ransomware.\n\nFigure 9: Main function of the decoded PowerShell.\n\nIn GandCrab v5.0 a new executable, cmd.exe, was added in addition to the original\nprocess, Uninst.exe under Powershell.exe. However, it did not stop here. The structure of\nthe process tree was altered continuously in order to evade V3’s behaviour-based\ndetection. After 26 September, WMIC.exe was used instead of cmd.exe to uninstall the V3\nprogram.\n\nAs AhnLab made continuous updates to its anti-malware program so GandCrab also\nintroduced updates. GandCrab v5.0.2 was distributed, which incorporated uninstallation\nusing the existing Uninst.exe -Uninstall in addition to the AhnUn000.tmp -UC method. As\nshown in Figure 10, this version copied the Uninst.exe file to %temp%\\AhnUn000.tmp, used\nWMIC.exe to run the file as the -UC switch, and changed the V3 product deletion processor\nto runas.exe.\n\n\n-----\n\nFigure 10: Process structure of uninstalling.\n\nGandCrab v5.0.3 only used AhnUn000.tmp -UC to execute the deletion of the program\ninstead of using Uninst.exe, and in v5.0.4, the main agent for the program deletion had\nchanged to cscript.exe.\n\n_AhnLab continued to update its product in response to GandCrab’s weekly script update._\nOn 6 November, for instance, a CAPTCHA was added to the V3 Lite uninstall program to\nprevent automated deletion by malware. As a result, GandCrab was unable to delete V3,\nand removed the uninstall function from its distributed script.\n\n### Scene #05: Endgame, the last battle\n\nWhile the versions of GandCrab distributed before December 2018 attempted to delete V3\nin various ways, GandCrab v5.0.4, discovered in January 2019, focused on terminating\n_V3’s operation instead of uninstalling it._\n\nThe process to disable the V3 service is shown in Figure 11.\n\n\n-----\n\nFigure 11: Process to disable V3 service.\n\nBefore moving onto the next step, GandCrab checks whether the V3 service is running and\nuses the sleep function to wait 15 minutes if it is running. In the first step, an execution file\n(help22.exe) is dropped to stop the service. The dropped file locates V3 Lite and then\nduplicates Uninst.exe, the V3 uninstall program, to %UserProfile%help.exe. The duplicated\nfile then executes ASDCli.exe and uses the stop command to stop V3 Lite.\n\n_AhnLab responded immediately with critical security patches, deleting ASDCli.exe and_\npreventing the stop command from being executed. In addition, the product was upgraded,\nrequiring an additional string (other than /Uninstall) to remove the product. The long tussle\nbetween GandCrab and AhnLab seemed to have settled down.\n\nHowever, the battle was not yet over. GandCrab’s creator continued to taunt AhnLab by\nadding an insulting text in GandCrab v5.2. Distributed in February 2019, GandCrab v5.2\nincorporated a time-delay technique to disturb dynamic analysis. This version included the\ntext string ‘AnaLab_sucks’ within the Windows procedure class name that enables the\nSetTimer function. ‘AnaLab’ can be assumed to be a typo. Furthermore, the creator of\nGandCrab consistently mentioned ‘V3 Lite’ and ‘AhnLab’ directly within the distributed\nstrings.\n\nFigure 12: AhnLab text string that was used as a class name\n\n\n-----\n\nA modified version of GandCrab v5.2, distributed in March 2019, no longer contained the\nabove-mentioned text. Instead, a text insulting Bitdefender was used as the mutex.\nHowever, it was too soon to assume that the battle between AhnLab and GandCrab had\nended.\n\nIn April 2019 GandCrab v5.2 added an evasive function to bypass detection by V3 Lite.\nUnlike the previous attempts to disable V3 Lite, the new feature injected the malware into\n_AhnLab’s anti-malware update program in order to perform malicious activities._\n\nThe evasive process used by GandCrab to bypass V3 Lite is shown in Figure 13.\n\nFigure 13: Evasive process used by GandCrab to bypass V3 Lite.\n\nLike the V3 disabling process, the malware first checks if ‘V3 Service’ is running. If the\nservice is running, it uses the sleep function to wait for 20 minutes before moving onto the\nnext step. After 20 minutes, it scans for the AhnLab anti-malware update program,\nAutoup.exe, then injects the ransomware execution data into the program. The injected\ncode is executed, starting the encryption process. AhnLab quickly released a security patch\nto address this process.\n\nAs if to prove the famous quote ‘nothing lasts forever, everything has an end’, what seemed\nlike a never-ending battle between GandCrab and AhnLab came to an abrupt end when\nGandCrab’s creator announced the end of its operation on 31 May 2019.\n\nGandCrab’s creator has claimed to have earned more than enough through the\nransomware operation, as seen in the statement shown in Figure 14. No new variants have\nbeen found since May 2019, and v5.3 remains GandCrab’s last released version.\n\n\n-----\n\nFigure 14: Announcement of GandCrab shutdown.\n\n## Conclusion\n\nThe battle between the GandCrab threat group and AhnLab lasted for 478 days and\nhighlights the importance of collaboration between security vendors and organizations in\nthe fight against advanced threats such as this. It is also vital for security vendors to\ncontinuously monitor threats and be resilient. It may seem as though the adversaries\nalways have a head start, but advanced attacks cannot prevail if vulnerabilities are promptly\naddressed and appropriate updates are made.\n\n_AhnLab will continue to monitor security threats in real time via its threat analysis and anti-_\nmalware program. In continuous efforts to build a strong alliance with other vendors and\norganizations, it will provide threat intelligence through various channels. GandCrab’s\noperation may have ended, but the cyber battle will never end.\n\n## References\n\n[1] GandCrab Ransomware Disseminated in Korea (in Korean). AhnLab blog.\n[https://asec.ahnlab.com/1091.](https://asec.ahnlab.com/1091)\n\n[2] GandCrab v2.1 spread in Fileless mode (in Korean). AhnLab blog.\n[https://asec.ahnlab.com/1130.](https://asec.ahnlab.com/1130)\n\n[3] GandCrab V2.1 Ransomware (internal version “version = 3.0.0”) (in Korean). AhnLab\n[blog. https://asec.ahnlab.com/1133.](https://asec.ahnlab.com/1133)\n\n[4] Salvio, J. GandCrab V4.0 Analysis: New Shell, Same Old Menace. Fortinet blog.\nhttps://www.fortinet.com/blog/threat-research/gandcrab-v4-0-analysis--new-shell--same-oldmenace.html.\n\n[5] GandCrab v4.x encryption blocking method (Kill-Switch) (in Korean). AhnLab blog.\n[https://asec.ahnlab.com/1144.](https://asec.ahnlab.com/1144)\n\n\n-----\n\n[6] Cimpanu, C. GandCrab Ransomware Author Bitter After Security Vendor Releases\nVaccine App. Bleeping Computer.\nhttps://www.bleepingcomputer.com/news/security/gandcrab-ransomware-author-bitter-aftersecurity-vendor-releases-vaccine-app/.\n\n## Latest articles:\n\n### Cryptojacking on the fly: TeamTNT using NVIDIA drivers to mine cryptocurrency\n\nTeamTNT is known for attacking insecure and vulnerable Kubernetes deployments in order\nto infiltrate organizations’ dedicated environments and transform them into attack\nlaunchpads. In this article Aditya Sood presents a new module introduced by…\n\n### Collector-stealer: a Russian origin credential and information extractor\n\nCollector-stealer, a piece of malware of Russian origin, is heavily used on the Internet to\nexfiltrate sensitive data from end-user systems and store it in its C&C panels. In this article,\nresearchers Aditya K Sood and Rohit Chaturvedi present a 360…\n\n### Fighting Fire with Fire\n\nIn 1989, Joe Wells encountered his first virus: Jerusalem. He disassembled the virus, and\nfrom that moment onward, was intrigued by the properties of these small pieces of selfreplicating code. Joe Wells was an expert on computer viruses, was partly…\n\n### Run your malicious VBA macros anywhere!\n\nKurt Natvig wanted to understand whether it’s possible to recompile VBA macros to another\nlanguage, which could then easily be ‘run’ on any gateway, thus revealing a sample’s true\nnature in a safe manner. In this article he explains how he recompiled…\n\n### Dissecting the design and vulnerabilities in AZORult C&C panels\n\nAditya K Sood looks at the command-and-control (C&C) design of the AZORult malware,\ndiscussing his team's findings related to the C&C design and some security issues they\nidentified during the research.\n\n[Bulletin Archive](https://www.virusbulletin.com/virusbulletin/archive)\n\n\n-----\n\nWe have placed cookies on your device in order to improve the functionality of this site, as\n[outlined in our cookies policy. However, you may delete and block all cookies from this site](https://www.virusbulletin.com/about-vb/privacy-policy/cookies)\nand your use of the site will be unaffected. By continuing to browse this site, you are\n[agreeing to Virus Bulletin's use of data as outlined in our privacy policy.](https://www.virusbulletin.com/about-vb/privacy-policy/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-01-20 - Behind the scenes of GandCrab’s operation.pdf"
    ],
    "report_names": [
        "2020-01-20 - Behind the scenes of GandCrab’s operation.pdf"
    ],
    "threat_actors": [
        {
            "id": "bf6cb670-bb69-473f-a220-97ac713fd081",
            "created_at": "2022-10-25T16:07:23.395205Z",
            "updated_at": "2025-03-27T02:02:09.777308Z",
            "deleted_at": null,
            "main_name": "Bitter",
            "aliases": [
                "T-APT-17",
                "TA397"
            ],
            "source_name": "ETDA:Bitter",
            "tools": [
                "Artra Downloader",
                "ArtraDownloader",
                "Bitter RAT",
                "BitterRAT",
                "Dracarys"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "655f7d0b-7ea6-4950-b272-969ab7c27a4b",
            "created_at": "2022-10-27T08:27:13.133291Z",
            "updated_at": "2025-03-27T02:00:55.490812Z",
            "deleted_at": null,
            "main_name": "BITTER",
            "aliases": [
                "T-APT-17"
            ],
            "source_name": "MITRE:BITTER",
            "tools": [
                "ZxxZ"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "f809bfcb-b200-4988-80a8-be78ef6a52ef",
            "created_at": "2023-01-06T13:46:39.186988Z",
            "updated_at": "2025-03-27T02:00:03.016358Z",
            "deleted_at": null,
            "main_name": "TeamTNT",
            "aliases": [
                "Adept Libra"
            ],
            "source_name": "MISPGALAXY:TeamTNT",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "c3ca592f-0669-49bd-ab5c-310007ab2fb4",
            "created_at": "2022-10-25T15:50:23.334495Z",
            "updated_at": "2025-03-27T02:00:55.445098Z",
            "deleted_at": null,
            "main_name": "TeamTNT",
            "aliases": [
                "TeamTNT"
            ],
            "source_name": "MITRE:TeamTNT",
            "tools": [
                "Peirates",
                "MimiPenguin",
                "LaZagne",
                "Hildegard"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535648,
    "ts_updated_at": 1743041531,
    "ts_creation_date": 1653775381,
    "ts_modification_date": 1653775381,
    "files": {
        "pdf": "https://archive.orkl.eu/acd1f0e2b07b8593945e0ec00c21848a2ac12ca1.pdf",
        "text": "https://archive.orkl.eu/acd1f0e2b07b8593945e0ec00c21848a2ac12ca1.txt",
        "img": "https://archive.orkl.eu/acd1f0e2b07b8593945e0ec00c21848a2ac12ca1.jpg"
    }
}