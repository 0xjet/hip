{
    "id": "a1637f2d-7649-4a58-a0a8-4042c5b72e12",
    "created_at": "2022-10-25T16:48:22.549622Z",
    "updated_at": "2025-03-27T02:05:43.53667Z",
    "deleted_at": null,
    "sha1_hash": "d5e47cedc99e7eafd495003e6bd0b79eb44d4f8d",
    "title": "T9000: Advanced Modular Backdoor Uses Complex Anti-Analysis Techniques - Palo Alto Networks BlogPalo Alto Networks Blog",
    "authors": "",
    "file_creation_date": "2016-05-16T10:22:45Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 741878,
    "plain_text": "### 231\n\n\n**backdoor as T9000, which is a newer variant of the T5000 malware family, also known as Plat1.**\n\n**In addition to the basic functionality all backdoors provide, T9000 allows the attacker to capture**\n\n**encrypted data, take screenshots of specific applications and specifically target Skype users.**\n\n**The malware goes to great lengths to identify a total of 24 potential security products that may**\n\n**be running on a system and customizes its installation mechanism to specifically evade those**\n\n**that are installed. It uses a multi-stage installation process with specific checks at each point to**\n\n**identify if it is undergoing analysis by a security researcher.**\n\n**The primary functionality of this tool is to gather information about the victim. In fact, the author**\n\n**chose to store critical files dropped by the Trojan in a directory named “Intel.” T9000 is pre-**\n\n**configured to automatically capture data about the infected system and steal files of specific**\n\n**types stored on removable media.**\n\n**We have observed T9000 used in multiple targeted attacks against organizations based in the**\n\n**United States. However, the malware’s functionality indicates that the tool is intended for use**\n\n**against a broad range of users. In this report, we share an analysis of each stage in T9000’s**\n\n**execution flow. Stay tuned for a future report in which we will provide more detail on how this**\n\n**tool has been used and the infrastructure we have identified as part of our analysis.**\n\n**The entire execution flow of the malware is represented in the following diagram:**\n\n**As this malware uses a multistage execution flow, we’ll discuss each stage individually.**\n\n**The sample of T9000 used in this analysis was originally dropped via a RTF file that contained**\n\n**[exploits for both CVE-2012-1856 and CVE-2015-1641. When triggered, an initial shellcode](http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1856)**\n\n**stage is run, which is responsible for locating and executing a secondary shellcode stub. The**\n\n**second stage shellcode reads the initial RTF document and seeks to the end of the file, using**\n\n**the last four bytes as the size of the embedded payload.**\n\n**With the payload size confirmed, the shellcode will create a file in the %TEMP% folder using a**\n\n**temporary filename. The shellcode will decrypt and subsequently load the embedded payload in**\n\n**the RTF file. The decrypted payload is written to the temporary file and executed using**\n\n**WinExec. The shellcode then attempts to decrypt an embedded decoy document with the same**\n\n**algorithm used to decrypt the payload, which it will save to %TEMP%\\~tmp.doc path. This file is**\n\n**opened using the following command:**\n\n**_cmd /C %TEMP%\\~tmp.doc_**\n\n**However, this particular sample did not contain a decoy document.**\n\n|Col1|POSTED BY: Josh Grunzweig and Jen Miller-Osborn on February 4, 2016 1:00 PM|\n|---|---|\n|231||\n|LLiikkee|FILED IN: Malware, Threat Prevention, Unit 42 TAGGED: Skype, T5000, T9000, Trojans Most custom backdoors used by advanced attackers have limited functionality. They evade detection by keeping their code simple and flying under the radar. But during a recent investigation we found a backdoor that takes a very different approach. We refer to this|\n|Tweet||\n|33||\n\n\n## Palo Alto Networks News of the Week – May 14\n\n**[posted by Anna Lough on May 14, 2016](http://researchcenter.paloaltonetworks.com/author/anna-lough/)**\n\n## Japan’s Cybersecurity Guidelines for Business Leadership – Changing the Japanese Business Mindset and Potentially Raising the Global Bar\n\n**[posted by Mihoko Matsubara on May 13, 2016](http://researchcenter.paloaltonetworks.com/author/mihoko-matsubara/)**\n\n## A Word on Endpoint Security (For Those In the Know)\n\n**[posted by Sebastian Goodwin on May 13, 2016](http://researchcenter.paloaltonetworks.com/author/sebastian-goodwin/)**\n\n## Winning Together in the Commercial Market\n\n**[posted by Ron Myers on May 13, 2016](http://researchcenter.paloaltonetworks.com/author/ron-myers/)**\n\n## Palo Alto Networks Signs Coordinated Vulnerability Disclosure Manifesto, Showcasing Industry’s Contributions to EU Cybersecurity Efforts\n\n**[posted by Rene Bonvanie on May 12, 2016](http://researchcenter.paloaltonetworks.com/author/rene/)**\n\n**[MORE →](http://researchcenter.paloaltonetworks.com/archives/)**\n\n\n**Get Updates**\n**Sign up to receive the latest news, cyber**\n**threat intelligence and research from Unit**\n**42.**\n\n**Business Email**\n\n**Submit**\n\n\n**LikeLike**\n\n\n-----\n\n**_820C90CxxA1B084495866C6D95B2595xx1C3_**\n\n**It continues to perform a number of checks for installed security products on the victim machine.**\n\n**The following security platforms are queried by checking entries within the HKLM\\Software\\**\n\n**registry path:**\n\n**Sophos**\n\n**INCAInternet**\n\n**DoctorWeb**\n\n**Baidu**\n\n**Comodo**\n\n**TrustPortAntivirus**\n\n**GData**\n\n**AVG**\n\n**BitDefender**\n\n**VirusChaser**\n\n**McAfee**\n\n**Panda**\n\n**Trend Micro**\n\n**Kingsoft**\n\n**Norton**\n\n**Micropoint**\n\n**Filseclab**\n\n**AhnLab**\n\n**JiangMin**\n\n**Tencent**\n\n**Avira**\n\n**Kaspersky**\n\n**Rising**\n\n**360**\n\n**These security products are represented by a value that is binary AND-ed with any other**\n\n**products found. The following numbers represent each respective security product.**\n\n**_0x08000000 : Sophos_**\n\n**_0x02000000 : INCAInternet_**\n\n**_0x04000000 : DoctorWeb_**\n\n**_0x00200000 : Baidu_**\n\n**_0x00100000 : Comodo_**\n\n**_0x00080000 : TrustPortAntivirus_**\n\n**_0x00040000 : GData_**\n\n**_0x00020000 : AVG_**\n\n**_0x00010000 : BitDefender_**\n\n**_0x00008000 : VirusChaser_**\n\n**_0x00002000 : McAfee_**\n\n**_0x00001000 : Panda_**\n\n**_0x00000800 : Trend Micro_**\n\n**_0x00000400 : Kingsoft_**\n\n**_0x00000200 : Norton_**\n\n**_0x00000100 : Micropoint_**\n\n**_0x00000080 : Filseclab_**\n\n**_0x00000040 : AhnLab_**\n\n**_0x00000020 : JiangMin_**\n\n**_0x00000010 : Tencent_**\n\n**_0x00000004 : Avira_**\n\n**_0x00000008 : Kaspersky_**\n\n**_0x00000002 : Rising_**\n\n**_0x00000001 : 360_**\n\n**So, for example, if both Trend Micro and Sophos were discovered on a victim machine, the**\n\n**resulting value would be 0x08000800. This numerical value is written to the following file:**\n\n**_%APPDATA%\\Intel\\avinfo_**\n\n**The malware proceeds to drop the following files to the %APPDATA%\\Intel directory:**\n\n\n-----\n\n**Additionally, the following two files are written to the Data directory:**\n\n**The following table provides a description of each file dropped:**\n\n**File Name** **Description**\n\n**~1** **Debug information about files used by malware.**\n\n**avinfo** **Installed security products on victim.**\n\n**hccutils.dll** **Malicious DLL. Loads ResN32.dll.**\n\n**hccutils.inf** **Malicious INF file. Points to hccutils.dll.**\n\n**hjwe.dat** **Encrypted core of malware family.**\n\n**igfxtray.exe** **Legitimate Microsoft executable. Loads hccutils.dll.**\n\n**qhnj.dat** **Encrypted plugin. Hooks a number of functions and logs results.**\n\n**QQMgr.dll** **Malicious DLL. Sets persistence via Run registry key.**\n\n**QQMgr.inf** **Malicious INF file. Points to QQMgr.dll**\n\n**ResN32.dat** **String pointing to path of encrypted core of malware.**\n\n**ResN32.dll** **Malicious DLL. Decrypts, decompresses, and loads core malware.**\n\n**tyeu.dat** **Encrypted plugin. Takes screenshots and collects Skype information.**\n\n**vnkd.dat** **Encrypted plugin. Finds files on removable drives on victim machine.**\n\n**dtl.dat** **Encrypted configuration information.**\n\n**glp.uin** **Plugin configuration information.**\n\n**You’ll notice that QQMgr* files are not listed in the original malware execution flow diagram. In**\n\n**the event the victim is running any of the following operating system versions, as well as either**\n\n**Kingsoft, Filseclab, or Tencent security products, the malware will be installed using an**\n\n**alternative method.**\n\n**Windows 2008 R2**\n\n**Windows 7**\n\n**Windows 2012**\n\n**Windows 8**\n\n**In such a situation the malware will find and run the built in Microsoft Windows**\n\n\n-----\n\n**QQMgr.inf will install the QQMgr.dll, while hccutils.inf will install the hccutils.dll library. QQMgr.dll**\n\n**will set the following registry key:**\n\n**_HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\Eupdate –_**\n\n**_%APPDATA%\\Intel\\ResN32.dll_**\n\n**The QQMgr.dll file has the following debug string found within it:**\n\n**_H:\\WORK\\PROJECT\\InfInstallBypassUAC\\Release\\BypassUAC.pdb_**\n\n**The hccutils.dll file is described later within this post.**\n\n**After the malware drops the required files, by default the malware will spawn**\n\n**%APPDATA%\\Intel\\igfxtray.exe in a new process, which begins the second stage of the**\n\n**malware’s execution.**\n\n**[The igfxtray.exe is a legitimate Microsoft Windows executable that sideloads the malicious](https://attack.mitre.org/wiki/DLL_side-loading)**\n\n**hccutils.dll DLL file. This DLL has the following debug string embedded within it:**\n\n**_D:\\WORK\\T9000\\hccutils_M4\\Release\\hccutils.pdb_**\n\n**Upon loading this malicious DLL, the malware will initially perform the same queries for security**\n\n**products that were witnessed in stage 1.**\n\n**Three separate techniques for starting stage 3 are used depending on the properties of the**\n\n**victim.**\n\n**The first technique is used if the victim meets the following criteria:**\n\n**Microsoft Windows 8 / Windows Server 2012 R2**\n\n**DoctorWeb security product installed**\n\n**For this situation, the following registry key is set:**\n\n**_HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\update – %SYSTEM%\\rundll32.exe_**\n\n**_%APPDATA\\Intel\\ResN32.dll Run_**\n\n**This ensures that the ResN32.dll library will be run using the ‘Run’ exported function whenever**\n\n**the machine is rebooted.**\n\n**The second technique is used if the victim meets any of the following sets of criteria:**\n\n**Microsoft Windows 8 / Windows Server 2012 R2**\n\n**Not running Kingsoft, Tencent, or DoctorWeb security products**\n\n**Microsoft Windows XP or lower**\n\n**No security products installed, or running any of the following:**\n\n**Sophos**\n\n**GData**\n\n**TrendMicro**\n\n**AhnLab**\n\n**Kaspersky**\n\n**In these situations, the following persistence technique is used.**\n\n**_HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\AppInit_DLLs –_**\n\n**_%APPDATA%\\Intel\\ResN32.dll_**\n\n**_HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\LoadAppInit_DLLs – 0x1_**\n\n**Setting these registry keys both enables the AppInit_DLL functionality, and ensures that every**\n\n**user mode process that is spawned will load the ResN32.dll library. More information about this**\n\n**[can be found here.](https://msdn.microsoft.com/en-us/library/windows/desktop/dd744762(v=vs.85).aspx)**\n\n**The third technique is used in any other situation. When this occurs, the malware will first**\n\n**identify the explorer.exe process identifier. It proceeds to inject the ResN32.dll library into this**\n\n**process.**\n\n**At this point, the third stage of the malware family is loaded.**\n\n\n-----\n\n**The ResN32.dll library begins by spawning a new thread that is responsible for the majority of**\n\n**the capabilities built into this sample. This thread begins by checking the operating system**\n\n**version, and once again runs a query on the various security products installed on the victim**\n\n**machine.**\n\n**Under certain conditions, the following registry key is set, ensuring persistence across reboots:**\n\n**_HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\update –_**\n\n**_c:\\windows\\system32\\rundll32.exe %APPDATA\\Intel\\ResN32.dll Run_**\n\n**Following this, a new thread is created that is responsible for deleting previously written files.**\n\n**This thread creates the following mutex:**\n\n**_Global\\\\deletethread_**\n\n**It proceeds to attempt to delete the following files in an infinite loop until said files have been**\n\n**deleted:**\n\n**%STARTUP%\\hccutils.dll**\n\n**%STARTUP%\\hccutil.dll**\n\n**%STARTUP%\\igfxtray.exe**\n\n**The ResN32.dll malware proceeds to read in the ResN32.dat file that was previously written to**\n\n**disk. This file contains a path to the hjwe.dat file, which is subsequently read in.**\n\n**The data within the hjwe.dat file is decrypted using the RC4 algorithm, and subsequently**\n\n**decompressed using the LZMA algorithm. The following script can be used to decrypt the**\n\n**hjwe.dat file, along with the plugins that will be discussed later.**\n\n\n**1**\n**2**\n**3**\n**4**\n**5**\n**6**\n**7**\n**8**\n**9**\n**10**\n**11**\n**12**\n**13**\n**14**\n**15**\n**16**\n**17**\n**18**\n**19**\n**20**\n**21**\n**22**\n**23**\n**24**\n**25**\n**26**\n**27**\n**28**\n**29**\n**30**\n**31**\n**32**\n**33**\n**34**\n**35**\n**36**\n**37**\n**38**\n\n\n**import sys,** **pylzma**\n**from base64 import ***\n**from binascii import ***\n**from struct** **import ***\n\n**def rc4(** **data** **,** **key** **):**\n**S = range(256)**\n**j = 0**\n**out = []**\n**for** **i** **in** **range(256):**\n**j = (j + S[i] + ord(** **key[i % len(key)]** **)) % 256**\n**S[i]** **,** **S[j] = S[j]** **,** **S[i]**\n**i = j = 0**\n**for** **char** **in** **data:**\n**i = (** **i + 1** **) % 256**\n**j = (** **j + S[i]** **) % 256**\n**S[i]** **,** **S[j] = S[j]** **,** **S[i]**\n**out.append(chr(ord(char) ^ S[(S[i] + S[j]) % 256]))**\n**return** **''.join(out)**\n\n**f = open(sys.argv[1],** **'rb')**\n**fd = f.read()**\n**f.close()**\n\n**bytes_0_4,** **bytes_4_8,** **bytes_8_12,** **bytes_12_16 = unpack(\"<IIII\",** **fd[**\n**if** **bytes_0_4 == 0xf7e4aa65:**\n**length = bytes_8_12**\n**if** **len(fd)-16 != length:**\n**print** **\"[*] Possible error reading in length of data.\"**\n**key_size = 260**\n**key = fd[16:16+key_size]**\n**data = fd[16+key_size:]**\n**decrypted = rc4(data,** **key)**\n**decompressed = pylzma.decompress_compat(decrypted)**\n**f1 = open(sys.argv[1]+\".decompressed\",** **'wb')**\n**f1.write(decompressed)**\n**f1.close**\n**print** **\"[+] Wrote %s\" % (sys.argv[1]+\".decompressed\")**\n\n\n**After this file has been decrypted and decompressed, it is written to a file in the %TEMP%**\n\n**directory with a file prefix of ‘____RES’. This file, which contains a Windows DLL, is then loaded**\n\n**into the current process. After the malicious library has been loaded, the previously written**\n\n**temporary file is deleted. This begins the last stage of the malware, which will load the core of**\n\n**the malware family.**\n\n**Once the decrypted and decompressed hjwe.dat file is loaded, it begins by checking its parent**\n\n**process against the following list. If the parent process matches the following blacklist, the**\n\n**malicious DLL will exit without performing any malicious activities.**\n\n**winlogon.exe**\n\n**csrss.exe**\n\n\n-----\n\n**logonui.exe**\n\n**explore.exe**\n\n**System**\n\n**Dbgview.exe**\n\n**userinit.exe**\n\n**lsass.exe**\n\n**wmiprvse.exe**\n\n**services.exe**\n\n**inetinfo.exe**\n\n**avp.exe**\n\n**Rtvscan.exe**\n\n**The malware proceeds to collect the username of the victim, as well as the operating system**\n\n**version. It then compares its parent process against the following list of executables:**\n\n**winlogon.exe**\n\n**csrss.exe**\n\n**logonui.exe**\n\n**ctfmon.exe**\n\n**drwtsn32.exe**\n\n**logonui.exe**\n\n**System**\n\n**Dwm.exe**\n\n**QQPCRTP.exe**\n\n**Tasking.exe**\n\n**Taskhost.exe**\n\n**Taskmgr.exe**\n\n**Dbgview.exe**\n\n**suerinit.exe**\n\n**lsass.exe**\n\n**wmiprvse.exe**\n\n**services.exe**\n\n**inetinfo.exe**\n\n**avp.exe**\n\n**Rtvscan.exe**\n\n**Notice the repeated check for the ‘logonui.exe’, as well as the overlap with the previous parent**\n\n**executable check, which implies sloppiness by the malware author.**\n\n**After these checks are performed, the following mutex is created.**\n\n**_Global\\\\{A59CF429-D0DD-4207-88A1-04090680F714}_**\n\n**The following folders are then created:**\n\n**utd_CE31**\n\n**XOLOADER**\n\n**Update**\n\n**The path of these folders is determined by the version of Microsoft Windows running. The**\n\n**following possibilities exist:**\n\n**%ALLUSERSPROFILE%\\Documents\\My Document\\**\n\n**%PUBLIC%\\Downloads\\Update\\**\n\n**At this point, the malware will read in the dtl.dat file, which contains configuration data. Data**\n\n**contained with this file starting at offset 0x20 is xor-encrypted using a single-byte key of 0x5F.**\n\n**The following script can be used to extract the IP address and port for the C2 server from this**\n\n**file.**\n\n\n-----\n\n**4**\n**5**\n**6**\n**7**\n**8**\n**9**\n**10**\n**11**\n**12**\n**13**\n**14**\n**15**\n**16**\n**17**\n**18**\n**19**\n**20**\n\n\n**def int2ip(addr):**\n**return** **socket.inet_ntoa(pack(\"!I\",** **addr))**\n\n**config_file = sys.argv[1]**\n**f = open(config_file,** **'rb')**\n**fd = f.read()**\n**f.close()**\n\n**decrypted = \"\"**\n**for** **x** **in** **fd[32:]:**\n**decrypted += chr(ord(x) ^ 0x5f)**\n\n**port = unpack(\"<I\",** **decrypted[4:8])[0]**\n**ip = int2ip(unpack(\">I\",** **decrypted[8:12])[0])**\n\n**print** **\"IP Address : %s\" % ip**\n**print** **\"Port    : %d\" % port**\n\n\n**The malware will then read in and parse the included plugin configuration information, which is**\n\n**found within the glp.uin file that was previously dropped. These included plugins are encrypted**\n\n**and compressed using the same method witnessed by the hjwe.dat file previously. The**\n\n**previously included script can be used to decrypt and decompress the following three plugin**\n\n**files:**\n\n**tyeu.dat**\n\n**vnkd.dat**\n\n**qhnj.dat**\n\n**These three plugins are subsequently loaded after being decrypted and decompressed. An**\n\n**overview of these plugins can be found later in this post.**\n\n**The malware proceeds to create the following event:**\n\n**_Global\\\\{34748A26-4EAD-4331-B039-673612E8A5FC}_**\n\n**Additionally, the following three mutexes are created:**\n\n**_Global\\\\{3C6FB3CA-69B1-454f-8B2F-BD157762810E}_**\n\n**_Global\\\\{43EE34A9-9063-4d2c-AACD-F5C62B849089}_**\n\n**_Global\\\\{A8859547-C62D-4e8b-A82D-BE1479C684C9}_**\n\n**The malware will spawn a new thread to handle network communication. The following event is**\n\n**created prior to this communication occurring:**\n\n**_Global\\\\{EED5CA6C-9958-4611-B7A7-1238F2E1B17E}_**\n\n**The malware includes proxy support in the event that the victim is behind a web proxy. Network**\n\n**traffic occurs over a binary protocol on the port specified within the configuration. Traffic is xor-**\n\n**encrypted with a single-byte key of 0x55 in an attempt to bypass any network security products**\n\n**that may be in place. Once decrypted, the following traffic is sent by the malware.**\n\n**Figure 1: Decrypted data sent by malware**\n\n**As we can see from the above image, the malware will send out an initial beacon, followed by**\n\n**various collected information from the victim machine. The following information is exfiltrated:**\n\n**Installed security products**\n\n**System time**\n\n**Build Number**\n\n**CPU Architecture (32-bit/64-bit)**\n\n**MAC Address**\n\n**IP Address**\n\n\n-----\n\n**Plugin configuration information**\n\n**The malware is configured to receive a number of commands. The following command**\n\n**functionalities have been identified.**\n\n**Command** **Description**\n\n**DIR** **Directory listing**\n\n**LIR** **Drive listing**\n\n**RUN** **Execute command (Either interactively or not)**\n\n**CIT** **Send command to interactively spawned command**\n\n**CFI** **Kill interactively spawned process**\n\n**DOW** **Download file**\n\n**UPL** **Upload file**\n\n**DEL** **Delete file**\n\n**DTK** **Retrieve statistics for file**\n\n**ERR** **Null command**\n\n**Additionally, the following commands have been identified, however, their functionalities have**\n\n**yet to be fully discovered.**\n\n**PNG**\n\n**PLI**\n\n**PLD**\n\n**FDL**\n\n**OSC**\n\n**OSF**\n\n**SDA**\n\n**QDA**\n\n**TFD**\n\n**SDS**\n\n**SCP**\n\n**FMT**\n\n**STK**\n\n**CRP**\n\n**When this plugin is called with the default exported function, it will create the following mutex:**\n\n**_{CE2100CF-3418-4f9a-9D5D-CC7B58C5AC62}_**\n\n**When called with the SetCallbackInterface function export, the malicious capabilities of the**\n\n**plugin begin. The plugin begins by collecting the username of the running process, and**\n\n**determining if it is running under the SYSTEM account. If running as SYSTEM, the plugin will**\n\n**associate the active desktop with the plugin’s thread.**\n\n**The plugin proceeds to create the following named event:**\n\n**_Global\\\\{EED5CA6C-9958-4611-B7A7-1238F2E1B17E}_**\n\n**Multiple threads are then spawned to handle various actions. The first thread is responsible for**\n\n**taking a screenshot of the desktop of the victim machine. This screenshot data is both**\n\n**compressed and encrypted using a single-byte xor key of 0x5F. This data is written to one of the**\n\n**following files:**\n\n**_%PUBLIC%\\Downloads\\Update\\S[random].dat_**\n\n**_%ALLUSERSPROFILE%\\Documents\\My Document\\S[random].dat_**\n\n**The random data is generated via the current system time. Additionally, when a screenshot is**\n\n**written, one of the following log files has data appended to it:**\n\n**_%PUBLIC%\\Downloads\\Update\\Log.txt_**\n\n**_%ALLUSERSPROFILE%\\Documents\\My Document\\Log.txt_**\n\n\n-----\n\n**A second thread is responsible for monitoring the foreground window every 20 seconds. The**\n\n**thread will target the window names set within the plugin configuration. In this particular**\n\n**instance, the malware will target the ‘notepad’ process.**\n\n**When this process is discovered to be running in the foreground window, the malware will take a**\n\n**screenshot of this window. The data is compressed and encrypted using a single-byte xor key of**\n\n**0x5F. This data is written to one of the following files:**\n\n**_%PUBLIC%\\Downloads\\Update\\W[random].dat_**\n\n**_%ALLUSERSPROFILE%\\Documents\\My Document\\W[random].dat_**\n\n**Like the previous thread, this one attempts to write another log file to the disk. However, due to a**\n\n**bug within the code of this plugin, the malware author attempts to append the**\n\n**‘C:\\\\Windows\\\\Temp\\\\Log.txt’ string to the path, resulting in an inaccessible file path. In the event**\n\n**this bug did not exist, the following example data would be written:**\n\n**_08:37:49 2000 [4] PrintKeyTitleWnd: ===>> Process ID : 2000_**\n\n**The third and final thread spawned by this plugin is responsible for collecting information from**\n\n**the Skype program. The malware will use the built-in Skype API to accomplish this. This only**\n\n**takes places if both Skype is running and the victim is logged into Skype. It makes calls to the**\n\n**following functions:**\n\n**SkypeControlAPIDiscover**\n\n**SkypeControlAPIAttach**\n\n**When hooking into the Skype API, the victim is presented with the following dialog:**\n\n**Figure 3: Skype API access request**\n\n**The victim must explicitly allow the malware to access Skype for this particular functionality to**\n\n**work. However, since a legitimate process is requesting access, the user may find him- or**\n\n**herself allowing this access without realizing what is actually happening.**\n\n**Once enabled, the malware will record video calls, audio calls, and chat messages. Audio and**\n\n**video files are stored in the following folder:**\n\n**_%APPDATA%\\Intel\\Skype_**\n\n**Temporary audio and video files are stored within the audio and video sub-folders respectively.**\n\n**After a call is finished, this data is compressed and encrypted using the same techniques**\n\n**previously witnessed. These files are stored in randomly named .dat files within the Skype**\n\n**folder.**\n\n**When decrypted, we can see that the malware periodically takes images of the video calls.**\n\n**Audio calls are stored as .wav files.**\n\n\n-----\n\n**Figure 4: A lonely malware reverser is captured on video by the malicious plugin**\n\n**The original name for this plugin is ‘CaptureDLL.dll’. This is aptly named, as we see that this**\n\n**plugin has the following functionality:**\n\n**Capture full desktop screenshots**\n\n**Capture window screenshots of targeted processes**\n\n**Capture Skype audio, video, and chat messages**\n\n**The vnkd.dat plugin has the following debug path, leading us to believe that the original name**\n\n**for this plugin is ‘FlashDiskThief’:**\n\n**_e:\\WORK\\Project\\T9000\\Windows\\Target\\FlashDiskThief.pdb_**\n\n**When loaded with the default DllEntryPoint exported function, it will create the following mutex:**\n\n**_Global\\\\{6BB1120C-16E9-4c91-96D5-04B42D1611B4}_**\n\n**Like the other plugins associated with this malware, the majority of the functionality for this**\n\n**malware resides within the SetCallbackInterface exported function. This function spawns a new**\n\n**thread that begins by registering a new window with a class name and window name of ‘xx’.**\n\n**The plugin proceeds to iterate through all connected drives on the system, looking for**\n\n**removable drives.**\n\n**Figure 5. Plugin check for removable drives**\n\n**Should a removable drive be discovered, the plugin will seek any files residing on this device**\n\n**based on the plugin’s configured list. In this particular instance, the malware will seek out the**\n\n**following file types:**\n\n***.doc**\n\n***.ppt**\n\n***.xls**\n\n***.docx**\n\n***.pptx**\n\n***.xlsx**\n\n**If one of these file types is found, the malware will create a copy of the file in one of the**\n\n**following paths:**\n\n**_%PUBLIC%\\Downloads\\Update\\D[random].tmp_**\n\n**_%ALLUSERSPROFILE%\\Documents\\My Document\\D[random].tmp_**\n\n**The data found within this file is encrypted using a single-byte xor key of 0x41. The file header**\n\n**structure, with the underlying data still encrypted, can be seen below.**\n\n\n-----\n\n**Figure 6: File structure prior to decryption**\n\n**Figure 7: File structure post decryption**\n\n**This concludes the functionality of the vnkd.dat plugin, or FlaskDiskThief as it’s known by the**\n\n**malware’s author. While specific in nature, this plugin allows attackers to collect files being**\n\n**passed around from one machine to another via removable drives.**\n\n**This particular plugin appears to have an original filename of ‘kplugin.dll’ due to debugging**\n\n**information found within the file. The qhnj.dat plugin is responsible for hooking a number of**\n\n**common Microsoft Windows API calls, and logging the results.**\n\n**The following functions are hooked by this plugin:**\n\n**ImmGetCompositionStringA**\n\n**ImmGetCompositionStringW**\n\n**CreateFileW**\n\n**DeleteFileW**\n\n**CopyFileExW**\n\n**MoveFileWithProgressW**\n\n**CreateDirectoryW**\n\n**CreateDirectoryExW**\n\n**RemoveDirectoryW**\n\n**GetClipboardData**\n\n**CryptEncrypt**\n\n**CryptDecrypt**\n\n**The plugin is most likely hooking the ImmGetCompositionString* functions in order to collect**\n\n**information about Unicode characters on the victim machine, such as Chinese, Japanese, and**\n\n**Korean.**\n\n**Hooking the various file and directory operations allows the malware to log what file changes**\n\n**are occurring on the system. When a file is created, copied, moved, or deleted on the system,**\n\n**the malware will check the directory of said file against the following blacklist:**\n\n**\\\\\\\\.\\\\**\n\n**:\\\\program files\\\\**\n\n**\\\\AppData\\\\**\n\n**\\\\temporary internet files\\\\**\n\n**\\\\application data\\\\**\n\n**\\\\Local Settings\\\\**\n\n**\\\\cookies\\\\**\n\n**\\\\temp\\\\**\n\n**\\\\history\\\\**\n\n**Additionally, the filename is compared against the ‘.tmp’ extension to ensure a temporary file is**\n\n**ignored.**\n\n\n-----\n\n**The Crypt functions allow the malware to collect sensitive encrypted data sent to and from the**\n\n**victim machine. This is especially useful when viewing network traffic, allowing the attackers to**\n\n**potentially gain access to remote systems used by the victim.**\n\n**All of the data logged by the qhnj.dat plugin file is stored in one of the following file paths. Data**\n\n**is encrypted using a single-byte XOR key of 0x79.**\n\n**_%PUBLIC%\\Downloads\\Update\\uai[random].tmp_**\n\n**_%ALLUSERSPROFILE%\\Documents\\My Document\\uai[random].tmp_**\n\n**This last plugin allows the attackers to record important actions taken by the victim, which in turn**\n\n**may allow them to gain additional access as well as insight into the victim’s actions.**\n\n**T9000 appears to be the latest version of this Trojan, which has been partially exposed in**\n\n**previous reports. In 2013, Cylance published a report on a group they named “Grand Theft Auto**\n\n**[Panda”, which includes some details on the T5000 version of this Trojan. FireEye researchers](https://www.fireeye.com/blog/threat-research/2014/03/spear-phishing-the-news-cycle-apt-actors-leverage-interest-in-the-disappearance-of-malaysian-flight-mh-370.html)**\n\n**also noted that the malware was used in an attack in 2014 using a lure related to the**\n\n**disappearance of Malaysian flight MH370.**\n\n**The author of this backdoor has gone to great lengths to avoid being detected and to evade the**\n\n**scrutiny of the malware analysis community. We hope that sharing the details of how this tool**\n\n**works as well as the indicators in the section below will help others defend themselves against**\n\n**attacks using this tool.**\n\n**In a future report, we will detail the infrastructure used by the variants of the malware we have**\n\n**identified and discuss the methods attackers use to infect systems with it.**\n\n**Palo Alto Networks customers are protected from T9000/T5000 attacks through our next-**\n\n**generation security platform, including the following.**\n\n**Threat Prevention signatures for the software vulnerabilities listed in this report are**\n\n**available to detect the exploit files during delivery.**\n\n**Traps is capable of preventing exploitation of the vulnerabilities exploited to install T9000.**\n\n**WildFire classifies all of the malware described in this report as malicious.**\n\n**Anti-malware signatures for the files listed in this report.**\n\n**[AutoFocus users can identify the malware discussed in this report with the T5000 tag](https://autofocus.paloaltonetworks.com/#/tag/Unit42.T5000)**\n\n**Hashes**\n\n**RTF File, d5fa43be20aa94baf1737289c5034e2235f1393890fb6f4e8d4104565be52d8c**\n\n**QQMGr.dll, bf1b00b7430899d33795ef3405142e880ef8dcbda8aab0b19d80875a14ed852f**\n\n**QQMGR.inf, ace7e3535f2f1fe32e693920a9f411eea21682c87a8e6661d3b67330cd221a2a**\n\n**ResN32.dat, aa28db689f73d77babd1c763c53b3e63950f6a15b7c1a974c7481a216dda9afd**\n\n**ResN32.dll, 1cea4e49bd785378d8beb863bb8eb662042dffd18c85b8c14c74a0367071d9a7**\n\n**hqwe.dat, bb73261072d2ef220b8f87c6bb7488ad2da736790898d61f33a5fb7747abf48b**\n\n**hqwe.dat.decrypted,**\n\n**7daf3c3dbecb60bee3d5eb3320b20f2648cf26bd9203564ce162c97dcb132569**\n\n**hccutils.dll, 3dfc94605daf51ebd7bbccbb3a9049999f8d555db0999a6a7e6265a7e458cab9**\n\n**hccutils.inf, f05cd0353817bf6c2cab396181464c31c352d6dea07e2d688def261dd6542b27**\n\n**igfxtray.exe, 21a5818822a0b2d52a068d1e3339ed4c767f4d83b081bf17b837e9b6e112ee61**\n\n**qhnj.dat, c61dbc7b51caab1d0353cbba9a8f51f65ef167459277c1c16f15eb6c7025cfe3**\n\n**qhnj.dat.decrypted, 2b973adbb2addf62cf36cef9975cb0193a7ff0b960e2cff2c80560126bee6f37**\n\n**tyeu.dat, e52b5ed63719a2798314a9c49c42c0ed4eb22a1ac4a2ad30e8bfc899edcea926**\n\n**tyeu.dat.decrypted,**\n\n**5fc3dc25276b01d6cb2fb821b83aa596f1d64ae8430c5576b953e3220a01d9aa**\n\n**vnkd.dat, c22b40db7f9f8ebdbde4e5fc3a44e15449f75c40830c88932f9abd541cc78465**\n\n**vnkd.dat.decrypted,**\n\n**157e0a9323eaaa911b3847d64ca0d08be8cd26b2573687be461627e410cb1b3f**\n\n**dtl.dat, 00add5c817f89b9ec490885be39398f878fa64a5c3564eaca679226cf73d929e**\n\n**glp.uin, 3fa05f2f73a0c44a5f51f28319c4dc5b8198fb25e1cfcbea5327c9f1b3a871d4**\n\n**Mutexes**\n\n**820C90CxxA1B084495866C6D95B2595xx1C3**\n\n**Global\\\\deletethread**\n\n**Global\\\\{A59CF429-D0DD-4207-88A1-04090680F714}**\n\n**Global\\\\{3C6FB3CA-69B1-454f-8B2F-BD157762810E}**\n\n**Global\\\\{43EE34A9-9063-4d2c-AACD-F5C62B849089}**\n\n\n-----\n\n**Named Events**\n\n**Global\\\\{34748A26-4EAD-4331-B039-673612E8A5FC}**\n\n**Global\\\\{EED5CA6C-9958-4611-B7A7-1238F2E1B17E}**\n\n**File Modifications**\n\n**%TEMP%\\~tmp.doc**\n\n**%APPDATA%\\Intel\\avinfo**\n\n**%APPDATA%\\Intel\\Data\\dtl.dat**\n\n**%APPDATA%\\Intel\\Data\\glp.uin**\n\n**%APPDATA%\\Intel\\Data\\**\n\n**%APPDATA%\\Intel\\~1**\n\n**%APPDATA%\\Intel\\hccutils.dll**\n\n**%APPDATA%\\Intel\\hccutils.inf**\n\n**%APPDATA%\\Intel\\hjwe.dat**\n\n**%APPDATA%\\Intel\\igfxtray.exe**\n\n**%APPDATA%\\Intel\\qhnj.dat**\n\n**%APPDATA%\\Intel\\QQMgr.dll**\n\n**%APPDATA%\\Intel\\QQMgr.inf**\n\n**%APPDATA%\\Intel\\ResN32.dll**\n\n**%APPDATA%\\Intel\\ResN32.dat**\n\n**%APPDATA%\\Intel\\tyeu.dat**\n\n**%APPDATA%\\Intel\\vnkd.dat**\n\n**%STARTUP%\\hccutils.dll**\n\n**%STARTUP%\\hccutil.dll**\n\n**%STARTUP%\\igfxtray.exe**\n\n**%ALLUSERSPROFILE%\\Documents\\My Document\\utd_CE31**\n\n**%ALLUSERSPROFILE%\\Documents\\My Document\\XOLOADER**\n\n**%ALLUSERSPROFILE%\\Documents\\My Document\\update**\n\n**%ALLUSERSPROFILE%\\Documents\\My Document\\Log.txt**\n\n**%PUBLIC%\\Downloads\\Update\\utd_CE31**\n\n**%PUBLIC%\\Downloads\\Update\\XOLOADER**\n\n**%PUBLIC%\\Downloads\\Update\\update**\n\n**%PUBLIC%\\Downloads\\Update\\Log.txt**\n\n**%APPDATA%\\Intel\\Skype**\n\n**Registry Modifications**\n\n**HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\Eupdate –**\n\n**%APPDATA%\\Intel\\ResN32.dll**\n\n**HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\update – %SYSTEM%\\rundll32.exe**\n\n**%APPDATA\\Intel\\ResN32.dll Run**\n\n**HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\AppInit_DLLs –**\n\n**%APPDATA%\\Intel\\ResN32.dll**\n\n**HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\LoadAppInit_DLLs – 0x1**\n\n**HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\update –**\n\n**c:\\windows\\system32\\rundll32.exe %APPDATA\\Intel\\ResN32.dll Run**\n\n**Command and Control**\n\n**198.55.120[.]143:8080**\n\n**February 13, 2016 9:34 AM**\n## This Trojan Malware Might Be Recording Your Skype Conversations Sell Ur Shit | Make Money Selling Your Shit online for Free | Sell Ur Shit | Make Money Selling Your Shit online for Free\n\n**February 13, 2016 9:36 AM**\n## This Trojan Malware Might Be Recording Your Skype Conversations | Xnulleds.com\n\n**F b** **13 2016 11 23 AM**\n\n\n-----\n\n## This Trojan Malware Might Be Recording Your Skype Conversations – Tricks Here\n\n**February 13, 2016 9:59 PM**\n## This Trojan Malware Might Be Recording Your Skype Conversations\n\n**February 13, 2016 10:46 PM**\n## Sherman's Security Blog » T9000 Skype backdoor malware steals audio, video, chats, screenshots, documents\n\n**February 14, 2016 10:41 AM**\n## Бэкдор для Skype | Сфера интересов\n\n**February 14, 2016 9:06 PM**\n## БЭКДОР ДЛЯ SKYPE ПОХИЩАЕТ ДАННЫЕ!!! – Defcon Azerbaijan\n\n**February 17, 2016 6:22 AM**\n## T9000 backdoor, malware that spies on Skype users - HackRaw\n\n**February 18, 2016 4:55 PM**\n## ReHWolution | T9000 – Il Malware che non viene rilevato dagli antivirus\n\n**February 21, 2016 7:33 AM**\n## Trojaner T9000: Skype User werden ausgeschnüffelt - Datenschutz Agentur\n\n**March 15, 2016 9:03 AM**\n## T9000 Trojan Can Compromise Skype and PC Security - Ophtek\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2016/2016.02.04_PaloAlto_T9000-Advanced-Modular-Backdoor/PaloAlto_t9000-advanced-modular-backdoor-uses-complex-anti-analysis-techniques.2016.02.04.pdf"
    ],
    "report_names": [
        "PaloAlto_t9000-advanced-modular-backdoor-uses-complex-anti-analysis-techniques.2016.02.04"
    ],
    "threat_actors": [
        {
            "id": "2f07a03f-eb1f-47c8-a8e9-a1a00f2ec253",
            "created_at": "2022-10-25T16:07:24.277669Z",
            "updated_at": "2025-03-27T02:02:10.157972Z",
            "deleted_at": null,
            "main_name": "TA428",
            "aliases": [
                "Operation LagTime IT",
                "Operation StealthyTrident",
                "ThunderCats"
            ],
            "source_name": "ETDA:TA428",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "Agent.dhwf",
                "Albaniiutas",
                "BlueTraveller",
                "Chymine",
                "Cotx RAT",
                "CoughingDown",
                "Darkmoon",
                "Destroy RAT",
                "DestroyRAT",
                "Gen:Trojan.Heur.PT",
                "Kaba",
                "Korplug",
                "LuckyBack",
                "PhantomNet",
                "PlugX",
                "Poison Ivy",
                "RedDelta",
                "RoyalRoad",
                "SManager",
                "SPIVY",
                "Sogu",
                "TIGERPLUG",
                "TManger",
                "TVT",
                "Thoper",
                "Xamtrav",
                "pivy",
                "poisonivy"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716502,
    "ts_updated_at": 1743041143,
    "ts_creation_date": 1463394165,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/d5e47cedc99e7eafd495003e6bd0b79eb44d4f8d.pdf",
        "text": "https://archive.orkl.eu/d5e47cedc99e7eafd495003e6bd0b79eb44d4f8d.txt",
        "img": "https://archive.orkl.eu/d5e47cedc99e7eafd495003e6bd0b79eb44d4f8d.jpg"
    }
}