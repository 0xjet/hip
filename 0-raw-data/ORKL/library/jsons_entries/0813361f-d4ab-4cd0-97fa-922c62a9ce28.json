{
    "id": "0813361f-d4ab-4cd0-97fa-922c62a9ce28",
    "created_at": "2023-01-12T15:00:01.681747Z",
    "updated_at": "2025-03-27T02:06:10.497819Z",
    "deleted_at": null,
    "sha1_hash": "7c9434290640a8195db53dfd1d1caf61436a3410",
    "title": "2012-12-18 - Malicious Apache module used for content injection- Linux-Chapro.A",
    "authors": "",
    "file_creation_date": "2022-05-27T22:04:51Z",
    "file_modification_date": "2022-05-27T22:04:51Z",
    "file_size": 408637,
    "plain_text": "# Malicious Apache module used for content injection: Linux/Chapro.A\n\n**[blog.eset.com/2012/12/18/malicious-apache-module-used-for-content-injection-linuxchapro-a](http://blog.eset.com/2012/12/18/malicious-apache-module-used-for-content-injection-linuxchapro-a)**\n\nDecember 18, 2012\n\nMore than half of all web servers on the Internet use Apache, so when we discovered a\nmalicious Apache module in the wild last month, we were understandably concerned.\n\n18 Dec 2012 - 01:01AM\n\nMore than half of all web servers on the Internet use Apache, so when we discovered a\nmalicious Apache module in the wild last month, we were understandably concerned.\n\n[Update: _[David Harley has published a blog post here with additional information about this](https://www.welivesecurity.com/2012/12/20/malicious-apache-module-a-clarification)_\n_malware.]_\n\nMore than half of all web servers on the Internet use Apache, so when we discovered a\nmalicious Apache module in the wild last month, being used to inject malicious content into\nweb pages displayed by compromised web servers, we were understandably concerned.\nOur concern deepened when we discovered that this malware was being used in a scheme\nto steal banking credentials.\n\n\n-----\n\n[At first, we wondered if this code might be related to the Linux/Snasko.A rootkit reported to](http://seclists.org/fulldisclosure/2012/Nov/94)\n[the Full-Disclosure mailing list and then analyzed by CrowdStrike and](http://blog.crowdstrike.com/2012/11/http-iframe-injecting-linux-rootkit.html) [Kaspersky but it turns](https://www.securelist.com/en/blog/208193935/)\nout this is a completely different beast.\n\nThe malicious\nApache module we\nhave analyzed is\ndetected by ESET\nas Linux/Chapro.A.\nthe primary\npurpose of which is\nto inject malicious\ncontent into web\npages served up by\nthe compromised\nserver (as\ndiagrammed on the\nright where an\niframe is injected,\nbut it could be\nmalicious\nJavaScript or\nsomething else).\n\nAlthough the module can serve any type of content, in this specific case the final payload,\nachieved via the iframe injection, was installation of a variant of Win32/Zbot, which is\ncommonly used to steal banking information from infected systems.\n\nWe also found that this module has a couple of interesting capabilities designed to reduce\nits chances of being spotted by system administrators. In addition to analyzing the malicious\nApache module, we were able to analyze the malicious content it was serving.\n\nIn this analysis, we will present the characteristics of Linux/Chapro.A. We will also give an\noverview of the exploit kit used to install malware, and the final Win32/Zbot payload.\n\n## Linux/Chapro.A Characteristics\n\nThe Linux/Chapro.A malicious Apache module is an x64 Linux binary. This malware makes\nuse of only one obfuscation technique. It uses an XOR loop with a 12 byte long key to\nencode most of the strings.\n\nThe program has many capabilities to evade detection by system administrators. Before\nserving malicious content to a visitor, multiple checks will be performed.\n\n\n-----\n\nFirst, Linux/Chapro.A checks the web browser s user agent for known bots as well as web\nbrowsers that are not likely to be vulnerable to the exploits used to infect the target system.\nIf the web browser visiting the page has a user agent string that contains keywords known\nto be used by web crawlers, the malware will not be served the malicious content. The\nfollowing figure shows some of the keywords used by the bot.\n\nLinux/Chapro.A will also inspect all active SSH sessions on the Linux system on which it is\nrunning to determine the IP addresses being used by them. If a visitor browses a page\nusing any of the same IPs involved in a SSH connection, it will not be served the malicious\ncontent. This helps hide the malicious content from system administrators, web developers\nand others who might be working on the web server\n\nBefore injecting the malicious iframe into the web content sent by the server,\nLinux/Chapro.A sets a cookie in the visiting web browser. Malicious content will not be\nserved if the visiting browser already had that cookie set. This helps ensure that visitors will\n\n\n-----\n\nnot receive malicious content over and over again, making it more difficult to determine how\na system was infected.\n\nFinally, Linux/Chapro.A maintains a list of IP addresses that have been served malicious\ncontent. If a user visits an infected website twice from the same IP address; it will only\nreceive the malicious content once. This provides a second, additional method to make the\npath of infection more difficult to determine.\n\n## Injected Content\n\nThe main purpose of Linux/Chapro.A is to inject iframes into webpages served by the\nApache webserver to which it is attached. To do so, the malware sends an HTTP POST\nrequest to its command and control server every 10 minutes. The following figure shows\none such HTTP POST request.\n\nAt the time of our analysis, the malicious command and control server was being hosted in\nGermany. It has recently gone offline.\n\nThe request is simple; it only includes the version of the malware and the operating system\nit is running on. The command and control server will respond to the query with the iframe\nto be injected by the malicious apache module. The iframe is encoded using base64 and\nXOR. If a visitor does not fall into any of the blacklists detailed in the previous section, it is\nserved the iframe downloaded from the command and control server.\n\nThe figure below shows the HTML code for an iframe sent by Linux/Chapro.A. The iframe is\npositioned outside of the usual browser display area in order to avoid being seen by the\nuser.\n\n\n-----\n\n## Exploit Kit\n\n[Based on our analysis and descriptions from this article, we are confident the iframe](http://malware.dontneedcoffee.com/2012/08/cve-2012-4681-sweet-orange.html)\ninjected by Linux/Chapro.A points to a “Sweet Orange” exploit pack landing page. At the\ntime of our analysis, the exploit pack was being hosted in Lithuania. The pack tries to\nexploit the following vulnerabilities found in modern web browsers and plugins:\n\n[CVE-2012-5076: Java JAX-WS Class Handling](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-5076)\n[CVE-2012-4681: Java getField Method Class Invocation Privilege Escalation](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-4681)\n[CVE-2006-0003: Internet Explorer MDAC](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-0003)\n[CVE-2010-0188: Adobe Reader LibTiff Integer Overflow](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2010-0188)\n\nIf the exploit pack is able to exploit one of the vulnerabilities it has exploits for, the final\npayload is executed.\n\n## Attack Payload\n\nThe final purpose of the attack we have investigated is to install a variant of Win32/Zbot,\nalso known as ZeuS, which has been widely used for years to steal banking-related\ninformation. In this case, the Win32/Zbot variant targets European and Russian banking\ninstitutions. The screenshot below shows a form used by a bank to give customers online\naccess to account information.\n\n\n-----\n\nApparently this bank is aware that it has been targeted by criminals attempting to obtain\ncustomer PIN code and CVC/CVV code information. Indeed, a specific warning is shown on\nits customer login form. However, when the login page is visited from a compromised host,\nthis warning is removed by the malware, as you can see below.\n\n\n-----\n\nOnce the user has logged into his account, the malware will inject a pop-up asking for the\nCVV code for his card, which is exactly the behavior outlined in the warning on the original\nlogin form. The malware will then try to send the user credentials, along with the CVV, to the\nbotnet operator.\n\n## Conclusions\n\nThe Linux/Chapro.A attack has not been publicly documented in the past. Our telemetry\nsystems did not report other installation of this malicious Apache module in the wild. While\nthe intent of injecting iframes into served webpages is the same as the rootkit analyzed by\nCrowdstrike and Kaspersky, we confirm this is not the same malware family. On the other\nhand, this malware has many similarities to something discussed on Russian underground\n[forums as exposed by Dancho Danchev.](http://blog.webroot.com/2012/11/26/cybercriminals-release-stealthy-diy-mass-iframe-injecting-apache-2-modules/)\n\nWhile we have not witnessed any other installations of Linux/Chapro.A in the wild, we have\nobserved thousands of users accessing the Sweet Orange exploit pack before we blocked\naccess to this server in our products. ESET blocked the exploit attempts through generic\ndetection, even before additional protection was added with URL blocking.\n\nThe attack described in the present analysis shows the increased complexity of malware\nattacks. This complicated case spreads across three different countries, targeting users\nfrom a fourth one, making it very hard for law enforcement agencies to investigate and\nmitigate. It is not clear at this point in time if the same group of people are behind the whole\noperation, or if multiple gangs collaborated, perhaps with one to drive traffic to the exploit\npack and sell the infected computers to another gang operating a botnet based on\nWin32/Zbot.\n\n## Acknowledgements\n\nWe would like to thank the following researchers for their contribution in this research:JeanIan Boutin, François Chagnon, Sébastien Duquette, Aleksander Matrosov.\n\n## Analyzed Files\n\nThe following listing provides the MD5 hashes for the files involved in our research:\n\n**Description** **MD5 Hash**\n\n**Linux/Chapro.A** e022de72cce8129bd5ac8a0675996318\n\n**Injected iframe** 111e3e0bf96b6ebda0aeffdb444bcf8d\n\n**Java exploit** 2bd88b0f267e5aa5ec00d1452a63d9dc\n\n**Zeus binary** 3840a6506d9d5c2443687d1cf07e25d0\n\n\n-----\n\n**Pierre-Marc Bureau**\n**Security Intelligence Program Manager**\n\n18 Dec 2012 - 01:01AM\n\n## Sign up to receive an email update whenever a new article is published in our Ukraine Crisis – Digital Security Resource Center\n\n Newsletter\n\n Discussion\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2012/2012-12-18 - Malicious Apache module used for content injection- Linux-Chapro.A.pdf"
    ],
    "report_names": [
        "2012-12-18 - Malicious Apache module used for content injection- Linux-Chapro.A.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535601,
    "ts_updated_at": 1743041170,
    "ts_creation_date": 1653689091,
    "ts_modification_date": 1653689091,
    "files": {
        "pdf": "https://archive.orkl.eu/7c9434290640a8195db53dfd1d1caf61436a3410.pdf",
        "text": "https://archive.orkl.eu/7c9434290640a8195db53dfd1d1caf61436a3410.txt",
        "img": "https://archive.orkl.eu/7c9434290640a8195db53dfd1d1caf61436a3410.jpg"
    }
}