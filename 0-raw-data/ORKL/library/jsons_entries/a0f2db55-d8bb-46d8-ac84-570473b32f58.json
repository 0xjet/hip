{
    "id": "a0f2db55-d8bb-46d8-ac84-570473b32f58",
    "created_at": "2023-01-12T15:01:35.625842Z",
    "updated_at": "2025-03-27T02:05:19.921519Z",
    "deleted_at": null,
    "sha1_hash": "b615aac05550e18896ded6b8b83c8f4dcc10a26b",
    "title": "2017-08-05 - Analysis of New GlobeImposter Ransomware Variant",
    "authors": "",
    "file_creation_date": "2022-05-29T10:40:46Z",
    "file_modification_date": "2022-05-29T10:40:46Z",
    "file_size": 1110717,
    "plain_text": "# Analysis of New GlobeImposter Ransomware Variant\n\n**[blog.fortinet.com/2017/08/05/analysis-of-new-globeimposter-ransomware-variant](https://blog.fortinet.com/2017/08/05/analysis-of-new-globeimposter-ransomware-variant)**\n\nAugust 5, 2017\n\nThreat Research\n\nBy [Xiaopeng Zhang | August 05, 2017](https://blog.fortinet.com/blog/search?author=Xiaopeng+Zhang)\nOver the past few days, [FortiGuard Labs captured a number of JS (JavaScript) scripts.](https://www.fortinet.com/fortiguard/threat-intelligence/threat-research.html)\nBased on my analysis, they were being used to spread the new GlobeImposter ransomware\nvariants. I picked one of them and did a quick analysis. The version of the variant I reviewed\nis “726”.\n\nFigure 1 shows part of the JS file list that we captured. As you can see, the files with name\nthat start with “IMG_” and “NIC” are all GlobeImposter downloaders.\n\n\n-----\n\nFigure 1. Captured JS file list\n\n**Download and Execution**\n\nWhen the JS “IMG_8798.js” is executed, it downloads GlobeImposter from\n“hxxp://wendybull.com.au/87wefhi??JWbXSIl=JWbXSIl” and runs it. In my test environment,\nthe downloaded file name is 87wefhi.txt.exe. Next we’ll look at how it works on a victim’s\nmachine.\n\nWhen GlobeImposter is launched, it dynamically extracts code into a heap space. It then\ncreates its child process with the flag “CREATE_SUSPENDED”. It creates a suspended\nprocess, and later the code of the child process will be replaced with previously extracted\ncode. This extracted code will be executed when the child process resumes its execution.\nThis behavior is the main part of GlobeImposter’s functionality.\n\nThe screenshot in Figure 2 shows the process tree when GlobeImposter is executed.\n\n\n-----\n\nFigure 2. The Process Tree\n\nThe initial process resumes the execution of its child process by calling “ResumeThread”,\nand then exits. All the analysis below is about that child process.\n\n**The Child Process**\n\nFirst, it calls the API function SetThreadExecutionState and passes 0x80000041H to it. With\nthe parameter 0x80000041H, the Windows system will never sleep while the ransomware is\nencrypting the files. The function is called again with 0x80000000 after its work is done.\n\nTo prevent it from being analyzed easily, most strings and part of its APIs are encrypted.\nThey are decrypted dynamically when running. Afterwards, it decrypts the exclusion folder\nand file extension names. In this version, it sets two exclusion lists. While the ransomware\ngoes through all the folders and files on the victim’s machine, it skips those files in the folders\nwhose names are in an exclusion folder list and those files whose extension names are in an\nexclusion extension list. (In this version, it does do the extension name checking, it ignores\nthe checking result though. Maybe it’s a bug).\n\nBelow are the exclusion lists:\n\nFolder exclusion list: (44 in total)\n\n_Windows, Microsoft, Microsoft Help, Windows App Certification Kit, Windows Defender,_\n_ESET, COMODO, Windows NT, Windows Kits, Windows Mail, Windows Media Player,_\n_Windows Multimedia Platform, Windows Phone Kits, Windows Phone Silverlight Kits,_\n_Windows Photo Viewer, Windows Portable Devices, Windows Sidebar, WindowsPowerShell,_\n_Temp, NVIDIA Corporation, Microsoft.NET, Internet Explorer, Kaspersky Lab, McAfee, Avira,_\n_spytech software, sysconfig, Avast, Dr.Web, Symantec, Symantec_Client_Security, system_\n_volume information, AVG, Microsoft Shared, Common Files, Outlook Express, Movie Maker,_\n_Chrome, Mozilla Firefox, Opera, YandexBrowser, ntldr, Wsus, ProgramData._\n\n\n-----\n\nExtension exclusion list: (170 in total)\n\n_.$er .4db .4dd .4d .4mp .abs .abx .accdb .accdc .accde .accdr .accdt .accdw .accft .adn .adp_\n_.aft .ahd .alf .ask .awdb .azz .bdb .bib .bnd .bok .btr .cdb .cdb .cdb .ckp .clkw .cma .crd_\n_.daconnections .dacpac .dad .dadiagrams .daf .daschema .db .db-shm .db-wa .db2 .db3 .dbc_\n_.dbf .dbf .dbk .dbs .dbt .dbv .dbx .dcb .dct .dcx .dd .df1 .dmo .dnc .dp1 .dqy .dsk .dsn .dta_\n_.dtsx .dx .eco .ecx .edb .emd .eq .fcd .fdb .fic .fid .fi .fm5 .fmp .fmp12 .fmps .fo .fp3 .fp4 .fp5_\n_.fp7 .fpt .fzb .fzv .gdb .gwi .hdb .his .ib .idc .ihx .itdb .itw .jtx .kdb .lgc .maq .mdb .mdbhtm_\n_.mdf .mdn .mdt .mrg .mud .mwb .myd .ndf .ns2 .ns3 .ns4 .nsf .nv2 .nyf .oce .odb .oqy .ora_\n_.orx .owc .owg .oyx .p96 .p97 .pan .pdb .pdm .phm .pnz .pth .pwa .qpx .qry .qvd .rctd .rdb_\n_.rpd .rsd .sbf .sdb .sdf .spq .sqb .sq .sqlite .sqlite3 .sqlitedb .str .tcx .tdt .te .teacher .tmd .trm_\n_.udb .usr .v12 .vdb .vpd .wdb .wmdb .xdb .xld .xlgc .zdb .zdc_\n\n**Relocation and Startup Group**\n\nAfterwards, it copies itself into “%AllUserProfile%\\Public\\” and adds the new file in the startup\ngroup in the victim’s Windows registry. This allows it to be executed automatically whenever\nthe system starts. Figure 3 shows that GlobeImposter has been added\n(….RunOnce\\CerificatesCheck) into the startup group in the Windows registry.\n\nFigure 3. Startup Group in Windows Registry\n\n**Preparatory Work**\n\nTo prevent the victim from restoring encrypted files from the Shadow Volume copies, it calls\n“vssadmin.exe Delete Shadows /All /Quiet” in an executable batch file to delete all shadows.\nIn that batch file it also cleans up Remote Desktop information saved in the system registry\nas well as the file %UserProfile%\\Documents\\Default.rdp. The batch file is called again after\nthe file encryption work is done.\n\nFigure 4 shows the content of the batch file.\n\n\n-----\n\nFigure 4. The Batch File\n\nNext, it initializes encryption related keys, data, etc. for encrypting files 2048-bit RSA. Part of\nthe key related data is saved in a newly created file “%AllUserProfile%\\Public\\{hex\nnumbers}”. The name of {hex numbers} is made from the hardware information of victim’s\nmachine.\n\n**Before Encrypting Files**\n\nKilling some running processes and generating an html file are the last two steps before its\nstarts encrypting files.\n\nIt calls taskkill.exe to kill running processes whose names include \"sql\", \"outlook\", \"ssms\",\n\"postgre\", \"1c\", \"excel\" and \"word\". Killing these processes might cause them to release the\nfiles they are using, which could result in this ransomware encrypting more files.\n\nFigure 5 shows the pseudo code used to do this.\n\n\n-----\n\nFigure 5. Kill Matched Processes\n\nAn HTML file (RECOVER-FILES-726.html) is then generated and dropped in the folder\nwhere the files are encrypted. Opening the HTML file informs the victim that the system’s\nfiles have been encrypted and provides instructions on how to pay to get them back. The\nHTML file consists of the decrypted resources of this exe as well as a “personal ID”.\n\nThis “personal ID” is sent to the server when you see the payment page. That ID allows the\nattacker to identify you and to generate the decryption key. Figure 6 is the screenshot of this\nHTML file content.\n\n\n-----\n\nFigure 6. RECOVER-FILES-726.html Content\n\n**Encryption Process**\n\nWhen GlobeImposter starts encrypting, it first scans files in all of the partitions on the victim’s\nmachine. It then encrypts almost every file as long as its folder name is not in the folder\nexclusion list as mentioned before. It reads the file and then encrypts the file content using\nthe RSA algorithm and then overwrites the original content with encrypted content. The\n“personal ID” is also appended after encrypted content has been added to the file.\n\nFigure 7 shows the content of an encrypted file.\n\nFigure 7. File Content of Encrypted config.sys\n\n\n-----\n\nIt then appends ..726 to every encrypted file name to identify that the file has been\nencrypted.\n\nThe screenshot in Figure 8, below, shows that it is about to rename an encrypted file by\ncalling API MoveFileExW.\n\nFigure 8. Rename Encrypted File\n\nFigure 9 shows the screenshot of encrypted files (including exe files) in the python\ninstallation folder.\n\n\n-----\n\nFigure 9. Encrypted Files in python Folder\n\n**Open RECOVER-FILES-726.html**\n\nFigure 10 shows how you go to the payment page by opening the RECOVER-FILES726.html. file.\n\nFigure 10. Open RECOVER-FILES-726.html\n\n**Solution**\n\nThrough this analysis, we know how GlobeImposter is downloaded onto a victim’s machine,\nand how it works to encrypt the files on victim’s machine. We also observed that many new\nJS samples are spreading this ransomware. Since it uses an RSA 2048-bit key to encrypt\nfiles, it’s very hard to decrypt them without the decryption key.\n\nThe URL in the JS file used to download the GlobeImposter has been rated as a\n“Malicious Website” by the FortiGuard Webfilter service.\nThe JS file is detected as JS/GlobeImposter.A!tr by the FortiGuard Antivirus service.\nThe downloaded GlobeImposter is detected as W32/GlobeImposter.A!trby the\nFortiGuard Antivirus service\n\n\n-----\n\n**IOC**\n\n**URL:**\n\nhxxp://wendybull.com.au/87wefhi??JWbXSIl=JWbXSIl\n\n**Sample SHA256:**\n\nIMG_8798.js\n\n3328B73EF04DEA21145186F24C300B9D727C855B2A4B3FC3FBC2EDC793275EEA\n\n87wefhi.txt.exe\n\n10AA60F4757637B6B934C8A4DFF16C52A6D1D24297A5FFFDF846D32F55155BE0\n\nCopyright © 2022 Fortinet, Inc. All Rights Reserved\n\n[Terms of ServicesPrivacy Policy](https://www.fortinet.com/corporate/about-us/legal.html)\n| Cookie Settings\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-08-05 - Analysis of New GlobeImposter Ransomware Variant.pdf"
    ],
    "report_names": [
        "2017-08-05 - Analysis of New GlobeImposter Ransomware Variant.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535695,
    "ts_updated_at": 1743041119,
    "ts_creation_date": 1653820846,
    "ts_modification_date": 1653820846,
    "files": {
        "pdf": "https://archive.orkl.eu/b615aac05550e18896ded6b8b83c8f4dcc10a26b.pdf",
        "text": "https://archive.orkl.eu/b615aac05550e18896ded6b8b83c8f4dcc10a26b.txt",
        "img": "https://archive.orkl.eu/b615aac05550e18896ded6b8b83c8f4dcc10a26b.jpg"
    }
}