{
    "id": "207c4751-b700-40a6-a21c-da338e662d96",
    "created_at": "2023-01-12T15:07:02.98071Z",
    "updated_at": "2025-03-27T02:05:42.542767Z",
    "deleted_at": null,
    "sha1_hash": "32c22b8097f95f9e25987e1f078d8e0e8739fae9",
    "title": "2020-06-16 - CrystalBit - Apple Double DLL Hijack -- From fraudulent software bundle downloads to an evasive miner raging campaign",
    "authors": "",
    "file_creation_date": "2022-05-28T01:57:47Z",
    "file_modification_date": "2022-05-28T01:57:47Z",
    "file_size": 1250193,
    "plain_text": "# CrystalBit / Apple Double DLL Hijack\n\n**blog.morphisec.com/crystalbit-apple-double-dll-hijack**\n\n[Tweet](https://twitter.com/share)\n\n\n-----\n\nAs part of a rapid change in the work environment during the COVID-19 pandemic,\nMorphisec Labs has been tracking the change in the attack trend landscape. This has\nincluded the evolution of adware, PUA, and fraudulent software bundle delivery beyond a\nconsumer problem into a significant attack vector on enterprise employees.\n\nIn this vein, Morphisec Labs has seen a more than 800 percent increase in preventing\nattacks from adware and fraudulent software bundles among protected enterprises.\n\nIn this blog, we will technically dive into one significant attack campaign example that\nhappened in the second week of May. During this attack, the adversary abuses two\nlegitimate vendor applications, such as CrystalBit and Apple, as part of a dll double hijack\nattack chain that starts with a fraudulent software bundle and eventually leads to a persistent\nminer and in some cases spyware deployment.\n\nThe abuse of the Apple push notification executable (APSDaemon.exe) is certainly not new.\nOver the course of more than a year, adversaries have deployed a legitimate and signed\ncopy of the application together with a malicious AppleVersions.dll that is soon loaded by the\ndaemon. In most cases, the deployment was part of a second stage of an attack and rarely\nhave been seen as part of an infiltration stage.\n\nWhat caught our attention is the use of similar techniques by abusing AnyToIso and\nCrystalBit software as part of the first delivery stage of the attack.\n\n## DLL HIJACK Technical Overview\n\nThe attack chain consists of:\n\n1. Downloading a software bundle from a fraudulent site (DVD plugins, browsers, Excel\n\nplugins, codecs, etc...).\n\nFormat: [random letters and digits]{7,8}_SETUP.zip\n\n\n-----\n\nElevated Execution of a signed AnyToIso / CrystalBit application by the victim, which\nleads to a malicious msimg32.dll hijack (the malicious DLL is bundled together with the\nexecutable)\n\nMsimg32.dll writes a number of files that include the Apple push application and the\nmalicious AppleVersions.dll to a “super” hidden directory under\n%windir%/SysWOW64/Speech/Engines/. In some cases it also writes data.dll. Both the\ndirectory name within the Speech/Engines and the APSDaemon.exe file name are\nrandomized under given constraints\n\nThe APSDaemon.exe new name starts with “fb_” or “rb_”, (“fb_<number>.exe”).\n\nThe directory name starts with “Q-”.\n\nMsimg32.dll creates a scheduled task for persistence, in most cases we have observed a\nGoogleUpdateTask that will execute every 15 minutes. Note: the scheduled task is created\nwith system privileges, you will need system privs to view it.\n\n**Note: to access the folder you will need to disable hidden privileges (attrib -h -s).**\n\n\n-----\n\n### CoinLoader Shellcode\n\nVirusTotal and other 3rd party tools have classified some of the AppleVersions.dll versions in\na very generic way, while some dll versions have got a clear CoinLoader classification, yet\nwith a relatively low detection ratio. We have decided to investigate some of those and\nidentified interesting techniques to extract modules and functions from within the memory\n(known but rare).\n\nMore specifically, their shellcode implemented a variation of the Fowler–Noll–Vo hash\nalgorithm to compare module names and function names during the iteration over the\nProcess environment block structure. This significantly increased their chances to evade\nsecurity vendors that are looking for the regular hash signatures in memory (all leading\nvendors are looking for the ROR-13 hash patterns as those are implemented as part of the\ndefault code injection framework unless the framework is recompiled).\n\n\n-----\n\n## Conclusions\n\nMalware has become much more evasive without relation to its type or category. This\nevasiveness manifests itself through whitelisting bypass, fileless techniques and in-memory\nexecution. Looking for suspicious memory patterns is not enough and will not hold for long,\nwhich makes prevention a clear necessity.\n\nCOVID-19 is the perfect time for adversaries to go hunt for new and less protected\n[environments, WFH (work from home) is such an environment without a proper network](https://engage.morphisec.com/wfh-employee-cybersecurity-threat-index)\nprotection stack, without proper hardening and without proper IT management and\nenforcement.\n\nMorphisec protects such environments without applying any sort of detection by executing\nMoving Target Defense against the same adversaries.\n\n## Artifacts\n\n**AppleVersions.dll**\n\nbe2e196f2920766f4bd63c1c8b566f3546e3fa94e49a1d9ccbc7d5eab54bca2c\n\n171efee993d8f3b6511cf2db29c5f73179706835a23bdd56e19760a5178763d7\n\n\n-----\n\n5e0299afdc9a0a37b364be15520b274565a6eb3894aefb6d9a4fd922a045e919\n\n99b8b6c1063dcdfd1e48819047543d03a2c3b1668f34ded03caae011ebeaf077\n\nd5511bbf5c3242e9bf286cbd158f9b29f7f279539a2f4b6a0ffb5551bcf6ddab\n\n90fce0aec20449e9dc200bd661fa27cd76ffb64a1d998753e9022d618cd6f3dc\n\n288a5cbc213c992991a2c26827bf6dd0c49570797a8be681db3bffc8169302b1\n\n84bfa4c1d0a5fdb3bb92e5df208aa4380147edb20ae5138482d46a4f286ed16c\n\n9e1d1ad0ed4d3a6c91d760140c63f1fc667ef26c5235fe3cac9ceaa412b3dfe7\n\n0607b96955d0d892f7ed07c238a608d88b4af8e0da3e23a74257788c1642f3d5\n\n422d0124825e9aa80d947440de9924a9f30fa06d110f9b6f77a183130892584e\n\n048f0a2ab98627a8c9181e5d867b8114e648afa718ed11830c29882e07556ec4\n\n05f82d05e2281a431ab92056718b11073fb0a2ea65dc2ab646f38b5b4ef88285\n\n36715e5bd086735793d2f2f708cce7e8bd2e9962d4a64e38f79b5b78a87f1a5e\n\n5e78e29357a07517ff907d9cd10b9ec41f5132d84e55aa3ba3e9b95ee854f507\n\nb336e88760604e2bc6e11b64357f0ca9ce940860e25a2e0eea4b16f2bb01b11d\n\nb0fb503452c986755b12466bb7e078e9c1a7dd94b3bc918aabd905dcc831e4ed\n\n920bb63ff5674de12508caa1b6e54e8dfe7c4c4c92e790fd69d3e79ed069cd35\n\nf04611b23d9eade1378205f68e16d68196121ff183420a191b71553a0b210d4d\n\n9bd4695e1c47a07c7d9667093580f99ad8d5a83090d537dcabb235b06bb88d8e\n\n6bc08768a5c3136de42e05d8051c2d17a7c65712363f75d8e56c015ac023a3f0\n\nfb3039cbc5dc39017d67de2b39971d30c836efd2370b3a16177979dbbebbb88a\n\na14837ba556522a151b507360baaf42285cadaf75bdb0b15f86ada031833e27a\n\n088388c4aed1eecd75d93d95eb41cfea563cbcf2ef324e2d1817797da4dc0215\n\n26a112534dd567f95d2f78f15c6a0d41507c32b190a6023eeaea11e20bc33f3a\n\n9de38aa482828653edf5d1cc4a6631af79c95082ba9cdf67b7929d33bc7e42c1\n\n843207d8bf91d6345943941292ade06a3f3d78d3c7a381d03a06618dc9690056\n\n\n-----\n\n2738dfb0ce4f24cdd866da1ae699667088c4c1b89259408ebc1eeed3c330faa0\n\n6f887d71f64c3cea6ae2962abf4c5c6884574d20c2475957d0c91f299e82afd8\n\n0888b450848000dbf4cdd35de0755b8ca5388718757d7c3de0755f5d00c9fbf8\n\nada8b31410bfa6feb10736607ad289f8fa938cd82387b32decb8d34d4be82814\n\n**Msimg32.dll**\n\n6dc8f7a18e1fd63e741635670ce8b1a96149f50cb10b672edf2f58f3cbb9898c\n\n6e1dc8519b4663e14116363029be7d290d22cea4198884c79a9b3c036ff8c3d5\n\n4109fc98007e41d7cf63547c29b6c558c67dec938d280c8ed091eafdccce2732\n\nf0d4f8c304032a1087d8a70978943bf7fcd9d69df514e2efa03ddc264403b9ff\n\nf0b9910df11b920d27da387eb4cabe5db21e07166aaf530fd877698225b7588e\n\na86158e10fda310befe2678e77fb82742e7e486ae153f9792dc630625efcf1e9\n\n8da42709a5e6ab3dd66f31eb76efed0026d0d580849e44da1bbc3315170566fa\n\nbd9713d2710851854cc3ec33807639df450d0a7665d238ebff14a8b434426379\n\n6dc8f7a18e1fd63e741635670ce8b1a96149f50cb10b672edf2f58f3cbb9898c\n\naebe99b84f571b460d6e05b2b7b644cb6c11e891b625390963e57ec5470ea15b\n\n[Contact SalesInquire via Azure](http://10.10.0.46/mailto:sales@morphisec.com)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-06-16 - CrystalBit - Apple Double DLL Hijack -- From fraudulent software bundle downloads to an evasive miner raging campaign.pdf"
    ],
    "report_names": [
        "2020-06-16 - CrystalBit - Apple Double DLL Hijack -- From fraudulent software bundle downloads to an evasive miner raging campaign.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536022,
    "ts_updated_at": 1743041142,
    "ts_creation_date": 1653703067,
    "ts_modification_date": 1653703067,
    "files": {
        "pdf": "https://archive.orkl.eu/32c22b8097f95f9e25987e1f078d8e0e8739fae9.pdf",
        "text": "https://archive.orkl.eu/32c22b8097f95f9e25987e1f078d8e0e8739fae9.txt",
        "img": "https://archive.orkl.eu/32c22b8097f95f9e25987e1f078d8e0e8739fae9.jpg"
    }
}