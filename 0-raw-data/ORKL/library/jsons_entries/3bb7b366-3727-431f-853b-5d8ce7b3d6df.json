{
    "id": "3bb7b366-3727-431f-853b-5d8ce7b3d6df",
    "created_at": "2022-10-25T16:48:24.418004Z",
    "updated_at": "2025-03-27T02:09:18.052224Z",
    "deleted_at": null,
    "sha1_hash": "0d10aa820095e0782fd38e79f5f04a5fb7cbc5d6",
    "title": "Technical Analysis of Cuba Ransomware",
    "authors": "",
    "file_creation_date": "2021-04-04T23:42:11Z",
    "file_modification_date": "2021-04-05T15:11:37Z",
    "file_size": 1794785,
    "plain_text": "# T e c h n i c a l\n\n A n a l y s i s\n\n o f C u b a\n\n R a n s o m w a r e\n\n\n-----\n\n### Table of Contents\n\n##### 4 Summary of Findings\n\n 5 Attack Overview\n\n 5 Impacted Countries\n\n 6 Technical Analysis\n\n 6 Lateral Movement 7 Ransomware Analysis\n\n 7 Packed sample 7 Unpacked Sample 10 Recent Sample\n\n 10 Conclusion\n\n 11 IOCs\n\n 11 Email addresses 11 Domain 11 Script for lateral movement and deployment 11 Cuba Ransomware\n\n\n##### 12 Process / Services Kill list\n\n 12 MITRE ATT&CK Techniques\n\n 14 YARA Rules\n\n 14 Cuba Dec 2019 15 Cuba variant May 2020 17 Cuba variant Dec 2020 18 Cuba ransomware March 2021 20 Cuba ransomware March 2021 Unpacked 23 About McAfee\n\n 23 McAfee ATR\n\n 23 Additional Resources\n\n\n-----\n\n### Introduction\n\n#### Cuba ransomware is an older ransomware that has been active for the past few years. The actors behind it recently switched to leaking the stolen data to increase its impact and revenue, much like we have seen recently with other major ransomware campaigns.\n\n In our analysis, we observed that the attackers had access to the network before the infection and were able to collect specific information in order to orchestrate the attack and have the greatest impact. The attackers operate using a set of PowerShell scripts that enables them to move laterally. The ransom note mentions that the data was exfiltrated before being encrypted. In similar attacks we have observed the use of a Cobalt Strike payload, although we have not found clear evidence of a relationship with Cuba ransomware.\n\n We observed Cuba ransomware targeting financial institutions, industry, technology, and logistics organizations.\n\n For active protection, more details can be found on our website:\n https://www.mcafee.com/enterprise/en-us/threat-center/threat-landscape-dashboard/ ransomware-details.cuba-ransomware.html\n\n The following report provides an overview analysis of the capabilities of Cuba ransomware and an explanation of how it works. The data included in this report is related to a Cuba ransomware sample from late 2020. We have also updated the findings with a recent sample.\n\n\n###### Authors\n\n This report was researched\n and written by:\n\n- Thomas Roccia\n\n- Thibault Seret\n\n- Alexandre Mundo\n\n###### Subscribe to receive threat information.\n\nConnect With Us\n\n\n-----\n\n## Technical Analysis of Cuba Ransomware Second Line\n\n\n##### Summary of Findings\n\n- Cuba ransomware has targeted several companies in\n\n###### north and south America as well as in Europe.\n\n- The attackers used a set of obfuscated PowerShell\n\n###### scripts to move laterally and deploy their attack.\n\n- They used an online website to publish the stolen data.\n\n\n\n- The malware is obfuscated and comes with several\n\n###### evasion techniques.\n\n- The actors have sold some of the stolen data.\n\n- The ransomware uses multiple argument options and\n\n###### has the possibility to discover shared resources using the NetShareEnum API.\n\n\nConnect With Us\n\n\n-----\n\n##### Attack Overview\n\n###### The current infection vectors are currently unknown. Once the network is breached, the attackers deploy a set of PowerShell scripts to move laterally and deploy the next stages.\n\n The attackers recently leaked the stolen data online at this address: http:// cuba4mp6ximo2zlo[.]onion.\n\n The following screenshot shows the website.\n\n\n###### It is interesting to note that the actors sold some specific stolen data rather than just leaked it. Below is an example for data stolen from the company AFTS.\n\n##### Impacted Countries\n\n###### The following picture shows an overview of the countries that have been impacted according to our telemetry.\n\n\n-----\n\n##### Technical Analysis\n\n Lateral Movement\n\n###### Several files, including deployment scripts, were discovered in the environment. The following batch files were created to deploy an obfuscated PowerShell script that loads into memory and installs the ransomware.\n\nFile type DOS batch file, ASCII text, with CRLF line terminators\n\nFile name 151.bat\n\nFile size 175\n\n\nHash\nSha256\n\n\n54627975c0befee0075d6da1a53af9403f047d9e367389e48ae0d25c2a7154bc\n\n\n###### The extract below shows the contents of this batch file. It is used to run a custom PowerShell script with the name 151.ps1 then autodeletes itself.\n\n```\n@ echo off\nC:\\Windows\\SysWOW64\\WindowsPowerShell\\v1.0\\powershell.exe -windowstyle\n\n```\nhidden -executionpolicy bypass -file c:\\windows\\temp\\151.ps1\n```\nTimeout /t 15\ndel %0\nexit\n\n```\n\n###### The below screenshot shows an extract of the PowerShell script.\n\n The PowerShell script allocates memory space to run the base64 encoded payload. The payload will be loaded into memory, contact the remote server and download the next stage.\n\n In another file discovered and named “Kurva.ps1”, we identified the same functionalities used (Note that Kurva means “bitch” in the Polish language).\n\nFile type ASCII text, with very long lines, with CRLF line terminators\n\nFile name kurva.ps1\n\nFile size 2182\n\n\n###### The number 151 for naming the script is related to the campaign number.\n\nFile type ASCII text, with very long lines, with CRLF line terminators\n\nFile name 151.ps1\n\nFile size 2642\n\n\nHash\nSHA256\n\n\n40101fb3629cdb7d53c3af19dea2b6245a8d8aa9f28febd052bb9d792cfbefa6\n\n\n###### The remote C2 is at the address kurvalarva[.]com and is known as being malicious The downloaded payload is the Cuba ransomware\n\n\nHash\nSHA256\n\n\nc385ef710cbdd8ba7759e084051f5742b6fa8a6b65340a9795f48d0a425fec61\n\n\n-----\n\n##### Ransomware Analysis\n\n###### In the version we analyzed, the ransomware comes packed and obfuscated. It uses the 360-antivirus icon and metadata to trick the user. In a more recent sample, the ransomware is using the OpenVPN metadata.\n\n At the end of the encryption process the ransomware will display a fake message to prompt restarting of the system.\n\n It uses the extension “.cuba” and the file marker in the encrypted file is “FIDEL.CA,” as shown below:\n\n\n###### In every folder, the sample will write the following ransom note:\n\n The sample uses multiple layers of obfuscation to avoid analysis and detection. Once unpacked, however, it is possible to analyze it.\n\n##### Packed sample\n\nFile type PE32 executable (GUI) Intel 80386, for MS Windows\n\nFile name COM.exe\n\nFile size 3012952\n\nHash SHA256 c4b1f4e1ac9a28cc9e50195b29dde8bd54527abc7f4d16899f9f8315c852afd4\n\nCompile time 1983-03-01 22:41:12\n\nSections 4 (0 suspicious)\n\nDirectories import, resource, security\n\nDetected sign, antidbg\n\nImport Hash 255ee022f76f062a24b690a8edb70334\n\n##### Unpacked Sample\n\nFile type PE32 executable (GUI) Intel 80386, for MS Windows\n\nFile name 400000.COM.exe\n\nFile size 72544\n\n\nHash\nSHA256\n\nCompile\ntime\n\n\n944ee8789cc929d2efda5790669e5266fe80910cabf1050cbb3e57dc62de2040\n\n2020-09-03 00:05:36\n\n\nSections 5 (0 suspicious)\n\nDirectories import, resource, debug, tls, relocation\n\nDetected packer, mutex, antidbg\n\n\nImport\nHash\n\n\ne9fcbfea37836d5b16c8427ecb7ba2a7\n\n\n-----\n\n###### In the unpacked sample, we can see that the compilation timestamp is dated “2020-09-03.”\n\n The ransomware has special options that can be used, allowing the threat actor to have flexibility in the attack. The sample will also check the installed languages (looking, for example, for the Russian language).\n\n```\n/dm\n/min\n/max\n/net\n/scan\n\n```\n\n###### The switches “/min” and “/max” can be used by an operator to encrypt files with a size between two values to make it faster and more impactful.\n\n After the end of the attack, or by using the option “/dm”, it will terminate the execution of the process and delete itself using “cmd.exe /c del”. \n\n\n-----\n\n###### The switch “/net” will get the ARP table using the function GetIpNetTable and search the machine’s network shares with the function NetShareEnum. Using GetIpNetTable can recover the last connections to the victim machine, allowing those IP addresses to be used to attack more targets.\n\n Prior to encrypting files, it will terminate the following services and processes:\n\n\n###### The malware also has the capability to encrypt shared resources.\n\n\n-----\n\n##### Recent Sample\n\n###### In a recent sample, the actors behind Cuba ransomware updated some of its functions. In this variant the ransomware is using SeDebugPrivilege to elevate privileges. Additionally, they updated the list of services and processes to terminate.\n\n Th th f ti i th i th i t\n\n\n##### Conclusion\n\n###### Cuba ransomware has recently impacted several organizations. In this short report we briefly detailed the threat actors’ capabilities and provided an overview of the ransomware. It is interesting to note that the website for leaking stolen data was put online some months ago and follows the same trends as other ransomware actors.\n\n The use of arguments demonstrates that the ransomware has been developed to be modular and practical for the authors to gain access, discover, and encrypt data more easily.\n\n While this brief threat report shows some aspects of the Cuba ransomware, it also provides an overview of the operating methods used by the attackers.\n\n McAfee® Advanced Threat Research Team is actively monitoring this threat for future releases.\n\n\n-----\n\n##### IOCs\n\n Email addresses\n\n\n##### Cuba Ransomware\n\n```\nunder _ amur@protonmail[.]ch\nhelpadmin2@cock[.]li\nhelpadmin2@protonmail[.]com\niracomp2@protonmail[.]ch\nfedelsupportagent@cock.li\nadmin@cuba-supp.com\ncuba _ support@exploit.im\n\n```\n\n##### Domain\n\n```\nkurvalarva[.]com\n\n```\n\n##### Script for lateral movement and deployment\n\n```\n54627975c0befee0075d6da1a53af9403f047d9e367389e48ae0d25c2a7154bc\nc385ef710cbdd8ba7759e084051f5742b6fa8a6b65340a9795f48d0a425fec61\n40101fb3629cdb7d53c3af19dea2b6245a8d8aa9f28febd052bb9d792cfbefa6\n\n```\n```\nc4b1f4e1ac9a28cc9e50195b29dde8bd54527abc7f4d16899f9f8315c852afd4\n944ee8789cc929d2efda5790669e5266fe80910cabf1050cbb3e57dc62de2040\n78ce13d09d828fc8b06cf55f8247bac07379d0c8b8c8b1a6996c29163fa4b659\n33352a38454cfc247bc7465bf177f5f97d7fd0bd220103d4422c8ec45b4d3d0e\n672fb249e520f4496e72021f887f8bb86fec5604317d8af3f0800d49aa157be1\ne942a8bcb3d4a6f6df6a6522e4d5c58d25cdbe369ecda1356a66dacbd3945d30\n907f42a79192a016154f11927fbb1e6f661f679d68947bddc714f5acc4aa66eb\n28140885cf794ffef27f5673ca64bd680fc0b8a469453d0310aea439f7e04e64\n271ef3c1d022829f0b15f2471d05a28d4786abafd0a9e1e742bde3f6b36872ad\n6396ea2ef48aa3d3a61fb2e1ca50ac3711c376ec2b67dbaf64eeba49f5dfa9df\nbda4bddcbd140e4012bab453e28a4fba86f16ac8983d7db391043eab627e9fa1\n7a17f344d916f7f0272b9480336fb05d33147b8be2e71c3261ea30a32d73fecb\nc206593d626e1f8b9c5d15b9b5ec16a298890e8bae61a232c2104cbac8d51bdd\n9882c2f5a95d7680626470f6c0d3609c7590eb552065f81ab41ffe074ea74e82\nc385ef710cbdd8ba7759e084051f5742b6fa8a6b65340a9795f48d0a425fec61\n54627975c0befee0075d6da1a53af9403f047d9e367389e48ae0d25c2a7154bc\n1f825ef9ff3e0bb80b7076ef19b837e927efea9db123d3b2b8ec15c8510da647\n40101fb3629cdb7d53c3af19dea2b6245a8d8aa9f28febd052bb9d792cfbefa6\n00ddbe28a31cc91bd7b1989a9bebd43c4b5565aa0a9ed4e0ca2a5cfb290475ed\n729950ce621a4bc6579957eabb3d1668498c805738ee5e83b74d5edaf2f4cb9e\n\n```\n\n-----\n\n##### Process / Services Kill list\n\n```\nMySQL, MySQL80, SQLSERVERAGENT, MSSQLSERVER, SQLWriter, SQLTELEMETRY,\nMSDTC, SQLBrowser, sqlagent.exe, sqlservr.exe, sqlwriter.exe, sql­\nceip.exe, msdtc.exe, sqlbrowser.exe, vmcompute, vmms, vmwp.exe, vmsp.\nexe, outlook.exe, MSExchangeUMCR, MSExchangeUM, MSExchangeTransport­\nLogSearch, MSExchangeTransport, MSExchangeThrottling, MSExchange­\nSubmission, MSExchangeServiceHost, MSExchangeRPC, MSExchangeRepl,\n\n```\nMSExchangePOP3BE, MSExchangePop3, MSExchangeNotificationsBroker,\n```\nMSExchangeMailboxReplication, MSExchangeMailboxAssistants, MSEx­\nchangeIS, MSExchangeIMAP4BE, MSExchangeImap4, MSExchangeHMRecovery,\nMSExchangeHM, MSExchangeFrontEndTransport, MSExchangeFastSearch,\nMSExchangeEdgeSync, MSExchangeDiagnostics, MSExchangeDelivery, MSEx­\nchangeDagMgmt, MSExchangeCompliance,MSExchangeAntispamUpdate\n\n```\n\n##### MITRE ATT&CK Techniques\n\n**Tactic** **Technique** **Observable** **IOCs**\n\n\nExecution Command and Scripting Interpreter: PowerShell\n(T1059.001)\n\nExecution System Services: Service Execution (T1569.002)\n\n\nCuba team is using PowerShell payload to drop Cuba\nransomware\n\n\nf739977004981fbe4a54bc68be18ea79\n\n68a99624f98b8cd956108fedcc44e07c\n\nbdeb5acc7b569c783f81499f400b2745\n\n\nExecution Shared Modules (T1129) Cuba ransomware links function at runtime Functions:\n\n“GetModuleHandle”\n\n“GetProcAddress”\n\n“GetModuleHandleEx”\n\nExecution Command and Scripting Interpreter (T1059) Cuba ransomware accepts command line arguments Functions:\n\n“GetCommandLine”\n\n\nPersistence Create or Modify System Process: Windows Service\n(T1543.003)\n\n\nCuba ransomware can modify services Functions:\n\n“OpenService”\n\n“ChangeServiceConfig”\n\n\nPrivilege Escalation Access Token Manipulation (T1134) Cuba ransomware can adjust access privileges Functions:\n\n“SeDebugPrivilege”\n\n“AdjustTokenPrivileges”\n\n\n-----\n\n**Tactic** **Technique** **Observable** **IOCs**\n\nDefense Evasion File and Directory Permissions Modification (T1222) Cuba ransomware will set file attributes Functions:\n\n“SetFileAttributes”\n\nDefense Evasion Obfuscated files or Information (T1027) Cuba ransomware is using xor algorithm to encode\ndata\n\nDefense Evasion Virtualization/Sandbox Evasion: System Checks Cuba ransomware executes anti-vm instructions\n\nDiscovery File and Directory Discovery (T1083) Cuba ransomware enumerates files Functions:\n\n“FindFirstFile”\n\n“FindNextFile”\n\n“FindClose”\n\n“FindFirstFileEx”\n\n“FindNextFileEx”\n\n“GetFileSizeEx”\n\nDiscovery Process Discovery (T1057) Cuba ransomware enumerates process modules Functions:\n\n“K32EnumProcesses”\n\n\nDiscovery System Information Discovery (T1082) Cuba ransomware can get keyboard layout,\nenumerates disks, etc.\n\n\nFunctions:\n\n“GetKeyboardLayoutList”\n\n“FindFirstVolume”\n\n“FindNextVolume”\n\n“GetVolumePathNamesForVolumeName”\n\n“GetDriveType”\n\n“GetLogicalDriveStrings”\n\n“GetDiskFreeSpaceEx”\n\n\nDiscovery System Service Discovery (T1007) Cuba ransomware can query service status Functions:\n\n“QueryServiceStatusEx”\n\nCollection Input Capture: Keylogging (T1056.001) Cuba ransomware logs keystrokes via polling Functions:\n\n“GetKeyState”\n\n“VkKeyScan”\n\nImpact Service Stop (T1489) Cuba ransomware can stop services\n\nImpact Data encrypted for Impact (T1486) Cuba ransomware encrypts data\n\n\n-----\n\n##### YARA Rules\n\n Cuba Dec 2019\n\n```\nrule RANSOM _ Cuba _ Dec2019 {\nmeta:\ndescription = “Rule to detect Cuba Ransomware 2019 version”\nauthor = “McAfee ATR”\ndate = “2021-02-23”\nrule _ version = “v1”\nhash = “ bda4bddcbd140e4012bab453e28a4fba86f16ac8983d7db391043eab627e9fa1”\nmalware _ type = “Ransom”\nstrings:\n$s1 = “VirtualProtect” fullword ascii\n$s2 = “GetStartupInfoA” fullword ascii\n$s3 = “GetModuleHandleA” fullword ascii\n$s4 = “ListDrop” fullword ascii\n$s5 = “WinExec” fullword ascii\n$pattern1 = {BF90C5BC9827B183908CB29090103240409A1DCD40BE90004D6C8704433AC0B6BF294087400D878C2940C5C17940BB00903AC3064062400D9B8940B80DBF88CB90902ABFBF­\nC9517C9057C472C6908E41904F}\n$pattern2 = {000CADDD1B48CCB34848CCB34848CCB34827D3B84840CCB348CBD0BD4854CCB34827D3B94813CCB348B7ECB7484DCCB34848CCB24809CCB3482AD3A0484ACCB348B7EC­\nB9484ACCB3481CEF82484ECCB348}\n$pattern3 = {F2FB58C3A06EA22ED5FB2BD44D066BA6862B6B187B123740FB2FC36B107EEF2A2463D6FB406B6BFB33A36B76FB01D66BFB0CC02BFBA70FD36B6B2E2CA20A6B6B286E­\n6BA06B2B}\n\n```\n\n-----\n\n```\n$pattern4 = {4090D8BC00BF909000C9908F00CB90798559C64090CB54B255A870900DBDDC09B290149090AF35BE3490C307BFB476CB40901B0AD840BFA32590FB409078053D004\n0F4814853}\n$pattern5 = {6B6BE03967E0397FE01943017332589458ABC7570A1769474BAAA4666893899BEA9430D72101E0317BE0791EB0E2369B0AE02E9BE0269B682357E2E65B949494D1636B}\ncondition:\n\n```\nfilesize <= 750KB and\n```\n4 of ($s*) and\n4 of ($pattern*)\n}\n\n```\n\n##### Cuba variant May 2020\n\n```\nrule RANSOM _ Cuba _ variant _ May2020 {\nmeta:\ndescription = “Rule to detect Cuba Ransomware variant from May 2020”\nauthor = “McAfee ATR”\ndate = “2021-02-23”\nrule _ version = “v1”\nhash = “7a17f344d916f7f0272b9480336fb05d33147b8be2e71c3261ea30a32d73fecb”\nmalware _ type = “Ransom”\nstrings:\n\n```\n$s1 = “Good day. All your files are encrypted. For decryption contact us.” fullword ascii\n```\n$s2 = “CryptGenRandom” fullword ascii\n\n```\n\n-----\n\n```\n$s3 = “VirtualAlloc” fullword ascii\n$s4 = {0021002100460041005100200066006F0072002000440065006300720079007000740069006F006E00210021002E007400780074}\n// !!FAQ for Decryption!!.txt\n$pattern1 = {C1C109334D8C8D3C01C1C70D337D94897D9C8D0439C1C01233C28B55988945A08D0413C1C00733458803D0C1C2093355848D1C02C1C30D335DB0895DB08D3C1A8BDF897DB­\n8C1C312335D98895DB88B5DB403D8C1C30733DE8B75B4895D90895DC08D3C33C1C70933F9897D8C897DC48D0C3BC1C10D33C8894D}\n$pattern2 = {B08D4DFB33C03BF977078D4DBC3BD1730B8D4E3F3BF977253BD672218B5DB48B75B88D55BC03D0408A0C16320A880C1383F84072ED8B750C8B5DACEB3E0F1045B­\nC0F100E660FEFC80F10}\n$pattern3 = {837E283872EF0FB646078846640FB646068846650FB646058846660FB646048846670FB646038846680FB646028846690FB6460188466A0FB60688466B8D462C5056E81E01}\n$pattern4 = {342A3464349434C43402355A35A235D4350A366536B536F236A337CD37F2371A384A389938D43804392A395A39A939DA39143A323A6E3AAE3AD23AFC3A223B5C}\n$pattern5 = {512085F6773372133B15FC294600732985F67725720583FA1D731E0FB682AC28460039411875128B0495802946005F5B890133C05E8BE55DC30BD6750B5F5B89}\ncondition:\n\n```\nfilesize <=600KB and\n```\n3 of ($s*) and\n4 of ($pattern*)\n}\n\n```\n\n-----\n\n##### Cuba variant Dec 2020\n\n```\nrule RANSOM _ Cuba _ variant _ Dec2020 {\nmeta:\ndescription = “Rule to detect Cuba Ransomware variant from December 2020”\nauthor = “McAfee ATR”\ndate = “2021-02-23”\nrule _ version = “v1”\nhash = “33352a38454cfc247bc7465bf177f5f97d7fd0bd220103d4422c8ec45b4d3d0e”\nmalware _ type = “Ransom”\nstrings:\n\n```\n$s1 = “Good day. All your files are encrypted. For decryption contact us.” fullword ascii\n```\n$s2 = “SeDebugPrivilege” fullword ascii\n$s3 = “md5WithRSAEncryption” fullword ascii\n$s4 = “CryptGenRandom” fullword ascii\n$s5 = “CryptAcquireContextW” fullword ascii\n$s6 = “FindFirstFileExW” fullword ascii\n// Main function\n$main1 = { 55 8b ec 83 ec 44 a1 0c 70 42 00 33 c5 89 45 fc 8b 45 10 56 33 f6 66 39 30 74 03 50 eb 05 68 08 be 41 00 e8 17 ea ff ff 8d 45 bc 50 6a 10\nff 15 c8 71 41 00 85 c0 7e 0c 80 7c b5 bc 19 74 0a 46 3b f0 7c f4 e8 11 ff ff ff 8b 4d fc 33 c0 33 cd 5e e8 34 74 00 00 c9 c2 10 00 }\n$main2 = {558bec83ec44a1????????33c58945fc8b45105633f666393074??50eb??68????????e8????????8d45bc506a??ff??????????85c07e??807cb5bc1974??463bf07c??e8??????­\n??8b4dfc33c033cd5ee8????????c9c21??0}\n\n```\n\n-----\n\n```\n$main3 = {558bec83ec44a1????????33c58945fc8b45105633f6663930[2-6]50[2-6]68????????e8????????8d45bc506a??ff??????????85c0[2-6]807cb5bc19[2-6]463bf0[2-6]\ne8????????8b4dfc33c033cd5ee8????????c9c21??0}\n$main4 = { 55 8B EC 83 EC 44 A1 ?? ?? ?? ?? 33 C5 89 45 ?? 8B 45 ?? 56 33 F6 66 39 30 74 ?? 50 EB ?? 68 08 BE 41 00 E8 ?? ?? ?? ?? 8D 45 ?? 50 6A 10\nFF 15 ?? ?? ?? ?? 85 C0 7E ?? 80 7C B5 ?? 19 74 ?? 46 3B F0 7C ?? E8 ?? ?? ?? ?? 8B 4D ?? 33 C0 33 CD 5E E8 ?? ?? ?? ?? C9 C2 10 00}\ncondition:\n\n```\nfilesize <= 180KB and\n```\n4 of ($s*) and\nany of ($main*)\n}\n\n```\n\n##### Cuba ransomware March 2021\n\n```\nrule RANSOM _ Cuba _ March2021\n{\nmeta:\ndescription = “Rule to detect Cuba ransomware March 2021 version”\nauthor = “McAfee ATR”\ndate = “2021-03-31”\nhash = “2af30ca88d11eb0c1a4bd4f0aa0ce685”\n\n```\n\n-----\n\n```\nstrings:\n$s1 = “VirtualAlloc” wide ascii\n$s2 = “GetSystemDirectoryW” wide ascii\n$s3 = “ShellExecuteEx” wide ascii\n$s4 = “SHEmptyRecycleBinA” wide ascii\n$s5 = “CommandLineToArgvW” wide ascii\n$fnc1 = { 55 8b ec 83 ec 18 c7 45 fc 40 00 00 00 c7 45 f4 00 00 00 00 a1 40 c1 44 00 89 45 e8 c7 45 f8 ff ff ff ff 8b 0d 7c a7 44 00 89 0d a0 c1 44\n00 ff 75 fc 68 01 30 00 00 83 2c 24 01 ff 75 e8 ff 75 f4 ff 35 a0 c1 44 00 59 ff d1 89 45 ec 8b 55 ec 89 15 84 c1 44 00 a1 40 c1 44 00 a3 44 c1 44\n00 8b 0d 84 c1 44 00 81 c1 c0 51 02 00 89 0d 50 c1 44 00 8b 45 ec 8b e5 5d c3 }\n$fnc2 = {558bec83ec18c7????????????c745f4????????a1????????8945e8c7????????????8b??????????89??????????ff75fc68????????832c2401ff75e8ff75f4ff??????????59ff­\nd18945ec8b55ec89??????????a1????????a3????????8b??????????81??????????89??????????8b45ec8be55dc3}\n$fnc3 = { 55 8B EC 83 EC 18 C7 45 ?? 40 00 00 00 C7 45 ?? 00 00 00 00 A1 ?? ?? ?? ?? 89 45 ?? C7 45 ?? FF FF FF FF 8B 0D ?? ?? ?? ?? 89 0D ?? ?? ??\n?? FF 75 ?? 68 01 30 00 00 83 2C 24 01 FF 75 ?? FF 75 ?? FF 35 ?? ?? ?? ?? 59 FF D1 89 45 ?? 8B 55 ?? 89 15 ?? ?? ?? ?? A1 ?? ?? ?? ?? A3 ?? ?? ?? ??\n8B 0D ?? ?? ?? ?? 81 C1 C0 51 02 00 89 0D ?? ?? ?? ?? 8B 45 ?? 8B E5 5D C3}\ncondition:\n\n```\nfilesize >= 350KB and filesize <= 500KB and\n```\n4 of ($s*) and\n1 of ($fnc*)\n}\n\n```\n\n-----\n\n##### Cuba ransomware March 2021 Unpacked\n\n```\nrule RANSOM _ Cuba _ Unpacked _ March2021\n{\nmeta:\ndescription = “Rule to detect Cuba ransomware unpacked”\nauthor = “McAfee ATR”\ndate = “2021-03-31”\nhash = “aef29cad14fd64de387c274476887c94”\nmalware _ type = “Ransom”\nstrings:\n$s1 = “Good day” wide ascii\n$s2 = “AppPolicyGetProcessTerminationMethod” wide ascii\n$s3 = “GetOEMCP” wide ascii\n$s4 = “GetCommandLineA” wide ascii\n$s5 = “GetProcAddress” wide ascii\n$main1 = { 55 8b ec 81 ec 78 06 00 00 a1 0c a0 42 00 33 c5 89 45 fc 56 8b 75 10 b9 b8 aa 42 00 6a 05 68 18 f0 41 00 e8 b8 04 00 00 66 c7 05 d0 aa\n42 00 00 00 0f 57 c0 c6 05 d2 aa 42 00 00 66 0f 13 05 d8 aa 42 00 c7 05 e0 aa 42 00 ff ff ff ff c7 05 e4 aa 42 00 ff ff ff 7f 85 f6 0f 84 57 01 00\n00 66 83 3e 00 0f 84 4d 01 00 00 8d 85 e0 f9 ff ff c7 85 e0 f9 ff ff 00 00 00 00 50 56 ff 15 c4 a1 41 00 8b 8d e0 f9 ff ff 89 85 88 f9 ff ff 85 c9\n0f 84 21 01 00 00 57 8b 38 33 f6 66 83 3f 2f 74 31 8b d7 8d 72 02 66 8b 02 83 c2 02 66 85 c0 75 f5 2b d6 b9 b8 aa 42 00 d1 fa 52 57 e8 20 04 00 00\n8b 8d e0 f9 ff ff be 01 00 00 00 8b 85 88 f9 ff ff 3b f1 0f 8d dc 00 00 00 53 66 0f 1f 44 00 00 8b 1c b0 33 ff 46 3b f1 7d 0c 8b 04 b0 66 83 38 2f\n74 03 8b f8 46 68 24 f0 41 00 53 ff 15 5c a0 41 00 85 c0 75 0c c6 05 d2 aa 42 00 01 e9 8e 00 00 00 68 2c f0 41 00 53 ff 15 5c a0 41 00 85 c0 75 1a\n85 ff 74 7a 57 e8 98 bd 00 00 83 c4 04 a3 d8 aa 42 00 89 15 dc aa 42 00 eb 64 68 38 f0 41 00 53 ff 15 5c a0 41 00 85 c0 75 1a 85 ff 74 50 57 e8 6e\nbd 00 00 83 c4 04 a3 e0 aa 42 00 89 15 e4 aa 42 00 eb 3a 8b 3d 5c a0 41 00 68 44 f0 41 00 53 ff d7 85 c0 75 09 c6 05 d0 aa 42 00 01 eb 1f 68 50 f0\n\n```\n\n-----\n\n```\n41 00 53 ff d7 0f b6 0d d1 aa 42 00 85 c0 ba 01 00 00 00 0f 44 ca 88 0d d1 aa 42 00 8b 8d e0 f9 ff ff 8b 85 88 f9 ff ff 3b f1 0f 8c 2c ff ff ff 5b\n5f 8d 85 a0 f9 ff ff 50 6a 10 ff 15 cc a1 41 00 33 c9 85 c0 7e 14 0f 1f 44 00 00 80 bc 8d a0 f9 ff ff 19 74 0a 41 3b c8 7c f1 e8 7c f8 ff ff 0f 57\nc0 c7 85 9c f9 ff ff 44 00 00 00 68 04 01 00 00 8d 85 e4 f9 ff ff 66 0f 13 85 a0 f9 ff ff 50 6a 00 66 0f 13 85 a8 f9 ff ff 66 0f 13 85 b0 f9 ff ff\n66 0f 13 85 b8 f9 ff ff 66 0f 13 85 c0 f9 ff ff 66 0f 13 85 c8 f9 ff ff 66 0f 13 85 d0 f9 ff ff 66 0f 13 85 d8 f9 ff ff ff 15 74 a0 41 00 85 c0 75\n11 8b 4d fc 33 cd 5e e8 b2 79 00 00 8b e5 5d c2 10 00 68 70 5e 42 00 8d 85 f4 fd ff ff 50 ff 15 bc a0 41 00 8b 35 9c a0 41 00 8d 85 e4 f9 ff ff 50\n8d 85 f4 fd ff ff 50 ff d6 68 80 5e 42 00 8d 85 f4 fd ff ff 50 ff d6 68 04 01 00 00 8d 85 ec fb ff ff 50 ff 15 a4 a0 41 00 68 90 5e 42 00 8d 85 ec\nfb ff ff 50 ff d6 8d 85 8c f9 ff ff 50 8d 85 9c f9 ff ff 50 6a 00 6a 00 68 00 00 00 08 6a 00 6a 00 6a 00 8d 85 f4 fd ff ff 50 8d 85 ec fb ff ff 50\nff 15 b4 a0 41 00 85 c0 74 16 ff b5 90 f9 ff ff 8b 35 54 a0 41 00 ff d6 ff b5 8c f9 ff ff ff d6 6a 00 ff 15 b0 a0 41 00 }\n$main2 = {558bec81ec7806????a1????????33c58945fc568b7510b9????????6a??68????????e8????????66c7??????????????0f57c0c6????????????660f13??????????c7????????­\n??????????c7??????????????????85f60f84????????66833e??0f84????????8d85e0f9ffffc785e0f9ffff????????5056ff??????????8b8de0f9ffff898588f9ffff85c90f84????­\n????578b3833f666833f2f74??8bd78d7202668b0283c2026685c075??2bd6b9????????d1fa5257e8????????8b8de0f9ffffbe01??????8b8588f9ffff3bf10f8d????????53660f1f44­\n????8b1cb033ff463bf17d??8b04b06683382f74??8bf84668????????53ff??????????85c075??c6????????????e9????????68????????53ff??????????85c075??85ff74??5\n7e8????????83c404a3????????89??????????eb??68????????53ff??????????85c075??85ff74??57e8????????83c404a3????????89??????????eb??8b??????????68????????53f\nfd785c075??c6????????????eb??68????????53ffd70fb6??????????85c0ba01??????0f44ca88??????????8b8de0f9ffff8b8588f9ffff3bf10f8c????????5b5f8d85a0f9ffff506a??­\nff??????????33c985c07e??0f1f44????80bc8da0f9ffff1974??413bc87c??e8????????0f57c0c7??????????????????68????????8d85e4f9ffff660f1385a0f9ffff506a??660f1385a8\nf9ffff660f1385b0f9ffff660f1385b8f9ffff660f1385c0f9ffff660f1385c8f9ffff660f1385d0f9ffff660f1385d8f9ffffff??????????85c075??8b4dfc33cd5ee8????????8be55d­\nc21??068????????8d85f4fdffff50ff??????????8b??????????8d85e4f9ffff508d85f4fdffff50ffd668????????8d85f4fdffff50ffd668????????8d85ecfbffff50ff??????­\n????68????????8d85ecfbffff50ffd68d858cf9ffff508d859cf9ffff506a??6a??68????????6a??6a??6a??8d85f4fdffff508d85ecfbffff50ff??????????85c074??ffb590f9ffff­\n8b??????????ffd6ffb58cf9ffffffd66a??ff??????????}\n$main3 = {558bec81ec7806????a1????????33c58945fc568b7510b9????????6a??68????????e8????????66c7??????????????0f57c0c6????????????660f13????????\n??c7??????????????????c7??????????????????85f6[2-6]66833e??[2-6]8d85e0f9ffffc785e0f9ffff????????5056ff??????????8b8de0f9ffff898588f9ffff85c9[26]578b3833f666833f2f[2-6]8bd78d7202668b0283c2026685c0[2-6]2bd6b9????????d1fa5257e8????????8b8de0f9ffffbe01??????8b8588f9ffff3bf1[2-6]53660f1f44????8b­\n1cb033ff463bf1[2-6]8b04b06683382f[2-6]8bf84668????????53ff??????????85c0[2-6]c6????????????[2-6]68????????53ff??????????85c0[2-6]85ff[2-6]57e8????????83c\n404a3????????89??????????[2-6]68????????53ff??????????85c0[2-6]85ff[2-6]57e8????????83c404a3????????89??????????[2-6]8b??????????68????????53ffd785c0[2-6]\nc6????????????[2-6]68????????53ffd70fb6??????????85c0ba01??????0f44ca88??????????8b8de0f9ffff8b8588f9ffff3bf1[2-6]5b5f8d85a0f9ffff506a??ff???????­\n???33c985c0[2-6]0f1f44????80bc8da0f9ffff19[2-6]413bc8[2-6]e8????????0f57c0c7??????????????????68????????8d85e4f9ffff660f1385a0f9ffff506a??660f1385a8f9ffff6\n60f1385b0f9ffff660f1385b8f9ffff660f1385c0f9ffff660f1385c8f9ffff660f1385d0f9ffff660f1385d8f9ffffff??????????85c0[2-6]8b4dfc33cd5ee8????????8be55dc21??068\n????????8d85f4fdffff50ff??????????8b??????????8d85e4f9ffff508d85f4fdffff50ffd668????????8d85f4fdffff50ffd668????????8d85ecfbffff50ff??????????68????????­\n8d85ecfbffff50ffd68d858cf9ffff508d859cf9ffff506a??6a??68????????6a??6a??6a??8d85f4fdffff508d85ecfbffff50ff??????????85c0[2-6]ffb590f9ffff­\n8b??????????ffd6ffb58cf9ffffffd66a??ff??????????}\n\n```\n\n-----\n\n```\n$main4 = { 55 8B EC 81 EC 78 06 00 00 A1 ?? ?? ?? ?? 33 C5 89 45 ?? 56 8B 75 ?? B9 B8 AA 42 00 6A 05 68 18 F0 41 00 E8 ?? ?? ?? ?? 66 C7 05 ?? ?? ??\n?? 00 00 0F 57 C0 C6 05 ?? ?? ?? ?? 00 66 0F 13 05 ?? ?? ?? ?? C7 05 ?? ?? ?? ?? FF FF FF FF C7 05 ?? ?? ?? ?? FF FF FF 7F 85 F6 0F 84 ?? ?? ?? ??\n66 83 3E 00 0F 84 ?? ?? ?? ?? 8D 85 ?? ?? ?? ?? C7 85 ?? ?? ?? ?? 00 00 00 00 50 56 FF 15 ?? ?? ?? ?? 8B 8D ?? ?? ?? ?? 89 85 ?? ?? ?? ?? 85 C9 0F 84\n?? ?? ?? ?? 57 8B 38 33 F6 66 83 3F 2F 74 ?? 8B D7 8D 72 ?? 66 8B 02 83 C2 02 66 85 C0 75 ?? 2B D6 B9 B8 AA 42 00 D1 FA 52 57 E8 ?? ?? ?? ?? 8B 8D\n?? ?? ?? ?? BE 01 00 00 00 8B 85 ?? ?? ?? ?? 3B F1 0F 8D ?? ?? ?? ?? 53 66 0F 1F 44 00 ?? 8B 1C B0 33 FF 46 3B F1 7D ?? 8B 04 B0 66 83 38 2F 74 ?? 8B\nF8 46 68 24 F0 41 00 53 FF 15 ?? ?? ?? ?? 85 C0 75 ?? C6 05 ?? ?? ?? ?? 01 E9 ?? ?? ?? ?? 68 2C F0 41 00 53 FF 15 ?? ?? ?? ?? 85 C0 75 ?? 85 FF 74 ??\n57 E8 ?? ?? ?? ?? 83 C4 04 A3 ?? ?? ?? ?? 89 15 ?? ?? ?? ?? EB ?? 68 38 F0 41 00 53 FF 15 ?? ?? ?? ?? 85 C0 75 ?? 85 FF 74 ?? 57 E8 ?? ?? ?? ?? 83 C4\n04 A3 ?? ?? ?? ?? 89 15 ?? ?? ?? ?? EB ?? 8B 3D ?? ?? ?? ?? 68 44 F0 41 00 53 FF D7 85 C0 75 ?? C6 05 ?? ?? ?? ?? 01 EB ?? 68 50 F0 41 00 53 FF D7 0F\nB6 0D ?? ?? ?? ?? 85 C0 BA 01 00 00 00 0F 44 CA 88 0D ?? ?? ?? ?? 8B 8D ?? ?? ?? ?? 8B 85 ?? ?? ?? ?? 3B F1 0F 8C ?? ?? ?? ?? 5B 5F 8D 85 ?? ?? ?? ??\n50 6A 10 FF 15 ?? ?? ?? ?? 33 C9 85 C0 7E ?? 0F 1F 44 00 ?? 80 BC 8D ?? ?? ?? ?? 19 74 ?? 41 3B C8 7C ?? E8 ?? ?? ?? ?? 0F 57 C0 C7 85 ?? ?? ?? ?? 44\n00 00 00 68 04 01 00 00 8D 85 ?? ?? ?? ?? 66 0F 13 85 ?? ?? ?? ?? 50 6A 00 66 0F 13 85 ?? ?? ?? ?? 66 0F 13 85 ?? ?? ?? ?? 66 0F 13 85 ?? ?? ?? ?? 66\n0F 13 85 ?? ?? ?? ?? 66 0F 13 85 ?? ?? ?? ?? 66 0F 13 85 ?? ?? ?? ?? 66 0F 13 85 ?? ?? ?? ?? FF 15 ?? ?? ?? ?? 85 C0 75 ?? 8B 4D ?? 33 CD 5E E8 ?? ??\n?? ?? 8B E5 5D C2 10 00 68 70 5E 42 00 8D 85 ?? ?? ?? ?? 50 FF 15 ?? ?? ?? ?? 8B 35 ?? ?? ?? ?? 8D 85 ?? ?? ?? ?? 50 8D 85 ?? ?? ?? ?? 50 FF D6 68 80\n5E 42 00 8D 85 ?? ?? ?? ?? 50 FF D6 68 04 01 00 00 8D 85 ?? ?? ?? ?? 50 FF 15 ?? ?? ?? ?? 68 90 5E 42 00 8D 85 ?? ?? ?? ?? 50 FF D6 8D 85 ?? ?? ?? ??\n50 8D 85 ?? ?? ?? ?? 50 6A 00 6A 00 68 00 00 00 08 6A 00 6A 00 6A 00 8D 85 ?? ?? ?? ?? 50 8D 85 ?? ?? ?? ?? 50 FF 15 ?? ?? ?? ?? 85 C0 74 ?? FF B5\n?? ?? ?? ?? 8B 35 ?? ?? ?? ?? FF D6 FF B5 ?? ?? ?? ?? FF D6 6A 00 FF 15 ?? ?? ?? ??}\ncondition:\n\n```\nfilesize >= 150KB and filesize <= 250KB and\n```\n4 of ($s*) and\n1 of ($main*)\n}\n\n```\n\n-----\n\n##### About McAfee\n\n###### McAfee is the device-to-cloud cybersecurity company. Inspired by the power of working together, McAfee creates business and consumer solutions that make our world a safer place. By building solutions that work with other companies’ products, McAfee helps businesses orchestrate cyber environments that are truly integrated, where protection, detection, and correction of threats happen simultaneously and collaboratively. By protecting consumers across all their devices, McAfee secures their digital lifestyle at home and away. By working with other security players, McAfee is leading the effort to unite against cybercriminals for the benefit of all.\n\n www.mcafee.com\n\n6220 America Center Drive\nSan Jose, CA 95002\n888 847 8766\n\n\n##### McAfee ATR\n\n###### The McAfee® Advanced Threat Research Operational Intelligence team operates globally around the clock, keeping watch of the latest cyber campaigns and actively tracking the most impactful cyber threats. Several McAfee products and reports, such as MVISION Insights and APG ATLAS, are fueled with the team’s intelligence work. In addition to providing the latest Threat Intelligence to our customers, the team also performs unique quality checks and enriches the incoming data from all of McAfee’s sensors in a way that allows customers to hit the ground running and focus on the threats that matter.\n\n Subscribe to receive our Threat Information.\n\n\n##### Additional Resources\n\n###### https://www.bleepingcomputer.com/news/ security/us-cities-disclose-data-breaches- after-vendors-ransomware-attack/\n\n\nMcAfee and the McAfee logo are trademarks or registered trademarks of McAfee, LLC or its subsidiaries in the US and other countries.\nOther marks and brands may be claimed as the property of others. Copyright © 2021 McAfee, LLC. 4713_0421\nAPRIL 2021\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "99fdc3ef-333d-48f5-a4a1-becd788c7b80",
            "created_at": "2022-10-25T15:28:29.802983Z",
            "updated_at": "2022-10-25T15:28:29.802983Z",
            "deleted_at": null,
            "name": "MITRE",
            "url": "https://github.com/mitre-attack/attack-stix-data",
            "description": "MITRE ATT&CK STIX Data",
            "reports": null
        },
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        }
    ],
    "references": [
        "https://www.mcafee.com/enterprise/en-us/assets/reports/rp-cuba-ransomware.pdf"
    ],
    "report_names": [
        "rp-cuba-ransomware.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1666716504,
    "ts_updated_at": 1743041358,
    "ts_creation_date": 1617579731,
    "ts_modification_date": 1617635497,
    "files": {
        "pdf": "https://archive.orkl.eu/0d10aa820095e0782fd38e79f5f04a5fb7cbc5d6.pdf",
        "text": "https://archive.orkl.eu/0d10aa820095e0782fd38e79f5f04a5fb7cbc5d6.txt",
        "img": "https://archive.orkl.eu/0d10aa820095e0782fd38e79f5f04a5fb7cbc5d6.jpg"
    }
}