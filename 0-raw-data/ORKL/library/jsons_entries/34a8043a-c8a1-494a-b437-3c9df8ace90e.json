{
    "id": "34a8043a-c8a1-494a-b437-3c9df8ace90e",
    "created_at": "2023-01-12T15:04:10.69481Z",
    "updated_at": "2025-03-27T02:14:08.391404Z",
    "deleted_at": null,
    "sha1_hash": "3b1fe0a4b700b579a148f7e17979d2924507bb71",
    "title": "2018-01-17 - Microsoft Office Vulnerabilities Used to Distribute Zyklon Malware in Recent Campaign",
    "authors": "",
    "file_creation_date": "2022-05-28T17:30:04Z",
    "file_modification_date": "2022-05-28T17:30:04Z",
    "file_size": 2224382,
    "plain_text": "# Microsoft Office Vulnerabilities Used to Distribute Zyklon Malware in Recent Campaign\n\n**[fireeye.com/blog/threat-research/2018/01/microsoft-office-vulnerabilities-used-to-distribute-zyklon-malware.html](https://www.fireeye.com/blog/threat-research/2018/01/microsoft-office-vulnerabilities-used-to-distribute-zyklon-malware.html)**\n\n**Introduction**\n\nFireEye researchers recently observed threat actors leveraging relatively new vulnerabilities\nin Microsoft Office to spread Zyklon HTTP malware. Zyklon has been observed in the wild\nsince early 2016 and provides myriad sophisticated capabilities.\n\nZyklon is a publicly available, full-featured backdoor capable of keylogging, password\nharvesting, downloading and executing additional plugins, conducting distributed denial-ofservice (DDoS) attacks, and self-updating and self-removal. The malware may communicate\nwith its command and control (C2) server over The Onion Router (Tor) network if configured\nto do so. The malware can download several plugins, some of which include features such\nas cryptocurrency mining and password recovery, from browsers and email software. Zyklon\nalso provides a very efficient mechanism to monitor the spread and impact.\n\n**Infection Vector**\n\nWe have observed this recent wave of Zyklon malware being delivered primarily through\nspam emails. The email typically arrives with an attached ZIP file containing a malicious\nDOC file (Figure 1 shows a sample lure)\n\n\n-----\n\nThe following industries have been the primary targets in this campaign:\n\nTelecommunications\nInsurance\nFinancial Services\n\nFigure 1: Sample lure documents\n\n**Attack Flow**\n\n1. Spam email arrives in the victim’s mailbox as a ZIP attachment, which contains a\n\nmalicious DOC file.\n2. The document files exploit at least three known vulnerabilities in Microsoft Office, which\n\nwe discuss in the Infection Techniques section. Upon execution in a vulnerable\nenvironment, the PowerShell based payload takes over.\n3. The PowerShell script is responsible for downloading the final payload from C2 server\n\nto execute it.\n\nA visual representation of the attack flow and execution chain can be seen in Figure 2.\n\n\n-----\n\nFigure 2: Zyklon attack flow\n\n**Infection Techniques**\n\nCVE-2017-8759\n\n[This vulnerability was discovered by FireEye in September 2017, and it is a vulnerability we](https://www.fireeye.com/blog/threat-research/2017/09/zero-day-used-to-distribute-finspy.html)\nhave observed being exploited in the wild.\n\nThe DOC file contains an embedded OLE Object that, upon execution, triggers the download\nof an additional DOC file from the stored URL (seen in Figure 3).\n\nFigure 3: Embedded URL in OLE object\n\nCVE-2017-11882\n\n[Similarly, we have also observed actors leveraging another recently discovered vulnerability](https://www.fireeye.com/blog/threat-research/2017/12/targeted-attack-in-middle-east-by-apt34.html)\n(CVE-2017-11882) in Microsoft Office. Upon opening the malicious DOC attachment, an\nadditional download is triggered from a stored URL within an embedded OLE Object (seen in\nFigure 4).\n\n\n-----\n\nFigure 4: Embedded URL in OLE object\n\nFigure 5: HTTP GET request to download the next level payload\n\nThe downloaded file, doc.doc, is XML-based and contains a PowerShell command (shown in\nFigure 6) that subsequently downloads the binary Pause.ps1.\n\nFigure 6: PowerShell command to download the Pause.ps1 payload\n\nDynamic Data Exchange (DDE)\n\nDynamic Data Exchange (DDE) is the interprocess communication mechanism that is\nexploited to perform remote code execution. With the help of a PowerShell script (shown in\nFigure 7), the next payload (Pause.ps1) is downloaded.\n\nFigure 7: DDE technique used to download the Pause.ps1 payload\n\nOne of the unique approaches we have observed is the use of dot-less IP addresses\n(example: hxxp://258476380).\n\nFigure 8 shows the network communication of the Pause.ps1 download.\n\n\n-----\n\nFigure 8: Network communication to download the Pause.ps1 payload\n\n**Zyklon Delivery**\n\nIn all these techniques, the same domain is used to download the next level payload\n(Pause.ps1), which is another PowerShell script that is Base64 encoded (as seen in Figure\n8).\n\nThe Pause.ps1 script is responsible for resolving the APIs required for code injection. It also\ncontains the injectable shellcode. The APIs contain VirtualAlloc(), memset(), and\nCreateThread(). Figure 9 shows the decoded Base64 code.\n\nFigure 9: Base64 decoded Pause.ps1\n\n\n-----\n\nThe injected code is responsible for downloading the final payload from the server (see\nFigure 10). The final stage payload is a PE executable compiled with .Net framework.\n\nFigure 10: Network traffic to download final payload (words.exe)\n\nOnce executed, the file performs the following activities:\n\n1. Drops a copy of itself in %AppData%\\svchost.exe\\svchost.exe and drops an XML file,\n\nwhich contains configuration information for Task Scheduler (as shown in Figure 11).\n2. Unpacks the code in memory via process hollowing. The MSIL file contains the packed\n\ncore payload in its .Net resource section.\n3. The unpacked code is Zyklon.\n\n\n-----\n\nFigure 11: XML configuration file to schedule the task\n\nThe Zyklon malware first retrieves the external IP address of the infected machine using the\nfollowing:\n\napi.ipify[.]org\nip.anysrc[.]net\nmyexternalip[.]com\nwhatsmyip[.]com\n\n\n-----\n\nThe Zyklon executable contains another encrypted file in its .Net resource section named tor.\nThis file is decrypted and injected into an instance of InstallUtiil.exe, and functions as a Tor\nanonymizer.\n\n**Command & Control Communication**\n\nThe C2 communication of Zyklon is proxied through the Tor network. The malware sends a\nPOST request to the C2 server. The C2 server is appended by the gate.php, which is stored\nin file memory. The parameter passed to this request is getkey=y. In response to this\nrequest, the C2 server responds with a Base64-encoded RSA public key (seen in Figure 12).\n\nFigure 12: Zyklon public RSA key\n\nAfter the connection is established with the C2 server, the malware can communicate with its\ncontrol server using the commands shown in Table 1.\n\nCommand Action\n\nsign Requests system information\n\nsettings Requests settings from C2 server\n\nlogs Uploads harvested passwords\n\nwallet Uploads harvested cryptocurrency wallet data\n\nproxy Indicates SOCKS proxy port opened\n\n\n-----\n\nminer Cryptocurrency miner commands\n\nerror Reports errors to C2 server\n\nddos DDoS attack commands\n\nTable 1: Zyklon accepted commands\n\nThe following figures show the initial request and subsequent server response for the\n“settings” (Figure 13), “sign” (Figure 14), and “ddos” (Figure 15) commands.\n\nFigure 13: Zyklon issuing “settings” command and subsequent server response\n\n\n-----\n\nFigure 14: Zyklon issuing “sign” command and subsequent server response\n\nFigure 15: Zyklon issuing “ddos” command and subsequent server response\n\n**Plugin Manager**\n\nZyklon downloads number of plugins from its C2 server. The plugin URL is stored in file in\nfollowing format:\n\n/plugin/index.php?plugin=<Plugin_Name>\n\nThe following plugins are found in the memory of the Zyklon malware:\n\n/plugin/index.php?plugin=cuda\n/plugin/index.php?plugin=minerd\n\n\n-----\n\n/plugin/index.php?plugin=sgminer\n/plugin/index.php?plugin=socks\n/plugin/index.php?plugin=tor\n/plugin/index.php?plugin=games\n/plugin/index.php?plugin=software\n/plugin/index.php?plugin=ftp\n/plugin/index.php?plugin=email\n/plugin/index.php?plugin=browser\n\nThe downloaded plugins are injected into:\nWindows\\Microsoft.NET\\Framework\\v4.0.30319\\RegAsm.exe.\n\n**Additional Features**\n\nThe Zyklon malware offers the following additional capabilities (via plugins):\n\nBrowser Password Recovery\n\nZyklon HTTP can recover passwords from popular web browsers, including:\n\nGoogle Chrome\nMozilla Firefox\nInternet Explorer\nOpera Browser\nChrome Canary/SXS\nCoolNovo Browser\nApple Safari\nFlock Browser\nSeaMonkey Browser\nSRWare Iron Browser\nComodo Dragon Browser\n\nFTP Password Recovery\n\nZyklon currently supports FTP password recovery from the following FTP applications:\n\nFileZilla\nSmartFTP\nFlashFXP\nFTPCommander\nDreamweaver\nWS_FTP\n\nGaming Software Key Recovery\n\nZyklon can recover PC Gaming software keys from the following games:\n\nBattlefield\n\n\n-----\n\nCall of Duty\nFIFA\nNFS\nAge of Empires\nQuake\nThe Sims\nHalf-Life\nIGI\nStar Wars\n\nEmail Password Recovery\n\nZyklon may also collect email passwords from following applications:\n\nMicrosoft Outlook Express\nMicrosoft Outlook 2002/XP/2003/2007/2010/2013\nMozilla Thunderbird\nWindows Live Mail 2012\nIncrediMail, Foxmail v6.x - v7.x\nWindows Live Messenger\nMSN Messenger\nGoogle Talk\nGMail Notifier\nPaltalkScene IM\nPidgin (Formerly Gaim) Messenger\nMiranda Messenger\nWindows Credential Manager\n\nLicense Key Recovery\n\nThe malware automatically detects and decrypts the license/serial keys of more than 200\npopular pieces of software, including Office, SQL Server, Adobe, and Nero.\n\nSocks5 Proxy\n\nZyklon features the ability to establish a reverse Socks5 proxy server on infected host\nmachines.\n\nHijack Clipboard Bitcoin Address\n\nZyklon has the ability to hijack the clipboard, and replaces the user’s copied bitcoin address\nwith an address served up by the actor’s control server.\n\n**Zyklon Pricing**\n\nResearchers identified different versions of Zyklon HTTP being advertised in a popular\nunderground marketplace for the following prices:\n\n\n-----\n\nNormal build: $75 (USD)\nTor-enabled build: $125 (USD)\nRebuild/Updates: $15 (USD)\nPayment Method: Bitcoin (BTC)\n\n**Conclusion**\n\nThreat actors incorporating recently discovered vulnerabilities in popular software – Microsoft\nOffice, in this case – only increases the potential for successful infections. These types of\nthreats show why it is very important to ensure that all software is fully updated. Additionally,\nall industries should be on alert, as it is highly likely that the threat actors will eventually\nmove outside the scope of their current targeting.\n\nAt this time of writing, FireEye [Multi Vector Execution (MVX) engine is able to recognize and](https://www.fireeye.com/)\nblock this threat. Table 2 lists the current detection and blocking capabilities by product.\n\nDetection Name Product Action\n\nPOWERSHELL DOWNLOADER D (METHODOLOGY) HX Detect\n\nSUSPICIOUS POWERSHELL USAGE (METHODOLOGY) HX Detect\n\nPOWERSHELL DOWNLOADER (METHODOLOGY) HX Detect\n\nSUSPICIOUS EQNEDT USAGE (METHODOLOGY) HX Detect\n\nTOR (TUNNELER) HX Detect\n\nSUSPICIOUS SVCHOST.EXE (METHODOLOGY) HX Detect\n\nMalware.Binary.rtf EX/ETP/NX Block\n\nMalware.Binary EX/ETP/NX Block\n\nFE_Exploit_RTF_CVE_2017_8759 EX/ETP/NX Block\n\nFE_Exploit_RTF_CVE201711882_1 EX/ETP/NX Block\n\nTable 2: Current detection capabilities by FireEye products\n\n\n-----\n\n**Indicators of Compromise**\n\nThe contained analysis is based on the representative sample lures shown in Table 3.\n\nMD5 Name\n\n76011037410d031aa41e5d381909f9ce accounts.doc\n\n4bae7fb819761a7ac8326baf8d8eb6ab Courrier.doc\n\neb5fa454ab42c8aec443ba8b8c97339b doc.doc\n\n886a4da306e019aa0ad3a03524b02a1c Pause.ps1\n\n04077ecbdc412d6d87fc21e4b3a4d088 words.exe\n\nTable 3: Sample Zyklon lures\n\nNetwork Indicators\n\n154.16.93.182\n85.214.136.179\n178.254.21.218\n159.203.42.107\n217.12.223.216\n138.201.143.186\n216.244.85.211\n51.15.78.0\n213.251.226.175\n93.95.100.202\nwarnono.punkdns.top\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-01-17 - Microsoft Office Vulnerabilities Used to Distribute Zyklon Malware in Recent Campaign.pdf"
    ],
    "report_names": [
        "2018-01-17 - Microsoft Office Vulnerabilities Used to Distribute Zyklon Malware in Recent Campaign.pdf"
    ],
    "threat_actors": [
        {
            "id": "ce10c1bd-4467-45f9-af83-28fc88e35ca4",
            "created_at": "2022-10-25T15:50:23.458833Z",
            "updated_at": "2025-03-27T02:00:55.475188Z",
            "deleted_at": null,
            "main_name": "APT34",
            "aliases": null,
            "source_name": "MITRE:APT34",
            "tools": [
                "netstat",
                "Systeminfo",
                "PsExec",
                "SEASHARPEE",
                "Tasklist",
                "Mimikatz",
                "POWRUNER",
                "certutil"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "cffb3c01-038f-4527-9cfd-57ad5a035c22",
            "created_at": "2022-10-25T15:50:23.38055Z",
            "updated_at": "2025-03-27T02:00:55.459558Z",
            "deleted_at": null,
            "main_name": "OilRig",
            "aliases": [
                "COBALT GYPSY",
                "IRN2",
                "APT34",
                "Helix Kitten",
                "Evasive Serpens",
                "Hazel Sandstorm",
                "EUROPIUM",
                "ITG13"
            ],
            "source_name": "MITRE:OilRig",
            "tools": [
                "ISMInjector",
                "RDAT",
                "Systeminfo",
                "QUADAGENT",
                "OopsIE",
                "Tasklist",
                "certutil",
                "ZeroCleare",
                "POWRUNER",
                "netstat",
                "ipconfig",
                "LaZagne",
                "BONDUPDATER",
                "SideTwist",
                "PsExec",
                "SEASHARPEE",
                "Mimikatz",
                "RGDoor",
                "ftp"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "67709937-2186-4a32-b64c-a5693d40ac77",
            "created_at": "2023-01-06T13:46:38.495593Z",
            "updated_at": "2025-03-27T02:00:02.848206Z",
            "deleted_at": null,
            "main_name": "OilRig",
            "aliases": [
                "IRN2",
                "Hazel Sandstorm",
                "EUROPIUM",
                "TA452",
                "Earth Simnavaz",
                "Cobalt Gypsy",
                "Crambus",
                "Helix Kitten",
                "APT 34",
                "APT34",
                "ATK40",
                "G0049",
                "Evasive Serpens",
                "Twisted Kitten"
            ],
            "source_name": "MISPGALAXY:OilRig",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "3eebdb3f-f4e3-42e5-bb4d-f02a13328316",
            "created_at": "2024-05-01T02:03:08.014303Z",
            "updated_at": "2025-03-27T02:05:17.306592Z",
            "deleted_at": null,
            "main_name": "COBALT EDGEWATER",
            "aliases": [
                "Cold River ",
                "DNSpionage ",
                "APT34 "
            ],
            "source_name": "Secureworks:COBALT EDGEWATER",
            "tools": [
                " DNSpionage",
                " Karkoff",
                " MailDropper",
                " SideTwist",
                " TWOTONE",
                "AgentDrable"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "8f9c8a6e-f6b6-431b-bedd-94fdeea5474a",
            "created_at": "2024-05-01T02:03:08.022974Z",
            "updated_at": "2025-03-27T02:05:17.310877Z",
            "deleted_at": null,
            "main_name": "COBALT GYPSY",
            "aliases": [
                "CHRYSENE ",
                "Crambus ",
                "EUROPIUM ",
                "Hazel Sandstorm ",
                "Helix Kitten ",
                "ITG13 ",
                "OilRig ",
                "Yellow Maero ",
                "APT34 "
            ],
            "source_name": "Secureworks:COBALT GYPSY",
            "tools": [
                " Helminth",
                " Jason",
                " MacDownloader",
                " PoisonFrog",
                " RGDoor",
                " ThreeDollars",
                " TinyZbot",
                " Toxocara",
                " Trichuris",
                " TwoFace",
                "Glimpse"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673535850,
    "ts_updated_at": 1743041648,
    "ts_creation_date": 1653759004,
    "ts_modification_date": 1653759004,
    "files": {
        "pdf": "https://archive.orkl.eu/3b1fe0a4b700b579a148f7e17979d2924507bb71.pdf",
        "text": "https://archive.orkl.eu/3b1fe0a4b700b579a148f7e17979d2924507bb71.txt",
        "img": "https://archive.orkl.eu/3b1fe0a4b700b579a148f7e17979d2924507bb71.jpg"
    }
}