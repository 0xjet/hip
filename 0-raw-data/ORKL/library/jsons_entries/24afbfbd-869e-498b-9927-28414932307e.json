{
    "id": "24afbfbd-869e-498b-9927-28414932307e",
    "created_at": "2023-01-12T15:06:05.935496Z",
    "updated_at": "2025-03-27T02:09:29.574252Z",
    "deleted_at": null,
    "sha1_hash": "89b7273158dc231312567399d1f590ac4bf9002c",
    "title": "2022-07-25 - PDF Analysis of Lokibot malware",
    "authors": "",
    "file_creation_date": "2022-08-18T03:31:41Z",
    "file_modification_date": "2022-08-18T03:31:41Z",
    "file_size": 1629669,
    "plain_text": "# PDF Analysis of Lokibot malware\n\n**muha2xmad.github.io/mal-document/lokibotpdf/**\n\n### Muhammad Hasan Ali\n\nMalware Analysis learner\n\n4 minute read\n\n**As-salamu Alaykum**\n\n## Introducion\n\n\nJuly 25, 2022\n\n\nThis sample is from Lokibot trojan which steals the credential information from web browsser,\nFTP server, SMTP server. This sample is a PDF file and our purpose of this blog is how to\nanalyze a PDF file.\n\n## About PDF\n\n Ability of a PDF file\n\nA PDF file can impelemnt droppers, downloader, or exploit PDF reader application’s\nvulnerabilities.\n\n\n-----\n\n## PDF sttucture\n\nPDF header: Contains info about the version of the PDF such as %PDF-1.6\n\nBody:\n\nStreams: a sequence of bytes such as images or data, which comes in encoded\ndata.\n\nObjects: How to render documanets which can include text or javascript.\n\nOthers such as names, dictionaries, strings, and arrays.\n\nCross-reference table: contains the offsets of file’s objects.\n\nTrailer: contains the offset of xref table, and number of objects, /Root.\n\nDictionary entry is an item between « » and starts with slash / such as /Root which is the first\nobject will be processed after loading the PDF file, /Root could be found in the Trailer\nsection.\n\nSuspecious keywords found when analyzing and their indications:\n\n/Js, /JavaScript: To execute embedded javascript\n\n/Launch, /EmbeddedFiles: To launch exeternal or embedded files\n\n/URI: To interact with URLs\n\n/OpenAction, /AA: To open an action\n\n/FlateDecode: uses the zlib/deflate decompression method.\n\nA comment in PDF starts with %\n\nAbout objects:\n```\nobj 1 0: % first number is ID, second number is version\n\ntype: catalog % catalog is an example, type can be empty.\n\nReferencing: 3 0 R % object 1 0 refernces to 3 0, R indicates of referencing\n\n........ % content of the object\n\nendobj % the object ends with\n\n\n```\n[For more info aboud PDF see this.](https://www.pdfprof.com/PDF_Image.php?idt=6197&t=41)\n\n\n-----\n\n## Methodology\n\nuse pdfid.py or peepdf.py:\n\nto perform an initial assessment by summarizing risky aspects\n\npdf-parser.py:\n\nto locate objects in file.pdf that include JavaScript\n\nto examine the contents of objects\n\nto decode the stream embedded from object\n\nto extract only the list of URL\n\nFollow object referencing to find the goal.\n\nIf you use peepdf.py and found that it has /EmbeddedFiles, start analyzing the object where\nis /EmbeddedFiles belongs to.\n\nIf you find /FlateDecode, go and try to analyze it which decodes stream.\n\n## PDF analysis\n\nIn this sample, We received a malicious PDF file which downloads Lokibot malware. So we\nneed to start our analysis quickly using REMnux.\n\nWe first use `pdfid.py to get info about the PDF and what is there. As we see, it has 8`\nstreams and 1 /EmbeddedFiles and 0 javascript files. We can use `peepdf.py to get which`\nobject contains the /EmbeddedFiles but an error occured running.\n\n\n-----\n\nFigure(1): pdfid.py output\n\nSo we will use `pdf-parser.py and to get our embedded file. We see many objects, Then`\nstart with objects which contains /FlateDecode and if we found /EmbeddedFiles go for it.\n\n\n-----\n\nFigure(2): pdf-parser.py output\n\nAfter scrolling down, we see object 12 conatins /FlateDecode. We try to decode it and\ndumping using\n\nFigure(3): After dumping the object 12\n\nIf we use `file command to see its type, it’s an ASCII text. Then we open` `file12 using`\n```\nscite we it’s useless. Some objects are useles, it takes time to find the peyload. We\n\n```\nexamine another object. When we get to object `22, we our /EmbeddedFiles which is an`\nindicator to that the PDF launches embedded file which has big length. Dump it to `file22`\nto see it’s content and its type. After that we use file command, we notice that it’s Composite\n**Document File V2 Document** [CFBF is a compound document file format for storing](https://en.wikipedia.org/wiki/Compound_File_Binary_Format)\nnumerous files and streams within a single file on a disk. In our case, this PDF stores an XLS\nfile.\n\nFigure(4): After dumping the object 22 and it's an xls excel spreadsheet\n\n[If we uploaded file22 to Virustotal we will find it already uploaded and it’s malicous. Our](https://www.virustotal.com/gui/file/825b7a64db82a61656c8004bef49823d5b9fe4f52fae744f5dc927b3e75a994b/detection)\npurpose is to get the main payload and that’s it.\n\n\n-----\n\nFigure(5): Virustotal analysis of xls dumped from PDF\n\n## Dynamic analysis\n\nWe will open FlareVM which has our installed tools. We need to install PDF reader such as\nFoxit reader, and Microsoft office.\n\nFirst, open `fakenet-ng, if the malicious PDF tries to connect and download from internet,`\nthis PDF sample opens an xls spredsheet.\n\nThen open the PDF. In foxit reader, disable safe mode and run the malicious PDF in privilage\nmode.\n\nWe open `Attachments, we see there’s an attachment which will be our` `xls spredsheet`\nfile. You can open it manually. Double click on it and allow to open it. Then it will open an xls\nexcel spredsheet. Save this attachment on your `Desktop from foxit reader as shown.`\n\n\n-----\n\nFigure(6): When opening the PDF\n\n## IoCs\n\nPDF file: `da9c3deb08bfc6a2e7930a4c8f1bd81b5ebffbb09b44027c74ea41ebf7149f8b`\n\nxls sheet: `825b7a64db82a61656c8004bef49823d5b9fe4f52fae744f5dc927b3e75a994b`\n\n## Article quote\n\nإلهي ، ماذا وجد من فقدك وما الذي فقد من وجدك\n\n## REF\n\n[hybrid-analysis](https://hybrid-analysis.com/sample/da9c3deb08bfc6a2e7930a4c8f1bd81b5ebffbb09b44027c74ea41ebf7149f8b/62dd55e6713b0c2fa0315c06)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-07-25 - PDF Analysis of Lokibot malware.pdf"
    ],
    "report_names": [
        "2022-07-25 - PDF Analysis of Lokibot malware.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535965,
    "ts_updated_at": 1743041369,
    "ts_creation_date": 1660793501,
    "ts_modification_date": 1660793501,
    "files": {
        "pdf": "https://archive.orkl.eu/89b7273158dc231312567399d1f590ac4bf9002c.pdf",
        "text": "https://archive.orkl.eu/89b7273158dc231312567399d1f590ac4bf9002c.txt",
        "img": "https://archive.orkl.eu/89b7273158dc231312567399d1f590ac4bf9002c.jpg"
    }
}