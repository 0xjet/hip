{
    "id": "50461855-07cf-4dcb-ae3c-f9203552dfda",
    "created_at": "2023-01-12T15:07:43.76045Z",
    "updated_at": "2025-03-27T02:05:37.390256Z",
    "deleted_at": null,
    "sha1_hash": "d7772dd945d443700bf92612c79e197d69f0b0aa",
    "title": "2020-10-05 - DarkSide ransomware analysis",
    "authors": "",
    "file_creation_date": "2022-05-27T23:23:31Z",
    "file_modification_date": "2022-05-27T23:23:31Z",
    "file_size": 605580,
    "plain_text": "# DarkSide ransomware analysis\n\n**zawadidone.nl/darkside-ransomware-analysis/**\n\nOctober 5, 2020 2 minute read\n\n\nOctober 5, 2020\n\n\nThis blog post will try to explain how the ransomware called DarkSide works. Based on my\nresearch, this ransomware uses Salsa20 encryption to encrypt files and RSA encryption to\nencrypt the key used by Salsa20. A new key is created per file based on random bytes.\n\n\n-----\n\nA new ransomware operation named DarkSide began attacking organizations earlier\nthis month with customized attacks that have already earned them million-dollar\npayouts.\n\nStarting around August 10th, 2020, the new ransomware operation began performing\ntargeted attacks against numerous companies.\n\nIn a “press release” issued by the threat actors, they claim to be former affiliates who\nhad made millions of dollars working with other ransomware operations.\nhttps://www.bleepingcomputer.com/news/security/darkside-new-targeted-ransomwaredemands-million-dollar-ransoms/amp/\n\n### Unpacking\n\nThe executable is compressed with UPX\n```\nfile 9cee5522a7ca2bfca7cd3d9daba23e9a30deb6205f56c12045839075f7627297\n[...]: PE32 executable (GUI) Intel 80386, for MS Windows, UPX compressed\n\n```\nAfter the first instruction `pushad I put a breakpoint on the` `ESP register and continue.`\n\nThe execution breaks on the instruction `lea eax, dword ptr ss:[esp80] . After the loop`\nis executed it jumps to the entry point of the packed executable.\n\nOnce the executable is unpacked, we can analyze the ransomware\n\n### Anti-analysis\n\nTo make static analysis harder the ransomware resolves DLL’s and API calls dynamically\nusing `LoadLibrary,` `GetProcAddress and 2 custom functions shown below. In this`\nscreenshot, the address of `_wcsicmp is resolved in memory.`\n\n\n-----\n\n### Preparation\n\nThe mutex `Global\\\\3e93e49583d6401ba148cd68d1f84af7 is created to make sure only`\none copy of the ransomware is running, otherwise the ransomware exits. This is done based\non the name of the executable. Then `SetThreadExecutionState is called to force the`\nsystem to be in the working state by resetting the system idle timer.\n\n**Services**\n\nTo make sure certain services are not running the following services are stopped using\n```\nControlService - SERVICE_CONTROL_STOP and DeleteService . Deleting a service is\n\n```\nnot useful if an organization pays the ransom and wants to go back into production quickly.\nAs a system administrator, I wouldn’t be happy about this.\n\nvss\nsql\nsvc$\nmemtas\nmepocs\nsophos\nveeam\nbackup\n\n\n-----\n\n**Shadow Copies**\n\nUsing `CreateProcessW the following Powershell script is executed which deletes Shadow`\nVolume Copies.\n```\npowershell -ep bypass -c \\\"(0..61)|%{$s+=[char][byte]\n('0x'+'4765742D576D694F626A6563742057696E33325F536861646F77636F7079207C20466F724561636\n $s\\\"\n\n```\nWhen deobfuscated, we can see that this PowerShell command is used to delete\nShadow Volume Copies on the machine before encrypting it.\n```\n   Get-WmiObject Win32_Shadowcopy | ForEach-Object {$_.Delete();}\n\n```\nhttps://www.bleepingcomputer.com/news/security/darkside-new-targeted-ransomwaredemands-million-dollar-ransoms/amp/\n\n**Processes**\n\nTo make sure certain processes are not running a list of processes are terminated\n[(https://pastebin.com/WWSQxhcq.](https://pastebin.com/WWSQxhcq)\n\n\n-----\n\n### Encryption\n\nThe encryption routine skips a few files, file extensions and directories\n[(https://pastebin.com/WWSQxhcq).](https://pastebin.com/WWSQxhcq)\n\n### Encryption flowchart\n\nThe encryption routine of the ransomware is shown below.\n\n### Debugging mode\n\n\n-----\n\nI don t know why but it seems the authors have forgotten to disable debugging functionality in\ntheir code or maybe they are using this to verify that the files are encrypted. (XXX = file\nname). This file was in the same directory as the executable.\n```\n[INF] Start Encrypting All Files\n[INF] Emptying Recycle Bin\n[INF] Uninstalling Services\n[INF] Deleting Shadow Copies\n[INF] Terminating Processes\n[INF] Encrypt Mode - FAST\n[INF] Encrypting Local Disks\n[INF] Started 8 I/O Workers\n[INF] Start Encrypt [Handle 492] \\\\?\\C:\\XXX\n[INF] File Encrypted Successful [Handle 492]\n[INF] Start Encrypt [Handle 640] \\\\?\\C:\\XXX\n[INF] File Encrypted Successful [Handle 640]\n[INF] Start Encrypt [Handle 640] \\\\?\\C:\\XXX\n[...]\n\n### IOC\n\n```\nSHA256 - `9cee5522a7ca2bfca7cd3d9daba23e9a30deb6205f56c12045839075f7627297`\n\n### References\n\nhttps://www.bleepingcomputer.com/news/security/darkside-new-targeted-ransomwaredemands-million-dollar-ransoms/amp/\n\n[https://tria.ge/200828-r31s5nvvm2/behavioral1](https://tria.ge/200828-r31s5nvvm2/behavioral1)\n\n## You May Also Enjoy\n\n Automating DFIR using Cloud services\n\nMarch 28 2022 7 minute read\n\n\n-----\n\nTL;DR: The DFIR lab can automate the processing of Plaso timelines to Timesketch using\nVelociraptor and Google Cloud services\n\n## Using Docker images from scratch\n\nJanuary 12, 2022 5 minute read\n\nThe last blog post about Docker was about using non-root Docker containers and why this is\nsafer. This time I want to go a step further and explain what I th...\n\n## Mount Locker ransomware analysis\n\nNovember 26, 2020 8 minute read\n\nThis blog post will explain how the ransomware called Mount Locker works. For encryption,\nMount Locker uses Chacha20 to encrypt files and RSA-2048 to encrypt...\n\n\n-----\n\n## Preparation Tips for CKAD\n\nNovember 12, 2020 3 minute read\n\n5 days ago, I took the CKAD exam and passed. So I decided to write this short blog post\nabout my experience and to share some tips that helped me pass it. Ev...\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-10-05 - DarkSide ransomware analysis.pdf"
    ],
    "report_names": [
        "2020-10-05 - DarkSide ransomware analysis.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536063,
    "ts_updated_at": 1743041137,
    "ts_creation_date": 1653693811,
    "ts_modification_date": 1653693811,
    "files": {
        "pdf": "https://archive.orkl.eu/d7772dd945d443700bf92612c79e197d69f0b0aa.pdf",
        "text": "https://archive.orkl.eu/d7772dd945d443700bf92612c79e197d69f0b0aa.txt",
        "img": "https://archive.orkl.eu/d7772dd945d443700bf92612c79e197d69f0b0aa.jpg"
    }
}