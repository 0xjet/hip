{
    "id": "4000d804-6a21-430b-9fed-bdaf321bdbfc",
    "created_at": "2023-01-12T15:01:31.746207Z",
    "updated_at": "2025-03-27T02:06:02.705873Z",
    "deleted_at": null,
    "sha1_hash": "85d0e57fe296b8a32a82bcd1681cb141f9cffda5",
    "title": "2021-12-02 - Revix Linux Ransomware",
    "authors": "",
    "file_creation_date": "2022-05-28T23:36:00Z",
    "file_modification_date": "2022-05-28T23:36:00Z",
    "file_size": 1238284,
    "plain_text": "# Revix Linux Ransomware\n\n**angle.ankura.com/post/102hcny/revix-linux-ransomware**\n\nVishal Thakur\n\nIn the first half of 2021, we started to see the REvil ransomware operators pivot to targeting\nLinux-based systems with a new Linux version of their ransomware, similar to the malware\nthey commonly used on Windows systems. Since then, there have been a few versions of\nthis Linux-based malware.\n\nIn this post, we look at the latest version of their Linux-based ransomware \"1.2a\".\n\n## Quick Snapshot:\n\nThe malicious file is a Linux executable\n\nClass: ELF64\n\nType: Dynamically Linked\n\nMachine: X86-64\n\nNumber of section headers: 28\n\nEntry Point: 0x401650\n\ncallq: __libc_start_main@plt\n\nMD5: c83df66c46bcbc05cd987661882ff061\n\nYara Rules:\n\n\n-----\n\n[https://github.com/YaraExchange/yarasigs/blob/master/ransomware/crime_lin_revil.yar](https://github.com/YaraExchange/yarasigs/blob/master/ransomware/crime_lin_revil.yar)\n[https://github.com/YaraExchange/yarasigs/blob/master/ransomware/crime_lin_revix.yar](https://github.com/YaraExchange/yarasigs/blob/master/ransomware/crime_lin_revix.yar)\n\n## Introduction\n\nThe execution of this malware is straightforward. It traverses through the directories specified\nas targets and encrypts the files present in those directories. Once encryption is complete, it\ndrops a ransom note in the directory with the usual ransom message and instructions on\npaying the threat actor to get the decryption key.\n\nThis variant of Revix requires a couple of parameters to be passed to execute successfully. It\nalso requires escalated privileges to run and encrypt files on the disk successfully.\nAdditionally, the malware checks the files in the target directories to see if they are already\nencrypted.\n\nOne of the main targets for this malware is VMware ESX platform's, which we've seen before\n[in a different Linux ransomware from DarkSide.](https://www.trendmicro.com/en_au/research/21/e/darkside-linux-vms-targeted.html)\n\n## Analysis\n\nFor this post, we analyzed Revix both statically and dynamically. Both methodologies have\nbeen used together throughout the analysis process presented below.\n\nLet’s take a quick look at a couple of sections of this executable so that we have the offsets\nto some of the initial calls that can be used for further analysis.\n\n\n-----\n\n**Header:**\n\n_Figure 1: Header Information_\n\n**Section .init:**\n\nThis section holds executable instructions that need to be executed before the main program\nentry point.\n\n_Figure 2: section_\n\n**Section .text:**\n\nThis section contains executable code.\n\n_Figure 3: section_\n\n## Functions\n\n\n-----\n\nRevix loads several functions upon initialization. Following are some of the more interesting\nfunctions we can extract useful information from, to understand the flow of execution, along\nwith developing threat detections that we've provided at the end of this post.\n\nWe execute the malware while attached to a debugger and break at the main function to\nview these functions presented below. Once we hit the main function, we follow the jump to\n'puts' function to look at the CPU at that location. We can see all the loaded functions at this\npoint.\n\n_Figure 4: Malware functions loaded upon initialization_\n\n_Figure 5: Function sequence during execution_\n\n## Initialization\n\nLet's take a quick look at the program initialization:\n\nThe malware requires to be run with a couple of command-line arguments. We can see\nthese being passed through the stack in the image below/\n\n_Figure 6: Parameters for the command-line arguments_\n\nThe image below shows another view from the CPU that shows the program execution in\nflight\n\n\n-----\n\n_Figure 7: Program execution in flight_\n\n_Figure 8: Stack view_\n\n## Execution\n\nWhen executed as a non-privileged user, the malware is not able to achieve full execution.\n\nAs shown in the image below, the malware has been provided with the directory 'here/' for\nthis analysis.\n\n_Figure 9: Write execution on dir_\n\nThe malware tries to access the data in this directory for read/write and is unsuccessful, as\nshown below.\n\n_Figure 10: getdent64 unsuccessful_\n\nThe malware also tries to encrypt a test file that we used in our analysis, but the encryption\nprocess fails as that action requires higher privileges.\n\n_Figure 11: Encryption unsuccessful_\n\nAs a result, the execution fails to achieve the desired outcome for the malware, as shown\nbelow.\n\n\n-----\n\n_Figure 12: Encryption failed_\n\nAnother point of interest from this failed execution is that the malware attempted to execute a\nesxcli command but this action fails as there is no esxcli on our test machine.\n\n_Figure 13: esxcli not found_\n\nWhen we execute Revix with elevated privileges, we start to see more successful activity\nfrom the malware.\n\nFirstly, Revix can access the data in the target directory.\n\n_Figure 14: getdents64 successful_\n\nWe can see in the image above, the system call ‘getdents’. This system call returns directory\nentries for the directory it’s run against.\n\n_Figure 15: getdents64(2) Synopsis_\n\nIn this case, there are three entries as we can see from the result shown in the image above.\n\nNext, we can see that Revix is able to perform read/write functions on the data in the target\ndirectories, resulting in successful encryption of files.\n\n_Figure 16: Encryption successful_\n\nThe Revix output below shows that it can write the ransom note text file to the victim's disk.\n\n\n-----\n\n_Figure 17: Ransom note write successful_\n\nFinally, we can see that the execution is completed successfully, resulting in the data present\nin the target directory being encrypted:\n\n_Figure 18: Execution complete_\n\nThe file we provided in the target directory is now encrypted, and a ransom note is created in\nthe same directory:\n\n_Figure 19: Execution complete, file encrypted_\n\nThe malware also checks if the data in the target directory is already encrypted. To\ndemonstrate this, we ran Revix against the same target directory one more time.\n\nUpon execution, Revix runs a check on the data present in the target directory and identifies\nit to be already encrypted:\n\n_Figure 20: Encryption check performed_\n\nAs a result, the execution ends up with no data being encrypted.\n\n\n-----\n\n_Figure 21: Execution complete_\n\n## VMware ESX Targeting\n\nRevix also tries to use esxcli, the command line interface for VMware’s ESX platform.\n\nLet's take a quick look at the parameters passed to esxcli by Revix when it executes:\n\n_esxcli --formatter=csv --format-param=fields==\"WorldID,DisplayName\" vm process list | awk_\n_-F \"\\\"*,\\\"*\" '{system(\"esxcli vm process kill --type=force --world-id=\" $1)}'_\n\n**vm process list**\n\nList the virtual machines on this system. This command currently will only list running VMs\non the system.\n\n**vm process kill**\n\nUsed to forcibly kill Virtual Machines that are stuck and not responding to normal stop\noperations.\n\n**--type**\n\nThere are three types of VM kills that can be attempted: [soft, hard, force].\n\n**--world-id | -w**\n\nThe World ID of the Virtual Machine to kill. This can be obtained from the 'vm process list'\ncommand (required)\n\nEssentially, these ESX command-line arguments are shutting down all virtual machines\nrunning on the ESX platform.\n\nRevix attempts to target the '/vmfs' directory and encrypt all the data present in that directory,\nso all the virtual machines are rendered inoperable until the data is decrypted. This targeting\nis similar to that seen in DarkSide's Linux variant.\n\n## Command-line Arguments\n\nThe malware requires the following parameters to be passed for its execution to begin:\n\n**elf.exe --path /vmfs/ --threads 5**\n\nIt also allows the '--silent' option that executes the malware without stopping any VMs\n\n**--silent (-s) use for not stoping VMs mode ***\n\n\n-----\n\n**Parameter** **Purpose**\n\n--path Specifies the path of the data that needs to be encrypted\n\n--threads Specifies the number of threads, by default the malware uses 50 threads\n\n--silent Executes the malware without stopping the VMs running on ESX\n\n## Configuration\n\nThe configuration of Revix is similar to that of its Windows variant, only with fewer fields.\n\n**Field** **Description**\n\npk Public Key\n\npid ID\n\nSub Tag\n\nDbg Debug mode\n\nnbody Base64-encoded body of the ransom-note\n\nnname Filename of the ransom-note\n\nrdmcnt Readme Count\n\next File extension of the encrypted files\n\nHere's an image showing the configuration we were able to extract from the sample we\nanalysed:\n\n\n-----\n\n_Figure 22: Configuration_\n\n## Profiling\n\nRevix also gathers information about the victim machine by running the \"uname\" command:\n\n**uname -a && echo \" | \" && hostname**\n\n_Figure 23: System profiling_\n\nThe results of the above command appear in the stack:\n\n_Figure 24: Stack view of system profiling in action_\n\nThe info is then passed through the registers:\n\n\n-----\n\n_Figure 25: Register view od system profiling in action_\n\nAnd the end-result is created in the form of this configuration with the victim information:\n\n_Figure 26: System profiling complete_\n\n## Encryption\n\nThe malware uses Salsa20 encryption algorithm, just like its Windows variant, to encrypt the\ndata. Here is the pseudocode for the function that implements this encryption:\n\n_Figure 27: Pseudo-code for the encryption algorithm_\n\n\n-----\n\n## Mitigation\n\n### Detections\n\n**Commands**\n\nRevix runs this command to determine machine info:\n\n_uname -a && echo \" | \" && hostname_\n\nRevix tries to query this directory:\n\n_/dev/urandom_\n\nRevix runs the below command to stop VMs running on the ESX platform in order to encrypt\nthe data on those VMs:\n\n_esxcli --formatter=csv --format-param=fields==\"WorldID,DisplayName\" vm process list | awk_\n_-F \"\\\"*,\\\"*\" '{system(\"esxcli vm process kill --type=force --world-id=\" $1)}'_\n\nTypos:\n\nIn some instances, typos that malware authors commit to the code are useful in detecting\nspecific malware or similar code used in other malware families. Below are some of the typos\nwe found in this variant of Revix:\n\n_--silent (-s) use for not stoping VMs mode_\n\n**_semms to be protected by os but let's encrypt anyway…_**\n\n## YARA Ruleset 1\n\n\n-----\n\nrule Revix {\n\nmeta:\n\ndescription = \"Detects REvil Linux - Revix 1.1 and 1.2\"\n\nauthor = \"Josh Lemon\"\n\nreference = \"https://angle.ankura.com/post/102hcny/revix-linux-ransomware\"\n\ndate = \"2021-11-04\"\n\nversion = \"1.0\"\n\nhash1 =\n\"f864922f947a6bb7d894245b53795b54b9378c0f7633c521240488e86f60c2c5\"\n\nhash2 = \"559e9c0a2ef6898fabaf0a5fb10ac4a0f8d721edde4758351910200fe16b5fa7\"\n\nhash3 =\n\"ea1872b2835128e3cb49a0bc27e4727ca33c4e6eba1e80422db19b505f965bc4\"\n\nstrings:\n\n$s1 = \"Usage example: elf.exe --path /vmfs/ --threads 5\" fullword ascii\n\n$s2 = \"uname -a && echo \\\" | \\\" && hostname\" fullword ascii\n\n$s3 = \"esxcli --formatter=csv --format-param=fields==\\\"WorldID,DisplayName\\\" vm\nprocess list\" ascii\n\n$s4 = \"awk -F \\\"\\\\\\\"*,\\\\\\\"*\\\" '{system(\\\"esxcli\" ascii\n\n$s5 = \"--silent (-s) use for not stoping VMs mode\" fullword ascii\n\n$s6 = \"!!!BY DEFAULT THIS SOFTWARE USES 50 THREADS!!!\" fullword ascii\n\n$s7 = \"%d:%d: Comment not allowed here\" fullword ascii\n\n$s8 = \"Error decoding user_id %d \" fullword ascii\n\n$s9 = \"Error read urandm line %d!\" fullword ascii\n\n$s10 = \"%d:%d: Unexpected `%c` in comment opening sequence\" fullword ascii\n\n$s11 = \"%d:%d: Unexpected EOF in block comment\" fullword ascii\n\n$s12 = \"Using silent mode, if you on esxi - stop VMs manualy\" fullword ascii\n\n$s13 = \"rand: try to read %hu but get %lu bytes\" fullword ascii\n\n$s14 = \"Revix\" fullword ascii\n\n$s15 = \"without --path encrypts current dir\" fullword ascii    $e1 = \"[%s] already\nencrypted\" fullword ascii\n\n$e2 = \"File [%s] was encrypted\" fullword ascii\n\n$e3 = \"File [%s] was NOT encrypted\" fullword ascii\n\n$e4 = \"Encrypting [%s]\" fullword ascii\n\ncondition:\n\nuint16(0) == 0x457f and filesize\n\n}\n\n## YARA Ruleset 2\n\n/*\n\nauthor = \"Vishal Thakur - malienist.medium.com\"\n\ndate = \"2021-11-15\"\n\nversion = \"1\"\n\n\n-----\n\ndescription = Detects Revix 1.2a and earlier versions of Revix\ninfo = \"Generated from information extracted from the malware sample by manual\nanalysis.\"\n*/\n\nimport \"pe\"\n\nrule revixStatic {\n\nstrings:\n\n$header = { 7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00 02 00 3e 00 01 00 00 00\n50 16 40 00 00 00 00 00 }\n\n$config = { 7B 22 76 65 72 22 3A ?? ?? 2C 22 70 69 64 22 3A 22 ?? ?? 22 2C 22 73 75\n62 22 3A 22 ?? ?? 22 2C 22 70 6B 22 3A 22 ?? ?? 22 2C 22 75 69 64 22 3A 22 ?? ?? 22\n2C 22 73 6B 22 3A 22 ?? ?? 22 2C 22 6F 73 22 3A 22 ?? ?? 22 2C 22 65 78 74 22 3A 22\n?? ?? 22 7D }\n\n$uname = { 75 6E 61 6D 65 20 2D 61 20 26 26 20 65 63 68 6F }\n\ncondition:\n\nall of them and\n\nfilesize\n\n}\n\nrule revixCode {\n\nstrings:\n\n$err1 = { 45 72 72 6F 72 20 6F 70 65 6E 20 75 72 61 6E 64 6D }\n\n$err2 = { 45 72 72 6F 72 20 64 65 63 6F 64 69 6E 67 20 6D 61 73 74 65 72 5F 70 6B }\n\n$err3 = { 66 61 74 61 6C 20 65 72 72 6F 72 2C 6D 61 73 74 65 72 5F 70 6B 20 73 69\n7A 65 20 69 73 20 62 61 64 }\n\n$err4 = { 45 72 72 6F 72 20 64 65 63 6F 64 69 6E 67 20 75 73 65 72 5F 69 64 }\n\n$err5 = { 45 72 72 6F 72 20 64 65 63 6F 64 69 6E 67 20 6E 6F 74 65 5F 62 6F 64 79 }\n\n$form1 = { 65 78 70 61 6E 64 20 33 32 2D 62 79 74 65 ?? ?? }\n\n$form2 = { 65 78 70 61 6E 64 20 31 36 2D 62 79 74 65 ?? ?? }\n\n$config = { 7B 22 76 65 72 22 3A ?? ?? 2C 22 70 69 64 22 3A 22 ?? ?? 22 2C 22 73 75\n62 22 3A 22 ?? ?? 22 2C 22 70 6B 22 3A 22 ?? ?? 22 2C 22 75 69 64 22 3A 22 ?? ?? 22\n2C 22 73 6B 22 3A 22 ?? ?? 22 2C 22 6F 73 22 3A 22 ?? ?? 22 2C 22 65 78 74 22 3A 22\n?? ?? 22 7D }\n\ncondition:\n\n\n-----\n\nall of them and\n\nfilesize\n\n}\n\nrule revixESX {\n\nstrings:\n\n$cmd1 = { 65 73 78 63 6C 69 }\n\n$cmd2 = { 2D 66 6F 72 6D 61 74 74 65 72 3D ?? ?? ?? }\n\n$cmd3 = { 2D 2D 66 6F 72 6D 61 74 2D 70 61 72 61 6D }\n\n$cmd4 = { 76 6D 20 70 72 6F 63 65 73 73 20 6C 69 73 74 }\n\n$cmd5 = { 65 73 78 63 6C 69 20 76 6D 20 70 72 6F 63 65 73 73 20 6B 69 6C 6C }\n\n$cmd6 = { 2D 2D 77 6F 72 6C 64 2D 69 64 3D 22 ?? ?? ?? }\n\n$config = { 7B 22 76 65 72 22 3A ?? ?? 2C 22 70 69 64 22 3A 22 ?? ?? 22 2C 22 73 75\n62 22 3A 22 ?? ?? 22 2C 22 70 6B 22 3A 22 ?? ?? 22 2C 22 75 69 64 22 3A 22 ?? ?? 22\n2C 22 73 6B 22 3A 22 ?? ?? 22 2C 22 6F 73 22 3A 22 ?? ?? 22 2C 22 65 78 74 22 3A 22\n?? ?? 22 7D }\n\ncondition:\n\nall of them and\n\nfilesize\n\n}\n\nrule revixPE {\n\ncondition:\n\npe.entry_point == 0x401650\n\n}\n\n## Conclusion\n\nAs we can see in the analysis shown above, the execution of Revix is a bit clunky in this\nvariant. It requires multiple conditions to be met before the ransomware is successful in\nencrypting data.\n\n\n-----\n\nRevix needs to be executed as a command-line argument with elevated privileges, specified\ntarget directories, and the number of threads. Basically, it's not a standalone application at\nthis time and is quite noisy as well.\n\nIf Revix is not run with silent mode enabled, it will try to stop any VMWare ESX virtual\nmachines, triggering incident response processes from the victim. Revix could quite possibly\nfail to encrypt the virtual machines due to reduced/restricted access of where they reside on\na Linux system.\n\nAs new variants for the Revix ransomware are released, we expect the execution to be more\nefficient, requiring fewer manual processes from the threat actor.\n\n## References\n\n[ESXi 7.0 U3 ESXCLI Command Reference](https://developer.vmware.com/docs/14743/esxi-7-0-u3-esxcli-command-reference/namespace/esxcli_vm.html)\n\n[DarkSide on Linux: Virtual Machines Targeted - Naiim, M.,2021](https://www.trendmicro.com/en_au/research/21/e/darkside-linux-vms-targeted.html)\n\n[getdents64(2) - Linux man page](https://linux.die.net/man/2/getdents64)\n\n[Code Analysis details by Intezer Analyse](https://analyze.intezer.com/files/f864922f947a6bb7d894245b53795b54b9378c0f7633c521240488e86f60c2c5)\n\n_© Copyright 2021. The views expressed herein are those of the author(s) and not_\n_necessarily the views of Ankura Consulting Group, LLC., its management, its subsidiaries, its_\n_affiliates, or its other professionals. Ankura is not a law firm and cannot provide legal advice._\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-12-02 - Revix Linux Ransomware.pdf"
    ],
    "report_names": [
        "2021-12-02 - Revix Linux Ransomware.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535691,
    "ts_updated_at": 1743041162,
    "ts_creation_date": 1653780960,
    "ts_modification_date": 1653780960,
    "files": {
        "pdf": "https://archive.orkl.eu/85d0e57fe296b8a32a82bcd1681cb141f9cffda5.pdf",
        "text": "https://archive.orkl.eu/85d0e57fe296b8a32a82bcd1681cb141f9cffda5.txt",
        "img": "https://archive.orkl.eu/85d0e57fe296b8a32a82bcd1681cb141f9cffda5.jpg"
    }
}