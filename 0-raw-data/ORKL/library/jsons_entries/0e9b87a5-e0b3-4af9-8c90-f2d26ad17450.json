{
    "id": "0e9b87a5-e0b3-4af9-8c90-f2d26ad17450",
    "created_at": "2023-05-06T02:09:35.810067Z",
    "updated_at": "2025-03-27T02:06:05.544526Z",
    "deleted_at": null,
    "sha1_hash": "5fe1d8dec854d4a51f46d6fe3c9d191684d77b37",
    "title": "2015-10-06 - Ticked Off- Upatre Malware’s Simple Anti-analysis Trick to Defeat Sandboxes",
    "authors": "",
    "file_creation_date": "2023-05-05T01:59:13Z",
    "file_modification_date": "2023-05-05T01:59:13Z",
    "file_size": 89515,
    "plain_text": "# Ticked Off: Upatre Malware’s Simple Anti-analysis Trick to Defeat Sandboxes\n\n**[unit42.paloaltonetworks.com/ticked-off-upatre-malwares-simple-anti-analysis-trick-to-defeat-sandboxes/](https://unit42.paloaltonetworks.com/ticked-off-upatre-malwares-simple-anti-analysis-trick-to-defeat-sandboxes/)**\n\nRichard Wartell October 6, 2015\n\nBy [Richard Wartell](https://unit42.paloaltonetworks.com/author/richard-wartell/)\n\nOctober 6, 2015 at 3:30 PM\n\n[Category: Malware,](https://unit42.paloaltonetworks.com/category/malware-2/) [Unit 42](https://unit42.paloaltonetworks.com/category/unit42/)\n\nTags: [AutoFocus,](https://unit42.paloaltonetworks.com/tag/autofocus/) [GetTickCount,](https://unit42.paloaltonetworks.com/tag/gettickcount/) [Upatre,](https://unit42.paloaltonetworks.com/tag/upatre/) [WildFire](https://unit42.paloaltonetworks.com/tag/wildfire/)\n\nThe Upatre family of malware is frequently updated, with the authors adding new features\nand protecting the malware from detection in various ways. If you aren’t yet familiar with\nUpatre, it’s one of the most common downloaders in the wild today, typically infecting\nsystems through phishing e-mails and downloading the Dyre banking Trojan to steal victim’s\ncredentials. Recently, the authors of Upatre added a very simple anti-analysis measure in an\nattempt to defeat sandboxes, which dynamically analyze executables to identify malicious\nbehavior.\n\n[The new anti-analysis trick involves using the Windows API GetTickCount. GetTickCount](https://msdn.microsoft.com/en-us/library/windows/desktop/ms724408(v=vs.85).aspx)\nreturns the number of milliseconds that the system has been alive, up to a maximum of\napproximately 49 days. Programs can use this value to determine how long a system has\nbeen running and make decisions based on that value. The following image shows Upatre\nexecuting these instructions inside of a debugger:\n\nThe code calls GetTickCount and compares the returned value to 0xAFE74 (720,500\nmilliseconds, or ~12 minutes). If GetTickCount returns a value less than 0xAFE74, Upatre\ndetermines that the system has been running for less than 12 minutes and exits.\n\nTo understand why this is an effective anti-analysis technique, we have to look at the normal\nstartup procedure for a sandbox:\n\n1. Start up a virtual machine with the target operating system on it\n2. Copy the malicious binary to the virtual machine\n3. Let the malware run for an extended period of time (usually about 5 minutes)\n\n\n-----\n\n4. Retrieve a report of what the malware did from the VM\n5. Shut down the virtual machine and clean up\n\nSince this whole process usually takes around 6 minutes at most, GetTickCount typically\nreturns a value much lower than 12 minutes. If this was an actual user’s system the value\nwould almost certainly be larger than 12 minutes, so a lower value gives the malware a clear\nindication that it is executing in a sandbox. By exiting at this point in the execution flow, the\nmalware doesn’t perform any malicious actions and will be flagged as benign in a sandbox.\n\nIn the Palo Alto Networks [WildFire analysis system, we modify the value returned by](https://www.paloaltonetworks.com/products/technologies/wildfire.html)\nGetTickCount to make it appear as though the machine has been running for hours. By doing\nthis, Upatre is fooled into continuing to execute its malicious routine, resulting in a malicious\nverdict.\n\nWe recently detected a surge of new Upatre malware samples exhibiting this behavior and\n[Brendan Griffin at Malcovery published a report on the activity recently. Palo Alto Networks](https://blog.malcovery.com/upatre-malware-adds-simple-anti-sandboxing-mechanism)\ncustomers using WildFire are fully protected from this anti-analysis technique and Palo Alto\n[Networks AutoFocus users can find new Upatre samples using the Upatre tag.](https://www.paloaltonetworks.com/products/platforms/subscriptions/autofocus.html)\n\n**Get updates from**\n\n**Palo Alto**\n\n**Networks!**\n\nSign up to receive the latest news, cyber threat intelligence and research from us\n\n[By submitting this form, you agree to our Terms of Use and acknowledge our Privacy](https://www.paloaltonetworks.com/legal-notices/terms-of-use)\nStatement.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2015/2015-10-06 - Ticked Off- Upatre Malware’s Simple Anti-analysis Trick to Defeat Sandboxes.pdf"
    ],
    "report_names": [
        "2015-10-06 - Ticked Off- Upatre Malware’s Simple Anti-analysis Trick to Defeat Sandboxes.pdf"
    ],
    "threat_actors": [
        {
            "id": "f8dddd06-da24-4184-9e24-4c22bdd1cbbf",
            "created_at": "2023-01-06T13:46:38.626906Z",
            "updated_at": "2025-03-27T02:00:02.877001Z",
            "deleted_at": null,
            "main_name": "Tick",
            "aliases": [
                "Stalker Taurus",
                "PLA Unit 61419",
                "Nian",
                "BRONZE BUTLER",
                "REDBALDKNIGHT",
                "STALKER PANDA",
                "G0060"
            ],
            "source_name": "MISPGALAXY:Tick",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d4e7cd9a-2290-4f89-a645-85b9a46d004b",
            "created_at": "2022-10-25T16:07:23.419513Z",
            "updated_at": "2025-03-27T02:02:09.790389Z",
            "deleted_at": null,
            "main_name": "Bronze Butler",
            "aliases": [
                "Bronze Butler",
                "CTG-2006",
                "Operation ENDTRADE",
                "RedBaldNight",
                "Stalker Panda",
                "Stalker Taurus",
                "TEMP.Tick",
                "Tick"
            ],
            "source_name": "ETDA:Bronze Butler",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "9002 RAT",
                "AngryRebel",
                "Blogspot",
                "Daserf",
                "Datper",
                "Elirks",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "HOMEUNIX",
                "HidraQ",
                "HomamDownloader",
                "Homux",
                "Hydraq",
                "Lilith",
                "Lilith RAT",
                "McRAT",
                "MdmBot",
                "Mimikatz",
                "Minzen",
                "Moudour",
                "Muirim",
                "Mydoor",
                "Nioupale",
                "PCRat",
                "POISONPLUG.SHADOW",
                "Roarur",
                "RoyalRoad",
                "ShadowPad Winnti",
                "ShadowWali",
                "ShadowWalker",
                "SymonLoader",
                "WCE",
                "Wali",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "XShellGhost",
                "XXMM",
                "gsecdump",
                "rarstar"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "bf0489c5-1c07-41e6-91c9-855ad96ccc6a",
            "created_at": "2022-10-25T16:47:55.541639Z",
            "updated_at": "2025-03-27T02:05:17.253496Z",
            "deleted_at": null,
            "main_name": "BRONZE BUTLER",
            "aliases": [
                "Daserf",
                "Stalker Panda ",
                "Tick ",
                "CTG-2006 "
            ],
            "source_name": "Secureworks:BRONZE BUTLER",
            "tools": [
                " DGet",
                " Daserf",
                " Datper",
                " Gofarer",
                " MSGet",
                " Mimikatz",
                " RarStar",
                " Screen Capture Tool",
                " ShadowPad",
                " T-SMB",
                " WinRAR",
                " Windows Credential Editor",
                " gsecdump",
                " xmm downloader",
                " xxmm",
                "ABK"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1683338975,
    "ts_updated_at": 1743041165,
    "ts_creation_date": 1683251953,
    "ts_modification_date": 1683251953,
    "files": {
        "pdf": "https://archive.orkl.eu/5fe1d8dec854d4a51f46d6fe3c9d191684d77b37.pdf",
        "text": "https://archive.orkl.eu/5fe1d8dec854d4a51f46d6fe3c9d191684d77b37.txt",
        "img": "https://archive.orkl.eu/5fe1d8dec854d4a51f46d6fe3c9d191684d77b37.jpg"
    }
}