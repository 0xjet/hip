{
    "id": "141e38e0-66e6-44a8-b260-382f27277707",
    "created_at": "2023-01-12T15:08:17.930864Z",
    "updated_at": "2025-03-27T02:09:29.198438Z",
    "deleted_at": null,
    "sha1_hash": "972f83564098f9f8d7f37f0b159247da0de21c7c",
    "title": "2019-10-29 - Threat Spotlight- Neshta File Infector Endures",
    "authors": "",
    "file_creation_date": "2022-05-28T02:30:05Z",
    "file_modification_date": "2022-05-28T02:30:05Z",
    "file_size": 150562,
    "plain_text": "# Threat Spotlight: Neshta File Infector Endures\n\n**[threatvector.cylance.com/en_us/home/threat-spotlight-neshta-file-infector-endures.html](https://threatvector.cylance.com/en_us/home/threat-spotlight-neshta-file-infector-endures.html)**\n\nTatsuya Hasegawa\n\n[RESEARCH & INTELLIGENCE / 10.29.19 /](https://threatvector.cylance.com/en/category/research-and-intelligence) [Tatsuya Hasegawa](https://threatvector.cylance.com/en/author/tatsuya-hasegawa)\n\n## Executive Overview\n\nNeshta is an older file infector that is still prevalent in the wild. It was initially observed in\n2003 and has been previously associated with BlackPOS malware. It prepends malicious\ncode to infected files. This threat is commonly introduced into an environment through\nunintentional downloading or by other malware. It infects Windows executable files and may\nattack network shares and removable storage devices.\n\nIn 2018 Neshta predominantly targeted the manufacturing industry, but attacked the finance,\nconsumer goods, and energy sectors as well. To achieve persistence Neshta renames itself\nto svchost.com then modifies the registry so it runs each time an .exe file is launched. This\nthreat is known to collect system information and use POST requests to exfiltrate data to\nattacker-controlled servers. The Neshta binaries used in our analysis did not demonstrate\nthe data exfiltration behaviour or functionality.\n\n## Technical Analysis\n\nThis section describes the symptoms of a Neshta infection. We picked samples of the\nNeshta virus uploaded to VirusTotal in 2007, 2008, and 2019.\n\nWe analyzed files with these SHA-256 hashes:\n\n29fd307edb4cfa4400a586d38116a90ce91233a3fc277de1cab7890e681c409a\n980bac6c9afe8efc9c6fe459a5f77213b0d8524eb00de82437288eb96138b9a2\n\n\n-----\n\n539452719c057f59238e123c80a0a10a0b577c4d8af7a5447903955e6cf7aa3d\na4d0865565180988c3d9dbf5ce35b7c17bac6458ef234cfed82b4664116851f2\n46200c11811058e6d1173a2279213d0b7ccde611590e427b3b28c0f684192d00\nc965f9503353ecd6971466d32c1ad2083a5475ce64aadc0b99ac13e2d2c31b75\n\n## Static File Analysis\n\nNeshta’s code is compiled by Boland Delphi 4.0. The file size is usually 41,472 bytes.\n\nAs any Delphi binary, Neshta has four writable sections (DATA, BSS, .idata, and .tls) and\nthree sharable sections (.rdata, .reloc, and .rsrc):\n\n_Figure 1: Section header features_\n\nIn addition, Neshta code displays interesting fingerprint strings - see Figure 2, below:\n\n“Delphi-the best. F*** off all the rest. Neshta 1.0 Made in Belarus. Прывiтанне усiм\n_~цiкавым~ беларус_кiм дзяучатам. Аляксандр Рыгоравiч, вам таксама :) Восень-_\n_кепская пара... Алiварыя - лепшае пiва! Best regards 2 Tommy Salo. [Nov-2005] yours_\n\n_[Dziadulja Apanas]”_\nThe Belarusian strings say: “ Hello everyone ~ ~ interesting belarus_kim girls. Alexander G.,\n_you too :) osen- bad couple ... Alivaryya - the best beer!”_\n\n_Figure 2: Neshta’s fingerprint strings_\n\n## File Infection\n\nNeshta’s main feature is its file infector which searches local drives for .exe files. Neshta\ntargets “.exe” files making exceptions for the ones that contain any of the following strings in\ntheir short path:\n\n%Temp%\n%SystemRoot% (usually C:\\Windows)\n\\PROGRA~1\\\n\nThe infection flow summary is described below and shown in Figure 3.\n\nNeshta:\n\n1. Reads 41,472 (0xA200) bytes from the beginning of target original file.\n2. Creates two sections and allocates memory with the attribute of PAGE_READWRITE\n\non the original file’s beginning and bottom.\n\n\n-----\n\n3. Inserts its malicious header and code at the beginning of the original file. The written\n\ndata is 41,472 bytes.\n4. Writes the encoded original header and code to the file, which is 41,472 bytes in size.\n\nThese actions enable the malicious code to launch as soon as the infected file is executed:\n\n_Figure 3: File Infection_\n\nWhen the infected file is executed, the original program is dropped into %Temp%\\3582-490\\\n<filename> and run by the WinExec API.\n\n## Persistence\n\nNeshta drops itself to C:\\Windows\\svchost.com and installs itself into the registry using the\nfollowing parameters:\n\n**Registry key: HKLM\\SOFTWARE\\Classes\\exefile\\shell\\open\\command**\n\n**Registry value: (Default)**\n\n**Value: %SystemRoot%\\svchost.com \"%1\" %***\n\nThis registry change directs the system to run Neshta each time an .exe file is launched. The\n\"%1\" %* points to the launched .exe file. In addition, Neshta creates a named mutex to check\nfor the existence of another running instance:\n\n_MutexPolesskayaGlush*.*<0x90>svchost.com<0x90>exefile\\shell\\open\\command‹À \"%1\"_\n_%*œ‘@_\n\nAnother dropped file is “directx.sys” which is sent to %SystemRoot%. This is a text file (not a\nkernel driver) which contains the path of the last infected file to run. It is updated every time\nan infected file is executed.\n\n## BlackBerry Cylance Stops Neshta\n\nBlackBerry Cylance uses artificial intelligence-based agents trained for threat detection on\nmillions of both safe and unsafe files. Our automated security agents block Neshta based on\ncountless file attributes and malicious behaviors instead of relying on a specific file signature.\nBlackBerry Cylance, which offers a [predictive advantage over zero-day threats, is trained on](https://threatvector.cylance.com/en_us/home/cylance-vs-future-threats-the-predictive-advantage.html)\nand effective against both new and legacy cyberattacks. For more information, visit\n[https://www.cylance.com.](https://www.cylance.com/)\n\n## Appendix\n\n Indicators of Compromise (IOCs)\n\n\n-----\n\nHashes\no  29fd307edb4cfa4400a586d38116a90ce91233a3fc277de1cab7890e681c409a\no  980bac6c9afe8efc9c6fe459a5f77213b0d8524eb00de82437288eb96138b9a2\no  539452719c057f59238e123c80a0a10a0b577c4d8af7a5447903955e6cf7aa3d\no  a4d0865565180988c3d9dbf5ce35b7c17bac6458ef234cfed82b4664116851f2\no  46200c11811058e6d1173a2279213d0b7ccde611590e427b3b28c0f684192d00\no  c965f9503353ecd6971466d32c1ad2083a5475ce64aadc0b99ac13e2d2c31b75\n\nFilenames\no  %SystemRoot%\\svchost.com\no  %SystemRoot%\\directx.sys\no  %Temp%\\tmp5023.tmp\n\nC2s/IPs\n\nMutexes\no  MutexPolesskayaGlush*.*<0x90>svchost.com<0x90>exefile\\shell\\open\\command‹À\n\"%1\" %*œ‘@\n\nInteresting strings\no  Delphi-the best. F**k off all the rest. Neshta 1.0 Made in Belarus. Прывiтанне усiм\n~цiкавым~ беларус_кiм дзяучатам. Аляксандр Рыгоравiч, вам таксама :) Восенькепская пара... Алiварыя - лепшае пiва! Best regards 2 Tommy Salo. [Nov-2005]\nyours [Dziadulja Apanas]\n\n**SHA256** **29fd307edb4cfa4400a586d38116a90ce91233a3fc277de1cab7890e681c409a**\n\n**Type** PE32 executable (GUI) Intel 80386, for MS Windows\n\n**Size** 41472\n\n**Timestamp** 1992:06:20 07:22:17+09:00\n\n**ITW names** Svchost[.]com\n\nTatsuya Hasegawa\n\n\n-----\n\n## About Tatsuya Hasegawa\n\nSenior Threat Researcher at BlackBerry Cylance\n\n[Tatsuya Hasegawa is a Senior Threat Researcher in APAC at BlackBerry, and is responsible](https://www.linkedin.com/in/tatsuya-hasegawa-aa3279142/)\nfor malware analysis and sandbox technology. He has practical experience in the both\nmanaged security service provider as a security analyst and CSIRT as an incident handler.\nHis certifications include: GREM, GCIH, GCFA, GXPN, GPEN and CISSP.\n\nBack\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-10-29 - Threat Spotlight- Neshta File Infector Endures.pdf"
    ],
    "report_names": [
        "2019-10-29 - Threat Spotlight- Neshta File Infector Endures.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536097,
    "ts_updated_at": 1743041369,
    "ts_creation_date": 1653705005,
    "ts_modification_date": 1653705005,
    "files": {
        "pdf": "https://archive.orkl.eu/972f83564098f9f8d7f37f0b159247da0de21c7c.pdf",
        "text": "https://archive.orkl.eu/972f83564098f9f8d7f37f0b159247da0de21c7c.txt",
        "img": "https://archive.orkl.eu/972f83564098f9f8d7f37f0b159247da0de21c7c.jpg"
    }
}