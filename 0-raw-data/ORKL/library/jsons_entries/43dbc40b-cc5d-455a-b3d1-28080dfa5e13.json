{
    "id": "43dbc40b-cc5d-455a-b3d1-28080dfa5e13",
    "created_at": "2022-10-25T16:48:16.294175Z",
    "updated_at": "2025-03-27T02:08:40.404889Z",
    "deleted_at": null,
    "sha1_hash": "12c4cc9d9a59aadcd01aa2282a6c99da8bcd18ab",
    "title": "",
    "authors": "",
    "file_creation_date": "2019-02-12T05:15:30Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 492151,
    "plain_text": "**[welivesecurity.com/2015/03/05/casper-malware-babar-bunny-another-espionage-cartoon](https://www.welivesecurity.com/2015/03/05/casper-malware-babar-bunny-another-espionage-cartoon/)**\n\nMarch 5, 2015\n\n[In March 2014, French newspaper Le Monde revealed that France is suspected by the](http://www.lemonde.fr/international/article/2014/03/21/quand-les-canadiens-partent-en-chasse-de-babar_4387233_3210.html)\nCommunications Security Establishment Canada (CSEC) of having developed and\ndeployed malicious software for espionage purposes. This story was based on\npresentation slides leaked by Edward Snowden, which were then published by\n[Germany’s Der Spiegel in January 2015.](http://www.spiegel.de/media/media-35683.pdf)\n\nAccording to the CSEC presentation, the malicious software in question is called\n“Babar” by its creators, likely after the famous French cartoon character “Babar The\nElephant”. Since then, several malware researchers have begun to work on the enigma\nthat is Babar. Marion Marschalek (Cyphort) struck first, with her report on the “Bunny”\nmalware. Bunny shares some characteristics with the Babar malware described by\n[CSEC. In mid-February, Marion published another report, this time on the actual Babar](http://www.cyphort.com/babar-suspected-nation-state-spyware-spotlight/)\ncase, explaining in great detail its spying features. At the same time, Paul Rascagnères\n[(G Data) published a blog post on the similarities between Babar and Bunny, and](https://blog.gdatasoftware.com/blog/article/babar-espionage-software-finally-found-and-put-under-the-microscope.html)\nshowed that they were very probably related to the malware described in the CSEC’s\nslides.\n\nIn this blog post, we lift the veil on another piece of software that we believe to have\nbeen created by the same organization that is behind Babar and Bunny. This\ncomponent is called “Casper” by its authors – presumably named after yet another\nfamous cartoon character.\n\nCasper was used against Syrian targets in April 2014, which makes it the most recent\nmalware from this group publicly known at this time. To attack their targets, Casper’s\n[operators used zero-day exploits in Adobe Flash, and these exploits were – surprisingly](http://virusradar.com/glossary/zero-day)\n– hosted on a Syrian governmental website. Casper is a well-developed reconnaissance\ntool, making extensive efforts to remain unseen on targeted machines. Of particular\nnote are the specific strategies adopted against antimalware software.\n\n# Context\n\nIn mid-April 2014, Vyacheslav Zakorzhevsky (Kaspersky) observed that the website\n“jpic.gov.sy” was hosting two Flash zero-day exploits, targeting the vulnerability later\nlabeled CVE-2014-0515. This website was set up in 2011 by the Syrian Justice Ministry\napparently to allow Syrian people to ask for reparation for the damage of the civil war.\nThe website is still online and apparently currently clean, although it was defaced in\nSeptember 2014 by some “hacktivist”.\n\nAt the time of the events, Zakorzhevsky could not retrieve the payloads distributed by\nthese Flash zero-days exploits. ESET researchers were able to find two of these\n[payloads, thanks to ESET LiveGrid® threat telemetry systems. The URLs of these](http://www.eset.com/int/about/technology/#livegrid)\npayloads and the dates when they were seen correspond to Zakorzhevsky’s\n\n\n-----\n\nIn a joint effort with Marion Marschalek, Paul Rascagnères, and researchers from the\n[Computer Incident Response Center Luxemboug (CIRCL), we were recently able to](http://www.circl.lu/)\ndetermine that the payloads distributed were very likely developed by the same actors\nwho developed the Babar and Bunny software.\n\n# Casper Binary Analysis\n\nThe two samples we found are the same core program but differently packaged. The\nfirst sample is an executable dropping the core program and making it persistent on\nthe machine. The second is a Windows library that deploys the core program directly\ninto memory, also in the form of a library. In this latter case, the name of the core\nprogram library was left visible by its creators: “Casper_DLL.dll”.\n\nThroughout this blog, we will focus on the first of these two payloads, the second one\nbeing similar in terms of behavior.\n\n## Dropper\n\nThe dropper is named “domcommon.exe” and its compilation date is set to the June\n18, 2010. This is very likely a forged date, as we will explain later.th\n\nIts execution is based on an XML configuration file decrypted at runtime with the RC4\nalgorithm and a hardcoded 16-byte key. Before the decryption, the program uses a\nchecksum computation to make sure the memory area containing the decryption key\nhas not been modified. Figure 1 shows the dropper’s decrypted configuration file.\n\nFigure 1 – Casper Dropper Configuration File\n\n## Casper Playing Chess against Antivirus\n\nFirstly, the dropper extracts the tag from its configuration file. This tag defines\nprecisely how the malware should behave, depending on which antivirus is present on\nthe machine.\n\n#### Choosing the appropriate strategy\n\n\n-----\n\n[machine by executing the Windows Management Instrumentation (WMI) request](https://msdn.microsoft.com/en-us/library/aa394582%28v=vs.85%29.aspx)\n“SELECT * FROM AntiVirusProduct” and fetching the “displayName” field from the\nresult. If an tag exists in the configuration file with a “NAME” attribute matching the\nname of an installed antivirus product, it will be set as the execution strategy. In this\ncase, four antivirus products have a defined strategy.\n\nIf no strategy is found for the running antivirus, or if no antivirus is protecting the\ncomputer, the default strategy described in the tag’s attributes will be applied.\nAlternatively, if a file named “strategy.xml” is present in the dropper’s folder, it will\noverride the strategy from the configuration file.\n\n#### Possible Moves\n\nA strategy is a set of attributes that influences both the dropper and the payload\nexecution. Some of these attributes define how to realize certain actions, whereas the\nothers define whether to perform certain actions. The following array describes the\nvarious “moves” offered by these attributes.\n\n**Possible**\n\n\n**Attribute** **Attribute Purpose**\n\nRUNKEY Defines how the dropper will interact\nwith the Windows registry in order\nto be persistent on the machine\n\nAUTODEL Defines how the dropper will remove\nitself from the machine after its\nexecution\n\nINJECTION Defines whether the dropper and\nthe payload will inject their code into\na new process, or execute it in the\ninitial process\n\n\n**Value** **Value Meaning**\n\nAPI Calls to Windows API functions\n(RegOpenKeyEx,\nRegQueryValueEx…)\n\nBAT Execution of a batch file\n[containing “reg” commands](https://technet.microsoft.com/en-us/library/cc732643.aspx)\n\nREG Execution of “reg” commands in\na command prompt process\n\nWMI Calls to methods of the\n[StdRegProv WMI class](https://msdn.microsoft.com/en-us/library/aa393664(v=vs.85).aspx)\n\nDEL Execution of a command line in\na command prompt process\n\nAPI Call to [MoveFileEx API function](https://msdn.microsoft.com/en-us/library/windows/desktop/aa365240%28v=vs.85%29.aspx)\nto delete the dropper during the\nnext restart of the system\n\nWMI Execution of a command line in\na command prompt process\ncreated through the Create\n[method of the Win32_Process](https://msdn.microsoft.com/en-us/library/aa389388(v=vs.85).aspx)\nWMI class\n\nYES/NO N/A\n\n\nSAFENOTIF Defines whether or not the payload YES/NO N/A\n\n\n-----\n\n**Attribute** **Attribute Purpose** **Value** **Value Meaning**\n\n\nSERVICE Likely defines how to interact with\nWindows services, but the code\nmanaging this attribute is missing in\nthese Casper samples\n\nESCAPE Defines whether the dropper will\nexecute normally, or simply exit\n\nSCHEDULER Unknown. The code managing this\nattribute is missing in these Casper\nsamples\n\n\nAPI N/A\n\nSC N/A\n\nYES/NO N/A\n\nCMD N/A\n\n\nThe possibilities offered by this tag show that Casper’s authors have acquired an indepth knowledge of behavioral detections in certain antivirus products.\n\nFor example, process injection will only happen on machines with none of the four\ndefined antiviruses running, since in such a case the “INJECTION” attribute will be set to\n“NO”. Interestingly, three antiviruses have the “ESCAPE” attribute set to “YES”, which\nmeans the dropper will simply uninstall itself in their presence without deploying\nCasper’s payload.\n\nAs the list of tags is pretty short, we can speculate that these are the antiviruses\nCasper’s authors expect to find on their targets. For the record, the “VERSION”\nattribute present in one tag is actually never used in the code, but it still indicates the\nintention to distinguish different versions of the same antivirus product. We very rarely\nsee this level of precision employed in malware in order to bypass antivirus.\n\n### Time To Drop The Payload\n\nIn the event that the “ESCAPE” attribute is set to “NO” in the chosen strategy – as is the\ncase with the default strategy – the dropper will then execute the commands provided\nin the form of XML tags in the configuration file, as shown in Figure 2.\n\nFigure 2 – Casper Dropper’s Commands\n\n#### Uninstalling previous versions\n\nThe first command instructs the dropper to remove other Casper instances that could\npossibly be running on the system. The corresponding tag comes with a “name”\nattribute, which will be prefixed with the BIOS constructor name retrieved from the\n\n\n-----\n\nmeant to avoid drawing the user’s attention if he or she happened to notice the\nidentifier.\n\nThe program is uninstalled in two steps, each step addressing different methods of\npersistence employed by Casper:\n\nIf it exists, the scheduled task whose name matches the identifier is removed\nfrom the system\nIf it exists, the application registered with the identifier in the Windows registry is\nremoved from the system\n\n#### Payload installation\n\nThe payload installation is then directed by the tag, which provides two versions of the\npayload, one for 32-bit machines () and another one for 64-bit machines ().\n\nThe attributes of the tag will then be used by one of the two installation methods\npreviously mentioned. If the operating system is Windows 7 or newer, persistence will\nbe set through a scheduled task; otherwise it will be set through the Windows registry\nkey\n\n“HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run”.\n\nThe tag provides an argument to give to the payload. The exact value of the argument\nis critical to the “correct” execution of the payload. The actual verification in the\npayload is subtle: the argument is used in a custom algorithm to find library functions\nin memory. Unless the value is correct, the addresses of these library functions will be\nwrong, resulting in a random-looking crash of the payload.\n\n#### Dropper cleans itself\n\nBefore terminating its execution, the dropper removes itself from the system, using\nthe method defined in the AUTODEL attribute. It should be noted that the payload is\nnot launched at this moment: it will be run only at the next startup thanks to the\nprevious persistence method.\n\n## Payload\n\nSimilarly to the dropper, Casper payload’s execution is based on an XML configuration\nfile decrypted at run-time, and shown in Figure 3.\n\n\n-----\n\nFigure 3 – Casper’s Payload Configuration File\n\nThis configuration file starts with a timestamp, which corresponds to Monday, the 7th\n**April 2014 at 21:27:05 GMT. Therefore, the compilation timestamps – set to 2010 –**\nhave very likely been forged.\n\nA series of tags will then control the payload’s behavior, as described in the following\narray.\n\n**attribute** **Purpose**\n\nID Unknown. It could be used to distinguish operations, as the value is the same in\nthe two payloads hosted on “jpic.gov.sy”.\n\nREGKEY Path in the Windows registry that will be used as storage area\n\nURL C&C server’s URL\n\nKEY Cryptographic key for the communications with the C&C server\n\n\nDELAYMIN\nDELAYMAX\nDELAYRETRY\n\n\nTimers to configure the frequency of the contacts with the C&C server\n\n\nThe payload then generates a unique identifier for the machine and inserts it at the\nend of the configuration in a tag. Finally, the configuration is RC4-encrypted and stored\nin the Windows registry.\n\nThe code handling the configuration shows certain capabilities not exploited in these\nCasper samples, for example a TIMETOLIVE attribute to plan the termination of Casper\nafter a certain amount of time, or a DELAYED_START attribute to wait before\ninteracting with the system.\n\nFinally, the payload’s configuration contains the exact same as the dropper.\n\n#### Report to C&C\n\nDuring its first execution, Casper’s payload executes the following XML file:\n\nThe handler of the “SYSINFO” command retrieves information about the system and\nbuilds a report containing several sections, as shown in Figure 4.\n\n\n-----\n\nFigure 4 – SYSINFO Command’s Result\n\nThe titles of the report sections are self-explanatory. Interestingly, the version of the\nmalware is clearly mentioned: 4.4.1. This report is then base64-encoded and sent to\n[the C&C server in the body of an HTTP POST request. It will also be written into a](http://virusradar.com/en/glossary/command-and-control-server)\ntemporary file named “perfaudio.dat”.\n\nThe network request will also have a cookie named “PREF” filled with the concatenation\nof the machine UID, the configuration ID, the version of Casper and the hardcoded\ncharacter “R”, all base64-encoded.\n\n#### C&C’s possible answers\n\nDue to the C&C being down at the time of the investigation we can only speculate on\nthe rest of the execution based on Casper’s known capabilities.\n\n\n-----\n\none in the SYSINFO request, but this time with “G” as the hardcoded character instead\nof “R”. Our analysis of the binary reveals that the server can then send back a PNG\nimage – with the correct header and format for a PNG file — from which a XML\ncommand file will be decrypted and executed.\n\nIn addition to the “SYSINFO” command, Casper can handle tags with the following\nvalues:\n\n“EXEC” to execute a program on the machine from its local path\n“SYSTEM” to execute commands in a Windows command prompt\n\nFinally, Casper can also handle tags, whose content is a Windows executable to deploy\non the machine.\n\n# How Does Casper Relate to the Other Cartoons?\n\nOur best chance of establishing that the same developers are behind Bunny, Babar\nand Casper is to identify unusual code or algorithms shared between these various\nprograms. In our comparison we also take into account the so-called “NBOT” malware\n(also known as the “TFC” malware), whose link with Babar and Bunny was established\n[by Marion Marschalek in her Babar report. Here is a non-exhaustive list of such](http://www.cyphort.com/babar-suspected-nation-state-spyware-spotlight/)\nshared features we observed:\n\nCasper hides its calls to API functions by using a hash calculated from the\nfunctions’ names, rather than the names themselves. The hashing algorithm is a\ncombination of rotate-left (ROL) of 7 bits and exclusive-or (XOR) operations.\nNBOT uses the exact same algorithm for the same purpose, whereas Babar\nhides its API calls in a similar manner but with a different algorithm.\n\nCasper fetches information about the running antivirus in a way similar to\nBunny, Babar, and NBOT, namely through the same WMI request. Moreover, all\nthese malwares compute the SHA-256 hash of the first word of the antivirus\nname, although in Casper it is actually never used.\nCasper generates delimiters for its HTTP requests by filling a specific format\nstring with the results of calls to the GetTickCount API function. The same code is\npresent in some NBOT samples, as shown in the following array.\n\n\n-----\n\nCasper removes its dropper by executing a Windows command created from the\nfollowing format string:\n\ncmd.exe /C FOR /L %%i IN (1,1,%d) DO IF EXIST “%hs” (DEL “%hs” & SYSTEMINFO) ELSE\nEXIT\n\nIn some NBOT samples we can find the following similar syntax:\n\ncmd.exe /C FOR /L %%i IN (1,1,%d) DO IF EXIST “%s” (DEL “%s” & PING 127.0.0.1 -n 3) ELSE\nEXIT\n\nCasper uses an “ID” value set to “13001”, whereas Babar samples contain an ID of\n“12075-01”. Also, the malware discovered in 2009 by the CSEC possesses an ID of\n[“08184” (slide 8 of the CSEC slides). This similar format, and the increasing value](http://www.spiegel.de/media/media-35683.pdf)\n\n\n-----\n\n**features together make us assess with high confidence that Bunny, Babar, NBOT**\n**and Casper were all developed by the same organization.**\n\n# Victimology\n\nAccording to our telemetry data, all the people targeted during this operation were\nlocated in Syria. These targets may have been the visitors of the “jpic.gov.sy” website\n— Syrian citizens who want to file a complaint. In this case they could have been\nredirected to the exploits from a legitimate page of this website.\n\nBut we were actually unable to determine if this were indeed the case. In other words,\nit is just as likely that the targets have been redirected to the exploits from another\nlocation, for example from a hacked legitimate website or from a link in an email. What\nis known for sure is that the exploits, the Casper binaries and the C&C component\nwere all hosted on this website’s server.\n\nThis leads us to a second hypothesis: the “jpic.gov.sy” website could have been hacked\nto serve as a storage area. This would have at least two advantages for the attackers:\nfirstly, hosting the files on a Syrian server can make them more easily accessible from\nSyria, a country whose Internet connection to the outside world has been unstable\n[since the beginning of the civil war, as shown in Google Transparency Report.](http://www.google.com/transparencyreport/traffic/explorer/?r=SY&l=EVERYTHING&csd=1301710971931&ced=1413615600000)\nSecondly, it would mislead attribution efforts by raising suspicion against the Syrian\ngovernment.\n\n# Conclusion\n\nAs previously explained, we are confident that the same group developed Bunny,\nBabar and Casper. The detailed analysis of Babar in the CSEC slides from 2009\nindicates this group is not a newcomer to the espionage business. The use of zero-day\nexploits is another indication that Casper’s operators belong to a powerful\norganization. Finally, the narrow targeting of people in Syria shows a likely interest in\ngeopolitics.\n\nNevertheless, we did not find any evidence in Casper itself to point a finger at a specific\ncountry. In particular, no signs of French origin, as suggested by CSEC for Babar, were\nfound in the binaries.\n\n# Hashes\n\n**ESET Detection**\n\n\n**SHA1** **Note**\n\n\n**Name**\n\n\n75BF51709B913FDB4086DF78D84C099418F0F449 DLL Dropper Win32/ProxyBot.B\n\n7F266A5E959BEF9798A08E791E22DF4E1DEA9ED5 DLL Dropper Win32/ProxyBot.B\n\n\n-----\n\n**SHA1** **Note** **Name**\n\nE4CC35792A48123E71A2C7B6AA904006343A157A Executable Dropper Win32/ProxyBot.B\n\n\nF4C39EDDEF1C7D99283C7303C1835E99D8E498B0 X86 Executable\nPayload\n\nC2CE95256206E0EBC98E237FB73B68AC69843DD5 X64 Executable\nPayload\n\n# Indicators of Compromise\n\n**Indicator** **Value**\n\nDropper’s file name domcommon.exe\n\nPayload’s file name aiomgr.exe\n\n\nWin32/ProxyBot.B\n\nWin32/ProxyBot.A\n\n\nC&C URLs hXXp://jpic.gov.sy/css/images/_cgi/index.php\n\nMutex name {4216567A-4512-9825-7745F856}\n\nKey for configuration decryption 7B 4B 59 DE 37 4A 42 26 59 98 63 C6 2D 0F 57\n40\n\nTemporary file name perfaudio.dat\n\n_Image: PAISAN HOMHUAN / Shutterstock.com_\n\n[Joan Calvet 5 Mar 2015 - 01:55PM](https://www.welivesecurity.com/author/joan/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2015/2015.03.05.Casper_Malware/casper-malware-babar-bunny-another-espionage-cartoon.pdf"
    ],
    "report_names": [
        "casper-malware-babar-bunny-another-espionage-cartoon"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "f8dddd06-da24-4184-9e24-4c22bdd1cbbf",
            "created_at": "2023-01-06T13:46:38.626906Z",
            "updated_at": "2025-03-27T02:00:02.877001Z",
            "deleted_at": null,
            "main_name": "Tick",
            "aliases": [
                "Stalker Taurus",
                "PLA Unit 61419",
                "Nian",
                "BRONZE BUTLER",
                "REDBALDKNIGHT",
                "STALKER PANDA",
                "G0060"
            ],
            "source_name": "MISPGALAXY:Tick",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d4e7cd9a-2290-4f89-a645-85b9a46d004b",
            "created_at": "2022-10-25T16:07:23.419513Z",
            "updated_at": "2025-03-27T02:02:09.790389Z",
            "deleted_at": null,
            "main_name": "Bronze Butler",
            "aliases": [
                "Bronze Butler",
                "CTG-2006",
                "Operation ENDTRADE",
                "RedBaldNight",
                "Stalker Panda",
                "Stalker Taurus",
                "TEMP.Tick",
                "Tick"
            ],
            "source_name": "ETDA:Bronze Butler",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "9002 RAT",
                "AngryRebel",
                "Blogspot",
                "Daserf",
                "Datper",
                "Elirks",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "HOMEUNIX",
                "HidraQ",
                "HomamDownloader",
                "Homux",
                "Hydraq",
                "Lilith",
                "Lilith RAT",
                "McRAT",
                "MdmBot",
                "Mimikatz",
                "Minzen",
                "Moudour",
                "Muirim",
                "Mydoor",
                "Nioupale",
                "PCRat",
                "POISONPLUG.SHADOW",
                "Roarur",
                "RoyalRoad",
                "ShadowPad Winnti",
                "ShadowWali",
                "ShadowWalker",
                "SymonLoader",
                "WCE",
                "Wali",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "XShellGhost",
                "XXMM",
                "gsecdump",
                "rarstar"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "bf0489c5-1c07-41e6-91c9-855ad96ccc6a",
            "created_at": "2022-10-25T16:47:55.541639Z",
            "updated_at": "2025-03-27T02:05:17.253496Z",
            "deleted_at": null,
            "main_name": "BRONZE BUTLER",
            "aliases": [
                "Daserf",
                "Stalker Panda ",
                "Tick ",
                "CTG-2006 "
            ],
            "source_name": "Secureworks:BRONZE BUTLER",
            "tools": [
                " DGet",
                " Daserf",
                " Datper",
                " Gofarer",
                " MSGet",
                " Mimikatz",
                " RarStar",
                " Screen Capture Tool",
                " ShadowPad",
                " T-SMB",
                " WinRAR",
                " Windows Credential Editor",
                " gsecdump",
                " xmm downloader",
                " xxmm",
                "ABK"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1666716496,
    "ts_updated_at": 1743041320,
    "ts_creation_date": 1549948530,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/12c4cc9d9a59aadcd01aa2282a6c99da8bcd18ab.pdf",
        "text": "https://archive.orkl.eu/12c4cc9d9a59aadcd01aa2282a6c99da8bcd18ab.txt",
        "img": "https://archive.orkl.eu/12c4cc9d9a59aadcd01aa2282a6c99da8bcd18ab.jpg"
    }
}