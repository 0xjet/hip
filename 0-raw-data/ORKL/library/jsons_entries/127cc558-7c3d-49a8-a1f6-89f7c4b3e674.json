{
    "id": "127cc558-7c3d-49a8-a1f6-89f7c4b3e674",
    "created_at": "2022-10-25T16:48:22.060335Z",
    "updated_at": "2025-03-27T02:09:15.376777Z",
    "deleted_at": null,
    "sha1_hash": "4e45a10b5a7c19ff7af8f68f6908d14258f4e799",
    "title": "",
    "authors": "",
    "file_creation_date": "2019-08-09T12:43:28Z",
    "file_modification_date": "2019-08-09T12:43:31Z",
    "file_size": 1116917,
    "plain_text": "# MACHETE\n JUST GOT SHARPER\n## Venezuelan government institutions under attack\n\n### How spies managed to steal gigabytes\n of confidential data over the course of a year\n\n\n-----\n\n#### TABLE OF CONTENTS\n\n1. Introduction .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 4\n\n2. Delivery method  .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .  4\n\n3. Timeline of Machete’s latest version .   .   .   .   .   .   .   .   .   . 5\n\n4. Targets .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   . 6\n\n5. Malware operators .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   . 7\n\n6. Technical analysis .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 8\n\n6.1 Downloader component .   .   .   .   .   .   .   .   .   .   .   .   . 8\n\n6.2 Obfuscation  .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   . 9\n\n6.3 Backdoor components .  .  .  .  .  .  .  .  .  .  .  .  . 10\n\n6.4 Domain names  .   .   .   .   .   .   .   .   .   .   .   .   .   .   .  27\n\n7. Conclusion .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .  28\n\n8. References  .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   . 29\n\n9. IoCs .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 30\n\n#### LIST OF TABLES\n\nTable 1 _Tasks scheduled for the execution of components .   .   .   .   . 22_\n\nTable 2 _Domain names and related IP addresses .   .   .   .   .   .   .   . 27_\n\n\n-----\n\n#### LIST OF FIGURES\n\nFigure 1 _Decoy (PDF file) in one of the Machete downloaders (blurred) .  5_\n\nFigure 2 _Countries with Machete victims in 2019 .   .   .   .   .   .   .   .  7_\n\nFigure 3 _Example of a Spanish word in Machete’s code  .   .   .   .   .   .  7_\n\nFigure 4 _Components of Machete .   .   .   .   .   .   .   .   .   .   .   .   .  8_\n\nFigure 5 _Configuration of a Machete downloader .   .   .   .   .   .   .   .  8_\n\nFigure 6 _Downloader code  .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   9_\n\nFigure 7 _Machete’s extra obfuscation  .   .   .   .   .   .   .   .   .   .   .   10_\n\nFigure 8 _Example of Machete’s first layer of obfuscation .   .   .   .   .   10_\n\nFigure 9 _Executable py2exe components of Machete .   .   .   .   .   .   .  11_\n\nFigure 10 Version check in GoogleCrash.exe  .   .   .   .   .   .   .   .   11\n\nFigure 11 Code to encrypt/decrypt config .   .   .   .   .   .   .   .   .   .   .  12\n\nFigure 12 Main code of Chrome.exe  .   .   .   .   .   .   .   .   .   .   .   . 13\n\nFigure 13 Code to create file listings .   .   .   .   .   .   .   .   .   .   .   .   14\n\nFigure 14 Code to access clipboard .   .   .   .   .   .   .   .   .   .   .   .   .  14\n\nFigure 15 File extensions to copy from removable drives  .   .   .   .   .   .  15\n\nFigure 16 File extensions for physical exfiltration .   .   .   .   .   .   .   .  16\n\nFigure 17 Code on Hack Forums .   .   .   .   .   .   .   .   .   .   .   .   .   . 16\n\nFigure 18 Keys in a Spanish distribution .   .   .   .   .   .   .   .   .   .   .   17\n\nFigure 19 Code for geolocation .   .   .   .   .   .   .   .   .   .   .   .   .   .  18\n\nFigure 20 Code to upload files in Winde  .   .   .   .   .   .   .   .   .   .   . 19\n\nFigure 21 Code to download a new configuration  .   .   .   .   .   .   .   .  19\n\nFigure 22 Code to update file listings .   .   .   .   .   .   .   .   .   .   .   .  19\n\nFigure 23 Code to download and execute other binaries .   .   .   .   .   . 20\n\nFigure 24 Folders on the FTP server  .   .   .   .   .   .   .   .   .   .   .   .  20\n\nFigure 25 Code for HTTP exfiltration .   .   .   .   .   .   .   .   .   .   .   .  21\n\nFigure 26 Configuration for self-extraction of python27.exe .   .   .   .   . 22\n\nFigure 27 Code for copying files .   .   .   .   .   .   .   .   .   .   .   .   .   . 23\n\nFigure 28 Archive names for different browsers .   .   .   .   .   .   .   .   . 23\n\nFigure 29 Code to obtain clipboard data .   .   .   .   .   .   .   .   .   .   .  24\n\nFigure 30 Code to obtain information about wireless networks .   .   .   . 24\n\nFigure 31 Downloads from C&C server  .   .   .   .   .   .   .   .   .   .   .   25\n\nFigure 32 Code to move newest files .   .   .   .   .   .   .   .   .   .   .   .  26\n\nFigure 33 Part of encryption code  .   .   .   .   .   .   .   .   .   .   .   .   .  26\n\nFigure 34 Code for sending files to the C&C server .   .   .   .   .   .   .   . 27\n\nFigure 35 Files spread in phishing emails  .   .   .   .   .   .   .   .   .   .   . 28\n\n\n-----\n\n#### EXECUTIVE SUMMARY\n\nMachete is a cyberespionage toolset developed by a Spanish-speaking group that has been operating\nsince at least 2010. This group is very active and continues to develop new features for its malware,\nand implement infrastructure changes in 2019. Their long run of attacks, focused in Latin American countries,\nhas allowed them to collect intelligence and refine their tactics over the years. ESET researchers have\ndetected an ongoing, highly targeted campaign, with a majority of the targets being military organizations.\n\nKey points in this white paper:\n\n- In 2019, ESET has seen more than 50 computers compromised by Machete in various Latin American\n\ncountries, with over 75% of them belonging to Venezuelan government institutions.\n\n- The group behind Machete uses effective spearphishing techniques. They know their targets, how\n\nto blend into regular communications, and which documents are of the most value to steal. Not only\ndoes Machete exfiltrate common office suite documents, but also specialized file types used by geo­\ngraphic information systems (GIS) that describe geographic data for navigation and positioning purposes.\n\n- Machete has evolved from what was seen in earlier attacks. The main backdoor is still Python-based,\n\nbut enriched with several new features such as a more resilient C&C communication mechanism, the use\nof Mozilla Location Service to geolocate compromised computers, and the possibility to exfiltrate data\nto removable drives when there is physical access to targets.\n\n- The group is very active. ESET has seen cases where stolen documents dated on one particular day were\n\nbundled with malware and used on the same day as lures to compromise new victims.\n\n_For any inquiries, or to submit samples related to this white paper, contact us at:_ _threatintel@eset.com_\n\n#### 1. INTRODUCTION\n\nMany events occurred in the first half of 2019 that have put Venezuela in the spotlight. From the uprising\nof the opposition against President Nicolás Maduro to plots in the government, the situation in Venezuela\nhas been open to international scrutiny. There is, however, an ongoing case of cyberespionage against\nVenezuelan government institutions that has managed to stay under the radar.\n\nFirst described by Kaspersky in 2014 [1] and later, by Cylance in 2017 [2], Machete is a piece of malware\nfound to be targeting high profile individuals and organizations in Latin American countries. In 2018 Machete\nreappeared with new code and new features. As of June 2019, ESET has seen over 50 victims being actively\nspied upon by Machete, with more than 75% of them being computers belonging to the Venezuelan govern­\nment institutions. Several GBs of confidential documents and private information have been exfiltrated to\na server controlled by the attackers.\n\nMachete has Latin American targets and has been developed by a Spanish-speaking group, presumably\nfrom a LATAM country. They are active and constantly working on very effective spearphishing campaigns.\nIn some cases, they trick new victims by sending real documents that had been stolen on the very same day.\nThey seem to have specialized knowledge about military operations, as they are focused on stealing specific\nfiles such as those that describe navigation routes. This white paper presents a technical analysis of the\nmalware, as well as data related to these targeted attacks.\n\n#### 2. DELIVERY METHOD\n\nMachete relies on spearphishing to compromise its targets. In other words, very specific emails are sent\ndirectly to the victims, and they change from target to target. These emails contain a link to download\n(or an attachment with) a compressed file with the malware and a document that serves as decoy.\n\nFigure 1 is a typical PDF file displayed to a potential victim before compromise. To trick unsuspecting targets,\nMachete operators use real documents they have previously stolen; Figure 1 is a classified official document\n\n\n-----\n\nthat is dated May 21st, 2019, the same day the related .zip file was first sent to targets.\n\nFigure 1 // Decoy (PDF file) in one of the Machete downloaders (blurred)\n\nThe kind of documents used as decoys are sent and received legitimately several times a day by targets.\nFor example, Radiogramas are documents used for communication in the military forces. Attackers take\nadvantage of that, along with their knowledge of military jargon and etiquette, to craft very convincing\nphishing emails.\n\n#### 3. TIMELINE OF MACHETE’S LATEST VERSION\n\nIn order to get a general idea of Machete’s capabilities to steal documents and spy on its targets,\nwe’ll describe its main features as they appeared, in chronological order.\n\n###### April 2018\n\nThe first time the new version was seen. It features:\n\n- Coded in Python\n\n- Code is obfuscated to try to thwart analysis\n\n- First stage downloader fetches the actual malware\n\n- Takes screenshots\n\n- Logs keystrokes\n\n- Accesses the clipboard\n\n- Communicates with an FTP server\n\n- AES encrypts and exfiltrates documents\n\n- Detects newly inserted drives and copies files\n\n- Updates configuration or malware binaries\n\n- Executes other binaries\n\n- Retrieves specific files from the system\n\n- Logs are generated in English\n\nSome of these early versions cannot have their code or configuration updated from the remote server.\nHowever, the binaries seen since late April do have these capabilities.\n\n###### August 2018\n\nAn extra layer of obfuscation was added, using zlib compression and base64 encoding. It managed to evade\ndetection by most security products.\n\n###### November 2018\n\n\n-----\n\nTwo new features were added:\n\n- Geolocation of victims and information about nearby Wi-Fi networks\n\n- Retrieves user profile data from Chrome and Firefox browsers\n\n###### February 2019\n\nPhysical exfiltration to removable drives was added, but both features added in November 2018 were\nremoved from the code. Also, logs were changed to Spanish.\n\n###### May 2019\n\nOn May 5th, 2019, subdomains used by Machete to communicate with the remote server were taken down.\nNew samples with new features started to emerge on May 16th.\n\nNew features:\n\n- Data are sent over HTTP if FTP connection fails\n\n- AES encryption algorithm was dropped and replaced by base64 encoding\n\n- Logs (of keys and clipboard contents) are not sent until they are larger than 10 KB\n\n- List of file extensions that are exfiltrated was reduced\n\n- There is no obfuscation after first layer of base64/zlib compression\n\n- There is no downloader\n\n###### June 2019\n\n- Communication is over HTTP only, with a main and a fallback server\n\n- Machete components are Python scripts; py2exe binaries were removed from this version\n\n- Documents are AES encrypted and base64 encoded before being sent\n\n- Now retrieves user data from more browsers\n\n- Only Microsoft Office documents, JPEG images, .pdf documents and archives are exfiltrated\n\n- Code was rewritten to perform the same tasks (keylogging, taking screenshots, etc.) but using\n\ndifferent libraries\n\n#### 4. TARGETS\n\nMachete is a highly targeted backdoor that has managed to stay under the radar for years. Emails\nwith malicious attachments are only sent in small numbers. Operators behind Machete apparently already\nhave information about individuals or organizations of interest to them in Latin America, how to reach them,\nand how best to trick them into getting compromised. Real documents are used as decoys, so it is not rare\nthat victims never realize they were compromised and are even compromised again after Machete\nC&C servers change.\n\nSince the end of March up until the end of May 2019, ESET observed that there were more than 50 victim­\nized computers actively communicating with the C&C server. This would amount to gigabytes of data being\nuploaded every week. By analyzing filenames and metadata of exfiltrated documents, it was possible\nto determine that more than 75% of the compromised computers were in various Venezuelan government\ninstitutions, such as militay forces, education, police, and foreign affairs sectors. This extends\nto other countries in Latin America, with the Ecuadorean military being another organization highly targeted\nby Machete. These countries are shown in Figure 2.\n\n\n-----\n\n#### 7%\nColombia\n\n#### 2% 75%\nNicaragua Venezuela\n\n#### 16%\nEcuador\n\nFigure 2 // Countries with Machete victims in 2019\n\n#### 5. MALWARE OPERATORS\n\nMachete is malware that has been developed and is actively maintained by a Spanish-speaking group.\nThis has been affirmed by other researchers for previous versions of Machete; these reasons, in conjunction\nwith those we describe below, lead us to agree with this attribution.\n\nFirst of all, there are some words in Spanish present within the code of the malware. Variable names\nare mostly random but the operators forgot to rename some of them. Examples include: datos (data),\ncanal (channel), senal (signal), and unidad (unit, drive). Another example is shown in Figure 3.\n\nFigure 3 // Example of a Spanish word in Machete’s code\n\n\n-----\n\nAlso, as was previously mentioned, logs with keystrokes and clipboard data are generated in Spanish.\nInitially they were in English, perhaps indicating copied code, but were later translated, for example\nto indicate which window the data is coming from.\n\nThe presence of code for physical exfiltration of documents may indicate that Machete operators could\nhave a presence in one of the targeted countries, although we cannot be certain.\n\n#### 6. TECHNICAL ANALYSIS\n\nBetween 2014 and 2017 inclusive, the malware was distributed in NSIS-packed files. These would extract\nand execute several py2exe components of Machete; py2exe [3] is a tool that converts Python scripts into\nWindows executables. These executables don’t require a Python installation to run, but can be quite large,\nas they need to include all Python libraries used by the script and the Python virtual machine. For example,\npy2exe would convert the classic one-liner “Hello, world” script into a 4 MB executable.\n\nThis new version of Machete, first seen in April 2018, uses a downloader as a first stage, which installs\nthe backdoor components of Machete on a compromised system.\n\n\nSelf-extracting file\nEncrypted Config\n\n**EXE** **EXE**\n\n###### [...]\n\n**py2Exe**\nBackdoor components\n\n\nSelf-extracting file\nwith Decoy document\n\n\nAnother **EXE**\nself-extracting file\nwith Encrypted URL\n\n**py2Exe**\nDownloader component\n\n**WWW**\n\n**Internet**\n\nFigure 4 // Components of Machete\n\n|g file onfig|Col2|\n|---|---|\n|||\n\n\nIn Figure 4 we can see that the downloader comes as a self-extracting file (made with 7z SFX Builder [4]).\nIt opens a PDF or Microsoft Office file that serves as a decoy and then runs the downloader executable.\nThe downloader is a RAR SFX that contains the actual downloader binary (a py2exe component)\nand a configuration file with the downloader’s target URL as an encrypted string.\n\nAll download URLs we have seen are either Dropbox or Google Docs. The files at these URLs have all been\nself-extracting (RAR SFX) archives containing encrypted configuration and malicious py2exe components.\n\n##### 6.1 Downloader component\n\nAn example of a configuration file for a 7z self-extracting downloader is shown in Figure 5.\n\nFigure 5 // Configuration of a Machete downloader\n\n\n-----\n\nThe .exe file inside is a RAR SFX that is very similar in structure to the final Machete payload itself.\nIt contains a py2exe executable and a configuration file with the URL from which to download Machete.\nThe config file is named mswe and it is the base64-encoded text of an AES-encrypted string.\n\nThe flow of execution for the downloader can be summarized as follows:\n\n- The working directory for the downloader will be: %APPDATA%\\GooDown\n\n- A scheduled task (ChromeDow) is created to execute the downloader every three to six minutes\n\n- The download URL is read and decrypted (AES) from the mswe config file\n\n- Machete is downloaded\n\n- Downloaded data are decrypted (AES) and renamed as Security.exe\n\n- Machete is executed\n\n- The task for the downloader is deleted\n\nFor each binary the decryption key is the same for both URL and payload, but the key varies across binaries.\nIn contrast, decryption keys used in the Machete payload itself have remained the same across all binaries\nup until June 2019, when they changed.\n\nPart of the code is shown in Figure 6.\n\nFigure 6 // Downloader code\n\nLater downloaders added version check features, similar to what we’ll describe in the GoogleCrash.exe:\n_scheduling and persistence section below. In these cases, version information is read from a file bsw.as,_\nincluded in the downloader. Some names were also changed: for example, the task was renamed\nto AdobeR, and downloaded payload renamed to ders.exe.\n\n##### 6.2 Obfuscation\n\nSince August 2018, all the main Machete backdoor components (which will be described in the next section)\nhave been delivered with an extra layer of obfuscation. The executable py2exe files now contain a block\nof zlib-compressed, base64-encoded text which, after being decoded, corresponds to the same code\nthat was seen before. This obfuscation is produced using pyminifier [5] with the -gzip parameter.\nPart of the obfuscated code is shown in Figure 7.\n\n\n-----\n\nFigure 7 // Machete’s extra obfuscation\n\nAfter that obfuscation is removed, there is code with further obfuscation including random names\nfor variables and lots of junk code. Once again, this was not developed by the Machete operators:\npyobfuscate [6] is an old project that has been used in previous Machete versions as well. A sample\nof this obfuscated code is shown in Figure 8.\n\nFigure 8 // Example of Machete’s first layer of obfuscation\n\nIt must be noted that one of the Machete binaries had a chunk of commented code that is produced\nby NXcrypt [7]. However, in the end, it seems the Machete operators decided not to use NXcrypt after all.\n\n##### 6.3 Backdoor components\n\nMachete’s dropper is a RAR SFX executable. Three py2exe components are dropped: GoogleCrash.exe,\n```\nChrome.exe and GoogleUpdate.exe. GoogleCrash.exe is executed first and launches the other two.\n\n```\n\n-----\n\n**jer.dll**\nEncrypted Config\n\n_Runs every 30 minutes_\n\n**Spy component** **Communication**\nChrome.exe GoogleUpdate.exe\n\n_Installs other components_\n\n_Runs indefinitely_ _Runs every 10 minutes_\n\n_Copies and encrypts_ _Sends stolen data_\n_documents_ _to server_\n\n_Screenshots, keylogs, etc._ _Receives updates from server_\n\nFigure 9 // Executable py2exe components of Machete\n\nA single configuration file, jer.dll, is dropped, and it contains base64-encoded text that corresponds\nto AES-encrypted strings. A schema summarizing the components is shown in Figure 9.\n\n###### GoogleCrash.exe: scheduling and persistence\n\nThis is the main component of the malware. It schedules execution of the other two components\nand creates Windows Task Scheduler tasks to achieve persistence.\n\nFirst, a version number is read from the configuration file jer.dll. Version numbers have 4 digits since\nthis new distribution in 2018, although sometimes they also have ‘.0’ at the end (for example, version number\n_‘1111.0’). If a victim’s PC was already compromised and the version number in the new configuration file_\nis bigger than in the existing one (see Figure 10), the existing Machete installation (tasks, files, processes)\nis cleaned and the new version installed.\n\nFigure 10 // Version check in GoogleCrash.exe\n\nNext, the following tasks are created:\n\nSpy component runs every 3 minutes\n```\nSCHTASKS /create /ST 00:00:01 /SC MINUTE /MO 03 /TR “C:\\Users\\%USERNAME%\\AppData\\\nRoaming\\Chrome\\Google\\Chrome.exe” /TN Chrome\n\n```\nCommunication runs every 10 minute\n```\nSCHTASKS /create /ST 00:00:01 /SC MINUTE /MO 10 /TR “C:\\Users\\%USERNAME% \\AppData\\\nRoaming\\Chrome\\Google\\GoogleUpdate.exe” /TN GoogleCrash\n\n```\n\n-----\n\nPersistence component runs every 30 minutes\n```\nSCHTASKS /create /ST 00:00:01 /SC MINUTE /MO 30 /TR “C:\\Users\\%USERNAME% \\AppData\\\nRoaming\\Gchrome\\GoogleCrash.exe” /TN Googleupdate32\n\n```\nThen executables are copied to:\n```\n%APPDATA%\\Chrome\\Google\\\n\n%APPDATA%\\Gchrome\\\n\n```\nFinally, a file is used to identify the victim. It is a text file; the MAC address and HOSTNAME are encrypted\nand then written to chrom.dll. The steps for encryption (see Figure 11) are:\n\n- Add padding if length < blocksize\n\n- Encrypt using AES with a hardcoded key\n\n- Prepend IV used to encrypt (first 16 bytes)\n\n- Encode in base64\n\nFigure 11 // Code to encrypt/decrypt config\n\n\n-----\n\n###### Chrome.exe: spy component\n\nThis component is responsible for recollection of data from the victim. Figure 12 contains the code\nfor the main() routine. It runs indefinitely, performing operations based on timers.\n\nFigure 12 // Main code of Chrome.exe\n\nStolen data are stored in different subfolders, depending on what data type it is (screenshots,\nlogs of keystrokes, etc.). Then the communication component takes the data and sends them to a remote\nserver. This folder structure will be described later.\n\nCollecting screenshots\n\nScreenshots are taken every five minutes, using ImageGrab from PIL [8] (Python Imaging Library).\nThe filename is encoded with ROT13 (only for lowercase letters) and then the image is encrypted and moved\nto the Winde folder. Here is the naming convention:\n\nDumped screenshot: ‘Cder-’ + strftime(‘%d-%m-%Y-%H-%M-%S’)\nExample: Cder-29-03-2019-10-30-00\n\nEncrypted file: ‘Cqre-’ + strftime(‘%d-%m-%Y-%H-%M-%S’) + ‘.wcrt’\nExample: Cqre-29-03-2019-10-30-00.wcrt\n\nThe encryption used is AES and the code was copied from this page: https://eli.thegreenplace.net/2010/06/25/\n_aes-encryption-of-files-in-python-with-pycrypto_\n\nThe key is hardcoded and has not changed in any of the binaries we have analyzed, except for those\nthat were released in mid-June 2019 (this will be discussed later). It is a 16-byte key, whereas the key used\nfor configurations is 32 bytes long.\n\nKeeping a list of modified files, by year of modification\n\nOne text file is created for every year, containing a listing of files that were last modified in that year.\nThis process runs every 60 seconds, checking for files on every fixed and removable drive (only when the list\ndoesn’t already exist for the current year). If the list was already created but there are newly modified files,\nthe communication component can delete listings to get newer files, as will be described later.\n\n\n-----\n\nFiles in system folders, or those with unwanted extensions, are ignored, as can be seen in Figure 13.\n\nFigure 13 // Code to create file listings\n\nApart from Microsoft Office documents and images, the list of extensions includes:\n\n- Backup files\n\n- Database files\n\n- Cryptographic keys (PGP)\n\n- OpenOffice documents\n\n- Vector images\n\n- Files for geographic information systems (topographic maps, navigation routes, etc.)\n\nIt’s interesting to note the exclusion of the folder Archivos de Programa, which is Program Files\nin Spanish. The resulting listings will be saved to the Loc folder.\n\nAccessing the clipboard\n\nAccess to the clipboard is achieved by creating a window and hooking its WM_DRAWCLIPBOARD, WM_\n```\nCHANGECBCHAIN and WM_DESTROY messages. The code was inspired by this: https://mail.python.org/pipermail/\n\n```\n_python-list/2006-October/399603.html_\n\nThe payload has been inserted into the OnDrawClipboard function, and is shown in Figure 14.\n\nFigure 14 // Code to access clipboard\n\n\n-----\n\nThe content of the clipboard, along with the window the operation came from, is saved in an HTML file\nnamed Hser, which will be stored under the same directory as screenshots. It is encrypted and copied\nthe same way, with some differences in the naming convention:\n\nLog file: `Hser`\nEncrypted file: strftime(‘%d-%m-%Y-%H-%M-%S-’) + ‘Hfre’ + ‘.ugz’\nExample: 29-03-2019-10-30-00-Hfre.ugz\n\nDetecting newly inserted removable drives\n\nThis is achieved by creating a top-level window. The code was copied from here: http://timgolden.me.uk/\n_python/win32_how_do_i/detect-device-insertion.html_\n\nCuriously, when the window is created, the name Device Change Demo is used, which hasn’t been\nmodified by the Machete developers. The payload is located in the onDeviceChange function.\n\nWhen a removable drive has been inserted, malware executables located in the Gchrome folder\n(of extension .scr) are copied to the root folder of the newly inserted drive. Then every file in that drive that\nmatches a desired extension is copied and encrypted to the Winde folder on the local drive. These extensions\nare shown in Figure 15.\n\nFigure 15 // File extensions to copy from removable drives\n\nNaming convention (this time ROT13 for both lowercase and uppercase):\n\nOriginal file: Example: Imagen.jpg\nEncrypted file: ‘HFO-’ + rot13(original_file).\nExample: HFO-Vzntra.wct\n\nNote that ‘HFO’ comes from rot13(‘USB’).\n\nPhysical exfiltration\n\nThis feature is related to the one that was described previously. When the insertion of a removable drive\nis detected, the existence of a specific filename is checked in the root of that drive. If found, then files from\nevery drive are copied (encrypted) onto the removable drive, in a hidden folder. That specific file is not\ncreated anywhere in the code of Machete and the filename may vary from one target to another. In other\nwords, this is a way to exfiltrate data in cases where the attacker has physical access to a computer that\nwas already compromised with Machete.\n\nA file usb.txt is created in the main directory where the malware is located. Only one line is written:\nthe drive letter where data was copied. Figure 16 lists the extensions sought and, if found, copied. Note that\nthe list differs to that of Figure 15: compressed files are ignored, as well as pdf files; now included are specific\nfiles that contain encrypted passwords.\n\n\n-----\n\nFigure 16 // File extensions for physical exfiltration\n\nRegarding encryption, it is the same AES routine used extensively in all of Machete’s components; naming\nconventions follow:\n\nOriginal file: Example: key3.db\nEncrypted file: strftime(‘%d-%m-%Y-%H-%M-%S-’) + rot13(original_file)\nExample: 29-03-2019-10-30-00-xrl3.qo\n\nKeylogging\n\nData is saved to the same Hser file used to store clipboard information. The code was copied from Hack\nForums: https://hackforums.net/showthread.php?tid=4186437\n\nFigure 17 // Code on Hack Forums\n\n\n-----\n\nOne thing that was adapted for Spanish language keyboards is the keyids variable, shown in Figure 18.\n\nFigure 18 // Keys in a Spanish distribution\n\nGetting Chrome and Firefox user profile data\n\nThis task is performed in just 4 lines of code by creating a compressed archive of the user’s data folder,\nboth for Chrome and Firefox. The resulting zipped files are stored in the Winde folder. Original files are\nlocated in the following folders:\n\nChrome: `%LOCALAPPDATA%\\Google\\Chrome\\User Data\\Default`\nFirefox: %APPDATA%\\Mozilla\\Firefox\\Profiles\n\nThe files created are FIREPERF.zip and CRHOMEPER.zip (there’s a typo for Chrome,\nbut it was never corrected).\n\nGeolocation of victims and Wi-Fi networks\n\nInformation about available Wi-Fi networks is collected by running the following Windows commands:\n\n```\nnetsh wlan show networks mode=bssid\nnetsh wlan show interfaces\n\n```\n\nThe output from these commands is parsed and a dictionary object is created containing information about\nthe Access Point’s MAC address and signal strength for every available Wi-Fi network. Here is an example:\n\n```\n{\n\n```\n'wifiAccessPoints' :\n```\n             [\n               {\n                 'macAddress' : 'e2:ee:51:6f:cf:26',\n                 'signalStrength' : '45'\n               },\n               {\n                 'macAddress' : '2b:9f:d6:77:4a:64',\n                 'signalStrength' : '70'\n               }\n             ]\n}\n\n```\n\nThis information is sent as a JSON object to the Mozilla Location Service’s API [9]. In short, this application\nprovides geolocation coordinates when it’s given other sources of data such as Bluetooth beacons,\ncell towers or Wi-Fi access points.\n\n\n-----\n\nThe Machete operators copied the code to do this from Python Wi-Fi Positioning System [10]. However,\nthat project uses Google’s Geolocation API, which requires a valid API key.\n\nRegistering an API key might be a hassle (it requires a credit card), but Mozilla’s API is the same as Google’s,\nwith the difference that it does not require a private API key. The string ‘test’ can be used as API key,\nwhich is exactly what Machete uses. They copied the code (and got the idea) from this blog:\n_https://zuidt.nl/blog/html/2014/07/04/tinkering_with_mozilla_location_services.html_\n\nMozilla’s API returns geolocation information from where latitude and longitude coordinates are taken\nto build a Google Maps URL. An extract of this part of the code in Machete can be seen in Figure 19.\n\nFigure 19 // Code for geolocation\n\nThe advantage of using Mozilla Location Service is that it permits geolocation without an actual GPS\nand can be more accurate than other methods. For example, an IP address can be used to obtain an approxi­\nmate location, but it is not so accurate. On the other hand, if there is available data for the area, Mozilla\nLocation Service can provide information such as in which building the target is located.\n\nThe URL and full output from netsh commands are written in the Winde folder to a text file with a name\ngenerated as follows:\n\nFilename: ‘GEO-’ + strftime(‘%d-%m-%Y-%H-%M-%S-’) + ‘.txt’\nExample: `GEO-12-04-2019-14-02-58.txt`\n\n###### GoogleUpdate.exe: communication module\n\nThis component is responsible for communicating with the remote server. The configuration to set the\nconnection is read from the jer.dll file: domain name, username and password. The principal means of\ncommunication for Machete is via FTP, although HTTP communication was implemented as a fallback in 2019.\n\nAnother line read from the configuration is a folder name on the server that identifies the campaign.\nVictim info is retrieved from the chrom.dll file and a folder on the server is created as\n_/[folder_name]/MACaddr-HOSTNAME._\n\nDecryption is the inverse process to the one described for encryption of data in chrom.dll file\n(see section GoogleCrash.exe: scheduling and persistence).\n\nThen, the main functionality of this component is to upload encrypted files located in the Winde folder\nto different subdirectories on the C&C server. Figure 20 shows how the folder is processed to upload documents.\n\n\n-----\n\nFigure 20 // Code to upload files in Winde\n\nFile listings\n\nThe listing of files generated by the Chrome.exe component (stored in the Loc folder) is read and those\nfiles are encrypted (temporarily to the Winde folder) and uploaded to the C&C server. All of this is done\nby this component and not the spy component, although that would make more sense.\n\nEncryption is the usual AES routine and for naming, only ROT13 on the filename is performed.\nOnce a file is uploaded, it is deleted from the Winde folder, as well as the corresponding line in the list of files.\n\nReceiving updates\n\nNot only is confidential information exfiltrated to the server, but Machete operators can, by leaving specific\nfiles on the server, update configurations, malware files, listings of files, or execute other binaries. Therefore,\nthey can customize the malware behavior if they want to retrieve more specific data.\n\nIf a file jer.dll exists on the server when GoogleUpdate.exe runs, then the local config file jer.dll\ngets overwritten by this file. After being used, it gets deleted from the server. The code is shown in Figure 21.\n\nFigure 21 // Code to download a new configuration\n\nIf a file bers.dll exists, then it replaces the list of files for current year, located in the Loc folder.\nThis way, the Machete operators can retrieve specific files from a compromised system.\n\nFigure 22 // Code to update file listings\n\n\n-----\n\nThere can also be executable files on the server. They will be copied to the %APPDATA% folder\non the compromised computer and will be executed from there, as seen in Figure 23.\n\nFigure 23 // Code to download and execute other binaries\n\nFinally, there can be .scr executables with updated components (.asae extension on the server),\nwhich will be copied to the Ansrome folder on a compromised PC. However, they are not executed.\n\nIf a file bsera.txt is in the same folder as the executables, the GoogleUpdate.exe component\nwill proceed to delete all files from the Ansrome folder.\n\nFTP folders\n\nFor every victim there will be folders on the FTP server, which are shown in Figure 24.\n\nFigure 24 // Folders on the FTP server\n\nHere’s a summary:\n\n- `Dfse: stores .htm files with clipboard data and keylogs`\n\n- `Dbse: stores screenshots`\n\n- `Dqwo: stores encrypted documents from local and removable drives`\n\n- `Dvas: folder where operators can leave files to change configuration`\n\n- `Doer: folder where operators can leave updated Machete executables`\n\n- `Djuy: stores file listings (not encrypted)`\n\n- `Dbow: stores zipped files with profile data from installed web browsers. Files are not encrypted`\n\nor encoded and they can be quite large (300 MB for example)\n\n- `Dwis: stores .txt files (not encrypted) with wireless adapters, visible wireless networks and geolocation`\n\nHTTP communication\n\nSince May 16th, 2019, new Machete binaries have emerged. After we had domain names related\nto the FTP server taken down, Machete’s operators had to come up with a new plan to make the malware\nmore reliable and maintain control of their victims.\n\n\n-----\n\nInformation is still being sent to an FTP server but, if for some reason the connection fails, then the informa­\ntion is sent over HTTP. The HTTP server is the same as the FTP server (same IP address), but the domain\nname used is different (more details in the section Domain names below).\n\nFor HTTP communication, proxy settings are retrieved and files in the Winde folder are sent if they\nare no bigger than 8 MB. If more than 5 files could not be successfully sent without errors, then the transfer\nis stopped. Both size and error-checking are new features first seen in May 2019.\n\nDocuments are sent by calling urlopen() [11] with the following parameters in the query string of the URL:\n\n- namepc: MAC address and hostname of the victim.\n\n- nadir: folder name on the server that identifies the campaign.\n\n- menrut0: type of file. It is one of “PXDfse”, “PXDbse”, “PXDwis”, “PXDbow” or “PXDqwo”.\n\n- menfile0: filename (which has already been transformed by applying ROT13, depending on the type of file).\n\n- mens0: contents of the file (base64 data, as encryption was dropped for this version).\n\nFor file listings in the Loc folder, documents are encoded in base64 and sent in the same manner.\n\nIf five or more files generated errors when sending, then an alternative transfer method is executed.\nFirst, processes running on the system are inspected, looking for web browsers: Firefox, Chrome, Internet\nExplorer, Microsoft Edge and Opera. If any of those is running, then only five files under 1 MB will be sent.\nFiles bigger than 1 MB will be deleted from the Winde folder.\n\nThe information will be sent as a query string with the same parameters described above, but once\nfor all five documents. As can be seen in Figure 25, now there will be parameters menrut0, menrut1, etc.\n\nFigure 25 // Code for HTTP exfiltration\n\nThen a file google.html is written to disk and opened with the default web browser (which the Machete\noperators must have assumed would be open if a process for a web browser was found to be running).\nThis will cause information to be sent to the C&C server via a http POST request.\n\n\n-----\n\n###### New components\n\nIn June 2019 Machete started being delivered with several changes to its structure, while keeping essentially\nthe same functionalities. Curiously enough, Machete seems to have been rewritten to use different libraries\nsince this update, perhaps with the intent to evade detection.\n\nThis version’s malicious tasks are divided into six components, which are no longer py2exe executables.\nPython scripts for malicious components, an original executable for Python 2.7, and all libraries used are\npacked into a self-extracting file called python27.exe. This binary is distributed along with a decoy docu­\nment, as we’ve seen before. Figure 26 shows the configuration for self-extraction of the payload.\n\nFigure 26 // Configuration for self-extraction of python27.exe\n\nA folder C:\\Python2.7 is created, holding malicious scripts and Python libraries in the DLLs subdirectory.\nThe first component to be executed is _hashlbi.pyw, which is similar to GoogleCrash.exe, but with\ndifferent code.\n\nBefore describing the components, it is worth mentioning that a component may perform tasks\nthat are unrelated. This means that, in the future, Machete operators could swap parts of code between\ncomponents, rename them, etc. trying to avoid detections.\n\n_hashlbi.pyw: persistence\n\nThis component sets up malware folders and schedules tasks to run the other components. Folders\nand files are created under C:\\Python2.7 with the same name as the ones in a common Python\ninstallation. They are bogus and have no contents.\n\nThe following Windows Task Scheduler tasks are created. Note that there isn’t a task\nfor this component itself.\n\n\nTable 1 _Tasks scheduled for the execution of components_\n\n\nTask names Component run Frequency\n\nGoogleExplorer, AdobcUpdate, SystemUpolate\n_clypes.pyw at 9 am, 1 pm, 6 pm, 9 pm\nand InstallationUpdates\n\nInternetExplorer _bsdbd.pyw every 5 minutes\n\nchromeUpdate _elementree.pyw every 15 minutes\n\nWindowsUpdate _mssi.pyw every 15 minutes\n\nOneDriveUpdate _multiproccessing.pyw every 10 minutes\n\nThis component also copies Microsoft Office files, .pdf, .jpg/.jpeg and .rar/.zip files from every drive\nto %LOCALAPPDATA%\\Microsoft\\Dropbox\\Crashpad and creates directories with names based\non the SHA-256 hash of those files, in C:\\Python2.7\\DLLs\\hhd. Part of the code is shown in Figure 27.\n\n\n-----\n\nFigure 27 // Code for copying files\n\nThe hash is calculated using 3 MB chunks and its only purpose is keeping track of what files have already\nbeen copied.\n\n_clypes.pyw: browser data\n\nThis component checks running processes (every three or four hours) looking for web browsers. It makes\na .zip file with profile data from each of these browsers if they are not currently running: Chrome, Firefox,\nOpera and Internet Explorer. Filenames are different for every browser – see Figure 28 for details – but they\nall include the UTC time instead of local time, which is new for Machete. These files are saved\nin %LOCALAPPDATA%\\Microsoft\\Dropbox\\avatar_cache\\.\n\nFigure 28 // Archive names for different browsers\n\nIt also has the same code as the other component to copy files and generate folders with hashes.\n\n_bsdbd.pyw: screenshots, clipboard, removable drives\n\nTo perform its tasks this component uses different libraries than the ones we described before.\nTo access the clipboard the ctypes library is used and the contents are saved to a file wwancgf_.html\nin the avatar_cache folder.\n\n\n-----\n\nFigure 29 // Code to obtain clipboard data\n\nScreenshots are also saved in this folder. They are taken with shot() function from mss library [12].\n\nDumped screenshot: ‘shopt-’ + utcnow().strftime(‘%Y-%m-%d-%H_%M_%S.%f’) + ‘.png’\nExample: shopt-2019-06-20-22_37_16.176.png\n\nThe code for copying files and hashing is again present, but this time it has been modified to copy only files\nfrom removable devices. Copied files will have ‘usb-’ prepended. Part of the code has been taken again from\nTim Golden’s site: http://timgolden.me.uk/python/win32_how_do_i/find-drive-types.html\n\n_elementree.pyw: geolocation and updates from the server\n\nThis component performs geolocation with code similar to that described previously but with some\nadded information.\n\nA file gt.txt is created in the avatar_cache folder; a Google Maps URL with the location of the victimized\ncomputer and the output of the systeminfo Windows command are appended. The inclusion of that\ncommand is a new feature and it shows installed security patches, among other information.\n\nAnother file is created as utc_time + ‘-gtn.txt’. It contains the same information as the other file, but adds\nall nearby wireless networks and information about the WLAN to which the computer is connected\n(including the passphrase to connect). Part of the code is shown in Figure 30.\n\nFigure 30 // Code to obtain information about wireless networks\n\n\n-----\n\nThe second part of this component extracts the C&C server from the file C:\\Python2.7\\DLLs\\date.dll\n(configuration file, base64-encoded) and downloads and executes binaries or scripts from there.\n\nFigure 31 // Downloads from C&C server\n\nThe code in Figure 31 shows that a .exe or .vbe file will be downloaded (from the PSLte or PSLtv folders\nrespectively) and executed (not shown in the snippet) if the operators have placed some files there for that\nspecific target. There is also code to download a new configuration file and replace the one in use: a file\n```\ndate.html is retrieved from the PSLte directory on the server. A folder QuitReports is used to store\n\n```\ndownloaded files on the victimized computer.\n\n_mssi.pyw: keylogging\n\nThe code is the same as before, but everything is saved to the file vpr.html in the avatar_cache folder.\n\n_multiproccessing.pyw: communication\n\nTwo C&C servers are read from the date.dll configuration file: one will be the primary server and the\nother one the fallback server. Every victimized computer will have a folder on the server with the following\nformat: folder_campaign/MACaddr-HOSTNAME. As of this writing, we have seen ‘02’, ‘03’ and ‘04’ for\n_folder_campaign._\n\nFiles to be exfiltrated are moved to other folders on a compromised computer before being encrypted\nand sent to the server. All documents, which were stored in the Crashpad folder, are moved to the\n```\nCrashReports folder. Logs, screenshots and browser data are moved from avatar_cache to the events\n\n```\nfolder. If there are any files larger than 120 MB, they are deleted.\n\nNot every document is sent to the server. The latest code of Machete does not keep listings with modified\nfiles. Instead, as seen in the code snippet in Figure 32, the date of modification is retrieved and only\nthe 20 newest documents are copied from CrashReports to the events folder to be exfiltrated.\n\n\n-----\n\nFigure 32 // Code to move newest files\n\nEncryption is AES and a 64-byte key is used: a SHA-256 digest of a 40-byte string. Part of this code is shown\nin Figure 33. After that, files are base64 encoded and ROT13 is applied to the filenames.\n\nFigure 33 // Part of encryption code\n\nBefore they are actually sent, files are copied one last time, from events to the instance_db folder.\nThen, files are sent over HTTP via a POST request, similar to what was described in the HTTP communication\nsection. The folder names have changed, as shown in Figure 34.\n\n\n-----\n\nFigure 34 // Code for sending files to the C&C server\n\nIf for some reason the server could not be contacted, then the fallback server is used to exfiltrate\ndocuments in the same manner. If after this there are still files in the folder that could not be sent, a file\nhandle to the binary stream is passed in the POST request instead of the contents of the file itself. This\nis done for both the main and fallback servers, meaning that these files will be mirrored on both servers.\n\n##### 6.4 Domain names\n\nInitially, we saw three domain names being used in Machete’s configuration files. They all pointed to the\nsame IP address during 2019, but a passive DNS query showed two other IP addresses active during 2018.\nTable 2 shows information about these domain names.\n\n\nTable 2 _Domain names and related IP addresses_\n\n\nDate first seen Date last seen Domain name IP address\n\n2019 05 13 2019 05 13 mcsi.gotdns[.]ch 0.0.0[.]0\n\n2018 10 01 2019 04 25 mcsi.gotdns[.]ch 142.44.236[.]215\n\n2018 08 20 2018 12 16 mcsi.gotdns[.]ch 199.79.63[.]188\n\n2018 09 20 2018 09 20 mcsi.gotdns[.]ch 109.61.164[.]33\n\n2018 07 15 2018 07 15 djcaps.gotdns[.]ch 199.79.63[.]188\n\n2018 08 15 2018 08 20 tokeiss.ddns[.]net 109.61.164[.]33\n\n\n-----\n\nThose three subdomains were reported to the dynamic DNS service No-IP (which provisions the second-level\ndomains) and they have pointed to 0.0.0.0 since May 5th, 2019. Some days later in May, the operation was\nmoved to an FTP server on a different IP address (158.69.9[.]209), and a new No-IP subdomain was found\nin configuration files, adtiomtardecessd.zapto[.]org. To prevent losing their victims if that domain name is taken\ndown, Machete operators developed new code to send stolen data over HTTP, with a domain name specific\nto that purpose. That domain, artyomt[.]com, was registered on May 10th, 2019 but there is not much more\ninformation available, so it’s less likely to be taken down.\n\nAs was mentioned before, Machete operators stopped using downloaders since their update in May 2019.\nPhishing emails would contain a link to download a zipped file from lawyersofficial.mipropia[.]com\n(free hosting). Some files and their timestamps can be seen in Figure 35.\n\nFigure 35 // Files spread in phishing emails\n\nIn June 2019 Machete operators stopped using FTP communication and started to use HTTP for both the\nmain and fallback C&C servers. The domain name tobabean[.]expert points to the IP address 142.44.236[.]215,\nwhich has been used before by Machete. The other server is u929489355.hostingerapp[.]com and the related\nIP address is 156.67.222[.]88 at the time of this writing.\n\n#### 7. CONCLUSION\n\nLatin America is usually overlooked when it comes to persistent threats and groups targeting the region.\nThere have been, however, several attacks resonating in the news in the past few years, such as those\ntargeting banks in Mexico [13] and Chile [14]. The group behind Machete has managed to continue operating\neven after researchers have published technical descriptions and indicators of compromise for this malware.\nBy introducing small changes to their code and infrastructure, the group has bypassed several security\nproducts. It is the targeted organizations, though, who have failed in raising awareness and applying\nsecurity policies so that employees don’t fall for these attacks in the first place.\n\n\n-----\n\n#### 8. REFERENCES\n\n1 GReAT, “El Machete”, Kaspersky Labs, 20 August 2014. [Online]. Available:\n_https://securelist.com/el-machete/66108/_\n\n2 The Cylance Threat Research Team, “El Machete’s Malware Attacks Cut Through LATAM”, Cylance, 22 March\n2017. [Online]. Available:\n_https://threatvector.cylance.com/en_us/home/el-machete-malware-attacks-cut-through-latam.html_\n\n3 py2exe: http://www.py2exe.org/\n\n4 7z SFX Builder: https://sourceforge.net/projects/s-zipsfxbuilder/\n\n5 pyminifier: https://github.com/liftoff/pyminifier\n\n6 pyobfuscate: https://github.com/astrand/pyobfuscate\n\n7 NXcrypt: https://github.com/Hadi999/NXcrypt\n\n8 ImageGrab module: https://pillow.readthedocs.io/en/3.0.x/reference/ImageGrab.html\n\n9 Mozilla Location Service: https://location.services.mozilla.com/\n\n10 Python Wi-Fi Positioning System: https://github.com/deviance/Python-Wi-Fi-Positioning-System\n\n11 urlopen() function from urllib2: https://docs.python.org/2/library/urllib2.html#urllib2.urlopen\n\n12 Python MSS: https://python-mss.readthedocs.io/\n\n13 Lily Haw Newman, “How Hackers Pulled Off a $20 Million Mexican Bank Heist”, Wired, 15 March 2019.\n\n[Online]. Available: https://www.wired.com/story/mexico-bank-hack/\n\n14 Jeremy Kirk, “Banco de Chile Loses $10 Million in SWIFT-Related Attack”, BankInfoSecurity, 13 June 2018.\n\n[Online]. Available:\n_https://www.bankinfosecurity.com/banco-de-chile-loses-10-million-in-swift-related-attack-a-11075_\n\n\n-----\n\n#### 9. IOCS\n\n###### GoogleUpdate.exe\n\nSHA-1 ESET Detection Name\n\n048C40EB606DA3DEF08C9F6997C1948AFBBC959B Python/Machete.F\n\n2E8D8508096CAA38493414F6BA788D0041EA9E15 Python/Machete.F\n\n85BDD7D871108C737701AC30C14A2D343CBDEF94 Python/Machete.D\n\n8ED8CB784512F7DADD147347FC94E945FAF16338 Python/Machete.F\n\n9C413075AAB7EF7876B8DC8D7B7C1B9B96842C6E Python/Machete.A\n\nAB8DD6B0CC950618589603012863B57F7ADB9D9B Python/Machete.A\n\n###### Chrome.exe\n\nDetected by ESET as Python/Machete.B\n\nSHA-1\n\n318496B58CF5052EFD49A95C721D9165278E9FCE\n\n3BB345032B6D0226D6771BA65FE4DA0FAF628631\n\n946A24DFBD0AE94209EF7C284D3F462548566A3C\n\n984B9202A6DBD7D3DD696CAE1220338A68092DC9\n\nEABD45D0A86113F5CCFF9FD292C1E482A5727815\n\nF05BC018C90B560DC4932758956ADFFBC10588CE\n\n###### GoogleCrash.exe\n\nSHA-1 ESET Detection Name\n\n204A2850548E5994D4696E9002F90DFCCBE2093A Python/Machete.C\n\n3792588EDC809270E6666A4677EC85A3400BA4CF Python/Machete.E\n\n4899A2C2CECEB92D2CC4ED17D092D1D599379284 Python/Machete.A\n\nA42756280AA352F4612BED85AABF7F3267E676C2 Python/Machete.E\n\nA97CF05AD7F3102BDE45E4B4947ED435EFEA1968 Python/Machete.E\n\n###### RAR/7z SFX: config + payload\n\nSHA-1 Filename Observations\n\n00397DA69B8E748720AEDFD80D78166573C33EC8 ders.exe\n\n03929A5530639C1D9DBD395A298C59FD7EFF1DEC chrome.sfx.exe\n\n0922DEFB82FF1140BBE3481BAB27564BB966D50B ChrOme_UpdAte.sfx.exe\n\n0AC64E08E63601AD9D6A4EF019E5B374784AF80A chrome.sfx.exe\n\n0BA5BCE133B50EF80FD9241C3EA5CB9135CA4EB1 ders.exe\n\n161629F63422AB34108854662313F87A278DD7F5 chrome.sfx.exe\n\n24752DAB28C3ADD4C31591F2EC480CE3CA83E0AA python27.exe\n\n341F2EFA0FD11B4480D8503BFB81C62AF667D72D chrome_Up.sfx.exe\n\n4C130AA110B290A0CF4FF1C099EA2A705081A9CB Chrome_Update.sfx.exe\n\n\n-----\n\n50C23690C23EE070AD3A20FCED7311BFDF098833 ders.exe\n\n67ECBC1E9A66719C599E6DDED33A85F70DACA13E chrome.sfx.exe\n\n6A69A2A2D4A2F8690B71386F0F092B04EA5A647D ders.exe\n\n92C56AF6815597C0135C21EF5A35D41B0E2A460F Python_27.exe\n\npayload pushed by\n9E52E1C015B97D4FB2CAC888F8FC69D729AF78F5 finaser.aes\noperators (no config file)\n\nA48A71B9D1C00A683397F97C02E0DBB3F4606863 ders.exe\n\nB6E436A0FFF117A1C3D3D70947F62D4CAC66C95E ders.exe\n\nC4ACCF6071F51ADE102190C6FA350435FC202654 Python.27.exe\n\nD5238CDE036EEFCC6D8D686B3A00247F27DA894C Python.27.exe\n\nDDA105D8D894F73B16518D546270E4F783CB5178 python27.exe\n\nE85C1EF38C39B6087EA9AC8171DDD1416B9A5306 python27.exe\n\nFD52B10E9D4E5D343E589627444A6766357D5E47 Security.exe\n\n###### 7z SFX: decoy + downloader\n\nSHA-1 Filename\n\n52B680F472AE463436979DA325DB7AD64D5AF1EF Mapa_monitoreo_WRF_ind02052018.scr\n\n69109287D41C002FA70BB3D6238C4056B2B24B2F Mapa_monitoreo_WRF_ind02052018.scr\n\n89C0FDEED36A69099E935A590A103339B0CBE525 Mapa_monitoreo_WRF_ind02052018.scr\n\n9EA7832D83C74C839A49580B4211E627A24571BE Programa Formacion en Contratacion Publica.scr\n\nBFD0CBEF5B9C329792B38274474F04BD8109DF66 RGMA0_1_629.scr\n\nFB871AACA0DDCF2F009A2D11ECF672CFB61B7357 CALENDARIO_ACTIVIDADES_COLCO_EC.scr\n\nFDE89FCEC30FCAABB3D42ED87180843F3E760CD8 Mapa_monitoreo_WRF_ind02052018.scr\n\n###### RAR SFX: URL config + downloader\n\nSHA-1 FIlename\n\n9912BDBE08179122DC3797A2585D463573D1B5A5 04Down.exe\n\nAB16808B5B4706B6265C5FF5FEF8B8460C8A51F8 4Down.sfx.exe\n\nBDAAB0B356EC9FE61FEE1723E1DD52E39DDC6699 04Down.exe\n\nDED6509458DF62D3CE60C68F3A2A87E59F1F96BE Down.sfx.exe\n\n###### Downloader\n\nDetected by ESET as Python/Machete.A\n\nSHA-1 FIlename\n\n2B7404F6B0075BC1192D61D4AF135D521D5F08A3 RdrCEF.exe\n\n53102E57B40FEACB64566C26D101D9242DECE77C Down.exe\n\n56E8743E0773286A4B9E055147D96D53A43BECA1 Down.exe\n\n71F69F04307C8F5675DCADEAA80B8C2B95691B01 Down.exe\n\n904137B61F1DED66C8CA76EBF198DEC1B638B5D4 Down.exe\n\nFBB485B40477F5A014E7096747B1B4A494CE50EF Down.exe\n\n\n-----\n\n###### RAR/7z SFX: decoy + payload (no downloader)\n\nSHA-1 FIlename\n\nFORMATO UNICO DE RENDIMIENTO OPERATIVO GNB\n0468D3776435E527DBA52B9DA61D38C076DDA09A\n11JUNIO2019 CZGNB-13 xlsx.scr\n\n10EB152039CB0A379DAAB272151BC1BAA8C6D4DB Radiograma 004026_pdf.scr\n\n173664DE0A9A08218098ABFB86D2C64F25B5EE37 Diseño_pptx.scr\n\n212F3697117D17EC3F299D037845CF3DB20CE88A\n\n29EA8A983E56229AC69FFF9958319B66C006020B RDGMA 1101 001 jpg.scr\n\n3562CB8D37E68025787C31A0B4654A1CE209E62F 20190611101428 pdf.scr\n\n35E4ECB61F1FA09BEC8A4528C592D982D33B6C6B INVITADOS_MEXICANOS.scr\n\n442E6CC28D118CFAF1A5482E2000C7DC00D9A7B9\n\n5C56AC14CA7159804A9D53FE037CFD0D99D45AB1 JUNIO_19_PROPUESTA_CLARO_RENOVACION.scr\n\n61DE62436B3806A3A645C96677D7AD9D802E30A8 FORMATO DE NOVEDADES PARA DC PERSONAL xls.scr\n\n62800D245A3726CA390D08B7BF17FE2C37F2B3CF 20190611101331.scr\n\n64F1322BF2A898278AA1E73803FDD500B6E5E7C7 RAD_N_0961_21MAY19.scr\n\n79AC512389EF9E27A3598CA2968573DB4F5FD58F RAD OFL0120_jpg.scr\n\nS_E_ARLETTE_MARENCO_NOTA_INFORMANDO_TER­\n7A1AD75A1AA73EC72EE21B213FCCA55D57A0CD58\nMINO_DE_MISION_001.scr\n\n8E0AC29B8BD0C086B20C23B254CF047AA30A0529 07_1379.scr\n\n91F2C7EED2EE92D11BC6B8FD8D3CBA0B02C8D074 Blason.scr\n\n97EDCDFD6E674591C1E809381C7E68F11DFA81FC 08_1159.scr\n\n9D65B55168526161A79F4743A37B1A7358C67037 INSTRUCCIONES DEL JSO 08JUN19 docx.scr\n\nA19648A5576E0B9FC449D89ADDC569BA1350ECFF\n\nA94916F9696D861FE040891634B3F2DA09557F13 REPORTE OPERACIONAL 10JUN19 pdf.scr\n\nB451F623FE9F315EB886B83F27139FC236A07EC9 20190611101428.scr\n\nC39B9D966AED0372619B3989995AB9AD12F94D38 NOTA_CICR_00079.scr\n\nCF10E0313177FF4C9C588232218078EB870C0079 BOLETA DE PERMISO NELSON GUERERE docx.scr\n\nE8BBCB0F6538D1543BFA3F7A66F20155EBC2BCC8 JUNIO_27_PROPUESTA_CLARO_RENOVACION.scr\n\nEA3D823DF9F0E41AD1DA2FD3492B418693BED8BD 20190611101331 pdf.scr\n\nEB82401CE6B2497AEB1FC666697D7D9CE66E4D5B Asimilacion.scr\n\n###### _hashlbi.pyw\n\nSHA-1 ESET Detection Name\n\n1B3723651E1D321D4F34F2A243D7751D17288257 Python/Machete.G\n\n7FFB9C7DA20C536B694E78538B65726EACB1B055 Python/Machete.G\n\nB1ADF4B46350FB801CE54DA9C93A4EF79674F3F5 Python/Machete.G\n\n###### _bsdbd.pyw\n\nSHA-1 ESET Detection Name\n\n0C33B75F6C4FC0413ABDBCDA1C5E18C907F13DC3 Python/Machete.G\n\n314D9B4C25DD69453D86E4C7062DCE6DEDDA0533 Python/Machete.G\n\nD4CF22F3DB78BDC1CEB55431857D88166CE677D4 Python/Machete.G\n\n\n-----\n\n###### _clypes.pyw\n\nSHA-1 ESET Detection Name\n\n26FB301AF7393B5E564B8C802F5795EDEBD7CECF Python/Machete.G\n\n979859B5A177650EF0549C81FD66D36E9DEA8078 Python/Machete.G\n\nA07E38DF9887EA7811369CD72C57FD6D44523CD6 Python/Machete.G\n\n###### _elementree.pyw\n\nSHA-1 ESET Detection Name\n\n07E383E9FF04F587769845306DC4BFE75630BAAA Python/Machete.G\n\n3B6F5CB20FF3AC0EE3813A68A937AAE92EBC46D3 Python/Machete.G\n\n56765B7511372A8E9BE017F48A764D141F485474 Python/Machete.G\n\nCF2DC40926D8747AEC572DFD711BBFD766AADB10 Python/Machete.G\n\n###### _mssi.pyw\n\nSHA-1 ESET Detection Name\n\n6B42091CA2F89A59F4E27E30ACDACF32EB83F824 Python/Machete.G\n\n708F159F2CFE22FF0C4464F2FEDAA0501868BDD8 Python/Machete.G\n\nDE639618B550DBE9071E999AAA5B4FC81F63A5A6 Python/Machete.G\n\n###### _multiproccessing.pyw\n\nSHA-1 ESET Detection Name\n\n0B6F61AF3E2C6551F15E0F888177EEC91F20BA99 Python/Machete.G\n\n76AABC0AF5D487A80BCBA19555191B46766139FA Python/Machete.G\n\n7FF87649CA1D9178A02CD9942856D1B590652C6E Python/Machete.G\n\n8692EB1E620F2BCDDAF28F0CB726CEC2AA1C230D Python/Machete.G\n\n8AF19AA3F18CB35F12EE3966931E11799C3AC5A4 Python/Machete.G\n\nE1BC4EC7F82FA06924DC4B43FBBB485D8C86D9CD Python/Machete.G\n\nServer domain names\n\n- tobabean[.]expert\n\n- koliast[.]com\n\n- u929489355.hostingerapp[.]com\n\n- u154611594.hostingerapp[.]com\n\n- 6e24a5fb.ngrok[.]io\n\n- f9527d03.ngrok[.]io\n\n- adtiomtardecessd.zapto[.]org\n\n- mcsi.gotdns[.]ch\n\n- djcaps.gotdns[.]ch\n\n- tokeiss.ddns[.]net\n\n- artyomt[.]com\n\n- lawyersofficial.mipropia[.]com\n\n- ceofanb18.mipropia[.]com\n\n\n-----\n\nServer IPs\n\n- 185.224.137[.]63\n\n- 156.67.222[.]88\n\n- 158.69.9[.]209\n\n- 142.44.236[.]215\n\n- 199.79.63[.]188\n\n- 109.61.164[.]33\n\n###### MITRE ATT&CK techniques\n\nTactic ID Name Description\n\n\nInitial Access\n\nExecution\n\nPersistence\n\nDefense Evasion\n\nCredential\nAccess\n\nDiscovery\n\n\nEmails contain a link to download a compressed\n_T1192_ Spearphishing Link\nfile from an external server.\n\nSpearphishing\n_T1193_ Emails contain a zipped file with malicious contents.\nAttachment\n\nTries to get users to open links or attachments\n_T1204_ User Execution\nthat will execute the first component of Machete.\n\nOther components of Machete are executed\n_T1053_ Scheduled Task\nby Windows Task Scheduler.\n\nHidden Files and\n_T1158_ Malware files and folders are hidden for persistence.\nDirectories\n\nAll of the components are scheduled to ensure\n_T1053_ Scheduled Task\npersistence.\n\nObfuscated Files or\n_T1027_ Python scripts are obfuscated.\nInformation\n\nMachete payload is delivered as self-extracting files.\n_T1045_ Software Packing\nMachete downloaders are UPX packed.\n\nFile and task names try to impersonate Google Chrome,\n_T1036_ Masquerading\nJava, Dropbox, Adobe Reader and Python executables.\n\nA compromised system is scanned looking for key\n_T1145_ Private Keys\nand certificate file extensions.\n\nMachete exfiltrates files with stored credentials\n_T1081_ Credentials in Files\nfor several browsers.\n\nSystem Network\n_T1049_ `Netsh command is used to list all nearby Wi-Fi networks.`\nConnections Discovery\n\n\nFile and Directory\n_T1083_ File listings are produced for files to be exfiltrated.\nDiscovery\n\nIn the latest version, running processes are enumerated\n_T1057_ Process Discovery\nsearching for browsers.\n\n\nPeripheral Device\n_T1120_\nDiscovery\n\n\nNewly inserted devices are detected by listening\nfor the WM_DEVICECHANGE window message.\n\n\nBrowser Bookmark\n_T1217_\nDiscovery\n\nApplication Window\n_T1010_\nDiscovery\n\n\nBrowser data such as bookmarks is gathered\nfor several browsers.\n\nWindow names are reported along with keylogger\ninformation.\n\n\n-----\n\nCollection\n\nCommand and\nControl\n\nExfiltration\n\n\nClipboard data is stolen by creating an overlapped\n_T1115_ Clipboard Data\nwindow that will listen to keyboard events.\n\n_T1005_ Data from Local System File system is searched for files of interest.\n\nData from Removable\n_T1025_ Files are copied from newly inserted drives.\nMedia\n\n_T1056_ Input Capture Machete logs keystrokes from the victim’s machine.\n\n_T1113_ Screen Capture Machete captures screenshots.\n\n_T1074_ Data Staged Files and logs are stored in a temporary folder, encrypted.\n\nStandard FTP and HTTP ports are used\n_T1043_ Commonly Used Port\nfor communications.\n\nMachete uses HTTP to exfiltrate documents if FTP\n_T1008_ Fallback Channels\nis unavailable.\n\nMachete can download additional files for execution\n_T1105_ Remote File Copy\non the victim’s machine.\n\nStandard Application\n_T1071_ FTP and HTTP are used for Command & Control.\nLayer Protocol\n\nAll collected files are exfiltrated automatically\n_T1020_ Automated Exfiltration\nto remote servers.\n\nMachete compresses browser’s profile data as .zip files\n_T1002_ Data Compressed\nprior to exfiltrating it.\n\n\n_T1022_ Data Encrypted\n\n\n_T1041_\n\n\nExfiltration Over\nCommand and Control\nChannel\n\n\nExfiltration Over Physical\n_T1052_\nMedium\n\n\nCollected data is encrypted with AES before transmitting\nit. In some versions of the malware, it is encoded\nwith base64 (but not encrypted).\n\nData is exfiltrated over the same channel used for C&C.\n\nData from all drives in a compromised system is copied\nto a removable drive if there is a special file in that drive.\n\n\n_T1029_ Scheduled Transfer Data is sent to the C&C server every 10 minutes.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "99fdc3ef-333d-48f5-a4a1-becd788c7b80",
            "created_at": "2022-10-25T15:28:29.802983Z",
            "updated_at": "2022-10-25T15:28:29.802983Z",
            "deleted_at": null,
            "name": "MITRE",
            "url": "https://github.com/mitre-attack/attack-stix-data",
            "description": "MITRE ATT&CK STIX Data",
            "reports": null
        },
        {
            "id": "6fc23d14-23a6-4870-8fad-b291b182596f",
            "created_at": "2022-10-25T16:07:18.480113Z",
            "updated_at": "2022-10-25T16:07:18.480113Z",
            "deleted_at": null,
            "name": "ETDA",
            "url": "https://apt.etda.or.th",
            "description": "Threat Group Cards: A Threat Actor Encyclopedia",
            "reports": null
        }
    ],
    "references": [
        "https://www.welivesecurity.com/wp-content/uploads/2019/08/ESET_Machete.pdf"
    ],
    "report_names": [
        "ESET_Machete.pdf"
    ],
    "threat_actors": [
        {
            "id": "d303c77e-0110-471b-a3a6-37fce9ac848d",
            "created_at": "2022-10-25T15:50:23.342452Z",
            "updated_at": "2025-03-27T02:00:55.447692Z",
            "deleted_at": null,
            "main_name": "Machete",
            "aliases": [
                "APT-C-43",
                "El Machete"
            ],
            "source_name": "MITRE:Machete",
            "tools": null,
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "edc11896-f4f1-4132-9c38-d073ccdcf5b6",
            "created_at": "2022-10-25T16:07:23.576476Z",
            "updated_at": "2025-03-27T02:02:09.873658Z",
            "deleted_at": null,
            "main_name": "El Machete",
            "aliases": [
                "APT-C-43",
                "ATK 97",
                "Operation HpReact",
                "TAG-NS1",
                "TEMP.Andromeda"
            ],
            "source_name": "ETDA:El Machete",
            "tools": [
                "El Machete",
                "ForeIT",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Loki",
                "Loki.Rat",
                "LokiBot",
                "LokiPWS",
                "Pyark"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "ba4f277c-c3da-45e6-a2fb-4ed556dbae64",
            "created_at": "2023-01-06T13:46:38.605117Z",
            "updated_at": "2025-03-27T02:00:02.871423Z",
            "deleted_at": null,
            "main_name": "El Machete",
            "aliases": [
                "APT-C-43",
                "G0095",
                "machete-apt"
            ],
            "source_name": "MISPGALAXY:El Machete",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1666716502,
    "ts_updated_at": 1743041355,
    "ts_creation_date": 1565354608,
    "ts_modification_date": 1565354611,
    "files": {
        "pdf": "https://archive.orkl.eu/4e45a10b5a7c19ff7af8f68f6908d14258f4e799.pdf",
        "text": "https://archive.orkl.eu/4e45a10b5a7c19ff7af8f68f6908d14258f4e799.txt",
        "img": "https://archive.orkl.eu/4e45a10b5a7c19ff7af8f68f6908d14258f4e799.jpg"
    }
}