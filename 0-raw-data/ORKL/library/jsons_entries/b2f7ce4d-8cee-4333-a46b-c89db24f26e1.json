{
    "id": "b2f7ce4d-8cee-4333-a46b-c89db24f26e1",
    "created_at": "2023-04-05T02:08:16.929179Z",
    "updated_at": "2025-03-27T02:06:01.737486Z",
    "deleted_at": null,
    "sha1_hash": "08af66967283f912b5fbceb576af51bc3917fdec",
    "title": "2023-03-12 - Makop- The Toolkit of a Criminal Gang",
    "authors": "",
    "file_creation_date": "2023-04-03T08:25:57Z",
    "file_modification_date": "2023-04-03T08:25:57Z",
    "file_size": 1089405,
    "plain_text": "# Makop: The Toolkit of a Criminal Gang\n\n**[medium.com/@lcam/makop-the-toolkit-of-a-criminal-gang-53cd44563c11](https://medium.com/@lcam/makop-the-toolkit-of-a-criminal-gang-53cd44563c11)**\n\nL M March 12, 2023\n\nL M\n\nMar 12\n\n\n7 min read\n\nDissecting the malicious arsenal of the Makop ransomware gang.\n\n## Executive summary\n\n\n-----\n\nInsights from a recent intrusion authored by Makop ransomware operators show\npersistence capability through dedicated .NET tools.\nMakop toolkit includes both off-the-shelf tools and custom-developed ones, including\ntools from the Chinese underground ecosystem.\nMakop gang did not conduct any significative retooling since 2020, which is a clear\nindicator of their effectiveness even after three years and hundreds of successful\ncompromises.\nThe gang leverages exposed remote administration services and internet-facing\nvulnerabilities to gain and maintain access to victim networks.\n\n## Introduction\n\nThe Makop ransomware operators started their infamous criminal business in 2020\nleveraging a new variant of the notorious Phobos ransomware. During the last years, the\ngang maintained a solid presence in the criminal underground even if they did not join the\ndouble extortion practice.\n\nTheir operations are based on the human operator ransomware practice where most of the\nintrusion is handled by hands-on keyboard criminals, even in the encryption stage.\n\nMakop ransomware gang is classified as a tier-B ransomware actor, but despite this, they\nkeep hitting companies in Europe and Italy. Technical details of the Makop ransomware\n[encryption tool have been greatly deepened by the Lifars security team (link), so, in this](https://lifars.com/wp-content/uploads/2021/08/Makop-Ransomware-Whitepaper-case-studyNEW-1.pdf)\narticle, I am going to focus on other parts of the Makop gang arsenal leveraged to conduct\ndigital extortions.\n\n## Technical Details\n\nMakop ransomware operator arsenal is a hybrid one: it contains both cust-developed tools\nand off-the-shelf software taken from public repositories. In particular, recent investigations\nwere able to identify four of them: the ARestore escalation tool, the backdoor, and other\npublicly available toolkits such as Advanced_Port_Scanner and a particular popular Chinese\nhack tool.\n\n## Custom tools\n\nAfter the initial access, Makop criminals are still using an old tool dated back to their first\noperations in cyberspace. The “ARestore” tool is .NET executable built in 2020 and partially\nobfuscated. Also, the compilation time in the PE header looks time stomped, but the\nmetadata from the .NET assembly modules reveal a more plausible date matching the time\nscale of the Makop operations.\n\nfilename: ARestore.exe\n\n\n-----\n\nmd5: 7f86b67ac003eda9d2929c9317025013\n\nFigure. Tampered PE timestamp (left) and .NET assembly copyright year (right)\nThe obfuscated part of the code is based on a switch-case state-machine looping and\njumping through labels in the MSIL code. Despite this, the tool does not contain any evasion\nor anti-debugging techniques and contains IL-only, 32-bit code.\n\nFigure. .NET flags (left) and obfuscation pattern (right)\nThe tool is designed for two main purposes: generating comb lists of local windows user\nnames and potential passwords, and testing them locally. The tool is able to automatically\nretrieve local users from groups, filter for administration, and then test the password. The\ncrooks currently use it after the initial access phase of their attack chain.\n\nFigure. View of the “ARestore” tool\nMakop operators also leverage other custom .NET assemblies to achieve further stages of\nthe kill chain. For instance, they are using a particular persistence tool we name “PuffedUp”\ndesigned to ensure persistence after the initial access. Even this tool looks compiled and\ngenerated back in the early stage of the Makop operations and is still in use in current\nintrusions. Even this time the executable has been built in 2020, but it is not obfuscated at\nall.\n\nfilename:data.exe\n\nmd5:e245f8d129e8eadb00e165c569a14b71\n\nFigure. Compilation timestamp (left), main routine (right)\nDuring recent Makop intrusions, the tool has been coupled with another executable named\n“c.exe”, but, unfortunately, it has been erased by the attackers during the disengagement\nphase. Anyway, a quick look at the PuffedUp code reveals a plain logic to keep its execution\npersistent through a RUN registry key.\n\nFigure. Run registry key setup in PuffedUp\nInterestingly, the tool relies on a textual configuration file placed in the same folder. This\nparticular file contains one or more 42 chars strings, that will be placed into the user\nclipboard. Apparently, a weird behavior that might make sense only with a more complete\nview of the Makop arsenal.\n\nFigure. PuffedUp configuration reading loop\n\n## Off-the-shelf tools\n\nMakop ransomware operators extensively use off-the-shelf open-source and freeware tools\nto conduct lateral movement and system discovery. Along with the classical abuse of\nMicrosoft SysInternal tools such as PsExec and other well-known open-source tools such as\n\n\n-----\n\nPutty and the never-missing Mimikatz, during recent operations, Makop abused even more\npeculiar software.\n\nFor instance “Advanced Port Scanner”, a freeware port scanning tool developed by the\nfamous Radmin’s authors. The Makop criminals were recently using version 2.5.3869 of the\ntool, which dates back to 2019.\n\nAdvanced_Port_Scanner_2.5.3869.exe\n\nmd5: 6A58B52B184715583CDA792B56A0A1ED\n\nThe date of this particular version of the free software is particularly meaningful because it\nperfectly fits the build and compilation time of the other custom tools of the Makop intrusion\narsenal. In fact, Makop criminals are still using tools built back in 2019 and 2020 to\ncompromise small and medium enterprises around the world.\n\nFigure. Advanced Port Scanner part of the Makop arsenal\nAgain, another tool in the Makop arsenal still dates to 2019: the “Everything” tool. Everything\nis freeware software maintained by Voidtools. As anticipated, the version abused by Makop\nransomware operators in recent 2023 intrusions is still version 1.4.1.932, released in January\n2019.\n\nThe tool is basically a search engine for local and network shared files inside a Windows\nenvironment: unlike the default Windows search, it is designed to locate files and folders by\nfilename instantly, speeding up system information discovery.\n\nFilename: Everything.exe\n\nmd5: b69d036d1dcfc5c0657f3a1748608148\n\nThe last tool interesting tool spotted in the Makop arsenal is a particular system\nadministration tool rarely used in the Russian criminal underground. Its name is YDArk and it\n[is an open-source tool available even on GitHub (link).](https://github.com/ClownQq/YDArk)\n\nfilename: YDArk.exe\n\nmd5: 9fd28d2318f66e4fe37a9a5bc1637928\n\nFigure. YDArk GitHub page (source: GitHub)\nYDArk is a powerful kernel manipulation tool that appeared in the Chinese underground\ncommunities back in 2020, where it was used to evade the memory scan of the anti-cheating\nprogram in gaming communities. The tool has been previously analyzed by SangYun Shin\n[(link). YDArk can hide processes the rootkit way: at the kernel level. It manipulates the](https://medium.com/@iamshinsangyun/how-to-find-processes-hidden-by-ydark-exe-18525318164a)\nEPROCESS kernel object of the target process by changing its PID to 0 and redirecting\nforward and backward ActiveProcessLinks to the self’s EPROCESS address.\n\nFigure. YDArk process hiding feature (source: GitHub)\n\n\n-----\n\nThe presence of this tool in the Makop arsenal is quite interesting because YDArk was\npreviously found in other ransomware compromises:\n\nIn April 2021 and December 2020, Sophos reported the abuse of YDArk in unspecified\ncircumstances ().\nIn July 2022, Dark Lab security firm () reported the abuse of YDArk within a SonicWall\nSMA100 exploitation campaign aimed to leverage CVE-2019–7481 and CVE-2021–\n20028 on internet-exposed appliances to install Lockbit ransomware.\n\n## Conclusion\n\nThe Makop ransomware operators are conducting cyber extortion with a consistent cyber\narsenal surviving detection for years. The absence of significative retooling in the Makop\noperator practice tells us the way to stop ransomware intrusion is still long.\n\nIf a tier-B human-operated ransomware gang targeting hundreds of companies worldwide\ndoes not need to update and change its arsenal after three years of operation it is a clear\nindication we are still lagging behind in enforcing an effective cyber attack deterrence\nstrategy based on increasing the cost of attacks for cyber criminals and forcing them to\nretool.\n\nThe disclosure of the Makop cyber arsenal tools shall enable defenders to correlate even\nmore intrusion attempts to the gang, to reach early detection of the abuse of both legit and\ncustom-made tools.\n\n## Indicator of Compromise\n\nHash:\n\n7f86b67ac003eda9d2929c9317025013 arestore.exe\ne245f8d129e8eadb00e165c569a14b71 data.exe\n6A58B52B184715583CDA792B56A0A1ED Advanced_Port_Scanner_2.5.3869.exe\nb69d036d1dcfc5c0657f3a1748608148 Everything.exe\n9fd28d2318f66e4fe37a9a5bc1637928 YDArk.exe\n\n## Yara Rules\n\n\n-----\n\nimport pe\nrule PuffedUp{\n\nmeta:\n\nauthor= “@luc4m”\n\ndate= “2023–03–12”\n\nmodified= “2023–03–12”\n\nhash= “e245f8d129e8eadb00e165c569a14b71”\n\ndescription=”puffedup tool in makop ransomware toolkit”\n\ntlp=”CLEAR”\n\nstrings:\n\n$main_1 = { 00 72 [4] 28 [4] 00 72 [4] 0A 72 [4] 28 [4] 00 29 }\n\n$main_2 = { 0B 07 28 [4] 80 [4] 28 [4] 00 2A }\n\n$sash_3 = { 72 [4] 0C [4] 72 [4] 0D 28 [4] 13 08 2C 06 }\n\n$sash_4 = { 16 FE 01 13 0C 11 0C 2C 17 11 08 }\n\n$sash_5 = { 1c 0D 00 20 [4] 28 [4] 00 00 DE 00 }\n\ncondition:\n\nuint16(0) == 0x5a4d\n\nand pe.imports(“mscoree.dll”)\n\nand ( 2 of ($sash_*) or 1 of ($main_*) )\n\n}\n\nrule ARestore{\n\nmeta:\n\nauthor= “@luc4m”\n\ndate= “2023–03–12”\n\nmodified= “2023–03–12”\n\n\n-----\n\nhash= 7f86b67ac003eda9d2929c9317025013\n\ndescription=”ARestore in makop ransomware toolkit”\n\ntlp=”CLEAR”\n\nstrings:\n\n$junk_1= { 2B 09 28 [4] 14 16 9A 26 16 2D F9 14 2A }\n\n$obj_1= { 38 [4] 26 20 [4] 38 [4] FE [4] 38 [4] 20 [4] 20 [4] 59 9C 20 [4] FE [4] 28 [4] 38\n}\n\n$obj_2= { FE [4] 20 [4] FE [4] 9C 20 [4] 38 [4] 12 }\n\n$string_1 = “ADLogic” nocase\n\n$string_2 = “GetUserFromGroupAsync” nocase\n\n$string_3 = “WriteResultAsync” nocase\n\n$string_4 = “ParseLoginAsync” nocase\n\n$string_5 = “GenerateCredentials” nocase\n\n$string_6 = “GetUserAsync” nocase\n\n$string_7 = “IsAuthenticated” nocase\n\ncondition:\n\nuint16(0) == 0x5a4d\n\nand pe.imports(“mscoree.dll”)\n\nand ( (1 of ($junk_*) or 1 of ($obj_*)) and 3 of ($string_*) )\n\n}\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2023/2023-03-12 - Makop- The Toolkit of a Criminal Gang.pdf"
    ],
    "report_names": [
        "2023-03-12 - Makop- The Toolkit of a Criminal Gang.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1680660496,
    "ts_updated_at": 1743041161,
    "ts_creation_date": 1680510357,
    "ts_modification_date": 1680510357,
    "files": {
        "pdf": "https://archive.orkl.eu/08af66967283f912b5fbceb576af51bc3917fdec.pdf",
        "text": "https://archive.orkl.eu/08af66967283f912b5fbceb576af51bc3917fdec.txt",
        "img": "https://archive.orkl.eu/08af66967283f912b5fbceb576af51bc3917fdec.jpg"
    }
}