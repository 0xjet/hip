{
    "id": "76f852e9-7bd9-4326-bba7-629a9dcbad04",
    "created_at": "2023-01-12T14:59:08.188873Z",
    "updated_at": "2025-03-27T02:09:07.992616Z",
    "deleted_at": null,
    "sha1_hash": "20676725f96ecb865989fb60464f45ba38147dde",
    "title": "2015-02-05 - Anatomy of a Brute Force Campaign- The Story of Hee Thai Limited",
    "authors": "",
    "file_creation_date": "2022-05-28T15:14:30Z",
    "file_modification_date": "2022-05-28T15:14:30Z",
    "file_size": 667943,
    "plain_text": "# Anatomy of a Brute Force Campaign: The Story of Hee Thai Limited\n\n**fireeye.com/blog/threat-research/2015/02/anatomy_of_a_brutef.html**\n\n## Threat Research Blog\n\nFebruary 05, 2015 | by [Michael Lin,](https://www.fireeye.com/blog/threat-research.html/category/etc/tags/fireeye-blog-authors/cap-michael-lin) [Derek Gooley](https://www.fireeye.com/blog/threat-research.html/category/etc/tags/fireeye-blog-authors/cap-derek-gooley)\n\n## Summary\n\nThis is the tale of an ongoing SSH brute forcing campaign, targeting servers and network devices, that distributes a new family of Linux rootkit\nmalware named “XOR.DDoS.” While typical DDoS bots are straightforward in operation and often programmed in a high-level script such as\nPHP or Perl, the XOR.DDoS family is programming in C/C++ and incorporates multiple persistence mechanisms including a rare Linux rootkit.\n\nThe campaign also utilizes complex attack scripts to serve the malware through a sophisticated distribution scheme that allows the attackers to\ncompile and deliver tailored rootkits on-demand to infect x86 and ARM systems alike.\n\nIn this post, we will follow the campaign from first sighting to the present day. We reveal the infection strategy, describe the build systems and\nshare indicators of compromise.\n\n## Brute Force Campaign\n\nOur story begins on Nov. 15, 2014. Late that evening, FireEye’s global threat research network was suddenly flooded by SSH brute-force\ndetections coming from various IP addresses belonging to 103.41.124.0/24, an address block that was registered to “Hee Thai Limited” only a\nfew weeks prior. Normally, a brute force attack would not be notable. What caught our eye about this attack was the sheer scale of the\noperation.\n\nWithin 24 hours of first sighting, we had observed well over 20,000 SSH login attempts, per server. No server was spared: each was attacked\nwithin hours of first sighting. By the end of November, just two weeks later, FireEye’s research systems had each logged about 150,000 login\nattempts from nearly every IP in Hee Thai Limited’s bucket of 255 addresses. By the end of January, each server had seen nearly 1 million\nlogin attempts. During this time period, traffic from 103.41.124.0/24 accounted for 63% of all observed port 22 traffic. Someone with a lot of\nbandwidth and resources really wanted to get into our servers.\n\nWe continued to observe the Hee Thai campaign over the next three months. The brute forcing campaign had three distinct phases. The initial\nphase began late in the evening of Nov. 15 and lasted less than 36 hours. During this phase, each targeted server was attacked by a single\nHee Thai address at a time, in series. Each IP address would attempt more than 20,000 passwords before moving on.\n\nAfter roughly a day without contact, the second phase of the campaign began on Saturday, Nov. 19 and would last until Sunday, Nov. 30.\nDuring this phase, the targeted servers were still attacked by Hee Thai IP’s in series, but each IP would only attempt a few thousand\npasswords before cycling to the next. Repeat attacks also began to occur. Another characteristic of the second phase was the use of a single\npassword dictionary, a modified version of the RockYou password list, by all attacking IPs.\n\nNo activity was observed from the Hee Thai subnet between Monday, Dec. 1 and Sunday, Dec. 7th, which marked the beginning of the third\nphase and continues to the present day. This new stage of the Hee Thai campaign is more chaotic than the previous two. The attacks now\noccur en masse and at random, frequently with multiple IPs simultaneously targeting the same server.\n\n\n-----\n\ne pass o d d ct o a es use a e a so d ast ca y c a ged o t e se e s use d e e t d ct o a es, a y g d y s e, a d t e\ncontents of the dictionaries have become increasingly exotic. One particular IP was observed trying several thousand non-sequential and\nseemingly random numbers. Passwords representing “keyboard walks,” where the password is the result of a keyboard pattern created by\ndrawing lines across a keyboard, were also frequently observed.\n\n## Infection Strategy\n\nThe Hee Thai SSH brute force campaign always attempts to gain access to the root account. If a login attempt is successful, the brute forcing\nmachine immediately logs out and stops its attack. Within 24 hours a different machine from an IP address outside of Hee Thai’s\n103.41.124.0/24 address block will log in and out again. The SSH brute force attacks will still continue and this process may repeat several\ntimes, but the events following a successful login attempt are always the same.\n\nOn the surface, this appears to be the extent of interactions. Linux servers running the standard OpenSSH server will only see a successful\nlogin in their logs, followed by an immediate logout and no further activity.\n\nFigure 1: SSH remote commands not seen in logs\n\nIn reality, the second machine that logs in after root’s password is found will run a SSH remote command. This commonly used feature of\nOpenSSH, interestingly enough, evades standard Linux logging facilities. The OpenSSH server does not log remote commands, even when\nlogging is configured to the most verbose setting. Since a remote command doesn’t create a terminal session, TTY logging systems also do\nnot capture these events. Both the last and lastlog commands, which display listings of recent logins, are also blind.\n\nThe Hee Thai campaign has used several different remote commands, depending on when the compromise occurred, as the campaign is\nconstantly evolving. SSH remote commands can consist of multiple shell commands, separated by semi-colons. Hee Thai takes advantage of\nthis to run large, complicated scripts in a single command.\n\n## On-demand Malware Build System\n\nUsing a sophisticated set of build systems, the malware harvests kernel headers and version strings from victims to deliver customized\nmalware that may be compiled on-demand. A second set of fallback servers exist to deliver a pre-compiled version of the malware without the\nrootkit component.\n\nThis strategy makes hash signature-based detection systems ineffective for detecting XOR.DDoS.\n\nThe on-demand compilation mechanism is operated by the remote SSH command seen in the initial stage of a compromise. The most\ncommonly used and most feature-full command/script seen during the Hee Thai campaign is over 6000 characters in length and very\nsophisticated. Smaller versions of this script have also been seen, particularly a version that exclusively targets 64-bit machines. Additional\nvariations will break up the script into multiple smaller parts, served separately in different files, which fetch each other via wget in series.\nUltimately, the scripts all do the same thing, operate the on-demand build system and deliver XOR.DDoS to the target machine.\n\n\n-----\n\nFigure 2: Hee Thai Campaign Attack Cycle\n\nThe script starts by setting up an environment PATH and decoding a series of hard-coded values (including the IP addresses used later), which\nhave been encoded with a simple shift cipher. It also removes the immutable bit and gives execute permissions to the system’s wget and cut\nbinaries, in case an admin locked them down.\n\nThe script extracts the system’s kernel vermagic string, which indicates the version number of the kernel. Rootkits on Linux are difficult to\ndistribute because loadable kernel modules (LKM) must be compiled for the kernel they want to run on. Unlike Windows, which has a stable\nkernel API allowing for the creation of code that is portable between kernel versions, the Linux kernel lacks such an API. Since the kernel’s\ninternals change from version to version, a LKM must be binary compatible with the kernel. A safety mechanism in the form of a kernel version\nID string, called the vermagic string, helps to prevent an incompatible LKM from loading.\n\nThere is no standard shell command to display the running kernel’s vermagic string. The script cleverly extracts a listing of all active LKMs on\nthe system with lsmod and then uses modinfo on a module to extract the LKM’s vermagic string, which is guaranteed to match the string of the\nkernel. Then, the extracted vermagic string is hashed with MD5.\n\nNext, the script selects a build server with the same architecture as the targeted host from a hardcoded list, then sends the hashed vermagic\nstring to the server. This is accomplished with wget by sending the hashed vermagic string as a GET parameter to a server-side function on\nthe selected build server. The server will check whether it has seen the hash before and reply appropriately.\n\nGET /check.action?iid=8C204556960B73B25667CA80F33A72F9&kernel=3.14\n\nIf the hash is known to the server, the build system uses server-side copies of the necessary kernel headers to compile and deliver the\nmalware in the form of an ELF binary.\n\nIf the hash is unknown to the server, meaning it has never seen this kernel before, it will attempt to harvest the target’s kernel headers, if they\nare installed. If kernel headers are installed, which aren’t necessarily on all systems, it gathers the header files and compresses them into a tgz\nfile. The script downloads a small ELF binary tool with wget, called ‘mini,’ and uses it to upload the compressed kernel headers with a POST\nrequest to the build server.\n\nPOST /submit.action\n\nusername%3Dadmin%26password%3Dadmin%26ip%3D103.25.0.0%3A8003%7C103.240.0.0%3A8003%7C66.102.0.0%3A8003%26ver%3D3.14\n2-amd64%5C%5C+SMP%5C%5C+mod_unload%5C%5C+modversions%5C%5C%26kernel%3D3.14%26file%3D%40%2Ftmp%2Fdev.tgz\n\n\n-----\n\nt e e e eade s a e t sta ed o t e ta get, t e a est g s s pped stead, t e bu d syste atte pts to co p e a su tab e oot t\nusing the kernel version strings. This is accomplished with a GET request to yet another server-side function.\n\nGET /compiler.action?\niid=8C204556960B73B25667CA80F33A72F9&username=admin&password=admin&ip=103.25.0.0%7C103.240.0.0%7C66.102.0.0&ver=3.142-amd64%5C%5C+SMP%5C%5C+mod_unload%5C%5C+modversions%5C%5C&kernel=3.14\n\nIf the kernel headers aren’t available and the build system can’t get by with just the kernel version strings, or if the build servers are\nunreachable, the script downloads a precompiled version of the malware without the rootkit component from a backup server.\n\nFinally, the malware is executed. XOR.DDoS extracts itself, sets up its numerous persistence mechanisms and randomly generates a 32character long string of lowercase letters. This string is sent back to the attacker and is used as a unique identifier for the compromised\nsystem.\n\n## XOR.DDoS: Modern Linux DDoS Bot with a Rootkit Twist\n\nThe ultimate goal of the Hee Thai SSH brute forcing campaign is to infect systems with the XOR.DDoS malware. The non-profit research\n[group “Malware Must Die!” first spotted this new family of Linux malware and they briefly outlined its characteristics in a blog post in September](http://blog.malwaremustdie.org/2014/09/mmd-0028-2014-fuzzy-reversing-new-china.html)\n2014.\n\nXOR.DDoS is ostensibly a DDoS bot. However, unlike typical straightforward DDoS bots, XOR.DDoS is one of the more sophisticated malware\nfamilies to target the Linux OS. It’s also multi-platform, with C/C++ source code that can be compiled to target x86, ARM and other platforms.\nXOR.DDoS gets its name from frequent use of XOR encryption within the code and in its network communications.\n\nTwo distinct variants of the XOR.DDoS family have been observed in the wild. Most variants are available in many different binaries, which are\nidentical in primary function but differ subtly perhaps containing different DNS server lookups or using different ports for communication. Each\nvariant is also available in versions targeting different platforms (i.e., x86, AMD64, ARM).\n\nTo date, the Hee Thai campaign has delivered 41 unique re-compiled binaries from four distribution domains that were observed in the wild.\nThe build system is capable of producing infinitely more versions of the malware on demand.\n\nVariant 1 Persistence Mechanisms\n\n32 randomly generated lower-case characters stored in /var/run/mount.pid\nCopies itself to /lib/libgcc.so\nCopies itself to /usr/bin/ with a filename of 10 random lowercase characters\nCreates symlink to /usr/bin/ copy and placed in /etc/init.d/\nCreates symlinks to /usr/bin/ in /etc/rc[1-5].d/S90[Session ID]\nCreates symlinks to /usr/bin/ in /etc/rc.d/rc[1-5].d/S90[Session ID]\nCron script to turn on network interfaces, copy /lib/libgcc.so to /lib/libgcc.so.bak, execute /lib/libgcc.so.bak\nUses XOR key: BB2FA36AAA9541F0\n\nVariant 2 Persistence Mechanisms\n\nFirst seen Dec. 22, 2014\n32 randomly generated lowercase characters stored in /var/run/udev.pid\nCopies itself to /lib/libgcc4.so\nCopies itself to /usr/bin/ with a filename identical to the session ID, then appends a timestamp to the binary\nCreates symlink to /usr/bin/ copy and placed in /etc/init.d/\nCreates symlinks to /usr/bin/ in /etc/rc[1-5].d/S90[Session ID]\nCreates symlinks to /usr/bin/ in /etc/rc.d/rc[1-5].d/S90[Session ID]\nCron script to copy /lib/libgcc4.so to /lib/libgcc4.4.so, execute /lib/libgcc4.4.so\nUses two XOR keys: BB2FA36AAA9541F0 and ECB6D3479AC3823F\n\nVariant 2 is the newest version. All in-the-wild, pre-compiled copies of Variant 2 were replaced on Jan. 20, 2015, with a new set of binaries. It is\nfunctionally the same as the original version, but some of the domains used during C&C have changed. Variant 1 distribution servers remain\nactive, but may have fallen out of favor.\n\nWhen executed, XOR.DDoS attempts to make contact with its C&C servers. Once contact is established, it fetches a small XOR encoded file\ncontaining lists of process names, file hashes, file names and IP addresses. It then searches the system for these identifiers and kills/removes\nthem. Processes found to have active network connections with the IPs from the file are also killed. Judging from the contents of the files,\nXOR.DDoS appears to be killing other malware, ensuring there is no competition for the machine’s resources.\n\nThe server may then send a list of targets at any time and the bot will start DoS attacks against them using a variety of methods (SYN, DNS,\nUDP, TCP).\n\nThe rootkit used by XOR.DDoS loads itself as a LKM. Its primary purpose is to hide indicators of compromise at the kernel level. It has\nfunctions for hiding processes files ports and controlling netfilter (Linux kernel firewall)\n\n\n-----\n\na a ts o O oS a e t e ab ty to do oad a d e ecute a b t a y b a es as e as a se update eatu e, g g t e a a e t e\nability to replace itself with newer versions.\n\n## Detection and Prevention\n\nNetwork devices and embedded systems are the most vulnerable to SSH brute force attacks. It may not be straightforward or possible for an\nend-user to protect these systems against these types of attacks.\n\nIf possible, configure your SSH server to use encryption keys instead of passwords. We also recommend you disable remote logins for the root\naccount. The XOR.DDoS malware requires root permissions, and the Hee Thai campaign has only been observed attacking root accounts.\n\nInstall a network-based brute force detection system available in some security appliances, including FireEye’s NX product family. These\nproducts will defend your network from the initial attack vector, detecting the breach before it can do damage.\n\nHome and small business users can install the open source fail2ban utility, which works with iptables to detect and block brute force attacks.\n\nOpenSSH servers will place the text of an SSH remote command into a $SSH_ORIGINAL_COMMAND environment variable. This can be\nlogged with the ForceCommand feature in the server configuration file, allowing you to detect the compromise, but only after it has occurred.\n\nA compromised system should be isolated from the network, to the extent possible, and cleaned of all IoC’s (see appendix). If a version of\nXOR.DDoS containing a rootkit has compromised the system, removal may not be feasible.\n\n## Conclusion\n\nBrute force attacks are one of the oldest types of attacks. Due to its ubiquity, there are numerous solutions available for defending against\nthem. However a great many systems are vulnerable. Even in enterprise settings, network devices and servers in forgotten branch offices\ncould be exposed to this threat.\n\nBrute forcing credentials remains one of the top 10 most common ways an organization is first breached. The Hee Thai Limited SSH brute\nforce campaign takes advantage of this to find insufficiently defended systems to incorporate into the XOR.DDoS botnet.\n\n## Appendix: Indicators of Compromise\n\nSince there are multiple XOR.DDoS variants, each with differing persistence mechanisms, only a sub-set of indicators will be seen in the same\ninfection.\n\n### Strings:\n\nBB2FA36AAA9541F0\nECB6D3479AC3823F\n\n### Files:\n\n/usr/bin/[10 random characters a-z]\n/etc/init.d/[10 random characters a-z]\n/usr/bin/[Session ID]\n/etc/init.d/[Session ID]\n/etc/rc1.d/S90[Session ID]\n/etc/rc2.d/S90[Session ID]\n/etc/rc3.d/S90[Session ID]\n/etc/rc4.d/S90[Session ID]\n/etc/rc5.d/S90[Session ID]\n/etc/rc.d/rc1.d/S90[Session ID]\n/etc/rc.d/rc2.d/S90[Session ID]\n/etc/rc.d/rc3.d/S90[Session ID]\n/etc/rc.d/rc4.d/S90[Session ID]\n/etc/rc.d/rc5.d/S90[Session ID]\n/var/run/sftp.pid\n/var/run/udev.pid\n/var/run/mount.pid\n/etc/cron.hourly/cron.sh\n/etc/cron.hourly/udev.sh\n/etc/crontab\n\n*/3 * * * * root etc/cron.hourly/udev.sh\n/lib/libgcc.so\n/lib/libgcc.so.bak\n/lib/libgcc4.so\n\n\n-----\n\n/ b/ bgcc so\n/lib/udev/udev\n/lib/udev/debug\n\n### Domains\n\nheethai.com\nbuhenge.com\nrxxiaoao.com\nhcxiaoao.com\ninfo.3000uc.com\nwangzongfacai.com\nnavert0p.com\ndsaj2a.com\ndsaj2a.org\ndsaj2a1.org\n\n### IP addresses (hard-coded into binary)\n\n103.25.9.228\n103.25.9.229\n\n### Malware Binary MD5 Hashes\n\n0b7630ead879da12b74b2ed7566da2fe (variant 1)\n85ecdf50a92e76cdb3f5e98d54d014d4 (variant 2)\n\nIOC content is posted at: [https://github.com/fireeye/iocs/tree/master/BlogPosts](https://github.com/fireeye/iocs/tree/master/BlogPosts)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2015/2015-02-05 - Anatomy of a Brute Force Campaign- The Story of Hee Thai Limited.pdf"
    ],
    "report_names": [
        "2015-02-05 - Anatomy of a Brute Force Campaign- The Story of Hee Thai Limited.pdf"
    ],
    "threat_actors": [
        {
            "id": "eb3f4e4d-2573-494d-9739-1be5141cf7b2",
            "created_at": "2022-10-25T16:07:24.471018Z",
            "updated_at": "2025-03-27T02:02:10.24394Z",
            "deleted_at": null,
            "main_name": "Cron",
            "aliases": [],
            "source_name": "ETDA:Cron",
            "tools": [
                "Catelites",
                "Catelites Bot",
                "CronBot",
                "TinyZBot"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535548,
    "ts_updated_at": 1743041347,
    "ts_creation_date": 1653750870,
    "ts_modification_date": 1653750870,
    "files": {
        "pdf": "https://archive.orkl.eu/20676725f96ecb865989fb60464f45ba38147dde.pdf",
        "text": "https://archive.orkl.eu/20676725f96ecb865989fb60464f45ba38147dde.txt",
        "img": "https://archive.orkl.eu/20676725f96ecb865989fb60464f45ba38147dde.jpg"
    }
}