{
    "id": "2794d13e-70e1-4e47-b87f-99f46a45ac5d",
    "created_at": "2023-01-12T15:00:26.165111Z",
    "updated_at": "2025-03-27T02:16:47.093845Z",
    "deleted_at": null,
    "sha1_hash": "16d64402742b866e7c337bc9220427bebf950d16",
    "title": "2021-06-02 - RedDelta PlugX Undergoing Changes and Overlapping Again with Mustang Panda PlugX Infrastructure",
    "authors": "",
    "file_creation_date": "2022-05-29T01:34:53Z",
    "file_modification_date": "2022-05-29T01:34:53Z",
    "file_size": 2461702,
    "plain_text": "# RedDelta PlugX Undergoing Changes and Overlapping Again with Mustang Panda PlugX Infrastructure\n\n**blog.xorhex.com/blog/reddeltaplugxchangeup/**\n\n## xorhex\n\nFocus on Threat Research through malware reverse engineering\n\nNew RedDelta PlugX variant undergoes revisions to slow down analysis. Extracted C2s link\nback to two known Mustang Panda command and control servers.\n\nJune 2, 2021\nxorhex\n\n9-Minute Read\n\nFamily PlugX - RedDelta Variant\n\n\nThreat\nActor\n\n\nMustang Panda\n\n\nEncrypted 1c7897a902b35570a9620c64a2926cd5d594d4ff5a033e28a400981d14516600\n\n\nDecryption\nKey\n\nKey\nLength\n\n\n0x78, 0x61, 0x6c, 0x72, 0x45, 0x5a, 0x6f, 0x78, 0x43, 0x59, 0x73, 0x71, 0x6c,\n0x52, 0x6e, 0x77, 0x78, 0x46, 0x63, 0x43, 0x46\n\n21\n\n\n-----\n\nDecrypted ec1c29cb6674ffce989576c51413a6f9cbb4a8a41cbd30ec628182485a937160\n\nConfig C2 101.36.125.203:965\n\nConfig C2 101.36.125.203:110\n\nConfig C2 vitedannews.com:965\n\nConfig C2 vitedannews.com:110\n\n### Summary\n\nMustang Panda (aka RedDelta, BRONZE PRESIDENT) is striving to make their PlugX\nvariant more challenging to reverse statically. This RedDelta PlugX variant overlaps with\ninstrastructure tied to Mustang Panda’s PlugX variant, something we’ve seen before.\nMustang Panda is believed to be a Chinese nation-sponsored espionage group. Public\n[reporting shows MustangPanda targeting non-government organizations (NGOs), including](https://www.secureworks.com/research/bronze-president-targets-ngos)\n[religious entities. They appear to focus locations in close proximity like Mongolia,](https://www.recordedfuture.com/reddelta-targets-catholic-organizations/) Hong\nKong, and [Vietnam. Mustang Panda is known for making use of PlugX, Posion Ivy, and](https://blog.vincss.net/2020/03/re012-phan-tich-ma-doc-loi-dung-dich-COVID-19-de-phat-tan-gia-mao-chi-thi-cua-thu-tuong-Nguyen-Xuan-Phuc.html)\nCobalt Strike. The PlugX sample covered in this blog demonstrates how this group is\ncontinuing to evolve their toolset in a likely attempt to slow down researchers and avoid\nsecurity automation tools.\n\n**Key Findings**\n\nShares command and control infrastructure with other Mustang Panda PlugX binaries\nDecryption key length increased to 21 characters\nControl flow obfuscation added\nCode variations in the dynamic Windows API resolutions\n\n### Mustang Panda / RedDelta Connection\n\n[When Recorded Future reported on RedDelta last year they differentiated between Mustang](https://go.recordedfuture.com/hubfs/reports/cta-2020-0728.pdf)\nPanda and RedDelta. They both make use of PlugX binaries, and due to binary similarities\n[and overlapping infrastructure, we track them as the same group. The key binary differences](https://threatconnect.com/blog/research-roundup-mustang-panda-and-reddelta-plugx-using-same-c2/)\nin the RedDelta PlugX version are:\n\nConfig block check for `########`\nRC4 Encryption\n\nThe config block check is how we primarily distinguish between the Mustang Panda\nvariant and the RedDelta variant. The “original” Mustang Panda variant\nuses XXXXXXXX .\n\n\n-----\n\n-----\n\nFigure 1: RedDelta Variant Config Check\n(ec1c29cb6674ffce989576c51413a6f9cbb4a8a41cbd30ec628182485a937160)\nOverlapping features between both of these variants include:\n\nPrepended XOR key\nShellcode in the MZ header\nStack Strings\nRolling Config XOR decryption key: `123456789`\n\nThis sample contains all of these features including the RedDelta PlugX ones.\n\nWe believe with moderate confidence that this sample is tied to the Mustang\nPanda/RedDelta threat actor group.\n\n### Similar Yet Different\n\n**Encrypted DAT File**\n\nOn May 24 2021 an encrypted DAT file was uploaded to VirusTotal from [Vietnam. The file](https://www.virustotal.com/gui/file/1c7897a902b35570a9620c64a2926cd5d594d4ff5a033e28a400981d14516600/submissions)\nwas uploaded with the name `SmadDB.dat and is encypted with a 21 byte XOR key`\nprepended to the binary.\n\nFigure 2: MWDB\nWhile the majority of the RedDelta PlugX variants we have seen use a 10 byte prepended\nXOR key; this is not the first deviation. There are three others in our collection that have a\nprepended XOR key longer than 10 bytes.\n\n**XOR**\n**Key**\n**Length** **SHA256 (Encrypted File)**\n\n13 dba437c9030b5f857ce9820a0c9e2c252fd8aeda71c2101024d3576c446972a0\n\n15 a1eb4ce6eaa0c35ca4e8285c32b59cd0dfb34018b3f454d4fa4cebe9906534d8\n\n\n-----\n\n**XOR**\n**Key**\n**Length** **SHA256 (Encrypted File)**\n\n17 2304891f176a92c62f43d9fd30cae943f1521394dce792c6de0e097d10103d45\n\n21 1c7897a902b35570a9620c64a2926cd5d594d4ff5a033e28a400981d14516600\n(most recent sample)\n\nThis is not the only change; control flow obfuscation is also being added to the malware.\n\n**Control Flow Obfuscation**\n\nMustang Panda is working on adding control flow obfuscation to their PlugX variant. This first\nexample shows control flow obfuscation added to the config decrypting routine.\n\n\n-----\n\nFigure 3:1c7897a902b35570a9620c64a2926cd5d594d4ff5a033e28a400981d14516600\nWe don’t see this when comparing it to a prior sample (Figure 4).\n\n\n-----\n\n-----\n\nFigure 4: dba437c9030b5f857ce9820a0c9e2c252fd8aeda71c2101024d3576c446972a0\nIn addition to control flow obfuscating being added, the newest sample’s function (Figure 3)\nis updated to directly house the decryption routine versus it being in a separate function, as\nseen in the prior sample (Figure 5).\n\n\n-----\n\nFigure 5: XOR Routine dba437c9030b5f857ce9820a0c9e2c252fd8aeda71c2101024d3576c446972a0\nOur second control flow obfuscation example in this binary is pulled from an API hashing\nalgorithm.\n\nFigure 6: Control Flow Obfuscation - API Hashing Function\nNotice the multiple comparison statements controlling which branches are taken (Figure 6),\nmaking it harder to follow the exection flow.\n\nMustang Panda appears to be adding control flow obfuscation to parts of their code but it\ndoes not exist in all of the functions yet. They don’t stop with control flow obfuscation; they\nare also modifing how the dynamic Windows API lookup is being performed.\n\n**Resolving Windows API Calls**\n\nThe binary also contains deviations in how it dynamically resolves Windows API functions.\nFigure 7 shows how the previous samples did this.\n\n\n-----\n\n-----\n\nFigure 7: Prior Dynamic API Calling (dba437c9030b5f857ce9820a0c9e2c252fd8aeda71c2101024d3576c446972a0)\nNotice the API name is built on the stack and then resolved using GetProcAddress. They do\nthis consistantly throughout the binary when dynamically resolving API calls.\n\nThe new sample,\nec1c29cb6674ffce989576c51413a6f9cbb4a8a41cbd30ec628182485a937160, changes\nthings up a bit by using two slightly different variations on the same pattern to resolve\nWindows API calls.\n\nAdded Techinque - Method 1\n\nThe first method involves using API hashing to get `LoadLibraryA and` `GetProcAddress`\nfunction pointers. The API hashing code is placed inline with the rest of the function. It’s not\nseparated into its own function. This is an important distinction as the next method does\nseparate it out. The API name is built on the stack between resolving `GetProcAddress and`\n```\nLoadLibraryA . The final step is to execute the Windows function hidden in the stack string.\n\n```\nThe diagram below outlines the process in more detail.\n\n\n-----\n\nFigure 8: Dynamic API Calling (Method 1)\nAdded Technique - Method 2\n\nThe second method is similar to the first but the Windows API hashing algorithm is placed\ninto a separate function. The Windows API names may or may not be encrypted. Figure 9\nshows the function’s flow with the stack strings being encrypted. The unencrypted strings\nfollow this same pattern minus the decryption loop.\n\n\n-----\n\nFigure 9: Dynamic API Calling (Method 2)\nThe next difference noted is around string obfuscation.\n\n**String Obfuscation**\n\nThe older samples primarily make use of stack strings to hide from tools like strings.exe. This\nnew sample uses a mixture of stack strings with and without XOR encryption. The index of\nthe character being decrypted makes up one part of the XOR key for that letter. The second\npart is a constant they add to it to get the final XOR key.\n\nThe string decryption function (for example, Figure 9) can be represented in Python as:\n\n\n-----\n\n```\ndef str_decrypt(value: [bytes], xor_key_modified_by: int) > str:\n plain_text = []\n for idx, val in enumerate(value):\n  plain_text.append(chr(val^(idx+xor_key_modified_by)))\n return ''.join(plain_text)\n\n```\nTo call it, pass an array of bytes and the constant to add to the XOR key. For example:\n```\n>>> str_decrypt([0x03, 0x0c, 0x18, 0x05, 0x09, 0x01, 0x5d, 0x5d], 0x68)\n'kernel32'\n\n```\nThey don’t always modify the XOR key by `0x68 ; sometimes they use other values like`\n```\n0x2c .\n\n### Mustang Panda and RedDelta Infrastructure Overlap\n\n```\nThis PlugX’s config contains two previously seen Mustang Panda command and control\nservers;\n\n101.36.125.203\nvitedannews.com\n\nInfrastructure Pivot\n\n**Content Loading..**\n\nClick a Node to Load Details Below\n\nThere are 7 samples in our repository that share the IP, 101.36.125.203, and one other\nsample that shares the domain, vitedannews.com. All of these samples contain the\n```\nXXXXXXXX config value check making them the Mustang Panda variant. This RedDelta\n\n```\nvariant (ec1c29cb6674ffce989576c51413a6f9cbb4a8a41cbd30ec628182485a937160)\nmakes the second instance where the IP/Domains overlap with the “original” Mustang Panda\n[PlugX variant. More about the first instance can be found on ThreatConnect’s blog. This](https://threatconnect.com/blog/research-roundup-mustang-panda-and-reddelta-plugx-using-same-c2/)\nsecond infrastructure overlap further strenghtens our theory of them being the same group or\nat least sharing personnel/infrastructure.\n\n### Conclusion\n\nOver all we believe Mustang Panda will continue evolving the RedDelta variant to help\nfurther thwart detection as time goes on. Historically the .dat file (the encrypted PlugX file) is\nloaded using a sideloaded dll which does the loading, decrypting, and passing execution on\nto this PlugX binary. These three files are sometimes packaged using a self extracting SFX\nfile. We can’t be certain that the updated variant was delivered in the same fashion, but that\nwould be something to look for.\n\nFeedback welcomed via Twitter.\n\n\n-----\n\n### Appendix\n\n**API Hashing**\n\nSpotting the Hashing Routine Inside Control Flow Obfucation\n\nTaking our knowledge of API hashing algorithms (most, if not all, API hashing routines loop\nthrough each character of the API name and apply the hashing algorithm to it) we can find\nthe only part of the algorithm we really care about, the hashing routine. The GIF starts from a\nzoomed out position to identify a loop for inspection before zooming in on the hashing\nalgorithm loop.\n\nFigure 10: Control Flow Obfuscation - API Hashing Loop\nRewriting the Hashing Algorithm in Python\n\nThe API hashing algorithm can be re-written in Python as:\n\n\n-----\n\n```\ndef hasher(name: str):\n ebp = 0x811c9dc5\n for dl in name:\n  edx = ord(dl) ^ ebp\n  ebp = (edx * 0x1000193) & 0xffffffff\n print(hex(ebp))\n\n```\nLoadLibraryA == 0x53b2070f\nGetProcAddress == 0xf8f45725\n\n**IOCs**\n\n1c7897a902b35570a9620c64a2926cd5d594d4ff5a033e28a400981d14516600\nec1c29cb6674ffce989576c51413a6f9cbb4a8a41cbd30ec628182485a937160\n101.36.125.203\nvitedannews.com\ndba437c9030b5f857ce9820a0c9e2c252fd8aeda71c2101024d3576c446972a0\na1eb4ce6eaa0c35ca4e8285c32b59cd0dfb34018b3f454d4fa4cebe9906534d8\n2304891f176a92c62f43d9fd30cae943f1521394dce792c6de0e097d10103d45\n2f58a869711d2b28e6ecaac25cc2166daa46f7adfb719b7dd334e01c1474ca9b\n2bfd100498f70938dedef42116af09af2db77ef1315edcea0ffd62c93015ddf5\nb87d1c01daee804c7330d5ac6273e5dcba886e1663c929709c158fd45b11a7ba\n4e30cfa4f3d3bd6192818c5619eb7f6a26a408ae9fd62a7629059f47466f757b\n2531af12360e29b73b545210e1cbdfc2459c95e2827d3246e9d6933820a808dd\n4b1dbb3fc4adba3a83a563e5e86afb56136a1f9ba0293ad21a00e031b88b2ad9\nf631e8f0c723cccbc5b26387f4100351de2e158b6770e962733734be6ca119d5\n76f44175f88984367ad62c81d1dcc947b1a26d6832fd33569d2c21113c1ddee2\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-06-02 - RedDelta PlugX Undergoing Changes and Overlapping Again with Mustang Panda PlugX Infrastructure.pdf"
    ],
    "report_names": [
        "2021-06-02 - RedDelta PlugX Undergoing Changes and Overlapping Again with Mustang Panda PlugX Infrastructure.pdf"
    ],
    "threat_actors": [
        {
            "id": "b5449533-0ff1-4048-999d-7d4bfd8e6da6",
            "created_at": "2022-10-25T16:07:24.114365Z",
            "updated_at": "2025-03-27T02:02:10.111256Z",
            "deleted_at": null,
            "main_name": "RedDelta",
            "aliases": [
                "Operation Dianxun",
                "TA416"
            ],
            "source_name": "ETDA:RedDelta",
            "tools": [
                "Agent.dhwf",
                "Agentemis",
                "Chymine",
                "Cobalt Strike",
                "CobaltStrike",
                "Darkmoon",
                "Destroy RAT",
                "DestroyRAT",
                "Gen:Trojan.Heur.PT",
                "Kaba",
                "Korplug",
                "PlugX",
                "Poison Ivy",
                "RedDelta",
                "SPIVY",
                "Sogu",
                "TIGERPLUG",
                "TVT",
                "Thoper",
                "Xamtrav",
                "cobeacon",
                "pivy",
                "poisonivy"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "aa90ad17-8852-4732-9dba-72ffb64db493",
            "created_at": "2023-07-11T02:00:10.067957Z",
            "updated_at": "2025-03-27T02:00:03.134199Z",
            "deleted_at": null,
            "main_name": "RedDelta",
            "aliases": [],
            "source_name": "MISPGALAXY:RedDelta",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "1691c25f-1aa4-4168-8ce2-7aa8f23246e7",
            "created_at": "2024-06-04T02:03:07.724221Z",
            "updated_at": "2025-03-27T02:05:17.284601Z",
            "deleted_at": null,
            "main_name": "BRONZE PRESIDENT",
            "aliases": [
                "Mustang Panda ",
                "Red Lich ",
                "Temp.Hex ",
                "HoneyMyte "
            ],
            "source_name": "Secureworks:BRONZE PRESIDENT",
            "tools": [
                " Cobalt Strike",
                " ORat",
                " PlugX",
                " RCSession",
                "China Chopper"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "b69037ec-2605-4de4-bb32-a20d780a8406",
            "created_at": "2023-01-06T13:46:38.790766Z",
            "updated_at": "2025-03-27T02:00:02.919758Z",
            "deleted_at": null,
            "main_name": "MUSTANG PANDA",
            "aliases": [
                "TEMP.HEX",
                "TA416",
                "TANTALUM",
                "Twill Typhoon",
                "Earth Preta",
                "Stately Taurus",
                "LuminousMoth",
                "Polaris",
                "BRONZE PRESIDENT",
                "HoneyMyte",
                "Red Lich"
            ],
            "source_name": "MISPGALAXY:MUSTANG PANDA",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "9baa7519-772a-4862-b412-6f0463691b89",
            "created_at": "2022-10-25T15:50:23.354429Z",
            "updated_at": "2025-03-27T02:00:55.45162Z",
            "deleted_at": null,
            "main_name": "Mustang Panda",
            "aliases": [
                "Mustang Panda",
                "TA416",
                "RedDelta",
                "BRONZE PRESIDENT"
            ],
            "source_name": "MITRE:Mustang Panda",
            "tools": [
                "Cobalt Strike",
                "RCSession",
                "NBTscan",
                "PoisonIvy",
                "PlugX"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "2ee03999-5432-4a65-a850-c543b4fefc3d",
            "created_at": "2022-10-25T16:07:23.882813Z",
            "updated_at": "2025-03-27T02:02:10.0116Z",
            "deleted_at": null,
            "main_name": "Mustang Panda",
            "aliases": [
                "Bronze President",
                "Camaro Dragon",
                "Earth Preta",
                "HoneyMyte",
                "Mustang Panda",
                "Operation SMUGX",
                "Operation SmugX",
                "PKPLUG",
                "Red Lich",
                "Stately Taurus",
                "TEMP.Hex"
            ],
            "source_name": "ETDA:Mustang Panda",
            "tools": [
                "9002 RAT",
                "AdFind",
                "Agent.dhwf",
                "Agentemis",
                "CHINACHOPPER",
                "China Chopper",
                "Chymine",
                "ClaimLoader",
                "Cobalt Strike",
                "CobaltStrike",
                "DCSync",
                "DOPLUGS",
                "Darkmoon",
                "Destroy RAT",
                "DestroyRAT",
                "Farseer",
                "Gen:Trojan.Heur.PT",
                "HOMEUNIX",
                "Hdump",
                "HenBox",
                "HidraQ",
                "Hodur",
                "Homux",
                "HopperTick",
                "Hydraq",
                "Impacket",
                "Kaba",
                "Korplug",
                "LadonGo",
                "MQsTTang",
                "McRAT",
                "MdmBot",
                "Mimikatz",
                "NBTscan",
                "NetSess",
                "Netview",
                "Orat",
                "POISONPLUG.SHADOW",
                "PUBLOAD",
                "PVE Find AD Users",
                "PlugX",
                "Poison Ivy",
                "PowerView",
                "QMAGENT",
                "RCSession",
                "RedDelta",
                "Roarur",
                "SPIVY",
                "ShadowPad Winnti",
                "SinoChopper",
                "Sogu",
                "TIGERPLUG",
                "TONEINS",
                "TONESHELL",
                "TVT",
                "TeamViewer",
                "Thoper",
                "TinyNote",
                "WispRider",
                "WmiExec",
                "XShellGhost",
                "Xamtrav",
                "Zupdax",
                "cobeacon",
                "nbtscan",
                "nmap",
                "pivy",
                "poisonivy"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535626,
    "ts_updated_at": 1743041807,
    "ts_creation_date": 1653788093,
    "ts_modification_date": 1653788093,
    "files": {
        "pdf": "https://archive.orkl.eu/16d64402742b866e7c337bc9220427bebf950d16.pdf",
        "text": "https://archive.orkl.eu/16d64402742b866e7c337bc9220427bebf950d16.txt",
        "img": "https://archive.orkl.eu/16d64402742b866e7c337bc9220427bebf950d16.jpg"
    }
}