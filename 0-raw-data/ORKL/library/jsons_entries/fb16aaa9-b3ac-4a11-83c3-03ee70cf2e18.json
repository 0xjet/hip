{
    "id": "fb16aaa9-b3ac-4a11-83c3-03ee70cf2e18",
    "created_at": "2023-01-12T15:00:43.927061Z",
    "updated_at": "2025-03-27T02:05:54.489926Z",
    "deleted_at": null,
    "sha1_hash": "eb3ab5065bce57e8cd893f7a9242cc63b32f8d39",
    "title": "2014-11-14 - OnionDuke- APT Attacks Via the Tor Network",
    "authors": "",
    "file_creation_date": "2022-05-28T04:55:15Z",
    "file_modification_date": "2022-05-28T04:55:15Z",
    "file_size": 305756,
    "plain_text": "# January 2004 to September 2015\n\n**f-secure.com/weblog/archives/00002764.html**\n\n[<<<](https://www.f-secure.com/weblog/archives/00002762.html) NEWS FROM THE LAB - Friday, November 14, 2014 [>>>](https://www.f-secure.com/weblog/archives/00002765.html)\n\n**[ARCHIVES |](https://www.f-secure.com/weblog/archives/)** **[SEARCH](https://www.bing.com/search?q=site:f-secure.com/weblog)**\n\n**[OnionDuke: APT Attacks Via the Tor Network](https://www.f-secure.com/weblog/archives/00002764.html)** Posted by FSLabs @ 05:00 GMT\n\nRecently, [research was published identifying a Tor exit node, located in Russia, that was](http://www.leviathansecurity.com/blog/the-case-of-the-modified-binaries/)\nconsistently and maliciously modifying any uncompressed Windows executables\ndownloaded through it. Naturally this piqued our interest, so we decided to peer down\nthe rabbit hole. Suffice to say, the hole was a lot deeper than we expected! In fact, it\nwent all the way back to the notorious Russian APT family MiniDuke, known to have\nbeen used in targeted attacks against NATO and European government agencies. The\nmalware used in this case is, however, not a version of MiniDuke. It is instead a\nseparate, distinct family of malware that we have since taken to calling OnionDuke. But\nlets start from the beginning.\n\nWhen a user attempts to download an executable via the malicious Tor exit node, what\nthey actually receive is an executable \"wrapper\" that embeds both the original\nexecutable and a second, malicious executable. By using a separate wrapper, the\nmalicious actors are able to bypass any integrity checks the original binary might\ncontain. Upon execution, the wrapper will proceed to write to disk and execute the\noriginal executable, thereby tricking the user into believing that everything went fine.\nHowever, the wrapper will also write to disk and execute the second executable. In all\nthe cases we have observed, this malicious executable has been the same binary\n(SHA1: a75995f94854dea8799650a2f4a97980b71199d2, detected as TrojanDropper:W32/OnionDuke.A). This executable is a dropper containing a PE resource that\n\n\n-----\n\npretends to be an embedded GIF image file. In reality, the resource is actually an\nencrypted dynamically linked library (DLL) file. The dropper will proceed to decrypt this\nDLL, write it to disk and execute it.\n\nA flowchart of the infection process\n\nOnce executed, the DLL file (SHA1: b491c14d8cfb48636f6095b7b16555e9a575d57f,\ndetected as Backdoor:W32/OnionDuke.B) will decrypt an embedded configuration\n(shown below) and attempt to connect to hardcoded C&C URLs specified in the\nconfiguration data. From these C&Cs the malware may receive instructions to download\nand execute additional malicious components. It should be noted, that we believe all five\ndomains contacted by the malware are innocent websites compromised by the malware\noperators, not dedicated malicious servers.\n\nA screenshot of the embedded configuration data\n\n\n-----\n\nThrough our research, we have also been able to identify multiple other components of\nthe OnionDuke malware family. We have, for instance, observed components dedicated\nto stealing login credentials from the victim machine and components dedicated to\ngathering further information on the compromised system like the presence of antivirus\nsoftware or a firewall. Some of these components have been observed being\ndownloaded and executed by the original backdoor process but for other components,\nwe have yet to identify the infection vector. Most of these components don't embed their\nown C&C information but rather communicate with their controllers through the original\nbackdoor process.\n\nOne component, however, is an interesting exception. This DLL file (SHA1\nd433f281cf56015941a1c2cb87066ca62ea1db37, detected as\nBackdoor:W32/OnionDuke.A) contains among its configuration data a different\nhardcoded C&C domain, overpict.com and also evidence suggesting that this\ncomponent may abuse Twitter as an additional C&C channel. What makes the\noverpict.com domain interesting, is it was originally registered in 2011 with the alias of\n\"John Kasai\". Within a two-week window, \"John Kasai\" also registered the following\ndomains: airtravelabroad.com, beijingnewsblog.net, grouptumbler.com, leveldelta.com,\nnasdaqblog.net, natureinhome.com, nestedmail.com, nostressjob.com, nytunion.com,\noilnewsblog.com, sixsquare.net and ustradecomp.com. This is significant because the\ndomains leveldelta.com and grouptumbler.com have previously been identified as C&C\ndomains used by MiniDuke. This strongly suggests that although OnionDuke and\nMiniDuke are two separate families of malware, the actors behind them are connected\nthrough the use of shared infrastructure.\n\nA visualization of the infrastructure shared between OnionDuke and MiniDuke\n\nBased on compilation timestamps and discovery dates of samples we have observed,\nwe believe the OnionDuke operators have been infecting downloaded executables at\nleast since the end of October 2013. We also have evidence suggesting that, at least\nsince February of 2014 OnionDuke has not only been spread by modifying downloaded\n\n\n-----\n\nexecutables but also by infecting executables in .torrent files containing pirated\nsoftware. However, it would seem that the OnionDuke family is much older, both based\non older compilation timestamps and also on the fact that some of the embedded\nconfiguration data make reference to an apparent version number of 4 suggesting that\nat least three earlier versions of the family exist.\n\nDuring our research, we have also uncovered strong evidence suggesting that\nOnionDuke has been used in targeted attacks against European government agencies,\nalthough we have so far been unable to identify the infection vector(s). Interestingly, this\nwould suggest two very different targeting strategies. On one hand is the \"shooting a fly\nwith a cannon\" mass-infection strategy through modified binaries and, on the other, the\nmore surgical targeting traditionally associated with APT operations.\n\nIn any case, although much is still shrouded in mystery and speculation, one thing is\ncertain. While using Tor may help you stay anonymous, it does at the same time paint a\nhuge target on your back. It's never a good idea to download binaries via Tor (or\nanything else) without encryption. The problem with Tor is that you have no idea who is\nmaintaining the exit node you are using and what their motives are. VPNs (such as our\n[Freedome VPN) will encrypt your connection all the way through the Tor network, so the](https://www.f-secure.com/en/web/home_global/freedome)\nmaintainers of Tor exit nodes will not see your traffic and can't tamper with it.\n\nSamples:\n\n- a75995f94854dea8799650a2f4a97980b71199d2\n- b491c14d8cfb48636f6095b7b16555e9a575d57f\n- d433f281cf56015941a1c2cb87066ca62ea1db37\n\nDetected as: Trojan-Dropper:W32/OnionDuke.A, Backdoor:W32/OnionDuke.A, and\nBackdoor:W32/OnionDuke.B.\n\n[Post by â€” Artturi (@lehtior2)](https://www.twitter.com/lehtior2)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2014/2014-11-14 - OnionDuke- APT Attacks Via the Tor Network.pdf"
    ],
    "report_names": [
        "2014-11-14 - OnionDuke- APT Attacks Via the Tor Network.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535643,
    "ts_updated_at": 1743041154,
    "ts_creation_date": 1653713715,
    "ts_modification_date": 1653713715,
    "files": {
        "pdf": "https://archive.orkl.eu/eb3ab5065bce57e8cd893f7a9242cc63b32f8d39.pdf",
        "text": "https://archive.orkl.eu/eb3ab5065bce57e8cd893f7a9242cc63b32f8d39.txt",
        "img": "https://archive.orkl.eu/eb3ab5065bce57e8cd893f7a9242cc63b32f8d39.jpg"
    }
}