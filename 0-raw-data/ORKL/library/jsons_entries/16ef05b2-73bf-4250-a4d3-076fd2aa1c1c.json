{
    "id": "16ef05b2-73bf-4250-a4d3-076fd2aa1c1c",
    "created_at": "2023-01-12T15:01:50.716319Z",
    "updated_at": "2025-03-27T02:09:30.169189Z",
    "deleted_at": null,
    "sha1_hash": "27de8cc561c5a4e2a15beb83b5ad2adcd16df906",
    "title": "2016-09-21 - Reversing GO binaries like a pro",
    "authors": "",
    "file_creation_date": "2010-08-25T10:00:24Z",
    "file_modification_date": "2010-08-25T10:00:24Z",
    "file_size": 524106,
    "plain_text": "# The Stuxnet Worm and Options for Remediation\n\n## Andrew Ginter, Chief Security Officer, Industrial Defender\n Last updated: August 23, 2010\n\nWe encourage distribution of the information in this document to support knowledge sharing and\nto enable further discussion and discovery.\n\nThe content of this document is licensed under a Creative Commons Attribution- Share Alike 3.0 License\n<http://creativecommons.org/licenses/by-sa/3.0/>\n\nAdditionally, permission is also granted to copy, distribute and/or modify content in this document under the terms of the\nGNU Free Documentation License <http://www.gnu.org/licenses/fdl.txt>\n\nPlease do not use any text selectively in order to misrepresent Industrial Defender's position. Legal action may be taken if\nthis occurs.\n\nPlease contact mktg@industrialdefender.com for additional information.\n\n\n-----\n\n**Table of Contents**\n\n1: Introduction .......................................................................................................................... 2\n\n2: Variants and Naming ........................................................................................................... 3\n\n3: LNK Vulnerability ................................................................................................................. 3\n\n4: Stuxnet Propagation ............................................................................................................ 4\n\n5: Evidence of Compromise .................................................................................................... 5\n\n6: Signed Code ........................................................................................................................ 6\n\n7: Network Operations ............................................................................................................. 6\n\n8: Stuxnet Targets Siemens PCS 7 Systems ........................................................................... 7\n\n9: Geographic Distribution ....................................................................................................... 9\n\n10: Remediations ................................................................................................................... 13\n\n10.1: Microsoft Patch for LNK Vulnerability ...................................................................... 15\n\n10.2: Microsoft Tool to Disable Display of File Shortcuts ................................................. 15\n\n10.3: Siemens / TrendMicro Remediation Tool ................................................................. 15\n\n10.4: Siemens Update ...................................................................................................... 16\n\n10.5: Third Party LNK Vulnerability Avoidance Tools ....................................................... 16\n\n10.6: Anti-Virus Tools ........................................................................................................ 16\n\n10.7: Whitelisting / Host Intrusion Prevention Systems .................................................... 17\n\n10.8: Host Intrusion Detection Systems ........................................................................... 18\n\n10.9: Disabling USB Keys ................................................................................................ 19\n\n10.10: Strict Firewall Egress Filtering ............................................................................... 20\n\n10.11: Other Topics ........................................................................................................... 20\n\n11: Conclusions ..................................................................................................................... 21\n\n12: Links ................................................................................................................................ 21\n\n\n-----\n\n1: Introduction\nOn June 17, 2010, the makers of the VirusBlokAda anti-virus product in Belarus identified a new\nworm. The worm was significant in that it propagated via a previously unknown vulnerability in the\nmethod that all versions of Microsoft Windows operating systems, since at least Windows NT,\nhandled file shortcut or “.LNK” files. Further, the malware was signed by a RealTek certificate. On\nJuly 14, Frank Boldewin, a security expert in Germany, investigated the worm further and\ndiscovered that the worm targeted Siemens WinCC control system components, part of the\nSiemens PCS 7 control system solution.\n\nThis combination of characteristics:\n\n� Using an unknown and un-patched vulnerability to compromise machines,\n\n� Being signed with a certificate from a well-known vendor, presumably stolen, and\n\n� A sophisticated attack on industrial control systems components,\n\nmade the worm very unusual. Later analysis by Symantec identified the worm as the first control\nsystem “rootkit” – a piece of software that modifies the behavior of a control system and disguises\nitself from detection. This paper summarizes what is known about the worm at the time of writing,\nand describes ways to protect industrial control systems from the worm.\n\n2: Variants and Naming\nThe VirusBlokAda paper used a number of terms to refer to the worm. Components of the worm\nwere identified as “Rootkit.TmpHider” and “Rootkit.TmpHider.2,” presumably because when\npropagating via USB sticks and network shares, the worm embeds itself in “.tmp” files. By the\ntime Microsoft published their advisory, a majority of labs with signatures published for the worm\nhad dubbed it “Stuxnet.” Microsoft identified the “TmpHider” and “TmpHider.2” components of the\nworm as “Stuxnet.A” and “Stuxnet.B”.\n\nThis first Stuxnet.A/B variant of the worm was signed with a RealTek certificate. On July 17,\nESET labs announced that they had found a second variant of the worm, signed with a JMicron\ncertificate. On July 23, Kaspersky labs reported that their anti-virus products were reporting over\n40,000 computers infected with Stuxnet.A/B, but only two machines infected with the JMicronsigned variant. Little has been published about the variant and differing naming conventions for\nthe variant exist.\n\nSymantec reports that it has analyzed some four variants of the Stuxnet worm. The oldest dates\nfrom June, 2009. The worm appears to have been under steady development by a professional\nteam for at least the last 12 months.\nMost of the information in this report relates to the Stuxnet.A/B variant.\n\n3: LNK Vulnerability\nThe Microsoft Windows LNK vulnerability appears evident in all versions of Windows operating\nsystems, back to at least Windows NT 4.0. The vulnerability is related to the rendering of icons in\nthe Windows Explorer “shell” for certain file shortcuts. It seems that when the shell renders icons\nfor certain shortcuts, the shell activates code in the files to which the shortcuts refer. Stuxnet code\nis initially activated this way.\n\nThe Stuxnet worm uses the LNK vulnerability when the worm propagates via USB mass storage\nmedia, such as USB flash sticks. The Stuxnet code is activated by viewing the Stuxnet shortcuts\nin Windows Explorer. On the surface, this sounds similar to many other worms which propagate\nvia USB sticks. Those worms use the “autorun.inf” file to trigger execution of the malware; a\ncommon protection against such worms is to instruct Windows not to run the autorun files when\n\n\n-----\n\nmedia is attached to USB ports or even CD drives. This autorun.inf protection does not prevent\nStuxnet from running – you activate the Stuxnet code by having Windows Explorer display the\nStuxnet shortcut icons.\n\nThe same vulnerability can be triggered anywhere that file shortcut icons are displayed – on the\nhard disk, on network shares and on WebDAV shares. More recently, there are reports that the\nvulnerability can be triggered by file shortcuts embedded in Microsoft Office documents, other\nkinds of files and even electronic mail. Other kinds of malware have also started using the LNK\nvulnerability to propagate.\n\n**_Note: The ICS-CERT and Microsoft advisories on the LNK vulnerability are easy to misinterpret._**\nNeither list Windows NT, Windows 2000 or Windows XP SP2 as affected by the vulnerability. The\nreason for the omission is that these platforms are out of support by Microsoft. The platforms are\nin fact affected by the vulnerability, and are still widely used in industrial control systems.\n\n**_Note: The Microsoft advisory indicates that “program information files” (PIF) can be abused to_**\ntrigger the execution of malware, in much the same way as LNK files can be abused. PIF files\nhowever, are not used by Stuxnet to propagate, and so are not treated in depth in this discussion\nof Stuxnet.\n\n4: Stuxnet Propagation\nStuxnet moves between computers on USB sticks, via network shares, and via an older Microsoft\nRPC vulnerability.\n\nIf you look at an infected USB stick on a Linux machine, or a Windows machine protected to the\npoint where it cannot run the software on the USB stick, you will see files:\n\nCopy of Copy of Copy of Copy of Shortcut to.lnk\n\nCopy of Copy of Copy of Shortcut to.lnk\n\nCopy of Copy of Shortcut to.lnk\n\nCopy of Shortcut to.lnk\n\n~wtr4132.tmp\n\n~wtr4141.tmp\n\nThe LNK files are the malicious file shortcuts, all referring to “~wtr4132.tmp.” The TMP files\ncontain the code of the worm. If you attach another USB stick to a compromised machine, these\nfiles are usually copied to the stick. The version of Stuxnet Industrial Defender tested would not\ncreate these files on an empty USB stick, but would create them if the stick contained a number\nof other files.\n\n**_Note: The “does not write to empty USB sticks” is not behavior you should rely on._**\n\nOnce a machine is compromised, the Stuxnet worm renders the TMP and LNK files on the USB\nstick invisible to Windows Explorer. If you watch closely while Stuxnet compromises a machine,\nyou may see the files briefly displayed in Windows Explorer, and then disappear a number of\nseconds later.\n\nWhen propagating via USB sticks, the worm counts how many “hops” it has made between\nmachines. After three hops, the worm erases itself from the USB stick and from the machine it\nhas just infected. This feature was likely designed to limit the geographic spread of the worm.\n\n\n-----\n\nSymantec reports that Stuxnet also propagates via network shares to which the compromised\nmachine has permission to write to. The worm is said to store a file named:\n\nDEFRAG[random number].tmp\n\nin the root folder of any “Admin$” share the worm finds. These shares are invisible administrative\nshares created by default on many file servers. To activate the TMP file on that share, the worm\ncontacts the share server over the network and schedules execution of the TMP file, making\nremote use of the Windows task scheduler.\n\nAnd finally, the worm also propagates across local area networks using the Microsoft MS08-067\nRPC vulnerability. That vulnerability is also used by Conflicker and other worms, and a patch has\nbeen available for the vulnerability since 2008.\n\n5: Evidence of Compromise\nWhen the Stuxnet worm compromises a Windows machine, it does many things, including\ncreating files, creating and starting services, and hiding code inside of apparently benign\nprocesses in memory. The easiest changes to identify are the creation of files:\n\n%SystemRoot%\\system32\\drivers\\mrxcls.sys\n\n%SystemRoot%\\system32\\drivers\\mrxnet.sys\n\n%SystemRoot%\\inf\\oem6c.pnf\n\n%SystemRoot%\\inf\\oem7a.pnf\n\nUnlike the masked LNK and TMP files on USB sticks, these files are visible to Windows Explorer.\nThe worm also creates two services:\n\nMRXCLS\n\nMRXNET\n\nand creates a number of registry keys in:\n\nHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\MRxCLS\n\nHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\MRxNET\n\nThe services, however, are not visible in the Control Panel / Administrative Tools / Services tool.\n\nIn addition, there are indications in the worm code that the worm checks for the presence of antivirus systems on compromised equipment and may disable those systems. If a system has been\ncompromised and owners are removing the worm, owners should check that any anti-virus\nprotections which should be active on the machine are still working.\n\n6: Signed Code\nThe mrxcls and mrxnet drivers are signed because Windows Vista prompts you if drivers you are\ninstalling are not signed with a trusted certificate, and Windows 7 refuses to install drivers which\nare not signed this way. Most of the Stuxnet worms circulating are signed with a RealTek\ncertificate. Verisign has confirmed that the certificates were legitimate – they were legitimately\nissued to representatives of RealTek and JMicron. Both certificates have been revoked, but this\nonly means that no new code can be signed with them, not that signatures on existing code have\nbecome invalid.\n\n\n-----\n\nNo one knows for sure how the malware came to be signed with certificates legitimately issued to\nthese firms. There is speculation that since the firms have offices close to each other in an\nindustrial park in Taiwan, that the theft might have been by a corporate insider in that geography.\nOther speculation is that the firms may have been compromised by malware of some sort which\nsteals certificates. For example, the Zeus botnet is known to steal website certificates, but is not\nknown to steal other kinds of certificates.\n\n\n-----\n\n7: Network Operations\nSymantec reports that once the worm has compromised a machine, it contacts a command and\ncontrol (C&C) server on port 80 at one of the DNS addresses:\n\nwww . mypremierfutbol . com\n\nwww . todaysfutbol . com\n\nSome variants of the worm also contain hard-coded IP addresses which are identical to the IP\naddresses these DNS entries once resolved to. The two IP addresses involved identified two\nC&C servers – one in Malaysia and one in Denmark. Symantec reports that it worked with\nagencies to redirect the C&C DNS entries to benign IP addresses. The benign addresses are\nnow being used to count infected machines and to work with authorities in different countries to\nassist in cleaning up the infection.\n\n**_Note: Symantec cautions that the Stuxnet worm is easily reconfigured to use different IP_**\naddresses and DNS entries to contact its C&C servers. No such variants have yet been identified.\nHowever, users should not be complacent because the existing versions of the worm have been\nfrustrated in their attempts to contact a C&C server.\n\nSymantec further reports that the worm sends basic information about the compromised host to\nthe C&C server, including:\n\n� Windows version information,\n\n� Computer name,\n\n� Network group name,\n\n� A flag as to whether the WinCC software is installed or not, and\n\n� IP addresses of all network interfaces.\n\nThe information is sent encrypted to the URL:\n\nhttp://<C&C server address>/index.php?data=<encrypted data>\n\nThe server responds with either a command to execute a remote procedure call on the\ncompromised host, or with a download of a new DLL for the worm to download and execute. The\nremote procedure calls include:\n\n� Read a file\n\n� Write to a file\n\n� Delete a file\n\n� Create a process\n\n� Inject a .dll into lsass.exe\n\n� Load an additional .dll file\n\n� Inject code into other processes\n\n� Update the configuration data for the worm\n\nNo information has been published as to whether any of these RPCs were activated on\ncompromised hosts, or whether additional dll files have been discovered to have been\ndownloaded to those hosts.\n\n\n-----\n\n8: Stuxnet Targets Siemens PCS 7 Systems\n\nFigure 1: Siemens PCS 7 System Structure\n\nStuxnet targets computers running the WinCC Human / Machine Interface (HMI) components of a\nSiemens PCS 7 control system. In process control systems, HMIs display graphic analogues of\nthe physical process to a plant operator, animating the graphics with the latest real-time data\nacquired from Programmable Logic Controllers (PLCs). The sensors and controllers in the\nphysical process are wired into the PLCs. In addition, operators can manipulate the graphic user\ninterface to change the physical process, for example: start pumps, close valves, increase\npressures, and so on. The HMI translates those graphic manipulations into low-level commands\nand sends those commands to the PLCs. Note that PLCs are generally not Windows computers\nand so are not of themselves vulnerable to direct compromise by the Stuxnet worm.\n\nEvery WinCC component uses the Microsoft SQLServer database to store information. The\ndatabase runs on the same machine as the WinCC software. The WinCC software uses a hardcoded password to access the SQLServer database. Users are not able to change this “vendor\npassword,” since the password is embedded in the WinCC product. If users were to change the\npassword in the SQLServer database, the WinCC components would malfunction, as they would\nno longer be able to contact the database.\n\nWhen Stuxnet takes over a machine, it checks to see if the machine is running WinCC software.\nIf so, the worm opens a connection to the SQLServer database on the machine using the vendor\npassword. Frank Boldewin, the security researcher who first published that the worm targets\nSiemens control systems, has published SQL queries embedded in the worm. His analysis is that\nif those embedded queries execute, they will extract IP addresses and port numbers of other\nWinCC machines that are connected up in the PCS 7 system. The SQLServer database on\nWinCC hosts can by default accept connections from other hosts on the same network using the\nvendor password. There is no indication that the worm uses this capability.\n\n\n-----\n\nSymantec has published an analysis of the worm's capabilities as well. Symantec reports that the\nworm contains a wrapper for the Siemens “s7otbxdx.dll”. This dll is used by WinCC to\ncommunicate with PLCs. The wrapper exports exactly as many functions as the real dll. Some of\nthese functions simply pass control directly into the real dll without changing any data, and other\nfunctions either manipulate inputs before passing them on to the real dll, or manipulate the\noutputs of the real dll. The set of functions which manipulate inputs or outputs is listed below:\n\n� s7_event\n\n� s7ag_bub_cycl_read_create\n\n� s7ag_bub_read_var\n\n� s7ag_bub_write_var\n\n� s7ag_link_in\n\n� s7ag_read_szl\n\n� s7ag_test\n\n� s7blk_delete\n\n� s7blk_findfirst\n\n� s7blk_findnext\n\n� s7blk_read\n\n� s7blk_write\n\n� s7db_close\n\n� s7db_open\n\n� s7ag_bub_read_var_seg\n\n� s7ag_bub_write_var_seg\n\nThese functions are related to PLC programming. With these function wrappers, Symantec has\nidentified Stuxnet as “the first known rootkit for SCADA devices.” Symantec and other\nresearchers report that if a PLC program has been modified in a certain way, these wrappers act\nto hide the modification from users trying to examine the PLC program from a compromised\nWindows host. Any user looking at the PLC from a programming tool on the compromised WinCC\nhost makes request to see the list of function blocks in the PLC, using the wrapped functions\nabove. If the programming tool requests all the function blocks for display, but the return values\nfrom the library are modified by the wrapper to exclude the malicious function blocks, those\nblocks are invisible to the programming tool, and so are invisible to the user using the\nprogramming tool.\n\n\n-----\n\nFigure 2 Hiding Compromised PLC Programs\n\nThe Stuxnet worm is reported to contain some 70 function blocks which it is able to download\ninto PLCs. Details of the effects of these function blocks are not yet available.\n**_Note: If your PCS7 control system has been compromised by Stuxnet, it is not enough to clean_**\nout the compromised machines or rebuild those machines from scratch. Anyone cleaning out a\ncompromised control system must also examine all S7 PLCs in the control system from an\nuncompromised computer and determine whether there are any illegitimate function blocks in the\nPLC.\n\n9: Geographic Distribution\nOn July 15, Kaspersky Labs, the Russian anti-virus vendor, reported over 5,000 compromised\nmachines with a geographic distribution as follows:\n\n\n-----\n\nFigure 3: July 15 Kaspersky Labs Infection Data\n\nOn July 16, the Microsoft Protection Center reported detecting and rejecting infection attempts at\nsome 1000 machines per day. Less than .02% of all machines globally, which Microsoft monitors,\nreport infection attempts daily. Microsoft reports a significant rate of infection attempts in the USA,\nbut when you normalize the infection attempts by the number of monitored machines in each\ngeography, Microsoft reports infection attempts as follows:\n\nFigure 4: July 16 Microsoft Infection Attempt Data\n\n\n-----\n\nOn July 17, ESET, the French anti-virus vendor reported infections distributed geographically as\nfollows:\n\nUnited States 57.71%\n\nIran 30.00%\n\nRussia 4.09%\n\nIndonesia 3.04%\n\nFaroe Islands 1.22%\n\nUnited Kingdom 0.77%\n\nTurkey 0.49%\n\nSpain 0.44%\n\nIndia 0.29%\n\nRest of the world 1.73%\n\nFigure 5: July 18 ESET Infection Data\n\nESET published only these percentages, not a total count of infected machines.\n\nOn July 22, Symantec reported over 14,000 distinct IP addresses harvested from the benign IP\naddresses which were substituted for the real C&C servers. The geographic distribution of those\naddresses was as follows:\n\nFigure 6: July 22 Symantec Compromised Host IP Address Data\n\nThe IP address data can be misleading. A compromised host can contact a C&C server only if it\nis on a network with connectivity to the open internet.\n\nOn July 23, Kaspersky Labs reported over 45,000 infected machines, with about 1,000 new\nmachines being infected per day:\n\n|United States|57.71%|\n|---|---|\n|Iran|30.00%|\n|Russia|4.09%|\n|Indonesia|3.04%|\n|Faroe Islands|1.22%|\n|United Kingdom|0.77%|\n|Turkey|0.49%|\n|Spain|0.44%|\n|India|0.29%|\n|Rest of the world|1.73%|\n\n\n-----\n\nFigure 7: July 23 Kaspersky Labs Infection Data\n\nThese reports do not agree particularly well. It may be that some of the reported “infection” data\nwas in fact “infection attempt” data. It may also be that some of the anti-virus vendors have\nlimited installed bases in some geographies, thus skewing their statistics. To the extent that they\nagree, it is clear that the most-impacted countries are India, Indonesia and Iran. There is\ndisagreement as to what extent computers in the USA were affected.\n\n10: Remediations\nWhenever the Stuxnet worm is discussed, the question “What can I do about it?” arises. For end\nusers on home computers, the answer is simple:\n\n� Don't worry about Stuxnet – there are so few infections in the world you are unlikely to\nencounter one.\n\n� Do worry about other more widespread malware taking advantage of the LNK and PIF\nvulnerabilities. Make sure you have an anti-virus system installed. All credible anti-virus\nvendors now have signatures for the LNK and PIF vulnerabilities and many have\nsignatures for the Stuxnet worm.\n\n� A Microsoft patch for the LNK and PIF vulnerabilities has been available since August 2,\ninstall the patch and you should be well-protected.\n\nFor corporate networks the answer is similar, though it may take corporate IT teams a little longer\nto test and distribute the Microsoft patch.\n\nFor sites running industrial control systems, the question is quite a bit more involved. What you\nshould do depends very much on how vulnerable your control systems are, how stringent your\nsafety and availability requirements are, and what your existing security program looks like.\n\nThere is an incredible variety among control system security postures. Some systems are more\nor less managed like corporate IT systems – well patched, protected by anti-virus and other\nmodern protections, with signatures updated regularly. Such systems will be protected as soon as\nthe new anti-virus signatures make it through their site's change control processes. Other sites\nare running old versions of operating systems without anti-virus, and cannot patch those systems\n\n\n-----\n\ndue to the risk of causing a malfunction, or because the sites will breach the terms of their vendor\nsupport contracts. Still others run anti-virus on their older systems but do not update the\nsignatures because they do not have a change control process in place capable of testing new\nsignatures enough to ensure continued correct operation of the control system with new\nsignatures in place.\n\nSome control systems have very stringent safety and availability requirements – think nuclear\nsites, refineries and electric power systems. If things go catastrophically wrong at one of these\nsites there are significant impacts on the public at large. Such sites have very tight change control\nsystems. Every change, however small, must be evaluated as to the risk the change poses to the\ncorrect operation of the physical process. Yes, the overall control system has many layers of\nredundant safety systems, and the HMI is only one of these layers, but nobody should use that as\na reason to be complacent about changes to the HMI workstations.\n\nAnd finally, different sites have different degrees of security programs. Some sites have programs\nwhich are well thought through, comprehensive, regularly assessed for compliance to the site\nsecurity policy, and reviewed and updated as the threat environment, or available security\napproaches change. Other sites may have much less well thought-through programs, and\nunfortunately there are still some industries where control system security is still very much an\nafterthought, especially smaller sites.\n\nThe short story as to what industrial sites should do in light of the Stuxnet threat is easy: reevaluate your security posture in light of this new threat. If a site does not have the expertise inhouse to do this, they will need to bring in a qualified outside party. Depending on the existing\nsecurity posture, sites should expect the re-evaluation to result in recommendations ranging from\n“don't worry, you're good already” to “you need significant improvements to your security\nprogram.” Industry experts are nearly unanimous in agreeing that the right security posture for\nindustrial sites is a “defense-in-depth” posture, with layers of defenses including policies,\nprocedures, training, physical security, computer security, personnel screening and many other\nelements. A detailed description of a defense-in-depth security program is beyond the scope of\nthis report. Interested readers are referred to any of:\n\n� NIST 800-82: Guide to Industrial Control Systems (ICS) Security\n\n� ISA SP-99 Security for Industrial Automation and Control Systems – Part 1: Terminology,\nConcepts and Models\n\n� Department of Homeland Security: Catalog of Control Systems Security:\nRecommendations for Standards Developers\n\nIn the course of re-evaluating their security posture, industrial sites may wish to consider the\nfollowing remediations. Note that while the focus of this report has been the Stuxnet worm and\nsome of the remediations below are specific to the worm, sites should consider that the worm is\nonly one example – the first example – of an advanced threat to control systems. Industrial sites\nare at risk from all kinds of malware, not only Stuxnet. Even if most other kinds of malware do not\ntarget control systems specifically, such systems will still be affected by any malware which takes\nover a machine, affected in ways that are difficult to predict. If a site is poorly protected against\nrun-of-the-mill malware, the site should strengthen those protections, as well as considering\nspecific protections against the Stuxnet worm.\n\nThe following sections discuss specific remediation options.\n\n10.1: Microsoft Patches\nMicrosoft released a patch for the MS08-067 RPC vulnerability in 2008 and made the patch\navailable for all then-supported operating systems platforms.\n\n\n-----\n\nMicrosoft released a patch for the MS10-046 LNK and PIF vulnerabilities on August 2, 2010. Only\nnewer versions of Windows operating systems are supported by the patch. In particular, the\nWindows 2000 and Windows XP SP2 versions of the operating system used heavily in industrial\ncontrol systems, are not supported. In addition, many control systems have no effective patch\nprogram or are constrained in what patches they can apply by support contracts with their control\nsystem vendors.\n\nSites which can apply these patches should expect to be protected against any exploit of the\nRPC, LNK and PIF vulnerabilities by the patch. A strong patch program generally should protect a\nsite against much malware. Exceptions to the protections patches offer include zero-day threats,\ninsider attacks and threats like trojans which persuade authorized users to download and run\nthem.\n\n10.2: Microsoft Tool to Disable Display of File Shortcuts\nMicrosoft has released a tool at:\n\nMicrosoft tool: http://support.microsoft.com/kb/2286198\n\nWhich disables the display of file shortcuts, thus preventing the exploit of the LNK and PIF file\nvulnerability. Users who have tried the tool are unanimous in their rejection of it – the tool makes\nWindows operating systems extremely difficult to use.\n\n10.3: Siemens / TrendMicro Remediation Tool\nSiemens has published instructions on how to use the TrendMicro “Sysclean” tool to remove the\nStuxnet worm from compromised systems:\n\nhttp://support.automation.siemens.com/WW/view/en/43876783\n\n**_Note: Siemens recommends that users contact their specific support organizations before using_**\nthe remediation tool. Control systems generally, PCS 7 included, tend to be highly customized.\nSiemens, like most responsible control systems vendors, cannot recommend that any specific\nchange be made safely to a highly customized control system. It is only the technical people\nfamiliar with a particular customization who have the test bed and procedures to test if it is safe to\napply the Siemens tool on a particular control system.\n\nUse of the remediation tool does not protect a site from compromise by the Stuxnet worm. The\ntool is designed to remove the worm from a compromised machine. There are no reports yet as\nto the effectiveness of the tool.\n\n10.4: Siemens Update\nSiemens has issued an update to their WinCC software which:\n\n� Modifies registry settings according to the Microsoft security advisory for the LNK and PIF\nvulnerabilities, and\n\n� Tightens up SQLServer security settings, especially for client authentication.\n\n**_Note: Applying this Siemens update will disable viewing of file shortcut icons just as the Microsoft_**\ntool does. This may make control system user interfaces on affected machines much harder to\nuse.\n\n\n-----\n\n10.5: Third Party LNK Vulnerability Avoidance Tools\nSophos and Surfright have released tools to prevent exploitation of the vulnerability without\ndisabling most Windows icons:\n\nhttp://www.sophos.com/shortcut\n\nhttp://hitmanpro.wordpress.com/2010/07/30/hitman-pro-lnk-exploit-protection-released/\n\nFeedback on the Sophos tool is that it protects against LNK exploits only when both the shortcut\nfile and the file target are on external media. Neither tool protects against the PIF vulnerability.\n\n10.6: Anti-Virus Tools\nControl systems with anti-virus products installed and virus signatures current should already be\nprotected against malicious shortcut files and the Stuxnet worm. Sites with anti-virus products\ninstalled but without current signatures should have a comparatively easy time of acquiring some\ndegree of protection. New signatures need to be run through the change control system,\nreviewed, tested, and applied.\n\nSites with existing control systems lacking installed anti-virus products may not find anti-virus\ntechnology to be their best option to retrofit protection. Sites must first determine if their vendors\nrecommend or support running their versions of control systems with anti-virus products. If the\nvendors support the products, the sites will need to apply a reasonably rigorous testing process to\nensure that the operation of the anti-virus products does not impair the operation of their\nproduction control systems. Indiscriminate application of anti-virus products to existing control\nsystems has historically resulted in component malfunctions and control systems failures.\n\nAnti-virus tools will protect against Stuxnet and other known threats and vulnerabilities. However,\nanti-virus vendors generally do not produce signatures for a threat until between five hundred and\nfive thousands instances of the threat are observed world-wide. Further, anti-virus vendors can\nonly produce signatures for known threats. Thus, anti-virus tools provide good general protection,\nbut cannot protect against previously unknown, or low-volume threats such as attacks targeted at\na specific site.\n\n10.7: Whitelisting / Host Intrusion Prevention Systems\nWhitelisting or host intrusion prevention system (HIPS) products calculate a cryptographic hash\nfor all approved executables in the filesystem on a machine. Whenever the operating system tries\nto load an executable file, including DLL libraries and other kinds of executables, the hash is\nrecalculated and compared to the list of approved hashes. If there is no entry for the hash, it\nmeans the file being loaded is either not approved to execute, or has been tampered with. HIPS\nsystems are generally configured either to issue a warning in this case and continue execution, or\nto block execution of the unauthorized software.\n\nHIPS products are comparatively new technologies and a good fit for control systems. The\nproducts themselves change very slowly, unlike anti-virus systems which issue new signatures as\noften as several times per day. As a result, HIPS products put less of a change management\nburden on industrial sites. Further, HIPS products protect against even low-volume and zero-day\nattacks, because malware software is never on the approved list of cryptographic hashes for a\nprotected machine.\n\n\n-----\n\nFor example: Industrial Defender labs have tested the Industrial Defender HIPS product with a\nlive copy of the Stuxnet worm and confirmed that the HIPS product prevented compromise of the\nprotected machine.\n\nFigure 8: Industrial Defender HIDS Results for Stuxnet Worm\n\nThe HIPS system simply reports blocking the execution of the file “~wtr4132.tmp” every time a\nWindows Explorer renders icons on a compromised USB stick.\n\nHIPS products have been criticized in enterprise applications because of the extra work required\nto keep the approved application list current as new patches and new software are frequently\ninstalled. This concern does not apply to most control systems. HIPS products check executables\nwhen they are loaded from disk and not all threats come from disk – threats may come from\nnetworks with buffer overflow attacks for example. HIPS products deal with such threats in part by\nobserving that most network-based malware uses the network shell code only to pull much larger\nexecutable files on to the machine and execute them. Execution of this second stage of the\nmalware is then blocked by the HIPS. Further, most HIPS products have one form or another of\nmemory protection, either periodically or in real-time scanning memory for suspicious executables\nthat did not come from disk.\n\nRetrofitting HIPS protections onto an existing control system should be done cautiously, within\nthe confines of a strong change control program. However, customers will likely find the slow\npace of change of HIPS products to be a better fit for existing control systems than would be an\nanti-virus system retrofit on to those systems.\n\n10.8: Host Intrusion Detection Systems\nIf a control system has host intrusion detection systems (HIDS) installed, those systems should\nbe sufficient to alert the site to a compromise by the Stuxnet worm. Industrial sites may use HIDS\nas part of a defense-in-depth strategy to find out whether anything got past their other\nprotections, or they might use HIDS on very sensitive equipment where more intrusive HIPS or\nanti-virus products are considered a poor fit.\n\nIndustrial Defender tested our own HIDS agents with a live Stuxnet worm and saw a burst of\nsome 20 alerts describing unexpected changes to the control system host:\n\nFigure 9: Industrial Defender HIDS Results for Stuxnet Worm\n\n\n-----\n\nThe most obvious indication of Stuxnet compromise were the alerts reporting new mrxnet.sys and\nmrxcls.sys drivers in the system32/drivers folder, as well as the alerts reporting the creation of\ntwo new services.\n\nHIDS products come in many shapes and sizes. Some install agents on the monitored hosts and\nothers monitor hosts remotely. The former tend to be more powerful, since Windows facilities for\nremote monitoring are not as feature-rich as the on-host Windows programming environment.\nFurther, some agents are designed to be non-intrusive, strictly throttling resource usage and\nrunning entirely in user space, while others are more profligate of machine resources and come\nwith new kernel drivers and introduce new execution paths to all monitored software. Retrofitting\nHIDS on to an existing control system may be easier with remote monitoring, since even though\nthe remote monitoring does introduce new execution paths into software on the control system\nhost, those new paths may not be as significant as new paths introduced by host agents.\n\nIn terms of effectiveness, most modern HIDS systems should be powerful enough to detect, but\nnot prevent, compromise by Stuxnet.\n\n10.9: Disabling USB Keys\nMany HIPS products include options to entirely disable the use of removable storage, such as\nUSB flash sticks. Whether or not they use such technology, sites should strongly consider a\npolicy forbidding the use of removable storage on production control system components. There\nis too much malware which propagates via removable storage and this makes it too easy for\nerrors and omissions to change software on production hosts in violation of change management\npolicies.\n\n**_Note: While controlling the use of USB sticks is good policy for many kinds of control system, it_**\nwill not work for some systems, such as some kinds of Siemens S7 systems. USB sticks are the\nonly supported way to move certain kinds of information into some kinds of S7 PLCs.\n\n10.10: Strict Firewall Egress Filtering\nEgress filtering is the filtering of outbound connections from a more trusted to a less trusted\nnetwork. Such filtering is useful against Stuxnet and in fact against many kinds of malware,\nbecause the most powerful modern malware tends to work closely with instructions from a\ncommand and control (C&C) server. In order to contact the server, the malware must connect to\nan IP address on the open internet from the trusted network. If the firewall prohibits connections\nto random IP addresses from the trusted network, the malware does compromise the machine,\nbut cannot receive new instructions or software updates from the C&C server. Further, if the\nfirewall logs such communications attempts and site personnel review the logs, those personnel\nwill be alerted to suspicious communications attempts from trusted IP addresses and can\ninvestigate those hosts for possible compromise.\n\nEgress filtering does not prevent compromise by Stuxnet or by any malware. Egress filtering\nprevents malware on compromised machines from doing any more than their hard-coded\ninstructions. Malware without contact with a C&C server cannot start doing more things or worse\nthings to your control system than was originally programmed in the malware. Monitoring egress\nfiltering logs provides a kind of intrusion detection as well, which can be one layer in a defense-indepth posture.\n\n10.11: Other Topics\nThere are many aspects to a strong security program. Sites re-evaluating their security posture\ngenerally, rather than specifically for this one kind of threat, may want to consider in addition\nmeasures like the following:\n\n\n-----\n\n� Keeping a site compliant with a mature security program can add up to enough effort to\nkeep one or more full-time security personnel busy. Consider managing or reducing\nthose costs with a compliance management system. Such systems help a site reduce\ncosts while still keeping their security posture strong.\n\n� Develop, document and test a strong incident response plan. Even some of the bestprotected sites will be compromised from time to time. When a site is compromised, it is\nimportant to respond quickly and correctly. Such response is only possible if it has been\nthought through and practiced in advance.\n\n� Consider strong protections for control systems hosts – host hardening, patch programs,\nand regular vulnerability assessments.\n\n� Consider strengthening physical security and personnel security measures at industrial\nsites. The authors of this malware have been refining it for some time.\n\n� Outsource the most complex or the most time-consuming security functions to experts\nfocused on industrial security. This lets a site's personnel remain focused on the\nchallenging skill-set which is continued correct operation of the control system, while still\nsupporting a strong security posture.\n\n� And in the long term, work with control systems vendors to make clear to them what\nsecurity measures will be expected in all new control systems products.\n\n\n-----\n\n11: Conclusions\n\nThe Stuxnet worm is very unusual. It is a sophisticated piece of malware that clearly targets\nindustrial control systems in a way that no other malware before it has. The ability of the worm to\nintercept, change, and hide PLC programs is of great concern, as, such changes undetected,\ncould easily disrupt important civilian infrastructure. The best defense against threats lof this type\nis a strong industrial security program, which includes a defense-in-depth security posture.\n\nThe “Remediations” section of this whitepaper describes steps you can take to protect control\nsystems form malware like Stuxnet. Note that for the Stuxnet worm in particular:\n\n  - Patches and the various LNK vulnerability exploit prevention tools will prevent Stuxnet\ninfections now, but these remediations did not exist when Stuxnet began circulating.\n\n  - Anti-virus tools will prevent Suxnet infections now, but had no effect when the worm\nbegan circulating, because signatures for the worm and for the LNK vulnerability had not\nyet been developed and circulated.\n\n  - Host Intrusion Detection Systems would have detected and diagnosed compromise by\nthe Stuxnet worm, but would not have prevented compromise.\n\n  - Disabling USB keys would have prevented infection by Stuxnet, but this measure is not\npractical on most Siemens S7 systems because of the need to use USB keys to\nexchange certain information with S7 PLCs.\n\n  - Firewalls, one-way diodes and other perimeter protections would not have prevented\nStuxnet infections, because the worm propagated primarily via USB keys carried past\nfirewalls by trusted personnel. Strict firewall outbound connection/egress filtering controls\nwould not have prevented compromise by Stuxnet, but would have prevented the worm\nfrom receiving new instructions from the command and control servers.\n\nHost Intrusion Prevention Systems would have prevented compromise, because the Stuxnet\nworm would not have been recognized as an approved and authorized executable, in spite of its\nsignature by a well-known hardware manufacturer. All control system security practitioners should\nbecome familiar with this new technology as quickly as is feasible.\n\nIndustrial Defender provides many of the technologies and services described in the\n“Remediations” section of this report, in an easy-to-use, integrated solution designed specifically\nfor industrial control systems. More information on Industrial Defender solutions, including the\nIndustrail Defender HIPS, are available at the Industrial Defender website. Customers with\nindustrial sites should never hesitate to call upon Industrial Defender to understand how we might\nhelp to improve a security program, now or in the future.\n\n**12: Links**\n\n\n-----\n\nWe encourage distribution of the information in this document to support knowledge sharing and\nto enable further discussion and discovery.\n\nThe content of this document is licensed under a Creative Commons Attribution- Share Alike 3.0 License\n<http://creativecommons.org/licenses/by-sa/3.0/>\n\nAdditionally, permission is also granted to copy, distribute and/or modify content in this document under the terms of the\nGNU Free Documentation License <http://www.gnu.org/licenses/fdl.txt>\n\nPlease do not use any text selectively in order to misrepresent Industrial Defender's position. Legal action may be taken if\nthis occurs.\n\nPlease contact mktg@industrialdefender.com for additional information.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/ICS SCADA/Stuxnet/Stuxnet Worm and Options for Remediation.pdf"
    ],
    "report_names": [
        "Stuxnet Worm and Options for Remediation.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535710,
    "ts_updated_at": 1743041370,
    "ts_creation_date": 1282730424,
    "ts_modification_date": 1282730424,
    "files": {
        "pdf": "https://archive.orkl.eu/27de8cc561c5a4e2a15beb83b5ad2adcd16df906.pdf",
        "text": "https://archive.orkl.eu/27de8cc561c5a4e2a15beb83b5ad2adcd16df906.txt",
        "img": "https://archive.orkl.eu/27de8cc561c5a4e2a15beb83b5ad2adcd16df906.jpg"
    }
}