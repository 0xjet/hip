{
    "id": "ab6abda3-d2ee-4476-b791-8e05fba2615d",
    "created_at": "2023-02-02T02:07:51.488655Z",
    "updated_at": "2025-03-27T02:09:18.087785Z",
    "deleted_at": null,
    "sha1_hash": "fefcc482ea27df5b5bf04d1369258ddc8aeaf057",
    "title": "2023-01-20 - Emotet Returns With New Methods of Evasion",
    "authors": "",
    "file_creation_date": "2023-02-01T07:52:48Z",
    "file_modification_date": "2023-02-01T07:52:48Z",
    "file_size": 2030693,
    "plain_text": "# Emotet Returns With New Methods of Evasion\n\n**[blogs.blackberry.com/en/2023/01/emotet-returns-with-new-methods-of-evasion](https://blogs.blackberry.com/en/2023/01/emotet-returns-with-new-methods-of-evasion)**\n\nThe BlackBerry Research & Intelligence Team\n\n### Summary\n\nEmotet, a Trojan that is primarily spread through spam emails, has been a prevalent issue\nsince its first appearance in 2014. With a network made up of multiple botnets, denoted as\n[“epochs” by security research team Cryptolaemus, Emotet has continuously sent out spam](https://www.zdnet.com/article/meet-the-white-hat-group-fighting-emotet-the-worlds-most-dangerous-malware/)\n[emails in campaigns designed to infect users via phishing attacks. Once it is successfully](https://www.blackberry.com/us/en/solutions/endpoint-security/ransomware-protection/phishing)\n[running on an endpoint, Emotet drops other malicious programs such as Qakbot, Cobalt](https://www.blackberry.com/us/en/solutions/endpoint-security/ransomware-protection/qakbot)\n[Strike, or in some cases, even the notorious Ryuk ransomware. However, as of July 2022,](https://blogs.blackberry.com/en/2022/05/yashma-ransomware-tracing-the-chaos-family-tree)\nthe heavily distributed Malware-as-a-Service (MaaS) seemingly went dark, and no longer\nappeared to be running these spam campaigns.\n\nFor the next four months, Emotet remained silent. Then, on November 2, the Cryptolaemus\ngroup found that its botnets, particularly those known as Epoch4 and Epoch5, had begun\nsending out spam emails once again. These phishing emails used various methods to lure\n\n\n-----\n\nvictims into first opening them, and then downloading and executing .xls files, with macros\nused to download the Emotet dropper. With as little fanfare as when it went dark, it seems\nthat Emotet has returned, appearing to be as malicious as ever.\n\n### Emotet’s Growing Toolbox of Modules\n\nSince its inception, Emotet has continued to steadily evolve, adding new techniques for\nevasion and increasing its likelihood of successful infections. It is also able to host an array\nof modules, each used for different aspects of information theft that report back to their\ncommand-and-control (C2) servers. From process monitoring to grabbing Microsoft®\nOutlook® email addresses, Emotet has been observed to inject both proprietary modules\nand readily available freeware tools, adding and tweaking them over the years with\nalarming effectiveness. More recently, Emotet has added a new Server Message Block\n(SMB) spreader module, used as an effective method for lateral movement once placed on\na target machine.\n\nThe SMB spreader starts this process by gaining the same security privileges as the initial\ntarget account. Once loaded onto a victim’s system, this module begins impersonating that\nuser by duplicating their account token via the SecurityImpersonation level. This gives a\nprocess the same privileges as the current user on that system. With these duplicated\nprivileges, the spreader calls a function “ImpersonateLoggedOnUser” to perform actions in\nthe same security context of the account that is currently logged in. Pseudocode for the use\nof this function can be seen in Figure 1.\n\n_Figure 1 – Pseudocode for SMB Spreader impersonating user (Source: Bitsight)_\n\nFrom here, the module begins enumerating network resources using the WinAPIs\nWnetOpenEnumW and WnetEnumResourceW. Of these resources, it saves any potential\nremote servers to a list. Then, using two additional hardcoded lists (one of common\nusernames, another of common passwords), the spreader will iterate over this list of server\nnames and begin bruteforcing the IPC$ share with the WinAPI WNetAddConnection2W in\nhopes of a successful connection.\n\n\n-----\n\nIf no connection is made with the credentials at hand, the SMB spreader can also attempt to\nseek additional usernames from the server being targeted with the NetUserEnum WinAPI.\nAny potential new usernames found will also be bruteforced with the hardcoded list of\npasswords to login to the IPC$ share.\n\n_Figure 2 – Hardcoded usernames and passwords used in bruteforce attack_\n\nIf a connection succeeds, the spreader finally attempts to connect to either the ADMIN$ and\nC$ shares. From there, it finally copies the Emotet loader to said share and launches it as a\nservice. The service executes with regsvr32.exe, and lateral movement is achieved.\n\nAlong with the SMB spreader, another recently added module is used to target a victim’s\nGoogle Chrome™ browser in the hopes of stealing stored credit card information. While\nEmotet has used other modules for digging out financial information in the past (such as\nNirSoft’s WebBrowser PassView module), Proofpoint found the following decrypted strings\nin early June 2022 that appear to be looking at Chrome™ specifically.\n\n_Figure 3 – Evidence of credit card exfiltration from Chrome (Source: ProofPoint)_\n\n### A Demon at Heaven’s Gate\n\nTo load some of its previously used modules, Emotet has been observed to use an injection\ntechnique known as Heaven’s Gate. Made popular in the mid-2000s, Heaven’s Gate is an\ninfamous method used by malware to bypass Windows® on Windows64 (WoW64) API\nhooks, by taking malicious 32-bit processes to inject into 64-bit processes. This technique\nworks because while many security products monitor file activity by hooking 32-bit APIs\n(CreateFile, WriteFile, OpenFile), when running 64-bit code, an opportunity is presented to\ncompletely bypass many system calls which would render the malicious code segments far\ntoo noisy.\n\n\n-----\n\nIn the interests of backwards compatibility, WoW64 actually allows 32-bit applications to be\nrun on 64-bit systems too. When a 32-bit application is run, both the 32-bit and 64-bit\nversion of ntdll.dll is loaded. While a 32-bit process would normally pass through the 32-bit\nAPI hooks, malicious processes can perform a jump instruction past these hooks in order to\nexecute 64-bit code. This allows the injection of any malicious code to be run without setting\noff immediate alerts via system calls. Windows initially developed this on the assumption\nthat the 64-bit ntdll.dll could not be accessed by a 32-bit process, but Heaven’s Gate takes\nadvantage of this by running x64 instructions which will be completely missed by any\napplication expecting x86 instructions. Heaven’s Gate was therefore an early exploit on 64bit systems that is still used to this day.\n\nOnce through Heaven’s Gate, Emotet loaders will use a technique known as process\nhollowing to suspend a legitimate process, then remap its image with malicious code. The\nmalicious code will then be able to run from the now hollowed out process in order to load\nmodules at will.\n\n### New Trap, New Bait\n\nWith the newest wave of Emotet spam emails, the attached .xls files have a new method for\ntricking users into allowing macros to download the dropper. In addition to this, new Emotet\nvariants have now moved from 32bit to 64bit, as another method for evading detection. It\nseems that Emotet has utilized its time offline to refine/retool itself and come back with\nstronger attacks and more intricate methods of spreading than ever before. We’ll go into\nmore detail on this below.\n\n### Operating System\n\n Risk and Impact\n\n Technical Analysis\n\n\n-----\n\nStudying Emotet s most recent campaign, it s clear that a variety of different emails have\nbeen generated to lure victims into downloading the malicious attachment. While this\nmethod of infection is certainly nothing new, there appears to be one clever twist in the\nthreat actor’s attempts to convince users to compromise their own machines.\n\nWhen a user downloads an .xls attachment from one of these phishing emails, the infection\nvector is entirely dependent on the user enabling macros to download the Emotet dropper.\nNow, all files downloaded from the Internet, including email attachments such as Excel®\nfiles, are given a special flag from Microsoft by default. Known as a Mark-of-the-Web\n(MOTW) flag, this is a security feature originally introduced by Internet Explorer® to force\nsaved web pages to run in the same security zone that the page was saved from. What this\ndoes is it basically forces programs to treat certain types of files more cautiously. For\ninstance, an Excel file bearing a MotW flag will be opened in Protected View, which\nautomatically disables macros; this is very bad news for Emotet.\n\nIn order to bypass this built-in security functionality, Emotet infections rely instead on good\n[old-fashioned social engineering to manually override these protections. Users are finally](https://blogs.blackberry.com/en/2016/12/social-engineering-beware-strangers-with-candy)\ngetting more savvy when it comes to identifying suspicious attachments, but this new\nvariant does something particularly sneaky. In an .xls attachment\n(ef2ce641a4e9f270eea626e8e4800b0b97b4a436c40e7af30aeb6f02566b809c) sent in this\nnew spam campaign conducted by the Epoch4 botnet, users are instructed to move the\nnewly-downloaded file into Excel’s ‘Templates’ folder, as shown below in Figure 4.\n\nSeeing as this folder is automatically trusted by Microsoft, any file executed from here is\nignored by the Protected View functionality, allowing any macros to run without hinderance.\n\n_Figure 4 – Message displayed to convince users to bypass Protected View_\n\nOnce the macros are run, they reach out to the Internet to download and execute the\nEmotet malware. Looking at Figures 5 and 6, you can see the macros used by the .xls file,\nas well as the malicious URLs used to download Emotet. In Figure 7, you can see the\nmacros from a different variant of this .xls file\n(199a2e0e1bb46a5dd8eb3a58aa55de157f6005c65b70245e71cecec4905cc2c0) reaching\nout to alternate web URLS.\n\n\n-----\n\n_Figure 5, 6, and 7 – URLs used by macros to download Emotet droppers_\n\nFrom here, the Emotet dropper is downloaded to a randomly generated folder under\n%UserProfile%\\AppData\\Local as a .dll file. This .dll file is also given a randomly generated\nname. Once downloaded, macros use regsvr32.exe to execute Emotet, as shown in Figure\n8.\n\n_Figure 8 – Execution of Emotet dropper via regsvr32.exe_\n\n_Figure 9 – Registry key created for persistence_\n\nAt this point, Emotet will run in the background, reaching out to its C2 server in order to\ndownload additional malware. It also achieves persistence on the system by creating the\nregistry key shown in Figure 9 so that it may stay active on the local machine, awaiting\nfurther instruction.\n\n\n-----\n\n### The Endgame of Emotet\n\nEmotet, as a MaaS, focuses on the spreading of other malware. Considered to be one of\nthe most widely disseminated malware distributors, its resurgence has been met with great\nconcern by the industry. With the introduction of more insidious variants designed to bypass\nautomatic security checkpoints, it now appears that its dropper is being used to download\nbanking Trojan IcedID. It achieves this by downloading an installer, which then downloads a\nseparate binary file from the URL hxxps[:]//bayernbadabum[.]com/botpack[.]dat in order to\ndrop the final payload onto the victim’s machine.\n\n_Figure 10 – URL used to download IcedID banking Trojan_\n\nAs if Emotet’s inbuilt module for stealing credit card information isn’t bad enough, its\nsecondary payload IcedID is more sinister still. Otherwise known as BokBot, IcedID is a\nmodular Trojan well-known for stealing financial information. While also establishing\npersistence through process hollowing, it in itself is fully capable of dropping additional\nmalware. IcedID monitors and logs Internet browser activity in order to steal sensitive\ninformation such as login details for online banking sessions. In a recently found sample of\nIcedID dropped by new Emotet variants, a legitimate pdb path can even be seen within the\nfile’s strings. This may speak for how ‘fresh’ this variant is, or possibly even still in active\ndevelopment.\n\n\n-----\n\n_Figure 11 – PDB path found in IcedID sample_\n_(05a3a84096bcdc2a5cf87d07ede96aff7fd5037679f9585fee9a227c0d9cbf51)_\n\n[Bumblebee, a malware loader believed to be distributed by the Conti syndicate, has also](https://blogs.blackberry.com/en/2022/05/russia-linked-conti-group-creates-national-emergency-for-costa-rica)\nbeen reported as a payload being dropped by the new Emotet variants. The dropper will\ndownload a PowerShell script that reaches out to a separate URL to download and execute\nthe Bumblebee DLL using rundll32.exe.\n\n### Conclusion\n\nWith its steady evolution over the last eight-plus years, Emotet has continued to become\nmore sophisticated in terms of evasion tactics; has added additional modules in an effort to\nfurther propagate itself, and is now spreading malware via phishing campaigns. While it\nmay have been dormant for a few months, it has now returned with a vengeance, making it\na threat to be reckoned with for business and individual users alike.\n\n### Mitigation Tips\n\nAnyone can be affected by Emotet. Always remain cautious when opening email\nattachments, regardless of file type.\nBe sure to carefully read all security popups when you’re being asked to manually\nenable something on your machine, particularly macros.\nMonitor accounts for unusual and unauthorized access that falls outside of the\n[baseline (MITRE D3FEND™ techniques D3-AZET,](https://d3fend.mitre.org/technique/d3f:AuthorizationEventThresholding/) [D3-LAM).](https://d3fend.mitre.org/technique/d3f:LocalAccountMonitoring)\n\n### Indicators of Compromise (IoCs)\n\n\n-----\n\nEF2CE641A4E9F270EEA626E8E4800B0B97B4A436C40E7AF30AEB6F02566B809C –\n**xls Bait** **File**\n\n199A2E0E1BB46A5DD8EB3A58AA55DE157F6005C65B70245E71CECEC4905CC2C0\n– xls Bait **File**\n\nBB444759E8D9A1A91A3B94E55DA2AA489BB181348805185F9B26F4287A55DF36 –\n**Emotet Dropper**\n\nF6485AEF4BE4CB0EC50317B7F87694FB775F81733AF64C9BC6050F6806504207 –\n**Emotet Dropper**\n\n3D8F8F406A04A740B8ABB1D92490AFEF2A9ADCD9BEECB13AECF91F53AAC736B4\n– SMB Spreader Module\n\n05A3A84096BCDC2A5CF87D07EDE96AFF7FD5037679F9585FEE9A227C0D9CBF51\n– IcedID Trojan\n\n**Malicious URLs used for downloading Emotet:**\n\nhxxp://audioselec[.]com/about/dDw5ggtyMojggTqhc/\n\nhxxp://geringer-muehle[.]de/wp-admin/G/\n\nhxxp://intolove[.]co[.]uk/wp-admin/FbGhiWtrEzrQ/\n\nhxxp://isc[.]net.ua/themes/3rU/\n\nhxxps://blacksebo[.]de/sharedassets/fA/\n\nhxxps://bikkviz[.]com/wp-admin/NyT44HkVg/\n\nhxxp://chist[.]com/dir-/HH/\n\nhxxp://coadymarine[.]com/Admin/ekamS7WWDkLwS44q/\n\n**Malicious URLs used for downloading IcedID:**\n\nhxxps[:]//bayernbadabum[.]com/botpack[.]dat\n\n### References\n\n_[https://blog.cyble.com/2022/11/09/emotet-returns-targeting-users-worldwide/](https://blog.cyble.com/2022/11/09/emotet-returns-targeting-users-worldwide/)_\n\n_https://www.bleepingcomputer.com/news/security/emotet-botnet-starts-blasting-malware-_\n_again-after-4-month-break/_\n\n_[https://news.vmware.com/security/vmware-report-exposes-emotet-malware](https://news.vmware.com/security/vmware-report-exposes-emotet-malware)_\n\n_[https://twitter.com/Unit42_Intel/status/1590002190298804225](https://twitter.com/Unit42_Intel/status/1590002190298804225)_\n\n\n-----\n\n_https://twitter.com/threatinsight/status/1534298451076431873?_\n_ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1534298451076431873_\n_[%7Ctwgr%5Ebe2909305dc964b5628509afc88bf08c38800f12%7Ctwcon%5Es1_&ref_url=h](https://twitter.com/threatinsight/status/1534298451076431873?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1534298451076431873%7Ctwgr%5Ebe2909305dc964b5628509afc88bf08c38800f12%7Ctwcon%5Es1_&ref_url=https%3A%2F%2Fsecurityaffairs.com%2F132090%2Fcyber-crime%2Femotet-google-chrome-info-stealer.html)_\n_ttps%3A%2F%2Fsecurityaffairs.com%2F132090%2Fcyber-crime%2Femotet-google-_\n_chrome-info-stealer.html_\n\n_https://www.proofpoint.com/us/blog/threat-insight/comprehensive-look-emotets-fall-2022-_\n_return_\n\n_[https://www.bitsight.com/blog/emotet-smb-spreader-back](https://www.bitsight.com/blog/emotet-smb-spreader-back)_\n\n_[https://unit42.paloaltonetworks.com/banking-trojan-techniques/#post-125550-_3dy6vkm](https://unit42.paloaltonetworks.com/banking-trojan-techniques/#post-125550-_3dy6vkm)_\n\n### BlackBerry Assistance\n\nIf you’re battling this malware or a similar threat, you’ve come to the right place, regardless\nof your existing BlackBerry relationship.\n\n[The BlackBerry Incident Response team is made up of world-class consultants dedicated to](https://www.blackberry.com/us/en/services/incident-response)\nhandling response and containment services for a wide range of incidents, including\nransomware and Advanced Persistent Threat (APT) cases.\n\nWe have a global consulting team standing by to assist you, providing around-the-clock\nsupport where required, as well as local assistance. Please contact us\nhere: https://www.blackberry.com/us/en/forms/cylance/handraiser/emergency-incidentresponse-containment\n\n**Related Reading**\n\n## About The BlackBerry Research & Intelligence Team\n\n\n-----\n\nThe BlackBerry Research & Intelligence team examines emerging and persistent threats,\nproviding intelligence analysis for the benefit of defenders and the organizations they serve.\n\nBack\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2023/2023-01-20 - Emotet Returns With New Methods of Evasion.pdf"
    ],
    "report_names": [
        "2023-01-20 - Emotet Returns With New Methods of Evasion.pdf"
    ],
    "threat_actors": [
        {
            "id": "77b28afd-8187-4917-a453-1d5a279cb5e4",
            "created_at": "2022-10-25T15:50:23.768278Z",
            "updated_at": "2025-03-27T02:00:55.5423Z",
            "deleted_at": null,
            "main_name": "Inception",
            "aliases": [
                "Inception Framework",
                "Cloud Atlas"
            ],
            "source_name": "MITRE:Inception",
            "tools": [
                "PowerShower",
                "VBShower",
                "LaZagne"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1675303671,
    "ts_updated_at": 1743041358,
    "ts_creation_date": 1675237968,
    "ts_modification_date": 1675237968,
    "files": {
        "pdf": "https://archive.orkl.eu/fefcc482ea27df5b5bf04d1369258ddc8aeaf057.pdf",
        "text": "https://archive.orkl.eu/fefcc482ea27df5b5bf04d1369258ddc8aeaf057.txt",
        "img": "https://archive.orkl.eu/fefcc482ea27df5b5bf04d1369258ddc8aeaf057.jpg"
    }
}