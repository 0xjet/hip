{
    "id": "a1facef5-7848-4762-a4fb-efacea46adc3",
    "created_at": "2023-01-12T15:04:02.880094Z",
    "updated_at": "2025-03-27T02:16:26.139546Z",
    "deleted_at": null,
    "sha1_hash": "d28c11e4ed344f1e6e9591c4a307b06857c37ddb",
    "title": "2020-08-31 - Analysis of the latest wave of Emotet malicious documents",
    "authors": "",
    "file_creation_date": "2022-05-27T22:12:23Z",
    "file_modification_date": "2022-05-27T22:12:23Z",
    "file_size": 1296671,
    "plain_text": "# Analysis of the latest wave of Emotet malicious documents\n\n**[inde.nz/blog/analysis-of-the-latest-wave-of-emotet-malicious-documents](https://www.inde.nz/blog/analysis-of-the-latest-wave-of-emotet-malicious-documents)**\n\nIn the first technical blog post from the Security Team, we're going to take a look at the latest\nwave of Emotet from a specific angle: the downloader document (or maldoc).\n\nDistributed as an attachment via malspam, the operators tend to play it fairly safely with the\nrange of lures they employ in emails - however they are still fairly advanced when compared\nto other large scale campaigns. Over the past week we've observed a fairly even spread of\ngeneric templates (e.g. shipping, invoices, scanned documents) and reply-to messages, with\nmore effort seemingly being made to appear more geographically relevant. Messages almost\nalways leverage the names of legitimate organisations and employees from the same region.\nIn the case of reply-to messages, email exfiltrated in past (or current) compromise is\nresponded to via another compromised account with a standard request to open the\nattachment - though it's not uncommon to encounter messages that only have a signature.\n\n\n-----\n\nThe\n\n[latest document template, dubbed \"Red Dawn\", was first seen on 26th August NZT. It was at](https://twitter.com/Cryptolaemus1/status/1298482483986669568)\nabout this time that we also saw the volume of Emotet mail hitting NZ customers significantly\nramp up. Emotet consists of three botnets known as Epoch 1, 2 and 3. In the most recent\nwave, we have only observed NZ targeted by Epoch 1 and 2. While there are no notable\ndifferences in documents between the 3, email templates can vary depending on which\nbotnet they come from and post-compromise behavior also differs.\n\nAs seen\n\nabove, the document requests for editing and content to be enabled to permit the macro to\n\n\n-----\n\nexecute. Upon execution, the Document_load() function is invoked, which calls a function in\na custom form.\n\nAt first glance the function appears to be\n\nrather complex, however after following the code it becomes apparent that klEP6Sq and\nduFdpjP83 do absolutely nothing other than fill space. After each pairing of these variable\ndeclarations are commands that serve as the functional portion of the script (highlighted with\nbreakpoints). For example, here an obfuscated string is declared as the variable that begins\nwith \"Jcu\" which is then passed to the deobfuscation function (more on that in a moment).\nThis is used to define the Win32 Process object that will later be used to launch PowerShell.\n\nSimilar\n\nto the above, another function takes the value of the Control Tip for a tab on the form and\npasses it to the same deobfuscation function. It is the output of this function that forms the\nPowerShell command that retrieves and executes the Emotet payload.\n\nThe\n\ndeobfuscation function turns out to be fairly basic:\n\nTakes the input string and saves it as a variable.\nSplits the string into an array, defining a series of alphanumeric characters and\nparentheses as the separator.\nRe-joins the output of the array to form the output of the function.\n\n\n-----\n\nWhile\n\n[basic, doing this by hand would be time consuming, so let's automate it with Python. olevba](https://github.com/decalage2/oletools)\nis used to extract the ControlTip text, from which the separator string is determined:\n\nThe\n\ndeobfuscated string is of the format \"powersheLL -e <base64 blob>\". We only want the blob,\nso that's pulled off:\n\nNaturally, the base64 is decoded and presents what looks a little more like a PowerShell\nscript:\n\n\n-----\n\nObfuscation is removed, leaving a clean string that URLs can be extracted from:\n\nThe same script works just fine for\n\nother recent samples, too:\n\nIt's a\n\ncommonly observed mistake for analysts to throw Emotet maldocs into sandboxes and\nassume that the first URL that gets requested is the only one for the document, where there\nshould always be 5 or 7. Where one request fails, the next URL from the list will be\nrequested.\n\nAs has been illustrated, with a little work you can develop safer, faster and reusable\nanalytical methods. While there are methods also known for extracting the full URL set\nthrough dynamic analysis (and the same works for discovering the C2 set of the payload),\n\n\n-----\n\nstatic analysis is always going to be the safer approach as you re not having to touch\nadversary infrastructure. While the above method is only valid so long as the script used to\ngenerate the macros doesn't change, it still serves as a reliable template for an approach\nand requires little work to adapt to changing conditions.\n\n[To keep up to date with Emotet developments, we recommend following @Cryptolaemus1](https://twitter.com/Cryptolaemus1)\non Twitter. [Abuse.ch also provide an excellent feed of Emotet indicators that can be ingested](https://twitter.com/abuse_ch)\nin a variety of formats:\n\nAll IndeSIEM customers benefit from these detections via integration with LogRhythm. We\nwill also be continuing frequent testing of samples to ensure IndeEDR customers have full\ncoverage.\n\n[Those with an ANY.RUN account can download the sample described in this post here.](https://app.any.run/tasks/8e0c6590-01ce-4d7b-8ccf-7a0b5352df0d)\n\n**_If you'd like to find out more about how Inde can help detect these security threats,_**\n**_you can_** **_[contact us here.](https://www.inde.nz/contact-us)_**\n\nAbout the author\n\n**Chris Campbell**\n\nChris was that notoriously disobedient kid who sat at the back of the class and always\nseemed bored, but somehow still managed to ace all of his exams. Obsessed with the finer\ndetails and mechanics of everything in both the physical and digital realms, Chris serves as\nthe Security Architect within the Inde Security Team. His ventures into computer security\nbegan at an early age and haven't slowed down since. After a decade spent across security\nand operations, and evenings spent diving into the depths of malware and operating\nsystems, he brings a wealth of knowledge to Inde along with a uniquely adversary focused\napproach to defence. Like many others at Inde, Chris likes to unwind by hitting the bike trails\nor pretending to be a BBQ pitmaster.\n\n**COMMENTS**\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-08-31 - Analysis of the latest wave of Emotet malicious documents.pdf"
    ],
    "report_names": [
        "2020-08-31 - Analysis of the latest wave of Emotet malicious documents.pdf"
    ],
    "threat_actors": [
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535842,
    "ts_updated_at": 1743041786,
    "ts_creation_date": 1653689543,
    "ts_modification_date": 1653689543,
    "files": {
        "pdf": "https://archive.orkl.eu/d28c11e4ed344f1e6e9591c4a307b06857c37ddb.pdf",
        "text": "https://archive.orkl.eu/d28c11e4ed344f1e6e9591c4a307b06857c37ddb.txt",
        "img": "https://archive.orkl.eu/d28c11e4ed344f1e6e9591c4a307b06857c37ddb.jpg"
    }
}