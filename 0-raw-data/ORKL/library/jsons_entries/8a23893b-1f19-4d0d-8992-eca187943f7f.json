{
    "id": "8a23893b-1f19-4d0d-8992-eca187943f7f",
    "created_at": "2023-01-12T15:09:49.376122Z",
    "updated_at": "2025-03-27T02:06:05.436658Z",
    "deleted_at": null,
    "sha1_hash": "5fecdc6f659e17c1591bad3746eec206c568993d",
    "title": "2022-04-18 - New BotenaGo Variant Discovered by Nozomi Networks Labs",
    "authors": "",
    "file_creation_date": "2022-05-28T05:02:31Z",
    "file_modification_date": "2022-05-28T05:02:31Z",
    "file_size": 2356994,
    "plain_text": "# New BotenaGo Variant Discovered by Nozomi Networks Labs\n\n**[nozominetworks.com/blog/new-botenago-variant-discovered-by-nozomi-networks-labs/](https://www.nozominetworks.com/blog/new-botenago-variant-discovered-by-nozomi-networks-labs/)**\n\nBy April 18, 2022\n\nAccording to [AT&T Alien Labs, BotenaGo malware has been deployed with over 30 exploit](https://cybersecurity.att.com/blogs/labs-research/att-alien-labs-finds-new-golang-malwarebotenago-targeting-millions-of-routers-and-iot-devices-with-more-than-30-exploits)\nfunctions, putting millions of IoT devices at risk of potential cyberattacks. BotenaGo is written\nin “Go”, which is a Google open-source programming language. While the use of opensource programming languages has its benefits, attackers have equally taken advantage,\nusing Go to code malicious malware.\n\nOur research highlights Nozomi Networks Labs’ discovery of a new variant of the BotenaGo\nmalware that specifically targets Lilin security camera DVR devices. We have named this\nsample “Lillin scanner” because of the name the developers used for it in the source code:\n```\n/root/lillin.go . Let’s dive deeper into the functionality of this sample to show step-by\n```\nstep how these kinds of scanners work.\n\n\n-----\n\n**Figure 1. BotenaGo source code.**\n\nThe source code of the BotenaGo malware (Figure 1) was leaked in October 2021, which led\nto the creation of new variants based on the original. We decided to monitor samples that\ncould have been generated utilizing parts of the BotenaGo source code. In doing so, we\ndiscovered a sample that contained certain similarities of BotenaGo.\n\nAt the time of this research, [the sample had not been detected by any malware detection](https://www.virustotal.com/gui/file/fdbd955959a8f42450af5ac2bf93efba180f4cbae64dd4dd852f65c2e2057f56/detection)\nengine in VirusTotal (Figure 2). Although the sample is quite large (2.8 MB), due to being\nwritten in Go, the portion of the actual malicious code is quite small and focuses on a single\ntask. Its authors removed almost all of the the 30+ exploits present in BotenaGo’s original\nsource code and reused some parts to exploit a different vulnerability that was over two\nyears old. This may be why the sample hasn’t been detected until now.\n\n\n-----\n\n**Figure 2. The file is not detected as a threat.**\n\n## Lillin Scanner Functionality\n\nIn order to run, the scanner/exploiter needs a parameter to be passed in the command line.\nThat will be the port being used to connect to each of the IP addresses that the program\ntargets. Lillin scanner differs from BotenaGo in that it doesn’t check the banner for the given\nIPs. It is possible that this tool is chained with another program that builds lists of Lilin\ndevices using services like Shodan or other mass scanning tools.\n\nNext, the sample will iterate over the IP addresses that it receives from the standard input.\nThis portion of the code can easily be spotted in the original BotenaGo source code. These\ninstructions will create one Goroutine (a sort of thread used in Go) per IP address executing\nthe `infectFunctionLilinDvr function, which follows the same naming convention as in`\nBotenaGo.\n\n\n-----\n\n**Figure 3. A loop creating Goroutines using the input from STDIN.**\nThe presence of strings with the names of the functions and the absence of any protection\n[(many malware families use at least the modified version of UPX) means that it isn’t actually](https://www.nozominetworks.com/blog/how-iot-botnets-evade-detection-and-analysis/)\ntrying to protect itself against security products and reverse engineers. It reinforces the\ntheory that this executable might mainly be intended to be used by attackers in manual\nmode.\n\n## Device Access and Vulnerability Exploitation\n\nWhen the `infectFunctionLilinDvr function receives the IP address to scan, it first`\nchecks if the device behind that IP can be accessed. The Lillin scanner contains 11 pairs of\nuser-password credentials in its code. This is a difference from previous malware samples\nthat, [reportedly, abused only the credentials](https://blog.netlab.360.com/multiple-botnets-are-spreading-using-lilin-dvr-0-day-en/) `root/icatch99 and` `report/8Jg0SR8K50 .`\nThese credentials are Base64-encoded to be used in the basic authentication needed to\nexploit the vulnerability that allows the Remote Code Execution (RCE).\n\n**Figure 4. Credentials used for bruteforce access to the DVRs.**\n\n\n-----\n\n**Figure 5. Basic authentication attempt.**\nLillin scanner will loop over the 11 encoded credentials and will sequentially try to access the\nroot directory, changing the Base64 string in the `Authorization field. When the server`\nresponse contains the string `HTTP/1.1 200 or` `HTTP/1.0 200 it will consider the`\nauthentication to be successful and will attempt the exploitation of the Network Time Protocol\n(NTP) configuration vulnerability.\n\nThis vulnerability, part of a set of security vulnerabilities affecting Lilin DVRs, was discovered\n[in 2020 and was assigned a CVSS v3.1 score of 10.0 (Critical) by the vendor.](https://www.meritlilin.com/assets/uploads/support/file/M00158-TW.pdf)\n\nThe scanner will send particularly crafted HTTP POST requests to the URL paths\n```\n/dvr/cmd and /cn/cmd in order to exploit a command injection vulnerability in the web\n\n```\ninterface.\n\nFirst, the scanner attempts to inject some code by submitting a POST request to the URL\npath `/dvr/cmd . If successful, this request then modifies the NTP configuration of the`\ncamera. The modified configuration contains a command that, because of the vulnerability,\nwill attempt to download a file named `wget.sh from the IP address` `136.144.41[.]169`\nand then immediately execute its content. If the command injection to `/dvr/cmd is not`\nsuccessful, the scanner attempts the same attack to the endpoint `/cn/cmd .`\n\nOnce the attack is complete, another request to the same endpoint restores the original NTP\nconfiguration.\n\n\n-----\n\n**Figure 6. POST request with the injected** `wget command.`\nThe file `wget.sh recursively downloads multiple executables for multiple architectures from`\n```\n136.144.41[.]169 . The targeted architectures are ARM, Motorola 68000, MIPS,\n\n```\nPowerPC, SPARC, SuperH, x86.\n\n**Figure 7. The content of** `wget.sh file.`\n\n## The Mirai Malware Family\n\nIn the third stage of this attack, multiple malicious samples for each architecture attempt to\nexecute on the camera. These samples belong to the Mirai malware family, which is a widely\nknown threat to IoT devices. All these samples have recently been submitted to VirusTotal (at\nthe beginning of March 2022). For example, for the MIPS architecture, two samples have\nbeen identified as the third stage connected to the Mirai family:\n\nae0185189e463c6abddf8865972dac72630b6e515e79d3f7566f0983a0eae295\n28f50f24c930b595f88257748f62d985436ecce1330ff52f09cdd13642591450\n\n**Figure 8. TVirusTotal graph showing the connection between the two ELF samples and wget**\nrequest contained in the `wget.sh file.`\nFor x86 architecture, the file\n```\n62ef086111b6816d332e298d00ac946c11fac0ed8708fa2668ad3c91ceb96dbf is\n\n```\ndownloaded and executed. An analysis of this sample reveals some typical behaviors of the\n\n\n-----\n\nMirai malware. For example, while scanning new devices, Mirai typically bruteforces the\nauthentication using a list of hardcoded credentials. In Figure 9, there is a non-exhaustive list\nof credentials used for the bruteforce. This list comes from the Mirai source code.\n\n**Figure 9. Non-exhaustive list of hardcoded credentials used by Mirai malware from the**\nsource code.\n\nFrom the static analysis of the downloaded sample, we retrieved a list of credentials used in\nthe scanning module, many of which are the same as the ones hardcoded in the Mirai\nsource code.\n\n\n-----\n\n**Figure 10. A portion of code from sample**\n```\n62ef086111b6816d332e298d00ac946c11fac0ed8708fa2668ad3c91ceb96dbf using the\n\n```\nsame credentials hardcoded in the source code.\nAnother behavior associated with the Mirai botnet is the exclusion of IP ranges belonging to\nthe internal networks of the U.S. Department of Defense (DoD), U.S. Postal Service (USPS),\nGeneral Electric (GE), Hewlett-Packard (HP), and others. Some of them are visible in Figure\n11, which is taken from Mirai’s source code.\n\n**Figure 11. Some of the IP ranges listed in the source code that are excluded while scanning.**\nThe same IP ranges are excluded from the scanning procedure in the sample we are\nanalyzing. Moreover, we see that the verification of a randomly generated IP follows the\nsame algorithm as the one implemented in Mirai’s source code.\n\n\n-----\n\n**Figure 12. Portion of the sample code excluding some IP ranges while generating the IPs to**\nscan.\nIt seems that this tool has been quickly built using the code base of the BotenaGo malware.\nIt shouldn’t be confused with a worm as its main goal is to infect its victims with Mirai\nexecutables with a list of IP addresses provided as input; it can’t automatically propagate\nitself.\n\n## Conclusion\n\n\n-----\n\nApart from working on completely new projects, attackers also commonly re-use already\navailable code to build new malware. Monitoring the evolution of these projects helps create\nmore robust and generic detections that remain proactive for a longer time, thus providing\nbetter protections against modern cyberthreats.\n\n**Related Content**\n\nWHITE PAPER\n\n## The S3CUREC4M Project: Vulnerability Research in Modern IP Video Surveillance Technologies\n\nLearn how to assess the security posture of an IP video surveillance system, including\nhardware extraction and firmware analysis techniques.\n\n[Download](https://info.nozominetworks.com/wp-vulnerability-research-in-modern-ip-video-surveillance-technologies-lp-0)\n**Related Links**\n\nBlog: [How IoT Botnets Evade Detection and Analysis](https://www.nozominetworks.com/blog/how-iot-botnets-evade-detection-and-analysis/)\nBlog: [Critical Log4Shell (Apache Log4j) Zero-Day Attack Analysis](https://www.nozominetworks.com/blog/critical-log4shell-apache-log4j-zero-day-attack-analysis/)\nBlog: [Reverse Engineering Obfuscated Firmware for Vulnerability Analysis](https://www.nozominetworks.com/blog/reverse-engineering-obfuscated-firmware-for-vulnerability-analysis/)\nBlog: [Methods for Extracting Firmware from OT Devices for Vulnerability Research](https://www.nozominetworks.com/blog/methods-for-extracting-firmware-from-ot-devices-for-vulnerability-research/)\nOn-Demand Webinar: OT/IoT Security Review 2021 2H: Lessons for Critical\nInfrastructure\n\n\n-----\n\n[Nozomi Networks Labs](https://www.nozominetworks.com/author/nn-labs/)\nNozomi Networks Labs is dedicated to reducing cyber risk for the world’s industrial and\ncritical infrastructure organizations. Through our cybersecurity research and collaboration\nwith industry and institutions, we’re helping defend the operational systems that support\neveryday life.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-04-18 - New BotenaGo Variant Discovered by Nozomi Networks Labs.pdf"
    ],
    "report_names": [
        "2022-04-18 - New BotenaGo Variant Discovered by Nozomi Networks Labs.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536189,
    "ts_updated_at": 1743041165,
    "ts_creation_date": 1653714151,
    "ts_modification_date": 1653714151,
    "files": {
        "pdf": "https://archive.orkl.eu/5fecdc6f659e17c1591bad3746eec206c568993d.pdf",
        "text": "https://archive.orkl.eu/5fecdc6f659e17c1591bad3746eec206c568993d.txt",
        "img": "https://archive.orkl.eu/5fecdc6f659e17c1591bad3746eec206c568993d.jpg"
    }
}