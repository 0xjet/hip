{
    "id": "5c9c900a-c44a-41f4-a031-35cc8496e3f3",
    "created_at": "2023-01-12T15:08:03.883907Z",
    "updated_at": "2025-03-27T02:09:18.473205Z",
    "deleted_at": null,
    "sha1_hash": "34efa31964c24520835da3621a95beca13a14cca",
    "title": "2022-04-04 - Stolen Images Campaign Ends in Conti Ransomware",
    "authors": "",
    "file_creation_date": "2022-05-25T14:20:21Z",
    "file_modification_date": "2022-05-25T14:20:21Z",
    "file_size": 3717052,
    "plain_text": "# Stolen Images Campaign Ends in Conti Ransomware\n\n**[thedfirreport.com/2022/04/04/stolen-images-campaign-ends-in-conti-ransomware](https://thedfirreport.com/2022/04/04/stolen-images-campaign-ends-in-conti-ransomware/)**\n\nApril 4, 2022\n\nIn this intrusion from December 2021, the threat actors utilized IcedID as the initial access\nvector. [IcedID is a banking trojan that first appeared in 2017, usually, it is delivered via](https://malpedia.caad.fkie.fraunhofer.de/details/win.icedid)\n[malspam campaigns and has been widely used as an initial access vector in multiple](https://thedfirreport.com/2021/10/18/icedid-to-xinglocker-ransomware-in-24-hours/)\n[ransomware intrusions.](https://thedfirreport.com/2021/05/12/conti-ransomware/)\n\nUpon execution of the IcedID DLL, discovery activity was performed which was followed by\nthe dropping of a Cobalt Strike beacon on the infected host. Along the way, the threat actors\ninstalled remote management tools such as Atera and Splashtop for persisting in the\nenvironment. While remaining dormant most of the time, the adversary deployed Conti\nransomware on the 19th day (shortly after Christmas), resulting in domain wide encryption.\n\n## Case Summary\n\n[We assess with high confidence that the “Stolen Image Evidence” email campaign was used](https://twitter.com/infosecfu/status/1468955220059168785?s=20&t=_fCNcLM-nx1e8EHbyA6z3A)\n[to deliver the IcedID DLL. This was first reported by Microsoft in April 2021.](https://www.microsoft.com/security/blog/2021/04/09/investigating-a-unique-form-of-email-delivery-for-icedid-malware/)\n\nUpon execution of the IcedID DLL, a connection to a C2 server was established. This was\nfollowed by the creation of a scheduled task on the beachhead host to establish persistence.\nThe task executed the IcedID payload every one 1 hour. The IcedID malware then used\nWindows utilities such as net, chcp, nltest, and wmic, to perform discovery activity on the\nhost.\n\nAfter a gap of almost an hour, a Cobalt Strike beacon was dropped and executed on the\nbeachhead host. Soon after, another round of discovery was performed from the Cobalt\nStrike beacon focusing on the Windows domain. Nltest and net group were utilized to look\nfor sensitive groups such as Domain Admins and Enterprise Admins. Process injection into\nexplorer.exe was then observed from the Cobalt Strike Beacon.\n\n[The threat actors proceeded to install remote management tools such as Atera Agent and](https://www.atera.com/remote-monitoring-and-management/)\n[Splashtop. Use of these 3rd party administrative tools allow the threat actors another](https://www.splashtop.com/)\n“legitimate” means of persistence and access if they were to lose their malware connection. In\nthis intrusion, we observed usage of gmail[.]com and outlook[.]com email accounts for Atera\nagent registration. Soon after, one of the injected Cobalt Strike processes accessed LSASS\nmemory to dump credentials from the beachhead.\n\nOn the sixth day of the intrusion, the beachhead host saw new discovery activity with a quick\n[nltest followed by the PowerView script Invoke-ShareFinder. On the following day, the](https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1)\nseventh day of the intrusion, the threat actors made their next move. On that day, a new\nCobalt Strike server was observed, in fact over the course of the intrusion, four different\n\n\n-----\n\nCobalt Strike servers were used. From the beachhead host, a DLL was transferred to a\ndomain controller over SMB and then a remote service was created on the domain controller\nto execute the Cobalt Strike DLL.\n\nAfter getting a foothold on the domain controller, we saw more process injection followed by\nthe same pattern of installing Atera for additional persistent access. From the domain\n[controller, the threat actors proceeded with more discovery tasks including AdFind and](https://thedfirreport.com/2020/05/08/adfind-recon/)\nInvoke-ShareFinder again. After this, the threat actors went quiet.\n\nOn day nine of the intrusion, the next Cobalt Strike server, which would ultimately be used\nuntil the end of the intrusion, was observed for the first time. On the tenth day, little activity\nwas observed but the threat actors connected to the beachhead host via the Atera agent and\nexecuted another Cobalt Strike DLL. A little discovery check-in was observed on the 14th day,\nbut little else.\n\nOn the 19th day, the threat actors moved towards their final objectives. They reviewed the\ndirectory structure of several hosts including domain controllers and backup servers. They\nthen dropped their final ransomware payload on the beachhead host and attempted to\nexecute it using a batch file named backup.bat. However, they found that their execution\nfailed.\n\n[They left for a few hours, and then returned, and attempted to exploit a couple of CVE’s in an](https://techcommunity.microsoft.com/t5/security-compliance-and-identity/sam-name-impersonation/ba-p/3042699)\nattempt to escalate privileges. The threat actors had already secured domain admin access\nbut it’s possible the operator may have thought they lacked permissions when their first\nransomware execution failed.\n\nWhile these exploits appear to have failed the threat actors found their previously captured\ndomain admin credentials and launched two new Cobalt Strike beacons on the domain\ncontrollers. Finally, twenty minutes after accessing the domain controllers, the threat actors\ndropped the ransomware DLL and the batch script and executed it from the domain\ncontroller. This time the execution worked as intended and resulted in domain wide\nransomware.\n\n## Services\n\n[We offer multiple services including a Threat Feed service which tracks Command and](https://thedfirreport.com/services/)\nControl frameworks such as Cobalt Strike, BazarLoader, Covenant, Metasploit, Empire,\n[PoshC2, etc. More information on this service and others can be found here.](https://thedfirreport.com/services/)\n\nWe also have artifacts and IOCs available from this case such as pcaps, memory captures,\nfiles, event logs including Sysmon, Kape packages, and more, under our Security Researcher\nand Organization services.\n\n## Timeline\n\n\n-----\n\n-----\n\n-----\n\n[Report lead: @0xtornado](https://twitter.com/0xtornado)\n\n[Contributing analysts: @yatinwad,](https://twitter.com/yatinwad) [@MetallicHack, and](https://twitter.com/MetallicHack) [@_pete_0](https://twitter.com/_pete_0)\n\n## Initial Access\n\nThe IcedID DLL, which gave the threat actors a foothold into the environment, was likely\n[delivered by a “Stolen Image Evidence” email campaign.](https://twitter.com/infosecfu/status/1468955220059168785?s=20&t=_fCNcLM-nx1e8EHbyA6z3A)\n\n\"Stolen Images\" [#ContactForms campaign that submits \"https://t.co/uc4QkLQt4b\" links into](https://twitter.com/hashtag/ContactForms?src=hash&ref_src=twsrc%5Etfw)\ncontact us forms now dropping an .iso file and [#IcedID dll.](https://twitter.com/hashtag/IcedID?src=hash&ref_src=twsrc%5Etfw)\n[https://t.co/1O3TYQYP1i@abuse_ch Looks like](https://t.co/1O3TYQYP1i) [https://t.co/ZNwTD5rH7U incorrectly(?) tags](https://t.co/ZNwTD5rH7U)\nthe dll as emotet/Heodo... FYI.\n\n— Sean (@infosecfu) [December 9, 2021](https://twitter.com/infosecfu/status/1468955220059168785?ref_src=twsrc%5Etfw)\n\nThese initial access campaigns reportedly utilize contact forms to send malicious emails to\nintended targets.\n\nThe emails contain a link to a legitimate storage service like those offered by Google and\nMicrosoft. In this example, “http://storage.googleapis.com” was used to host a zip file. The\nzip archive contains an ISO file, which once clicked and mounted, shows a document-like\nLNK file. Once the victim opens that LNK file, the IcedID DLL loader executes, downloads,\nand runs the second stage of IcedID.\n\nBelow is a configuration extraction of that initial IcedID malware from an automated\nsandbox analysis of the sample:\n```\n{\n \"Campaign ID\": 870605016,\n \"C2 url\": \"guguchrome.com\"\n}\n\n## Execution\n\n```\nThe graph below shows detailed actions performed through IcedID, including reconnaissance\nand Cobalt Strike beacons drops:\n\n\n-----\n\n## Persistence\n\n**Scheduled Tasks**\n\nOnly one scheduled task was created during this intrusion. The scheduled task was created\non the beachhead host upon the execution of IcedID DLL, which executed every hour:\n```\n<Exec>\n   <Command>rundll32.exe</Command>\n   <Arguments>\"C:\\Users\\REDACTED\\AppData\\Local\\{C904416E-A880-3136-ED72AA63AF7DB1F2}\\Gaagsp2.dll\",DllMain --ob=\"CapitalLadder\\license.dat\"</Arguments>\n</Exec>\n\n```\n**Atera Agent**\n\n[Threat actors dropped and installed Atera agent (T1219), using two MSI packages “sql.msi”](https://attack.mitre.org/techniques/T1219/)\nand “mstsc.msi”, from the Cobalt Strike beacons, which allowed them to have a non-malware\nbackdoor in the environment.\n\nThe installation of those two packages reveals two emails potentially belonging to the\nransomware operators or affiliates:\n\n\n-----\n\n```\n/IntegratorLogin=\"\"marsmors1947@gmail.com\"\" /AccountId=\"\"0013z00002kcnS1AAI\"\n/IntegratorLogin=\"\"hughess6623@outlook.com\"\" /AccountId=\"\"0013z00002kbhSdAAI\"\n\n```\n[Atera agent is a remote monitoring and management system.](https://www.atera.com/)\n\nAt one point in the intrusion the threat actors utilized Atera to download and launch a new\nCobalt Strike beacon on one of the hosts they had installed the agent on.\n\n## Privilege Escalation\n\nThere were attempts to exploit Active Directory vulnerabilities CVE-2021-42278 and CVE2021-42287 in order to create privileged accounts. This attempt failed, however, there were\nindicators through DNS requests enumerating accounts for the existence of\n[SAMTHEADMIN-XX (XX being a random number). The query status 9003 indicates that](https://docs.microsoft.com/en-us/windows/win32/debug/system-error-codes--9000-11999-)\nthis does not exist.\n\nThe injected process dllhost.exe requesting SAMTHEADMIN-92 and SAMTHEADMIN-20\naccounts:\n\n\n-----\n\n[We believe the operator used the publicly available script ‘sam_the_admin‘ or a variant](https://github.com/WazeHell/sam-the-admin/)\nbased on it. Part of the script generates a new computer name account in the form\nSAMTHEADMIN- followed by a random value between 0 to 100, as indicated below.\n\nThe exploitation involves invoking lookups to ensure that the new accounts were successful,\nexplaining why failed DNS requests were observed.\n\n## Defense Evasion\n\n**Disable Defender**\n\nA base64 encoded PowerShell command was executed on the beachhead which disabled\n[Windows Defender AV (T1562.001).](https://attack.mitre.org/techniques/T1562/001/)\n\nEncoded Command:\n```\npowershell -nop -exec bypass -EncodedCommand\nUwBlAHQALQBNAHAAUAByAGUAZgBlAHIAZQBuAGMAZQAgAC0ARABpAHMAYQBiAGwAZQBSAGUAYQBsAHQAaQBtAG\n\n```\nThe decoded base64 PowerShell command uses Set-MpPreference cmdlet to disable\nDefender’s real time monitoring:\n```\nSet-MpPreference -DisableRealtimeMonitoring $true\n\n```\n**Process Injection**\n\nA number of process injections were seen during this intrusion. The Cobalt Strike beacon\nused the CreateRemoteThread Win32 function in order to inject code into running\nprocesses. The usage of this function triggers the Sysmon Event ID 8, a well known pattern of\nCS beacon activity.\n\nRemote threads were created in Winlogon and Explorer processes.\n\n\n-----\n\n## Credential Access\n\n**LSASS Access**\n\n[The threat actors accessed LSASS process memory (T1003.001) on different hosts, including](https://attack.mitre.org/techniques/T1003/001/)\ndomain controllers, using multiple techniques.\n\nThe screenshot below shows the different\n“DesiredAccess” to the LSASS process\nobject from different beacons (dllhost.exe,\nEdebef4.dll, etc.) or Task Manager:\n\n[The table below maps the “DesiredAccess” values with the actual corresponding access rights,](https://docs.microsoft.com/en-us/windows/win32/procthread/process-security-and-access-rights)\nand examples of credentials dumping tools requesting those accesses:\n\n\n-----\n\n**Desired**\n**Access**\n\n\n**Hex**\n**value**\n\n\n**Process Access Rights** **Offensive**\n**Tools**\n\n\n5136 1410 **PROCESS_VM_READ (0x0010)**\n**PROCESS_QUERY_INFORMATION (0x0400)**\n\n**PROCESS_QUERY_LIMITED_INFORMATION**\n**(0x1000)***\n\n4112 1010 **PROCESS_VM_READ (0x0010)**\n**PROCESS_QUERY_LIMITED_INFORMATION**\n**(0x1000)**\n\n\nMimikatz\n(Winver <5)\nNanoDump\n\nMimikatz\n(Winver >=6)\n\n\n64 40 **PROCESS_DUP_HANDLE (0x0040)** MirrorDump\nHandleKatz\n\n*A handle that has the PROCESS_QUERY_INFORMATION access right is automatically\ngranted PROCESS_QUERY_LIMITED_INFORMATION.\n\nThose “DesiredAccess” values could be interesting to build detections or hunting queries if\nyou are using Sysmon or such a verbose monitoring tool.\n\nIn our case, the access to LSASS process allowed the threat actors to compromise a domain\nadmin account, which was then used to move laterally and deploy ransomware.\n\n## Discovery\n\nMultiple discovery techniques were observed throughout the case. The initial discovery\ntechniques were conducted on the beachhead host by the IcedID malware – focusing on\n[determining the system language and security products installed (T1518.001). Other familiar](https://attack.mitre.org/techniques/T1518/001/)\ndiscovery techniques were then leveraged to establish situational awareness, such as network\nconfigurations and Windows domain configuration.\n\nDiscovery was achieved using a combination of living off the land techniques (WMIC and\nCMD) and via third-party tools.\n\n\n-----\n\n```\ncmd.exe /c chcp >&2\nipconfig /all\nsysteminfo\nWMIC /Node:localhost /Namespace:\\\\root\\SecurityCenter2 Path AntiVirusProduct Get *\n/Format:List\nnet config workstation\nnltest /domain_trusts\nnltest /domain_trusts /all_trusts\nnet view /all /domain\nnet view /all\nnet group \"Domain Admins\" /domain\ncmd.exe /C nltest /dclist:\ncmd.exe /C net group /domain \"Domain Computers\"\ncmd.exe /C net group /domain \"Enterprise Admins\"\n\n```\n[Threat actors also used “chcp” for discovery of the system locale/language (T1614.001).](https://attack.mitre.org/techniques/T1614/001/)\n[Change Control Page (ChCP) is a Microsoft utility for changing the console control page](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/chcp)\n(language). In this case, the existing control page language was collected using the following\ncommand:\n```\ncmd.exe /c chcp >&2\n\n```\nAs a test, entering this on a command prompt shows a numeric value. The Microsoft link\nshows the number of the language used (437 – United States).\n\nIt is highly likely that the threat actors were establishing the\ncountry of origin based on the language used – an extra failsafe check to ensure certain users or regions were not targeted.\nThe >&2 parameter could indicate a parameter was expected as\npart of a script, or possibly a redirect using stderr.\n\nThe second discovery was from a different Cobalt Strike beacon “Faicuy4.exe” which focused\non domain discovery and user groups using the net command.\n\nOnce the threat actors had achieved lateral movement to domain controllers, the AdFind\n[utility was employed to enumerate active directory objects (T1018).](https://attack.mitre.org/techniques/T1018)\n\n\n-----\n\n‘adf.bat’ is a common batch file that we have observed in previous cases, we saw this script in\n2020 as part of a [Ryuk intrusion. The recent Conti leaks indicate that Conti operators were](https://thedfirreport.com/2020/10/18/ryuk-in-5-hours/)\nsurprised Ryuk operators were using their file.\n\n\n-----\n\nThe PowerView module Invoke-ShareFinder was executed from the beachhead host and a\ndomain controller.\n\n\n-----\n\nSome network discovery was conducted using the ping utility to check the existence of hosts\n[on the network (T1049).](https://attack.mitre.org/techniques/T1049)\n\n\n-----\n\n[Filesystem discovery (T1083) was conducted to collect directory lists to a text file.](https://attack.mitre.org/techniques/T1083)\n\nOther variations included:\n\nC:\\Windows\\system32\\cmd.exe /C dir “\\\\<REDACTED>\\C$” /s >> listback.txt\nC:\\Windows\\system32\\cmd.exe /C dir “\\\\<REDACTED>\\C$” /s >> list1.txt\n\n## Lateral Movement\n\nOn the 6th day, the threat actors began their lateral movement activity using SMB to transfer\nCobalt Strike DLL’s onto a domain controller and another server.\n\nServices were then created on the hosts to execute the uploaded Cobalt Strike Beacons.\n\n\n-----\n\nOn the final day, right before execution of the ransomware, SMB was again used to transfer\nCobalt Strike Beacon executable to the domain controllers.\n\nThe beacons were then executed using a remote service.\n\nKnown Cobalt Strike named pipes were observed on the Domain Controllers with these\nexecutable beacons. Named pipes connections can be observed through Sysmon Event ID 18.\n\nNote that the named pipes followed MSSE-[0-9]{4}-server pattern, which indicates that\nthe threat actors were using the default Cobalt Strike Artifact Kit binaries:\n```\npipeName: \\MSSE-3328-server and Image: 61582ab.exe\npipeName: \\MSSE-7344-server and Image: 044b7e1.exe\n\n```\n\n-----\n\n-----\n\n**Command and Control**\n\nWe observed the IcedID DLL dropping multiple CS beacons on the beachhead.\n\n\n-----\n\n**Splashtop Streamer**\n\nThreat actors used Splashtop Streamer via Atera agent, allowing them to remotely connect to\nmachines without using RDP tunneling or other techniques previously seen in our cases.\n\nBy default, the Splashtop Streamer is automatically installed together with the AteraAgent.\n\nSplashtop Streamer usage leaves many network connections to *.api.splashtop.com and\n*.relay.splashtop.com on port 443:\n\n\n-----\n\n**Cobalt Strike**\n\nWe observed a default Cobalt Strike malleable C2 profile, using the jquery agent string. This\n[activity can be detected with relative ease by the ET rules.](https://rules.emergingthreats.net/)\n\nThere appeared to be no jitter configured, resulting in a constant stream of HTTP requests,\nand if using ET rules, constant alerts would be generated.\n\nJust based on the ET Cobalt Strike rule, ‘ET MALWARE Cobalt Strike Malleable C2 JQuery\nCustom Profile Response’, there were in excess of 6K alerts generated.\n\nDue to the length of this intrusion, we observerd the threat actors handing off between C2\nservers. We also observed one Cobalt Strike domain change IP resolutions three times, over\nthe length of the case.\n\n\n-----\n\nIcedID:\n```\n guguchrome.com\n 5.181.80.214:80\napplesflying.com\n5.181.80.113:443\nJa3: a0e9f5d64349fb13191bc781f81f42e1\nJA3s: ec74a5c51106f0419184d0dd08fb05bc\nCertificate: [89:ac:17:b1:f1:b6:9e:c8:bb:e5:f3:59:ac:e4:91:b2:91:f4:85:58 ]\nNot Before: 2021/12/08 20:30:05 UTC\nNot After: 2022/12/08 20:30:05 UTC\nIssuer Org: Internet Widgits Pty Ltd\nSubject Common: localhost\nSubject Org: Internet Widgits Pty Ltd\nPublic Algorithm: rsaEncryption\n\n```\nCobalt Strike:\n\n\n-----\n\n```\nbunced.net\n103.208.86.7:80\n103.208.86.7:443\nJa3: 0eecb7b1551fba4ec03851810d31743f\nJA3s:10b29985cd0ecd878ac083f059c42d51\nCertificate: [8f:98:c5:f8:48:96:b6:cd:13:91:7c:4c:32:85:db:b7:e5:e1:bc:8f ]\nNot Before: 2021/12/09 10:32:43 UTC\nNot After: 2022/03/09 10:32:42 UTC\nIssuer Org: Let's Encrypt\nSubject Common: bunced.net\nPublic Algorithm: id-ec\nPublicKey Curve: secp384r1\n\n```\n\n-----\n\n```\n{\n \"x64\": {\n  \"sha256\": \"01a4c5ef0410b379fa83ac1a4132ba6f7b5814192dbdb87e9d7370e6256ea528\",\n  \"md5\": \"21242d958caf225f76ad71a4d3a6d4d9\",\n  \"config\": {\n   \"Jitter\": 10,\n   \"Spawn To x86\": \"%windir%\\\\syswow64\\\\dllhost.exe\",\n   \"Port\": 80,\n   \"Watermark\": 0,\n   \"C2 Host Header\": \"\",\n   \"HTTP Method Path 2\": \"/jquery-3.3.2.min.js\",\n   \"Beacon Type\": \"0 (HTTP)\",\n   \"C2 Server\": \"bunced.net,/jquery-3.3.1.min.js\",\n   \"Method 1\": \"GET\",\n   \"Spawn To x64\": \"%windir%\\\\sysnative\\\\dllhost.exe\",\n   \"Method 2\": \"POST\",\n   \"Polling\": 5000\n  },\n  \"time\": 1639100549541.8,\n  \"sha1\": \"04bbd0ffa580dd5a85ce4c7fc19c66cc753e45ff\",\n  \"uri_queried\": \"/uKVG\"\n },\n \"x86\": {\n  \"sha256\": \"9c01afed2a863fa2466679ef53127e925963cc95de98bc4c59cb4743ccc73bf5\",\n  \"md5\": \"e7df03bc59b478f0588039416b845c7f\",\n  \"config\": {\n   \"Jitter\": 10,\n   \"Spawn To x86\": \"%windir%\\\\syswow64\\\\dllhost.exe\",\n   \"Port\": 80,\n   \"Watermark\": 0,\n   \"C2 Host Header\": \"\",\n   \"HTTP Method Path 2\": \"/jquery-3.3.2.min.js\",\n   \"Beacon Type\": \"0 (HTTP)\",\n   \"C2 Server\": \"bunced.net,/jquery-3.3.1.min.js\",\n   \"Method 1\": \"GET\",\n   \"Spawn To x64\": \"%windir%\\\\sysnative\\\\dllhost.exe\",\n   \"Method 2\": \"POST\",\n   \"Polling\": 5000\n  },                                        \n  \"time\": 1639100538593.3,                             \n  \"sha1\": \"18ddb5fac720599983791036e43154a9ce67ffde\",               \n  \"uri_queried\": \"/Uq4b\"                              \n }                                         \n}\nshytur.com\n179.43.176.93:80\n216.73.159.33:80\n179.43.176.80:80\n\n```\n\n-----\n\n```\n{                                          \n \"x64\": {                                      \n  \"config\": {                                   \n   \"Port\": 80,                                  \n   \"Beacon Type\": \"0 (HTTP)\",                           \n   \"Spawn To x86\": \"%windir%\\\\syswow64\\\\dllhost.exe\",               \n   \"Polling\": 5000,                                \n   \"Method 2\": \"POST\",                              \n   \"C2 Server\": \"shytur.com,/jquery-3.3.1.min.js\",                \n   \"C2 Host Header\": \"\",                             \n   \"Method 1\": \"GET\",                               \n   \"Spawn To x64\": \"%windir%\\\\sysnative\\\\dllhost.exe\",              \n   \"Watermark\": 0,                                \n   \"Jitter\": 10,                                 \n   \"HTTP Method Path 2\": \"/jquery-3.3.2.min.js\"                  \n  },                                        \n  \"uri_queried\": \"/RnJS\",                             \n  \"md5\": \"22bbd14a893b19220e829940ad474687\",                    \n  \"sha256\": \"10084d7146462d06c599bd14664d14c511b40687e21983e6f8bded06982931a9\",  \n  \"sha1\": \"06ef512d5a2b9353b6d0a412a1876e02d3474527\",               \n  \"time\": 1640639559417.7                             \n },                                         \n \"x86\": {                                      \n  \"config\": {                                   \n   \"Port\": 80,                                  \n   \"Beacon Type\": \"0 (HTTP)\",                           \n   \"Spawn To x86\": \"%windir%\\\\syswow64\\\\dllhost.exe\",               \n   \"Polling\": 5000,                                \n   \"Method 2\": \"POST\",                              \n   \"C2 Server\": \"shytur.com,/jquery-3.3.1.min.js\",                \n   \"C2 Host Header\": \"\",                             \n   \"Method 1\": \"GET\",                               \n   \"Spawn To x64\": \"%windir%\\\\sysnative\\\\dllhost.exe\",              \n   \"Watermark\": 0,                                \n   \"Jitter\": 10,                                 \n   \"HTTP Method Path 2\": \"/jquery-3.3.2.min.js\"\n  },\n  \"uri_queried\": \"/COPz\",\n  \"md5\": \"a48fbea91a31afaf348f713b1f59dfbf\",\n  \"sha256\": \"d281caef6c8fc45d8725d6cd1542234aea35b97b99bb6aaff7688d91a10716f0\",\n  \"sha1\": \"7d700ad69d2800de159af5f50bbb82e89467d8b4\",\n  \"time\": 1640639554775.3\n }\n}\ncirite.com \n23.81.246.30\nJa3: a0e9f5d64349fb13191bc781f81f42e1\nJa3s: ae4edc6faf64d08308082ad26be60767\nCertificate: [f1:43:f2:43:29:79:35:ad:b5:60:c7:79:3a:0f:c6:68:a3:f2:d5:d1 ]\nNot Before: 2021/10/22 00:00:00 UTC \nNot After: 2022/10/22 23:59:59 UTC \nIssuer Org: Sectigo Limited \nSubject Common: cirite.com [cirite.com,www.cirite.com ]\nPublic Algorithm: rsaEncryption\n\n```\n\n-----\n\n```\n{                                          \n \"beacontype\": [                                  \n  \"HTTPS\"                                     \n ],                                         \n \"sleeptime\": 5000,                                 \n \"jitter\": 20,                                   \n \"maxgetsize\": 1864736,                               \n \"spawnto\": \"AAAAAAAAAAAAAAAAAAAAAA==\",                       \n \"license_id\": 0,                                  \n \"cfg_caution\": false,                               \n \"kill_date\": null,                                 \n \"server\": {                                    \n  \"hostname\": \"cirite.com\",                            \n  \"port\": 443,                                   \n  \"publickey\":\n\"MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCNZaG28qpSpw7xhHStBrU+s2eWiOIBlBERsSzWagdI1TzzJ\n },                                         \n \"host_header\": \"\",\n \"useragent_header\": null,\n \"http-get\": {\n  \"uri\": \"/posting\",\n  \"verb\": \"GET\",\n  \"client\": {\n   \"headers\": null,\n   \"metadata\": null\n  },\n  \"server\": {\n   \"output\": [\n    \"print\",\n    \"prepend 600 characters\",\n    \"base64\",\n    \"base64url\"\n   ]\n  }\n },\n \"http-post\": {\n  \"uri\": \"/extension\",\n  \"verb\": \"POST\",\n  \"client\": {\n   \"headers\": null,\n   \"id\": null,\n   \"output\": null\n  }\n },\n \"tcp_frame_header\":\n\"AAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\n \"crypto_scheme\": 0,\n \"proxy\": {\n  \"type\": null,\n  \"username\": null,\n  \"password\": null,\n  \"behavior\": \"Use IE settings\"\n },\n\n```\n\n-----\n\n```\n http_post_chunk : 0,\n \"uses_cookies\": true,\n \"post-ex\": {\n  \"spawnto_x86\": \"%windir%\\\\syswow64\\\\rundll32.exe\",\n  \"spawnto_x64\": \"%windir%\\\\sysnative\\\\rundll32.exe\"\n },\n \"process-inject\": {\n  \"allocator\": \"VirtualAllocEx\",\n  \"execute\": [\n   \"CreateThread\",\n   \"CreateRemoteThread\",\n   \"RtlCreateUserThread\"\n  ],\n  \"min_alloc\": 23886,\n  \"startrwx\": false,\n  \"stub\": \"Ms1B7fCBDFtfSY7fRzHMbQ==\",\n  \"transform-x86\": [\n   \"prepend '\\\\x90\\\\x90\\\\x90'\"\n  ],\n  \"transform-x64\": [\n   \"prepend '\\\\x90\\\\x90\\\\x90'\"\n  ],\n  \"userwx\": false\n },\n \"dns-beacon\": {\n  \"dns_idle\": null,\n  \"dns_sleep\": null,\n  \"maxdns\": null,\n  \"beacon\": null,\n  \"get_A\": null,\n  \"get_AAAA\": null,\n  \"get_TXT\": null,\n  \"put_metadata\": null,\n  \"put_output\": null\n },\n \"pipename\": null,\n \"smb_frame_header\":\n\"AAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\n \"stage\": {\n  \"cleanup\": true\n },\n \"ssh\": {\n  \"hostname\": null,\n  \"port\": null,\n  \"username\": null,\n  \"password\": null,\n  \"privatekey\": null\n }\n}\n\n```\n\n-----\n\n```\nwayeyoy.com\n172.241.29.192:443 \nCertificate: [00:e7:34:3a:ad:bc:61:59:16:5e:d4:2b:e7:64:fa:8c:d5:42:40:17]\nNot Before: 2021/12/07 00:00:00 UTC \nNot After: 2022/12/07 23:59:59 UTC \nIssuer Org: Sectigo Limited \nSubject Common: wayeyoy.com [wayeyoy.com,www.wayeyoy.com ]\nPublic Algorithm: rsaEncryption\n\n```\nA configuration was not obtained for this server.\n\n**Exfiltration**\n\nWe did not observe any exfiltration indicators while analyzing host and network forensic\nartifacts.\n\nThis does not mean that there was no exfiltration, as this could have been performed via\nCobalt Strike beacons over encrypted channels.\n\n**Impact**\n\nOn the 19th day of the intrusion, the threat actors prepared for their final objectives. From\nthe beachhead host, the directory listings of the domain controllers were checked again,\nfollowed by the backup server. On the beachhead host, we observed the threat actors attempt\nto execute the final ransomware payload. From that host however the attempt failed.\n\nThe threat actors then proceeded to look for other elevation paths. After a failed attempt with\nCVE-2021-42278 and CVE-2021-42287, the threat actors executed Cobalt Strike beacons on\na couple of domain controllers. Once they established this access, around twenty minutes\nlater, they again attempted the ransomware deployment and this time the payload executed\nproperly and began spreading across the network via SMB.\n\nThe threat actors deployed ransomware payload in a DLL, named x64.dll, which was\nexecuted using backup.bat batch script.\n\n\n-----\n\n[This x64.dll DLL contains fingerprints, “conti_v3.dll”, seen in our previous cases:](https://thedfirreport.com/2021/05/12/conti-ransomware/)\n\n[We didn’t dig into reversing this DLL, as a detailed step-by-step analysis already exists, and](https://cybergeeks.tech/dissecting-the-last-version-of-conti-ransomware-using-a-step-by-step-approach/)\ngives an excellent explanation of command line parameters used during the execution of\nConti ransomware.\n\nOnce the threat actors pushed the encryptor to C$, an excessive SMB network activity were\ngenerated in a short period of time (~7K) as indicated by the chart.\n\nThis resulted in files being encrypted and a ‘readme.txt’ ransom note generated on the hosts:\n\nThe ransom note has slightly been modified from our last Conti cases:\n\n\n-----\n\n**Indicators**\n\n**Network**\n```\nEmail Addresses used for Atera Registration:\nmarsmors1947@gmail.com\nhughess6623@outlook.com\n5.181.80.214:80\nguguchrome.com\n5.181.80.113:443\napplesflying.com\n103.208.86.7:80\nbunced.net\n172.241.29.192:443\nwayeyoy.com\n23.81.246.30:443\ncirite.com\n216.73.159.33:80\nshytur.com\n\n```\n**File**\n\n\n-----\n\n```\ndata.dll\n71c8eb081c33fd6b2c10effa92154a18\n8222ed4fcac2c7408e7fbb748af1752e72bb9b01\nbaeb13eea3a71cfaba9d20ef373dcea69cf31f2ec21f45b83f29f699330cb3e3\nFaicuy4.exe\nfe4fb0b3ca2cb379d74cd239e71af44f\n6ccd04b109a5148a04ae3ac7f6bc061ccab2122f\na79f5ce304707a268b335f63d15e2d7d740b4d09b6e7d095d7d08235360e739c\nEwge.dll/Ijucko32.dll\nb3053228b51ae7af99e0abfa663368d5\n670d974d936262c1c569442238d953ed009f7c79\n4d62929aa9e76694a62b46bc05425452f26e1e9b09ea6f294850ace825229966\nEdebef4.dll\n7375eccff18bef7e89665d1a7f31edca\na0836d54aa2a783fd8bae685a1b94e913b655430\n50d2a2564541887570cf784c677de6900aa503648c510927e08c32b5a6ae3bf5\nx64.dll\n28bd01b6b3efa726bf00d633398c5c8a\n11012f0074e37e105c404a2eda61f9d652b8c03d\n8fb035b73bf207243c9b29d96e435ce11eb9810a0f4fdcc6bb25a14a0ec8\n\n```\n**Detections**\n\n**Suricata**\n```\nET MALWARE Cobalt Strike Malleable C2 JQuery Custom Profile Response\nET MALWARE Cobalt Strike Beacon Activity (GET)\nETPRO POLICY Observed Atera Remote Access Application Activity Domain in TLS SNI\nET POLICY Command Shell Activity Over SMB - Possible Lateral Movement\nET POLICY SMB Executable File Transfer\nET POLICY SMB2 NT Create AndX Request For an Executable File\nET HUNTING Possible Powershell .ps1 Script Use Over SMB\nET POLICY SMB2 NT Create AndX Request For a Powershell .ps1 File\n\n```\n**Sigma**\n\nhttps://github.com/SigmaHQ/sigma/blob/master/rules/windows/deprecated/sysmon_mi\nmikatz_detection_lsass.yml\n\nhttps://github.com/SigmaHQ/sigma/blob/11b6b24660c045bb907ed43cfe007349764173bc/\n[rules/windows/powershell/powershell_script/posh_ps_powerview_malicious_commandlet](https://github.com/SigmaHQ/sigma/blob/11b6b24660c045bb907ed43cfe007349764173bc/rules/windows/powershell/powershell_script/posh_ps_powerview_malicious_commandlets.yml)\ns.yml\n\nhttps://github.com/SigmaHQ/sigma/blob/071bcc292362fd3754a2da00878bba4bae1a335f/\nrules/windows/process_creation/proc_creation_win_ad_find_discovery.yml\n\n\n-----\n\nhttps://github.com/SigmaHQ/sigma/blob/6b3fc11a48e8aa2773dfe266c3be11e4c4c973a5/ru\n[les/windows/process_creation/proc_creation_win_powershell_defender_disable_feature.y](https://github.com/SigmaHQ/sigma/blob/6b3fc11a48e8aa2773dfe266c3be11e4c4c973a5/rules/windows/process_creation/proc_creation_win_powershell_defender_disable_feature.yml)\nml\n\nhttps://github.com/SigmaHQ/sigma/blob/eb382c4a59b6d87e186ee269805fe2db2acf250e/\nrules/windows/builtin/security/win_admin_share_access.yml\n\nhttps://github.com/SigmaHQ/sigma/blob/04f72b9e78f196544f8f1331b4d9158df34d7ecf/ru\nles/windows/builtin/application/win_software_atera_rmm_agent_install.yml\n\nhttps://github.com/SigmaHQ/sigma/blob/8bb3379b6807610d61d29db1d76f5af4840b8208\n/rules/windows/process_creation/proc_creation_win_trust_discovery.yml\n\nhttps://github.com/SigmaHQ/sigma/blob/becf3baeb4f6313bf267f7e8d6e9808fc0fc059c/ru\nles/windows/process_creation/proc_creation_win_susp_recon_activity.yml\n\nhttps://github.com/SigmaHQ/sigma/blob/e049058d14dd9ec09771b38ed4d59e8b49ba1bad\n/rules/windows/builtin/security/win_security_cobaltstrike_service_installs.yml\n\n\n-----\n\n```\ntitle: CHCP CodePage Locale Lookup\nstatus: Experimental\ndescription: Detects use of chcp to look up the system locale value as part of host\ndiscovery\nauthor: _pete_0, TheDFIRReport\nreferences:\n - https://thedfirreport.com/2022/04/04/stolen-images-campaign-ends-in-contiransomware/\n - https://docs.microsoft.com/en-us/windows-server/administration/windowscommands/chcp\ndate: 2022/02/21\nmodified: 2022/02/21\nlogsource:\n category: process_creation\n product: windows\ndetection:\n selection:\n  Image|endswith:\n   - '\\chcp.com'\n  CommandLine|endswith:\n   - 'chcp'\n  ParentImage|endswith:\n   - '\\cmd.exe'\n  ParentCommandLine|contains:\n   - '/c'\n condition: selection\nfields:\n - CommandLine\n - ParentCommandLine\nfalsepositives:\n - Unknown\nlevel: high\ntags:\n - attack.discovery\n - attack.t1614.001\n\n## YARA\n\n```\n\n-----\n\n```\n/ \n  YARA Rule Set \n  Author: The DFIR Report \n  Date: 2022-04-04\n  Identifier: 9438 conti\n  Reference: https://thedfirreport.com/2022/04/04/stolen-images-campaign-ends-inconti-ransomware/\n*/ \n/* Rule Set ----------------------------------------------------------------- */ \nrule cs_exe_9438 {\n  meta:\n   description = \"9438 - file Faicuy4.exe\"\n   author = \"TheDFIRReport\"\n   reference = \"https://thedfirreport.com/2022/04/04/stolen-images-campaign-endsin-conti-ransomware/\"\n   date = \"2022-04-04\"\n   hash1 = \"a79f5ce304707a268b335f63d15e2d7d740b4d09b6e7d095d7d08235360e739c\"\n  strings:\n   $x1 = \"C:\\\\Users\\\\Administrator\\\\Documents\\\\Visual Studio\n2008\\\\Projects\\\\MUTEXES\\\\x64\\\\Release\\\\MUTEXES.pdb\" fullword ascii\n   $s2 = \"mutexes Version 1.0\" fullword wide\n   $s3 = \"    <requestedExecutionLevel level=\\\"asInvoker\\\" uiAccess=\\\"false\\\">\n</requestedExecutionLevel>\" fullword ascii\n   $s4 = \".?AVCMutexesApp@@\" fullword ascii\n   $s5 = \".?AVCMutexesDlg@@\" fullword ascii\n   $s6 = \"About mutexes\" fullword wide\n   $s7 = \"Mutexes Sample\" fullword wide\n   $s8 = \" 1992 - 2001 Microsoft Corporation. All rights reserved.\" fullword wide\n   $s9 = \"&Process priority class:\" fullword wide\n   $s10 = \" Type Descriptor'\" fullword ascii\n   $s11 = \"&About mutexes...\" fullword wide\n   $s12 = \" constructor or from DllMain.\" fullword ascii\n   $s13 = \".?AVCDisplayThread@@\" fullword ascii\n   $s14 = \"IsQ:\\\"P\" fullword ascii\n   $s15 = \"CExampleThread\" fullword ascii\n   $s16 = \".?AVCCounterThread@@\" fullword ascii\n   $s17 = \".?AVCExampleThread@@\" fullword ascii\n   $s18 = \" <trustInfo xmlns=\\\"urn:schemas-microsoft-com:asm.v3\\\">\" fullword\nascii\n   $s19 = \"CDisplayThread\" fullword ascii\n   $s20 = \"CCounterThread\" fullword ascii\n  condition:\n   uint16(0) == 0x5a4d and filesize < 2000KB and\n   1 of ($x*) and 4 of them\n}\nrule conti_dll_9438 {\n  meta:\n\n```\n\n-----\n\n```\n   description 9438 file x64.dll \n   author = \"TheDFIRReport\"\n   reference = \"https://thedfirreport.com/2022/04/04/stolen-images-campaign-endsin-conti-ransomware/\"\n   date = \"2022-04-04\"\n   hash1 = \"8fb035b73bf207243c9b29d96e435ce11eb9810a0f4fdcc6bb25a14a0ec8cc21\"\n  strings:\n   $s1 = \"AppPolicyGetProcessTerminationMethod\" fullword ascii\n   $s2 = \"conti_v3.dll\" fullword ascii\n   $s3 = \"    <requestedExecutionLevel level='asInvoker' uiAccess='false' />\"\nfullword ascii\n   $s4 = \"api-ms-win-core-processthreads-l1-1-2\" fullword wide\n   $s5 = \"ext-ms-win-ntuser-dialogbox-l1-1-0\" fullword wide\n   $s6 = \" Type Descriptor'\" fullword ascii\n   $s7 = \"operator \\\"\\\" \" fullword ascii\n   $s8 = \"operator co_await\" fullword ascii\n   $s9 = \" <trustInfo xmlns=\\\"urn:schemas-microsoft-com:asm.v3\\\">\" fullword ascii\n   $s10 = \"api-ms-win-rtcore-ntuser-window-l1-1-0\" fullword wide\n   $s11 = \"api-ms-win-security-systemfunctions-l1-1-0\" fullword wide\n   $s12 = \"ext-ms-win-ntuser-windowstation-l1-1-0\" fullword wide\n   $s13 = \"api-ms-win-appmodel-runtime-l1-1-2\" fullword wide\n   $s14 = \" Base Class Descriptor at (\" fullword ascii\n   $s15 = \" Class Hierarchy Descriptor'\" fullword ascii\n   $s16 = \"bad array new length\" fullword ascii\n   $s17 = \" Complete Object Locator'\" fullword ascii\n   $s18 = \".data$r\" fullword ascii\n   $s19 = \" delete[]\" fullword ascii\n   $s20 = \" </trustInfo>\" fullword ascii\n  condition:\n   uint16(0) == 0x5a4d and filesize < 700KB and\n   all of them\n\n### MITRE\n\n```\n\n-----\n\n```\nT1614.001 System Location Discovery: System Language Discovery\nT1218.010 - Signed Binary Proxy Execution: Regsvr32\nT1218.011 - Signed Binary Proxy Execution: Rundll32\nT1059.001 - Command and Scripting Interpreter: PowerShell\nT1055 - Process Injection\nT1003.001 - OS Credential Dumping: LSASS Memory\nT1486 - Data Encrypted for Impact\nT1482 - Domain Trust Discovery\nT1021.002 - Remote Services: SMB/Windows Admin Shares\nT1219 - Remote Access Software \nT1083 - File and Directory Discovery\nT1562.001 - Impair Defenses: Disable or Modify Tools\nT1518.001 - Software Discovery: Security Software Discovery\nT1047 - Windows Management Instrumentation\nT1087.002 - Account Discovery: Domain Account\nT1068 - Exploitation for Privilege Escalation\nT1082 - System Information Discovery\nT1018 - Remote System Discovery\nT1053.005 - Scheduled Task/Job: Scheduled Task\nT1569.002 - Service Execution\nT1071.001 Web Protocols\nS0552 - AdFind\nS0154 - Cobalt Strike\nS0097 - Ping\n\n```\nInternal case #9438\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-04-04 - Stolen Images Campaign Ends in Conti Ransomware.pdf"
    ],
    "report_names": [
        "2022-04-04 - Stolen Images Campaign Ends in Conti Ransomware.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536083,
    "ts_updated_at": 1743041358,
    "ts_creation_date": 1653488421,
    "ts_modification_date": 1653488421,
    "files": {
        "pdf": "https://archive.orkl.eu/34efa31964c24520835da3621a95beca13a14cca.pdf",
        "text": "https://archive.orkl.eu/34efa31964c24520835da3621a95beca13a14cca.txt",
        "img": "https://archive.orkl.eu/34efa31964c24520835da3621a95beca13a14cca.jpg"
    }
}