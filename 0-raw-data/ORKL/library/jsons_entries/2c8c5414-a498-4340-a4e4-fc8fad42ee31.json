{
    "id": "2c8c5414-a498-4340-a4e4-fc8fad42ee31",
    "created_at": "2022-10-25T16:48:10.538064Z",
    "updated_at": "2025-03-27T02:08:40.682295Z",
    "deleted_at": null,
    "sha1_hash": "850ce69b276f4726de382eabcffa8cb8d68cecfc",
    "title": "Analysis Of Chinese Mitm On Google",
    "authors": "Netresec",
    "file_creation_date": "2014-09-06T13:15:37Z",
    "file_modification_date": "2014-09-06T13:15:37Z",
    "file_size": 343608,
    "plain_text": "Thursday, 04 September 2014 23:55:00 (UTC/GMT)\n\n_The Chinese are running a MITM attack on SSL encrypted traffic between Chinese universities and_\n\n_Google. We've performed technical analysis of the attack, on request from GreatFire.org, and can_\n\n_confirm that it is a real SSL MITM against www.google.com and that it is being performed from within_\n\n_China._\n\nWe were contacted by GreatFire.org yesterday (September 3) with a request to analyze two packet\n\ncaptures from suspected MITM-attacks before they finalized their blog post. The conclusions from our\n\nanalysis is now published as part of GreatFire.org's great blog post titled “Authorities launch man-in-the\nmiddle attack on Google”.\n\nIn their blog post GreatFire.org write:\n\nFrom August 28, 2014 reports appeared on Weibo and Google Plus that users in China trying to\n\naccess google.com and google.com.hk via CERNET, the country’s education network, were\n\nreceiving warning messages about invalid SSL certificates. The evidence, which we include later\n\nin this post, indicates that this was caused by a man-in-the-middle attack.\n\nWhile the authorities have been blocking access to most things Google since June 4th, they have\n\nkept their hands off of CERNET, China’s nationwide education and research network. However,\n\nin the lead up to the new school year, the Chinese authorities launched a man-in-the-middle\n\n(MITM) attack against Google.\n\nOur network forensic analysis was performed by investigating the following to packet capture files:\n\n\n**Client**\n**Capture Location**\n**Netname**\n\n\n**Capture**\n\n**Filename** **MD5**\n**Date**\n\n\naba4b35cb85ed218\nPeking University PKU6-CERNET2 Aug 30, 2014 google.com.pcap\n7a8a7656cd670a93\nChongqing\nCQU6-CERNET2 Sep 1, 2014 google_fake.pcapng [3bf943ea453f9afa]\nUniversity 5c06b9c126d79557\n\n**Client and Server IP adresses**\n\nThe analyzed capture files contain pure IPv6 traffic (CERNET is a IPv6 network) which made the analysis\n\na bit different then usual. We do not disclose the client IP addresses for privacy reasons, but they both\n\nseem legit; one from Peking University (netname PKU6-CERNET2) and the other from Chongqing\n\n\n-----\n\nInternet CERNET2 .\n\n_Peking University entrance, by galaygobi (Creative Commons Attribution 2.0)_\n\n_Chongqing University gate, by Brooktse (Creative Commons Attribution-Share Alike 3.0)_\n\nThe IP addresses received for www.google.com were in both cases also legit, so the MITM wasn't carried\n\nout through DNS spoofing The Peking University client connected to 2607:f8b0:4007:804::1013\n\n\n-----\n\n[2404:6800:4005:805::1010 (GOOGLE_IPV6_AP-20080930 in Australia).](http://wq.apnic.net/apnic-bin/whois.pl?searchtext=2404:6800::/32&object_type=inet6num)\n\n**Time-To-Live (TTL) Analysis**\n\nThe Time-To-Live (TTL) values received in the IP packets from www.google.com were in both cases 248 or\n\n249 (note: TTL is actually called ”Hop Limit” in IPv6 nomenclature, but we prefer to use the well\n\n_established term ”TTL” anyway). The highest possible TTL value is 255, this means that the received_\n\npackets haven't made more than 6 or 7 router hops before ending up at the client. However, the expected\n\nnumber of router hops between a server on GOOGLE-IPV6 and the client at Peking University is around\n\n14. The low number of router hops is is a clear indication of an IP MITM taking place.\n\n_[CapLoader with both capture files loaded, showing TTL values](http://caploader.com/)_\n\nHere is an IPv6 traceroute from AS25795 in Los Angeles towards the IP address at Peking University\n\n[(generated with ARP Networks' 4or6.com tool):](http://4or6.com/traceroute?l=en)\n\n#traceroute -6 2001:da8:[REDACTED]\n\n1 2607:f2f8:1600::1 (2607:f2f8:1600::1) 1.636 ms 1.573 ms 1.557 ms\n\n2 2001:504:13::1a (2001:504:13::1a) 40.381 ms 40.481 ms 40.565 ms\n\n3 * * *\n\n4 2001:252:0:302::1 (2001:252:0:302::1) 148.409 ms 148.501 ms 148.595 ms\n\n\n-----\n\n6 2001:252:0:1::1 (2001:252:0:1::1) 148.273 ms 147.620 ms 147.596 ms\n\n7 pku-bj-v6.cernet2.net (2001:da8:1:1b::2) 147.574 ms 147.619 ms 147.420 ms\n\n8 2001:da8:1:50d::2 (2001:da8:1:50d::2) 148.582 ms 148.670 ms 148.979 ms\n\n9 cernet2.net (2001:da8:ac:ffff::2) 147.963 ms 147.956 ms 147.988 ms\n\n10 2001:da8:[REDACTED] 147.964 ms 148.035 ms 147.895 ms\n\n11 2001:da8:[REDACTED] 147.832 ms 147.881 ms 147.836 ms\n\n12 2001:da8:[REDACTED] 147.809 ms 147.707 ms 147.899 ms\n\n[As can be seen in the traceroute above, seven hops before the client we find the 2001:252::/32 network,](http://wq.apnic.net/apnic-bin/whois.pl?searchtext=2001:252::/32&object_type=inet6num)\n\nwhich is called “CNGI International Gateway Network (CNGIIGN)”. This network is actually part of\n\n[CERNET, but on AS23911, which is the network that connects CERNET with its external peers. A](http://bgp.he.net/AS23911)\n\nreasonable assumption is therefore that the MITM is carried out on the 2001:252::/32 network, or where\n\nAS23910 (2001:da8:1::2) connects to AS23911 (2001:252:0:1::1). This means that the MITM attack is\n\nbeing conducted from within China.\n\n**Response Time Analysis**\n\nThe round-trip time between the client and server can be estimated by measuring the time from when the\n\nclient sends it initial TCP SYN packet to when it receives a TCP SYN+ACK from the server. The expected\n\nround-trip time for connecting from CERNET to a Google server overseas would be around 150ms or\n\nmore. However, in the captures we've analyzed the TCP SYN+ACK package was received in just 8ms\n\n(Peking) and 52ms (Chongqing) respectively. Again, this is a clear indication of an IP MITM taking place,\n\nsince Google cannot possibly send a response from the US to CERNET within 8ms regardless of how fast\n\nthey are. The fast response times also indicate that the machine performing the MITM is located fairly\n\nclose to the network at Peking University.\n\nEven though the machine performing the MITM was very quick at performing the TCP tree-way\n\nhandshake we noticed that the application layer communication was terribly slow. The specification for\n\n[the TLS handshake (RFC 2246) defines that a ClientHello message should be responded to with a](https://www.ietf.org/rfc/rfc2246.txt)\n\nServerHello. Google typically send their ServerHello response almost instantly, i.e. the response is\n\nreceived after one round-trip time (150ms in this case). However, in the analyzed captures we noticed\n\nServerHello response times of around 500ms.\n\n**X.509 Certificate analysis**\n\n[We extracted the X.509 certificates from the two capture files to .cer files using NetworkMiner. We](http://networkminer.com/)\n\nnoticed that both users received identical certificates which were both self signed for “google com” The\n\n\n-----\n\ntechnical user, since the web browser will typically display a warning about the site not being trusted.\n\nAdditionally the X.509 certificate was created for ”google.com” rather than ”*.google.com”. This is an\n\nobvious miss from the MITM'ers side since they were attempting to MITM traffic to ”www.google.com”\n\nbut not to ”google.com”.\n\nNetworkMiner showing list of X.509 certificates extracted from the two PCAP files\n\nCertificate SHA1 fingerprint: f6beadb9bc02e0a152d71c318739cdecfc1c085d\n\nCertificate MD5 fingerprint: 66:D5:D5:6A:E9:28:51:7C:03:53:C5:E1:33:14:A8:3B\n\n[A copy of the fake certificate is available on Google drive thanks to GreatFire.org.](https://docs.google.com/file/d/0ByksGrIc0SXfT0p3NFpKWFlrMkE/edit)\n\n**Conclusions**\n\nAll evidence indicates that a MITM attack is being conducted against traffic between China’s nationwide\n\neducation and research network CERNET and www.google.com. It looks as if the MITM is carried out on a\n\nnetwork belonging to AS23911, which is the outer part of CERNET that peers with all external networks.\n\nThis network is located in China, so we can conclude that the MITM was being done within the country.\n\nIt's difficult to say exactly how the MITM attack was carried out, but we can dismiss DNS spoofing as the\n\nused method. The evidence we've observed instead indicate that the MITM attack is performed either by\n\n[performing IP hijacking or by simply reconfiguring a router to forward the HTTPS traffic to a transparent](http://en.wikipedia.org/wiki/IP_hijacking)\n\nSSL proxy. An alternative to changing the router config would also be to add an in-line device that\n\nredirects the desired traffic to the SSL proxy. However, regardless of how they did it the attacker would be\n\n\n-----\n\nWe can also conclude that the method used to perform the MITM attack was similar to the Chinese MITM\n\non GitHub, but not identical.\n\n[Share |](http://www.addthis.com/bookmark.php?source=tbx32nj-1.0&=250&pubid=xa-4d7526e93a9537a7&url=http%3a%2f%2fwww.netresec.com%2f%3fpage%3dBlog%26month%3d2014-09%26post%3dAnalysis-of-Chinese-MITM-on-Google&title=Analysis%20of%20Chinese%20MITM%20on%20Google) [Short URL: http://netresec.com/?b=14955CB](http://netresec.com/?b=14955CB)\n\nPosted by Erik Hjelmvik on Thursday, 04 September 2014 23:55:00 (UTC/GMT)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        },
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/rpig9c10mj8wdri1ulftjxbabm543mxa",
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2014/2014.09.04.Analysis_of_Chinese_MITM_on_Google/Chinese_MITM_Google.pdf"
    ],
    "report_names": [
        "Chinese_MITM_Google"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716490,
    "ts_updated_at": 1743041320,
    "ts_creation_date": 1410009337,
    "ts_modification_date": 1410009337,
    "files": {
        "pdf": "https://archive.orkl.eu/850ce69b276f4726de382eabcffa8cb8d68cecfc.pdf",
        "text": "https://archive.orkl.eu/850ce69b276f4726de382eabcffa8cb8d68cecfc.txt",
        "img": "https://archive.orkl.eu/850ce69b276f4726de382eabcffa8cb8d68cecfc.jpg"
    }
}