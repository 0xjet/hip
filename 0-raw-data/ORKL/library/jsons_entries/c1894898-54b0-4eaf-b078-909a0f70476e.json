{
    "id": "c1894898-54b0-4eaf-b078-909a0f70476e",
    "created_at": "2023-01-12T14:59:22.642903Z",
    "updated_at": "2025-03-27T02:05:32.731235Z",
    "deleted_at": null,
    "sha1_hash": "7bc520624487763d42aa59e49ad1b3bf3918c54f",
    "title": "2020-02-05 - The Hole in the Bucket- Attackers Abuse Bitbucket to Deliver an Arsenal of Malware",
    "authors": "",
    "file_creation_date": "2022-05-28T18:25:35Z",
    "file_modification_date": "2022-05-28T18:25:35Z",
    "file_size": 1648810,
    "plain_text": "# The Hole in the Bucket: Attackers Abuse Bitbucket to Deliver an Arsenal of Malware\n\n**[cybereason.com/blog/the-hole-in-the-bucket-attackers-abuse-bitbucket-to-deliver-an-arsenal-of-malware](https://www.cybereason.com/blog/the-hole-in-the-bucket-attackers-abuse-bitbucket-to-deliver-an-arsenal-of-malware)**\n\nWritten By\nCybereason Nocturnus\n\nFebruary 5, 2020 | 9 minute read\n\n**Research by: Lior Rochberger and Assaf Dahan**\n\n\n-----\n\n## Introduction\n\nCybereason is following an active campaign to deliver an arsenal of malware that is able to steal data, mine for\ncryptocurrency, and deliver ransomware to victims all over the world. Due to the variety of malware types deployed in this\nattack, attackers are able to hit victims from all sides and do not have to limit themselves to one attack goal or another.\n[The payloads observed in this campaign originated from different accounts in code repository platform Bitbucket, which](https://bitbucket.org/product/)\nwas abused as part of the attackers delivery infrastructure.\n\nThe following malware are deployed and updated using Bitbucket by the threat actor:\n\n**Predator: Predator is an information stealer that steals credentials from browsers, uses the camera to take**\npictures, takes screenshots, and steals cryptocurrency wallets.\n**Azorult: Azorult is an information stealer that steals passwords, email credentials, cookies, browser history, IDs,**\ncryptocurrencies, and has backdoor capabilities.\n**Evasive Monero Miner: The Evasive Monero Miner is the dropper for a multi-stage XMRig Miner that uses**\nadvanced evasion techniques to mine Monero and stay under the radar.\n**STOP Ransomware: The STOP Ransomware is used to ransom the file system and is based on an open source**\nransomware platform. It also has downloader capabilities that it uses to infect the system with additional malware.\n**Vidar: Vidar is an information stealer that steals web browser cookies and history, digital wallets, two-factor**\nauthentication data, and takes screenshots.\n**Amadey bot: Amadey bot is a simple trojan bot primarily used for collecting reconnaissance information on a target**\nmachine.\n**IntelRapid: IntelRapid is a cryptocurrency stealer that steals different types of cryptocurrency wallets.**\n\n**Cybereason reached out to Bitbucket Support and the malicious repositories mentioned in the report were**\n**deactivated within a few hours.**\n\n_The flow of the Bitbucket multi-payload attack._\n\nThis research highlights an ongoing trend with cybercriminals where they abuse legitimate online storage platforms like\nGithub, Dropbox, Google Drive, and Bitbucket to distribute commodity malware.\n\nIn this campaign, the attackers abuse the Bitbucket platform by creating several user accounts that are updated\n[frequently. Regular updates to the malware stored on these accounts and the use of Themida as a packer are used to](https://www.oreans.com/themida.php)\n[evade detection by antivirus products and thwart analysis attempts. They also use the CypherIT Autoit packer to pack](https://www.autoitscript.com/site/)\nAzorult and give additional layers of protection against analysis.\n\n\n-----\n\nThis research is particularly interesting because of how the attackers infect a single target machine with multiple different\nkinds of malware. These kinds of commodity malware are often used for a one-off infection to steal data on the machine\nand sell it in underground hacking communities. However, in this attack, the attackers chose to integrate malware like\ncoin miners and ransomware, which gives them a more persistent source of revenue. Each piece of malware in this\ncampaign makes the attack stronger, with additional capabilities and features for a greater impact.\n\n## Key Points\n\n**Abuses resource sharing platforms: The Cybereason Nocturnus team is investigating an ongoing campaign that**\nabuses the Bitbucket infrastructure to store and distribute a large collection of different malware. The attackers\naren’t satisfied with one payload, they want to use multiple to maximize their revenue.\n**Attacks from all sides: This campaign deploys an arsenal of malware for a multi-pronged assault on businesses.**\nIt is able to steal sensitive browser data, cookies, email client data, system information, and two-factor\nauthentication software data, along with cryptocurrency from digital wallets. It is also able to take pictures using the\ncamera, take screenshots, mine Monero, and in certain cases also deploy ransomware.\n**Far Reaching: This ongoing campaign has infected over 500,000 machines worldwide thus far.**\n**Modular and Constantly Updating: The attackers leverage Bitbucket to easily update payloads and distribute**\nmany different types of malware at once. In order to evade detection, they have an array of user profiles and\ncontinuously update their repositories, at times as often as every hour.\n**Many kinds of malware: The attackers use the Evasive Monero Miner to steal a combination of data, mine**\ncryptocurrency, and deploy other malware including the Vidar stealer, Amadey Bot, and IntelRapid. They also use\nPredator the Thief, Azorult, and the STOP ransomware over the course of their activities.\n**Devastating impact: The combination of so many different types of malware exfiltrating so many different types of**\ndata can leave organizations unworkable. This threat is able to compromise system security, violate user privacy,\nharm machine performance, and cause great damage to individuals and corporations by stealing and spreading\nsensitive information, all before infecting them with ransomware.\n\n[For a synopsis of this research, check out the Bitbucket Threat Alert.](https://www.cybereason.com/hubfs/Threat%20Alerts/Nocturnus%20Threat%20Alert%20-%20Bitbucket%20Malware%20Arsenal.pdf)\n\n## Table of Contents\n\n Anatomy of the Multi-payload Attack\n\n Initial compromise via Predator Infostealer\n\nThis attack starts with an unsuspecting user downloading a cracked version of commercial software like Adobe\nPhotoshop, Microsoft Office, and others. Threat actors often target users looking for “free” commercial products by\nbundling legitimate software with different kinds of malware. In this instance, we are seeing vast amounts of cracked\nsoftware bundled with the Azorult Infostealer and Predator the Thief.\n\n[Predator the Thief is an information stealer that steals sensitive data like passwords from browsers, takes pictures, takes](https://www.fortinet.com/blog/threat-research/predator-the-thief-recent-versions.html)\nscreenshots, and steals cryptocurrency wallets. Predator had previously been delivered via exploit kits like the RIG\nExploit Kit and through phishing attacks.\n\nWhen a user attempts to install the “free commercial software”, it actually drops Azorult and Predator onto the target\nmachine. Azorult (download.exe) immediately starts stealing information and deleting its binary to cover its tracks. After\nAzorult executes, Predator (dowloadx.exe) creates a connection to Bitbucket to begin downloading additional payloads.\n\n\n-----\n\n_Cybereason UI: the attack tree of the execution of the malicious zip file._\n\nWe identified the download URLs for additional payloads of Azorult and the Evasive Monero Miner from a Bitbucket\nrepository at hxxps://bitbucket[.]org/patrickhornvist/repo/ by unpacking Predator.\n\n_Deobfuscated strings in memory from downloadx.exe show download URLs of other malware._\n\nThere are multiple additional payloads on Bitbucket:\n\n1.exe and 3.exe, both of which are Azorult information stealers with different hashes.\n2.exe and 8800.exe, both of which are Predator the Thief with different hashes.\n4.exe and 5.exe, both of which are the Evasive Monero Miner with different hashes.\n111.exe, the STOP ransomware.\n\n\n-----\n\n_Screenshot of the Bitbucket repo: https://bitbucket[.]org/patrickhornvist/repo/downloads_\n\nThrough research of other samples related to the campaign, we have identified additional Bitbucket repositories that are\nlikely created by the same threat actor with the same set of malware samples. Judging by the number of downloads, we\nestimate over 500,000 machines have been infected by the campaign so far, with hundreds of machines affected every\nhour.\n\nhttps://bitbucket[.]org/luisdomingue1/new/downloads/\n\nhttps://bitbucket[.]org/BasilCowan/new/downloads/\n\nIt’s worth noting that the payloads on Bitbucket are updated almost constantly by the threat actor, sometimes as often as\nevery few hours. This is likely done to avoid detection by traditional antivirus by replacing old binaries with fresh ones\nunknown to AV engines.\n\n## Evasive Azorult\n\n[Azorult is an information stealer that uses a quick and dirty approach to steal sensitive data. After it successfully steals](https://attack.mitre.org/software/S0344/)\nsensitive information, it deletes any trace of itself by removing all associated files.\n\n## Attack Flow for Azorult\n\nPredator downloads a secondary downloader which is used to download an evasive version of Azorult. In order to\ndownload Azorult, this downloader connects to hxxps://2no[.]co/2QqYb5 and downloads an encoded file in a certificate\nform named bolo.com.\n\n\n-----\n\n_The encoded Azorult payload, a file named bolo.com._\n\nThe downloader uses certutil.exe, a native Windows binary, to decode the payload using the living-off-the-land\n[technique. We have previously reported how the Ramnit trojan has been decoded using this technique. The contents of](https://www.cybereason.com/blog/banking-trojan-delivered-by-lolbins-ramnit-trojan)\nthe decoded payload have another layer of obfuscation as well.\n\n_The decoded Azorult payload - grol._\n\nTo execute the decoded payload, the malware launches the Autoit compiler, which the threat actor renamed to lsm.com.\nAutoIt is a freeware scripting language used to automate the Windows GUI and general scripting. It is compatible with all\nversions of Windows with no prerequisites, which makes it a useful tool for attackers looking to create malware.\n\n_Cybereason UI: the attack tree of the evasive Azorult execution._\n\nOnce executed, Azorult scans the file system and searches for sensitive data like browser data, cookies, email clients\nand cryptocurrency wallets. It copies this data to the %TEMP% directory, packs it, and sends it to the attacker. Once all\ninformation has been exfiltrated, Azorult removes all data copied to %TEMP% and deletes its binary to cover its tracks.\n\n## STOP Ransomware and the Vidar Stealer\n\n\n-----\n\nThe [STOP Ransomware was first discovered in 2018, but began its most aggressive campaigns in early 2019. Over the](https://blogs.quickheal.com/stop-djvu-ransomware-ransom-shady-habits/)\n[year, it evolved to strengthen its encryption and evade detection, and at one point was even used to deliver Azorult onto](https://cyware.com/news/stop-ransomware-installs-azorult-trojan-onto-victims-systems-to-steal-credentials-c48f76dc)\nvictim’s systems.\n\nPredator downloads the STOP Ransomware from Bitbucket (111.exe) and executes it. STOP gathers information about\nthe target machine by accessing api.2ip.ua and checks to see if it is running on a VM.\n\nSTOP creates a folder in %AppData%, copies its binary there, and changes access control to the file using icacls so\nothers cannot access it.\n\nSTOP creates a RUN registry key and a scheduled task to execute itself every five minutes. While running, it connects to\nthe C2 server, sends the C2 the MD5 hash of the MAC address, and downloads a key for file encryption.\n\nSTOP also downloads additional payloads onto the machine, including:\n\nhxxp://ring2[.]ug/files/cost/updatewin2.exe\nhxxp://ring2[.]ug/files/cost/updatewin1.exe\nhxxp://ring2[.]ug/files/cost/updatewin.exe\nhxxp://ring2[.]ug/files/cost/3.exe\nhxxp://ring2[.]ug/files/cost/4.exe\nhxxp://ring2[.]ug/files/cost/5.exe\n\n_updatewin.exe and updatewin2.exe help STOP evade detection, and the other payloads are independent pieces of_\nmalware: the Visel Trojan, the infamous Vidar stealer, and several other files.\n\n_Cybereason UI: the process tree of STOP Ransomware and Vidar stealer._\n\nVidar is a well-known information stealer that collects system information, passwords from browsers, email, and twofactor authentication software data. It stores stolen data in a randomly named folder in %ProgramData% and sends the\ninfo to its C2 server, besfdooorkoora[.]com. After the data is sent to the attacker, the malware stops the process and\ndeletes its payload from the machine (5.exe).\n\n## Evasive Monero Miner: Old Miner, New Dropper\n\nEver since the rise of Bitcoin, miners have gained popularity in the underground community, becoming one of the best\nsellers for attackers looking to make an easy profit. In this campaign, attackers continue this trend by distributing an\nEvasive Monero Miner.\n\n[The Evasive Monero Miner is a dropper that drops a version of the infamous, open source XMRig miner based on its](https://github.com/xmrig/xmrig)\noriginal source code. An older version of the Evasive Monero Miner was first submitted to VirusTotal in late 2018, but was\n[not discovered until December 2019 after a massive campaign that infected machines all over the world.](https://www.acronis.com/en-us/blog/posts/acronis-discovers-new-autoit-cryptominer-campaign-injecting-windows-process)\n\nThe dropper is packed with Themida, a powerful packer with anti-debug features and a way of packing that intentionally\nmakes it difficult to manually unpack. It uses an Autoit compiled script to unpack and download the XMRig miner. The\ndropper also uses several evasive techniques it uses to avoid detection including code injection file renaming encoded\n\n\n-----\n\nfiles, non executable extensions, and the ability to connect through Tor.\n\n## Deep Dive into the Monero Dropper\n\nWhen the Evasive Monero Miner is first executed, it drops several files in the %TEMP% folder:\n\nCL_Debug_Log.txt\nCR_Debug_Log.txt\nAsacpiex.dll (same as CR_Debug_Log.txt)\n\nCL_Debug_Log.txt is the binary for the 7zip executable renamed to hide its activity. It extracts and decodes a 7zip\narchive named CR_Debug_Log.txt. CR_Debug_Log.txt extracts a 32-bit and 64-bit version of the payload of the miner,\n_32.exe and 64.exe, into %TEMP%._\n\nAfter extracting the payload, the dropper deletes the encoded archive CR_Debug_Log.txt and checks if the machine’s\narchitecture is 32-bit or 64-bit. Depending on the results of the check, it copies the relevant binary, renames it helper.exe,\nand saves it in \\AppData\\Roaming\\Microsoft\\Windows.\n\n_Cybereason UI: attack tree of the execution of the XMRig Miner Dropper_\n\nThe dropper also creates an XML file in %TEMP% named SystemCheck.xml along with a scheduled task SystemCheck\nthat runs the XML file every minute.\n\nThe XML file is configured to run helper.exe with the argument -SystemCheck:\n\n_How Sys5emCheck.xml executes helper.exe._\n\nhelper.exe is a compiled Autoit script. The script sets a few variables for the malware configuration, including:\n\nCommand line parameter\nTCP Protocol\nThe mining pool for the miner, with port manip2[.]hk:7777.\nA list of processes it must check to see if it is being analyzed.\nTwo URL paths public2/udp.txt and public2/32/32.txt, or fpublic2/64/64.txt for the 64-bit version.\nA password DxSqsNKKOxqPrM4Y3xeK that, based on the name of the variable, is used to decrypt an archive.\n\n\n-----\n\n_helper.exe decompiled code: the variables setting._\n\nhelper.exe contains two embedded binaries built during execution, the first of which is a 7zip binary.\n\n_helper.exe decompiled code: 7Zip binary embedded code._\n\nThe second is an encoded 7zip archive for a Tor client named Tor.tmp. Tor.tmp is decoded using the embedded\npassword in helper.exe and extracted to \\AppData\\Roaming\\Microsoft\\Windows\\Tor\\.\n\n_helper.exe decompiled code: Tor client embedded code._\n\n_Cybereason UI: command line used to extract the Tor.tmp archive._\n\nThe dropper checks for various antivirus engines on the target machine, as well as if the SmartScreen feature of\nWindows Defender exists. SmartScreen is used to protect against phishing and various malware websites.\n\n\n-----\n\n_The helper.exe decompiled code: an embedded list of security products._\n\nhelper.exe holds four domains encoded in Base64:\n\n_helper.exe decompiled code: embedded Base64 encoded domains._\n\nThe decoded domains:\n\n_bgpaio75egqvqigekt5bqfppzgth72r22f7vhm6xolzqd6ohroxs7pqd[.]onion_\n_jr2jjfxgklthlxh63cz3ajdvh7cj6boz3c3fbhriklk7yip4ce4vzsyd[.]onion_\n_uovyniuak3w4d3yzs4z4hfgx2qa6l2u6cx4wqsje4pmnmygc6vfddwqd[.]onion_\n_Rcjndzwubq5zbay5xoqk4dnc23gr4ifseqqsmbw5soogye6yysc7nkyd[.]onion_\n\nThe dropper uses the Tor client to connect to one of the decoded domains, combined with the URL paths, and\ndownloads the contents into a file named SysBackup.tmp and the malware version into a file name upd.version to the\ntarget machine. Both of these files are created under \\AppData\\Roaming\\Microsoft\\Windows\\.\n\n_helper.exe decompiled code: creating the GET request that downloads the XMRig miner - SysBackup.tmp._\n\nAfter the file is downloaded, the dropper terminates tor.exe.\n\n_Sysbackup.tmp houses a bytes array for the XMRig miner executable._\n\n\n-----\n\n_XMRig file properties._\n\n_helper.exe spawns attrib.exe and injects the XMRig miner code into memory._\n\n_XMRig code floating in memory of attrib.exe. Taken using Process Hacker._\n\nThe dropper executes attrib.exe with a command line that specifies the mining pool and the wallet where the miner will\nadd its resources.\n\n_helper.exe decompiled code: building the command line for attrib.exe._\n\n## Closing Thoughts\n\nAttackers continue to abuse legitimate online storage platforms for their own gain. By storing malicious payloads on\ntrusted platforms, attackers can bypass security products to exploit the trust given to legitimate online services. In\naddition, it provides the attackers with another way of reducing the risk of exposure to their C2 server infrastructure\nthrough separating the delivery infrastructure (online storage platforms) from the C2 server infrastructure.\n\nIn some ways, this attack takes persistent revenue to the next level. These attackers infect the target machine with\ndifferent kinds of malware to get as much sensitive data as possible, alongside miner capabilities and ransomware\ncapabilities. This attack is the epitome of “have your cake and eat it too”, with attackers layering malware for maximum\nimpact.\n\nAttackers continue to evolve and look for more effective ways to make a profit. They are finding that, when their tools fail,\nthey can use legitimate ones instead. Security practitioners must find ways to evolve faster and ensure the security of\nthese trusted resources so we can stay ahead of these threats.\n\n\n-----\n\n_The best way to defend against an attack like this is to use an iterative security process. Learn more in our whitepaper,_\n**_\"Unleashing the true potential of MITRE ATT&CK.\"_**\n\n## Indicators of compromise\n\n[Click here for a full list of the IOCs (PDF).](https://www.cybereason.com/hubfs/BitBucket%20Malware%20Arsenal%20IOCs.pdf)\n\n## MITRE ATT&CK BREAKDOWN\n\n\n**Initial Access** **Execution** **Persistence** **Privilege**\n**Escalation**\n\n\n**Defense Evasion** **Credential**\n**Access**\n\n\n**Collection** **C&C**\n\n\nDrive-by\nCompromise\n\nSpearphishing\nLink\n\nAbout the Author\n\n\nCommandLine\nInterface\n\nScheduled\nTask\n\n\nScheduled\nTask\n\nRegistry\nRun Keys /\nStartup\nFolder\n\n\nBypass\nUser\nAccount\nControl\n\nStartup\nItems\n\n\nBypass User\nAccount Control\n\nDeobfuscate/Decode\nFiles or Information\n\nDisabling Security\nTools\n\n\nCredentials\n[from Web](https://attack.mitre.org/techniques/T1503)\nBrowsers\n\nCredentials\nin Files\n\nCredentials\nin Registry\n\n\nAudio\nCapture\n\nData from\n[Information](https://attack.mitre.org/techniques/T1213)\nRepositories\n\nScreen\nCapture\n\n\nCommonly\nUsed Port\n\nData\nEncoding\n\nMulti-hop\nProxy\n\n\n[Scripting](https://attack.mitre.org/techniques/T1064) Shortcut\nModification\n\nUser\nExecution\n\n\n[File Deletion](https://attack.mitre.org/techniques/T1107) Video\nCapture\n\n[Process Injection](https://attack.mitre.org/techniques/T1055)\n\n[Software Packing](https://attack.mitre.org/techniques/T1045)\n\n[Masquerading](https://attack.mitre.org/techniques/T1036)\n\n\n**Cybereason Nocturnus**\n\n\n-----\n\nThe Cybereason Nocturnus Team has brought the world’s brightest minds from the military, government intelligence, and\nenterprise security to uncover emerging threats across the globe. They specialize in analyzing new attack\nmethodologies, reverse-engineering malware, and exposing unknown system vulnerabilities. The Cybereason Nocturnus\nTeam was the first to release a vaccination for the 2017 NotPetya and Bad Rabbit cyberattacks.\n\n[All Posts by Cybereason Nocturnus](https://www.cybereason.com/blog/authors/cybereason-nocturnus)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-02-05 - The Hole in the Bucket- Attackers Abuse Bitbucket to Deliver an Arsenal of Malware.pdf"
    ],
    "report_names": [
        "2020-02-05 - The Hole in the Bucket- Attackers Abuse Bitbucket to Deliver an Arsenal of Malware.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535562,
    "ts_updated_at": 1743041132,
    "ts_creation_date": 1653762335,
    "ts_modification_date": 1653762335,
    "files": {
        "pdf": "https://archive.orkl.eu/7bc520624487763d42aa59e49ad1b3bf3918c54f.pdf",
        "text": "https://archive.orkl.eu/7bc520624487763d42aa59e49ad1b3bf3918c54f.txt",
        "img": "https://archive.orkl.eu/7bc520624487763d42aa59e49ad1b3bf3918c54f.jpg"
    }
}