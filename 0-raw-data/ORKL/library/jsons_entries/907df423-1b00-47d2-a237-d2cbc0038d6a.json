{
    "id": "907df423-1b00-47d2-a237-d2cbc0038d6a",
    "created_at": "2023-01-12T15:09:51.425823Z",
    "updated_at": "2025-03-27T02:05:54.03401Z",
    "deleted_at": null,
    "sha1_hash": "683462fe97ad7140efb04310581c24d6af65cf62",
    "title": "2016-07-08 - Investigating the LuminosityLink Remote Access Trojan Configuration",
    "authors": "",
    "file_creation_date": "2022-05-28T02:12:59Z",
    "file_modification_date": "2022-05-28T02:12:59Z",
    "file_size": 538470,
    "plain_text": "# Investigating the LuminosityLink Remote Access Trojan Configuration\n\n**[researchcenter.paloaltonetworks.com/2016/07/unit42-investigating-the-luminositylink-remote-access-trojan-configuration/](https://researchcenter.paloaltonetworks.com/2016/07/unit42-investigating-the-luminositylink-remote-access-trojan-configuration/)**\n\nJosh Grunzweig July 8, 2016\n\nBy [Josh Grunzweig](https://unit42.paloaltonetworks.com/author/joshgruznweig/)\n\nJuly 8, 2016 at 5:00 AM\n\n[Category: Malware,](https://unit42.paloaltonetworks.com/category/malware-2/) [Threat Prevention,](https://unit42.paloaltonetworks.com/category/threat-prevention-2/) [Unit 42](https://unit42.paloaltonetworks.com/category/unit42/)\n\nTags: [ConfuserEx,](https://unit42.paloaltonetworks.com/tag/confuserex/) [LuminosityLink,](https://unit42.paloaltonetworks.com/tag/luminositylink/) [RAT,](https://unit42.paloaltonetworks.com/tag/rat/) [Trojan](https://unit42.paloaltonetworks.com/tag/trojan/)\n\nThis post is also available in: 日本語 [(Japanese)](https://unit42.paloaltonetworks.jp/unit42-investigating-the-luminositylink-remote-access-trojan-configuration/)\n\nIn recent weeks, I’ve spent time investigating the LuminosityLink Remote Access Trojan’s (RAT) embedded configuration. For those unaware,\nLuminosityLink is a malware family costing $40 that purports to be a system administration utility. However, when executed, the malware\nleverages a very aggressive keylogger, as well as a number of other malicious features that allow an attacker to gain full control over a victim\nmachine.\n\n_Figure 1 LuminosityLink website_\n\nAt the request of a coworker, I was asked to extract the configuration of a LuminosityLink sample, and while I could have simply executed the\nmalware in a sandboxed environment and pulled the configuration from memory, I chose to see if I could perform the same action against the\nstatic binary.\n\nThis led to me understanding how the configuration is encrypted within the binary, as well as how to parse that configuration. I’ve created a\nscript to perform this action against an unaltered LuminosityLink malware sample, which I will be sharing within this blog post. Furthermore, I\nlooked at the roughly 18,000 LuminosityLink samples Palo Alto Networks has collected over time, and using this script, I was able to extract\nthe configurations of 14,700 samples. (This data can be found in the Appendix section of this post.)\n\n## Overview of LuminosityLink\n\nOriginally surfacing in May 2015, LuminosityLink’s popularity has been on the rise, as shown in the following chart. To date, Palo Alto Networks\nhas tracked approximately 50,000 attempted infections of LuminosityLink against our customers.\n\n_Figure 2 AutoFocus graph of LuminosityLink sessions over time._\n\nLuminosityLink currently sells for $40 and can be purchased directly from its author. This package allows attackers to host a LuminosityLink\nserver as well as generate customized binaries, which are obfuscated with ConfuserEx 0.4.0. ConfuserEx is an open-source project that\nobfuscates the underlying .NET code, making it much more difficult for reverse engineers that decompile it. This is important to note for later\nwhen we discuss determining how to reverse-engineer the encryption process.\n\nAs mentioned previously, a number of configuration options are included, as we can see in the following screenshot.\n\n\n-----\n\n_Figure 3 Client configuration options in LuminosityLink_\n\nOnce executed, attackers are given a wealth of options, including keylogging, remote desktop, password stealing, and interacting with a shell\non the device.\n\n## Reverse-Engineering the Configuration\n\nThe first step in parsing out the configuration of LuminosityLink is to extract it statically. I initially opened up a clean LuminosityLink sample\n[using a program named dnSpy to search for clues as to where the configuration might be stored. (As a quick aside, I highly recommend](https://github.com/0xd4d/dnSpy)\ndnSpy, as it not only does a great job of decompiling the provided .NET binary, but it also comes equipped with a built-in debugger, which is\ninstrumental in tackling problems such as the one we are facing.)\n\nWhen initially opening up a sample binary, I didn’t expect much as I knew the sample was obfuscated using ConfuserEx. However, looking at\nthe resources of the sample, I saw some strings that looked promising.\n\n_Figure 4 Embedded resource strings in LuminosityLink_\n\nAs we can see, the malware contains a number of resources that in turn contain what appears to be Base64-encoded data. The\n“SMARTLOGS”, “XML”, and “CONFIG” resources all contain a wealth of data, which, at this point, is still unknown. Unfortunately, decoding\nthese strings results in garbage, which likely means some other form of encryption is being used underneath.\n\nI continued to investigate the underlying code, which, while obfuscated, still provides a high-level idea of what various classes are doing. Using\nimported namespaces, API calls and certain un-obfuscated strings, we’re able to get clues as to what is going on within the program.\nSpecifically, we see the fd() class using the namespace of ‘System.Security.Cryptography’, which certainly merits investigation as we\nsuspected crypto being used against the earlier referenced resource strings.\n\n\n-----\n\n_gu e 5 C yptog ap y_ _a_ _espace be g used by_ _u_ _os ty_\n\nAs we further investigate this class, we see references to the following classes and functions:\n\nMD5CryptoServiceProvider\nComputeHash\nFromBase64String\nRijndaelManaged\n\nAt this point, I turned to my debugger in an attempt to see how these strings were handled. I set breakpoints on various calls previously\nmentioned. Specifically, the breakpoint on the RijndaelManaged class yields excellent results.\n\n_Figure 6 Successful recovery of AES-128 key_\n\nWe’re able to not only verify that AES-128 encryption is used, but also verify that the “SMARTLOGS” resource string is being used. We also\nare able to identify the string being used as the key, which in this particular example is\n“\\\\ecnOnuR\\\\noisreVtnerruC\\\\swodniW\\\\tfosorciM\\\\erawtfoS”. Further investigation reveals that this string is hashed using the MD5 algorithm.\nThe first 15 bytes of this hash is concatenated with the entire 16 bytes of the hash, followed by a null byte. We can replicate this decryption\nprocess in Python as such:\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\ndef decrypt_data(data, key_string):\ndecoded_data = base64.b64decode(data)\nm = hashlib.md5()\nm.update(key_string)\nmd5 = m.digest()\nkey = md5[0:15]+md5+\"\\x00\"\nmode = AES.MODE_ECB\niv = '\\x00' * 16\ne = AES.new(key, mode, iv)\nreturn e.decrypt(decoded_data)\n\n\nWe can further verify that this is correct using the above code. In the following example, the data variable has been set with the base64encoded string found within the “SMARTLOGS” resource, and the key_string variable has been set to the reversed registry key previously\nmentioned.\n\n\n1\n2\n\n\n>>> print decrypt_data(data, key_string)\n172.16.1.100|11111|backup.dns.com|filename.exe|startup_name|folder_name|data_directory_name|backup_startup.exe|df5e0e1c667c399588\n\n\nUsing trial and error, we’re able to successfully map each variable witnessed in the above configuration. The last variable proves to be quite\ninteresting, as each character except for ‘1’ maps to a particular configuration option. The following mapping was determined:\n\n_i : Enable Client Installation/Startup_\n_d : Client Persistence Module: Protect Luminosity's Client Binary_\n_s : Silent Mode (Hide Luminosity Window on Client PC)_\n_a : Proactive Anti-Malware: Clean Malicious Files and Speed up Client PC_\n_n : Power Saver: Prevent Sleep Mode and Turn off Monitor after 15 minutes of inactivity_\n_m : Remove File after Execution (Melt)_\n_v : Anti-Virtual Machines/Debugging_\n_h : Hide File and Directories_\n_b : Backup Startup_\n\nUsing this knowledge, we can parse the above configuration, which yields the following results.\n\n\n-----\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nDomain/IP:      172.16.1.100\nPort:         11111\nBackup DNS:      backup.dns.com\nFilename:       filename.exe\nStartup Name:     startup_name\nFolder Name:     folder_name\nData Directory Name: data_directory_name\nBackup Startup Exe:  backup_startup.exe\nMutex:        df5e0e1c667c399588b014cb9b4ae7b33c9c0b4cac9d4169f39197e41e9a43a4\nBuild ID:       BuildID\nSettings:\n[X] Enable Client Installation/Startup\n[X] Client Persistence Module: Protect Luminosity's Client Binary\n[X] Silent Mode (Hide Luminosity Window on Client PC)\n[ ] Proactive Anti-Malware: Clean Malicious Files and Speed up Client PC\n[X] Power Saver: Prevent Sleep Mode and Turn off Monitor after 15 minutes of inactivity\n[ ] Remove File after Execution (Melt)\n[ ] Anti-Virtual Machines/Debugging\n[ ] Hide File and Directories\n[X] Backup Startup\n\n\n## Parsing LuminosityLink Configurations at Scale\n\nUsing this knowledge, we created a script to parse the configuration of a given sample. The script searches for strings that appear to be\nbase64-encoded with a length greater than 50 and takes a brute-force approach. While not elegant, it does the job quite successfully. The\nscript can be downloaded in the Appendix section of this blog post.\n\nGoing through Palo Alto Networks repository of samples, we found roughly 18,000 files tagged as LuminosityLink. For these 18,000 samples,\nwe applied our static configuration extraction and parsing script and successfully retrieved about 4,500 configurations. The remaining samples\nwere packed beyond the built-in ConfuserEx obfuscation routine, and as such, the raw configuration strings were not present.\n\nThese samples were run through a local instance of the open-source Cuckoo Sandbox, where the process dumps were extracted. The same\nscript was applied to these process dumps, where we were able to obtain an additional 10,200 configurations, leaving us with a total of 14,700\nparsed LuminosityLink configurations.\n\nAs the samples were processed, further keys were discovered to be used by the author. The following additional three strings were used to\ngenerate the keys to LuminosityLink samples.\n\nThis conf'ig contains nothing useful. Quit acting as if you're cool by decrypting it.\nResources.SMARTLOGS\nSpecify a Password\n\nIt appears as though the author of LuminosityLink is not without a sense of humor. Additionally, as we parsed older samples, it was discovered\nthat the configuration made a change sometime between February and June of this year. Fewer options were available in the configuration of\nolder samples. The provided script accounts for these differences and various keys used.\n\nUsing the aggregated data from the 14,700 configurations, the following high-level statistics were pulled:\n\n_Figure 7 Prevalence of enabled settings in LuminosityLink configurations_\n\n**Top C2 TLDs/IP Addresses**\n\n[3308] ddns[.]net\n\n[2537] duckdns[.]org\n\n[904] no-ip[.]biz\n\n[670] chickenkiller[.]com\n\n[378] no-ip[.]org\n\n[377] mooo[.]com\n\n[242] fishdns[.]com\n\n[174] no-ip[.]info\n\n[165] ignorelist[.]com\n\n[157] freedns[ ]su\n\n\n-----\n\n**p**\n\n[4829] HOME\n\n[83]  Client\n\n[82]  crtx1\n\n[71]  M4CHINATION\n\n[65]  CSGO\n\n[65]  NEW\n\n[59]  Slave\n\n[47]  CAPO\n\n[44]  Youtube\n\n[42]  PROJECT.D\n\n**Top Executable Names**\n\n[1973] sysmon.exe\n\n[1831] client.exe\n\n[1254] helper.exe\n\n[1207] repair.exe\n\n[1087] winlogon.exe\n\n[509] svchost.exe\n\n[315] Luminosity.exe\n\n[83]  WinCOMHost.exe\n\n[82]  chrome.exe\n\n[61]  windowsbootapp.exe\n\n**Top Ports**\n\n[1866] 6318\n\n[1055] 1400\n\n[493] 1604\n\n[412] 1337\n\n[214] 3175\n\n[182] 22028\n\n[162] 9045\n\n[119] 2122\n\n[115] 100\n\n[113] 9999\n\nThe parsed configuration data, provided in the CSV file format, is being freely provided to the security community in the hope that protections\nwill be created against this threat.\n\n## Conclusion\n\nLuminosityLink, while marketed as a systems administration utility, is a formidable keylogger and backdoor used by a large number of\ncriminals. To date, Palo Alto Networks has witnessed over 50,000 attempted infections of LuminosityLink, encompassing 18,000 unique\nsamples. The malware is cheap and readily available to the public, making this a dangerous threat to both organizations and individuals alike.\n\nBy reverse-engineering LuminosityLink samples, we were able to statically extract and parse the embedded configuration, which in turn\nprovides valuable information about with what hosts and ports the malware is configured to communicate. It also provides information\nregarding configured protections configured within the executable, as well as installation information.\n\nPalo Alto Networks customers are protected from this threat in the following ways:\n\nAn [AutoFocus tag can be used to track this malware family](https://autofocus.paloaltonetworks.com/)\n\nAll LuminosityLink samples are appropriately marked as malicious in WildFire\nAll identified domains are flagged as malicious\nNetwork traffic is appropriately identified and blocked as threat ID #14460 (LumonosityLinkRAT.Gen Command And Control Traffic)\n\n## Appendix\n\n[An extraction and parsing script for LuminosityLink samples can be found here.](https://github.com/pan-unit42/public_tools/tree/master/luminositylink/parse_config_file.py)\n\n[A script to be used to parse plain configuration strings can be found here.](https://github.com/pan-unit42/public_tools/tree/master/luminositylink/parse_config_string.py)\n\n[A CSV file containing all of the configuration data extracted from Palo Alto Networks sample set can be found here.](https://github.com/pan-unit42/iocs/tree/master/luminositylink/luminositylink_configs.csv)\n\n\n-----\n\n**p**\n**Palo Alto**\n**Networks!**\n\nSign up to receive the latest news, cyber threat intelligence and research from us\n\n[By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement.](https://www.paloaltonetworks.com/legal-notices/terms-of-use)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2016/2016-07-08 - Investigating the LuminosityLink Remote Access Trojan Configuration.pdf"
    ],
    "report_names": [
        "2016-07-08 - Investigating the LuminosityLink Remote Access Trojan Configuration.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536191,
    "ts_updated_at": 1743041154,
    "ts_creation_date": 1653703979,
    "ts_modification_date": 1653703979,
    "files": {
        "pdf": "https://archive.orkl.eu/683462fe97ad7140efb04310581c24d6af65cf62.pdf",
        "text": "https://archive.orkl.eu/683462fe97ad7140efb04310581c24d6af65cf62.txt",
        "img": "https://archive.orkl.eu/683462fe97ad7140efb04310581c24d6af65cf62.jpg"
    }
}