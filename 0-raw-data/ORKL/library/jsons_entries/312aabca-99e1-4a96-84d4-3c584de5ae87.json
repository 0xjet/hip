{
    "id": "312aabca-99e1-4a96-84d4-3c584de5ae87",
    "created_at": "2023-01-12T15:07:55.276414Z",
    "updated_at": "2025-03-27T02:06:15.011735Z",
    "deleted_at": null,
    "sha1_hash": "99d4302c3d4edbf014d240e3f039e4d18056233b",
    "title": "2021-11-29 - Pysa Ransomware Under the Lens- A Deep-Dive Analysis",
    "authors": "",
    "file_creation_date": "2022-05-27T23:06:12Z",
    "file_modification_date": "2022-05-27T23:06:12Z",
    "file_size": 1082816,
    "plain_text": "# Pysa Ransomware Under the Lens: A Deep-Dive Analysis\n\n**[blog.cyble.com/2021/11/29/pysa-ransomware-under-the-lens-a-deep-dive-analysis/](https://blog.cyble.com/2021/11/29/pysa-ransomware-under-the-lens-a-deep-dive-analysis/)**\n\nNovember 29, 2021\n\nInitially observed in 2019, Pysa ransomware has actively targeted organizations in many countries. Once\nexecuted on the victim machine, Pysa encrypts the victim files and drops ransom notes to instruct users on\nhow to recover the files in exchange for the ransom amount. It is human-operated ransomware and does\nnot have self-propagation capability. Once the Threat Actor (TA) is done with the data exfiltration from the\nvictim machine or organization, they execute Pysa for the encryption. The Pysa ransomware group is also\nknown for double extortion.\n\nPresently there are 190+ victims of the Pysa ransomware across the world, and the image below shows the\nHeat Map of countries impacted by the Pysa ransomware.\n\n\n-----\n\nFigure 1 Pysa Ransomware Heat Map\nThe top 5 Countries affected by Pysa are the US, UK, Canada, Spain, and Brazil. Pysa has impacted\nindustries like Education, Utilities, Transportation, Construction, Healthcare, and Business Services, etc.\nThe Pysa ransomware group operates from the dark web site\n_pysa2bitc5ldeyfak4seeruqymqs4sj5wt5qkcq7aoyg4h2acqieywad[.]onion, as shown below._\n\nFigure 2 TOR Website of Pysa Ransomware group\nThe image below shows the high-level execution diagram of the Pysa ransomware. Initially, the\nransomware creates a mutex with the name of Pysa, and later it enumerates drives in the victim’s system.\nAdditionally, it goes through files and directories to search for targeted files having specific extensions that\nare hardcoded in the malware. Once found, the ransomware appends the ‘.pysa’ extension to the victim\nfiles and encrypts the content as a priority, followed by the encryption of the rest of the files. Later it carries\nout the registry modification and finally creates a file called update.bat for self-deletion.\n\n\n-----\n\nFigure 3 High-level Execution Flow of Pysa Ransomware\nIn this report, Cyble Research Labs has covered the deep-dive analysis of the Pysa ransomware to\nunderstand the behaviour and infection mechanism.\n\n## Technical Analysis\n\nThe Static properties of Pysa ransomware tell us that the ransomware is an x86 Windows Portable\nExecutable (PE) written in the C/C++ language and compiled on 2021-10-11 10:21:04, as shown below.\n\nFigure 4 Static Information of Pysa\nUpon execution of the ransomware, it creates a process tree, as shown below.\n\n\n-----\n\nFigure 5 Process Tree\nAfter successful execution, the malware infects the victim’s files and appends the extension, ‘.pysa’, as\nshown below.\n\nFigure 6 Ransomware appends .pysa extension\nThe image below showcases the content of the ransom note in which the TA instructs victims to pay the\nransom amount. In case the victim fails to pay the demanded ransom, the TA threatens to upload the data\non their leake website or sell it to cybercriminals in the darknet.\n\nFigure 7 Ransom Note Created by P\n\n## Code Analysis\n\nAs shown in the below code, the ransomware first creates a mutex with the name “pysa”. The mutex has\nbeen designed to ensure that only one instance of the ransomware is running in the victim system at a time.\n\n\n-----\n\nFigure 8 Code for creating Mutex\n\nLater, the ransomware enumerates the victim’s drives using the Application Program Interface (API)\n_GetLogicalDriveStringsW and uses the GetDriveTypeW API to ensure that the drive is a fixed drive (0x03),_\nsuch as a hard disk.\n\nFigure 9 Enumerates\n\nDrives and Checks if the Drive is a Fixed drive\nOnce the list of drives is found, the ransomware creates a Thread using the CreateThread API and passes\nthe Drive letter as a parameter for the infection, as shown below.\n\n\n-----\n\nFigure 10\n\nCreates Thread for Infection\nEach directory that is found by the ransomware is compared with the list below, as the ransomware does\nnot infect files present in the directory list shown below.\n\nFigure 11 Whitelisted Directories\n\nOnce the malware has found the files present in the victim machine, the ransomware compares the files\nextension with the list below.\n\n.doc .myd .bkf .pbf .zip\n\n.xls .ndf .bkup .qic .rar\n\n.docx .sdf .bup .sqb .cad\n\n.xlsx .trc .fbk .tis .dsd\n\n.pdf .wrk .mig .vbk .dwg\n\n.db .001 .spf .vbm .pla\n\n.db3 .acr .vhdx .vrb .pln\n\n.frm .bac .vfd .win\n\n.ib .bak .avhdx .pst\n\n.mdf .backupdb .vmcx .mdb\n\n.mwb .bck .vmrs .7z\n\nTable 1 Targeted File Extension\nOnce the victim’s file extension matches with the above list, the ransomware Call MoveFileW API to\nappend the .pysa extension as shown in the below figure.\n\nFigure 12 Appends .pysa Extension\nAs shown in the below code, the ransomware reads the content from the files.\n\n\n-----\n\nFigure 13\n\nReads Plain Text Content\nOnce the plain text content has been read, it encrypts it using Advanced Encryption Standard (AES) 256\nand then writes the encrypted content into the file.\n\nFigure 14 Write Encrypted Content into the File\nOnce the above process is done, the ransomware creates ransom notes and encrypts the remaining files in\nthe victim machine.\n\nFurthermore, the Pysa ransomware creates two registry keys under\n_HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System, with the name legalnoticetext_\nhaving value as Ransom note _content and legalnoticecaption having values as PYSA, as shown in the_\nbelow code.\n\nFigure 15 Create registry entry legalnoticetext and legalnoticecaption\nRansomware created entry legalnoticetext and inserted content ransom note.\n\n\n-----\n\nFigure 16 Creates registry legalnoticetext\nAnother entry is created with the name of legalnoticetext and having content PYSA.\n\nFigure 17 Creates registry legalnoticecaption\nFinally, the ransomware releases the mutex and a update.bat file under the Temp folder of the currently\nlogged-in user containing the content below.\n\n:Repeat\n\ndel “C:\\\\Users\\\\MalWorkstation\\\\Desktop\\\\Evil2.exe”\n\nif exist “C:\\\\Users\\\\MalWorkstation\\\\Desktop\\\\Evil2.exe” goto Repeat\n\nrmdir “C:\\\\Users\\\\MalWorkstation\\\\Desktop”\n\ndel “C:\\\\Users\\\\MALWOR~1\\\\AppData\\\\Local\\\\Temp\\\\update.bat””\n\nTable 2 Content of update.bat\nUsing the above code, the malware performs the self-Delete operation to delete its traces.\n\n## Conclusion\n\nThe Pysa ransomware has multiple victims around the world, and the initial execution is manual after the\nTA exfiltrates the data from the victim’s machine. The Pysa ransomware is one of the many ransomware\npresented on the surface web that can encrypt user files using a strong encryption algorithm and leave\nransom notes for instructing users on how to recover the files.\n\nCyble Research Labs is continuously monitoring Pysa’s activities, and we keep informing our clients with\nrecent updates about this campaign.\n\n## Our Recommendations\n\n\n-----\n\nWe have listed some essential cybersecurity best practices that create the first line of control against\nattackers. We recommend that our readers follow the suggestions given below:\n\nUse strong passwords and enforce multi-factor authentication wherever possible.\nTurn on the automatic software update feature on your computer, mobile, and other connected\ndevices wherever possible and pragmatic.\nUse a reputed anti-virus and Internet security software package on your connected devices, including\nPC, laptop, and mobile.\nRefrain from opening untrusted links and email attachments without verifying their authenticity.\nConduct regular backup practices and keep those backups offline or in a separate network.\n\n## MITRE ATT&CK® Techniques\n\n**Tactic** **Technique ID** **Technique Name**\n\n**Initial access** [T1566](https://attack.mitre.org/techniques/T1566/) Phishing\n\n**Execution** [T1204](https://attack.mitre.org/techniques/T1204/) User Execution\n\n**Discovery** [T1082](https://attack.mitre.org/techniques/T1082/) System Information Discovery\n\n**Defense Evasion** [T1112](https://attack.mitre.org/techniques/T1112/) Modify Registry\n\n\n**Impact** [T1490](https://attack.mitre.org/techniques/T1490/)\n\n[T1489](https://attack.mitre.org/techniques/T1489/)\n\n[T1486](https://attack.mitre.org/techniques/T1486/)\n\n\nInhibit System Recovery\n\nService Stop\n\nData Encrypted for Impact\n\n\n## Indicators of Compromise (IoCs):\n\n**Indicators** **Indicator**\n**type**\n\n\n**Description**\n\n\n**7c774062bc55e2d0e869d5d69820aa6e3b759454dbc926475b4db6f7f2b6cb14** SHA-256 Pysa\nRansomware\n\n\n**pysa2bitc5ldeyfak4seeruqymqs4sj5wt5qkcq7aoyg4h2acqieywad[.]onion** TORURL\n\n\nTAs Website\n\n\n**kardalkareefhaddad@onionmail.org** Email TAs Email\n\n## Generic signatures and Rules:\n\n### Yara Rules:\n\n\n-----\n\n```\n      _py\n{ \nmeta: \n     author= \"Cyble Research\" \n     date= \"2021-11-25\" \n     description= \"Coverage for Pysa Ransomware\" \n     hash= \"7c774062bc55e2d0e869d5d69820aa6e3b759454dbc926475b4db6f7f2b6cb14\" \n     strings: \n          $header= \"MZ\" \n          $sig1 = \"Readme.README\" wide ascii \n          $sig2 = \"n.pysa\" wide ascii \n          $sig3 = \"pysa2bitc5ldeyfak4seeruqymqs4sj5wt5qkcq7aoyg4h2acqieywad.onion\" wide ascii\n          $sig4 = \"kardalkareefhaddad@onionmail.org\" wide ascii \n          $sig5 = \"Every byte on any types of your devices was encrypted.\" wide ascii \n          $sig6 = \"To get all your data back contact us\" wide ascii \n     condition: \n          $header at 0 and (4 of ($sig*)) \n}\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-11-29 - Pysa Ransomware Under the Lens- A Deep-Dive Analysis.pdf"
    ],
    "report_names": [
        "2021-11-29 - Pysa Ransomware Under the Lens- A Deep-Dive Analysis.pdf"
    ],
    "threat_actors": [
        {
            "id": "a97cf06d-c2e2-4771-99a2-c9dee0d6a0ac",
            "created_at": "2022-10-25T16:07:24.349252Z",
            "updated_at": "2025-03-27T02:02:10.184406Z",
            "deleted_at": null,
            "main_name": "Turla",
            "aliases": [
                "ATK 13",
                "Belugasturgeon",
                "Blue Python",
                "CTG-8875",
                "Group 88",
                "ITG12",
                "Iron Hunter",
                "Krypton",
                "Makersmark",
                "Operation Epic Turla",
                "Operation Moonlight Maze",
                "Operation Penguin Turla",
                "Operation Satellite Turla",
                "Operation Skipper Turla",
                "Operation Turla Mosquito",
                "Operation WITCHCOVEN",
                "Pacifier APT",
                "Pensive Ursa",
                "Popeye",
                "SIG15",
                "SIG2",
                "SIG23",
                "Secret Blizzard",
                "TAG-0530",
                "Turla",
                "UNC4210",
                "Venomous Bear",
                "Waterbug"
            ],
            "source_name": "ETDA:Turla",
            "tools": [
                "ASPXSpy",
                "ASPXTool",
                "ATI-Agent",
                "AdobeARM",
                "Agent.BTZ",
                "Agent.DNE",
                "BigBoss",
                "COMpfun",
                "Chinch",
                "Cloud Duke",
                "CloudDuke",
                "CloudLook",
                "Cobra Carbon System",
                "ComRAT",
                "DoublePulsar",
                "EmPyre",
                "EmpireProject",
                "Epic Turla",
                "EternalBlue",
                "EternalRomance",
                "GoldenSky",
                "Group Policy Results Tool",
                "HTML5 Encoding",
                "HyperStack",
                "IcedCoffee",
                "IronNetInjector",
                "KSL0T",
                "Kapushka",
                "Kazuar",
                "KopiLuwak",
                "Kotel",
                "LOLBAS",
                "LOLBins",
                "LightNeuron",
                "Living off the Land",
                "Maintools.js",
                "Metasploit",
                "Meterpreter",
                "MiamiBeach",
                "Mimikatz",
                "MiniDionis",
                "Minit",
                "NBTscan",
                "NETTRANS",
                "NETVulture",
                "Neptun",
                "NetFlash",
                "NewPass",
                "Outlook Backdoor",
                "Penquin Turla",
                "Pfinet",
                "PowerShell Empire",
                "PowerShellRunner",
                "PowerShellRunner-based RPC backdoor",
                "PowerStallion",
                "PsExec",
                "PyFlash",
                "QUIETCANARY",
                "Reductor RAT",
                "RocketMan",
                "SMBTouch",
                "SScan",
                "Satellite Turla",
                "SilentMoon",
                "Sun rootkit",
                "TTNG",
                "TadjMakhal",
                "Tavdig",
                "TinyTurla",
                "TinyTurla Next Generation",
                "TinyTurla-NG",
                "Topinambour",
                "Tunnus",
                "Turla",
                "Turla SilentMoon",
                "TurlaChopper",
                "Uroburos",
                "Urouros",
                "WCE",
                "WITCHCOVEN",
                "WhiteAtlas",
                "WhiteBear",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "Wipbot",
                "WorldCupSec",
                "XTRANS",
                "certutil",
                "certutil.exe",
                "gpresult",
                "nbtscan",
                "nbtstat",
                "pwdump"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536075,
    "ts_updated_at": 1743041175,
    "ts_creation_date": 1653692772,
    "ts_modification_date": 1653692772,
    "files": {
        "pdf": "https://archive.orkl.eu/99d4302c3d4edbf014d240e3f039e4d18056233b.pdf",
        "text": "https://archive.orkl.eu/99d4302c3d4edbf014d240e3f039e4d18056233b.txt",
        "img": "https://archive.orkl.eu/99d4302c3d4edbf014d240e3f039e4d18056233b.jpg"
    }
}