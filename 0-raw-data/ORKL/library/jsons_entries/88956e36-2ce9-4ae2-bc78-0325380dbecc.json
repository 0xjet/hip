{
    "id": "88956e36-2ce9-4ae2-bc78-0325380dbecc",
    "created_at": "2022-10-25T16:48:20.252118Z",
    "updated_at": "2025-03-27T02:16:53.024584Z",
    "deleted_at": null,
    "sha1_hash": "fe05831d3dc661e418f969045f0087ba642fb27b",
    "title": "The Duqu 2.0 Technical Details",
    "authors": "Kaspersky",
    "file_creation_date": "2015-06-11T13:43:51Z",
    "file_modification_date": "2015-06-11T13:43:58Z",
    "file_size": 11269748,
    "plain_text": "# THE DUQU 2.0\n\n## Technical Details\n\n###### Version: 2.1 (11 June 2015)\n\n\n-----\n\nTechnical Details\n\n### CONTENTS\n\nEXECUTIVE SUMMARY\b 3\n\nINITIAL ATTACK\b 4\n\nLATERAL MOVEMENT\b 4\n\nANALYSIS OF A DUQU 2.0 MSI PACKAGE\b 7\n\nFile properties\b 7\n\nFirst Layer: ActionDLL (msi.dll)\b 10\n\nSecond Layer: ActionData0\b 10\n\nThird Layer: klif.dll\b 11\n\nAttacking AVP.EXE\b 12\n\nCTwoPENC.dll zero-day and KMART.dll\b 14\n\nPAYLOAD CONTAINERS AND MIGRATION\b 15\n\nPayload type “L”\b 15\n\nPayload run type “G”\b 16\n\nPayload run type “I”\b 16\n\nPayload run type “K”\b 17\n\nPayload run type “Q”\b 17\n\nPLATFORM PLUGGINABLE MODULES\b 17\n\nPERSISTENCE MECHANISM\b 33\n\nCOMMAND AND CONTROL MECHANISMS\b 33\n\nThe “portserv.sys” driver analysis\b 35\n\nSIMILARITIES BETWEEN DUQU AND DUQU 2.0\b 37\n\nVICTIMS OF DUQU 2.0\b 42\n\nATTRIBUTION\b 43\n\nCONCLUSIONS\b 44\n\nREFERENCES\b 45\n\n\n-----\n\nTechnical Details\n\n### EXECUTIVE SUMMARY\n\nEarlier this year, during a security sweep, Kaspersky Lab detected a cyber intrusion\naffecting several of its internal systems.\n\nFollowing this finding, we launched a large-scale investigation, which led to the\ndiscovery of a new malware platform from one of the most skilled, mysterious and\npowerful groups in the APT world – Duqu. The Duqu threat actor went dark in 2012 and\nwas believed to have stopped working on this project - until now. Our technical analysis\nindicates the new round of attacks include an updated version of the infamous [1]2011\nDuqu malware, sometimes referred to as the step-brother of [2]Stuxnet. We named this\nnew malware and its associated platform “Duqu 2.0”.\n\nVictims of Duqu 2.0 have been found in several places, including western countries, the\nMiddle East and Asia. The actor appears to compromise both final and utilitarian targets,\nwhich allow them to improve their cyber capabilities.\n\nMost notably, some of the new 2014-2015 infections are linked to the P5+1 events and\nvenues related to the negotiations with Iran about a nuclear deal. The threat actor behind\nDuqu appears to have launched attacks at the venues for some of these high level talks.\nIn addition to the P5+1 events, the Duqu 2.0 group has launched a similar attack in\nrelation to the [3]70th anniversary event of the liberation of Auschwitz-Birkenau.\n\nIn the case of Kaspersky Lab, the attack took advantage of a zero-day (CVE-2015-2360)\nin the WindowsKernel, patched by Microsoft on June 9 2015 and possibly up to two\nother, currently patched vulnerabilities, which were zeroday at that time.\n\n1 [https://en.wikipedia.org/wiki/Duqu](https://en.wikipedia.org/wiki/Duqu)\n\n2 [http://www.kaspersky.com/about/news/virus/2011/Duqu_The_Step_Brother_of_Stuxnet](http://www.kaspersky.com/about/news/virus/2011/Duqu_The_Step_Brother_of_Stuxnet)\n\n\n-----\n\nTechnical Details\n\n### INITIAL ATTACK\n\nThe initial attack against Kaspersky Lab began with the targeting of an employee in\none of our smaller APAC offices. The original infection vector for Duqu 2.0 is currently\nunknown, although we suspect spear-phishing e-mails played an important role. This is\nbecause for one of the patients zero we identified had their mailbox and web browser\nhistory wiped to hide traces of the attack. Since the respective machines were fully\npatched, we believe a zero-day exploit was used.\n\nIn 2011, we were able to identify Duqu attacks that used Word Documents containing an\nexploit for a zero-day vulnerability (CVE-2011-3402) that relied on a malicious embedded\nTTF (True Type Font File). This exploit allowed the attackers to jump directly into Kernel\nmode from a Word Document, a very powerful, extremely rare, technique. A similar\ntechnique and zero-day exploit ( [4]CVE-2014-4148) appeared again in June 2014, as part\nof an attack against a prominent international organization. The C&C server used in this\n2014 attack as well as other factors have certain similarities with Duqu, however, the\nmalware is different from both Duqu and Duqu 2.0. It is possible that this is a parallel\nproject from the Duqu group and the same zero-day (CVE-2014-4148) might have been\nused to install Duqu 2.0.\n\nOnce the attackers successfully infected one machine, they moved on to the next stage.\n\n### LATERAL MOVEMENT\n\nIn general, once the attackers gain access into a network, two phases follow:\n\n- Reconnaissance and identification of network topology\n\n- Lateral movement\n\nIn the case of Duqu 2.0, the lateral movement technique appears to have taken\nadvantage of another zero-day, (CVE-2014-6324) which was patched in November 2014\nwith [5]MS14-068 . This exploit allows an unprivileged domain user to elevate credentials\nto a domain administrator account. Although we couldn’t retrieve a copy of this exploit,\nthe logged events match the Microsoft detection guidance for this attack. Malicious\nmodules were also observed performing a “pass the hash” attack inside the local\nnetwork, effectively giving the attackers many different ways to do lateral movement.\n\nOnce the attackers gained domain administrator privileges, they can use these\npermissions to infect other computers in the domain.\n\nTo infect other computers in the domain, the attackers use few different strategies. In\nmost of the attacks we monitored, they prepare Microsoft Windows Installer Packages\n(MSI) and then deploy them remotely to other machines. To launch them, the attackers\ncreate a service on the target machine with the following command line:\n\nmsiexec.exe /i “C:\\\\[…]\\tmp8585e3d6.tmp” /q PROP=9c3c7076-d79f-4c\n\n4 [https://www.fireeye.com/blog/threat-research/2014/10/two-targeted-attacks-two-new-zero-days.html](https://www.fireeye.com/blog/threat-research/2014/10/two-targeted-attacks-two-new-zero-days.html)\n\n\n-----\n\nTechnical Details\n\nThe PROP value above is set to a random 56-bit encryption key that is required to\ndecrypt the main payload from the package. Other known names for this parameter\nobserved in the attacks are “HASHVA” and “CKEY”. The folder where the package is\ndeployed can be different from case to case, depending on what the attackers can\naccess on the remote machine.\n\nIn addition to creating services to infect other computers in the LAN, attackers can also\nuse the Task Scheduler to start “msiexec.exe” remotely. The usage of Task Scheduler\nduring Duqu infections for lateral movement was also observed with the 2011 version\nand was described by [6]Symantec in their technical analysis.\n\n_“msiexec.exe” - Task Scheduler trace in the logs_\n\nThe MSI files used in the attacks contain a malicious stub inside which serves as a loader.\nThe stub loads the other malware resources right from the MSI file and decrypts them,\nbefore passing execution to the decrypted code in memory.\n\n_Malicious stub with query to load the other resources from the MSI file highlighted._\n\nThe encryption algorithms used for these packages differ from case to case. It’s\nimportant to point out that the attackers were careful enough to implement unique\nmethods, encryption algorithms and names (such as file names) for each attack, as a\nmethod to escape detection from security products and limit the ability of an antivirus\ncompany to find other infections once one of them has been identified.\n\nSo far, we’ve seen the following encryption algorithms used by the attackers:\n\n- Camellia\n\n- AES\n\n\n-----\n\nTechnical Details\n\n- XTEA\n\n- RC4\n\n- Different multibyte XOR-based encryption\n\nFor compression algorithms, we’ve seen the following:\n\n- LZJB\n\n- LZF\n\n- FastLZ\n\n- LZO\n\nIn essence, each compiled attack platform uses a unique combination of algorithms that\nmake it very difficult to detect.\n\nThe attackers can deploy two types of packages to their victims:\n\n- “Basic”, in-memory remote backdoor (~500K)\n\n- Fully featured, C&C-capable, in-memory espionage platform (18MB)\n\nThese have similar structures and look like the following:\n\n_Malicious Duqu 2.0 MSI package._\n\nIn the screenshot above, one can see the loader (ActionDll: 17,920 bytes) and the main\npayload (ActionData0: 476,736 bytes). Upon execution, ActionDll is loaded and control is\npassed to its only export, StartAction.\n\nThe “basic” in-memory remote backdoor is pushed to computers inside the domain\nby the Domain Controller on a regular basis – almost like a worm infection. This gives\nthe attackers an entry into most of the machines from the domain and if further access\nis needed, they can upload a more sophisticated MSI file that deploys tens of different\nplugins to harvest information.\n\n\n-----\n\nTechnical Details\n\nA thorough description of the malware loading mechanism from the “basic” remove\nbackdoor MSI can be found below.\n\n### ANALYSIS OF A DUQU 2.0 MSI PACKAGE\n\nFilename: random / varies from case to case\nMD5 (example, can vary): 14712103ddf9f6e77fa5c9a3288bd5ee\nSize: 503,296 bytes\n\n#### File properties\n\nThe MSI file has the following general properties:\n\n- Composite Document File V2 Document\n\n- Little Endian\n\n- OS: Windows, Version 6.1\n\n- Code page: 1252\n\n- Title: {7080A304-67F9-4363-BBEB-4CD7DB43E19D} (randomly generated GUIDs)\n\n- Subject: {7080A304-67F9-4363-BBEB-4CD7DB43E19D}\n\n- Author: {7080A304-67F9-4363-BBEB-4CD7DB43E19D}\n\n- Keywords: {7080A304-67F9-4363-BBEB-4CD7DB43E19D}\n\n- Comments: {7080A304-67F9-4363-BBEB-4CD7DB43E19D}\n\n- Template: Intel;1033\n\n- Last Saved By: {7080A304-67F9-4363-BBEB-4CD7DB43E19D}\n\n- Revision Number: {4ADA4205-2E5B-45B8-AAC2-D11CFD1B7266}\n\n- Number of Pages: 100\n\n- Number of Words: 8\n\n- Name of Creating Application: Windows Installer XML (3.0.5419.0)\n\n- Security: 4\n\nIt should be noted that MSI files used in other attacks can have different other properties.\nFor example, we observed several other fields:\n\n- Vendor: Microsoft or InstallShield\n\n- Version: 1.0.0.0 or 1.1.2.0 or 2.0.0.0\n\n\n-----\n\nTechnical Details\n\nSome of these are visible via the Windows Explorer file properties dialog box:\n\nThere are two binary blocks inside this MSI package:\n\n\n-----\n\nTechnical Details\n\nThe first binary, called ActionDll, is in fact a Windows PE DLL file, while the other one\nis a Camellia-encrypted and LZJB-compressed data payload (the encryption and\ncompression algorithm vary from case to case). In fact, there are several layers of\nexecutable code embedded one into another as compressed or encrypted binary blocks.\nHere’s a look at a Duqu 2.0 MSI package, with all its internal payloads:\n\nWe describe these components in more detail below.\n\n\n-----\n\nTechnical Details\n\n#### First Layer: ActionDLL (msi.dll)\n\nOriginal filename: msi.dll\nMD5: e8eaec1f021a564b82b824af1dbe6c4d\nSize: 17’920 bytes\nLink time: 2004.02.12 02:04:50 (GMT)\nType: 64-bit PE32+ executable DLL for MS Windows\n\nThis DLL has only one export name called StartAction, which is called in the context of\nmsiexec.exe process. When this function is called, it retrieves an MSI property called\nPROP and uses it as a decryption key for the bundled ActionData0 package:\n\nNext, the code iterates over 12 possible\npayloads that have to be decrypted and\nstarted. The payloads are part of the\nMSI and may have the following names:\nActionData0, ActionData1, ActionData2,\netc.\n\nThe package described here contains\nonly one payload named “ActionData0”.\n\n#### Second Layer: ActionData0\n\nThis binary chunk contains the main code, in\ncompressed and encrypted format. It represents a\ncomposition of executable, position-independent code\nblocks mixed with embedded data objects. The code\nseems to be based on a framework and heavily uses\nhelper structures that contain pointers to a set of system\nAPIs and offsets to internal data blocks. Such structures\nare definitely a trademark of the developer. When they\nare initialized, one field (usually the first 4 bytes) contains\na magic value that identifies the state and type of the\nstructure.\n\nAnother trademark of the coder is the way to import\nsystem API by module and export name hashes. The\nhashing algorithm was found all over this and other\nlayers of executable code. It’s easily recognizable by two\nDWORD constants: 0x8A20C27 and 0x67F84FC6.\n\nBasically, the code in ActionData0 passes execution\nto an embedded executable, which we will refer by its\ninternal name: “klif.dll”. The execution is passed to the\nsecond exported function in table of exports of this DLL\nfile. This disregards the export name and relies only on\nthe order of functions in the table of PE export ordinals.\nWhen this export function is called, a next stage helper structure pointer is passed to it,\nso that it can use some of the values set on the upper layer.\n\n\n-----\n\nTechnical Details\n\nHowever, before passing execution to klif.dll, the code attempts alternative routes.\nFirst, it attempts to find the name of the following format “api-ms-win-shell-XXXX.\ndll”, where “X” can be any decimal number. The name is valid if there is no module with\nsuch filename loaded into current process. The code attempts to iteratively find such\nname starting from api-ms-win-shell-0000.dll, api-ms-win-shell-0001.dll, api-ms-winshell-0002.dll and so on. This may be a dependency to the Duqu platform component\nthat is yet to be discovered.\n\nRight after this, if the name was found, the code attempts to map a section kernel object\nby name, which is generated using a PRNG-based algorithm. The name of the section\nhas the following template: “\\BaseNamedObjects\\{XXXXXXXX-XXXX-XXXX-XXXXXXXXXXXX}”, where “X” is any hexadecimal digit that is generated based on current\nsystem boot time. So far, the name of the section is “machine/boot time” dependent,\nwhich makes it unique but allows other processes of modules to locate such section if\nthey use the same name generation algorithm. This section is accessed in different other\nparts of the code and modules. Lets refer to this section as OSBoot-section from now.\nOnce the section name is generated the code tries to open such section and, if it is\nfound, it takes some values from it and attempts to open a specific device and issue a\nnumber of IOCTL codes to the driver. The name of the driver device as well as IOCTL\ncodes are located inside a section of the kernel mode driver KMART.dll that is described\nbelow.\n\nThe code developer has a preference for using sections to any other ways to access\ndata. Another use of sections appears to be in mapping the part of code/data where\nklif.dll is embedded and then finding that section using a hardcoded magic QWORD\nnumber: 0xA1B5F8FC0C2E1064. Once the section is found in address space of current\nprocess the code attempts to pass execution to it. This alternative execution route is\nnot applicable to current MSI file package but simply exists in the code probably due\nto common code template used for building current MSI package. It may also be an\nindicator of another Duqu platform component that wasn’t used in the attacks that we\nobserved.\n\n#### Third Layer: klif.dll\n\nOriginal filename: klif.dll\nMD5: 3fde1bbf3330e0bd0952077a390cef72\nSize: 196’096 bytes\nLink time: 2014.07.06 08:36:50 (GMT)\nType: 64-bit PE32+ executable DLL for MS Windows\n\nApparently, this file attempts to mimic some of legitimate names of Kaspersky Lab\nproduct components: “klif.sys”. Although there is neither similarity in code nor in file\ninformation, the module uses Kaspersky Lab acronym in it’s export names: KLInit and\nKLDone.\n\n\n-----\n\nTechnical Details\n\nWhen this DLL is loaded into a new process, it simply initializes internal structures, such\nas those providing pointers to the required system API.\nThe real payload of this module is located in the KLDone export function, which is\nsecond in the list of the export table. This export function is called from the previous\ncode layer.\n\nFirst, it makes sure that global application structure is initialized with essential functions\nfrom ntdll.dll, kernel32.dll and user32.dll. System API functions are imported using hashes\nof export names. The hashing algorithm is identical to the one described one layer above\nand uses the same magic constants: 0x8A20C27 and 0x67F84FC6.\n\nNext the code iterates through the list of running processes and hashes lowercase name\nof each process. The hash is compared to a hardcoded value of 0x3E3021CB, which is a\nhash for the “avp.exe” string.\n\n#### Attacking AVP.EXE\n\nIf the “avp.exe” process is running, the module attempts to open the OSBoot-section as\ndescribed before and tries to attack the avp.exe process. The attack starts from\nidentifying the exact path to the installed Kaspersky Lab product by iterating through an\narray of hardcoded registry keys and values for the following products:\n\n\nKES12\n\nKES11\n\nKES10\n\nAVP16.0.0\n\nAVP16\n\nAVP15.0.0\n\n\nAVP15\n\nAVP14.0.0\n\nAVP14\n\nAVP13\n\nAVP12\n\nAVP11\n\n\nAVP10\n\nKES9\n\nKES8\n\nAVP80\n\nAVP90\n\nAVP9\n\n\nAVP8\nAVP7\nAVP6\n\n\nThe registry values queried by the module contain a filesystem path to the root directory\nwhere the corresponding product is installed. For example: “C:\\Program Files\\Kaspersky\nLab\\Kaspersky Internet Security 15.0.0\\”\n\nOnce the registry key and value is found, the module confirms that avp.exe file is located\nin that directory. It does some basic file availability checks as well: makes sure that\nenvironment variables are resolved and the file can be opened for reading and it begins\nwith 0x5A4D (magic “MZ” value of Windows executables).\n\nAfter that, the module creates a new section and maps avp.exe as a file view to this\nsection. To allow code execution, the attributes of this memory region are also changed\naccordingly. This allows the module to change bytes from the mapped avp.exe in\nmemory. The module applies two patches to the mapped avp.exe in a quite unusual way\nusing SSE2 CPU extensions. In fact, it patches just the old DOS PE header (less than 120\nbytes). The patches are simple callback mechanisms that call arbitrary function passed as\nan argument.\n\nRight after this, the module attempts to start a new thread that begins with one of the\npatched locations. So far, it looks like the new thread begins with a call originating from\navp exe module that does some other calls i e jumping back to klif dll Apparently this\n\n\n-----\n\nTechnical Details\n\nattack was introduced to trick the avp.exe process into believing that further calls will\nbe safe and trusted as the root of the call stack is coming from the legitimate avp.exe\nmodule. This is what we see further down in the code: the new thread instantly jumps\nfrom avp.exe back to klif.dll and tries to communicate with the Kaspersky Lab product\nminifilter driver, known as klif.sys.\n\nIn fact, just before communicating with klif.sys, it opens OSBoot-section and gets an\nIOCTL code as well as the driver device name to send this IOCTL code to. The section\nand corresponding driver (KMART.dll) provide certain support to the current module. The\ncode hashes current process name and verifies if it falls down into one of three hashes:\n0x3E3021CB (avp.exe), 0xDE6D4DA0 (msiexec.exe), 0xB915B2D8 (rundll32.exe).\n\nIf current process name hash is recognized, the module communicates with klif.sys\nby opening \\KlifComm minifilter communication port and sending series of driver\ncommunication messages. According to analysis of the messages, this technique\nmakes process or thread operations “invisible” to the klif interceptor. Such registered\nentity is considered to be trusted and its activity is removed from AV-scanning, process\nmonitoring, firewall and other defense engines that are subscribed to intercepted events.\nIn addition, the module requests support of the self-defense feature of Kaspersky Lab\nproduct, which is normally used to protect the software from aggressive malware which\nkills the security software processes using a number of techniques available from the\nOS. This of course guarantees that even a user with administrative privileges cannot stop\nsuch process.\n\nConsidering that this seemed to be an attack against Kaspersky Lab products, we did\nsome additional tests of the products and found that current products verify the caller\nprocess by checking its custom digital signature. So far, without additional driver support,\nthis technique should fail. Verification of the digital signature of the process that opened\n\\KlifComm minifilter communication port was implemented in all Kaspersky Lab\nproducts since 2010. So far, this could affect only\nolder products such as KIS2010, which was\nreleased by Kaspersky Lab in 2009 ►\n\nIt doesn’t look realistic now that the attackers\nstarted implementing tricks against Kaspersky\nLab products in 2009 or earlier. So we looked for\nanother rational explanation and seem to have\nfound it.\n\nSuch an attack doesn’t normally work against\nour products because they verify that the caller\nprocess is legitimate by checking its custom digital\nsignature. To bypass this, the Duqu 2.0 component\nnamed “KMART.dll” patches “klif.sys” in memory to\nbypass this check. The attack works because the\nattacker’s “KMART.dll” is already running in kernel\nmode due to a vulnerability in the Windows kernel.\n\nAfter sending the codes, the module proceeds to the next stage, which is process\nmigration, described further below.\n\n\n-----\n\nTechnical Details\n\n#### CTwoPENC.dll zero-day and KMART.dll\n\nThe third layer klif.dll performs a multitude of functions in order to ensure the survival of\nthe malware in memory and bypass antivirus detections.\n\nOne important step is to get kernel level access. On 64-bit systems, one cannot simply\nload and run kernel mode code without a signed driver. While other attackers such\nas Equation or Turla chose to piggyback on third-party signed drivers, the Duqu 2.0\nplatform relies on a much more cunning trick.\n\nOne of the payloads bundled together with “klif.dll” is called “CTwoPENC.dll”. This is\naWindows kernel mode exploit (CVE-2015-2360) that allows them to run code with the\nhighest privileges in the system We recovered several versions of “CTwoPENC.dll”, both\nfor 32-bit and 64-bit versions of Windows, with the following compilation timestamps:\n\n- 2014.08.25 01:20:04 (GMT)\n\n- 2014.08.25 01:19:03 (GMT)\n\n- 2014.07.06 09:17:03 (GMT)\n\nUnlike other Duqu 2.0 modules, these timestamps appear to be legitimate. The reason\nfor this remains unknown – perhaps the Duqu platform developers got this module from\nsomebody else and forgot to patch its compilation timestamp.\n\n“CTwoPENC.DLL” exploits a zero-day vulnerability in “win32k.sys” to gain kernel privileges\nwhile being run as an unprivileged user. It creates several windows with classes named\n“CPer”, “Zero”, “CTwo”, “Vero” in several threads and manipulates the callback pointers.\n\n_Part of the exploit code that registers window classes and creates new windows._\n\nThe main purpose of the exploit is to load a driver named “KMART.dll”. If the exploit\nsucceeds, it decompresses “KMART.dll” from the module’s body and passes control\n\n\n-----\n\nTechnical Details\n\nto it while running in kernel mode. Both 32-bit and 64-bit versions of the “KMART.\nDLL” exist. This driver implements a kernel-mode attack against the Kaspersky Lab\nproducts filter “klif.sys”. It patches the import table addresses of system API functions\nPsGetCurrentProcessId, PsLookupProcessByProcessId and KlGetStringRef export of\nKaspersky Lab’s anti-virus driver klflt.sys. The intercepted functions are preceded by\nmalicious code that impersonates the other malicious modules as coming from the\nprocess/file “avp.exe” (using the actual location of the anti-virus component), thus\nevading monitoring by the anti-virus software.\n\nDuring testing, the zero-day exploit worked on all contemporary Windows versions (XP,\nVista, 7, 8, 8.1 both 32-bit and 64-bit). This vulnerability has been patched by Microsoft\non June 9, 2015.”\n\n### PAYLOAD CONTAINERS AND MIGRATION\n\nThe module supports a number for different payloads provided in the form of containers\nfollowing klif.dll in memory (located in PE overlay).\n\nA payload container contains a short header describing target CPU architecture, payload\ntype and target process name or hash. When the module uses some embedded code or\nfile there is normally at least two variants of code bundled inside: 32 and 64-bit.\nEach payload run type is identified by a single character. Current module supports\nthe following 5 payload run types: g, i, k, l, q. Seems like the developer used ordered\nalphabet characters, which means that there could be other payload run types which\nwere removed from the code at some time. Currently the container located in the\noverlay of subject executable contains a “l” character as a payload run type, so lets\ndescribe it first.\n\n#### Payload type “L”\n\nFirst, the code looks for privileges from other processes. The process handle can be\nhardcoded or obtained by looking for currently running processes, hashing their names\nand comparing them to one of known hashes. The module includes the following\nhardcoded process hashes:\n\n0x31283314 (services.exe), 0x1026D1BA (lsass.exe), 0x3BD2498C (svchost.exe).\n\nIf any of the recognized processes are found, the module opens process token and\nverifies that the following privileges are available:\n\n- SeDebugPrivilege\n\n- SeTcbPrivilege\n\n- SeAssignPrimaryTokenPrivilege\n\n- SeIncreaseQuotaPrivilege\n\n- SeImpersonatePrivilege\n\n- SeRestorePrivilege\n\nIf they are available the module duplicates process token and saves it into an internal\n\n\n-----\n\nTechnical Details\n\nThe module looks for one of the available security suites installed in current system and\nsome generic processes if nothing was found. It attempts to find executable files of the\nfollowing software:\n\n- More than 20 different Kaspersky Lab products\n\n- McAfee VSCore, SystemCore, HIP\n\n- Symantec Internet Security\n\n- Bitdefender\n\n- ESET\n\n- H+BEDV\n\n- TrendMicro Network Security Component\n\n- Rising AV\n\n- Avast\n\n- AVG 2012/2013/2014/2015\n\n- F-Secure\n\n- Qihoo 360 Security\n\n- Generic Windows Processes:\n\noo %ProgramFiles(x86)%\\Windows Defender\\MsMpEng.exe\n\noo %SystemRoot%\\syswow64\\svchost.exe\n\noo %SystemRoot%\\system32\\lsass.exe\n\noo %SystemRoot%\\system32\\svchost.exe\n\nWhen such an executable is found and eventually it should (at least svchost or lsass.\nexe should be present), it runs a new process from discovered location and replaces\nits executable code with own embedded into current executable in encrypted and\ncompressed form.\n\nIf the code manages to find a security token from one of the processes with required\nsecurity privileges, it will try to use this token when creating a new process using\nCreateProcessAsUser API. Otherwise it simply spawns new process instance.\n\nThe new process is started in suspended and debugged state. Just before starting the\nnew process it disables DEP for the child processes to simplify code injection and data\nmanipulation. So far, from the outside, it may look like a security software was started,\nwhile from the inside its code is completely different from legitimate module.\n\n#### Payload run type “G”\n\nThis payload is almost identical to payload L described above, but the loader is simpler\n\n- it skips hijacking of privileged token. Code injection target is selected automatically\ndepending on the availability of known processes.\n\n#### Payload run type “I”\n\nThis payload is similar to payload G, but makes the loader parse payload header a bit\ndifferently: instead of process name string it takes only 4 bytes, which are supposedly\nused as a process hash. This seems to be a way to hide target process name and\nuse only hash, however this hasn’t been implemented completely in the module we\n\n\n-----\n\nTechnical Details\n\n#### Payload run type “K”\n\nThis payload is designed to run within the context of the current process. The code\nsimply copies the code to be executed into separate memory and runs it in a dedicated\nthread. It blocks until thread finishes its execution.\n\n#### Payload run type “Q”\n\nThis payload is identical to payload K described above but it doesn’t block execution\nwhen a new thread is started. So far, the new code runs asynchronously.\n\nAfter the payload container is opened and code migrated to another process, which can\nbe elevated and protected from security software, the real malicious code is activated.\nIn most cases, it is simple named pipe based backdoor that listens for incoming\ncommunications from the orchestrator. In rare cases, on selected machines, it can be\nheavy orchestrator module that communicates with command and control server, works\nas a bidirectional proxy and comes with a large bundle of secondary plugins.\n\n### PLATFORM PLUGGINABLE MODULES\n\nIn addition to the basic remote backdoor, the attackers deploy more sophisticated\npackages to domain controllers and to the victims of interest inside the LAN. These MSI\npackages can contain tens of different modules designed for various cyberespionage\nfunctions.\n\nThe fully featured packages are much larger than the basic remote backdoor – 18MB\nvs 500KB. They follow the same structure, with ActionDll and the loader mechanism,\nexcept they contain a lot more plugins to load and run.\n\nDuring our analysis, we identified more than 100 variants of such plugins.\nA description of these plugins follows. To separate them, we used a virtual identifier\nbased on the first two bytes of their MD5 sum.\n\n03B7 – The main module of Duqu 2.0, orchestrator.\n\nImplements multiple protocol handlers for C&C communication, can start an\nintermediate C&C proxy server with a self-signed HTTPS certificate. Starts the plugin\nframework, loads and manages all additional plugins.\n\nIt works via HTTP, HTTPS, SMB network pipes or direct TCP connection using a custom,\nencrypted protocol. Interaction via HTTP is concealed in JPEG or GIF files, similar to the\n2011 version of Duqu. Request names, URLs and User-Agent strings may vary between\nattacks.\n\nAdditional known variants: 3026, 4F11.\n\n0682 – Collects basic system information:\n\n- List of running processes\n\n\n-----\n\nTechnical Details\n\nCollected information is then transmitted to a named pipe provided by the caller.\n\nAdditional known variants: C0B7\n\n073C – Implements a complete Windows socket-based transport, both client and\nserver side. Provides a class factory for the class that encapsulates various networking\nfunctions.\n\n0872 – MSI CustomAction library that is activated when the malicious installer package\nis started by the Windows Installer. Loads the encrypted binary blob that contains actual\nmalicious payload, decrypts and then executes it in memory.\n\nThe names in version information vary: svcmsi_32.dll, msi3_32.dll, MSI.dll, msi4_32.dll.\n\nEncryption algorithms also vary: Camellia 256, AES, XXTEA.\n\nThe decryption key is extracted from an MSI parameter, possible names: PROP,\nHASHVA, CKEY.\n\nThe encrypted blob is searched by prefixes (can vary): ActionData, CryptHashs, CAData.\n\nBoth 32-bit and 64-bit versions are known. Additional known variants: 8D7C, 16EF, E6E5,\n434C, 44BD, F708.\n\n09A0 – 64-bit, Exfiltrates file contents, particularly searching for files matching these\nrules:\n\n- *.inuse, *.hml\n\n- filename contains “data.hmi” or “val.dat”\n\n- files from the /Int/HMI/ or /LG/HM/ folders.\n\n_File and directory names of interest for the 09A0 plugin._\n\nAdditional known variants: 8858\n\n0AB8 – Provides 25 functions for manipulating files and directories:\n\n- List files in directories\n\n- Upload and download arbitrary files\n\n\n-----\n\nTechnical Details\n\nIn several cases, the modules are looking specifically for directories named “\\int”, “\\lg”, “\\\nof\\md”, “\\tl”, “\\ak” and files with extensions “.part”, “.manual”, “.inuse”.\n\n_File and directory names of interest for the 0AB8 plugin._\n\nAdditional known variants: A69E.\n\n0B97 – Network transport. Implements API for connecting sockets and pipes provided\nby the caller. Additional variant: 56A2.\n\n152B – Network and domain discovery.\n\n- Enumerates all servers in the domain\n\n- Tries to connect to remote registries and enumerate all users in “HKEY_USERS”.\nUsernames are then converted to SIDs\n\n- Enumerates all visible network shares\n\nAdditional known variants: A987\n\n1C71 – In-memory storage. Receives and stores string data in file mappings.\n\n2125 – Network infection module. Tries to acquire administrative credentials from the\nrunning processes and then connect to a target machine using Windows shares. The\nmachine is infected with a malicious DLL backdoor, the target directory varies and may\nbe in UPDROOT$, ADMIN$ or C$. Uses custom SMB packets to identify the target OS\nversion. The target malicious DLL is then started using a new service created with a name\n“svcmsi_32@”. The module communicates with the target backdoor via Windows pipes.\nAdditional variant: DB65. Instead of the malicious DLL, it uploads a new MSI package and\nthen relies on MSIEXEC.EXE to start the MSI via a newly created service named\n“msisvc_32@”, the target MSI name is generated randomly using a template “tmp%x.\ntmp”.\n\n_Example of a Windows event log (System) entry created_\n_at the moment of infection._\n\nAdministrative credentials are acquired by stealing a token from any running process that\nas sta ted b a logged on se ha ing domain administ ato ’s ights Fo that it fi st\n\n\n-----\n\nTechnical Details\n\nqueries for the first 100 administrative usernames in the current domain directly from the\ndomain controller.\n\n_Remote locations used by the network infection module._\n\n24B7 – Remote desktop administration. Acquires the screenshots of the desktop but\nalso can send input to the desktop, move the mouse cursor. Both 32-bit and 64-bit\nvariants exist. Additional known variants: 65BE, 7795, BDC8, DEE2\n\n26D6 – Detects running network sniffers (wireshark, tcpview, netstat, dumpcap,\nperfmon); implements a TCP server and communicates via network pipes. Internal\nname: “P.dll”.\n\n2829 – Collects system information\n\n- Monitors USB device attachment\n\n- Collects USB drive history\n\n- Enumerates network shares, windows captions, system routing tables\n\n- Reads/writes encrypted files\n\n2913 - WMI data collection\n\n- Enumerate profiles with SIDs\n\n- For each profile, extracts information from lnk files in the profile directory\n\n- Enumerate processes via WMI (CIMV2), including terminated processes\n\n- Extracts user information from available remote registries\n\nAdditional known variant: C776\n\n29D4 - Service msisvc_32@; DLL backdoor that is used for network infection by\nmodule 2125. Accepts commands via named pipe “Global\\{B54E3268-DE1E-4c1e-A6672596751403AD}” Both 32 bit and 64 bit variants exists\n\n\n-----\n\nTechnical Details\n\nAdditional known variants: 6F92, A505, D242\n\n2B46 – Extensive collection of system and user information\n\n- Domain controller’s name\n\n- List of users in the domain\n\n- Administrators of the domain\n\n- Enumerates domain trusts\n\n- TCP tables\n\n- UDP tables\n\n- SNMP discovery (OS, parse all replies)\n\n- USB drive history, mounted devices\n\n- Installed programs\n\n- Time zone\n\n- OS install date\n\n- ODBC.ini, SQL Server instance info, Oracle ALL_HOMES, SyBase, DB2, MS SQL,\nMySQL last connections\n\n- DHCP/routing\n\n- Network profiles\n\n- Zero Config parameters\n\n- Connected printers\n\n- MRU list for WinRAR, WinZip, Office, IE typed URLs, mapped network drives, Visual\nStudio MRU\n\n- Terminal Service Client default username hint\n\n- User Assist history\n\n- PuTTY host keys and sessions\n\n- Logged on users\n\n- Network adapter configuration\n\n- VNC clients passwords\n\n- Scan the network and identify OS using SMB packet\n\n_Some of the registry locations harvested by the module._\n\n\n-----\n\nTechnical Details\n\nAdditional known variants: A7F8\n\n2BF7 - Utility DLL. Provides basic API for creating new MSI packages, loading and\ninjecting arbitrary PE modules. Also responsible for loading the first level of the VFS\ninside the malicious MSI files. Both 32-bit and 64-bit versions exist.\n\nKnown names: “ntdll.dll”, “klif.dll”, “apiset.dll”.\n\nAdditional known variants: 6DA1, 32DB, 8304, 9931, 9E60, A2D4, ABA9, B3BB, DC5F,\nDD32, F7BB\n\n3395 – MS SQL discovery module. Module can send ARP packets to network and\ndiscover MS SQL Server ports. Additional functions are responsible for connecting and\nreading of remote registry contents.\n\n35E9 – File system discovery.\n\n- Enumerate network shares\n\n- Enumerate local disks\n\n- Traverse files system hierarchy and enumerate files; identify reparse points\n\n3F45 – Pipe backdoor. Opens a new globally visible named Windows pipe, receives and\nexecutes encrypted commands. The “magic” string that identifies the encrypted protocol\nis “tttttttt”.\n\n- Enumerates running processes\n\n- Loads and executes arbitrary PE files\n\nBoth 32-bit and 64-bit versions exist.\n\nKnown pipe names:\n\n- \\\\.\\pipe\\{AAFFC4F0-E04B-4C7C-B40A-B45DE971E81E} \\\\.\\pipe\\{AB6172ED-81054996-9D2A-597B5F827501}\n\n- \\\\.\\pipe\\{0710880F-3A55-4A2D-AA67-1123384FD859} \\\\.\\pipe\\{6C51A4DB-E3DE4FEB-86A4-32F7F8E73B99}\n\n- \\\\.\\pipe\\{7F9BCFC0-B36B-45EC-B377-D88597BE5D78}, \\\\.\\pipe\\{57D2DE92-CE174A57-BFD7-CD3C6E965C6A}\n\nAdditional known variants: 6364, 3F8B, 5926, A90A, DDF0, A717, A36F, 8816, E85E, E927\n\n\n-----\n\nTechnical Details\n\n4160 - Password stealer\n\n- Extracts Google Chrome and Firefox login data\n\n- LSA credentials\n\n_Data used to locate Chrome saved logins._\n\nAdditional known variants: B656\n\n41E2 – Password stealer. 64-bit module. Extracts:\n\n- IE IntelliForms history\n\n- POP3/HTTP/IMAP passwords\n\n- TightVNC, RealVNC, WinVNC3/4 passwords\n\n- Outlook settings\n\n- SAM, LSASS cache\n\n- Windows Live, .Net Passport passwords\n\n_References to information collected by the module._\n\nAdditional known variants: 992E, AF68, D49F\n\n482F – Collects system information.\n\n- Enumerates disk drives\n\n- Gets list of running processes\n\n- Extensive process information including uptime\n\n\n-----\n\nTechnical Details\n\n- Memory information\n\n- SID information\n\nAdditional known variants: F3F4\n\n559B – Active Directory survey.\n\n- Connects to the Active Directory Global Catalog (“GC:”) using ADSI\n\n- Enumerates all objects in AD\n\n- Presents every entry in a human-readable format\n\n_Active Directory enumeration routine._\n\n580C - Collects system and network information.\n\n- Retrieves the domain controller name\n\n- Enumerates all users and groups in the domain\n\n- Collects Task Scheduler logs\n\n- Collects disk information, removable device history\n\n- Retrieves firewall policies\n\n- Enumerates all named system objects\n\n- Enumerates all system services\n\n\n-----\n\nTechnical Details\n\n5B78 - Collects system information and utilities. One of the two exported functions has\na name “GetReport”.\n\n- Enumerate running processes, extract tokens and SIDs, collect timing information\n\n- Logon users using explicit credentials\n\n- Impersonate users of running processes\n\n- Build new 32-bit and 64-bit shellcode stubs using a hardcoded template\n\nBoth 32-bit and 64-bit versions exist.\n\nAdditional known variants: E8C7, EE6E.\n\n5C66 – Encrypted file I/O, utilities\n\n- File I/O operations: open/seek/read/write\n\n- Manages compressed and encrypted temporary files\n\n\n-----\n\nTechnical Details\n\n622B - Generate XML report about system using unique schema\n\n- Computer name\n\n- Windows directory\n\n- Enumerates all logical drives\n\n- Lists all files\n\n- OS serial number\n\n- Domain name\n\n- Network adapter configuration: IP addresses, MAC, MTU, adapter list\n\n_XML tags used to generate the system report._\n\n6302 - Utilities. Has internal name “d3dx9_27.dll”. Executes timer-based events.\n\nAdditional known variants: FA84\n\n669D – Utilities. Given a list of file names and directories, checks if they exist.\n\n\n-----\n\nTechnical Details\n\n6914 - Sniffer-based network attacks. Uses a legitimate WinPcap driver “npf.sys”. Detects\n\nNBNS (NetBIOS protocol) requests of interest and sends its own responses:\n\n- Responds to WPAD requests (“FHFAEBE” in NBNS packets)\n\n- Sends responses to HTTP GET requests\n\nThe network filter is based on the BPF library. The payloads for the HTTP and WPAD\nresponses are provided externally.\n\n_Fake HTTP response and related status messages._\n\n6FAC - File API\n\n- Get file size, attributes\n\n- Securely delete a file\n\n- Open/close/read/write file contents\n\nAdditional known variants: A7EE\n\n7BDA – Collects system information\n\n- Current state of AV and firewall protection using wscapi.dll API\n\n- Detect if “sqlservr.exe” is running\n\n- Computer name\n\n- Workgroup info\n\n- Domain controller name\n\n- Network adapter configuration\n\n- Time and time zone information\n\n- CPU frequency\n\n\n-----\n\nTechnical Details\n\n7C23 – Extracts metadata from documents and collects system information\n\n- Computer name\n\n- System volume serial\n\n- Complete file API as in 6FAC\n\nSearches for documents and archives and implements routines to extract all valuable\ninformation from them:\n\n- E-mail messages: eml, msg\n\n- Image files: jpg, jpe, jpeg, tif, tiff, bmp, png\n\n- Multimedia files: wmv, avi, mpeg, mpg, m4a, mp4, mkv, wav, aac, ac3, dv, flac,\nflv, h264, mov, 3gp, 3g2, mj2, mp3, mpegts, ogg, asf. These are re-encoded with\nlibffmpeg.\n\n- Contents from PDF documents\n\n- Microsoft Office: doc, docx, xlsx, pptx. Dedicated routines are called accordingly:\n“OfficeRipDoc”, “OfficeRipDocx”, “OfficeRipXlsx”, “OfficeRipPptx”. PPT slides are\nextracted and converted to a HTML digest of the presentation.\n\n- Archives: gz, gzip, gzX3, zip, rar\n\nCreates temporary files with extension “.fg4”.\n\nAdditional known variants: EB18, C091i\n\n\n-----\n\nTechnical Details\n\n8172 - Sniffer-based network attacks. Performs NBNS (NetBIOS protocol) name\nresolution spoofing for:\n\n- WPAD requests\n\n- Names starting with “SHR”\n\n- Names starting with “3142” (log only)\n\n_Status messages related to the attack._\n\nAdditional feature: the module can build new shellcode blobs from hardcoded templates.\n\n81B7 – Driver management\n\n- Write driver to disk\n\n- Start/stop driver\n\n- Safely remove the driver’s file from disk\n\nAdditional known variants: C1B9\n\n\n-----\n\nTechnical Details\n\n8446 - Oracle DB and ADOdb client.\n\n- Uses “oci.dll” API to access Oracle databases\n\n- Extracts all available information from the database\n\n- Also connects to ADOdb providers\n\n_SQL queries and related data._\n\n8912 – Encrypted file manipulation and collects system information\n\n- Shared file mapping communication\n\n- Write encrypted data to files\n\n- Enumerate windows\n\n- Enumerate network shares and local disks\n\n- Retrieve USB device history\n\n- Collect network routing table\n\nKnown mutex and mapping names:\n\n- Global\\{DD0FF599-FA1B-4DED-AC70-C0451F4B98F0} Global\\{B12F87CA-1EBA4365-B90C-E2A1D8911CA9},\n\n- Global\\{B03A79AD-BA3A-4BF1-9A59-A9A1C57A3034} Global\\{6D2104E6-73104A65-9EDD-F06E91747790},\n\n- Global\\{DD0FF599-FA1B-4DED-AC70-C0451F4B98F0} Global\\{B12F87CA-1EBA\n\n-----\n\nTechnical Details\n\nAdditional known variants: D19F, D2EE\n\n9224 – Run console applications. Creates processes using desktop “Default”, attaches to\nits console and redirects its I/O to named pipes.\n\n92DB - Modified cmd.exe shell.\n\n_Several CMD commands processed by the shell._\n\n9F0D (64-bit), D1A3(32-bit) – legitimate signed driver NPF.SYS (WinPcap) distributed\ninside the VFS along with the plugins. It is used for sniffer-based network attacks.\n\nA4B0 – Network survey\n\n- Uses DHCP Server Management API (DHCPSAPI.DLL) to enumerate all DHCP server’s\nclients\n\n- Queries all known DHCP sub-networks\n\n- Searches for machines that have ports UDP 1434 or 137 open\n\n- Enumerates all network servers\n\n- Enumerates network shares\n\n- Tries to connect to remote registries to enumerate all users in HKEY_USERS, converts\nthem to SIDs\n\nB6C1 - WNet API. Provides wrappers for the WnetAddConnection2 and WNetOpenEnum\nfunctions.\n\nAdditional known variants: BC4A\n\n\n-----\n\nTechnical Details\n\nC25B – Sniffer based network attacks. Implements a fake SMB server to trick other\nmachines to authenticate with NTLM.\n\n- Implements basic SMB v1 commands\n\n_SMB commands handled by the module_\n\n- Pretends to have IPC$ and A: shares\n\n- Accepts user authentication requests\n\n- Also handles HTTP “GET /” requests\n\n_NTLM challenge and SMB server data_\n\n\n-----\n\nTechnical Details\n\nED92 – File system survey\n\n- Enumerates all local drives and connected network shares\n\n- Lists files\n\nEF97 – Filesystem utilities\n\n- Enumerate files\n\n- Create and remove directories\n\n- Copy/move/delete files and directories\n\n- Extract version information from files\n\n- Calculate file hashes\n\nAdditional known variants: F71E\n\n### PERSISTENCE MECHANISM\n\nThe Duqu 2.0 malware platform was designed in a way that survives almost exclusively\nin memory of the infected systems, without need for persistence. To achieve this, the\nattackers infect servers with high uptime and then re-infect any machines in the domain\nthat get disinfected by reboots. Surviving exclusively in memory while running kernel\nlevel code through exploits is a testimony to the technical prowess of the group. In\nessence, the attackers were confident enough they can survive within an entire network\nof compromised computers without relying on any persistence mechanism at all.\n\nThe reason why there is no persistence with Duqu 2.0 is probably because the attackers\nwanted to stay under the radar as much as possible. Most modern anti-APT technologies\ncan pinpoint anomalies on the disk, such as rare drivers, unsigned programs or\nmaliciously-acting programs. Additionally, a system where the malware survives reboot\ncan be imaged and then analyzed thoroughly at a later time. With Duqu 2.0, forensic\nanalysis of infected systems is extremely difficult – one needs to grab memory snapshots\nof infected machines and then identify the infection in memory.\n\nHowever, this mechanism has one weakness; in case of a massive power failure, all\ncomputers will reboot and the malware will be eradicated. To get around this problem,\nthe attackers have another solution – they deploy drivers to a small number of\ncomputers, with direct Internet connectivity. These drivers can tunnel traffic from the\noutside into the network, allowing the attackers to access remote desktop sessions or\nto connect to servers inside the domain by using previously acquired credentials. Using\nthese credentials, they can re-deploy the entire platform following a massive power loss.\n\n### COMMAND AND CONTROL MECHANISMS\n\nDuqu 2.0 uses a sophisticated and highly flexible command-and-control mechanism that\nbuilds on top of the 2011 variant, with new features that appear to have been inspired\nby other top class malware such as Regin. This includes the usage of network pipes and\nmailslots, raw filtering of network traffic and masking C&C traffic inside image files.\n\n\n-----\n\nTechnical Details\n\nInside a Windows LAN, newly infected clients may not have a C&C hardcoded in their\ninstallation MSI packages. Without a C&C, they are in “dormant” state and can be\nactivated by the attackers over SMB network pipes with a special TCP/IP packet that\ncontains the magic string “tttttttttttttttt”. If a C&C is included in the configuration part of\nthe MSI file, this can be either a local IP address, which serves as a bouncing point or an\nexternal IP address. As a general strategy for infection, the attackers identify servers with\nhigh uptime and set them as intermediary C&C points. Hence, an infected machine can\njump between several internal servers in the LAN before reaching out to the Internet.\n\nTo connect the the C&C servers, both 2011 and 2014/2015 versions of Duqu can hide the\ntraffic as encrypted data appended to a harmless image file. The 2011 version used a\nJPEG file for this; the new version can use either a GIF file or a JPEG file. Here’s how\nthese image files look like:\n\nAnother modification to the 2014/2015 variants is the addition of multiple user agent\nstrings for the HTTP communication. The 2011 used the following user agent string:\n\n- Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US; rv:1.9.2.9) Gecko/20100824\nFirefox/3.6.9 (.NET CLR 3.5.30729)\n\nThe new variants will randomly select an user agent string from a table of 53 different\npossible ones.\n\n\n-----\n\nTechnical Details\n\nAnother unusual C&C mechanism relies on driver files that are used to tunnel the C&C\ncommunications and attacker’s RDP/SMB activity into the network. The attackers deploy\nsuch translation drivers on servers with direct Internet connectivity. Through a knocking\nmechanism, the attackers can activate the translation mechanism for their IPs and tunnel\ntheir traffic directly into the LAN. Outside the LAN, the traffic can be masked over port\n443; inside the LAN, it can be either direct SMB/RDP or it can be further translated over\nfake TCP/IP packets to IP 8.8.8.8.\n\nDuring our investigation, we observed several such drivers. A description can be found\nbelow.\n\n#### The “portserv.sys” driver analysis\n\nMD5: 2751e4b50a08eb11a84d03f8eb580a4e\n\nSize: 14336\nCompiled: Sat Feb 11 21:55:30 2006 (fake timestamp)\nInternal name: termport.sys\nType: Win32 device driver (a 64 bit version is known as well)\n\n\n-----\n\nTechnical Details\n\nThis is a malicious NDIS filter driver designed to perform manipulation of TCP/IP packets\nto allow the attacker to access internal servers in the victim’s infrastructure.\n\nUpon startup, the filter driver hooks into the NDIS stack and starts processing TCP/IP\npackets.\n\nTo leverage the driver, the attacker first sends a special TCP/IP packet with the string\n“romanian.antihacker” to any of the hardcoded IPs belonging to infected server. In\ngeneral, such servers are computers with direct Internet connectivity, such as a\nwebserver or a proxy. The driver sees the packet, recognizes the magic string “romanian.\nantihacker” and saves the attacker’s IP for later use.\n\n_Magic string used for knocking inside the driver._\n\nWhen a packet comes from the attacker’s IP (saved before), the following logic applies:\n\n- Packet to server 1’s IP on port 443, is redirected on port 445 (Samba/Windows file\nsystem)\n\n- Packet from server 1’s IP from port 445, is redirected to attacker’s IP port 443\n\n- Packet to server 2’s IP on port 443 is redirected on port 3389 (Remote Desktop)\n\n- Packet from server 2’s IP from port 3389 is redirected to attacker’s IP port 443\n\nThis effectively allows the attackers to tunnel SMB (remote file system access) and\nRemote Desktop into these two servers while making it look like SSL traffic (port 443).\n\nThese drivers allow the Duqu attackers to easily access servers inside the LAN from\nremote, including tunneling RDP sessions over Port 443 (normally SSL). It also gives them\na persistence mechanism that allows them to return even if all the infected machines\nwith the malware in memory are rebooted. The attackers can simply use existing\ncredentials to log back into any of the servers that the driver is serving and can reinitialize the backdoors from there.\n\n\n-----\n\nTechnical Details\n\n### SIMILARITIES BETWEEN DUQU AND DUQU 2.0\n\nThe 2014/2015 Duqu 2.0 is a greatly enhanced version of the 2011 Duqu malware\ndiscovered by [7]CrySyS Lab. It includes many new ideas from modern malware, such as\nRegin, but also lateral movement strategies and harvesting capabilities which surpasses\ncommonly seen malware from other APT attacks.\n\nSide by side:\n\n2011 Duqu 2014/2015 Duqu 2.0\n\n\nNumber of victims: <50 (estimated) <100 (estimated)\n\nPersistence mechanism: Yes No\n\nLoader: SYS driver MSI file\n\nZero-days used: Yes Yes\n\nMain storage: PNF (custom) files MSI files\n\nC&C mechanism: HTTP/HTTPS, network pipes HTTP/HTTPS, network pipes\n\nKnown plugins: 6 >100\n\n\nThere are many similarities in the code that leads us to conclusion that Duqu 2.0 was\nbuilt on top of the original source code of Duqu. Those interested can read below for a\ntechnical description of these similarities.\n\n\n-----\n\nTechnical Details\n\nOne of the “trademark” features unique to the original Duqu was the set of functions that\nprovide logging facilities. Unlike many other APTs, Duqu logs almost every important step\nof its activity but does it in a special way: there are no readable strings written to the log.\nInstead, a series of unique numbers identify every state, error, or message in the log.\nComparing the functions that generate every log entry in Duqu and Duqu 2.0, we can\nconclude that they are almost identical:\n\nThe first generation of Duqu was also written in a very rare and unique manner. It was\ncompiled with Visual Studio and while parts of it were definitely written in C++, the\nmajority of its classes were not natively generated by the C++ compiler. After analyzing\nall the possible variants, we conclude that these classes were written in OO-C, the\nobjective variant of the C language, and then somehow converted into a compilable C/\nC++ source. All these classes had a very specific feature: the virtual function table of\nevery instance was filled “by hand” in its constructor. Interestingly, this is no longer the\ncase for Duqu 2.0. The authors upgraded their compiler from Visual Studio 2008 (used in\n2011) to Visual Studio 2013 and now use classes that look much more like native C++\nones:\n\n_On the left: the “hand-made” or “compiler-assisted” classed of OO-C in Duqu._\n_On the right: the same class in Duqu 2.0 has a native Vtable similar to native C++ one,_\n_however the offset of the pointer is not zero._\n\n\n-----\n\nTechnical Details\n\nThe more concrete evidence of similarity can be found if we look for functions that\nactually use the logging facilities. The authors kept using the same unique numbers for\nidentification of internal states, errors and function results. Networking functions are\ngood candidates for comparison:\n\n_Implementation of the same networking function in Duqu and Duqu 2.0. Note the same unique numbers_\n_(in red rectangles) PUSHed as parameters to the logging function._\n\n\n-----\n\nTechnical Details\n\n_Another networking routine: after calling recv() to receive data from network, Duqu logs the results and_\n_possible network errors (obtained via WSAGetLastError()). Unique numbers in red rectangles are used to_\n_identify the current state of the networking routine._\n\nThe code of the orchestrator evolved in many aspects since 2011. One of the notable\ndifferences is a huge list of HTTP User-Agent strings that are now used instead of a single\nhard-coded one:\n\n\n-----\n\nTechnical Details\n\nThe authors also modified the “magic” two-byte value that identifies encrypted network\ntraffic: “SH” was replaced with a more neutral and harder to trace “WW”:\n\n_Code that verifies the “magic” value in network traffic._\n_The chars are swapped due to little-endianness of data in x86/64 architectures._\n\nBoth Duqu and Duqu 2.0 use special structures to identify the interfaces of their plugins.\nThe orchestrator also has one for the “core” plugin that is compiled in its code. The\nnewer version has a slightly bigger table, hence more functions, and a different notation\nfor describing the plugin features. Special strings (i.e. “A888A8>@”) describe each\nfunction’s signature. The older Duqu had contained similar strings in binary (unreadable)\nform.\n\n_Data structure that describes the “core” plugin of Duqu and two different version of Duqu 2.0._\n_Note the same constants and similar functions._\n\n\n-----\n\nTechnical Details\n\nThe Duqu C&C code makes use of small image files to hide its communications over\nunencrypted channels, i.e. HTTP. The original Duqu used a JPEG file, and known versions\nof Duqu 2.0 use a similar JPEG file as well as a new, larger GIF file. Also, the layout of the\ndata section did not change much: the image data is preceded by short AES encryption\nkeys (string “sh123456” in Duqu, two binary DWORDs in Duqu 2.0) followed by the LZO\nversion string “2.03”.\n\n_Image data used for hiding C&C communication in them: JPEG in Duqu, similar JPEG in Duqu 2.0 and_\n_GIF in a different version of Duqu 2.0. Note the preceding LZO version string “2.03” and encryption keys._\n\nThe large number of similarities between the Duqu 2011 code and the new Duqu 2.0\nsamples indicates that the new code represents a new iteration of the malware platform.\nThe new version could not have been built without access to the 2011 Duqu source\ncode. Hence, we conclude that the authors are the same or working together.\n\n### VICTIMS OF DUQU 2.0\n\nVictims of Duqu 2.0 were found in several places, including western countries, the\nMiddle East and Asia. The actor appears to compromise both final and utilitarian targets,\nwhich allow them to improve their cyber capabilities.\n\nMost of the final targets appear to be similar to their 2011 goals – which is to spy on\nIran’s nuclear program. Some of the new 2014-2015 infections are linked to the P5+1\nevents and venues related to the negotiations with Iran about a nuclear deal. The threat\nactor behind Duqu appears to have launched attacks at the venues for some of these\nhigh level talks. In addition to the P5+1 events, the Duqu 2.0 group has launched a similar\nattack in relation to the [8]70th anniversary event of the liberation of Auschwitz-Birkenau.\n\n\n-----\n\nTechnical Details\n\nThe other type of targets for the new attacks are what we call “utilitarian” targets. These\nare companies that the attackers compromise to improve their cyber capabilities.\nFor instance, in 2011, the attackers compromised a certificate authority in Hungary;\nobviously, this would allow them to generate digital certificates, which can be further\nused to sign malware samples. The same pattern can be seen with the Duqu 2.0\ninfections. Some of the companies infected with Duqu 2.0 operate in the sector of\nIndustrial Control Systems as well as industrial computers.\n\n### ATTRIBUTION\n\nAs usual, attribution of cyberattacks over the Internet is a difficult task. In the case of\nDuqu, the attackers use multiple proxies and jumping points to mask their connections.\nThis makes tracking an extremely complex problem.\n\nAdditionally, the attackers have tried to include several false flags throughout the code,\ndesigned to send researchers in the wrong direction. For instance, one of the drivers\ncontains the string “ugly.gorilla”, which obviously refers to [9]Wang Dong, a Chinese\nhacker believed to be associated with the APT1/Comment Crew. The usage of the\nCamellia cypher in the MSI VFSes, previously seen in APT1-associated Poison Ivy samples\nis another false flag planted by the attackers to make researchers believe they are dealing\nwith APT1 related malware. The “romanian.antihacker” string used in the “portserv.sys”\ndriver is probably designed to mimic “w00tw00t.at.blackhats.romanian.anti-sec” requests\nthat are often seen in server logs or simply point to an alleged Romanian origin of the\nattack. The usage of rare compression algorithms can also deceptive. For instance, the\nLZJB algorithm used in some of the samples is rarely seen in malware samples; it has\nbeen used by MiniDuke which we reported in early 2013.\n\nNevertheless, such false flags are relatively easy to spot, especially when the attacker is\nextremely careful not to make any other mistakes.\n\nDuring our 2011 analysis, we noticed that the logs collected from some of the proxies\nindicated the attackers appear to work less on Fridays and didn’t appear to work at all on\nSaturdays, with their regular work week starting on Sunday. They also compiled binaries\non January 1st, indicating it was probably a normal work day for them. The compilation\ntimestamps in the binaries seemed to suggest a time zone of GMT+2 or GMT+3. Finally,\ntheir attacks would normally occur on Wednesdays, which is why we originally called\nthem the “Wednesday Gang”. While the 2014 attack against Kaspersky Lab also took\nplace on a Wednesday, the gang made huge OPSEC improvements compared to their\nolder 2011 operations, including faking all the timestamps in PE files, removing the debug\npaths and internal module names for all plugins.\n\nThe 2014 Duqu 2.0 binaries contain several strings in almost perfect English but one of\nthem has a minor mistake indicating the involvement of non-native speakers. The usage\nof “Excceeded” instead of “Exceeded” in the file-harvesting module of Duqu 2.0 is the\nonly language mistake we observed.\n\n\n-----\n\nTechnical Details\n\n_Misspelling of the word “Exceeded” in Duqu 2.0._\n\nMost interesting, one of the victims appear to have been infected both by the Equation\nGroup and by the Duqu group at the same time; this suggests the two entities are\ndifferent and competing with each other to obtain information from this victim.\n\n### CONCLUSIONS\n\nDuring the 2011 Duqu attacks, we concluded that its main purpose could have been to\nspy on Iran’s nuclear program. Some of the victims appear to have been “utilitary”, such\nas one certificate authority in Hungary, which was compromised by Duqu and ultimately\nthat led to its discovery. The group behind Duqu hacks these “utilitary” victims in order to\ngain certain technical abilities such as signing their malware with trusted certificates or to\nserve as platforms for further attacks.\n\nThe 2014/2015 Duqu 2.0 appears to be a massive improvement over the older “Tilded”\nplatform, although the main orchestrator and C&C core remains largely unchanged. Back\nin 2011 we pointed out to the usage of [10]Object Oriented C as an unusual programming\ntechnique. The 2014 version maintains the same core, although some new objects in\nC++ have been added. The compiler used in the 2014 is newer and it results in different\ncode optimizations. Nevertheless, the core remains the same in functionality and it is\nour belief it could not have been created by anyone without access to the original Duqu\nsource code. Since these have never been made public and considering the main interest\nappears to have remained the same, we conclude the attackers behind Duqu and Duqu\n2.0 are the same.\n\nThe targeting of Kaspersky Lab represents a huge step for the attackers and an indicator\nof how quick the cyber-arms race is escalating. Back in 2011 and 2013 respectively, [11]RSA\nand [12]Bit9, were hacked by Chinese-language APT groups, however, such incidents\nwere considered rare. In general, an attacker risks a lot targeting a security company\n– because they can get caught and exposed. The exact reason why Kaspersky Lab\nwas targeted is still not clear – although the attackers did seem to focus on obtaining\ninformation about Kaspersky’s future technologies, Secure OS, anti-APT solutions, KSN\nand APT research.\n\n10 [https://securelist.com/blog/research/32354/the-mystery-of-duqu-framework-solved-7/](https://securelist.com/blog/research/32354/the-mystery-of-duqu-framework-solved-7/)\n\n11 [https://blogs.rsa.com/anatomy-of-an-attack/](https://blogs.rsa.com/anatomy-of-an-attack/)\n\n\n-----\n\nTechnical Details\n\nFrom a threat actor point of view, the decision to target a world-class security company\nmust be quite difficult. On one hand, it almost surely means the attack will be exposed –\nit’s very unlikely that the attack will go unnoticed. So the targeting of security companies\nindicates that either they are very confident they won’t get caught, or perhaps they don’t\ncare much if they are discovered and exposed. By targeting Kaspersky Lab, the Duqu\nattackers have probably taken a huge bet hoping they’d remain undiscovered; and lost.\n\nFor a security company, one of the most difficult things is to admit falling victim to a\nmalware attack. At Kaspersky Lab, we strongly believe in transparency, which is why\nwe are publishing the information herein. For us, the security of our users remains the\nmost important thing – and we will continue to work hard to maintain your trust and\nconfidence.\n\n### REFERENCES\n\n1. [Duqu: A Stuxnet-like malware found in the wild https://www.crysys.hu/publications/](https://www.crysys.hu/publications/files/bencsathPBF11duqu.pdf)\n[files/bencsathPBF11duqu.pdf](https://www.crysys.hu/publications/files/bencsathPBF11duqu.pdf)\n\n[2. Duqu: The Precursor to the next Stuxnet http://www.symantec.com/content/en/us/](http://www.symantec.com/content/en/us/enterprise/media/security_response/whitepapers/w32_duqu_the_precursor_to_the_next_stuxnet.pdf)\n[enterprise/media/security_response/whitepapers/w32_duqu_the_precursor_to_the_](http://www.symantec.com/content/en/us/enterprise/media/security_response/whitepapers/w32_duqu_the_precursor_to_the_next_stuxnet.pdf)\n[next_stuxnet.pdf](http://www.symantec.com/content/en/us/enterprise/media/security_response/whitepapers/w32_duqu_the_precursor_to_the_next_stuxnet.pdf)\n\n[3. The Mystery of Duqu: Part One https://securelist.com/blog/incidents/31177/the-](https://securelist.com/blog/incidents/31177/the-mystery-of-duqu-part-one-5/)\n[mystery-of-duqu-part-one-5/](https://securelist.com/blog/incidents/31177/the-mystery-of-duqu-part-one-5/)\n\n[4. The Mystery of Duqu: Part Two https://securelist.com/blog/incidents/31445/the-](https://securelist.com/blog/incidents/31445/the-mystery-of-duqu-part-two-23/)\n[mystery-of-duqu-part-two-23/](https://securelist.com/blog/incidents/31445/the-mystery-of-duqu-part-two-23/)\n\n[5. The Mystery of Duqu: Part Three https://securelist.com/blog/incidents/31486/the-](https://securelist.com/blog/incidents/31486/the-mystery-of-duqu-part-three-9/)\n[mystery-of-duqu-part-three-9/](https://securelist.com/blog/incidents/31486/the-mystery-of-duqu-part-three-9/)\n\n[6. The Mystery of Duqu: Part Five https://securelist.com/blog/incidents/31208/the-](https://securelist.com/blog/incidents/31208/the-mystery-of-duqu-part-five-6/)\n[mystery-of-duqu-part-five-6/](https://securelist.com/blog/incidents/31208/the-mystery-of-duqu-part-five-6/)\n\n7. [The Mystery of Duqu: Part Six (The Command and Control Servers) https://securelist.](https://securelist.com/blog/incidents/31863/the-mystery-of-duqu-part-six-the-command-and-control-servers-36/)\n[com/blog/incidents/31863/the-mystery-of-duqu-part-six-the-command-and-](https://securelist.com/blog/incidents/31863/the-mystery-of-duqu-part-six-the-command-and-control-servers-36/)\n[control-servers-36/](https://securelist.com/blog/incidents/31863/the-mystery-of-duqu-part-six-the-command-and-control-servers-36/)\n\n[8. The Mystery of Duqu: Part Ten https://securelist.com/blog/incidents/32668/the-](https://securelist.com/blog/incidents/32668/the-mystery-of-duqu-part-ten-18/)\n[mystery-of-duqu-part-ten-18/](https://securelist.com/blog/incidents/32668/the-mystery-of-duqu-part-ten-18/)\n\n[9. The Mystery of Duqu Framework Solved https://securelist.com/blog/research/32354/](https://securelist.com/blog/research/32354/the-mystery-of-duqu-framework-solved-7/)\n[the-mystery-of-duqu-framework-solved-7/](https://securelist.com/blog/research/32354/the-mystery-of-duqu-framework-solved-7/)\n\n[10. The Duqu Saga Continues https://securelist.com/blog/incidents/31442/the-duqu-](https://securelist.com/blog/incidents/31442/the-duqu-saga-continues-enter-mr-b-jason-and-tvs-dexter-22/)\n[saga-continues-enter-mr-b-jason-and-tvs-dexter-22/](https://securelist.com/blog/incidents/31442/the-duqu-saga-continues-enter-mr-b-jason-and-tvs-dexter-22/)\n\n[11. CrySyS Blog: Duqu 2.0 http://blog.crysys.hu/2015/06/duqu-2-0/](http://blog.crysys.hu/2015/06/duqu-2-0/)\n\n\n-----\n\n[Securelist, the ressource](http://securelist.com)\nfor Kaspersky Lab experts’\ntechnical research, analysis\nand thoughts\n\n\nKaspersky Lab B2C Blog Kaspersky Lab security news\nservice\n\n\n[Eugene Kaspersky Blog](http://www.eugene.kaspersky.com) [Kaspersky Lab](http://business.kaspersky.com)\n[B2B Blog](http://business.kaspersky.com)\n\n\nKaspersky Lab, Moscow, Russia\nwww.kaspersky.com\n\nKaspersky Lab HQ\n\n39A/3 Leningradskoe Shosse\nMoscow, 125212\nRussian Federation\n\n[More contact details](http://www.kaspersky.com/about/contactinfo/contacts_global_hq)\n\nTel: +7-495-797-8700\nFax: +7-495-7978709\n\n\nAll about Internet security:\nwww.securelist.com\n\nFollow us\n\nTwitter.com/Kaspersky\n\nFacebook.com/Kaspersky\n\nYoutube.com/Kaspersky\n\n\n[Kaspersky Lab Academy](http://academy.kaspersky.com)\n\nFind a partner near you:\nwww.kaspersky.com/buyoffline\n\n\n© 2015 Kaspersky Lab. All rights reserved. Registered trademarks and service marks are the property of their respective owners.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        },
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        },
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/9bejel60h3doxinwxdfyhig5nsqz05ga",
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2015/2015.06.10.The_Mystery_of_Duqu_2_0/The_Mystery_of_Duqu_2_0_a_sophisticated_cyberespionage_actor_returns.pdf",
        "https://papers.vx-underground.org/papers/ICS SCADA/Duqu/The Duqu 2 - Technical Details v2.1.pdf"
    ],
    "report_names": [
        "The_Mystery_of_Duqu_2_0_a_sophisticated_cyberespionage_actor_returns",
        "The Duqu 2 - Technical Details v2.1.pdf"
    ],
    "threat_actors": [
        {
            "id": "b740943a-da51-4133-855b-df29822531ea",
            "created_at": "2022-10-25T15:50:23.604126Z",
            "updated_at": "2025-03-27T02:00:55.505366Z",
            "deleted_at": null,
            "main_name": "Equation",
            "aliases": [
                "Equation"
            ],
            "source_name": "MITRE:Equation",
            "tools": null,
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "67bf0462-41a3-4da5-b876-187e9ef7c375",
            "created_at": "2022-10-25T16:07:23.44832Z",
            "updated_at": "2025-03-27T02:02:09.806007Z",
            "deleted_at": null,
            "main_name": "Careto",
            "aliases": [
                "Careto",
                "The Mask",
                "Ugly Face"
            ],
            "source_name": "ETDA:Careto",
            "tools": [
                "Careto"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "fea75bf4-c510-4146-bbac-0802351f4eb0",
            "created_at": "2023-01-06T13:46:38.714847Z",
            "updated_at": "2025-03-27T02:00:02.899174Z",
            "deleted_at": null,
            "main_name": "Unit 8200",
            "aliases": [
                "Duqu Group"
            ],
            "source_name": "MISPGALAXY:Unit 8200",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "dabb6779-f72e-40ca-90b7-1810ef08654d",
            "created_at": "2022-10-25T15:50:23.463113Z",
            "updated_at": "2025-03-27T02:00:55.47619Z",
            "deleted_at": null,
            "main_name": "APT1",
            "aliases": [
                "APT1",
                "Comment Crew",
                "Comment Group",
                "Comment Panda"
            ],
            "source_name": "MITRE:APT1",
            "tools": [
                "Seasalt",
                "ipconfig",
                "Cachedump",
                "PsExec",
                "GLOOXMAIL",
                "Lslsass",
                "PoisonIvy",
                "WEBC2",
                "Mimikatz",
                "gsecdump",
                "Pass-The-Hash Toolkit",
                "Tasklist",
                "xCmd",
                "pwdump"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "cf7fc640-acfe-41c4-9f3d-5515d53a3ffb",
            "created_at": "2023-01-06T13:46:38.228042Z",
            "updated_at": "2025-03-27T02:00:02.775905Z",
            "deleted_at": null,
            "main_name": "APT1",
            "aliases": [
                "GIF89a",
                "G0006",
                "PLA Unit 61398",
                "Group 3",
                "TG-8223",
                "Comment Group",
                "ShadyRAT",
                "COMMENT PANDA",
                "Comment Crew",
                "Byzantine Candor",
                "Brown Fox"
            ],
            "source_name": "MISPGALAXY:APT1",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "08623296-52be-4977-8622-50efda44e9cc",
            "created_at": "2023-01-06T13:46:38.549387Z",
            "updated_at": "2025-03-27T02:00:02.859535Z",
            "deleted_at": null,
            "main_name": "Equation Group",
            "aliases": [
                "Tilded Team",
                "EQGRP",
                "G0020"
            ],
            "source_name": "MISPGALAXY:Equation Group",
            "tools": [
                "EquationLaser",
                "EquationDrug",
                "DoubleFantasy",
                "TripleFantasy",
                "GrayFish"
            ],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "2d9fbbd7-e4c3-40e5-b751-27af27c8610b",
            "created_at": "2024-05-01T02:03:08.144214Z",
            "updated_at": "2025-03-27T02:05:17.419705Z",
            "deleted_at": null,
            "main_name": "PLATINUM COLONY",
            "aliases": [
                "Equation Group "
            ],
            "source_name": "Secureworks:PLATINUM COLONY",
            "tools": [
                " EquationDrug",
                " EquationLaser",
                " Fanny",
                " GrayFish",
                " TripleFantasy",
                "DoubleFantasy"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "a97cf06d-c2e2-4771-99a2-c9dee0d6a0ac",
            "created_at": "2022-10-25T16:07:24.349252Z",
            "updated_at": "2025-03-27T02:02:10.184406Z",
            "deleted_at": null,
            "main_name": "Turla",
            "aliases": [
                "ATK 13",
                "Belugasturgeon",
                "Blue Python",
                "CTG-8875",
                "Group 88",
                "ITG12",
                "Iron Hunter",
                "Krypton",
                "Makersmark",
                "Operation Epic Turla",
                "Operation Moonlight Maze",
                "Operation Penguin Turla",
                "Operation Satellite Turla",
                "Operation Skipper Turla",
                "Operation Turla Mosquito",
                "Operation WITCHCOVEN",
                "Pacifier APT",
                "Pensive Ursa",
                "Popeye",
                "SIG15",
                "SIG2",
                "SIG23",
                "Secret Blizzard",
                "TAG-0530",
                "Turla",
                "UNC4210",
                "Venomous Bear",
                "Waterbug"
            ],
            "source_name": "ETDA:Turla",
            "tools": [
                "ASPXSpy",
                "ASPXTool",
                "ATI-Agent",
                "AdobeARM",
                "Agent.BTZ",
                "Agent.DNE",
                "BigBoss",
                "COMpfun",
                "Chinch",
                "Cloud Duke",
                "CloudDuke",
                "CloudLook",
                "Cobra Carbon System",
                "ComRAT",
                "DoublePulsar",
                "EmPyre",
                "EmpireProject",
                "Epic Turla",
                "EternalBlue",
                "EternalRomance",
                "GoldenSky",
                "Group Policy Results Tool",
                "HTML5 Encoding",
                "HyperStack",
                "IcedCoffee",
                "IronNetInjector",
                "KSL0T",
                "Kapushka",
                "Kazuar",
                "KopiLuwak",
                "Kotel",
                "LOLBAS",
                "LOLBins",
                "LightNeuron",
                "Living off the Land",
                "Maintools.js",
                "Metasploit",
                "Meterpreter",
                "MiamiBeach",
                "Mimikatz",
                "MiniDionis",
                "Minit",
                "NBTscan",
                "NETTRANS",
                "NETVulture",
                "Neptun",
                "NetFlash",
                "NewPass",
                "Outlook Backdoor",
                "Penquin Turla",
                "Pfinet",
                "PowerShell Empire",
                "PowerShellRunner",
                "PowerShellRunner-based RPC backdoor",
                "PowerStallion",
                "PsExec",
                "PyFlash",
                "QUIETCANARY",
                "Reductor RAT",
                "RocketMan",
                "SMBTouch",
                "SScan",
                "Satellite Turla",
                "SilentMoon",
                "Sun rootkit",
                "TTNG",
                "TadjMakhal",
                "Tavdig",
                "TinyTurla",
                "TinyTurla Next Generation",
                "TinyTurla-NG",
                "Topinambour",
                "Tunnus",
                "Turla",
                "Turla SilentMoon",
                "TurlaChopper",
                "Uroburos",
                "Urouros",
                "WCE",
                "WITCHCOVEN",
                "WhiteAtlas",
                "WhiteBear",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "Wipbot",
                "WorldCupSec",
                "XTRANS",
                "certutil",
                "certutil.exe",
                "gpresult",
                "nbtscan",
                "nbtstat",
                "pwdump"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "8aaa5515-92dd-448d-bb20-3a253f4f8854",
            "created_at": "2024-06-19T02:03:08.147099Z",
            "updated_at": "2025-03-27T02:05:17.408118Z",
            "deleted_at": null,
            "main_name": "IRON HUNTER",
            "aliases": [
                "Belugasturgeon ",
                "Blue Python ",
                "CTG-8875 ",
                "ITG12 ",
                "KRYPTON ",
                "MAKERSMARK ",
                "Pensive Ursa ",
                "Secret Blizzard ",
                "Turla",
                "UAC-0003 ",
                "UAC-0024 ",
                "UNC4210 ",
                "Venomous Bear ",
                "Waterbug ",
                "ATK13 "
            ],
            "source_name": "Secureworks:IRON HUNTER",
            "tools": [
                " ComRAT",
                " Kazuar",
                " KopiLuwak",
                " LightNeuron",
                " Mosquito",
                " Nautilus",
                " Neuron",
                " Penquin",
                " PoisonFrog",
                " PyFlash",
                " Skipper",
                " Snake",
                " Tavdig",
                " TinyTurla",
                " Tunnus",
                "Carbon-DLL"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "a97fee0d-af4b-4661-ae17-858925438fc4",
            "created_at": "2023-01-06T13:46:38.396415Z",
            "updated_at": "2025-03-27T02:00:02.823045Z",
            "deleted_at": null,
            "main_name": "Turla",
            "aliases": [
                "Uroburos",
                "Hippo Team",
                "Pacifier APT",
                "MAKERSMARK",
                "ATK13",
                "UAC-0003",
                "IRON HUNTER",
                "Waterbug",
                "TAG_0530",
                "KRYPTON",
                "Popeye",
                "SIG23",
                "UAC-0144",
                "G0010",
                "Blue Python",
                "VENOMOUS Bear",
                "Group 88",
                "Pfinet",
                "ITG12",
                "UNC4210",
                "Secret Blizzard",
                "UAC-0024"
            ],
            "source_name": "MISPGALAXY:Turla",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "e0fed6e6-a593-4041-80ef-694261825937",
            "created_at": "2022-10-25T16:07:23.593572Z",
            "updated_at": "2025-03-27T02:02:09.879892Z",
            "deleted_at": null,
            "main_name": "Equation Group",
            "aliases": [
                "APT-C-40",
                "Platinum Colony",
                "Tilded Team"
            ],
            "source_name": "ETDA:Equation Group",
            "tools": [
                "Bvp47",
                "DEMENTIAWHEEL",
                "DOUBLEFANTASY",
                "DanderSpritz",
                "DarkPulsar",
                "DoubleFantasy",
                "DoubleFeature",
                "DoublePulsar",
                "Duqu",
                "EQUATIONDRUG",
                "EQUATIONLASER",
                "EQUESTRE",
                "Flamer",
                "GRAYFISH",
                "GROK",
                "OddJob",
                "Plexor",
                "Prax",
                "Regin",
                "Skywiper",
                "TRIPLEFANTASY",
                "Tilded",
                "UNITEDRAKE",
                "WarriorPride",
                "sKyWIper"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "d11c89bb-1640-45fa-8322-6f4e4053d7f3",
            "created_at": "2022-10-25T15:50:23.509601Z",
            "updated_at": "2025-03-27T02:00:55.487991Z",
            "deleted_at": null,
            "main_name": "Turla",
            "aliases": [
                "Turla",
                "IRON HUNTER",
                "Group 88",
                "Waterbug",
                "WhiteBear",
                "Krypton",
                "Venomous Bear",
                "Secret Blizzard",
                "BELUGASTURGEON"
            ],
            "source_name": "MITRE:Turla",
            "tools": [
                "PsExec",
                "nbtstat",
                "ComRAT",
                "netstat",
                "certutil",
                "KOPILUWAK",
                "IronNetInjector",
                "LunarWeb",
                "Arp",
                "Uroburos",
                "PowerStallion",
                "Kazuar",
                "Systeminfo",
                "LightNeuron",
                "Mimikatz",
                "Tasklist",
                "LunarMail",
                "HyperStack",
                "NBTscan",
                "TinyTurla",
                "Penquin",
                "LunarLoader"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "f87ef0bf-0574-492f-aebc-63e5953938e2",
            "created_at": "2024-11-23T02:00:04.116692Z",
            "updated_at": "2025-03-27T02:00:03.465245Z",
            "deleted_at": null,
            "main_name": "Gorilla",
            "aliases": [],
            "source_name": "MISPGALAXY:Gorilla",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "3aaf0755-5c9b-4612-9f0e-e266ef1bdb4b",
            "created_at": "2022-10-25T16:07:23.480196Z",
            "updated_at": "2025-03-27T02:02:09.826059Z",
            "deleted_at": null,
            "main_name": "Comment Crew",
            "aliases": [
                "APT 1",
                "BrownFox",
                "Byzantine Candor",
                "Byzantine Hades",
                "Comment Crew",
                "Comment Panda",
                "GIF89a",
                "Group 3",
                "Operation Oceansalt",
                "Operation Seasalt",
                "Operation Siesta",
                "Shanghai Group",
                "TG-8223"
            ],
            "source_name": "ETDA:Comment Crew",
            "tools": [
                "Auriga",
                "Cachedump",
                "Chymine",
                "CookieBag",
                "Darkmoon",
                "GDOCUPLOAD",
                "GLOOXMAIL",
                "GREENCAT",
                "Gen:Trojan.Heur.PT",
                "GetMail",
                "Hackfase",
                "Hacksfase",
                "Helauto",
                "Kurton",
                "LETSGO",
                "LIGHTBOLT",
                "LIGHTDART",
                "LOLBAS",
                "LOLBins",
                "LONGRUN",
                "Living off the Land",
                "Lslsass",
                "MAPIget",
                "ManItsMe",
                "Mimikatz",
                "MiniASP",
                "Oceansalt",
                "Pass-The-Hash Toolkit",
                "Poison Ivy",
                "ProcDump",
                "Riodrv",
                "SPIVY",
                "Seasalt",
                "ShadyRAT",
                "StarsyPound",
                "TROJAN.COOKIES",
                "TROJAN.FOXY",
                "TabMsgSQL",
                "Tarsip",
                "Trojan.GTALK",
                "WebC2",
                "WebC2-AdSpace",
                "WebC2-Ausov",
                "WebC2-Bolid",
                "WebC2-Cson",
                "WebC2-DIV",
                "WebC2-GreenCat",
                "WebC2-Head",
                "WebC2-Kt3",
                "WebC2-Qbp",
                "WebC2-Rave",
                "WebC2-Table",
                "WebC2-UGX",
                "WebC2-Yahoo",
                "Wordpress Bruteforcer",
                "bangat",
                "gsecdump",
                "pivy",
                "poisonivy",
                "pwdump",
                "zxdosml"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716500,
    "ts_updated_at": 1743041813,
    "ts_creation_date": 1434030231,
    "ts_modification_date": 1434030238,
    "files": {
        "pdf": "https://archive.orkl.eu/fe05831d3dc661e418f969045f0087ba642fb27b.pdf",
        "text": "https://archive.orkl.eu/fe05831d3dc661e418f969045f0087ba642fb27b.txt",
        "img": "https://archive.orkl.eu/fe05831d3dc661e418f969045f0087ba642fb27b.jpg"
    }
}