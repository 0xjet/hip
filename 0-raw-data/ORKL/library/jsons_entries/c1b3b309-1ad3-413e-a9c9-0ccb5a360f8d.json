{
    "id": "c1b3b309-1ad3-413e-a9c9-0ccb5a360f8d",
    "created_at": "2023-01-12T15:02:14.48846Z",
    "updated_at": "2025-03-27T02:08:41.23251Z",
    "deleted_at": null,
    "sha1_hash": "e11ee9107b1b39cb4fde50fabb47a77af3de02eb",
    "title": "2022-03-24 - Vidar Malware Launcher Concealed in Help File",
    "authors": "",
    "file_creation_date": "2022-05-28T15:19:34Z",
    "file_modification_date": "2022-05-28T15:19:34Z",
    "file_size": 517738,
    "plain_text": "# Vidar Malware Launcher Concealed in Help File\n\n**[trustwave.com/en-us/resources/blogs/spiderlabs-blog/vidar-malware-launcher-concealed-in-help-file/](https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/vidar-malware-launcher-concealed-in-help-file/)**\n\nAppending a malicious file to an unsuspecting file format is one of the tricks our adversaries\nuse to evade detection. Recently, we came across an interesting email campaign employing\nthis technique to deliver the info stealer Vidar malware. First, let’s examine the email\ndelivery mechanism, then go on to take a closer look at the Vidar malware itself.\n\n**_Figure 1: The malicious spam message_**\n\nThe messages in this campaign have two things in common. First, the email body has\nsimilar text, which as usual, directs the recipient’s attention to the attachment.\n\n\n-----\n\nSecond, the email contains only one attachment named request.doc, which is actually an\nISO file. ISO is a disk image file format that cybercriminals [repurpose for use as a malware](https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/leveraging-disk-imaging-tools-to-deliver-rats/)\ncontainer. In this campaign, the ISO attachment holds two files – a Microsoft Compiled\nHTML Help (CHM) file “pss10r.chm” and an executable “app.exe.” Once the attacker tricks\nthe recipient into extracting the contents of “request.doc” and then executes either one, the\nsystem can be compromised.\n\n## The CHM Loader\n\nCHM is Microsoft Proprietary online help file format normally used for software\ndocumentation. When executed, Microsoft Help Viewer (hh.exe) loads the primary object of\nthe CHM.\n\n**_Figure 2: The MailMarshal unpack tree of the ISO attachment_**\n\n\n-----\n\nAs shown in Figure 2, MailMarshal supports the unpacking of ISO and CHM files. One of\nthe objects unpacked from the CHM is the HTML file\n“PSSXMicrosoftSupportServices_HP05221271.htm”- the primary object that gets loaded\nonce the CHM “pss10r.chm” is opened. This HTML has a button object which automatically\ntriggers the silent re-execution of the CHM “pss10r.chm” with mshta.\n\n**_Figure 3: The legitimate PSS10R.CHM in Windows vs the one contained in the ISO_**\n_attachment_\n\nMshta is a Windows binary used for executing HTA files. Looking at the CHM “pss10r.chm”\nstatically, some HTML Application (HTA) code is noticeably lurking at the tail end. The\nappended HTA has some JavaScript that silently runs ‘app.exe’, the second file inside the\nISO attachment. Note that for this loader to work, the executable must be extracted to the\nsame directory as the CHM file.\n\n\n-----\n\n**_Figure 4: The HTA appended at the CHM Loader ‘pss10r.chm’_**\n\n## The Vidar Malware\n\nThe executable “app.exe” is the malware known as Vidar, which is an information stealer\ncompiled in C++ capable of harvesting system information and data from a wide range of\nbrowsers and other applications in the system.\n\n**_Figure 5: Vidar advertised on ultrahacks.org_**\n\n\n-----\n\nOnce executed, this malware will not proceed to its malicious routine if the computer and\nusername of the system is JohnDoe and HAL9TH, respectively (artifacts from Windows\nDefender emulator), and if the following DLLs related to sandbox and AV and email\nscanners are loaded into the system.\n\napi_log.dll    cmdvrt64.dll  snxhk.dll\navghookx.dll  dir_watch.dll  vmcheck.dll\navghooka.dll  pstorec.dll    wpespy.dll\ncmdvrt32.dll  sbiedll.dll\n\nThe Vidar samples we obtained, which were all version 50.3, retrieve their command and\ncontrol (C&C) servers from Mastodon, an open-source social networking platform. The\nsamples searched the following profiles and grab the C&C from the Bio section:\n\nmastodon.social@kill5rnax\nnoc.social@kill6nix\n\n**_Figure 6: The Mastodon profile containing Vidar’s C&C_**\n\nBefore the stealing routine, Vidar downloads its dependencies from the C&C and saves\nthem at C:\\ProgramData. Then, it retrieves its configuration setting.\n\nfreebl3.dll\nmozglue.dll\nmsvcp140.dll\n\n\n-----\n\nns33.dll\nsoftokn3.dll\nvcruntime140.dll\n\n**_Figure 7: The returned setting with 95[.]216[.]181[.]231/1149_**\n\nVidar creates its own folder at C:\\ProgramData. The data it collected from the infected\nsystem are saved on C:\\ProgramData\\<random>\\files. Then, this is archived at\n_C:\\ProgramData\\<random>\\<machine GUID>.zip and sent to the C&C._\n\n**_Figure 8: The folders and files created by “app.exe”_**\n\nWe observed in the code that in response, the C&C can send a download URL of an\nexecutable. This process can lead to another malware being installed in the system.\n\n**_Figure 9: Vidar can download and execute an executable_**\n\n\n-----\n\nLastly, the files created by this threat are deleted, as well as all the DLL files in\n%programdata%. Below is the command used.\n\nC:\\Windows\\System32\\cmd.exe /c taskkill /im <Vidar executable> /f & timeout /t 6 & del /f /q\n\\\" <Vidar filepath>\\\" & del C:\\ProgramData\\*.dll & exit\n\n## IOC\n\nrequest.doc (1996800 bytes)\n\nSHA1: 4E5BC4B8CB05872721C1D4965C14D395ED0B3221\n\npss10r.chm ( 949858 bytes)\n\nSHA1: EFE3E712C667CE1D61C8613D03F7EAE31782BDBF\n\nPSSXMicrosoftSupportServices_HP05221271.htm (2710 bytes)\n\nSHA1: 762DF02815D9E5A4D4058081D3FF479853B1348D\n\napp.exe (674304 bytes)\n\nSHA1: 8CB6279E76DCA6DFDEF1079CB336C0F2D69AC9D3\n\n95[.]216[.]181[.]231 - C&C\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-03-24 - Vidar Malware Launcher Concealed in Help File.pdf"
    ],
    "report_names": [
        "2022-03-24 - Vidar Malware Launcher Concealed in Help File.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535734,
    "ts_updated_at": 1743041321,
    "ts_creation_date": 1653751174,
    "ts_modification_date": 1653751174,
    "files": {
        "pdf": "https://archive.orkl.eu/e11ee9107b1b39cb4fde50fabb47a77af3de02eb.pdf",
        "text": "https://archive.orkl.eu/e11ee9107b1b39cb4fde50fabb47a77af3de02eb.txt",
        "img": "https://archive.orkl.eu/e11ee9107b1b39cb4fde50fabb47a77af3de02eb.jpg"
    }
}