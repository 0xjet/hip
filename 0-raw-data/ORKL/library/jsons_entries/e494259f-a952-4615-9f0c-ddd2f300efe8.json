{
    "id": "e494259f-a952-4615-9f0c-ddd2f300efe8",
    "created_at": "2023-01-12T15:00:11.949432Z",
    "updated_at": "2025-03-27T02:08:40.992472Z",
    "deleted_at": null,
    "sha1_hash": "5ee69b2febc1efd5431bd62da51ee2b0a5800385",
    "title": "2021-10-29 - OpenCTI data sharing",
    "authors": "",
    "file_creation_date": "2022-05-28T18:22:04Z",
    "file_modification_date": "2022-05-28T18:22:04Z",
    "file_size": 525274,
    "plain_text": "# OpenCTI data sharing\n\n**medium.com/luatix/opencti-data-sharing-6da7dc045d14**\n\nJulien Richard October 29, 2021\n\n[Julien Richard](https://medium.com/@julien.richard?source=post_page-----6da7dc045d14--------------------------------)\n\nOct 29, 2021\n\n\n10 min read\n\nIn this blog post, we would like to explain a little bit how users and developers are able to\nextract data from OpenCTI whether using API, TAXII‚Ñ¢ collections or data streams.\n\nAs you might know, data sharing in the cybersecurity field matters a lot (and this is not the\nonly one üòÄ) and we think this is an area where OpenCTI should bring great added value to\nthe community.\n\nMajor data sharing features in OpenCTI\nOpenCTI has a lot of capabilities to extract the information from the database to feed other\nsystems. We will give you more knowledge about the different ways to do it, with a specific\nfocus on streams capabilities.\n\n## GraphQL API\n\n\n-----\n\nThe first way to extract data from OpenCTI is by using the GraphQL API (/graphql). If you\nchoose to directly consume this API, you will have to manipulate filtering, ordering and\npagination API arguments to get the latest data periodically. This can lead to some delay in\nrefreshing your data.\n\nIf you would like to discover the API endpoints and capabilities, the best path is to explore\nthe embedded GraphQL playground in the platform.\n\nGraphQL playground\n\n## TAXII‚Ñ¢ Collections\n\nOpenCTI has an embedded TAXII‚Ñ¢ API endpoint which provides valid STIX 2.1 bundles. If\n[you wish to know more about the TAXII‚Ñ¢ standard, please read the official introduction.](https://oasis-open.github.io/cti-documentation/taxii/intro.html)\n\nIn OpenCTI you can create as many TAXII 2.1 collections as needed. Each of them can have\nspecific filters to publish only a subset of the platform overall knowledge (specific types of\nentities, labels, marking definitions, etc.).\n\n\n-----\n\nAn example of OpenCTI TAXII 2.1 collection\nAfter creating a new collection, every systems with a proper access token can consume the\ncollection using different kind of authentication (basic, bearer, etc.)\n\nAs when using the GraphQL, TAXII 2.1 collections have a classic pagination system that\nshould be handled by the consumer. Also, it‚Äôs important to understand that element\ndependencies (nested IDs) inside the collection are not always contained/resolved in the\nbundle (this may lead to have a thousands of entities just for one), so consistency needs to\nbe handled at the client level.\n\nThe lack of real time update and the dependencies issue are the main drivers that led us to\ncreate what we call in the platform the ‚Äústreams (live or raw)‚Äù.\n\n## Streams\n\nOpenCTI provides 2 different kinds of stream which aim to provide various usages. These\nstreams are both available through the API directly, using the Server-sent events protocol (to\n[learn more about SSE, you can check the Wikipedia article).](https://fr.wikipedia.org/wiki/Server-sent_events)\n\n**Disclaimer: the streams contain only knowledge data (STIX 2.1). All internal**\n**configurations, users, groups, roles, etc. are not streamed. For all attached files, the**\n**streams provide metadata information as well as links to authenticated download.**\n\n## The ‚Äúraw‚Äù stream\n\n\n-----\n\nThis stream is a low level stream directly written in our Redis database. Every time\nsomething is written in OpenCTI, the platform stores the event in this stream: create,\n**update, delete and merge.**\n\n[The ‚Äúraw‚Äù stream is available on the URL: . To access it, the logged in user must have the](http://your_opencti_.com/stream.)\ncapability ‚ÄúConnect and consume the platform stream‚Äù. The available content is also\n**implicitly filtered with the allowed marking definitions (aka data segregation).**\n\nEach type of event has a specific format so consuming this stream needs an understanding\nof this ontology and developing dedicated methods to handle it.\n\n**Creation event**\nThe creation event ‚Äúdata‚Äù field contains the full data in pure STIX 2.1 format.\n```\nid: 1635416661232-0event: createdata: { \"markings\": [], \"origin\": {  \"ip\":\n\"::ffff:172.16.2.1\",  \"user_id\": \"45626d43-f88c-4c98-8729-f33b7730e6ba\",  \n\"referer\": \"https://opencti/dashboard/threats/threat_actors?\" }, \"data\": {  \n\"name\": \"Test Threat Actor\",  \"description\": \"Test Threat Actor\",  \"confidence\":\n15,  \"spec_version\": \"2.1\",  \"created_at\": \"2021-10-28T10:24:21.178Z\",  \n\"updated_at\": \"2021-10-28T10:24:21.178Z\",  \"revoked\": false,  \"lang\": \"en\",  \n\"created\": \"2021-10-28T10:24:21.178Z\",  \"modified\": \"2021-10-28T10:24:21.178Z\",  \n\"id\": \"threat-actor--aeefb1fc-7418-53cc-8ffb-78ee20289ff7\",  \"x_opencti_id\":\n\"c0243521-b62d-4881-9584-968c6ecc0bc8\",  \"type\": \"threat-actor\",  \n\"x_opencti_type\": \"Threat-Actor\" }, \"message\": \"creates a Threat-Actor `Test Threat\nActor`\", \"version\": \"3\"}\n\n```\n**Delete event**\nThe delete event field ‚Äúdata‚Äù contains the id of the deleted element and also the associated\ndata in pure STIX 2.1 format at the deletion time (elements deleted recursively will be\navailable in x_opencti_context field).\n```\nid: 1635416953680-0event: deletedata: { \"markings\": [], \"origin\": {  \"ip\":\n\"::ffff:172.16.2.1\",  \"user_id\": \"45626d43-f88c-4c98-8729-f33b7730e6ba\",  \n\"referer\": \"https://opencti/dashboard/threats/threat_actors/c0243521-b62d-4881-9584968c6ecc0bc8\" }, \"data\": {  \"id\": \"threat-actor--aeefb1fc-7418-53cc-8ffb78ee20289ff7\",  \"name\": \"Test Threat Actor\",  \"description\": \"Test Threat Actor\",\n\"confidence\": 15,  \"spec_version\": \"2.1\",  \"created_at\": \"2021-1028T10:24:21.178Z\",  \"updated_at\": \"2021-10-28T10:24:21.178Z\",  \"revoked\": false, \n\"lang\": \"en\",  \"created\": \"2021-10-28T10:24:21.178Z\",  \"modified\": \"2021-1028T10:24:21.178Z\",  \"x_opencti_id\": \"c0243521-b62d-4881-9584-968c6ecc0bc8\",  \n\"type\": \"threat-actor\",  \"x_opencti_type\": \"Threat-Actor\",  \"x_opencti_context\":\n{   \"deletions\": []  } }, \"message\": \"deletes a Threat-Actor `Test Threat\nActor`\", \"version\": \"3\"}\n\n```\n**Update eventThe update event contains the id of the updated element along with a specific**\npatch object element containing the replace/add/remove operations.\n\n\n-----\n\n```\nid: 1635417153690 0event: updatedata:{ markings : [], origin : {  ip :\n\"::ffff:172.16.2.1\",  \"user_id\": \"45626d43-f88c-4c98-8729-f33b7730e6ba\",  \n\"referer\": \"https://opencti/dashboard/threats/threat_actors/92903430-97e6-45f6-a976ff99ec9809db\" }, \"data\": {  \"x_opencti_patch\": {   \"replace\": {    \n\"description\": {     \"current\": \"This is a test description\",     \n\"previous\": \"test\"    }   }  },  \"id\": \"threat-actor--b088c4b6-52d5-533fb5e0-1a255970ec6e\",  \"x_opencti_id\": \"92903430-97e6-45f6-a976-ff99ec9809db\",  \n\"type\": \"threat-actor\",  \"x_opencti_type\": \"Threat-Actor\" }, \"message\": \"replaces\n`This is a test description` in `description`\", \"version\": \"3\"}\n\n```\nAnother example:\n```\n{ \"markings\": [], \"origin\": {  \"ip\": \"::ffff:172.16.2.1\",  \"user_id\":\n\"45626d43-f88c-4c98-8729-f33b7730e6ba\",  \"referer\":\n\"https://opencti/dashboard/threats/threat_actors/92903430-97e6-45f6-a976ff99ec9809db\" }, \"data\": {  \"x_opencti_patch\": {   \"replace\": {    \n\"created_by_ref\": {     \"current\": {      \"value\": \"identity--01291fc4aa94-566f-9867-35217412a2f1\",      \"reference\": \"ISP Kievnet\",      \n\"x_opencti_id\": \"c0a3dca9-b07a-47c0-8c47-9baf831b9af5\"     },     \n\"previous\": null    }   }  },  \"id\": \"threat-actor--b088c4b6-52d5-533fb5e0-1a255970ec6e\",  \"x_opencti_id\": \"92903430-97e6-45f6-a976-ff99ec9809db\",  \n\"type\": \"threat-actor\",  \"x_opencti_type\": \"Threat-Actor\" }, \"message\": \"replaces\n`identity--01291fc4-aa94-566f-9867-35217412a2f1` in `created_by_ref`\", \"version\":\n\"3\"}\n\n```\n**Merge event**\nThe merge event contains the list of the merged element along with the list of deleted\nelements due to the merge (in x_opencti_context field).\n\n\n-----\n\n```\nid: 1635417404792 0event: mergedata: { markings : [  99518d4a 7cb2 4422 8b80\naec475882446\" ], \"origin\": {  \"user_id\": \"45626d43-f88c-4c98-8729-f33b7730e6ba\", \n\"referer\": \"background_task\" }, \"data\": {  \"id\": \"malware--8bd2cac8-fbde-5b158d67-5dc91dfaa1f1\",  \"x_opencti_stix_ids\": [   \"malware--47fe49ff-03f0-503396e3-9fe326a94369\"  ],  \"name\": \"Abaddon\",  \"description\": \"Uses Discord as\nC&C, has ransomware feature.\",  \"aliases\": [   \"Abaddon RAT\"  ],  \n\"is_family\": true,  \"first_seen\": \"1970-01-01T00:00:00.000Z\",  \"last_seen\":\n\"5138-11-16T09:46:40.000Z\",  \"confidence\": 15,  \"revoked\": false,  \"lang\":\n\"en\",  \"created\": \"2021-09-13T04:42:44.664Z\",  \"modified\": \"2021-1028T10:36:44.697Z\",  \"spec_version\": \"2.1\",  \"created_at\": \"2021-0913T04:42:44.664Z\",  \"updated_at\": \"2021-10-28T10:36:44.697Z\",  \"created_by_ref\":\n\"identity--180d3ffd-a014-54ff-a817-211dddd29059\",  \"object_marking_refs\": [   \n\"marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9\"  ],  \n\"external_references\": [   {    \"source_name\": \"Bleepingcomputer RAT malware\n2020\",    \"description\": \"Abrams, L. (2020, October 23). New RAT malware gets\ncommands via Discord, has ransomware feature. Retrieved April 1, 2021.\",    \n\"url\": \"https://www.bleepingcomputer.com/news/security/new-rat-malware-gets-commandsvia-discord-has-ransomware-feature/\",    \"external_id\": null   }  ],  \n\"x_opencti_id\": \"699db9c9-98eb-4d1b-9ab4-849611c7e084\",  \"type\": \"malware\",  \n\"x_opencti_type\": \"Malware\",  \"x_opencti_patch\": {   \"add\": {    \n\"x_opencti_stix_ids\": [     \"malware--47fe49ff-03f0-5033-96e3-9fe326a94369\"   \n]   },   \"replace\": {    \"aliases\": {     \"current\": [      \n\"Abaddon RAT\"     ],     \"previous\": null    },    \"modified\": {  \n\"current\": \"2021-10-28T10:36:44.697Z\",     \"previous\": \"2021-0913T04:42:44.664Z\"    },    \"updated_at\": {     \"current\": \"2021-1028T10:36:44.697Z\",     \"previous\": \"2021-09-13T04:42:45.350Z\"    }   }  \n},  \"x_opencti_context\": {   \"sources\": [    {     \"id\": \"malware-47fe49ff-03f0-5033-96e3-9fe326a94369\",     \"name\": \"Abaddon RAT\",     \n\"is_family\": false,     \"first_seen\": \"1970-01-01T00:00:00.000Z\",     \n\"last_seen\": \"5138-11-16T09:46:40.000Z\",     \"confidence\": 15,     \n\"revoked\": false,     \"lang\": \"en\",     \"created\": \"2021-0913T15:15:23.191Z\",     \"modified\": \"2021-09-13T15:15:23.191Z\",     \n\"spec_version\": \"2.1\",     \"created_at\": \"2021-09-16T05:21:18.065Z\",     \n\"updated_at\": \"2021-09-16T05:21:18.195Z\",     \"created_by_ref\": \"identity-e52b2fa3-2af0-5e53-ad38-17d54b3d61cb\",     \"object_marking_refs\": [      \n\"marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9\"     ],     \n\"x_opencti_id\": \"c0a7affc-063e-497a-82cc-d31050f81e89\",     \"type\": \"malware\", \n\"x_opencti_type\": \"Malware\"    }   ],   \"deletions\": [],   \"shifts\": [ \n{     \"id\": \"relationship--4219eeaa-369c-4f3d-97cb-0d7ceea990a4\",     \n\"x_opencti_id\": \"dddcebec-8361-40f6-b34f-1cd9faa91663\",     \"type\":\n\"relationship\",     \"relationship_type\": \"uses\",     \"x_opencti_patch\": { \n\"replace\": {       \"source_ref\": {        \"current\": {        \n\"x_opencti_id\": \"699db9c9-98eb-4d1b-9ab4-849611c7e084\"        },       \n\"previous\": {         \"value\": \"c0a7affc-063e-497a-82cc-d31050f81e89\"    \n}       }      }     }    },    [...]    }   ]  } \n}, \"message\": \"merges Malware `Abaddon RAT` in `Abaddon`\", \"version\": \"3\"}\n\n```\n**Current internal usages of the raw stream**\n\n\n-----\n\nRaw stream URL is displayed in the data sharing section\n_Create the history_\n\nThe history connector is a simple usage of the raw stream consumption that get each event\nin the stream to build the history index.\n\n_Rebuild a complete platform_\n\nA connector is available on demand to consume the raw stream of a platform and ingest data\nin a new one. Nevertheless, it‚Äôs not released yet since this use case needs to maintain all the\nevents all the events in the Redis stream indefinitely, so Redis sizing can be huge.\n\n_Rule engine real time behavior_\n\nThe ‚Äúrule engine‚Äù (released in 5.0.0) uses this stream internally to perform real time\ncreation/update/deletion of the inferred elements created in the context of the enabled\nreasoning rules.\n\nExample of inferred relationship\n_Share data to other systems_\n\nYou can obviously use this stream to react on OpenCTI data in other systems. If you need\n[help to understand the event types, formats, etc., you can join our Slack channel and get](https://slack.luatix.org/)\nhelp.\n\n\n-----\n\n## Live/data sharing stream\n\nThis stream is a high level stream (and the most used) where data are coming both\nfrom the ElasticSearch database and the raw stream. Each time something is updated\nin OpenCTI, the stream will publish the complete STIX 2.1 data based on the specified\nfilters in the stream configuration.\n\n[An out-of-the-box live stream without any filter is available by default on the URL: . To access](http://opencti/stream/live.)\nit, the logged in user must have the capability ‚ÄúConnect and consume the platform stream‚Äù.\nThe available content is also implicitly filtered with the allowed marking definitions (aka\n_data segregation)._\n\nBeyond default raw and live streams, any user with the appropriate capabilities can also\ncreate his own live streams with filtering and group access restrictions directly in the\nOpenCTI user interface.\n\nExample of user defined live stream\n**Why this is different from the raw stream?**\n\n_Data are always completeThis stream have only two types of event: create and delete. This_\nallows to push only events containing the full data in STIX 2.1 format. There is no partial\nupdate/patching ontology as it is in the raw stream.\n\n_Data dependencies are implicitly injected_\n\nThat‚Äôs a huge difference between the raw stream and any other approach like the TAXII one.\nThis stream takes care for consumer of the data dependencies. Basically, if you create a live\nstream filtered to only get the ‚ÄúMalwares‚Äù, the stream will also published all data attached to\nthis malware by transitivity.\n\nUsing this capability, the client does not need to process everything from the beginning to\nhave consistent data but can just start consuming now and have all the required knowledge\nbefore going ‚Äúlive‚Äù.\n\n\n-----\n\n_Back pressure managementNot yet available in raw stream (this is the subject of on-going_\nworks), the live stream have the capability to handle some commands to manage the back\npressure. I will explain a bit more the mechanism in the synchronization section. Please\ncontinue to read if you are interested üòÄ.\n\n**Current internal usages of the live streams**\n\n_Backup and restore_\n[Using the connector ‚Äúbackup-files‚Äù, it‚Äôs possible to use live streams to backup all OpenCTI](https://github.com/OpenCTI-Platform/connectors/tree/master/stream/backup-files)\ndata in STIX 2.1 JSON files (and raw files associated to element) in a directory. Also, a\n[‚Äúrestore-files‚Äù connector is available to restore the file from the a directory containing](https://github.com/OpenCTI-Platform/connectors/tree/master/external-import/restore-files)\n[‚Äúbackup-files‚Äù data.](https://github.com/OpenCTI-Platform/connectors/tree/master/stream/backup-files)\n\n_Share data to other systems_\nObviously this stream can be used to react on OpenCTI data in third party systems.\n\n_Platform synchronizationSince OpenCTI 5.0.0, a built-in synchronization management_\nfeature is available in the user interface. To create a new synchronizer, an administrator\nshould know the remote OpenCTI URL, token and live stream ID to consume. This, the\nembedded process will connect to the live stream of the remote OpenCTI, get the data as\nsoon as its published in order to ‚Äúcreate/update/delete‚Äù the elements.\n\nCreation of a synchronizer\n**The back pressure problem**\n\nWhen we have developed the built-in synchronization management system within OpenCTI,\nwe have encountered several issues and especially one concerning the back pressure\nproblem.\n\nWithout any resilient queuing system between two different OpenCTI platforms, the observed\ningestion speed on the consumer side was slower than the stream data production. After\nreviewing different options, it turned to be impossible to introduce this kind of middleware.\n\n\n-----\n\nTherefore, we have decided to develop a system which controls the speed of the remote\nserver to manage a limited queue size on the receiver.\n\n_How its currently works?_\n\n1. Synchronizer connects to the stream and starts getting data. Connect to and get a\n\n[connection_id] as a reference.Data is stored in a memory internal queue.\n2. Synchronizer processes the data in order of the internal queue.\n3. When queue size reach the memory limit (500 elements)\n4. Synchronizer ask remote OpenCTI to slow downPost to [connection_id]specifying a\n\ndelay.Data are now received at low speed.\n5. Synchronizer continue to process the queue that now decrease.\n6. When queue size reach the memory base acceptance (100 elements)Post to\n\n[connection_id]specifying the minimal delay.\n\nThis way the memory queue size on the receiver are always between 100 and 1000\nelements depending of the receiver injection speed. Along with a state we maintain to be\nable to restart the processing if needed.\n\n## Conclusion\n\nAs you read in this blog post sharing data is a really important topic for OpenCTI and we\nexpose a lot of different ways to do it. We hope this article will help you to use the right\napproach for you needs. And if you need other ways to doing it, please join our Slack\n[channel or create an issue on the Github project.](https://github.com/OpenCTI-Platform/opencti)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-10-29 - OpenCTI data sharing.pdf"
    ],
    "report_names": [
        "2021-10-29 - OpenCTI data sharing.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535611,
    "ts_updated_at": 1743041320,
    "ts_creation_date": 1653762124,
    "ts_modification_date": 1653762124,
    "files": {
        "pdf": "https://archive.orkl.eu/5ee69b2febc1efd5431bd62da51ee2b0a5800385.pdf",
        "text": "https://archive.orkl.eu/5ee69b2febc1efd5431bd62da51ee2b0a5800385.txt",
        "img": "https://archive.orkl.eu/5ee69b2febc1efd5431bd62da51ee2b0a5800385.jpg"
    }
}