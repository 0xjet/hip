{
    "id": "33470d3d-8840-4287-bb3e-01dc183e8fb7",
    "created_at": "2023-01-12T15:00:47.050686Z",
    "updated_at": "2025-03-27T02:05:39.928444Z",
    "deleted_at": null,
    "sha1_hash": "3eec243801a2bfa8b40b4ed42f1fd8f10ee8ef58",
    "title": "2016-10-27 - Inside the Gootkit C&C server",
    "authors": "",
    "file_creation_date": "2022-05-28T19:31:32Z",
    "file_modification_date": "2022-05-28T19:31:32Z",
    "file_size": 1081002,
    "plain_text": "# Inside the Gootkit C&C server\n\n**[securelist.com/blog/research/76433/inside-the-gootkit-cc-server/](https://securelist.com/blog/research/76433/inside-the-gootkit-cc-server/)**\n\nAuthors\n\n[Alexey Shulmin](https://securelist.com/author/alexeyshulmin/)\n\n[Sergey Yunakovsky](https://securelist.com/author/sergeyyunakovsky/)\n\nThe Gootkit bot is one of those types of malicious program that rarely attracts much attention\nfrom researchers. The reason is its limited propagation and a lack of distinguishing features.\n\n[There are some early instances, including on Securelist (here and](https://securelist.com/runforestrun-gootkit-and-random-domain-name-generation/57865/) [here), where Gootkit is](https://securelist.com/this-site-may-harm-your-computer-how-to-recognize-and-defeat-website-infections/36534/)\nmentioned in online malware research as a component in bots and Trojans. However, the\nfirst detailed analysis was published by researchers around two years ago. That was the first\nattempt to describe the bot as a standalone malicious program, where it was described as a\n“new multi-functional backdoor”. The authors of that piece of research put forward the\nassertion that the bot’s features were borrowed from other Trojans, and also provided a\ndescription of some of Gootkit’s key features.\n\nIn September 2016, we discovered a new version of Gootkit with a characteristic and\ninstantly recognizable feature: an extra check of the environment variable ‘crackme’ in the\ndownloader’s body. This feature was not present in the early versions. Just as interesting\n\n\n-----\n\nwas the fact that we were able to gain access to the bot s C&C server, including its complete\nhierarchal tree of folders and files and their contents.\n\n## Infection\n\nAs was the case earlier, the bot Gootkit is written in NodeJS, and is downloaded to a victim\ncomputer via a chain of downloaders. The main purpose of the bot also remained the same –\nto steal banking data. The new Gootkit version, detected in September, primarily targets\nclients of European banks, including those in Germany, France, Italy, the Netherlands,\nPoland, etc.\n\nThe Trojan’s main propagation methods are spam messages with malicious attachments and\nwebsites containing exploits on infected pages (Rig Exploit Kit). The attachment in the spam\nmessages contained Trojan-Banker.Win32.Tuhkit, the small initial downloader that launched\nand downloaded the main downloader from the C&C server, which in turn downloaded\nGootkit.\n\n\n-----\n\n_Examples of infected pages used to spread the Trojan_\n\nWhile carrying out our research we detected a huge number of the initial downloader\nversions that were used to distribute the Trojan – most of them are detected as\n_Trojan.Win32.Yakes. Some of the loaders were extremely odd, like the one shown below. It_\nclearly stated in its code that is was a loader for Gootkit.\n\n_Section of code from one of the initial downloaders_\n\nSome versions of Gootkit are also able to launch the main body with administrator privileges\nbypassing UAC. To do so, the main loader created an SDB file and registered it in the\nsystem with the help of the sdbinst.exe utility, after which it launched the bot with elevated\n\n\n-----\n\nprivileges without notifying the user.\n\n## ‘Crackme’ check\n\nThe new version of Gootkit is distinct in that it checks the environment variable ‘crackme’\nlocated in the downloader body. It works as follows: the value of the variable is compared to\na fixed value. If the two values differ, the bot starts to check if it has been launched in a\nvirtual environment.\n\n_Checking the global variable in the downloader’s body_\n\nTo do so, the bot checks the variable ‘trustedcomp’, just like it did in earlier versions.\n\n\n-----\n\n_Checking the bot’s body for launch in a virtual environment_\n\nThe Trojan’s main body\n\nThe Trojan’s main file includes a NodeJS interpreter and scripts. After unpacking, the scripts\nlook like this:\n\n\n-----\n\n_NodeJS scripts that make up the Trojan’s main body_\n\nThe scripts shown in the screenshot constitute the main body of the Trojan. Gootkit has\nabout a hundred various scripts, but they are mostly for practical purposes (intermediate data\nhandlers, network communication DLLs, wrapper classes implementations, encoders etc.)\nand not of much interest.\n\nThe Trojan itself is distributed in an encrypted and packed form. Gootkit is encrypted with a\nsimple XOR with a round key; unpacking is performed using standard Windows API tools.\nThe screen below shows the first 255 bytes of the transferred data.\n\n_The Trojan’s packed body_\n\n\n-----\n\nThe first three DWORDs denote the sizes of the received, unpacked and packed data\nrespectively. One can easily check this by subtracting the third DWORD from the first\nDWORD, which leaves 12 bytes – i.e., the size of these variables.\n\n## Stealing money\n\nInterception of user data is done the standard way, via web injections into HTTPS traffic\n(examples of these web injects are shown below). After the data is sent to the C&C server, it\nis processed by parsers, each of which is associated with the website of a specific bank.\n\n_Fragment of parser code_\n\nCommunication with the C&C\n\n\n-----\n\nIn the version of Gootkit under review, the C&C address is the same as the address from\nwhich the Trojan’s main body is downloaded; in earlier versions, these two addresses\nsometimes differed. While generating a request, the Trojan uses its unique User Agent – any\nrequest that does not specify a User Agent will be denied.\n\n_The unique GootKit User Agent_\n\nCommunication with the C&C comes down to the exchange of a pre-defined set of\ncommands, the main ones being:\n\nRequest a list of files available to the Trojan (P_FS:FS_READDIR);\nReceive those files (P_FS:FS_GETFILE/FS_GET_MULTIPLEFILES);\nReceive update for the bot (P_FS: FS_GETFILE);\nObtain screenshot (P_SPYWARE:SP_SCREENSHOT);\nUpload list of processes (P_SPYWARE:SP_PROCESSLIST);\nTerminate process (P_SPYWARE:SP_PROCESSKILL);\nDownload modules (P_FS: FS_GETFILE);\nReceive web injects (P_ SPYWARE:SP_SPYWARE_CONFIG).\n\n_The bot’s main commands and sub-commands_\n\n\n-----\n\nThe C&C addresses (two or three in number) are hardwired in the loader s body and can\nalso be saved in the registry. The body of the data packet may vary depending on the\nrequest type, but always includes the following variables:\n\nSize of data packet, plus eight;\nCheck value XORed with a constant;\nCommand type;\nCommand sub-type.\n\nIn the screen below, the C&C requests registration information from the bot during its first\nlaunch.\n\n_Request from C&C, example of variables_\n\nThe response in this case will contain detailed information about the infected computer,\nincluding:\n\nNetwork adapter parameters;\nCPU details, amount of RAM;\nUser name, computer name.\n\nRegardless of the request type, data is communicated between the C&C and the bot in the\nformat protobuf.\n\nWhen the main body is downloaded, the address that the loader contacts typically ends in\none of the following strings:\n\n/rbody32;\n/rbody64;\n/rbody320.\n\nMystery solved…rather easily\n\nWe found a configuration error that often appears on botnet C&C servers and took\nadvantage of it to capture a complete tree of folders and files, as well as their contents, from\none of the GootKit C&C servers.\n\n\n-----\n\n_Contents of GootKit C&C server_\n\nThe C&C server contains a number of parsers for different banking sites. These parsers are\nused (provided the user data is available) to steal money from user accounts and to send\nnotifications via Jabber. The stolen data is used in the form of text files, with the infected\ncomputer’s IP address used as the file name.\n\n_Stolen data and logs on the bot’s C&C server_\n\n_Example of stolen data in one of the text files_\n\nOther data (bank transfers and logs) is also stored in text file format\n\n\n-----\n\n_Parser logs_\n\nAn analysis of the bot’s web injects and parser logs has shown that the attackers primarily\ntarget the clients of German and French banks.\n\n\n-----\n\n_Distribution of web injects across domain zones_\n\n_Excerpts from parser logs_\n\nAnalysis of the server content and the parsers made it clear that the botnet’s creator was a\nRussian speaker. Note the comments in the screen below.\n\n\n-----\n\n_A fragment of script including the author’s comments in Russian_\n\nMoreover, Gootkit most probably has just one owner – it’s not for sale anywhere and,\nregardless of the downloaders’ modifications or type of admin panel, the code in NodeJS\n(the Trojan’s main body) is always the same.\n\n\n-----\n\n_Examples of Gootkit web injects_\n\n## Conclusions\n\nGootkit belongs to a class of Trojans that are extremely tenacious, albeit not very\nwidespread. Because it’s not very common, new versions of the Trojan may remain under\nthe researchers’ radar for long periods.\n\nIt should also be noted that the users of NodeJS as a development platform set themselves\ncertain limitations, but simultaneously get a substantial degree of flexibility and simplicity\nwhen creating new versions of the Trojan.\n\n\n-----\n\nKaspersky Lab s security products detect the Trojan GootKit and all its associated\ncomponents under the following verdicts:\n\nTrojan-Banker.Win32.Tuhkit (the initial downloader distributed via emails);\nTrojan.Win32.Yakes (some modifications of the main downloader);\nHEUR:Trojan.Win32.Generic (the bot’s main body, some modifications of the\ndownloader).\n\n## MD5\n\n1c89a85c1a268f6abb34fb857f5b1b6f\n\n7521e82162ed175ad68582dd233ab1ae\n\n9339dcb3571dda122b71fb80de55d0d6\n\nb13378ad831a1e4e60536b6a3d155c42\n\n9ba9f48cda9db950feb4fbe10f61353c\n\n[Botnets](https://securelist.com/tag/botnets/)\n[Financial malware](https://securelist.com/tag/financial-malware/)\n[Malware Technologies](https://securelist.com/tag/malware-technologies/)\n[Trojan](https://securelist.com/tag/trojan/)\n\nAuthors\n\n[Alexey Shulmin](https://securelist.com/author/alexeyshulmin/)\n\n[Sergey Yunakovsky](https://securelist.com/author/sergeyyunakovsky/)\n\nInside the Gootkit C&C server\n\nYour email address will not be published. Required fields are marked *\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2016/2016-10-27 - Inside the Gootkit C&C server.pdf"
    ],
    "report_names": [
        "2016-10-27 - Inside the Gootkit C&C server.pdf"
    ],
    "threat_actors": [
        {
            "id": "61c4ddc4-156b-4828-8570-0979da81f3d0",
            "created_at": "2022-10-25T16:47:55.593828Z",
            "updated_at": "2025-03-27T02:05:17.275161Z",
            "deleted_at": null,
            "main_name": "BRONZE MAYFAIR",
            "aliases": [
                "Gothic Panda ",
                "TG-0110 ",
                "APT3 "
            ],
            "source_name": "Secureworks:BRONZE MAYFAIR",
            "tools": [
                " HUC Proxy Malware (Htran)",
                " Pirpi",
                " SplitVPN",
                " ctt",
                " ctx",
                "Cookiecutter"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "761d1fb2-60e3-46f0-9f1c-c8a9715967d4",
            "created_at": "2023-01-06T13:46:38.269054Z",
            "updated_at": "2025-03-27T02:00:02.789278Z",
            "deleted_at": null,
            "main_name": "APT3",
            "aliases": [
                "TG-0110",
                "Group 6",
                "Buckeye",
                "Boyusec",
                "BORON",
                "BRONZE MAYFAIR",
                "Red Sylvan",
                "GOTHIC PANDA"
            ],
            "source_name": "MISPGALAXY:APT3",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "13354d3f-3f40-44ec-b42a-3cda18809005",
            "created_at": "2022-10-25T15:50:23.275272Z",
            "updated_at": "2025-03-27T02:00:55.418075Z",
            "deleted_at": null,
            "main_name": "APT3",
            "aliases": [
                "APT3",
                "Gothic Panda",
                "Pirpi",
                "UPS Team",
                "Buckeye",
                "Threat Group-0110",
                "TG-0110"
            ],
            "source_name": "MITRE:APT3",
            "tools": [
                "OSInfo",
                "schtasks",
                "PlugX",
                "LaZagne",
                "SHOTPUT",
                "RemoteCMD"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535647,
    "ts_updated_at": 1743041139,
    "ts_creation_date": 1653766292,
    "ts_modification_date": 1653766292,
    "files": {
        "pdf": "https://archive.orkl.eu/3eec243801a2bfa8b40b4ed42f1fd8f10ee8ef58.pdf",
        "text": "https://archive.orkl.eu/3eec243801a2bfa8b40b4ed42f1fd8f10ee8ef58.txt",
        "img": "https://archive.orkl.eu/3eec243801a2bfa8b40b4ed42f1fd8f10ee8ef58.jpg"
    }
}