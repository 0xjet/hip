{
    "id": "180b3a7e-9655-49ca-9a2e-0fa6ef3eeb6e",
    "created_at": "2023-01-12T15:01:59.962236Z",
    "updated_at": "2025-03-27T02:12:03.930888Z",
    "deleted_at": null,
    "sha1_hash": "c32bdf90d04585dd658f1343d01b3148dd0977c6",
    "title": "2021-03-06 - Scan for HAFNIUM Exploitation Evidence with THOR Lite",
    "authors": "",
    "file_creation_date": "2022-05-28T15:16:34Z",
    "file_modification_date": "2022-05-28T15:16:34Z",
    "file_size": 348050,
    "plain_text": "# Scan for HAFNIUM Exploitation Evidence with THOR Lite\n\n**[nextron-systems.com/2021/03/06/scan-for-hafnium-exploitation-evidence-with-thor-lite](https://www.nextron-systems.com/2021/03/06/scan-for-hafnium-exploitation-evidence-with-thor-lite)**\n\nMarch 6, 2021\n\nSince we’ve heard from partners and friends about many non-profit organisations affected by\nthe Exchange server vulnerability, we’ve decided to transfer many detection rules from our\ncommercial scanner into the free community version.\n\n[If you haven’t heard of THOR or THOR Lite before, I’d recommend reading the product page](https://www.nextron-systems.com/thor-lite/)\nof at least THOR Lite.\n\nTLDR: It’s a forensic scanner with the focus on traces of hacking activity, configuration\nbackdoors, file anomalies and other things that an Antivirus often misses like web shells or\nthe output of hack tools that has been left over by the attackers. It is portable and doesn’t\nrequire an installation.\n\n## What we did to improve THOR Lite\n\nWe’ve added many of the signature that we also sell with THOR and the VALHALLA rule\nfeed to the Open Source repository. Fellow researchers provided additional YARA signatures\nfor some webshell types and traces in log files.\n\nOnly a few rules haven’t been published with THOR Lite in order to keep some detection\nlogic secret. (creative ways to detect the compiled ASP.NET DLLs)\n\n[YARA rules, filename IOCs and hash IOCs provided by Microsoft and](https://www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers/) [Volexity are also](https://www.volexity.com/blog/2021/03/02/active-exploitation-of-microsoft-exchange-zero-day-vulnerabilities/)\nalready included.\n\nWe estimate the coverage provided by the open source rules and IOCs to be around 95%.\n\n\n-----\n\nWe even have translated the Sigma rules used in THOR into YARA rules in order to enable\nthe detection of these patterns in THOR Lite (as THOR Lite doesn’t allow Sigma scanning\nbut can apply these rules in the available ‘Logscan’ module).\n\n\n-----\n\n## Included IOCs and YARA Rules\n\n[YARA – Hafnium samples and forensic evidence – apt_hafnium.yar](https://github.com/Neo23x0/signature-base/blob/master/yara/apt_hafnium.yar)\n[YARA – Exploitation in log files – apt_hafnium_log_sigs.yar](https://github.com/Neo23x0/signature-base/blob/master/yara/apt_hafnium_log_sigs.yar)\nHash IOCs – [hash-iocs.txt](https://github.com/Neo23x0/signature-base/blob/master/iocs/hash-iocs.txt#L9738)\n[Filename IOCs – filename-iocs.txt](https://github.com/Neo23x0/signature-base/blob/master/iocs/filename-iocs.txt#L3484)\n\n## Getting Started\n\n\n-----\n\nWe offer THOR Lite for free. All we require is a newsletter subscription. (side note: we ve\nnever sent a newsletter to that list so far. This will be the first blog post that will be sent to all\nsubscribers)\n\nJust visit the [download page, subscribe, receive a license file and download links to](https://www.nextron-systems.com/thor-lite/download/)\ndownload the scanner package.\n\nAfter the download you place the license file sent to you in a separate email into the\nextracted program folder and should immediately update the signatures with the following\ncommand:\n\nthor-lite-util.exe update\nIf you want to use a web proxy to connect to the Internet, use the following command to get a\nhelp for the “update” command.\n\nthor-lite-util.exe update --help\nIf you are already a user of THOR Lite, make sure to use at least signature set version\n“21.3.6-090007”.\n\n## Specific Recommendations\n\n### Exclude Mailbox Folders\n\nWe recommend excluding the mailboxes from the scan by adding the following lines to the\nfile ./config/directory-excludes.cfg\n\n\\\\(MDBDATA|Mailbox|Mailbox Database)\\\\\nScanning this directory would just slow down the scan and – according to all available\nreports – wouldn’t be necessary to produce relevant findings.\n\n### Exchange on Drives Other than C:\n\nIf your Exchange server isn’t installed on drive C:, use the “–allhds” flag.\n\nthor64-lite.exe --allhds\nOtherwise just run a standard scan without flags.\n\n### Antivirus Exclusion\n\nSince THOR Lite doesn’t provide modules for “Rootkit” detection or problematic modules like\n“Mutex” or “NamedPipes”, you shouldn’t have problems scanning systems without an\nAntivirus exclusion filter.\n\n\n-----\n\nAll YARA rules are included in a compressed and encrypted form so that an Antivirus\nshouldn’t trigger on clear text signatures as it is the case for most of the other YARA\nscanners including LOKI.\n\nHowever, since some realtime engines check every file that THOR Lite has “touched” during\nits scan, an Antivirus exclusion can increase the scan speed by ~30% and avoid any\ninterference (blocked access to some files etc.).\n\n### Scanning a Subset Only\n\nYou could run a scan on a subset only and skip other system folders. If you have a good\npicture of the location of the Exchange folder and all relevant sub directories (log files, owa\nweb service folders), you could run a selective scan using the following command.\n\nthor64-lite.exe -a Filescan -p \"C:\\Program Files\\Microsoft\\Exchange Server\"\nHowever, we do not know if all relevant forensic evidence can be found in that folder.\n\n### Intense Mode\n\nDon’t use the “–intense” flag or use it only in cases in which it is okay for the scan to take\n12+ hours to complete and system stability isn’t a concern – which is almost never the case.\nThe “–intense” flag is meant for lab scenarios or use cases in which a maximum detection\nrate is very important. Warning: That flag disables all system resource monitoring safe\nguards that we’ve integrated into THOR.\n\n### Lab Scans\n\nTest the scan on samples that you’ve collected using the following commands:\n\nthor64-lite.exe -a Filescan -p D:\\collected-samples\nthor64-lite.exe --fsonly -p D:\\collected-samples\nThe first command reflects the scan mode that is used during a default scan with all\nmodules. The second command starts THOR in “lab scanning” mode, which scans samples\nregardless of their extension and magic header. If you discover samples that get detected\nonly in lab scanning mode, please let us know. (see “How Can I Help” below)\n\n## How Can I Help\n\nPlease provide feedback on false positives. Include all information that you’re allowed\nto share, e.g. file name, file hash, rule name or the full log line with all confidential\n[information removed. Use the issues section on Github or send an email to](https://github.com/Neo23x0/signature-base/issues)\n[rules@nextron-systems.com.](http://10.10.0.46/mailto:rules@nextron-systems.com)\n\n\n-----\n\nPlease help us cover false negatives. If you ve found a webshell or forensic evidence\nthat THOR Lite wasn’t able to detect, please provide that evidence and we add\ncoverage for everyone in the community to use. (open source YARA rule usable in any\nscanner including LOKI and THOR Lite)\n\n## FAQs\n\n### Where can I find help?\n\nPlease first check the documentation, which is provided as PDF in the ./docs sub folder. It’s\nwritten for THOR, but many chapters also apply to THOR Lite.\n\n[You can report THOR Lite issues on Github.](https://github.com/NextronSystems/thor-lite/issues)\n\n### How can I scan unsupported Windows version?\n\nWe provide a legacy version of THOR to scan outdated Windows version (2003, 2008) for\n[our customers only. Sorry. You can find information on pricing in the license packs section.](https://www.nextron-systems.com/thor/license-packs/)\n\n### How can I provide samples that haven’t been detected?\n\nPlease add information about them to a new issue on Github or send them to rules@nextronsystems.com.\n\n### I’ve subscribed to the Newsletter but didn’t get an email with a license file or the download links. What can I do?\n\nThe response emails sometimes get classified as SPAM. Please check your junk mail folder.\nIn 100% of the cases in which subscribers didn’t get a corresponding email, this was the\nreason.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-03-06 - Scan for HAFNIUM Exploitation Evidence with THOR Lite.pdf"
    ],
    "report_names": [
        "2021-03-06 - Scan for HAFNIUM Exploitation Evidence with THOR Lite.pdf"
    ],
    "threat_actors": [
        {
            "id": "529c1ae9-4579-4245-86a6-20f4563a695d",
            "created_at": "2022-10-25T16:07:23.702006Z",
            "updated_at": "2025-03-27T02:02:09.93109Z",
            "deleted_at": null,
            "main_name": "Hafnium",
            "aliases": [
                "Red Dev 13",
                "Silk Typhoon"
            ],
            "source_name": "ETDA:Hafnium",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "7c969685-459b-4c93-a788-74108eab6f47",
            "created_at": "2023-01-06T13:46:39.189751Z",
            "updated_at": "2025-03-27T02:00:03.017103Z",
            "deleted_at": null,
            "main_name": "HAFNIUM",
            "aliases": [
                "ATK233",
                "G0125",
                "Operation Exchange Marauder",
                "Red Dev 13",
                "Silk Typhoon"
            ],
            "source_name": "MISPGALAXY:HAFNIUM",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "2704d770-43b4-4bc4-8a5a-05df87416848",
            "created_at": "2022-10-25T15:50:23.306305Z",
            "updated_at": "2025-03-27T02:00:55.43633Z",
            "deleted_at": null,
            "main_name": "HAFNIUM",
            "aliases": [
                "HAFNIUM",
                "Operation Exchange Marauder",
                "Silk Typhoon"
            ],
            "source_name": "MITRE:HAFNIUM",
            "tools": [
                "Tarrask",
                "ASPXSpy",
                "Impacket",
                "PsExec",
                "China Chopper"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535719,
    "ts_updated_at": 1743041523,
    "ts_creation_date": 1653750994,
    "ts_modification_date": 1653750994,
    "files": {
        "pdf": "https://archive.orkl.eu/c32bdf90d04585dd658f1343d01b3148dd0977c6.pdf",
        "text": "https://archive.orkl.eu/c32bdf90d04585dd658f1343d01b3148dd0977c6.txt",
        "img": "https://archive.orkl.eu/c32bdf90d04585dd658f1343d01b3148dd0977c6.jpg"
    }
}