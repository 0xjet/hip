{
    "id": "01027996-a90f-46a7-b075-fd37c88b69a0",
    "created_at": "2023-01-12T14:58:49.822695Z",
    "updated_at": "2025-03-27T02:05:41.419195Z",
    "deleted_at": null,
    "sha1_hash": "1a0bb1052dc604cc5c407668e88d7499fd815e8c",
    "title": "2022-08-16 - Two more malicious Python packages in the PyPI",
    "authors": "",
    "file_creation_date": "2022-09-01T10:21:38Z",
    "file_modification_date": "2022-09-01T10:21:38Z",
    "file_size": 1173716,
    "plain_text": "# Two more malicious Python packages in the PyPI\n\n**securelist.com/two-more-malicious-python-packages-in-the-pypi/107218/**\n\nOn August 8, CheckPoint [published a report on ten malicious Python packages in the Python Package Index (PyPI), the most popular Python](https://research.checkpoint.com/2022/cloudguard-spectral-detects-several-malicious-packages-on-pypi-the-official-software-repository-for-python-developers/)\nrepository among software developers. The malicious packages were intended to steal developers’ personal data and credentials.\n\nFollowing this research, we used our internal automated system for monitoring open-source repositories and discovered two other malicious\n[Python packages in the PyPI. They were masquerading as one of the most popular open-source packages named “requests“.](https://pypi.org/project/requests/#files)\n\nTimeline of uploaded packages:\n\n**Package name** **Version** **Timestamp (UTC)**\n\npyquest 2.28.1 2022-07-30 10:11:47.000\n\npyquest 2.28.2 2022-07-30 10:15:28.000\n\npyquest 2.28.3 2022-07-30 10:19:14.000\n\nultrarequests 2.28.3 2022-07-30 10:25:41.000\n\nThe attacker used a description of the legitimate “requests” package in order to trick victims into installing a malicious one. The description\ncontains faked statistics, as if the package was installed 230 million times in a month and has more than 48000 “stars” on GitHub. The project\ndescription also references the web pages of the original “requests” package, as well as the author’s email. All mentions of the legitimate\npackage’s name have been replaced with the name of the malicious one.\n\n\n-----\n\nAfter downloading the malicious packages, it becomes clear that the source code is nearly identical to the code of the legitimate “requests”\npackage, except for one file: exception.py. In the malicious package, this script was last modified on July 30, exactly on the date of publication\nof the malicious package.\n\n\n-----\n\nThe malicious payload is a Base64-encoded Python script hidden in the “HTTPError” class. The script writes another Python one-liner script\ninto a temporary file and then runs that file via the system.start() function. Then that one-liner script downloads the next-stage script from\nhttps://zerotwo-best-waifu[.]online/778112985743251/wap/enner/injector and executes it.\n\n## Downloader\n\n[The next stage is a downloader obfuscated with a publicly available tool named Hyperion. Obfuscation is done using multiple techniques, such](https://github.com/billythegoat356/Hyperion)\nas renaming variables and library functions, adding mixed boolean-arithmetic expressions and junk code, and compressing the code chunks\nwith the zlib library.\n\nThe downloader terminates if the OS name is not “nt” (Windows). It randomly selects one of the directories under C:\\Users\\\n<username>\\AppData\\Roaming or C:\\Users\\<username>\\AppData\\Local, generates a random eight-characters string consisting of the\n“bcdefghijklmnopqrstuvwxyz” characters and randomly picks one of extensions from the following list:\n\n1 ['.dll', '.png', '.jpg', '.gay', '.ink', '.url', '.jar', '.tmp', '.db', '.cfg']\n\n\n-----\n\ne t e a a e do oads t e a stage pay oad o ttps // e ot o best a u[ ]o e/ 8 985 3 5 / ap/s at egay/stea e 3365,\nsaves it to the previously generated location and executes it.\n\nIn order to achieve persistence on the infected machine, the malware creates a registry value with name “Realtek HD Audio Universal Service”\nin the HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run Windows system registry branch.\n\nThe script searches for an existing executable in the %system32% directory, named SecurityHealthSystray.exe or the\nSystemSettingsAdminFlows.exe, adds a “&” character (to ensure sequential execution in a command-line string), and then adds the location of\nthe Python interpreter with the location of the malicious script. It is worth noting that this method does not work properly, as the system starts\nonly the first executable, and the persistence is not actually achieved.\n\n1 C:\\Windows\\System32\\<SecurityHealthSystray.exe | SystemSettingsAdminFlows.exe> & <Python interpreter path> <generated path for\ndropped final payload>\n\n## Final payload: W4SP Stealer\n\nThe final payload is a Trojan written in Python and obfuscated with the same obfuscator as the downloader. The malware is dubbed “W4SP\nStealer” by its author in the code.\n\nUpon launching, the stealer identifies the external IP address of the victim’s machine by making a GET request to https://api.ipify.org and\ninstalls two legitimate PyPI packages – “requests” and “pycryptodome” in order to send exfiltrated data to the operator and work with\ncryptography for decrypting cookies and passwords from browsers. Then the malware starts collecting Discord tokens, saved cookies and\npasswords from browsers in separate threads.\n\nCollected passwords and cookies are stored in the files %TEMP%\\wppassw.txt and %TEMP%\\wpcook.txt in the following format:\n\n1 UR1: <URL> | U53RN4M3: <USERNAME> | P455W0RD: <DECRYPTED_PASSWORD>\n\n\n-----\n\n1 H057 K3Y: <HOST_KEY> | N4M3: <NAME>| V41U3: <DECRYPTED_COOKIE>\n\nAll files created by the stealer on the victim’s machine start with the line: “<–W4SP STEALER ON TOP–>”. All collected data is sent to the\noperator via a Discord webhook\n[(https://discord[.]com/api/webhooks/1001296979948740648/4wqCErLU3BVeKWnxDA70Gns5vcfxh5OCb3YDIFZaFujqfSRIwHH4YIu3aLOVWjCDe](https://discord/)\nand rendered in a prettified format:\n\nThe stealer also creates and sends a list of saved browser credentials for the URLs containing keywords “mail”, “card”, “bank”, “buy”, “sell”,\netc. (see Appendix for a full list). Apart from that, it gathers data from the MetaMask, Atomic and Exodus wallets, as well as Steam and\nMinecraft credentials.\n\nHaving collected credentials, the stealer starts traversing the victim’s directories named Downloads, Documents and Desktop, looking for\nfilenames containing the following words:\n\n\n1\n\n2\n\n3\n\n\n'passw', 'mdp', 'motdepasse', 'mot de passe', 'login', 'paypal',\n\n'banque', 'account', 'metamask', 'wallet', 'crypto', 'exodus',\n\n'discord', '2fa', 'code', 'memo', 'compte', 'token'\n\n\nInterestingly, this list contains multiple French words: “mot de passe” (password), “mdp” (abbreviation for “mot de passe”), “banque” (bank),\n“compte” (account). The matching files are then uploaded to the same Discord channel.\n\nThe stealer also downloads a JavaScript payload from zerotwo-best-waifu[.]online/778112985743251/wap/dsc_injection, writing it into\nDiscord’s index.js file. Then it kills the running discord.exe process, so that the user has to restart Discord, thus activating the payload.\n\n1 subprocess.Popen('taskkill /im discord.exe /t /f',shell=true)\n\nThe injected script monitors the victim’s actions such, as changing their email address, password or billing information. The updated\ninformation is also sent to the Discord channel.\n\n[We have already reported these two](https://security.snyk.io/vuln/SNYK-PYTHON-ULTRAREQUESTS-2980311) [packages to the PyPI security team and Snyk Vulnerability Database.](https://security.snyk.io/vuln/SNYK-PYTHON-PYQUEST-2980312)\n\nKaspersky solutions detect the threat with the following verdicts:\n\nTrojan.Python.Inject.d\nTrojan.Python.Agent.gj\n\n## IOCs\n\n### Samples\n\n[34c9d77afd77611ce55716f23594275a](https://opentip.kaspersky.com/34c9d77afd77611ce55716f23594275a/?utm_source=SL&utm_medium=SL&utm_campaign=SL) ultrarequests-2.28.3.tar.gz\n\n[f2102dee0caba546ef98b47b373bab9a](https://opentip.kaspersky.com/f2102dee0caba546ef98b47b373bab9a/?utm_source=SL&utm_medium=SL&utm_campaign=SL) pyquest-2.28.3.tar.gz\n\n\n-----\n\n[556ee928fbffd4bbd1cec282ec1a5bb3](https://opentip.kaspersky.com/556ee928fbffd4bbd1cec282ec1a5bb3/?utm_source=SL&utm_medium=SL&utm_campaign=SL) Downloader Script\n\n[42f0f3b4d5a2be7f09d1c02668cb2c08](https://opentip.kaspersky.com/42f0f3b4d5a2be7f09d1c02668cb2c08/?utm_source=SL&utm_medium=SL&utm_campaign=SL) injected Discord index.js\n\n[d7b6df674690c2e81c72ea031ed44a6f](https://opentip.kaspersky.com/d7b6df674690c2e81c72ea031ed44a6f/?utm_source=SL&utm_medium=SL&utm_campaign=SL) W4SP stealer\n\n### URLs\n\nhttps://zerotwo-best-waifu[.]online/778112985743251/wap/enner/injector\n\nhttps://zerotwo-best-waifu[.]online/778112985743251/wap/shatlegay/stealer123365\n\nhttps://zerotwo-best-waifu[.]online/778112985743251/wap/dsc_injection\n\n### Appendix\n\n[‘mail’, ‘[coinbase](https://coinbase.com)’, ‘[gmail](https://gmail.com)’, ‘[steam](https://steam.com)’, ‘[discord](https://discord.com)’, ‘[riotgames]\n(https://riotgames.com)’, ‘[youtube](https://youtube.com)’, ‘[instagram](https://instagram.com)’, ‘[tiktok](https://tiktok.com)’, ‘[twitter]\n(https://twitter.com)’, ‘(https://facebook.com)’, ‘card’, ‘[epicgames](https://epicgames.com)’, ‘[spotify](https://spotify.com)’, ‘[yahoo]\n(https://yahoo.com)’, ‘[roblox](https://roblox.com)’, ‘[twitch](https://twitch.com)’, ‘[minecraft](https://minecraft.net)’, ‘bank’, ‘[paypal]\n(https://paypal.com)’, ‘[origin](https://origin.com)’, ‘[amazon](https://amazon.com)’, ‘[ebay](https://ebay.com)’, ‘[aliexpress]\n(https://aliexpress.com)’, ‘[playstation](https://playstation.com)’, ‘[hbo](https://hbo.com)’, ‘[xbox](https://xbox.com)’, ‘buy’, ‘sell’, ‘[binance]\n(https://binance.com)’, ‘[hotmail](https://hotmail.com)’, ‘[outlook](https://outlook.com)’, ‘[crunchyroll](https://crunchyroll.com)’, ‘[telegram]\n(https://telegram.com)’, ‘[pornhub](https://pornhub.com)’, ‘[disney](https://disney.com)’, ‘[expressvpn](https://expressvpn.com)’, ‘crypto’, ‘[uber]\n(https://uber.com)’, ‘[netflix](https://netflix.com)’]\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-08-16 - Two more malicious Python packages in the PyPI.pdf"
    ],
    "report_names": [
        "2022-08-16 - Two more malicious Python packages in the PyPI.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535529,
    "ts_updated_at": 1743041141,
    "ts_creation_date": 1662027698,
    "ts_modification_date": 1662027698,
    "files": {
        "pdf": "https://archive.orkl.eu/1a0bb1052dc604cc5c407668e88d7499fd815e8c.pdf",
        "text": "https://archive.orkl.eu/1a0bb1052dc604cc5c407668e88d7499fd815e8c.txt",
        "img": "https://archive.orkl.eu/1a0bb1052dc604cc5c407668e88d7499fd815e8c.jpg"
    }
}