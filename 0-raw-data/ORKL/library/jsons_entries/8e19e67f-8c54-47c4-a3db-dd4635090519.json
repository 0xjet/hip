{
    "id": "8e19e67f-8c54-47c4-a3db-dd4635090519",
    "created_at": "2023-01-12T15:04:13.986115Z",
    "updated_at": "2025-03-27T02:16:59.217363Z",
    "deleted_at": null,
    "sha1_hash": "aa479b9b31c0ae40437f7c2a9de84c54983003ba",
    "title": "2016-06-25 - Rokku Ransomware shows possible link with Chimera",
    "authors": "",
    "file_creation_date": "2014-06-06T08:39:34Z",
    "file_modification_date": "2014-06-24T09:30:31Z",
    "file_size": 2984029,
    "plain_text": "**DISTINGUISHING INTERNET-FACING ICS DEVICES USING PLC**\n\n**PROGRAMMING INFORMATION**\n\nTHESIS\n\nPaul M. Williams, Major, USA\n\nAFIT-ENG-T-14-J-41\n\n**DEPARTMENT OF THE AIR FORCE**\n**AIR UNIVERSITY**\n\n## AIR FORCE INSTITUTE OF TECHNOLOGY\n\n**Wright-Patterson Air Force Base, Ohio**\n\nDISTRIBUTION STATEMENT A:\nAPPROVED FOR PUBLIC RELEASE; DISTRIBUTION UNLIMITED\n\n\n-----\n\nThe views expressed in this thesis are those of the author and do not reflect the official\npolicy or position of the United States Air Force, the Department of Defense, or the United\nStates Government.\n\nThis material is declared a work of the U.S. Government and is not subject to copyright\nprotection in the United States.\n\n\n-----\n\nAFIT-ENG-T-14-J-41\n\nDISTINGUISHING INTERNET-FACING ICS DEVICES USING PLC\n\nPROGRAMMING INFORMATION\n\nTHESIS\n\nPresented to the Faculty\n\nDepartment of Electrical and Computer Engineering\n\nGraduate School of Engineering and Management\n\nAir Force Institute of Technology\n\nAir University\n\nAir Education and Training Command\n\nin Partial Fulfillment of the Requirements for the\n\nDegree of Master of Science in Cyber Operations\n\nPaul M. Williams, B.S.E.E.T, M.A.I.T.M\n\nMajor, USA\n\nJune 2014\n\nDISTRIBUTION STATEMENT A:\nAPPROVED FOR PUBLIC RELEASE; DISTRIBUTION UNLIMITED\n\n\n-----\n\nAFIT-ENG-T-14-J-41\n\nDISTINGUISHING INTERNET-FACING ICS DEVICES USING PLC\n\nPROGRAMMING INFORMATION\n\nPaul M. Williams, B.S.E.E.T, M.A.I.T.M\nMajor, USA\n\nApproved:\n\n\n//signed//\n\nMaj Jonathan Butts, PhD (Chairman)\n\n//signed//\n\nLt Col David J. Robinson, PhD (Member)\n\n//signed//\n\nJuan Lopez Jr., (Member)\n\n\n28 May 2014\n\nDate\n\n28 May 2014\n\nDate\n\n28 May 2014\n\nDate\n\n\n-----\n\nAFIT-ENG-T-14-J-41\n**Abstract**\n\nThe Shodan search engine reveals Industrial Control System (ICS) devices around\n\nthe globe are directly connected to the Internet. After Shodan’s inception in 2009, multiple\n\nnews reports have focused on the increased threat to infrastructure posed by Shodan. While\n\nno attacks to date have been directly attributed to Shodan searches, its existence provides\n\nan anonymous reconnaissance platform that facilitates ICS targeting for those actors with\n\nboth a desire and capability to carry out attacks. Recent research has demonstrated that\n\nsimple search queries return thousands of ICS devices indexed by Shodan, and the number\n\nof newly indexed ICS devices is growing. This research discusses the method used to\n\ndistinguish the Internet-facing ICS devices indexed by the Shodan search engine. PLC code\n\nis obtained by sending specifically crafted CIP request messages to the devices, capitalizing\n\non the fact that authentication is not built in to the CIP application layer protocol. This data\n\nallows categorization of Internet-facing devices by comparing PLC code attributes. The\n\nresults of this research show PLC code can be collected from Internet-facing ICS devices\n\nwith no significant impact to task execution times. Also, this research demonstrates a\n\nmethod to distinguish Internet-facing ICS devices by function and by Critical Infrastructure\n\nsector. This capability develops an understanding of the function and purpose of ICS\n\ndevices that are being connected to the Internet.\n\niv\n\n\n-----\n\n_I dedicate this to my wife and children for tolerating me in this endeavor._\n\nv\n\n\n-----\n\n**Acknowledgments**\n\nI would like to thank my two Academic Advisors, Lt Col Robinson and Maj Butts\n\nalong with Juan Lopez and Steven Dunlap for their leadership and motivation during the\n\ncourse of this research. I would also like to thank the faculty and students at AFIT who\n\nhelped me think through some of these problems. Finally, I would like to thank Dr.\n\nNathaniel Davis who took the time to ensure I had the tools necessary to compete and\n\nsucceed in this program. Lion Brigade Sir!\n\nPaul M. Williams\n\nvi\n\n\n-----\n\n**Table of Contents**\n\nPage\n\nAbstract . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . iv\n\nDedication . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . v\n\nAcknowledgments . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . vi\n\nTable of Contents . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . vii\n\nList of Figures . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . x\n\nList of Tables . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . xiii\n\nList of Acronyms . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . xiv\n\nI. Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1\n\n1.1 Problem Statement . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1\n1.2 Scope, Assumptions and Limitations . . . . . . . . . . . . . . . . . . . . . 2\n1.3 Approach . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 3\n1.4 Overview of Subsequent Chapters . . . . . . . . . . . . . . . . . . . . . . 4\n\nII. Background . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6\n\n2.1 Critical Infrastructure and Industrial Control Systems . . . . . . . . . . . . 7\n2.1.1 SCADA network architectures . . . . . . . . . . . . . . . . . . . . 8\n2.1.2 ICS Components . . . . . . . . . . . . . . . . . . . . . . . . . . . 11\n2.1.3 Allen-Bradley Industrial Control Systems . . . . . . . . . . . . . . 14\n2.1.4 ICS Protocols . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 19\n2.2 The Shodan Search Engine . . . . . . . . . . . . . . . . . . . . . . . . . . 21\n2.2.1 Discovering Indexed ICS Devices . . . . . . . . . . . . . . . . . . 24\n2.2.2 Project SHINE . . . . . . . . . . . . . . . . . . . . . . . . . . . . 26\n2.3 Security Concerns and ICS Attacks . . . . . . . . . . . . . . . . . . . . . . 26\n2.3.1 TrendMicro Reports on ICS Attakers . . . . . . . . . . . . . . . . 28\n2.3.2 Shodan Impacts on ICS devices Pre/Post Indexing . . . . . . . . . 31\n2.4 Related Work . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 32\n2.5 Conclusion . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 33\n\nvii\n\n\n-----\n\nPage\n\nIII. Methodology . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 34\n\n3.1 Problem Definition . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 34\n3.2 Approach . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 35\n3.2.1 Evaluating Collection Impact on PLCs . . . . . . . . . . . . . . . . 36\n3.2.2 PLC Code Collection Script Development . . . . . . . . . . . . . . 37\n3.2.2.1 EtherNet/IP Connection Setup . . . . . . . . . . . . . . 38\n3.2.2.2 CIP Attribute Requests . . . . . . . . . . . . . . . . . . 38\n3.2.3 Detecting Process Control Terms in PLC Programming Information 40\n3.3 Environment . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 42\n3.3.1 Architecture and Hardware . . . . . . . . . . . . . . . . . . . . . . 42\n3.3.2 Software . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 42\n3.3.3 PLC Code collection tools . . . . . . . . . . . . . . . . . . . . . . 44\n3.3.4 Performance Analysis Tools . . . . . . . . . . . . . . . . . . . . . 44\n3.3.5 Implementation . . . . . . . . . . . . . . . . . . . . . . . . . . . . 44\n3.4 Experiment Design . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 45\n3.4.1 Experiment Setup . . . . . . . . . . . . . . . . . . . . . . . . . . . 45\n3.4.2 PLC Execution Times . . . . . . . . . . . . . . . . . . . . . . . . 46\n3.4.3 PLC Impact Experiments . . . . . . . . . . . . . . . . . . . . . . . 47\n3.4.4 Visual Inspection of PLC Code . . . . . . . . . . . . . . . . . . . . 49\n3.5 Evaluation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 50\n3.6 Conclusion . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 51\n\nIV. Results and Implementation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 52\n\n4.1 Exploratory Testing . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 52\n4.1.1 Reverse Engineering Allen-Bradley PLC Code CIP Requests . . . . 52\n4.1.2 Conclusion . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 59\n4.2 Performance Analysis Results . . . . . . . . . . . . . . . . . . . . . . . . 59\n4.2.1 Data . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 59\n4.2.2 Non-parametric Statistical Analysis . . . . . . . . . . . . . . . . . 62\n4.2.3 Analysis . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 64\n4.2.3.1 L61 CPU . . . . . . . . . . . . . . . . . . . . . . . . . . 64\n4.2.3.2 L71 CPU . . . . . . . . . . . . . . . . . . . . . . . . . . 65\n4.2.3.3 L23E CPU . . . . . . . . . . . . . . . . . . . . . . . . . 65\n4.2.3.4 L32E CPU . . . . . . . . . . . . . . . . . . . . . . . . . 67\n4.2.4 Discussion . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 70\n4.3 Implementation Results . . . . . . . . . . . . . . . . . . . . . . . . . . . . 73\n4.3.1 Identifying Internet-facing ICS devices . . . . . . . . . . . . . . . 73\n4.3.2 Collecting Diagnostic Web Page Data . . . . . . . . . . . . . . . . 75\n4.3.3 Collecting PLC Code . . . . . . . . . . . . . . . . . . . . . . . . . 76\n4.3.4 Distinguishing ICS Devices . . . . . . . . . . . . . . . . . . . . . 76\n\nviii\n\n\n-----\n\nPage\n\n4.3.5 Analysis . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 77\n4.4 Conclusion . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 77\n\nV. Conclusions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 79\n\n5.1 Conclusions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 79\n5.2 Impact . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 79\n5.3 Recommendations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 80\n5.4 Future Work . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 80\n5.4.1 Machine Learning and Process Control Term Matching . . . . . . . 80\n5.4.2 Distinguishing Internet-facing ICS Devices by Sector . . . . . . . . 81\n5.4.3 Determining Methodology Portability . . . . . . . . . . . . . . . . 81\n5.5 Summary . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 82\n\nAppendix A: 1: Process Control Terms . . . . . . . . . . . . . . . . . . . . . . . . . 83\n\nAppendix B: 2: List of Boxplots . . . . . . . . . . . . . . . . . . . . . . . . . . . . 88\n\nBibliography . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 95\n\nix\n\n\n-----\n\n**List of Figures**\n\nFigure Page\n\n2.1 ICS Operation Function Blocks [20]. . . . . . . . . . . . . . . . . . . . . . . . 8\n\n2.2 Example SCADA Architecture [1]. . . . . . . . . . . . . . . . . . . . . . . . . 9\n\n2.3 NIST SCADA Communication Topologies [20]. . . . . . . . . . . . . . . . . . 10\n\n2.4 NIST Guide to ICS Security SCADA System Implementation Example [20]. . . 11\n\n2.5 Allen-Bradley ControlLogix PLC Architecture [25]. . . . . . . . . . . . . . . . 13\n\n2.6 Allen-Bradley EtherNet/IP Architecture [25]. . . . . . . . . . . . . . . . . . . 15\n\n2.7 EtherNet/IP Module Web Server. . . . . . . . . . . . . . . . . . . . . . . . . . 16\n\n2.8 Allen-Bradley CompactLogix PLC Architecture [27]. . . . . . . . . . . . . . . 17\n\n2.9 RSLogix Task Monitor. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 18\n\n2.10 Allen-Bradley Firmware Feature Comparison. . . . . . . . . . . . . . . . . . . 19\n\n2.11 Common Industrial Protocol - Object Oriented Formatting. . . . . . . . . . . . 20\n\n2.12 Common Industrial Protocol - Identity Object Attributes. . . . . . . . . . . . . 21\n\n2.13 Common Industrial Protocol Object Model [6]. . . . . . . . . . . . . . . . . . 22\n\n2.14 Leverett search query results [19]. . . . . . . . . . . . . . . . . . . . . . . . . 25\n\n2.15 Comparison of Leverett search query results obtained in 2011 and 2013 [5]. . . 29\n\n3.1 Process to Distinguish Internet-facing ICS Devices. . . . . . . . . . . . . . . . 36\n\n3.2 PLC Code Program-Specific Instance Request and Response. . . . . . . . . . . 38\n\n3.3 Flowchart depicting Global and Program-specific code collection. . . . . . . . 40\n\n3.4 ControlLogix Experiment Architecture. . . . . . . . . . . . . . . . . . . . . . 43\n\n3.5 CompactLogix Experiment Architecture. . . . . . . . . . . . . . . . . . . . . . 43\n\n3.6 Task Monitor Graphical Interface shown with Wireshark CIP packet capture. . 48\n\n3.7 Measuring PLC Task Execution Times. . . . . . . . . . . . . . . . . . . . . . 50\n\n4.1 Hardware configuration for exploratory testing. . . . . . . . . . . . . . . . . . 53\n\nx\n\n\n-----\n\nFigure Page\n\n4.2 EtherNet/IP Packet. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 54\n\n4.3 PLC Code Request for Global Instance Values. . . . . . . . . . . . . . . . . . 55\n\n4.4 PLC Code Global Instance Request and Response. . . . . . . . . . . . . . . . 56\n\n4.5 PLC Code Request for Program-Specific Instance Values. . . . . . . . . . . . . 57\n\n4.6 PLC Code Program-Specific Instance Request and Response. . . . . . . . . . . 57\n\n4.7 R Q-Q Plot of PLC Task Execution Times L61 v16.56.47. . . . . . . . . . . . 60\n\n4.8 Boxplots of PLC Task Execution Times L61 v16.56.47. . . . . . . . . . . . . . 62\n\n4.9 Run B2 Scatter Plot for PLC Task Execution Times L61 v16.56.47. . . . . . . 63\n\n4.10 Boxplot for L61 v19.11.56. . . . . . . . . . . . . . . . . . . . . . . . . . . . . 65\n\n4.11 Boxplot for L23E v17.07.63. . . . . . . . . . . . . . . . . . . . . . . . . . . . 68\n\n4.12 Boxplot for L32E v17.12.64. . . . . . . . . . . . . . . . . . . . . . . . . . . . 70\n\n4.13 Boxplot for L32E v20.13.81. . . . . . . . . . . . . . . . . . . . . . . . . . . . 71\n\n4.14 Process to Distinguish Internet-facing ICS Devices (Black boxes contain\n\nredacted information). . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 74\n\n4.15 Registered User Details view for an ICS device cataloged by Shodan (IP\n\naddresses redacted). . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 75\n\n4.16 Sector/Industrial Category Distribution of Process Control Devices. . . . . . . 78\n\nB.1 Boxplot for L61 v16.56.47. . . . . . . . . . . . . . . . . . . . . . . . . . . . . 88\n\nB.2 Boxplot for L61 v19.11.56. . . . . . . . . . . . . . . . . . . . . . . . . . . . . 89\n\nB.3 Boxplot for L61 v20.11.59. . . . . . . . . . . . . . . . . . . . . . . . . . . . . 89\n\nB.4 Boxplot for L71 v20.11.59. . . . . . . . . . . . . . . . . . . . . . . . . . . . . 90\n\nB.5 Boxplot for L71 v20.12.79. . . . . . . . . . . . . . . . . . . . . . . . . . . . . 90\n\nB.6 Boxplot for L71 v20.13.81. . . . . . . . . . . . . . . . . . . . . . . . . . . . . 91\n\nB.7 Boxplot for L23E v17.7.63. . . . . . . . . . . . . . . . . . . . . . . . . . . . . 91\n\nB.8 Boxplot for L23E v18.12.57. . . . . . . . . . . . . . . . . . . . . . . . . . . . 92\n\nxi\n\n\n-----\n\nFigure Page\n\nB.9 Boxplot for L23E v19.11.16. . . . . . . . . . . . . . . . . . . . . . . . . . . . 92\n\nB.10 Boxplot for L32E v16.23.15. . . . . . . . . . . . . . . . . . . . . . . . . . . . 93\n\nB.11 Boxplot for L32E v17.12.64. . . . . . . . . . . . . . . . . . . . . . . . . . . . 93\n\nB.12 Boxplot for L32E v20.13.81. . . . . . . . . . . . . . . . . . . . . . . . . . . . 94\n\nxii\n\n\n-----\n\n**List of Tables**\n\nTable Page\n\n2.1 Ports and services indexed by Shodan [4]. . . . . . . . . . . . . . . . . . . . . 23\n\n3.1 Firmware Versions used in performance analysis testing. . . . . . . . . . . . . 45\n\n3.2 Listing of Experiment Runs for the 1756-L61 CPU. . . . . . . . . . . . . . . . 47\n\n4.1 Data Type Values found in Attribute 2 CIP Instance Responses. . . . . . . . . . 58\n\n4.2 L61 Baseline vs. Treatment p-values (Bold indicates slower execution time). . . 66\n\n4.3 L71 Baseline vs. Treatment p-values (Bold indicates slower execution time). . . 67\n\n4.4 L23E Baseline vs. Treatment p-values (Bold indicates slower execution time). . 69\n\n4.5 L32E Baseline vs. Treatment p-values (Bold indicates slower execution time). . 72\n\nxiii\n\n\n-----\n\n**List of Acronyms**\n\nAcronym Definition\n\nNIST National Institute of Standards and Technology\n\nICS Industrial Control System\n\nSCADA Supervisory Control and Data Acquisition Systems\n\nDCS Distributed Control Systems\n\nPLC Programmable Logic Controllers\n\nIP Internet Protocol\n\nSHINE SHodan INtelligence Extraction\n\nCIP Common Industry Protocol\n\nICS-CERT Industrial Control System - Computer Emergency Response Team\n\nASCII American Standard Code for Information Interchange\n\nIEC International Electrotechnical Commission\n\nI/O Input/Output\n\nHTTP Hypertext Transfer Protocol\n\nCPU Central Processing Unit\n\nCIP Common Industrial Protocol\n\nEtherNet/IP Ethernet / Industrial Protocol\n\nOSI Open Systems Interconnection\n\nTCP Transmission Control Protocol\n\nTCP/IP Transmission Control Protocol/Internet Protocol\n\nUDP User Datagram Protocol\n\nSHINE Shodan Intelligence Extraction\n\nS4 SCADA Security Scientific Symposium\n\nSSH Secure Shell\n\nxiv\n\n\n-----\n\nAcronym Definition\n\nCIA Central Intelligence Agency\n\nFBI Federal Bureau of Investigation\n\nDoD Department of Defense\n\nNAT/PAT Network Address Translation or Port Address Translation\n\nxv\n\n\n-----\n\n# T\n\n\nDISTINGUISHING INTERNET-FACING ICS DEVICES USING PLC\n\nPROGRAMMING INFORMATION\n\n**I.** **Introduction**\n\nhe Shodan search engine maintains a database of devices connected to the Internet. It\n\nworks by indexing the response messages for a variety of protocols for each public\n\n\nInternet address. While there have been many reports in the press that Shodan increases risk\n\nto Critical Infrastructure [22], no recent research has attempted to distinguish the Industrial\n\nControl System (ICS) that Shodan indexes. This research examines a non-invasive method\n\nto distinguish ICS devices based on Programmable Logic Controllers (PLC) programming\n\ninformation. Allen-Bradley RSLogix 5000 PLCs use tags in PLC code to label variables.\n\nThese tags can be obtained by sending Common Industrial Protocol (CIP) requests for\n\ncode attributes and parsing the results. This research demonstrates the ability to use\n\ntags to distinguish ICS devices indexed by Shodan based on function, and using industry\n\nexperts, further distinguish those devices by industrial sector. This chapter describes the\n\nproblem statement, scope, and methodology used to determine the metrics and methods\n\nrequired to obtain the necessary information from Internet-facing ICS devices that permits a\n\nclassification based on function. This chapter concludes with an overview of the subsequent\n\nchapters included in this thesis.\n\n**1.1** **Problem Statement**\n\nThe National Institute of Standards and Technology (NIST) has published regulations\n\nregarding the safe and secure implementation of ICS networks [20]. In the NIST guidelines,\n\nit is clear that no ICS devices should be connected to the Internet, either by means of a\n\n1\n\n\n-----\n\npublic Internet Protocol (IP) address or by forwarding public address space to a private\n\naddress using Network Address Translation or Port Address Translation (NAT/PAT). Many\n\nindustry experts have developed a false sense of security, believing their networks are safe\n\nfrom attack because they are not connected to the Internet [22]. However, Shodan has\n\ndemonstrated that ICS devices are, in fact, connected to the Internet. Recent research\n\nhas sought to enumerate ICS devices indexed by Shodan, and the results show Shodan\n\ncontinues to index more ICS devices as time continues [22]. To date, no research has been\n\nconducted that attempts to determine the function of those Internet-facing ICS devices. The\n\ngoal of this research is to distinguish Internet-facing ICS devices indexed by Shodan.\n\nTo accomplish the research goal, data collection methods are tested in a controlled\n\nenvironment to ensure that Internet-facing ICS devices are not interrupted by the collection\n\nprocess. Reverse engineering techniques are used to write scripts in the Python language\n\nthat craft application layer request messages for each PLC. The responses to those requests\n\ncontain PLC code that contains Task, Program, Routing and Tag names along with tag data\n\ntypes. Next, testing on four different Allen-Bradley PLC Central Processing Units (CPUs)\n\nis conducted to measure PLC performance during the request/response process. Finally,\n\nthe PLC code is visually inspected for process control terms to indicate if an ICS device\n\nis used to control a process. The results of this inspection are ICS devices classified as\n\nProcess Control or Indeterminate.\n\n**1.2** **Scope, Assumptions and Limitations**\n\nThe scope of this research is limited in the type of ICS device tested and data sets\n\navailable for analysis. This research builds on recent work using Allen-Bradley PLCs to\n\ndetect changes to PLC code execution times and to detect changes in interaction with a\n\nPLC after it is indexed by Shodan. For this reason, a Shodan search query is used to obtain\n\na pool of Allen-Bradley CompactLogix and ControlLogix family PLCs. From this device\n\n2\n\n\n-----\n\npool, controlled testing is conducted on four different Allen-Bradley CPUs: 1756-L61,\n\n1756-L71, 1769-L23E, and 1769-L32E.\n\nThe implementation of this research collects PLC code from Allen-Bradley PLCs that\n\nare connected to the Internet. The results from those collections are analyzed individually.\n\nThis research does not attempt to look at similarities in PLC code among the sample\n\npopulation or look at contiguous IP space in order to identify systems of systems.\n\nA set of municipal wastewater PLC project files are used for static analysis, providing\n\na set of Program, Routine, and Tag data representing PLCs currently in use in Critical\n\nInfrastructure. These project files are from one small geographic area within the United\n\nStates and from one Critical Infrastructure sector, and therefore not representative of a\n\nlarger population.\n\nLimitations to this research effect the types of Allen-Bradley PLCs available for testing\n\nand the data available for static analysis of PLC code. Allen-Bradley RSLogix5000 PLCs\n\nare used in this research as the RSLogix500 PLCs such as the MicroLogix family do not\n\nuse tags to handle PLC code variables. Static analysis is also impacted by the small,\n\ngeographically localized set of available PLC project files.\n\n**1.3** **Approach**\n\nCollecting PLC code form Internet-facing ICS devices must not impact the device’s\n\noperation. Impact is defined as a statistically significant increase in task execution time.\n\nExperimentation on ICS devices in a controlled environment provides the means to develop\n\nnon-invasive data collection methods and measure performance metrics to determine\n\nimpacts those collection methods have on ICS devices. The goal of this research is to\n\ndistinguish Internet-facing ICS devices based on PLC programming information. This\n\nresearch accomplishes this goal by obtaining a list of Internet-facing ICS devices, collecting\n\nPLC code, and classifying devices by matching process control terms with the names used\n\nby ICS engineers to write PLC code.\n\n3\n\n\n-----\n\nThe Shodan search engine indexes devices in the same manner that Google indexes\n\nweb pages. Shodan requests service information for a specific IP and port, and indexes the\n\nresponse message. Carefully crafted Shodan search queries are used to obtain IP addresses\n\nfor devices with matching service response messages. This is the method this research uses\n\nto obtain a list of Allen-Bradley PLCs indexed by Shodan.\n\nCollecting PLC code from ICS devices makes use of CIP Get Attribute List messages\n\nthat return Task, Program, and Routine names along with names and data types for Global\n\nand Program-specific tags. The RSLogix5000 software uploads PLC code from the device\n\nby making several CIP requests for class and instance values for Task, Program, Routime,\n\nand Tag values. Reverse engineering these requests using Wireshark captures, it is possible\n\nto create CIP requests replicating certain parts of the upload process, obtaining PLC code\n\nwithout using RSLogix5000. Once pilot testing confirms that the Python scripts are\n\nable to collect PLC code from an ICS device, testing is conducted measuring the task\n\nand system process execution times to ensure ICS device performance is not negatively\n\nimpacted. During this testing, four different PLC CPUs are tested, each with three firmware\n\nversions. The firmware versions are selected according to firmware versions obtained\n\nduring exploratory testing. For each CPU, it is tested with three firmware versions ranging\n\nfrom oldest to newest found on Internet-facing devices. Once PLC code is collected, each\n\nresponse is categorized based on attributes found in the PLC code.\n\nFinally, a visual inspection of the PLC code collected from Internet-facing PLCs is\n\nconducted to match the names of Tasks, Programs, Routines, and Tags with a list of process\n\ncontrol terms common across multiple Critical Infrastructure sectors.\n\n**1.4** **Overview of Subsequent Chapters**\n\nThe remainder of this thesis describes in detail the background, testing, and results\n\nof distinguishing Internet-facing ICS devices indexed by Shodan. Chapter 2 discusses\n\nthe types of ICS devices and networks in use today along with the relevant research into\n\n4\n\n\n-----\n\nShodan and Internet-facing ICS devices. Chapter 3 details the methodology used to develop\n\nmethods to obain data from Internet-facing ICS devices, ensuring PLC task execution is\n\nnot negatively impacted. Chapter 4 describes the results of testing and implementing the\n\nresearch methodology. Finally, Chapter 5 states the research conclusions and future work\n\nthat can be conducted to further classify Internet-facing ICS devices.\n\n5\n\n\n-----\n\n**II.** **Background**\n\nndustrial control systems (ICS) are used by corporations and municipalities to operate\n\nand maintain critical infrastructure providing essential services such as electric power\n\n# I\n\ndistribution and wastewater management [20]. ICS systems operate by means of an\n\ninterconnected network of devices to make automated and human assisted decisions\n\naffecting the operation of attached mechanical actuators and sensors. Despite governmental\n\nand industry efforts to standardize secure ICS implementations, compliance with security\n\nrecommendations and industry best practices like those cited in the National Institute of\n\nStandards and Tehcnology (NIST) Guide to Industrial Control Systems are still voluntary\n\n[20]. The critcal nature of these systems combined with a lack of security focus make ICS\n\nnetworks interesting and vulnerable targets for attackers.\n\nSecurity managers believe segregating their ICS networks from the Internet provided\n\na sufficient level of security [22]. In 2009, however, the Shodan search engine showed\n\nthat against NIST security guidelines, ICS devices are in fact connected to the Internet.\n\nThe Shodan search engine indexes these devices and provides a reconnaissance platform to\n\npassively identify ICS devices.\n\nRecent research has shed new light on the ICS attack surface by indexing and\n\ncataloging ICS devices connected to Internet-facing IP addresses [19][22]. The purpose\n\nof this chapter is to define the components and methods used to implement ICS systems\n\nand also review current research demonstrating ways and means to interact with Internet\nfacing ICS devices.\n\nSection 2.1 describes in detail the hardware, software, and communications networks\n\nthat make up Industrial Control Systems. Section 2.2 discusses the Shodan search engine\n\nand recent research focusing on enumerating ICS devices indexed by Shodan. Section 2.3\n\ndescribes the risks posed to ICS networks by attackers and provides examples of recent\n\n6\n\n\n-----\n\nattacks on Critical Infrastructure. Finally, section 2.4 covers recent research methods to\n\nmeasure CPU performance in ICS devices under test.\n\n**2.1** **Critical Infrastructure and Industrial Control Systems**\n\nThe Department of Homeland Security (DHS) defines Critical Infrastructure as the\n\n“assets, systems, and networks, whether physical or virtual, so vital to the United\n\nStates that their incapacitation or destruction would have a debilitating effect on security,\n\nnational economic security, national public health or safety, or any combination thereof.”\n\nDHS assumes the responsibility of protecting what it calls Critical Infrastructure and\n\nKey Resources (CIKR) [8][9]. DHS divides CIKR into 16 different sectors divided by\n\nfunctionality: financial, chemical, commercial, communications, manufacturing, dams,\n\ndefense industrial base, education, emergency services, energy, food and agriculture,\n\nhealthcare, national monuments and icons, nuclear reactors and materials, transportation,\n\nand water.\n\nIndustrial Control Systems can be divided into three components as shown in Figure\n\n2.1: Human-Machine Interface (HMI), Remote Diagnostics and Maintenance Utilities, and\n\nthe Control Loop consisting of Controllers, Actuators, Sensors, and a Controlled Process\n\n[20].\n\nThe control loop refers to the sensors, transmission methods, and controllers\n\nthat operate at the lowest level of the ICS. Controllers such as Programmable Logic\n\nControllers (PLCs) receive information from sensors and make decisions based on set\n\npoints programmed into the PLC. For example, a PLC receives a specific voltage level\n\nfrom a temperature sensor and, based on that information, causes an actuator to open a\n\ncooling valve. The PLC also sends information to an HMI and a data historian for human\n\nobservation and logging. HMIs are the devices that monitor and display information for a\n\nICS which allows a central control room staffed by human operators to monitor data and\n\n7\n\n\n-----\n\nFigure 2.1: ICS Operation Function Blocks [20].\n\nconfigure the PLC’s parameters when required. Remote maintenance systems are used in\n\nICS for preventing and recovering from equipment failures.\n\n**_2.1.1_** **_SCADA network architectures._**\n\nThere are many different network topologies that support Supervisory Control and\n\nData Acquisition Systems (SCADA) software and hardware design. This research will\n\nfocus on an architecture using IP-based communications protocols and replicates SCADA\n\narchitectures recommended by industry and governmental agencies.\n\nFigure 2.2 is just one example of a SCADA architecture that generalizes how SCADA\n\ncontrol and communications devices are interconnected to form a SCADA network [1]. The\n\ncommon components in any SCADA architecture are the topology, transmission systems,\n\nand control components.\n\n8\n\n\n-----\n\nFigure 2.2: Example SCADA Architecture [1].\n\nThere are varying terminologies used to describe a SCADA topology which are\n\ndepicted in Figure 2.3. The NIST Guide to ICS Security provides an example of four\n\nSCADA topologies: point to point, series, series-star, and multi-drop [20]. Point-to-point\n\ntopologies typically use serial communications instead of the IP-based communications\n\nfocused on in this research. Series, series-star, and multi-drop are used to network multiple\n\nfield devices on a shared medium with the SCADA server.\n\nRockwell Collins defines their topologies as point to point and point to multipoint\n\n(multi-drop). Rockwell Collins identifies point to multipoint as the main topology used in\n\nSCADA networks. The multipoint (multidrop) topology connects several field devices to a\n\nSCADA server through a central hub. The entire SCADA system is interconnected through\n\nIP-based Local Area Network (LAN) and Wide Area Network (WAN) links creating the\n\n9\n\n\n-----\n\nFigure 2.3: NIST SCADA Communication Topologies [20].\n\nfinal design architecture as depicted in the NIST Guide to ICS Security shown in Figure\n\n2.4.\n\nSCADA architectures use a variety of transmission systems to connect the control\n\ncenter to field sites. These connections can be accomplished using serial connections,\n\nmodem connections, WAN and LAN shared media connections, or wireless radio. Electric\n\npower distribution SCADA systems are geographically disperse and often utilize many\n\ndifferent transmission methods such as Ethernet, dial-up/leased line serial connections,\n\nwireless IP and wireless radio [1]. Each of these systems use appropriate transmission\n\nprotocols such as Modbus/TCP and DNP3 to format and send data over the transmission\n\n10\n\n\n-----\n\nFigure 2.4: NIST Guide to ICS Security SCADA System Implementation Example [20].\n\nmedium used in a SCADA topology. The control components used in a SCADA system use\n\nthe topology design and transmission medium to send and receive data within a network.\n\n**_2.1.2_** **_ICS Components._**\n\nICSs are typically categorized as SCADA or Distributed Control Systems (DCS) based\n\non their topology and purpose. SCADA systems are geographically dispersed systems\n\nwith numerous field sites sending data to a central data historian, while DCS systems\n\nare normally configured to operate within a confined plant-centric area [20]. In SCADA\n\nsystems, control devices such as PLCs are primarily used to supervise and monitor the state\n\nof an attached physical device, where PLCs in DCS systems typically control systems that\n\nexecute mechanical operations.\n\n11\n\n\n-----\n\nSCADA components are separated into the control components and network\n\ncomponents. These components allow SCADA systems to exchange real-time data\n\nbetween a centralized control center and field devices [18]. The control station is normally\n\npopulated with any combination of control servers, Master Terminal Units (MTU), Human\nMachine Interfaces (HMI), data historians, and Input/Output Servers [20]. The control\n\nserver, Input/Output (I/O) server, MTU, and HMI can be separate systems or consolidated\n\nin a few physical devices. They make up the means for operators in the control center\n\nto monitor and remotely configure field devices. The HMI is comprised of software and\n\nhardware that allows operators to view the status of field devices, make changes to set\n\npoints or algorithms, and override the commands of field devices when necessary. The\n\n_Control Server hosts the control software that communicates with field devices, the I/O_\n\n_Server provides a method to communicate with field devices, and the MTU works with field_\n\ndevices in a master/slave configuration to implement changes made at the control center.\n\nThe Data Historian is a centralized database server that logs all process information within\n\nthe SCADA system for auditing, data analysis, and future planning.\n\nThese ICS field devices communicate with the control center and are responsible\n\nfor monitoring and executing instructions based on their configured algorithms and set\n\npoints. The PLC is a versatile control module that can be populated with special purpose\n\nmodules to carry out a wide range of tasks. The PLC has the capability to logically control\n\ncomplex tasks by receiving feedback from an attached sensor and make decisions based on\n\nits programmed algorithm to maintain or change the state of an attached physical device.\n\nPLCs used in SCADA systems are the most versatile and configurable of the field\n\ndevices, capable of performing all supervisory control and data acquisition functions as\n\nother field devices [20]. Kalapatapu [18] describes how an RTU’s use of communication\n\nprotocols over wireless transmission systems is similar to PLC communications over\n\nwire medium using the same protocols. Siemens and Rockwell Collins are two of the\n\n12\n\n\n-----\n\nlargest manufacturers of PLCs, with the Germany-based Siemens focusing on European\n\nmarkets and Rockwell Collins being the largest manufacturer based in the United States\n\n[30]. Rockwell Collins manufactures Allen-Bradley PLCs which are represented in nearly\n\nevery Critical Infrastructure sector and have a 30 percent share of the North American\n\nelectrical utilities market. The Allen-Bradley Logix 5000 series PLCs consist of a power\n\nsupply, communications backplane, and 1756-A7 chassis with up to 7 slots for add-on\n\nmodules. The PLC uses ARM processors for control and backplane communications.\n\nThe control module houses the processors, memory, slot for flash memory and an RS\n232 communications port. The remaining slots in the PLC are populated with I/O modules\n\nbased on specific tasks the PLC is required to perform. Examples of these modules are\n\nanalog and DC input modules used to read voltage levels from sensors which the PLC then\n\nconverts into digital information used as input in execution of a task.\n\nFigure 2.5: Allen-Bradley ControlLogix PLC Architecture [25].\n\n13\n\n\n-----\n\n**_2.1.3_** **_Allen-Bradley Industrial Control Systems._**\n\nThe Allen-Bradley ControlLogix family of PLCs shown in Figure 2.5 consists of a\n\nchassis, controller, communications module, and a number of optional modules providing\n\nadditional functionality such as I/O [25]. The standard controllers for ControlLogix PLCs\n\nare the L6x and L7x series. These controllers can be populated in any chassis slot, and\n\nmultiple controllers can be installed and operate simultaneously in a ControlLogix chassis.\n\nThe primary difference between the L6x and L7x controllers is the built-in communications\n\narchitecture. The L6x controller provides an RS-232 serial communications capability\n\nwhile the L7x controller has a built-in USB port. Allen-Bradley varies the amount of user\n\nmemory within each series from 2MB on the L61 controller to 32MB on the L65 controller.\n\nBoth controllers are used to execute PLC code and communicates with additional modules\n\nvia the ControlLogix chassis backplane.\n\nEthernet / Industrial Protocol (EtherNet/IP) describes the Ethernet Industrial Protocol\n\nused by Allen-Bradley for PLC real-time messaging and I/O communications over IP\nbased networks as shown in Figure 2.6 [25]. The EtherNet/IP modules available for use\n\nin Allen-Bradley PLCs include an integrated web server that provides device configuration\n\nand communications data. Allen-Bradley recommends using the communications statistics\n\nprovided by a Diagnostic Web Page shown in Figure 2.7. The web page is hosted by the\n\nEtherNet/IP module and is provided for troubleshooting PLC communication issues. The\n\nstatistics provide a means to obtain current device state and communication capabilities by\n\nmeans of making a Hypertext Transfer Protocol (HTTP) GET request to the device’s IP\n\naddress.\n\nThe CompactLogix family of PLCs shown in Figure 2.8 provides a compact,\n\nintegrated PLC solution that uses the same RSLogix common programming platform as\n\nthe ControlLogix family [27]. The CompactLogix platform is built around an integrated\n\n14\n\n\n-----\n\nFigure 2.6: Allen-Bradley EtherNet/IP Architecture [25].\n\nbackplane, CPU, and communications module providing control and communications\n\nservices for a range of I/O options. The 1769-L23x series provides embedded I/O functions\n\nin the device and limited expansion options. The 1769-L3x series increases options for\n\nonboard user memory and increases the number of possible add-on modules. Both use\n\nintegrated serial communications or EtherNet/IP for communications with other devices or\n\nthe RSLogix control software.\n\n15\n\n\n-----\n\nFigure 2.7: EtherNet/IP Module Web Server.\n\nPLCs are programmed using one of the languages listed in the International\n\nElectrotechnical Commission (IEC) published standard IEC 61131-3. This standard\n\ndescribes the graphical and text-based programming languages which are used to provide\n\nlogical decision-making for programmable controllers [20]. The Allen-Bradley Logix\n\n5000 series PLCs conform to the IEC 61131-3 standard and uses a proprietary Studio\n\n5000 Engineering and Design Environment to facilitate graphical program design and\n\nimplementation [26].\n\nRSLogix 5000 is a software application from Allen-Bradley that provides program\nming, control, and troubleshooting services for their PLCs [24]. RSLogix 5000 provides\n\na graphical interface to build and monitor ladder logic, which is a type of PLC code sup\nported by Allen-Bradley PLCs. RSLogix 5000 uses tags as variables within ladder logic.\n\nTags can be thought of as any other programming variable, having assigned names and data\n\n16\n\n\n-----\n\nFigure 2.8: Allen-Bradley CompactLogix PLC Architecture [27].\n\ntypes. Ladder logic instructions can use tags to make decisions, such as monitoring a tag\n\nas a setpoint.\n\nRSLogix 5000 also provides real-time monitoring for ladder logic execution, and\n\nprovides a suite of tools useful for troubleshooting [23]. RSLogix Task Monitor shown\n\nin Figure 2.9 which monitors and logs the PLC state during ladder logic execution. Task\n\nMonitor tracks operating statistics such as CPU Utilization and ladder logic execution\n\ntimes. Task Monitor collects data from the PLC by sending requests for execution times\n\nto the PLC at a user-defined interval. The PLC returns in microseconds the execution\n\ntimes for system processes and all tasks executing in ladder logic. This allows Task\n\nMonitor to calculate CPU Utilization and track the load on system services, such as the\n\ncommunications service.\n\n17\n\n\n-----\n\nFigure 2.9: RSLogix Task Monitor.\n\nThe PLC firmware is the layer between logic and PLC hardware that implements\n\nlogical operations in PLC code on the PLC itself. Allen-Bradley provides a support site\n\nwhere firmware feature sets and compatibility can be checked as in Figure 2.10, and\n\nfirmware can be downloaded once an e-mail address is registered with Allen-Bradley\n\nthrough an online sign-up page.\n\n18\n\n\n-----\n\nFigure 2.10: Allen-Bradley Firmware Feature Comparison.\n\n**_2.1.4_** **_ICS Protocols._**\n\nA PLC makes decisions and executes code once all appropriate modules, firmware,\n\nand PLC code is loaded and configured. During operation, PLCs need to communicate\n\nto other field devices and HMIs for real-time information reporting and control. ICS\n\nprotocols such as EtherNet/IP and CIP allow PLCs to communicate using an industry\n\nstandard protocol which allows PLCs to communicate over any Transmission Control\n\nProtocol/Internet Protocol (TCP/IP) network.\n\nCIP is an open industry standard application layer protocol managed by ODVA, Inc.\n\nthat allows PLCs to communicate using a variety of ICS networking technologies such as\n\nDeviceNet, ControlNet, CompoNet, and EtherNet/IP [31]. CIP uses a producer-consumer\n\nmodel which allows PLCs to publish tag data and attributes to multiple consumers. CIP\n\nidentifies messages by Connection IDs instead of source/destination address which allows\n\nmultiple devices to make a single request for a Connection ID. Attribute messages are\n\npublished for all consumers who have made a request to the Connection ID eliminating the\n\nneed for multiple devices to initiate individual requests for tag attributes [2].\n\n19\n\n\n-----\n\nFigure 2.11 shows a CIP message requesting a list of attributes for an Identity Object\n\nusing class and instance values. Identity Objects are objects with common attributes,\n\nseparated by class [6]. CIP provides some pre-defined public classes along with the ability\n\nto define vendor specific classes in the Class ID range 100-199. An example of an Identity\n\nObject is shown in Figure 2.12.\n\nFigure 2.11: Common Industrial Protocol - Object Oriented Formatting.\n\nEtherNet/IP is an ICS communications protocol operating at layers 1-4 of the Open\n\nSystems Interconnection (OSI) model allowing CIP messages to route over IP networks.\n\nEtherNet/IP at the transport layer segments CIP messages using Transmission Control\n\nProtocol (TCP) or User Datagram Protocol (UDP) protocols based on the CIP message\n\ntype. EtherNet/IP uses TCP for explicit CIP messages such as the Get Attribute List\n\nrequest shown in Figure 2.11 [2]. TCP is a connection-oriented protocol that ensures\n\n20\n\n\n-----\n\nFigure 2.12: Common Industrial Protocol - Identity Object Attributes.\n\ndelivery of the message. EtherNet/IP uses UDP to transmit real-time information such\n\nas I/O messages. UDP is connection-less, but it is faster and smaller than TCP and suitable\n\nfor time-sensitive transmissions. EtherNet/IP also provides a mechanism to establish\n\nconnections between devices through a Connection Manager shown in Figure 2.13 [6]. CIP\n\nconnections define packets that are produced and transmitted over a given network. Explicit\n\nmessaging handles the routine produce and consume messages, assigning Connection IDs\n\nfor produced information and handling the messaging to consumers. Implicit messaging\n\nrefers to the time-sensitive I/O information transmitted via UDP by EtherNet/IP. The\n\nUnconnected Message Manager handles communication requests for routine information\n\nsuch as Identity Object attributes without establishing Connection IDs. This reduces the\n\ncommunications overhead for infrequent or routine requests by eliminating the need to\n\nestablish connections and reserve resources through the Connection Manager.\n\n**2.2** **The Shodan Search Engine**\n\nVice magazine in 2013 published an article called “Is Shodan really the world’s\n\nmost dangerous search engine?” [7]. In 2009, the Shodan search engine was placed into\n\noperation and provided proof that ICS networks around the globe were directly connected\n\nto the Internet by means of PLCs using public-facing IP addresses [13]. Recent research\n\nhas developed techniques to quantify the problem and continues to discover more public\n21\n\n\n-----\n\nFigure 2.13: Common Industrial Protocol Object Model [6].\n\nfacing ICS devices. Much is being done to raise the alarm about the quantity of ICS\n\ndevices connected to the Internet, but not much is being done to determine the function\n\nthose devices perform.\n\nShodan was created by John Matherly in order to map software deployments across the\n\ninternet to assist developers determine what systems were connected to the Internet [17].\n\nThe utility of Shodan became clear to researchers, security experts, and hackers alike [7]\n\nand Shodan became a tool to find all types of hardware and software using public-facing IP\n\naddresses. In 2009, Elian Leverett published his methodology using Shodan to determine\n\nthe IP addresses of over 7,500 public-facing ICS devices.\n\nMatherly started indexing banner messages on a Dell computer in his free time,\n\ncataloging messages at a rate of 10,000 per month [7]. His intent to conduct world\nwide banner grabbing was to allow companies to track deployment of their hardware and\n\n22\n\n\n-----\n\nsoftware. Shodan works by randomly selecting a public IP address, then interrogating a set\n\nof well-known ports for that IP shown in Table 2.1, indexing any banner messages returned.\n\nTable 2.1: Ports and services indexed by Shodan [4].\n\nShodan Port Filters\n\nPort Service Port Service Port Service Port Service\n\n21 FTP 143 IMAP 1900 UPnP 6379 Redis\n\n22 SSH 161 SNMP 2323 Telnet 7777 Oracle\n\n23 Telnet 443 HTTPS 3306 MySQL 8000 Qconn\n\n25 SMTP 445 SMB 3389 RDP 8080 HTTP\n\n53 DNS 465 SMTP 5000 Synology 8129 Snapstream\n\n80 HTTP 623 IPMI 5001 Synology 8443 HTTPS\n\n81 HTTP 993 IMAP + SSL 5432 PostgreSQL 9200 ElasticSearch\n\n110 POP3 995 POP3 + SSL 5560 Oracle 11211 MemCache\n\n119 NNTP 1023 Telnet 5632 PC Anywhere 27017 MongoDB\n\n137 NetBIOS 1434 MS-SQL 5900 VNC 28017 MongoDB Web\n\n“I don’t consider my search engine scary...It’s scary that there are power plants\n\nconnected to the Internet” [17]. Any user can query Shodan’s database and receive up\n\nto 10 results for free. Alternatively, users can register and pay a $20 fee to have access to\n\n10,000 results per search query. Some articles on Matherly have hinted that this provides a\n\nlayer of insulation between Shodan and a black-hat hacker; however, Matherly states in the\n\nVice article that the subscription service allows him to devote more assets to Shodan and\n\nnow indexes “hundreds of millions a month.”\n\nIn 2010, Michael Schearer presented his work “Shodan for Penetration Testers” at\n\nDEFCON 18 [28]. Schearer began his talk by describing methods used to craft search\n\n23\n\n\n-----\n\nqueries and utilize Shodan’s filters to narrow results by port, protocol, service, or even\n\ngeographic location. Schearer educated his audience in the art of using Shodan for network\n\nreconnaissance by finding networking devices with default credentials (or no authentication\n\nat all). Schearer was able to gain the highest access level (level 15) to an Internet Service\n\nProvider’s (ISP) distribution switch and determine sensitive configuration information used\n\nby the ISP.\n\nAt DEFCON 20, Dan Tentler delivered a presentation on Shodan where he showed a\n\ncity’s traffic control system was indexed along with a hydroelectric power plant’s control\n\nsystem [13]. This demonstrates Shodan’s direct and potentially dangerous relationship with\n\nCritical Infrastructure and the ability for anyone to conduct passive reconnaissance on the\n\nICS networks supporting CI.\n\n**_2.2.1_** **_Discovering Indexed ICS Devices._**\n\nIn June 2011, Eireann Leverett completed his research titled “Quantitatively Assessing\n\nand Visualizing Industrial System Attack Surfaces” [19]. Leverett’s motivation was to\n\ndisprove the common assumption that ICS devices were safe from attack because they were\n\nonly connected to internal, private networks. “Vendors say they don’t need to do security\n\ntesting because the systems are never connected to the internet; it’s a very dangerous claim.”\n\n[35]. Leverett crafted 29 Shodan queries in order to identify ICS devices by specific strings\n\ncontained in the banner messages indexed by Shodan shown in Figure 2.14 from Leverett’s\n\nwork.\n\nLeverett’s research produced a tool that visualizes ICS devices by location to show\n\nthat vulnerable Internet-facing ICS devices are connected worldwide. He presented his\n\nfindings to several industry professionals including Industrial Control System - Computer\n\nEmergency Response Team (ICS-CERT), and continues to give talks on ICS categorization\n\nusing Shodan.\n\n24\n\n\n-----\n\nFigure 2.14: Leverett search query results [19].\n\nWhen looking at Leverett’s research in the context of risk to Critical Infrastructure, it\n\nis important to note that Leverett’s research does not categorize ICS devices by function or\n\nindustry sector. This leads some to conclude that the large number of ICS devices indexed\n\nby Shodan can be correlated to an increased risk to Critical Infrastructure. In 2012 during a\n\ntalk at the Digital Bond SCADA Security Scientific Symposium (S4), Dale Peterson raised\n\n25\n\n\n-----\n\na question about determining risk to Critical Infrastructure. Leverett’s response showed\n\nthe lack of research in this area: “Dale may be right here, the amount of truly ‘critical’\n\ninfrastructure is likely to be low in this data set” [21].\n\n**_2.2.2_** **_Project SHINE._**\n\nProject SHINE, the product of Rob Radvanovsky and Jake Brodsky, uses Shodan to\n\ncatalog Internet-facing ICS devices in similar fashion to Leverett’s work [15]. Shodan\n\nIntelligence Extraction (SHINE) began around the same time as Leverett and produced\n\nsimilar results. According to Radvanovsky, SHINE “began ingesting raw data mid\nApril 2012...to determine a baseline of just how many SCADA/ICS devices and software\n\nproducts are directly connected to the Internet” [22].\n\nWhere Leverett developed his thesis in an academic environment, the security\n\nprofessionals behind Project SHINE do not share Leverett’s openness or willingness to\n\nshare results. Radvanovsky states Project SHINE has categorized a list of over 1,000,000\n\nunique IP addresses appearing to belong to SCADA/ICS devices and typically finds an\n\nadditional 2,000-8,000 per day. He stated this in September 2013, implying he has\n\ndiscovered another half-million devices. Radvanovsky says SHINE is able to find such\n\na large number of devices using “just shy of 700 searchable terms and (we) are adding\n\nmore every week” [22].\n\nRadvanovsky continues to collect data on Internet-facing ICS devices, and has stated\n\nthat they “intend to perform our own...scans...through a new (undisclosed) method in the\n\nnot-too-distant-future” [22]. A motive behind Radvanovsky’s secrecy may be financial;\n\n“we may make available SHINE data to be used as part of a compliance service for asset\n\nowners, but we are struggling with an appropriate business model” [22].\n\n**2.3** **Security Concerns and ICS Attacks**\n\nRecent events highlight the significant capabilities of state and non-state actors to\n\ncarry out attacks on Critical Infrastructure. Stuxnet is a widely known example of malware\n\n26\n\n\n-----\n\ncreating devastating physical effects. Stuxnet modified PLC code on a Siemens device\n\nand reports false information to the Siemens control software in an effort to mask the new\n\nPLC code that damages the targeted nuclear centrifuges [11]. Stuxnet is remarkable in\n\nthe complexity of the code and the way it seeks out a very specific target. The Stuxnet\n\ndevelopers have never been discovered. However, it is generally accepted to be part of a\n\nUS program to intervene in the Iranian Nuclear program.\n\nTo demonstrate the desire to attack critical infrastructure using cyber exploits, an\n\nexample emerged three decades before Stuxnet in the Trans-Siberian Pipeline [32]. The\n\nCentral Intelligence Agency (CIA) used Soviet officer Colonel Vladimir I. Vetrov to\n\nfacilitate a known Soviet plot to use a shadow company to illegally obtain banned\n\ntechnology. The CIA, Department of Defense (DoD), and Federal Bureau of Investigation\n\n(FBI) conducted an undercover operation which sold modified equipment to the Soviets\n\nthrough their shadow company. According to the CIA’s report on The Farewell Dossier,\n\n“Contrived computer chips found their way into Soviet military equipment, flawed turbines\n\nwere installed on a gas pipeline, and defective plans disrupted the output of chemical\n\nplants and a tractor factory” [32]. The resulting sale of sabotaged devices is believed to\n\nhave caused an explosion on the Trans-Siberian pipeline in 1982. While some dispute the\n\nexplosion was caused by CIA actions, it is a clear demonstration of an intent to carry out\n\ncyber attacks on critical infrastructure dating back thirty years.\n\nThe Darkreading.com IT security news portal has reported several recent exploits\n\nand attacks focusing on ICS devices and networks. In 2012, Kelly Higgins reported on\n\nbackdoor exploits that target Siemens PLCs allowing the capture of passwords and ability\n\nto manipulate PLC code [14]. The same article described the addition of ICS exploits into\n\nthe Metaspoit Framework and an electric utility that had experienced unsuccessful brute\n\nforce logon attempts through the Secure Shell (SSH) service.\n\n27\n\n\n-----\n\nHiggins has written several articles highlighting recent attacks on the Oil and Gas\n\nsector. In 2012, the Saudi Aramco oil and natural gas company had 30,000 computers on\n\ntheir corporate network infected and damaged by a piece of malware called Shamoon [3].\n\nShamoon is a version of W32.Disttrack destructive malware that writes over the Master\n\nBoot Records of hard drives, rendering the machine inoperable.\n\nIn 2014, Higgins wrote about a group called STTEAM using a “mix of hacktivist,\n\nnation-state, and pure cybercrime techniques” against oil and gas companies in the Middle\n\nEast [16]. The STTEAM attacks show an increased sophistication from the Shamoon\n\nmalware. Shamoon seemed to be poorly written and was able to be quickly removed\n\nfrom the Saudi Aramco network by replacing all 30,000 hard drives. STTEAM shows\n\nan intent to become a persistent threat to the systems they attack by using several powerful\n\nASP backdoor scripts to allow attackers entry into the target network and remotely execute\n\ncommands [12].\n\nThese recent attacks demonstrate the advanced capabilities available to exploit and\n\nattack critical infrastructure. This section has shown examples of a desire to attack critical\n\ninfrastructure and increased exploits to carry out attacks. Shodan provides those with a\n\ndesire to attack critical infrastructure an advanced reconnaissance capability to discover and\n\ncollect targeting information on Internet-facing ICS devices. Since Leverett’s work in 2011,\n\nthe number of Internet-facing devices indexed in his work has risen as shown in Figure 2.15\n\n[19]. Along with the devices discovered by Leverett’s search terms, more specific terms\n\nare able to discover a larger number of Internet-facing ICS devices, all without having to\n\ninterrogate the target devices directly.\n\n**_2.3.1_** **_TrendMicro Reports on ICS Attakers._**\n\nIn 2013, SCADA security researcher Kyle Wilhoit published two papers with\n\nTrendMicro titled ‘Whos Really Attacking Your ICS Equipment?’ [33] and ‘The SCADA\n\nThat Didnt Cry Wolf. Whos Really Attacking Your ICS Equipment? (Part 2)’ [34]. In the\n\n28\n\n\n-----\n\nFigure 2.15: Comparison of Leverett search query results obtained in 2011 and 2013 [5].\n\nfirst publication, Wilhoit describes his effort to identify SCADA attacks though the use of\n\nInternet-facing SCADA honeypots. Wilhoit used an actual PLC, PLC software running on\n\nAmazon Cloud, and a web server mimicking an ICS web server, all on different static IPs\n\nregistered in the United States. Wilhoit provided a definition of threat in the paper:\n\n29\n\n\n-----\n\n‘We define an attack as anything that may be deemed a threat to Internet\nfacing ICS/SCADA systems. This includes unauthorized access to secure areas\n\nof sites, modifications on perceived controllers, or any attack against a protocol\n\nspecific to ICS/SCADA devices like Modbus. In addition to classifying these\n\nattempts as attacks, we also consider any attempt to gain access or cause an\n\nincident to the server in a targeted fashion attacks [34].’\n\nIn 28 days, the honeypots Wilhoit identified 39 attacks 12 of which Wilhoit described as\n\ntargeted.\n\nWilhoit’s second paper revisited the honeypot configuration. He developed a more\n\nrobust honeypot architecture that closely replicated an actual SCADA system, including\n\nModbus modules, PLCs, HMIs and other ICS systems. Wilhoit deployed 12 honeypots\n\nworldwide across 8 countries, taking care to use local language to make each deployment\n\nmore realistic. In a four month period, Wilhoit’s honeynet saw 74 attacks, 10 of which\n\nWilhoit classified as critical. Six of those critical atacks triggered Snort IDS signatures\n\ndeveloped by DigitalBond to monitor unauthorized Modbus traffic.\n\nWilhoit’s research does not fully explain the nature of reported ICS attacks. Many of\n\nthe generic attacks seen by Wilhoit were not targeting ICS field devices, but instead were\n\ntargeting workstations used as HMIs. He did not describe what critical attacks are or if\n\nthey were successful. In his second paper, he gives only one example of a targeted attack\n\ndiscovered during his earlier research. The targeted attack was a phishing attempt against\n\nan e-mail address found on an ICS honeypot. The phishing attempt targeted the Windows\n\ncomputer, not the ICS device and was designed to exfiltrate data if successful. Wilhoit\n\ncalled it a targeted ICS attack because it targeted an email address found on his honeypot,\n\nbut he does not detail how attackers could only have found this email address by targeting\n\nhis honeypot.\n\n30\n\n\n-----\n\n**_2.3.2_** **_Shodan Impacts on ICS devices Pre/Post Indexing._**\n\nThe 2014 research conducted by Roland Bodenheim sought to determine Shodan’s\n\nimpact on ICS devices by measuring the change in network activity on an ICS honeypot\n\nafter it was indexed by Shodan [5]. His research used TCP connections, TCP packet\n\ncount, and number of unique IPs interacting with the device as metrics to quantify a\n\nchange in network activity. His research also focused on detecting targeted attacks against\n\nShodan indexed ICS devices by inspecting traffic at the honeypots against known ICS attack\n\nsignatures.\n\nBodenheim deployed a honeynet consisting of four Allen-Bradley PLCs using Internet\nfacing IP addresses. Two of the devices were configured with default authentication settings\n\nto mimic newly deployed devices, while the other two PLCs were configured to modify the\n\nservice banner responses to Shodan requests. One of the modified banners replaced the\n\nstring ‘Server: GoAhead-Webs’ with a random string to avoid detection, and the other\n\nmodified banner had the original string replaced with ‘Allen Bradley ControlLogix 1756’\n\nin an attempt to make it easier to detect using a targeted Shodan search query. All four\n\ndevices were loaded with ladder logic and deployed for 55 days at the site of an ICS inte\ngrator.\n\nThe first of the honeypots was indexed by Shodan after 3 days with all four honeypots\n\nindexed by Shodan within 13 days. Bodenheim showed that linear trending and ‘goodness\n\nof fit’ testing on network activity showed no evidence of any change to network activity\n\nafter a device is indexed by Shodan. In fact, a comparison of mean averages for network\n\nactivity metrics were all either below the 95% confidence interval, or could be attributed to\n\nan increase in automated network scans not specifically targeting the ICS honeypots. This\n\nindicated a lack of any statistical signifigance to the changes observed in network activity\n\npre and post indexing.\n\n31\n\n\n-----\n\nBodenheim used the Snort Intrusion Detection System (IDS) to check for targeted\n\nattacks matching Snort and DigitalBond Quickdraw SCADA signatures specific to ICS\n\nprotocols. During the 55 day period, Snort identified only one high alert against one of the\n\nfour honeypots. The alert was found to be an indiscriminate scan for PHP vulnerabilities, a\n\nservice not used on the Allen-Bradley web server. While all four devices registered Snort\n\nalerts, it was found that none of the alerts were ICS specific, and results from the Snort IDS\n\nindicated that the activity was related to indiscriminate scans across public IP space, not\n\ntargeted attacks associated with Shodan indexing.\n\nWilhoit saw scanning, generic attacks, and a small number of Modbus-specific IDS\n\nsignature matches. Bodenheim saw no attacks on his PLCs even though his devices were\n\nexposed for the same duration as Wilhoit’s first honeypots, attracting 39 attacks.\n\nWhile no attacks to date have been directly attributed to Shodan searches, its existence\n\ndoes provide an anonymous reconnaissance platform that may facilitate the targeting of ICS\n\ndevices for those actors with both a desire and capability to carry out attacks.\n\n**2.4** **Related Work**\n\nA Rockwell Automations white paper [23] describes the recommended method to\n\ncompare CPU performance between L6x and L7x model CPUs. The Rockwell Task\n\nMonitor utility measures CPU performance based on task execution times. The white paper\n\nstates that Task Monitor is compatible with all RSLogix5000 controllers version 13 and\n\nabove. The Task Monitor utility provides the means to request task execution times from a\n\nPLC and measure changes while the PLC is operating under different loads. This approach\n\nwas used in two recent works to demonstrate CPU performance [10] [29].\n\nRecent work performed by other researchers established methods used in this research\n\nto obtain PLC information and test PLCs for increases in CPU utilization or system process\n\nexecution times. Stephen Dunlap in 2013 showed that analyzing timing characteristics of\n\nPLC ladder logic execution can be used to detect modifications to firmware or ladder logic\n\n32\n\n\n-----\n\n[10]. In his research, Dunlap developed a data collection mechanism to measure ladder\n\nlogic execution times. He determined that a sample rate of 250ms over the course of 10,000\n\nsamples provided sufficient data to test for statistically significant changes to ladder logic\n\nexecution times with a resolution of two microseconds.\n\nCarl Schuett in 2013 expanded on Dunlap’s method to measure ladder logic execution\n\ntimes as a part of performance analysis tools to measure process execution times [29].\n\nSchuett added the capability to request process execution times for system processes\n\nrunning on the PLC CPU to detect statistically significant changes in performance. Schuett\n\nvalidated Dunlap’s sample rate and size in his research, and found that system services\n\nmust be sampled at a rate of 500ms to obtain valid results. Schuett uses the same one\nway permutation test as Dunlap with an alpha value of 0.0001 to accept or reject the null\n\nhypothesis that there is no performance change between samples.\n\n**2.5** **Conclusion**\n\nShodan demonstrates that ICS devices are connected to the Internet, and much\n\nresearch has been conducted recently to show that the number of ICS devices Shodan\n\nindexes is growing. While this research focuses on numbers, no research has yet attempted\n\nto qualify Internet-facing ICS devices by function, or try to determine what Shodan’s\n\nimpacts are to critical infrastructure. This chapter focused on the systems comprising\n\nICS networks and the current efforts to enumerate them using Shodan. In the following\n\nchapter, this research will outline the methodology used to distinguish ICS devices indexed\n\nby Shodan.\n\n33\n\n\n-----\n\n# T\n\n\n**III.** **Methodology**\n\nhis chapter describes the methodology used to distinguish Internet-facing ICS devices\n\nand conduct testing to ensure an ICS device under test is not impacted. Section 3.1\n\n\ndefines the problem of distinguishing ICS devices as it relates to this research. Section 3.2\n\ndescribes the methodology used in this research. Section 3.3 describes the experimental\n\nenvironment. Section 3.4 describes in detail the procedures used to collect data. Section\n\n3.5 outlines the analysis methods that will be used in the following chapter to interpret the\n\ndata collected during experimentation.\n\n**3.1** **Problem Definition**\n\nShodan has been called “the scariest search engine on the planet” [13] due to the fact\n\nthat Shodan indexes response messages for a set of TCP/IP and application layer protocols\n\nacross the entire public IP address space. Since 2009, Shodan database queries have\n\nrevealed ICS devices are being connected to the internet using public-facing IP addresses\n\n[19]. While the existence of ICS devices in the Shodan database has been examined by\n\nmany different researchers, no research addresses the risk those devices pose to critical\n\ninfrastructure. Many of the sensational news stories published regarding Shodan cite\n\nthe discovery of a control system for a wine cellar or publicly-accessible webcams [13],\n\nhowever, no one has yet taken the steps necessary to determine the real threat to critical\n\ninfrastructure posed by ICS devices cataloged in Shodan’s database.\n\nThe goal of this research is to develop a method to distinguish Internet-facing ICS\n\ndevices indexed by Shodan based on PLC programming information.\n\nIndustry and governmental recommendations for secure ICS network design specify\n\nmethods to prevent direct Internet connections [20]. Leverett’s work has shown that despite\n\nthe recommendations, ICS devices are continuing to be connected directly to the Internet.\n\n34\n\n\n-----\n\nRelated work quantifies Internet-facing ICS devices, but cannot answer the question “Why\n\nare these devices connected to the Internet?” This research attempts to answer that question\n\nby distinguishing Internet-facing ICS devices based on PLC programming information.\n\nThis research defines PLC programming information as the Task, Program, Routine, and\n\nTag names used by ICS engineers to program PLC code. Allen-Bradley PLCs using the\n\nCIP protocol return these names as strings in response to CIP attribute requests. Static\n\nanalysis techniques are used to distinguish these strings as either process control terms or\n\nindeterminate. PLC code containing process control terms indicates the device is likely to\n\nbe controlling a physical industrial process.\n\nThis research evaluates two primary objectives:\n\n1. Evaluate the impact of collection methods on Allen-Bradley PLCs by measuring\n\nPLC code and system service execution times. This research defines impact as a\n\nmeasurable, statistically significant increase in task execution time caused by the\n\ncollection methods developed in this chapter.\n\n2. Collect PLC programming information from Internet-facing Allen-Bradley PLCs and\n\ndistinguish each device based on matching PLC code to process control terms.\n\n**3.2** **Approach**\n\nThe goal of this research is to determine a method for distinguishing Internet-facing\n\nICS devices that are controlling processes without impacting PLC task execution time.\n\nThis section describes the general methodology used to evaluate PLC impacts during\n\ncode collection, script development that automates the request process given a list of ICS\n\ndevices, and the segregation of ICS devices by the presence of process control terms.\n\nThe proposed method of distinguishing Internet-facing ICS devices is shown in Figure\n\n3.1. This section concludes with the explanation of performance analysis methods used in\n\nthis research to determine PLC code collection impacts on PLC task execution times.\n\n35\n\n\n-----\n\nFigure 3.1: Process to Distinguish Internet-facing ICS Devices.\n\n**_3.2.1_** **_Evaluating Collection Impact on PLCs._**\n\nAvailability is critical to the secure and safe operation of any ICS network. The\n\nmethods used to collect data in this research must not degrade PLC performance to the\n\npoint where task execution times are significantly impacted.\n\nExploratory testing demonstrates the CIP protocol can be reverse engineered and a\n\npython script can replicate the RSLogix5000 Upload process to receive PLC code from an\n\n36\n\n\n-----\n\nInternet-facing device. EtherNet/IP and CIP protocols are used to send attribute requests\n\nto the PLC, and responses are parsed and analyzed. The results of exploratory testing are\n\ndiscussed in detail in Chapter 4.\n\nCollecting PLC code form Internet-facing ICS devices must not impact the device’s\n\noperation. Impact is defined as a statistically significant increase in task execution time.\n\nExperimentation on ICS devices in a controlled environment provides the means to develop\n\nnon-invasive data collection methods and measure performance metrics to determine\n\nimpacts on ICS devices. Tests measure task execution times during requests for PLC code.\n\nDuring these experiments, user task execution times should not see a significant increase.\n\nExploratory testing confirms that the Python scripts are able to collect PLC code from an\n\nICS device. Testing is conducted measuring the task execution times to ensure ICS device\n\nperformance is not negatively impacted. During this testing, four different PLC CPUs are\n\ntested, each with three firmware versions. During exploratory testing, firmware versions\n\nare cataloged to develop a better understanding of Allen-Bradley PLCs connected to the\n\nInternet. For each CPU, it is tested with firmware ranging from oldest to newest found on\n\nInternet-facing devices. Measuring PLC impacts during code collection determines if this\n\nmethod is feasible for employment on a set of Internet-facing PLCs indexed by Shodan.\n\n**_3.2.2_** **_PLC Code Collection Script Development._**\n\nThis research builds on the code developed by Dunlap that crafts EtherNet/IP and CIP\n\npackets requesting PLC code attributes [10][29]. Dunlap’s script written for the Python\n\ninterpreter version 2.7 obtains a Connection ID from the PLC used in connection-oriented\n\ncommands. The connection manager provides routing for messages from the EtherNet/IP\n\nmodule, across the chassis backplane, to the CPU installed in its respective slot.\n\nCode collection is established by replicating the process RSLogix 5000 uses to collect\n\nPLC code: register a session, establish a connection, send the appropriate series of Get\n\nAttribute List commands iterating over all global and program-specific instance values.\n\n37\n\n\n-----\n\nCompactLogix PLCs are designed so that the CPU always populates slot 0, however\n\nControlLogix PLCs are more customizable and the CPU can be located in any slot on the\n\nbackplane. Since the EtherNet/IP Forward Open request requires the CPU path, a method\n\nfor determining the processor type and slot is required.\n\n**_3.2.2.1_** **_EtherNet/IP Connection Setup._**\n\nThe 1756-ENBT module hosts a web server with Diagnostic Web Pages used primarily\n\nfor troubleshooting network connections. One of the Diagnostic Web Pages lists all devices\n\npopulated in the chassis by slot number shown in Figure 3.2. The collection process for a\n\nlist of Internet-facing ICS devices returned by Shodan is automated by use of web-scraping\n\ntechniques. These techniques make an HTTP GET request for the Diagnostic Web Page\n\nand search the web page source code for the processor type and slot. This information is\n\nthen returned and is used in the EtherNet/IP Forward Open request message.\n\nFigure 3.2: PLC Code Program-Specific Instance Request and Response.\n\n**_3.2.2.2_** **_CIP Attribute Requests._**\n\nFive functions are added to the python script in order to collect the PLC code shown\n\nin Figure 3.3. The first function creates a CIP message using the CIP service 0x4B Get\n\nAttribute List with a class value of 0x6B and an instance value of 0x00 to request all\n\nglobal instance values. The response message is parsed to strip the first four of every eight\n\nhex characters. These four hex characters represent a global instance value and the list\n\n38\n\n\n-----\n\nof instance values are passed to the next function. The second function takes in the list\n\nof global instance values and iterates over each value requesting a set of attributes. This\n\nfunction uses the CIP service 0x03 Get Attribute List to request the instance attributes for\n\nclass 0x6B and a given instance value. The responses for each service request are parsed\n\ninto attributes and returned as a list of hex values.\n\nProgram instance values and attributes are collected in a similar manner with a\n\nmodification of the code to provide the request path pair for each global instance value\n\nand an associated program-specific instance. The third function in our script uses the CIP\n\nservice 0x4B with class 0x68 and instance 0x00 to request a list of global program instance\n\nvalues. Note that the global instances returned from the first request cannot be used to\n\nobtain program-specific instances; RSLogix 5000 inserts this step requesting a new set of\n\nclass 0x68 global instance values. This is the reason that no association is made between the\n\nglobal instance values returned by the first function and the global program instance values\n\nreturned by this function. The fourth function iterates over each global program instance\n\nto obtain a set of program-specific instance values. This is the first message created using\n\na request path pair. The first class and instance used is class 0x68, instance 0x(global\n\n_program instance), class 0x6B, instance 0x00. As in other CIP requests, the message_\n\nrequests the global program instance values (0x68,0x(global program instance))(0x6B,\n\n0x00) associated with that specific program. The data field containing instance values\n\nis parsed, stored as a list of program-specific instance values, and passed to the fifth\n\nfunction. Finally, the CIP service 0x03 Get Attribute List request is sent for each program\nspecific instance value. This function also uses a request path pair of class 0x68, 0x(global\n\n_program instance), 0x6B, 0x(program-specific instance). The script writes each response_\n\nin a comma separated value (csv) coded file for further static analysis.\n\n39\n\n\n-----\n\nFigure 3.3: Flowchart depicting Global and Program-specific code collection.\n\n**_3.2.3_** **_Detecting Process Control Terms in PLC Programming Information._**\n\nThe goal of static analysis on PLC code is to distinguish devices that are controlling\n\nan operation in an industrial process from those where their function cannot be determined.\n\nThe tag names provide meaningful data for detecting process control terms. This research\n\n40\n\n\n-----\n\nuses a set of PLC project files developed by an ICS integrator for a metropolitan wastewater\n\nmanagement system. Analyzing the wastewater project files, it is evident that engineers\n\nuse process control terms to label the programs and tags used in PLC code so that it\n\nis readable and understandable. This permits static analysis of the PLC code obtained\n\nin this research for the presence of process control terms. A process control term in\n\nthis research is defined as: a generally accepted terms widely used by ICS engineers to\n\ndescribe industrial processes. Examples of process control terms are pump, generator,\n\nstart, HMI, and variations on each term (pump, pmp, pum1, pump01, etc.) Assuming that\n\nICS engineers code similarly and by reviewing the wastewater PLC code, it is expected to\n\nfind process control terms in the PLC code for ICS devices controlling industrial processes.\n\nPLC code for each device is reviewed for the presence of process control terms. A list\n\nof the terms used is included in Appendix 1. This is the method that allows devices to be\n\nclassified as Process Control or Indeterminate. The Process Control devices are selected\n\nbased on the existence of process control terms in their PLC code. Devices that do not\n\ncontain any process control terms are classified as indeterminate and separated from the\n\nProcess Control set.\n\nAfter selecting the group of Process Control devices, the list is presented to a group of\n\nIndustrial Control Systems engineers for review. These industry experts are able to leverage\n\ntheir experience and deep understanding of process control systems to validate devices in\n\nthe Process Control group and exclude any devices that contain process control terms, but\n\ndo not meet their expectations for a device controlling an industrial process.\n\nThe limitation to this method of classifying devices are the process control terms\n\nthemselves. It is possible that an engineer may use an odd naming convention for program\n\nnames or tags. Also, devices with PLC code written in a non-english language will\n\nalso avoid detection by this classification. In both cases, the device will be classified as\n\nindeterminate.\n\n41\n\n\n-----\n\n**3.3** **Environment**\n\nThis section describes the testing environment constructed to measure performance\n\nimpacts to Allen-Bradley 1756-L61/L71 and 1769-L23E/L32E PLCs during PLC code\n\ncollection. Performance impact in this research is defined as a statistically significant\n\nincrease to user task execution times.\n\n**_3.3.1_** **_Architecture and Hardware._**\n\nThe experiment setup for this research consists of a workstation, hub, and Allen\nBradley PLC as shown in Figure 3.4 and Figure 3.5. The workstation depicted is a Dell\n\nPrecision 690 with dual Intel Xeon 3GHz processors, 8GB RAM, Windows 7 Enterprise\n\nSP1 64-bit operating system. The workstation supports a Windows XP Virtual Machine\n\nwith 1 processor and 4 cores, 3GB RAM, 60GB hard drive, and a bridged network\n\nconnection to the test network. The workstation is connected to the PLC under test through\n\na Linksys 5 port workgroup hub and CAT-5 Ethernet cable. The two ControlLogix PLC\n\nCPUs under test are the 1756-L61 and 1756-L71, both using the Allen-Bradley chassis\n\n1756-A4 Series B, 1756-ENBT/A EtherNet/IP module v6.004, and Power Supply 1756\nPA75 Series B. The two CompactLogix PLC CPUs under test are the Allen-Bradley 1769\nL23E-QBFC1B Series A and Allen-Bradley 1769-L32E Series B. CompactLogix CPUs\n\ntests utilized the same L23E power supply and housing for both the L23E and L32E\n\nprocessor modules.\n\n**_3.3.2_** **_Software._**\n\nThe workstation utilizes Wireshark Version 1.8.6 for packet capture on the test\n\nnetwork and VMWare Workstation 10.0.1 build-1379776 to run the Windows XP\n\nVirtual Machine. The Virtual Machine has Rockwell Software installed that provides\n\ncommunication and a programming interface to the PLCs under test. The Rockwell\n\nSoftware used in this research is ControlFLASH v12.00.00 for firmware loading, RSLinx\n\n42\n\n\n-----\n\nFigure 3.4: ControlLogix Experiment Architecture.\n\nFigure 3.5: CompactLogix Experiment Architecture.\n\nClassic Lite Revision 2.59.02 CPR 9 SR 5 for establishing a communications path to the\n\nPLC under test, RSLogix5000 V19.01.00 CPR 9 SR 3 for the programming interface\n\nand ability to upload and download project files to the CPU under test, and Logix5000\n\n43\n\n\n-----\n\nTask Monitor Version 3.0.3.0 to perform logging of user and system task execution times.\n\nPython scripts for this research use the Python 2.7.6 interpreter.\n\n**_3.3.3_** **_PLC Code collection tools._**\n\nPython scripts developed by Dunlap [10] for his research are modified to collect object\n\ninformation for Tasks, Programs, Routines, and Tags in the project files loaded into the\n\nCPU under test. Dunlap originally developed scripts that register a session and obtains a\n\nConnection ID. Through reverse engineering the RSLogix5000 upload process, Python is\n\nused to craft packets initiating Connected Send requests for PLC code.\n\n**_3.3.4_** **_Performance Analysis Tools._**\n\nCPU task execution time is measured using the user task and system service execution\n\ntimes with and without the PLC code collection script running. Comparative analysis is\n\nconducted between the two measurement sets to determine if a statistically significant\n\nchange in execution times is detected. This research uses Python classes developed in\n\nDunlap’s [10] research and modified by Schuett [29] to take measurements of execution\n\ntimes and automate the project file download process. Measurements are taken every\n\n500ms by means of a CIP request for execution times. The responses from these CIP\n\nrequests provide user task and system service execution times in microseconds. A sample\n\nsize of 120 measurements are taken for each level of CPU and firmware with and without\n\nPython PLC code collection scripts running.\n\n**_3.3.5_** **_Implementation._**\n\nImplementation of this method occurs after determining the impact code collection\n\nhas on a device. Four different Allen-Bradley CPUs are tested for three firmware versions\n\nto determine impact. CPUs that are not impacted by the PLC code collection method are\n\nscanned using a Ubuntu Linux instance on the Amazon Web Services Elastic Compute\n\nCloud (EC2) Virtual Server in the Cloud. Amazon EC2 provides an Ubuntu Server 14.04\n\nLTS instance using 1 CPU, 0.613GB of RAM, 8 GB storage, and a public IP.\n\n44\n\n\n-----\n\n**3.4** **Experiment Design**\n\nThis section details the design, implementation, and data collection used in this\n\nresearch to obtain PLC code from ICS devices indexed in the Shodan search engine. The\n\ndata collection methods used in this research must not impact ICS device availability to\n\nbe considered acceptable for use against Internet-facing ICS devices. These experiments\n\nshow the impacts to a PLC in a test environment prior to data collection conducted on the\n\nInternet-facing devices.\n\n**_3.4.1_** **_Experiment Setup._**\n\nA total of 30 sets of measurements are collected on each CPU. Baseline sets are\n\ndefined as a set of 120 task execution time measurements taken for a fixed CPU and\n\nfirmware level. Treatment sets are defined as a set of 120 task execution time measurements\n\ntaken for a fixed CPU and firmware level while a PLC code collection script is sending one\n\nEtherNet/IP message to the CPU for each measurement cycle. Three firmware versions are\n\ntested for each CPU. Five replications of baseline sets and five replications of treament sets\n\nare recorded for each of the three firmware versions resulting in 30 total measurement sets.\n\nTable 3.1 lists the firmware versions used in the experiment.\n\nTable 3.1: Firmware Versions used in performance analysis testing.\n\nExperiment Firmware Versions\n\nFirmware 1756-L61 1756-L71 1769-L23 1769-L32\n\nLow 16.56.47 20.11.59 17.7.63 16.23.15\n\nMedium 19.11.56 20.12.79 18.12.57 17.12.64\n\nHigh 20.11.59 20.13.81 19.11.16 20.13.81\n\nTable 3.2 lists an example experiment setup before the entire list of 30 experiments\n\nis randomized to reduce bias. The first column represents the run order prior to\n\n45\n\n\n-----\n\nrandomization. The second column lists the RSLogix5000 project file downloaded\n\nautomatically to the PLC. The logic in each project file is identical, however each project\n\nfile is matched to a specific firmware version. The fourth column lists the firmware version\n\nflashed to the PLC and the fifth column indicates if the run is Baseline or Treatment. When\n\nthe workload value in the fifth column is zero, no code collection is performed during\n\nmeasurement. When the workload value is 1, a child process spawns running the code\n\ncollection script in conjunction with measurements.\n\nEach project file is a modification of the “Big” project file used in Dunlap and\n\nSchuett’s research. The project files are modified by adding global tags to each project\n\nfile so that the PLC code collection scripts run for a period of time between 55 and 56\n\nseconds.\n\n**_3.4.2_** **_PLC Execution Times._**\n\nMeasurements are collected from the PLC using Dunlap and Schuett’s python script\n\nwhich records task and system process execution times every 500ms. The script was\n\ndeveloped by reverse engineering RSLogix Task Monitor requests to the PLC for execution\n\ntimes and validated on the 1756-L61 CPU. This research builds upon Dunlap and Schuett’s\n\nwork by reverse engineering the Task Monitor requests for the 1756-L71, 1769-L23, and\n\n1769-L32 CPUs.\n\nThe requests are sent as CIP Command 0x6D unconnected send messages and routed\n\nto the PLC CPU via the CIP Connection Manager. The data fields returned are parsed as\n\nshown in Figure 3.6.\n\nTask and system service execution times are recorded every 500ms for a total of 120\n\nmeasurements, approximately 60 seconds. Each CPU is measured under three different\n\nfirmware versions replicated five times, once with the PLC code collection script running\n\nand five times with no collection (baseline). This provides a total of 10 measurement sets\n\nper firmware version or 30 measurements per CPU.\n\n46\n\n\n-----\n\nTable 3.2: Listing of Experiment Runs for the 1756-L61 CPU.\n\nExperimental Setup: L61\nRun Project File Name Firmware Version Workload (B=0/T=1)\n1 L61 20 11 59.ACD 20 11.bin 0\n2 L61 20 11 59.ACD 20 11.bin 0\n3 L61 20 11 59.ACD 20 11.bin 0\n4 L61 20 11 59.ACD 20 11.bin 0\n5 L61 20 11 59.ACD 20 11.bin 0\n6 L61 20 11 59.ACD 20 11.bin 1\n7 L61 20 11 59.ACD 20 11.bin 1\n8 L61 20 11 59.ACD 20 11.bin 1\n9 L61 20 11 59.ACD 20 11.bin 1\n10 L61 20 11 59.ACD 20 11.bin 1\n11 L61 19 11 16.ACD 19 11.bin 0\n12 L61 19 11 16.ACD 19 11.bin 0\n13 L61 19 11 16.ACD 19 11.bin 0\n14 L61 19 11 16.ACD 19 11.bin 0\n15 L61 19 11 16.ACD 19 11.bin 0\n16 L61 19 11 16.ACD 19 11.bin 1\n17 L61 19 11 16.ACD 19 11.bin 1\n18 L61 19 11 16.ACD 19 11.bin 1\n19 L61 19 11 16.ACD 19 11.bin 1\n20 L61 19 11 16.ACD 19 11.bin 1\n21 L61 16 23 16.ACD 16 56.bin 0\n22 L61 16 23 16.ACD 16 56.bin 0\n23 L61 16 23 16.ACD 16 56.bin 0\n24 L61 16 23 16.ACD 16 56.bin 0\n25 L61 16 23 16.ACD 16 56.bin 0\n26 L61 16 23 16.ACD 16 56.bin 1\n27 L61 16 23 16.ACD 16 56.bin 1\n28 L61 16 23 16.ACD 16 56.bin 1\n29 L61 16 23 16.ACD 16 56.bin 1\n30 L61 16 23 16.ACD 16 56.bin 1\n\n**_3.4.3_** **_PLC Impact Experiments._**\n\nThis experiment to measure impacts of code collection is conducted on a closed IP\nbased network shown in Figure 3.4 and Figure 3.5. Each CPU is measured independent of\n\nthe other three CPUs.\n\n47\n\n\n-----\n\nFigure 3.6: Task Monitor Graphical Interface shown with Wireshark CIP packet capture.\n\nThe procedure for downloading PLC code and taking execution time measurements is\n\nused as follows:\n\n1. Configure the list of experimental runs as shown in Table 3.2 ensuring to randomize\n\nthe list to reduce bias.\n\n2. Begin the runexp.py script which automates project file download and task execution\n\ntime measurement.\n\n3. Use ControlFLASH software to load the appropriate Firmware to the PLC as\n\nidentified by the runexp.py script.\n\n4. Script loads the appropriate project file by replicating the RSLogix5000 download\n\nprocess.\n\n5. Script places the PLC in Remote Run mode.\n\n48\n\n\n-----\n\n6. Script pauses for verification that controller is in Remote Run. Execution times will\n\nnot be recorded if PLC did not reach Remote Run state.\n\n7. The PLC runs for 60 seconds before taking measurements to allow it to reach steady\n\nstate.\n\n8. PLC code collection requests are made once each 500 millisecond measurement\n\ncycle to record 120 measurements over a 60 second period. See Figure 3.7 for\n\ncollection sequence.\n\n9. For treatment measurements, PLC code collection begins after a two second delay.\n\nCode collection script sets up the EtherNet/IP connection with the PLC and then\n\nsends one CIP request to the PLC per 500 millisecond measurement cycle.\n\n10. PLC code collection stops approximately two seconds before measurement collec\ntion ends.\n\n11. Verify task execution time measurements are valid before advancing the runexp.py\n\nscript to the next line specified in the configuration file.\n\nThis process as depicted in Figure 3.7 is replicated five times for a baseline\n\nmeasurement and five times for a treatment measurement covering each CPU and firmware\n\nversion in the experiment for a total of 30 runs per CPU. The list of 30 runs is randomized\n\nusing the Random.Org List Randomizer to reduce the possibility of bias being introduced.\n\n**_3.4.4_** **_Visual Inspection of PLC Code._**\n\nThe final process in this method of distinguishing Internet-facing ICS devices is the\n\nclassification of PLC code using process control terms. A visual inspection is condcuted\n\non the PLC code obtained from each device to identify well-known process control terms\n\nlisted in Appendix 1. The presence of these terms in PLC code is assumed to indicate that\n\nthe device is controlling an industrial process, and results in the device being classified as\n\n49\n\n\n-----\n\nFigure 3.7: Measuring PLC Task Execution Times.\n\nProcess Control. When PLC code does not show the existence of process control terms, the\n\ndevice is classified as Indeterminate. During testing, the visual inspection of PLC code is\n\nperformed to ensure PLC code collection scripts function properly and do no cause errors\n\nin the code or on the PLC.\n\n**3.5** **Evaluation**\n\nImpacting a PLC controlling an industrial process has the potential to result in personal\n\ninjury or have a devastating environmental or industrial impact. This research uses PLC\n\nperformance analysis methods used in previous work by Schuett and Dunlap. Their work\n\nfocused on detecting small changes in task execution times due to firmware or PLC code\n\nmodifications. Measurements are collected over a sixty second run to obtain sufficient\n\nnumber of samples to perform statistical tests on the data. A total of 120 measurements are\n\ntaken in 500ms intervals.\n\nThe measurements collected during experimentation are analyzed using the Monte\nCarlo resampling technique. This is a nonparametric test that measures the effect of the\n\ntreatment on a sample. In this research, the sample is the baseline task execution time and\n\nthe treatment is the task execution times collected while the PLC code collection script is\n\n50\n\n\n-----\n\nrunning. The 9999 Monte-Carlo resamplings provide a p-value which is used to accept or\n\nreject a null hypothesis. The null hypothesis in this research is that there is no difference\n\nbetween the sample and treatment populations. The p-value returned represents the percent\n\nchance that the treatment value could have been obtained from the sample. If both the\n\nsample and treatment populations are the same, the p-value will be 1. If the sample and\n\ntreatment populations are statistically different, the p-value will be below the chosen alpha\n\nvalue of 0.05 to provide a 95% confidence interval.\n\n**3.6** **Conclusion**\n\nThe methodology outlined in this chapter is used to identify Internet-facing ICS\n\ndevices indexed by the Shodan search engine, obtain PLC code from those devices, and\n\nclassify the device as Process Control or Indeterminate. Further, the experimental design\n\nmeasures the impact of PLC code collection on the ICS device in order to determine the\n\nfeasibility of using this method to collect from ICS devices in production. The results\n\nof performance analysis and implementation of this methodology on Internet-facing ICS\n\ndevices is discussed in the following chapter.\n\n51\n\n\n-----\n\n# T\n\n\n**IV.** **Results and Implementation**\n\nhis chapter describes the results obtained during exploratory testing, performance\n\nevaluation, and implementation of the research methodology. Exploratory testing\n\n\ndetails the reverse engineering of Allen-Bradley software and communications protocols.\n\nThe performance evaluation section details the results of experiments designed to determine\n\nimpact of PLC code collection on PLC task execution times. The implementation section\n\ndescribes the results of implementing the methodology on Internet-facing Allen-Bradley\n\nPLCs.\n\n**4.1** **Exploratory Testing**\n\nThis section describes the exploratory testing conducted to determine the CIP protocol\n\nrequests that return PLC programming information.\n\n**_4.1.1_** **_Reverse Engineering Allen-Bradley PLC Code CIP Requests._**\n\nProgramming information stored in the PLC is uploaded to a computer using a vendor\nspecific programming suite. In this research, a Windows XP Virtual Machine running\n\nRSLogix 5000 software is connected to an Allen-Bradley 1756-L61 PLC CPU using a\n\n1756-ENBT EtherNet/IP module. Both devices are connected using Private IP space on a\n\nclosed network. The environment for exploratory testing is shown in Figure 4.1.\n\nAllen Bradley ControlLogix and CompactLogix PLCs use RSLogix 5000 for\n\nprogramming design and configuration. RSLogix 5000 uses an Upload process to load\n\nPLC code from a given PLC into the RSLogix 5000 interface. RSLogix 5000 uses CIP to\n\nrequest PLC code from the device, and by reverse engineering the Upload process, data\n\npackets are reconstructed which request PLC code from a device without using RSLogix\n\n5000.\n\n52\n\n\n-----\n\nFigure 4.1: Hardware configuration for exploratory testing.\n\nWireshark is used to observe network traffic between the Virtual Machine hosting\n\nRSLogix 5000 software and an Allen-Bradley 1756-L61 CPU and 1756-ENBT EtherNet/IP\n\nmodule. Wireshark parses the fileds contained in each CIP data packet, which aids in static\n\nanalysis.\n\nRSLogix 5000 establishes an EtherNet/IP session with a PLC by executing the\n\nEtherNet/IP protocol Register Session command. Once this command is sent to the PLC,\n\na session handle is returned and used in all subsequent communications between RSLogix\n\n5000 and the PLC. The Register Session command is defined in Dunlap’s work [10] and\n\nhis code for registering an EtherNet/IP session and routing CIP messages to the PLC CPU\n\nis used in this research.\n\n53\n\n\n-----\n\nThe CIP protocol is an object oreinted protocol that uses classes and instances to\n\ndescribe data elements. PLC Tasks, Programs, Routines, and Tags are all referenced by a\n\nspecific class and instance value. Allen-Bradley RSLogix 5000 PLCs use the class 0x6B to\n\nidentify global data elements of PLC code such as Tasks, Programs, and Global Tags.\n\nObserving RSLogix 5000 communications, the EtherNet/IP packet consists of the\n\nEtherNet/IP header, CIP header, and data. Figure 4.2 shows the hex representation of\n\nthe EtherNet/IP packet used to request a list of nine attributes associated with the class and\n\ninstance values listed in the request path.\n\nFigure 4.2: EtherNet/IP Packet.\n\n54\n\n\n-----\n\nRSLogix 5000 first sends a CIP request to the PLC with a request path of Class 0x6B,\n\nInstance 0x00 shown in Figure 4.3. The PLC responds with a CIP message listing the\n\ninstance values of all global data elements. The response message data field is where an\n\ninstance is represented by two bytes in little-endian formatting followed by an additional\n\ntwo Null bytes as padding. Similar request messages are crafted with Class 0x6B and\n\na specific instance value which returns a data field for each instance containing a list of\n\ninstance attributes.\n\nFigure 4.3: PLC Code Request for Global Instance Values.\n\nAt this point CIP requests transition from requesting instance values to requesting\n\nattributes assigned to each specific instance. The first messages observed returning\n\nattributes associated with PLC code are the pair of messages shown in Figure 4.4. Once the\n\nglobal instance values have been obtained, CIP attribute requests iterating over all global\n\ninstance values return data fields for the nine attributes requested for each instance.\n\n55\n\n\n-----\n\nAttribute 1 contains American Standard Code for Information Interchange (ASCII)\n\nrepresentations of each Task, Program, and Global Tag name. The Wireshark packet\n\ncapture shown in the bottom right of Figure 4.4 decodes the ASCII text and Task:task bravo\n\nis visible.\n\nFigure 4.4: PLC Code Global Instance Request and Response.\n\nRSLogix uses a similar process to obatin program-specific names for Routines and\n\nProgram Tags as shown in Figure 4.5. RSLogix 5000 uses class and instance values for\n\nprogram-specific data. The first request path pair of Class 0x68 Instance 0x2420 indicate\n\nthe request is for a program-specific item belonging to the global item (Instance Value\n\n_0x2420). The next request path pair of Class 0x6B Instance 0x00 indicates a request for_\n\nall instance values belonging to the elements belonging to the parent Global instance value\n\n0x2420.\n\n56\n\n\n-----\n\nFigure 4.5: PLC Code Request for Program-Specific Instance Values.\n\nRSLogix 5000 sends CIP requests iterating over all returned program-specific instance\n\nvalues to obtain the nine attributes for each program-specific Routine and Program Tag.\n\nAttribute 1 contains the ASCII name of each Routine and Tag returned as shown in Figure\n\n4.6.\n\nFigure 4.6: PLC Code Program-Specific Instance Request and Response.\n\nEach CIP request is a request for nine attributes associated with a instance value.\n\nAttribute 1 is the ASCII string representing the name of the data element. Attribute 2 lists\n\nthe data type of each data element. Observation of global and program-specific responses\n\n57\n\n\n-----\n\nidentifies the values listed in Table 4.1. The fields for Attributes 3 through 9 are not readily\n\nidentifiable and it is unknown what data is represented by the values in these fields.\n\nTable 4.1: Data Type Values found in Attribute 2 CIP Instance Responses.\n\nSelection of RSLogix 5000 Data Types\n\nHex Value Data Type\n\n0x00C4 DINT Tag\n\n0x00C1 Boolean Tag\n\n0x106D Routine\n\n0x1070 Task\n\n0x1068 Program\n\n0x1069 Map (Global Tag)\n\n0x107E Cxn (Global Tag)\n\nThe Get Attribute List command discussed above returns a list of nine attributes given\n\na global class and instance, or a program-specific class instance pair. It is important to note\n\nthat during exploratory testing, there is no method developed that successfully mapped a\n\nprogram-specific instance back to a global instance. That is, a method for obtaining global\n\nand program specific PLC code is established, however, that method cannot determine\n\nwhich program-specific data elements are related to a global program. During static\n\nanalysis of the remaining attributes, the values for the third and fourth attributes change\n\neach time a new project file is downloaded into the PLC. The fifth and sixth attributes only\n\nhave values when referencing a global or program specific tag, and the remaining three\n\nattributes always contain a value of zero.\n\n58\n\n\n-----\n\n**_4.1.2_** **_Conclusion._**\n\nThis section describes reverse engineering that allows development of python scripts\n\nthat replicate portions of the RSLogix 5000 Upload process. These scripts applied to\n\nInternet-facing ICS devices obtain PLC code used in this methodology to distinguish\n\nInternet-facing ICS devices. In order to implement these scripts on devices in production,\n\nperformance analysis testing is conducted to determine if these code collection scripts\n\nimpact PLC task execution times.\n\n**4.2** **Performance Analysis Results**\n\nThis section describes the results of experiments measuring impacts on PLC\n\nperformance resulting from PLC code collection on an Allen-Bradley PLC. The data\n\ncollected is defined in terms of statistical distribution, error conditions, outliers, group\n\nmean, standard deviation, minimum, and maximum values.\n\n**_4.2.1_** **_Data._**\n\nPLC execution measurements are read into the R software package for statistical\n\nanalysis [10]. A total of 120 sets of measurements are recorded in microseconds with a\n\nresolution of two microseconds. Execution times are reported from the PLC every 500\n\nmilliseconds over a 60 second test period. The PLC code collection script includes a\n\n_time.sleep(0.5) command in order to ensure only one request per measurement cycle is_\n\nsent to the PLC. This maximizes the speed of code collection while limiting the number of\n\nCIP commands issued to the PLC CPU per cycle.\n\nThe results from execution time collection are not approximately normal as shown in\n\nthe Q-Q plot in Figure 4.7. This plot consists of data taken during the first baseline run\n\nfor the L61 CPU on version 16.56.47 firmware. The remaining runs measuring all CPUs\n\nand firmware versions have similar Q-Q plots, therefore assuming the data is approximately\n\nnormal is not valid. The nonparametric Monte Carlo resampling test is used in this research\n\nto obtain p-values.\n\n59\n\n\n-----\n\nFigure 4.7: R Q-Q Plot of PLC Task Execution Times L61 v16.56.47.\n\nDunlap and Schuett identified outliers which may be caused by logical interrupts and\n\nexcluded them from statistical analysis. The PLC execution times in their research are\n\nstable since the PLC is executing code without any external influences. Dunlap and Schuett\n\nnoted that some execution times are well outside the normal variance and investigating\n\ndue to software interrupts in the PLC scheduling algorithm causing artificial delays in\n\ncode execution times. Outliers in this data set appear in a similar manner observed in\n\nDunlap and Schuett’s research; however, this research counts them as valid measurements.\n\n60\n\n\n-----\n\nA key difference between the work done by Dunlap and Schuett and this research is the\n\nmeasurement of a treatment on the sample data set. The effect that a CIP packet has on\n\nthe CPU cannot be distinguished from the effect a software interrupt has on the CPU.\n\nTherefore, outliers are included in statistical analysis for this research.\n\nBoxplots shown in Figure 4.8 depict the five Baseline runs (B1-B5) and five Treatment\n\nruns (T1-T5) for the L61 CPU on version 16.56.47 firmware. The boxplots are a graphical\n\ndepiction of the data distribution. The solid lines in each box depict the median value\n\nand the box itself encompass the 25th to 75th percentiles of the data in each set of\n\nmeasurements. If each replication is stable and predictable, boxplots one through five\n\nwould have similar means and quantiles, and boxplots six through ten would be similar\n\nto each other as well. Measurements show that there is significant unequal variance in\n\nthe measurement of execution times among the replications of similar experiments. The\n\ndistribution of execution times for run T4 appear to be much smaller than the distribution\n\nof execution times for run B1, even though run T4 had the treatment applied and run B1 is\n\na baseline measurement. The boxplot also shows the outliers which are plotted above the\n\ntop whisker line. While code collection cannot be eliminated as a contributor to outliers,\n\nit is evident that there are a number of outliers present in the baseline measurements B1\n\nthrough B5.\n\nLooking more closely at a run with a small variance, a scatter plot of run B2 shows\n\nthe separation between PLC execution times with outliers. The scatter plot in Figure 4.9\n\nshows the distribution of task execution time measurements with a solid line at the 3478\n\nmicrosecond mark which corresponds to the top whisker shown in the Figure 4.8 boxplot.\n\nMeasurements above the red line in the scatter plot represent the outliers shown in the Run\n\nB2 boxplot in Figure 4.8.\n\nThe differences in median and variance seen in the L61 version 16.56.47 boxplot and\n\nscatterplot are common among the data sets measuring the three firmware versions for all\n\n61\n\n\n-----\n\nFigure 4.8: Boxplots of PLC Task Execution Times L61 v16.56.47.\n\nfour CPUs. The statistical differences determined by one way Monte Carlo resampling are\n\ndiscussed in the next section.\n\n**_4.2.2_** **_Non-parametric Statistical Analysis._**\n\nStatistical analysis for this data set uses the same one way permutation test used by\n\nDunlap and Schuett in their research. The permutation test does not rely on an assumption\n\nthat the data is approximately normal. The data collected in this research has been shown to\n\n62\n\n\n-----\n\nFigure 4.9: Run B2 Scatter Plot for PLC Task Execution Times L61 v16.56.47.\n\nbe skewed and not normally distributed. The one way permutation with 9999 Monte-Carlo\n\nresamplings is calculated using the Coin package in R.\n\nThe one way permutation test for differences in mean task execution times provides\n\na p-value which represents the percent chance that a random variable representing the\n\ntreatment set could come from the baseline set. When comparing the first run of the\n\nbaseline set to the first run of the treatment set, a p-value below the threshold value means\n\nthere is a statistically significant difference between the two sets. The threshold value\n\nselected for this research is 0.05.\n\n63\n\n\n-----\n\n**_4.2.3_** **_Analysis._**\n\nThe p-values obtained for each CPU/firmware combination show statistically signif\nicant differences among three of the four CPUs. Since the one way permutation function\n\ntests for differences in the mean sample, some of the differences are due to faster, not\n\nslower, task execution times. In those cases, the difference is noted, however it is not\n\nconsidered an impact in this research.\n\nThe following subsections list tables containing p-values for each of the four CPUs\n\ntested. The baseline runs are listed on the table’s vertical axis and are labeled B1 through\n\nB5. The treatment runs are on the table’s horizontal axis and labeled T1 through T5. The\n\np-values listed in each Table are obtained from the one way permutation test comparing\n\nthe treatment runs to the baseline runs. P-values are listed in bold when they are below the\n\nthreshold value due to an increase in task execution time during the treatment run. P-values\n\nare underlined when the permutation test measures a statistically significant difference in\n\nmeans, however the treatment run executed faster than the baseline run.\n\nWhere statistically significant differences are shown, boxplots are included to illustrate\n\nthe variance in median, variance, quantile, and outlier values.\n\n**_4.2.3.1_** **_L61 CPU._**\n\nTable 4.2 lists the p-values obtained for the L61 CPU. Treatment 2, 3, and 4 all show\n\nstatistically slower runs when compared to Baseline runs 2, 4, and 5. Examining the\n\nboxplot for this run in Figure 4.10, it is clear that Treatment 2, 3, and 4 fit within the\n\nrange of execution times returned in the Baseline runs. In fact, the run with the largest\n\nexecution times for this CPU and firmware is Baseline 3. Statistically faster runs are\n\ndetected comparing Treatment 1 with Baseline 1 and 3.\n\n64\n\n\n-----\n\nFigure 4.10: Boxplot for L61 v19.11.56.\n\n**_4.2.3.2_** **_L71 CPU._**\n\nTable 4.3 lists the p-values obtained for the L71 CPU. None of the p-values indicate a\n\nstatistically significant increase in task execution times.\n\n**_4.2.3.3_** **_L23E CPU._**\n\nTable 4.4 lists the p-values obtained for the L23E CPU. Eight of the 25 p-values\n\nreturned for firmware version 17.7.63 show statistically longer task execution times.\n\nExamining the boxplot in Figure 4.11 Baseline 5 has the third fastest task execution times\n\nand lowest variance across all ten sets while Treatment 5 has one of the highest median and\n\n3rd Quadrennial values among all ten sets. When these two sets are excluded, only one\n\nof the remaining 20 p-values are below the selected threshold with slower task execution\n\ntimes.\n\n65\n\n\n-----\n\nTable 4.2: L61 Baseline vs. Treatment p-values (Bold indicates slower execution time).\n\n1756-L61 P-values\n\nFirmware version 16.56.47\n\nT1 T2 T3 T4 T5\n\nB1 0.710071007 0.385838584 0.220822082 0.087008701 0.860286029\n\nB2 0.172017202 0.873787379 0.920192019 0.485248525 0.359835984\n\nB3 0.468046805 0.627062706 0.412841284 0.182018202 0.828682868\n\nB4 0.269426943 0.97839784 0.768376838 0.406840684 0.507150715\n\nB5 0.922092209 0.253625363 0.130213021 0.04850485 0.619261926\n\nFirmware version 19.11.56\n\nT1 T2 T3 T4 T5\n\nB1 0.01438924 0.872059554 0.738535269 0.847818191 0.291268318\n\nB2 0.753083092 **0.012227441** **0.00246279** **0.004025775** 0.093014581\n\nB3 0.003532936 0.54701249 0.918845547 0.80667756 0.130273047\n\nB4 0.825904893 **0.017721752** **0.003962985** **0.006263625** 0.120199879\n\nB5 0.927038441 **0.021955656** **0.004996289** **0.007835988** 0.143674488\n\nFirmware version 20.11.59\n\nT1 T2 T3 T4 T5\n\nB1 0.608040308 0.694409633 0.59214477 0.704535777 0.066645462\n\nB2 0.552817863 0.776946749 0.677119928 0.790750211 0.092981131\n\nB3 0.671688605 0.653498384 0.555890695 0.661875626 0.064103369\n\nB4 0.650188876 0.648850737 0.546769661 0.655479734 0.057078883\n\nB5 0.484296053 0.859180663 0.7587753 0.876351546 0.116058067\n\n66\n\n\n-----\n\nTable 4.3: L71 Baseline vs. Treatment p-values (Bold indicates slower execution time).\n\n1756-L71 P-values\n\nFirmware version 20.11.59\n\nT1 T2 T3 T4 T5\n\nB1 0.628762876 0.918891889 0.756875688 0.97379738 0.899289929\n\nB2 0.98219822 0.765276528 0.848384838 0.606960696 0.570357036\n\nB3 0.403840384 0.683468347 0.473547355 0.735473547 0.832683268\n\nB4 0.411741174 0.696869687 0.498049805 0.746874687 0.842984298\n\nB5 0.415041504 0.280928093 0.251525153 0.139113911 0.154515452\n\nFirmware version 20.12.79\n\nT1 T2 T3 T4 T5\n\nB1 0.354835484 0.815881588 0.611161116 0.114611461 0.919191919\n\nB2 0.819481948 0.656265627 0.177617762 0.391339134 0.441844184\n\nB3 0.733573357 0.785178518 0.289428943 0.364836484 0.567256726\n\nB4 0.848284828 0.654065407 0.182118212 0.436443644 0.443944394\n\nB5 0.260826083 0.613461346 0.847084708 0.079607961 0.881588159\n\nFirmware version 20.13.81\n\nT1 T2 T3 T4 T5\n\nB1 0.511351135 0.162716272 0.320632063 0.716271627 0.164116412\n\nB2 0.218821882 0.659865987 0.320332033 0.102710271 0.617661766\n\nB3 0.853685369 0.314931493 0.608160816 0.877087709 0.307430743\n\nB4 0.303430343 0.820982098 0.453545355 0.150215022 0.801880188\n\nB5 0.850185019 0.509750975 0.891889189 0.565756576 0.518451845\n\n**_4.2.3.4_** **_L32E CPU._**\n\nThe L32E p-values in Table 4.5 show statistically significant differences for all three\n\nfirmware versions tested. Firmware 16.23.15 has 11 of 25 p-values below the selected\n\n67\n\n\n-----\n\nFigure 4.11: Boxplot for L23E v17.07.63.\n\nthreshold, however 10 of the 11 have faster mean task execution times in the Treatment set\n\nthan in the Baseline set. The only p-value that indicates a statistically slower task execution\n\ntime in the Treatment set is the p-value comparing the fastest Baseline set (Baseline 2) to\n\nthe slowest Treatment set (Treatment 3).\n\nFirmware 17.12.64 has eight of the 25 p-values below the selected threshold. All\n\neight below the threshold p-values are common to the Baseline 2, 4, and 5 sets and the\n\nTreatment 1, 2, and 5 sets. The boxplot in Figure 4.12 shows that Baseline 2, 4, and 5 have\n\nlower median values than the remaining two Baseline sets. Similarly, Treatment 1, 2, and\n\n5 have the highest three median values. These treatment sets have statistically slower task\n\nexecution times when compared to the fastest Baseline sets, however, the range of values\n\nin each of the Treatment sets are not outside what is observed in the Baseline sets.\n\n68\n\n\n-----\n\nTable 4.4: L23E Baseline vs. Treatment p-values (Bold indicates slower execution time).\n\n1769-L23E P-values\n\nFirmware version 17.7.63\n\nT1 T2 T3 T4 T5\n\nB1 0.886988699 0 0.455445545 0.471947195 0.525352535\n\nB2 0.062206221 0.02640264 0.169716972 0.133813381 **0.01190119**\n\nB3 **0.03780378** 0.01360136 0.126212621 0.089108911 **0.00420042**\n\nB4 0.155215522 0.0340034 0.323032303 0.281228123 **0.04710471**\n\nB5 **0.00180018** 0.183718372 **0.00730073** **0.00360036** **0**\n\nFirmware version 18.12.57\n\nT1 T2 T3 T4 T5\n\nB1 0.804880488 0.440844084 0.127912791 0.294729473 0.420442044\n\nB2 0.709270927 0.525052505 0.164716472 0.371537154 0.503150315\n\nB3 0.126712671 0.550755076 0.810181018 0.773877388 0.634963496\n\nB4 0.308030803 0.95049505 0.439443944 0.805680568 0.97779778\n\nB5 **0.04280428** 0.219321932 0.736573657 0.381338134 0.298629863\n\nFirmware version 19.11.16\n\nT1 T2 T3 T4 T5\n\nB1 0.649164916 0.869386939 0.514851485 0.929592959 0.660566057\n\nB2 0.799279928 0.734273427 0.442844284 0.924792479 0.567356736\n\nB3 0.695069507 0.837583758 0.506550655 0.96649665 0.638363836\n\nB4 0.619761976 0.907790779 0.546054605 0.894489449 0.705470547\n\nB5 0.749074907 0.760376038 0.447344734 0.96539654 0.589458946\n\nThe boxplot for firmware version 20.13.81 shown in Figure 4.13 shows two common\n\ngroupings of task execution times. Baseline 1, 2, and 3 are comparable with Treatment 4\n\n69\n\n\n-----\n\nFigure 4.12: Boxplot for L32E v17.12.64.\n\nand 5 while Baseline 4 and 5 are comparable with Treatment 1, 2 and 3. When analyzed in\n\nthese two subgroups, all calculated p-values are above the selected threshold.\n\n**_4.2.4_** **_Discussion._**\n\nThree of the four CPUs tested exhibited statistically different outcomes comparing a\n\ngiven Baseline run to a Treatment run. The experiments are performed with five replications\n\nper Baseline and five replications per Treatment run. The boxplots of these runs show\n\ndifferences within the five replications that are similar to the differences observed when\n\nBaseline and Treatment runs are compared.\n\nThe PLC code collection script makes one CIP request to the PLC per measurement\n\ncycle. This ensures the script places the lowest load possible on the CPU. The p\nvalues above demonstrate statistically significant differences among individual Baseline\n\n70\n\n\n-----\n\nFigure 4.13: Boxplot for L32E v20.13.81.\n\nor Treatment runs, however, none of the experiments demonstrate statistically significant\n\ndifferences across more than nine of 25 calculated p-values.\n\nDuring all 120 experiments, the PLC code collection script had a 100 percent success\n\nrate collecting all PLC code from the PLCs under test. Major and minor PLC faults are not\n\ndetected or logged during data collection. Fault detection during code collection relies on\n\ncomparing the results of code collection against the PLC code downloaded into the PLC.\n\nFor each CPU and firmware version tested, the minimum and maximum values\n\nmeasured for all five Baseline experiments approximates the minimum and maximum\n\nvalues measured for all five Treatment experiments. The data fails to indicate an overall\n\nstatistically slower task execution time during code collection, therefore the code collection\n\nscripts can be implemented on Internet-facing ICS devices.\n\n71\n\n\n-----\n\nTable 4.5: L32E Baseline vs. Treatment p-values (Bold indicates slower execution time).\n\n1769-L32E P-values\n\nFirmware version 16.23.15\n\nT1 T2 T3 T4 T5\n\nB1 0.894689469 0.00020002 0.204620462 0.711871187 0\n\nB2 0.171417142 0.0130013 **0.01790179** 0.093909391 0.00970097\n\nB3 0.792979298 0.00010001 0.188318832 0.627462746 0.00050005\n\nB4 0.718171817 0 0.433043304 0.874587459 0\n\nB5 0.512251225 0 0.654365437 0.630563056 0\n\nFirmware version 17.12.64\n\nT1 T2 T3 T4 T5\n\nB1 0.0180018 0 0 0 0\n\nB2 **0** **0.0040004** 0.757975798 0.498649865 **0.02470247**\n\nB3 0.157715772 0.789378938 0.00120012 0.01370137 0.383338334\n\nB4 **0** **0.00370037** 0.98819882 0.355835584 **0.02140214**\n\nB5 **0.00010001** **0.03090309** 0.493449345 0.885888589 0.126512651\n\nFirmware version 20.13.81\n\nT1 T2 T3 T4 T5\n\nB1 **0.00050005** **0** **0.00050005** 0.98659866 0.96969697\n\nB2 **0.02930293** **0.01820182** **0.04570457** 0.185318532 0.193719372\n\nB3 **0.00170017** **0.00040004** **0.00280028** 0.733073307 0.748974897\n\nB4 0.398539854 0.315131513 0.561256126 0.00460046 0.00570057\n\nB5 0.99469947 0.930493049 0.778077808 0.00080008 0.00080008\n\n72\n\n\n-----\n\n**4.3** **Implementation Results**\n\nThis section describes the results of implementing the methodology for distinguishing\n\nICS devices on a set of Internet-facing Allen-Bradley PLCs obtained from a Shodan search\n\nquery.\n\nThe process shown in Figure 3.1 is used to obtain a list of Internet-facing Allen\nBradley PLCs, determine CPU and CPU slot for each device, collect PLC code, check\n\nfor errors, and distinguish PLCs by groups of Process Control and Indeterminate devices.\n\n**_4.3.1_** **_Identifying Internet-facing ICS devices._**\n\nCollecting PLC code from Internet-facing ICS devices begins with developing a list\n\nof devices to interrogate. The search query used, “GoAhead index.html close”, is the\n\nsame used by Bodenheim in his research [5]. This query returns a list of Allen-Bradley\n\nCompactLogix and ControlLogix PLCs that have been previously indexed by Shodan.\n\nShodan returns a list shown in Figure 4.14 that is parsed to obtain a list of 540 target\n\nIP addresses.\n\nShodan responds to the query “GoAhead index.html close” with a list of indexed\n\nAllen-Bradley CompactLogix and ControlLogix PLCs. Shodan lists IP addresses for\n\neach device indexed along with the indexed response message matching the search query.\n\nShodan also allows registered users to access the Details view shown in Figure 4.15. The\n\nDetails view shows the service and response received for each instance Shodan indexed the\n\ndevice. The figure shows the last two instances where the device responded to a Shodan\n\nrequest on HTTP port 80, and also shows a response on EtherNet/IP port 44818. During the\n\ncourse of this research, it was discovered that Shodan is indexing more ports and protocols\n\nthan those listed in its documentation. Port 44818 is not advertised as a port that Shodan\n\nindexes, however, when entering the query “port:44818” into Shodan, a list is returned of\n\nevery Internet-facing device that responded to a Shodan request for port 44818. At the time\n\nof this research, Shodan has indexed 3608 devices on port 44818.\n\n73\n\n\n-----\n\nFigure 4.14: Process to Distinguish Internet-facing ICS Devices (Black boxes contain\n\nredacted information).\n\nShodan also provides a fee-based service where search results are exported to an XML\n\nfile. The XML file returns a set of metadata on each device including location based on\n\non IP registration, last update, port and response message indexed, and IP address. The\n\nXML file returned by Shodan for the query “GoAhead index.html close” listed 493 unique\n\nIP addresses for indexed devices. The next step is to extract a list of IP addresses using a\n\nsimple python script that parses XML and writes IP addresses to a text file used to collect\n\nDiagnostic Web Page data.\n\n74\n\n\n-----\n\nFigure 4.15: Registered User Details view for an ICS device cataloged by Shodan (IP\n\naddresses redacted).\n\n**_4.3.2_** **_Collecting Diagnostic Web Page Data._**\n\nA simple python script collects data from Diagnostic Web Pages on indexed PLCs.\n\nModule type and firmware revision for CompactLogix devices is collected from the Home\n\npage and the Browse Chassis page lists CPU, slot, and firmware version for ControlLogix\n\n75\n\n\n-----\n\ndevices. This information is parsed by the python script and written to a csv file used to\n\ncreate four CPU-specific configuration files used to obtain PLC code. 200 of the 493 IPs\n\nreturned by Shodan are Internet-facing Allen-Bradley PLCs, with 167 being PLCs using\n\nCPU families tested in this research: 1756-L6x, 1756-L7x, 1769-L23E, 1769-L32E/35E.\n\n**_4.3.3_** **_Collecting PLC Code._**\n\nThe python scripts developed for code collection are CPU-specific because each\n\nCPU returns data formatted in a different manner. PLC code collection scripts take in a\n\nconfiguration file listing IP addresses for CompactLogix PLCs and IP address, processor\n\nslot pairs for ControlLogix PLCs. Configuration files are taken from Diagnostic Web Page\n\ninformation and randomized using the Random.Org List Randomizer. Each code collection\n\nscript sends EtherNet/IP messages to a device and logs response messages and PLC code\n\ninto csv files. The script writes the raw EtherNet/IP protocol response message, then parses\n\nthe data field and writes the ASCII text string found in Attribute 1.\n\nThe scripts log errors when no data is received from PLC code requests, and in three\n\ncases responses are received with no data. These three devices are assumed to have no\n\nladder logic loaded into the PLC. Pilot testing shows that responses from these three devices\n\nmatch responses received from a PLC without PLC code. These three devices are not\n\nconsidered in the pool of error conditions.\n\nDuring PLC code collection, 10 errors are recorded. One device did not respond to\n\nany requests on port 80 or port 44818 and is assumed to be no longer connected to the\n\nInternet. Eight devices resulted in a connection timeout error and one device resulted in a\n\nconnection refused error.\n\n**_4.3.4_** **_Distinguishing ICS Devices._**\n\nThe names returned in Attribute 1 are reviewed by two researchers familiar with\n\nprocess control systems and PLC programming. The panel visually inspects the PLC code\n\nwritten for each device for process control terms. The presence of these process control\n\n76\n\n\n-----\n\nterms is assumed to indicate the device is controlling an industrial process, and the device\n\nis classified Process Control by the panel. The list of terms the panel identified in the\n\nProcess Control group are listed in Appendix 1.\n\nAfter the panel review, the PLC code is delivered to an ICS Engineer for expert review.\n\nThe engineer was given instructions to review the PLC code and try to determine if it is\n\ncontrolling an industrial process. The engineer was also asked to attempt to determine the\n\nindustrial sector that the device supports.\n\n**_4.3.5_** **_Analysis._**\n\nThe panel’s results selected 91 devices as Process Control and 63 devices as\n\nIndeterminate. This segregates the population of identified devices with 38% of Internet\nfacing ICS devices classified as Indeterminate.\n\nExpert analysis shows that it is possible to identify the specific sector associated with\n\na device using PLC code. The ICS engineer independently reviewing code selected 91\n\ndevices as Process Control, with a 100% match for each Process Control device selected\n\nby the panel. The ICS engineer also classified the sector or industrial category of 65 of the\n\n91 Process Control devices used. Figure 4.16 shows the results of categorizing devices by\n\nsector. The results indicate that this method distinguishes ICS devices not only by function,\n\nbut by industrial sector, including critical infrastructure. CI sectors represented include\n\nWater and Wastewater, Energy, Food and Agriculture, Transportation, and Commercial\n\nFacilities.\n\n**4.4** **Conclusion**\n\nStatistically significant differences are calculated when comparing individual runs,\n\nhowever the range of values obtained from Treatment runs are within the observed values\n\nobtained measuring Baseline runs. This demonstrates that making one CIP request per\n\n77\n\n\n-----\n\nFigure 4.16: Sector/Industrial Category Distribution of Process Control Devices.\n\nmeasurement cycle will not negatively impact task execution times on the PLC CPUs tested\n\nin this research.\n\n78\n\n\n-----\n\n**V.** **Conclusions**\n\n**5.1** **Conclusions**\n\nThis overall findings of this research shows that PLC code collected from an Internet\nfacing ICS device does not significantly impact PLC task execution times, and the PLC\n\ncode returned from the device is useful in distinguishing the device as to its function in a\n\nprocess control system. The initial detection rate of Process Control devices using a panel\n\nof ICS researchers yielded a 54% selection of Process Control PLCs.\n\nSubsequent analysis by an industry expert categorized the Process Control devices by\n\nthe sector or industrial category the device supports. This is an important and unexpected\n\ncapability provided by this methodology.\n\nThis research is exploratory in nature and the methods used for matching PLC code\n\nwith process control terms are very elementary. This indicates that this methodology can\n\nbe readily adapted to identify Internet-facing ICS systems.\n\n**5.2** **Impact**\n\nThis research demonstrates a significant impact to answering the question “So what?”\n\nwhen trying to understand the risk associated with Internet-facing ICS devices. The\n\nclassification by panel reduced the pool of ICS devices by 46%. Further review by industry\n\nexperts classified the devices by the industrial sector supported.\n\nThis research demonstrates the ability to identify Internet-facing ICS devices\n\ncontrolling physical industrial processes, and then classify those devices by the industrial\n\nsector they support. Current research has focused on the quantity of Internet-facing ICS\n\ndevices. This research accomplishes its goal of distinguishing ICS devices based on PLC\n\ncode, and futher demonstrates a method to distinguish Internet-facing ICS devices by\n\n79\n\n\n-----\n\nsector. This methodology establishes the ability to gain a deeper understanding of the\n\nrisk to critical infrastructure being incurred at the device level.\n\n**5.3** **Recommendations**\n\nNone of this research would be possible if PLC code could not be collected from\n\nan Internet-facing device. The most important act ICS administrators can take is to\n\nfollow NIST recommendations and remove any Internet connections from their ICS\n\nnetworks. Following NIST recommendations is currently voluntary, however, this should\n\nnot discourage ICS administrators from adhering to NIST recommendations.\n\nWhere Internet connections are determined to be a requirement by ICS administrators,\n\nthe employment of network security appliances such as firewalls is essential. One device\n\nof the 164 interrogated returned a Connection Refused error message. It is likely that port\n\n44818 is open on this device, however, a firewall is configured to block inbound traffic on\n\nthat port. This stopped the PLC code collection script from successfully getting any CIP\n\nrequests to the PLC.\n\nFinally, the lack of authentication in the EtherNet/IP or CIP protocols allows the\n\nscripts used in this research to send CIP commands to any Internet-facing PLC and have the\n\nPLC execute those commands. While legacy equipment and procedures is at the core of ICS\n\nsecurity issues, an ICS application layer protocol with security features like authentication\n\nbuilt-in would dramatically increase the security of any ICS device which is able to be\n\ndiscovered on an Internet connection.\n\n**5.4** **Future Work**\n\n**_5.4.1_** **_Machine Learning and Process Control Term Matching._**\n\nThe exploratory nature of this research leaves room for improvement. Visually\n\ninspecting code and qualitatively distinguishing Internet-facing ICS devices can be\n\nimproved by exploring the use of machine learning techniques to distinguish these devices.\n\n80\n\n\n-----\n\nFuture research can use machine learning to develop algorithms that use process control\n\nterms to match PLC code and select devices based on different metric such as assigning\n\nweight to the values of select process control terms or establishing a threshold value for a\n\nminimum number of matched terms.\n\n**_5.4.2_** **_Distinguishing Internet-facing ICS Devices by Sector._**\n\nThis research demonstrated the ability to use PLC code to distinguish Internet-facing\n\nICS devices by function and use industry experts to classify devices by sector. Further\n\nresearch can make use of the methodology in this research and build sector-specific process\n\ncontrol term lists and explore the ability to identify other critical infrastructure sectors.\n\nIndustry experts use years of experience to make qualitative decisions supporting the\n\nclassification of these devices. Using current analytic methods such as machine learning\n\nmay provide automated methods of replicating those qualitative decisions.\n\nInferences cannot be made from this data alone. The ICS engineer called on 25 years\n\nexperience to categorize device by sector. The engineer is also limited by geographical\n\nregion and types of sectors supported. Further study is required to identify additional\n\nfactors in sector distribution. The data shows a large proportion of wastewater systems,\n\nhowever the causal relationship cannot be determined. Allen-Bradley PLCs may be more\n\ncommon in wastewater systems, or confirmation bias on the part of the ICS engineer may\n\nhave inflated the wastewater categorization count.\n\n**_5.4.3_** **_Determining Methodology Portability._**\n\nThis researched focused solely on Allen-Bradley PLCs, however there are other\n\nmanufacturers of ICS devices represented in the Shodan search engine. Future research\n\ncan expand the scope of PLCs tested to determine if the results of this research’s success\n\nrate translates for other manufacturer’s devices.\n\n81\n\n\n-----\n\n**5.5** **Summary**\n\nShodan demonstrated that despite popular belief, ICS devices are connected to the\n\nInternet. Researchers and security professionals began enumerating ICS devices found\n\nin Shodan and media reports started generating concern regarding possibilities of critical\n\ninfrastructure attacks on these Internet-facing devices. This research distinguishes the\n\nfunction of Internet-facing ICS devices in regards to Internet-facing ICS devices. Using a\n\nnovel method to collect PLC programming information to distinguish PLCs, this research\n\nis able to distinguish Internet-facing ICS devices by function and industrial sector.\n\n82\n\n\n-----\n\n**Appendix A: 1: Process Control Terms**\n```\nRecycle_WW\nSludge_Transfer_Pumps\nFlow_Totalizer_Cont\nWell_Data_S6CP\nRoutine:B_Level_Controller\nRoutine:B_Mixer_Alarms\nRoutine:B_Pump_Alarms\nControl\nFCV_1010_High_Flow_SP\nFCV_1010_Low_Flow_SP\nProgram_Control\nBell_Sounds_Before_P15_Moves\nE_STOP_1ST_CONV\nHMI_JOG_MAIN_SLAT_PB\nMap:Controller\nP17_Conveyor_Move_Complete\nP3_READY_TO_XFER_TO_P5_PE5\nPAUSE_MAIN_SLAT\nRESPONSE_FROM_SMTP_SERVER\nSAFETY_RESET\nSTACKER_DOOR_E_STOP\nSTART_SWITCH_P1\nVFD1_OUTPUT_VOLTAGE\nVFD2_INPUT_VOLTAGE\nRoutine:VFD1_STATUS\nRoutine:_2_MAIN_CNTRL\nRoutine:_40_STRT_STOP\nRoutine:_61_STACKER\nFIFO_CONTROL\nPV_NOM_SPEED_DOWN_PB\nPV_NOM_SPEED_UP_PB\nPV_RECIPE_MOVE_UP_OS\nVFD1_OUTPUT_WATTS\nAuxilliary_Shut_Down\nEngine_Pumps_Shut_Down\nRemote_Reset_RedLion\nRoutine:AFR_Control_PID\nRoutine:Engine_Start_Stop_Run\nStart_Fuel_Timer1\nCond_VFD_2_Bypass\n\n```\n83\n\n\n-----\n\n```\nCondensing_SetPt_Calcs\nEvap_16_Fan_Current_Relay\nEvap_27_Fan_VFD_Run_Confirm\nFloor_Heat_Control_Temp\nGlycol_Tank_Temp\nLT_Comp1_Current_Switch\nLT_Comp1_Low_Pressure_Control\nMT_Comp3_Crankcase_Heater\nMOV1302_Open_Status\nMOV301A_Closed_Status\nP300_VFD_Frequency_Command\nP300_VFD_Run_Command\nSK205_ModbusTCP_Error_Code\nShipping_Oil_To_Sinclair_Active\nStart_P301_Pump\nCHILLER_SETPOINT\nCONTAINER_CUT_SYSTEM_GALLONS\nEMPTY_Water_Separator\nDetergent_Tank_Prep_Timer\nFlow_Meter_Control\nMMI_SYRUP_TANK_START_FILL\nRoutine:FILLER\nRoutine:PID_FILLER\nCond_B1_VFD1_Bypass\nCond_B1_VFD_Run_Fans_1_3_5_7\nAS_Lower_Final_Pallet_Stop\nAS_Rbt_OK_to_Place\nLD_Door_3_Open\nLD_Door_Lock_2\nOF_Enable_Pallet_Conveyor\nRoutine:H1_Conveyor\nRoutine:_SelectBufferLev\nAlm_N1J_MotorStarterFlt\nTPAControl_\nCrPs_Flow_Low\nCrPs_Flow_Scaled_AI\n_PumpControl_Lag_Start_ONS\nRoutine:Motor_Operated_Valves\nRoutine:SBR_PumpControl\nZ_DO_PMP0001_CommandStart\nZ_ValueSlowScanFromScada\nRoutine:Booster_Processing\nRoutine:MTR_PUMPS_Valencia_Send\n\n```\n\n84\n\n\n-----\n\n```\nRoutine:Valencia_AO_PID_Out\nProgram:HartProgram\nCribPump1\nChlorineLeakAlm1\nOverride\nRoutine:CribPumpControl\nCribAutoToggle\nA400_3_Jog\nC111_AtSpeed\nC111_Active\nV100_2_AtSpeed\nV101_Start\nV102_2_Stop\nRoutine:PowerUpMain\nRoutine:PanelView\nPV_PB_V106_2_Rev\nPV_PB_V106_2_Fwd\nCOMP01_START_MODE\nEC06_FAN2_OVERLOAD\nEC06_FAN2_VFD_SPEED\nFreezer1980_AU2C_2D_ENABLE_SW\nP1_COND5_PUMP_PUMP_OFF\nInfeed_Speed_Ratio\nPacker_Run\nPackerJogging\nServoDriveEnabled\nVFD19_BottleTurner:I\nVFD19_BottleTurner:O\nRoutine:Glue_Control\nRoutine:TrayControl\nSkid_B_Backwash_Step4\npv_Aeration_Level_Setpoint3_Max\npv_Turbidity_Alarm_SP\nRoutine:Anoxic_Tank_Mixing_System\nRoutine:Aeration_Tank_Denite_Pump\nRoutine:SV_Solenoid_Control\nProgram:Conveyor_Control\nProgram:Traffic_Control\nProgram:Physical_IO\nRoutine:Car_Positioning\nRoutine:Deliver_Loads\nRoutine:Laser_Positioning\nAuto_Car_Forward\n\n```\n\n85\n\n\n-----\n\n```\nA_TurretDriveJogSpeed_WRT\nB_TorqueRequired\nHydraulicPumpKeepOnONS\nRecipeTransferCancel\nRollExtractorDownMessageBit\nRoutine:Cantilvered_Arm_Logic\nRoutine:Knives_Bed_Control\nCenter_Seal_Top_Pressure\nFoldedFilm1_Brake_CV_Auto\nFoldedFilm1_Brake_PID_OUT\nTemp_PortSeal_when_TempOK\nRoutine:A01_PortSealSequence\nDistanceinPRTuntoFinssesTun_HMI\nMap:PF400_SprayBoothNorthwestRecircFan_VFD\nRoutine:Process_Message\nRoutine:VFD_Comms\nChilledWaterPump\nCausticWastePump\nCom_CDMA_Initiate\nCom_Disable\nRoutine:RSP_PID_Routine\nEnable_Full_Speed_Cmd\nCC_COMMUNITOR_RUN\nCC_GEN_RUN\nCRWNCT_PMP1_RUN_DI\nFlouride_Tank_Scale\nPumps_Start\nVent_Flouride\nRoutine:_010A_Tower_Control\nRoutine:_600B_Flouride_DT_Pump\nBridge_Opening\nOk_To_Open_Bridge\nRoutine:Watchdog\nBioxie_Tank_Filling_Latch\nMap:WASTEWATER_PUMP_1\nPLC_IO_Status_HMI_1\nWASTEWATER_PUMP_1:O\nWASTEWATER_PUMP_2:I\nRoutine:TRANSFER_SWITCH\nRoutine:FeedLine\nRoutine:_DefoamerPump\nFCV2MSG\nProgram:FlowControlValve\n\n```\n86\n\n\n-----\n\n```\nPUMP10_STOP\nOUTLET_VALVE_OPEN_COMMAND\nRoutine:WASTE_TRANSFER\nProgram:E_STOP_ZONE_1\nRoutine:Interlock_Override\nRoutine:MotorControl_Z1\nRoutine:LakeWater_Pump_Speed\nRoutine:Scale_Analog_Outputs\nRoutine:Lead_pump_select\nRoutine:Wet_well_alarms\nRoutine:Aborting\nRoutine:ANIONIC_POLYMER_CTRL\nBACKWASH_AVIVOEN\nRoutine:_713_Robot_1_Send_Data\nRoutine:_711_Robot_1_Cycle_Start\nA21_Regulator_Position_Value\nRoutine:SCADA_Mapping\nBatch_Control_Load_Valve_Open_Request\nRoutine:Rail_Loading\nRoutine:Modbus_Comms\nRoutine:M17_Heavies_Picking_Conveyor\nRoutine:Start_Up\nRoutine:System_Pause\nRoutine:B1_LOAD_XFR_ROUTINE\nRoutine:Filter_102_Auto_BW_mode_startup\nRoutine:F101_Backwash_pump\nAutoSetSlowDown\nProgram:PIDExecution\nRoutine:F1_Backwash_Abort\nBackwash1_Control\nRoutine:T2_BACKFLUSH\nRoutine:A15_Load_Control\nM203_OK_TO_RUN\nOverHead_One_Shot\n\n```\n87\n\n\n-----\n\n**Appendix B: 2: List of Boxplots**\n\nFigure B.1: Boxplot for L61 v16.56.47.\n\n88\n\n\n-----\n\nFigure B.2: Boxplot for L61 v19.11.56.\n\nFigure B.3: Boxplot for L61 v20.11.59.\n\n89\n\n\n-----\n\nFigure B.4: Boxplot for L71 v20.11.59.\n\nFigure B.5: Boxplot for L71 v20.12.79.\n\n90\n\n\n-----\n\nFigure B.6: Boxplot for L71 v20.13.81.\n\nFigure B.7: Boxplot for L23E v17.7.63.\n\n91\n\n\n-----\n\nFigure B.8: Boxplot for L23E v18.12.57.\n\nFigure B.9: Boxplot for L23E v19.11.16.\n\n92\n\n\n-----\n\nFigure B.10: Boxplot for L32E v16.23.15.\n\nFigure B.11: Boxplot for L32E v17.12.64.\n\n93\n\n\n-----\n\nFigure B.12: Boxplot for L32E v20.13.81.\n\n94\n\n\n-----\n\n**Bibliography**\n\n[1] The Role of Authenticated Communications for Electric Power Distribution. Technical report, Pacific Northwest National Laboratory. URL http://www.science.upm.ro/\n\n∼traian/web curs/Scada/docum/SCADA archit.pdf.\n\n[2] EtherNet/IP _-_ _CIP_ _on_ _Ethernet_ _Technology._ Technical report, ODVA,\n2008. URL http://www.odva.org/Portals/0/Library/Publications Numbered/\nUB00138R3 CIP Adv Tech Series EtherNetIP.pdf.\n\n[3] The Shamoon Attacks. Technical report, Symantec, 2012. URL http://www.symantec.\ncom/connect/blogs/shamoon-attacks.\n\n[4] SHODAN - Computer Search Engine. Technical report, SHODAN, 2014. URL\nhttp://http://www.shodanhq.com/help/filters.\n\n[5] Bodenheim, Roland C. Impact of the Shodan Computer Search Engine on Internet_facing Industrial Control System Devices._ Master’s thesis, Air Force Institute of\nTechnology, 2014.\n\n[6] Brooks, Paul. _EtherNet/IP: Industrial Protocol White Paper._ Technical report,\nRockwell Automation, 2001. URL http://literature.rockwellautomation.com/idc/\ngroups/literature/documents/wp/enet-wp001 -en-p.pdf.\n\n[7] Clements, Sam. “Is Shodan Really The World’s Most Dangerous Search Engine?”, 2013. URL http://www.vice.com/en uk/read/\nshodan-exposes-the-dark-side-of-the-net.\n\n[8] Department of Homeland Security. “A Guide to Critical Infrastructure and Key\nResources Protection at the State, Regional, Local, Tribal and Territorial Level”,\n2008.\n\n[9] Department of Homeland Security. “National Infrastructure Protection Plan”, 2009.\n\n[10] Dunlap, Stephen J. Timing-based Side Channel Analysis for Anomoly Detection in\n_the Industrial Control System Environment. Master’s thesis, Air Force Institute of_\nTechnology, 2013.\n\n[11] Falliere, Nicolas. _Exploring Stuxnets PLC Infection Process._ Technical report, Symantec, 2010. URL http://www.symantec.com/connect/blogs/\nexploring-stuxnet-s-plc-infection-process.\n\n[12] Fidelis Cybersecurity Solutions. _Fidelis Threat Advisory #1012 Gathering in the_\n_Middle East, Operation STTEAM. Technical report, General Dynamics, 2014. URL_\nhttp://www.fidelissecurity.com/webfm send/377.\n\n95\n\n\n-----\n\n[13] Goldman, David. “Shodan: The scariest search engine on the Internet”, 2013. URL\n\nhttp://money.cnn.com/2013/04/08/technology/security/shodan/.\n\n[14] Higgins, Kelly Jackson. “Utilities Facing Brute-Force Attack\nThreat”, 2012. URL http://www.darkreading.com/attacks-breaches/\nutilities-facing-brute-force-attack-thre/232600345.\n\n[15] Higgins, Kelly Jackson. _’Project SHINE’ Illuminates Sad State Of SCADA/ICS_\n_Security On The Net._ Technical report, Dark Reading, 2013. URL http://www.\ndarkreading.com/vulnerability/project-shine-illuminates-sad-state-of-s/240162739.\n\n[16] Higgins, Kelly Jackson. “Oil & Gas Firms Targeted In Web Server\nHacks”, 2014. URL http://www.darkreading.com/attacks-breaches/\noil-gas-firms-targeted-in-web-server-ha/240166515.\n\n[17] Hill, Kashmir. “The Terrifying Search Engine That Finds Internet-Connected\nCameras, Traffic Lights, Medical Devices, Baby Monitors and Power\nPlants”, 2013. URL http://www.forbes.com/sites/kashmirhill/2013/09/04/\nshodan-terrifying-search-engine/.\n\n[18] Kalapatapu, Rao. “SCADA Protocols and Communication Trends”. ISA2004, 2004.\n\n[19] Leverett, Eireann P. Quantitatively Assessing and Visualizing Industrial System Attack\n_Surfaces. Master’s thesis, University of Cambridge, 2011._\n\n[20] National Institute of Standards and Technology. “Guide to Industrial Control Systems\n(ICS) Security Special Publication 800-82”, 2011.\n\n[21] Peterson, Dale G. “S4 Video: Denial of Surface ICS on the Internet”, 2012. URL https://www.digitalbond.com/blog/2012/02/09/\ns4-video-denial-of-surface-ics-on-the-internet/.\n\n[22] Radvanovsky, Bob. “Shining a Light on a Big Problem”, 2013. URL http://www.tofinosecurity.com/blog/\nproject-shine-1000000-internet-connected-scada-and-ics-systems-and-counting.\n\n[23] Rockwell Automation. “Comparing performance of L7x vs L6x using\nLogix5000 Task Monitor tool”, 2011. URL https://www.rockwellautomation.\ncom/resources/downloads/rockwellautomation/pdf/solutions/integrated-architecture/\nLogixTaskMonitorInstruction.pdf.\n\n[24] Rockwell Automation. “Optimize Productivity with RSLogix 5000 Design and\nConfiguration Software”, 2011. URL http://literature.rockwellautomation.com/idc/\ngroups/literature/documents/pp/9324-pp001 -en-p.pdf.\n\n[25] Rockwell Automation. “ControlLogix System. Rockwell Automation Publication\n1756-SG001R-EN-P”, 2012. URL http://literature.rockwellautomation.com/idc/\ngroups/literature/documents/sg/1756-sg001 -en-p.pdf.\n\n96\n\n\n-----\n\n[26] Rockwell Automation. “Logix5000 Controllers IEC 61131-3 Compliance”, 2012.\n\n[27] Rockwell Automation. “CompactLogix System. Rockwell Automation Publication\n1769-SG001P-EN-P”, 2014. URL http://literature.rockwellautomation.com/idc/\ngroups/literature/documents/sg/1769-sg001 -en-p.pdf.\n\n[28] Schearer, Michael. “SHODAN for Penetration Testers”, 2010. URL\nhttps://www.defcon.org/images/defcon-18/dc-18-presentations/Schearer/\nDEFCON-18-Schearer-SHODAN.pdf.\n\n[29] Schuett, Carl D. Programmable Logic Controller Modification Attacks for use in\n_Detection Analysis. Master’s thesis, Air Force Institute of Technology, 2014._\n\n[30] Schwartz, Moses D., John Mulder, and William D. Trent, Jason & Atkins. Control\n_System Devices: Architectures and Supply Channels Overview._ Technical report,\nSandia National Laboratories, 2010.\n\n[31] Voss, Katherine. _The CIP Advantage:_ _Proven and Future-Proof, CIP Pro-_\n_vides a Unified Architecture for Delivering Standards-Based Open Network-_\n_ing Technologies Throughout the Enterprise._ Technical report, ODVA, 2008.\nURL http://www.odva.org/Portals/0/Library/Publications Numbered/PUB00072R0\nCIP Advantage Technical Paper.pdf.\n\n[32] Weiss, Gus W. “The Farewell Dossier”, 2007. URL https://www.cia.gov/library/\ncenter-for-the-study-of-intelligence/csi-publications/csi-studies/studies/96unclass/\nfarewell.htm.\n\n[33] Wilhoit, Kyle. “The SCADA That Didnt Cry Wolf. Whos Really Attacking Your\nICS Equipment? (Part 2)”, 2013. URL http://www.trendmicro.com/cloud-content/us/\npdfs/security-intelligence/white-papers/wp-the-scada-that-didnt-cry-wolf.pdf.\n\n[34] Wilhoit, Kyle. “Whos Really Attacking Your ICS Equipment?”, 2013.\nURL http://www.trendmicro.com/cloud-content/us/pdfs/security-intelligence/\nwhite-papers/wp-whos-really-attacking-your-ics-equipment.pdf.\n\n[35] Zetter, Kim. “10K Reasons to Worry About Critical Infrastructure”, 2012. URL\n\nhttp://www.wired.com/threatlevel/2012/01/10000-control-systems-online/.\n\n97\n\n\n-----\n\n_pp_\n### REPORT DOCUMENTATION PAGE\n_OMB No. 0704–0188_\n\nThe public reporting burden for this collection of information is estimated to average 1 hour per response, including the time for reviewing instructions, searching existing data sources, gathering and\nmaintaining the data needed, and completing and reviewing the collection of information. Send comments regarding this burden estimate or any other aspect of this collection of information, including\nsuggestions for reducing this burden to Department of Defense, Washington Headquarters Services, Directorate for Information Operations and Reports (0704–0188), 1215 Jefferson Davis Highway,\nSuite 1204, Arlington, VA 22202–4302. Respondents should be aware that notwithstanding any other provision of law, no person shall be subject to any penalty for failing to comply with a collection\nof information if it does not display a currently valid OMB control number. **PLEASE DO NOT RETURN YOUR FORM TO THE ABOVE ADDRESS.**\n\n**1. REPORT DATE (DD–MM–YYYY) 2. REPORT TYPE** **3. DATES COVERED (From — To)**\n\n19–06–2014 Master’s Thesis Jan 2013–Jun 2014\n\n**4. TITLE AND SUBTITLE** **5a. CONTRACT NUMBER**\n\n**5b. GRANT NUMBER**\n\nDistinguishing Internet-facing ICS devices using PLC programming\ninformation\n\n**5c. PROGRAM ELEMENT NUMBER**\n\n**6. AUTHOR(S)** **5d. PROJECT NUMBER**\n\n**5e. TASK NUMBER**\n\nWilliams, Paul M., Major, USA\n\n**5f. WORK UNIT NUMBER**\n\n**7. PERFORMING ORGANIZATION NAME(S) AND ADDRESS(ES)** **8. PERFORMING ORGANIZATION REPORT**\n**NUMBER**\n\nAir Force Institute of Technology\nGraduate School of Engineering and Management (AFIT/EN)\n2950 Hobson Way AFIT-ENG-T-14-J-41\nWPAFB, OH 45433-7765\n\n**9. SPONSORING / MONITORING AGENCY NAME(S) AND ADDRESS(ES)** **10. SPONSOR/MONITOR’S ACRONYM(S)**\n\nIntentionally Left Blank **11. SPONSOR/MONITOR’S REPORT**\n\n**NUMBER(S)**\n\n**12. DISTRIBUTION / AVAILABILITY STATEMENT**\nDISTRIBUTION STATEMENT A:\nAPPROVED FOR PUBLIC RELEASE; DISTRIBUTION UNLIMITED\n\n**13. SUPPLEMENTARY NOTES**\nThis work is declared a work of the U.S. Government and is not subject to copyright protection in the United States.\n\n**14. ABSTRACT**\nThe Shodan search engine reveals Industrial Control System (ICS) devices around the globe are directly connected to the\nInternet. After Shodan’s inception in 2009, multiple news reports have focused on the increased threat to infrastructure\nposed by Shodan. While no attacks to date have been directly attributed to Shodan searches, its existence provides an\nanonymous reconnaissance platform that facilitates ICS targeting for those actors with both a desire and capability\nto carry out attacks. Recent research has demonstrated that simple search queries return thousands of ICS devices\nindexed by Shodan, and the number of newly indexed ICS devices is growing. This research discusses the method used\nto distinguish the Internet-facing ICS devices indexed by the Shodan search engine. PLC code is obtained by sending\nspecifically crafted CIP request messages to the devices, capitalizing on the fact that authentication is not built in\nto the CIP application layer protocol. This data allows categorization of Internet-facing devices by comparing PLC\ncode attributes. The results of this research show PLC code can be collected from Internet-facing ICS devices with no\nsignificant impact to task execution times. Also, this research demonstrates a method to distinguish Internet-facing ICS\ndevices by function and by Critical Infrastructure sector. This capability develops an understanding of the function and\npurpose of ICS devices that are being connected to the Internet.\n\n**15. SUBJECT TERMS**\nSCADA ICS SHODAN Critical Infrastructure Allen-Bradley Distinguishing Internet-facing PLC\n\n**16. SECURITY CLASSIFICATION OF:** **17. LIMITATION OF** **18. NUMBER** **19a. NAME OF RESPONSIBLE PERSON**\n\n**b. ABSTRACT c. THIS PAGE** **ABSTRACT** **OF** Maj Jonathan W. Butts (ENG)\n\n**PAGES**\n\n**19b. TELEPHONE NUMBER (include area code)**\n\nU U U UU 114 (937) 255-3636 x4332 Jonathan.Butts@afit.edu\n\n|The public reporting burden for this collection of information is estimated to average 1 hour per response, including the time for reviewing instructions, searching existing data sources, gathering and maintaining the data needed, and completing and reviewing the collection of information. Send comments regarding this burden estimate or any other aspect of this collection of information, including suggestions for reducing this burden to Department of Defense, Washington Headquarters Services, Directorate for Information Operations and Reports (0704–0188), 1215 Jefferson Davis Highway, Suite 1204, Arlington, VA 22202–4302. Respondents should be aware that notwithstanding any other provision of law, no person shall be subject to any penalty for failing to comply with a collection of information if it does not display a currently valid OMB control number. PLEASE DO NOT RETURN YOUR FORM TO THE ABOVE ADDRESS.|Col2|Col3|Col4|\n|---|---|---|---|\n|1. REPORT DATE (DD–MM–YYYY) 19–06–2014|2. REPORT TYPE Master’s Thesis||3. DATES COVERED (From — To) Jan 2013–Jun 2014|\n|4. TITLE AND SUBTITLE Distinguishing Internet-facing ICS devices using PLC programming information||5a. CONTRACT NUMBER||\n|||5b. GRANT NUMBER||\n|||5c. PROGRAM ELEMENT NUMBER||\n|6. AUTHOR(S) Williams, Paul M., Major, USA||5d. PROJECT NUMBER||\n|||5e. TASK NUMBER||\n|||5f. WORK UNIT NUMBER||\n|7. PERFORMING ORGANIZATION NAME(S) AND ADDRESS(ES) Air Force Institute of Technology Graduate School of Engineering and Management (AFIT/EN) 2950 Hobson Way WPAFB, OH 45433-7765|||8. PERFORMING ORGANIZATION REPORT NUMBER AFIT-ENG-T-14-J-41|\n|9. SPONSORING / MONITORING AGENCY NAME(S) AND ADDRESS(ES) Intentionally Left Blank|||10. SPONSOR/MONITOR’S ACRONYM(S)|\n||||11. SPONSOR/MONITOR’S REPORT NUMBER(S)|\n|12. DISTRIBUTION / AVAILABILITY STATEMENT DISTRIBUTION STATEMENT A: APPROVED FOR PUBLIC RELEASE; DISTRIBUTION UNLIMITED||||\n|13. SUPPLEMENTARY NOTES This work is declared a work of the U.S. Government and is not subject to copyright protection in the United States.||||\n|14. ABSTRACT The Shodan search engine reveals Industrial Control System (ICS) devices around the globe are directly connected to the Internet. After Shodan’s inception in 2009, multiple news reports have focused on the increased threat to infrastructure posed by Shodan. While no attacks to date have been directly attributed to Shodan searches, its existence provides an anonymous reconnaissance platform that facilitates ICS targeting for those actors with both a desire and capability to carry out attacks. Recent research has demonstrated that simple search queries return thousands of ICS devices indexed by Shodan, and the number of newly indexed ICS devices is growing. This research discusses the method used to distinguish the Internet-facing ICS devices indexed by the Shodan search engine. PLC code is obtained by sending specifically crafted CIP request messages to the devices, capitalizing on the fact that authentication is not built in to the CIP application layer protocol. This data allows categorization of Internet-facing devices by comparing PLC code attributes. The results of this research show PLC code can be collected from Internet-facing ICS devices with no significant impact to task execution times. Also, this research demonstrates a method to distinguish Internet-facing ICS devices by function and by Critical Infrastructure sector. This capability develops an understanding of the function and purpose of ICS devices that are being connected to the Internet.||||\n|15. SUBJECT TERMS SCADA ICS SHODAN Critical Infrastructure Allen-Bradley Distinguishing Internet-facing PLC||||\n|16. SECURITY CLASSIFICATION OF:||19a. NAME OF RESPONSIBLE PERSON Maj Jonathan W. Butts (ENG)||\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/ICS SCADA/ICS Vulnerabilities/AFIT - Distinguishing Internet-Facing ICS Devices.pdf"
    ],
    "report_names": [
        "AFIT - Distinguishing Internet-Facing ICS Devices.pdf"
    ],
    "threat_actors": [
        {
            "id": "873a6c6f-a4d1-49b3-8142-4a147d4288ef",
            "created_at": "2022-10-25T16:07:23.455744Z",
            "updated_at": "2025-03-27T02:02:09.811933Z",
            "deleted_at": null,
            "main_name": "Chimera",
            "aliases": [
                "Operation Skeleton Key"
            ],
            "source_name": "ETDA:Chimera",
            "tools": [
                "Agentemis",
                "Cobalt Strike",
                "CobaltStrike",
                "SkeletonKeyInjector",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "c91e335e-42be-48d9-96b5-ba56749a723b",
            "created_at": "2022-10-25T16:07:23.458346Z",
            "updated_at": "2025-03-27T02:02:09.813395Z",
            "deleted_at": null,
            "main_name": "CIA",
            "aliases": [
                "Central Intelligence Agency"
            ],
            "source_name": "ETDA:CIA",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "77b28afd-8187-4917-a453-1d5a279cb5e4",
            "created_at": "2022-10-25T15:50:23.768278Z",
            "updated_at": "2025-03-27T02:00:55.5423Z",
            "deleted_at": null,
            "main_name": "Inception",
            "aliases": [
                "Inception Framework",
                "Cloud Atlas"
            ],
            "source_name": "MITRE:Inception",
            "tools": [
                "PowerShower",
                "VBShower",
                "LaZagne"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "f88b16bc-df4b-48e7-ae35-f4117240ff24",
            "created_at": "2022-10-25T15:50:23.556699Z",
            "updated_at": "2025-03-27T02:00:55.499173Z",
            "deleted_at": null,
            "main_name": "Chimera",
            "aliases": [
                "Chimera"
            ],
            "source_name": "MITRE:Chimera",
            "tools": [
                "PsExec",
                "esentutl",
                "Mimikatz",
                "Cobalt Strike"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "f9806b99-e392-46f1-9c13-885e376b239f",
            "created_at": "2023-01-06T13:46:39.431871Z",
            "updated_at": "2025-03-27T02:00:03.08926Z",
            "deleted_at": null,
            "main_name": "Watchdog",
            "aliases": [
                "Thief Libra"
            ],
            "source_name": "MISPGALAXY:Watchdog",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535853,
    "ts_updated_at": 1743041819,
    "ts_creation_date": 1402043974,
    "ts_modification_date": 1403602231,
    "files": {
        "pdf": "https://archive.orkl.eu/aa479b9b31c0ae40437f7c2a9de84c54983003ba.pdf",
        "text": "https://archive.orkl.eu/aa479b9b31c0ae40437f7c2a9de84c54983003ba.txt",
        "img": "https://archive.orkl.eu/aa479b9b31c0ae40437f7c2a9de84c54983003ba.jpg"
    }
}