{
    "id": "d085ec32-0922-462a-b579-51b2b045ccb9",
    "created_at": "2023-01-12T15:04:28.091708Z",
    "updated_at": "2025-03-27T02:08:41.439915Z",
    "deleted_at": null,
    "sha1_hash": "c5ee8536b6ba9ff7ec40012ef6124b6b59d99231",
    "title": "2022-12-23 - IcedID Botnet Distributors Abuse Google PPC to Distribute Malware",
    "authors": "",
    "file_creation_date": "2022-12-29T00:40:01Z",
    "file_modification_date": "2022-12-29T00:40:01Z",
    "file_size": 2091866,
    "plain_text": "# IcedID Botnet Distributors Abuse Google PPC to Distribute Malware\n\n**[trendmicro.com/en_ie/research/22/l/icedid-botnet-distributors-abuse-google-ppc-to-distribute-malware.html](https://www.trendmicro.com/en_ie/research/22/l/icedid-botnet-distributors-abuse-google-ppc-to-distribute-malware.html)**\n\n23 December 2022\n\nContent added to Folio\n\nMalware\n\nWe analyze the latest changes in IcedID botnet from a campaign that abuses Google pay\nper click (PPC) ads to distribute IcedID via malvertising attacks.\n\nBy: Ian Kenefick\nDecember 23, 2022\nRead time: ( words)\n\n[After closely tracking the activities of the IcedID botnet, we have discovered some significant](https://www.trendmicro.com/vinfo/tmr/?/us/security/news/cybercrime-and-digital-threats/icedid-banking-trojan-targets-us-financial-institutions)\nchanges in its distribution methods. Since December 2022, we observed the abuse of\n[Google pay per click (PPC) ads to distribute IcedID via malvertising attacks. This IcedID](https://www.trendmicro.com/vinfo/tmr/?/us/security/news/cybercrime-and-digital-threats/malvertising-when-online-ads-attack)\nvariant is detected by Trend Micro as TrojanSpy.Win64.ICEDID.SMYXCLGZ.\n\n\n-----\n\n[Advertising platforms like Google Ads enable businesses to display advertisements to target](https://ads.google.com/intl/en_us/home/?pli=1#!/)\naudiences for the purpose of boosting traffic and increasing sales. Malware distributors\nabuse the same functionality in a technique known as malvertising, wherein chosen\nkeywords are hijacked to display malicious ads that lure unsuspecting search engine users\nto downloading malware.\n\nIn our investigation, malicious actors used malvertising to distribute the IcedID malware via\ncloned webpages of legitimate organizations and well-known applications. Recently, the\n[Federal Bureau of Investigation (FBI) published a warning pertaining to how cybercriminals](https://www.ic3.gov/Media/Y2022/PSA221221)\nabuse search engine advertisement services to imitate legitimate brands and direct users to\nmalicious sites for financial gain.\n\nOur blog entry provides the technical details of IcedID botnet’s new distribution method and\nthe new loader it uses.\n\nTechnical analysis\n\n[Organic search results are those generated by the Google PageRank algorithm, whereas](https://www.semrush.com/blog/pagerank/)\n[Google Ads appear in more prominent locations above, beside, below, or with the organic](https://support.google.com/google-ads/answer/1704373?hl=en#:~:text=They%20can%20appear%20beside%2C%20above,websites%20of%20Google%20search%20partners.)\nsearch results. When these ads are hijacked by malicious actors via malvertising, they can\nlead users to malicious websites.\n\nTargeted brands and applications\n\nIn our investigation, we discovered that IcedID distributors hijacked the keywords used by\nthese brands and applications to display malicious ads:\n\n1. Adobe – A computer software company\n2. AnyDesk - A remote control application\n3. Brave Browser - A web browser\n4. Chase Bank - A banking application\n5. Discord - An instant messenger service\n6. Fortinet - A security company\n7. GoTo - A remote control application\n8. Libre Office - An open-source alternative to Microsoft Office\n9. OBS Project - A streaming application\n10. Ring - A home CCTV (closed-circuit) manufacturer\n\n11. Sandboxie - A virtualization/sandbox application\n12. Slack - An instant messaging application\n13. Teamviewer - A remote control application\n14. Thunderbird - An email client\n15. US Internal Revenue Service (IRS) – A US federal government body\n\n\n-----\n\nThe malicious websites where victims are directed are made to look like their legitimate\ncounterparts. Figure 1 shows a legitimate-looking malicious Slack webpage used by IcedID\ndistributors to lure victims into downloading malware.\n\nFigure 1. A legitimate-looking malicious Slack webpage used by IcedID distributors\nInfection chain\n\nThe overall infection flow involves delivering the initial loader, fetching the bot core, and\nultimately, dropping the payload. The payload is typically a backdoor.\n\nFigure 2. IcedID botnet malware infection chain\n**Infection via malvertising**\n\n1. A user searches for an application by entering a search term on Google. In this\n\nparticular example, the user wants to download the AnyDesk application and enters the\nsearch term “AnyDesk” on the Google search bar.\n2. A malicious ad for the AnyDesk application that leads to a malicious website is\n\ndisplayed above the organic search results.\n\n\n-----\n\n3. IcedID actors abuse the legitimate Keitaro Traffic Direction System (TDS), to filter\n\nresearcher and sandbox traffic. The victim is then redirected to a malicious website.\n4. Once the user selects the “Download” button, it downloads a malicious Microsoft\n\nSoftware Installer (MSI) or Windows Installer file inside a ZIP file in the user’s system.\n\n\n-----\n\nFigure 3. IcedID botnet malvertising infection chain\n**The new IcedID botnet loader**\n\nIn this campaign, the loader is dropped via an MSI file, which is atypical for IcedID.\n\nThe installer drops several files and invokes the “init” export function via rundll32.exe, which\nthen executes the malicious loader routine.\n\nThis “loader” DLL has the following characteristics:\n\nThe authors have taken a legitimate DLL and replaced a single legitimate function with\nthe malicious loader function using the “init” export function name at the last ordinal.\nThe first character of each legitimate export function in the IcedID loader is replaced\nwith the letter “h.”\nThe reference to the malicious function is a patched legitimate function.\n\nThe resulting malicious file is almost identical to the legitimate version. This can prove to be\n[challenging for machine learning (ML) detection solutions.](https://www.trendmicro.com/vinfo/tmr/?/us/security/definition/machine-learning)\n\nOn the surface, the malicious IcedID and legitimate sqlite3.dll files look almost identical.\n[Figure 4 shows a side-by-side comparison of these files using the PortEx Analyzer tool,](https://github.com/struppigel/PortEx)\nwhich was developed by security researcher Karsten Hahn. The tool allows us to quickly\nvisualize the structure of the portable executable (PE) files, and, in this case, assess the\nsimilarity of files.\n\n\n-----\n\nFigure 4. A visual representation of the malicious IcedID (left) and legitimate PE (right) files\n(using Karsten Hahn’s PortEx Analyzer tool)\nFor this reason, we hypothesize that this is an attack on two types of malware detection\ntechnologies:\n\nMachine learning detection engines\nWhitelisting systems\n\n**Tampered DLL files functioning as IcedID loaders**\n\nWe have observed that some of the files that have been modified to act as IcedID loaders\nare well-known and widely used libraries.\n\nTable 1. Files that have been modified to act as IcedID loaders\n\nDLL name Description\n\ntcl86.dll A library component of ActiveState’s TCL (Tool Command Language)\nProgramming Language Interpreter\n\nsqlite3.dll A library component of SQLite database\n\nConEmuTh.x64.dll A plugin for Far Manager\n\nlibcurl.dll A CURL library\n\n\n-----\n\nIn sqlite3.dll, we observed that the function at ordinal 270 sqlite3_win32_write_debug has\nbeen replaced with the malicious “init” function in the IcedID loader.\n\nThis is the case across the modified DLL files listed above: The export function at the last\nordinal is replaced with the malicious “init” function.\n\nFigure 5. A comparison of IcedID-modified (left) and normal (right) files, wherein the former’s\nexport function at the last ordinal is replaced with the malicious “init” function\nFurther investigation shows that the structure of the file is identical.\n\nFigure 6. A comparison of IcedID-modified and normal files wherein both files show an\nidentical structure\n**Execution**\n\n1. “MsiExec.exe” executes (parent process) (MITRE ID T1218.007 - System Binary Proxy\n\nExecution: msiexec)\n2. “rundll32.exe” is spawned (MITRE ID T1218.011 - System Binary Proxy Execution:\n\nrundll32.exe)\n\n\n-----\n\n3. rundll32.exe runs the custom action Z3z1Z via\n\n“zzzzInvokeManagedCustomActionOutOfProc” (MITRE ID T1218.011 - System Binary\nProxy Execution: rundll32.exe)\n4. The custom action spawns a second “rundll32.exe” to run the IcedID loader\n\n“MSI3480c3c1.msi” with the “init” export function (MITRE IDs T1027.009 - Embedded\nPayloads and T1218.011 - System Binary Proxy Execution: rundll32.exe)\n\nFigure 7. IcedID loader execution chain\n\nFigure 8. MSI custom action\n\nFigure 9. MSI structure that contains the custom action\nConclusion\n\nIcedID is a noteworthy malware family that is capable of delivering other payloads, including\nCobalt Strike and other malware. IcedID enables attackers to perform highly impactful follow\nthrough attacks that lead to total system compromise, such as data theft and crippling\nransomware. The use of malvertising and an evasive loader is a reminder of why it’s\nimportant for businesses to deploy layered security solutions that include custom\nsandboxing, predictive machine learning, behavior monitoring and file and web reputation\ndetection capabilities. Users can also consider the use of ad blockers to help thwart\nmalveritising attacks.\n\nIndicators Of Compromise (IOCs)\n\n[The indicators of compromise can be accessed via this text file.](https://www.trendmicro.com/content/dam/trendmicro/global/en/research/22/l/icedid-botnet-distributors-abuse-google-ppc-to-distribute-malware/IOCs-IcedID-Botnet-Actors-Abuse-Google-PPC-to-Distribute-Malware.txt)\n\nMitre ATT&CK\n\n\n-----\n\nsXpIBdPeKzI9PC2p0SWMpUSM2NSxWzPyXTMLlbXmYa0R20xk\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-12-23 - IcedID Botnet Distributors Abuse Google PPC to Distribute Malware.pdf"
    ],
    "report_names": [
        "2022-12-23 - IcedID Botnet Distributors Abuse Google PPC to Distribute Malware.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535868,
    "ts_updated_at": 1743041321,
    "ts_creation_date": 1672274401,
    "ts_modification_date": 1672274401,
    "files": {
        "pdf": "https://archive.orkl.eu/c5ee8536b6ba9ff7ec40012ef6124b6b59d99231.pdf",
        "text": "https://archive.orkl.eu/c5ee8536b6ba9ff7ec40012ef6124b6b59d99231.txt",
        "img": "https://archive.orkl.eu/c5ee8536b6ba9ff7ec40012ef6124b6b59d99231.jpg"
    }
}