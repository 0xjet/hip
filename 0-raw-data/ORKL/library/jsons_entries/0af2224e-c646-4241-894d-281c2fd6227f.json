{
    "id": "0af2224e-c646-4241-894d-281c2fd6227f",
    "created_at": "2023-01-12T15:08:09.554769Z",
    "updated_at": "2025-03-27T02:16:25.54067Z",
    "deleted_at": null,
    "sha1_hash": "58c9d159c4da793306325160f9a16172631ff304",
    "title": "2021-09-03 - Dissecting Sodinokibi Ransomware Attacks- Bringing Incident Response and Intelligence Together in the Fight",
    "authors": "",
    "file_creation_date": "2022-05-28T19:36:06Z",
    "file_modification_date": "2022-05-28T19:36:06Z",
    "file_size": 2326720,
    "plain_text": "# Bringing Incident Response and Intelligence Together in the Fight\n\n**[securityintelligence.com/posts/sodinokibi-ransomware-incident-response-intelligence-together/](https://securityintelligence.com/posts/sodinokibi-ransomware-incident-response-intelligence-together/)**\n\n[Home&nbsp/](https://securityintelligence.com/) [Advanced Threats](https://securityintelligence.com/category/x-force/threats/)\nDissecting Sodinokibi Ransomware Attacks: Bringing Incident Response and Intelligence\nTogether in the Fight\n\n\n-----\n\n[Advanced Threats September 3, 2021](https://securityintelligence.com/category/x-force/threats/)\nBy [Camille Singleton co-authored by Andrew Gorecki,](https://securityintelligence.com/author/camille-singleton/) [John Dwyer 10 min read](https://securityintelligence.com/author/john-dwyer/)\n[Ransomware actors are specializing, collaborating and assisting each other to conduct](https://www.ibm.com/topics/ransomware)\nsophisticated attacks that are becoming increasingly difficult to prevent. Combating these\ngroups effectively similarly requires a team approach — specialization, understanding tactics\nand techniques and how to counter them and cutting off activity at its source. Arguably, it has\nnever been more imperative that cybersecurity specialists work together to counter a specific\ncyber threat.\n\nIBM Security [X-Force Threat Intelligence and Incident Response teams have found that](https://www.ibm.com/security/xforce)\n[collaboration has a force-multiplying effect in countering ransomware attacks. Intelligence on](https://securityintelligence.com/posts/how-cybersecurity-threat-intelligence-can-spot-problems-before-they-start/)\n[ransomware groups can help inform and prioritize defenses, and in the event of an attack,](https://securityintelligence.com/posts/the-day-megacortex-ransomware-mayhem-was-averted/)\n[accelerate the incident response process by providing direction and augmenting investigative](https://www.ibm.com/topics/incident-response)\nfindings. In addition, data collected during ransomware investigations enhances analysts’\nunderstanding of ransomware groups, how they operate and how potential victims can\ncounter their tactics.\n\nTo illustrate these points, this blog will examine a collection of Sodinokibi TTPs through\nvarious ransomware attacks in-depth and highlight the ways intelligence and incident\nresponse work together to inform defenses against ransomware operators. Together,\nintelligence and incident response teams can better contain attacks in their early stages\nbefore ransomware deployment, address full deployment attacks and quickly remediate the\nincident. By sharing this information, we anticipate organizations will be better able to\nprevent and defend against a variety of different ransomware attacks.\n\n## Why Examine Sodinokibi?\n\n[X-Force incident response data underscores the significant threat from](https://www.rsaconference.com/library/podcast/hunting-sodinokibi) [Sodinokibi (also](https://securityintelligence.com/posts/sodinokibi-revil-ransomware-disrupt-trade-secrets/)\nknown as REvil) ransomware attacks over the past two years. In fact, Sodinokibi made up\n29% of all X-Force ransomware engagements in 2020 and jumped to 37% of ransomware\nengagements in the first half of 2021. Although Sodinokibi infrastructure was partially shut\ndown in early July 2021, and X-Force has not observed ransomware attacks from the cartel\nsince that time, the tactics, techniques and procedures (TTPs) this group uses are common\nacross several groups. We anticipate the operators behind Sodinokibi activity will resume\nwork on ransomware operations again in the future, probably under a different name.\n\n## Stage 1: Initial Access Through QakBot Infections\n\nIn more than one Sodinokibi attack, X-Force incident response has observed the threat\n[actors gain initial access through a QakBot infection delivered via a phishing email](https://securityintelligence.com/qakbot-banking-trojan-causes-massive-active-directory-lockouts/)\ncontaining a Microsoft Office attachment or URL. While QakBot started out over a decade\nago as one of the top banking Trojans to emerge from the Eastern European cyber crime\narena, nowadays it is used for its foothold in company networks. Several ransomware groups\n\n\n-----\n\n[use QakBot as an initial access vector, including Prolock,](https://www.proofpoint.com/us/blog/email-and-cloud-threats/ransomware-rise-key-trends-and-tips-you-need-know) [Egregor and, of course,](https://www.recordedfuture.com/egregor-ransomware-attacks/) [Sodinokibi.](https://unit42.paloaltonetworks.com/revil-threat-actors/)\nQakBot operators specialize in gaining initial access through phishing emails and then sell\nthis access to cyber crime counterparts including ransomware actors, who conduct\nreconnaissance, move laterally, steal data and deploy ransomware.\n\nX-Force has observed QakBot phishing emails utilizing information gathered\nfrom [hijacked email threads with subject lines involving unpaid invoices to entice a recipient](https://research.checkpoint.com/2020/exploring-qbots-latest-attack-methods/)\nto click on a link or open an attachment.\n\nTo further establish a sense of legitimacy with the recipient, QakBot weaponized Microsoft\nOffice documents will present a ‘DocuSign’ image containing instructions to enable the\npayload to execute.\n\n_Figure 1: Microsoft Excel document containing QakBot DocuSign lure_\n\nIn the QakBot to Sodinokibi incidents X-Force has observed, a phishing email with a\ncompressed archive attachment containing a Microsoft Excel spreadsheet was sent to a\nrecipient in response to an existing e-mail thread. To evade detection, QakBot maldocs have\nnot utilized traditional malicious VBA macros to deliver the payload. Instead, QakBot\nmaldocs leverage Excel 4.0 macros, hidden spreadsheet formulas and BIFF data. Upon\n\n\n-----\n\nexecution, the QakBot maldoc will initiate a download of a dynamic link library (DLL), which\nis the QakBot loader fetched via a call to URLDownloadToFileA. The loader is loaded via the\nDllRegisterServer function within rundll32.exe.\n\nAfter passing some anti-analysis checks, the QakBot loader will execute the main QakBot\npayload and establish persistence through a scheduled task that loads QakBot via\nrundll32.exe or regsvr32.exe.\n\n_Figure 2: QakBot loader downloader within a hidden Microsoft Excel sheet named “Bob”_\n\n_Figure 3: Hidden Microsoft Excel formulas referencing data in hidden “Bob” sheet_\n\n## Initial Access Through Valak Infections\n\nIn other incidents, X-Force has observed Sodinokibi operators gaining initial access through\na [Valak malware infection. Valak itself was delivered via phishing emails with password](https://www.darkreading.com/threat-intelligence/valak-malware-retasked-to-steal-data-from-us-german-firms)\nprotected and compressed archives containing malicious Word documents that advise the\nrecipient to enable macros through a Microsoft Word version mismatch lure.\n\n\n-----\n\n_Figure 4: Valak maldoc lure_\n\nUpon execution, the maldoc downloads a Valak loader DLL as a .tmp file which executes an\nembedded JavaScript payload via wscript.exe. Once Valak has been loaded onto the target\nsystem, the malware will check in with the command-and-control servers (C2), copy itself to\nthe registry, and create a scheduled task for persistence which leverages alternate data\nstreams (ADS) to evade detection.\n\n_Figure 5: Valak loader macro_\n\n_Figure 6: Valak persistence_\n\n\n-----\n\n## Stage 2: Transfer to Ransomware Actors\n\nAfter gaining persistence on the victim’s system, the QakBot and Valak operators probably\nsold their access to an affiliate working directly with Sodinokibi ransomware. After\ntransferring access, the Sodinokibi actor begins some manual processes, usually\ndownloading additional tools such as Cobalt Strike to establish interactive access on the\ninfected host.\n\n[Cobalt Strike is a commercial offensive security toolset that many ransomware operators](https://www.cobaltstrike.com/)\nhave adopted as their primary post-exploitation tool. Some of those are the DarkSide\ngang, [Egregor, Clop,](https://securityintelligence.com/posts/egregor-ransomware-negotiations-uncovered/) [Ryuk, DoppelPaymer, Sodinokibi and several others.](https://securityintelligence.com/articles/ryuk-ransomware-operators-shift-tactics/)\n\nIn some instances, Sodinokibi operators have downloaded the legitimate remote access tool\nNetSupport Manager as a second stage remote access tool. This tool is used to download\nand execute PowerShell payloads and establish additional C2 communication channels.\n\n_Figure 7: Valak NetSupport Manager secondary payload_\n\n## Stage 3: Recon and Credential Harvesting\n\nAfter downloading additional tools and establishing interactive access to a compromised\nsystem, the Sodinokibi actors frequently perform system and Active Directory\nreconnaissance using living-off-the-land tools, those tools that are inherent to the victim’s\noperating system or legitimate system administration tools such as AdFind and that rarely\nappear malicious to security controls.\n\nThrough various Sodinokibi attacks, X-Force has observed common reconnaissance\noperations including enumerating lists of domain workstations and servers, domain\nadministrators domain controllers local users and groups and running processes\n\n\n-----\n\n_Figure 8: Active Directory recon using nltest and AdFind_\n\nWith another commercial pentesting tool in play, X-Force has observed Sodinokibi operators\n[repeatedly harvesting credentials using Mimikatz to escalate privileges and move laterally](https://attack.mitre.org/software/S0002/)\nwithin the compromised environment.\n\nSome Sodinokibi operators also commonly execute lateral movement operations through the\ncreation of a new service on the target host, which uses the service control manager (SCM)\nto execute a PowerShell payload.\n\nAlternatively, in some attacks, Sodinokibi operators have leveraged admin shares to stage a\nmalicious binary on a remote host and subsequently configure a new service to execute the\nbinary to move laterally.\n\n_Figure 9: Sodinokibi lateral movement via new service_\n\nLateral movement, reconnaissance and credential harvesting operations continue until the\nSodinokibi operators have obtained privileged access to the environment and to the\norganization’s data repositories for eventual data exfiltration.\n\nAn interesting observation that X-Force has made over the course of several Sodinokibi\ninvestigations is that the Sodinokibi operators have switched remote access channels from\npost-exploitation tools to leveraging tools such as plink.exe and ngrok.exe. They use these\n\n\n-----\n\ntools to tunnel RDP traffic from servers over web application protocols. These techniques\nallow cyber criminals to bypass firewall restrictions when they move into the data collection\nand exfiltration stage.\n\n_Figure 10: RDP tunneling evidence in Windows Event Logs_\n\nExfiltrating data is a critical part of how ransomware gangs build leverage. They use the\nstolen data to extort the victimized company if the latter chooses to forego payment for a\ndecryption key.\n\n## Stage 4: Data Collection and Exfiltration\n\n[Like many other ransomware operators, Sodinokibi operators incorporate data exfiltration as](https://www.sdxcentral.com/articles/news/did-covid-19-usher-in-cybercrimes-golden-age/2021/03/)\npart of a double extortion tactic to increase the probability of a payment as a result of the\ncompromise.\n\nX-Force IR observed that Sodinokibi operators often access remote file shares to stage data\nto a single compromised system and leverage tools such as Rclone, MegaSync, MegaCmd\nand WinSCP to exfiltrate data from the compromised environment.\n\n\n-----\n\nDuring investigations of Sodinokibi ransomware incidents, X-Force has determined that the\nthreat actors spend most of the compromise within the data collection and exfiltration phase.\n\nDuring one Sodinokibi incident X-Force investigated, the operator spent nine days\nperforming data collection and exfiltration out of a total of eleven days from the point the\nactor established interactive access to the network.\n\nThe types of data Sodinokibi operators target include:\n\nPoint of sale (POS) data that includes payment card data\nSupervisory Control and Data Acquisition (SCADA) data\nData marked ‘confidential’\nInitial Public Offering (IPO) or stock market data\nIntellectual property (IP) (e.g. source code, Gitlab backups, etc.)\nPayment card information (PCI)\nPersonally identifiable information (PII)\nProtected health information (PHI) (e.g. ultrasound, patient prescription details, mental\nhealth summaries, etc.)\nFinancial planning and investment\nAccounting data\nHuman resources (HR) data\nInternal communications\nBackups\nClient data\nPassports\nCustomer contracts\nVendor sensitive data\n\n## Stage 5: Ransomware Deployment\n\nAfter completing the data exfiltration phase, the Sodinokibi operators will leverage their\nprivileged access to pivot to access a compromised domain controller.\n\nFrom the domain controller, the threat actor can stage ransomware and then deploy it using\ndomain administrator credentials via PSExec, server message block (SMB) protocol and\ngroup policy object (GPO). Use of GPO in multiple Sodinokibi attacks has enabled threat\nactors to also disable Microsoft Windows Defender to inhibit target protections against the\nransomware.\n\nIn one Sodinokibi ransomware incident that X-Force investigated, after completing the\nexfiltration of 92 GB of data through the Rclone tool, the threat actors accessed a domain\ncontroller through RDP and created a new GPO which modified the following registry key to\ndisable Windows Defender.\n\n\n-----\n\nHKLM \\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\DisableAntiSpyware\n\nThe threat actors then linked the new GPO to the root of the domain and created eight new\nline-separated text files containing 8,771 hostnames from Active Directory.\n\nOnce Windows Defender was disabled, the threat actor created eight BAT files in the\nC:\\Windows directory.\n\nX-Force IR recovered these binaries and determined that they loop through the eight\npreviously mentioned text files, authenticate to each host using a service account via the\nSMB protocol, copy a DLL to the C:\\Windows directory and use the Windows Management\nInstrumentation (WMI) utility to execute the DLL with Rundll32.exe on the target host.\n\nX-Force malware analysts confirmed the DLL as a Sodinokibi ransomware payload.\n\n_Figure 11: BAT file “wmi4.bat” that the attacker used to deploy ransomware using WMI_\n\n## Investigation: Where Intelligence and Incident Response Meet\n\nWhile assisting IBM clients with remediating Sodinokibi ransomware attacks, X-Force threat\nintelligence has provided context, research and assistance to the incident response team\nthat has enhanced investigation and informed remediation.\n\nIn some cases, intelligence analysts have been able to pivot on a single indicator of\ncompromise (IOC) from an attack and, through research and enrichment, pave the way for\nadditional analysis. These capabilities illuminate new systems for investigation and open\ndoors for the incident response team that would otherwise have remained closed.\n\nThis process is mutually beneficial, as it also provides threat intelligence teams with\nadditional insight on threat actors and indicators for detecting them. For example, an IR\nrequest for intelligence to examine one internet protocol led to insight on a recent phishing\ncampaign connected to several different email addresses. At the same time, the team\npointed to Transmission Control Protocol (TCP) scanning activity and threat actor activity\nrelated to both ransomware attacks and Trojan infections.\n\nIn addition to IOCs, the X-Force threat intelligence team closely tracks the TTPs associated\nwith dozens of threat groups, including ransomware groups and their affiliates. These TTPs\nare changing rapidly, and as threat intelligence teams identify changes they can relay these\nshifts to incident response consultants working on related cases.\n\n\n-----\n\nThe availability of IR and intelligence professionals that tag team is a process that augments\nforensic analysis and enables consultants to search artifacts for specific TTPs. They can also\nidentify more suspicious activity that is most likely to be relevant to the investigation. For\n[example, Sodinokibi’s exploitation of a zero-day and supply chain attack involving Kaseya in](https://us-cert.cisa.gov/kaseya-ransomware-attack)\nearly July 2021 represented a significant shift in the group’s behavior that altered X-Force\nIR’s examination of initial infection vectors for Sodinokibi attacks.\n\nIn some cases, intelligence insight can warn of potential Sodinokibi activity. For instance, in\none incident IR investigated, even before any malware was found, intelligence analysts\nnoted that some identified IPs and use of Rclone could be indicative of precursor activity to\nransomware deployment — and specifically Sodinokibi. Fortunately, defenders were able to\nidentify and remediate the activity quickly and the attackers never reached the ransomware\ndeployment stage in this operation.\n\n## Remediation: Shoring Up Potential Victims Against Future Attacks\n\nX-Force IR has assisted numerous clients with containing ransomware attacks, eradicating\nthreat actors from compromised networks and recovering business operations. Once an\nincident is fully contained, organizations commence the recovery effort — often a complex\nundertaking that requires strong cross-functional collaboration.\n\nIn many cases, rebuilding or restoring the compromised systems according to the incident\ntimeline is the first step in recovery, but recovery alone is not sufficient. Organizations need\nto reduce their attack surface and remediate security weaknesses exploited by the threat\nactor to minimize the risk of similar attacks occurring in the future. Our team has assisted\nmany clients with these activities, providing recommendations on controls to improve the\noverall security posture of any network.\n\nSome of the short-term controls frequently recommended by X-Force include:\n\nDeploying a local administrator password solution (LAPS)\nReducing the SMB protocol’s attack surface\nHardening systems against credential harvesting attacks\nProhibiting workstation and server logins with enterprise administrator (EA) and domain\nadministrator (DA) credentials\nDeploying a secure administrative host for access to trusted security zones\nMonitoring elevated privilege accounts, including service accounts\nDeploy an endpoint detection and response (EDR) tool\n\nIn the medium term, X-Force often recommends that victims focus on designing a delegation\nmodel, enforcing the principle of least privilege for security principals and separating\nadministrative credentials into administrative tiers. Privileged accounts should always be\nprotected by strong passwords and a multi-factor authentication scheme.\n\n\n-----\n\nIn the longer term, potential ransomware victims might want to explore a range of options\nthat would enhance the security posture of the network and minimize the risk of successful\nnetwork intrusion by ransomware operators. Some of the controls include:\n\n[Developing a vulnerability management program](https://www.ibm.com/security/services/vulnerability-scanning)\nSegmenting an internal network to reduce the possibility of lateral movement\nImplementing privileged access management (PAM) to manage and secure the\ncredentials for privileged accounts, including users with elevated privileges, local and\nActive Directory (AD) accounts, system administrators and super users, service\naccounts and application accounts, among others.\nImplementing multifactor authentication (MFA) to enhance security in scenarios where\nthe risk of compromised credential use is the greatest.\n\n[Keep up to date on IBM X-Force blogs and emerging research here.](https://securityintelligence.com/tag/x-force/)\n\nIf your organization requires assistance with incident response and intelligence services, IBM\nX-Force stands by 24/7.\n\nUS Hotline: 1-888-241-9812\n\nGlobal hotline: +001 (312) 212-8034\n\n[Camille Singleton](https://securityintelligence.com/author/camille-singleton/)\nManager, X-Force Cyber Range Tech Team, IBM\n\nCamille Singleton brings sixteen years of professional experience to cybersecurity topics,\nboth in the US government and as an analyst at IBM. She is convers...\n\n\n-----\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-09-03 - Dissecting Sodinokibi Ransomware Attacks- Bringing Incident Response and Intelligence Together in the Fight.pdf"
    ],
    "report_names": [
        "2021-09-03 - Dissecting Sodinokibi Ransomware Attacks- Bringing Incident Response and Intelligence Together in the Fight.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673536089,
    "ts_updated_at": 1743041785,
    "ts_creation_date": 1653766566,
    "ts_modification_date": 1653766566,
    "files": {
        "pdf": "https://archive.orkl.eu/58c9d159c4da793306325160f9a16172631ff304.pdf",
        "text": "https://archive.orkl.eu/58c9d159c4da793306325160f9a16172631ff304.txt",
        "img": "https://archive.orkl.eu/58c9d159c4da793306325160f9a16172631ff304.jpg"
    }
}