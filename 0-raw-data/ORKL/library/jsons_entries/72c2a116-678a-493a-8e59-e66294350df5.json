{
    "id": "72c2a116-678a-493a-8e59-e66294350df5",
    "created_at": "2023-01-12T15:03:36.334162Z",
    "updated_at": "2025-03-27T02:06:14.240266Z",
    "deleted_at": null,
    "sha1_hash": "96525ae2c2d87733e87c01e1cef45b3fcda62523",
    "title": "2016-05-09 - KRBanker Targets South Korea Through Adware and Exploit Kits",
    "authors": "",
    "file_creation_date": "2022-05-28T02:34:00Z",
    "file_modification_date": "2022-05-28T02:34:00Z",
    "file_size": 850213,
    "plain_text": "# KRBanker Targets South Korea Through Adware and Exploit Kits\n\n**researchcenter.paloaltonetworks.com/2016/05/unit42-krbanker-targets-south-korea-through-adware-and-exploit-kits-**\n2/\n\nVicky Ray, Kaoru Hayashi May 9, 2016\n\nBy [Vicky Ray and](https://unit42.paloaltonetworks.com/author/vicky-khan/) [Kaoru Hayashi](https://unit42.paloaltonetworks.com/author/khayashi/)\n\nMay 9, 2016 at 6:30 AM\n\n[Category: Malware,](https://unit42.paloaltonetworks.com/category/malware-2/) [Threat Prevention,](https://unit42.paloaltonetworks.com/category/threat-prevention-2/) [Unit 42](https://unit42.paloaltonetworks.com/category/unit42/)\n\nTags: [Adware,](https://unit42.paloaltonetworks.com/tag/adware/) [Banking Trojan,](https://unit42.paloaltonetworks.com/tag/banking-trojan/) [Blackmoon,](https://unit42.paloaltonetworks.com/tag/blackmoon/) [ExploitKit,](https://unit42.paloaltonetworks.com/tag/exploitkit/) [KRBanker,](https://unit42.paloaltonetworks.com/tag/krbanker/) [Pharming,](https://unit42.paloaltonetworks.com/tag/pharming/) Republic of\nKorea\n\nThis post is also available in: 日本語 [(Japanese)](https://unit42.paloaltonetworks.jp/unit42-krbanker-targets-south-korea-through-adware-and-exploit-kits-2/)\n\nOnline banking services have been a prime target of cyber criminals for many years and\nattacks continue to grow. Targeting online banking users and stealing their credentials has\nyielded huge profits for the criminals behind these campaigns. Unit 42 has been tracking\n\"KRBanker\" AKA 'Blackmoon', since late last year. This campaign specifically targets banks\nof the Republic of Korea. On April 23, researchers at Fortinet published a blog describing the\nfunctionalities of the recent 'Blackmoon' campaign. Our objective in this blog is to share\nadditional details on the distribution of the KRBanker or Blackmoon malware campaign and\nindicators of KRBanker samples.\n\nEarly variants of this campaign started surfacing in late September 2015. Though the\nnumber of KRBanker infection attempts was relatively low in 2015, we have noticed a\ngradual increase in the number of sessions since the start of 2016, and identified close to\n2,000 unique samples of KRBanker and 200+ pharming server addresses in the last 6\nmonths.\n\n\n-----\n\n_Figure 1 KRBanker download sessions on Autofocus_\n\n## Malware Distribution\n\nOur analysis shows that KRBanker has been distributed through web exploit kits (EK) and a\nmalicious Adware campaign. The exploit kit used for installing KRBanker is known as KaiXin\nand the Adware which distributes it is called NEWSPOT.\n\n[In March 2016, Unit 42's Brad Duncan wrote two articles for SANS and](https://isc.sans.edu/diary/Recent+example+of+KaiXin+exploit+kit/20827) Malware-TrafficAnalysis.Net, noting that the KaiXin EK is observed in Republic of Korea. In those cases,\nmalicious JavaScript through compromised web sites or advertisements led to the EK that\nexploited Adobe Flash vulnerabilities CVE-2014-0569 or CVE-2015-3133. We confirmed that\nfinal payload in both cases was KRBanker.\n\nAnother distribution channel is a malicious Adware program, called NEWSPOT. According to\nthe marketing document of the product, NEWSPOT guarantees 300% revenue growth for\nonline shopping sites . NEWSPOT is a basic adware program that displays advertisements\nin browsers, but since at least November 2015 has started installing malware.When visiting\nsome Korean websites, a user may notice a pop-up of a browser add-on requesting\ninstallation for NEWSPOT.\n\n_Figure 2 Installing NEWSPOT tool_\n\nIf installed, the adware is executed on the computer and starts getting configuration from the\nfollowing URL:\n\nwww.newspot[.]kr/config.php?sUID=[web site name]\n\nIt downloads a file from URL described in the <update> section within the configuration data\nreturned by the server.\n\n\n-----\n\n_Figure 3 Configuration file contains download link to malware_\n\nThis might have originally been used to update the NEWSPOT software, but we have\nconfirmed that Banking Trojans like KRBanker and Venik has been installed through this\nupdate channel. Figure 4 shows the URLs:\n\n_Figure 4 Downloading Banking Trojans from NEWSPOT update channel_\n\n## Execution\n\n[KRBanker uses Process Hollowing to execute its main code in a clean (non-suspicious)](https://attack.mitre.org/wiki/Process_hollowing)\nexecutable. The process is as follows:\n\n1. KRBanker executes a clean PE file in System directory.\n\n\n-----\n\n2. Windows loads the PE file into memory.\n3. KRBanker overwrites the whole clean process with its own (malicious) main module.\n4. Overwritten process starts malicious activity.\n\n_Figure 5 Execution Steps_\n\n\n-----\n\n_Figure 6 Execution Steps (cont.)_\n\nAfter a successful execution the Windows Firewall alerts the user on the process attempting\nto access the Internet. Many users may allow this activity because the process originally\ninvolved a clean Microsoft file.\n\n_Figure 7 Windows Firewall Alert_\n\n## Pharming\n\nBanking trojans like Dridex or Vawtrak mainly employ Man-in-the-browser(MitB) techniques\nto steal credentials from targeted victims. However, KRBanker uses a different technique\nknown as “pharming.” This technique involves redirecting traffic to a forged website when a\nuser attempts to access one of the banking sites being targeted by the cyber criminals. The\nfake server masquerades the original site and urges visitors to submit their information and\ncredentials.\n\n**Set Up**\n\nThe IP address of the fraudulent server is not hard-coded in the malware. KRBanker obtains\nthe server address by accessing Chinese SNS, Qzone through a Web API. The API provides\nbasic user information by sending QQ number to the following URL.\n\nusers.qzone.qq.com/fcg-bin/cgi_get_portrait.fcg?uins=[QQ ID Number]\n\nThe server then responds with the QQ ID Number, link to picture, nick name and some other\ninformation from SNS profile identified by the QQ ID Number. The author of the trojan put the\nPharming server address in the \"nickname\" field.\n\nFollowing is an example response that contains the IP address, 23.107.204[.]38 which is\nthen extracted by KRBanker for Pharming.\n\n\n-----\n\n_Figure 8 Receiving IP address for Pharming from QZone_\n\nNext, KRBanker gets the MAC Address using an embedded VBScript and code page by\nexecuting GetOEMCP() API on the compromised system. It then registers the compromised\nsystem with the C2 server by sending the following HTTP GET request:\n\nhttp://[IP address]/ca.php?m=[encoded MAC Address]&h=[code page]\n\n**Proxy Auto-Config**\n\nResearchers at ALYac had reported previously, on KRBanker employing hosts file\nmodification and [local DNS proxy techniques to redirect HTTP traffic. The latest version of](http://blog.alyac.co.kr/172)\nthe threat employs Proxy Auto-Config(PAC), a legitimate function on Windows and Network\nadministrators that can define an appropriate proxy address for each URL by writing\n[JavaScript, and was also mentioned by Fortinet on their blog post. The adversaries abuse](https://blog.fortinet.com/post/over-100-000-south-korean-users-affected-by-blackmoon-campaign)\nthis feature for Pharming.\n\nTo configure this, the Trojan starts a local proxy server and creates the following registry\nentry.\n\nHKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet\nSettings\\AutoConfigURL = http://127.0.0.1:[random]/[random]\n\nThe local proxy hosts encrypted JavaScript.\n\n\n-----\n\n_Figure 9 Malicious JavaScript for Proxy Auto-Config_\n\nAfter decrypting the JavaScript we can see the function for PAC, FindProxyForURL() which is\nused to check for a list of targeted sites.\n\n_Figure 10 Decrypted malicious JavaScript_\n\nWhen the browser attempts to connect to a web server, the traffic goes to the local proxy.\nThe malicious JavaScript on the Proxy PAC checks the domain with the list of targets using\nthe FindProxyForURL() function. If the domain being accessed matches with any of the\ntargets from the list, the traffic goes to a fraudulent server. If not, it goes to the legitimate\ndomain being requested.\n\n_Figure 11 Redirecting traffic by Proxy Auto-Config_\n\nCurrent, KRBanker is targeting a large list of Korean financial institutions using this Pharming\nattack.\n\nWhen a compromised user visits one of the targeted websites, the user will see a page like\nthe one shown in Figure 12 below. It appears to look like a legitimate webpage with a valid\nURL displayed on the address bar of the browser. However, this is a fake website for stealing\nthe credentials and account information of the victims.\n\n\n-----\n\n_Figure 12 Fake Authorized Certification Center for renewal_\n\nKRBanker is also capable of taking the following actions:\n\nStealing certification from NPKI directory in order to access online bankingaccounts\nTerminating Ahnlab’s V3 security software\n\n## Conclusion\n\nProfit is the primary motivator for attackers who use banking Trojans. The adversary behind\nKRBanker has been developing new distribution channels, evolving the pharming techniques\nmultiple times, and releasing new variants on a daily basis to maximize the revenue from\nvictims.\n\nAs described in this article, the threat is distributed through Exploit Kits that exploit old\nvulnerabilities and Adware that needs to be manually installed. It is essential to understand\nthe infection vectors of such campaigns to minimize the impact. Palo Alto Networks\nAutofocus users can track this threat using the 'KRBanker' Autofocus tag.\n\n## Indicators\n\nThe indicators on KRBanker can be found on Unit 42's github page below\n\n[https://github.com/pan-unit42/iocs/blob/master/krbanker/hashes.txt](https://github.com/pan-unit42/iocs/blob/master/krbanker/hashes.txt)\n\n**Get updates from**\n\n**Palo Alto**\n\n**Networks!**\n\nSign up to receive the latest news, cyber threat intelligence and research from us\n\n\n-----\n\n[By submitting this form, you agree to our Terms of Use and acknowledge our Privacy](https://www.paloaltonetworks.com/legal-notices/terms-of-use)\nStatement.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2016/2016-05-09 - KRBanker Targets South Korea Through Adware and Exploit Kits.pdf"
    ],
    "report_names": [
        "2016-05-09 - KRBanker Targets South Korea Through Adware and Exploit Kits.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535816,
    "ts_updated_at": 1743041174,
    "ts_creation_date": 1653705240,
    "ts_modification_date": 1653705240,
    "files": {
        "pdf": "https://archive.orkl.eu/96525ae2c2d87733e87c01e1cef45b3fcda62523.pdf",
        "text": "https://archive.orkl.eu/96525ae2c2d87733e87c01e1cef45b3fcda62523.txt",
        "img": "https://archive.orkl.eu/96525ae2c2d87733e87c01e1cef45b3fcda62523.jpg"
    }
}