{
    "id": "027e1d07-9dc2-457b-b7f5-c8ed2b8d6d20",
    "created_at": "2023-01-12T15:06:16.294524Z",
    "updated_at": "2025-03-27T02:10:25.941791Z",
    "deleted_at": null,
    "sha1_hash": "6c16ccfa2ebe2b6aa58849e329a1dafb54d84c67",
    "title": "2021-06-15 - Handy guide to a new Fivehands ransomware variant",
    "authors": "",
    "file_creation_date": "2022-05-28T18:22:24Z",
    "file_modification_date": "2022-05-28T18:22:24Z",
    "file_size": 182872,
    "plain_text": "# Handy guide to a new Fivehands ransomware variant\n\n**[research.nccgroup.com/2021/06/15/handy-guide-to-a-new-fivehands-ransomware-variant/](https://research.nccgroup.com/2021/06/15/handy-guide-to-a-new-fivehands-ransomware-variant/)**\n\nJune 15, 2021\n\nby Michael Matthews and William Backhouse\n\n## tl;dr\n\nNCC Group’s Incident Response team observed a new variant of the FiveHands\nransomware, deployed by an affiliate leveraging publicly available tools to progress their\nattack. This blog post aims to describe the developments in the ransomware variant and the\ntechniques used by the affiliate.\n\nThe affiliate appears to have been active for a long period of time. Open-source intelligence\nsuggests a link to UNC2447, matching several characteristics shown through the campaign.\nIncluding aggressive tactics when urging the victim to pay the ransom. In this instance,\n\n\n-----\n\nattempts were made to directly call individuals within the organisation using spoofed caller\nIDs.\n\n## Initial Access\n\nAn externally facing SonicWall VPN appliance was the initial access vector exploited by the\nactor, allowing them to generate a VPN profile and join the target network using the\nhostname “Commando”, which matches the default hostname of the complete Mandiant\noffensive VM. In addition, the source port of 4444 was used which is the default listener port\nfor Metasploit.\n```\nAccount For Which Logon Failed:\nSecurity ID: S-1-0-0\nAccount Name: command0\nAccount Domain: COMMANDO\nNetwork Information:\nWorkstation Name: COMMANDO\nSource Network Address: 10.X.X.X\nSource Port: 4444\nNetwork Information:\nWorkstation Name: COMMANDO\nSource Network Address: 10.X.X.X\nSource Port: 2360\n\n## Attackers Toolbox\n\n```\nSeveral publicly available tools were leveraged by the attacker, a brief description has been\nprovided below detailing their functionality.\n\n### Netscan.exe\n\nThe SoftPerfect website states that the “SoftPerfect Network Scanner can ping computers,\nscan ports, discover shared folders, and retrieve practically any information about network\ndevices, via Windows Management Instrumentation (WMI), Simple Network Management\nProtocol (SNMP), Hypertext Transfer Protocol (HTTP), Secure Shell (SSH), and PowerShell.\nIt also scans for remote services, registry, files and performance counters; offers flexible\nfiltering and display options and exports NetScan results to a variety of formats from XML to\nJSON.”\n\n### Advanced_port_Scanner.exe\n\nThe advanced port scanner website states that the “Advanced Port Scanner is a free\nnetwork scanner allowing you to quickly find open ports on network computers and retrieve\nversions of programs running on the detected ports.”\n\n\n-----\n\n### Hostclean.exe\n\nPreferring a GUI environment, the remote desktop software “Remote Utilities” was used to\nenact some level of persistent C2 with hosts connecting back to the master console which\nwas an IP address based in Russia.\n\nReviewing the log files revealed the user account used to register the product:\npau7887pau@yandex[.]ru. Open source research provides a link to Hybrid Analysis pointing\ntowards a sample that was uploaded in July 2020, which turns out to be the remote desktop\ntool by [Remote Utilities.](https://hybrid-analysis.com/sample/91aca8d07e71ea7e9f33a3a5b61aa55a7e581f15eac20a92505712021a9fd630/5f19377ffb73832e3825a71e)\n\n### pCloud.exe\n\nThe pCloud website states that “pCloud is Europe’s most secure encrypted cloud storage,\nwhere you can store your personal files or backup your PC or share your business\ndocuments with your team”\n\npCloud was leveraged as the main data exfiltration method.\n\n### AllInOnePasswordRecoveryPro.exe\n\nAllInOnePasswordRecoveryPro website states that “All-In-One Password Recovery Pro is\nthe enterprise software to instantly recover ALL your lost or forgotten passwords from 100+\npopular Windows Apps with a click of button. Long & short, it is the One software to recover\nyour all type of passwords including website login, e-mail, messenger, FTP, download\nmanager, remote desktop, database, router, credential manager, Wi-Fi passwords.”\n\n### PsExec.exe\n\nPsExec.exe is the legitimate remote administration program by Sysinternals. This utility was\nused to remotely execute the encryptor.exe payload and create accounts.\n\n### Encryptor.exe\n\nEncryptor.exe was the loader for the FiveHands ransomware. The loader was written in Go\nand took a 16-byte key over the command line using the “-key” switch to decrypt the payload,\nbefore loading the ransomware directly into memory. It is believed that the key is derived\nduring the build process to generate a unique binary as part of RaaS.\n\nAs in most cases, where command line logging is not enabled, it was fortunate the actor\nused RDP extensively as the -key parameters were obtained through the bitmap cache. In\nshort, the bitmap cache is a collection of small bitmap files that make up snippets of an RDP\nsession. A large proportion of the key could be seen in the bitmap images available, the\nremaining characters obtained through brute forcing the key. The key is 16 characters long\nand is made up of upper- and lower-case characters with numbers. No symbols were\npresent\n\n\n-----\n\n## Passwords\n\nA unique attribute of the affiliate was the use of the password “Remark123!”. Open source\nresearch throws up a link to the online sandbox “AnyRun” containing the following command\n[executed “net localgroup Administrators gook /add” as part of “Update.exe”. Followed by](https://app.any.run/tasks/c0f35b79-4190-44c7-8ccd-7f57c2da8f1b/)\nadding the user to the Remote Desktop Users group, the favoured lateral movement\ntechnique for the actor.\n\nThe upload timestamp of 12/08/2020 paired with prior information suggests the actor has\nbeen active for quite some time, predating FiveHands involvement.\n\n## pCloud Data Exfiltration\n\nYet another internet cloud storage provider being used maliciously for data exfiltration,\npCloud joins the list. Although a paid product, a free account will allow users to store up to\n10GB of files. The operation of pCloud is similar to that of other cloud storage products such\nas Google Drive, managed both through an installed application or a web browser. The\ninstalled version provides a virtual disk which is used to sync files with the cloud.\n\nWhilst pCloud syncs/uploads files from the host, the contents are cached locally on disk in\nthe following location:\n```\nC:\\Users\\<Username>\\AppData\\local\\pCloud\\Cache\\Cached\n\n```\nUsing your favourite file carving tool, it is possible to recover the contents of files synced with\nthe cloud. In turn revealing data exfil! A valuable outcome for most forensic investigators.\n\n## FiveHands Ransomware\n\nThe sample analysed has many similarities with what is already in the public domain\nhowever, the developers have added and changed parts of the code. For example, the\ntarget’s ID for the TOR ransomware page is not generated at runtime but it is hardcoded. We\nassess that this ransomware family operates under a Ransomware as a Service (RaaS)\nmodel.\n\n## Technical Analysis\n\nThe loader observed was written in Go, with the ransomware written in C++.\n\nThe entry point and the core functionality of the ransomware is stored in the export function\n‘Run’. Despite the loader not passing any command line parameters, the ransomware\nsupports the following:\n\n**Parameter** **Description**\n\n\n-----\n\n-limit Specify the maximum size of a file to encrypt\n\n-skip Specify the minimum size of files to encrypt\n\n-blocks Encrypt only the first block (163840 bytes at most) of a file\n\n-full Encrypt the entire file\n\n-path Encrypt only a specified path\n\nThe ransomware can encrypt the following resources:\n\nNetwork Shares\nMounted Drives\nSpecified File Paths (-path parameter)\n\n### Encryption Process\n\nThe ransomware sample uses a combination of RSA and AES algorithms in order to encrypt\na file on the system. The implementations of the encryption algorithms are taken directly\nfrom the open-source library ‘Mbed TLS’.\n\nGenerally, the following steps are taken:\n\n1. Generate a new AES-128 key (CBC mode) and encrypt a block (163840 bytes at most) of\nthe target file\n\n2. Store the AES key/IV and other metadata of the target file in a memory block and encrypt\nit using an embedded public RSA key (See Appendix section for a detailed description of the\nmemory block)\n\n3. If there is more data to encrypt in the target file then keep encrypting each block but with a\nnew AES IV each time\n\n4. Add the extension ‘.crypt’ to the encrypted file. The developers have also included the\nextension ‘).crypt’. This extension is only used if the use of ‘.crypt’ fails.\n\nThe above process is repeated for each target file. In case of a locked file, the ransomware\nattempts to unlock it via the ‘Windows Restart Manager’.\n\nThe ransomware excludes the following folders and extensions from the encryption process:\n\nprogramdata\n$recycle.bin\nprogram files\nwindows\nall users\n\n\n-----\n\nwinnt\nappdata\napplication data\nlocal settings\nboot\nread_me_unlock.txt\nntldr\npagefile.sys\nntdetect.com\nautoexec.bat\ndesktop.ini\nautorun.inf\nntuser.dat\niconcache.db\nbootsect.bak\nboot.ini\nbootfont.bin\nconfig.sys\nio.sys\nmsdos.sys\nntuser.dat.log\nthumbs.db\nswapfile.sys\n.exe\n.dll\n.scr\n.sys\n.msi\n\n## Appendix\n\n### Public RSA Key\n```\n-----BEGIN PUBLIC KEY----MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAlCzts7lbjf+KBhuz2GpB\nis7X2oFE+gIUjQzwHzJvU06VSWT2YNtnqed3KlX7nKbrf4Ajso7CeyjzpK9maKYV\nTsLrVm+zRWVWwyojOFKAhtMXR8d6G33bWaKOa0cNrh0OpIn/lWMoLVIAA1BztGk2\nOZe7tlxT7FFLH5PaUdLUlXkcFHBDvnmk8beZXSEPufuDrsJAOSjfxVCXZuPBqMU2\n2SlXtc1LIHY0O13JxWBmyjdqtYNl+AoBhyCM0jW8nlBVqfZlLx0+FBtp3lyWiCrh\ndHnTCMn7c7B/ypISph3I6tIQs+Vt/glz+6q4rcZW3qKNjvDnff7dCi0MW9BRZSxX\nGwIDAQAB\n-----END PUBLIC KEY----\n Structures used in the encrypted block(s) of a target file\n\n```\n\n-----\n\n```\nstruct Encrypted_File_Block\n{\n BYTE AES_Encrypted_File[N]; // Where N is the size of the encrypted block\n BYTE Encrypted_RSA_Block[0x60];\n DWORD Marker; // (0xABCCDCDB)\n};\nstruct Encrypted_RSA_Block\n{\n DWORD Marker; //0xBAADC0DE\n QWORD Size_of_encrypted_data;\n LPFILETIME lpCreationTime;\n LPFILETIME lpLastAccessTime;\n LPFILETIME lpLastWriteTime;\n DWORD Types_Of_Parameters; //Indicates what parameters that are passed.\n DWORD Maximum_Bytes_To_Encrypt_Per_Block; //Hardcoded to 0x00028000 (163840)\n DWORD Random_number; // Random generated number when the '-blocks' parameter is\npassed. Otherwise, set to 0. Appears to have no use.\n DWORD Unknown; // Hardcoded to 3 when '-blocks' parameter is passed. Otherwise, set\nto 0.\n QWORD Parsed_limits_parameter; // Parsed value of '-limits' parameter. 0x6400000 by\ndefault\n DWORD Plaintext_Data_CRC32; // Checksum of the plaintext data\n BYTE AES_KEY[0x10]; //Generated AES KEY\n BYTE AES_IV[0x10]; // Generated AES IV\n};\n\n### Indicators\n\n```\nAdvanced Port Scanner\n\n3477A173E2C1005A81D042802AB0F22CC12A4D55 (SHA1)\n763499B37AACD317E7D2F512872F9ED719AACAE1 (SHA1)\n\nFiveHands Encrypted Dropper\n\n9A0FC9B53117ECDF78A899649C59F50C (MD5)\n\npCloud\n\n8087F3C1F7F65E2CFC202550D3645000 (MD5)\nA6C8787815BC72DF7B0CFA6831157143 (MD5)\n95425ACE5598941165025136AD52893D (MD5)\npcloud[.]com\n\nRemote Utilities\n\n9E63911B5B7E63023708125418D6D4D5 (MD5)\n1A426D873C1C6EA9D25747932F392E14 (MD5)\nB521ECCF21D13DCB062DDF39EF4BF351 (MD5)\n185.175.47[.]32\n\n\n-----\n\npau7887pau[at]yandex[.]ru\nModerator.hldns[.]ru\n\nSoftPerfect Network Scanner\n\n132071DC69B875D239F133984655A26A (MD5)\n\n### MITRE ATT&CK\n\n**Tactic** **Description**\n\nInitial Access T1133 – External Remote Services\n\nExecution T1059.003 – Windows Command Shell\n\nPersistence T1136.002 – Create Account\n\nDefence Evasion T1562 – Impair DefencesT1070 – Indicator Removal on Host\n\nCredential Access T1003.001 – LSASS Memory\n\nDiscovery T1046 – Network Service ScanningT1069.002 – Permission Groups\nDiscovery\n\nLateral Movement T1021.001 – Remote Desktop Protocol\n\nCollection T1039 – Data From Network Shared Drive\n\n\nCommand and\nControl\n\n\nT1219 – Remote Access Software\n\n\nExfiltration T1567.002 Exfiltration to Cloud Storage\n\nImpact T1486 – Data Encrypted for Impact\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-06-15 - Handy guide to a new Fivehands ransomware variant.pdf"
    ],
    "report_names": [
        "2021-06-15 - Handy guide to a new Fivehands ransomware variant.pdf"
    ],
    "threat_actors": [
        {
            "id": "cf1c7efe-4464-4347-95d3-c86fb4d7db51",
            "created_at": "2022-10-25T16:07:24.35977Z",
            "updated_at": "2025-03-27T02:02:10.189727Z",
            "deleted_at": null,
            "main_name": "UNC2447",
            "aliases": [],
            "source_name": "ETDA:UNC2447",
            "tools": [
                "7-Zip",
                "AdFind",
                "Agentemis",
                "Cobalt Strike",
                "CobaltStrike",
                "DEATHRANSOM",
                "DeathRansom",
                "FIVEHANDS",
                "FOXGRABBER",
                "HELLOKITTY",
                "HelloKitty",
                "KittyCrypt",
                "Mimikatz",
                "PCHUNTER",
                "RCLONE",
                "ROUTERSCAN",
                "Ragnar Locker",
                "RagnarLocker",
                "Rclone",
                "S3BROWSER",
                "SombRAT",
                "Thieflock",
                "WARPRISM",
                "cobeacon",
                "deathransom",
                "wacatac"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "065b7ea2-5920-4270-824e-94ea8a79d197",
            "created_at": "2023-12-08T02:00:05.747632Z",
            "updated_at": "2025-03-27T02:00:03.265128Z",
            "deleted_at": null,
            "main_name": "UNC2447",
            "aliases": [],
            "source_name": "MISPGALAXY:UNC2447",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535976,
    "ts_updated_at": 1743041425,
    "ts_creation_date": 1653762144,
    "ts_modification_date": 1653762144,
    "files": {
        "pdf": "https://archive.orkl.eu/6c16ccfa2ebe2b6aa58849e329a1dafb54d84c67.pdf",
        "text": "https://archive.orkl.eu/6c16ccfa2ebe2b6aa58849e329a1dafb54d84c67.txt",
        "img": "https://archive.orkl.eu/6c16ccfa2ebe2b6aa58849e329a1dafb54d84c67.jpg"
    }
}