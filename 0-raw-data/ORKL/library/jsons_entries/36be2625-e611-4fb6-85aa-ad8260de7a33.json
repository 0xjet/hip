{
    "id": "36be2625-e611-4fb6-85aa-ad8260de7a33",
    "created_at": "2023-01-12T15:07:32.800226Z",
    "updated_at": "2025-03-27T02:06:05.317672Z",
    "deleted_at": null,
    "sha1_hash": "87d15693fc66c49b1b1b662bcfcbf56c0846e6c5",
    "title": "2021-06-16 - Cerberus Analysis - Android Banking Trojan",
    "authors": "",
    "file_creation_date": "2022-05-25T14:21:40Z",
    "file_modification_date": "2022-05-25T14:21:40Z",
    "file_size": 6610100,
    "plain_text": "# Cerberus Analysis - Android Banking Trojan\n\n**nur.pub/cerberus-analysis**\n\nJune 16, 2021\n\nCerberus is an Android malware that emerged in 2019 but was allegedly used for special\noperations until two years ago. It has been determined by the analysts that it was not built on\na banking trojan and the Anubis malware whose source code had leaked, or many similar\ntrojans, but was written completely from scratch.\n\n## Static Analysis\n\nMD5: 872ebba0dfe0a28da3e91b0ee4d6df32\n\nSHA1: 6a87c50179b08740bcab9da69a869d7c881f40c4\n\nSHA-256: 9832b1ade1907849fd7091e85f2c24bd8a4488ecd96f0638fc979d8858b25196\n\nC&C URL: http://botduke1.ug\n\nThe AndroidManifest.xml file shows that the application uses many permissions that can be\nused maliciously. In addition, the class name that is not in the code shows that the\napplication loads some classes at run-time, and the classes that are not in the manifest file\nare put in order to complicate the code analysis.\n\n\n-----\n\nWhen we hook the application, we see that the malware creates the Ab.json file and\nDexClassLoader is detected in this file. In this way, the actual dex file (Ab.json) is loaded at\nrun-time.\n\nAfter the application runs on the device, the files and directories under its own directory are\nlisted as follows.\n\n\n-----\n\nWhen file.delete (Java level) and unlink syscall (System level) functions are hooked, it is seen\nthat ring0.xml.bak, ring0.xml, Ab.json and Ab.dex files are tried to be deleted from the\nsystem.\n\nAfter pulling the Ab.json file from the device, we can see the\nqhsewqxnjwezdfj.mysoclyistirmcm.wkzf class in AndroidManifest.xml. You can use eybisi’s\njadx fork to hide enum classes and for extra features.\n\nThe RC4 algorithm is frequently used in malware. When we search for the “^” character in\nboth the apk file and the Ab.json loaded at run-time, we can find the f class that encrypts with\nRC4.\n\n\n-----\n\nThe use of the decryption function used in the application is as follows.\n\n**Decryption**\n\nThis method converts hex string to byte. The output is seen in the figure below:\n\nThe output of the previous function (h) is passed to the RC4 cipher. It also decrypts using a\nhard-coded key. The e string in the c class is used as the RC4 decryption key.\n\n\n-----\n\nWhen the strings in the c class are decrypted with Base64+RC4, the strings used by the\nmalware are accessed. You can use this script for decryption\n[https://gist.github.com/nurpabuccu/ac3fe35720d13890c0cc5317acf12a82](https://gist.github.com/nurpabuccu/ac3fe35720d13890c0cc5317acf12a82)\n\nThe decrypted strings contain the application name, permissions, Telegram channel,\nparameters sent in the network traffic, the RC4 key used to analyze the network traffic, and\nthe nick of the malware author “ring0”, which is one of the important data about the\nmalware.\n\nSome these strings are also available in the ring0.xml file under the shared_prefs directory of\nthe application on the device.\n\n\n-----\n\nThe malware can get all the contacts from the Android phone book with the CONTENT_URI\nfield.\n\n\n-----\n\nAfter getting the phone book, the malware can send sms messages.\n\nMalware can enable call forwarding to the specified number.\n\nThe malware is also configured to run on Xiaomi systems. The code block for checking\nMIUI.UIversion is as follows:\n\nMalware changes its behavior depending on the system language. The system looks at its\ndefault language and displays notifications based on that data (from the “string L” seen in\nclass c below).\n\n\n-----\n\nAndroid’s battery optimization feature suspends the app to conserve battery, but since it’s a\nmalicious RAT, it constantly listens for commands from the attacker. Upon installation, the\nmalware uses the REQUEST_IGNORE_BATTERY_OPTIMIZATIONS permission to prompt\nthe user to ignore battery optimization for this app. Ignoring Battery Optimizations prevents\nthe malware from being shut down by the battery optimization routine inside the device even\nwhen idle.\n\nAlso this method used for blocking attempt to uninstall the app from the device.\n\nIn above, we can see the message for blocking removal of TeamViewer app from the device.\nCerberus use TeamViewe for remote access to victims device.\n\n\n-----\n\nThere are also some additional features in the malware. Using these commands the device\ncan be turned into a RAT (Remote Access Trojan).\n\ngrabbing_pass_gmail\ngrabbing_lockpattern\nrat_connect\nchange_url_connect\nrequest_permission\nchange_url_recover\nrun_admin_device\nurl\nussd\nsms_mailing_phonebook\nget_data_logs\ngrabbing_google_authenticator2\nremove_app\nremove_bot\nnotification\nsend_sms\ncall_forward\nrun_app\npatch_update\n\n\n-----\n\n## Dynamic Analysis\n\nThe application is hidden under the name “Vodafone 5G”. When the application is launched,\nit asks the user to enable Accessibility Service.\n\nAfter the user grants the requested permission, the malware abuses it by giving it additional\npermissions, such as permissions to send messages, perform some action commands from\nC&C, and make calls without requiring any user interaction. It also disables Google Play\nProtect to prevent it from being discovered and deleted in the future. The malware\nappropriately grants it additional privileges and secures its persistence on the device. If the\nuser tries to uninstall the malicious application or tries to disable the accessibility of the\nmalicious application, it can prevent the user from uninstalling the software.\n\nTYPE_VIEW_CLICKED (eventType=1)\nTYPE_VIEW_FOCUSED (eventType=8)\nTYPE_VIEW_TEXT_CHANGED (eventType=16)\nTYPE_WINDOW_STATE_CHANGED (eventType=32)\n\nFor constant values of events:\n[https://www.apiref.com/android/android/view/accessibility/AccessibilityEvent.html](https://www.apiref.com/android/android/view/accessibility/AccessibilityEvent.html)\n\n\n-----\n\n-----\n\nAfter the user allows the Accessibility Service, the application icon is deleted from the menu.\nIt then sends a request to the C&C server (http://botduke1.ug).\n\n\n-----\n\nSince C&C is not active during the analysis process, we cannot see all functions. When we\nlook at the Cerberus analysis reports/blogs, we can see that the parameters listed below are\nused:\n\nd_attacker_two\nd_attacker\nis_attacker\ninfo_device\nnew_device\nsaved_data_attacker\nsaved_data_device\npause_attacker\nsaved_accessibility_events\nupgrade_patch\nconnecting\nsaved_all_sms\nsaved_contacts\nsaved_applications\nrat_connect\nrat_cmd\n\nIn the first request, the malware is trying to collect some data about the device. Requests sent\nby the device can be found as follows. info_device request contains device data such as\nDevice Battery Level, Device Language. This request keeps the C&C server updated with new\ninformation about the device.\n\nIn the data in the resolved HTTP request, many personal and sensitive data on the device are\nsent to http://botduke1.ug, where the application communicates, by POST method.\n\n**Features**\n\n\n-----\n\nCerberus has the same capabilities as most other Android banking trojans, such as overlay\nattacks, SMS checking. The Trojan can also take advantage of keystrokes to expand its attack\ncoverage.\n\nOverlaying: Dynamic (Local injects obtained from C2)\nKeylogging\nSMS listing\nSMS forwarding\nDevice info collection\nContact list collection\nApplication listing\nLocation collection\nSMS Sending\nCalls: USSD request making\nCalls: Call forwarding\nRemote actions: App installing\nRemote actions: App starting\nRemote actions: App removal\nRemote actions: Showing arbitrary web pages\nRemote actions: Screen-locking\nNotifications: Push notifications\nHiding the App icon\nPreventing removal\nEmulation-detection\nStealing 2FA tokens\n\nOn August 2020, Cerberus group officially announced the project is indeed dead because of\nGoogle Play Protects new functionality. Forum admin who bought Cerberus, shared the\nsource code publicly.\n\n## References\n\n[https://pentest.blog/n-ways-to-unpack-mobile-malware/](https://pentest.blog/n-ways-to-unpack-mobile-malware/)\n\n[https://koodous.com/apks](https://koodous.com/apks)\n\nhttps://www.threatfabric.com/blogs/cerberus-a-new-banking-trojan-from-theunderworld.html\n\n[https://www.biznet.com.tr/wp-content/uploads/2020/08/Cerberus.pdf](https://www.biznet.com.tr/wp-content/uploads/2020/08/Cerberus.pdf)\n\n[https://www.avira.com/en/blog/in-depth-analysis-of-a-cerberus-trojan-variant](https://www.avira.com/en/blog/in-depth-analysis-of-a-cerberus-trojan-variant)\n\nhttps://securitynews.sonicwall.com/xmlpost/coronavirus-themed-android-rat-on-theprowl/\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-06-16 - Cerberus Analysis - Android Banking Trojan.pdf"
    ],
    "report_names": [
        "2021-06-16 - Cerberus Analysis - Android Banking Trojan.pdf"
    ],
    "threat_actors": [
        {
            "id": "3fff98c9-ad02-401d-9d4b-f78b5b634f31",
            "created_at": "2023-01-06T13:46:38.376868Z",
            "updated_at": "2025-03-27T02:00:02.818071Z",
            "deleted_at": null,
            "main_name": "Cleaver",
            "aliases": [
                "Cobalt Gypsy",
                "G0003",
                "Operation Cleaver",
                "Op Cleaver",
                "Tarh Andishan",
                "Alibaba",
                "TG-2889"
            ],
            "source_name": "MISPGALAXY:Cleaver",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673536052,
    "ts_updated_at": 1743041165,
    "ts_creation_date": 1653488500,
    "ts_modification_date": 1653488500,
    "files": {
        "pdf": "https://archive.orkl.eu/87d15693fc66c49b1b1b662bcfcbf56c0846e6c5.pdf",
        "text": "https://archive.orkl.eu/87d15693fc66c49b1b1b662bcfcbf56c0846e6c5.txt",
        "img": "https://archive.orkl.eu/87d15693fc66c49b1b1b662bcfcbf56c0846e6c5.jpg"
    }
}