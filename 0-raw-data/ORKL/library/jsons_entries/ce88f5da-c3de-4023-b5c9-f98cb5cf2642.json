{
    "id": "ce88f5da-c3de-4023-b5c9-f98cb5cf2642",
    "created_at": "2023-01-12T15:06:34.593962Z",
    "updated_at": "2025-03-27T02:06:13.087449Z",
    "deleted_at": null,
    "sha1_hash": "af54473150134497daae6eadb0d0a1fafb52f2a4",
    "title": "2021-02-02 - Kobalos – A complex Linux threat to high performance computing infrastructure",
    "authors": "",
    "file_creation_date": "2022-05-28T16:10:52Z",
    "file_modification_date": "2022-05-28T16:10:52Z",
    "file_size": 375840,
    "plain_text": "# Kobalos – A complex Linux threat to high performance computing infrastructure\n\n**[welivesecurity.com/2021/02/02/kobalos-complex-linux-threat-high-performance-computing-infrastructure/](https://www.welivesecurity.com/2021/02/02/kobalos-complex-linux-threat-high-performance-computing-infrastructure/)**\n\nFebruary 2, 2021\n\nESET researchers publish a white paper about unique multiplatform malware they’ve\nnamed Kobalos\n\nESET researchers have analyzed malware that has been targeting high performance\ncomputing (HPC) clusters, among other high-profile targets. We reverse engineered this\nsmall, yet complex, malware that is portable to many operating systems including Linux,\nBSD, Solaris, and possibly AIX and Windows. We have named this malware Kobalos for its\ntiny code size and many tricks; in Greek mythology, a Kobalos is a small, mischievous\ncreature. Today we publish a paper titled “A wild Kobalos appears: Tricksy Linux malware\ngoes after HPCs” describing the inner working of this threat.\n\n[A wild Kobalos appears: Tricksy Linux malware goes after HPCs](https://www.welivesecurity.com/wp-content/uploads/2021/01/ESET_Kobalos.pdf)\n\n[Download Research Paper](https://www.welivesecurity.com/wp-content/uploads/2021/01/ESET_Kobalos.pdf)\n\n\n-----\n\nPerhaps unrelated to the events involving Kobalos, there were multiple security incidents\ninvolving HPC clusters in the past year. Some of them [hit the press and](https://www.darkreading.com/attacks-breaches/uk-supercomputing-service-archer-still-offline-after-monday-attack/d/d-id/1337838) details were made\npublic in an advisory from the European Grid Infrastructure (EGI) CSIRT about cases where\ncryptocurrency miners were deployed. The EGI CSIRT advisory shows compromised\nservers in Poland, Canada and China were used in these attacks. Press articles also\nmention Archer, a breached UK-based supercomputer where SSH credentials were stolen,\nbut do not contain details about which malware was used, if any.\n\nWe’ve worked with the CERN Computer Security Team and other organizations involved in\nmitigating attacks on scientific research networks. According to them, the usage of the\nKobalos malware predates the other incidents. While we know Kobalos compromised large\nHPC clusters, no one could link the Kobalos incidents to the use of cryptocurrency malware.\nThe malware and the techniques described in these other attacks are different. We also\nknow Kobalos is not exclusively targeting HPCs: we found that a large Asian ISP, a North\nAmerican endpoint security vendor (not us), as well as some personal servers were also\ncompromised by this threat.\n\n## Tiny code, big targets\n\nThorough analysis of Kobalos revealed that it is sometimes possible to remotely determine\nif a system is compromised by connecting to the SSH server using a specific TCP source\nport. Using that knowledge, ESET researchers scanned the internet to find potential victims.\nWe were able to identify multiple targets of Kobalos, including HPC systems.\n\n\n-----\n\n_Figure 1. Industry and region of compromised organizations_\n\nWe notified all identified victims and worked with them to remediate.\n\n## The backdoor\n\nKobalos is a generic backdoor in the sense that it contains broad commands that don’t\nreveal the intent of the attackers. In short, Kobalos grants remote access to the file system,\nprovides the ability to spawn terminal sessions, and allows proxying connections to other\nKobalos-infected servers.\n\n\n-----\n\n_Figure 2. Overview of Kobalos features and ways to access them_\n\nThere are multiple ways for the operators to reach a Kobalos-infected machine. The method\nwe’ve seen the most is where Kobalos is embedded in the OpenSSH server executable\n(sshd) and will trigger the backdoor code if the connection is coming from a specific TCP\nsource port. There are other stand-alone variants that are not embedded in sshd. These\nvariants either connect to a C&C server that will act as a middleman, or wait for an inbound\nconnection on a given TCP port.\n\nSomething that makes Kobalos unique is the fact that the code for running a C&C server is\nin Kobalos itself. Any server compromised by Kobalos can be turned into a C&C server by\nthe operators sending a single command. As the C&C server IP addresses and ports are\nhardcoded into the executable, the operators can then generate new Kobalos samples that\nuse this new C&C server.\n\n\n-----\n\n## The sidekick\n\nIn most systems compromised by Kobalos, the SSH client is compromised to steal\ncredentials. This credential stealer is unlike any of the malicious OpenSSH clients we’ve\n[seen before, and we’ve looked at tens of](https://www.welivesecurity.com/2018/12/05/dark-side-of-the-forsshe/) [them in the](https://www.welivesecurity.com/2014/02/21/an-in-depth-analysis-of-linuxebury/) [past eight years. The sophistication of](https://www.welivesecurity.com/2013/01/24/linux-sshdoor-a-backdoored-ssh-daemon-that-steals-passwords/)\nthis component is not the same as Kobalos itself: there was no effort to obfuscate early\nvariants of the credential stealer. For example, strings were left unencrypted and stolen\nusernames and passwords are simply written to a file on disk. However, we found newer\nvariants that contain some obfuscation and the ability to exfiltrate credentials over the\nnetwork.\n\nThe presence of this credential stealer may partially answer how Kobalos propagates.\nAnyone using the SSH client of a compromised machine will have their credentials\ncaptured. Those credentials can then be used by the attackers to install Kobalos on the\nnewly discovered server later.\n\n## How it hides\n\nAnalyzing Kobalos isn’t as trivial as most Linux malware because all of its code is held in a\nsingle function that recursively calls itself to perform subtasks.\n\n\n-----\n\n_Figure 3. Control flow graph of Kobalos_\n\nThis makes it more challenging to analyze. Additionally, all strings are encrypted so it’s\nmore difficult to find the malicious code than when looking at the samples statically.\n\nUsage of the backdoor requires a private 512-bit RSA key and a 32-byte-long password.\nOnce authenticated, RC4 keys are exchanged and the rest of the communication is\nencrypted with them.\n\nThe network protocol is summarized by the sequence diagram.\n\n\n-----\n\n_Figure 4. Sequence diagram summarizing Kobalos network protocols_\n\n## Remediation\n\nESET products detect the Kobalos malware as Linux/Kobalos or Linux/Agent.IV. The SSH\ncredential stealer is detected as Linux/SSHDoor.EV, Linux/SSHDoor.FB or\nLinux/SSHDoor.FC. A YARA rule is also available in ESET’s [malware-ioc repository on](https://github.com/eset/malware-ioc/tree/master/kobalos)\nGitHub.\n\nFrom a network perspective, it is possible to detect Kobalos by looking for non-SSH traffic\non the port attributed to an SSH server. When the Kobalos backdoor communicates with an\noperator, there is no SSH banner (SSH-2.0‑…) exchanged, neither from the client nor the\nserver.\n\n\n-----\n\n[We have suggested before setting up two-factor authentication (2FA) for connecting to SSH](https://www.welivesecurity.com/2020/02/21/up-close-and-personal-with-linux-malware/)\nservers. Kobalos is another case where 2FA could have mitigated the threat, since the use\nof stolen credentials seems to be one of the ways it is able to propagate to different\nsystems.\n\n## Conclusion\n\nWe were unable to determine the intentions of the operators of Kobalos. No other malware,\nexcept for the SSH credential stealer, was found by the system administrators of the\ncompromised machines. We also didn’t have access to network traffic captures of the\noperators in action.\n\nThe way Kobalos is tightly contained in a single function and the usage of an existing open\nport to reach Kobalos makes this threat harder to find. Hopefully the details we reveal today\nin our new publication will help raise awareness around this threat and put its activity under\nthe microscope. This level of sophistication is only rarely seen in Linux malware. Given that\nit’s more advanced than the average and that it compromised rather large organizations,\nKobalos may be running around for a little while.\n\nA comprehensive list of Indicators of Compromise (IoCs) and samples can be found in our\nGitHub repository.\n\n_For any inquiries, or to make sample submissions related to the subject, contact us at_\n_[threatintel@eset.com.](http://10.10.0.46/mailto:threatintel@eset.com)_\n\n_[We would like to acknowledge the work of Maciej Kotowicz from](https://twitter.com/maciekkotowicz)_ _[MalwareLab.pl who also](https://malwarelab.pl/)_\n_[analyzed Kobalos independently and with whom we mutually share results. He presented](https://omhconf.pl/lecture#id=63871)_\n_on this threat at the Oh My H@ck 2020 conference._\n\n## MITRE ATT&CK techniques\n\n_[This table was built using version 8 of the ATT&CK framework.](https://attack.mitre.org/versions/)_\n\n**Tactic** **ID** **Name** **Description**\n\n\nPersistence [T1554](https://attack.mitre.org/versions/v8/techniques/T1554/) Compromise Client\nSoftware Binary\n\n\nKobalos may embed its\nmalicious payload in the\nOpenSSH server and\nreplace the legitimate\nfile (sshd).\nKobalos replaces the\nSSH client on\ncompromised systems\nto steal credentials.\n\n\n-----\n\n**Tactic** **ID** **Name** **Description**\n\n[T1205](https://attack.mitre.org/versions/v8/techniques/T1205/) Traffic Signaling Kobalos may be\ntriggered by an incoming\nTCP connection to a\nlegitimate service from a\nspecific source port.\n\n\nDefense\nEvasion\n\n\n[T1070.003](https://attack.mitre.org/versions/v8/techniques/T1070/003) Clear Command History No command history\nrelated to the attack\nwas found on Kobalosinfected machines.\n\n\n[T1070.006](https://attack.mitre.org/versions/v8/techniques/T1070/006) Timestomp When files are replaced\nby Kobalos operators,\ntimestamps are forged.\n\n[T1027.002](https://attack.mitre.org/versions/v8/techniques/T1027/002) Software Packing Kobalos’s code is\nflattened into a single\nfunction using a custom\npacker and its strings are\nencrypted.\n\n\nCommand\nand Control\n\n\n[T1573.001](https://attack.mitre.org/versions/v8/techniques/T1573/001) Encrypted\nChannel: Symmetric\nCryptography\n\n\nKobalos’s postauthentication\ncommunication channel\nis encrypted with RC4.\n\n\n[T1573.002](https://attack.mitre.org/versions/v8/techniques/T1573/002) Encrypted\nChannel: Asymmetric\nCryptography\n\n[T1090.003](https://attack.mitre.org/versions/v8/techniques/T1090/003) Proxy: Multi-hop\nProxy\n\n2 Feb 2021 - 11:30AM\n\n\nKobalos’s authentication\nand key exchange is\nperformed using RSA512.\n\nKobalos can serve as a\nproxy to other Kobaloscompromised systems.\n\n\n### Sign up to receive an email update whenever a new article is published in our Ukraine Crisis – Digital Security Resource Center\n\n Newsletter\n\n\n-----\n\n### Discussion\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-02-02 - Kobalos – A complex Linux threat to high performance computing infrastructure.pdf"
    ],
    "report_names": [
        "2021-02-02 - Kobalos – A complex Linux threat to high performance computing infrastructure.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535994,
    "ts_updated_at": 1743041173,
    "ts_creation_date": 1653754252,
    "ts_modification_date": 1653754252,
    "files": {
        "pdf": "https://archive.orkl.eu/af54473150134497daae6eadb0d0a1fafb52f2a4.pdf",
        "text": "https://archive.orkl.eu/af54473150134497daae6eadb0d0a1fafb52f2a4.txt",
        "img": "https://archive.orkl.eu/af54473150134497daae6eadb0d0a1fafb52f2a4.jpg"
    }
}