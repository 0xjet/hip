{
    "id": "221b5add-bb78-4c43-8ed2-7957223a5353",
    "created_at": "2022-10-25T16:48:11.251251Z",
    "updated_at": "2025-03-27T02:05:19.274004Z",
    "deleted_at": null,
    "sha1_hash": "0c853a4bcad3e0a13f06295a2e27a8d708756fee",
    "title": "Guidelines on firewalls and firewall policy",
    "authors": "",
    "file_creation_date": "2009-09-22T08:06:40Z",
    "file_modification_date": "2012-02-06T09:11:23Z",
    "file_size": 339557,
    "plain_text": "Special Publication 800-41\n\nRevision 1\n\n\n# Guidelines on Firewalls and Firewall Policy\n\n## Recommendations of the National Institute of Standards and Technology\n\n#### Karen Scarfone Paul Hoffman\n\n\n-----\n\n|Col1|Guidelines on Firewalls and Firewall Policy Recommendations of the National Institute of Standards and Technology Karen Scarfone Paul Hoffman|\n|---|---|\n|NIST Special Publication 800-41 Revision 1||\n|||\n\n\n### C O M P U T E R   S E C U R I T Y\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\n###### Reports on Computer Systems Technology\n\nThe Information Technology Laboratory (ITL) at the National Institute of Standards and Technology\n(NIST) promotes the U.S. economy and public welfare by providing technical leadership for the nation’s\nmeasurement and standards infrastructure. ITL develops tests, test methods, reference data, proof of\nconcept implementations, and technical analysis to advance the development and productive use of\ninformation technology. ITL’s responsibilities include the development of technical, physical,\nadministrative, and management standards and guidelines for the cost-effective security and privacy of\nsensitive unclassified information in Federal computer systems. This Special Publication 800-series\nreports on ITL’s research, guidance, and outreach efforts in computer security and its collaborative\nactivities with industry, government, and academic organizations.\n\n\n**National Institute of Standards and Technology Special Publication 800-41 Revision 1**\n\n**Natl. Inst. Stand. Technol. Spec. Publ. 800-41 rev1, 48 pages (Sep. 2009)**\n\n\nCertain commercial entities, equipment, or materials may be identified in this\ndocument in order to describe an experimental procedure or concept adequately.\nSuch identification is not intended to imply recommendation or endorsement by the\n\nNational Institute of Standards and Technology, nor is it intended to imply that the\n\nentities, materials, or equipment are necessarily the best available for the purpose.\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\n###### Acknowledgments\n\nThe authors, Karen Scarfone of the National Institute of Standards and Technology (NIST) and Paul\nHoffman of the Virtual Private Network Consortium, wish to thank their colleagues who reviewed drafts\nof this document and contributed to its technical content. The authors would like to acknowledge Tim\nGrance, Murugiah Souppaya, Sheila Frankel, and Gale Richter of NIST, and Matthew Goche, David\nKlug, Logan Lodge, John Pearce, Noel Richards, Anne Roudabush, and Steven Sharma of Booz Allen\nHamilton, for their keen and insightful assistance throughout the development of the document. Special\nthanks go to Brahim Asfahani of Booz Allen Hamilton for his contributions to early drafts of the\ndocument. The authors also thank all the reviewers who provided feedback during the public comment\nperiod, particularly Joel Snyder (Opus One), Ron Colvin (National Aeronautics and Space Administration\n\n[NASA]), Dean Farrington (Wells Fargo), Raffael Marty (Splunk), and David Newman (Network Test).\n\nThe authors also wish to express their thanks to the individuals and organizations that contributed to the\noriginal version of the publication, including John Wack of NIST and Ken Cutler and Jamie Pole of the\nMIS Training Institute, who authored the original version, and other contributors and reviewers—\nparticularly Peter Batista and Wayne Bavry (U.S. Treasury); Harriet Feldman (Integrated Computer\nEngineering, Inc.); Rex Sanders (U.S. Geological Survey); and Timothy Grance, D. Richard Kuhn, Peter\nMell, Gale Richter, and Murugiah Souppaya (NIST).\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\n###### Table of Contents\n\n**Executive Summary..............................................................................................................ES-1**\n\n**1.** **Introduction ......................................................................................................................1-1**\n\n1.1 Authority...................................................................................................................1-1\n1.2 Purpose and Scope .................................................................................................1-1\n1.3 Audience..................................................................................................................1-1\n1.4 Document Structure.................................................................................................1-1\n\n**2.** **Overview of Firewall Technologies ................................................................................2-1**\n\n2.1 Firewall Technologies ..............................................................................................2-2\n2.1.1 Packet Filtering.............................................................................................2-2\n2.1.2 Stateful Inspection........................................................................................2-4\n2.1.3 Application Firewalls.....................................................................................2-5\n2.1.4 Application-Proxy Gateways.........................................................................2-6\n2.1.5 Dedicated Proxy Servers..............................................................................2-6\n2.1.6 Virtual Private Networking ............................................................................2-7\n2.1.7 Network Access Control ...............................................................................2-8\n2.1.8 Unified Threat Management (UTM)..............................................................2-9\n2.1.9 Web Application Firewalls ............................................................................2-9\n2.1.10 Firewalls for Virtual Infrastructures...............................................................2-9\n2.2 Firewalls for Individual Hosts and Home Networks................................................2-10\n2.2.1 Host-Based Firewalls and Personal Firewalls ............................................2-10\n2.2.2 Personal Firewall Appliances .....................................................................2-11\n2.3 Limitations of Firewall Inspection...........................................................................2-11\n2.4 Summary of Recommendations.............................................................................2-12\n\n**3.** **Firewalls and Network Architectures.............................................................................3-1**\n\n3.1 Network Layouts with Firewalls................................................................................3-1\n3.2 Firewalls Acting as Network Address Translators....................................................3-3\n3.3 Architecture with Multiple Layers of Firewalls ..........................................................3-4\n3.4 Summary of Recommendations...............................................................................3-4\n\n**4.** **Firewall Policy ..................................................................................................................4-1**\n\n4.1 Policies Based on IP Addresses and Protocols .......................................................4-1\n4.1.1 IP Addresses and Other IP Characteristics..................................................4-1\n4.1.2 IPv6 ..............................................................................................................4-3\n4.1.3 TCP and UDP...............................................................................................4-4\n4.1.4 ICMP.............................................................................................................4-4\n4.1.5 IPsec Protocols.............................................................................................4-5\n4.2 Policies Based on Applications................................................................................4-5\n4.3 Policies Based on User Identity ...............................................................................4-6\n4.4 Policies Based on Network Activity..........................................................................4-6\n4.5 Summary of Recommendations...............................................................................4-7\n\n**5.** **Firewall Planning and Implementation...........................................................................5-1**\n\n5.1 Plan..........................................................................................................................5-1\n5.2 Configure .................................................................................................................5-4\n5.2.1 Hardware and Software Installation..............................................................5-4\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\n5.2.2 Policy Configuration......................................................................................5-4\n5.2.3 Logging and Alerts Configuration .................................................................5-5\n5.3 Test..........................................................................................................................5-6\n5.4 Deploy......................................................................................................................5-6\n5.5 Manage....................................................................................................................5-7\n\n###### List of Appendices\n\n**Appendix A— Glossary..........................................................................................................A-1**\n\n**Appendix B— Acronyms and Abbreviations .......................................................................B-1**\n\n**Appendix C— Resources.......................................................................................................C-1**\n\n###### List of Figures\n\nFigure 2-1. TCP/IP Layers .........................................................................................................2-1\n\nFigure 2-2. Application Proxy Configuration ..............................................................................2-7\n\nFigure 3-1. Simple Routed Network with Firewall Device ..........................................................3-2\n\nFigure 3-2. Firewall with a DMZ .................................................................................................3-2\n\n###### List of Tables\n\nTable 2-1. State Table Example ................................................................................................2-4\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\n\n###### Executive Summary\n\n\nFirewalls are devices or programs that control the flow of network traffic between networks or hosts that\nemploy differing security postures. At one time, most firewalls were deployed at network perimeters. This\nprovided some measure of protection for internal hosts, but it could not recognize all instances and forms\nof attack, and attacks sent from one internal host to another often do not pass through network firewalls.\nBecause of these and other factors, network designers now often include firewall functionality at places\nother than the network perimeter to provide an additional layer of security, as well as to protect mobile\ndevices that are placed directly onto external networks.\n\nThreats have gradually moved from being most prevalent in lower layers of network traffic to the\napplication layer, which has reduced the general effectiveness of firewalls in stopping threats carried\nthrough network communications. However, firewalls are still needed to stop the significant threats that\ncontinue to work at lower layers of network traffic. Firewalls can also provide some protection at the\napplication layer, supplementing the capabilities of other network security technologies.\n\nThere are several types of firewalls, each with varying capabilities to analyze network traffic and allow or\nblock specific instances by comparing traffic characteristics to existing policies. Understanding the\ncapabilities of each type of firewall, and designing firewall policies and acquiring firewall technologies\nthat effectively address an organization’s needs, are critical to achieving protection for network traffic\nflows. This document provides an overview of firewall technologies and discusses their security\ncapabilities and relative advantages and disadvantages in detail. It also provides examples of where\nfirewalls can be placed within networks, and the implications of deploying firewalls in particular\nlocations. The document also makes recommendations for establishing firewall policies and for selecting,\nconfiguring, testing, deploying, and managing firewall solutions.\n\nThis document does not cover technologies that are called “firewalls” but primarily examine only\napplication layer activity, not lower layers of network traffic. Technologies that focus on activity for a\nparticular type of application, such as email firewalls that block email messages with suspicious content,\nare not covered in detail in this document.\n\nTo improve the effectiveness and security of their firewalls, organizations should implement the\nfollowing recommendations:\n\n**Create a firewall policy that specifies how firewalls should handle inbound and outbound network**\n**traffic.**\n\nA firewall policy defines how an organization’s firewalls should handle inbound and outbound network\ntraffic for specific IP addresses and address ranges, protocols, applications, and content types based on the\norganization’s information security policies. Organizations should conduct risk analysis to develop a list\nof the types of traffic needed by the organization and how they must be secured—including which types\nof traffic can traverse a firewall under what circumstances. Examples of policy requirements include\npermitting only necessary Internet Protocol (IP) protocols to pass, appropriate source and destination IP\naddresses to be used, particular Transmission Control Protocol (TCP) and User Datagram Protocol (UDP)\nports to be accessed, and certain Internet Control Message Protocol (ICMP) types and codes to be used.\nGenerally, all inbound and outbound traffic not expressly permitted by the firewall policy should be\nblocked because such traffic is not needed by the organization. This practice reduces the risk of attack and\ncan also decrease the volume of traffic carried on the organization’s networks.\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\n**Identify all requirements that should be considered when determining which firewall to implement.**\n\nThere are many considerations that organizations should include in their firewall selection and planning\nprocesses. Organizations need to determine which network areas need to be protected, and which types of\nfirewall technologies will be most effective for the types of traffic that require protection. Several\nimportant performance considerations also exist, as well as concerns regarding the integration of the\nfirewall into existing network and security infrastructures. Additionally, firewall solution design involves\nrequirements relating to physical environment and personnel as well as consideration of possible future\nneeds, such as plans to adopt new IPv6 technologies or virtual private networks (VPN).\n\n**Create rulesets that implement the organization’s firewall policy while supporting firewall**\n**performance.**\n\nFirewall rulesets should be as specific as possible with regards to the network traffic they control. To\ncreate a ruleset involves determining what types of traffic are required, including protocols the firewall\nmay need to use for management purposes. The details of creating rulesets vary widely by type of firewall\nand specific products, but many firewalls can have their performance improved by optimizing firewall\nrulesets. For example, some firewalls check traffic against rules in a sequential manner until a match is\nfound; for these firewalls, rules that have the highest chance of matching traffic patterns should be placed\nat the top of the list wherever possible.\n\n**Manage firewall architectures, policies, software, and other components throughout the life of the**\n**firewall solutions.**\n\nThere are many aspects to firewall management. For example, choosing the type or types of firewalls to\ndeploy and their positions within the network can significantly affect the security policies that the\nfirewalls can enforce. Policy rules may need to be updated as the organization’s requirements change,\nsuch as when new applications or hosts are implemented within the network. Firewall component\nperformance also needs to be monitored to enable potential resource issues to be identified and addressed\nbefore components become overwhelmed. Logs and alerts should also be continuously monitored to\nidentify threats—both successful and unsuccessful. Firewall rulesets and policies should be managed by a\nformal change management control process because of their potential to impact security and business\noperations, with ruleset reviews or tests performed periodically to ensure continued compliance with the\norganization’s policies. Firewall software should be patched as vendors provide updates to address\nvulnerabilities.\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\n\n###### 1. Introduction\n\n\n**1.1** **Authority**\n\nThe National Institute of Standards and Technology (NIST) developed this document in furtherance of its\nstatutory responsibilities under the Federal Information Security Management Act (FISMA) of 2002,\nPublic Law 107-347.\n\nNIST is responsible for developing standards and guidelines, including minimum requirements, for\nproviding adequate information security for all agency operations and assets; but such standards and\nguidelines shall not apply to national security systems. This guideline is consistent with the requirements\nof the Office of Management and Budget (OMB) Circular A-130, Section 8b(3), “Securing Agency\nInformation Systems,” as analyzed in A-130, Appendix IV: Analysis of Key Sections. Supplemental\ninformation is provided in A-130, Appendix III.\n\nThis guideline has been prepared for use by Federal agencies. It may be used by nongovernmental\norganizations on a voluntary basis and is not subject to copyright, though attribution is desired.\n\nNothing in this document should be taken to contradict standards and guidelines made mandatory and\nbinding on Federal agencies by the Secretary of Commerce under statutory authority, nor should these\nguidelines be interpreted as altering or superseding the existing authorities of the Secretary of Commerce,\nDirector of the OMB, or any other Federal official.\n\n**1.2** **Purpose and Scope**\n\nThis document seeks to assist organizations in understanding the capabilities of firewall technologies and\nfirewall policies. It provides practical guidance on developing firewall policies and selecting, configuring,\ntesting, deploying, and managing firewalls.\n\n**1.3** **Audience**\n\nThis document has been created primarily for technical information technology (IT) personnel such as\nnetwork, security, and system engineers and administrators who are responsible for firewall design,\nselection, deployment, and management. Other IT personnel with network and system security\nresponsibilities may also find this document to be useful. The content assumes some basic knowledge of\nnetworking and network security.\n\n**1.4** **Document Structure**\n\nThe remainder of this document is organized into four major sections:\n\n� Section 2 provides an overview of a number of network firewall technologies—including packet\nfiltering, stateful inspection, and application-proxy gatewaying—and also provides information on\nhost-based and personal firewalls.\n\n� Section 3 discusses the placement of firewalls within network architectures.\n\n� Section 4 discusses firewall policies and makes recommendations on the types of traffic that should\nbe specified as prohibited.\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\n� Section 5 provides an overview of firewall planning and implementation. It lists factors to consider\nwhen selecting firewall solutions, and provides recommendations for firewall configuration, testing,\ndeployment, and management.\n\nThe document also contains appendices with supporting material:\n\n� Appendices A and B contain a glossary and an acronym and abbreviation list, respectively.\n\n� Appendix C lists print and online resources that may be of use in gaining a better understanding of\nfirewalls.\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\n\n###### 2. Overview of Firewall Technologies\n\n\n_Firewalls are devices or programs that control the flow of network traffic between networks or hosts that_\nemploy differing security postures. While firewalls are often discussed in the context of Internet\nconnectivity, they may also have applicability in other network environments. For example, many\nenterprise networks employ firewalls to restrict connectivity to and from the internal networks used to\nservice more sensitive functions, such as accounting or personnel. By employing firewalls to control\nconnectivity to these areas, an organization can prevent unauthorized access to its systems and resources.\nInclusion of a proper firewall provides an additional layer of security. Organizations often need to use\nfirewalls to meet security requirements from mandates (e.g., FISMA); some mandates, such as the\nPayment Card Industry (PCI) Data Security Standard,[1] specifically require firewalling.\n\nSeveral types of firewall technologies are available. One way of comparing their capabilities is to look at\nthe Transmission Control Protocol/Internet Protocol (TCP/IP) layers that each is able to examine. TCP/IP\ncommunications are composed of four layers that work together to transfer data between hosts. When a\nuser wants to transfer data across networks, the data is passed from the highest layer through intermediate\nlayers to the lowest layer, with each layer adding more information. The lowest layer sends the\naccumulated data through the physical network, with the data then passed upwards through the layers to\nits destination. Simply put, the data produced by a layer is encapsulated in a larger container by the layer\nbelow it. The four TCP/IP layers, from highest to lowest, are shown in Figure 2-1.\n\n**Application Layer. This layer sends and receives data for particular applications, such as**\nDomain Name System (DNS), Hypertext Transfer Protocol (HTTP), and Simple Mail Transfer\nProtocol (SMTP). The application layer itself has layers of protocols within it. For example,\nSMTP encapsulates the Request for Comments (RFC) 2822 message syntax, which\nencapsulates Multipurpose Internet Mail Extensions (MIME), which can encapsulate other\nformats such as Hypertext Markup Language (HTML).\n\n**Transport Layer. This layer provides connection-oriented or connectionless services for**\ntransporting application layer services between networks, and can optionally ensure\ncommunications reliability. Transmission Control Protocol (TCP) and User Datagram Protocol\n(UDP) are commonly used transport layer protocols. [2]\n\n**IP Layer (also known as the Network Layer). This layer routes packets across networks.**\nInternet Protocol version 4 (IPv4) is the fundamental network layer protocol for TCP/IP. Other\ncommonly used protocols at the network layer are Internet Protocol version 6 (IPv6), ICMP, and\nInternet Group Management Protocol (IGMP).\n\n**Hardware Layer (also known as the Data Link Layer). This layer handles communications on**\nthe physical network components. The best known data link layer protocol is Ethernet.\n\n**Figure 2-1. TCP/IP Layers**\n\nAddresses at the data link layer, which are assigned to network interfaces, are referred to as media access\n_control (MAC) addresses—an example of this is an Ethernet address that belongs to an Ethernet card._\nFirewall policies rarely concern themselves with the data link layer. Addresses at the network layer are\nreferred to as IP addresses. The transport layer identifies specific network applications and\ncommunication sessions as opposed to network addresses; a host may have any number of transport layer\nsessions with other hosts on the same network. The transport layer may also include the notion of ports—\na destination port number generally identifies a service listening on the destination host, and a source port\nusually identifies the port number on the source host that the destination host should reply to. Transport\nprotocols such as TCP and UDP have ports, while other transport protocols do not. The combination of\n\n1 The PCI Data Security Standard may apply to some Federal agencies. It is defined at [https://www.pcisecuritystandards.org/.](https://www.pcisecuritystandards.org/)\n2 The differences between TCP and UDP are explained by several of the print resources listed in Appendix C.\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\nsource IP address and port with destination IP address and port helps define the session. The highest layer\nrepresents end user applications—firewalls can inspect application traffic and use it as the basis for policy\ndecisions.\n\nBasic firewalls operate on one or a few layers—typically the lower layers—while more advanced\nfirewalls examine all of the layers shown in Figure 2-1. Those that examine more layers can perform\nmore granular and thorough examinations. Firewalls that understand the application layer can potentially\naccommodate advanced applications and protocols and provide services that are user-oriented. For\nexample, a firewall that only handles lower layers cannot usually identify specific users, but a firewall\nwith application layer capabilities can enforce user authentication and log events to specific users.\n\n**2.1** **Firewall Technologies**\n\nThis section of the publication provides an overview of firewall technologies and basic information on the\ncapabilities of several commonly used types. Firewalling is often combined with other technologies—\nmost notably routing—and many technologies often associated with firewalls are more accurately part of\nthese other technologies. For example, network address translation (NAT) is sometimes thought of as a\nfirewall technology, but it is actually a routing technology. Many firewalls also include content filtering\nfeatures to enforce organization policies not directly related to security. Some firewalls include intrusion\nprevention system (IPS) technologies, which can react to attacks that they detect to prevent damage to\nsystems protected by the firewall.\n\nFirewalls are often placed at the perimeter of a network. Such a firewall can be said to have an external\nand internal interface, with the external interface being the one on the outside of the network. These two\ninterfaces are sometimes referred to as unprotected and protected, respectively. However, saying that\nsomething is or is not protected is often inappropriate because a firewall’s policies can work in both\ndirections; for example, there might be a policy to prevent executable code from being sent from inside\nthe perimeter to sites outside the perimeter.\n\n**2.1.1 Packet Filtering**\n\nThe most basic feature of a firewall is the packet filter. Older firewalls that were only packet filters were\nessentially routing devices that provided access control functionality for host addresses and\ncommunication sessions. These devices, also known as stateless inspection firewalls, do not keep track of\nthe state of each flow of traffic that passes though the firewall; this means, for example, that they cannot\nassociate multiple requests within a single session to each other. Packet filtering is at the core of most\nmodern firewalls, but there are few firewalls sold today that only do stateless packet filtering. Unlike\nmore advanced filters, packet filters are not concerned about the content of packets. Their access control\nfunctionality is governed by a set of directives referred to as a ruleset. Packet filtering capabilities are\nbuilt into most operating systems and devices capable of routing; the most common example of a pure\npacket filtering device is a network router that employs access control lists.\n\nIn their most basic form, firewalls with packet filters operate at the network layer. This provides network\naccess control based on several pieces of information contained in a packet, including:\n\n� The packet’s source IP address—the address of the host from which the packet originated (such as\n192.168.1.1)\n\n� The packet’s destination address—the address of the host the packet is trying to reach (e.g.,\n192.168.2.1)\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\n� The network or transport protocol being used to communicate between source and destination hosts,\nsuch as TCP, UDP, or ICMP\n\n� Possibly some characteristics of the transport layer communications sessions, such as session source\nand destination ports (e.g., TCP 80 for the destination port belonging to a web server, TCP 1320 for\nthe source port belonging to a personal computer accessing the server)\n\n� The interface being traversed by the packet, and its direction (inbound or outbound).\n\nFiltering inbound traffic is known as ingress filtering. Outgoing traffic can also be filtered, a process\nreferred to as egress filtering. Here, organizations can implement restrictions on their internal traffic, such\nas blocking the use of external file transfer protocol (FTP) servers or preventing denial of service (DoS)\nattacks from being launched from within the organization against outside entities. Organizations should\nonly permit outbound traffic that uses the source IP addresses in use by the organization—a process that\nhelps block traffic with spoofed addresses from leaking onto other networks. Spoofed addresses can be\ncaused by malicious events such as malware infections or compromised hosts being used to launch\nattacks, or by inadvertent misconfigurations.\n\nStateless packet filters are generally vulnerable to attacks and exploits that take advantage of problems\nwithin the TCP/IP specification and protocol stack. For example, many packet filters are unable to detect\nwhen a packet’s network layer addressing information has been spoofed or otherwise altered, or uses\noptions that are permitted by standards but generally used for malicious purposes, such as IP source\nrouting. Spoofing attacks, such as using incorrect addresses in the packet headers, are generally employed\nby intruders to bypass the security controls implemented in a firewall platform. Firewalls that operate at\nhigher layers can thwart some spoofing attacks by verifying that a session is established, or by\nauthenticating users before allowing traffic to pass. Because of this, most firewalls that use packet filters\nalso maintain some state information for the packets that traverse the firewall.\n\nSome packet filters can specifically filter packets that are fragmented. Packet fragmentation is allowed by\nthe TCP/IP specifications and is encouraged in situations where it is needed. However, packet\nfragmentation has been used to make some attacks harder to detect (by placing them within fragmented\npackets), and unusual fragmentation has also been used as a form of attack. For example, some networkbased attacks have used packets that should not exist in normal communications, such as sending some\nfragments of a packet but not the first fragment, or sending packet fragments that overlap each other. To\nprevent the use of fragmented packets in attacks, some firewalls have been configured to block\nfragmented packets.\n\nToday, fragmented packets on the Internet often occur not because of attacks, but because of virtual\nprivate networking (VPN) technologies that encapsulate packets within other packets. If encapsulating a\npacket would cause the new packet to exceed the maximum permitted size for the medium it will be\ntransmitted on, the packet must be fragmented. Fragmented packets being blocked by firewalls is a\ncommon cause of VPN interoperability issues.\n\nSome firewalls can reassemble fragments before passing them to the inside network, although this\nrequires additional firewall resources, particularly memory. Firewalls that have this reassembly feature\nmust implement it carefully, otherwise someone can readily mount a denial-of-service attack. Choosing\nwhether to block, reassemble, or pass fragmented packets is a tradeoff between overall network\ninteroperability and full system security. Given this, automatic blocking of all fragmented packets is not\nrecommended because of the legitimate and necessary uses of fragmentation on the Internet.\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\n**2.1.2 Stateful Inspection**\n\n_Stateful inspection improves on the functions of packet filters by tracking the state of connections and_\nblocking packets that deviate from the expected state. This is accomplished by incorporating greater\nawareness of the transport layer. As with packet filtering, stateful inspection intercepts packets at the\nnetwork layer and inspects them to see if they are permitted by an existing firewall rule, but unlike packet\nfiltering, stateful inspection keeps track of each connection in a state table. While the details of state table\nentries vary by firewall product, they typically include source IP address, destination IP address, port\nnumbers, and connection state information.\n\nThree major states exist for TCP traffic—connection establishment, usage, and termination (which refers\nto both an endpoint requesting that a connection be closed and a connection with a long period of\ninactivity.) Stateful inspection in a firewall examines certain values in the TCP headers to monitor the\nstate of each connection. Each new packet is compared by the firewall to the firewall’s state table to\ndetermine if the packet’s state contradicts its expected state. For example, an attacker could generate a\npacket with a header indicating it is part of an established connection, in hopes it will pass through a\nfirewall. If the firewall uses stateful inspection, it will first verify that the packet is part of an established\nconnection listed in the state table.\n\nIn the simplest case, a firewall will allow through any packet that seems to be part of an open connection\n(or even a connection that is not yet fully established). However, many firewalls are more cognizant of\nthe state machines for protocols such as TCP and UDP, and they will block packets that do not adhere\nstrictly to the appropriate state machine. For example, it is common for firewalls to check attributes such\nas TCP sequence numbers and reject packets that are out of sequence. When a firewall provides NAT\nservices, it often includes NAT information in its state table.\n\nTable 2-1 provides an example of a state table. If a device on the internal network (shown here as\n192.168.1.100) attempts to connect to a device outside the firewall (192.0.2.71), the connection attempt is\nfirst checked to see if it is permitted by the firewall ruleset. If it is permitted, an entry is added to the state\ntable that indicates a new session is being initiated, as shown in the first entry under “Connection State”\nin Table 2-1. If 192.0.2.71 and 192.168.1.100 complete the three-way TCP handshake, the connection\nstate will change to “established” and all subsequent traffic matching the entry will be allowed to pass\nthrough the firewall.\n\n**Table 2-1. State Table Example**\n\n\n**Destination**\n**Source Address** **Source Port**\n**Address**\n\n\n**Destination**\n**Connection State**\n**Port**\n\n\n192.168.1.100 1030 192.0.2.71 80 Initiated\n\n192.168.1.102 1031 10.12.18.74 80 Established\n\n192.168.1.101 1033 10.66.32.122 25 Established\n\n192.168.1.106 1035 10.231.32.12 79 Established\n\nBecause some protocols, most notably UDP, are connectionless and do not have a formal process for\ninitializing, establishing, and terminating a connection, their state cannot be established at the transport\nlayer as it is for TCP. For these protocols, most firewalls with stateful inspection are only able to track the\nsource and destination IP addresses and ports. UDP packets must still match an entry in the state table\nbased on source and destination IP address and port information to be permitted to pass—a DNS response\nfrom an external source would be permitted to pass only if the firewall had previously seen a\ncorresponding DNS query from an internal source. Since the firewall is unable to determine when a\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\nsession has ended, the entry is removed from the state table after a preconfigured timeout value is\nreached. Application-level firewalls that are able to recognize DNS over UDP will terminate a session\nafter a DNS response is received, and may act similarly with the Network Time Protocol (NTP).\n\n\n**2.1.3**\n\n\n**Application Firewalls**\n\n\nA newer trend in stateful inspection is the addition of a stateful protocol analysis capability, referred to by\nsome vendors as deep packet inspection. Stateful protocol analysis improves upon standard stateful\ninspection by adding basic intrusion detection technology—an inspection engine that analyzes protocols\nat the application layer to compare vendor-developed profiles of benign protocol activity against observed\nevents to identify deviations. This allows a firewall to allow or deny access based on how an application\nis running over the network. For instance, an application firewall can determine if an email message\ncontains a type of attachment that the organization does not permit (such as an executable file), or if\ninstant messaging (IM) is being used over port 80 (typically used for HTTP). Another feature is that it can\nblock connections over which specific actions are being performed (e.g., users could be prevented from\nusing the FTP “put” command, which allows users to write files to the FTP server). This feature can also\nbe used to allow or deny web pages that contain particular types of active content, such as Java or\nActiveX, or that have SSL certificates signed by a particular certificate authority (CA), such as a\ncompromised or revoked CA.\n\nApplication firewalls can enable the identification of unexpected sequences of commands, such as issuing\nthe same command repeatedly or issuing a command that was not preceded by another command on\nwhich it is dependent. These suspicious commands often originate from buffer overflow attacks, DoS\nattacks, malware, and other forms of attack carried out within application protocols such as HTTP.\nAnother common feature is input validation for individual commands, such as minimum and maximum\nlengths for arguments. For example, a username argument with a length of 1000 characters is\nsuspicious—even more so if it contains binary data. Application firewalls are available for many common\nprotocols including HTTP, database (such as SQL), email (SMTP, Post Office Protocol [POP], and\nInternet Message Access Protocol [IMAP])[3], voice over IP (VoIP), and Extensible Markup Language\n(XML).[4]\n\nAnother feature found in some application firewalls involves enforcing application state machines, which\nare essentially checks on the traffic’s compliance to the standard for the protocol in question. This\ncompliance checking, sometimes call “RFC compliance” because most protocols are defined in RFCs\nissued by the Internet Engineering Task Force (IETF), can be a mixed blessing. Many products\nimplement protocols in ways that almost, but not completely, match the specification, so it is usually\nnecessary to let such implementations communicate across the firewall. Compliance checking is only\nuseful when it detects and blocks communication that can be harmful to protected systems.\n\nFirewalls with both stateful inspection and stateful protocol analysis capabilities are not full-fledged\nintrusion detection and prevention systems (IDPS), which usually offer much more extensive attack\ndetection and prevention capabilities. For example, IDPSs also use signature-based and/or anomaly-based\nanalysis to detect additional problems within network traffic.[5]\n\n3 For additional information about email security, see NIST Special Publication (SP) 800-45 Version 2, Guidelines on\n_Electronic Mail Security_ [(http://csrc.nist.gov/publications/PubsSPs.html).](http://csrc.nist.gov/publications/PubsSPs.html)\n4 For additional information about XML and XML firewalls, see NIST SP 800-95, Guide to Secure Web Services\n[(http://csrc.nist.gov/publications/PubsSPs.html).](http://csrc.nist.gov/publications/PubsSPs.html)\n5 For additional information about IDPS, see NIST SP 800-94, Guide to Intrusion Detection and Prevention Systems (IDPS)\n[(http://csrc.nist.gov/publications/PubsSPs.html).](http://csrc.nist.gov/publications/PubsSPs.html)\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\n\n**2.1.4**\n\n\n**Application-Proxy Gateways**\n\n\nAn application-proxy gateway is a feature of advanced firewalls that combines lower-layer access control\nwith upper-layer functionality. These firewalls contain a proxy agent that acts as an intermediary between\ntwo hosts that wish to communicate with each other, and never allows a direct connection between them.\nEach successful connection attempt actually results in the creation of two separate connections—one\nbetween the client and the proxy server, and another between the proxy server and the true destination.\nThe proxy is meant to be transparent to the two hosts—from their perspectives there is a direct\nconnection. Because external hosts only communicate with the proxy agent, internal IP addresses are not\nvisible to the outside world. The proxy agent interfaces directly with the firewall ruleset to determine\nwhether a given instance of network traffic should be allowed to transit the firewall.\n\nIn addition to the ruleset, some proxy agents have the ability to require authentication of each individual\nnetwork user. This authentication can take many forms, including user ID and password, hardware or\nsoftware token, source address, and biometrics.\n\nLike application firewalls, the proxy gateway operates at the application layer and can inspect the actual\ncontent of the traffic. These gateways also perform the TCP handshake with the source system and are\nable to protect against exploitations at each step of a communication. In addition, gateways can make\ndecisions to permit or deny traffic based on information in the application protocol headers or payloads.\nOnce the gateway determines that data should be permitted, it is forwarded to the destination host.\n\nApplication-proxy gateways are quite different than application firewalls. First, an application-proxy\ngateway can offer a higher level of security for some applications because it prevents direct connections\nbetween two hosts and it inspects traffic content to identify policy violations. Another potential advantage\nis that some application-proxy gateways have the ability to decrypt packets (e.g., SSL-protected\npayloads), examine them, and re-encrypt them before sending them on to the destination host. Data that\nthe gateway cannot decrypt is passed directly through to the application. When choosing the type of\nfirewall to deploy, it is important to decide whether the firewall actually needs to act as an application\nproxy so that it can match the specific policies needed by the organization.\n\nFirewalls with application-proxy gateways can also have several disadvantages when compared to packet\nfiltering and stateful inspection. First, because of the “full packet awareness” of application-proxy\ngateways, the firewall spends much more time reading and interpreting each packet. Because of this,\nsome of these gateways are poorly suited to high-bandwidth or real-time applications—but applicationproxy gateways rated for high bandwidth are available. To reduce the load on the firewall, a dedicated\nproxy server (discussed in Section 2.1.5) can be used to secure less time-sensitive services such as email\nand most web traffic. Another disadvantage is that application-proxy gateways tend to be limited in terms\nof support for new network applications and protocols—an individual, application-specific proxy agent is\nrequired for each type of network traffic that needs to transit a firewall. Many application-proxy gateway\nfirewall vendors provide generic proxy agents to support undefined network protocols or applications.\nThose generic agents tend to negate many of the strengths of the application-proxy gateway architecture\nbecause they simply allow traffic to “tunnel” through the firewall.\n\n\n**2.1.5**\n\n\n**Dedicated Proxy Servers**\n\n\n_Dedicated proxy servers differ from application-proxy gateways in that while dedicated proxy servers_\nretain proxy control of traffic, they usually have much more limited firewalling capabilities. They are\ndescribed in this section because of their close relationship to application-proxy gateway firewalls. Many\ndedicated proxy servers are application-specific, and some actually perform analysis and validation of\ncommon application protocols such as HTTP. Because these servers have limited firewalling capabilities,\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\nsuch as simply blocking traffic based on its source or destination, they are typically deployed behind\ntraditional firewall platforms. Typically, a main firewall could accept inbound traffic, determine which\napplication is being targeted, and hand off traffic to the appropriate proxy server (e.g., email proxy). This\nserver would perform filtering or logging operations on the traffic, then forward it to internal systems. A\nproxy server could also accept outbound traffic directly from internal systems, filter or log the traffic, and\npass it to the firewall for outbound delivery. An example of this is an HTTP proxy deployed behind the\nfirewall—users would need to connect to this proxy en route to connecting to external web servers.\nDedicated proxy servers are generally used to decrease firewall workload and conduct specialized\nfiltering and logging that might be difficult to perform on the firewall itself.\n\nIn recent years, the use of inbound proxy servers has decreased dramatically. This is because an inbound\nproxy server must mimic the capabilities of the real server it is protecting, which becomes nearly\nimpossible when protecting a server with many features. Using a proxy server with fewer capabilities than\nthe server it is protecting renders the non-matched capabilities unusable. Additionally, the essential\nfeatures that inbound proxy servers should have (logging, access control, etc.) are usually built into the\nreal servers. Most proxy servers now in use are outbound proxy servers, with the most common being\nHTTP proxies.\n\nFigure 2-2 shows a sample diagram of a network employing a dedicated HTTP proxy server that has been\nplaced behind another firewall system. The HTTP proxy would handle outbound connections to external\nweb servers and possibly filter for active content. Requests from users first go to the proxy, and the proxy\nthen sends the request (possibly changed) to the outside web server. The response from that web server\nthen comes back to the proxy, which relays it to the user. Many organizations enable caching of\nfrequently used web pages on the proxy to reduce network traffic and improve response times.\n\n**Figure 2-2. Application Proxy Configuration**\n\n**2.1.6 Virtual Private Networking**\n\nFirewall devices at the edge of a network are sometimes required to do more than block unwanted traffic.\nA common requirement for these firewalls is to encrypt and decrypt specific network traffic flows\nbetween the protected network and external networks. This nearly always involves virtual private\nnetworks (VPN), which use additional protocols to encrypt traffic and provide user authentication and\nintegrity checking. VPNs are most often used to provide secure network communications across untrusted\nnetworks. For example, VPN technology is widely used to extend the protected network of a multi-site\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\norganization across the Internet, and sometimes to provide secure remote user access to internal\norganizational networks via the Internet. Two common choices for secure VPNs are IPsec[6] and Secure\nSockets Layer (SSL)/Transport Layer Security (TLS).[7]\n\nThe two most common VPN architectures are gateway-to-gateway and host-to-gateway.[8] Gateway-togateway architectures connect multiple fixed sites over public lines through the use of VPN gateways—\nfor example, to connect branch offices to an organization’s headquarters. A VPN gateway is usually part\nof another network device such as a firewall or router. When a VPN connection is established between the\ntwo gateways, users at branch locations are unaware of the connection and do not require any special\nsettings on their computers. The second type of architecture, host-to-gateway, provides a secure\nconnection to the network for individual users, usually called remote users, who are located outside of the\norganization (at home, in a hotel, etc.) Here, a client on the user machine negotiates the secure connection\nwith the organization’s VPN gateway.[9] For gateway-to-gateway and host-to-gateway VPNs, the VPN\nfunctionality is often part of the firewall itself. Placing it behind the firewall would require VPN traffic to\nbe passed through the firewall while encrypted, preventing the firewall from inspecting the traffic.\n\nAll remote access (host-to-gateway) VPNs allow the firewall administrator to decide which users have\naccess to which network resources. This access control is normally available on a per-user and per-group\nbasis; that is, the VPN policy can specify which users and groups are authorized to access which\nresources, should an organization need that level of granularity. VPNs generally rely on authentication\nprotocols such as Remote Authentication Dial In User Service (RADIUS).[10] RADIUS uses several\ndifferent types of authentication credentials, with the most common examples being username and\npassword, digital signatures, and hardware tokens. Another authentication protocol often used by VPNs is\nthe Lightweight Directory Access Protocol (LDAP); it is particularly useful for making access decisions\nfor individual users and groups.\n\nTo run VPN functionality on a firewall requires additional resources that depend on the amount of traffic\nflowing across the VPN and the type of encryption being used. For some environments, the added traffic\nassociated with VPNs might require additional capacity planning and resources. Planning is also needed\nto determine the type of VPN (gateway-to-gateway and/or host-to-gateway) that should be included in the\nfirewall. Many firewalls include hardware acceleration for encryption to minimize the impact of VPN\nservices.\n\n\n**2.1.7**\n\n\n**Network Access Control**\n\n\nAnother common requirement for firewalls at the edge of a network is to perform client checks for\nincoming connections from remote users and allow or disallow access based on those checks. This\nchecking, commonly called network access control (NAC) or network access protection (NAP), allows\naccess based on the user’s credentials and the results of performing “health checks” on the user’s\ncomputer. Health checks typically consist of verifying that one or more of the following comply with\norganizational policy:\n\n6 For additional information on IPsec, see NIST SP 800-77, Guide to IPsec VPNs\n[(http://csrc.nist.gov/publications/PubsSPs.html).](http://csrc.nist.gov/publications/PubsSPs.html)\n7 For additional information on SSL and TLS, see NIST SP 800-52, Guidelines for the Selection and Use of Transport Layer\n_Security (TLS) Implementations and NIST SP 800-113, Guide to SSL VPNs_ [(http://csrc.nist.gov/publications/PubsSPs.html).](http://csrc.nist.gov/publications/PubsSPs.html)\n8 For additional information on VPN architectures, see NIST SP 800-77, Guide to IPsec VPNs and NIST SP 800-113, Guide\n_[to SSL VPNs (http://csrc.nist.gov/publications/PubsSPs.html).](http://csrc.nist.gov/publications/PubsSPs.html)_\n9 Host-to-gateway architectures usually require some user participation, such as initiating the VPN connection or providing\ncredentials to the VPN for authentication.\n10 [RADIUS is defined in RFC 2865 (http://www.rfc-editor.org/rfc/rfc2865.txt).](http://www.ietf.org/rfc/rfc2865.txt)\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\n� Latest updates to antimalware and personal firewall software\n\n� Configuration settings for antimalware and personal firewall software\n\n� Elapsed time since the previous malware scan\n\n� Patch level of the operating system and selected applications\n\n� Security configuration of the operating system and selected applications\n\nThese health checks require software on the user’s system that is controlled by the firewall. If the user has\nacceptable credentials but the device does not pass the health check, the user and device may get only\nlimited access to the internal network for remediation purposes.\n\n\n**2.1.8**\n\n\n**Unified Threat Management (UTM)**\n\n\nMany firewalls combine multiple features into a single system, the idea being that it is easier to set and\nmaintain policy on a single system than on many systems that are deployed at the same location on a\nnetwork. A typical unified threat management (UTM) system has a firewall, malware detection and\neradication, sensing and blocking of suspicious network probes, and so on. There are pros and cons to\nmerging multiple, not-completely-related functions into a single system. For example, deploying a UTM\nreduces complexity by making a single system responsible for multiple security objectives, but it also\nrequires that the UTM have all the desired features to meet every one of the objectives. Another tradeoff\nis in performance: a single system handling multiple tasks has to have enough resources such as CPU\nspeed and memory to handle every task assigned to it. Some organizations will find the balance favors a\nUTM, while other organizations will use multiple firewalls at the same location in their network.\n\n\n**2.1.9**\n\n\n**Web Application Firewalls**\n\n\nThe HTTP protocol used in web servers has been exploited by attackers in many ways, such as to place\nmalicious software on the computer of someone browsing the web, or to fool a person into revealing\nprivate information that they might not have otherwise. Many of these exploits can be detected by\nspecialized application firewalls called web application firewalls that reside in front of the web server.\n\nWeb application firewalls are a relatively new technology, as compared to other firewall technologies,\nand the type of threats that they mitigate are still changing frequently. Because they are put in front of\nweb servers to prevent attacks on the server, they are often considered to be very different than traditional\nfirewalls.\n\n\n**2.1.10**\n\n\n**Firewalls for Virtual Infrastructures**\n\n\nMany virtualization solutions allow more than one operating system to run on a single computer\nsimultaneously, each appearing as if it were a real computer. This has become popular recently because it\nallows organizations to make more efficient use of computer hardware. Most of these types of\nvirtualization systems include virtualized networking, which allows the multiple operating systems to\ncommunicate as if they were on a standard Ethernet, even though there is no actual networking hardware.\n\nNetwork activity that passes directly between virtualized operating systems within a host cannot be\nmonitored by an external firewall. However, some virtualization systems offer built-in firewalls or allow\nthird-party software firewalls to be added as plug-ins. Using firewalls to monitor virtualized networking is\na relatively new area of firewall technology, and it is likely to change significantly as virtualization usage\ncontinues to increase.\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\n**2.2** **Firewalls for Individual Hosts and Home Networks**\n\nAlthough firewalls at a network’s perimeter provide some measure of protection for internal hosts, in\nmany cases additional network protection is required. Network firewalls are not able to recognize all\ninstances and forms of attack, allowing some attacks to penetrate and reach internal hosts—and attacks\nsent from one internal host to another may not even pass through a network firewall. Because of these and\nother factors, network designers often include firewall functionality at places other than the network\nperimeter to provide an additional layer of security. This section describes firewalls specifically designed\nfor deployment onto individual hosts and home networks.\n\n\n**2.2.1**\n\n\n**Host-Based Firewalls and Personal Firewalls**\n\n\nHost-based firewalls for servers and personal firewalls for desktop and laptop personal computers (PC)\nprovide an additional layer of security against network-based attacks. These firewalls are software-based,\nresiding on the hosts they are protecting—each monitors and controls the incoming and outgoing network\ntraffic for a single host. They can provide more granular protection than network firewalls to meet the\nneeds of specific hosts.\n\nHost-based firewalls are available as part of server operating systems such as Linux, Windows, Solaris,\nBSD, and Mac OS X Server, and they can also be installed as third-party add-ons. Configuring a hostbased firewall to allow only necessary traffic to the server provides protection against malicious activity\nfrom all hosts, including those on the same subnet or on other internal subnets not separated by a network\nfirewall. Limiting outgoing traffic from a server may also be helpful in preventing certain malware that\ninfects a host from spreading to other hosts.[11] Host-based firewalls usually perform logging, and can often\nbe configured to perform address-based and application-based access controls. Many host-based firewalls\ncan also act as intrusion prevention systems (IPS) that, after detecting an attack in progress, take actions\nto thwart the attacker and prevent damage to the targeted host.\n\nA personal firewall is software that runs on a desktop or laptop PC with a user-focused operating system\nsuch as Microsoft Windows Vista or Macintosh OS X. A personal firewall is similar to a host-based\nfirewall, but because the computer being protected is meant for end users, the interface is usually different\n(and presumably easier for the typical user to understand). A personal firewall provides an additional\nlayer of security for PCs located both inside and outside perimeter firewalls (e.g., mobile laptop users),\nbecause it can restrict inbound communications and can often limit outbound communications as well.\nThis not only allows personal firewalls to protect PCs from incoming attacks, but also limits the spread of\nmalware from infected PCs and the use of unauthorized software such as peer-to-peer file sharing utilities.\nPersonal firewalls are often packaged with antimalware programs, intrusion detection software, and other\nsecurity utilities.[12]\n\nSome personal firewalls allow creation of different profiles based on location, such as a profile for use\ninside the organization’s network and a different profile for use when at a remote location. This is\nparticularly important when a computer is used on an untrusted external network, because having a\nseparate firewall profile for use on such networks can restrict network activity more tightly and provide\nstronger protection than having a single profile for all networks.\n\n11 If an attacker compromises a host and gains administrator-level privileges, the attacker can disable or circumvent the hostbased firewall.\n12 For additional information about personal firewalls, see NIST SP 800-114, User's Guide to Securing External Devices for\n_[Telework and Remote Access (http://csrc.nist.gov/publications/PubsSPs.html).](http://csrc.nist.gov/publications/PubsSPs.html)_\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\nIn addition to traditional stateful filtering, many personal firewalls can be configured to allow\ncommunications based on lists of authorized applications—such as web browsers contacting web servers\nand email clients sending and receiving email messages—and to deny communications involving any\nother applications. These are referred to as application-based firewalls. Access control is based on the\napplications or services launched, and not on the ports or services.\n\nManagement of personal firewalls should be centralized if at all possible to help efficiently create,\ndistribute, and enforce policies for all users and groups. Doing this will ensure that the organization’s\nsecurity policy will be in effect whenever a user is accessing the organization’s computing resources. But\nregardless of whether a personal firewall is managed by central administrators or individual users, any\nwarning messages that are generated by the firewall should be shown to the user of the PC to help them\nrectify problems that are found.\n\n\n**2.2.2**\n\n\n**Personal Firewall Appliances**\n\n\nIn addition to using personal firewalls on their PCs, some teleworkers also use a small, inexpensive\ndevice called a firewall appliance or firewall router to protect the computers on their home networks. A\npersonal firewall appliance performs functions similar to a personal firewall, including some of the more\nadvanced features listed earlier in this section—such as VPN. Even if each computer on a home network\nis using a personal firewall, a firewall appliance is still a valuable added layer of security. Should a\npersonal firewall on a computer malfunction, be disabled, or be misconfigured, the firewall appliance can\nstill protect the computer from unauthorized network communications from external computers. Personal\nfirewall appliances are essentially like small enterprise firewalls that are deployed away from the\norganization, so the ability to perform central management and administration is as important for personal\nfirewall appliances as it is for enterprise firewalls.[13]\n\nSome personal firewall appliances can be partially configured by Universal Plug and Play (UPnP), which\nallows applications on PCs behind the firewall to automatically ask the firewall to open certain ports so\nthat the applications can have two-way communications with an external system. Most personal firewalls\nthat support dynamic reconfiguration via UPnP have this featured turned off by default because it is a\nsignificant security risk to allow untrusted applications to alter a firewall’s security policy.\n\n**2.3** **Limitations of Firewall Inspection**\n\nFirewalls can only work effectively on traffic that they can inspect. Regardless of the firewall technology\nchosen, a firewall that cannot understand the traffic flowing through it will not handle that traffic\nproperly—for example, allowing traffic that should be blocked. Many network protocols use\ncryptography to hide the contents of the traffic. Section 2.1.6 covered IPsec and TLS; other encrypting\nprotocols include Secure Shell (SSH) and Secure Real-time Transport Protocol (SRTP). Firewalls also\ncannot read application data that is encrypted, such as email that is encrypted using the S/MIME or\nOpenPGP protocols, or files that are manually encrypted. Another limitation faced by some firewalls is\nunderstanding traffic that is tunneled, even if it is not encrypted. For example, IPv6 traffic can be tunneled\nin IPv4 in many different ways. The content may still be unencrypted, but if the firewall does not\nunderstand the particular tunneling mechanism used, the traffic cannot be interpreted.\n\nIn all these cases, the firewall’s rules will determine what to do with traffic it does not (or, in the case of\nencrypted traffic, cannot) understand. An organization should have policies about how to handle traffic in\nsuch cases, such as either permitting or blocking encrypted traffic that is not authorized to be encrypted.\n\n13 Additional information on personal firewall appliances is available from NIST SP 800-114.\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\n**2.4** **Summary of Recommendations**\n\nThe following items summarize the major recommendations from this section:\n\n� The use of NAT should be considered a form of routing, not a type of firewall.\n\n� Organizations should only permit outbound traffic that uses the source IP addresses in use by the\norganization.\n\n� Compliance checking is only useful in a firewall when it can block communication that can be\nharmful to protected systems.\n\n� When choosing the type of firewall to deploy, it is important to decide whether the firewall needs to\nact as an application proxy.\n\n� Management of personal firewalls should be centralized to help efficiently create, distribute, and\nenforce policies for all users and groups.\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\n\n###### 3. Firewalls and Network Architectures\n\n\nFirewalls are used to separate networks with differing security requirements, such as the Internet and an\ninternal network that houses servers with sensitive data. Organizations should use firewalls wherever their\ninternal networks and systems interface with external networks and systems, and where security\nrequirements vary among their internal networks. This section is intended to help organizations determine\nwhere firewalls should be placed, and where other networks and systems should be located in relation to\nthe firewalls.\n\nSince one of the primary functions of a firewall is to prevent unwanted traffic from entering a network\n(and, in some cases, from exiting it), firewalls should be placed at the edge of logical network\nboundaries.[14] This normally means that firewalls are positioned either as a node where the network splits\ninto multiple paths, or inline along a single path. In routed networks, the firewall usually resides just on\nthe network at the location immediately before traffic enters the router (the ingress point), and is\nsometimes co-resident with the router. It is rare to place the firewall for a multi-path node after the router\nbecause the firewall device would need to watch each of the multiple exit paths that typically exist in such\nsituations. The vast majority of hardware firewall devices contain router capabilities, and in switched\nnetworks, a firewall is often part of the switch itself to enable it to protect as many of the switched\nsegments as possible.\n\nFirewall vendors often vary in their terminology for the logical flow of firewall traffic. A firewall takes\ntraffic that has not been checked, checks it against the firewall's policy, and then acts accordingly (e.g.,\npasses the traffic, blocks it, passes it with some modification). Because all traffic on a network has a\ndirection, policies are based on the direction that the traffic is moving. For the purposes of this document,\ntraffic that has not yet been checked is coming from the “unprotected side” of the firewall and is moving\ntowards the “protected side.” Some firewalls check traffic in both directions—for example, if they are set\nup to prevent specific traffic from an organization's local area network (LAN) from escaping to the\nInternet.[15] In these cases, the protected side of the firewall is the one facing the outside network.\n\nSection 2 lists many different types of firewall technologies. Network firewalls are almost always\nhardware devices with multiple network interfaces; host-based and personal firewalls involve software\nthat resides on a single computer and protects only that computer; and personal firewall appliances are\ndesigned to protect a single PC or a small office/home office network. This section focuses on network\nfirewalls because the other types are usually unrelated to network topology issues.\n\n**3.1** **Network Layouts with Firewalls**\n\nFigure 3-1 shows a typical network layout with a hardware firewall device acting as a router. The\nunprotected side of the firewall connects to the single path labeled “WAN,” and the protected side\nconnects to three paths labeled “LAN1,” “LAN2,” and “LAN3.” The firewall acts as a router for traffic\nbetween the wide area network (WAN) path and the LAN paths. In the figure, one of the LAN paths also\nhas a router; some organizations prefer to use multiple layers of routers due to legacy routing policies\nwithin the network.\n\n14 In addition to traditional network boundaries, this also includes boundaries related to the use of virtual machines. For\nexample, there may be a need to restrict network activity between two virtual machines with different security policies.\n15 Some firewalls are configured to permit traffic in only one direction—for example, a firewall set up as a guard to allow\nlimited traffic flows from a higher-impact system to a lower-impact system, but no traffic initiated by the lower-impact\nsystem to reach the higher-impact system.\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\n**Figure 3-1. Simple Routed Network with Firewall Device**\n\nMany hardware firewall devices have a feature called DMZ, an acronym related to the demilitarized zones\nthat are sometimes set up between warring countries. While no single technical definition exists for\nfirewall DMZs, they are usually interfaces on a routing firewall that are similar to the interfaces found on\nthe firewall’s protected side. The major difference is that traffic moving between the DMZ and other\ninterfaces on the protected side of the firewall still goes through the firewall and can have firewall\nprotection policies applied. DMZs are sometimes useful for organizations that have hosts that need to\nhave all traffic destined for the host bypass some of the firewall’s policies (for example, because the DMZ\nhosts are sufficiently hardened), but traffic coming from the hosts to other systems on the organization’s\nnetwork need to go through the firewall. It is common to put public-facing servers, such as web and email\nservers, on the DMZ. An example of this is shown in Figure 3-2, a simple network layout of a firewall\nwith a DMZ. Traffic from the Internet goes into the firewall and is routed to systems on the firewall’s\nprotected side or to systems on the DMZ. Traffic between systems on the DMZ and systems on the\nprotected network goes through the firewall, and can have firewall policies applied.\n\n**Figure 3-2. Firewall with a DMZ**\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\nMost network architectures are hierarchical, meaning that a single path from an outside network splits\ninto multiple paths on the inside network—and it is generally most efficient to place a firewall at the node\nwhere the paths split. This has the advantage of positioning the firewall where there is no question as to\nwhat is “outside” and what is “inside.” However, there may be reasons to have additional firewalls on the\ninside of the network, such as to protect one set of computers from another. If a network’s architecture is\nnot hierarchical, the same firewall policies should be used on all ingresses to the network. In many\norganizations, there is only supposed to be one ingress to the network, but other ingresses are set up on an\nad-hoc basis, often in ways that are not allowed by overall policy. In these situations, if a properly\nconfigured firewall is not placed at each entry point, malicious traffic that would normally be blocked by\nthe main ingress can enter the network by other means.\n\nThe diagrams in Figures 3-1 and 3-2 each show a single firewall; however, many implementations use\nmultiple firewalls. Some vendors sell high-availability (HA) firewalls, which allow one firewall to take\nover for another if the first firewall fails or is taken offline for maintenance. HA firewalls are deployed in\npairs at the same spot in the network topology so that they both have the same external and internal\nconnections. While HA firewalls can increase reliability, they can also introduce some problems, such as\nthe need to combine logs between the paired firewalls and possible confusion by administrators when\nconfiguring the firewalls (for example, knowing which firewall is pushing its policy changes to the other\nfirewall). HA functionality may be provided through a variety of vendor-specific techniques.\n\n**3.2** **Firewalls Acting as Network Address Translators**\n\nMost firewalls can perform NAT, which is sometimes called port address translation (PAT) or network\naddress and port translation (NAPT). Despite the popular misconception, NAT is not part of the security\nfunctionality of a firewall. The security benefit of NAT—preventing a host outside the firewall from\ninitiating contact with a host behind NAT—can just as easily be achieved by a stateful firewall with less\ndisruption to protocols that do not work as well behind NAT. However, turning on a firewall’s NAT\nfeature is usually easier than properly configuring the firewall policy to have the same protections, so\nmany people think of NATs as primarily a security feature.\n\nTypically, a NAT acts as a router that has a network with private addresses on the inside and a single\npublic address on the outside. The way a NAT performs this many-to-one mapping varies between\nimplementations, but almost always involves the following:\n\n� Hosts on the inside network initiating connections to the outside network cause the NAT to map the\nsource port of the connection to a different source port that is controlled by the NAT. The NAT uses\nthis source port number to map connections from the outside back to the host on the inside.\n\n� Hosts on the outside of the network cannot initiate contact with hosts on the inside network. In some\nfirewalls, the NAT can be configured to map a particular destination port on the NAT to a particular\nhost on the inside of the NAT; for example, all HTTP requests that go to the NAT could be directed\nto a single host on the protected side of the firewall. This feature is sometimes called pinholing.\n\nAlthough NATs are not in and of themselves security features of a firewall, they interact with the\nfirewall’s security policy. For example, any policy that requires that all HTTP servers accessible to the\noutside be on the DMZ must prevent the NAT from pinholing TCP port 80. Another example of where\nNATs interact with security policy is the ability to identify the source of traffic in a firewall’s logs. If a\nNAT is used, it must report the private address in the logs instead of the translated public address,\notherwise the logs will incorrectly identify many hosts by the single public address.\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\n**3.3** **Architecture with Multiple Layers of Firewalls**\n\nThere is no limitation on where a firewall can be placed in a network. While firewalls should be at the\nedge of a logical network boundary, creating an “inside” and “outside” on either side of the firewall, a\nnetwork administrator may wish to have additional boundaries within the network and deploy additional\nfirewalls to establish such boundaries. The use of multiple layers of firewalls is quite common to provide\ndefense-in-depth. An example of this was mentioned in Section 2.2.1, where a host-based firewall creates\na boundary just before the host it is installed upon and adds another set of firewall policies to the\narchitecture of the network. Using multiple layers of network firewalls is another common technique.\n\nA typical situation that requires multiple layers of network firewalls is the presence of internal users with\nvarying levels of trust. For example, an organization might want to protect its accounting databases from\nbeing accessed by users who are not part of the accounting department. This could be accomplished by\nplacing one firewall at the edge of the network (to prevent general access to the network from the\nInternet) and another at the edge of the internal network that defines the boundary of the accounting\ndepartment. The inner firewall would block access to the database server by anyone outside the\naccounting network while allowing limited access to other resources on the accounting network. Another\ntypical use for firewalls inside a network with a firewall at its edge involves visitors who need access to\nthe Internet. Many organizations deploy specific wireless access points within their networks for visitor\nuse. A firewall between the access points and the rest of the internal network can prevent visitors from\naccessing the local network with the same privileges as an employee.\n\nPlacing a firewall within a network that already has one at the edge requires good planning and policy\ncoordination to prevent inadvertent security lapses. When designing policies for an inner firewall, the\nadministrator could make assumptions that result in poor policy choices—for example, if the inner\nfirewall’s administrator assumes that the outer firewall is already preventing certain types of traffic from\nreaching the inner firewall, and the outer firewall’s administrator later modifies existing policy, hosts\nbehind the inner firewall will be exposed to additional threats. A better approach is to duplicate outer\nfirewall policies that are also relevant for inner firewalls on each inner firewall. This may be difficult if\nthese firewalls are not able to coordinate their policies automatically, which is particularly likely when\nfirewalls are from different manufacturers.\n\nAnother common problem with using multiple layers of network firewalls is the increased difficulty it\npresents in tracing firewall problems. If one firewall stands between a user and a server, and the user\ncannot connect to the server, it is easy to check that firewall’s logs to see if the connection is being\npermitted. But if multiple firewalls are involved, the problem becomes more difficult because an\nadministrator must locate all firewalls in the chain and check their logs to find where the problem\noriginates. The presence of multiple layers of application-proxy gateways is particularly daunting,\nbecause each gateway can change a message, which makes debugging even more difficult.\n\n**3.4** **Summary of Recommendations**\n\nThe following items summarize the major recommendations from this section:\n\n� In general, a firewall should fit into a current network’s layout. However, an organization might\nchange its network architecture at the same time as it deploys a firewall as part of an overall security\nupgrade.\n\n� Different common network architectures lead to very different choices for where to place a firewall,\nso an organization should assess which architecture works best for its security goals.\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\n� If an edge firewall has a DMZ, consider which outward-facing services should be run from the DMZ\nand which should remain on the inside network.\n\n� Do not rely on NATs to provide the benefits of firewalls.\n\n� In some environments, putting one firewall behind another may lead to a desired security goal, but in\ngeneral such multiple layers of firewalls can be troublesome.\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\n\n###### 4. Firewall Policy\n\n\nA firewall policy dictates how firewalls should handle network traffic for specific IP addresses and\naddress ranges, protocols, applications, and content types (e.g., active content) based on the\norganization’s information security policies. Before a firewall policy is created, some form of risk\nanalysis should be performed to develop a list of the types of traffic needed by the organization and\ncategorize how they must be secured—including which types of traffic can traverse a firewall under what\ncircumstances.[16] This risk analysis should be based on an evaluation of threats; vulnerabilities;\ncountermeasures in place to mitigate vulnerabilities; and the impact if systems or data are compromised.\nFirewall policy should be documented in the system security plan and maintained and updated frequently\nas classes of new attacks or vulnerabilities arise, or as the organization’s needs regarding network\napplications change. The policy should also include specific guidance on how to address changes to the\nruleset.\n\nGenerally, firewalls should block all inbound and outbound traffic that has not been expressly permitted\nby the firewall policy—traffic that is not needed by the organization. This practice, known as deny by\n_default, decreases the risk of attack and can also reduce the volume of traffic carried on the organization’s_\nnetworks. Because of the dynamic nature of hosts, networks, protocols, and applications, deny by default\nis a more secure approach than permitting all traffic that is not explicitly forbidden.\n\nThis section provides details on what types of traffic should be blocked. Section 4.1 discusses policies for\npacket filtering and stateful inspection based on IP addresses and other IP characteristics. Section 4.2\ncovers policies relating to application-specific traffic. Section 4.3 covers access based on user identity,\nand Section 4.4 describes policies triggered by network activity.\n\n**4.1** **Policies Based on IP Addresses and Protocols**\n\nFirewall policies should only allow necessary IP protocols through. Examples of commonly used IP\nprotocols, with their IP protocol numbers,[17] are ICMP (1), TCP (6), and UDP (17). Other IP protocols,\nsuch as IPsec components Encapsulating Security Payload (ESP) (50) and Authentication Header (AH)\n(51) and routing protocols, may also need to pass through firewalls. These necessary protocols should be\nrestricted whenever possible to the specific hosts and networks within the organization with a need to use\nthem. By permitting only necessary protocols, all unnecessary IP protocols are denied by default.\n\nSome IP protocols are rarely passed between an outside network and an organization’s LAN, and\ntherefore can simply be blocked in both directions at the firewall. For example, IGMP is a protocol used\nto control multicast networks, but multicast is rarely used, and when it is, it is often not used across the\nInternet. Therefore, blocking all IGMP traffic in both directions is feasible if multicast is not used.\n\n\n**4.1.1**\n\n\n**IP Addresses and Other IP Characteristics**\n\n\nFirewall policies should only permit appropriate source and destination IP addresses to be used. Specific\nrecommendations for IP addresses include:\n\n� Traffic with invalid source or destination addresses should always be blocked, regardless of the\nfirewall location. Examples of relatively common invalid IPv4 addresses are 127.0.0.0 to\n\n16 The process to perform a risk assessment and create this type of list is not detailed here. For additional information, see\nNIST SP 800-30, Risk Management Guide for Information Technology Systems, and SP 800-18 Revision 1, Guide for\n_Developing Security Plans for Federal Information Systems, at_ [http://csrc.nist.gov/publications/PubsSPs.html.](http://csrc.nist.gov/publications/PubsSPs.html)\n17 IP protocol number assignments are defined in [http://www.iana.org/assignments/protocol-numbers.](http://www.iana.org/assignments/protocol-numbers)\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\n127.255.255.255 (also known as the localhost addresses) and 0.0.0.0 (interpreted by some operating\nsystems as a localhost or a broadcast address). These have no legitimate use on a network. Also,\ntraffic using link-local addresses (169.254.0.0 to 169.254.255.255) should be blocked.\n\n� Traffic with an invalid source address for incoming traffic or destination address for outgoing traffic\n(an invalid “external” address) should be blocked at the network perimeter. This traffic is often\ncaused by malware, spoofing, denial of service attacks, or misconfigured equipment. The most\ncommon type of invalid external addresses is an IPv4 address within the ranges in RFC 1918,\n_Address Allocation for Private Internets, that are reserved for private networks. These ranges are_\n10.0.0.0 to 10.255.255.255 (10.0.0.0/8 in Classless Inter-Domain Routing [CIDR] notation),\n172.16.0.0 to 172.31.255.255 (172.16.0.0/12), and 192.168.0.0 to 192.168.255.255 (192.168.0.0/16).\n\n� Traffic with a private destination address for incoming traffic or source address for outgoing traffic\n(an “internal” address) should be blocked at the network perimeter. Perimeter devices can perform\naddress translation services to permit internal hosts with private addresses to communicate through\nthe perimeter, but private addresses should not be passed through the network perimeter.\n\n� Outbound traffic with invalid source addresses should be blocked (this is often called egress\n_filtering). Systems that have been compromised by attackers can be used to attack other systems on_\nthe Internet; using invalid source addresses makes these kinds of attacks more difficult to stop.\nBlocking this type of traffic at an organization’s firewall helps reduce the effectiveness of these\nattacks.\n\n� Incoming traffic with a destination address of the firewall itself should be blocked unless the firewall\nis offering services for incoming traffic that require direct connections—for example, if the firewall is\nacting as an application proxy.\n\nOrganizations should also block the following types of traffic at the perimeter:\n\n� Traffic containing IP source routing information, which allows a system to specify the routes that\npackets will employ while traveling from source to destination. This could potentially permit an\nattacker to construct a packet that bypasses network security controls. IP source routing is rarely used\non modern networks, and valid applications are even less common on the Internet.\n\n� Traffic from outside the network containing broadcast addresses that is directed to inside the network.\nAny system that responds to the directed broadcast will then send its response to the system specified\nby the source, rather than to the source system itself. These packets can be used to create huge\n“storms” of network traffic for denial of service attacks. Regular broadcast addresses, as well as\naddresses used for multicast IP, may or may not be appropriate for blocking at an organization’s\nfirewall. Multicast and broadcast networking is seldom used in normal networking environments, but\nwhen it is used both inside and outside of the organization, it should be allowed through firewalls.\n\nFirewalls at the network perimeter should block all incoming traffic to networks and hosts that should not\nbe accessible from external networks. These firewalls should also block all outgoing traffic from the\norganization’s networks and hosts that should not be permitted to access external networks. Deciding\nwhich addresses should be blocked is often one of the most time-consuming aspects of developing\nfirewall IP policies. It is also one of the most error-prone, because the IP address associated with an\nundesired entity often changes over time.\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\n**4.1.2 IPv6**\n\nIPv6 is a new version of IP that is increasingly being deployed. Although IPv6’s internal format and\naddress length differ from those of IPv4, many other features remain the same—and some of these are\nrelevant to firewalls. For the features that are the same between IPv4 and IPv6, firewalls should work the\nsame. For example, blocking all inbound and outbound traffic that has not been expressly permitted by\nthe firewall policy should be done regardless of whether or not the traffic has an IPv4 or IPv6 address.\n\nAs of this writing, some firewalls cannot handle IPv6 traffic at all; others are able to handle it but have\nlimited abilities to filter IPv6 traffic; and still others can filter IPv6 traffic to approximately the same\nextent as IPv4 traffic. Every organization, whether or not it allows IPv6 traffic to enter its internal\nnetwork, needs a firewall that is capable of filtering this traffic. These firewalls should have the following\ncapabilities:\n\n� The firewall should be able to use IPv6 addresses in all filtering rules that use IPv4 addresses.\n\n� The administrative interface should allow administrators to clone IPv4 rules to IPv6 addresses to\nmake administration easier.\n\n� The firewall needs to be able to filter ICMPv6, as specified in RFC 4890, Recommendations for\n_Filtering ICMPv6 Messages in Firewalls._\n\n� The firewall should be able to block IPv6-related protocols such as 6-to-4 and 4-to-6 tunneling,\nTeredo, and Intra-site Automatic Tunnel Addressing Protocol (ISATAP) if they are not required.\n\n� Many sites tunnel IPv6 packets in IPv4 packets. This is particularly common for sites experimenting\nwith IPv6, because it is currently easier to obtain IPv6 transit from a tunnel broker through a v6-to-v4\ntunnel than to get native IPv6 transit from an Internet service provider (ISP). A number of ways exist\nto do this, and standards for tunneling are still evolving. If the firewall is able to inspect the contents\nof IPv4 packets, it needs to know how to inspect traffic for any tunneling method used by the\norganization. A corollary to this is that if an organization is using a firewall to prohibit IPv6 coming\ninto or going out of its network, that firewall needs to recognize and block all forms of v6-to-v4\ntunneling.\n\nNote that the above list is short and not all the rules are security-specific. Because IPv6 deployment is still\nin its early stages, there is not yet widespread agreement in the IPv6 operations community about what an\nIPv6 firewall should do that is different from IPv4 firewalls.\n\nFor firewalls that permit IPv6 use, traffic with invalid source or destination IPv6 addresses should always\nbe blocked—this is similar to blocking traffic with invalid IPv4 addresses. Since much more effort has\nbeen spent on making lists of invalid IPv4 addresses than on IPv6 addresses, finding lists of invalid IPv6\naddresses can be difficult. Also, IPv6 allows network administrators to allocate addresses in their assigned\nranges in different ways. This means that in a particular address range assigned to an organization, there\ncan literally be trillions of invalid IPv6 addresses and only a few that are valid. By necessity, listing which\nIPv6 addresses are invalid will have to be less fine-grained than listing invalid IPv4 addresses, and the\nfirewall rules that use these lists will be less effective than their IPv4 counterparts.\n\nOrganizations that do not yet use IPv6 should block all native and tunneled IPv6 traffic at their firewalls.\nNote that such blocking limits testing and evaluation of IPv6 and IPv6 tunneling technologies for future\ndeployment. To permit such use, the firewall administrator can selectively unblock IPv6 or the specific\ntunneling technologies of interest for use by the authorized testers.\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\n\n**4.1.3**\n\n\n**TCP and UDP**\n\n\nApplication protocols can use TCP, UDP, or both, depending on the design of the protocol. An\napplication server typically listens on one or more fixed TCP or UDP ports. Some applications use a\nsingle port, but many applications use multiple ports. For example, although SMTP uses TCP port 25 for\nsending mail, it uses TCP port 587 for mail submission. Similarly, FTP uses at least two ports, one of\nwhich can be unpredictable, and while most web servers use only TCP port 80, it is common to have web\nsites that also use additional ports such as TCP port 8080. Some applications use both TCP and UDP; for\nexample, DNS lookups can occur on UDP port 53 or TCP port 53. Application clients typically use any of\na wide range of ports.\n\nAs with other aspects of firewall rulesets, deny by default policies should be used for incoming TCP and\nUDP traffic. Less stringent policies are generally used for outgoing TCP and UDP traffic because most\norganizations permit their users to access a wide range of external applications located on millions of\nexternal hosts.\n\nIn addition to allowing and blocking UDP and TCP traffic, many firewalls are also able to report or block\nmalformed UDP and TCP traffic directed towards the firewall or to hosts protected by the firewall. This\ntraffic is frequently used to scan for hosts, and may also be used in certain types of attacks. The firewall\ncan help block such activity—or at least report when such activity is happening.\n\n**4.1.4 ICMP**\n\nAttackers can use various ICMP types and codes to perform reconnaissance or manipulate the flow of\nnetwork traffic.[18] However, ICMP is needed for many useful things, such as getting reasonable\nperformance across the Internet. Some firewall policies block all ICMP traffic, but this often leads to\nproblems with diagnostics and performance. Other common policies allow all outgoing ICMP traffic, but\nlimit incoming ICMP to those types and codes needed for Path Maximum Transmission Unit (PMTU)\ndiscovery (ICMP code 3) and destination reachability.\n\nTo prevent malicious activity, firewalls at the network perimeter should deny all incoming and outgoing\nICMP traffic except for those types and codes specifically permitted by the organization. For ICMP in\nIPv4, ICMP type 3 messages should not be filtered because they are used for important network\ndiagnostics. The ping command (ICMP code 8) is an important network diagnostic, but incoming pings\nare often blocked by firewall policies to prevent attackers from learning more about the internal topology\nof the organization’s network. For ICMP in IPv6, many types of messages must be allowed in specific\ncircumstances to enable various IPv6 features. See RFC 4890, Recommendations for Filtering ICMPv6\n_Messages in Firewalls, for detailed information on selecting which ICMPv6 types to allow or disallow for_\na particular firewall type.\n\nICMP is often used by low-level networking protocols to increase the speed and reliability of networking.\nTherefore, ICMP within an organization’s network generally should not be blocked by firewalls that are\nnot at the perimeter of the network, unless security needs outweigh network operational needs. Similarly,\nif an organization has more than one network, ICMP that comes from or goes to other networks within the\norganization should not be blocked.\n\n18 ICMP type and code numbers are defined at [http://www.iana.org/assignments/icmp-parameters.](http://www.iana.org/assignments/icmp-parameters)\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\n\n**4.1.5**\n\n\n**IPsec Protocols**\n\n\nAn organization needs to have a policy whether or not to allow IPsec VPNs that start or end inside its\nnetwork perimeter. The ESP and AH protocols are used for IPsec VPNs, and a firewall that blocks these\nprotocols will not allow IPsec VPNs to pass. While blocking ESP can hinder the use of encryption to\nprotect sensitive data, it can also force users who would normally encrypt their data with ESP to allow it\nto be inspected—for example, by a stateful inspection firewall or an application-proxy gateway.\n\nOrganizations that allow IPsec VPNs should block ESP and AH except to and from specific addresses on\nthe internal network—those addresses belong to IPsec gateways that are allowed to be VPN endpoints.[19]\nEnforcing this policy will require people inside the organization to obtain the appropriate policy approval\nto open ESP and/or AH access to their IPsec routers. This will also reduce the amount of encrypted traffic\ncoming from inside the network that cannot be examined by network security controls.\n\n**4.2** **Policies Based on Applications**\n\nMost early firewall work involved simply blocking unwanted or suspicious traffic at the network\nboundary. Inbound application firewalls or application proxies take a different approach—they let traffic\ndestined for a particular server into the network, but capture that traffic in a server that processes it like a\nport-based firewall. The application-based approach provides an additional layer of security for incoming\ntraffic by validating some of the traffic before it reaches the desired server. The theory is that the inbound\napplication firewall’s or proxy’s additional security layer can protect the server better than the server can\nprotect itself—and can also remove malicious traffic before it reaches the server to help reduce server\nload. In some cases, an application firewall or proxy can remove traffic that the server might not be able\nto remove on its own because it has greater filtering capabilities. An application firewall or proxy also\nprevents the server from having direct access to the outside network.\n\nIf possible, inbound application firewalls and proxies should be used in front of any server that does not\nhave sufficient security features to protect it from application-specific attacks. The main considerations\nwhen deciding whether or not to use an inbound application firewall or proxy are:\n\n� Is a suitable application firewall available? Or, if appropriate, is a suitable application proxy\navailable?\n\n� Is the server already sufficiently protected by existing firewalls?\n\n� Can the main server remove malicious content as effectively as the application firewall or proxy?\n\n� Is the latency caused by an application proxy acceptable for the application?\n\n� How easy it is to update the filtering rules on the main server and the application firewall or proxy to\nhandle newly developed threats?\n\nApplication proxies can introduce problems if they are not highly capable. Unless an application proxy is\nsignificantly more robust than the server and easy to keep updated, it is usually best to stay with the\napplication server alone. Application firewalls can also introduce problems if they are not fast enough to\nhandle the traffic destined for the server. However, it is also important to consider the server’s\nresources—if the server does not have sufficient resources to withstand attacks, the application firewall or\nproxy could be used as a shield.\n\n19 Wherever there is a policy to allow ESP and/or AH traffic through a firewall, it is extremely likely that the firewall also\nneeds a policy to allow Internet Key Exchange (IKE) traffic as well. IKE runs on UDP port 500, and it can also use UDP\nport 4500 for IPsec systems that support NAT traversal.\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\nWhen an inbound application firewall or proxy is behind a perimeter firewall or in the firewall’s DMZ,\nthe perimeter firewall should be blocking based on IP addresses, as described earlier in this section, to\nreduce the load on the application firewall or proxy. Doing this puts more of the address-specific policy in\na single place—the main firewall—and reduces the amount of traffic seen by the application firewall or\nproxy, freeing more power to filter content. Of course, if the perimeter firewall is also the application\nfirewall and an internal application proxy is not used, no such rules are needed.\n\nOutbound application proxies are useful for detecting systems that are making inappropriate or dangerous\nconnections from inside the protected network. By far the most common type of outbound proxy is for\nHTTP. Outbound HTTP proxies allow an organization to filter dangerous content before it reaches the\nrequesting PC. They also help an organization better understand and log web traffic from its users, and to\ndetect activity that is being tunneled over HTTP. When an HTTP proxy filters content, it can alert the web\nuser that the site being visited sent the filtered content. The most prominent non-security benefit of HTTP\nproxies is caching web pages for increased speed and decreased bandwidth use. Most organizations\nshould employ HTTP proxies.\n\n**4.3** **Policies Based on User Identity**\n\nTraditional packet filtering does not see the identities of the users who are communicating in the traffic\ntraversing the firewall, so firewall technologies without more advanced capabilities cannot have policies\nthat allow or deny access based on those identities. However, many other firewall technologies can see\nthese identities and therefore enact policies based on user authentication. One of the most common ways\nto enforce user identity policy at a firewall is by using a VPN. Both IPsec VPNs and SSL VPNs have\nmany ways to authenticate users, such as with secrets that are provisioned on a user-by-user basis, with\nmulti-factor authentication (e.g., time-based cryptographic tokens protected with PINs), or with digital\ncertificates controlled by each user. NAC has also become a popular method for firewalls to allow or deny\nusers access to particular network resources. In addition, application firewalls and proxies can allow or\ndeny access to users based on the user authentication within the applications themselves.\n\nFirewalls that enforce policies based on user identity should be able to reflect these policies in their logs.\nThat is, it is probably not useful to only log the IP address from which a particular user connected if the\nuser was allowed in by a user-specific policy; it is also important to log the user’s identity as well.\n\n**4.4** **Policies Based on Network Activity**\n\nMany firewalls allow the administrator to block established connections after a certain period of\ninactivity. For example, if a user on the outside of a firewall has logged into a file server but has not made\nany requests during the past 15 minutes, the policy might be to block any further traffic on that\nconnection. Time-based policies are useful in thwarting attacks caused by a logged-in user walking away\nfrom a computer and someone else sitting down and using the established connections (and therefore the\nlogged-in user’s credentials). However, these policies can also be bothersome for users who make\nconnections but do not use them frequently. For instance, a user might connect to a file server to read a\nfile and then spend a long time editing the file. If the user does not save the file back to the file server\nbefore the firewall-mandated timeout, the timeout could cause the changes to the file to be lost.\n\nSome organizations have mandates about when firewalls should block connections that are considered to\nbe inactive, when applications should disconnect sessions if there is no activity, etc. A firewall used by\nsuch an organization should be able to set policies that match the mandates while being specific enough to\nmatch the security objective of the mandates.\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\nA different type of firewall policy based on network activity is one that throttles or redirects traffic if the\nrate of traffic matching the policy rule is too high. For example, a firewall might redirect the connections\nmade to a particular inside address to a slower route if the rate of connections is above a certain threshold.\nAnother policy might be to drop incoming ICMP packets if the rate is too high. Crafting such policies is\nquite difficult because throttling and redirecting can cause desired traffic to be lost or have difficult-todiagnose transient failures.\n\n**4.5** **Summary of Recommendations**\n\nThe following items summarize the major recommendations from this section:\n\n� An organization’s firewall policy should be based on a comprehensive risk analysis.\n\n� Firewall policies should be based on blocking all inbound and outbound traffic, with exceptions made\nfor desired traffic.\n\n� Policies should take into account the source and destination of the traffic in addition to the content.\n\n� Many types of IPv4 traffic, such as that with invalid or private addresses, should be blocked by\ndefault.\n\n� Organizations should have policies for handling incoming and outgoing IPv6 traffic.\n\n� An organization should determine which applications may send traffic into or out of its network and\nmake firewall policies to block traffic for other applications.\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\n\n###### 5. Firewall Planning and Implementation\n\n\nThis section focuses on the planning and implementation of firewalls in the enterprise. As with any new\ntechnology deployment, firewall planning and implementation should be addressed in a phased approach.\nA successful firewall deployment can be achieved by following a clear, step-by-step planning and\nimplementation process. The use of a phased approach for deployment can minimize unforeseen issues\nand identify potential pitfalls early on. This section explores in depth each of the firewall planning and\nimplementation phases, including:\n\n1. **Plan. The first phase of the process involves identifying all requirements that an organization should**\nconsider when determining which firewall to implement to enforce the organization’s security policy.\n\n2. **Configure. The second phase involves all facets of configuring the firewall platform. This includes**\ninstalling hardware and software as well as setting up rules for the system.\n\n3. **Test. The next phase involves implementing and testing a prototype of the designed solution in a lab**\nor test environment. The primary goals of testing are to evaluate the functionality, performance,\nscalability, and security of the solution, and to identify any issues—such as interoperability—with\ncomponents.\n\n4. **Deploy. Once testing is completed and all issues are resolved, the next phase focuses on deployment**\nof the firewall into the enterprise.\n\n5. **Manage. After the firewall has been deployed, it is managed throughout its lifecycle to include**\ncomponent maintenance and support for operational issues. This lifecycle process is repeated when\nenhancements or significant changes need to be incorporated into the solution.\n\n**5.1** **Plan**\n\nThe planning phase for choosing and implementing a firewall should begin only after an organization has\ndetermined that a firewall is needed to enforce the organization’s security policy. This typically occurs\nfollowing a risk assessment of the overall system. A risk assessment includes (1) the identification of\nthreats and vulnerabilities in the information system; (2) the potential impact or magnitude of harm that a\nloss of confidentiality, integrity, or availability would have on the organization’s assets or operations\n(including mission, function, image, or reputation) in the event of a threat exploitation of identified\nvulnerabilities; and (3) the identification and analysis of security controls for the information system[20].\n\nBasic principles that organizations should follow in the planning of firewall deployments include:\n\n� **Use devices as they were intended to be used. Firewalls should not be constructed of equipment not**\nmeant for firewall use. For example, routers are meant to handle routing, not highly complex filtering,\nwhich can cause an excess burden on the router’s processor. Additionally, firewalls should not be\nexpected to provide non-security services, such as acting as a web server or email server.\n\n� **Create defense-in-depth. Defense-in-depth involves creating multiple layers of security. This allows**\nrisk to be better managed, because if one layer of defense becomes compromised, another layer is\nthere to contain the attack. In the case of firewalls, defense-in-depth can be accomplished by using\nmultiple firewalls throughout an organization, including at the perimeter, in front of sensitive internal\ndepartments, and on individual computers. For defense-in-depth to be truly effective, firewalls should\n\n20 For additional information about risk assessments, see NIST SP 800-30, Risk Management Guide for Information\n_Technology Systems_ [(http://csrc.nist.gov/publications/PubsSPs.html).](http://csrc.nist.gov/publications/PubsSPs.html)\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\nbe part of an overall security program that also includes products such as antimalware and intrusion\ndetection software.\n\n� **Pay attention to internal threats. Focusing attention solely on external threats leaves the network**\nwide open to attacks from within. These threats may not come directly from insiders, but can involve\ninternal hosts infected by malware or otherwise compromised by external attackers. Important\ninternal systems should be placed behind internal firewalls.\n\n� **Document the firewall’s capabilities. Each model of firewall has different capabilities and**\nlimitations. These will sometimes affect the planning of the organization’s security policy and\nfirewall deployment strategy. Any features that positively or negatively affect this planning should be\nwritten into the overall planning document.\n\nKeep in mind that the expression “all rules are meant to be broken” applies when building firewalls.\nWhile firewall implementers should keep the above rules in mind during planning, every network and\norganization has unique requirements and idiosyncrasies that could require unique solutions.\n\nOrganizations should consider the following when purchasing and implementing a firewall solution:\n\n� Security Capabilities\n\n###### – Which areas of the organization need to be protected (the perimeter, internal departments, remote\noffice, individual hosts, specific services, mobile clients, etc.)?\n\n###### – Which types of firewall technologies will best address the kinds of traffic that need to be\nprotected (packet filtering, stateful inspection, application firewall, application-proxy gateway,\netc.)?\n\n###### – What additional security features—such as intrusion detection capabilities, VPNs, and content\nfiltering—does the firewall need to support?\n\n� Management\n\n###### – Which protocols does the firewall support for remote management, such as HTTP-over-SSL,\nSSH, and access over a serial cable?\n\n###### – Are any of the firewall’s remote management protocols acceptable for use, according to the\norganization’s policies?\n\n###### – Can remote management be restricted to certain firewall interfaces and source IP addresses, such\nas those on a particular internal network?\n\n###### – Does the firewall support centralized management for multiple devices (not necessarily just\nfirewalls) from the same vendor?\n\n###### – If centralized management is available, is it performed by a vendor-specific application or can it\nbe controlled by other applications?\n\n� Performance (generally for network firewalls only)\n\n###### – What amount of throughput, maximum simultaneous connections, connections per second, and\nlatency requirements must be met to prevent the firewall from being a bottleneck for network\naccess, for both current and future traffic needs?\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\n###### – Are load balancing and failover functionally required to ensure high availability?\n\n – Is hardware-based vs. software-based firewall preference a consideration? \n\n� Integration\n\n###### – Will the firewall require specific hardware to properly integrate within the organization’s network\ninfrastructure (specific power capabilities, specific type of network interface card [NIC], specific\nbackup device, etc.)?\n\n###### – Does the firewall need to be compatible with other devices on the network that provide security\nor other services?\n\n###### – Does the firewall’s logging interoperate with existing log management systems?\n\n – Will installing a firewall require changes to other areas of the network? \n\n� Physical Environment (generally a consideration for network firewalls, although it may also apply to\nthe centralized components of host-based firewall implementations)\n\n###### – Where will the firewall be physically located to ensure physical security and protection from\ndisasters?\n\n###### – Is there adequate shelf or rack space at the physical location where the firewall will be placed?\n\n – Will additional power, backup power, air conditioning, and/or network connections be required at\nthe physical location?\n\n� Personnel\n\n###### – Who will be responsible for managing the firewall?\n\n – Will system administrators require training before the firewall is deployed? \n\n� Future Needs\n\n###### – Will the firewall meet the future needs of the organization (plans to move to IPv6, anticipated\nbandwidth requirements, compliance with regulations expected to be implemented, etc.)?\n\nOther items to consider when purchasing and implementing host-based and personal firewalls include:\n\n� Do workstations or servers meet the minimum system requirements of the firewall being evaluated?\n\n� Will the firewall be compatible with other security software on the workstation or server (e.g.,\nantimalware software)?\n\n� Can the firewall be centrally managed and allow policies that enforce the organization’s security\npolicy to be pushed to clients?\n\n� Can the firewall report policy violations to a central server?\n\n� Can the firewall be locked down to prevent anyone but administrators from modifying its settings?\n\n� Will the firewall conflict with host-based or personal firewalls built in to the hosts’ operating\nsystems? If so, how easily can these conflicts be resolved?\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\n**5.2** **Configure**\n\nThe configuration phase involves all facets of configuring the firewall platform. This includes installing\nhardware and software, configuring policies, configuring logging and alerting, and integrating the firewall\ninto the network architecture.\n\n\n**5.2.1**\n\n\n**Hardware and Software Installation**\n\n\nOnce the firewall has been chosen and acquired, the hardware, operating system, and underlying firewall\nsoftware should be installed for a software-based firewall. Next, for both software-based and hardwarebased firewalls, patches and vendor updates should be installed on the system. During this stage, the\nfirewall should also be hardened to decrease the risk of vulnerabilities and protect the system against\nunauthorized access. Any console software needed for remote access should also be installed at this time.\n\nDuring the installation and configuration, only the administrator doing that work should be able to\nmanage the firewall. All other management services for the firewall, such as SNMP, should be disabled,\nand these services should be left disabled permanently unless needed. If the firewall supports having a\nseparate administrator account for each person performing firewall administration duties, configure such\naccounts.\n\nNetwork firewalls should be placed in a room that meets the product’s recommended environmental\nrequirements for temperature, humidity, space, power, etc. This room should also be physically secured to\nprevent unauthorized personnel from accessing the firewall.\n\nComparing the logs of multiple systems when analyzing problems is very important, so the internal\nclocks in each firewall should be consistent with those in all other systems used by the organization. The\nbest way to do this is to have all systems synchronize with an authoritative time source.\n\n\n**5.2.2**\n\n\n**Policy Configuration**\n\n\nOnce hardware and software has been installed and secured, administrators can create the firewall’s\npolicies. Some firewalls implement policy through explicit rules; some firewalls require configuring\nfirewall settings that then create internal rules; some firewalls create policies and rules automatically; and\nstill others use a combination of these three types of configuration. The end result is a set of rules called a\n_ruleset that describes how the firewall acts. Some vendors have restrictions or suggestions on the order of_\nthe rules in a ruleset. While it is common to think of a firewall’s rules affecting traffic that appears on the\ninternal or external interfaces, most firewalls also allow configuring policies that are not traffic-based,\nsuch as who can view or change the rules, or where external DNS servers and time synchronization\nservers can be found.\n\nThese rulesets should implement the organization’s firewall policy as documented in the system security\nplan, and should be as specific as possible with regards to the network traffic they control. To create a\nruleset, it should first be determined what types of traffic (protocols, source and destination addresses,\netc.) are required by approved applications for the organization. This should include protocols that the\nfirewall itself may need (DNS, Simple Network Management Protocol [SNMP], NTP, logging, etc.)\n\nThe details of creating a ruleset vary by type of firewall and specific products. For example, many\nfirewalls check traffic against rules in a sequential manner until a match is found. For these firewalls,\nrules with the highest chance of matching traffic patterns should be placed as high in the list as possible to\nimprove firewall performance. Other firewalls have more complex ways of processing rulesets, such as\nfirst checking “deny” rules and then checking “allow” rules.\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\nMost firewalls allow each rule in a ruleset to have a comment. Filling in such a comment is important for\nothers to determine why a rule was made. Comments are also quite useful to people auditing rulesets.\nAlthough commenting rules may seem trivial, it can be quite valuable later and takes little effort. The rule\nchanges and the associated comments should be copied to the appropriate configuration management log.\n\nAt minimum, the following rules should be defined:\n\n� Port filtering should be enabled at the outer edge of the network, and probably at places inside the\nnetwork as well.\n\n� Content filtering should be done as close to the content receiver as possible.\n\nMany ways exist to define rules, and each organization will have its own needs and specific sets of\npersonnel who should be involved in ruleset configuration.\n\nIf multiple firewalls need to have the same rules or a common subset of rules, those rules should be\nsynchronized across the firewalls. This is usually done in a vendor-specific fashion. Note that it is likely\nthat some of the firewalls might have somewhat different policies, depending on their location in the\norganization's network. For example, an organization might want to have just one of its firewalls acting as\nthe VPN gateway, although all the firewalls might have the same filtering rules for non-VPN traffic.\nTherefore, it is important to only synchronize the rules that are common across the firewalls.\n\n**5.2.3 Logging and Alerts Configuration**\n\nThe next step in the configuration process is to set up logging and alerts. Logging is a critical step in\npreventing and recovering from failures as well as ensuring that proper security configurations are set on\nthe firewall. Proper logging can also provide vital information for responding to security incidents.\nWhenever possible, the firewall should be configured both to store logs locally and to send them to a\ncentralized log management infrastructure. Resource constraints, firewall logging capabilities, and other\nsituations may impair the ability to store logs both locally and centrally.\n\nDeciding what to log, and how long to keep logs, should be done on a case-by-case basis. For example,\nsome network administrators want to log all incoming accepted connections so that they can make sure\nthat they are not accepting unwanted traffic. Other administrators would not want to log accepted\nincoming connections because they are so numerous or because the logging would consume too many\nresources. Similarly, some administrators would not want to log all incoming traffic denied by the\nfirewall because the number of scans and probes by potentially malicious parties is very high and there is\nno action to be taken in response to them; however, other administrators would want to know about scans\nand probes in case they can detect a pattern that alerts them to a potential attack that can then be\nprevented.\n\nIf the firewall supports having administrator accounts with different capabilities, create one or more\nadministrative user accounts with just read access to the logs, if possible. Use these credentials when\nperforming read-only tasks such as auditing and periodic inspection of the logs.\n\nIn addition to configuring logging, real-time alerts should also be set up to notify administrators when\nimportant events occur on the firewall. Notifications may include the following:\n\n� Any modifications or disabling of the firewall rules\n\n� System reboots, disk shortages, and other operational events\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\n� Secondary system status changes, if applicable.\n\n**5.3** **Test**\n\nNew firewalls should be tested and evaluated before deployment to ensure that they are working properly.\nTesting should be completed on a test network without connectivity to the production network. This test\nnetwork should attempt to replicate the production network as faithfully as possible, including the\nnetwork topology and network traffic that would travel through the firewall. Aspects of the solution to\nevaluate include the following:\n\n� **Connectivity. Users can establish and maintain connections through the firewall.**\n\n� **Ruleset, Traffic that is specifically allowed by the security policy is permitted.** All traffic that is not\nallowed by the security policy is blocked. Verification of the ruleset should include both reviewing it\nmanually and testing whether the rules work as expected.\n\n� **Application Compatibility. Host-based or personal firewall solutions do not break or interfere with**\nthe use of existing software applications. This includes network communications between application\ncomponents. Network firewall solutions do not interfere with applications that have components that\ninteract through the firewall (e.g., client and server software).\n\n� **Management. Administrators can configure and manage the solution effectively and securely.**\n\n� **Logging. Logging and data management function in accordance with the organization’s policies and**\nstrategies.\n\n� **Performance. Solutions provide adequate performance during normal and peak usage. In many**\ncases, the best way to test performance under the load of a prototype implementation is to use\nsimulated traffic generators on a live test network to mimic the actual characteristics of expected\ntraffic as closely as possible. Simulating the loads caused by DoS attacks can also be helpful in\nassessing firewall performance. Testing should incorporate a variety of applications that will traverse\nthe firewall, especially those that are most likely to be affected by network throughput or latency\nissues.\n\n� **Security of the Implementation. The firewall implementation itself may contain vulnerabilities and**\nweaknesses that attackers could exploit. Organizations with high security needs may want to perform\nvulnerability assessments against firewall components.\n\n� **Component Interoperability. Components of the firewall solution must function together properly.**\nThis is of greatest concern when a variety of components from different vendors are used.\n\n� **Policy Synchronization. If there are multiple firewalls running synchronized policies or groups of**\nrules, test that the synchronization works in various scenarios (such as if one or more nodes are\noffline).\n\n� **Additional Features. Additional features that will be used by the firewall—such as VPN and**\nantimalware capabilities—should be tested to ensure they are working properly.\n\n**5.4** **Deploy**\n\nOnce testing is complete and all issues have been resolved, the next phase of the firewall planning and\nimplementation model is deployment, which should be done in accordance with organization policies.\nBefore deploying the firewall, administrators should notify users or owners of potentially affected\nsystems of the planned deployment, and instruct them who to notify if they encounter any problems. Any\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\nchanges required to other equipment should also be coordinated as part of the firewall deployment. The\nsecurity policy expressed by the firewall’s configuration should be added to the overall security policy of\nthe organization, and the ongoing changes to its configuration should be integrated with the\norganization’s configuration management processes. If multiple firewalls are being deployed, including\npersonal firewalls or at multiple branch offices, a gradual or phased approach should be considered; a\npilot program would also be helpful, especially for identifying and resolving issues of conflicting policies.\nThis will provide administrators with an opportunity to evaluate the firewall solution’s impact and resolve\nissues before enterprise-wide deployment.\n\nConnecting a firewall to the organization’s network requires more than just inserting the firewall into the\ntraffic flow from the outside of the network to the inside: it also involves integrating the firewall with\nother network elements that will interact with the firewall. Because firewalls usually act as routers, the\nfirewall has to be integrated into the network’s routing structure. This often means replacing a router that\nis at the same spot in the network topology as where the firewall is being placed, but it can also mean\nchanging the routing tables for other routers in the organization’s network to handle the addition of this\nnew router. If elements in the network use dynamic routing, those elements will probably need to have\ntheir configuration modified to be aware of the firewall’s routing. Also, the network switch on the outside\nof the network being protected may need to be reconfigured to handle the firewall’s addressing. If the\nfirewall is a set of systems with failover between the systems, the network switch may need to be\nconfigured to handle the failover.\n\n**5.5** **Manage**\n\nThis last phase of the firewall planning and implementation model is the longest lasting, because\nmanaging the solution involves maintaining firewall architecture, policies, software, and other\ncomponents of the solution chosen to be deployed. One example of a typical maintenance action is testing\nand applying patches to firewall devices.[21] Policy rules may need to be updated as new threats are\nidentified and requirements change, such as when new applications or hosts are implemented within the\nnetwork, and should also be reviewed periodically to ensure they remain in compliance with security\npolicy. It is also important to monitor the performance of firewall components to ensure that potential\nresource issues are identified and addressed before components become overwhelmed. Logs and alerts\nshould also be monitored continuously to identify threats—successful and unsuccessful—that are made to\nthe system. Another important task is to perform periodic testing to verify that firewall rules are\nfunctioning as expected. Also, firewall policies and rulesets should be backed up regularly. Some\nfirewalls can store this information in multiple formats, such as a binary format that is used to configure\nthe firewall and a human-readable format that can be read by auditors. If multiple formats are available,\nbackups should be kept in all of them.\n\nChanges to firewall rulesets or policies impact security and should be managed as part of a formal\nconfiguration management process. Many firewalls have auditing of changes as part of their\nadministrative interfaces, but this does not necessarily track policy changes. At a minimum, a log should\nbe kept of all policy decisions and ruleset changes—and this log should somehow be associated with the\nfirewall. For example, the log can be attached to the device physically, or the log file can be kept in the\nsame part of the organization’s inventory management system as the firewall. Also, some firewalls permit\ncomments to be maintained for each rule; wherever practical, rulesets should be documented with\ncomments on each rule. Most firewalls allow restrictions on who can make changes to the ruleset; some\neven allow restrictions on the addresses from which administrators can make such changes. Such\nrestrictions should be used when possible.\n\n21 For additional information about patch management, see NIST SP 800-40 Version 2, Creating a Patch and Vulnerability\n_[Management Program (http://csrc.nist.gov/publications/PubsSPs.html).](http://csrc.nist.gov/publications/PubsSPs.html)_\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\nBe aware that firewall rulesets can become increasingly complicated with age. For example, a new\nfirewall ruleset might contain entries to accommodate only outbound user traffic and inbound email\ntraffic (along with allowing the return inbound connections required by TCP/IP)—but will likely contain\nfar more rules by the time the firewall system reaches the end of its first year in production. While new\nuser or business requirements typically drive these changes, they can also reflect other influences within\nan organization. It is important to review the firewall policy often. Such a review can uncover rules that\nare no longer needed as well as new policy requirements that need to be added to the firewall.\n\nIt is best to review the firewall policy at regular intervals so that such reviews do not only happen during\npolicy or security audits (or, worse, only during emergencies). Each review should include a detailed\nexamination of all changes since the last regular review, particularly who made the changes and under\nwhat circumstances. It is also useful to occasionally perform overall ruleset audits by people who are not\npart of the normal policy review team to get an outside view of how the policy matches the organization’s\ngoals. Some firewalls have tools that can do automated reviews of policies, looking for such things as\nredundant rules or missing rules that are widely recommended. If such tools are available for an\norganization’s firewall, they should be used periodically, probably as part of the regular policy review.\n\nOrganizations may want to consider conducting penetration testing to assess the overall security of their\nnetwork environment. This testing can be used to verify that a firewall ruleset is performing as intended\nby generating network traffic and monitoring how it is handled by the firewall in comparison with its\nexpected response. Penetration testing should be employed in addition to, rather than instead of, a\nconventional audit program.[22]\n\n22 For more information on penetration testing, see NIST SP 800-115, Technical Guide to Information Security Testing and\n_[Assessment (http://csrc.nist.gov/publications/PubsSPs.html).](http://csrc.nist.gov/publications/PubsSPs.html)_\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\n\n**Appendix A—Glossary**\n\n\nSelected terms used in the publication are defined below.\n\n**Application Firewall: A firewall that uses stateful protocol analysis to analyze network traffic for one or**\nmore applications.\n\n**Application-Proxy Gateway: A firewall capability that combines lower-layer access control with upper**\nlayer-functionality, and includes a proxy agent that acts as an intermediary between two hosts that wish to\ncommunicate with each other.\n\n**Dedicated Proxy Server: A form of proxy server that has much more limited firewalling capabilities**\nthan an application-proxy gateway.\n\n**Demilitarized Zone (DMZ): An interface on a routing firewall that is similar to the interfaces found on**\nthe firewall’s protected side. Traffic moving between the DMZ and other interfaces on the protected side\nof the firewall still goes through the firewall and can have firewall protection policies applied.\n\n**Deny by Default: To block all inbound and outbound traffic that has not been expressly permitted by**\nfirewall policy.\n\n**Egress Filtering: Filtering of outgoing network traffic.**\n\n**Firewall: A device or program that controls the flow of network traffic between networks or hosts that**\nemploy differing security postures.\n\n**Host-Based Firewall: A software-based firewall installed on a server to monitor and control its incoming**\nand outgoing network traffic.\n\n**Ingress Filtering: Filtering of incoming network traffic.**\n\n**Network Access Control (NAC): A feature provided by some firewalls that allows access based on a**\nuser’s credentials and the results of health checks performed on the telework client device.\n\n**Network Address Translation (NAT): A routing technology used by many firewalls to hide internal**\nsystem addresses from an external network through use of an addressing schema.\n\n**Packet Filter: A routing device that provides access control functionality for host addresses and**\ncommunication sessions.\n\n**Personal Firewall: A software-based firewall installed on a desktop or laptop computer to monitor and**\ncontrol its incoming and outgoing network traffic.\n\n**Personal Firewall Appliance: A device that performs functions similar to a personal firewall for a group**\nof computers on a home network.\n\n**Ruleset: A set of directives that govern the access control functionality of a firewall. The firewall uses**\nthese directives to determine how packets should be routed between its interfaces.\n\n**Stateful Inspection: Packet filtering that also tracks the state of connections and blocks packets that**\ndeviate from the expected state.\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\n**Stateful Protocol Analysis: A firewalling capability that improves upon standard stateful inspection by**\nadding basic intrusion detection technology. This technology consists of an inspection engine that\nanalyzes protocols at the application layer to compare vendor-developed profiles of benign protocol\nactivity against observed events to identify deviations, allowing a firewall to allow or deny access based\non how an application is running over a network.\n\n**Stateless Inspection: See “Packet Filtering”.**\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\n\n**Appendix B—Acronyms and Abbreviations**\n\n\nSelected acronyms and abbreviations used in the publication are defined below.\n\n**AH** Authentication Header\n**ALG** Application Layer Gateways\n\n**CA** Certificate Authority\n**CIDR** Classless Inter-Domain Routing\n**CPU** Central Processing Unit\n\n**DMZ** Demilitarized Zone\n**DNS** Domain Name System\n**DoS** Denial of Service\n\n**ESP** Encapsulating Security Payload\n\n**FISMA** Federal Information Security Management Act\n**FTP** File Transfer Protocol\n\n**HA** High Availability\n**HTML** Hypertext Markup Language\n**HTTP** Hypertext Transfer Protocol\n\n**ICMP** Internet Control Message Protocol\n**IDPS** Intrusion Detection and Prevention System\n**IETF** Internet Engineering Task Force\n**IGMP** Internet Group Management Protocol\n**IKE** Internet Key Exchange\n**IM** Instant Messaging\n**IMAP** Internet Message Access Protocol\n**IP** Internet Protocol\n**IPS** Intrusion Prevention System\n**IPsec** Internet Protocol Security\n**IPv4** Internet Protocol version 4\n**IPv6** Internet Protocol version 6\n**ISATAP** Intra-site Automatic Tunnel Addressing Protocol\n**ISP** Internet Service Provider\n**IT** Information Technology\n**ITL** Information Technology Laboratory\n\n**LAN** Local Area Network\n**LDAP** Lightweight Directory Access Protocol\n\n**MAC** Media Access Control\n**MIME** Multipurpose Internet Mail Extensions\n\n**NAC** Network Access Control\n**NAP** Network Access Protection\n**NAPT** Network Address and Port Translation\n**NAT** Network Address Translation\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\n**NIC** Network Interface Card\n**NIST** National Institute of Standards and Technology\n**NTP** Network Time Protocol\n\n**OMB** Office of Management and Budget\n\n**PAT** Port Address Translation\n**PC** Personal Computer\n**PCI** Payment Card Industry\n**PMTU** Path Maximum Transmission Unit\n**POP** Post Office Protocol\n\n**RADIUS** Remote Authentication Dial In User Service\n**RFC** Request for Comments\n\n**SMTP** Simple Mail Transfer Protocol\n**SNMP** Simple Network Management Protocol\n**SP** Special Publication\n**SQL** Structured Query Language\n**SSL** Secure Sockets Layer\n\n**TCP** Transmission Control Protocol\n**TCP/IP** Transmission Control Protocol/Internet Protocol\n**TLS** Transport Layer Security\n\n**UDP** User Datagram Protocol\n**UPnP** Universal Plug and Play\n**URL** Uniform Resource Locator\n**UTM** Unified Threat Management\n\n**VoIP** Voice over Internet Protocol\n**VPN** Virtual Private Network\n**VPNC** Virtual Private Network Consortium\n\n**WAN** Wide Area Network\n\n**XML** Extensible Markup Language\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\n\n**Appendix C—Resources**\n\n\nThe lists below provide examples of resources that may be helpful.\n\n**NIST Documents and Resource Sites**\n\n**Resource Name** **Uniform Resource Locator (URL)**\n\nNIST National Checklist Program [http://checklists.nist.gov/](http://checklists.nist.gov/)\n\n\nNIST SP 800-18 Revision 1, Guide for Developing Security\n_Plans for Federal Information Systems_\n\nNIST SP 800-30, Risk Management Guide for Information\n_Technology Systems_\n\nNIST SP 800-40 Version 2, Creating a Patch and\n_Vulnerability Management Program_\n\nNIST SP 800-44 Version 2, Guidelines on Securing Public\n_Web Servers_\n\nNIST SP 800-45 Version 2, Guidelines on Electronic Mail\n_Security_\n\nNIST SP 800-46 Revision 1, Guide to Enterprise Telework\n_and Remote Access Security_\n\nNIST SP 800-52, Guidelines for the Selection and Use of\n_Transport Layer Security (TLS) Implementations_\n\nNIST SP 800-61 Revision 1, Computer Security Incident\n_Handling Guide_\n\nNIST SP 800-70 Revision 1 (Draft), National Checklist\n_Program for IT Products—Guidelines for Checklist Users_\n_and Developers_\n\n\n[http://csrc.nist.gov/publications/nistpubs/800-18-](http://csrc.nist.gov/publications/nistpubs/800-18-Rev1/sp800-18-Rev1-final.pdf)\n[Rev1/sp800-18-Rev1-final.pdf](http://csrc.nist.gov/publications/nistpubs/800-18-Rev1/sp800-18-Rev1-final.pdf)\n\n[http://csrc.nist.gov/publications/nistpubs/800-](http://csrc.nist.gov/publications/nistpubs/800-30/sp800-30.pdf)\n[30/sp800-30.pdf](http://csrc.nist.gov/publications/nistpubs/800-30/sp800-30.pdf)\n\n[http://csrc.nist.gov/publications/nistpubs/800-40-](http://csrc.nist.gov/publications/nistpubs/800-40-Ver2/SP800-40v2.pdf)\n[Ver2/SP800-40v2.pdf](http://csrc.nist.gov/publications/nistpubs/800-40-Ver2/SP800-40v2.pdf)\n\n[http://csrc.nist.gov/publications/nistpubs/800-44-](http://csrc.nist.gov/publications/nistpubs/800-44-ver2/SP800-44v2.pdf)\n[ver2/SP800-44v2.pdf](http://csrc.nist.gov/publications/nistpubs/800-44-ver2/SP800-44v2.pdf)\n\n[http://csrc.nist.gov/publications/nistpubs/800-45-](http://csrc.nist.gov/publications/nistpubs/800-45-version2/SP800-45v2.pdf)\n[version2/SP800-45v2.pdf](http://csrc.nist.gov/publications/nistpubs/800-45-version2/SP800-45v2.pdf)\n\n[http://csrc.nist.gov/publications/nistpubs/800-46-](http://csrc.nist.gov/publications/nistpubs/800-46-rev1/sp800-46r1.pdf)\n[rev1/sp800-46r1.pdf](http://csrc.nist.gov/publications/nistpubs/800-46-rev1/sp800-46r1.pdf)\n\n[http://csrc.nist.gov/publications/nistpubs/800-](http://csrc.nist.gov/publications/nistpubs/800-52/SP800-52.pdf)\n[52/SP800-52.pdf](http://csrc.nist.gov/publications/nistpubs/800-52/SP800-52.pdf)\n\n[http://csrc.nist.gov/publications/nistpubs/800-61-](http://csrc.nist.gov/publications/nistpubs/800-61-rev1/SP800-61rev1.pdf)\n[rev1/SP800-61rev1.pdf](http://csrc.nist.gov/publications/nistpubs/800-61-rev1/SP800-61rev1.pdf)\n\n[http://csrc.nist.gov/publications/PubsSPs.html](http://csrc.nist.gov/publications/PubsSPs.html)\n\n\nNIST SP 800-77, Guide to IPsec VPNs [http://csrc.nist.gov/publications/nistpubs/800-](http://csrc.nist.gov/publications/nistpubs/800-77/sp800-77.pdf)\n[77/sp800-77.pdf](http://csrc.nist.gov/publications/nistpubs/800-77/sp800-77.pdf)\n\n\nNIST SP 800-81 Revision 1 (Draft), Secure Domain Name\n_System (DNS) Deployment Guide_\n\nNIST SP 800-86, Guide to Integrating Forensic Techniques\n_into Incident Response_\n\nNIST SP 800-92, Guide to Computer Security Log\n_Management_\n\nNIST SP 800-94, Guide to Intrusion Detection and\n_Prevention Systems (IDPS)_\n\n\n[http://csrc.nist.gov/publications/PubsSPs.html](http://csrc.nist.gov/publications/PubsSPs.html)\n\n[http://csrc.nist.gov/publications/nistpubs/800-](http://csrc.nist.gov/publications/nistpubs/800-86/SP800-86.pdf)\n[86/SP800-86.pdf](http://csrc.nist.gov/publications/nistpubs/800-86/SP800-86.pdf)\n\n[http://csrc.nist.gov/publications/nistpubs/800-](http://csrc.nist.gov/publications/nistpubs/800-92/SP800-92.pdf)\n[92/SP800-92.pdf](http://csrc.nist.gov/publications/nistpubs/800-92/SP800-92.pdf)\n\n[http://csrc.nist.gov/publications/nistpubs/800-](http://csrc.nist.gov/publications/nistpubs/800-94/SP800-94.pdf)\n[94/SP800-94.pdf](http://csrc.nist.gov/publications/nistpubs/800-94/SP800-94.pdf)\n\n\nNIST SP 800-95, Guide to Secure Web Services [http://csrc.nist.gov/publications/nistpubs/800-](http://csrc.nist.gov/publications/nistpubs/800-95/SP800-95.pdf)\n[95/SP800-95.pdf](http://csrc.nist.gov/publications/nistpubs/800-95/SP800-95.pdf)\n\n\nNIST SP 800-97, Establishing Wireless Robust Security\n_Networks: A Guide to IEEE 802.11i_\n\n\n[http://csrc.nist.gov/publications/nistpubs/800-](http://csrc.nist.gov/publications/nistpubs/800-97/SP800-97.pdf)\n[97/SP800-97.pdf](http://csrc.nist.gov/publications/nistpubs/800-97/SP800-97.pdf)\n\n\nNIST SP 800-113, Guide to SSL VPNs [http://csrc.nist.gov/publications/nistpubs/800-](http://csrc.nist.gov/publications/nistpubs/800-113/SP800-113.pdf)\n[113/SP800-113.pdf](http://csrc.nist.gov/publications/nistpubs/800-113/SP800-113.pdf)\n\n\nNIST SP 800-114, User’s Guide to Securing External\n_Devices for Telework and Remote Access_\n\nNIST SP 800-115, Technical Guide to Information Security\n_Testing and Assessment_\n\n\n[http://csrc.nist.gov/publications/nistpubs/800-](http://csrc.nist.gov/publications/nistpubs/800-114/SP800-114.pdf)\n[114/SP800-114.pdf](http://csrc.nist.gov/publications/nistpubs/800-114/SP800-114.pdf)\n\n[http://csrc.nist.gov/publications/nistpubs/800-](http://csrc.nist.gov/publications/nistpubs/800-115/SP800-115.pdf)\n[115/SP800-115.pdf](http://csrc.nist.gov/publications/nistpubs/800-115/SP800-115.pdf)\n\n\n-----\n\nGUIDELINES ON FIREWALLS AND FIREWALL POLICY\n\n**Other Technical Resource Sites and Documents**\n\n**Resource Name** **Uniform Resource Locator (URL)**\n\nAchieving Defense-in-Depth with Internal Firewalls [http://www.sans.org/reading_room/whitepapers/firewalls/7](http://www.sans.org/reading_room/whitepapers/firewalls/797.php?portal=a4d358dbd051422110d917753a0ebb7c)\n[97.php?portal=a4d358dbd051422110d917753a0ebb7c](http://www.sans.org/reading_room/whitepapers/firewalls/797.php?portal=a4d358dbd051422110d917753a0ebb7c)\n\nBest Practices for Managing Firewall Logs [http://www.zdnet.com.au/insight/print.htm?TYPE=story&A](http://www.zdnet.com.au/insight/print.htm?TYPE=story&AT=120265680-139023731t-110000100c)\n[T=120265680-139023731t-110000100c](http://www.zdnet.com.au/insight/print.htm?TYPE=story&AT=120265680-139023731t-110000100c)\n\n\nDefense in Depth: Foundations for Secure and\nResilient IT Enterprises\n\n\n[http://www.cert.org/archive/pdf/Defense_in_Depth092106.](http://www.cert.org/archive/pdf/Defense_in_Depth092106.pdf)\n[pdf](http://www.cert.org/archive/pdf/Defense_in_Depth092106.pdf)\n\n\nFirewall Evolution – Deep Packet Inspection [http://www.securityfocus.com/infocus/1716](http://www.securityfocus.com/infocus/1716)\n\n\nHow do Circuit-Level Gateways and Application-Level\nGateways Differ?\n\n\n[http://searchsecurity.techtarget.com/expert/Knowledgebas](http://searchsecurity.techtarget.com/expert/KnowledgebaseAnswer/0,289625,sid14_gci1197999,00.html)\n[eAnswer/0,289625,sid14_gci1197999,00.html](http://searchsecurity.techtarget.com/expert/KnowledgebaseAnswer/0,289625,sid14_gci1197999,00.html)\n\n\nNational Vulnerability Database [http://nvd.nist.gov/](http://nvd.nist.gov/)\n\nThe Perils of Deep Packet Inspection [http://www.securityfocus.com/infocus/1817](http://www.securityfocus.com/infocus/1817)\n\nTransparent, Bridging Firewall Devices [http://www.securityfocus.com/infocus/1737](http://www.securityfocus.com/infocus/1737)\n\nThe Web Services Advisor: XML Firewalls [http://searchwebservices.techtarget.com/tip/1,289483,sid2](http://searchwebservices.techtarget.com/tip/1,289483,sid26_gci855052,00.html)\n[6_gci855052,00.html](http://searchwebservices.techtarget.com/tip/1,289483,sid26_gci855052,00.html)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "99fdc3ef-333d-48f5-a4a1-becd788c7b80",
            "created_at": "2022-10-25T15:28:29.802983Z",
            "updated_at": "2022-10-25T15:28:29.802983Z",
            "deleted_at": null,
            "name": "MITRE",
            "url": "https://github.com/mitre-attack/attack-stix-data",
            "description": "MITRE ATT&CK STIX Data",
            "reports": null
        }
    ],
    "references": [
        "https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-41r1.pdf"
    ],
    "report_names": [
        "nistspecialpublication800-41r1.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716491,
    "ts_updated_at": 1743041119,
    "ts_creation_date": 1253606800,
    "ts_modification_date": 1328519483,
    "files": {
        "pdf": "https://archive.orkl.eu/0c853a4bcad3e0a13f06295a2e27a8d708756fee.pdf",
        "text": "https://archive.orkl.eu/0c853a4bcad3e0a13f06295a2e27a8d708756fee.txt",
        "img": "https://archive.orkl.eu/0c853a4bcad3e0a13f06295a2e27a8d708756fee.jpg"
    }
}