{
    "id": "98891b69-a75b-4367-9683-a4fd81ebe2ce",
    "created_at": "2023-10-03T02:07:39.116741Z",
    "updated_at": "2025-03-27T02:06:08.336557Z",
    "deleted_at": null,
    "sha1_hash": "da34eacdaec0e822479ed61664e278db5f7a1944",
    "title": "",
    "authors": "",
    "file_creation_date": "2023-09-29T14:29:51Z",
    "file_modification_date": "2023-09-29T14:29:51Z",
    "file_size": 3801010,
    "plain_text": "Website Blog Twitter Linkedin\n\n\n-----\n\n## Ongoing Threats Targeting the Energy Industry\n\n TLP: CLEAR PAP: CLEAR\n\n\n# Table of contents\n\nTable of contents .................................................................................................................................. 2\n\nKey findings ........................................................................................................................................... 3\n\nIntrinsec’s CTI services ........................................................................................................................ 3\n\nIntroduction ............................................................................................................................................ 4\n\nI – Strategical Intelligence ................................................................................................................... 4\n\n1. Intelligence brief ........................................................................................................................ 4\n\n2. Attribution ................................................................................................................................... 5\n\n3. Victimology................................................................................................................................. 5\n\n3.1. Unattributed malicious cluster ............................................................................................. 7\n\n3.2. Another malicious cluster ................................................................................................... 12\n\nII – Tactical Intelligence ...................................................................................................................... 14\n\n1. Tactics, Techniques and Procedures .................................................................................. 14\n\n1.1. NSIS variant of GuLoader.................................................................................................. 14\n\n1.2. Attachment abusing CVE-2017-0199 for GuLoader deployment ................................ 18\n\n2. Code Analysis ......................................................................................................................... 20\n\n2.1. Extracted NSI script ............................................................................................................ 20\n\n2.2. NSIS variant ......................................................................................................................... 21\n\n2.3. VBS variant of GuLoader ................................................................................................... 21\n\n2.4. Shellcode anti analysis ....................................................................................................... 27\n\n3. Infrastructure Analysis ........................................................................................................... 28\n\n3.1. Leveraging Google Drive for final payload delivery ....................................................... 28\n\nConclusion ........................................................................................................................................... 29\n\nIII - Actionable content ....................................................................................................................... 30\n\n1. IoCs ........................................................................................................................................... 30\n\n2. Recommendations .................................................................................................................. 31\n\n3. Sources .................................................................................................................................... 31\n\n© I t i\n\n\n-----\n\n## Ongoing Threats Targeting the Energy Industry\n\n TLP: CLEAR PAP: CLEAR\n\n\n# Key findings\n\nIn this report are presented:\n\n  - The origin of the malware and information about the company running it.\n\n  - How multiple companies from the energy sector including, three French companies with\nbranches in Liquified Natural Gas (LNG) production, were targeted using internal emails that\nwere uploaded to public platforms and likely reused by an unidentified threat actor to send\nphishing emails with their template.\n\n  - The last techniques, tactics and procedures threats actors are currently leveraging to target\ncritical entities using GuLoader and other malwares.\n\n  - Some insights on GuLoader’s functionalities and evasion techniques leveraged by its NSIS and\nVBS variants.\n\n# Intrinsec’s CTI services\n\nOrganisations are facing a rise in the sophistication of threat actors and intrusion sets. To address these\nevolving threats, it is now necessary to take a proactive approach in the detection and analysis of any\nelement deemed malicious. Such a hands-on approach allows companies to anticipate, or at least react\nas quickly as possible to the compromises they face.\n\nFor this report, shared with our clients in July 2023, Intrinsec relied on its Cyber Threat Intelligence\nservice, which provides its customers with high value-added, contextualized and actionable\nintelligence to understand and contain cyber threats. Our CTI team consolidates data & information\ngathered from our security monitoring services (SOC, MDR …), our incident response team (CERTIntrinsec) and custom cyber intelligence generated by our analysts using custom heuristics, honeypots,\nhunting, reverse-engineering & pivots.\n\nIntrinsec also offers various services around Cyber Threat Intelligence:\n\n  - Risk anticipation: which can be leveraged to continuously adapt the detection & response\ncapabilities of our clients’ existing tools (EDR, XDR, SIEM, …) through:\n\n`o` an operational feed of IOCs based on our exclusive activities.\n`o` threat intel notes & reports, TIP-compliant.\n\n  - Digital risk monitoring:\n\n`o` data leak detection & remediation\n`o` external asset security monitoring (EASM)\n`o` brand protection\n\nFor more information, go to www.intrinsec.com/en/cyber-threat-intelligence/.\n\n© I t i\n\n\n-----\n\n## Ongoing Threats Targeting the Energy Industry\n\n TLP: CLEAR PAP: CLEAR\n\n\n# Introduction\n\nIntrinsec’s CTI Team discovered a cluster of activity mainly targeting companies related to the energy\nsector with spear phishing emails and domains typo squatting of those companies’ domain names and\ntheir Liquified Natural Gas branches, but also other generic domains related to the LNG industry like\n“lng-gaz[.]com”. The purpose of these campaigns was to deploy GuLoader implants and later on,\nAgentTesla implants.\n\nGuLoader is a loader used to evade detection and analysis by leveraging a variety of techniques such\nas checking for its environment of execution and encrypting the payload it is trying to inject on the\ninfected system. The actor that bought GuLoader must provide to the building program the URL\nhosting the software that it wants to protect and load on the system. It must be encrypted and can be\nhosted on legitimate services like Google Drive or any other domain. GuLoader can come in different\nfile formats like VBS scripts or NSIS installers. It is known to drop malware like Lokibot, AzorUlt,\nRemcos, Nanocore, WarzoneRAT, AgentTesla, FormBook and Hakbit ransomware.\n\n# I – Strategical Intelligence\n\n### 1. Intelligence brief\n\n_Figure 1: Diamond model of the analysed threats._\n\n© I t i\n\n\n-----\n\n## Ongoing Threats Targeting the Energy Industry\n\n TLP: CLEAR PAP: CLEAR\n\n\n### 2. Attribution \n\n[As reported by CheckPoint, GuLoader is currently sold under the name “CloudEye Protector” by an](https://research.checkpoint.com/2020/guloader-cloudeye/)\nItalian company specialized in code protection. The program was first advertised in 2014 on\nundergrounds forums like Hack-Forum by a user with the username “xor”, in reference to the logical\noperation of the same name, often used for encryption purposes. On those old threads, Xor mentioned\nthe possibility to buy the program on its official website “securitycode[.]eu”. The company that owns\nthe website is registered in Italy under the name “Easysoft Di Ivano Mancini”. Even though Easysoft\nindeed commercially distributes CloudEye, the company does not control nor involve itself in the usage\nmade by clients of their software. This plausible deniability gives the company a sort of \"immunity\" as\nto any attribution regarding GuLoader powered campaigns.\n\nCheckpoint researchers even reported that GuLoader’s developer contacted them right after their\npublication research echoed in June 2020 with the cybersec community claiming not being aware of\nany malicious usage of their product. However, further checks by the same researchers of thousands\nof GuLoader samples showed that [99.9-100% of them were associated with malicious activities. As](https://www.youtube.com/watch?v=8ZnTJyEgVNg)\nsuch, GuLoader could be considered as a malware-as-a-service.\n\n### 3. Victimology\n\nAs far as the victimology related to GuLoader usage is concerned, it appears that a wide range of\nsectors and companies were targeted.\n\nAn interesting aspect to observe in the campaigns is the delivery method of GuLoader. One method of\ntracking the malware usage as well as campaigns was through the research of spear phishing emails.\nThese emails revealed the effort put into appearing legitimate, adapting the name of the payload to\npass off as a genuine corporate document or business enquiry as well as the use of legitimate logos\nand identities. Finally, the use of spoofed email domains was observed rendering those phishing\n[campaigns particularly hard to detect for average users. This spoofing technique has been observed](https://www.fortinet.com/blog/threat-research/spoofed-saudi-purchase-order-drops-guloader?utm_source=blog&utm_medium=blog&utm_campaign=spoofed-saudi-purchase-order-drops-guloader)\n[by Fortinet](https://www.fortinet.com/blog/threat-research/spoofed-saudi-purchase-order-drops-guloader?utm_source=blog&utm_medium=blog&utm_campaign=spoofed-saudi-purchase-order-drops-guloader) in 2022, during a campaign that spoofed Saudi purchase orders around the period of July.\n\nMoreover, GuLoader has been observed targeting energy providers, such as a Romanian company\noperating in this sector on June 21, 2023. This company represented a key target as it is an important\nprovider for electrical infrastructure in Romania.\n\nTo achieve its objective, the threat actor sent a phishing email and spoofed its headers to make it look\nlike it was sent by a known Romanian airline.\n\n© I t i\n\n\n-----\n\n_Figure 2: Phishing e-mail targeting a Romanian company and deploying GuLoader._\n\n© I t i\n\n\n## Ongoing Threats Targeting the Energy Industry\n\n TLP: CLEAR PAP: CLEAR\n\n\n-----\n\n## Ongoing Threats Targeting the Energy Industry\n\n TLP: CLEAR PAP: CLEAR\n\n\n#### 3.1. Unattributed malicious cluster\n\nAnother delivery method related to the deployment of GuLoader by another malicious cluster is still\nassociated to email spoofing, but this time used in such a way that the attacker poses as a member of\nthe victim company by sending an email with a typo squatted domain where only one letter is changed.\nThrough this method of delivery, we have detected several companies being spoofed such as the South\nKorean branch of a French company operating in the energy industry. The targeted person was working\nfor the company as a strategical buyer. The email was particularly well crafted since the subject of\ntopic was related to an ongoing project, between the targeted company and another company from\nthe energy sector based in Taiwan, about the installation of a slug catcher (which is a common piece\nof equipment in this industry) in their infrastructure in Malaysia. We can assess that this email was\noriginally sent by employees of the company but was uploaded to a public platform for unknown\nreason, resulting in the threat actor taking advantage of this OPSEC error by reusing their email\ntemplate to send the same one but with a malicious archive attached to it.\n\n_Figure 3: Phishing e-mail sent to a French company from the energy sector with a GuLoader implant attached to it._\n\nA Spanish company linked to the oil and gas industry was targeted two days before that by an email\nsent by the same server and leveraging the same domain typo squatting technique. In this case, the\nmail contained three legitimate internal documents including one confidential linked to the company,\ngiving more legitimacy to the lure. The GuLoader implant was contained in a CAB archive. The targeted\nindividual works as a purchasing engineer for the company.\n\n© I t i\n\n\n-----\n\n## Ongoing Threats Targeting the Energy Industry\n\n TLP: CLEAR PAP: CLEAR\n\n\nBy pivoting on the legitimate files present in the mail, we found that the same email was uploaded to\na public platform one month before this campaign but only with the legitimates documents attached\nto it and not the malicious CAB archive. We can assess that there is a realistic probability that this\nthreat actor found it and decided to attach its payload and to use the same email template for its\nphishing campaign in order to increase the quality of the lure.\n\n_Figure 4: Phishing Mail sent to a Spanish company operation in the energy sector with a GuLoader implant attached to it._\n\n_Figure 5 : Technique used by the threat actor to target companies with emails uploaded to a public platform._\n\nThe same IP that sent those emails targeted a Thai company operating in the heavy industry and\nengineering design sectors, as well as in the petrochemical sector. The same technique was likely\nleveraged, since an original and legitimate email related to the company was uploaded on a public\n\n© I t i\n\n\n-----\n\n## Ongoing Threats Targeting the Energy Industry\n\n TLP: CLEAR PAP: CLEAR\n\n\nplatform in December 2022. In June 2023, the threat actor took the template and documents from this\nemail and used them to send it to the company but added its malicious implant to it. Regarding this\nlatter, AgentTesla was contained in a ZIP archive attached to the email.\n\n_Figure 6: Phishing Mail sent to a Thai company operating in the energy sector with an archive containing an AgentTesla_\n\n_implant attached to it._\n\nA major German company operating in the energy sector was targeted later, in August, by an email\nsent by the same IP address that sent the emails from the previously analysed campaigns. The threat\nactor crafted the headers of the mail to make it look like the sender’s domain of origin was the one of\nthe targeted companies. Looking more in the details of the headers, we found that the actual sender\nemail server had a completely different domain name and used Plesk.\n\nAs a reminder, Plesk is a server data automation software, which is often used by threat actors to\nquickly deploy phishing infrastructures. The mail pretended to be sent by the head of the production\nand was supposed to target the head of external relations. In this campaign, the threat actor chose to\ndirectly place an AgentTesla implant in a RAR archive attached to the mail.\n\n© I t i\n\n\n-----\n\n_Figure 7: Details on the mail’s content._\n\nDuring the same day, another mail related to a “Power & Energy Project” subject was sent to a SinoThai company specialized in the construction of refineries and various types of power plants such as\ngas, thermal, cogeneration, coal, and hydro. An AgentTesla implant was also contained in a RAR archive\nattached to the mail.\n\n_Figure 8: Details on the mail’s content._\n\nOn those three previously analysed campaigns, the AgentTesla implants were supposed to exfiltrate\nthe stolen data over SMTP with the following configuration:\n\nProtocol SMTP\nHost cp7nl.hyperhost[.]ua\nPort 587\nUsername victorlog@lgtvproducts[.]buzz\n\nUpon examining those campaigns targeting energy companies, it is possible to assess with medium\nconfidence, that they were operated by the same threat actor. Some of the elements supporting that\nassessment are the use of the same IP address for the delivery of infected phishing emails and the\n\n© I t i\n\n|Protocol|SMTP|\n|---|---|\n|Host|cp7nl.hyperhost[.]ua|\n|Port|587|\n|Username|victorlog@lgtvproducts[.]buzz|\n\n\n-----\n\n## Ongoing Threats Targeting the Energy Industry\n\n TLP: CLEAR PAP: CLEAR\n\n\ntechnique leveraged to find legitimate emails related to the targeted company on a public platform,\nthe same exfiltration configuration for the AgentTesla implants as well as the use of Google Drive for\nthe final payload delivery when GuLoader was deployed, and the short period of time between the\ncampaigns.\n\nThe observed campaigns can be summarized with the following timeline:\n\n_Figure 9: Timeline and details of the observed campaigns._\n\n© I t i\n\n\n-----\n\n## Ongoing Threats Targeting the Energy Industry\n\n TLP: CLEAR PAP: CLEAR\n\n\n#### 3.2. Another malicious cluster\n\nIn July 2023, another campaign from a different intrusion set that did not show the same artefacts\npreviously found, used a compromised webmail of an ONG in Uzbekistan to target a financial company\nin Azerbaijan. This time the energy sector was not directly targeted but was instead used as a lure. The\nmail pretended to be sent by a state-owned oil and natural gas corporation. A ZIP archive containing a\nGuLoader implant presented as a screen saver was attached to the mail.\n\n_Figure 10: Email sent by the intrusion set, targeting an Azerbaijani company, and pretending to be an energy company._\n\n© I t i\n\n\n-----\n\n## Ongoing Threats Targeting the Energy Industry\n\n TLP: CLEAR PAP: CLEAR\n\n\nAlso in July, this intrusion set pretended to be part of an Iranian company specialized in designing,\nengineering, manufacturing, and supplying chemicals and equipment in petrochemical industries. Two\narchives were attached to the mail, both containing GuLoader implants presented as screen savers.\n\n_Figure 11: Email sent by the intrusion set, pretending to be an Iranian company specialized in petrochemicals._\n\n© I t i\n\n\n-----\n\n## Ongoing Threats Targeting the Energy Industry\n\n TLP: CLEAR PAP: CLEAR\n\n\n# II – Tactical Intelligence\n\n### 1. Tactics, Techniques and Procedures\n\n#### 1.1. NSIS variant of GuLoader\n\nIn the case of an email targeting a German company, the attachment was an IMG file that automatically\nmounts a virtual disk on the machine when launched. Inside was the GuLoader NSIS installer.\n\n_Figure 12: Email containing the malicious IMG attachment._\n\nWhen executed, the NSIS, (Nullsoft Scriptable Install System), a program originally used to install\nsoftware, will create a folder dubbed “Stephens” on “Appdata\\Local” in the user’s directory that will\ncontain the shellcode.\n\n_Figure 13: Content of the \"Stephens\" folder._\n\nThe content of an NSIS can also be extracted with software like 7zip. It contains a DLL responsible for\ninterpreting specific instructions written in a separate “.nsi” file that can also be extracted with\nprevious versions of 7zip (15.05). The GuLoader shellcode is saved with a random name and extension\nin the same folder.\n\n© I t i\n\n\n-----\n\n_Figure 14: Extracted content of the NSIS installer._\n\nThe NSIS then starts the legitimate process “CasPol.exe” and injects the shellcode in its memory before\nterminating itself.\n\n_Figure 15: Process tree after executing the NSIS._\n\nThe shellcode can be found in a Read-Write-Execute protected region in the process’s memory. Its\ncontent is the same as the content of the shellcode file extracted from the NSIS.\n\n_Figure 16: Content of the memory region where the shellcode was injected._\n\n© I t i\n\n\n-----\n\n## Ongoing Threats Targeting the Energy Industry\n\n TLP: CLEAR PAP: CLEAR\n\n\nThe shellcode performs a GET request to retrieve an additional payload that is XOR encrypted and\nhosted on “00gssa[.]com/zx.bin”. It is possible to find the URL hosting this next stage in the dumped\nstrings of the process.\n\n_Figure 17: Strings dumped from the CasPol.exe process displaying the URL hosting the next stage payload._\n\nThe format of the URL found in the dumped strings corresponds to the one which must be provided in\nthe CloudEye Protector client for it to download the desired next stage; where the file’s extension\nseems to always be “.bin”.\n\n_Figure 18: Inside the builder, the user must provide the URL hosting the encrypted payload in order for GuLoader to know_\n\n_[where to download it from. Source: https://research.checkpoint.com/2020/guloader-cloudeye/](https://research.checkpoint.com/2020/guloader-cloudeye/)_\n\n© I t i\n\n\n-----\n\n## Ongoing Threats Targeting the Energy Industry\n\n TLP: CLEAR PAP: CLEAR\n\n\nThe full chain of infection for this campaign can be summarized with the diagram below:\n\n_Figure 19: A chain of infection using IMG and NSIS installer files to deploy GuLoader._\n\nBy analysing those two campaigns, it is possible to observe how the options “self-process loader” and\n“trusted process loader”, present on the CloudEye Protector builder, are operated by the loader. We\nbelieve that the “trusted process” mentioned in the builder is indeed the injected “CasPol.exe”\nprocess. This program is natively present on the Windows Operating System, and thus considered\n“trusted”.\n\n_Figure 20: Injection options available when building the loader on the CloudEye Protector client. Source:_\n\n[https://research.checkpoint.com/2020/guloader-cloudeye/](https://research.checkpoint.com/2020/guloader-cloudeye/)\n\n© I t i\n\n\n-----\n\n## Ongoing Threats Targeting the Energy Industry\n\n TLP: CLEAR PAP: CLEAR\n\n\n#### 1.2. Attachment abusing CVE-2017-0199 for GuLoader deployment\n\nWe observed another initial access technique consisting of a Word document exploiting CVE-20170199 that was sent in attachment of an email spoofing a Georgian company.\n\n_Figure 21: Email spoofing a Georgian company and containing a malicious attachment._\n\nWhen launched, the document will communicate with a shortened URL hosting a malicious RTF that\ndownloads and drops the GuLoader NSIS installer.\n\n_Figure 22: Execution of the document displaying the URL hosting the RTF._\n\nIt is possible to observe the GET request sent to the IP hosting the last encrypted payload.\nUnfortunately, it was not possible to retrieve the payload as the page returned a 404 error.\n\n© I t i\n\n\n-----\n\n_Figure 23: GET request trying to retrieve the final payload but returning a 404 not found._\n\nThe full chain of infection for this campaign can be summarized with the diagram below:\n\n_Figure 24: An infection chain using RTF file and the NSIS variant of GuLoader._\n\n© I t i\n\n\n-----\n\n## Ongoing Threats Targeting the Energy Industry\n\n TLP: CLEAR PAP: CLEAR\n\n\n### 2. Code Analysis\n\n#### 2.1. Extracted NSI script\n\nUsing 7z we can extract the NSI script used for installation and then analyze this script. The heavily\nobfuscated script begins with running every section upon the \"instfile” call, then calls the one function\nwe are interested in: .onMouseOverSection. This function is called automatically on binary execution\n[as stated in the NSIS documentation.](https://nsis.sourceforge.io/Docs/Chapter4.html)\n\n_Figure 25: .onMouseOverSection function._\n\nOn startup, the _.onMouseOverSection function will copy the shellcode located in the_\n_Emneomraadedefinition.Ove file in the $4 variable and call the func_451 function. This function will_\nthen call the func_12 function which will copy the $4 variable in the $R8 variable, allocate some space\ninto memory and then call the “System::Call” method on the $R8 variable, executing the shellcode.\n\n© I t i\n\n\n-----\n\n_Figure 26: Summary of an NSI script used to build the executable._\n\nThe System::Call method is inherited from the NSIS System plug-in contained in System.dll library. As\nstated in the NSIS documentation, this library allows allocation of memory, writing to memory, freeing\nmemory, and calls.\n\n#### 2.2. NSIS variant \n\nUsing _CreateProcessInternalW(), GuLoader’s NSIS variant will start by creating a new process_\n“CasPol.exe”, which stands for “Code Access Security Policy Tool”. This process is a legitimate Windows\nprocess that enables users and administrators to modify security policy for the machine policy level,\nthe user policy level, and the enterprise policy level. After creating this process, the malware writes\nthe full shellcode in its memory using _NtWriteVirtualMemory()._ The size of the written data\ncorresponds exactly to the delivered file containing the shellcode. After checking its environment for\nanalysis environment behaviour, the shellcode downloads the next payload encrypted with a XOR key.\nThis payload will be decrypted and injected in the same process as the shellcode in a region with ReadWrite-Execute protections.\n\n#### 2.3. VBS variant of GuLoader\n\nIn the context of a campaign spoofing a Bulgarian IT company, an archive containing the VBS variant\nof GuLoader was sent in the attachment of an email.\n\n© I t i\n\n\n## Ongoing Threats Targeting the Energy Industry\n\n TLP: CLEAR PAP: CLEAR\n\n\n-----\n\n## Ongoing Threats Targeting the Energy Industry\n\n TLP: CLEAR PAP: CLEAR\n\n\n_Figure 27: Content of the mail and attachment sent to the Bulgarian company._\n\nThe VBS script contains 879 lines with obfuscated PowerShell in its core. Its content was passed in the\nPowerShell.exe process in the following format:\n\n_Figure 28: The full PowerShell script that was passed as a parameter in the PowerShell.exe process._\n\n© I t i\n\n\n-----\n\n## Ongoing Threats Targeting the Energy Industry\n\n TLP: CLEAR PAP: CLEAR\n\n\nOnce deobfuscated, the script will download an additional base64 encoded blob of data in a file hosted\non the URL “ac-at[.]net/Tulle.asd” and will save it on the disk under the name “Beruse.Sor”. It then\nlocates a certain portion data at the offset 189548 with a length of 20758 bytes which contains a\nsecond PowerShell script.\n\n_Figure 29: The deobfuscated content of the PowerShell script._\n\n_Figure 30: Base64 encoded data hosted on the URL found in the PowerShell script._\n\n© I t i\n\n\n-----\n\n## Ongoing Threats Targeting the Energy Industry\n\n TLP: CLEAR PAP: CLEAR\n\n\nAfter decoding and extracting the data from the specifically given offset and size, the second\nPowerShell script was found to be filled with random comments in its code.\n\n_Figure 31: Content of the second PowerShell script._\n\nAfter removing those comments, one could find XOR encrypted data passed through various variables.\n\n_Figure 32: Content of the PowerShell script after removing the comments._\n\n© I t i\n\n\n-----\n\n## Ongoing Threats Targeting the Energy Industry\n\n TLP: CLEAR PAP: CLEAR\n\n\nOnce decrypted, a shellcode is executed via function _CallWindowProcA. This function takes as first_\nargument a pointer to a callback function. When this pointer is used to call the function, it is called a\ncallback. This behaviour can be abused to run a shellcode by passing a pointer to the shellcode in the\nfirst argument. [This article contains other APIs that threat actors can leverage to abuse this](https://osandamalith.com/2021/04/01/executing-shellcode-via-callbacks/)\nfunctionality.\n\n_Figure 33: Decrypted code found in the second PowerShell script responsible for launching a shellcode._\n\nThis shellcode is used to decrypt another shellcode present on the same file “Beruse.Sor” at a different\noffset.\n\n_Figure 34: Location of the shellcode used to decrypt the other shellcode._\n\n© I t i\n\n\n-----\n\n## Ongoing Threats Targeting the Energy Industry\n\n TLP: CLEAR PAP: CLEAR\n\n\nThe overall content of the file retrieved from the URL present on the PowerShell script and saved on\nthe disk under the name ”Beruse.Sor”, can be summarized with the following figure:\n\n_Figure 35: Content of the downloaded file “Beruse.Sor”._\n\nThe XOR key that will decrypt the encrypted shellcode can be found inside the first shellcode amongst\nthe following set of assembly instructions. In this case, the key is “0x3EAF89BA”.\n\n_Figure 36: Assembly instructions responsible for the decryption of the second shellcode._\n\n© I t i\n\n\n-----\n\n## Ongoing Threats Targeting the Energy Industry\n\n TLP: CLEAR PAP: CLEAR\n\n\nThe following python script can be used to decrypt the second shellcode with the previously found key.\n\n_Figure 37: Python script that can be used to decrypt the second shellcode with the previously found XOR key._\n\nThe full chain of infection for this campaign can be summarized with the diagram below:\n\n_Figure 38: A chain of infection using ZIP and PowerShell to deploy GuLoader shellcode._\n\n#### 2.4. Shellcode anti analysis\n\n[As mentioned by McAfee, GuLoader employs many techniques to hinder the analysis process of the](https://www.mcafee.com/blogs/other-blogs/mcafee-labs/guloader-campaigns-a-deep-dive-analysis-of-a-highly-evasive-shellcode-based-loader/)\nshellcode:\n\n  - Employs runtime padding.\n\n  - Scans whole process memory for analysis tool specific strings.\n\n  - Uses DJB2 hashing for string checks and dynamic API address resolution.\n\n  - Strings are decoded at runtime.\n\n  - Checks if QEMU is installed on the system by checking the installation path:\n\nC:\\\\Program Files\\\\qqa\\\\qqa.exe\n\n  - Patches the following APIs: DbgUIRemoteBreakIn\n\n  - The function’s prologue is patched with ExitProcess call.\n\n  - _LdrLoadDll_\n\n© I t i\n\n\n-----\n\n## Ongoing Threats Targeting the Energy Industry\n\n TLP: CLEAR PAP: CLEAR\n\n\n\n  - The initial bytes are patched with instruction “mov **edi** **edi.”**\n\n  - DbgBreakPoint\n\n  - Patches with “nop” instruction\n\n  - Clears hooks placed in ntdll.dll by security products or researcher for the analysis.\n\n  - Window Enumeration via EnumWindows\n\n  - Hides the shellcode thread from the debugger via ZwSetInformationThread by passing 0x11\n(ThreadHideFromDebugger)\n\n  - Device driver enumeration via EnumDeviceDrivers and GetDeviceDriverBaseNameA\n\n  - Installed software enumeration via MsiEnumProductsA and MsiGetProductInfoA\n\n  - System service enumeration via OpenSCManagerA and EnumServiceStatusA\n\n  - Checks use of debugging ports by passing _ProcessDebugPort_ (0x7) class to\n_NtQueryInformationProcess_\n\n  - Use of CPUID and RDTSC instructions to detect virtual environments.\n\nThose checks often result in an error revealing that GuLoader managed to detect the environment and\nthus prevent the download and decryption of the next stage payload.\n\n_Figure 39: Error message returned when GuLoader manages to detect the analysis environment._\n\n### 3. Infrastructure Analysis\n\n#### 3.1. Leveraging Google Drive for final payload delivery\n\nThe observed campaign targeting companies from the energy sector revealed the use of the legitimate\nservice Google Drive for payload hosting and delivery.\n\nInitial spearfishing email with attached GuLoader payload was sent from a Thai IP (147.50.227[.]13).\nUpon execution of the payload and after injection, the malware would contact **142.250.179[.]78**\n(Google LLC) to retrieve the final payload from a Google drive instance resolving the following URLs:\n\n  - hxxps[://]drive[.]google[.]com/uc?export=download&id=1BDYk252qc7_7mHf4QCodtbpjIysH\nT4Vv\n\n  - hxxps[://]drive[.]google[.]com/uc?export=download&id=1zXYSS2YpyezHZdQPtXPdNr0uPNor\nVivP\n\nUnfortunately, both of those URLs return a 404-response code at the time of writing this report. This\nwould indicate that the threat actor has deleted the final payload, perhaps with the intent of\nconcealing the goal of the campaigns.\n\n© I t i\n\n\n-----\n\n## Ongoing Threats Targeting the Energy Industry\n\n TLP: CLEAR PAP: CLEAR\n\n\n# Conclusion\n\nThrough analysis of both recent and past campaigns using GuLoader, Intrinsec’s CTI team hopes to\nhighlight how stealthy and efficient this loader is. From Easysoft’s CloudEye humble beginnings in\nunderground forums for hackers to its use in targeted campaigns observed in this report testify to the\nsuccess of this malware.\n\n© I t i\n\n\n-----\n\n## Ongoing Threats Targeting the Energy Industry\n\n TLP: CLEAR PAP: CLEAR\n\n\n# III - Actionable content\n\n### 1. IoCs\n\nValue Type Description\n0c86253017d45f1cf09b474135ab9a603584f4c6d1d8d22b9c SHA-256 NSIS loader\nbce7be46dfb019\n\na09ed21fa6609b2868160bd39abf1628a797cc703a0d64a11 SHA-256 emneomraadedefinition.ove\n4585d0c8b9c9982\n\n50f7d8503f51e02f52c3f666ad902900b2b90809df612c96e8 SHA-256 Malicious RTF\n8cd51466416c0b\n\nec5be7c50c187de9346e381fe229eb22a3383dfd70bbac356 SHA-256 Liljans Slipstrmme.exe\n8051af0ee25016c\n\n107.172.148[.]208 IP address Hosting payload\n\n91.234.99[.]51 IP address GuLoader C2\n\n103.131.57[.]119 IP address Hosting payload\n\nIP address IP performing malspam\n188.86.117[.]83\n\n147.50.227[.]13 IP address IP performing malspam\n\nac-at[.]net Domain Hosting payload\n\nrdns.aesite[.]cz Domain GuLoader C2\n\n00gssa[.]com Domain GuLoader C2\n\n00gts[.]ru Domain GuLoader C2\n\n© I t i\n\n|Value|Type|Description|\n|---|---|---|\n|0c86253017d45f1cf09b474135ab9a603584f4c6d1d8d22b9c bce7be46dfb019|SHA-256|NSIS loader|\n|a09ed21fa6609b2868160bd39abf1628a797cc703a0d64a11 4585d0c8b9c9982|SHA-256|emneomraadedefinition.ove|\n|50f7d8503f51e02f52c3f666ad902900b2b90809df612c96e8 8cd51466416c0b|SHA-256|Malicious RTF|\n|ec5be7c50c187de9346e381fe229eb22a3383dfd70bbac356 8051af0ee25016c|SHA-256|Liljans Slipstrmme.exe|\n|107.172.148[.]208|IP address|Hosting payload|\n|91.234.99[.]51|IP address|GuLoader C2|\n|103.131.57[.]119|IP address|Hosting payload|\n|188.86.117[.]83|IP address|IP performing malspam|\n|147.50.227[.]13|IP address|IP performing malspam|\n|ac-at[.]net|Domain|Hosting payload|\n|rdns.aesite[.]cz|Domain|GuLoader C2|\n|00gssa[.]com|Domain|GuLoader C2|\n|00gts[.]ru|Domain|GuLoader C2|\n\n\n-----\n\n## Ongoing Threats Targeting the Energy Industry\n\n TLP: CLEAR PAP: CLEAR\n\n\n### 2. Recommendations\n\nGuLoader has proved to be a stealthy and highly customizable loader. The campaigns studied in this\ndocument reveal that the use of GuLoader, coupled with a smart use of spear phishing techniques, can\nprove to be very efficient for initial access and further exploitation.\n\nTo prevent your organization from being infected, Intrinsec’s CTI recommends to:\n\n**Network and Emails policy**\n\n  - Train your staff to always question the legitimacy of an email, especially if it contains\nattachments.\n\n  - Block the domains names included in the IoCs section of this report.\n\n  - Block domains associated with any GuLoader campaigns.\n\n  - Block emails sent from spoofed or not trusted domains.\n\n  - Block IP addresses included in the IoCs section of this report.\n\n  - Block IP addresses associated with any GuLoader campaigns.\n\n  - Do not upload internal emails on public platforms.\n\n**System and endpoint security**\n\n  - Prevent PowerShell execution by normal users.\n\n  - Use GuLoader’s detection rules on endpoints.\n\n  - Train your staff not to activate content on Microsoft Office documents if coming from an\nuntrusted source.\n\n### 3. Sources\n\n➢ [https://malpedia.caad.fkie.fraunhofer.de/details/win.cloudeye](https://malpedia.caad.fkie.fraunhofer.de/details/win.cloudeye)\n➢ [https://github.com/OALabs/research/blob/master/_notebooks/2022-12-16-](https://github.com/OALabs/research/blob/master/_notebooks/2022-12-16-guloader.ipynb)\n\n[guloader.ipynb](https://github.com/OALabs/research/blob/master/_notebooks/2022-12-16-guloader.ipynb)\n➢ [https://research.checkpoint.com/2020/guloader-cloudeye/](https://research.checkpoint.com/2020/guloader-cloudeye/)\n➢ [https://research.checkpoint.com/2023/cloud-based-malware-delivery-the-evolution-of-](https://research.checkpoint.com/2023/cloud-based-malware-delivery-the-evolution-of-guloader/)\n\nguloader/\n➢ [https://therecord.media/german-intelligence-warning-lng-terminals-cyberattacks](https://therecord.media/german-intelligence-warning-lng-terminals-cyberattacks)\n\n© I t i\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        }
    ],
    "references": [
        "https://www.intrinsec.com/wp-content/uploads/2023/09/TLP-CLEAR-20230912-EN-GuLoader-Information-report.pdf"
    ],
    "report_names": [
        "TLP-CLEAR-20230912-EN-GuLoader-Information-report.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1696298859,
    "ts_updated_at": 1743041168,
    "ts_creation_date": 1695997791,
    "ts_modification_date": 1695997791,
    "files": {
        "pdf": "https://archive.orkl.eu/da34eacdaec0e822479ed61664e278db5f7a1944.pdf",
        "text": "https://archive.orkl.eu/da34eacdaec0e822479ed61664e278db5f7a1944.txt",
        "img": "https://archive.orkl.eu/da34eacdaec0e822479ed61664e278db5f7a1944.jpg"
    }
}