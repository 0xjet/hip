{
    "id": "0986c205-6f31-4f1b-a2f8-05d397410ce4",
    "created_at": "2023-01-12T15:00:48.26818Z",
    "updated_at": "2025-03-27T02:17:11.38122Z",
    "deleted_at": null,
    "sha1_hash": "4315857252835f4b2d881a944cb0154abc01393a",
    "title": "2017-03-02 - Update on the Fancy Bear Android malware (poprd30.apk)",
    "authors": "",
    "file_creation_date": "2022-05-27T21:28:37Z",
    "file_modification_date": "2022-05-27T21:28:37Z",
    "file_size": 164260,
    "plain_text": "# Update on the Fancy Bear Android malware (poprd30.apk)\n\n**[blog.crysys.hu/2017/03/update-on-the-fancy-bear-android-malware-poprd30-apk/](http://blog.crysys.hu/2017/03/update-on-the-fancy-bear-android-malware-poprd30-apk/)**\n\nBy Boldizsar Bencsath March 2, 2017\n\n## About the APK:\n\nThe APK file, that was investigated by Crowd Strike and us is actually corrupt, unzipping\nyields two warnings and a CRC Error.\n\n**$ unzip 6f7523d3019fa190499f327211e01fcb.apk**\n\nArchive: 6f7523d3019fa190499f327211e01fcb.apk\n\nwarning [6f7523d3019fa190499f327211e01fcb.apk]: 1 extra byte at beginning or within zipfile\n\n(attempting to process anyway)\n\nfile #1: bad zipfile offset (local header sig): 1\n\n(attempting to re-compensate)\n\ninflating: META-INF/MANIFEST.MF\n\ninflating: META-INF/CERT.SF\n\ninflating: META-INF/CERT.RSA\n\ninflating: AndroidManifest.xml\n\ninflating: classes.dex\n\nextracting: res/drawable-hdpi/dmk.png\n\nextracting: res/drawable-hdpi/ic_launcher.png\n\nextracting: res/drawable-mdpi/fon_1.jpg\n\nextracting: res/drawable-mdpi/fon_2.png\n\nextracting: res/drawable-mdpi/fon_3.png\n\nextracting: res/drawable-mdpi/ic_action_search.png\n\nextracting: res/drawable-mdpi/ic_launcher.png\n\nextracting: res/drawable-mdpi/panel_2.gif\n\nextracting: res/drawable-mdpi/panel_4.png\n\nextracting: res/drawable-mdpi/panel_5.png\n\nextracting: res/drawable-mdpi/panel_6.png\n\nextracting: res/drawable-mdpi/panel_7.png\n\nextracting: res/drawable-mdpi/warnings.png bad CRC 73cded37 (should be 902e9cdb)\n\nfile #19: bad zipfile offset (local header sig): 660433\n\n(attempting to re-compensate)\n\nextracting: res/drawable-xhdpi/ic_launcher.png\n\nextracting: res/drawable-xxhdpi/ic_launcher.png\n\ninflating: res/layout/activity_reg_form.xml\n\ninflating: res/layout/byleten.xml\n\ninflating: res/layout/dan_dmk.xml\n\n\n-----\n\ninflating: res/layout/dan_meteo.xml\ninflating: res/layout/dan_vr_2.xml\ninflating: res/layout/meteo_podg_form.xml\ninflating: res/layout/o_avtope_form.xml\ninflating: res/layout/pomow_form.xml\ninflating: res/layout/promt.xml\nextracting: resources.arsc\n\nIn this form, it is not possible to install the APK, trying so results in the phone yielding the\nfollowing error message:\n**$ adb install 6f7523d3019fa190499f327211e01fcb.apk**\nFailed to install 6f7523d3019fa190499f327211e01fcb.apk: Failure\n\n[INSTALL_PARSE_FAILED_UNEXPECTED_EXCEPTION: Failed to parse\n/data/app/vmdl135131206.tmp/base.apk: AndroidManifest.xml]\n\nFrom the error messages we suspected, that an extra byte somehow ended up in the APK\nfile.\nThe repair process consisted of finding and removing an extra byte from the file\n“warnings.png”. By changing only this byte and getting a valid APK file, this might be the\noriginal file. After repair, we got the following file.\n**$ sha256sum REPAIRED.apk**\n5b6ea28333399a73475027328812fb42259c12bb24b6650e5def94f4104f385e\nREPAIRED.apk\n\n**$ unzip -vt REPAIRED.apk**\nArchive: REPAIRED.apk\ntesting: META-INF/MANIFEST.MF OK\ntesting: META-INF/CERT.SF OK\ntesting: META-INF/CERT.RSA OK\ntesting: AndroidManifest.xml OK\ntesting: classes.dex OK\ntesting: res/drawable-hdpi/dmk.png OK\ntesting: res/drawable-hdpi/ic_launcher.png OK\ntesting: res/drawable-mdpi/fon_1.jpg OK\ntesting: res/drawable-mdpi/fon_2.png OK\ntesting: res/drawable-mdpi/fon_3.png OK\ntesting: res/drawable-mdpi/ic_action_search.png OK\ntesting: res/drawable-mdpi/ic_launcher.png OK\ntesting: res/drawable-mdpi/panel_2.gif OK\ntesting: res/drawable-mdpi/panel_4.png OK\ntesting: res/drawable-mdpi/panel_5.png OK\ntesting: res/drawable-mdpi/panel_6.png OK\ntesting: res/drawable-mdpi/panel_7.png OK\n\n\n-----\n\ntesting: res/drawable-mdpi/warnings.png OK\ntesting: res/drawable-xhdpi/ic_launcher.png OK\ntesting: res/drawable-xxhdpi/ic_launcher.png OK\ntesting: res/layout/activity_reg_form.xml OK\ntesting: res/layout/byleten.xml OK\ntesting: res/layout/dan_dmk.xml OK\ntesting: res/layout/dan_meteo.xml OK\ntesting: res/layout/dan_vr_2.xml OK\ntesting: res/layout/meteo_podg_form.xml OK\ntesting: res/layout/o_avtope_form.xml OK\ntesting: res/layout/pomow_form.xml OK\ntesting: res/layout/promt.xml OK\ntesting: resources.arsc OK\nNo errors detected in compressed data of REPAIRED.apk.\n\n**$ jarsigner -verbose -verify REPAIRED.apk**\n\ns 2215 Thu Feb 28 18:33:46 CET 2008 META-INF/MANIFEST.MF\n2268 Thu Feb 28 18:33:46 CET 2008 META-INF/CERT.SF\n1714 Thu Feb 28 18:33:46 CET 2008 META-INF/CERT.RSA\nsm 6108 Thu Feb 28 18:33:46 CET 2008 AndroidManifest.xml\nsm 543000 Thu Feb 28 18:33:46 CET 2008 classes.dex\nsm 7047 Thu Feb 28 18:33:46 CET 2008 res/drawable-hdpi/dmk.png\nsm 1703 Thu Feb 28 18:33:46 CET 2008 res/drawable-hdpi/ic_launcher.png\nsm 68364 Thu Feb 28 18:33:46 CET 2008 res/drawable-mdpi/fon_1.jpg\nsm 153893 Thu Feb 28 18:33:46 CET 2008 res/drawable-mdpi/fon_2.png\nsm 182654 Thu Feb 28 18:33:46 CET 2008 res/drawable-mdpi/fon_3.png\nsm 311 Thu Feb 28 18:33:46 CET 2008 res/drawable-mdpi/ic_action_search.png\nsm 1853 Thu Feb 28 18:33:46 CET 2008 res/drawable-mdpi/ic_launcher.png\nsm 2241 Thu Feb 28 18:33:46 CET 2008 res/drawable-mdpi/panel_2.gif\nsm 4420 Thu Feb 28 18:33:46 CET 2008 res/drawable-mdpi/panel_4.png\nsm 450 Thu Feb 28 18:33:46 CET 2008 res/drawable-mdpi/panel_5.png\nsm 1448 Thu Feb 28 18:33:46 CET 2008 res/drawable-mdpi/panel_6.png\nsm 551 Thu Feb 28 18:33:46 CET 2008 res/drawable-mdpi/panel_7.png\nsm 25089 Thu Feb 28 18:33:46 CET 2008 res/drawable-mdpi/warnings.png\nsm 2545 Thu Feb 28 18:33:46 CET 2008 res/drawable-xhdpi/ic_launcher.png\nsm 4845 Thu Feb 28 18:33:46 CET 2008 res/drawable-xxhdpi/ic_launcher.png\nsm 4356 Thu Feb 28 18:33:46 CET 2008 res/layout/activity_reg_form.xml\nsm 20332 Thu Feb 28 18:33:46 CET 2008 res/layout/byleten.xml\nsm 10584 Thu Feb 28 18:33:46 CET 2008 res/layout/dan_dmk.xml\nsm 20852 Thu Feb 28 18:33:46 CET 2008 res/layout/dan_meteo.xml\nsm 10208 Thu Feb 28 18:33:46 CET 2008 res/layout/dan_vr_2.xml\nsm 2772 Thu Feb 28 18:33:46 CET 2008 res/layout/meteo_podg_form.xml\n\n\n-----\n\nsm 2076 Thu Feb 28 18:33:46 CET 2008 res/layout/o_avtope_form.xml\nsm 2944 Thu Feb 28 18:33:46 CET 2008 res/layout/pomow_form.xml\nsm 952 Thu Feb 28 18:33:46 CET 2008 res/layout/promt.xml\nsm 13296 Thu Feb 28 18:33:46 CET 2008 resources.arsc\n\ns = signature was verified\nm = entry is listed in manifest\nk = at least one certificate was found in keystore\ni = at least one certificate was found in identity scope\n\nSigned by “EMAILADDRESS=android@android.com, CN=Android, OU=Android,\nO=Android, L=Mountain View, ST=California, C=US”\nDigest algorithm: SHA1\nSignature algorithm: SHA1withRSA, 2048-bit key\n\njar verified.\n\nWarning:\nThis jar contains entries whose certificate chain is not validated.\nThis jar contains signatures that does not include a timestamp. Without a timestamp, users\nmay not be able to validate this jar after the signer certificate’s expiration date (2035-07-17)\nor after any future revocation date.\n\nRe-run with the -verbose and -certs options for more details.\n\n**About the RC4/encryption key:**\n\nBy decompiling and manually “refactoring” the encryption algorithm, we discovered a\n[“textbook” RC4 implementation as the encryption routine, which uses the hard-coded key as](https://en.wikipedia.org/wiki/RC4#Key-scheduling_algorithm_.28KSA.29)\na first-part to the encryption key, with the second-part coming as a parameter from the\nfunction call:\n\nAnalyzing the XAgent linux sample, which also contained this RC4 key, we did not found an\nRC4 implementation, but a simple XOR based encryption routine:\n\n\n-----\n\nWe found one function call, which used the encryption key from the APK as input, but\nsurprisingly, it was not used as key parameter, but input parameter.\n\nFor checking HTTP GET and POST messages a different XOR based check routine can be\nfound, and a Base64-like encoding. After decoding, the XOR based routine checks the http\nresult’s body. It xors the 4-11 bytes with the first 4 bytes as a key. It then should be equal to a\nhardcoded value (7 bytes) which the sample uses to check whether the recv succeeded or\nnot.\n\nThese XAgent linux samples are very similar to a Windows version that has been found\nin november, 2013\n(5f6b2a0d1d966fc4f1ed292b46240767f4acb06c13512b0061b434ae2a692fa1).\n\n\n-----\n\nRecommended yara for the linux versions:\n```\nrule sofacy_xagent {\nmeta:\nauthor = \"AKG\"\ndescription = \"Sofacy - XAgent\"\nstrings:\n$service = \"ksysdefd\"\n$x1 = \"AgentKernel\"\n$x2 = \"Cryptor\"\n$x3 = \"AgentModule\"\n$x4 = \"ChannelController\"\n$x5 = \"RemoteKeylogger\"\n$a1 = \"UNCORRECT DISPLAY NAME\"\n$a2 = \"Keylogger started\"\n$a3 = \"Keylog thread exit\"\n$a4 = \"Keylogger yet started\"\ncondition:\n$service or (2 of ($x)) or (2 of ($a))\n}\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-03-02 - Update on the Fancy Bear Android malware (poprd30.apk).pdf"
    ],
    "report_names": [
        "2017-03-02 - Update on the Fancy Bear Android malware (poprd30.apk).pdf"
    ],
    "threat_actors": [
        {
            "id": "e3767160-695d-4360-8b2e-d5274db3f7cd",
            "created_at": "2022-10-25T16:47:55.914348Z",
            "updated_at": "2025-03-27T02:05:17.411172Z",
            "deleted_at": null,
            "main_name": "IRON TWILIGHT",
            "aliases": [
                "ATK5 ",
                "Blue Athena ",
                "BlueDelta ",
                "FROZENLAKE ",
                "Fancy Bear ",
                "Fighting Ursa ",
                "Forest Blizzard ",
                "GRAPHITE ",
                "Group 74 ",
                "PawnStorm ",
                "STRONTIUM ",
                "Sednit ",
                "Snakemackerel ",
                "Sofacy ",
                "TG-4127 ",
                "Tsar Team ",
                "APT28 "
            ],
            "source_name": "Secureworks:IRON TWILIGHT",
            "tools": [
                " Downdelph",
                " Drovorub",
                " EVILTOSS",
                " HIDEDRV",
                " Headlace",
                " LoJack",
                " Powershell Empire",
                " SCONATO",
                " SEDUPLOADER",
                " SHARPFRONT",
                " Scaramouche",
                " Sedkit Exploit Kit",
                " Sofacy downloader",
                " X-Agent",
                " X-Tunnel",
                " Zebrocy",
                " reGeorg",
                "DEALERSCHOICE"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "730dfa6e-572d-473c-9267-ea1597d1a42b",
            "created_at": "2023-01-06T13:46:38.389985Z",
            "updated_at": "2025-03-27T02:00:02.821388Z",
            "deleted_at": null,
            "main_name": "APT28",
            "aliases": [
                "FROZENLAKE",
                "BlueDelta",
                "SNAKEMACKEREL",
                "TG-4127",
                "ITG05",
                "TA422",
                "Fancy Bear",
                "FANCY BEAR",
                "Sednit",
                "IRON TWILIGHT",
                "G0007",
                "Sofacy",
                "Forest Blizzard",
                "GruesomeLarch",
                "Pawn Storm",
                "Tsar Team",
                "STRONTIUM",
                "ATK5",
                "Blue Athena",
                "APT-C-20",
                "Group 74",
                "SIG40",
                "Grizzly Steppe",
                "Fighting Ursa",
                "T-APT-12",
                "UAC-0028"
            ],
            "source_name": "MISPGALAXY:APT28",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "ae320ed7-9a63-42ed-944b-44ada7313495",
            "created_at": "2022-10-25T15:50:23.671663Z",
            "updated_at": "2025-03-27T02:00:55.518748Z",
            "deleted_at": null,
            "main_name": "APT28",
            "aliases": [
                "APT28",
                "IRON TWILIGHT",
                "SNAKEMACKEREL",
                "Group 74",
                "Sednit",
                "Sofacy",
                "Pawn Storm",
                "Fancy Bear",
                "STRONTIUM",
                "Tsar Team",
                "Threat Group-4127",
                "TG-4127",
                "Forest Blizzard",
                "FROZENLAKE"
            ],
            "source_name": "MITRE:APT28",
            "tools": [
                "Wevtutil",
                "certutil",
                "Forfiles",
                "DealersChoice",
                "Mimikatz",
                "ADVSTORESHELL",
                "Komplex",
                "HIDEDRV",
                "JHUHUGIT",
                "Koadic",
                "Winexe",
                "XTunnel",
                "Drovorub",
                "CORESHELL",
                "OLDBAIT",
                "Downdelph",
                "XAgentOSX",
                "USBStealer",
                "Zebrocy",
                "Fysbis",
                "LoJax"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "d2516b8e-e74f-490d-8a15-43ad6763c7ab",
            "created_at": "2022-10-25T16:07:24.212584Z",
            "updated_at": "2025-03-27T02:02:10.141001Z",
            "deleted_at": null,
            "main_name": "Sofacy",
            "aliases": [
                "APT 28",
                "ATK 5",
                "Blue Athena",
                "BlueDelta",
                "FROZENLAKE",
                "Fancy Bear",
                "Fighting Ursa",
                "Forest Blizzard",
                "Grey-Cloud",
                "Grizzly Steppe",
                "Group 74",
                "GruesomeLarch",
                "ITG05",
                "Iron Twilight",
                "Operation DealersChoice",
                "Operation Dear Joohn",
                "Operation Komplex",
                "Operation Pawn Storm",
                "Operation Russian Doll",
                "Operation Steal-It",
                "Pawn Storm",
                "SIG40",
                "Sednit",
                "Snakemackerel",
                "Sofacy",
                "Strontium",
                "T-APT-12",
                "TA422",
                "TAG-0700",
                "TAG-110",
                "TG-4127",
                "Tsar Team",
                "UAC-0028",
                "UAC-0063"
            ],
            "source_name": "ETDA:Sofacy",
            "tools": [
                "ADVSTORESHELL",
                "AZZY",
                "Backdoor.SofacyX",
                "CHERRYSPY",
                "CORESHELL",
                "Carberp",
                "Computrace",
                "DealersChoice",
                "Delphacy",
                "Downdelph",
                "Downrage",
                "Drovorub",
                "EVILTOSS",
                "Foozer",
                "GAMEFISH",
                "GooseEgg",
                "Graphite",
                "HATVIBE",
                "HIDEDRV",
                "Headlace",
                "Impacket",
                "JHUHUGIT",
                "JKEYSKW",
                "Koadic",
                "Komplex",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "LoJack",
                "LoJax",
                "MASEPIE",
                "Mimikatz",
                "NETUI",
                "Nimcy",
                "OCEANMAP",
                "OLDBAIT",
                "PocoDown",
                "PocoDownloader",
                "Popr-d30",
                "ProcDump",
                "PythocyDbg",
                "SMBExec",
                "SOURFACE",
                "SPLM",
                "STEELHOOK",
                "Sasfis",
                "Sedkit",
                "Sednit",
                "Sedreco",
                "Seduploader",
                "Shunnael",
                "SkinnyBoy",
                "Sofacy",
                "SofacyCarberp",
                "SpiderLabs Responder",
                "Trojan.Shunnael",
                "Trojan.Sofacy",
                "USB Stealer",
                "USBStealer",
                "VPNFilter",
                "Win32/USBStealer",
                "WinIDS",
                "Winexe",
                "X-Agent",
                "X-Tunnel",
                "XAPS",
                "XTunnel",
                "Xagent",
                "Zebrocy",
                "Zekapab",
                "carberplike",
                "certutil",
                "certutil.exe",
                "fysbis",
                "webhp"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535648,
    "ts_updated_at": 1743041831,
    "ts_creation_date": 1653686917,
    "ts_modification_date": 1653686917,
    "files": {
        "pdf": "https://archive.orkl.eu/4315857252835f4b2d881a944cb0154abc01393a.pdf",
        "text": "https://archive.orkl.eu/4315857252835f4b2d881a944cb0154abc01393a.txt",
        "img": "https://archive.orkl.eu/4315857252835f4b2d881a944cb0154abc01393a.jpg"
    }
}