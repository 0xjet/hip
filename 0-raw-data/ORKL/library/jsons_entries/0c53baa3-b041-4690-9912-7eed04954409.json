{
    "id": "0c53baa3-b041-4690-9912-7eed04954409",
    "created_at": "2023-01-12T15:10:16.804232Z",
    "updated_at": "2025-03-27T02:05:55.178353Z",
    "deleted_at": null,
    "sha1_hash": "7aad16feadccac441b5eb6a936275c5925bb2766",
    "title": "2022-01-20 - Threat Thursday- Purple Fox Rootkit",
    "authors": "",
    "file_creation_date": "2022-05-28T23:20:53Z",
    "file_modification_date": "2022-05-28T23:20:53Z",
    "file_size": 1049930,
    "plain_text": "# Threat Thursday: Purple Fox Rootkit\n\n**[blogs.blackberry.com/en/2022/01/threat-thursday-purple-fox-rootkit](https://blogs.blackberry.com/en/2022/01/threat-thursday-purple-fox-rootkit)**\n\nThe BlackBerry Research & Intelligence Team\n\n### Summary\n\nPurple Fox rootkit is an active malware campaign that has been distributed using a fake malicious\nTelegram installer since early 2022. Purple Fox attempts to stay under the radar by breaking its\nattack chain down into multiple discrete stages. Each stage of the attack is carried out by a different\nfile, with each file being useless without the entire file set. While using legitimate installers is already\na popular technique, using such a popular application is certainly notable, as is breaking up the\nmalware's functionality to make analysis more difficult.\n\nThe malware’s main goal is to gain a foothold on targeted Windows® machines by loading a rootkit\nthat is planted beyond the reach of antivirus (AV) products, helping the malware remain hidden. This\nrootkit provides the attacker with a backdoor into the victim’s machine, from which further malicious\nactivity can be carried out.\n\n### Operating System\n\n\n-----\n\n### Risk & Impact\n\n Technical Analysis\n\nThe attack chain for Purple Fox begins when the victim is lured into launching a Trojanized installer\n[for the popular instant messaging application Telegram, a freeware, cross-platform, cloud-based](https://en.wikipedia.org/wiki/Telegram_(software))\nservice. The installer is an AutoIt-compiled script, which appears on desktops with the icon shown in\nFigure 1.\n\n_Figure 1 - Fake malicious installer “Telegram Desktop.exe”_\n\nWhen launched, this fake Telegram installer will create a directory called “TextInputh” within the\n“AppData/Temp” folder. The installer drops two files into this directory. One of the files is a legitimate\ncopy of Telegram.exe, which is not launched or used in the attack chain, but it is created to help the\nmalicious installer appear legitimate to the target. The other file is an executable called\n“TextInputh.exe,” as shown in Figure 2.\n\n\n-----\n\n_Figure 2 - Files dropped to Temp directory by fake installer_\n\nTextInputh.exe is the main malicious downloader. When executed, it will reach out to its commandand-control (C2) server, which at the time of writing was hosted at 193[.]164[.]223[.]77 (as shown\nbelow), to retrieve the next-stage payloads.\n\n_Figure 3 - Main downloader creating a connection with the C2_\n\nThe downloader creates a folder within the “Users/Public/Videos” directory, which is named using a\ncombination of random numbers. In the analysis carried out for this report, the folder was named\n“1642069858.” The files retrieved from the C2 server are stored in this folder.\n\nThe first file downloaded is an archive file called “1.rar.” The second file is a copy of 7Zip called\n“7zz.exe,” which is used to extract the RAR archive. The unzipped archive contains four files, as\nseen in Figure 4. Once these four files have been extracted, the initial archive and the 7Zip\napplication are both automatically deleted from the machine.\n\n_Figure 4 - Contents of “1.rar” archive retrieved from C2_\n\nTextInputh.exe also creates a copy of “360.tct,” “rundll3222.exe” and “svchost.txt” within the\n“/ProgramData” folder. The file “ojbk.exe” is used to load the file “360.tct”, as seen in Figure 5. This\nis a DLL file that is used to read and execute the payload contained within svchost.txt.\n\n\n-----\n\n_Figure 5 - File “ojbk.exe” is used to load the DLL “360.tct”_\n\nWhen svchost.txt is executed, it drops five additional files into the “/ProgramData\" folder. These files\nare named “Calldriver.exe,” “Driver.sys,” “dll.dll,” “kill360.bat,” and “speedmem2.hg.”\n\nThe DLL file “dll.dll” performs a User Account Control (UAC) bypass by modifying the value of three\nregistry keys to zero. Many malware authors use this technique to elevate process privileges on a\nsystem. The registry keys in question are as follows:\n\nHKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\nConsentPromptBehaviorAdmin\nHKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\EnableLUA\nHKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\PromptOnSecureDesktop\n\nThe five dropped files work together, with the goal of disabling and blocking antivirus programs, in\nparticular the security solution “360 AV,” a free antivirus and system optimization utility. This evasion\ntechnique is done prior to the deployment of the final Purple Fox payload, to allow the rootkit to be\nplanted and launched without being detected.\n\nThe file “kill360.bat” is a script that is used to prevent 360 AV processes from running. Within this\nscript, the names of the four other files that help achieve this can be seen.\n\nThis BAT script is used to place a copy of the SQL file “speedmem2.hg” into the 360 AV directory.\nOnce the files have been executed, the script deletes them from the “/ProgramData” directory in a\nbid to clean up after itself and remain undetected on the target machine.\n\n\n-----\n\n_Figure 6 - Functionality of ”kill360.bat”_\n\nThe Purple Fox malware continues the attack chain by performing a check on the infected machine\nfor the presence of a pre-set list of antivirus products. This list includes vendors such as TrendMicro,\nKaspersky and McAfee.\n\nThe malware will also perform a scan of the victim’s machine to gather a range of information,\nincluding the hostname, CPU type, driver type and memory status. This information is then\nexfiltrated to the C2 server, which in this instance is hosted at 144[.]48[.]243[.]79.\n\nAt the time of our investigation, this C2 server was no longer online, and as a result, the last stage of\nthe attack that retrieves the rootkit could not be replicated directly. However, for analysis purposes, a\ncopy of the payload from the above C2 address that contains the rootkit has been retrieved from\nVirusTotal.\n\n\n-----\n\n_Figure 7 - MSI file which contains kernel payload_\n\nThe payload is an MSI file which contains encrypted shellcode. When launched, it displays an\ninstallation screen and prompts the victim to give a “yes” or “no” response, as shown in Figure 7.\n\nOnce the victim has approved the prompt, the system performs a restart. This allows for registry key\nchanges, including the UAC bypass, to take effect and it allows the rootkit to be deployed at the\nkernel level without disruption.\n\n### Conclusion\n\nMalware bundling itself with legitimate installers to gain access to a victim’s machine is not new to\n[world of cybersecurity. Indeed, the threat our team covered last week, Jupyter infostealer, also uses](https://blogs.blackberry.com/en/2022/01/threat-thursday-jupyter-infostealer-is-a-master-of-disguise)\nthis highly effective technique. However, the manner in which Purple Fox goes about this malicious\nactivity brings a new level of creativity to the way these intrusions are performed.\n\nThe multistage attack chain used by the latest version of Purple Fox is a devious addition, which will\naid the attacker in remaining undetected by security solutions. This innovative approach to evasion\nand disguise makes it easier for Purple Fox to deliver and deploy its final rootkit payload to the\ntarget machine. From here, the possibilities for further malicious activity are practically endless.\n\n### YARA Rule\n\nThe following YARA rule was authored by the BlackBerry Research & Intelligence Team to catch the\nthreat described in this document:\n\n\n-----\n\nimport \"pe\"\n\nrule Purple_Fox {\n\nmeta:\ndescription = \"Detects Purple Fox Rootkit\"\n\nauthor = \"BlackBerry Threat Research Team\"\n\ndate = \"2022-01-10\"\n\nlicense = \"This Yara rule is provided under the Apache License 2.0\n(https://www.apache.org/licenses/LICENSE-2.0) and open to any user or organization, as long as\nyou use it under this license and ensure originator credit in any derivative to The BlackBerry\nResearch & Intelligence Team\"\n\nstrings:\n\n$s1 = \"C:\\\\Users\\\\Public\\\\Videos\\\\%d\"\n\n$s2 = \"\\\\1.rar\"\n\n$s3 = \"\\\\7zz.exe\"\n\n$s4 = \"\\\\rundll3222.exe\"\n\n$s5 = \"\\\\ojbk.exe\"\n\n$s6 = \"http://193.164.223.77:7456/77\"\n\n$s7 = \"\\\\360.tct\"\n\n$s8 = \"C:\\\\ProgramData\\\\360.dll\"\n\n$s9 = \"\\\\svchost.txt\"\n\ncondition:\n\n(\n\n//PE File\n\nuint16(0) == 0x5a4d and\n\n// PE Sections\n\npe.number_of_sections == 5 and\n\n//All Strings\n\nall of ($s*) )\n\n}\n\n### Indicators of Compromise (IoCs)\n\n\n-----\n\n**C2 Servers**\n\n193[.]164[.]223[.]77\n144[.]48[.]243[.]79\n\n**File Names**\n\nTelegram Desktop.exe\nTextInputh.exe\n1.rar\nrundll3222.exe\nsvchost.txt\n360.tct\nKill360.bat\nspeedmem2.hg\ndll.dll\nDriver.sys\nCalldriver.exe\n\n**Registry Key**\n\nHKEY_LOCAL_MACHINE\\SYSTEM\\Select\\MarkTime\n\n### BlackBerry Assistance\n\nIf you’re battling this malware or a similar threat, you’ve come to the right place, regardless of your\nexisting BlackBerry relationship.\n\n[The BlackBerry Incident Response team is made up of world-class consultants dedicated to](https://www.blackberry.com/us/en/services/incident-response)\nhandling response and containment services for a wide range of incidents, including ransomware\nand Advanced Persistent Threat (APT) cases.\n\nWe have a global team standing by to assist you with around-the-clock support, where required, as\nwell as local assistance. Please contact us\nhere: https://www.blackberry.com/us/en/forms/cylance/handraiser/emergency-incident-responsecontainment\n\n\n-----\n\n## About The BlackBerry Research & Intelligence Team\n\nThe BlackBerry Research & Intelligence team examines emerging and persistent threats, providing\nintelligence analysis for the benefit of defenders and the organizations they serve.\n\nBack\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-01-20 - Threat Thursday- Purple Fox Rootkit.pdf"
    ],
    "report_names": [
        "2022-01-20 - Threat Thursday- Purple Fox Rootkit.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536216,
    "ts_updated_at": 1743041155,
    "ts_creation_date": 1653780053,
    "ts_modification_date": 1653780053,
    "files": {
        "pdf": "https://archive.orkl.eu/7aad16feadccac441b5eb6a936275c5925bb2766.pdf",
        "text": "https://archive.orkl.eu/7aad16feadccac441b5eb6a936275c5925bb2766.txt",
        "img": "https://archive.orkl.eu/7aad16feadccac441b5eb6a936275c5925bb2766.jpg"
    }
}