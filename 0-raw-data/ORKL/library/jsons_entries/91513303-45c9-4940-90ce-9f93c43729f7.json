{
    "id": "91513303-45c9-4940-90ce-9f93c43729f7",
    "created_at": "2023-01-12T15:06:36.005095Z",
    "updated_at": "2025-03-27T02:05:33.729912Z",
    "deleted_at": null,
    "sha1_hash": "c2e579e8799aea42d1efd6e2b08e9b2d209bb2ca",
    "title": "2016-04-21 - When entropy meets Shannon",
    "authors": "",
    "file_creation_date": "2022-05-28T19:48:08Z",
    "file_modification_date": "2022-05-28T19:48:08Z",
    "file_size": 417528,
    "plain_text": "# When entropy meets Shannon\n\n**[splunk.com/en_us/blog/tips-and-tricks/when-entropy-meets-shannon.html](https://www.splunk.com/en_us/blog/tips-and-tricks/when-entropy-meets-shannon.html)**\n\nApril 21, 2016\n\nBy [Splunk April 21, 2016](https://www.splunk.com/en_us/blog/author/admin.html)\n\nThis is the third post on URL analysis, please have a look at the two other posts for more\ncontext about what can be done with Splunk to analyze URLs:\n\n[Splunking 1 million URLs](http://blogs.splunk.com/2016/03/22/splunking-1-million-urls/)\n[Hunting that evil typosquatter](http://blogs.splunk.com/2016/04/01/hunting-that-evil-typosquatter/)\n\nYou will find in this article information on how one can detect DNS tunnels. While you can\nfind [lots of very useful apps on Splunkbase to help you analyze DNS data, it is always good](https://splunkbase.splunk.com/apps/#/page/1/search/dns/order/relevance)\nfor curious individuals to discover some techniques being used underneath.\n\nA lot of captive portals are bypassed everyday by anyone able to run a DNS request, if\nsomeone can run on their machine the following command:\n```\n $ host splunk.com\n splunk.com has address 54.69.58.243\n ...\n\n```\nWithout being authenticated on the captive portal, then they can use any service on the\n[internet using a DNS tunnel. There are a lot](https://github.com/iagox86/dnscat2) [of](http://wiki.kartbuilding.net/index.php/Dnstunnel) [tools](http://code.kryo.se/iodine/) [out](https://www2.deloitte.com/fr/fr/pages/risque-compliance-et-controle-interne/articles/cyber-academy.html/ressources/outils/dns2tcp/.html) [there to create those tunnels. And](https://github.com/FedericoCeratto/dnscapy)\n[for a great paper on the topic, I encourage you to read the Detecting DNS Tunneling from](https://www.sans.org/reading-room/whitepapers/dns/detecting-dns-tunneling-34152)\n\n\n-----\n\nSANS Institute.\n\n## Claude Shannon to the rescue!\n\nLong time\nago, the\nvenerable\nClaude E.\nShannon\nwrote the\npaper “A\nMathematic\n[al Theory of](http://math.harvard.edu/~ctm/home/text/others/shannon/entropy/entropy.pdf)\nCommunicat\nion“, which I\nstrongly\nencourage\nto read for\nits clarity\n\nClaude Shannon\n\nand\n\nBy Jacobs, Konrad - [https://opc.mfo.de/detail?photo_id=3807,](https://opc.mfo.de/detail?photo_id=3807) [CC BY-SA 2.0 de,](https://creativecommons.org/licenses/by-sa/2.0/de/deed.en) [Link](https://commons.wikimedia.org/w/index.php?curid=45380422)\n\namazing\nsource of\ninformation.\n\n\n[He invented a great algorithm known as the Shannon Entropy which is useful to discover](https://en.wikipedia.org/wiki/Entropy_(information_theory))\nthe statistical structure of a word or message.\n\nIf you consider a word, being a discrete source of the finite number of characters type which\ncan be considered, for each possible character there will be a set of probabilities which\nwould produce various outputs. There will be an entropy for each character. This entropy on\nthe chosen word is defined as the average of the output weighted on the probability of\noccurrence of the characters.\n\nThe previous paragraph can easily be translated into the following Python code (taken from\nthe excellent URL Toolbox on Splunkbase:\n```\ndef shannon(word):\n  entropy = 0.0\n  length = len(word)\n\n```\n\n-----\n\n```\n  occ {}\n  for c in word :\n    if not c in occ:\n      occ[ c ] = 0\n    occ += 1\n  for (k,v) in occ.iteritems():\n    p = float( v ) / float(length)\n    entropy -= p * math.log(p, 2) # Log base 2\n  return entropy\n\n```\nWhich can be run directly from any word you can have in Splunk:\n\nAs you can see, the score is pretty high, which makes sense since there is a high variety of\nfrequency over those data. If we click on the ut_shannon field to sort in reverse order, this is\nwhat you could get:\n\n\n-----\n\nAs one can see, words of low characters distribution get a low score.\n\n## Catching DNS tunnels from subdomains in URLs\n```\nIf we run the following query, interesting results are shown:\nsourcetype=\"isc:bind:query\" | eval list=\"mozilla\" | `ut_parse(query, list)` |\n`ut_shannon(ut_subdomain)` | table ut_shannon, query | sort ut_shannon desc\n\n```\n\n-----\n\nAs you can see in the results here, the high score come from tunnels made to the domain\nip-dns.info as well as something which is unknown but could also be a tunnel: traffic\ntowards greencompute.org\n\nI hope this post helps you to see tools and methodologies one can use to find out unusual\nactivity strictly based on the DNS traffic. More to come…\n\n---------------------------------------------------Thanks!\nSebastien Tricaud\n\nPosted by\n\n**[Splunk](https://www.splunk.com/en_us/blog/author/admin.html)**\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2016/2016-04-21 - When entropy meets Shannon.pdf"
    ],
    "report_names": [
        "2016-04-21 - When entropy meets Shannon.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535996,
    "ts_updated_at": 1743041133,
    "ts_creation_date": 1653767288,
    "ts_modification_date": 1653767288,
    "files": {
        "pdf": "https://archive.orkl.eu/c2e579e8799aea42d1efd6e2b08e9b2d209bb2ca.pdf",
        "text": "https://archive.orkl.eu/c2e579e8799aea42d1efd6e2b08e9b2d209bb2ca.txt",
        "img": "https://archive.orkl.eu/c2e579e8799aea42d1efd6e2b08e9b2d209bb2ca.jpg"
    }
}