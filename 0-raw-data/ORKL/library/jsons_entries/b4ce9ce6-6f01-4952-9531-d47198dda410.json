{
    "id": "b4ce9ce6-6f01-4952-9531-d47198dda410",
    "created_at": "2023-01-12T15:00:33.250538Z",
    "updated_at": "2025-03-27T02:05:55.248769Z",
    "deleted_at": null,
    "sha1_hash": "b8ce90a5687e8f98dcd6967b5de2e014b4be37c7",
    "title": "2016-08-04 - What is Multigrain- Learn what makes this PoS malware different",
    "authors": "",
    "file_creation_date": "2022-05-28T19:17:12Z",
    "file_modification_date": "2022-05-28T19:17:12Z",
    "file_size": 570505,
    "plain_text": "# What is Multigrain? Learn what makes this PoS malware different.\n\n**[pandasecurity.com/mediacenter/malware/multigrain-malware-pos/](https://www.pandasecurity.com/mediacenter/malware/multigrain-malware-pos/)**\n\nAugust 4, 2016\n\n**Multigrain is a Point of Sale (PoS) malware that specializes in stealing credit and debit**\ncard information while using RAM-Scraping techniques (it directly accesses the RAM\nmemory from certain processes to obtain the information from the cards). This has become a\npopular method as international laws prohibit this information from being stored on the disk\n(not even temporarily).\n\nAnother characteristic of Multigrain is that it uses DNS petitions in order to communicate with\nthe outside (and so it can send the stolen information). In this article we will analyze the\nmalware itself as well as the way the malware communicates.\n\nIn April of this year, FireEye [published an analysis of this malware and it looks like this is the](https://www.fireeye.com/blog/threat-research/2016/04/multigrain_pointo.html)\nfirst time they found a variant of Multigrain. In this article, the analysis pertains to a sample\nthat we detected in November 2015 (MD5 A0973ADAF99975C1EB12CC1E333D302F), and\nsince then we have been able to detect new variants or updates of this malware, but\nessentially they work in the same way.\n\n\n-----\n\n### Multigrain in detail: a technical analysis\n\nWe first started analyzing Multigrain because the analyzed code showed RAM-Scraping\ncharacteristics that are typical in PoS malware. We can clearly assess this in the 00405A10\nroutine shown below.\n\nWithin this\nroutine we\nfind\nourselves\nwith the\ntypical calls\nfrom a\nprocess that\nperforms\nRAMScraping on\nthe memory\nof running\nprocesses:\n\n**CreateToolhelp32Snapshot to get a pointer of the process list**\n\n**Process32FirstW and Process32NextW to get a snapshot of the process list after calling**\nthe previous API.\n\n**OpenProcess is used afterwards to get a list of memory pages with VirtualQueryEx.**\n\n\n-----\n\nFinally, with ReadProcessMemory, you are able to read the content from the previous\npages.\n\nOnce the buffer is obtained using the content from each page, it will perform the\nappropriately-named scraping. To do so it uses (in this same routine) the second\npseudocode:\n\nIf possible TRACKS1/2 sequences are detected, corresponding with the code from the credit\ncard magnetic strip in the buffers from the analyzed memory, it will proceed to call the\nfunctions sub_406100 and sub_405D10. The malware is now ready to prepare the data so it\ncan be exfiltrated later.\n\nThis PoS malware is only interested in two processes, respectively named “spcwin.exe” and\n“brain.exe”; if neither of them are detected, “scraping” will not be performed.\n\n\n-----\n\n### Data Exfiltration\n\nThe exfiltration performs during DNS petitions (UDP, port 53) from the routine 00402C40, as\nshown in the following pseudocode:\n\nApparently, the information leaked by DNS is performed in three different points (two\nroutines) from the program:\n\n\n-----\n\nIn the first\nroutine\n(address\n00401DA0),\nit uses the\n“install.”\nsubdomain\nfor the\nexfiltrated\ninformation.\nIn the\nsecond\nroutine (address 00402580) it uses the “log.” subdomain for the exfiltrated information.\n\nIn these exfiltration routines, we find different references to the functions that code the\ninformation using “base32”. This is due to the fact that in order to exfiltrate the bank card\ninformation, it is first encoded using “base32” and it later performs DNS requests with the\nformat: install.<base32_CCs>.domain\n\n### Network Information\n\nApparently, the domain for the sample is: dojfgj.com\n\nWhois Information:\n\nDomain Name: DOJFGJ.COM\n\nRegistry Domain ID: 1979271903_DOMAIN_COM-VRSN\n\nRegistrar WHOIS Server: whois.enom.com\n\nRegistrar URL: www.enom.com\n\nUpdated Date: 2015-11-13T07:16:58.00Z\n\nCreation Date: 2015-11-13T15:16:00.00Z\n\nRegistrar Registration Expiration Date: 2016-11-13T15:16:00.00Z\n\nRegistrar: ENOM, INC.\n\nRegistrar IANA ID: 48\n\nReseller: NAMECHEAP.COM\n\nDomain Status: ok https://www.icann.org/epp#ok\n\n\n-----\n\nRegistry Registrant ID:\n\nRegistrant Name: WHOISGUARD PROTECTED\n\nRegistrant Organization: WHOISGUARD, INC.\n\nRegistrant Street: P.O. BOX 0823-03411\n\nRegistrant City: PANAMA\n\nRegistrant State/Province: PANAMA\n\nRegistrant Postal Code: 00000\n\nRegistrant Country: PA\n\nRegistrant Phone: +507.8365503\n\nRegistrant Phone Ext:\n\nRegistrant Fax: +51.17057182\n\nRegistrant Fax Ext:\n\nRegistrant Email:\nCC7F8D40E4FA4188AE5EA89A35925E6B.PROTECT@WHOISGUARD.COM\n\nRegistry Admin ID:\n\nAdmin Name: WHOISGUARD PROTECTED\n\nAdmin Organization: WHOISGUARD, INC.\n\nAdmin Street: P.O. BOX 0823-03411\n\nAdmin City: PANAMA\n\nAdmin State/Province: PANAMA\n\nAdmin Postal Code: 00000\n\nAdmin Country: PA\n\nAdmin Phone: +507.8365503\n\nAdmin Phone Ext:\n\nAdmin Fax: +51.17057182\n\n\n-----\n\nAdmin Fax Ext:\n\nAdmin Email:\nCC7F8D40E4FA4188AE5EA89A35925E6B.PROTECT@WHOISGUARD.COM\n\nRegistry Tech ID:\n\nTech Name: WHOISGUARD PROTECTED\n\nTech Organization: WHOISGUARD, INC.\n\nTech Street: P.O. BOX 0823-03411\n\nTech City: PANAMA\n\nTech State/Province: PANAMA\n\nTech Postal Code: 00000\n\nTech Country: PA\n\nTech Phone: +507.8365503\n\nTech Phone Ext:\n\nTech Fax: +51.17057182\n\nTech Fax Ext:\n\nTech Email: CC7F8D40E4FA4188AE5EA89A35925E6B.PROTECT@WHOISGUARD.COM\n\nName Server: NS1.DOJFGJ.COM\n\nName Server: NS2.DOJFGJ.COM\n\nIf we sort out this domain, we can see that it moves to the internal IP address “192.168.0.3”.\nThe domain is associated with two DNS servers, that in principle resolve eachother. To\nobtain their actual addresses we should do a “whois”:\n\n$ whois ns2.dojfgj.com\n\nServer Name: NS1.DOJFGJ.COM\n\nIP Address: 104.156.246.159\n\n**A “traceroute” of this IP shows us its origin:**\n\n$ traceroute 104.156.246.159\n\n\n-----\n\ntraceroute to 104.156.246.159 (104.156.246.159), 30 hops max, 60 byte packets\n\n1 104.131.0.253 (104.131.0.253) 0.423 ms 104.131.0.254 (104.131.0.254) 0.404 ms 0.437\nms\n\n2 162.243.188.229 (162.243.188.229) 0.422 ms 0.394 ms 162.243.188.241\n(162.243.188.241) 0.293 ms\n\n3 xe-0-9-0-17.r08.nycmny01.us.bb.gin.ntt.net (129.250.204.113) 3.503 ms 4.078 ms 4.102\nms\n\n4 ae-2.r25.nycmny01.us.bb.gin.ntt.net (129.250.3.97) 1.160 ms ae3.r25.nycmny01.us.bb.gin.ntt.net (129.250.6.208) 1.226 ms 1.171 ms\n\n5 ae-9.r22.asbnva02.us.bb.gin.ntt.net (129.250.2.149) 6.985 ms 6.926 ms 7.013 ms\n\n6 ae-0.r23.asbnva02.us.bb.gin.ntt.net (129.250.3.85) 6.952 ms 7.091 ms 7.057 ms\n\n7 ae-1.r20.miamfl02.us.bb.gin.ntt.net (129.250.2.87) 42.672 ms 33.314 ms 33.257 ms\n\n8 ae-1.r05.miamfl02.us.bb.gin.ntt.net (129.250.2.185) 35.530 ms 35.327 ms 38.280 ms\n\n9 xe-0-6-0-0.r05.miamfl02.us.ce.gin.ntt.net (129.250.207.174) 32.063 ms 31.912 ms 31.755\nms\n\n10 * * *\n\n**11 104.156.246.159.vultr.com (104.156.246.159) 33.398 ms 31.757 ms 32.283 ms**\n\n**As we can see, it corresponds to an ISP in Miami that manages a multitude of IP**\n**addresses:**\n\nNetRange:    104.156.244.0 – 104.156.247.255\n\nCIDR:        104.156.244.0/22\n\nNetName:    NET-104-156-244-0-22\n\nNetHandle:   NET-104-156-244-0-1\n\nParent:       CHOOPA (NET-104-156-224-0-1)\n\nNetType:     Reassigned\n\nOriginAS:\n\nOrganization:  Vultr Holdings, LLC (VHL-57)\n\n\n-----\n\n### Persistence\n\nTo stay persistent in the system (Windows PoS) the analyzed malware installs itself\nautomatically as a service and chooses the name “Windows Module Extension”, as can be\nseen in the following screenshot (routine 00406C20):\n\nThe attacker can perform exclusions at the time it registers itself as a service, now that it\nalready consulted the current region using “ipinfo.io” and depending on the response, the\nsystem may or may not register as a service. This is especially useful if the attacker wants to\navoid attacking PoS systems in certain countries, for example.\n\nThe malware accepts “i” as parameter (from “install”), and in that case it will install the\n“scraping” process and send the stolen information.\n\nIf this parameter is not specified (“i”), in the case it doesn’t find the “spcwin.exe” or\n“brain.exe” processes running, it will not install the service, and additionally the malware will\nbe automatically eliminated. Both processes pertain to PoS software.\n\n\n-----\n\n**[Panda Security](https://www.pandasecurity.com/en/mediacenter/author/panda-security/)**\n\nPanda Security specializes in the development of endpoint security products and is part of\nthe WatchGuard portfolio of IT security solutions. Initially focused on the development of\nantivirus software, the company has since expanded its line of business to advanced cybersecurity services with technology for preventing cyber-crime.\n\n### You May also Like\n\n\n-----\n\n[View Post](https://www.pandasecurity.com/en/mediacenter/panda-security/panda-security-rewards-beta-tester-year-e600/)\n\n2\n\n**[Panda Security rewards Beta Tester of the Year with up to €600](https://www.pandasecurity.com/en/mediacenter/panda-security/panda-security-rewards-beta-tester-year-e600/)**\n\n**[Spamta/Stration/Warezov strike back](https://www.pandasecurity.com/en/mediacenter/malware/spamtastrationwarezov-strike-back/)**\n\n**[…more and more Rogue Antivirus](https://www.pandasecurity.com/en/mediacenter/malware/more-and-more-rogue-antivirus/)**\n\n**[Distributing malware through Facebook](https://www.pandasecurity.com/en/mediacenter/malware/distributing-malware-through-facebook/)**\n\n## Leave a Reply\n\nYour email address will not be published. Required fields are marked *\n\n\n\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2016/2016-08-04 - What is Multigrain- Learn what makes this PoS malware different.pdf"
    ],
    "report_names": [
        "2016-08-04 - What is Multigrain- Learn what makes this PoS malware different.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535633,
    "ts_updated_at": 1743041155,
    "ts_creation_date": 1653765432,
    "ts_modification_date": 1653765432,
    "files": {
        "pdf": "https://archive.orkl.eu/b8ce90a5687e8f98dcd6967b5de2e014b4be37c7.pdf",
        "text": "https://archive.orkl.eu/b8ce90a5687e8f98dcd6967b5de2e014b4be37c7.txt",
        "img": "https://archive.orkl.eu/b8ce90a5687e8f98dcd6967b5de2e014b4be37c7.jpg"
    }
}