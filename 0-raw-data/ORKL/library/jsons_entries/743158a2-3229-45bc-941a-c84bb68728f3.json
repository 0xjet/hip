{
    "id": "743158a2-3229-45bc-941a-c84bb68728f3",
    "created_at": "2023-01-12T15:09:04.29849Z",
    "updated_at": "2025-03-27T02:16:46.983082Z",
    "deleted_at": null,
    "sha1_hash": "267f9cb74d32fd083bdd662cd763a91a45e22019",
    "title": "2022-10-18 - APT27 – One Year To Exfiltrate Them All- Intrusion In-Depth Analysis",
    "authors": "",
    "file_creation_date": "2022-11-28T19:00:54Z",
    "file_modification_date": "2022-11-28T19:00:54Z",
    "file_size": 687077,
    "plain_text": "# APT27 – One Year To Exfiltrate Them All: Intrusion In- Depth Analysis\n\n**intrinsec.com/apt27-analysis/**\n\nEquipe CERT 18 octobre 2022\n\n## Context\n\nDuring 2022, a company discovered that one of their equipments was communicating with a\nknown command and control server. As a result, the company decided to contact CERT\nIntrinsec in order to get help to handle the security breach and manage the crisis. CERT\nIntrinsec gathered information about malicious activities that were discovered on victim’s\ninformation system, and past incidents. Our in-depth analysis led us to conclude that an\nadvanced persistent threat dubbed APT27 (a.k.a LuckyMouse, EmissaryPanda) actually\ncompromised the company’s internal network by exploiting a public facing application. Our\nanalysis showed that the threat actor managed to compromise several different domains and\nto gain persistence on many equipments while trying to hide in plain sight. As investigations\nwent on, we observed tactics, techniques and procedures that had already been\ndocumented in papers, but we discovered new ones as well. CERT Intrinsec wanted to share\nwith the community fresh and actionnable threat-intelligence related to APT27. That is why\nthis report presents a timeline of actions taken by the attackers and the tactics, techniques\nand procedures seen during our incident response. It provides as well a MITRE ATT&CK\ndiagram and several recommendations to follow if you came across such incident, and to\nprevent them.\n\n## CERT Intrinsec presentation\n\nCERT Intrinsec is a private French incident response team dealing between 50 to 100 major\nincidents per year and works to help its customers to recover from cyber-attacks and\nstrengthen their security. Since 2017, CERT Intrinsec has responded to hundreds of security\nbreaches involving companies and public entities. The majority of those incidents are related\nto cybercriminality and ransomware attacks with financial objectives, hence, Intrinsec follows\nthose groups activities and generates comprehensive intelligence `from the field`. ANSSI\n(French National Security Agency) granted CERT Intrinsec PRIS (State-Certified Security\nIncident Response Service Providers) certification. The latter testify that CERT Intrinsec\nmeets specific incident response requirements, using dedicated procedures, qualified people\nand appropriate infrastructures. Should you need our expertises, Intrinsec provides Incident\nresponse & Crisis services, Threat Intelligence services & datas, Detection services\n(SOC/MDR/XDR), supported by a large set of other services (pentests & audits, consulting,\n…) .\n\n\n-----\n\n## APT27 Presentation\n\nAPT27 (a.k.a LuckyMouse, EmissaryPanda, Iron Tiger or Mustang Panda) is a supposed\nnation state cyber threat actor linked to RPC governement. Since at least 2010, the group\nhas been reported targeting numerous public organisations as well as private companies.\nKnown APT27 sectors of interest are: Defense contractors, Aerospace, Telecommunication,\nEnergy, Manufacturing, Technology, Education and finally governement’s data (ambassies\nhas been reported targeted). The group is also well known for exploiting internet facing\napplications to get access within the victim’s networks. Known targeted application were\nMySQL, Microsoft SharePoint (CVE-2019-0604 RCE), Apache Zookeeper and more recently\nMicrosoft Exchange servers. In addition, the group is also known to rely on the HyperBRO\nmalware, a Remote Access Trojan (RAT). Capabilities description and decryption tool are\navailable on behalf of the report.\n\n## Operation’s timeline\n\nIt is important to look at the timeline of malicious activities. The first activity discovered was\nthe exploitation of a Microsoft Exchange server using ProxyLogon vulnerabilities chain and\nthe domains discovery performed from this server. APT27’s operators then compromised\nseveral domains in a few months, dumping credentials and gathering technical data about\nvictim’s information system. Finally, they started exfiltrating data in archives using different\nmeans. Gigabytes of data were exfiltrated in 17 days. Attackers tried to hide their activities\nusing many defense evasion techniques that we present to you in this report.\nThe following timeline shows the different steps of the operation, especially regarding\ndomains compromise and data exfiltration.\n\n\n-----\n\nThe following diagram summarizes APT27 modus operandi during the attack. It emphasizes\nintrusion vector, data exfiltration as well as command and control activities.\n\n\n-----\n\n## APT27 Techniques, Tactics and procedures\n\nTactic ID Technique ID Technique Name\n\nInitial Access T1190 Exploit Public-Facing Application\n\nInitial compromise is the adversaries actions performed to gain access of their target’s\norganisations. It can be performed by sending spear-phishing email or exploiting vulnerable\ninternet facing applications to, then, move within the network. During CERT Intrinsec\ninvestigations, we found that on March, 4th of 2021, APT27 exploited ProxyLogon\nvulnerabilities chain affecting Microsoft Exchange server to gain initial access of the targeted\norganisation’s network. As a reminder, ProxyLogon related Microsoft advisory was initially\npublished by Microsoft on March, 2th of 2021. First known information related to those CVE\n[came back from december 2020, when DEVCORE Team discovered both CVE-2021-26855](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-26855)\n[and CVE-2021-27065. The exploitation of these two vulnerabilities leads to remote code](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-27065)\nexecution with SYSTEM permissions, allowing attackers to drop webshells, for instance.\n\n\n-----\n\nSame initial intrusion date, also involving a successful ProxyShell exploitation as entry vector\n[has been also reported by HVS-Consulting for one of their customer in their incident](https://www.hvs-consulting.de/public/ThreatReport-EmissaryPanda.pdf)\nresponse report related to APT27. Many others security vendors also reported active\nexploitation of Microsoft Exchange Server on that date. We can assume that the threat group\nwas aware of the vulnerability before the Microsoft Advisory (or quickly developped an\nexploit) and managed to perform a massive exploitation campaign before companies had a\nchance to apply security fixes.\n\n## Execution\n\nTactic ID Technique ID Technique Name\n\nExecution T1059.001 Command and Scripting Interpreter: PowerShell\n\nExecution T1059.003 Command and Scripting Interpreter: Windows Command Shell\n\nExecution T1047 Windows Management Instrumentation\n\nAdversaries were wrapping their commands through calls to cmd.exe /Q /c command line. In\naddition, all results were stored int the ADMIN$ administrative share, in a file of type\n__[UNIX_EPOCH_DATETIME]\nThis a likely the impacket’s behaviour and hence, Intrinsec CERT assumes that adversaries\nused that framework during their operation.\nC:\\Windows\\System32\\cmd.exe(cmd.exe /Q /c powershell Add-MpPreference ExclusionPath C:\\Windows\\temp 1> \\\\127.0.0.1\\ADMIN$\\__[UNIX_EPOCH_DATETIME]\n2>&1)\nIn order to execute remote command, threat actors also relied on valid credentials collected\nin previous stages used wmic tool to execute commands on remote hosts.\nAs exemple, a command where attackers executed a script located in the recycle bin of a\nremote computer:\ncmd.exe /Q /c wmic /node:[IP] /user:[DOMAIN]\\[ACCOUNT] /password:[PASSWORD]\nprocess call create cmd /c d:\\$recycle.bin\\2.bat\n\n## Persistence\n\n\nTactic Technique\nID\n\n\nTechnique Name\n\n\nPersistence T1569.002 Create or Modify System Process: Windows Service\n\nPersistence T1547.001 Boot or Logon Autostart Execution: Registry Run Keys /\nStartup Folder\n\nPersistence T1112 Modify Registry\n\n\n-----\n\nPersistence T1078.002 Valid Accounts: Domain Accounts\n\nTypical next step after a successful initial intrusion is to ensure persistance within the target’s\nnetwork and be sure that attacker’s will not be kick-out easily.\nIt is commonly achieved by deploying webshells, Remote Access Trojan or Remote\nAdministration Tool, such as AnyDesk / Teamviewer.\n\nFirst payload found by CERT Intrinsec was the HyperBRO Remote Access Trojan.\nHyperBRO malware is a closed-sources application typical of APT27 threat group’s activities.\nHyperBRO is a fully featured Remote Access Trojan (RAT) and is used by APT27 operators\nto (not exaustive):\n\nBypass UAC\nExecute local & remote commands\nSteal data\nKeylogging\nCapture keyboard\nEdit registry\nManage files, process, services\n\n### HyperBRO Malware description\n\nHyperBro is a custom in-memory RAT backdoor used by APT27 and associated groups\n(Emissary Panda, Iron Tiger, LuckyMouse…)\nOnce the HyperBro virus has infected a host, it’s used by APT27 to execute remote\ncommands from it’s C2 server. HyperBro also includes features for taking screenshots,\nstealing clipboard content, modifying Windows services, editing the registry, and\nmanipulating files (downloading and uploading, deleting, renaming).\n\n### Deployment\n\nFirst, a legitimate program (linked to CyberArk software) (vfhost.exe / msmpeng.exe) with a\nDLL side-loading vulnerability is used to load vftrace.dll (Initial loader / Stage 1).\nThen the loader will be able to decrypt thumb.dat (Stage 2) file, “encrypted” with a 1 byte key\nalgorithm, decompress it and finaly extract the actual HyperBro backdoor (Stage\n**_3) (compressed with lznt1 algorithm)._**\nThe loader will then use the process hollowing technique to inject HyperBro backdoor\n**_(Stage 3)_**\nThe HyperBro backdoor configuration is embedded into its own PE. At its first execution, the\nconfiguration is copied into the config.ini file and into the config_ registry key.\n\n\n-----\n\n### Known Paths\n\n%ProgramData%\\windefenders\\\n%ProgramData%\\windefenders\\config.ini\n%ProgramData%\\windefenders\\msmpeng.exe\n%ProgramData%\\windefenders\\thumb.dat\n%ProgramData%\\windefenders\\vftrace.dll\n%ProgramFiles%\\Common Files\\windefenders\\\n%ProgramFiles%\\Common Files\\windefenders\\config.ini\n%ProgramFiles%\\Common Files\\windefenders\\msmpeng.exe\n%ProgramFiles%\\Common Files\\windefenders\\thumb.dat\n%ProgramFiles%\\Common Files\\windefenders\\vftrace.dll\nSOFTWARE\\WOW6432Node\\Microsoft\\config_\nHKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\windefenders\nSOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\windefenders\n\n## HyperBRO Extractor\n\n\n-----\n\nCERT Intrinsec made a tool to extract HyperBro configuration from Stage 2 samples.\n[This program is based on the work done on project HyperBroExtractor by HVS-Consulting](https://github.com/hvs-consulting/HyperBroExtractor)\n\n### Description\n\nThis tool is able to decrypt Stage 2 (thumb.dat), decompress and extract the actual hyperBro\nPE file(Stage 3), and parse the configuration it embeds.\nHyperExtractor will try to automatically bruteforce the 1 byte key and decrypt Stage 2, then it\nwill decompress the LZNT1 compressed Stage 3 and extract the configuration.\nTo work with as many samples as possible, this program uses patterns scanning to find\nconfigurations.\nIn some cases the extraction of the configuration may fail but you can try to search for utf16\nstrings.\n**NB: We have recently noticed that some new samples have some of their configuration fields**\nencrypted or obfuscated and this tool will not be able to extract all of the configutation.\n\n### Usage\n\n-i input file (Stage2 e.g: thumb.dat)\n-o output file (extracted PE)\n.\\hyperbro_extractor.exe -i .\\samples\\thumb_dat.bin -o thumb_dat_extracted_pe.bin\n\n### Output Example\n\n/!\\ — HyperBro config extractor — /!\\\n[+] ==> The decryption Key is: 0xfc\n/!\\ — Successfully exported PE to : thumb_dat_extracted_pe.bin — /!\\\n[-] HyperBro Configuration registry key: config\n[-] Legit loader: vfhost.exe\n[-] First stage: VFTRACE.DLL\n[-] Second stage: thumb.dat\n[-] Windows service name: vfhost\n[-] C2 address: 80.92.206[.]158\n[-] C2 Path: /api/v2/ajax\n[-] Verb: POST\n[-] Named Pipe: \\\\.\\pipe\\testpipe\n[-] Mutex: 80A85553-1E05-4323-B4F9-43A4396A4507\n[You can download it on our github repository: https://github.com/Intrinsec/HyperBroExtractor](https://github.com/Intrinsec/HyperBroExtractor)\n\n## Discovery & Lateral Movement\n\nTactic ID Technique ID Technique Name\n\n\n-----\n\nDiscovery T1087.002 Account Discovery: Domain Account\n\nDiscovery T1087.003 Account Discovery: Email Account\n\nDiscovery T1087.001 Account Discovery: Local Account\n\nDiscovery T1482 Domain Trust Discovery\n\nDiscovery T1083 File and Service Discovery\n\nDiscovery T1146 Network Service Discovery\n\nDiscovery T1135 Network Share Discovery\n\nDiscovery T1018 Remote System Discovery\n\nDiscovery T1082 System Information Discovery\n\nDiscovery T1057 Process Discovery\n\nLateral Movement T1570 Lateral Tool Transfer\n\nLateral Movement T1021.006 Remote Services: SMB Windows Admin Shares\n\nLateral Movement T1021.001 Remote Services: Remote Desktop Protocol\n\nOnce access gained on the Microsoft Exchange server, adversaries managed to perform an\ninitial reconnaissance of the network and domain caracteritics, such as hosts, account, policy\nenumeration.\nThis operation was performed by executing a script that lists all domains in the selected\nforest, related domain controllers, computer’s names and versions and finally list of domain’s\nusers and save it into a file named owa_font_[2-letters].css in the directory C:\\Program\nFiles\\Microsoft\\Exchange\nServer\\V15\\FrontEnd\\HttpProxy\\owa\\auth\\Current\\themes\\resources\\ :\nBelow an exemple of data saved into the owa_font_[2-letters].css file:\nMicrosoft (R) Windows Script Host Version 5.812\nCopyright (C) Microsoft Corporation. Tous droits réservés.\nAll Domains in the forest:\nDomain_NAME\n********************************************************\n\n-         Domain Controller         *\n********************************************************\nCN=[REDACTED]-DC1          DOMAIN\nCN=[REDACTED]-DC1          DOMAIN\n********************************************************\nDomain_NAME\n********************************************************\n\n\n-----\n\nHostname           DNSHostName                    OperatingSystem\nDescription\nHOST_A             DNS_NAME                        Windows Server\n[REDACTED]\n….\nDomain Policy: Password will Expired in 90 Days\n********************************************************\nDomain Admins & Enterprise Admins\n********************************************************\n********************************************************\nAll Users\n********************************************************\nkrbtgt\nDisplay Name:\nPassword Last Set: [REDACTED]\nPassword Expired: [REDACTED]\nActive: No\nLast Logon:\nDescription: Compte de service du centre de distribution de clés\nMember Of:\nCN=Groupe de réplication dont le mot de passe RODC est refusé [REDACTED]\nAdversaries also managed to extract all email addresses and associated users from the\nExchange server.\npowershell -exec bypass -command Add-PSSnapin\nMicrosoft.Exchange.Management.PowerShell.SnapIn;Get-Mailbox | format-table\nName,WindowsEmailAddress\nIn order to perform internal reconnaissance, adversaries also relied on Windows built-in\ncommands :\nipconfig /all\nnet session\nnet share\nnet use\nnet use \\\\[IP]\\ipc$ /d /y\nnet use \\\\[IP]\\ipc$\nnet use \\\\[IP] /user:[DOMAIN]\\[ACCOUNT] [PASSWORD]\nnet user\nnet user [ACCOUNT] /domain\nnet user [ACCOUNT]\nnet view /all\nnet view /domain\nnet view /domain:[DOMAIN]\nnet view\n\n\n-----\n\nnltest /domain_trusts\nnslookup -type=srv _ldap._tcp\nnslookup [IP]\nping -n 1 [IP]\nquery query user\nwhoami\ntasklist /svc\nIn addition, they used Sysinternals tools PsLoggedon.exe to identify where specific users are\nlogged in.\nThey also used Remote Desktop protocol, to connect to computers within the targeted\norganisation’s network, and admin shares to move laterally.\nThe targeted organization was managing numerous domains. APT27 operators managed to\ncompromised them successively. a few months separated compromise of first domain and\nthe second one. However, adversaries accelerated their operation and managed to get\naccess to remaining domains in a few weeks interval.\n\n## Credential Access\n\nTactic ID Technique ID Technique Name\n\nCredential Access T1003.001 OS Credential Dumping: LSASS Memory\n\nCredential Access T1003.003 OS Credential Dumping: NTDS\n\nAdversaries managed to elevate their privileges to the domain administrator level within the\nvictim’s network and systematically compromised domain controller with HyperBro malware.\nIn order to stealth authentication materials on compromised hosts, adversaries relied on the\nmimikatz tool. However, they tried to stay stealthly and used the sysinternal’s procdump tool,\nrenamed in error.log to bypass Windows Defender detection and dump lsass process\nmemory :\nC:\\Windows\\Temp\\error.log -accepteula -ma lsass.exe c:\\windows\\temp\\error.dmp\nThreat actors also used SysInternal’s PsLoggedon tool to search for specific account usage.\nWe especially seen that threat actors were interested in backups related accounts usage.\ncmd.exe /Q /c PsLoggedon.exe -accepteula [VEEAM_ACCOUNT] 1>\n\\\\127.0.0.1\\ADMIN$\\__[UNIX_EPOCH_DATETIME] 2>&1\nOnce access gained on domain controllers, adversaries managed to extract and exfiltrate\nNTDS.DIT database.\nntdsutil ac i ntds ifm create full c:\\\\windows\\\\temp\\\\winstore\\\\ quit quit\nOperators then create archive, named error.rar, containing NTDS database prior to\nexfiltrating it.\ncmd.exe /Q /c rar.exe a -r -y -[PASSWORD] -df c:\\windows\\temp\\error.rar\nc:\\windows\\temp\\winstore\\ 1> \\\\127.0.0.1\\ADMIN$\\__[UNIX_EPOCH_DATETIME] 2>&1\n\n\n-----\n\n## Defense Evasion\n\nTactic ID Technique\nID\n\n\nTechnique Name\n\n\nDefense\nEvasion\n\nDefense\nEvasion\n\nDefense\nEvasion\n\nDefense\nEvasion\n\nDefense\nEvasion\n\nDefense\nEvasion\n\n\nT1574.002 Hijack Execution Flow: DLL Side Loading\n\nT1070.004 Indicator Removal on Host: File Deletion\n\nT1036.004 Masquerading: Masquerade Task or Service\n\nT1036.005 Masquerading: Match Legitimate Name or Location\n\nT1562.001 Impair Defenses: Disable of Modify Tools\n\nT1548.002 Abuse Elevation Control Mechanism: Bypass User Account\nControl (UAC bypass using CMSTPLUA COM interface)\n\n\nTo prevent detection from Microsoft Windows Defender antivirus, APT27 operators modified\nsystem’s settings to add exclusion path to the Defender’s configuration and remove it once\ntheir operations done.\nThey achieved that operation with the following command:\nThe commands below allow attackers to add and remove the C:\\windows\\temp directory to\nWindows Defender excluded folders in order to try hiding in plain sight\nC:\\Windows\\System32\\cmd.exe(cmd.exe /Q /c powershell Get-MpPreference -ExclusionPath\nC:\\Windows\\temp 1>\n\\\\127.0.0.1\\ADMIN$\\__[UNIX_EPOCH_DATETIME] 2>&1)\nC:\\Windows\\System32\\cmd.exe(cmd.exe /Q /c powershell Add-MpPreference ExclusionPath C:\\Windows\\temp 1>\n\\\\127.0.0.1\\ADMIN$\\__[UNIX_EPOCH_DATETIME] 2>&1)\nC:\\Windows\\System32\\cmd.exe(cmd.exe /Q /c powershell Remove-MpPreference ExclusionPath C:\\Windows\\temp 1>\n\\\\127.0.0.1\\ADMIN$\\__[UNIX_EPOCH_DATETIME] 2>&1)\nIn order to slow down investigations, attackers deleted their tools as well as the archives built\nduring exfiltration phase. They use the following commands to do so.\ncmd.exe /Q /c del rar.exe error.log error1.rar error.dmp 1>\n\\\\127.0.0.1\\ADMIN$\\__[UNIX_EPOCH_DATETIME] 2>&1\n\n## Command and Control\n\n\n-----\n\nTactic ID Technique ID Technique Name\n\nCommand and Control T1090.001 Proxy: Internal Proxy\n\nCommand and Control T1071.001 Application Layer Protocol: Web Protocols\n\nAPT27 operators mainly used HyperBro C2 feature to send commands to infected hosts,\nusing POST request /api/v2/ajax and user-agent Mozilla/5.0 (Windows NT 6.3; WOW64)\nAppleWebKit/537.36 (KHTML, like Gecko) Chrome/34.0.1847.116 Safari/537.36.\nCERT Intrinsec also discovered a second application used to expose the targeted\norganisation’s internal network to adversaries.\n[The application is a reverse SOCKS proxy written in GoLang called Chisel. It transports](https://github.com/jpillora/chisel)\nTCP/UDP traffic over SSH, which is encapsulated into HTTP.\nAPT27 operators executed Chisel using wmic and rename it to veeamGues.exe to hide it in\nplain sight. The following command runs a server listening on port 9080 allowing clients to\naccess the SOCKS5 proxy.\ncmd.exe /Q /c wmic /node:127.0.0.1 process call create cmd /c\nc:\\Windows\\Temp\\veeamGues.exe server -p 9080 –socks5 1>\n\\\\127.0.0.1\\ADMIN$\\__[UNIX_EPOCH_DATETIME] 2>&1)\n\n## Data Collection\n\nTactic ID Technique ID Technique Name\n\nCollection T1560.001 Archive Collected Data: Archive via Utility\n\nCollection T1114.001 Email Collection: Local Email collection\n\nCollection T1074.001 Data Staged : Local Data Staging\n\nCollection T1074.002 Data Staged: Remote Data Staging\n\nCollection T1005 Data from Local System\n\nCollection T1038 Data from Network Shared Drive\n\nOnce APT27 operators have stolen credentials, they started the collection process by\nchecking size and usage of directories. To do so, they used diruse command, as illustrated\nbelow.\ncmd.exe /Q /c wmic /node:127.0.0.1 process call create cmd /c\nD:\\$RECYCLE.BIN\\diruse.exe /m /* D:\\data >> D:\\$RECYCLE.BIN\\temD.txt 1>\n\\\\127.0.0.1\\ADMIN$\\__[UNIX_EPOCH_DATETIME] 2>&1)\nOperators then browsed directories in order to find personal information and data related to\nresearch and development, leveraging dir command and wmic to look for files on network\nshares\n\n\n-----\n\ncmd.exe /Q /c wmic /node:[IP_ADDRESS] /user:[DOMAIN]\\[USERNAME] /password:\n\n[PASSWORD] process call create cmd /c dir [DIRECTORY] > d:\\$recycle.bin\\1.txt 1>\n\\\\127.0.0.1\\ADMIN$\\__[UNIX_EPOCH_DATETIME] 2>&1\ncmd.exe /Q /c dir \\\\[IP_ADDRESS]\\Z$\\[DIRECTORY] 1>\n\\\\127.0.0.1\\ADMIN$\\__[UNIX_EPOCH_DATETIME] 2>&1\nOnce they found relevant data, they created password-protected archives using -t to test files\nafter archiving, -inul to disable all messages, -hp to provide a password and -v to adjust size.\nwmic /node:[IP_ADDRESS] /user:[USER_ACCOUNT] /password:[PASSWORD] process call\ncreate “cmd /c c:\\temp\\rar.exe a c:\\temp\\temp.rar c:\\temp\\temp.dat -r -t -inul hp[PASSWORD] -v[SIZE]\ncmd.exe /Q /c del rar.exe c:\\windows\\temp\\rar.exe a -r -y -inul -[PASSWORD]\ng:\\$recycle.bin\\error.rar [DRIVE]:\\[FOLDER]\\*.ppt* 1>\n\\\\127.0.0.1\\ADMIN$\\__[UNIX_EPOCH_DATETIME] 2>&1\nrar.exe a -r -y -hp[PASSWORD] -df error1.rar error.dmp error.log\nBesides, APT27 operators collected data about mailboxes on the Exchange server, using\nGet-Mailbox powershell command, as shown below :\ncmd.exe /Q /c powershell -c Add-PSSnapin\nMicrosoft.Exchange.Management.PowerShell.SnapIn;Get-Mailbox 1>\n\\\\127.0.0.1\\ADMIN$\\__[UNIX_EPOCH_DATETIME] 2>&1)\n\n## Exfiltration\n\nTactic ID Technique ID Technique Name\n\nExfiltration T1071.001 Application Layer Protocol: Web Protocols\n\nAttackers used different methods to exfiltrate data.\nFirst, archives containing stolen data were moved to the Exchange server, in the Exchange\nfolder C:\\Program Files\\Microsoft\\Exchange\nServer\\V15\\FrontEnd\\HttpProxy\\owa\\auth\\Current\\themes\\resources\\, an easy way to\nexfiltrate data as this server had direct access to the Internet. These RAR archives were\nrenamed with a .png file extension to hide in plain sight and try to avoid detection. Attackers\nthen deleted them. By investigating files and Exchange server, CERT Intrinsec managed to\ncarve some archives from disk images and retrieve passwords used to create the latter. It\nwas then possible to know which data were exfiltrated by attackers.\nYou can see below archives’ names created by the attackers prior to exfiltrating.\n.\\Program Files\\Microsoft\\Exchange\nServer\\V15\\FrontEnd\\HttpProxy\\owa\\auth\\Current\\themes\\resources\\error1.png\n.\\Program Files\\Microsoft\\Exchange\nServer\\V15\\FrontEnd\\HttpProxy\\owa\\auth\\Current\\themes\\resources\\error2.png\n.\\Program Files\\Microsoft\\Exchange\nServer\\V15\\FrontEnd\\HttpProxy\\owa\\auth\\Current\\themes\\resources\\error3.png\n\n\n-----\n\n[…]\n.\\Program Files\\Microsoft\\Exchange\nServer\\V15\\FrontEnd\\HttpProxy\\owa\\auth\\Current\\themes\\resources\\error.part025.rar\n.\\Program Files\\Microsoft\\Exchange\nServer\\V15\\FrontEnd\\HttpProxy\\owa\\auth\\Current\\themes\\resources\\error.part026.rar\nAttackers used HyperBro command and control server as well to exfiltrate WinRAR archives.\nMost of the exfiltration was carried out in 26 days and involve gigabytes of data, from 4\ndifferent domains.\n\n## APT27 Intrusion Set\n\nThe following diagram sums up APT27 techniques, tactics and procedures.\n\n\n-----\n\n## Lessons Learned\n\nTo prevent those types of attacks, CERT Intrinsec recommends monitoring network and\n**endpoints activities. Indeed, supervising network equipments allows to track down**\nmalicious activities performed by advanced persistent threat, including command and control\ncommunications and exfiltration. Depending on your situations : XDR / MDR approaches\ncombined with SOC and proper threat intelligence.\n\nEnsuring a proper log retention and storage is a good way to improve detection of\nmalicious behaviour.\n\nHandling network, Active Directory hardening especially regarding trusts, and least\nprivilege principle is very important to slow down attackers in the event of an intrusion.\n\nWhen compromising servers, particularly domain controllers, operators are used to execute\ncommands to collect credentials or to dump NTDS database. Very useful information\nsources are available on systems and need to be monitored to spot attackers’ actions. These\nsources are Sysmon, that allows to log various events helping detection, and Microsoft\nProtection Logs where many evidences were found during the investigation. CERT Intrinsec\npublished an article about this artefact and a parser to extract useful informations from it. You\ncan read this article here.\n\nAs explained previously, adversaries can take advantage of a vulnerable exposed server to\nenter the corporate’s network. That shows the importance of keeping public-facing\n**equipments up-to-date and managing vulnerabilities (support at least by an external**\n**asset security monitoring approach to ensure a second line of defense in complexe /**\n**fast evolving environment).**\n\n\n-----\n\n## External Resources\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-10-18 - APT27 – One Year To Exfiltrate Them All- Intrusion In-Depth Analysis.pdf"
    ],
    "report_names": [
        "2022-10-18 - APT27 – One Year To Exfiltrate Them All- Intrusion In-Depth Analysis.pdf"
    ],
    "threat_actors": [
        {
            "id": "f3b19931-3751-4ece-a235-15b397951dc2",
            "created_at": "2022-10-25T16:07:23.889537Z",
            "updated_at": "2025-03-27T02:02:10.015565Z",
            "deleted_at": null,
            "main_name": "Nazar",
            "aliases": [
                "SIG37"
            ],
            "source_name": "ETDA:Nazar",
            "tools": [
                "Distribute.exe",
                "EYService",
                "GpUpdates.exe",
                "Microolap Packet Sniffer",
                "TCPDUMP for Windows"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "e3492534-85a6-4c87-a754-5ae4a56d7c8c",
            "created_at": "2022-10-25T15:50:23.819113Z",
            "updated_at": "2025-03-27T02:00:55.552554Z",
            "deleted_at": null,
            "main_name": "Threat Group-3390",
            "aliases": [
                "Threat Group-3390",
                "Earth Smilodon",
                "TG-3390",
                "Emissary Panda",
                "BRONZE UNION",
                "APT27",
                "Iron Tiger",
                "LuckyMouse"
            ],
            "source_name": "MITRE:Threat Group-3390",
            "tools": [
                "Systeminfo",
                "gsecdump",
                "PlugX",
                "ASPXSpy",
                "Cobalt Strike",
                "Mimikatz",
                "Impacket",
                "gh0st RAT",
                "certutil",
                "China Chopper",
                "HTTPBrowser",
                "Tasklist",
                "netstat",
                "SysUpdate",
                "HyperBro",
                "ZxShell",
                "RCSession",
                "ipconfig",
                "Clambling",
                "pwdump",
                "NBTscan",
                "Pandora",
                "Windows Credential Editor"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "2c980ea7-04c4-4193-8535-52f87e66a96e",
            "created_at": "2024-05-01T02:03:07.994126Z",
            "updated_at": "2025-03-27T02:05:17.293799Z",
            "deleted_at": null,
            "main_name": "BRONZE UNION",
            "aliases": [
                "Budworm ",
                "Emissary Panda ",
                "Iron Tiger ",
                "Lucky Mouse ",
                "TG-3390 ",
                "Temp.Hippo ",
                "APT27 "
            ],
            "source_name": "Secureworks:BRONZE UNION",
            "tools": [
                " ASPXSpy",
                " China Chopper",
                " Enfal",
                " Gh0st RAT",
                " HttpBrowser",
                " Hunter",
                " HyperBro",
                " OwaAuth",
                " PlugX",
                " PoisonIvy",
                " Sysupdate",
                " ZxShell",
                "9002"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "1691c25f-1aa4-4168-8ce2-7aa8f23246e7",
            "created_at": "2024-06-04T02:03:07.724221Z",
            "updated_at": "2025-03-27T02:05:17.284601Z",
            "deleted_at": null,
            "main_name": "BRONZE PRESIDENT",
            "aliases": [
                "Mustang Panda ",
                "Red Lich ",
                "Temp.Hex ",
                "HoneyMyte "
            ],
            "source_name": "Secureworks:BRONZE PRESIDENT",
            "tools": [
                " Cobalt Strike",
                " ORat",
                " PlugX",
                " RCSession",
                "China Chopper"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "c63ab035-f9f2-4723-959b-97a7b98b5942",
            "created_at": "2023-01-06T13:46:38.298354Z",
            "updated_at": "2025-03-27T02:00:02.798255Z",
            "deleted_at": null,
            "main_name": "APT27",
            "aliases": [
                "TG-3390",
                "EMISSARY PANDA",
                "TEMP.Hippo",
                "Budworm",
                "Group 35",
                "BRONZE UNION",
                "Lucky Mouse",
                "Iron Taurus",
                "GreedyTaotie",
                "Red Phoenix",
                "ZipToken",
                "Iron Tiger",
                "G0027",
                "Earth Smilodon"
            ],
            "source_name": "MISPGALAXY:APT27",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "b69037ec-2605-4de4-bb32-a20d780a8406",
            "created_at": "2023-01-06T13:46:38.790766Z",
            "updated_at": "2025-03-27T02:00:02.919758Z",
            "deleted_at": null,
            "main_name": "MUSTANG PANDA",
            "aliases": [
                "TEMP.HEX",
                "TA416",
                "TANTALUM",
                "Twill Typhoon",
                "Earth Preta",
                "Stately Taurus",
                "LuminousMoth",
                "Polaris",
                "BRONZE PRESIDENT",
                "HoneyMyte",
                "Red Lich"
            ],
            "source_name": "MISPGALAXY:MUSTANG PANDA",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "9baa7519-772a-4862-b412-6f0463691b89",
            "created_at": "2022-10-25T15:50:23.354429Z",
            "updated_at": "2025-03-27T02:00:55.45162Z",
            "deleted_at": null,
            "main_name": "Mustang Panda",
            "aliases": [
                "Mustang Panda",
                "TA416",
                "RedDelta",
                "BRONZE PRESIDENT"
            ],
            "source_name": "MITRE:Mustang Panda",
            "tools": [
                "Cobalt Strike",
                "RCSession",
                "NBTscan",
                "PoisonIvy",
                "PlugX"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "5c13338b-eaed-429a-9437-f5015aa98276",
            "created_at": "2022-10-25T16:07:23.582715Z",
            "updated_at": "2025-03-27T02:02:09.875151Z",
            "deleted_at": null,
            "main_name": "Emissary Panda",
            "aliases": [
                "APT 27",
                "ATK 15",
                "Bronze Union",
                "Budworm",
                "Earth Smilodon",
                "Emissary Panda",
                "Group 35",
                "Iron Taurus",
                "Iron Tiger",
                "LuckyMouse",
                "Operation DRBControl",
                "Operation Iron Tiger",
                "Operation PZChao",
                "Operation SpoiledLegacy",
                "Operation StealthyTrident",
                "Red Phoenix",
                "TEMP.Hippo",
                "TG-3390",
                "ZipToken"
            ],
            "source_name": "ETDA:Emissary Panda",
            "tools": [
                "ASPXSpy",
                "ASPXTool",
                "Agent.dhwf",
                "AngryRebel",
                "Antak",
                "CHINACHOPPER",
                "China Chopper",
                "Destroy RAT",
                "DestroyRAT",
                "FOCUSFJORD",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "HTTPBrowser",
                "HTran",
                "HUC Packet Transmit Tool",
                "HighShell",
                "HttpBrowser RAT",
                "HttpDump",
                "HyperBro",
                "HyperSSL",
                "HyperShell",
                "Kaba",
                "Korplug",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Mimikatz",
                "Moudour",
                "Mydoor",
                "Nishang",
                "OwaAuth",
                "PCRat",
                "PlugX",
                "ProcDump",
                "PsExec",
                "RedDelta",
                "SEASHARPEE",
                "Sensocode",
                "SinoChopper",
                "Sogu",
                "SysUpdate",
                "TIGERPLUG",
                "TVT",
                "Thoper",
                "Token Control",
                "TokenControl",
                "TwoFace",
                "WCE",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "Xamtrav",
                "ZXShell",
                "gsecdump",
                "luckyowa"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "2ee03999-5432-4a65-a850-c543b4fefc3d",
            "created_at": "2022-10-25T16:07:23.882813Z",
            "updated_at": "2025-03-27T02:02:10.0116Z",
            "deleted_at": null,
            "main_name": "Mustang Panda",
            "aliases": [
                "Bronze President",
                "Camaro Dragon",
                "Earth Preta",
                "HoneyMyte",
                "Mustang Panda",
                "Operation SMUGX",
                "Operation SmugX",
                "PKPLUG",
                "Red Lich",
                "Stately Taurus",
                "TEMP.Hex"
            ],
            "source_name": "ETDA:Mustang Panda",
            "tools": [
                "9002 RAT",
                "AdFind",
                "Agent.dhwf",
                "Agentemis",
                "CHINACHOPPER",
                "China Chopper",
                "Chymine",
                "ClaimLoader",
                "Cobalt Strike",
                "CobaltStrike",
                "DCSync",
                "DOPLUGS",
                "Darkmoon",
                "Destroy RAT",
                "DestroyRAT",
                "Farseer",
                "Gen:Trojan.Heur.PT",
                "HOMEUNIX",
                "Hdump",
                "HenBox",
                "HidraQ",
                "Hodur",
                "Homux",
                "HopperTick",
                "Hydraq",
                "Impacket",
                "Kaba",
                "Korplug",
                "LadonGo",
                "MQsTTang",
                "McRAT",
                "MdmBot",
                "Mimikatz",
                "NBTscan",
                "NetSess",
                "Netview",
                "Orat",
                "POISONPLUG.SHADOW",
                "PUBLOAD",
                "PVE Find AD Users",
                "PlugX",
                "Poison Ivy",
                "PowerView",
                "QMAGENT",
                "RCSession",
                "RedDelta",
                "Roarur",
                "SPIVY",
                "ShadowPad Winnti",
                "SinoChopper",
                "Sogu",
                "TIGERPLUG",
                "TONEINS",
                "TONESHELL",
                "TVT",
                "TeamViewer",
                "Thoper",
                "TinyNote",
                "WispRider",
                "WmiExec",
                "XShellGhost",
                "Xamtrav",
                "Zupdax",
                "cobeacon",
                "nbtscan",
                "nmap",
                "pivy",
                "poisonivy"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536144,
    "ts_updated_at": 1743041806,
    "ts_creation_date": 1669662054,
    "ts_modification_date": 1669662054,
    "files": {
        "pdf": "https://archive.orkl.eu/267f9cb74d32fd083bdd662cd763a91a45e22019.pdf",
        "text": "https://archive.orkl.eu/267f9cb74d32fd083bdd662cd763a91a45e22019.txt",
        "img": "https://archive.orkl.eu/267f9cb74d32fd083bdd662cd763a91a45e22019.jpg"
    }
}