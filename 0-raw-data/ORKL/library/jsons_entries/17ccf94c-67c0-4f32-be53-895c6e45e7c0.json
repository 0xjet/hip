{
    "id": "17ccf94c-67c0-4f32-be53-895c6e45e7c0",
    "created_at": "2023-01-12T15:01:18.816478Z",
    "updated_at": "2025-03-27T02:10:07.448574Z",
    "deleted_at": null,
    "sha1_hash": "189c4cf5d15c6c384c819369c4c65d22e142cd0d",
    "title": "2018-01-16 - Skygofree- Following in the footsteps of HackingTeam",
    "authors": "",
    "file_creation_date": "2022-05-27T22:00:04Z",
    "file_modification_date": "2022-05-27T22:00:04Z",
    "file_size": 1267650,
    "plain_text": "# Skygofree: Following in the footsteps of HackingTeam\n\n**securelist.com/skygofree-following-in-the-footsteps-of-hackingteam/83603/**\n\nAuthors\n\nNikita Buchka\n\nAlexey Firsh\n\nAt the beginning of October 2017, we discovered new Android spyware with several features previously unseen in the wild. In the course of\nfurther research, we found a number of related samples that point to a long-term development process. We believe the initial versions of this\nmalware were created at least three years ago – at the end of 2014. Since then, the implant’s functionality has been improving and remarkable\nnew features implemented, such as the ability to record audio surroundings via the microphone when an infected device is in a specified\nlocation; the stealing of WhatsApp messages via Accessibility Services; and the ability to connect an infected device to Wi-Fi networks\ncontrolled by cybercriminals.\n\nWe observed many web landing pages that mimic the sites of mobile operators and which are used to spread the Android implants. These\ndomains have been registered by the attackers since 2015. According to our telemetry, that was the year the distribution campaign was at its\nmost active. The activities continue: the most recently observed domain was registered on October 31, 2017. Based on our KSN statistics,\nthere are several infected individuals, exclusively in Italy.\n\nMoreover, as we dived deeper into the investigation, we discovered several spyware tools for Windows that form an implant for exfiltrating\nsensitive data on a targeted machine. The version we found was built at the beginning of 2017, and at the moment we are not sure whether\nthis implant has been used in the wild.\n\nWe named the malware Skygofree, because we found the word in one of the domains*.\n\n## Malware Features\n\n\n-----\n\n### d o d\n\nAccording to the observed samples and their signatures, early versions of this Android malware were developed by the end of 2014 and the\ncampaign has remained active ever since.\n\n_Signature of one of the earliest versions_\n\nThe code and functionality have changed numerous times; from simple unobfuscated malware at the beginning to sophisticated multi-stage\nspyware that gives attackers full remote control of the infected device. We have examined all the detected versions, including the latest one\nthat is signed by a certificate valid from September 14, 2017.\n\nThe implant provides the ability to grab a lot of exfiltrated data, like call records, text messages, geolocation, surrounding audio, calendar\nevents, and other memory information stored on the device.\n\nAfter manual launch, it shows a fake welcome notification to the user:\n\n_Dear Customer, we’re updating your configuration and it will be ready as soon as possible._\n\nAt the same time, it hides an icon and starts background services to hide further actions from the user.\n\n**Service Name** **Purpose**\n\nAndroidAlarmManager Uploading last recorded .amr audio\n\nAndroidSystemService Audio recording\n\nAndroidSystemQueues Location tracking with movement detection\n\nClearSystems GSM tracking (CID, LAC, PSC)\n\nClipService Clipboard stealing\n\nAndroidFileManager Uploading all exfiltrated data\n\nAndroidPush XMPP С&C protocol (url.plus:5223)\n\nRegistrationService Registration on C&C via HTTP (url.plus/app/pro/)\n\nInterestingly, a self-protection feature was implemented in almost every service. Since in Android 8.0 (SDK API 26) the system is able to kill\nidle services, this code raises a fake update notification to prevent it:\n\n\n-----\n\nCybe c a s a e t e ab ty to co t o t e p a t a,, b a y S S a d [ebaseC oud](https://firebase.google.com/docs/cloud-messaging/) essag g (o Goog eC oud essag g\nin older versions) protocols. Such a diversity of protocols gives the attackers more flexible control. In the latest implant versions there are 48\ndifferent commands. You can find a full list with short descriptions in the Appendix. Here are some of the most notable:\n\n‘geofence’ – this command adds a specified location to the implant’s internal database and when it matches a device’s current location\nthe malware triggers and begins to record surrounding audio.\n”social” – this command that starts the ‘AndroidMDMSupport’ service – this allows the files of any other installed application to be\ngrabbed. The service name makes it clear that by applications the attackers mean MDM solutions that are business-specific tools. The\noperator can specify a path with the database of any targeted application and server-side PHP script name for uploading.\n\n_Several hardcoded applications targeted by the MDM-grabbing command_\n\n‘wifi’ – this command creates a new Wi-Fi connection with specified configurations from the command and enable Wi-Fi if it is disabled.\nSo, when a device connects to the established network, this process will be in silent and automatic mode. This command is used to\nconnect the victim to a Wi-Fi network controlled by the cybercriminals to perform traffic sniffing and man-in-the-middle (MitM) attacks.\n\n_addWifiConfig method code fragments_\n\n‘camera’ – this command records a video/capture a photo using the front-facing camera when someone next unlocks the device.\n\nSome versions of the Skygofree feature the self-protection ability exclusively for Huawei devices. There is a ‘protected apps’ list in this brand’s\nsmartphones, related to a battery-saving concept. Apps not selected as protected apps stop working once the screen is off and await reactivation, so the implant is able to determine that it is running on a Huawei device and add itself to this list. Due to this feature, it is clear that\nthe developers paid special attention to the work of the implant on Huawei devices.\n\nAlso, we found a debug version of the implant (70a937b2504b3ad6c623581424c7e53d) that contains interesting constants, including the\nversion of the spyware.\n\n\n-----\n\n_Debug BuildConfig with the version_\n\nAfter a deep analysis of all discovered versions of Skygofree, we made an approximate timeline of the implant’s evolution.\n\n_Mobile implant evolution timeline_\n\nHowever, some facts indicate that the APK samples from stage two can also be used separately as the first step of the infection. Below is a list\nof the payloads used by the Skygofree implant in the second and third stages.\n\n**Reverse shell payload**\n\nThe reverse shell module is an external ELF file compiled by the attackers to run on Android. The choice of a particular payload is determined\nby the implant’s version, and it can be downloaded from the command and control (C&C) server soon after the implant starts, or after a specific\ncommand. In the most recent case, the choice of the payload zip file depends on the device process architecture. For now, we observe only\none payload version for following the ARM CPUs: arm64-v8a, armeabi, armeabi-v7a.\n\nNote that in almost all cases, this payload file, contained in zip archives, is named ‘setting’ or ‘setting.o’.\n\nThe main purpose of this module is providing reverse shell features on the device by connecting with the C&C server’s socket.\n\n\n-----\n\n_Reverse shell payload_\n\nThe payload is started by the main module with a specified host and port as a parameter that is hardcoded to ‘54.67.109.199’ and ‘30010’ in\nsome versions:\n\nAlternatively, they could be hardcoded directly into the payload code:\n\nWe also observed variants that were equipped with similar reverse shell payloads directly in the main APK /lib/ path.\n\n_Equipped reverse shell payload with specific string_\n\nAfter an in-depth look, we found that some versions of the reverse shell payload code share similarities with PRISM – a stealth reverse shell\n[backdoor that is available on Github.](https://github.com/andreafabrizi/prism/)\n\n\n-----\n\n_Reverse shell payload from update_dev.zip_\n\n**Exploit payload**\n\nAt the same time, we found an important payload binary that is trying to exploit several known vulnerabilities and escalate privileges. According\nto several timestamps, this payload is used by implant versions created since 2016. It can also be downloaded by a specific command. The\nexploit payload contains following file components:\n\n**Component name** **Description**\n\nrun_root_shell/arrs_put_user.o/arrs_put_user/poc Exploit ELF\n\ndb Sqlite3 tool ELF\n\ndevice.db Sqlite3 database with supported devices and their constants needed for privilege\nescalation\n\n‘device.db’ is a database used by the exploit. It contains two tables – ‘supported_devices’ and ‘device_address’. The first table contains 205\ndevices with some Linux properties; the second contains the specific memory addresses associated with them that are needed for successful\nexploitation. You can find a full list of targeted models in the Appendix.\n\n_Fragment of the database with targeted devices and specific memory addresses_\n\nIf the infected device is not listed in this database, the exploit tries to discover these addresses programmatically.\n\nAfter downloading and unpacking, the main module executes the exploit binary file. Once executed, the module attempts to get root privileges\non the device by exploiting the following vulnerabilities:\n\nCVE-2013-2094\n\nCVE-2013-2595\n\nCVE-2013-6282\n\n[CVE-2014-3153 (futex aka TowelRoot)](https://threatpost.com/android-root-access-vulnerability-affecting-most-devices/106683/)\n\nCVE 2015 3636\n\n\n-----\n\n_Exploitation process_\n\n[After an in-depth look, we found that the exploit payload code shares several similarities with the public project android-rooting-tools.](https://github.com/android-rooting-tools)\n\n_Decompiled exploit function code fragment_\n\n\n-----\n\n_run_with_mmap function from the android-rooting-tools project_\n\nAs can be seen from the comparison, there are similar strings and also a unique comment in Italian, so it looks like the attackers created this\nexploit payload based on android-rooting-tools project source code.\n\n**Busybox payload**\n\nBusybox is public software that provides several Linux tools in a single ELF file. In earlier versions, it operated with shell commands like this:\n\n_Stealing WhatsApp encryption key with Busybox_\n\n**Social payload**\n\nActually, this is not a standalone payload file – in all the observed versions its code was compiled with exploit payload in one file (‘poc_perm’,\n‘arrs_put_user’, ‘arrs_put_user.o’). This is due to the fact that the implant needs to escalate privileges before performing social payload\nactions. This payload is also used by the earlier versions of the implant. It has similar functionality to the ‘AndroidMDMSupport’ command from\nthe current versions – stealing data belonging to other installed applications. The payload will execute shell code to steal data from various\napplications. The example below steals Facebook data:\n\nAll the other hardcoded applications targeted by the payload:\n\n**Package name** **Name**\n\njp.naver.line.android LINE: Free Calls & Messages\n\n\n-----\n\ncom.facebook.orca Facebook messenger\n\ncom.facebook.katana Facebook\n\ncom.whatsapp WhatsApp\n\ncom.viber.voip Viber\n\n**Parser payload**\n\nUpon receiving a specific command, the implant can download a special payload to grab sensitive information from external applications. The\ncase where we observed this involved WhatsApp.\n\nIn the examined version, it was downloaded from:\n\n_hxxp://url[.]plus/Updates/tt/parser.apk_\n\nThe payload can be a .dex or .apk file which is a Java-compiled Android executable. After downloading, it will be loaded by the main module\nvia DexClassLoader api:\n\nAs mentioned, we observed a payload that exclusively targets the WhatsApp messenger and it does so in an original way. The payload uses\nthe Android Accessibility Service to get information directly from the displayed elements on the screen, so it waits for the targeted application\nto be launched and then parses all nodes to find text messages:\n\nNote that the implant needs special permission to use the Accessibility Service API, but there is a command that performs a request with a\nphishing text displayed to the user to obtain such permission.\n\n### Windows\n\nWe have found multiple components that form an entire spyware system for the Windows platform.\n\n\n-----\n\n**Name** **MD5** **Purpose**\n\nmsconf.exe 55fb01048b6287eadcbd9a0f86d21adf Main module, reverse shell\n\nnetwork.exe f673bb1d519138ced7659484c0b66c5b Sending exfiltrated data\n\nsystem.exe d3baa45ed342fbc5a56d974d36d5f73f Surrounding sound recording by mic\n\nupdate.exe 395f9f87df728134b5e3c1ca4d48e9fa Keylogging\n\nwow.exe 16311b16fd48c1c87c6476a455093e7a Screenshot capturing\n\nskype_sync2.exe 6bcc3559d7405f25ea403317353d905f Skype call recording to MP3\n\nAll modules, except skype_sync2.exe, are written in Python and packed to binary files via the Py2exe tool. This sort of conversion allows\nPython code to be run in a Windows environment without pre-installed Python binaries.\n\nmsconf.exe is the main module that provides control of the implant and reverse shell feature. It opens a socket on the victim’s machine and\nconnects with a server-side component of the implant located at 54.67.109.199:6500. Before connecting with the socket, it creates a malware\nenvironment in ‘APPDATA/myupd’ and creates a sqlite3 database there – ‘myupd_tmp\\\\mng.db’:\n\nCREATE TABLE MANAGE(ID INT PRIMARY KEY NOT NULL,Send INT NOT NULL, Keylogg INT NOT NULL,Screenshot INT NOT\nNULL,Audio INT NOT NULL);\n\nINSERT INTO MANAGE (ID,Send,Keylogg,Screenshot,Audio) VALUES (1, 1, 1, 1, 0 )\n\nFinally, the malware modifies the ‘Software\\Microsoft\\Windows\\CurrentVersion\\Run’ registry key to enable autostart of the main module.\n\nThe code contains multiple comments in Italian, here is the most noteworthy example:\n\n_“Receive commands from the remote server, here you can set the key commands to command the virus”_\n\nHere are the available commands:\n\n**Name** **Description**\n\ncd Change current directory to specified\n\nquit Close the socket\n\nnggexe Execute received command via Python’s subprocess.Popen() without outputs\n\nngguploads Upload specified file to the specified URL\n\nnggdownloads Download content from the specified URLs and save to specified file\n\nnggfilesystem Dump file structure of the C: path, save it to the file in json format and zip it\n\n\nnggstart_screen\n\nnggstop_screen\n\nnggstart_key\n\nnggstop_key\n\nnggstart_rec\n\nnggstop_rec\n\n\nEnable/disable screenshot module. When enabled, it makes a screenshot every 25 seconds\n\nEnable/disable keylogging module\n\nEnable/disable surrounding sounds recording module\n\n\nngg_status Send components status to the C&C socket\n\n*any other* Execute received command via Python’s subprocess.Popen(), output result will be sent to the C&C socket.\n\nAll modules set hidden attributes to their files:\n\n**Module** **Paths** **Exfiltrated data format**\n\nmsconf.exe %APPDATA%/myupd/gen/ %Y%m%d-%H%M%S_filesystem.zip (file structure dump)\n\n\n-----\n\nsystem.exe %APPDATA%/myupd/aud/ %d%m%Y%H%M%S.wav (surrounding sounds)\n\n\nupdate.exe %APPDATA%/myupd_tmp/txt/\n\n%APPDATA%/myupd/txt/\n\n\n%Y%m%d-%H%M%S.txt (keylogging)\n\n\nwow.exe %APPDATA%/myupd/scr/ %Y%m%d-%H%M%S.jpg (screenshots)\n\n\nskype_sync2.exe %APPDATA%/myupd_tmp/skype/\n\n%APPDATA%/myupd/skype/\n\n\nyyyyMMddHHmmss_in.mp3\n\nyyyyMMddHHmmss_out.mp3\n\n(skype calls records)\n\n\nMoreover, we found one module written in .Net – skype_sync2.exe. The main purpose of this module is to exfiltrate Skype call recordings. Just\nlike the previous modules, it contains multiple strings in Italian.\n\nAfter launch, it downloads a codec for MP3 encoding directly from the C&C server:\n\n_http://54.67.109.199/skype_resource/libmp3lame.dll_\n\nThe skype_sync2.exe module has a compilation timestamp – Feb 06 2017 and the following PDB string:\n\n_\\\\vmware-host\\Shared_\n\n_Folders\\dati\\Backup\\Projects\\REcodin_2\\REcodin_2\\obj\\x86\\Release\\REcodin_2.pdb_\n\nnetwork.exe is a module for submitting all exfiltrated data to the server. In the observed version of the implant it doesn’t have an interface to\nwork with the skype_sync2.exe module.\n\n_network.exe submitting to the server code snippet_\n\n**Code similarities**\n\nWe found some code similarities between the implant for Windows and other public accessible projects.\n\nhttps://github.com/El3ct71k/Keylogger/\n\nIt appears the developers have copied the functional part of the keylogger module from this project.\n\n\n-----\n\n_update.exe module and Keylogger by ‘El3ct71k’ code comparison_\n\n[Xenotix Python Keylogger including specified mutex ‘mutex_var_xboz’.](https://github.com/ajinabraham/Xenotix-Python-Keylogger/)\n\n_update.exe module and Xenotix Python Keylogger code comparison_\n\n_‘addStartup’ method from msconf.exe module_\n\n\n-----\n\n_‘addStartup’ method from Xenotix Python Keylogger_\n\n## Distribution\n\nWe found several landing pages that spread the Android implants.\n\n**Malicious URL** **Referrer**\n\nhttp://217.194.13.133/tre/internet/Configuratore_3.apk http://217.194.13.133/\n\nhttp://217.194.13.133/appPro_AC.apk –\n\nhttp://217.194.13.133/190/configurazione/vodafone/smartphone/VODAFONE%20Configuratore%20v5_4_2.apk http://217.194.13.133/\n\nhttp://217.194.13.133/190/configurazione/vodafone/smartphone/Vodafone%20Configuratore.apk http://217.194.13.133/\n\nhttp://vodafoneinfinity.sytes.net/tim/internet/Configuratore_TIM.apk http://vodafoneinfinity.\n\nhttp://vodafoneinfinity.sytes.net/190/configurazione/vodafone/smartphone/VODAFONE%20Configuratore%20v5_4_2.apk http://vodafoneinfinity.\n\nhttp://windupdate.serveftp.com/wind/LTE/WIND%20Configuratore%20v5_4_2.apk http://windupdate.serv\n\nhttp://119.network/lte/Internet-TIM-4G-LTE.apk http://119.network/lte/d\n\nhttp://119.network/lte/Configuratore_TIM.apk 2015-07-08\n\nMany of these domains are outdated, but almost all (except one – appPro_AC.apk) samples located on the 217.194.13.133 server are still\naccessible. All the observed landing pages mimic the mobile operators’ web pages through their domain name and web page content as well.\n\n\n-----\n\n_Landing web pages that mimic the Vodafone and Three mobile operator sites_\n\nNETWORK CONFIGURATION\n\n** AGG. 2.3.2015 ***\n\nDear Customer, in order to avoid malfunctions to your internet connection, we encourage you to upgrade your configuration. Download the\nupdate now and keep on navigating at maximum speed!\n\nDOWNLOAD NOW\n\nDo you doubt how to configure your smartphone?\n\nFollow the simple steps below and enter the Vodafone Fast Network.\n\nInstallation Guide\n\nDownload\n\nClick on the DOWNLOAD button you will find on this page and download the application on your smartphone.\n\nSet your Smartphone\n\nGo to Settings-> Security for your device and put a check mark on Unknown Sources (some models are called Sources Unknown).\n\nInstall\n\nGo to notifications on your device (or directly in the Downloads folder) and click Vodafone Configuration Update to install.\n\nTry high speed\n\nRestart your device and wait for confirmation sms. Your smartphone is now configured.\n\nFurther research of the attacker’s infrastructure revealed more related mimicking domains.\n\nUnfortunately, for now we can’t say in what environment these landing pages were used in the wild, but according to all the information at our\ndsiposal, we can assume that they are perfect for exploitation using malicious redirects or man-in-the-middle attacks. For example, this could\nbe when the victim’s device connects to a Wi-Fi access point that is infected or controlled by the attackers.\n\n## Artifacts\n\n\n-----\n\nu g t e esea c, e ou d p e ty o t aces o t e de e ope s a d t ose do g t e a ta g\n\nAs already stated in the ‘malware features’ part, there are multiple giveaways in the code. Here are just some of them:\n\n**ngglobal – FirebaseCloudMessaging topic name**\n\n**Issuer: CN = negg – from several certificates**\n\n**negg.ddns[.]net, negg1.ddns[.]net, negg2.ddns[.]net – C&C servers**\n\n**NG SuperShell – string from the reverse shell payload**\n\n**ngg – prefix in commands names of the implant for Windows**\n\n_Signature with specific issuer_\n\nWhois records and IP relationships provide many interesting insights as well. There are a lot of other ‘Negg’ mentions in Whois records\nand references to it. For example:\n\n## Conclusions\n\nThe Skygofree Android implant is one of the most powerful spyware tools that we have ever seen for this platform. As a result of the long-term\ndevelopment process, there are multiple, exceptional capabilities: usage of multiple exploits for gaining root privileges, a complex payload\nstructure, never-before-seen surveillance features such as recording surrounding audio in specified locations.\n\nGiven the many artifacts we discovered in the malware code, as well as infrastructure analysis, we are pretty confident that the developer of\nthe Skygofree implants is an Italian IT company that works on surveillance solutions, just like HackingTeam.\n\nNotes\n\n*Skygofree has no connection to Sky, Sky Go or any other subsidiary of Sky, and does not affect the Sky Go service or app.\n\n**[Skygofree Appendix — Indicators of Compromise (PDF)](https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2018/03/07164028/Skygofree_appendix_eng.pdf)**\n\n[APT](https://securelist.com/tag/apt/)\n[Google Android](https://securelist.com/tag/google-android/)\n[Hacking Team](https://securelist.com/tag/hacking-team/)\n[Mobile Malware](https://securelist.com/tag/mobile-malware/)\n\nAuthors\n\nNikita Buchka\n\nAlexey Firsh\n\nSkygofree: Following in the footsteps of HackingTeam\n\nYour email address will not be published. Required fields are marked *\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-01-16 - Skygofree- Following in the footsteps of HackingTeam.pdf"
    ],
    "report_names": [
        "2018-01-16 - Skygofree- Following in the footsteps of HackingTeam.pdf"
    ],
    "threat_actors": [
        {
            "id": "a3687241-9876-477b-aa13-a7c368ffda58",
            "created_at": "2022-10-25T16:07:24.496902Z",
            "updated_at": "2025-03-27T02:02:10.256629Z",
            "deleted_at": null,
            "main_name": "Hacking Team",
            "aliases": [],
            "source_name": "ETDA:Hacking Team",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "e90c06e4-e3e0-4f46-a3b5-17b84b31da62",
            "created_at": "2023-01-06T13:46:39.018236Z",
            "updated_at": "2025-03-27T02:00:02.978356Z",
            "deleted_at": null,
            "main_name": "Hacking Team",
            "aliases": [],
            "source_name": "MISPGALAXY:Hacking Team",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535678,
    "ts_updated_at": 1743041407,
    "ts_creation_date": 1653688804,
    "ts_modification_date": 1653688804,
    "files": {
        "pdf": "https://archive.orkl.eu/189c4cf5d15c6c384c819369c4c65d22e142cd0d.pdf",
        "text": "https://archive.orkl.eu/189c4cf5d15c6c384c819369c4c65d22e142cd0d.txt",
        "img": "https://archive.orkl.eu/189c4cf5d15c6c384c819369c4c65d22e142cd0d.jpg"
    }
}