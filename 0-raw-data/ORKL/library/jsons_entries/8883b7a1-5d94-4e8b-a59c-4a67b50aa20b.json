{
    "id": "8883b7a1-5d94-4e8b-a59c-4a67b50aa20b",
    "created_at": "2023-01-12T15:10:19.809584Z",
    "updated_at": "2025-03-27T02:09:30.259407Z",
    "deleted_at": null,
    "sha1_hash": "691e0e6558b1ebcee22985a2179f1a1af2603303",
    "title": "2020-06-19 - Dridex- the secret in a PostMessage()",
    "authors": "",
    "file_creation_date": "2022-05-28T17:57:30Z",
    "file_modification_date": "2022-05-28T17:57:30Z",
    "file_size": 1445312,
    "plain_text": "# Dridex: the secret in a PostMessage()\n\n**reaqta.com/2020/06/dridex-the-secret-in-a-postmessage/**\n\nDridex is a well-known banking malware that has been around since 2014. The developers\n[behind it are always at the forefront of innovation and capable of routinely coming up with](https://reaqta.com/2016/07/dridex-tries-sandbox-evasion)\n[new tricks.](https://reaqta.com/2015/08/analysis-of-an-undetected-dridex-sample)\n\n## Taking a Closer Look\n\nDridex Phishing Email\nIn this campaign (still active at the time of writing), Dridex comes packaged as a zip file,\npretending to be a DHL Document. As seen above, the lure, directed at safeguard_technology.com, is rather simple and not articulate._\n\n\n-----\n\nThe attached zip file contains a Word Document laced with a malicious macro. Opening the\ndocument starts the infection chain, and this is where things get really interesting. To\n[understand the general behavior, we started by running the sample through ReaQta-Hive.](https://reaqta.com/hive)\nThis is how it looks like.\n\nDridex behavior as tracked by ReaQta-Hive\nAt first glance, it might not look like much – just another WMI execution via Macro – but\nbehind the scenes, Dridex does something interesting. Though the wmic.exe inspection\npanel (2) shows an empty command line, and the edge connecting winword.exe to wmic.exe\ndoesn’t show any sign of alteration – like a process impersonation or code injection – the\nWMI somehow starts rundll32.exe (3). How is this possible?\n\nWinword starting an instance of notepad\n\n\n-----\n\nThe behavioral tree gives us clues into this. As seen from the above image, we can observe\na possible anomaly: an instance of notepad.exe pops-out from winword.exe. By zooming in,\nwe also see that notepad opens a .txt file.\n\nThe file being processed by notepad is called may_befall.txt. Analyzing the Macro’s code\nhelps better explain what is happening.\n\nDridex macro analysis\nThe macro code is obfuscated along the lines of Pride and Prejudice. The developers\nprobably felt poetic.Well, this kind of obfuscation is also more pleasant to the eye of the\nanalysts, so no critiques here. Below we can see where the .txt file opened by notepad is\ncreated.\n\nDridex macro creating notepad’s text file\nThis file is actually an xsl containing the code that is used by wmic.exe to download and run\nits malicious Dridex payload.\n\n\n-----\n\nXSL payload opened by notepad\nAdditional Macro code analysis shows what is really happening, it can be summarised in this\nway:\n\n1. The macro creates an instance of notepad.exe\n2. By using several calls to PostMessageA(), the macro writes the xsl payload in a .txt\n\nfile\n3. The macro then renames the .txt to .xsl\n4. wmic.exe is started by the macro\n5. The macro searches the wmic console by calling FindWindowExA() using\n\n_consolewindowclass_\n6. Data to the wmic console is again sent using PostMessageA()\n7. wmic.exe runs a **[squiblytwo attack](https://reaqta.com/2019/02/hunting-fileless-malware/)**\n8. wmic.exe downloads and drops the malicious Dridex dlls\n9. wmic.exe finally runs rundll32.exe\n\nBelow is a high level view of the macro’s workflow:\n\n\n-----\n\nDridex macro workflow\nThe malicious payload is downloaded from 2 URLS:\n\n1. https[:]//batriaruum[.]com/dasruol.dll\n2. https[:]//penotorc[.]com/topwin.dll\n\n\n-----\n\nDridex C2 connection\nWe have created a quick PoC video that shows this technique at work.\n\nWatch Video At:\n\nhttps://youtu.be/k3Qra1y64jY\n\nWhy the did the Dridex developers go down this convoluted path to start wmic.exe? There\nare several possible answers:\n\n1. To hide the commandline and thus prevent static detection, such as from automated\n\n_Threat Hunting on commandline parameters._\n2. To prevent triggering SIEM’s correlation rules.\n3. To bypass application whitelisting (AWL) solutions.\n\n\n-----\n\nIndeed the technique is quite effective to thwart such analyses, as the commandline doesn t\nshow anything anomalous. Also the payloads are written on disk from a trusted process and\nthis might further prevent detection from certain security solutions.\n\nWe notice that Dridex behavior changed between the 5th and the 9th of June 2020. Before\nthese dates Dridex was adopting a much simpler technique where rundll32.exe was\nlaunched directly.\n\n## Conclusions\n\nAttackers keeps evolving at an incredible pace and they are increasingly more creative in\ntheir approach. Behavioral monitoring and continuous endpoint monitoring help\norganisation remain safe and prevent interruption to business continuity, even when facing\nnew and previously unknown threats or techniques.\n\nWith a large part of the workforce now operating from home, traditional enterprise defense\nsystems are less effective and attention must be pointed towards those devices that are\ntargeted more often. Behavioral monitoring, infrastructural modeling and automated threat\n**[hunting are some of the most important features provided by ReaQta-Hive. Our security](https://reaqta.com/hive)**\nexperts can help if you suspect that your infrastructure has been breached or if you need to\n[step up your cyber security posture, contact us to discuss with our security team.](https://reaqta.com/contact)\n\n## MITRE ATT&CK Techniques\n\n**Execution: T1047, T1204, T1064, T1085**\n\n**Defense Evasion: T1055, T1107, T1064, T1085**\n\n**C2: T1043**\n\nReaQta-Hive MITRE ATT&CK Mapping\n\n## IOC\n\n\n-----\n\n```\nhttps[:]//batriaruum[.]com/dasruol.dll\nhttps[:]//penotorc[.]com/topwin.dll\nca381193229b547475e5724d5ea9f202b92f72836e9ada71ebad288845de2bbf\n7a6e5af86297a254911aff6610aca9bee0fff349434cad5fe76314e51acd66f9\na50a9733f36b1f444efc7336f490d49199f61f34643f9125908bd47b6fcd173b\nc45e738d6348324dac8cfedf451e8cb67b35d2ba2ef4c2f1cb7c004ce88edddd\nfcc719b587b940009970177f33e85f96973983387c3ea19c698c720935d88af4 \n49a686549e78ad7d432af8a8a70973912e569cc1ca1dbe9de49909ed5247c634 \n54d2448355d298c883e885dcf56ee943fa926ba42c46bb8d06722772653619b1 \n84567037059c961a3ad1e6dffdf598a4c887df6d65b31e9257a7de8a75db9440 \n500be83e6624af2302e45bc91e026b776d72824cf84896839e03251c41394110 \n89560994f6d6f2717bcb92d4076704690af2d3df30ca7218fd3482903c9719b8 \n94737e6b49496356b1df987c498bc4e4f07551d803be346d37cbc33d6cb1cf2d\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-06-19 - Dridex- the secret in a PostMessage().pdf"
    ],
    "report_names": [
        "2020-06-19 - Dridex- the secret in a PostMessage().pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536219,
    "ts_updated_at": 1743041370,
    "ts_creation_date": 1653760650,
    "ts_modification_date": 1653760650,
    "files": {
        "pdf": "https://archive.orkl.eu/691e0e6558b1ebcee22985a2179f1a1af2603303.pdf",
        "text": "https://archive.orkl.eu/691e0e6558b1ebcee22985a2179f1a1af2603303.txt",
        "img": "https://archive.orkl.eu/691e0e6558b1ebcee22985a2179f1a1af2603303.jpg"
    }
}