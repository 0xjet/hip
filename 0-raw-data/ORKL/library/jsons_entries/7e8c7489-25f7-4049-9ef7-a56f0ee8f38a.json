{
    "id": "7e8c7489-25f7-4049-9ef7-a56f0ee8f38a",
    "created_at": "2023-01-12T15:08:38.239858Z",
    "updated_at": "2025-03-27T02:05:35.882893Z",
    "deleted_at": null,
    "sha1_hash": "2acf20515fe110082c2c90ca31a1d1584173fe27",
    "title": "2021-12-14 - Network Security Monitoring Opportunities and Best Practices for Log4j Defense",
    "authors": "",
    "file_creation_date": "2022-05-28T19:41:20Z",
    "file_modification_date": "2022-05-28T19:41:20Z",
    "file_size": 139236,
    "plain_text": "# Network Security Monitoring Opportunities and Best Practices for Log4j Defense\n\n**[blog.gigamon.com/2021/12/14/network-security-monitoring-opportunities-and-best-practices-for-log4j-defense/](https://blog.gigamon.com/2021/12/14/network-security-monitoring-opportunities-and-best-practices-for-log4j-defense/)**\n\nDecember 15, 2021\n\n[Home »](https://blog.gigamon.com/) [Threat Research » Network Security Monitoring Opportunities and Best Practices for](https://blog.gigamon.com/category/threat-research/)\nLog4j Defense\n\n[Threat Research / December 14, 2021](https://blog.gigamon.com/category/threat-research/)\n\n[Joe Slowik &nbsp](https://blog.gigamon.com/author/joeslowik/)\n\n[In early December 2021, Apache released a patch to address CVE-2021-44228 in the Log4j](http://cve.mitre.org/cgi-bin/cvename.cgi?name=2021-44228)\nlogging framework library in Java. The vulnerability enables remote code execution (RCE)\nwhen Log4j parses a specially crafted string to retrieve and load follow-on code. After\nrelease, multiple proof of concept (POC) implementations of exploit code became publicly\navailable through various public repositories and social media platforms, resulting in rapid\nimplementation of widespread scanning for this vulnerability and weaponization.\n\n[As of this writing, multiple overviews exist from government](https://www.govcert.ch/blog/zero-day-exploit-targeting-popular-java-library-log4j/) [entities,](https://www.cert.govt.nz/it-specialists/advisories/log4j-rce-0-day-actively-exploited/) [security](https://unit42.paloaltonetworks.com/apache-log4j-vulnerability-cve-2021-44228/) [vendors, and](https://www.trendmicro.com/en_us/research/21/l/patch-now-apache-log4j-vulnerability-called-log4shell-being-acti.html)\nother parties who have published overviews of this vulnerability and its functionality. While\nanalysis is still ongoing, the consensus opinion among multiple researchers and analysts is\nthat this item, given scope and relative ease of exploitation, is of serious concern and will\nrequire ongoing attention and mitigation efforts.\n\n## Implications\n\nLog4j is a logging library built into Java-based frameworks. While not necessarily universal,\nits use and application are widespread for the many applications and services leveraging\nJava resources for functionality. As a result, the potential attack surface for this vulnerability\nis vast – so large that as of this writing its precise implications and reach are yet to be\ndetermined.\n\nSpecifically, concerns center not around Log4j as a service being directly reachable for\npotential attackers, but rather the chain of dependencies from front-line, internet-facing\napplications or APIs to back-end processing using Log4j. For example, an adversary may\ntrigger this vulnerability by placing the embedded exploit string in seemingly harmless\ncontexts – a chat message on an application or a resource request that will fail – but\nbecause these items will be logged and ultimately processed by Log4j behind the scenes,\nthe exploit condition will trigger.\n\n\n-----\n\nLog4j dependencies are often not immediately evident, and in many cases may be difficult to\ndiscern from an end-user perspective. The result is that from an organization’s perspective,\nresolving the problem is not just an issue of patching the Log4j library, but ensuring that\nmultiple other services depending on vulnerable versions of this library are patched as well.\nUntil third-party vendors and application providers also patch their software to include the\nlatest updates in Log4j eliminating this vulnerability, organizations will remain vulnerable\neven if their own internal use of this framework is updated.\n\nGiven the sequence of dependencies, Gigamon ATR anticipates that this vulnerability will\nremain relevant for months, if not years, to come. As software supply chains gradually\nidentify and resolve dependencies, the problem will resolve itself, but will not be completely\nsolved until some point likely far in the future. While concerning, as of this writing exploitation\nof Log4j appears limited to opportunistic or research-oriented scanning, cryptocurrency miner\ninstallation, and variations of [botnets such as Mirai-like installations. Gigamon ATR expects](https://blog.netlab.360.com/threat-alert-log4j-vulnerability-has-been-adopted-by-two-linux-botnets/)\nthat this will inevitably change, if it has not done so already, to include initial access for\ninformation theft, ransomware deployment, and targeted intrusions. Due to the sheer volume\nof scanning and related activity, such attempts may have already occurred but are “hiding”\nwithin the overall noise. Nonetheless, network defenders and IT asset owners must work\ndiligently to begin addressing this threat before it grows completely out of control.\n\n## Potential Pitfalls\n\nThe mechanisms through which CVE-2021-44228 can be exploited remain vast. Since\npublication, researchers have posted multiple variations of POC code to various social media\nand other platforms to demonstrate adaptability and defense evasion. Given the scope,\nseverity, and likely duration of this vulnerability, defenders will require a variety of approaches\nto securing networks before patching can ultimately resolve the issue – but a number of\nthese approaches demonstrate significant issues and if taken in isolation can lead to a false\nsense of security.\n\n### Avoiding an Indicator-Focused Approach\n\nMany organizations, since initial publication of Log4j exploit activity, seek to bolster defense\nby publishing lists of network infrastructure identified in attempted exploitation. Unfortunately,\nthis leads to a variety of issues:\n\nEase of adversary creation or utilization of new infrastructure for multiple phases of\noperations allows for evasion of block or alerting lists.\nDefender inability to differentiate between infrastructure used purely for researchfocused scanning and actual malicious operations to focus response and resources.\nHistorical nature of identified infrastructure, meaning that such items could at best be\nused for analysis of prior exploit attempts but will likely be insufficient for future-oriented\ndefense.\n\n\n-----\n\nWhile indicator ingestion may be valuable for forensic purposes to determine if a known\nentity has probed an environment previously, this approach will be ill-suited to establish\nongoing defense as exploitation continues. Given the ease with which adversaries can\ncreate new infrastructure, the sheer volume of potential malicious endpoints, and the\navailability of multiple services (e.g., dynamic DNS, cloud providers, proxy services, and\nother capabilities) that can obscure the true source of activity, an indicator-based approach\nmay provide some short-term security but ultimately will prove to be a losing game.\nFurthermore, the sheer volume of items identified in both originating traffic and referenced\ninfrastructure hosting exploit payloads mean any block or alert list will rapidly become\nexceedingly long, potentially to the point of causing resource issues, with significant difficulty\nin curating and updating the accuracy of such lists.\n\nDefenders can still utilize reports of malicious infrastructure to determine exposure to or\nextent of past activity but must recognize the limitations of this approach if attempting to\nsecure environments moving forward from the point of reporting. Focusing instead on how\nadversaries are using this vulnerability as opposed to _from where may therefore represent a_\nmore valuable position.\n\n### Understanding Adversary Adaptability\n\nFocusing on attacker implementations of Log4j exploits has its own problems, however.\nSince publication, multiple offensive security researchers identified various ways to “fuzz” or\nalter delivery of the Log4j exploit string to evade content-focused inspection and detections.\nAs a result, static signatures based around the specific content of network traffic can be\neasily evaded and give rise to innumerable possibilities to encode or obfuscate the exploit\npayload.\n\nWhile opportunities still exist to capture “common” implementations of CVE-2021-44228\nexploitation, such activity will likely only encompass low-effort, lower-risk scanning,\nenumeration, and potentially commodity exploitation activity. Although valuable to an extent,\nsuch an approach will likely fail against determined, targeted intrusions willing to invest the\ntime required to modify or obfuscate exploitation activity to evade defensive controls. As\nthese are the most worrying vectors, applying “common” detection logic can lead to a\nmistaken sense of coverage for this threat leaving the most threatening and impactful\nadversaries with inadequate defensive coverage.\n\nAs such, while implementing and monitoring various mechanisms of Log4j exploitation can\nbe useful at point of initial exploitation, defenders must also recognize the limitations of this\napproach. Simply implementing network security monitoring (NSM) signatures for this activity\nrepresents a good step in gaining visibility, but will almost certainly not be sufficient to catch\nall intrusions, especially the most focused or worrisome actors.\n\n### Mapping Attack Surface and Exposure\n\n\n-----\n\nFinally, attack surface identification and reduction are critical for running a security program\nand managing defense irrespective of threat. Defenders must also, however, understand the\nscope and extent of such efforts. In the case of libraries such as Log4j, specific\nimplementations and presence of this artifact are obscured as the item is frequently\nembedded in other commercial products, and its use is not immediately identifiable.\n\nFurthermore, while mapping attack surface is indisputably valuable, on its own it does not\nrepresent a security control as much as it builds security awareness. Actual implementation\nrequires either applying a patch for a given service (if it is even available) or limiting access\nto such a service. For the latter, the unique accessibility of Log4j as a logging framework\nfrequently accepting external input for awareness purposes makes limiting attack surface\nextremely difficult, if not outright impossible in many instances. The complexity of its use and\nembedding within software products and services make the former daunting and mean\nmitigating patches may not be available for weeks, if not months.\n\nDefenders should certainly expend efforts to understand what services their organization\nexposes to external entities and how these might be accessed, but in cases like the Log4j\nissue this represents an intermediate step and not a solution to the problem. Attack surface\nidentification can be used to vector defensive resources, but until effective patches become\navailable for multiple services, ranging from end-user applications to server-side software to\nvarious IOT and ICS products, reducing this surface will be extremely difficult for the\nforeseeable future.\n\n## Detection and Defensive Opportunities\n\nMultiple, seemingly obvious defensive approaches to CVE-2021-44228 feature various\npitfalls and limitations that will leave organizations vulnerable to its exploitation until all\nvulnerable services are fully patched. While no “complete” solution exists at this time,\nmultiple strategies can be employed to reduce the effectiveness of exploitation activity, or to\nidentify its use and application after success. This defense in depth approach, while not\ncompletely removing the threat, can be usefully implemented to improve the security posture\nof organizations until more complete solutions (patches) become available.\n\n### Limiting Exposure and Outbound Communication Channels\n\nFirst, and linked to attack surface mapping and reduction, organizations do retain some\ncontrol over what is allowed into networks, and what communication can leave them. While\ncomplete management may remain impossible without essentially isolating a network from\nthe broader internet, defenders and their organizations retain freedom of movement in\nlimiting the scope and degree of what inbound and outbound communications are possible.\n\nBy first performing or having adequate attack surface management information,\norganizations can then move to limit certain likely attack vectors. For example, many\n[implementations of CVE-2021-44228 activity require retrieving an object via LDAP. While](https://blog.cloudflare.com/inside-the-log4j2-vulnerability-cve-2021-44228/)\n\n\n-----\n\nredirections or other mechanisms of retrieving Java Naming and Directory Interface (JNDI)\nobjects exist (e.g., DNS and Remote Method Invocation mechanisms have also been\nidentified), doing so via LDAP remains a common and direct mechanism for doing so.\nLimiting or monitoring LDAP communications leaving the monitored network can identify\nsuspicious instances of this protocol’s use, which through analytic approaches can be linked\nto attempts to communicate with Log4j services should sufficient visibility and processing\ncapabilities exist.\n\nFurthermore, sanitization and examination of inputs to external facing processes and\nfunctions, while seemingly simple advice, can go a long way to reduce fuzzing and evasion\nopportunities associated with this activity. Although almost certainly not capable of\ncompletely removing possibilities of exploitation, such techniques can reduce such instances\nand when applied in conjunction with other controls produce a more manageable defensive\nposture. Unfortunately, such approaches are seldom achievable as an after-action security\nmeasure, but rather require focused attempts at the application development stage to\nimplement before content is parsed or decoded for ingestion and follow-on execution or use.\n\n### Identifying Post-Exploitation Activities\n\nOnce defenders manage attack surface and limit it as best as possible, subsequent efforts\ncan focus on identifying adversary post-exploitation behaviors. Simply exploiting CVE-202144228 is insufficient to achieve adversary goals – rather, additional functionality is required:\ninstalling a cryptominer, deploying a remote access tool (RAT), or exfiltrating information. At\nthis stage, NSM becomes a vital component in monitoring for and identifying such behaviors.\n\nFurthermore, such approaches are not uniquely relevant for Log4j subversion, but apply to a\nmultitude of initial access vectors such as other exploits or code execution vectors. By\nimplementing robust defenses and detections around post-exploitation behaviors, such as\nlateral movement and command and control (C2) activity, security personnel achieve\ndefense in depth vis a vis multiple, potential threats.\n\nAs part of this process, organizations must ensure they possess and are actively monitoring\ndetections and alerts for post-exploitation activity such as C2 behaviors or indications of\nlateral movement. While in these instances the adversary has already gained access to the\ndefended environment, defenders can ensure more rapid and focused response to mitigate\nand remove the intruder more rapidly, limiting the extent of the incident.\n\n### Profiling Environments to Identify Alterations\n\nFinally, simply understanding one’s environment and knowing what “normal” looks like can\nhelp determine when matters go awry. While Log4j is widespread in application and use, its\nprimary vectors of concern for enterprise environments are server-side applications running\nthis process and making it available indirectly via logging. Understanding which servers and\n\n\n-----\n\napplications are involved are an aspect of earlier discussions around attack surface\nmapping. Determining how these assets function and communicate represents a further step\nin profiling the operating environment.\n\nBy having a means to profile and understand network traffic behaviors over time in monitored\nenvironments, defenders become armed with ways to detect deviations. For example, seeing\nanomalous external network connections from an application or logging server can be a\ntelltale sign of potentially malicious activity, such as active C2 or a reverse shell, and trigger\nfurther investigation.\n\nQuestions like “what is normal” are difficult to answer in the middle of a security incident or\nevent of concern without prior knowledge, though. Defenders must therefore work to build\nthis level of insight, understanding, and recognition in advance and overtime to enable future\nidentification of anomalous or suspicious modifications to asset behavior.\n\n## Conclusion\n\nThe Log4j vulnerability, under active and pervasive exploitation, will likely remain a significant\nissue for security teams for months if not years to come as software dependencies are\nunearthed and patches slowly released. While patching the vulnerability remains the most\neffective and assured way of eliminating this as a potential attack vector, defenders are not\nhelpless in the interim. Multiple approaches exist to address exploitation and follow-on\nadversary activity to ensure continued visibility into and follow-on response to intrusions.\nHowever, network defenders must do so adequately understanding the capabilities and\nlimitations afforded by such mechanisms, as described above, and apply multiple\napproaches to achieve a true defense in depth posture. In such fashion, network security\npersonnel can ensure not just robust defense against items such as CVE-2021-44228, but\nagainst similar events emerging in the future.\n\n## Recommendations for Gigamon Customers\n\nGigamon continues to scope potential impact scenarios from CVE-2021-44228 in internal\n[products and services. Gigamon customers can refer to community portal documentation for](https://community.gigamon.com/gigamoncp/s/article/Are-Gigamon-products-affected-by-CVE-2021-44228)\nthe latest news and updates on Log4j impacts and patching information. Gigamon\nThreatINSIGHT customers can find suggested queries and detection strategies to identify\n[vulnerable software through the notification alert in the web portal.](https://insight.gigamon.com/)\n\n**Featured Webinars**\n\n[Hear from our experts on the latest trends and best practices to optimize your network](https://www.gigamon.com/resources/resource-library/webinar-hub.html?intcid=blog)\nvisibility and analysis.\n\n\n-----\n\nCONTINUE THE DISCUSSION\n\nPeople are talking about this in the Gigamon Community’s [Security group.](https://community.gigamon.com/gigamoncp/s/group/0F91O0000009cNHSAY/security)\n\n**Share your thoughts today**\n\n## RELATED CONTENT\n\nREPORT\n\n2022 Ransomware Defense Report\n\nGET YOUR COPY\n\nWEBINAR\n\nThreatINSIGHT: Eliminating Adversaries’ Dwell Time Advantage\n\nWATCH ON DEMAND\n\nWEBINAR\n\nDeep Dive INSIGHTS: Fighting Ransomware and Shifting Security Priorities\n\nWATCH ON DEMAND\n\nREPORT\n\nGigamon ThreatINSIGHT Guided-SaaS Network Detection and Response\n\nGET YOUR COPY\n\nOLDER ARTICLE\n\n[‘Tap’ping the Myths of Cloud Migration](https://blog.gigamon.com/2021/12/13/tapping-the-myths-of-cloud-migration/)\nNEWER ARTICLE\n\n[The Control Plane’s Evolving 5G Role in Enabling Visibility of the Future](https://blog.gigamon.com/2021/12/15/the-control-planes-evolving-5g-role-in-enabling-visibility-of-the-future/)\n\n\n-----\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-12-14 - Network Security Monitoring Opportunities and Best Practices for Log4j Defense.pdf"
    ],
    "report_names": [
        "2021-12-14 - Network Security Monitoring Opportunities and Best Practices for Log4j Defense.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536118,
    "ts_updated_at": 1743041135,
    "ts_creation_date": 1653766880,
    "ts_modification_date": 1653766880,
    "files": {
        "pdf": "https://archive.orkl.eu/2acf20515fe110082c2c90ca31a1d1584173fe27.pdf",
        "text": "https://archive.orkl.eu/2acf20515fe110082c2c90ca31a1d1584173fe27.txt",
        "img": "https://archive.orkl.eu/2acf20515fe110082c2c90ca31a1d1584173fe27.jpg"
    }
}