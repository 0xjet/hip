{
    "id": "d275b9be-6809-47a0-9305-36d5cd6dc6eb",
    "created_at": "2023-01-12T15:03:49.209377Z",
    "updated_at": "2025-03-27T02:16:26.234234Z",
    "deleted_at": null,
    "sha1_hash": "35b300c60b91fd33818189e10b38e19c011a499c",
    "title": "2019-06-26 - ViceLeaker Operation- mobile espionage targeting Middle East",
    "authors": "",
    "file_creation_date": "2022-05-28T02:04:08Z",
    "file_modification_date": "2022-05-28T02:04:08Z",
    "file_size": 644307,
    "plain_text": "# ViceLeaker Operation: mobile espionage targeting Middle East\n\n**securelist.com/fanning-the-flames-viceleaker-operation/90877/**\n\nAuthors\n\nGReAT\n\nIn May 2018, we discovered a campaign targeting dozens of mobile Android devices belonging to Israeli\ncitizens. Kaspersky spyware sensors caught the signal of an attack from the device of one of the victims; and a\nhash of the APK involved (Android application) was tagged in our sample feed for inspection. Once we looked\ninto the file, we quickly found out that the inner-workings of the APK included a malicious payload, embedded in\nthe original code of the application. This was an original spyware program, designed to exfiltrate almost all\naccessible information.\n\n**Spyware sensors samples feed contained the first sample**\n\nDuring the course of our research, we noticed that we were not the only ones to have found the operation.\n[Researchers from Bitdefender also released an analysis of one of the samples in a blogpost. Although](http://labs.bitdefender.com/2018/08/triout-spyware-framework-for-android-with-extensive-surveillance-capabilities/)\nsomething had already been published, we decided to do something different with the data we acquired. The\nfollowing month, we released a private report on our Threat Intelligence Portal to alert our clients about this\nnewly discovered operation and began writing YARA rules in order to catch more samples. We decided to call\nthe operation “ViceLeaker”, because of strings and variables in its code.\n\n\n-----\n\n## Mobile ViceLeaker\n\nThe following table shows meta information on the observed samples, including compiler timestamps:\n\n**MD5** **Package** **Compiler** **C2**\n\n51df2597faa3fce38a4c5ae024f97b1c com.xapps.SexGameForAdults dexlib 2.x 188.165.28[.]251\n\n2d108ff3a735dea1d1fdfa430f37fab2 com.psiphon3 dexlib 2.x 188.165.49[.]205\n\n7ed754a802f0b6a1740a99683173db73 com.psiphon3 dexlib 2.x 188.165.49[.]205\n\n3b89e5cd49c05ce6dc681589e6c368d9 ir.abed.dastan dexlib 2.x 185.141.60[.]213\n\nTo backdoor legitimate applications, attackers used a Smali injection technique – a type of injection that allows\n[attackers to disassemble the code of original app with the Baksmali tool, add their malicious code, and assemble](https://github.com/JesusFreke/smali)\nit with Smali. As a result, due to such an unusual compilation process, there were signs in the dex file that point\nto dexlib, a library used by the Smali tool to assemble dex files.\n\n**Original code of the APK on the left, versus injected APK on the right**\n\nThe analysis of the APK was rather interesting, because some of the actions were very common spyware\nfeatures, such as the exfiltration of SMS messages, call logs and other data. However, in addition to the\ntraditional functionality, there were also backdoor capabilities such as upload, download, delete files, camera\ntakeover and record surrounding audio.\n\nThe malware uses HTTP for communication with the C2 server for command handling and data exfiltration. Here\nis a command and control protocol fragment:\n\n\n-----\n\n**Commands from C2 server parsing**\n\nIn total, the malicious APK handles 16 different commands:\n\n**Command** **Endpoint** **Description**\n\n1 reqsmscal.php Send specified SMS message\n\n2 reqsmscal.php Call specified number\n\n3 reqsmscal.php Exfiltrate device info, such as phone model and OS version\n\n4 reqsmscal.php Exfiltrate a list of all installed applications\n\n5 reqsmscal.php Exfiltrate default browser history (limited to a given date)\n\n6 reqsmscal.php Exfiltrate Chrome browser history (limited to a given date)\n\n7 reqsmscal.php Exfiltrate memory card file structure\n\n8 reqsmscal.php Record surrounding sound for 80 seconds\n\n\n-----\n\n1 reqcalllog.php Exfiltrate all call logs\n\n2 reqcalllog.php Exfiltrate all SMS messages\n\n3 reqcalllog.php Upload specified file from the device to the C2\n\n4 reqcalllog.php Download file from specified URL and save on device\n\n5 reqcalllog.php Delete specified file\n\n6,7,8 reqcalllog.php Commands not yet implemented\n\n9 reqcalllog.php Take photo (muted audio) with rear camera, send to C2\n\n10 reqcalllog.php Take photo (muted audio) with front camera, send to C2\n\nAll observed samples with Smali injections were signed by the same debug certificate (0x936eacbe07f201df).\n\nAs we know from our investigation, traces of the first development activities were found at the end of 2016, but\nthe main distribution campaign began in 2018 (end of 2017).\n\nBased on our detection statistics, the main infection vector is the spread of Trojanized applications directly to\nvictims via Telegram and WhatsApp messengers. There are the following relevant detection paths (the last one\n[is an alternative Telegram client – “Telegram X“):](https://play.google.com/store/apps/details?id=org.thunderdog.challegram)\n\n**Name** **Detection path**\n\nSex Game For Adults 18.apk /storage/emulated/0/WhatsApp/Media/WhatsApp Documents/\n\n4_6032967490689041387.apk /storage/emulated/0/Telegram/Telegram Documents/\n\nPsiphon-v91.apk /storage/emulated/0/Android/data/org.thunderdog.challegram/files/documents/\n\n## Backdoored Open Source\n\nDuring the course of our analysis, we also found samples sharing code with the ViceLeaker malware, in\nparticular they shared a delimiter that was used in both cases to parse commands from the C2 server.\n\n**Modified Conversations (on the right) code overlap with the Smali injections (left)**\n\n\n-----\n\nThis would be a very unusual coincidence. Even when a false flag might also be a possibility, we consider this to\nbe unlikely.\n\n[The samples sharing this overlap are modified versions of an open source Jabber/XMPP client called](https://github.com/siacs/Conversations/)\n“Conversations” with some code additions. The legitimate version of this app is also available on Google Play.\n\n**Screenshot of Conversations app on Google Play**\n\nThe Conversations modified samples differ from the original one in the getKnownHosts method that was\nmodified to replace the main XMPP host with the attackers’ C2 server:\n\n\n-----\n\n**Comparison of the original “getKnownHosts” method (from Github) and the modified one**\n\nIt appears that the attackers were using a specific C2 for the use of that app. Another important modification is in\nthe message transfer process:\n\n**Comparison of the original Conversations method with the modified once**\n\nWith this modification, an application sends device location coordinates with every message.\n\nThere are also many other modifications, fully described in our private report. In addition, we did not see traces\nof the Smali injection. In this case we found traces of dx/dexmerge compilers, which means that, this time, the\nattackers just imported the original source code into an Android IDE (such as Android Studio, for instance) and\ncompiled it with their own modifications.\n\n\n-----\n\n**dx/dexmerge compiler of the modified Conversations samples**\n\nIn addition to adding the code, the attackers also changed the icon and package name. We do not know why, but\nwe suspect that it was an attempt to hide the origin of the application.\n\n**Conversations-based app mimics Telegram messenger**\n\nEven when we originally thought this was a backdoored version of the Conversations app, used to infect victims,\nwe didn´t discovered anything malicious in it. This brought to us the hypothesis that this might be a version used\nby the group behind ViceLeaker for internal communication or for other, unclear purposes. All the detections of\nthis backdoored app were geolocated in Iran.\n\n## Backdoored Conversations C2 server analysis\n\nDuring the analysis of the Smali injected apps and their C2 server infrastructure we hadn’t found any interesting\nclues, but things changed when we looked at the C2 server of the linked Conversations messenger. It uses\n“185.51.201[.]133” as a main C2 address, and there is only one domain that is hosted on this dedicated server –\niliageram[.]ir. Note that we later found versions that used the domain as a C2 directly instead of the IP address.\nThe record contains a personal email address:\n\n**WHOIS records of C2 server exposing the attacker’s email address**\n\n\n-----\n\nWe were aware of the possibility that the attackers might be using a compromised email account, so we dug\ndeeper to find more information related to this email address. A quick search produced results about a personal\npage and, what is more interesting, a GitHub account that contains a forked Conversation repository.\n\n**Related Github account contains forked Conversations repository**\n\nSummarizing all the found clues, we have the following attribution flow:\n\n## Conclusion\n\nThe operation of ViceLeaker is still ongoing, as is our research. The attackers have taken down their\ncommunication channels and are probably looking for ways to assemble their tools in a different manner.\nKaspersky detects and blocks samples of the ViceLeaker operation using the following verdict: Trojan**Spy.AndroidOS.ViceLeaker.***\n\nActually, we are currently investigating whether this group might also be behind a large-scale web-oriented\nattack at the end of 2018 using code injection and exploiting SQL vulnerabilities. Even when this would not be\ndirectly related to the Android malware described in this blogpost, it would be an indicator of wider capabilities\n\n\n-----\n\nand objectives of this actor.\n\n[For more information about the ViceLeaker operation, contact us at: intelreports@kaspersky.com](http://10.10.0.46/mailto:intelreports@kaspersky.com)\n\n[Backdoor](https://securelist.com/tag/backdoor/)\n[Code injection](https://securelist.com/tag/code-injection/)\n[Instant Messengers](https://securelist.com/tag/instant-messengers/)\n[Mobile Malware](https://securelist.com/tag/mobile-malware/)\n[Targeted attacks](https://securelist.com/tag/targeted-attacks/)\n[Trojan](https://securelist.com/tag/trojan/)\n[Vulnerabilities and exploits](https://securelist.com/tag/vulnerabilities-and-exploits/)\n\nAuthors\n\nGReAT\n\nViceLeaker Operation: mobile espionage targeting Middle East\n\nYour email address will not be published. Required fields are marked *\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-06-26 - ViceLeaker Operation- mobile espionage targeting Middle East.pdf"
    ],
    "report_names": [
        "2019-06-26 - ViceLeaker Operation- mobile espionage targeting Middle East.pdf"
    ],
    "threat_actors": [
        {
            "id": "e0b6d3fa-157c-45bf-b9e3-3aa9f9aa7de7",
            "created_at": "2022-10-25T16:07:24.024256Z",
            "updated_at": "2025-03-27T02:02:10.08381Z",
            "deleted_at": null,
            "main_name": "Operation ViceLeaker",
            "aliases": [],
            "source_name": "ETDA:Operation ViceLeaker",
            "tools": [
                "Triout",
                "ViceLeaker"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "b960c826-adff-49e8-97aa-017ceab56776",
            "created_at": "2023-01-06T13:46:39.036244Z",
            "updated_at": "2025-03-27T02:00:02.982733Z",
            "deleted_at": null,
            "main_name": "ViceLeaker",
            "aliases": [],
            "source_name": "MISPGALAXY:ViceLeaker",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "8941e146-3e7f-4b4e-9b66-c2da052ee6df",
            "created_at": "2023-01-06T13:46:38.402513Z",
            "updated_at": "2025-03-27T02:00:02.824555Z",
            "deleted_at": null,
            "main_name": "Sandworm",
            "aliases": [
                "G0034",
                "IRIDIUM",
                "Blue Echidna",
                "FROZENBARENTS",
                "Seashell Blizzard",
                "IRON VIKING",
                "ELECTRUM",
                "TeleBots",
                "UAC-0113",
                "UAC-0082",
                "APT44",
                "Quedagh",
                "VOODOO BEAR",
                "TEMP.Noble"
            ],
            "source_name": "MISPGALAXY:Sandworm",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "7bd810cb-d674-4763-86eb-2cc182d24ea0",
            "created_at": "2022-10-25T16:07:24.1537Z",
            "updated_at": "2025-03-27T02:02:10.126127Z",
            "deleted_at": null,
            "main_name": "Sandworm Team",
            "aliases": [
                "APT 44",
                "ATK 14",
                "BE2",
                "Blue Echidna",
                "CTG-7263",
                "FROZENBARENTS",
                "IRIDIUM",
                "Iron Viking",
                "Quedagh",
                "Sandworm",
                "Sandworm Team",
                "Seashell Blizzard",
                "TEMP.Noble",
                "UAC-0082",
                "UAC-0113",
                "UAC-0125",
                "UAC-0133",
                "Voodoo Bear"
            ],
            "source_name": "ETDA:Sandworm Team",
            "tools": [
                "AWFULSHRED",
                "ArguePatch",
                "BIASBOAT",
                "Black Energy",
                "BlackEnergy",
                "CaddyWiper",
                "Colibri Loader",
                "Cyclops Blink",
                "CyclopsBlink",
                "DCRat",
                "DarkCrystal RAT",
                "Fobushell",
                "GOSSIPFLOW",
                "Gcat",
                "IcyWell",
                "Industroyer2",
                "JaguarBlade",
                "JuicyPotato",
                "Kapeka",
                "KillDisk.NCX",
                "LOADGRIP",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "ORCSHRED",
                "P.A.S.",
                "PassKillDisk",
                "Pitvotnacci",
                "PsList",
                "QUEUESEED",
                "RansomBoggs",
                "RottenPotato",
                "SOLOSHRED",
                "SwiftSlicer",
                "VPNFilter",
                "Warzone",
                "Warzone RAT",
                "Weevly"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535829,
    "ts_updated_at": 1743041786,
    "ts_creation_date": 1653703448,
    "ts_modification_date": 1653703448,
    "files": {
        "pdf": "https://archive.orkl.eu/35b300c60b91fd33818189e10b38e19c011a499c.pdf",
        "text": "https://archive.orkl.eu/35b300c60b91fd33818189e10b38e19c011a499c.txt",
        "img": "https://archive.orkl.eu/35b300c60b91fd33818189e10b38e19c011a499c.jpg"
    }
}