{
    "id": "4169ca39-9070-4672-b1da-fb17776b8f9e",
    "created_at": "2023-01-12T15:04:29.601623Z",
    "updated_at": "2025-03-27T02:17:27.653284Z",
    "deleted_at": null,
    "sha1_hash": "af1e2d4b13d4b6dbcb00e4a8db98f53e4fa0d50f",
    "title": "2017-04-27 - Iranian Fileless Attack Infiltrates Israeli Organizations",
    "authors": "",
    "file_creation_date": "2022-05-28T01:57:12Z",
    "file_modification_date": "2022-05-28T01:57:12Z",
    "file_size": 1181922,
    "plain_text": "# Iranian Fileless Attack Infiltrates Israeli Organizations\n\n**[blog.morphisec.com/iranian-fileless-cyberattack-on-israel-word-vulnerability](http://blog.morphisec.com/iranian-fileless-cyberattack-on-israel-word-vulnerability)**\n\n[Tweet](https://twitter.com/share)\n\n\n-----\n\n## INTRODUCTION\n\nFrom April 19-24, 2017, a politically motivated, targeted campaign was carried out against\nnumerous Israeli organizations. Morphisec researchers began investigating the attacks on April\n24 and continue to uncover more details. Initial reports of the attacks, published April 26 (in\nHebrew) by the Israel National Cyber Event Readiness Team (CERT-IL) and [The Marker, confirm](http://www.themarker.com/technation/1.4049930)\nthat the attack was delivered through compromised email accounts at Ben-Gurion University and\nsent to multiple targets across Israel. Ironically, Ben-Gurion University is home to Israel’s Cyber\nSecurity Research Center. Investigators put the origin of the attack as Iranian; Morphisec’s\nresearch supports this conclusion and attributes the attacks to the same infamous hacker group\nresponsible for the OilRig malware campaigns.\n\nThe fileless attack was delivered via Microsoft Word documents that exploited a former zeroday vulnerability in Word, CVE-2017-0199, to install a fileless attack variant of the Helminth\nTrojan agent. Microsoft released the patch for the vulnerability on April 11, but many\norganizations have not yet deployed the update. The attackers actually based their attack on an\nexisting Proof-of-Concept method that was published by researchers after the patch release.\n\nBy hunting through known malware repositories, Morphisec identified matching samples\nuploaded by Israeli high-tech development companies, medical organizations, and education\norganizations, indicating that they were victims of the attack. For security purposes, Morphisec is\nnot revealing these names.\n\n\n-----\n\nThe delivery was executed by compromising the email accounts of a few high-profile individuals\nat Ben-Gurion University. The Word document was sent as a reply to legitimate emails sent from\nthose accounts and was propagated to more than 250 individuals in different Israeli companies,\naccording to CERT-IL.\n\nUpon deeper investigation into the installed Helminth fileless agent, we identified a near-perfect\nmatch to the OilRig campaign executed by an Iranian hacker group against 140 financial\ninstitutions in the Middle East last year, as analyzed by [FireEye, Palo Alto Networks and](https://www.fireeye.com/blog/threat-research/2016/05/targeted_attacksaga.html)\n[Logrhythm. This group has become one of the most active threat actors, with noteworthy abilities,](https://logrhythm.com/oilrig-campaign-analysis-threat-research/)\nresources, and infrastructure; speculations indicate the hacking organization to be sponsored by\nthe Iranian government. In other recent attacks (January 2017), the group used a fake Juniper\nNetworks VPN portal and fake University of Oxford websites to deliver malware as described by\n[ClearSky.](http://www.clearskysec.com/oilrig/)\n\nOur report presents the technical details of the attack, emphasizing differences from last year’s\nattack. In particular, there are several enhancements to different evasive mechanisms and some\nmodifications in the communications protocol, which delivers PowerShell commands from the\nC&C.\n\nThe most important difference is that the use of macros was exchanged with a vulnerability\nexploit. With their ability to set up the attack in a relatively short time, the threat actors could\ncorrectly speculate that their window of opportunity between patch release and patch rollout was\nstill open.\n\nAt the time of publication, the C&C servers are still active and will be listed herein as all other\nsignatures and indicators of compromise.\n\n## TECHNICAL ANALYSIS\n\n**Word Delivery**\n\nThe different delivered documents, as shown below, are generally named with some random\nnumber <random number>.doc.\n\n\n-----\n\nMorphisec identified the following set of documents:\n\n**Name** **SHA256**\n\n13.doc a9bbbf5e4797d90d579b2cf6f9d61443dff82ead9d9ffd10f3c31b686ccf81ab\n\n\n558.doc,\n2.doc\n\n\n2869664d456034a611b90500f0503d7d6a64abf62d9f9dd432a8659fa6659a84\n\n\n1.doc 832cc791aad6462687e42e40fd9b261f3d2fbe91c5256241264309a5d437e4d8\n\n3.doc d4eb4035e11da04841087a181c48cd85f75c620a84832375925e6b03973d8e48\n\n**CVE-2017-0199 Vulnerability Exploit**\n\nThe most notable difference from last year’s OilRig campaign is the way the attack was\ndelivered. In the previous campaign, the Iranian group sent specially crafted Excel and Word\nfiles, which contained macros that targeted individuals were convinced to enable.\n\n**In this campaign, no macros were required. Each document utilized the vulnerability by an**\n**embedded link that delivers an .hta file (html executable).**\n\n\n-----\n\nMorphisec identified the following delivered test<number>.hta file with the same signature\ndelivered from the following domains:\n\n**Name** **Delivery Server**\n\n**test4.hta** hxxp://comonscar[.]in (82.145.40.46)\n\n**test5.hta** 80.82.67.42\n\n**test1.hta** reserved\n\nSHA256: 5ac61ea5142d53412a251eb77f2961e3334a00c83da9087d355a49618220ac43\n\nThe .hta file is immediately executed by mshta.exe, the Windows process which executes html\nexecutables. As a result, the user is usually shown a warning message, despite the fact that the\nHTA is still executed even if the user chooses “No”:\n\nThe .hta file in this attack is much more sophisticated than in previous versions and actually\ndisables this message by sending an “Enter” command to the warning window. This is covered in\nthe next section.\n\n**HTA Execution and Persistency**\n\nThe HTA execution goes through the following steps:\n\n\n-----\n\n1. Before installing the agent, the .hta file sends the Enter key into the Word application to\n\nremove the warning message and minimize any appearance of suspicious execution. It is\ndone by creating and executing a 1.vbs script.\n\n1. The next step writes and executes the 0011.ps1 PowerShell script, which is described in\n\nthe following section.\n\n1. The last step kills the original process that activated the .hta file, to remove any suspicion.\n\n**Helminth Trojan Installation and Persistency**\n\n0011.ps1 script, which is activated by the .hta file, is in charge of generating the Helminth Trojan\nPowerShell and VBS files.\n\n**Name** **SHA256**\n\n\n-----\n\n**0011.ps1** 042F60714E9347DB422E1A3A471DC0301D205FFBD053A4015D2B509DB92029D1\n\n**1.vbs** BE7F1D411CC4160BB221C7181DA4370972B6C867AF110C12850CAD77981976ED\n\nMorphisec identified the following structure:\n\n[This structure matches the attack structure from October 2016, as described by Logrhythm:](https://logrhythm.com/oilrig-campaign-analysis-threat-research/)\n\nAside from the unique generation of the files, the structure and the functionality of the trojan is\nvery similar to the previous campaign:\n\n\n-----\n\n1. The PowerShell script ps1 creates similar variants of Helminth trojan PowerShell and VBS\n\nfiles templates (DnS1.Ps1, DnE1.Ps1, backup1.vbs). Those templates are regenerated on\nthe infected computer by replacement of all variables and function names to random names\nin order to slow down detection and remediation.\n\n1. All the scripts are installed in the Public\\Libraries\\RecordedTV\\ folder.\n2. As in the previous campaign, persistency is achieved by adding a schedule task with a\n\nsimilar name to the Google update task (“GoogleUpdateTasksMachineUI”), which\nexecutes vbs every 3 minutes:\n\nNote: All the parameters in the 0011.ps1 script can be reconfigured, therefore some of the\nnames could be different for the tasks and locations.\n\n**Communication Protocol**\n\nWe will focus here on the DnE1.Ps1 file because all other files are almost identical to the\nprevious campaign. This file executes some of the same commands executed by VBS script in\nthe previous campaign, but there are differences as well. The script connects to a C&C server –\n**vpsupdate[.]tk. At the time of this report’s publication, the C&C server is still live; the server**\nwas first registered on April 16, 2017. The goal of the script is to:\n\n\n-----\n\nDownload bat script\nExecute it and upload the results back to the C&C\nClear traces\n\nAt each new activation (first) activation of the download command (GET request), the infected\ncomputer receives a bat script for activation from the C&C:\n\n**vpsupdate[.]tk/index.aspx?id=<random character><randomnumber>[b] (the “b” is for**\ndownload)\n\nThe file name of the bat script is then delivered through the response headers, and the content of\nthe bat script is delivered through the response. Both of them are encoded in base 64.\n\nThe name of the file is default.bat (decoded from Content-Disposition property in the header) and\nit is saved temporary in the dn folder (described in the next section).\n\nNote: Morphisec identified several other samples of communication with different C&C servers\n**(“alenupdate[.]info” and “maralen[.]tk”) in which a more advanced customized version of**\nMimikatz was sent to specific users, and an additional agent was installed in the “C:\\Program\n\n\n-----\n\n**Files (x86)\\Microsoft Idle\\ directory:**\n\nBack to the popular variant of the protocol: As soon as the file executes and the resulting output\nis written to default.bat.txt (similarly to the previous campaign), the resulting file is uploaded back\nto the C&C using the following URL command (POST request):\n\n**vpsupdate[.]tk/index.aspx?id=<random character><randomnumber>[u] (the “u” is for**\nupload)\n\n\n-----\n\nAt the same time, the DnE1.Ps1 is executed. The DnS1.Ps1 is also executed and communicates\nwith the C&C using DNS exchange queries (the same as in the previous campaign). This kind of\ncommunication is very hard to block since DNS is a basic functionality required in any\norganization.\n\n**Delivered Commands**\n\nThe bat script is a customized version of Mimikatz (with slight modification from the last\ncampaign). Its goal is to gather information from the computer and the network:\n\nThe added commands are chcp to handle non-ASCII characters (e.g. Hebrew) and the validation\nof the scheduled task (which should have been added by the persistency mechanism).\n\nAs mentioned in the previous section, Morphisec identified an advanced version of the same bat\nscript communicating with the alenupdate[.]info C&C. In that case, the information that is\ngathered includes A.V., Firewall, and AntiSpy product information. The persistent tasks are\nslightly different as well, “Google Update Core” and “Google Sync Core”.\n\n\n-----\n\n## Remediation\n\n1. The scheduled task “GoogleUpdateTasksMachineUI” should be removed. Note that\n\nregular Google update tasks look like GoogleUpdateTask[Machine|User]* without the “s” in\n**Tasks).**\n\n1. In case “Google Update Core” or “Google Sync Core” exists, those need to be\n\nremoved as well.\n2. Access Public\\Libraries\\RecordedTV folder. Note that the Libraries folder in Public is\n\nhidden, and you should delete the folder and not the RecordedTV icon – if you have only\nthe icon, then the agent is not installed.\n3. If the following directory exists, remove it: “Program Files(x86)\\Microsoft Idle”\n4. If the following directory contains “WinInit.lnk” or “SyncInit.lnk” files, remove those files:\n\n**“%userprofile%\\AppData\\Roaming\\Microsoft\\Windows\\Start**\n**Menu\\Programs\\Startup”**\n\n## Conclusion\n\n\n-----\n\nEvery few years, a new logic bug CVE in OLE object linking is identified; the previous one was\nthree years ago (CVE-2014-4114 and CVE-2014-6352). This kind of vulnerability is rare but\npowerful. It allows attackers to embed OLE objects (or links in the case of CVE-2017-0199) and\nbypass Microsoft validation of OLE execution without warning. In essence, it is the same as\nplaying animation in PowerPoint.\n\n**Such vulnerabilities should be patched immediately.**\n\nIt is significant to note how the Iranian threat actors advanced their abilities in such a short time:\n\nUtilizing a vulnerability PoC immediately after its publication\nSetting up the required infrastructure with multiple domains and delivery servers\nIncreasing the sophistication of the delivered Helminth agent, including regeneration of its\nsignatures on the infected computer\nImproving the customized information gathering Mimikatz version\n\nWith many organizations taking high-risk vulnerabilities seriously and patching them as quickly as\npossible, attackers can no longer exploit them for an extended period of time. We, therefore,\nexpect that threat actors will return to macro-based campaigns like Hancitor.\n\n## Indicators of Compromise (IOCs)\n\n**Document delivery**\n\n**Name** **SHA256**\n\n**13.doc** a9bbbf5e4797d90d579b2cf6f9d61443dff82ead9d9ffd10f3c31b686ccf81ab\n\n\n**558.doc,**\n**2.doc**\n\n\n2869664d456034a611b90500f0503d7d6a64abf62d9f9dd432a8659fa6659a84\n\n\n**1.doc** 832cc791aad6462687e42e40fd9b261f3d2fbe91c5256241264309a5d437e4d8\n\n**3.doc** d4eb4035e11da04841087a181c48cd85f75c620a84832375925e6b03973d8e48\n\n**HTA delivery servers:**\n\n**hxxp://comonscar[.]in (82.145.40.46)**\n\n**80.82.67.42**\n\n**HTA files:**\n\n\n-----\n\n**Name** **SHA256**\n\n\n**test4.hta,**\n**test5.hta**\n\n\n5ac61ea5142d53412a251eb77f2961e3334a00c83da9087d355a49618220ac43\n\n\n**Helminth Trojan Installers:**\n\n**Name** **SHA256**\n\n**0011.ps1** 042F60714E9347DB422E1A3A471DC0301D205FFBD053A4015D2B509DB92029D1\n\n**1.vbs** BE7F1D411CC4160BB221C7181DA4370972B6C867AF110C12850CAD77981976ED\n\n**C&C:**\n\n**Name**\n\nvpsupdate[.]tk\n\nalenupdate[.]info\n\nMaralen[.]tk\n\n**Persistency:**\n\n**Task Name**\n\nGoogleUpdateTasksMachineUI\n\nGoogle Update Core\n\nGoogle Sync Core\n\nCERT-IL has listed additional IoCs that are not mentioned in this list, which includes the January\ncampaign that involved malicious Juniper Networks VPN and fake Oxford registration form\nexecutables and their C&C domain server.\n\n[Contact SalesInquire via Azure](http://10.10.0.46/mailto:sales@morphisec.com)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-04-27 - Iranian Fileless Attack Infiltrates Israeli Organizations.pdf"
    ],
    "report_names": [
        "2017-04-27 - Iranian Fileless Attack Infiltrates Israeli Organizations.pdf"
    ],
    "threat_actors": [
        {
            "id": "c4bc6ac9-d3e5-43f1-9adf-e77ac5386788",
            "created_at": "2022-10-25T15:50:23.722608Z",
            "updated_at": "2025-03-27T02:00:55.533377Z",
            "deleted_at": null,
            "main_name": "Thrip",
            "aliases": [
                "Thrip"
            ],
            "source_name": "MITRE:Thrip",
            "tools": [
                "PsExec",
                "Mimikatz",
                "Catchamas"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "cffb3c01-038f-4527-9cfd-57ad5a035c22",
            "created_at": "2022-10-25T15:50:23.38055Z",
            "updated_at": "2025-03-27T02:00:55.459558Z",
            "deleted_at": null,
            "main_name": "OilRig",
            "aliases": [
                "COBALT GYPSY",
                "IRN2",
                "APT34",
                "Helix Kitten",
                "Evasive Serpens",
                "Hazel Sandstorm",
                "EUROPIUM",
                "ITG13"
            ],
            "source_name": "MITRE:OilRig",
            "tools": [
                "ISMInjector",
                "RDAT",
                "Systeminfo",
                "QUADAGENT",
                "OopsIE",
                "Tasklist",
                "certutil",
                "ZeroCleare",
                "POWRUNER",
                "netstat",
                "ipconfig",
                "LaZagne",
                "BONDUPDATER",
                "SideTwist",
                "PsExec",
                "SEASHARPEE",
                "Mimikatz",
                "RGDoor",
                "ftp"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "67709937-2186-4a32-b64c-a5693d40ac77",
            "created_at": "2023-01-06T13:46:38.495593Z",
            "updated_at": "2025-03-27T02:00:02.848206Z",
            "deleted_at": null,
            "main_name": "OilRig",
            "aliases": [
                "IRN2",
                "Hazel Sandstorm",
                "EUROPIUM",
                "TA452",
                "Earth Simnavaz",
                "Cobalt Gypsy",
                "Crambus",
                "Helix Kitten",
                "APT 34",
                "APT34",
                "ATK40",
                "G0049",
                "Evasive Serpens",
                "Twisted Kitten"
            ],
            "source_name": "MISPGALAXY:OilRig",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "eaa8168f-3fab-4831-aa60-5956f673e6b3",
            "created_at": "2022-10-25T16:07:23.805824Z",
            "updated_at": "2025-03-27T02:02:09.986613Z",
            "deleted_at": null,
            "main_name": "Lotus Blossom",
            "aliases": [
                "ATK 1",
                "ATK 78",
                "Billbug",
                "Bronze Elgin",
                "CTG-8171",
                "Dragonfish",
                "Lotus Blossom",
                "Operation Lotus Blossom",
                "Red Salamander",
                "Spring Dragon",
                "Thrip"
            ],
            "source_name": "ETDA:Lotus Blossom",
            "tools": [
                "BKDR_ESILE",
                "Catchamas",
                "EVILNEST",
                "Elise",
                "Group Policy Results Tool",
                "Hannotog",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Mimikatz",
                "PsExec",
                "Rikamanu",
                "Sagerunex",
                "Spedear",
                "Syndicasec",
                "WMI Ghost",
                "Wimmie",
                "gpresult"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "a0548d4e-edc2-40c1-a4e2-c1d6103012eb",
            "created_at": "2023-01-06T13:46:38.793461Z",
            "updated_at": "2025-03-27T02:00:02.920553Z",
            "deleted_at": null,
            "main_name": "Thrip",
            "aliases": [
                "G0076",
                "ATK78"
            ],
            "source_name": "MISPGALAXY:Thrip",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "8f9c8a6e-f6b6-431b-bedd-94fdeea5474a",
            "created_at": "2024-05-01T02:03:08.022974Z",
            "updated_at": "2025-03-27T02:05:17.310877Z",
            "deleted_at": null,
            "main_name": "COBALT GYPSY",
            "aliases": [
                "CHRYSENE ",
                "Crambus ",
                "EUROPIUM ",
                "Hazel Sandstorm ",
                "Helix Kitten ",
                "ITG13 ",
                "OilRig ",
                "Yellow Maero ",
                "APT34 "
            ],
            "source_name": "Secureworks:COBALT GYPSY",
            "tools": [
                " Helminth",
                " Jason",
                " MacDownloader",
                " PoisonFrog",
                " RGDoor",
                " ThreeDollars",
                " TinyZbot",
                " Toxocara",
                " Trichuris",
                " TwoFace",
                "Glimpse"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "b6436f7b-6012-4969-aed1-d440e2e8b238",
            "created_at": "2022-10-25T16:07:23.91517Z",
            "updated_at": "2025-03-27T02:02:10.027531Z",
            "deleted_at": null,
            "main_name": "OilRig",
            "aliases": [
                "APT 34",
                "ATK 40",
                "Chrysene",
                "Cobalt Gypsy",
                "Crambus",
                "DEV-0861",
                "EUROPIUM",
                "Earth Simnavaz",
                "Evasive Serpens",
                "Hazel Sandstorm",
                "Helix Kitten",
                "IRN2",
                "ITG13",
                "Scarred Manticore",
                "Storm-0861",
                "TA452",
                "Twisted Kitten",
                "UNC1860",
                "Yellow Maero"
            ],
            "source_name": "ETDA:OilRig",
            "tools": [
                "AMATIAS",
                "Agent Drable",
                "Agent Injector",
                "AgentDrable",
                "Alma Communicator",
                "BONDUPDATER",
                "CACTUSPIPE",
                "Clayslide",
                "CypherRat",
                "DNSExfitrator",
                "DNSpionage",
                "DROPSHOT",
                "DistTrack",
                "DropperBackdoor",
                "Fox Panel",
                "GREYSTUFF",
                "GoogleDrive RAT",
                "HighShell",
                "HyperShell",
                "ISMAgent",
                "ISMDoor",
                "ISMInjector",
                "Jason",
                "Karkoff",
                "LIONTAIL",
                "LOLBAS",
                "LOLBins",
                "LONGWATCH",
                "LaZagne",
                "Living off the Land",
                "MailDropper",
                "Mimikatz",
                "MrPerfectInstaller",
                "OILYFACE",
                "OopsIE",
                "POWBAT",
                "POWRUNER",
                "Plink",
                "Poison Frog",
                "PowerExchange",
                "PsList",
                "PuTTY Link",
                "QUADAGENT",
                "RDAT",
                "RGDoor",
                "SEASHARPEE",
                "Saitama",
                "Saitama Backdoor",
                "Shamoon",
                "SideTwist",
                "SpyNote",
                "SpyNote RAT",
                "StoneDrill",
                "TONEDEAF",
                "TONEDEAF 2.0",
                "ThreeDollars",
                "TwoFace",
                "VALUEVAULT",
                "Webmask",
                "WinRAR",
                "ZEROCLEAR",
                "ZeroCleare",
                "certutil",
                "certutil.exe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535869,
    "ts_updated_at": 1743041847,
    "ts_creation_date": 1653703032,
    "ts_modification_date": 1653703032,
    "files": {
        "pdf": "https://archive.orkl.eu/af1e2d4b13d4b6dbcb00e4a8db98f53e4fa0d50f.pdf",
        "text": "https://archive.orkl.eu/af1e2d4b13d4b6dbcb00e4a8db98f53e4fa0d50f.txt",
        "img": "https://archive.orkl.eu/af1e2d4b13d4b6dbcb00e4a8db98f53e4fa0d50f.jpg"
    }
}