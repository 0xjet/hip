{
    "id": "802d6142-1f67-41ac-b02f-7b27ead0a9c8",
    "created_at": "2023-03-03T02:05:50.490562Z",
    "updated_at": "2025-03-27T02:16:50.85571Z",
    "deleted_at": null,
    "sha1_hash": "9a4e55d7db8018b787534e9122f67aa85b4e0186",
    "title": "2022-12-12 - Precious Gemstones- The New Generation of Kerberos Attacks",
    "authors": "",
    "file_creation_date": "2023-03-01T09:21:04Z",
    "file_modification_date": "2023-03-01T09:21:04Z",
    "file_size": 1794190,
    "plain_text": "# Precious Gemstones: The New Generation of Kerberos Attacks\n\n**[unit42.paloaltonetworks.com/next-gen-kerberos-attacks/](https://unit42.paloaltonetworks.com/next-gen-kerberos-attacks/)**\n\nOz Soprin, Shachar Roitman December 12, 2022\n\nBy [Oz Soprin and](https://unit42.paloaltonetworks.com/author/oz-soprin/) [Shachar Roitman](https://unit42.paloaltonetworks.com/author/shachar-roitman/)\n\nDecember 12, 2022 at 6:00 AM\n\n[Category: Threat Briefs and Assessments](https://unit42.paloaltonetworks.com/category/threat-briefs-assessments/)\n\nTags: [Cortex XDR,](https://unit42.paloaltonetworks.com/tag/cortex-xdr/) [Diamond Ticket,](https://unit42.paloaltonetworks.com/tag/diamond-ticket/) [Golden Ticket,](https://unit42.paloaltonetworks.com/tag/golden-ticket/) [kerberos,](https://unit42.paloaltonetworks.com/tag/kerberos/) [privilege escalation,](https://unit42.paloaltonetworks.com/tag/privilege-escalation/) Sapphire\nTicket\n\nThis post is also available in: 日本語 [(Japanese)](https://unit42.paloaltonetworks.jp/next-gen-kerberos-attacks/)\n\n## Executive Summary\n\nUnit 42 researchers show new detection methods that help improve detection of a new line\nof Kerberos attacks, which allow attackers to modify Kerberos tickets to maintain privileged\naccess. The most well-known example of this is the Golden Ticket attack, which allows threat\nactors to forge a ticket to masquerade as a high-privileged user.\n\n\n-----\n\nThese two newer attacks extend the Golden Ticket attack in that the forged tickets are not\ncreated from scratch, but instead based on modifying an existing ticket to include highprivileged access. We’ll discuss the difference between these three types of attacks, to\nexplain why the newer ones are harder to detect.\n\nThe broad usage of Active Directory has made Kerberos attacks the bread and butter of\nmany threat actors. Researchers have discovered the following new attack techniques that\nallow an adversary to gain unconstrained access to all services and resources within an\nActive Directory (AD) domain:\n\nDiamond Ticket\nSapphire Ticket\n\nBecause of their similarity to the well-known Golden Ticket attack, threat actors might also\nuse these attacks in future campaigns. People can better protect themselves by employing\nthe new detection methods we’ll discuss for these new Kerberos attacks.\n\nPalo Alto Networks customers receive improved detection for the attacks discussed in this\nblog through Cortex XDR.\n\n**Related Unit 42 Topics** [privilege escalation,](https://unit42.paloaltonetworks.com/tag/privilege-escalation/) [Golden Ticket,](https://www.paloaltonetworks.com/blog/tag/golden-ticket/) [Kerberos](https://unit42.paloaltonetworks.com/tag/kerberos/)\n\n## Table of Contents\n\nKerberos Refresher\n\nWhat Components Are in a Kerberos Ticket?\n\nWhat is a Kerberos Privilege Attribute Certificate (PAC)?\n\nKerberos Delegation\n\nS4U2Self Extension\n\nU2U Authentication\n\nU2U + S4U2Self\n\nHow Do These Kerberos Attacks Work?\n\nSapphire Ticket\n\nDiamond Ticket\n\nHow Powerful Are the New Kerberos Attacks?\n\nWhat’s the Difference Between a Diamond Ticket and a Sapphire Ticket Attack?\n\nCan Anyone Forge TGTs?\n\nForged Ticket Attacks in the Wild\n\nProposing Detection Methods for Forged Ticket Attacks\n\nSapphire Ticket\n\nDiamond Ticket\n\nGenerating a Ticket for Domain Admin Account\nElevating Normal Domain User’s Privileges\n\n\n-----\n\nGroup Membership Detection\nConclusion\n\nAdditional Resources\n\nAppendix: Glossary\n\n## Kerberos Refresher\n\nTo understand the ticket attacks and their implications, it helps to understand a few things\nabout how Kerberos works. This includes some common terms for features used in these\nattacks, as well as the structure of how tickets are used.\n\n[Kerberos is a network authentication protocol that is primarily used in Active Directory (AD)](https://en.wikipedia.org/wiki/Kerberos_(protocol))\n[environments. Thousands of companies across different industries use Active Directory](https://discovery.hgdata.com/product/microsoft-active-directory)\ntechnology for managing user accounts and other resources within an organization. Active\nDirectory’s first version was released in Windows Server 2000 and since then, it has become\nparticularly common in businesses and other large organizations that have a significant\nnumber of users and resources to manage.\n\nKerberos provides strong authentication by issuing tickets to authenticate users and allow\n[access to services. The tickets are distributed by the key distribution center (KDC). In most](https://www.techopedia.com/definition/12883/key-distribution-center-kdc-cryptography)\n[environments, the KDC is installed on the domain controller (DC).](https://en.wikipedia.org/wiki/Domain_controller)\n\n[During the initial authentication, a Ticket Granting Ticket (TGT) is a ticket assigned to a user.](https://doubleoctopus.com/security-wiki/authentication/ticket-granting-tickets/)\nThe TGT is later used to authenticate the user to the KDC and request a service ticket from\nthe [Ticket Granting Service (TGS). Service tickets are granted for authentication against](https://www.techopedia.com/definition/27186/ticket-granting-server-tgs#:~:text=A%20ticket%20granting%20server%20(TGS)%20is%20a%20logical%20key%20distribution,such%20as%20network%20service%20access.)\nservices.\n\nA Kerberos authentication would consist of the following steps:\n\n1. The user requests (AS-REQ) a TGT from the KDC and the KDC verifies and validates\n\nthe credentials and user information.\n2. After authenticating the user, the KDC sends an encrypted TGT back to the requester\n\n(AS-REP).\n3. The user presents the TGT to the DC and requests a TGS (TGS-REQ).\n4. The TGS is encrypted and sent back to the requesting user (TGS-REP).\n5. The user connects to the server hosting the service requested and presents the TGS\n\n(AP-REQ) in order to access the service.\n6. The application server sends an (AP-REP) to the client.\n\n\n-----\n\nFigure 1. Kerberos authentication.\n\n### What Components Are in a Kerberos Ticket?\n\nEach [Kerberos ticket contains the following fields:](https://www.rfc-editor.org/rfc/rfc4120#section-5.3)\n\n**Kerberos Ticket**\n\n**Tkt-vno** Version number for the ticket format.\n\n**Realm** The realm that issued a ticket.\n\n**sname** Server name. All the components of the name are part of the server's\nidentity.\n\n**Enc-part** Encrypted with the server's secret key.\n\n_Table 1. Kerberos ticket._\n\nThe enc-part contains different fields but we will focus on the following:\n\n1. cname – The name part of the client's principal identifier.\n2. authorization-data – used to pass authorization data from the principal on whose behalf\n\na ticket was issued to the application service. This part includes the Privileged Attribute\nCertificate (PAC).\n\n### What Is a Kerberos Privilege Attribute Certificate (PAC)?\n\n\n-----\n\nAs [Microsoft s documentation states, the](https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-pac/54d570b1-fc54-4c54-8218-f770440ec334) [PAC is a structure that conveys authorization-](https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-pac/54d570b1-fc54-4c54-8218-f770440ec334)\nrelated information provided by DCs. The PAC is used by authentication protocols that verify\nidentities to transport authorization information, which controls access to resources.\n\n[The DC includes authorization data such as security identifiers (SIDs) and](https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-pac/f2ef15b6-1e9b-48b5-bf0b-019f061d41c8#gt_83f2020d-0804-4840-a5ac-e06439d50f8d) relative identifiers\n(RIDs) in the PAC.\n\n### Kerberos Delegation\n\n[A common use case for Kerberos delegation is a web server fetching user data from a](https://blog.netwrix.com/2021/11/30/what-is-kerberos-delegation-an-overview-of-kerberos-delegation/#:~:text=Kerberos%20Delegation%20is%20a%20security,account%20for%20any%20other%20network)\ndatabase server. The database server can grant access to the user data only for the user. In\nthis scenario, the web server will need to impersonate the user. This impersonation is called\nKerberos delegation.\n\nWe will focus on constrained delegation in this blog, but you can read about the different\nKerberos delegation methods in Protecting Against the Bronze Bit Vulnerability with Cortex\nXDR.\n\n**Constrained Delegation: Microsoft has implemented Kerberos extensions in order to avoid**\n[keeping the user’s TGT in memory. This extension is called S4U (Service for User), and it](https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-sfu/4a624fb5-a078-4d30-8ad1-e9ab71e0bc47#gt_083a5403-f654-4db6-b17e-9c10dc5cd420)\nconsists of [S4U2Self and](https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-sfu/4a624fb5-a078-4d30-8ad1-e9ab71e0bc47#gt_2214804a-4a44-46f4-b6d2-a78f4ff39a39) [S4U2Proxy. S4U2Self allows a service to ask for a ticket to itself](https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-sfu/bde93b0e-f3c9-4ddf-9f44-e1453be7af5a)\non behalf of any user. S4U2Proxy will allow a service to authenticate to a different service.\n\n### S4U2Self Extension\n\n[As described above, the S4U2self extension allows a service to receive the user’s](https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-sfu/4a624fb5-a078-4d30-8ad1-e9ab71e0bc47#gt_2214804a-4a44-46f4-b6d2-a78f4ff39a39)\n[authorization data in the ticket (i.e., the PAC).](https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-sfu/4a624fb5-a078-4d30-8ad1-e9ab71e0bc47#gt_0eef5aca-03f3-4b09-b79b-cdf7f730ad89)\n\n[To use this protocol extension, the user that issues the KRB_TGS_REQ must have at least](https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-kile/b4af186e-b2ff-43f9-b18e-eedb366abf13)\n[one Service Principal Name (SPN) to allow the DC to encrypt the generated service ticket](https://learn.microsoft.com/en-us/windows/win32/ad/service-principal-names)\nwith the service secret key.\n\nS4U2U KRB_TGS exchange flow:\n\n1. The service fills out the [PA_FOR_USER data structure, which contains the information](https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-sfu/aceb70de-40f0-4409-87fa-df00ca145f5a)\n\nabout the user on whose behalf the service requests the service ticket, and sends the\nKRB_TGS_REQ message to the TGS.\n2. The service ticket will be sent back to the service via KRB_TGS_REQ message. The\n\nPAC returned in the service ticket contains the authorization data.\n\n### U2U Authentication\n\n[User-to-User authentication is described in the Kerberos RFC as a method that “allows the](https://www.rfc-editor.org/rfc/rfc4120#section-3.7)\nclient to request that the ticket issued by the KDC be encrypted using a session key from a\nTGT issued to the party that will verify the authentication.”\n\n\n-----\n\nThe KRB_TGS_REQ will have the following features:\n\n[additional-tickets: will contain the TGT from which the secret-key is taken](https://www.rfc-editor.org/rfc/rfc4120#section-5.4.1)\n[ENC-TKT-IN-SKEY: option indicates that the ticket for the end server is to be encrypted](https://www.rfc-editor.org/rfc/rfc4120#section-2.9.2)\nin the session key from the additional TGT provided.\nThe service name (sname) can refer to a user and not necessarily a service with SPN.\n\n### U2U + S4U2Self\n\nCombining the two methods together allows using the S4U2Self extension for users with no\nSPN. The service ticket received in this exchange is encrypted with the server’s secret-key\n(in this specific case the server can be a user with no SPN), therefore, the PAC of the target\nuser can be decrypted using the server’s secret-key.\n\nThe KRB_TGS_REQ packet will have all the features of both methods.\n\n## How Do These Kerberos Attacks Work?\n\nBoth the Sapphire and Diamond Ticket attacks decrypt a legitimate TGT and change its PAC,\n[and in order to do that, the adversary needs to have access to the KRBTGT account’s key](https://adsecurity.org/?p=483)\n(the password hash). The KRBTGT account, as described by Microsoft TechNet (now\nMicrosoft Docs), is a local default account that acts as a service account for the KDC service.\n\n### Sapphire Ticket\n\n[The Sapphire ticket attack (introduced by Charlie Bromberg), requires getting credentials of](https://twitter.com/_nwodtuhs)\nany user in the domain. Let's call that user Joe. Joe’s credentials will be used to obtain a\nTGT (using a regular [KRB_AS_REQ) and later to decrypt the PAC of a high-privileged user.](https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-kile/b4af186e-b2ff-43f9-b18e-eedb366abf13)\n\nOnce the TGT is received, the adversary will use the U2U + S4U2Self:\n\n1. Decide on the user they want to impersonate (high-privileged user)\n2. Generate a KRB_TGS_REQ with the following attributes:\n\n1. The PA_FOR_USER struct contains the impersonated user\n2. The service name (sname) is Joe’s username\n3. Joe’s TGT will be added to the additional-tickets field\n4. ENC-TKT-IN-SKEY flag in the KDC Option is set\n3. Obtain a service ticket for the impersonated user\n\nKRB_TGS_REQ \n\n-----\n\nFigure 2. KRB_TGS_REQ created using U2U + S4U2Self methods.\n\n\n-----\n\nset in the KDC Option.\nKRB_TGS_REP\n\n\nFigure 3. ENC-TKT-IN-SKEY flag is\n\nFigure 4. U2U + S4U2Self TGS-REP.\n\n\n-----\n\nAs we know, a service ticket is encrypted with the service s long-term secret, which means\nthat if the adversary has Joe’s credentials, they will be able to decrypt the service ticket. The\nadversary also has the KRBTGT account’s secret key and therefore they can decrypt and\nmodify Joe’s TGT, which is signed with said secret key.\n\nTo forge the Sapphire Ticket, the attacker will extract the PAC of the impersonated user, and\nmodify Joe’s TGT in 2 ways:\n\n1. Replace Joe’s original PAC with the high-privileged PAC.\n2. Match the cname to be the impersonated user’s name.\n\nThis gives the attacker a usable TGT of a high-privileged user.\n\n### Diamond Ticket\n\n[The first part of the Diamond Ticket attack (introduced by Charlie Clark and](https://twitter.com/exploitph) Andrew\nSchwartz) is obtaining a TGT. This can be done by using one of the following techniques:\n\nAdversaries will use the low-privileged user’s credentials to initiate a KRB_AS_REQ,\nwhich will result in a legitimate TGT.\n[A tool called Rubeus has an option called tgtdeleg that abuses the Kerberos Generic](https://github.com/GhostPack/Rubeus)\nSecurity Services Application Program Interface (GSS-API) to retrieve a usable TGT\nfor the current user without needing elevation on the host.\n\n[Once receiving the TGT in the KRB_AS_REP, the adversary can now decrypt the TGT using](https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-kile/b4af186e-b2ff-43f9-b18e-eedb366abf13)\nthe KRBTGT account’s key and modify each part of the ticket.\n\nAfter modifying the ticket, an attacker can escalate their privileges using one of the following\napproaches:\n\nGenerating a TGT to impersonate a domain admin or any other user in the domain.\n\nIn this scenario the attacker will need to change the cname field in the ticket as well as the\nPAC. This method will result in a forged ticket under the name of the domain admin (or any\n[other user in the domain), which is pretty similar to the Golden Ticket attack.](https://attack.mitre.org/techniques/T1558/001/)\n\nElevating a normal domain user’s privileges to domain admin privileges by modifying\nthe PAC.\n\nThis method will supply the attacker with a ticket under the name of the low-privileged user\nwith domain admin permissions.\n\n## How Powerful Are the New Kerberos Attacks?\n\n\n-----\n\nDiamond and Sapphire Tickets are forged TGTs created by modifying a legitimate TGT,\nwhich gives it additional privileges or a new identity. While many Golden Ticket detections\nare based on the absence of a TGT creation by a legitimate DC, the new attacks manipulate\na legitimate TGT that was issued by the DC, which makes them harder to detect.\n\nAfter the TGT is forged, the attacker uses it to request a TGS to any service or resource they\ndesire. For example, they can request access to all computers, files and folders in the\ndomain.\n\n### What’s the Difference Between a Diamond Ticket and a Sapphire Ticket Attack?\n\nIn both attacks, the manipulation happens on the PAC of a legitimate TGT, but the main\ndifference is in the way it is modified. With a Diamond Ticket, the modification is to the\noriginal PAC of the requested TGT, by adding additional privileges or modifying it completely.\nWith a Sapphire Ticket, the attacker modifies the TGT by getting a legitimate PAC of a highprivileged user using Kerberos delegation, and replaces it with the original ticket’s PAC.\n\n### Can Anyone Forge TGTs?\n\nIn order to perform such an attack, the basic requirement is that the adversary needs access\nto the [KRBTGT account’s password hash.](https://adsecurity.org/?p=483)\n\nThe KRBTGT account encrypts and signs all the Kerberos TGT tickets for the domain. All\nverification of Kerberos tickets, including encrypting and decrypting TGTs for the KDC\nservice, is done by the KRBTGT. This means a forged TGT will be considered a valid ticket\nsimply because it was encrypted with the KRBTGT account.\n\nMoreover, the adversary has to encrypt the forged TGT with the KRBTGT password hash\nonce the TGT is forged, to make sure the new TGT will pass the KDC’s verification and issue\na service ticket to the desired service.\n\nWith that being said, it’s important to remember that getting the KRBTGT password hash is\nnot an easy task. Doing so not only provides access to all the services and resources in the\ndomain, but also enables network persistence.\n\n## Forged Ticket Attacks in the Wild\n\n[Forged ticket attacks have been sighted in the wild, such as in attacks by Playful Taurus,](https://attack.mitre.org/groups/G0004/)\n[also known as APT15, Ke3chang and NICKEL. This group is attributed to actors operating](https://unit42.paloaltonetworks.com/operation-ke3chang-resurfaces-with-new-tidepool-malware/)\nout of China and has targeted oil, government, diplomatic, military and non-governmental\norganizations around the world since 2010.\n\n\n-----\n\nAn [investigation done by NCC Group s IR team in May 2017 states that, to gain persistence](https://research.nccgroup.com/2018/03/10/apt15-is-alive-and-strong-an-analysis-of-royalcli-and-royaldns/)\nin the victim’s network in the event of remediation actions being undertaken, Playful Taurus\n[used Mimikatz to dump credentials and generate Kerberos Golden Tickets.](https://attack.mitre.org/software/S0002/)\n\n[In a different campaign around December 2021, MSTIC found that the same threat actor](https://www.microsoft.com/en-us/security/blog/2021/12/06/nickel-targeting-government-organizations-across-latin-america-and-europe/)\nused malicious tools such as Mimikatz, WDigest, NTDSDump, and other password-dumping\ntools to gather credentials on a targeted system.\n\nMimikatz allows attackers to perform the following activities:\n\nGathering credentials\nPerforming [DCSync attacks](https://attack.mitre.org/techniques/T1003/006/)\n\n[These simulate the Active Directory replication process and retrieve the user’s password](https://social.technet.microsoft.com/wiki/contents/articles/4592.how-active-directory-replication-works.aspx)\nhash. They can be used to collect the KRBTGT password hash.\n\nForge a Golden Ticket\n\nOur assumption is that – because Sapphire and Diamond Ticket attacks resemble Golden\nTicket attacks but are harder to discover – different threat actors (like Playful Taurus) are\nlikely to use these attacks in the future.\n\n## Proposing Detection Methods for Forged Ticket Attacks\n\nDue to the difficulty of finding the KRBTGT password hash, these attacks would probably\ncause a lot of noise even before the attack took place. In this case, the detection ideas that\napply to Golden Ticket attacks are relevant here as well.\n\nIf you want to read more about such detections, check out our blog, Detecting and\nPreventing the Path to a Golden Ticket With Cortex XDR.\n\n### Sapphire Ticket\n\nSince the Sapphire Ticket should appear valid (i.e., a ticket with a legitimate PAC), we would\nhave a difficult time detecting its utilization solely by analyzing it. However, we can detect\nother suspicious activities on the host:\n\nSigns of KRBTGT password hash theft\nSuspicious tools usage\nDCSync attacks in the environment or suspicious connections from the host to a DC\nIrregular KRB_TGS_REQ with U2U + S4U2Self attributes\nKRB_TGS_REQ by a high-privileged user from that host\n\n\n-----\n\nIf the adversary uses the ticket right after performing the attack, we will observe a TGT\nrequest and TGS from the same IP for two different users. There would be no indication for\nthe second user’s (i.e., the one that appears in the TGS request) authentication to that\nmachine. This can be monitored by Windows Event 4768 and 4769 as well as network traffic.\n\nFigure 5. TGT request by low-privileged user.\n\n\n-----\n\nFigure 6. TGS request by high-privileged user.\n\n### Diamond Ticket\n\n**Generating a Ticket for Domain Admin Account**\n\nThe detection here is pretty similar to any Golden Ticket detector or the suggested Sapphire\nTicket detector.\n\n**Elevating Normal Domain User’s Privileges**\n\nIf the adversary uses this technique, it will look like legitimate authentication. The TGT and\nTGS requests will be for the same user, and the suggested detectors won’t be relevant.\n\nThis activity can be monitored by looking for anomalies in both the number of resources\nbeing accessed and what resources the user accessed. Attackers will likely be accessing\nhigh-privileged resources, so this activity will be new. Anomaly detection can be tricky in big\nenvironments and can cause distraction rather than finding an attack.\n\nIt’s important to note that the main difference between Diamond Ticket and Sapphire Ticket is\nthat a Sapphire Ticket has an actual PAC of a real high-privileged user. In Diamond Ticket\nand Golden Ticket attacks, the PAC is modified by the attacker, and might therefore be\ninaccurate. This information can be used to detect these attacks.\n\n### Group Membership Detection\n\n\n-----\n\nTo make this detection method more approachable, let me introduce you to Windows event\n4627(S): Group membership information. This event is generated with Windows event\n“4624(S): An account was successfully logged on,” and it shows the list of groups that the\nlogged-on account belongs to.\n\n\n-----\n\nFigure 7. Windows Event 4627.\n_Source -_ [Microsoft](https://learn.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4627)\n\nThis requires OS Version Windows Server 2016, Windows 10 and above. To enable it, you\n[must enable the Success Audit for the Audit Logon subcategory.](https://learn.microsoft.com/en-us/windows/security/threat-protection/auditing/audit-logon)\n\nMonitoring this event will allow you to discover irregularities in the user’s group\nmemberships. When an attacker wants to assign domain admin privileges to a forged ticket,\nthey add the domain admin rid (512) to the PAC. Thus, during the login, it appears the user is\npart of the domain admins.\n\nAn example of this would be using Diamond Ticket attacks to elevate a low-privileged user\n(we’ll continue to use “Joe”) to domain admin privileges, as shown in Figures 8 and 9.\n\n\n-----\n\nFigure 8. Low-privileged user appears in domain admin.\n\n\n-----\n\nFigure 9. Joe is not a member of domain admins.\nIt is worth noting that, if an adversary impersonates a high-privileged user using a forged\nTGT, they might assign the wrong group membership. Therefore, it is worth paying attention\nto those as well.\n\nTo avoid false positives (when a user is intentionally added to a high-privileged group), event\n[4627 can be correlated with Windows events 4732 and](https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventid=4732) [4728, which indicate when a user is](https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventID=4728)\nadded to a group.\n\n## Conclusion\n\nIn this blog, after a brief primer on relevant Kerberos terms and the attacks themselves, we\ndiscussed the privileges required to perform such attacks and the importance of monitoring\ndifferent forged ticket attacks. Additionally, we examined possible detection ideas that might\n\n\n-----\n\nhelp cover Golden Ticket attacks as well as new attack methods.\n\nForged ticket attacks might be hard to detect with a cursory glance, since they can initially\nappear to be legitimate. However, if enough information is collected about suspicious\nnetwork activity, malicious tool usage, or Windows events, we might be able to detect some\nof the most effective Kerberos attacks.\n\n[In addition, deploying a security platform such as Cortex XDR can provide an additional layer](https://www.paloaltonetworks.com/cortex/cortex-xdr)\nof protection and visibility to the various stages of the attack.\n\n## Additional Resources\n\n[Detecting and Preventing the Path to a Golden Ticket With Cortex XDR - Palo Alto Networks](https://www.paloaltonetworks.com/blog/security-operations/detecting-and-preventing-the-path-to-a-golden-ticket-with-cortex-xdr/)\n\n[Protecting Against the Bronze Bit Vulnerability with Cortex XDR - Palo Alto Networks](https://www.paloaltonetworks.com/blog/security-operations/bronze-bit-vulnerability-xdr/)\n\n[The Essential Guide to XDR - Palo Alto Networks](https://start.paloaltonetworks.com/essential-guide-to-xdr.html)\n\n[Understanding Microsoft Kerberos PAC Validation - Microsoft](https://learn.microsoft.com/en-us/archive/blogs/openspecification/understanding-microsoft-kerberos-pac-validation)\n\n[The Kerberos Network Authentication Service (V5) - MIT](https://www.rfc-editor.org/rfc/rfc4120)\n\n[A Diamond (Ticket) in the Ruff - Semperis](https://www.semperis.com/blog/a-diamond-ticket-in-the-ruff/)\n\n## Appendix: Glossary\n\n**[Constrained delegation – Provides a safer form of delegation that could be used by](https://learn.microsoft.com/en-us/windows-server/security/kerberos/kerberos-constrained-delegation-overview)**\nservices. When it is configured, constrained delegation restricts the services to which the\nspecified server can act on the behalf of a user.\n\n**DCSync Attack – Abusing a Windows Domain Controller's application programming**\ninterface (API) to simulate the replication process from a remote domain controller.\n\n**Domain controller (DC) – A server computer that responds to security authentication**\nrequests within a computer network domain. It is a network server that is responsible for\nallowing host access to domain resources. Serves as the KDC in AD environments.\n\n**ENC-TKT-IN-SKEY – The option indicates that the ticket for the end server is to be**\nencrypted in the session key from the additional TGT provided.\n\n**Golden Ticket attack – Adversaries who have the KRBTGT account password hash may**\nforge Kerberos ticket-granting tickets (TGT) called “Golden ticket” which enable adversaries\nto generate authentication material for any account in Active Directory.\n\n**Kerberos – Kerberos is a network authentication protocol that is primarily used in Active**\nDirectory environments.\n\n**[Kerberos delegation – Kerberos delegation is a delegation setting that allows applications](https://learn.microsoft.com/en-us/defender-for-identity/security-assessment-unconstrained-kerberos)**\nto request end-user access credentials to access resources on behalf of the originating user.\n\n\n-----\n\n**Key Distribution Center (KDC) – A key distribution center (KDC) in cryptography is a**\nsystem that is responsible for providing keys to the users in a network that shares sensitive\nor private data.\n\n**KRBTGT account – A local default account that acts as a service account for the KDC**\nservice.\n\n**PA-FOR-USER – A struct used to identify the user, on whose behalf the service requests the**\nservice ticket, using the user name and user realm.\n\n**Privileged Attribute Certificate (PAC) – The PAC is a structure that conveys authorization-**\nrelated information provided by domain controllers (DCs). The PAC is used by authentication\nprotocols that verify identities to transport authorization information, which controls access to\nresources.\n\n**S4U – Kerberos extensions in order to avoid keeping the user’s TGT in memory. It consists**\nof S4U2Self and S4U2Proxy.\n\n**S4U2Proxy – Will allow a service to authenticate to a different service.**\n\n**S4U2Self – Allows a service to ask for a ticket to itself on behalf of any user.**\n\n**Service Principal Names (SPN) – A unique identifier of a service instance. SPNs are used**\nby Kerberos authentication to associate a service instance with a service logon account.\n\n**Ticket Granting Server (TGS) – A TGS validates the use of a ticket for a specified purpose,**\nsuch as network service access.\n\n**Ticket Granting Ticket (TGT) – A user authentication token issued by the KDC that is used**\nto request access tokens from the Ticket Granting Service (TGS) for specific\nresources/systems joined to the domain.\n\n**U2U authentication – A method to perform authentication when the verifier does not have**\naccess to a long-term service key. To address this problem, the Kerberos protocol allows the\nclient to request that the ticket issued by the KDC be encrypted using a session key from a\nTGT issued to the party that will verify the authentication.\n\n_Updated December 13, 2022, at 8:25 a.m. PT._\n\n**Get updates from**\n\n**Palo Alto**\n\n**Networks!**\n\nSign up to receive the latest news, cyber threat intelligence and research from us\n\n\n-----\n\n[By submitting this form, you agree to our Terms of Use and acknowledge our Privacy](https://www.paloaltonetworks.com/legal-notices/terms-of-use)\nStatement.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-12-12 - Precious Gemstones- The New Generation of Kerberos Attacks.pdf"
    ],
    "report_names": [
        "2022-12-12 - Precious Gemstones- The New Generation of Kerberos Attacks.pdf"
    ],
    "threat_actors": [
        {
            "id": "0a03e7f0-2f75-4153-9c4f-c46d12d3962e",
            "created_at": "2022-10-25T15:50:23.453824Z",
            "updated_at": "2025-03-27T02:00:55.473216Z",
            "deleted_at": null,
            "main_name": "Ke3chang",
            "aliases": [
                "Ke3chang",
                "APT15",
                "Vixen Panda",
                "GREF",
                "Playful Dragon",
                "RoyalAPT",
                "Nylon Typhoon"
            ],
            "source_name": "MITRE:Ke3chang",
            "tools": [
                "Okrum",
                "Systeminfo",
                "netstat",
                "spwebmember",
                "Mimikatz",
                "Tasklist",
                "MirageFox",
                "Neoichor",
                "ipconfig"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "7c8cf02c-623a-4793-918b-f908675a1aef",
            "created_at": "2023-01-06T13:46:38.309165Z",
            "updated_at": "2025-03-27T02:00:02.801298Z",
            "deleted_at": null,
            "main_name": "APT15",
            "aliases": [
                "BRONZE PALACE",
                "Nylon Typhoon",
                "VIXEN PANDA",
                "Playful Dragon",
                "BRONZE DAVENPORT",
                "BRONZE IDLEWOOD",
                "G0004",
                "Red Vulture",
                "Ke3Chang",
                "Metushy",
                "Lurid",
                "Social Network Team",
                "Royal APT"
            ],
            "source_name": "MISPGALAXY:APT15",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "7d5531e2-0ad1-4237-beed-af009035576f",
            "created_at": "2024-05-01T02:03:07.977868Z",
            "updated_at": "2025-03-27T02:05:17.283109Z",
            "deleted_at": null,
            "main_name": "BRONZE PALACE",
            "aliases": [
                "BRONZE DAVENPORT ",
                "BRONZE IDLEWOOD ",
                "CTG-9246 ",
                "Ke3chang ",
                "Playful Dragon",
                "Vixen Panda ",
                "APT15 "
            ],
            "source_name": "Secureworks:BRONZE PALACE",
            "tools": [
                " BS2005",
                " Enfal",
                " Mirage",
                " RoyalCLI",
                " RoyalDNS",
                "BMW"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "17b1b76b-16da-4c4f-8b32-f6fede3eda8c",
            "created_at": "2022-10-25T16:07:23.750796Z",
            "updated_at": "2025-03-27T02:02:09.961401Z",
            "deleted_at": null,
            "main_name": "Ke3chang",
            "aliases": [
                "APT 15",
                "BackdoorDiplomacy",
                "Bronze Davenport",
                "Bronze Idlewood",
                "Bronze Palace",
                "CTG-9246",
                "GREF",
                "Ke3chang",
                "Metushy",
                "Nylon Typhoon",
                "Operation Ke3chang",
                "Operation MirageFox",
                "Playful Dragon",
                "Playful Taurus",
                "Red Vulture",
                "Royal APT",
                "Social Network Team",
                "Vixen Panda"
            ],
            "source_name": "ETDA:Ke3chang",
            "tools": [
                "Agentemis",
                "Anserin",
                "BS2005",
                "BleDoor",
                "CarbonSteal",
                "Cobalt Strike",
                "CobaltStrike",
                "DarthPusher",
                "DoubleAgent",
                "EternalBlue",
                "GoldenEagle",
                "Graphican",
                "HenBox",
                "HighNoon",
                "IRAFAU",
                "Ketrican",
                "Ketrum",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "MS Exchange Tool",
                "Mebroot",
                "Mimikatz",
                "MirageFox",
                "NBTscan",
                "Okrum",
                "PluginPhantom",
                "PortQry",
                "ProcDump",
                "PsList",
                "Quarian",
                "RbDoor",
                "RibDoor",
                "Royal DNS",
                "RoyalCli",
                "RoyalDNS",
                "SAMRID",
                "SMBTouch",
                "SilkBean",
                "Sinowal",
                "SpyWaller",
                "Theola",
                "TidePool",
                "Torpig",
                "Turian",
                "Winnti",
                "XSLCmd",
                "cobeacon",
                "nbtscan",
                "netcat",
                "spwebmember"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1677809150,
    "ts_updated_at": 1743041810,
    "ts_creation_date": 1677662464,
    "ts_modification_date": 1677662464,
    "files": {
        "pdf": "https://archive.orkl.eu/9a4e55d7db8018b787534e9122f67aa85b4e0186.pdf",
        "text": "https://archive.orkl.eu/9a4e55d7db8018b787534e9122f67aa85b4e0186.txt",
        "img": "https://archive.orkl.eu/9a4e55d7db8018b787534e9122f67aa85b4e0186.jpg"
    }
}