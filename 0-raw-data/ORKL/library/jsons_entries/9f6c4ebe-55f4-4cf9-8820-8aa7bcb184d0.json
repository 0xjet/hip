{
    "id": "9f6c4ebe-55f4-4cf9-8820-8aa7bcb184d0",
    "created_at": "2023-01-12T15:06:34.254378Z",
    "updated_at": "2025-03-27T02:17:11.719248Z",
    "deleted_at": null,
    "sha1_hash": "b832ee132b97f38b22ebef3e8e98bba5e0491f24",
    "title": "2021-07-28 - Cert Safari- Leveraging TLS Certificates to Hunt Evil",
    "authors": "",
    "file_creation_date": "2022-05-28T17:44:26Z",
    "file_modification_date": "2022-05-28T17:44:26Z",
    "file_size": 1178189,
    "plain_text": "# Cert Safari: Leveraging TLS Certificates to Hunt Evil\n\n**[prevailion.com/cert-safari-leveraging-tls-certificates-to-hunt-evil/](https://www.prevailion.com/cert-safari-leveraging-tls-certificates-to-hunt-evil/)**\n\nJuly 27, 2021\n\n27 July 2021\n\nProactively hunting for malicious infrastructure is a persistent puzzle for threat researchers to\nwork and solve. It is a complex and evolving problem, made more complex (though not\n[unmanageable) by Domain Privacy and](https://en.wikipedia.org/wiki/Domain_privacy) [GDPR, which obscure WHOIS information that](https://umbrella.cisco.com/blog/gdpr-and-whois)\n\n\n-----\n\nAnalysts and Researchers would otherwise use to identify trends and corroborate other\nobservations to increase confidence in attribution of infrastructure clustering. This has forced\nresearchers to identify other methods to proactively hunt for malicious infrastructure.\n\n**How to Leverage TLS Certificates**\n\nAssisted by an increasing body of knowledge generated by thoughtful, forward-leaning\nanalysts working on this very problem {1-9}, the Prevailion Adversarial Counterintelligence\nTeam (PACT) leverages TLS certificates to compensate for the investigatory vacuum left by\nWHOIS redactions. But, before we dive into an analytical methodology along with an\nexample that leverages this source of information, a quick primer on how the internet works:\n\nDomain names, like “Wikipedia.org,” are not required for network communications, but\nan IP address is (the internet runs on TCP/IP, after all).\nDomain names provide a sense of brand, recognition, and utility that IP addresses\ncannot (IP addresses are for machines, domain names are for people).\nMost legitimate sites will have a domain name that is mapped to (one or more) IP\naddresses.\n\nThe push for encrypted communications over the internet, mainly due to the influence of\necommerce, made much of the day-to-day communications between a user’s computer and\na website (on a domain) encrypted using the TLS (Transport Layer Security) protocol. To\nimplement and use TLS, a website must first prove its identity by presenting a TLS\ncertificate. The TLS certificate contains information about the website (domain) and the\norganization that runs and owns that domain. It is further countersigned by a trusted party\n(the Certificate Authority, or CA), whose sole job is to verify that the site is truly owned and\noperated by the entity claiming ownership.\n\nTLS certs are intended to bind together a domain name with an organizational identity {10}.\nFor example, the TLS cert for Wikipedia {Figure 1, below} displays the Subject Common\nName (CN=*.wikipedia.org), effectively proving the web server’s legitimate right to serve any\nwebpage from the domain (or any subdomain) ending in “wikipedia.org”. Additionally, it can\nserve web pages from the other domains on the cert, as agreed upon by the entity\n(Wikipedia) and the CA (Let’s Encrypt).\n\n\n-----\n\n_Figure 1 – Wikpedia’s TLS certificate_\n\nArmed with the understanding that TLS certificates are required for encrypted\ncommunications between a computer and a website (domain), and that IP addresses are\nrequired for network communications (but domain names are not), it stands to reason that\nTLS certificates must be associated with the IP addresses hosting a given domain.\n\nMalicious actors must execute most, if not all, of the following steps to create supporting\ninfrastructure for their operations {7}:\n\n1. Create a registration persona\n2. Buy a domain name from a registrar/reseller\n3. Set up hosting at an IP address\n4. Set up target or operation-specific subdomain infrastructure\n5. Create an SSL certificate if requiring HTTPS communication\n6. Enable services at a hosting IP address or the domain\n7. Set up domain with a website or redirect\n\n\n-----\n\nEach of these steps provides an opportunity for the researcher to identify tactics or artifacts\nthat can be used to cluster adversary activity or infrastructure. This methodology was\nrecently used by the PACT to uncover what appears to be a cluster of unattributed activity\nthat has yet to be reported on, hosted mainly on Vietnamese infrastructure and using domain\nnames with a technology and cryptocurrency theme.\n\nThe PACT initially identified a blacklisted certificate, listed as a generic “Malware C&C,” on\nthe SSL certificate blacklist (SSLBL) provided by the amazing folks at ABUSE.ch {11}.\nAnalysts identified the cert on Censys.io by its SHA1 fingerprint, where it was associated\nwith “google247[.]xyz” {Figure 2 below}\n\n_Figure 2 – the blacklisted certificate from SSLBL_\n\nTo identify the hosting infrastructure, analysts used DomainTools’ WHOIS tool to query the\ndomain associated with the certificate. Two notable facts were identified:\n\n1. The domain is hosted on 14.241.72[.]25\n2. Four other domains are hosted on the same IP {Figure 3, below}.\n\n\n-----\n\n_Figure 3 – WHOIS info for the domain associated with the blacklisted certificate_\n\nAnalysts also noted the following additional facts for future pivots:\n\n1. Registrant Organization: Nguyễn Quang Thuỷ\n2. Registrar: Mat Bao Corporation\n3. Name Servers: NS1.MATBAO.COM & NS2.MATBAO.COM\n\nIdentifying the hosting address of the domain enabled a pivot to Shodan {Figures 4,5,\nbelow}, which identified an additional domain associated with that IP: sellview[.]xyz.\n\n\n-----\n\n-----\n\n_Figure 4,5 – Results of Shodan query for the host, identifying it by IP and TLS certificate_\n\nCensys was used to backstop the findings from Shodan, positively identifying both the IP and\nthe certificate seen on the target IP in Shodan {Figures 6,7, below}:\n\n\n-----\n\n-----\n\n_Figure 6 – IP corroboration from Censys_\n\n_Figure 7 – Certificate corroboration from Censys_\n\nThe certificate structure for sellview[.]xyz is similar in structure to the original certificate for\ngoogle247[.]xyz (from the SSLBL): the “Issuer DN” string is identical; validity period is 1 year,\nand the “Names” values are identically structured. There are now two domains with\noverlapping certificate characteristics being hosted on IP 14.241.72[.]25. Additional\nsimilarities can be seen within the WHOIS registration data: the registrant information was\n\n\n-----\n\nidentical (Registrant Organization: Nguyễn Quang Thuỷ; Registrar: Mat Bao Corporation,\nand nameservers). Screenshots of both domains using URLSCAN.io also proved to be\nidentical: a blank white screen with “Hello.” written in black text in the top-left corner {Figure\n8}.\n\n_Figure 8 – Screenshot of the two domains_\n\nThe matching WHOIS registration data, along with the identical certificate structure, hosting\ninfrastructure, and URLSCAN website screenshots, indicate it is highly likely this activity can\nbe clustered.\n\nNext, PACT pivoted on the IP in an attempt to identify additional domains that might be\nclustered with the observed activity. Querying the IP using passive DNS and domain\nintelligence tools corroborated the hosting of the previously identified domains as well as\ndozens of other domains registered under the *.xyz TLD.\n\nSome were immediately notable due to their similarity in name or theme:\n\n1. google360[.]xyz\n2. shippro[.]xyz\n3. btc247[.]xyz\n4. btc360[.]xyz\n5. follow247[.]xyz\n6. follow360[.]xyz\n7. forex247[.]xyz\n8. forex24h[.]xyz\n9. gold247[.]xyz\n10. gold360[.]xyz\n\n11. googlevn[.]xyz\n12. guess247[.]xyz\n13. guess360[.]xyz\n14. mailgoogle[.]xyz\n\nOthers appeared to target a Vietnamese-speaking audience:\n\n1 Giaovat[ ]xyz (translated*: “giao vat” = delivery)\n\n\n-----\n\n2. Timviec[.]xyz (translated : tim viec = heart)\n3. Xemhang[.]vn (translated*: “xem hang” = see the cave)\n4. Xemhang[.]xyz (see above)\n5. Xuatban[.]xyz (translated*: “xuat ban” = leave you)\n\n*translation provided using Google Translate\n\nThe shared theme of the domains (technology, cryptocurrency, re-use of numbering schemes\n\n[e.g., btc247, gold247, guess247] and the consistent use of the “.xyz” TLD), as well as the\nshared hosting infrastructure (IP 14.241.72[.]25), along with the overlapping WHOIS data, is\nused to loosely cluster this activity.\n\nAll domains listed above (22 in total) share the following characteristics:\n\n1. Hosted (currently or previously) on IP 14.241.72.25\n2. Registrant Organization: Nguyễn Quang Thuỷ\n3. Registrar: Mat Bao Corporation\n4. Name Servers: NS1.MATBAO.COM & NS2.MATBAO.COM\n\n**Additional Analysis**\n\nIn keeping with the subject of this post, certificate analysis on all 22 domains continued\nstrengthening the case for clustering this activity. 20 of the 22 domains have overlapping\ncertificate characteristics: they were previously registered with 90-day certificates from\nCertificate Authority “ZeroSSL”, and 13 have a current 12-month certificate from Certificate\nAuthority Sectigo. The Sectigo certificates share a common naming schema for the\nwebsite/domain in the Common Name (CN) and Subject Alternative Names (SAN) as well as\nthe ‘Issuer DN’ string “C=GB, ST=Greater Manchester, L=Salford, O=Sectigo Limited,\nCN=Sectigo RSA Domain Validation Secure Server CA”. Both the Sectigo and ZeroSSL\ncertificates share the same naming schema in the CN and SAN fields.\n\nCertificate histories were available for some of the domains as far back as 2016, which also\nrevealed that this actor has been using multiple certificate authorities (Sectigo/Comodo,\nZeroSSL, Let’s Encrypt). Expired certificates for some domains also revealed additional\ndomains (via entries in the CN or SAN fields), but these domains were not included in the\nfindings as historical hosting data was not available. It appears from certificate timestamps\nthat the actor was using the ZeroSSL certs in early 2021, then recertified their domains using\nSectigo as the ZeroSSL certs began expiring. The most recent certifications have a period\nof validity beginning on 08 July 2021 (for both btc360[.]xyz and btc247[.]xyz), indicating that\nthe actor is actively maintaining this infrastructure. The expired ZeroSSL certs are\ntimestamped largely from early 2021, with most valid beginning dates clustered in March\n2021. Certificate histories could be identified as far back as 2016 for a few select domains,\nbut the actor appears to have begun building out the current cluster of infrastructure in mid2020 (June/July).\n\n\n-----\n\nIn order to visualize current and potential connections, the indicators were loaded into\nVirusTotal Graph. VT Graph enabled analysts to further pivot on malicious samples\ndownloaded from and communicating with the domains and hosting infrastructure, as well as\nidentify URLs and sub-domains clustered with the identified domains.\n\nFurther analysis of the malware hosted within these domains reinforces the\ninterconnectedness of the network. The identified samples relied heavily on scripting and\nLOLbins to establish persistence in the victim machine and communicate with the threat\nactor. Additional payloads and scripts were retrieved from btc247[.]xyz. Communication was\nmade via SMTP from btc247[@]sellview[.]xyz to 247@sellview[.]xyz leveraging a mailserver\nat emailserver[.]vn, a large Vietnamese webmail provider. {Figure 9,10}\n\n_Figure 9 – Network traffic generated by infection_\n\n\n-----\n\n_Figure 10 – SMTP communication from victim machine_\n\nThe email attachment contains information from the victim machine indicating if it has a\nconfiguration file for TeamViewer or a specific cryptominer. Samples of this cryptominer were\nfound in an open directory on one of the domains in this network. AeroAdmin is installed for\nremote control of the victim machine, but we were unable to link the AeroAdmin account\nback to any specific group or actor at this time.\n\n**Conclusion**\n\nRedaction of registration data previously available via WHOIS has left Threat Researchers\nand Threat Intel Analysts with a gap that can be bridged by investigation and clustering of\nTLS Certificates to identify adversary infrastructure. Thanks to the push for Certificate\nTransparency{12,13}, each CA continuously updates a permanent, append-only record of all\ncertificates that have been associated to domains, which can then be leveraged to identify\nhosting infrastructure (and even adversary TTPs) by searching the data provided by the\ngood folks doing the public service of scanning the internet {14}. Researchers hunting\nmalicious infrastructure can continue to ply their trade while society grapples with GDPR and\nprivacy law.\n\n**Notes on Analytical Gaps:**\n\n1. Prevailion Analysts do not currently possess region-specific, nuanced knowledge of the\n\nVietnamese internet hosting market, so something like the choices of registrar may be\nrestricted enough that multiple entities might be forced to use the same registrar and\nname server (leading to false confidence in clustering activity).\n2. Long term hosting data (SSL certificate scans or pDNS data) may have enabled further\n\npivot opportunities based upon domains observed in expired certificates.\n\n**REFERENCES:**\n\n1. https://medium.com/@mark.parsons/hunting-a-tls-certificate-series-post-1\n6ad7adfebe44\n2. [Mark Parsons @ SANS DFIR: Hunting Cyber Threat Actors with TLS Certificates]\n\n[(https://www.youtube.com/watch?v=SieSrv8RGic)](https://www.youtube.com/watch?v=SieSrv8RGic)\n[3. [Ryan Kovar @ SANS DFIR:](https://www.youtube.com/watch?v=QA5OTUVqJiw)](https://www.youtube.com/watch?v=QA5OTUVqJiw)\n\n\n-----\n\n[4. https://www.riskiq.com/blog/external-threat-management/threat-hunting-post-whois/](https://www.riskiq.com/blog/external-threat-management/threat-hunting-post-whois/)\n5. https://www.domaintools.com/resources/blog/analyzing-network-infrastructure-as\n[composite-objects?utm_campaign=current-events-to-widespread-campaigns-pivoting-](https://www.domaintools.com/resources/blog/analyzing-network-infrastructure-as-composite-objects?utm_campaign=current-events-to-widespread-campaigns-pivoting-from-samples-to-identify&utm_source=Blog)\nfrom-samples-to-identify&utm_source=Blog\n[6. https://osintcurio.us/2019/03/12/certificates-the-osint-gift-that-keeps-on-giving/](https://osintcurio.us/2019/03/12/certificates-the-osint-gift-that-keeps-on-giving/)\n[7. https://threatconnect.com/blog/infrastructure-research-hunting/](https://threatconnect.com/blog/infrastructure-research-hunting/)\n[8. https://threatconnect.com/blog/track-to-the-future/](https://threatconnect.com/blog/track-to-the-future/)\n9. https://threatconnect.com/blog/using-fancy-bear-ssl-certificate-information-to-identify\ntheir-infrastructure/\n[10. https://www.globalsign.com/en/ssl-information-center/what-is-an-ssl-certificate](https://www.globalsign.com/en/ssl-information-center/what-is-an-ssl-certificate)\n\n[11. https://sslbl.abuse.ch/](https://sslbl.abuse.ch/)\n12. https://www.rapid7.com/blog/post/2018/01/04/certificate-transparency-the-gift-that\nkeeps-giving/\n13. [https://transparencyreport.google.com/https/certificates?hl=en](https://transparencyreport.google.com/https/certificates?hl=en)\n14. [https://scans.io/](https://scans.io/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-07-28 - Cert Safari- Leveraging TLS Certificates to Hunt Evil.pdf"
    ],
    "report_names": [
        "2021-07-28 - Cert Safari- Leveraging TLS Certificates to Hunt Evil.pdf"
    ],
    "threat_actors": [
        {
            "id": "e3767160-695d-4360-8b2e-d5274db3f7cd",
            "created_at": "2022-10-25T16:47:55.914348Z",
            "updated_at": "2025-03-27T02:05:17.411172Z",
            "deleted_at": null,
            "main_name": "IRON TWILIGHT",
            "aliases": [
                "ATK5 ",
                "Blue Athena ",
                "BlueDelta ",
                "FROZENLAKE ",
                "Fancy Bear ",
                "Fighting Ursa ",
                "Forest Blizzard ",
                "GRAPHITE ",
                "Group 74 ",
                "PawnStorm ",
                "STRONTIUM ",
                "Sednit ",
                "Snakemackerel ",
                "Sofacy ",
                "TG-4127 ",
                "Tsar Team ",
                "APT28 "
            ],
            "source_name": "Secureworks:IRON TWILIGHT",
            "tools": [
                " Downdelph",
                " Drovorub",
                " EVILTOSS",
                " HIDEDRV",
                " Headlace",
                " LoJack",
                " Powershell Empire",
                " SCONATO",
                " SEDUPLOADER",
                " SHARPFRONT",
                " Scaramouche",
                " Sedkit Exploit Kit",
                " Sofacy downloader",
                " X-Agent",
                " X-Tunnel",
                " Zebrocy",
                " reGeorg",
                "DEALERSCHOICE"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "730dfa6e-572d-473c-9267-ea1597d1a42b",
            "created_at": "2023-01-06T13:46:38.389985Z",
            "updated_at": "2025-03-27T02:00:02.821388Z",
            "deleted_at": null,
            "main_name": "APT28",
            "aliases": [
                "FROZENLAKE",
                "BlueDelta",
                "SNAKEMACKEREL",
                "TG-4127",
                "ITG05",
                "TA422",
                "Fancy Bear",
                "FANCY BEAR",
                "Sednit",
                "IRON TWILIGHT",
                "G0007",
                "Sofacy",
                "Forest Blizzard",
                "GruesomeLarch",
                "Pawn Storm",
                "Tsar Team",
                "STRONTIUM",
                "ATK5",
                "Blue Athena",
                "APT-C-20",
                "Group 74",
                "SIG40",
                "Grizzly Steppe",
                "Fighting Ursa",
                "T-APT-12",
                "UAC-0028"
            ],
            "source_name": "MISPGALAXY:APT28",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "ae320ed7-9a63-42ed-944b-44ada7313495",
            "created_at": "2022-10-25T15:50:23.671663Z",
            "updated_at": "2025-03-27T02:00:55.518748Z",
            "deleted_at": null,
            "main_name": "APT28",
            "aliases": [
                "APT28",
                "IRON TWILIGHT",
                "SNAKEMACKEREL",
                "Group 74",
                "Sednit",
                "Sofacy",
                "Pawn Storm",
                "Fancy Bear",
                "STRONTIUM",
                "Tsar Team",
                "Threat Group-4127",
                "TG-4127",
                "Forest Blizzard",
                "FROZENLAKE"
            ],
            "source_name": "MITRE:APT28",
            "tools": [
                "Wevtutil",
                "certutil",
                "Forfiles",
                "DealersChoice",
                "Mimikatz",
                "ADVSTORESHELL",
                "Komplex",
                "HIDEDRV",
                "JHUHUGIT",
                "Koadic",
                "Winexe",
                "XTunnel",
                "Drovorub",
                "CORESHELL",
                "OLDBAIT",
                "Downdelph",
                "XAgentOSX",
                "USBStealer",
                "Zebrocy",
                "Fysbis",
                "LoJax"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "d2516b8e-e74f-490d-8a15-43ad6763c7ab",
            "created_at": "2022-10-25T16:07:24.212584Z",
            "updated_at": "2025-03-27T02:02:10.141001Z",
            "deleted_at": null,
            "main_name": "Sofacy",
            "aliases": [
                "APT 28",
                "ATK 5",
                "Blue Athena",
                "BlueDelta",
                "FROZENLAKE",
                "Fancy Bear",
                "Fighting Ursa",
                "Forest Blizzard",
                "Grey-Cloud",
                "Grizzly Steppe",
                "Group 74",
                "GruesomeLarch",
                "ITG05",
                "Iron Twilight",
                "Operation DealersChoice",
                "Operation Dear Joohn",
                "Operation Komplex",
                "Operation Pawn Storm",
                "Operation Russian Doll",
                "Operation Steal-It",
                "Pawn Storm",
                "SIG40",
                "Sednit",
                "Snakemackerel",
                "Sofacy",
                "Strontium",
                "T-APT-12",
                "TA422",
                "TAG-0700",
                "TAG-110",
                "TG-4127",
                "Tsar Team",
                "UAC-0028",
                "UAC-0063"
            ],
            "source_name": "ETDA:Sofacy",
            "tools": [
                "ADVSTORESHELL",
                "AZZY",
                "Backdoor.SofacyX",
                "CHERRYSPY",
                "CORESHELL",
                "Carberp",
                "Computrace",
                "DealersChoice",
                "Delphacy",
                "Downdelph",
                "Downrage",
                "Drovorub",
                "EVILTOSS",
                "Foozer",
                "GAMEFISH",
                "GooseEgg",
                "Graphite",
                "HATVIBE",
                "HIDEDRV",
                "Headlace",
                "Impacket",
                "JHUHUGIT",
                "JKEYSKW",
                "Koadic",
                "Komplex",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "LoJack",
                "LoJax",
                "MASEPIE",
                "Mimikatz",
                "NETUI",
                "Nimcy",
                "OCEANMAP",
                "OLDBAIT",
                "PocoDown",
                "PocoDownloader",
                "Popr-d30",
                "ProcDump",
                "PythocyDbg",
                "SMBExec",
                "SOURFACE",
                "SPLM",
                "STEELHOOK",
                "Sasfis",
                "Sedkit",
                "Sednit",
                "Sedreco",
                "Seduploader",
                "Shunnael",
                "SkinnyBoy",
                "Sofacy",
                "SofacyCarberp",
                "SpiderLabs Responder",
                "Trojan.Shunnael",
                "Trojan.Sofacy",
                "USB Stealer",
                "USBStealer",
                "VPNFilter",
                "Win32/USBStealer",
                "WinIDS",
                "Winexe",
                "X-Agent",
                "X-Tunnel",
                "XAPS",
                "XTunnel",
                "Xagent",
                "Zebrocy",
                "Zekapab",
                "carberplike",
                "certutil",
                "certutil.exe",
                "fysbis",
                "webhp"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535994,
    "ts_updated_at": 1743041831,
    "ts_creation_date": 1653759866,
    "ts_modification_date": 1653759866,
    "files": {
        "pdf": "https://archive.orkl.eu/b832ee132b97f38b22ebef3e8e98bba5e0491f24.pdf",
        "text": "https://archive.orkl.eu/b832ee132b97f38b22ebef3e8e98bba5e0491f24.txt",
        "img": "https://archive.orkl.eu/b832ee132b97f38b22ebef3e8e98bba5e0491f24.jpg"
    }
}