{
    "id": "ff9f5816-45e9-4771-9014-7de6a0887acb",
    "created_at": "2023-01-12T15:00:08.33318Z",
    "updated_at": "2025-03-27T02:17:01.024579Z",
    "deleted_at": null,
    "sha1_hash": "78ccec1251c3e760af649e5f64e4bd6e0f3301be",
    "title": "2022-09-14 - A Post-exploitation Look at Coinminers Abusing WebLogic Vulnerabilities",
    "authors": "",
    "file_creation_date": "2022-10-02T12:08:54Z",
    "file_modification_date": "2022-10-02T12:08:54Z",
    "file_size": 2314171,
    "plain_text": "# A Post-exploitation Look at Coinminers Abusing WebLogic Vulnerabilities\n\n**[trendmicro.com/en_us/research/22/i/a-post-exploitation-look-at-coinminers-abusing-weblogic-vulnerab.html](https://www.trendmicro.com/en_us/research/22/i/a-post-exploitation-look-at-coinminers-abusing-weblogic-vulnerab.html)**\n\nSeptember 14, 2022\n\nContent added to Folio\n\nExploits & Vulnerabilities\n\nThis blog entry details how Trend Micro Cloud One™ – Workload Security and Trend Micro Vision One™ effectively\ndetected and blocked the abuse of the CVE-2020-14882 WebLogic vulnerability in affected endpoints.\n\nBy: Sunil Bharti\nSeptember 14, 2022\nRead time: ( words)\n\n[We have recently observed malicious actors exploiting both recently disclosed and older Oracle WebLogic Server](https://www.oracle.com/ph/java/weblogic/)\nvulnerabilities to deliver cryptocurrency-mining malware. Oracle WebLogic Server is typically used for developing and\ndeploying high-traffic enterprise applications on cloud environments and engineered and conventional systems.\n\n[One of the older vulnerabilities that is still being actively exploited by malicious actors is CVE-2020-14882, a remote code](https://www.oracle.com/security-alerts/cpuoct2020traditional.html)\nexecution (RCE) vulnerability that takes advantage of improper input validation in Oracle WebLogic Server. This\nvulnerability affects versions 10.3.6.0.0, 12.1.3.0.0, 12.2.1.3.0, 12.2.1.4.0, and 14.1.1.0.0, and can be exploited by a\nremote unauthenticated attacker via sending a crafted HTTP request to the victim server resulting in RCE. It also has a\nCVSS v3.0 score of 9.8.\n\nThough we have observed that many malicious actors are using this vulnerability to deploy different malware families, this\n[blog will focus on Kinsing malware activity.](https://www.trendmicro.com/en_us/research/20/k/analysis-of-kinsing-malwares-use-of-rootkit.html) Based on our analysis, most of the exploits did not show special characteristics\nor features. However, we have observed that the downloaded shell and Python scripts went through a lengthy list of\nactions, including disabling basic operating system (OS) security features such as Security-Enhanced Linux (SELinux),\nwatchdog timers, and iptables, and disabling cloud service provider’s agents.\n\nThis blog entry will detail how Trend Micro Cloud One™ – Workload Security and Trend Micro Vision One™ effectively\n[detected and blocked the abuse of the CVE 2020 14882 WebLogic vulnerability in affected endpoints](https://www.oracle.com/security-alerts/cpuoct2020traditional.html)\n\n\n-----\n\n## Technical analysis\n\n[Despite being an older vulnerability, malicious actors are still actively weaponizing CVE-2020-14882 to gain a foothold in](https://www.oracle.com/security-alerts/cpuoct2020traditional.html)\nvictim organizations. Figure 1 shows the active attempt to exploit the vulnerability, which our intrusion prevention system\n(IPS) detected from October 31, 2020, to July 27, 2022.\n\nFigure 1. IPS detection count of the CVE-2020-14882 vulnerability exploitation from Oct. 31, 2020 to July 27, 2022\n\n\n-----\n\nFigure 2. Kinsing malware infection chain\n\n### Using Workload Security to detect WebLogic vulnerability exploitation\n\nWorkload Security’s correlation of telemetry and detections provided the initial security context in this campaign, which\nallowed security teams and analysts to track and monitor the malicious actor’s activities.\n\nThe following Workload Security modules worked to detect the exploitation of CVE-2020-14882 on vulnerable systems:\n\n**_Intrusion prevention system module_**\n\nWorkload Security’s intrusion prevention system module can tap into incoming traffic and effectively block and detect\nmalicious network traffic. This module includes multiple IPS rules that can block the vulnerability exploitation of the\nWebLogic server. One of these is IPS rule 1010590 - Oracle WebLogic Server Remote Code Execution Vulnerabilities\n(CVE-2020-14882, CVE-2020-14750 and CVE-2020-14883), which can detect and block the exploitation of vulnerabilities\nassigned to both CVE-2020-14882 and CVE-2020-14883.\n\n\n-----\n\nFigure 3. IPS detection of the vulnerability exploitation\n\nFigure 4 Payload data captured by the IPS rule\n\n\n-----\n\nIn figure 4, the malicious actor sent a crafted request that attempted to access the console.portal resource under the\n“images” directory. The “%252e%252e” is a double URL-encoded string of the “..” directory traversal pattern. Because the\nclass managing the targeted resource did not validate the input, it automatically computed the code that the attacker\nprovided. In this case, the attacker forced the server to read the contents of the wb.xml file, which downloaded a shell\nscript with the following contents:\n\nFigure 5. The contents of the\n\nwb.xml file\n**_Antimalware module_**\n\nThis module provides real-time protection against the exploitation of this vulnerability using behavior-monitoring features.\n\nFigure 6. Antimalware (AM) event of a shell script running on Java\n\n\n-----\n\nFigure 7. AM event of Kinsing malware detection\n**_Web reputation module_**\n\nThe web reputation module protects systems against web threats by blocking access to malicious URLs. In our\ninvestigation, this module immediately identified and blocked the wb.sh script’s attempt to download the Kinsing malware.\n\n\n-----\n\nFigure 8. The web reputation module\n\nblocked the download of the Kinsing malware.\n**_Activity monitoring module_**\n\nThis module can detect process, file, and network activities on endpoints that are running the Cloud One Workload\nSecurity solution. As seen on figure 13, the activity monitoring module detected the Java process that was attempting to\nopen a bash shell.\n\nFigure 9. The activity monitoring module\n\ndetected the Java process that tried to open a bash shell.\n\n### A closer look at the WebLogic vulnerability exploitation using Trend Micro Vision One and Trend Micro Cloud One\n\nIn our investigation of this Kinsing campaign, Trend Micro Vision One provided real-time details into the paths and events\nrelated to this attack. This section provides insights on the activities performed by the downloaded shell script, the\ndetections provided by the Trend Micro Cloud One and Trend Micro Vision One solutions, and how the said solutions\nprovide information on every step of the malware's behavior.\n\n## Trend Micro Cloud One\n\nAfter the successful exploitation of the vulnerability, the wb.sh file was downloaded into the host machine. In infected\nmachines that do not run Workload Security and Vision One, it would attempt to perform the following malicious actions:\n\n1.   The script would check if the “/tmp/zzza”file was present, which would then trigger the script to stop.Otherwise, it\nwould create an empty file and would perform the other actions. It is a flag used to verify that two or more instances are not\nrunning on the same host. This file can also be used to stop further infections if created manually.\n\n\n-----\n\nFigure 10. Detection of\n\n“/tmp/zzza” file creation\n2.   The script would increase the resource limit using the “ulimit” command and remove the /var/log/syslog file.\n\nFigure 11. Detection of\n\nthe /var/log/syslog file deletion\n3.   It would make multiple files mutable so that it can update them.\n\nClick to enlarge\n\nFigure 12. Detection of attribute modification of “/etc/crontab”\n4.   It would also disable multiple security features within the system.\n\nClick to enlarge\n\n\n-----\n\napparmor” command (Click to enlarge)\n5.   It would disable ”alibaba,” ”bydo,” and “qcloud” cloud service agents.\n\n\nFigure 13. Telemetry detection of the “disable\n\nFigure 14. Disabled alibaba, bydo and\n\n\nqcloud cloud service agents\n6.   Like other cryptocurrency-mining malware, it would start removing or killing off other cryptocurrency miners’ processes\nwithin the infected system.\n\nClick to enlarge\n\nFigure 15. Detection of\n\ncryptominers’ killing of other competing cryptominers’ processes (Click to enlarge)\n7.   It would also remove some Docker images that belonged to other cryptocurrency-mining malware.\n\n\n-----\n\nFigure 16. Removal of competing cryptominers’\n\nDocker images (Click to enlarge)\n8.   Until this point, the script worked as a stager — it would remove the files and processes that were related to other\ncryptominers and malware families. It would also disable security features and would modify the attributes of important files\nso that they can be manipulated. After the script performs all these steps, it would then download the Kinsingmalware.\n\nFigure 17. Downloading the Kinsing malware (Click to\n\nenlarge)\n9.   It would check if the user was root or not and would then select the path and utility (wget and curl) to download the\nmalicious binary.\n\nClick to enlarge\n\nFigure 18. Telemetry detection of\n\nthe downloaded Kinsing malware (Click to enlarge)\n10.   It would then create a cronjob to download the wb.sh script.\n\n\n-----\n\nFigure 19. Creation of cronjob to download the wb.sh script\n\n(Click to enlarge)\n**_Observed attack techniques (OATs)_**\n\nObserved attack techniques (OATs) are generated from individual events that provide security value. To investigate\npossible attempts of exploitation using this vulnerability, analysts can look for these OAT IDs from many other helper OAT\ntriggers that can indicate suspicious activities on the affected host.\n\nFigure 20. List of detected OATs (Click to enlarge)\n\n## Trend Micro Vision One Workbench app\n\nThe Trend Micro Vision One Workbench app helps analysts see the significant correlated events that are intelligently\nbased on the occurrences that happened throughout the entire fleet of workloads.\n\n\n-----\n\nFigure 21. Workbench app detection\nThe left side of figure 25 shows the summarized sequence of events. Meanwhile, security analysts can view the different\nfields of interest that are considered important and provide security value on the right side. The app allows security teams\nto see compromised assets and isolate those that can be potentially affected while patching and mitigation procedures are\nin progress.\n\n**_Execution profile_**\n\nExecution profile is a Trend Micro Vision One feature that generates graphs for security defenders. Fields like\n“processCmd” and “objectCmd’ can be expanded from the search app or the threat hunting app to look for different\nactivities in any given period. These activities include process creation, file creation, and inbound and outbound network\nactivity.\n\nIf “Check Execution Profile” is selected, a security analyst can go through the extensive list of actions that a malicious actor\nhas performed.\n\n\n-----\n\nFigure 22. Vision One dashboard showing the execution profile function (Click to enlarge)\n**_Threat hunting queries_**\n\nTo hunt down potential malicious activity within the environment, security analysts can use the following queries using the\nTrend Micro Vision One search app:\n\n1. To find the potential misuse of Java applications to open bash process: processFilePath:/bin/java AND\n_objectFilePath:/usr/bin/bash_\n\n2. To find the use of curl or wget initiated by Java via bash:\n\n_a.   processFilePath:/bin/java AND objectFilePath:/usr/bin/bash AND (objectCmd:curl or objectCmd:wget)_\n\n3. To find the execution of Base64-decoded string execution by Java via bash:\n\n_a.   processFilePath:/bin/java AND objectFilePath:/usr/bin/bash AND objectCmd:base64_\n\n## How Trend Micro Vision One and Trend Micro Cloud One – Workload Security can help thwart vulnerability exploitation\n\nIn this blog entry, we discussed how malicious actors exploited a two-year-old vulnerability and attempted to deploy the\nKinsing malware into a vulnerable system. The successful exploitation of this vulnerability can lead to RCE, which can\nallow attackers to perform a plethora of malicious activities on affected systems. This can range from malware execution,\nas in the case of our analysis, to theft of critical data, and even complete control of a compromised machine.\n\n[Trend Micro Vision One helps security teams gain an overall view of attempts in ongoing campaigns by providing them a](https://www.trendmicro.com/en_us/business/services/managed-xdr.html)\ncorrelated view of multiple layers such as email, endpoints, servers, and cloud workloads. Security teams can gain a\nbroader perspective and a better understanding of attack attempts and detect suspicious behavior that would otherwise\nseem benign when viewed from a single layer alone.\n\n[Meanwhile, Trend Micro Cloud One – Workload Security helps defend systems against vulnerability exploits, malware, and](https://www.trendmicro.com/en_us/business/products/hybrid-cloud/cloud-one-workload-security.html)\nunauthorized change. It can protect a variety of environments such as virtual, physical, cloud, and containers. Using\nadvanced techniques like machine learning (ML) and virtual patching, the solution can automatically secure new and\nexisting workloads both against known and new threats.\n\n**MITRE ATT&CK Technique IDs**\n\n**Technique** **ID**\n\nExploit Public-Facing Application T1190\n\nCommand and Scripting Interpreter:Unix Shell T1059.004\n\n\n-----\n\nResource Hijacking T1496\n\nIndicator Removal on Host: Clear Linux or Mac System Logs T1070.002\n\nFile and Directory Permissions Modification: Linux and Mac File and Directory Permissions Modification T1222.002\n\nImpair Defenses: Disable or Modify System Firewall T1562.004\n\nIndicator Removal on Host: File Deletion T1070.004\n\nScheduled Task/Job: Cron T1053.003\n\nImpair Defenses: Disable Cloud Logs T1562/008\n\n**IOCs**\n\n**URLs:**\n\nhxxp://91[.]241[.]19[.]134/wb.sh\nhxxp://185[.]14[.]30[.]35/kinsing\nhxxp://185[.]14[.]30[.]35/wb.sh\nhxxp://195[.]2[.]79[.]26/kinsing\nhxxp://195[.]2[.]79[.]26/wb.sh\nhxxp://195[.]2[.]78[.]230/wb.sh\nhxxp://193[.]178[.]170[.]47/wb.sh\nhxxp://178[.]20[.]40[.]200/wb.sh\nhxxp://94[.]103[.]89[.]159/wb.sh\nhxxp://185[.]231[.]153[.]4/wb.sh\nhxxp://195[.]2[.]85[.]171/wb.sh\nhxxp://80[.]92[.]204[.]82/wb.sh\nhxxp://195[.]2[.]84[.]209/kinsing\nhxxp://193[.]178[.]170[.]47/kinsing\nhxxp://178[.]20[.]40[.]200/kinsing\n\n**File hashes**\n\n**SHA-256** **Detection name**\n\n020c14b7bf5ff410ea12226f9ca070540bd46eff80cf20416871143464f7d546 Trojan.SH.CVE20207961.SM\n\n5D2530B809FD069F97B30A5938D471DD2145341B5793A70656AAD6045445CF6D Trojan.Linux.KINSING.USELVCR22\n\n**IP addresses**\n212[.]22[.]77[.]79\n185[.]234[.]247[.]8\n185[.]154[.]53[.]140\n\nsXpIBdPeKzI9PC2p0SWMpUSM2NSxWzPyXTMLlbXmYa0R20xk\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-09-14 - A Post-exploitation Look at Coinminers Abusing WebLogic Vulnerabilities.pdf"
    ],
    "report_names": [
        "2022-09-14 - A Post-exploitation Look at Coinminers Abusing WebLogic Vulnerabilities.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "eb3f4e4d-2573-494d-9739-1be5141cf7b2",
            "created_at": "2022-10-25T16:07:24.471018Z",
            "updated_at": "2025-03-27T02:02:10.24394Z",
            "deleted_at": null,
            "main_name": "Cron",
            "aliases": [],
            "source_name": "ETDA:Cron",
            "tools": [
                "Catelites",
                "Catelites Bot",
                "CronBot",
                "TinyZBot"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "3fff98c9-ad02-401d-9d4b-f78b5b634f31",
            "created_at": "2023-01-06T13:46:38.376868Z",
            "updated_at": "2025-03-27T02:00:02.818071Z",
            "deleted_at": null,
            "main_name": "Cleaver",
            "aliases": [
                "Cobalt Gypsy",
                "G0003",
                "Operation Cleaver",
                "Op Cleaver",
                "Tarh Andishan",
                "Alibaba",
                "TG-2889"
            ],
            "source_name": "MISPGALAXY:Cleaver",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "a6c351ea-01f1-4c9b-af75-cfbb3b269ed3",
            "created_at": "2023-01-06T13:46:39.390649Z",
            "updated_at": "2025-03-27T02:00:03.072899Z",
            "deleted_at": null,
            "main_name": "Kinsing",
            "aliases": [
                "Money Libra"
            ],
            "source_name": "MISPGALAXY:Kinsing",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f9806b99-e392-46f1-9c13-885e376b239f",
            "created_at": "2023-01-06T13:46:39.431871Z",
            "updated_at": "2025-03-27T02:00:03.08926Z",
            "deleted_at": null,
            "main_name": "Watchdog",
            "aliases": [
                "Thief Libra"
            ],
            "source_name": "MISPGALAXY:Watchdog",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535608,
    "ts_updated_at": 1743041821,
    "ts_creation_date": 1664712534,
    "ts_modification_date": 1664712534,
    "files": {
        "pdf": "https://archive.orkl.eu/78ccec1251c3e760af649e5f64e4bd6e0f3301be.pdf",
        "text": "https://archive.orkl.eu/78ccec1251c3e760af649e5f64e4bd6e0f3301be.txt",
        "img": "https://archive.orkl.eu/78ccec1251c3e760af649e5f64e4bd6e0f3301be.jpg"
    }
}