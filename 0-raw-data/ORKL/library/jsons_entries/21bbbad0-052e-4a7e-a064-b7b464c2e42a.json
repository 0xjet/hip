{
    "id": "21bbbad0-052e-4a7e-a064-b7b464c2e42a",
    "created_at": "2023-01-12T15:06:18.492529Z",
    "updated_at": "2025-03-27T02:09:18.151042Z",
    "deleted_at": null,
    "sha1_hash": "45267f135ce0bdf9ab62b55ae7ef0412ac8724e6",
    "title": "2021-10-21 - DBatLoader- Abusing Discord to Deliver Warzone RAT",
    "authors": "",
    "file_creation_date": "2022-05-28T17:13:00Z",
    "file_modification_date": "2022-05-28T17:13:00Z",
    "file_size": 1073042,
    "plain_text": "# DBatLoader: Abusing Discord to Deliver Warzone RAT\n\n**[netskope.com/blog/dbatloader-abusing-discord-to-deliver-warzone-rat](https://www.netskope.com/blog/dbatloader-abusing-discord-to-deliver-warzone-rat)**\n\nGustavo Palazolo October 21, 2021\n\n## Summary\n\n[67% of the malware downloads Netskope blocks come from popular cloud applications being](https://www.netskope.com/netskope-threat-labs/cloud-threat-report)\nabused by attackers. One of the services commonly abused by threat actors is Discord,\n[which is abused to host malware such as TroubleGrabber using public attachment URLs.](https://www.netskope.com/pt/blog/here-comes-troublegrabber-stealing-credentials-through-discord)\n\n[In this blog post, we will analyze a recent DBatLoader (a.k.a. ModiLoader) sample that uses](https://malpedia.caad.fkie.fraunhofer.de/details/win.dbatloader)\n[this technique on Discord to deliver a malware known as Warzone (a.k.a. Ave Maria), a](https://malpedia.caad.fkie.fraunhofer.de/details/win.ave_maria)\nRemote Access Trojan created in 2018.\n\nThis malware is actively being sold on the internet, through a dedicated website:\n\nWarzone RAT website\n\n\n-----\n\nIt offers a long list of capabilities, such as:\n\nRemote Desktop\nWebCam Live Stream\nDownload/Upload Files\nPassword Grabber (Chrome, Firefox, Internet Explorer, Edge, Outlook, etc.)\nOffline/Online Keylogger\n\nWarzone features, according to their website.\nThe malware is being sold under many prices, depending on the selected plan:\n\n\n-----\n\nWarzone RAT prices.\nThe website even includes a knowledge base that contains information about the usage of\nWarzone RAT.\n\nWarzone RAT knowledge base.\n\n## Analysis\n\n\n-----\n\nIt all starts with the first stage of DBatLoader, which is known for abusing cloud services, like\nGoogle Drive and Discord, to retrieve its second stage, both of which are developed in\nDelphi.\n\nFirst\n\nstage of DBatLoader.\nThe sample is signed with a revoked certificate from “Afia Wave Enterprises”.\n\nDBatLoader digital signature.\n\nOnce running, the malware allocates and executes a shellcode, which is responsible for\ndownloading the second stage.\n\n\n-----\n\nDBatLoader shellcode.\nLater, the second stage is downloaded from Discord, which is eventually decrypted and\nexecuted in memory.\n\n\n-----\n\nDBatLoader downloading its second stage from Discord.\nLooking at the decrypted file strings, we can see references to a few batch scripts that are\nusually created and executed by this malware to accomplish small tasks, like disabling\nWindows Defender. However, this sample doesn’t contain the routines to run these files.\n\nStrings related to batch scripts.\n\nThe loader then copies itself to “%AppData%” as “windows explorer.exe” and creates a very\nsimple persistence technique through Windows Registry.\n\nDBatLoader\n\npersistence mechanism.\nThe final payload is encrypted and stored in DBatLoader’s resources, named “YAK”.\n\n\n-----\n\nWarzone RAT encrypted payload.\nAfter decrypting these bytes, the payload is executed using a technique known as Process\nHollowing. Simply put, the code is injected through the following steps:\n\n1. The target process is created in a suspended state with CreateProcessA;\n2. The original process’ code section is removed with NtUnmapViewOfSection;\n3. New space is allocated in the process with VirtualAllocEx;\n4. The malicious code is written using WriteProcessMemory;\n5. Finally, the code is resumed with SetThreatContext and ResumeThread.\n\n\n-----\n\nWarzone RAT being injected through Process Hollowing.\nThis is a very common process injection technique, used by many malware such as\n[Astaroth,](https://malpedia.caad.fkie.fraunhofer.de/details/win.astaroth) [Cobalt Strike, and](https://malpedia.caad.fkie.fraunhofer.de/details/win.cobalt_strike) [Trickbot. After injecting Warzone RAT, DBatLoader exits the](https://malpedia.caad.fkie.fraunhofer.de/details/win.trickbot)\nprocess without further actions.\n\n[The final payload can be dumped from memory using a debugger or the pe-sieve tool.](https://github.com/hasherezade/pe-sieve)\n\nWarzone\n\nRAT strings.\nAs we mentioned earlier in this blog post, Warzone provides full access to the infected\nmachine and is also able to steal passwords from many browsers and email clients.\n\n\n-----\n\nPart of the Warzone\n\nRAT function that grabs passwords from browsers.\nThe malware communicates to its C2 server via TCP using sockets, through the port 1990 in\nthis case.\n\nWarzone RAT C2\n\ncommunication.\nThis information is encrypted and stored within the PE file in a section named “.bss”. The first\n4 bytes of the section are the key length, followed by the key and the encrypted data.\n\n\n-----\n\nWarzone RAT encrypted\n\nconfiguration.\nThe data is encrypted with RC4 and, once we understood this structure, we created a python\nscript that is able to parse and decrypt the C2 address from Warzone.\n\nDecrypted data from Warzone.\n\n## Conclusion\n\nUsing Discord to host malicious payloads isn’t something new, as we saw in [TroubleGrabber](https://malpedia.caad.fkie.fraunhofer.de/details/win.troublegrabber)\nin 2020. However, we should expect more malware to abuse not only Discord but other cloud\nservices as well, as it can be more reliable and harder to detect. Netskope is actively\nmonitoring attackers abusing cloud apps for malware delivery.\n\n## Protection\n\nNetskope Threat Labs is actively monitoring this campaign and has ensured coverage for all\nknown threat indicators and payloads.\n\n**Netskope Threat Protection**\n\nWin32.Trojan.Modiloader\nWin32 Trojan WarzoneRAT\n\n\n-----\n\n**Netskope Advanced Threat Protection provides proactive coverage against this**\nthreat.\n\nGen.Malware.Detect.By.StHeur indicates a sample that was detected using static\nanalysis\nGen.Malware.Detect.By.Sandbox indicates a sample that was detected by our\ncloud sandbox\n\n## IOCs\n\n**SHA256 Hashes**\n\n\nDBatLoader\nFirst Stage\n\nDBatLoader\nSecond\nStage\n\nWarzone\nRAT\n\n\n07915b1a44803fc9bd86d2d9ddad19434440b3d73f5c77f3400c84a935dd0255\n\n8f1d0ba030b897786c9ad6b68bb9165e539371648a8a60e2a6f1136647b5104e\n\ne89c137a4faa31d639492b045a78dd115468f9191143c302d165aefe85b3c06a\n\n\nThe full list of IOCs, the script that decrypts Warzone configuration, and a Yara rule can be\n[found in our Github repository.](https://github.com/netskopeoss/NetskopeThreatLabsIOCs/tree/main/DBatLoader)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-10-21 - DBatLoader- Abusing Discord to Deliver Warzone RAT.pdf"
    ],
    "report_names": [
        "2021-10-21 - DBatLoader- Abusing Discord to Deliver Warzone RAT.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535978,
    "ts_updated_at": 1743041358,
    "ts_creation_date": 1653757980,
    "ts_modification_date": 1653757980,
    "files": {
        "pdf": "https://archive.orkl.eu/45267f135ce0bdf9ab62b55ae7ef0412ac8724e6.pdf",
        "text": "https://archive.orkl.eu/45267f135ce0bdf9ab62b55ae7ef0412ac8724e6.txt",
        "img": "https://archive.orkl.eu/45267f135ce0bdf9ab62b55ae7ef0412ac8724e6.jpg"
    }
}