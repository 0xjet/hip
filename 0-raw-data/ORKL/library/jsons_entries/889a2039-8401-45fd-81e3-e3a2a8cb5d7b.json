{
    "id": "889a2039-8401-45fd-81e3-e3a2a8cb5d7b",
    "created_at": "2023-01-12T15:00:15.738456Z",
    "updated_at": "2025-03-27T02:05:44.366322Z",
    "deleted_at": null,
    "sha1_hash": "fe50774c4a79dcb6c345f0fb1e4e02bd26dc164f",
    "title": "2020-09-29 - The return of the Emotet as the world unlocks!",
    "authors": "",
    "file_creation_date": "2022-05-28T23:42:24Z",
    "file_modification_date": "2022-05-28T23:42:24Z",
    "file_size": 1638467,
    "plain_text": "# The return of the Emotet as the world unlocks!\n\n**[seqrite.com/blog/the-return-of-the-emotet-as-the-world-unlocks/](https://www.seqrite.com/blog/the-return-of-the-emotet-as-the-world-unlocks/)**\n\nPrashant Tilekar September 29, 2020\n\n29 September 2020\nWritten by [Prashant Tilekar](https://www.seqrite.com/blog/author/prashant-tilekar/)\n\n[Cybersecurity,](https://www.seqrite.com/blog/category/cybersecurity/) [Emotet](https://www.seqrite.com/blog/category/cybersecurity/emotet/)\n\nEstimated reading time: 5 minutes\nA threat actor named Emotet Trojan has been in the wild for more than 5 years, and now it is\nback after a 5 months break. It has spread globally, infecting new as well as old targets. It is\nre-launched with multiple Malspam Campaigns to distribute in all sectors.\n\nWe observed through our detection telemetry that Emotet campaigns have targeted a variety\nof sectors. It is spread through SpamMail with hot topics like Covid-19, Vaccine for Covid-19\nand few other generic keywords like Health Insurance, Payment, Invoice, Job\nUpdate/Opening, Cyberattack, Shipping and many more.\n\n## Infection chain\n\n\n-----\n\nFig 1: Infection chain\nThe infection chain starts by sending crafted emails to the target organization or person. The\nattacker uses the Hijacking email method for sending the crafted mails with an attachment.\nThe attachment may contain a word document a macro file or a PDF. Sometimes the email\nbody contains URLs too. As mailbox is hijacked, attachment is sent replying to old email\nthreads or forwarding to an existing mail list, due to which the victim easily opens the\nattachment as the mail comes from a trusted mail id.\n\nWe encountered extensive count of spam mails, few of the examples are listed below\n## Spam Mails\n\n\n-----\n\n-----\n\n-----\n\n-----\n\nFig 2. Example of Spam\n\nmails.\nThe attacker has done a silly mistake here, we can see in the mail that the subject and the\nattachment name doesn’t match. In most of the cases, an attachment name contains\n“Medical report Covid-19″.\n\n## Document Analysis\n\nOffice Document attachment contains a macro which contains a heavily obfuscated VBA\ncode responsible to deliver payload in the chain.\n\n\n-----\n\nFig 3. Macro code in an attachment.\nAfter some de-obfuscation, the “Qndiwjphrk8an6x” function code is as below\n\n{Qndiwjphrk8an6x = “winmgmt” + “:win32_” + “p” + “rocess”}\n\nwhich translates into winmgmts:win32_process. Once we removed the chunked data we\ngot a readable code with functions and reference variables.\n\nOne interesting part in the directory in Macros\\Ofbszpwp168r\\o.stm is that we can see some\nobfuscated data again.\n\n\n-----\n\nFig\n\n4: Obfuscation in Doc file\nAfter the initial level of de-obfuscation, we got base64 encoded PowerShell script as shown\nin below figure.\n\nFig 5: base64 Encoded PowerShell code\nAfter decoding with base64 and processing data, we got the below PowerShell script\n\n-----\n\nFig 6: Base64 Decoded PowerShell script\nIt contains malicious domains or URLs which serves Emotet executables. Using PowerShell\ncommands Emotet executable is downloaded at “%temp%” directory in the victim’s machine.\n\n## Payload Analysis\n\nThe payload downloaded from the above file has a customized packer. The unpacking is\ndone at runtime. Emotet’s packer code is polymorphic which makes it difficult for signaturebased detection tools to detect it based on the packer code.\n\nIts resource (.rsrc) section has significant data which seems to be an indication that the\nmalware might be packed. In the below Fig. we can see that RCData has an encrypted code.\n\nFig 7: File having\n\nencrypted data in resource\nWhile debugging the file, we observed that the data will be decrypted using a slightly\nmodified version of RC4. Key for RC4 is hardcoded in the file. After decryption, the control\ngoes to the decrypted shellcode.\n\n\n-----\n\nFig 8: RC4 used\n\nfor decryption\nIn some files, we have seen the use of VirtualAllocExNuma to allocate new memory. This is\nused for fast processing. The beginning of an obfuscated shellcode is copied to the new\naddress after being decrypted using the modified RC4 algorithm. In addition to the relatively\nshort shellcode, an additional PE can be seen in the memory.\n\nFig 9: Decrypted\n\nshellcode and PE File\nThe Shellcode deobfuscates several API calls at runtime, such as LoadLibraryA,\n_GetProcAddress, VirtualAlloc and VirtualProtect, all of which will be used to resolve APIs and_\nallocate memory to run the additional PE.\n\nFig 10: API Resolved\n\nAfter this, the malware allocates memory and copies the data of decrypted file and calls\n_VirtualProtect and finally, the program jumps to the real entry point of the decrypted file._\n\nSpreading mechanism of Emotet campaign remains almost the same that we had already\ndiscussed in our previous blog. Read it here in the link below.\n\n\n-----\n\nhttps://blogs.quickheal.com/evolution-4-year-old-threat-emotet-infamous-trojan-complexthreat-distributer/\n\nAfter executing the Emotet, it will exfiltrate the data to the CnC server. While sending, the\ndata is encoded and sent with some random name of the file and random path to the server.\n\nFig11: CnC traffic\n\n## Detection hits stats\n\nIn Quick Heal detection, we have successfully detected such Emotet trojans. We have\nmultiple detection layers like Email protection, Online protection and Behaviour detection to\nprotect our customers.\n\nHere is the detection stats number of hits per day in the last 45 days.\n\nFig 12: Graph\n\n## Conclusion\n\n\n-----\n\nEmotet is a persistent threat actor and highly successful in delivering email-based malware,\nwith a major focus on email theft and sending additional malware. It has moderate\nobfuscated code to deliver and bypass the detection technique.\n\nWith the global impact of COVID-19, threat actors are likely to continue to use COVID-19themed emails to deliver malware broadly in support of their objectives for all sectors.\n\nQuick Heal customers have long been protected from Emotet and other COVID-19-themed\nemails. We continue to track and report such attacks to keep our customers safe.\n\n**Subject Matter Experts:**\n\nPrashant Tilekar\n\nPreksha Saxena\n\n### No Comments\n\nLeave a Reply.Your email address will not be published.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-09-29 - The return of the Emotet as the world unlocks!.pdf"
    ],
    "report_names": [
        "2020-09-29 - The return of the Emotet as the world unlocks!.pdf"
    ],
    "threat_actors": [
        {
            "id": "0fca7692-4a21-482f-a113-9548b49e8531",
            "created_at": "2022-10-25T16:07:24.117599Z",
            "updated_at": "2025-03-27T02:02:10.112146Z",
            "deleted_at": null,
            "main_name": "RedEcho",
            "aliases": [],
            "source_name": "ETDA:RedEcho",
            "tools": [
                "POISONPLUG.SHADOW",
                "ShadowPad Winnti",
                "XShellGhost"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "bc91d469-ec69-497b-81d7-068b84501e63",
            "created_at": "2023-01-06T13:46:39.192791Z",
            "updated_at": "2025-03-27T02:00:03.017845Z",
            "deleted_at": null,
            "main_name": "RedEcho",
            "aliases": [],
            "source_name": "MISPGALAXY:RedEcho",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535615,
    "ts_updated_at": 1743041144,
    "ts_creation_date": 1653781344,
    "ts_modification_date": 1653781344,
    "files": {
        "pdf": "https://archive.orkl.eu/fe50774c4a79dcb6c345f0fb1e4e02bd26dc164f.pdf",
        "text": "https://archive.orkl.eu/fe50774c4a79dcb6c345f0fb1e4e02bd26dc164f.txt",
        "img": "https://archive.orkl.eu/fe50774c4a79dcb6c345f0fb1e4e02bd26dc164f.jpg"
    }
}