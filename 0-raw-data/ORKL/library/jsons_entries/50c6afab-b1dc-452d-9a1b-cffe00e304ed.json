{
    "id": "50c6afab-b1dc-452d-9a1b-cffe00e304ed",
    "created_at": "2023-01-12T15:10:52.634542Z",
    "updated_at": "2025-03-27T02:05:58.175906Z",
    "deleted_at": null,
    "sha1_hash": "9ec3e8079f62e77b2e50920a665dc6daa5966aed",
    "title": "2021-09-15 - Analyzing The ForcedEntry Zero-Click iPhone Exploit Used By Pegasus (CVE-2021-30860)",
    "authors": "",
    "file_creation_date": "2022-05-28T03:35:21Z",
    "file_modification_date": "2022-05-28T03:35:21Z",
    "file_size": 774794,
    "plain_text": "# Analyzing The ForcedEntry Zero-Click iPhone Exploit Used By Pegasus\n\n**[trendmicro.com/en_us/research/21/i/analyzing-pegasus-spywares-zero-click-iphone-exploit-forcedentry.html](https://www.trendmicro.com/en_us/research/21/i/analyzing-pegasus-spywares-zero-click-iphone-exploit-forcedentry.html)**\n\nSeptember 15, 2021\n\nExploits & Vulnerabilities\n\nCitizen Lab has released a report on a new iPhone threat dubbed ForcedEntry. This zeroclick exploit seems to be able to circumvent Apple's BlastDoor security, and allow attackers\naccess to a device without user interaction.\n\nBy: Mickey Jin September 15, 2021 Read time: ( words)\n\n[Citizen Lab has released a report detailing sophisticated iPhone exploits being used against](https://citizenlab.ca/2021/08/bahrain-hacks-activists-with-nso-group-zero-click-iphone-exploits/)\nnine Bahraini activists. The activists were reportedly hacked with the NSO Group’s Pegasus\n[spyware using two zero-click iMessage exploits: Kismet, which was identified in 2020; and](https://citizenlab.ca/2020/12/the-great-ipwn-journalists-hacked-with-suspected-nso-group-imessage-zero-click-exploit/)\n[ForcedEntry, a new vulnerability that was identified in 2021. Zero-click attacks are labeled](https://citizenlab.ca/2021/08/bahrain-hacks-activists-with-nso-group-zero-click-iphone-exploits/)\nas sophisticated threats because unlike typical malware, they do not require user interaction\nto infect a device. The latter zero-click spyware is particularly notable because it can bypass\nsecurity protections such as BlastDoor, which was designed by Apple to protect users\nagainst zero-click intrusions such as these.\n\nAccording to Citizen Lab’s report, Kismet was used from July to September 2020 and was\nlaunched against devices running at least iOS 13.5.1 and 13.7. It was likely not effective\nagainst the iOS 14 update in September. Then, in February 2021, the NSO Group started\ndeploying the zero-click exploit that managed to circumvent BlastDoor, which Citizen Lab\ncalls ForcedEntry. Amnesty Tech, a global collective of digital rights advocates and security\nresearchers, also observed zero-click iMessage exploit activity during this period and\nreferred to it as [Megalodon.](https://www.amnesty.org/en/latest/research/2021/07/forensic-methodology-report-how-to-catch-nso-groups-pegasus/)\n\nDiving into ForcedEntry\n\nAccording to the report from Citizen Lab, when the ForcedEntry exploit was launched against\nthe victim’s device, the device logs showed two types of crashes. The first crash apparently\nhappened when invoking ImageIO’s functionality for rendering Adobe Photoshop PSD data.\n\nOur analysis focuses on the second crash, which is detailed in Figure 1. This crash\nhappened when invoking CoreGraphics’ functionality for decoding JBIG2-encoded data in a\nPDF file. This analysis is solely based on samples from Citizen Lab; no new samples were\n\n\n-----\n\nobtained.\n\nFigure 1. This image from Citizen Lab shows a Symbolicated Type Two crash for\nForcedEntry on an iPhone 12 Pro Max running iOS 14.6. The red highlights from Trend Micro\nResearch.\nFrom this crash log, we can deduce three interesting points: First, the zero-click attack is\ndependent on iMessage attachment parsing. Next, the slide of dyld_shared_cache is 0,\nwhich means all the system modules are loaded into a fixed address. Lastly, the crash point\n0x181d6e228 is not the first place of vulnerability exploitation. We discuss the details of\nthese conclusions in the following sections.\n\n**Root cause of CVE-2021-30860**\n\nThe vulnerability is inside the function JBIG2Stream::readTextRegionSeg of\nCoreGraphics.framework The crash point 0x181d6e228 (as seen in box 3 in the preceding\nfigure) is at line 161 of the function JBIG2Stream::readTextRegionSeg of the following\nscreenshot:\n\n\n-----\n\nFigure 2. Screenshot of the function JBIG2Stream::readTextRegionSeg showing the crash\npoint\nFirst, it calculates the numSyms according to the JBIG2SymbolDict segment:\n\n\n-----\n\nThe type of numSyms is unsigned int, and the return type of function seg->getSize() is also\nunsigned int. Therefore, numSyms could be smaller than the size of one JBIG2Segment due\nto integer overflow. One example is numSyms=1=(0x80000000+0x80000001) <\n_0x80000000._\n\nThen, it allocates the heap buffer syms, with the size numSyms * 8 :\n\nFinally, it fills the syms with the value from bitmap:\n\nThe loop times are dependent on the JBIG2Segment size, which could be larger than the\nbuffer syms size. This leads to the out-of-bounds write access for the heap buffer syms.\n\n**Looking at Apple’s fix**\n\nApple patched the function in iOS 14.8:\n\n\n-----\n\nFigure 3. Screenshot of the same function JBIG2Stream::readTextRegionSeg with fixes in\nplace\nWe can see that Apple adds two new boundary checks (the red box in Figure 3), to avoid\noverflowing the syms buffer.\n\n**On the Pegasus spyware exploitation**\n\n**_Disabling ASLR_**\n\nThe dyld_shared_cache of version iOS 14.6 (18F72) was loaded into IDA Pro for static\nanalysis, after which a surprising result emerged. We were able to go to the addresses on\nthe call stack directly without rebasing the segment.\n\nAs deduced from the screenshot in Figure 1 (see box 2), the slide of dyld_shared_cache is\n**0. However, in common crash scenarios, these addresses should be in slide.**\n\nIf the screenshot of the original crash log has not been modified, then the conclusion is\nworrying. It should be noted that Pegasus already disabled Address Space Layout\nRandomization (ASLR) before its exploitation.\n\n\n-----\n\n**_Bypassing PAC_**\n\nBy inspecting the address 0x181d6e20c from Frame 1 of the call stack trace, we can see\nthat register x0, the return value of function JBIG2Stream::findSegment, is a subclass of\nJBIG2Segment:\n\nThere are four kinds of subclasses that override the getType() virtual function, but the\nfollowing code shows that they just return one of the enumerate values:\n\nFor example, JBIG2SymbolDict::getType just returns jbig2SegSymbolDict=1:\n\nTherefore, the frame 1 should have called the virtual function seg->getType(). But in\nactuality, it was already subverted to the current function itself (frame 0).\n\nThis shows that the virtual functions table of the object JBIG2Segment had already been\nreplaced, and the pointer authentication code (PAC) security feature was bypassed. This is\nsignificant because the PAC security mechanism was developed to help prevent zero-click\n\n\n-----\n\n[hacking. This also shows that the crash point is not the first place of the vulnerability](https://www.vice.com/amp/en/article/pkd4kg/apple-is-going-to-make-it-harder-to-hack-iphones-with-zero-click-attacks?__twitter_impression=true)\nexploitation.\n\nConclusion and recommendations\n\nFrom the view of attack technologies used, we can see that Pegasus is quite an advanced\nthreat for iOS users. However, it seems that these attacks are being launched on very\nspecific targets, rather than common users.\n\nThe information from the recent Pegasus attack is from the forensic analysis of Citizen Lab\nand Amnesty Tech, and we have not found Pegasus attack samples that are at large yet. We\nare actively searching and monitoring for these threats and will continue to share more\ndetails as our investigation continues.\n\nEssentially, this attack is a very common file format parsing vulnerability. We previously\n[discovered CVE-2020-9883, a vulnerability similar to ForcedEntry, which could be exploited](https://www.zerodayinitiative.com/advisories/ZDI-20-1238/)\nto do the same as what Pegasus has done here. ForcedEntry’s key point is the exploit\ntechnology as it is still unknown how it is able to bypass the PAC and disable ASLR.\n\n[In the meantime, we strongly recommendupdating your device to iOS 14.8. As stated](https://support.apple.com/en-us/HT212807)\npreviously, common iOS users are not the target for attacks using this spyware. However,\nthere are simple security steps that users can take. For example, concerned users can block\niMessages from unknown senders, while a more drastic step would be to disable the\niMessage function completely in the device’s Preferences.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-09-15 - Analyzing The ForcedEntry Zero-Click iPhone Exploit Used By Pegasus (CVE-2021-30860).pdf"
    ],
    "report_names": [
        "2021-09-15 - Analyzing The ForcedEntry Zero-Click iPhone Exploit Used By Pegasus (CVE-2021-30860).pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536252,
    "ts_updated_at": 1743041158,
    "ts_creation_date": 1653708921,
    "ts_modification_date": 1653708921,
    "files": {
        "pdf": "https://archive.orkl.eu/9ec3e8079f62e77b2e50920a665dc6daa5966aed.pdf",
        "text": "https://archive.orkl.eu/9ec3e8079f62e77b2e50920a665dc6daa5966aed.txt",
        "img": "https://archive.orkl.eu/9ec3e8079f62e77b2e50920a665dc6daa5966aed.jpg"
    }
}