{
    "id": "143e0ab0-75c3-4e6d-bd76-4edfded53f47",
    "created_at": "2023-01-12T15:02:47.082747Z",
    "updated_at": "2025-03-27T02:15:46.143013Z",
    "deleted_at": null,
    "sha1_hash": "fdbcf5a0f9e8b22b45fe862ea1409d67e75ff14c",
    "title": "2016-09-01 - TADAQUEOUS moments",
    "authors": "",
    "file_creation_date": "2022-05-28T04:50:29Z",
    "file_modification_date": "2022-05-28T04:50:29Z",
    "file_size": 91711,
    "plain_text": "# TADAQUEOUS moments\n\n**laanwj.github.io/2016/09/01/tadaqueos.html**\n\n## Laanwj's blog\n\n### Randomness\n\n Blog About The one mystery module in the BLATSTING rootkit/malware/implant/… in the Equation Group dump is m12000000, or TADAQUEOUS. There is only one mention of it in the various documentation and scripts:\n\n If you are putting up tadaqueous, there will be lp error due to a missing files, there is no LP for this module.\n\n What is meant here is that there is no Listening Post, or LP module for it. “Listening Post” is what the Equation Group calls its command-and-control programs. It can only be loaded and unloaded through this interface, not controlled, and it will spit an error message. Well, that tells us nothing.\n\n At first sight the module looks sort of boring. It packages a kernel module and a user-space executable, but looking at the imported symbols and (open) strings, what it does is something with Linux processes and system calls.\n\n However, after delving a bit deeper, I stumbled on a function that hooks a whole series of kernel calls, whose names are obfuscated in the binary:\n\n\n-----\n\n```\n╒ (fcn) hook_kernel_functions 153\n│      ; CALL XREF from 0x08001673 (fcn.080015a8)\n│      0x08000f54   57       push edi          ; 0 args hooks up to 14 kernel functions\n│      0x08000f55   56       push esi\n│      0x08000f56   53       push ebx\n│      0x08000f57   83ec10     sub esp, 0x10\n│      0x08000f5a   31c0      xor eax, eax\n│      0x08000f5c   c744240c0000. mov dword [esp + 0xc], 0  ; [ra - 0x10]\n│      0x08000f64   89c7      mov edi, eax\n│      0x08000f66   31f6      xor esi, esi\n│    ┌─> 0x08000f68   80bed4030000. cmp byte [esi + 0x3d4], 0 ; RELOC 32\n.data\n│   ┌──< 0x08000f6f   7517      jne 0x8000f88        ; hook this\nfunction?\n│   ┌───> 0x08000f71   47       inc edi           ; advance\nforward\n│   │││  0x08000f72   83c618     add esi, 0x18        ; records are\n0x18 bytes\n│   │││  0x08000f75   83ff0e     cmp edi, 0xe        ; count to 14\n│   ││└─< 0x08000f78   76ee      jbe 0x8000f68        ; the end?\n│   ││  0x08000f7a   89c2      mov edx, eax\n│  ┌┌──┌─> 0x08000f7c   83c410     add esp, 0x10\n│  │││││  0x08000f7f   5b       pop ebx\n│  │││││  0x08000f80   5e       pop esi\n│  │││││  0x08000f81   89d0      mov eax, edx\n│  │││││  0x08000f83   5f       pop edi\n│  │││││  0x08000f84   c3       ret\n  │││││  0x08000f85   8d7600     lea esi, [esi]\n│  │││└──> 0x08000f88   c744240c0000. mov dword [esp + 0xc], 0  ; [ra - 0x10]\n│  │││ │  0x08000f90   51       push ecx\n│  │││ │  0x08000f91   6a05      push 5\n│  │││ │  0x08000f93   ffb6c8030000  push dword [esi + 0x3c8] ; RELOC 32 .data\n; kernel function to hook\n│  │││ │  0x08000f99   8d442418    lea eax, [esp + 0x18]    ; [ra - 0x10]\n│  │││ │  0x08000f9d   50       push eax          ; outptr\n│  │││ │  0x08000f9e   a100000000   mov eax, dword [0] ; RELOC 32\nthe_interface\n│  │││ │  0x08000fa3   ff5054     call dword [eax + 0x54]   ; call core.54\nis kernel function hookable?\n│  │││ │  0x08000fa6   83c410     add esp, 0x10\n│  │││ │  0x08000fa9   85c0      test eax, eax\n│  │││ │  0x08000fab   8d9ec0030000  lea ebx, [esi + 0x3c0] ; RELOC 32 .data\n│  │││ │  0x08000fb1   baffffffff   mov edx, 0xffffffff\n│  └─────< 0x08000fb6   74c4      je 0x8000f7c\n│  ││ │  0x08000fb8   8b54240c    mov edx, dword [esp + 0xc] ; [ra - 0x10]\n│  ││ │  0x08000fbc   85d2      test edx, edx\n│  ││┌──< 0x08000fbe   7526      jne 0x8000fe6        ; FAIL\n│  ││││  0x08000fc0   83ec0c     sub esp, 0xc\n│  ││││  0x08000fc3   6a00      push 0\n│  ││││  0x08000fc5   50       push eax          ; return value\nfrom core.54\n│  ││││  0x08000fc6   ff730c     push dword [ebx + 0xc]   ; local\nfunction to redirect to\n│  ││││  0x08000fc9   ff7308     push dword [ebx + 8]    ; kernel\n\n```\n\n-----\n\n```\nfunction to hook\n│  ││││  0x08000fcc   8d4304     lea eax, [ebx + 4]\n│  ││││  0x08000fcf   50       push eax          ; outptr\n│  ││││  0x08000fd0   a100000000   mov eax, dword [0] ; RELOC 32\nthe_interface\n│  ││││  0x08000fd5   ff5058     call dword [eax + 0x58]   ; call\ncore.58: hook kernel function\n│  ││││  0x08000fd8   83c420     add esp, 0x20\n│  ││││  0x08000fdb   85c0      test eax, eax\n│  ││││  0x08000fdd   baffffffff   mov edx, 0xffffffff\n│  │└───< 0x08000fe2   748d      je 0x8000f71\n│  └────< 0x08000fe4   eb96      jmp 0x8000f7c\n│   └──> 0x08000fe6   baffffffff   mov edx, 0xffffffff\n╘    └─< 0x08000feb   eb8f      jmp 0x8000f7c\n\n### Summarizing the data structure at .data+0x3c0 :\n\n Offset Flag Target symbol Redirected to\n\n 0x000003c0 0x0001 __add_ipsec_sa .text+0x00000c60\n\n 0x000003d8 0x0002 asic_init_cmd_block .text+0x00000e8c\n\n 0x000003f0 0x0004 __del_ipsec_sa .text+0x00000da0\n\n 0x00000408 0x0008 get_random_bytes 0x00000000\n\n 0x00000420 0x0010 cipher_des 0x00000000\n\n 0x00000438 0x0020 cipher_3des 0x00000000\n\n 0x00000450 0x0040 cipher_aes 0x00000000\n\n 0x00000468 0x0080 cipher_null 0x00000000\n\n 0x00000480 0x0100 hmac_null 0x00000000\n\n 0x00000498 0x0200 hmac_md5_96 0x00000000\n\n 0x000004b0 0x0400 hmac_sha1_96 0x00000000\n\n 0x000004c8 0x0800 cipher_dev_in_use 0x00000000\n\n 0x000004e0 0x1000 asic_xxcrypt .text+0x00000f18\n\n 0x000004f8 0x2000 cpx_read_rand .text+0x00000e50\n\n It looks like this is a noteworthy module after all:\n\n Most of the symbols are not standard Linux symbols but specific to the TOS/Fortinet implementation. Their meaning, however is clear from the name.\n\n```\n\n-----\n\n### Some of the functions are redirected to a local function, others to 0x00000000, which likely means that they are disabled completely.\n\n It does give a huge hint at what the goal of this module is: cripple or disable IPsec! It appears it can be used to selectively disable ciphers, HMAC algorithms, and random number generation. It is obvious how this is useful to anyone trying to either intercept or insert themselves into a target’s VPN network.\n\n Shunting the function get_random_bytes will have the effect of disabling all random number generation in the kernel. Not just for IPsec, but also for e.g. TCP sequence numbers, enabling IP spoofing. It is not used for /dev/[u]random however, so user space processes cannot easily detect this.\n\n nohats.ca writes, in the conclusion of an artice about IPsec and the Snowden revelations:\n\n I read this to mean that the hardware or software of the system running IPsec was compromised, causing it to send valid protocol ESP packets, but creating those in such a way that these could be decrypted without knowing the ESP session keys (from IKE). Possibly by subverting the hardware number generator, or functions related to IV / ICV’s / nonces that would appear to be random but were not.\n\n We’ve found out one of the ways how. This targets a specific series of routers, but I’d be surprised if it was the only one, and other instances may be similar to this implementation, or based on it: there are various hints that BLATSTING is the oldest generation of implants in the EQGRP dump.\n\n Written on September 1, 2016\n\n Tags: eqgrp malware Filed under Reverse-engineering\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2016/2016-09-01 - TADAQUEOUS moments.pdf"
    ],
    "report_names": [
        "2016-09-01 - TADAQUEOUS moments.pdf"
    ],
    "threat_actors": [
        {
            "id": "b740943a-da51-4133-855b-df29822531ea",
            "created_at": "2022-10-25T15:50:23.604126Z",
            "updated_at": "2025-03-27T02:00:55.505366Z",
            "deleted_at": null,
            "main_name": "Equation",
            "aliases": [
                "Equation"
            ],
            "source_name": "MITRE:Equation",
            "tools": null,
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "08623296-52be-4977-8622-50efda44e9cc",
            "created_at": "2023-01-06T13:46:38.549387Z",
            "updated_at": "2025-03-27T02:00:02.859535Z",
            "deleted_at": null,
            "main_name": "Equation Group",
            "aliases": [
                "Tilded Team",
                "EQGRP",
                "G0020"
            ],
            "source_name": "MISPGALAXY:Equation Group",
            "tools": [
                "EquationLaser",
                "EquationDrug",
                "DoubleFantasy",
                "TripleFantasy",
                "GrayFish"
            ],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "2d9fbbd7-e4c3-40e5-b751-27af27c8610b",
            "created_at": "2024-05-01T02:03:08.144214Z",
            "updated_at": "2025-03-27T02:05:17.419705Z",
            "deleted_at": null,
            "main_name": "PLATINUM COLONY",
            "aliases": [
                "Equation Group "
            ],
            "source_name": "Secureworks:PLATINUM COLONY",
            "tools": [
                " EquationDrug",
                " EquationLaser",
                " Fanny",
                " GrayFish",
                " TripleFantasy",
                "DoubleFantasy"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "e0fed6e6-a593-4041-80ef-694261825937",
            "created_at": "2022-10-25T16:07:23.593572Z",
            "updated_at": "2025-03-27T02:02:09.879892Z",
            "deleted_at": null,
            "main_name": "Equation Group",
            "aliases": [
                "APT-C-40",
                "Platinum Colony",
                "Tilded Team"
            ],
            "source_name": "ETDA:Equation Group",
            "tools": [
                "Bvp47",
                "DEMENTIAWHEEL",
                "DOUBLEFANTASY",
                "DanderSpritz",
                "DarkPulsar",
                "DoubleFantasy",
                "DoubleFeature",
                "DoublePulsar",
                "Duqu",
                "EQUATIONDRUG",
                "EQUATIONLASER",
                "EQUESTRE",
                "Flamer",
                "GRAYFISH",
                "GROK",
                "OddJob",
                "Plexor",
                "Prax",
                "Regin",
                "Skywiper",
                "TRIPLEFANTASY",
                "Tilded",
                "UNITEDRAKE",
                "WarriorPride",
                "sKyWIper"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535767,
    "ts_updated_at": 1743041746,
    "ts_creation_date": 1653713429,
    "ts_modification_date": 1653713429,
    "files": {
        "pdf": "https://archive.orkl.eu/fdbcf5a0f9e8b22b45fe862ea1409d67e75ff14c.pdf",
        "text": "https://archive.orkl.eu/fdbcf5a0f9e8b22b45fe862ea1409d67e75ff14c.txt",
        "img": "https://archive.orkl.eu/fdbcf5a0f9e8b22b45fe862ea1409d67e75ff14c.jpg"
    }
}