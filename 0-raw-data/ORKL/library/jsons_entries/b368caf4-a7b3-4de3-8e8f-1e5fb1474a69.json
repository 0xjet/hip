{
    "id": "b368caf4-a7b3-4de3-8e8f-1e5fb1474a69",
    "created_at": "2023-01-12T14:58:49.112469Z",
    "updated_at": "2025-03-27T02:16:41.94423Z",
    "deleted_at": null,
    "sha1_hash": "ca65df8991a1a27a565425a173cd9aa7e8e12165",
    "title": "2021-05-17 - Investigating the Watering Hole Linked to the Oldsmar Water Treatment Facility Breach",
    "authors": "",
    "file_creation_date": "2022-05-27T21:07:45Z",
    "file_modification_date": "2022-05-27T21:07:45Z",
    "file_size": 2828806,
    "plain_text": "# When Intrusions Don’t Align: A New Water Watering Hole and Oldsmar\n\n**[dragos.com/blog/investigating-the-watering-hole-linked-to-the-oldsmar-water-treatment-facility-breach/](https://www.dragos.com/blog/investigating-the-watering-hole-linked-to-the-oldsmar-water-treatment-facility-breach/)**\n\nMay 18, 2021\n\nBlog Post\n\nBy Kent Backman\n\n05.18.21\n\n\n-----\n\nMembers of the cybersecurity community at large know that learning opportunities present\nthemselves every day. The purpose behind this investigative anecdote on the “water\nwatering hole” is educational and highlights how sometimes two intrusions just don’t line up\ntogether no matter how much coincidence there is. We hope you will agree after reading\nthis that intelligence and intrusion analysis are not always what they seem.\n\nOur story begins in Oldsmar, Florida, on Monday, 08 February 2021, when the Pinellas\n[County Sheriff held a press conference. The sheriff, Oldsmar mayor, and city](https://www.youtube.com/watch?v=MkXDSOgLQ6M)\nmanager described a water poisoning attempt at the city’s water treatment plant the\nprevious Friday. This unprecedented event made both a stir in the media\nand among Dragos’s team of adversary hunters.\n\n## A Water Watering HoleIs Discovered\n\n[During our investigation into the infamous water poisoning attempt against the citizens of](https://www.dragos.com/blog/industry-news/recommendations-following-the-oldsmar-water-treatment-facility-cyber-attack/)\nOldsmar, Dragos discovered a Florida water utility contractor hosting malicious code on\ntheir website (i.e., a watering hole). This malicious code seemingly targeted water utilities,\nparticularly in Florida, and more importantly, was visited by a browser from the city of\nOldsmar on the same day of the poisoning event.\n\n\n-----\n\nFigure 1: Website compromised with a unique browser enumeration and fingerprinting script\nThe adversary inserted the malicious code into the footer file (Figure 2) of the WordPressbased site associated with a Florida water infrastructure construction company. The\nadversary possibly exploited one of the multiple vulnerable WordPress plugins that Dragos\ndetermined were in use on the site at the time of compromise.\n\nFigure 2: Location of the subverted code in the footer of the once compromised WordPress\nsite xxxxxxxxxxxxxx[.]com\n\n## A Snapshot of the Malicious Data Gathering Campaign\n\nThis malicious data gathering campaign affected computer systems that browsed the\ncompromised, but otherwise legitimate, website during a 58-day window beginning 20\nDecember 2020. Dragos assisted with malicious code identification and initial remediation\nof the compromised website on 16 February 2021. Those who interacted with the malicious\ncode included computers from municipal water utility customers, state and local government\nagencies, various water industry-related private companies, and normal internet bot and\nwebsite crawler traffic. Over 1000 end-user computers were profiled by the malicious code\nduring that time, mostly from within the United States and the State of Florida, as shown in\nFigure 3.\n\n\n-----\n\nFigure 3: Geolocation of US fingerprinted client computers\nUsing telemetry from Team Cymru [Pure Signal Recon, Dragos determined that a user on a](https://team-cymru.com/products/pure-signal-recon-threat-hunting-and-threat-reconnaissance/)\ncomputer system on a network belonging to the City of Oldsmar browsed the compromised\nsite at exactly 14:49 Coordinated Universal Time (UTC), or 9:49 am on 05 February 2021.\nThis is the same network where an unknown actor reportedly compromised a water\ntreatment control plant computer on the morning of 05 February and attempted to poison\nthe water supply using the computer system’s Human Machine Interface (HMI).\n\nBased on these initial facts Dragos released an Advisory Alert on 17 February 2021 to\ncustomers informing them of the watering hole potentially targeting water utilities along with\ndefensive guidance and indicators. The purpose of an Advisory Alert is to ensure\ncustomers receive and can act on timely intelligence when the entire story is not yet known.\nWe also shared our insights with our partners at the Department of Homeland Security\n(DHS) so they could perform victim notifications if they deemed it important.\n\nAfter the Advisory Alert Dragos went to work uncovering and exposing the entire threat.\n\nWatch the SANS webinar with Dragos, \"Analyzing a New Water Watering Hole,\" on-demand now.\n\n[Watch Now](https://www.dragos.com/resource/analyzing-a-new-water-watering-hole/)\n\n## Deciphering the Malicious Fingerprinting Script\n\nDragos reverse-engineered the fingerprinting script and determined it used code from four\ndifferent code projects: [core-js,](https://github.com/zloirock/core-js) [UAParser,](https://github.com/faisalman/ua-parser-js) [regeneratorRuntime, and a data collection script](https://github.com/xubaifuCode/regeneratorRuntime)\n[only observed elsewhere on two websites (website 1,](https://bfpjs.epik.com/bfp.js) [website 2) associated with a domain](https://bfpjs.wecandevelopit.com/bfp.js)\nregistration hosting and web development company\n\n\n-----\n\nThe fingerprinting script gathered over 100 elements of detailed information about the\nvisitors including the following:\n\nOperating system and CPU\nBrowser, including available languages\nTouch points, input methods, presence of camera, accelerometer, microphone\nVideo card display adapter details, and\nTime zone, geolocation, video codecs, screen dimensions, browser plugins\n\nThe script also directed the visiting browser to two separate browser cipher fingerprinting\n[sites to collect cipher fingerprint hashes: TLS fingerprint,](https://client.tlsfingerprint.io/) [JA SSL Fingerprint. Various](https://ja3er.com/json)\n[network defense regimes typically compute browser cipher fingerprinting such as JA3 (done](https://engineering.salesforce.com/tls-fingerprinting-with-ja3-and-ja3s-247362855967)\nby ja3er[.]com, for example) to detect connections from malware-infected hosts and discern\nhostile connections from legitimate browser client traffic. Once all this data was collected in\nthe browser memory, the JavaScript code sent the data via Hypertext Transfer Protocol\n(HTTP) POSTs to a database on the same Heroku app site that hosted the script,\nbdatac.herokuapp[.]com. This Heroku app was taken down after notification from Dragos.\n\nDragos found exactly one other internet site that hosted this complex code and served it to\nvisiting internet browsers, DarkTeam Store. DarkTeam Store claims to be a dark market that\nsupplies thousands of customers with gift cards and accounts (Figure 4).\n\nFigure 4: Browser enumeration and fingerprinting script on purported dark market site\ndarkteam.store\n\n\n-----\n\nAdditional analysis of data obtained by Dragos revealed that at least a portion of this site\nmay not actually be a dark market, but rather a check-in place for systems infected with a\nrecent variant of botnet malware known as Tofsee. Dragos found evidence showing that the\nDarkTeam store and the water infrastructure construction company website were subverted\nby the same actor on the same day (20 December 2020). Dragos observed 12,735 IP\naddresses representing likely Tofsee-infected systems worldwide employing 271 unique\nuser agents. These clients connected to a non-public (i.e., requiring authentication) page\n(httpx://darkteam[.]store/dogs/Home-2.html) of the DarkTeam site and presented a browser\nuser agent string with a peculiar “Tesseract/1.0” artifact (Figure 5).\n\nFigure 5: Unique “Tesseract/1.0” user agent substring artifact associated with browser\ncheck-ins to restricted page on darkteam.store site\n\n## Improving Botnets to Impersonate Legitimate Browser Activity\n\nThis bot check-in routine for JA3 cipher fingerprinting may be the Tofsee malware author’s\nresponse to network defense techniques used to detect previous iterations of Tofsee botnet\n[malware with a characteristic JA3 hash. Dragos performed forensic log analysis and](https://community.ibm.com/community/user/security/blogs/tom-obremski1/2020/10/23/qni-ja3-ja3s-for-network-encryption)\nidentified three JA3 hashes unique to this new Tofsee botnet that Dragos calls “Tesseract.”\nDragos also obtained other JA3 hashes from an industry partner that observed connections\nfrom this botnet. Some of these JA3 hashes are also associated with legitimate browsers.\nDragos focuses solely on ICS cybersecurity, but as we obtain detailed intelligence on this\nthreat from our investigation, we share indicators to facilitate botnet detection.\n\nWith the forensic information we collected so far, Dragos’s best assessment is that an actor\ndeployed the watering hole on the water infrastructure construction company site to collect\nlegitimate browser data for the purpose of improving the botnet malware’s ability to\nimpersonate legitimate web browser activity. The botnet’s use of at least ten different cipher\nhandshakes or JA3 hashes, some of which mimic legitimate browsers, compared to the\nwidely published hash of a single handshake of a previous Tofsee bot iteration is evidence\nof botnet improvement.\n\n\n-----\n\n## In Summary\n\nWe do not understand why the adversary chose this specific Florida water construction\ncompany site to compromise and to host their code. Interestingly, and unlike other watering\nhole attacks, the code did not deliver exploits or attempt to achieve access to victim\ncomputers. It is possible the actor believed that the water infrastructure construction\nwebsite would allow more dwell time to collect data important for the actor’s objectives, than\nperhaps a busier but more closely monitored website with a dedicated security team.\n\nSeveral elements early in our investigation suggested a highly potent and dangerous threat\nto water utilities:\n\nFlorida-focused watering hole\nTemporal correlation to Oldsmar event\nHighly encoded and sophisticated JavaScript\nFew code locations on the internet\nKnown ICS-targeting activity groups use watering holes as initial access including:\n[DYMALLOY,](https://www.dragos.com/threat/dymalloy/) [ALLANITE, and](https://www.dragos.com/threat/allanite/) [RASPITE](https://www.dragos.com/threat/raspite/)\n\nFurther investigation revealed a less ominous threat but provided an excellent lesson in\nalerting the industry early to potential threats while continuing the investigation until the full\nscope and intent of the events can be understood.\n\nThis is not a typical watering hole. We have medium confidence it did not directly\ncompromise any organization. But it does represent an exposure risk to the water industry\nand highlights the importance of controlling access to untrusted websites, especially for\nOperational Technology (OT) and Industrial Control System (ICS) environments.\n\nTo learn more about Dragos’ analysis of the watering hole linked to the City of Oldsmar\nwater treatment facility breach, watch the SANS webinar, “Analyzing a new Water Watering\nHole,” on-demand now.\n\n## Indicators\n\n“Tesseract” variant of the Tofsee botnet malware indicators:\n\n**JA3 Hashes**\n\n5732cd1c2c85c7548ef840e05f42feec\n\n45728c30345dddda40cd01ee2f7a4c8e\n\n9f681ac5cde4d035b5d3dc040bda1a34\n\n**User-agent substring artifact**\n\n\n-----\n\nTesseract/1.0\n\n**User agent examples**\n\nMozilla/5.0 (Windows NT 10.0; Win64; x64; Tesseract/1.0) AppleWebKit/537.36 (KHTML,\nlike Gecko) Chrome/80.0.3987.163 Safari/537.36\n\nMozilla/5.0 (Android 10; Mobile; rv:84.0; Tesseract/1.0) Gecko/84.0 Firefox/84.0\n\nMozilla/5.0 (iPhone; CPU iPhone OS 14_3 like Mac OS X; Tesseract/1.0)\nAppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.0.2 Mobile/15E148 Safari/604.\n\nMozilla/5.0 (Windows NT 6.1; Tesseract/1.0) AppleWebKit/537.36 (KHTML, like Gecko)\nChrome/88.0.4324.104 Safari/537.36\n\nMozilla/5.0 (Windows NT 6.1; Win64; x64; rv:84.0; Tesseract/1.0) Gecko/20100101\nFirefox/84.0 (count: 68, last seen: 2021-02-18 17:32:12)\n\nMozilla/5.0 (Linux; Android 10; Redmi Note 9S; Tesseract/1.0) AppleWebKit/537.36\n(KHTML, like Gecko) Chrome/88.0.4324.152 Mobile Safari/537\n\nMozilla/5.0 (Windows NT 10.0; Win64; x64; Tesseract/1.0) AppleWebKit/537.36 (KHTML,\nlike Gecko) Chrome/75.0.3770.142 Safari/537.36\n\nMozilla/5.0 (Linux; Android 10; Redmi Note 8; Tesseract/1.0) AppleWebKit/537.36\n(KHTML, like Gecko) Chrome/87.0.4280.101 Mobile Safari/537.36\n\n**Tofsee botnet malware SHA256**\n\n6ce6c04ffb7f0ac158c0e340b52d2ebdb48fd089bd24c6fdbf81947bce0e476d\n\n2701f35430167bbb99f334c81088af75f8209a07cb1bcbf9c765a4968af2fbaa\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-05-17 - Investigating the Watering Hole Linked to the Oldsmar Water Treatment Facility Breach.pdf"
    ],
    "report_names": [
        "2021-05-17 - Investigating the Watering Hole Linked to the Oldsmar Water Treatment Facility Breach.pdf"
    ],
    "threat_actors": [
        {
            "id": "81d49904-579d-45b3-ace2-1fdf0a713bc4",
            "created_at": "2022-10-25T15:50:23.331457Z",
            "updated_at": "2025-03-27T02:00:55.444159Z",
            "deleted_at": null,
            "main_name": "Leafminer",
            "aliases": [
                "Leafminer",
                "Raspite"
            ],
            "source_name": "MITRE:Leafminer",
            "tools": [
                "LaZagne",
                "Mimikatz",
                "MailSniper",
                "PsExec"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "e2a4bc0b-6745-4e55-9d7c-3d169d70b025",
            "created_at": "2022-10-25T16:07:23.386907Z",
            "updated_at": "2025-03-27T02:02:09.774331Z",
            "deleted_at": null,
            "main_name": "Berserk Bear",
            "aliases": [
                "Berserk Bear",
                "Dragonfly 2.0",
                "Dymalloy"
            ],
            "source_name": "ETDA:Berserk Bear",
            "tools": [
                "Fuerboos",
                "Goodor",
                "Impacket",
                "Karagany",
                "Karagny",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Phishery",
                "Trojan.Karagany",
                "Trojan.Phisherly",
                "xFrost"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "32c8c1a1-ae5c-4a05-a95d-2e970a46cd1e",
            "created_at": "2022-10-25T16:07:23.777999Z",
            "updated_at": "2025-03-27T02:02:09.976101Z",
            "deleted_at": null,
            "main_name": "Leafminer",
            "aliases": [
                "Flash Kitten",
                "Leafminer",
                "Raspite"
            ],
            "source_name": "ETDA:Leafminer",
            "tools": [
                "Imecab",
                "LaZagne",
                "Mimikatz",
                "PhpSpy",
                "Sorgu"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "5cbf6c32-482d-4cd2-9d11-0d9311acdc28",
            "created_at": "2023-01-06T13:46:38.39927Z",
            "updated_at": "2025-03-27T02:00:02.823829Z",
            "deleted_at": null,
            "main_name": "ENERGETIC BEAR",
            "aliases": [
                "DYMALLOY",
                "TG-4192",
                "Crouching Yeti",
                "Group 24",
                "Havex",
                "IRON LIBERTY",
                "Blue Kraken",
                "ALLANITE",
                "Koala Team",
                "G0035",
                "ATK6",
                "ITG15",
                "Ghost Blizzard",
                "BERSERK BEAR"
            ],
            "source_name": "MISPGALAXY:ENERGETIC BEAR",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "552eeef7-4a19-44de-9147-db8893c115ef",
            "created_at": "2023-01-06T13:46:38.598788Z",
            "updated_at": "2025-03-27T02:00:02.869953Z",
            "deleted_at": null,
            "main_name": "RASPITE",
            "aliases": [
                "Raspite",
                "LeafMiner"
            ],
            "source_name": "MISPGALAXY:RASPITE",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "649b5b3e-b16e-44db-91bc-ae80b825050e",
            "created_at": "2022-10-25T15:50:23.290412Z",
            "updated_at": "2025-03-27T02:00:55.431037Z",
            "deleted_at": null,
            "main_name": "Dragonfly",
            "aliases": [
                "TEMP.Isotope",
                "DYMALLOY",
                "Berserk Bear",
                "TG-4192",
                "Crouching Yeti",
                "IRON LIBERTY",
                "Energetic Bear",
                "Ghost Blizzard"
            ],
            "source_name": "MITRE:Dragonfly",
            "tools": [
                "MCMD",
                "Impacket",
                "CrackMapExec",
                "Backdoor.Oldrea",
                "Mimikatz",
                "PsExec",
                "Trojan.Karagany",
                "netsh"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "1a76ed30-4daf-4817-98ae-87c667364464",
            "created_at": "2022-10-25T16:47:55.891029Z",
            "updated_at": "2025-03-27T02:05:17.408867Z",
            "deleted_at": null,
            "main_name": "IRON LIBERTY",
            "aliases": [
                "ATK6 ",
                "BROMINE ",
                "CASTLE ",
                "Crouching Yeti ",
                "DYMALLOY ",
                "Dragonfly ",
                "Energetic Bear / Berserk Bear ",
                "Ghost Blizzard ",
                "TEMP.Isotope ",
                "TG-4192 ",
                "ALLANITE "
            ],
            "source_name": "Secureworks:IRON LIBERTY",
            "tools": [
                " Ddex Loader",
                " Havex",
                " Karagany",
                " Loek",
                " MCMD",
                " Sysmain",
                " xfrost",
                "ClientX"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "a792743d-78a4-40c9-9d9a-a12c52880297",
            "created_at": "2023-01-06T13:46:38.75457Z",
            "updated_at": "2025-03-27T02:00:02.909884Z",
            "deleted_at": null,
            "main_name": "ALLANITE",
            "aliases": [
                "Palmetto Fusion",
                "Allanite"
            ],
            "source_name": "MISPGALAXY:ALLANITE",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "90307967-d5eb-4b7b-b8de-6fa2089a176e",
            "created_at": "2022-10-25T15:50:23.501119Z",
            "updated_at": "2025-03-27T02:00:55.486295Z",
            "deleted_at": null,
            "main_name": "Dragonfly 2.0",
            "aliases": [
                "Dragonfly 2.0",
                "IRON LIBERTY",
                "DYMALLOY",
                "Berserk Bear"
            ],
            "source_name": "MITRE:Dragonfly 2.0",
            "tools": [
                "netsh",
                "Impacket",
                "MCMD",
                "CrackMapExec",
                "Trojan.Karagany",
                "PsExec"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "0a0132a3-526d-4698-be49-5e75530c1417",
            "created_at": "2022-10-25T15:50:23.856139Z",
            "updated_at": "2025-03-27T02:00:55.559398Z",
            "deleted_at": null,
            "main_name": "ALLANITE",
            "aliases": [
                "ALLANITE",
                "Palmetto Fusion"
            ],
            "source_name": "MITRE:ALLANITE",
            "tools": null,
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "1c4281e9-0a4c-4f20-94a2-25ed3661cc98",
            "created_at": "2022-10-25T16:07:23.301826Z",
            "updated_at": "2025-03-27T02:02:09.72625Z",
            "deleted_at": null,
            "main_name": "Allanite",
            "aliases": [
                "Palmetto Fusion"
            ],
            "source_name": "ETDA:Allanite",
            "tools": [
                "PsExec",
                "SecreetsDump",
                "THC Hydra"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535529,
    "ts_updated_at": 1743041801,
    "ts_creation_date": 1653685665,
    "ts_modification_date": 1653685665,
    "files": {
        "pdf": "https://archive.orkl.eu/ca65df8991a1a27a565425a173cd9aa7e8e12165.pdf",
        "text": "https://archive.orkl.eu/ca65df8991a1a27a565425a173cd9aa7e8e12165.txt",
        "img": "https://archive.orkl.eu/ca65df8991a1a27a565425a173cd9aa7e8e12165.jpg"
    }
}