{
    "id": "627111d8-e489-4287-ae4d-f8558e62e73e",
    "created_at": "2022-10-25T16:48:17.251439Z",
    "updated_at": "2025-03-27T02:13:12.180603Z",
    "deleted_at": null,
    "sha1_hash": "3f2c224705dbf8658a97e8cbf6ca322ddf72862f",
    "title": "Report: Maui ransomware",
    "authors": "",
    "file_creation_date": "0001-01-01T00:00:00Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 350587,
    "plain_text": "# Maui ransomware\n\n#### Threat report\n\n Silas Cutler, Principal Reverse Engineer 06/07/2022\n\n\n-----\n\n###### THREAT REPORT\n\n\n# Table of contents\n\n**Technical overview** **3**\n\nEncryption 4\n\nHard-coded public key 5\n\nRuntime keys 6\n\nFile encryption 6\n\n**Appendix** **8**\n\nPoC key extractor 8\n\n\n**YARA rules** **9**\n\n**Files** **10**\n\n##### 2\n\n\n-----\n\n###### THREAT REPORT\n\n\nAs ransomware has grown to epidemic proportions, the ecosystems of Ransomware-as-a-Service\n(RaaS) gangs such as Conti, LockBit, and BlackCat have become broadly recognizable. Outside of that\necosystem, there are other ransomware families that often receive less attention, yet are important to\nstudy because they can help broaden our understanding of the ways threat actors may conduct\nextortion operations.\n\nIn June 2022, the Stairwell research team investigated one of these lesser-known families, the Maui\nransomware. Maui stood out to us because of a lack of several key features we commonly see with\ntooling from RaaS providers, such as an embedded ransom note to provide recovery instructions or\nautomated means of transmitting encryption keys to attackers. Instead, we believe that Maui is\nmanually operated, in which operators will specify which files to encrypt when executing it and then\nexfiltrate the resulting runtime artifacts.\n\nThere are many aspects to Maui ransomware that are unknown, including usage context. The following\nreport will provide a technical overview of the Maui ransomware; our goal with the publication of our\nfindings is to raise awareness of this ransomware and provide a starting point for other researchers.\n\n## Technical overview\n\nThe earliest identified copy of Maui (SHA256 hash:\n```\n5b7ecf7e9d0715f1122baf4ce745c5fcd769dee48150616753fec4d6da16e99e) was first collected\n\n```\nby Stairwell’s inception platform on 3 April 2022. All identified copies of Maui (as of this report) have\nshared a compilation timestamp of 15 April 2021 04:36:00 UTC. Based on overlapping compilation\ntimestamps and error messages, it is believed that Maui is configured using an unidentified external\nbuilder.\n\nMaui is believed to be designed for manual execution by attackers. When executed at the command line\nwithout any arguments, Maui prints usage information, detailing supported command-line parameters\n(shown in Figure 1). The only required argument is a folder path, which Maui will parse and encrypt\nidentified files.\n\n```\nUsage: maui [-ptx] [PATH]\nOptions:\n-p dir: Set Log Directory (Default: Current Directory)\n-t n:      Set Thread Count (Default: 1)\n-x:       Self Melt (Default: No)\n\n```\n\nFigure 1: Maui command line usage details\n\n##### 3\n\n\n-----\n\n###### THREAT REPORT\n\n\nEmbedded usage instructions and the assessed use of a builder is common when there is an\noperational separation between developers and users of a malware family. The Stairwell research team\nhas not identified any public offerings for Maui and assesses that it is likely privately developed.\n\n### Encryption\n\nInstead of relying upon external infrastructure to receive encryption keys, Maui creates three files in the\nsame directory it was executed from (unless a custom log directory is passed using the -p command\n\nline argument) containing the results of its execution. These files are likely exfiltrated by Maui operators\nand processed by private tooling to generate associated decryption tooling. A description of each of\nthese files is provided below:\n\n|File Name|Description|\n|---|---|\n|maui.evd|RSA private key generated at runtime, encrypted using hard-coded public key|\n|maui.key|RSA public key generated at runtime, encoded using XOR key generated from hard drive information|\n|maui.log|Log file containing output console output from execution|\n\n\nTable 1: Files generated by Maui\n\n\nThe strategy used in Maui for encrypting files can be logically divided into three layers, similar to Conti\n(2021)[1] and ShiOne (2022).[2]\n\nAt the inner layer, files are encrypted using Advanced Encryption Standard (AES) with a unique 16-byte\nkey for each file. Corresponding AES keys are RSA (Rivest–Shamir–Adleman) encrypted using a keypair\ngenerated the first time Maui is run (referred to hereafter as the runtime RSA keys). This key pair\nrepresents the second layer of encryption and, unless Maui is run under different conditions, will be\nunique to each system. At the final layer, runtime RSA keys are encrypted, using a different, hard-coded\nRSA public key (stored at the end of the Maui executable).\n\nFrom the limited number of observed samples, it is unclear if this hard-coded public key is unique to\ncampaigns, targeted networks, or individual operators.\n\n1 [https://assets.sentinelone.com/sentinellabs/conti-ransomware-unpacked](https://assets.sentinelone.com/sentinellabs/conti-ransomware-unpacked)\n\n2 [https://blog.malwarebytes.com/threat-analysis/2018/02/encryption-101-shione-ransomware-case-study/](https://blog.malwarebytes.com/threat-analysis/2018/02/encryption-101-shione-ransomware-case-study/)\n\n##### 4\n\n\n-----\n\n###### THREAT REPORT\n\n\n###### Hard-coded public key\n\nAt the start of execution, Maui will load an RSA public key stored at the end of itself on disk. This key is\nstored in a format (shown in Figure 2) designed to allow for safe programmatic retrieval.\n\n```\n000bedf0: 0000 0000 0000 0000 0000 0000 0000 0000 ................\n000bee00: 3081 9f30 0d06 092a 8648 86f7 0d01 0101 0..0...*.H......\n000bee10: 0500 0381 8d00 3081 8902 8181 00b9 0893 ......0.........\n000bee20: 47b1 444e 7caa 2627 6d01 dd0a b82d 91b0 G.DN|.&'m....-..\n000bee30: e980 04e2 2a45 163c 555a 5dff 6761 74fd ....*E.<UZ].gat.\n000bee40: dc86 978a fa81 bf73 3ce1 7d38 d540 c615 .......s<.}8.@..\n000bee50: 63f3 a5e1 eaa1 cf3c ab43 bbef ed7c 569e c......<.C...|V.\n000bee60: 9992 3b46 0959 843e 9ae5 a8e4 5e8c a01f ..;F.Y.>....^...\n000bee70: 5c64 6e68 209d 7d74 8d7e 59e0 ac4b 618f \\dnh .}t.~Y..Ka.\n000bee80: 8c7d a141 e5ed 5427 1512 e7fd b307 56a6 .}.A..T'......V.\n000bee90: 9031 d05a 81fc 1a80 2bb6 bacc 9502 0301 .1.Z....+.......\n000beea0: 0001 4b42 5550 0100 0000 a200 0000 ..KBUP........\nKey:\nRSA Public Key  - 3081 .... 0001\nPUBK Sentinel   - 4b42 5550\nKey version    - 0100\n\n```\n\nFigure 2: Public key stored in the last bytes of Maui on disk\n\nUsing fseek(), Maui will read the last twelve bytes of itself from disk, verify the resulting first 4 bytes\n\ncontain the static value of PUBK, followed by a number one, denoting the key version. If both of these\n\nchecks pass, the 162-bytes preceding the PUBK sentinel are read, containing the public key. If these\n\nchecks fail, a corresponding error message will be presented; the error message in Figure 3\ncorresponds to when the PUBK sentinel is not present.\n\nFigure 3: Error message presented if Maui’s embedded key is not found\n\nA proof-of-concept (POC) Python implementation of this key loading process is included in the\nAppendix of this report. This tool may also be useful for researchers for tracking public keys used in\ncopies of Maui.\n\n##### 5\n\n\n-----\n\n###### THREAT REPORT\n\n\n###### Runtime keys\n\nFollowing extraction of the hard-coded RSA public key, Maui generates a new keypair using\n```\nRSA_generate_key(). The resulting private key is then encrypted using the hard-coded public key\n\n```\nand written to a file named maui.evd. Based on debug messages (shown in figure 4), the developers\n\ndescribe maui.evd as an evidence file.\n\nFigure 4: Error messages referring to maui.evd as an evidence file\n\nThe corresponding public key is encoded using a 16-byte XOR key, generated using information about\n```\n\\\\.\\PhysicalDrive0, and written to a file named maui.key. XOR encoding was likely chosen for this\n\n```\nfile instead of RSA encryption to support key reuse if Maui is run multiple times on a target system.\n\n###### File encryption\n\nFiles are encrypted by Maui using Advanced Encryption Standard (AES) in CBC mode using a 32-byte\nkey generated per file. Keys are prefixed by the hard-coded string dogd, followed by 28 bytes\n\n\ngenerated using RAND_bytes().[3]\n\n\nEach file encrypted by Maui contains a custom header, allowing the malware to programmatically\nidentify already encrypted files. This header includes the file’s original path and an encrypted copy of\nthe AES key (encrypted using the runtime RSA public key). An example of this header is defined in the\nfigure below.\n\n```\n00000000: 5450 5243 0100 0000 5500 7300 6500 7200 TPRC....U.s.e.r.\n00000010: 5c00 4400 6500 7300 6b00 7400 6f00 7000 \\.D.e.s.k.t.o.p.\n00000020: 5c00 4900 4400 4100 2000 5000 7200 6f00 \\.I.D.A. .P.r.o.\n00000030: 2000 2800 3300 3200 2d00 6200 6900 7400 .(.3.2.-.b.i.t.\n00000040: 2900 2e00 6c00 6e00 6b00 0000 a303 0000 )...l.n.k.......\n00000050: 0000 0000 47d9 7e5f 1552 56c4 f743 28d5 ....G.~_.RV..C(.\n00000060: 79e0 ccb8 fc9b e021 48b5 cd67 5223 b027 y......!H..gR#.'\n...\n000000c0: fa9e a110 096f 26f9 ecc1 5f70 71fd 13da .....o&..._pq...\n000000d0: fa88 1894 fa96 ca88 2f41 771f 7570 a4d1 ......../Aw.up..\n000000e0: 5587 6440 83f6 222d 3a38 f42b d1d6 2d4c U.d@..\"-:8.+..-L\n...\n\n```\n\n3 [https://www.openssl.org/docs/man1.1.1/man3/RAND_bytes.html](https://www.openssl.org/docs/man1.1.1/man3/RAND_bytes.html)\n\n##### 6\n\n\n-----\n\n###### THREAT REPORT\n\n```\nKey:\nCustom Header         = 5450 5243\nStatic value         = 0100 0000\nOriginal File Path      = 5500 ...\nEncrypted AES Key       = 47d9 - 1894\nEncrypted file        = fa96 - [EOF]\n\n```\n\nFigure 5: Mail Encrypted file header\n\nWhile Maui is encrypting files, it outputs status information back to operators, as can be seen in Figure\n6.\n\nFigure 6: Command line output during execution\n\n##### 7\n\n\n-----\n\n###### THREAT REPORT\n\n\n## Appendix\n\n### PoC key extractor\n\nThe following Python script can be used to extract public RSA keys stored in copies of Maui.\n\n```\n#!/usr/bin/env python3\n# Author: Silas Cutler (silas@stairwell.com)\n# Desc: Maui public key extractor\nimport os\nimport sys\nfrom Crypto.PublicKey import RSA\ndef parse_key(inkey):\n  keyPub = RSA.importKey(inkey)\n  print(keyPub.exportKey().decode('utf-8'))\ndef main():\n  with open(sys.argv[1], 'rb') as fhandle:\n     # Read first 12-bytes containing headers\n     fhandle.seek(-12, os.SEEK_END)\n     #Check config PUBK header\n     if fhandle.read(4) == b'KBUP':\n       print(\" [D] Found PUBK sentinel\")\n    else:\n       print(\" [X] Missing PUBK sentinel\")\n       return False\n     # Check pub key version\n     if fhandle.read(1) == b'\\x01':\n       print(\" [D] Found pub key version\")\n    else:\n       print(\" [X] Invalid pub key version\")\n       return False\n     # Extract Pub Key\n     fhandle.seek(-174, os.SEEK_END)\n     rsakey = fhandle.read(162)\n     parse_key(rsakey)\nif __name__ == \"__main__\":\n  main()\n\n```\n\n##### 8\n\n\n-----\n\n###### THREAT REPORT\n\n\n## YARA rules\n\nStairwell's Inception platform users already have access to associated YARA rules automatically.\n\n```\nrule MauiRansomware\n{\n  meta:\n     author= \"Silas Cutler (Silas@Stairwell.com)\"\n     description = \"Detection for Maui Ransomware\"\n     version = \"0.1\"\n  strings:\n     $ = \"Unable to read public key info.\" wide\n     $ = \"it by <Godhead> using -maui option.\" wide\n     $ = \"Incompatible public key version.\" wide\n     $ = \"maui.key\" wide\n     $ = \"maui.evd\" wide\n     $ = \"Unable to encrypt private key\" wide\n     $ = \"Unable to create evidence file\" wide\n     $ = \"PROCESS_GOINGON[%d%% / %d%%]: %s\" wide\n     $ = \"demigod.key\" wide\n     $ = \"Usage: maui [-ptx] [PATH]\" wide\n     $ = \"-p dir: Set Log Directory (Default: Current Directory)\" wide\n     $ = \"-t n:      Set Thread Count (Default: 1)\" wide\n     $ = \"-x:       Self Melt (Default: No)\" wide\n     // File header loading (x32-bit)\n     $ = { 44 24 24 44 49 56 45 ?? 44 24 28 01 00 00 00 ?? 44 24 2C 10 00 00 00 }\n     $ = { 44 4F 47 44 ?? ?? 04 01 00 00 00 }\n  condition:\n     3 of them or\n     (\n       uint32(filesize-8) == 0x00000001 and\n       uint32(filesize-12) == 0x5055424B\n     )\n}\n\n```\n\n##### 9\n\n\n-----\n\n###### THREAT REPORT\n\n\n## Files\n\n|File Name|File Type|Size|Sha256 Hash|\n|---|---|---|---|\n|proc.exe|Windows portable executable|764K|45d8ac1ac692d6bb0fe776620371fca0 2b60cac8db23c4cc7ab5df262da42b78|\n|aui.exe|Windows portable executable|764K|5b7ecf7e9d0715f1122baf4ce745c5fc d769dee48150616753fec4d6da16e99e|\n|Maui.exe|Windows portable executable|764K|830207029d83fd46a4a89cd623103ba2 321b866428aa04360376e6a390063570|\n\n\n##### 10\n\n\n-----\n\n###### THREAT REPORT\n\n\nFor more information on the intelligence provided in this report,\n\n[contact us at threatresearch@stairwell.com](mailto:intel@stairwell.com)\n\nStairwell helps organizations take back the cybersecurity high ground with solutions that attackers can't evade. Its Inception\nplatform empowers security teams to outsmart any attacker by providing continuous contextual threat analysis, detection, and\nresponse. The Inception platform is used by a number of Fortune 500 companies. Stairwell is comprised of security industry\nleaders and engineers from Google and is backed by Sequoia Capital, Accel, and Gradient Ventures. [stairwell.com](http://stairwell.com)\n\n##### 11\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        }
    ],
    "references": [
        "https://stairwell.com/wp-content/uploads/2022/07/Stairwell-Threat-Report-Maui-Ransomware.pdf"
    ],
    "report_names": [
        "Stairwell-Threat-Report-Maui-Ransomware.pdf"
    ],
    "threat_actors": [
        {
            "id": "77b28afd-8187-4917-a453-1d5a279cb5e4",
            "created_at": "2022-10-25T15:50:23.768278Z",
            "updated_at": "2025-03-27T02:00:55.5423Z",
            "deleted_at": null,
            "main_name": "Inception",
            "aliases": [
                "Inception Framework",
                "Cloud Atlas"
            ],
            "source_name": "MITRE:Inception",
            "tools": [
                "PowerShower",
                "VBShower",
                "LaZagne"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "1f6ae238-765f-4495-9d54-6a7883d7a319",
            "created_at": "2022-10-25T16:07:24.573456Z",
            "updated_at": "2025-03-27T02:02:10.284644Z",
            "deleted_at": null,
            "main_name": "TA511",
            "aliases": [
                "MAN1",
                "Moskalvzapoe"
            ],
            "source_name": "ETDA:TA511",
            "tools": [
                "Agentemis",
                "Chanitor",
                "Cobalt Strike",
                "CobaltStrike",
                "Ficker Stealer",
                "Hancitor",
                "NetSupport",
                "NetSupport Manager",
                "NetSupport Manager RAT",
                "NetSupport RAT",
                "NetSupportManager RAT",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "542cf9d0-9c68-428c-aff8-81b6f59dc985",
            "created_at": "2023-02-15T02:01:49.554105Z",
            "updated_at": "2025-03-27T02:00:03.110991Z",
            "deleted_at": null,
            "main_name": "Moskalvzapoe",
            "aliases": [
                "MAN1",
                "TA511"
            ],
            "source_name": "MISPGALAXY:Moskalvzapoe",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1666716497,
    "ts_updated_at": 1743041592,
    "ts_creation_date": 0,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/3f2c224705dbf8658a97e8cbf6ca322ddf72862f.pdf",
        "text": "https://archive.orkl.eu/3f2c224705dbf8658a97e8cbf6ca322ddf72862f.txt",
        "img": "https://archive.orkl.eu/3f2c224705dbf8658a97e8cbf6ca322ddf72862f.jpg"
    }
}