{
    "id": "cf1d2fda-6463-4729-966a-5745a1348982",
    "created_at": "2022-10-25T16:48:23.208502Z",
    "updated_at": "2025-03-27T02:16:20.718069Z",
    "deleted_at": null,
    "sha1_hash": "2c5e1689900d6f92ec985be4f9f1df9f9b52de30",
    "title": "Gazing at Gazer",
    "authors": "ESET",
    "file_creation_date": "2017-08-29T11:24:19Z",
    "file_modification_date": "2017-08-29T11:24:25Z",
    "file_size": 869892,
    "plain_text": "# Gazing at Gazer\n\n## Turla’s new second stage backdoor\n\nAugust 2017\n\n\n-----\n\n# Gazing at Gazer\n\n## Turla’s new second stage backdoor\n\nAugust 2017\n\n\n-----\n\n### Table of Content\n\n**Introduction** **5**\n\n**Summary** **5**\n\n**Similarities with other Turla tools** **6**\n\n**Custom encryption** **6**\n\n**Global Architecture** **7**\n\nLoader 7\n\nLogs 11\n\nWorking Directory 13\n\nOrchestrator 14\n\nCommunication Module 16\n\nMessages between components 18\n\n**Gazer versions** **20**\n\n**IoCs** **21**\n\nFilenames 21\n\nRegistry keys 21\n\nC&C URLs 21\n\nMutexes 21\n\nHashes 22\n\n**Appendices** **25**\n\nFunction names 25\n\nYara rules 29\n\n\n-----\n\n### List of Figures\n\nFigure 1. Turla author’s sense of humor 6\n\nFigure 2. Gazer architecture 7\n\nFigure 3. Message format 18\n\nFigure 4. Certificates used to sign the malware variants 20\n\n### List of Tables\n\nTable 1. Abstract Class Autorun 15\n\nTable 2. Abstract Class Queue 16\n\nTable 3. Abstract Class Storage 16\n\nTable 4. Abstract Class TListenerInterface 16\n\nTable 5. Abstract Class TAbstractTransport 16\n\nTable 6. Gazer sample hashes 22\n\n\n-----\n\n#### Turla’s new second stage backdoor\n\n\n### Introduction\n\nHerein we release our analysis of a previously undocumented backdoor that has been targeted\nagainst embassies and consulates around the world leads us to attribute it, with high confidence,\nto the Turla group. Turla is a notorious group that has been targeting governments, government\n[officials and diplomats for years. They are known to run watering hole and spearphishing campaigns](https://www.welivesecurity.com/2017/06/06/turlas-watering-hole-campaign-updated-firefox-extension-abusing-instagram/)\nto better pinpoint their targets. Although this backdoor has been actively deployed since at least\n2016, it has not been documented anywhere. Based on strings found in the samples we analyzed,\nwe have named this backdoor “Gazer”.\n\nRecently, the Turla APT group has seen extensive news coverage surrounding its campaigns,\n[something we haven’t seen for a long time. The Intercept reported that there exists a 2011 presentation](https://theintercept.com/2017/08/02/white-house-says-russias-hackers-are-too-good-to-be-caught-but-nsa-partner-called-them-morons/)\nby Canada’s Communication Security Establishment (CSE) outlining the errors made by the Turla\noperators during their operations even though the tools they use are quite advanced. The codename\nfor Turla APT group in this presentation is MAKERSMARK. Gazer is, similar to its siblings in the Turla\nfamily, using advanced methods to spy and persist on its targets. This whitepaper highlights\nthe campaigns in which Gazer was used and also contains a technical analysis of its functionalities.\n\n### Summary\n\nBased on our research and telemetry on the different campaigns where Gazer was used,we believe\nthat Southeastern Europe as well as countries in the former Soviet Union Republichas recently\nbeen the main target. The witnessed techniques, tactics and procedures (TTPs) are in-line with\n[what we usuallysee in Turla’s operation: a first stage backdoor, such as Skipper, likely delivered](https://download.bitdefender.com/resources/media/materials/white-papers/en/Bitdefender-Whitepaper-PAC-A4-en_EN1.pdf)\nthrough spearphishingfollowed by the appearance on the compromised system of a second\nstage backdoor, Gazerin this case.\n\nAlthough we could not find irrefutable evidence that this backdoor is truly another tool in Turla’s\narsenal, several clues lead us to believe that this is indeed the case. First, their targets are in line\nwith Turla’s traditional targets: Ministries of Foreign Affairs (MFAs) and embassies. Second, the modus\noperandi of spearphishing, followed by a first stage backdoor and a second stage, stealthier backdoor\nis what has been seen over and over again. Skipper, which has been linked to Turla in the past, was\nfound alongside Gazer in most cases we investigated. Finally, there are many similarities between\n[Gazer and other second stage backdoors used by the Turla group such as Carbon and Kazuar.](https://www.welivesecurity.com/2017/03/30/carbon-paper-peering-turlas-second-stage-backdoor/)\n\nAs usual, the Turla APT group makes an extra effort to avoid detection by wiping files securely,\nchanging the strings and randomizing what could be simple markers through the different backdoor\nversions. In the most recent version we have found, Gazer authors modified most of the strings\nand inserted “video-game-related” sentences throughout the code. An example of such\na string is depicted in Figure 1.\n\n\n-----\n\n#### Turla’s new second stage backdoor\n\n\nFigure 1. Turla author’s sense of humor\n\n### Similarities with other Turla tools\n\nGazer is written in C++ and shares several similarities with other malware from the Turla APT family.\nIndeed, Gazer, Carbon and Kazuar can receive encrypted tasks from a C&C server, which can be executed\neither by the infected machine or by another machine on the network. They all use an encrypted\ncontainer to store the malware’s components and configuration and they also log their actions\nin a file.\n\nThe list of C&C servers is encrypted and embedded in Gazer’s PE resources. They are all compromised,\nlegitimate websites (that mostly use the WordPress CMS) that act as a first layer proxy. This is also\na common tactic for the Turla APT group.\n\nAnother interesting linkage is that one of the C&C servers embedded in a Gazer sample was known\nto be used in a JScript backdoor documented by Kaspersky as Kopiluak.\n\nLast but not least, these three malware families (Gazer, Carbon and Kazuar) have a similar list\nof processes that may be employed as a target to inject the module used to communicate with the\nC&C server embedded in the binary. The resource containing this list can change from one sample\nto another, it is likely tailored to what is installed on the system (for example, on some samples,\nthe process name “safari.exe” can appear on the list).\n\n### Custom encryption\n\nGazer’s authors make extensive use of encryption. They don’t use the Windows Crypto API\nand don’t seem to use any public library. It looks as if they are using their own library\nfor 3DES and RSA.\n\nThe RSA keys embedded in the resources contains the attacker’s public key which is used to encrypt\nthe data sent to the C&C server, and a private key to decrypt resources embedded in its binaries.\nThese keys are unique in each sample.\n\n[These resources are structured in the same way as RSA from OpenSSL, but these values (p, q, etc.)](https://wiki.openssl.org/index.php/Manual:Rsa(3))\nare computed by the custom implementation of Gazer’s authors.\n\n\n-----\n\n#### Turla’s new second stage backdoor\n\n\nFor 3DES, the IV and a static key are hardcoded and are the same in all samples. This 3DES key\nis randomly generated and XORed with the static key. The random data used to XOR the static\nkey is prepended to the logfile header. This key is then used in the regular 3DES algorithm.\n\n### Global Architecture\n\nIn this section, we will describe in detail each component of Gazer.\n\nGAZER LOADER GAZER ORCHESTRATOR\n\n**rsrc 101** running within Forward task\n“explorer.exe” “explorer.exe”\n\nSend\n\n**rsrc 102** task’s result\nOrchestrator **rsrc 101**\n\nGAZER ORCHESTRATOR\n\n**[...]**\n\nInjected into process\nindicated in rsrc 101\n\n**rsrc 102** running within\nComm module “firefox.exe” (for example)\n\nSend tasks’\n\nMay forward task Injected into a process that results\n\nlegitimately communicate\nover the internet. Get new\n_(process list from rsrc 106)_ tasks\n\nMachines on the same\nnetwork (P2P)\n\nC&C server\n\nFigure 2. Gazer architecture\n\n#### Loader\n\nThe loader is the first component of the malware to be executed on the system. Two resources\nare stored unencrypted in the binary:\n\n- 101: the process name to inject the orchestrator into[1]\n\n- 102: the orchestrator\n\nThe following mutex is created to ensure that only a single instance of the malware is running:\n```\n{531511FA-190D-5D85-8A4A-279F2F592CC7}\n\n#### Named pipe generation\n\n```\nTo establish a communication channel between Gazer components, a named pipe is initiated.\n\nThe named pipe is generated from this string:\n```\n\\\\\\\\.\\\\pipe\\\\Winsock2\\\\CatalogChangeListener-FFFF-F\n\n```\n1 Note that in all samples we have analyzed the process name is “explorer.exe”\n\n\n-----\n\n#### Turla’s new second stage backdoor\n\n\nThe pattern “FFFF-F” is replaced with values computed from the security identifier (SID) of the current\nuser and the current timestamp.\n\nLet’s take for example the current date as: “2017/04/24” and the SID: “S-1-5-21-84813077```\n3085987743-2510664113-1000”.\n\n```\nTo generate the pattern at the end of the named pipe, some arithmetic is performed:\n\n```\ntime = SystemTime.wDay * Systemtime.wMonth * SystemTime.wYear =\n24 * 04 * 2017 = 0x2f460\nxsid = (1 * 21 * 84813077 * 3085987743 * 2510664113 * 1000) &\n0xFFFFFFFF = 0xefa252d8\n((time >> 20) + (time & 0xFFF) + ((time >> 12) & 0xFFF)) % 0xFF =\n0x93\n((xsid >> 20) + (xsid & 0xFFF) + ((xsid >> 12) & 0xFFF)) % 0xFF =\n0x13\n((time * xsid >> 24) + (uint8_t)(time * xsid) + ((uint16_t)(time *\nxsid) >> 8) + (uint8_t)(time * xsid >> 16)) % 0xf) = 0xa\n\n```\n\nIn this case, the named pipe will be:\n```\n\\\\\\\\.\\\\pipe\\\\Winsock2\\\\CatalogChangeListener-9313-a\n\n```\nIf the current user’s SID cannot be retrieved, the named pipe \\\\\\\\.\\\\pipe\\\\\\Winsock2\\\\\n```\nCatalogChangeListener-FFFE-D will be used by default.\n\n#### Code injection through thread hijacking\n\n```\nA not-so-common trick is used in order to inject the orchestrator into a remote process. Indeed,\na running thread from the remote process is hijacked in order to run shellcode that will execute\nthe communication module entry point.\n\n- The whole module and shellcode are copied into the remote process;\n\n- the function ZwQuerySystemInformation is used to retrieve the total number\nof the running threads in the targeted process;\n\n- the following operations are attempted on each of those threads:\n\n - the thread is suspended with the OpenThread/SuspendThread functions;\n\n - the thread context is retrieved using GetThreadContext;\n\n  - the context’s instruction pointer is saved and modified to point to the shellcode\n(through SetThreadContext);\n\n - the thread is resumed using ResumeThread.\n\n- if one of the previous operations fails, the thread is resumed and the same actions\nare attempted on another thread.\n\n\n-----\n\n#### Turla’s new second stage backdoor\n\n\nThe shellcode is just a loader that will execute the module entry point in a new thread.\n\n#### Persistence\n\nThe loader sends binary data through the named pipe to the orchestrator. This blob contains:\n\n- a command ID (2): CMC_TAKE_LOADER_BODY\n\n- the loader path file\n\n- the loader PE\n\nOnce this message is received by the orchestrator, the loader is securely deleted by overwriting\nthe file content and deleted through the DeleteFile function.\n\nAfterwards, the persistency is set up. The persistency information is retrieved from the resource “105”\nand stored in the Gazer storage. Among these data, there is a dword value that is used to choose\nwhich persistency mode will be applied.\n\nThe resource 105 is structured in the following way:\n\n- a dword value representing the persistence mode\n\n- a dword value representing the size of the data\n\n- the persistence information\n\n\n-----\n\n#### Turla’s new second stage backdoor\n\n\nThere are 6 different persistence modes.\n\n0: ShellAutorun\nPersistence is achieved through the Windows registry by setting the value “Shell” with “explorer.\nexe, %malware_pathfile%” under the following key:\n```\nHKCU\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\n\n```\n1: HiddenTaskAutorun\nIt is very similar to the “TaskScheduler Autorun (4)” method described below. The main difference\nis that the task is hidden from the user by using the TASK_FLAG_HIDDEN flag (set up via\nthe SetFlags method from the ITask interface).\n\n2: ScreenSaverAutorun\nIn this mode, Gazer achieves persistency by setting up in the Windows registry the executable\nfile used for the screensaver.\n\nMany values are created under the HKCU\\Control Panel\\Desktop registry key:\n\n- `SCRNSAVE.exe with the malware executable path`\n\n- `ScreenSaveActive is set to “1”: enable the screensaver`\n\n- `ScreenSaverIsSecure is set to “0”: specifies that the screensaver is not password-protected`\n\n- `ScreenSaveTimeout is set to a value given in the resource. It specifies how long the system`\nremains idle before the screensaver (in this case: the malware) starts.\n\n3: StartupAutorun\nIf the resource 105 begins with the dword value “3”, a LNK file will be created in the Start Menu.\nThe resource will also provide a description for the shortcut file, the path for the target\nand the filename for the LNK.\n\nThe IShellLink interface is used to create the shell link.\n\n4: TaskSchedulerAutorun\nThis method is used to achieve persistence by creating a scheduled task.\n\nThe task is created and set up through COM interfaces related to tasks (ITaskService,\n```\nITaskSettings, …​).\n\n```\nSome information such as the task name and its description is retrieved from the resource.\nFor example, in one of the sample’s resources, the persistency mode is set to 04 (TaskSchedulerAutorun)\nwith the persistency data:\n```\n%APPDATA%\\Adobe\\adobeup.exe Adobe Acrobat Reader Updater. This task was\ngenerated by Adobe Systems, Inc to keep your Adobe Software up-to-data. \n\\Adobe\\AcrobatReader.Adobe\n\n```\nIn this example, a scheduled task will be created and set up thus:\n\n- Task name: “Adobe Acrobat Reader Updater”\n\n- Executable: “%APPDATA%\\Adobe\\adobeup.exe”\n\n - The orchestrator will copy the loader received through the named pipe to this location\n\n\n-----\n\n#### Turla’s new second stage backdoor\n\n\n\n- Task description: “This task was generated by Adobe Systems, Inc to keep your\n```\n Adobe Software up-to-data”\n\n```\n- Task folder: “\\Adobe\\AcrobatReader.Adobe”\n\nLast but not least, the task is configured to be started by the task scheduler at any time after\nits scheduled time has passed. The task will be triggered when the current user logs on.\n\n5: LinkAutorun\nThis persistence method modifies existing LNK files to execute the malware through cmd.exe.\n\nFor each LNK file in the folder given in the resource, the icon and arguments are removed\nand the path is set to “cmd.exe” with the argument set to:\n```\n/q /c start “%s” && start “%s”\n\n```\nIn most of the samples we analyzed, the configuration file specified that the TaskSchedulerAutorun\npersistence method should be used.\n\n#### Logs\n\nAll three Gazer components log their actions into logfiles. They are encrypted with the same\nalgorithm: 3DES.\n\nIn some versions of Gazer, it is easy to retrieve these logfiles because their filenames are hardcoded\ninto the binaries:\n\n- `%TEMP%\\CVRG72B5.tmp.cvr: the logs from the loader`\n\n- `%TEMP%\\CVRG1A6B.tmp.cvr: the logs from the orchestrator`\n\n- `%TEMP%\\CVRG38D9.tmp.cvr: the logs from the communication module`\n\nEach logfile is structured in the following way:\n\n- [LOGSIZE][DECRYPTION_KEY][ENCRYPTED_LOG]\n\n  - logsize: when this value (2 bytes) is subtracted from the magic value 0xf18b, it gives\nthe encrypted log size\n\n - decryption_key: when this 12 bytes blob is XORed with another hardcoded key of 12 bytes,\nit gives the 3DES key that can be used to decrypt the log\n\n - encrypted_log: log encrypted with the 3DES algorithm in CBC mode\n\nOnce decrypted, each log entry is formatted in the following way:\n\n|Hour:Min:Sec:Ms| [log ID] [log]\n\n\n-----\n\n#### Turla’s new second stage backdoor\n\n\nHere is an example with the decrypted orchestrator logfile:\n\n```\n|10:29:56:197| [1556]\n|10:29:56:197| [1557] ******************[...]****************\n|10:29:56:197| [1558] DATE: 25.05.2017\n|10:29:56:197| [1559] PID=900 TID=2324  Heaps=32\nC:\\Windows\\Explorer.EXE\n|10:29:56:197| [1565] DLL_PROCESS_ATTACH\n|10:29:56:197| [1574] 4164\n|10:29:58:197| [0137] ==================[...]================\n|10:29:58:197| [0138] Current thread = 2080\n|10:29:58:197| [0183] Heap aff0000 [34]\n|10:29:58:197| [0189] ### PE STORAGE ###\n|10:29:58:197| [0215] ### PE CRYPTO ###\n|10:29:58:197| [0246] ### EXTERNAL STORAGE ###\n|10:29:58:197| [1688] Ok\n|10:29:58:197| [0279] Path = \\HKCU\\Software\\Microsoft\\\nWindows\\CurrentVersion\\Explorer\\ScreenSaver\n|10:29:58:197| [0190] \\HKCU\\Software\\Microsoft\\Windows\\\nCurrentVersion\\Explorer\\ScreenSaver\n|10:29:58:197| [0338] ---FAILED\n|10:29:58:197| [0346] Initializing standart reg storage...\n|10:29:58:197| [0190] Software\\Microsoft\\Windows\\\nCurrentVersion\\Explorer\\ScreenSaver\n|10:29:58:197| [2605] Storage is empty!\n|10:29:58:197| [0392] ### EXTERNAL CRYPTO ###\n|10:29:59:666| [1688] Ok\n|10:29:59:713| [1473] Ok\n|10:29:59:760| [1688] Ok\n|10:29:59:775| [1473] Ok\n|10:29:59:775| [1688] Ok\n|10:29:59:775| [1473] Ok\n|10:29:59:791| [1688] Ok\n|10:29:59:791| [1473] Ok\n|10:29:59:806| [1688] Ok\n|10:29:59:806| [1473] Ok\n|10:29:59:806| [0270] 08-00-27-90-05-2A\n|10:29:59:806| [0286] _GETSID_METHOD_1_\n|10:29:59:806| [0425] 28 7 8 122\n|10:29:59:806| [0463] S-1-5-21-84813077-30859877432510664113-1000\n|10:29:59:806| [0471]\n|10:29:59:806| [0787] Ok\n|10:29:59:806| [1473] Ok\n|10:29:59:822| [0514] ### QUEUES ###\n|10:29:59:822| [0370] T Empty\n|10:29:59:822| [0482] R Empty\n|10:29:59:822| [1754] Ok\n|10:29:59:822| [1688] Ok\n|10:29:59:822| [1473] Ok\n|10:29:59:838| [0505] R #4294967295 PR_100 TR_00000000\nSZ_172 SC_0(50) --+- EX_0\n|10:29:59:838| [0625] ### TRANSPORT ###\n|10:29:59:838| [0286] _GETSID_METHOD_1_\n|10:29:59:838| [0425] 28 7 25 122\n|10:29:59:838| [0463] S-1-5-21-84813077-30859877432510664113-1000\n|10:29:59:838| [0471]\n|10:29:59:838| [0165] \\\\.\\pipe\\Winsock2\\\nCatalogChangeListener-2313-4\n|10:29:59:838| [0131] PipeName = \\\\.\\pipe\\Winsock2\\\nCatalogChangeListener-2313-4\n|10:29:59:838| [0041] true\n[...]\n\n```\n\n-----\n\n#### Turla’s new second stage backdoor\n\n\nNote that in older Gazer versions, the “log ID” was replaced by the name of the current function.\nWe believe that this log ID is an ID for the function where the log occurs.\n\n#### Working Directory\n\n Using the Windows Registry\n\nAll the files related to Gazer (except the logs) are stored encrypted within the registry. The orchestrator’s\nresource “109” contains the root storage path (it will be designated %RootStoragePath% in the rest\nof this paper). In every sample we examined, this resource pointed to the same storage path:\n```\nHKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\ScreenSaver\n\n```\nIf this resource is empty, the registry key above is used by default. Except for RSA keys, all the data\nin the storage is encrypted[2].\n\nSeveral subdirectories (whose names are hardcoded in the binary) are created.\n\n- `%RootStoragePath%{119D263D-68FC-1942-3CA3-46B23FA652A0}`\n\n  - Object ID: a unique ID to identify the victim\n\n- `%RootStoragePath%{1DC12691-2B24-2265-435D-735D3B118A70}`\n\n - Task Queue: linked list of tasks to be executed\n\n- `%RootStoragePath%{28E74BDA-4327-31B0-17B9-56A66A818C1D}`\n\n - Plugins\n\n- `%RootStoragePath%{31AC34A1-2DE2-36AC-1F6E-86F43772841F}`\n\n - Communication Module: the DLL that communicates with the C&C server\n\n- `%RootStoragePath%{3CDC155D-398A-646E-1021-23047D9B4366}`\n\n - Autorun: the persistency method\n\n- `%RootStoragePath%{4A3130BD-2608-730F-31A7-86D16CE66100}`\n\n - Local Transport Settings: the computers IPs that are on the same network\n\n- `%RootStoragePath%{56594FEA-5774-746D-4496-6361266C40D0}`\n\n - Last Connection: last connection time with the C&C server (structure SYSTEMTIME)\n\n- `%RootStoragePath%{629336E3-58D6-633B-5182-576588CF702A}`\n\n - RSA Private Key: generated on the fly; used to decrypt the data from Gazer storage.\n\n- `%RootStoragePath%{6CEE6FE1-10A2-4C33-7E7F-855A51733C77}`\n\n  - Result Queue: linked list of the tasks results\n\n- `%RootStoragePath%{81A03BF8-60AA-4A56-253C-449121D61CAF}`\n\n - Inject Settings: the list of processes to use to try to inject the communications module\n\n- `%RootStoragePath%{8E9810C5-3014-4678-27EE-3B7A7AC346AF}`\n\n - C&C servers\n\n2 See the “Gazer Resources” section for details\n\n\n-----\n\n#### Turla’s new second stage backdoor\n\n\n#### Using Alternate Data Streams\n\nIf it is not possible to access the registry, these configuration items are stored using alternate\ndata streams.\n\nThe function GetVolumeInformation is called to ensure that the volume “C:\\” supports named\nstreams in order to use ADS.\n\nThe same GUIDs as above are used to hide the different data in an ADS for the file (hardcoded\nin the binary):\n```\n“%TEMP%\\KB943729.log”\n\n```\nFor example, here is the full path to access the object ID:\n```\n%TEMP%\\KB943729.log:{1DC12691-2B24-2265-435D-735D3B118A70}\n\n#### Orchestrator\n\n Gazer Resources\n\n```\nThe Gazer-related files are stored in the orchestrator’s resources.\n\nFile format\nThere are a total of 11 resources (101 to 111) each structured in the following way:\n\n- [DATATYPE][SIZE][DATA][PADDING]\n\n - DATATYPE: A dword that specifies the type of data in the resource\n\n  - 0x0: raw data\n\n  - 0xFFFFFFFF: empty\n\n  - 0x4: undefined\n\n   - 0x1030001: strings array\n\n   - 0x1: binary\n\n - SIZE: the size of the data (without padding)\n\nEncryption\nExcept for resources 101 and 102 which are RSA keys, every resource is compressed with BZip\nand encrypted with 3DES.\n\n[RSAEncryptedBlob][SignatureBlob][3DESBlob]\n\n- RSAEncryptedBlob: The first 1024 bits of the data is a blob that contains a 3DES key. This blob\nis encrypted using RSA and can be decrypted using resource 101.\n\n- SignatureBlob: The second part of the data is a blob of 1024 bits containing the signature\nof the last part of the data once decrypted.\n\n- 3DESBlob: The last part is the effective data, which is encrypted with the 3DES key from\nthe first blob.\n\nEach resource is decrypted on the fly; the signature is compared with the decrypted data to check\nthe integrity. Decrypted resources that pass this integrity check are encrypted with a new RSA key\ngenerated randomly by the orchestrator code. The private key and the encrypted resource are then\nstored in the registry under a specific GUID subkey.\n\n\n-----\n\n#### Turla’s new second stage backdoor\n\n\nResources listing\n\n- 101: RSA private key. It is used to decrypt the other resources.\n\n- 102: an RSA public key.\n\n- 103: empty\n\n- 104: unknown\n\n- 105: store the persistency information\n\n- 106: the list of processes to use to try to inject the communications module\n\n- 107: C&C communication DLL\n\n- 108: C&C server list\n\n- 109: Gazer working directory path\n\n- 110: plugins list\n\n- 111: local transport information\n\n#### Task Execution\n\nWhen a task is retrieved from the C&C, it is either executed by the infected machine or by another\ncomputer on the same network through a P2P mechanism (in the same way this was done\nin Carbon and Snake).\n\nThe task can be:\n\n- file upload\n\n- file download\n\n- configuration update\n\n- command execution\n\nThe result of the task is stored in a queue and forwarded to the module that communicates\nwith the C&C server when access to the Internet is available.\n\n#### Classes Hierarchy\n\n[The malware is written in C++ and the RTTI that contains information about the objects used](https://en.wikipedia.org/wiki/Run-time_type_information)\nin the code is not overwritten.\n\nThere are 5 abstract classes that have several implementations.\n\n\nTable 1. Abstract Class Autorun\n\n\nClass Name\n\nLinkAutorun\n\nStartupAutorun\n\nShellAutorun\n\nScreenSaverAutorun\n\nTaskSchedulerAutorun\n\nHiddenTaskAutorun\n\n\n-----\n\n#### Turla’s new second stage backdoor\n\n\nTable 2. Abstract Class Queue\n\n\nClass Name\n\nTaskQueue\n\nResultQueue\n\n\nTable 3. Abstract Class Storage\n\n\nClass Name\n\nExeStorage\n\nFSStorage\n\nRegStorage\n\n\nTable 4. Abstract Class TListenerInterface\n\n\nClass Name\n\nLTMessageProcessing\n\nCMessageProcessingSystem\n\n\nTable 5. Abstract Class TAbstractTransport\n\n\nClass Name\n\nLTNamedPipe\n\nTNPTransport\n\n#### Communication Module\n\nThe communication module is used to retrieve tasks from the C&C server and to dispatch them\nto the orchestrator.\n\nThis library is injected into a process which can legitimately communicate over the Internet.\nThe injection library is the same as the one found in the loader to inject the orchestrator\ninto “explorer.exe”.\n\n#### Communication Initialization\n\nIf a proxy server exists, it is retrieved and used by Gazer to make the HTTP requests. There are two\ndifferent methods used to retrieve this value, either by requesting the following registry key:\n```\nHKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\n\n```\nor through the function InternetQueryOption with the flag INTERNET_OPTION_PROXY if the proxy\nserver cannot be retrieved through the registry.\n\nThe system user agent is then set up:\n\n- the default value of the “HKCU\\Software\\Microsoft\\Windows\\Current Version\\\n```\n Internet Settings\\User Agent” key is retrieved;\n\n```\n\n-----\n\n#### Turla’s new second stage backdoor\n\n\n\n- the value keys under “HKLM\\Software\\Microsoft\\Windows\\Current Version\\Internet\n```\n Settings\\5.0\\User Agent\\Post Platform” are enumerated and those that contain \n\n```\nthe sub-string “IEAK” are concatenated with the user agent string from the previous step;\n\n- in the case that no user agent was found in the registry, the hardcoded UA Mozilla/4.0\n```\n (compatible; MSIE 6.0) is used\n\n```\nBefore attempting any contact with the C&C server, the internet connection is checked by trying\nto reach the following servers one by one until one returns a HTTP status code 200:\n\n- `update.microsoft.com`\n\n- `microsoft.com`\n\n- `windowsupdate.microsoft.com`\n\n- `yahoo.com`\n\n- `google.com`\n\n#### C&C server communication\n\nThe malware communicates with its C&C server to retrieve tasks (through HTTP GET requests)\nand to send the tasks results (through HTTP POST requests).\n\nBefore sending a request to the C&C, the command CMC_GIVE_SETTINGS is sent to the orchestrator\nthrough its communication channel (a named pipe, more on this in the next section). The message\n(MSG) contained in the packet in this case is a single byte set by the orchestrator for the command\nresult status.\n\nThe orchestrator replies on the same channel with the settings retrieved from the working directory\nwith the object id, the list of the C&C servers and the last connection date.\n\nA GET request is performed to retrieve a task from the C&C.\n\nThe parameters of the GET request are chosen from amongst a hardcoded list of keywords that does\nnot look suspicious. Their values are generated randomly in the charset [a-z0-9] with a random size\nfrom a range given for each parameter:\n\n- `id [6-12]` _(As with all other parameters, if this parameter is used in the request, it will have a random_\n_value (of letters and digits) with a random size between 6 and 12 characters.)_\n\n- `hash [10-15]`\n\n- `session [10-15]`\n\n- `photo [6-10]`\n\n- `video [6-10]`\n\n- `album [6-10]`\n\n- `client [5-10]`\n\n- `key [5-10]`\n\n- `account [6-12]`\n\n- `member [6-12]`\n\n- `partners [5-10]`\n\n- `adm [6-12]`\n\n- `author [6-12]`\n\n\n-----\n\n#### Turla’s new second stage backdoor\n\n\n\n- `contact [6-12]`\n\n- `content [6-12]`\n\n- `user [6-12]`\n\nHere are few examples of such requests:\n```\nxxx.php?album=2ildzq&key=hdr2a&partners=d2lic33f&session=nurvxd2x0z8bztz&video\n=sg508tujm&photo=4d4idgkxxx.php?photo=he29zms5fc&user=hvbc2a&author=xvfj5r0q\n9c&client=7mvvc&partners=t4mgmuy&adm=lo3r6v4xxx.php?member=ectwzo820&contact\n=2qwi15&album=f1qzoxuef4&session=x0z8bztz8hrs65f&id=t3x0ftu9xxx.php?partners\n=ha9hz9sn12&hash=5740kptk3acmu&album=uef4nm5d&session=dpeb67ip65f&member=arj6\nx3ljjxxx.php?video=nfqsz570&client=28c7lu2&partners=818eguh70&contact=ibj3xch\n&content=1udm9t799ixr&session=5fjjt61qred9uo\n\n```\nA timeout of 10 minutes is set for each request (send/receive/connect) through InternetSetOption.\n\nOnce the request is sent, the response is handled only if the returned HTTP status code is 404.\nThe content of the response is encrypted and can be decrypted with the private RSA key generated\nby the orchestrator. The response body contains a blob of data and an MD5 hash of the data. The blob\nis hashed and compared to the MD5 to ensure the integrity of the server’s response.\n\nIf the response size is 20 bytes (a blob of 4 bytes + the hash), there are no tasks to retrieve.\n\nA command CMC_TAKE_TASK is sent to the orchestrator with the encrypted task received from\nthe C&C server and its size. The orchestrator will be in charge of executing the task and will send\nthe results to the communication module. Once the blob of the tasks results (encrypted by the\norchestrator) is received, it is sent to the C&C server through a POST request in the same way\nthat it was done for the GET request (using parameters with random values).\n\n#### Messages between components\n\nA global named pipe is used for the communication between the different components. The data\nsent through this named pipe is formatted in the following way:\n\n**0** **31** **48**\n\nDatatype ID_CMD MSG\n\nFigure 3. Message format\n\n- DATATYPE: the same constants are used for the resources (check the File Format entry\nin the “Resources section”)\n\n- ID_CMD: the command name (check below for a complete list)\n\n- MSG: the data to be sent\n\nHere is a listing of the different commands:\n\n- `CMC_TAKE_TASK (ID_CMD: 1)`\n\n  - When a task is retrieved by the C&C server module, it is sent to the orchestrator,\nwhich stores the task in the task queue.\n\n- `CMC_TAKE_LOADER_BODY (ID_CMD: 2)`\n\n\n-----\n\n#### Turla’s new second stage backdoor\n\n\n\n  - Wipe Gazer’s original loader file, clean persistency and set up a copy of the loader\nand its persistency according to one of the resources (check persistency part for details).\n\n- `CMC_GIVE_RESULT (ID_CMD: 4)`\n\n  - When this message is received, the orchestrator will retrieve the task’s result from\nthe result queue, compress and encrypt it using the server’s public RSA key (the one\nfrom the resource 102) and send the blob to the communication module which will send\nthe whole result to the server through a POST request.\n\n- `CMC_GIVE_SETTINGS (ID_CMD: 5)`\n\n - The communication module sends this message to the orchestrator to request\nthe information needed to contact the server (list of the servers to contact, the last\nconnection time and the victim ID).\n\n- `CMC_TAKE_CONFIRM_RESULT (ID_CMD: 6)`\n\n - When the communication module sends a task’s result to the server, a message is sent\nto the orchestrator that will remove the task’s result from the queue.\n\n- `CMC_TAKE_CAN_NOT_WORK (ID_CMD: 7)`\n\n - When an operation has failed (for example, if the communication module cannot correctly\nparse the data received from the orchestrator), this message is sent to the orchestrator\nwith the last error code. The error code will be added to the logfile.\n\n- `CMC_TAKE_UNINSTALL (ID_CMD: 8)`\n\n  - Used to wipe a file from the disk.\n\n- `CMC_TAKE_NOP (ID_CMD: 9)`\n\n - No operation\n\n- `CMC_NO_CONNECT_TO_GAZER (ID_CMD: 0xA)`\n\n - This command is sent to the orchestrator when the communication module cannot\ncontact any of the servers. In this case, if a pending task’s results are in the queue,\nthey are stored encrypted in Gazer’s storage.\n\n- `CMC_TAKE_LAST_CONNECTION (ID_CMD: 0xB)`\n\n - This command is sent from the communication module to the orchestrator each time\na connection is established to the C&C server. It contains a structure SystemTime (filled\nwith the current system time). Once the message is received by the orchestrator,\nthe last connection date is stored compressed and encrypted in the Gazer storage\n(either the registry or ADS).\n\n- `CMC_GIVE_CACHE / CMC_TAKE_CACHE (ID_CMD: 0xC / 0xD)`\n\n - Not implemented\n\n\n-----\n\n#### Turla’s new second stage backdoor\n\n\n### Gazer versions\n\nFour different versions have been identified.\n\nIn the first version, the function used to write logs has as its parameter the real function name\nwhere the log occurs. There were also different methods used to inject code (the one documented\nin this whitepaper and one based on window injection).\n\nIn a second version, the function names used as parameters are replaced by an ID and only one method\nis used for code injection. Also, the string “NO OLD METHODS” appears in this part of the code.\n\nSome samples from the first versions were signed with a valid certificate issued by Comodo for “Solid\nLoop Ltd”. The compilation date appears to be 2002 but is likely to be faked because the certificate\nwas issued in 2015.\n\nThe latest versions are signed with a different certificate: “Ultimate Computer Support Ltd”.\n\nFigure 4. Certificates used to sign the malware variants\n\nSome efforts have been made to obfuscate strings that can be used as IoCs. The mutex name and\nthe named pipe do not appear in cleartext anymore; they are now encoded with a XOR key. On the\nprevious versions, the logfile names were hardcoded in the binary. The function GetTempFileNameA\nis now used to generate a random filename. The C&C server returns a 404 or 502 status code page,\nwhereas it was only a 404 in the previous versions.\n\nIn the latest versions compiled in 2017, the log messages are different (although they have the same\nmeaning). For example: “PE STORAGE” is replaced by “EXE SHELTER”, “PE CRYPTO” by “EXE\n```\nCIPHER” etc…​\n\n```\nLast but not least, the compilation timestamp seems not to be faked anymore.\n\nIn conclusion, Gazer is a very sophisticated piece of malware that has been used against different\ntargets in several countries around the world. Through the different versions we found and analyzed,\nwe can see that this malicious backdoor is still being actively developed and used by its creators.\n\n_[Indicators of Compromise can also be found on github. For any inquiries, or to make sample submissions related](https://github.com/eset/malware-ioc/tree/master/turla)_\n_[to the subject, contact us at: threatintel@eset.com.](mailto:threatintel@eset.com)_\n\n\n-----\n\n#### Turla’s new second stage backdoor\n\n\n### IoCs\n\n#### Filenames\n\n- %TEMP%\\KB943729.log\n\n- %TEMP%\\CVRG72B5.tmp.cvr\n\n- %TEMP%\\CVRG1A6B.tmp.cvr\n\n- %TEMP%\\CVRG38D9.tmp.cvr\n\n- %TEMP%\\~DF1E06.tmp\n\n- %HOMEPATH%\\ntuser.dat.LOG3\n\n- %HOMEPATH%\\AppData\\Local\\Adobe\\AdobeUpdater.exe\n\n#### Registry keys\n\n- HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\ScreenSaver\n\n- HKCU\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Explorer\\ScreenSaver\n\n#### C&C URLs\n\n- daybreakhealthcare.co.uk/wp-includes/themees.php\n\n- simplecreative.design/wp-content/plugins/calculated-fields-form/single.php\n\n- 169.255.137.203/rss_0.php\n\n- outletpiumini.springwaterfeatures.com/wp-includes/pomo/settings.php\n\n- zerogov.com/wp-content/plugins.deactivate/paypal-donations/src/PaypalDonations/SimpleSubsribe.\nphp\n\n- ales.ball-mill.es/ckfinder/core/connector/php/php4/CommandHandler/CommandHandler.php\n\n- dyskurs.com.ua/wp-admin/includes/map-menu.php\n\n- warrixmalaysia.com.my/wp-content/plugins/jetpack/modules/contact-form/grunion-table-form.php\n\n- 217.171.86.137/config.php\n\n- 217.171.86.137/rss_0.php\n\n- shinestars-lifestyle.com/old_shinstar/includes/old/front_footer.old.php\n\n- www.aviasiya.com/murad.by/life/wp-content/plugins/wp-accounting/inc/pages/page-search.php\n\n- baby.greenweb.co.il/wp-content/themes/san-kloud/admin.php\n\n- soligro.com/wp-includes/pomo/db.php\n\n- giadinhvabe.net/wp-content/themes/viettemp/out/css/class.php\n\n- tekfordummies.com/wp-content/plugins/social-auto-poster/includes/libraries/delicious/Delicious.php\n\n- kennynguyen.esy.es/wp-content/plugins/wp-statistics/vendor/maxmind-db/reader/tests/MaxMind/Db/\ntest/Reader/BuildTest.php\n\n- sonneteck.com/wp-content/plugins/yith-woocommerce-wishlist/plugin-fw/licence/templates/panel/\nactivation/activation.php\n\n- chagiocaxuanson.esy.es/wp-content/plugins/nextgen-gallery/products/photocrati_nextgen/modules/\nngglegacy/admin/templates/manage_gallery/gallery_preview_page_field.old.php\n\n- hotnews.16mb.com/wp-content/themes/twentysixteen/template-parts/content-header.php\n\n- zszinhyosz.pe.hu/wp-content/themes/twentyfourteen/page-templates/full-hight.php\n\n- weandcats.com/wp-content/plugins/broken-link-checker/modules/checkers/http-module.php\n\n#### Mutexes\n```\n{531511FA-190D-5D85-8A4A-279F2F592CC7}\n\n```\n\n-----\n\n#### Turla’s new second stage backdoor\n\n\n#### Hashes\n\n\nTable 6. Gazer sample hashes\n\n\nCompilation Eset Detection\nSHA1 hash Component Certificate\nTime Name\n\n\n-----\n\n#### Turla’s new second stage backdoor\n\n\nCompilation Eset Detection\nSHA1 hash Component Certificate\nTime Name\n\n\n-----\n\n#### Turla’s new second stage backdoor\n\n\nCompilation Eset Detection\nSHA1 hash Component Certificate\nTime Name\n\n\n-----\n\n#### Turla’s new second stage backdoor\n\n\n### Appendices\n\n#### Function names\n\nThere are a few samples of Gazer that use the current function name as first parameter for the log\nfunction. Here is a list of some function names used in Gazer:\n\n- AutorunManager Class\n\n - AutorunManager::~AutorunManger\n\n - AutorunManager::Init\n\n - AutorunManger::ReInit\n\n - AutorunManager::BuildAutorunSettings\n\n - AutorunManager::FreeAutorunsSettings\n\n - AutorunManager::FullCheck\n\n - AutorunManager::StartAutorunEx\n\n - AutorunManager::FullStart\n\n- HiddenTaskAutorun Class\n\n - HiddenTaskAutorun::IsPathsEqual\n\n- LinkAutorun Class\n\n  - LinkAutorunClass::InfectLnkFile\n\n  - LinkAutorunClass::ClearLnkFile\n\n - LinkAutorunClass::CheckLnkFile\n\n- RemoteImport32 Class\n\n - RemoteImport32::RemoteImport32\n\n - RemoteImport32::GetRemoteProcAddress\n\n - RemoteImport32::GetRemoteModuleHandle\n\n- ScreenSaverAutorun Class\n\n - ScreenSaverAutorun::ChangeScreenSaver\n\n - ScreenSaverAutorun::WndProc1\n\n - ScreenSaverAutorun::GetMessageThreadProc\n\n - ScreenSaverAutorun::CreateHiddenWindow\n\n - ScreenSaverAutorun::CloseHiddenWindow\n\n- ShellAutorun Class\n\n  - ShellAutorun::AutorunInstallEx\n\n - ShellAutorun::AutorunUninstallEx\n\n - ShellAutorun::AutorunCheckEx\n\n - ShellAutorun::IsPathsEqual\n\n- StartupAutorun Class\n\n - StartupAutorun::AutorunInstallEx\n\n - StartupAutorun::AutorunUninstallEx\n\n - StartupAutorun::AutorunCheckEx\n\n - StartupAutorun::IsPathsEqual\n\n- TaskScheduler20Autorun Class\n\n - TaskScheduler20Autorun::Init\n\n - TaskScheduler20Autorun::AutorunCheckEx\n\n - TaskScheduler20Autorun::AutorunInstallEx\n\n - TaskScheduler20Autorun::AutorunUninstallEx\n\n - TaskScheduler20Autorun::IsPathsEqual\n\n\n-----\n\n#### Turla’s new second stage backdoor\n\n\n\n- DllInjector Class\n\n  - DllInjector::LoadDllToProcess\n\n  - DllInjector::GetProcHandle\n\n  - DllInjector::CheckDllAndSetPlatform\n\n  - DllInjector::CopyDllFromBuffer\n\n  - DllInjector::MapLibrary\n\n  - DllInjector::Map86Library_tox64\n\n  - DllInjector::CallEntryPoint\n\n  - DllInjector::FindDllImageBase\n\n  - DllInjector::WindowInject\n\n- InjectManager Class\n\n - InjectManager::~InjectManager\n\n  - InjectManager::BuildInjectSettingsList\n\n  - InjectManager::FreeInjectSettingsList\n\n - InjectManager::Stop\n\n - InjectManager::DetachAll\n\n - InjectManager::FindAndInjectInVictim\n\n - InjectManager::FindProcessSimple2\n\n - InjectManager::LoadNtdll\n\n - InjectManager::UnLoadNtdll\n\n - InjectManager::LoadWinsta\n\n - InjectManager::UnLoadWinsta\n\n - InjectManager::SetStatusTransportDll\n\n - InjectManager::GetTransportState\n\n - InjectManager::DestroyManuallyCreatedVictim\n\n - InjectManager::VictimManualCreateIE\n\n- TNPTransport Class\n\n  - TNPTransport::Init\n\n - TNPTransport::ReInit\n\n - TNPTransport::~TNPTransport\n\n - TNPTransport::Receive\n\n - TNPTransport::RunServer\n\n - TNPTransport::ServerProc\n\n- ExeStorage Class\n\n - ExeStorage::Migrate\n\n - ExeStorage::SecureHeapFree\n\n- FSStorage Class\n\n - FSStorage::~FSStorage\n\n  - FSStorage::Init\n\n - FSStorage::GetBlock\n\n  - FSStorage::GetListBlock\n\n - FSStorage::Migrate\n\n - FSStorage::SecureHeapFree\n\n - FSStorage::Update\n\n - FSStorage::Empty\n\n- RegStorage Class\n\n - RegStorage::~RegStorage\n\n  - RegStorage::Init\n\n  - RegStorage::FreeList\n\n\n-----\n\n#### Turla’s new second stage backdoor\n\n\n\n - RegStorage::GetListBlock\n\n - RegStorage::DeleteListBlock\n\n - RegStorage::Migrate\n\n - RegStorage::SecureHeapFree\n\n - RegStorage::Update\n\n - RegStorage::Empty\n\n- ResultQueue Class\n\n - ResultQueue::~ResultQueue\n\n - ResultQueue::DumpQueueToStorage\n\n - ResultQueue::RestoreFromStorage\n\n - ResultQueue::ClearQueue\n\n - ResultQueue::RemoveResult\n\n - ResultQueue::GetNextResultToSendWithModule\n\n - ResultQueue::SetPredeterminedResult\n\n - ResultQueue::print\n\n- TaskQueue Class\n\n - TaskQueue::~TaskQueue\n\n - TaskQueue::DumpQueueToStorage\n\n - TaskQueue::RestoreFromStorage\n\n - TaskQueue::ClearQueue\n\n - TaskQueue::RemoveCompletedTasks\n\n - TaskQueue::print\n\n- CExecutionSubsystem Class\n\n - CExecutionSubsystem::~CExecutionSubsystem\n\n - CExecutionSubsystem::Stop\n\n - CExecutionSubsystem::TaskExecusion\n\n - CExecutionSubsystem::TaskConfigure\n\n - CExecutionSubsystem::TaskUpload\n\n - CExecutionSubsystem::TaskDownload\n\n - CExecutionSubsystem::TaskReplacement\n\n - CExecutionSubsystem::TaskDelete\n\n - CExecutionSubsystem::TaskPacketLocalTransport\n\n - CExecutionSubsystem::FinishTask\n\n - CExecutionSubsystem::PushTaskResult\n\n - CExecutionSubsystem::UpdateStorage\n\n- CMessageProcessingSystem Class\n\n - CMessageProcessingSystem::~CMessageProcessing\n\n - CMessageProcessingSystem::ListenerCallBack\n\n - CMessageProcessingSystem::WaitShutdownModule\n\n - CMessageProcessingSystem::SetCompulsorySMC\n\n - CMessageProcessingSystem::UnSetCompulsorySMC\n\n - CMessageProcessingSystem::IsCompulsorySMC\n\n - CMessageProcessingSystem::GetCompulsorySMC\n\n - CMessageProcessingSystem::Receive_TAKE_NOP\n\n - CMessageProcessingSystem::Receive_GIVE_SETTINGS\n\n - CMessageProcessingSystem::Receive_TAKE_CAN_NOT_WORK\n\n - CMessageProcessingSystem::Receive_GIVE_CACHE\n\n - CMessageProcessingSystem::Receive_TAKE_CACHE\n\n - CMessageProcessingSystem::Receive_TAKE_TASK\n\n - CMessageProcessingSystem::Receive_GIVE_RESULT\n\n\n-----\n\n#### Turla’s new second stage backdoor\n\n\n\n - CMessageProcessingSystem::Receive_TAKE_CONFIRM_RESULT\n\n - CMessageProcessingSystem::Receive_TAKE_LOADER_BODY\n\n - CMessageProcessingSystem::Receive_TAKE_UNINSTALL\n\n - CMessageProcessingSystem::Receive_NO_CONNECT_TO_Gazer\n\n - CMessageProcessingSystem::Receive_TAKE_LAST_CONNECTION\n\n - CMessageProcessingSystem::Send_TAKE_FIN\n\n - CMessageProcessingSystem::Send_TAKE_SHUTDOWN\n\n - CMessageProcessingSystem::Send_TAKE_SETTINGS\n\n - CMessageProcessingSystem::Send_TAKE_RESULT\n\n- Crypto Class\n\n - Crypto::GetPublicKey\n\n - Crypto::EncryptRSA\n\n - Crypto::Sign\n\n - Crypto::EncryptAndSignBufferRSAEx\n\n - Crypto::DecryptRSA\n\n  - Crypto::Verify\n\n - Crypto::DecryptAndVerifyBufferRSAEx\n\n - Crypto::EncryptAndSignBufferRSA1\n\n - Crypto::EncryptAndSignBufferRSAC\n\n - Crypto::DecryptAndVerifyBufferRSA0\n\n - Crypto::DecryptAndVerifyBufferRSA1\n\n - Crypto::DecryptAndVerifyBufferRSAL\n\n  - Crypto::VerifyLoaderFile\n\n  - Crypto::VerifyLoader\n\n - Crypto::CompressBuffer\n\n - Crypto::DecompressBuffer\n\n- LTManager Class\n\n - LTManager::~LTManager\n\n - LTManager::Init\n\n - LTManager::GetResultFromQueue\n\n - LTManager::SetResultToCache\n\n - LTManager::GetTaskFromCache\n\n - LTManager::SetTaskToQueue\n\n - LTManager::IsSendPacketFurtherOnRoute\n\n - LTManager::SendPacketNextRouteUnit\n\n - LTManager::SetCache\n\n - LTManager::SetPacket\n\n - LTManager::DumpCacheToStorage\n\n - LTManager::DeSerializeCache\n\n - LTManager::DeSerializePacket\n\n - LTManager::DeSerializeRoute\n\n - LTManager::DeSerializeTask\n\n - LTManager::DeSerializeResult\n\n - LTManager::SerializeCache\n\n - LTManager::SerializePacket\n\n - LTManager::SerialiazeRoute\n\n  - LTManager::SerializeTask\n\n  - LTManager::SerializeResult\n\n - LTManager::ClearCache\n\n - LTManager::ClearPacket\n\n - LTManager::ClearRoute\n\n\n-----\n\n#### Turla’s new second stage backdoor\n\n\n\n - LTManager::ClearTask\n\n - LTManager::ClearResult\n\n - LTManager::PrintCache\n\n - LTManager::CreateEvents\n\n - LTManager::SetEvents\n\n - LTManager::ResetEvents\n\n - LTManager::WaitEvents\n\n - LTManager::DeleteEvents\n\n- LTMessageProcessing Class\n\n - LTMessageProcessing::ListenerCallBack\n\n - LTMessageProcessing::Send_TAKE_OK\n\n - LTMessageProcessing::Send_TAKE_ERROR_CRYPT\n\n - LTMessageProcessing::Send_TAKE_ERROR_UNKNOWN\n\n- LTNamedPipe Class\n\n - LTNamedPipe::ReInit\n\n - LTNamedPipe::BuildLocalTransportSettings\n\n - LTNamedPipe::~LTNamedPipe\n\n - LTNamedPipe::Receive\n\n - LTNamedPipe::RunServer\n\n - LTNamedPipe::Stop\n\n - LTNamedPipe::CreateNewNPInstance\n\n - LTNamedPipe::ServerProc\n\n - LTNamedPipe::ClientCommunication\n\n#### Yara rules\n\n```\nimport “pe”\nimport “math”\nimport “hash”\nrule Gazer_certificate_subject {\n condition:\n  for any i in (0..pe.number_of_signatures - 1):\n    (pe.signatures[i].subject contains “Solid Loop” or\npe.signatures[i].subject contains “Ultimate Computer Support”)\n}\nrule Gazer_certificate\n{\n strings:\n  $certif1 = {52 76 a4 53 cd 70 9c 18 da 65 15 7e 5f 1f de 02}\n  $certif2 = {12 90 f2 41 d9 b2 80 af 77 fc da 12 c6 b4 96 9c}\n condition:\n  (uint16(0) == 0x5a4d) and 1 of them and filesize < 2MB\n}\nrule Gazer_logfile_name\n{\n  strings:\n   $s1 = “CVRG72B5.tmp.cvr”\n   $s2 = “CVRG1A6B.tmp.cvr”\n   $s3 = “CVRG38D9.tmp.cvr”\n  condition:\n  (uint16(0) == 0x5a4d) and 1 of them\n}\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "99fdc3ef-333d-48f5-a4a1-becd788c7b80",
            "created_at": "2022-10-25T15:28:29.802983Z",
            "updated_at": "2022-10-25T15:28:29.802983Z",
            "deleted_at": null,
            "name": "MITRE",
            "url": "https://github.com/mitre-attack/attack-stix-data",
            "description": "MITRE ATT&CK STIX Data",
            "reports": null
        },
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        },
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        },
        {
            "id": "6fc23d14-23a6-4870-8fad-b291b182596f",
            "created_at": "2022-10-25T16:07:18.480113Z",
            "updated_at": "2022-10-25T16:07:18.480113Z",
            "deleted_at": null,
            "name": "ETDA",
            "url": "https://apt.etda.or.th",
            "description": "Threat Group Cards: A Threat Actor Encyclopedia",
            "reports": null
        },
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        },
        {
            "id": "5910e58f-4bc9-4e4e-9dbb-887804094a01",
            "created_at": "2022-10-25T16:32:58.457399Z",
            "updated_at": "2022-10-25T16:32:58.457399Z",
            "deleted_at": null,
            "name": "OTX",
            "url": "https://otx.alienvault.com",
            "description": "Alienvault Open Threat Exchange (OTX)",
            "reports": null
        },
        {
            "id": "6825b8cb-7d82-43d2-b0b0-d51c7e255b42",
            "created_at": "2023-01-06T13:46:37.642134Z",
            "updated_at": "2023-01-06T13:46:37.642134Z",
            "deleted_at": null,
            "name": "MISPGALAXY",
            "url": "https://www.misp-project.org/galaxy.html",
            "description": "MISP Galaxy Clusters",
            "reports": null
        }
    ],
    "references": [
        "https://www.welivesecurity.com/wp-content/uploads/2017/08/eset-gazer.pdf",
        "https://app.box.com/s/sqiber6gp1q75h6r4eq89fjeeur2mz8h",
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2017/2017.08.30.Gazing_at_Gazer/eset-gazer.pdf"
    ],
    "report_names": [
        "eset-gazer.pdf",
        "ESET_Gazer(08-30-2017)",
        "eset-gazer"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "a97cf06d-c2e2-4771-99a2-c9dee0d6a0ac",
            "created_at": "2022-10-25T16:07:24.349252Z",
            "updated_at": "2025-03-27T02:02:10.184406Z",
            "deleted_at": null,
            "main_name": "Turla",
            "aliases": [
                "ATK 13",
                "Belugasturgeon",
                "Blue Python",
                "CTG-8875",
                "Group 88",
                "ITG12",
                "Iron Hunter",
                "Krypton",
                "Makersmark",
                "Operation Epic Turla",
                "Operation Moonlight Maze",
                "Operation Penguin Turla",
                "Operation Satellite Turla",
                "Operation Skipper Turla",
                "Operation Turla Mosquito",
                "Operation WITCHCOVEN",
                "Pacifier APT",
                "Pensive Ursa",
                "Popeye",
                "SIG15",
                "SIG2",
                "SIG23",
                "Secret Blizzard",
                "TAG-0530",
                "Turla",
                "UNC4210",
                "Venomous Bear",
                "Waterbug"
            ],
            "source_name": "ETDA:Turla",
            "tools": [
                "ASPXSpy",
                "ASPXTool",
                "ATI-Agent",
                "AdobeARM",
                "Agent.BTZ",
                "Agent.DNE",
                "BigBoss",
                "COMpfun",
                "Chinch",
                "Cloud Duke",
                "CloudDuke",
                "CloudLook",
                "Cobra Carbon System",
                "ComRAT",
                "DoublePulsar",
                "EmPyre",
                "EmpireProject",
                "Epic Turla",
                "EternalBlue",
                "EternalRomance",
                "GoldenSky",
                "Group Policy Results Tool",
                "HTML5 Encoding",
                "HyperStack",
                "IcedCoffee",
                "IronNetInjector",
                "KSL0T",
                "Kapushka",
                "Kazuar",
                "KopiLuwak",
                "Kotel",
                "LOLBAS",
                "LOLBins",
                "LightNeuron",
                "Living off the Land",
                "Maintools.js",
                "Metasploit",
                "Meterpreter",
                "MiamiBeach",
                "Mimikatz",
                "MiniDionis",
                "Minit",
                "NBTscan",
                "NETTRANS",
                "NETVulture",
                "Neptun",
                "NetFlash",
                "NewPass",
                "Outlook Backdoor",
                "Penquin Turla",
                "Pfinet",
                "PowerShell Empire",
                "PowerShellRunner",
                "PowerShellRunner-based RPC backdoor",
                "PowerStallion",
                "PsExec",
                "PyFlash",
                "QUIETCANARY",
                "Reductor RAT",
                "RocketMan",
                "SMBTouch",
                "SScan",
                "Satellite Turla",
                "SilentMoon",
                "Sun rootkit",
                "TTNG",
                "TadjMakhal",
                "Tavdig",
                "TinyTurla",
                "TinyTurla Next Generation",
                "TinyTurla-NG",
                "Topinambour",
                "Tunnus",
                "Turla",
                "Turla SilentMoon",
                "TurlaChopper",
                "Uroburos",
                "Urouros",
                "WCE",
                "WITCHCOVEN",
                "WhiteAtlas",
                "WhiteBear",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "Wipbot",
                "WorldCupSec",
                "XTRANS",
                "certutil",
                "certutil.exe",
                "gpresult",
                "nbtscan",
                "nbtstat",
                "pwdump"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "8aaa5515-92dd-448d-bb20-3a253f4f8854",
            "created_at": "2024-06-19T02:03:08.147099Z",
            "updated_at": "2025-03-27T02:05:17.408118Z",
            "deleted_at": null,
            "main_name": "IRON HUNTER",
            "aliases": [
                "Belugasturgeon ",
                "Blue Python ",
                "CTG-8875 ",
                "ITG12 ",
                "KRYPTON ",
                "MAKERSMARK ",
                "Pensive Ursa ",
                "Secret Blizzard ",
                "Turla",
                "UAC-0003 ",
                "UAC-0024 ",
                "UNC4210 ",
                "Venomous Bear ",
                "Waterbug ",
                "ATK13 "
            ],
            "source_name": "Secureworks:IRON HUNTER",
            "tools": [
                " ComRAT",
                " Kazuar",
                " KopiLuwak",
                " LightNeuron",
                " Mosquito",
                " Nautilus",
                " Neuron",
                " Penquin",
                " PoisonFrog",
                " PyFlash",
                " Skipper",
                " Snake",
                " Tavdig",
                " TinyTurla",
                " Tunnus",
                "Carbon-DLL"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "a97fee0d-af4b-4661-ae17-858925438fc4",
            "created_at": "2023-01-06T13:46:38.396415Z",
            "updated_at": "2025-03-27T02:00:02.823045Z",
            "deleted_at": null,
            "main_name": "Turla",
            "aliases": [
                "Uroburos",
                "Hippo Team",
                "Pacifier APT",
                "MAKERSMARK",
                "ATK13",
                "UAC-0003",
                "IRON HUNTER",
                "Waterbug",
                "TAG_0530",
                "KRYPTON",
                "Popeye",
                "SIG23",
                "UAC-0144",
                "G0010",
                "Blue Python",
                "VENOMOUS Bear",
                "Group 88",
                "Pfinet",
                "ITG12",
                "UNC4210",
                "Secret Blizzard",
                "UAC-0024"
            ],
            "source_name": "MISPGALAXY:Turla",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d11c89bb-1640-45fa-8322-6f4e4053d7f3",
            "created_at": "2022-10-25T15:50:23.509601Z",
            "updated_at": "2025-03-27T02:00:55.487991Z",
            "deleted_at": null,
            "main_name": "Turla",
            "aliases": [
                "Turla",
                "IRON HUNTER",
                "Group 88",
                "Waterbug",
                "WhiteBear",
                "Krypton",
                "Venomous Bear",
                "Secret Blizzard",
                "BELUGASTURGEON"
            ],
            "source_name": "MITRE:Turla",
            "tools": [
                "PsExec",
                "nbtstat",
                "ComRAT",
                "netstat",
                "certutil",
                "KOPILUWAK",
                "IronNetInjector",
                "LunarWeb",
                "Arp",
                "Uroburos",
                "PowerStallion",
                "Kazuar",
                "Systeminfo",
                "LightNeuron",
                "Mimikatz",
                "Tasklist",
                "LunarMail",
                "HyperStack",
                "NBTscan",
                "TinyTurla",
                "Penquin",
                "LunarLoader"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1666716503,
    "ts_updated_at": 1743041780,
    "ts_creation_date": 1504005859,
    "ts_modification_date": 1504005865,
    "files": {
        "pdf": "https://archive.orkl.eu/2c5e1689900d6f92ec985be4f9f1df9f9b52de30.pdf",
        "text": "https://archive.orkl.eu/2c5e1689900d6f92ec985be4f9f1df9f9b52de30.txt",
        "img": "https://archive.orkl.eu/2c5e1689900d6f92ec985be4f9f1df9f9b52de30.jpg"
    }
}