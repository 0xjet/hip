{
    "id": "d3a6ecef-81b2-48b9-9902-20e925235036",
    "created_at": "2023-05-06T02:08:33.308535Z",
    "updated_at": "2025-03-27T02:05:18.129524Z",
    "deleted_at": null,
    "sha1_hash": "c581a929576a0a270e866c210054f6033e07f2fc",
    "title": "2023-03-31 - Initial Implants and Network Analysis Suggest the 3CX Supply Chain Operation Goes Back to Fall 2022",
    "authors": "",
    "file_creation_date": "2023-05-05T01:45:03Z",
    "file_modification_date": "2023-05-05T01:45:03Z",
    "file_size": 1908448,
    "plain_text": "# Initial Implants and Network Analysis Suggest the 3CX Supply Chain Operation Goes Back to Fall 2022\n\n**blogs.blackberry.com/en/2023/03/initial-implants-and-network-analysis-suggest-the-3cx-supply-chain-operation-goes-**\nback-to-fall-2022\n\nThe BlackBerry Research & Intelligence Team\n\n1. [BlackBerry Blog](https://blogs.blackberry.com/en.html)\n2. Initial Implants and Network Analysis Suggest the 3CX Supply Chain Operation Goes\n\nBack to Fall 2022\n\n### SUMMARY  \n\nOn March 29, it became publicly known that business communications supplier 3CX had\nsuffered a compromise, with several Trojanized versions of their VOIP software\n3CXDesktopApp deployed worldwide. This includes versions used by Windows and®\nmacOS clients.®\n\n\nWhile several users reported alerts by the middle of March 2023, most believed those were\nfalse positives.\n\n\n-----\n\nBased on our initial assessment, the 3CX supply chain operation most likely began at the\nbeginning of fall 2022.\n\n### TECHNICAL ANALYSIS\n\n**Context**\n\n[On March 30, 3CX publicly issued a security alert, stating that at least some of their](https://www.3cx.com/blog/news/desktopapp-security-alert/)\napplications had been Trojanized and delivered via the supply chain to their customers. The\nday before, on March 29, the attack was covered by multiple technical analyses from the\n[industry, including the implants for macOS.](https://objective-see.org/blog/blog_0x73.html)\n\nSince the supply chain attack may affect everyone who uses the affected 3CXDesktopApp,\nand given the number of potential victims worldwide, we took a look at the timelines behind\nthe attack, as well as technical aspects that have not yet been discussed, and present our\nfindings to you in this blog post.\n\n### What is the 3CXDesktopApp?\n\nThe 3CXDesktopApp is a legitimate voice and video conferencing software product, offering\n“call, video, and live chat.” It was developed by 3CX, a business communications software\ncompany founded in 2005, when Voice over Internet Protocol (VOIP) was still an emerging\ntechnology. According to the company website, 3CX has approximately 600,000 customer\ncompanies, with over 12 million daily users in 190 countries.\n\nThe software-based PBX phone system is currently available on Windows, Linux,®\nAndroid™, and iOS . The 3CX website lists customer organizations in sectors including®\nManufacturing, Automotive, Food and Beverage, Hospitality, and Managed Information\nTechnology Service Providers (MSPs).\n\n\n### Attack Vector\n\nWhile it's unclear how the threat actor initially obtained access to the 3CX network, the\ndelivery mechanism of Trojanized apps is via a supply chain by distributing melted clean\napplications with malicious libraries integrated into the installers for Windows and macOS.\n\nThis is not uncommon in these type of attacks, where a vendor gets compromised by a\nthreat actor, who inserts malware into the vendor’s supply chain; in this case, into their\nsoftware library. This malicious software is then distributed to the customers without the\nvendor's knowledge.\n\n[A couple of weeks ago, different 3CX users on the Internet reported issues with a new](https://www.reddit.com/r/3CX/comments/11rpiz4/windows_client_problem_with_new_ver_1812407/)\nversion of the 3CX app while installing it on their machines.\n\n\n-----\n\n_Figure 1: User discussing issues with the latest 3CX versions. (SOURCE: Reddit; r/3CX)_\n\n### Weaponization\n\nThe infection starts with a Trojanized installer (MSI) of the 3CX VOIP software. The\nmalicious code allegedly found its way into the release process via a compromised\ndependency. This means that the installer containing the malicious code was signed with\ntheir code signing certificate, so the installer appears perfectly legitimate.\n\nBundled in this installer are modified copies of ffmpeg.dll and d3dcompiler_47.dll. When the\n3CX desktop client is started, its dependencies (including ffmpeg.dll) are loaded. Ffmpeg.dll\nhas a modified DllMain (the function used for dll initialization) that loads a malicious portable\nexecutable (PE) file embedded in the d3dcompiler_47.dll.\n\nFfmpeg starts by using GetModuleFilenameW to get the path of the executing assembly\n(the 3CX desktop client binary). It then uses this path to locate d3dcompiler_47.dll, which is\ninstalled in the same folder. It walks through the PE headers of the d3dcompiler_47.dll to\nfind the security directory. This data directory is usually used to store certificate information,\nbut the modified copy has an encrypted shellcode blob inserted after the certificate data.\nFfmpeg finds the start of this shellcode blob by looking for a hex marker “FEEDFACE”. It\nthen reads the encrypted payload into a buffer on the heap and decrypts it. After the buffer\nhas been decrypted, it is then marked as executable using VirtualProtect, and finally the\nffmpeg code calls into the payload.\n\nThe payload is a reflectivised PE with an embedded name of “samcli.dll” that was built on\nJanuary 10th (localized time) of this year.\n\n\n-----\n\n_Figure 2: samcli.dll_\n\nAfter the PE is loaded its export DllGetClassObject is called and the command line “1200\n2400 \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like\nGecko) 3CXDesktopApp/18.11.1197 Chrome/102.0.5005.167 Electron/19.1.9\nSafari/537.36\" is passed in. This export starts a new thread to continue execution within the\npayload and returns allowing the 3CX software to continue its execution as normal.\n\nIn the new thread this payload writes some random data to a file called “manifest” or reads\nthe random data if the file is already present. It proceeds to read the MachineGuid subkey\nfrom HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Cryptography which is saved for\nlater use in command-and-control (C2) communications. To identify which C2 the payload\nshould communicate with it, it first downloads an icon from GitHub using a URL of the form:\n\nhxxps://raw.githubusercontent[.]com/IconStorages/images/main/icon[1-15].ico\n\nThe icon number is generated randomly at runtime (rand() % 15 + 1) and it continues until\nan icon is successfully downloaded:\n\nAfter an icon is downloaded, it searches from the end of the file backwards until it\nencounters the marker ‘$’:\n\n\n-----\n\nThe data after this marker is then extracted, base64 decoded and AES-GCM decrypted to\nreveal a C2 URL. The payload then makes a POST request to the C2 with a request header\ncookie:\n\n__tutma={machine-guid}\n\nWhere the machine-guid was the one read from the registry earlier. The response is\nexpected to contain three fields: meta, description and URL. The response is then parsed\nby the payload and some shellcode is decrypted from it, which is then subsequently loaded\ninto memory, protected as executable, and run.\n\nGiven that the C2 servers are no longer running, without any responses it is impossible to\ndetermine what the future payloads were intended to do.\n\n### Timeline of the Attack\n\nAccording to the [vendor, its Electron Windows App shipped in Update 7 was affected at](https://www.3cx.com/blog/news/desktopapp-security-alert/)\nleast in versions 18.12.407 and 18.12.416 for Windows, and 18.11.1213, 18.12.402,\n18.12.407, and 18.12.416 for macOS.\n\nSince each version release has a timeframe for development, testing, and then release, it's\nreasonable to conclude that the threat actor behind this attack had access to the vendor's\ninfrastructure for some time while deploying malicious installers.\n\nIf we trust in the PE implants' timestamps used in the attack, it reveals the following\ntimeline:\n\n**ffmpeg.dll (Trojanized dll)**\n\n253f3a53796f1b0fbe64f7b05ae1d66bc2b0773588d00c3d2bf08572a497fa59\n2824448     Sat, Nov 12 2022, 4:12:14 - 64 Bit DLL\n\n\n-----\n\n7986bbaee8940da11ce089383521ab420c443ab7b15ed42aed91fd31ce833896\n2814976     Sat, Nov 12 2022, 4:12:14 - 64 Bit DLL\n\nc485674ee63ec8d4e8fde9800788175a8b02d3f9416d0e763360fff7f8eb4e02\n2824448     Sat, Nov 12 2022, 4:12:14 - 64 Bit DLL\n\n**3CXDesktopApp.exe (Melted installer)**\n\ndde03348075512796241389dfea5560c20a3d2a2eac95c894e7bbed5e85a0acc\n149268224   Wed, Nov 30 2022, 15:56:23 - 64 Bit EXE\n\nfad482ded2e25ce9e1dd3d3ecc3227af714bdfbbde04347dbc1b21d6a3670405\n149268224   Wed, Nov 30 2022, 15:56:23 - 64 Bit EXE\n\n**samcli.dll (payload)**\n\nf5fdefaa5321e2cea02ef8b479de8ec3c5505e956ea1484c84a7abb17231fe24\n275627     Wed, Jan 11 2023, 2:21:42 - 64 Bit DLL\n\nIf the timestamps are original, then the Trojanization probably began by the beginning of\nNovember 2022. That might indicate that the initial intrusion had taken place even earlier.\n\n**Network Infrastructure**\n\nBased on the samples and network traffic analysis, we found a few domains of note. It's a\nreferential list, which only includes some of the domains we have not been able to confirm\nas connected to the campaign.\n\n**Domain/IP** **First Seen**\n\npbxsources[.]com 2023-01-04\n\nofficestoragebox[.]com 2022-11-17 (reused domain)\n\nvisualstudiofactory[.]com 2022-11-17\n\nazuredeploystore[.]com 2022-12-07\n\nmsstorageboxes[.]com 2022-12-09\n\nofficeaddons[.]com 2022-12-12 (reused domain)\n\n\n-----\n\nsourceslabs[.]com 2022-12-09\n\npbxcloudeservices[.]com 2022-12-23\n\npbxphonenetwork[.]com 2022-12-26\n\nakamaitechcloudservices[.]com 2023-01-04\n\n_Figure 3: Attack development timeline (domains and implants)_\n\n**Targets**\n\nBased on BlackBerry’s [Cylance®](https://www.blackberry.com/us/en/products/cylance-endpoint-security/cylance-ai) telemetry, we have seen registered attack attempts in\nAustralia, the United States, and the United Kingdom. Targeted industries are HealthCare,\nPharmaceutical, Information Technologies, and Financial Corporations.\n\nGiven the nature of the attack and 3CX’s customer directory, the complete list of potentially\naffected industries is more extensive.\n\n**CONCLUSIONS**\n\nGiven the complexity of the attack and its scale, it's highly likely the threat actor behind this\nattack is a Nation State. When a supply chain attack occurs, the initial number of victims is\nextensive, while the real target may stay unknown unless it receives the final payload,\nwhich is the operation's goal. At the moment of writing this post, it is unclear what the\nshortlist of final targets is. These are usually manually approved by adversaries before\ndelivering the final stage payload.\n\n\n-----\n\nOur initial samples and network infrastructure analysis indicate that the initial phase of this\noperation took place somewhere between the end of summer and the beginning of fall\n2022. Many organizations lacking mature security operations capabilities will find it hard to\ndetect this type of activity, and when they do, these alerts are often ignored in the midst of\nmany false positives produced by poorly managed security solutions.\n\nIt’s essential for any company today to have a workable strategy to detect and prevent\nsupply chain attacks. That includes cyber threat intelligence tools to extend visibility and\nhigh-fidelity detection, as well as log retention for further forensic analysis. A defensible\nsecurity architecture augmented by continuous monitoring and response may significantly\nreduce the risks of the 2nd stage payload execution and data exfiltration.\n\n**APPENDIX 1 – CylanceOptics Hunting Queries**\n\n**Query to detect “ffmpeg.dll” creation**\n\n{\n\"Name\": \"3CX ffmpeg File Create\",\n\n\"Description\": \"Detects when ffmpeg.dll file is created\",\n\n\"Id\": \"1cd91ca6-fbd4-4000-b4e1-2f1623e5a526\",\n\n\"Version\": 1,\n\n\"SchemaVersion\": 1,\n\n\"RuleSource\": \"Cylance\",\n\n\"ObjectType\": \"DetectionRule\",\n\n\"Severity\": \"High\",\n\n\"TBM\": \"High\",\n\n\"Product\": {\"Name\": \"CylanceOPTICS\"},\n\n\"Plugin\": {\"Name\": \"OpticsDetector\"},\n\n\"OperatingSystems\": [{\"Name\": \"Windows\"}],\n\n\"PostCompletionActions\": [\"GenerateDetectionEvent\"],\n\n\"AlertVolume\": \"TBD\",\n\n\"MaximumConcurrentActivations\": 10,\n\n\"ActivationLifetimeLimit\": \"00:10:00\",\n\n\"ActivationCanUtilizeDeviceStateEvents\": false,\n\n\"AllowMultipleActivationsPerContext\": true,\n\n\"States\": [\n\n{\n\n\"Name\": \"dllCreate\",\n\n\"Scope\": \"Global\",\n\n\"Function\": \"(a)\",\n\n\"FieldOperators\": {\n\n\"a\": {\n\n\"Type\": \"Contains\",\n\n\"OperandType\": \"String\",\n\n\"Options\": {\"IgnoreCase\": true},\n\n\"Operands\": [\n\n{\n\n\n-----\n\nsource : TargetFile,\n\"data\": \"Path\"\n},\n{\n\"source\": \"Literal\",\n\"data\": \"ffmpeg.dll\"\n}\n]\n}\n},\n\"ActivationTimeLimit\": \"-0:00:00.001\",\n\"Actions\": [\n{\n\"Type\": \"AOI\",\n\"ItemName\": \"InstigatingProcess\",\n\"Position\": \"PostActivation\"\n},\n{\n\"Type\": \"AOI\",\n\"ItemName\": \"TargetFile\",\n\"Position\": \"PostActivation\"\n}\n],\n\"HarvestContributingEvent\": true,\n\"Filters\": [\n{\n\"Type\": \"Event\",\n\"Data\": {\n\"Category\": \"File\",\n\"SubCategory\": \"*\",\n\"Type\": \"Create\"\n}\n}\n]\n}\n]\n}\n\n**Query to detect C2 communication attempts by ffmpeg.dll**\n\n{\n\"Name\": \"3CX ffmpeg DNS Request\",\n\n\"Description\": \"Detects when ffmpeg.dll reaches out to known 3CX domains.\",\n\n\"Id\": \"7638ba09-1254-4573-968d-fab9ee3f9396\",\n\n\"Version\": 1,\n\n\"SchemaVersion\": 1,\n\n\"RuleSource\": \"Cylance\",\n\n\"ObjectType\": \"DetectionRule\",\n\n\"Severity\": \"High\",\n\n\"TBM\": \"High\",\n\n\n-----\n\nProduct : { Name : CylanceOPTICS },\n\"Plugin\": {\"Name\": \"OpticsDetector\"},\n\"OperatingSystems\": [{\"Name\": \"Windows\"}],\n\"PostCompletionActions\": [\"GenerateDetectionEvent\"],\n\"AlertVolume\": \"TBD\",\n\"MaximumConcurrentActivations\": 10,\n\"ActivationLifetimeLimit\": \"00:10:00\",\n\"ActivationCanUtilizeDeviceStateEvents\": false,\n\"AllowMultipleActivationsPerContext\": true,\n\"States\": [\n{\n\"Name\": \"domainRequest\",\n\"Scope\": \"Global\",\n\"Function\": \"(a&b)\",\n\"FieldOperators\": {\n\"a\": {\n\"Type\": \"ContainsAny\",\n\"OperandType\": \"String\",\n\"Options\": {\"IgnoreCase\": true},\n\"Operands\": [\n{\n\"source\": \"InstigatingProcess\",\n\"data\": \"Name\"\n},\n{\n\"source\": \"LiteralSet\",\n\"data\": [\n\"ffmpeg.dll\",\n\"ffmpeg\"\n]\n}\n]\n},\n\"b\": {\n\"Type\": \"ContainsAny\",\n\"OperandType\": \"String\",\n\"Options\": {\"IgnoreCase\": true},\n\"Operands\": [\n{\n\"source\": \"TargetDnsRequest\",\n\"data\": \"Responses/A/1/QuestionName\"\n},\n{\n\"source\": \"LiteralSet\",\n\"data\": [\n\"3cx\",\n\"akamaicontainer\",\n\"akamaitechcloudservices\",\n\"azuredeploystore\",\n\"azureonlinecloud\",\n\"azureonlinestorage\",\n\"dunamistrd\",\n\n\n-----\n\nglcloudservice,\n\"journalide\",\n\"msedgepackageinfo\",\n\"msstorageazure\",\n\"msstorageboxes\",\n\"officeaddons\",\n\"officestoragebox\",\n\"pbxcloudeservices\",\n\"pbxphonenetwork\",\n\"pbxsources\",\n\"qwepoi123098\",\n\"sbmsa\",\n\"sourceslabs\",\n\"visualstudiofactory\",\n\"zacharryblogs\"\n]\n}\n]\n}\n},\n\"ActivationTimeLimit\": \"-0:00:00.001\",\n\"Actions\": [\n{\n\"Type\": \"AOI\",\n\"ItemName\": \"InstigatingProcess\",\n\"Position\": \"PostActivation\"\n},\n{\n\"Type\": \"AOI\",\n\"ItemName\": \"TargetDnsRequest\",\n\"Position\": \"PostActivation\"\n},\n{\n\"Type\": \"AOI\",\n\"ItemName\": \"TargetNetworkConnection\",\n\"Position\": \"PostActivation\"\n}\n],\n\"HarvestContributingEvent\": true,\n\"Filters\": [\n{\n\"Type\": \"Event\",\n\"Data\": {\n\"Category\": \"Network\",\n\"SubCategory\": \"DNS\",\n\"Type\": \"Request\"\n}\n}\n]\n}\n]\n\n\n-----\n\n}\n\n**Query to detect libffmpeg.dylib creation in the system (macOS)**\n\n{\n\"Name\": \"macOS 3CX ffmpeg File Create\",\n\n\"Description\": \"Detects when libffmpeg.dylib file is created\",\n\n\"Id\": \"5ef0fb47-2102-4351-9d3a-4872dd96734a\",\n\n\"Version\": 1,\n\n\"SchemaVersion\": 1,\n\n\"RuleSource\": \"Cylance\",\n\n\"ObjectType\": \"DetectionRule\",\n\n\"Severity\": \"High\",\n\n\"TBM\": \"High\",\n\n\"Product\": {\"Name\": \"CylanceOPTICS\"},\n\n\"Plugin\": {\"Name\": \"OpticsDetector\"},\n\n\"OperatingSystems\": [{\"Name\": \"macOS\"}],\n\n\"PostCompletionActions\": [\"GenerateDetectionEvent\"],\n\n\"AlertVolume\": \"TBD\",\n\n\"MaximumConcurrentActivations\": 10,\n\n\"ActivationLifetimeLimit\": \"00:10:00\",\n\n\"ActivationCanUtilizeDeviceStateEvents\": false,\n\n\"AllowMultipleActivationsPerContext\": true,\n\n\"States\": [\n\n{\n\n\"Name\": \"dylibCreate\",\n\n\"Scope\": \"Global\",\n\n\"Function\": \"(a)\",\n\n\"FieldOperators\": {\n\n\"a\": {\n\n\"Type\": \"Contains\",\n\n\"OperandType\": \"String\",\n\n\"Options\": {\"IgnoreCase\": true},\n\n\"Operands\": [\n\n{\n\n\"source\": \"TargetFile\",\n\n\"data\": \"Path\"\n},\n\n{\n\n\"source\": \"Literal\",\n\"data\": \"libffmpeg.dylib\"\n\n}\n\n]\n}\n\n},\n\n\"ActivationTimeLimit\": \"-0:00:00.001\",\n\n\"Actions\": [\n\n{\n\n\"Type\": \"AOI\",\n\n\"ItemName\": \"InstigatingProcess\",\n\n\n-----\n\nPosition : PostActivation\n},\n{\n\"Type\": \"AOI\",\n\"ItemName\": \"TargetFile\",\n\"Position\": \"PostActivation\"\n}\n],\n\"HarvestContributingEvent\": true,\n\"Filters\": [\n{\n\"Type\": \"Event\",\n\"Data\": {\n\"Category\": \"File\",\n\"SubCategory\": \"*\",\n\"Type\": \"Create\"\n}\n}\n]\n}\n]\n}\n\n**Query to detect C2 communication attempts by libffmpeg.dylib (macOS)**\n\n{\n\"Name\": \"macOS 3CX libffmpeg DNS Request\",\n\n\"Description\": \"Detects when libffmpeg.dylib reaches out to known 3CX domains.\",\n\n\"Id\": \"0072eda0-c235-4345-aaf3-5905cb1c0806\",\n\n\"Version\": 1,\n\n\"SchemaVersion\": 1,\n\n\"RuleSource\": \"Cylance\",\n\n\"ObjectType\": \"DetectionRule\",\n\n\"Severity\": \"High\",\n\n\"TBM\": \"High\",\n\n\"Product\": {\"Name\": \"CylanceOPTICS\"},\n\n\"Plugin\": {\"Name\": \"OpticsDetector\"},\n\n\"OperatingSystems\": [{\"Name\": \"macOS\"}],\n\n\"PostCompletionActions\": [\"GenerateDetectionEvent\"],\n\n\"AlertVolume\": \"TBD\",\n\n\"MaximumConcurrentActivations\": 10,\n\n\"ActivationLifetimeLimit\": \"00:10:00\",\n\n\"ActivationCanUtilizeDeviceStateEvents\": false,\n\n\"AllowMultipleActivationsPerContext\": true,\n\n\"States\": [\n\n{\n\n\"Name\": \"domainRequest\",\n\n\"Scope\": \"Global\",\n\n\"Function\": \"(a&b)\",\n\n\"FieldOperators\": {\n\n\n-----\n\na : {\n\"Type\": \"ContainsAny\",\n\"OperandType\": \"String\",\n\"Options\": {\"IgnoreCase\": true},\n\"Operands\": [\n{\n\"source\": \"InstigatingProcess\",\n\"data\": \"Name\"\n},\n{\n\"source\": \"LiteralSet\",\n\"data\": [\n\"libffmpeg.dylib\",\n\"libffmpeg\"\n]\n}\n]\n},\n\"b\": {\n\"Type\": \"ContainsAny\",\n\"OperandType\": \"String\",\n\"Options\": {\"IgnoreCase\": true},\n\"Operands\": [\n{\n\"source\": \"TargetDnsRequest\",\n\"data\": \"Responses/A/1/QuestionName\"\n},\n{\n\"source\": \"LiteralSet\",\n\"data\": [\n\"3cx\",\n\"akamaicontainer\",\n\"akamaitechcloudservices\",\n\"azuredeploystore\",\n\"azureonlinecloud\",\n\"azureonlinestorage\",\n\"dunamistrd\",\n\"glcloudservice\",\n\"journalide\",\n\"msedgepackageinfo\",\n\"msstorageazure\",\n\"msstorageboxes\",\n\"officeaddons\",\n\"officestoragebox\",\n\"pbxcloudeservices\",\n\"pbxphonenetwork\",\n\"pbxsources\",\n\"qwepoi123098\",\n\"sbmsa\",\n\"sourceslabs\",\n\"visualstudiofactory\",\n\"zacharryblogs\"\n\n\n-----\n\n]\n}\n]\n}\n},\n\"ActivationTimeLimit\": \"-0:00:00.001\",\n\"Actions\": [\n{\n\"Type\": \"AOI\",\n\"ItemName\": \"InstigatingProcess\",\n\"Position\": \"PostActivation\"\n},\n{\n\"Type\": \"AOI\",\n\"ItemName\": \"TargetDnsRequest\",\n\"Position\": \"PostActivation\"\n},\n{\n\"Type\": \"AOI\",\n\"ItemName\": \"TargetNetworkConnection\",\n\"Position\": \"PostActivation\"\n}\n],\n\"HarvestContributingEvent\": true,\n\"Filters\": [\n{\n\"Type\": \"Event\",\n\"Data\": {\n\"Category\": \"Network\",\n\"SubCategory\": \"DNS\",\n\"Type\": \"Request\"\n}\n}\n]\n}\n]\n}\n\n**Query to detect generic request to C2s used in the 3CX attack on Windows**\n\n{\n\"Name\": \"3CX DNS Request\",\n\n\"Description\": \"Detects when a dns request is made to known 3CX domains.\",\n\n\"Id\": \"6abb19ad-9490-488f-a9e0-dc51694d4b1b\",\n\n\"Version\": 1,\n\n\"SchemaVersion\": 1,\n\n\"RuleSource\": \"Cylance\",\n\n\"ObjectType\": \"DetectionRule\",\n\n\"Severity\": \"High\",\n\n\"TBM\": \"High\",\n\n\n-----\n\nProduct : { Name : CylanceOPTICS },\n\"Plugin\": {\"Name\": \"OpticsDetector\"},\n\"OperatingSystems\": [{\"Name\": \"Windows\"}],\n\"PostCompletionActions\": [\"GenerateDetectionEvent\"],\n\"AlertVolume\": \"TBD\",\n\"MaximumConcurrentActivations\": 10,\n\"ActivationLifetimeLimit\": \"00:10:00\",\n\"ActivationCanUtilizeDeviceStateEvents\": false,\n\"AllowMultipleActivationsPerContext\": true,\n\"States\": [\n{\n\"Name\": \"domainRequest\",\n\"Scope\": \"Global\",\n\"Function\": \"(a)\",\n\"FieldOperators\": {\n\"a\": {\n\"Type\": \"ContainsAny\",\n\"OperandType\": \"String\",\n\"Options\": {\"IgnoreCase\": true},\n\"Operands\": [\n{\n\"source\": \"TargetDnsRequest\",\n\"data\": \"Responses/A/1/QuestionName\"\n},\n{\n\"source\": \"LiteralSet\",\n\"data\": [\n\"3cx\",\n\"akamaicontainer\",\n\"akamaitechcloudservices\",\n\"azuredeploystore\",\n\"azureonlinecloud\",\n\"azureonlinestorage\",\n\"dunamistrd\",\n\"glcloudservice\",\n\"journalide\",\n\"msedgepackageinfo\",\n\"msstorageazure\",\n\"msstorageboxes\",\n\"officeaddons\",\n\"officestoragebox\",\n\"pbxcloudeservices\",\n\"pbxphonenetwork\",\n\"pbxsources\",\n\"qwepoi123098\",\n\"sbmsa\",\n\"sourceslabs\",\n\"visualstudiofactory\",\n\"zacharryblogs\"\n]\n}\n]\n\n\n-----\n\n}\n},\n\"ActivationTimeLimit\": \"-0:00:00.001\",\n\"Actions\": [\n{\n\"Type\": \"AOI\",\n\"ItemName\": \"InstigatingProcess\",\n\"Position\": \"PostActivation\"\n},\n{\n\"Type\": \"AOI\",\n\"ItemName\": \"TargetDnsRequest\",\n\"Position\": \"PostActivation\"\n},\n{\n\"Type\": \"AOI\",\n\"ItemName\": \"TargetNetworkConnection\",\n\"Position\": \"PostActivation\"\n}\n],\n\"HarvestContributingEvent\": true,\n\"Filters\": [\n{\n\"Type\": \"Event\",\n\"Data\": {\n\"Category\": \"Network\",\n\"SubCategory\": \"DNS\",\n\"Type\": \"Request\"\n}\n}\n]\n}\n]\n}\n\n**Query to detect generic request to C2s used in the 3CX attack on macOS**\n\n{\n\"Name\": \"macOS 3CX DNS Request\",\n\n\"Description\": \"Detects when a dns request is made to known 3CX domains.\",\n\n\"Id\": \"a2ca3af8-778d-4a6e-ac05-400ee2bf2ae6\",\n\n\"Version\": 1,\n\n\"SchemaVersion\": 1,\n\n\"RuleSource\": \"Cylance\",\n\n\"ObjectType\": \"DetectionRule\",\n\n\"Severity\": \"High\",\n\n\"TBM\": \"High\",\n\n\"Product\": {\"Name\": \"CylanceOPTICS\"},\n\n\"Plugin\": {\"Name\": \"OpticsDetector\"},\n\n\"OperatingSystems\": [{\"Name\": \"macOS\"}],\n\n\n-----\n\nPostCompletionActions : [ GenerateDetectionEvent ],\n\"AlertVolume\": \"TBD\",\n\"MaximumConcurrentActivations\": 10,\n\"ActivationLifetimeLimit\": \"00:10:00\",\n\"ActivationCanUtilizeDeviceStateEvents\": false,\n\"AllowMultipleActivationsPerContext\": true,\n\"States\": [\n{\n\"Name\": \"domainRequest\",\n\"Scope\": \"Global\",\n\"Function\": \"(a)\",\n\"FieldOperators\": {\n\"a\": {\n\"Type\": \"ContainsAny\",\n\"OperandType\": \"String\",\n\"Options\": {\"IgnoreCase\": true},\n\"Operands\": [\n{\n\"source\": \"TargetDnsRequest\",\n\"data\": \"Responses/A/1/QuestionName\"\n},\n{\n\"source\": \"LiteralSet\",\n\"data\": [\n\"3cx\",\n\"akamaicontainer\",\n\"akamaitechcloudservices\",\n\"azuredeploystore\",\n\"azureonlinecloud\",\n\"azureonlinestorage\",\n\"dunamistrd\",\n\"glcloudservice\",\n\"journalide\",\n\"msedgepackageinfo\",\n\"msstorageazure\",\n\"msstorageboxes\",\n\"officeaddons\",\n\"officestoragebox\",\n\"pbxcloudeservices\",\n\"pbxphonenetwork\",\n\"pbxsources\",\n\"qwepoi123098\",\n\"sbmsa\",\n\"sourceslabs\",\n\"visualstudiofactory\",\n\"zacharryblogs\"\n]\n}\n]\n}\n},\n\"ActivationTimeLimit\": \"-0:00:00.001\",\n\n\n-----\n\nActions : [\n{\n\"Type\": \"AOI\",\n\"ItemName\": \"InstigatingProcess\",\n\"Position\": \"PostActivation\"\n},\n{\n\"Type\": \"AOI\",\n\"ItemName\": \"TargetDnsRequest\",\n\"Position\": \"PostActivation\"\n},\n{\n\"Type\": \"AOI\",\n\"ItemName\": \"TargetNetworkConnection\",\n\"Position\": \"PostActivation\"\n}\n],\n\"HarvestContributingEvent\": true,\n\"Filters\": [\n{\n\"Type\": \"Event\",\n\"Data\": {\n\"Category\": \"Network\",\n\"SubCategory\": \"DNS\",\n\"Type\": \"Request\"\n}\n}\n]\n}\n]\n}\n\n**Related Reading**\n\n## About The BlackBerry Research & Intelligence Team\n\n\n-----\n\nThe BlackBerry Research & Intelligence team examines emerging and persistent threats,\nproviding intelligence analysis for the benefit of defenders and the organizations they serve.\n\nBack\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2023/2023-03-31 - Initial Implants and Network Analysis Suggest the 3CX Supply Chain Operation Goes Back to Fall 2022.pdf"
    ],
    "report_names": [
        "2023-03-31 - Initial Implants and Network Analysis Suggest the 3CX Supply Chain Operation Goes Back to Fall 2022.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1683338913,
    "ts_updated_at": 1743041118,
    "ts_creation_date": 1683251103,
    "ts_modification_date": 1683251103,
    "files": {
        "pdf": "https://archive.orkl.eu/c581a929576a0a270e866c210054f6033e07f2fc.pdf",
        "text": "https://archive.orkl.eu/c581a929576a0a270e866c210054f6033e07f2fc.txt",
        "img": "https://archive.orkl.eu/c581a929576a0a270e866c210054f6033e07f2fc.jpg"
    }
}