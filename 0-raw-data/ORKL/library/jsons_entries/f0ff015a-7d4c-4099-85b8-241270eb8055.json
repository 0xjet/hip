{
    "id": "f0ff015a-7d4c-4099-85b8-241270eb8055",
    "created_at": "2023-01-12T15:03:59.409552Z",
    "updated_at": "2025-03-27T02:05:20.427205Z",
    "deleted_at": null,
    "sha1_hash": "8c1ce736170f974298a074038f97b4c6c237e698",
    "title": "2020-09-10 - Who is calling- CDRThief targets Linux VoIP softswitches",
    "authors": "",
    "file_creation_date": "2022-05-27T22:36:08Z",
    "file_modification_date": "2022-05-27T22:36:08Z",
    "file_size": 698589,
    "plain_text": "# Who is calling? CDRThief targets Linux VoIP softswitches\n\n**[welivesecurity.com/2020/09/10/who-callin-cdrthief-linux-voip-softswitches/](https://www.welivesecurity.com/2020/09/10/who-callin-cdrthief-linux-voip-softswitches/)**\n\nSeptember 10, 2020\n\nESET researchers have discovered and analyzed malware that targets Voice over IP (VoIP)\nsoftswitches\n\n[Anton Cherepanov](https://www.welivesecurity.com/author/acherepanov/)\n10 Sep 2020 - 11:30AM\n\nESET researchers have discovered and analyzed malware that targets Voice over IP (VoIP)\nsoftswitches\n\nThis new malware that we have discovered and named CDRThief is designed to target a very specific\nVoIP platform, used by two China-produced softswitches (software switches): Linknat VOS2009 and\nVOS3000. A softswitch is a core element of a VoIP network that provides call control, billing, and\nmanagement. These softswitches are software-based solutions that run on standard Linux servers.\n\n\n-----\n\nThe primary goal of the malware is to exfiltrate various private data from a compromised softswitch,\n[including call detail records (CDR). CDRs contain metadata about VoIP calls such as caller and callee](https://en.wikipedia.org/wiki/Call_detail_record)\nIP addresses, starting time of the call, call duration, calling fee, etc.\n\nTo steal this metadata, the malware queries internal MySQL databases used by the softswitch. Thus,\nattackers demonstrate a good understanding of the internal architecture of the targeted platform.\n\n## Linux/CDRThief analysis\n\nWe noticed this malware in one of our sample sharing feeds, and as entirely new Linux malware is a\nrarity, it caught our attention. What was even more interesting was that it quickly became apparent that\nthis malware targeted a specific Linux VoIP platform. Its ELF binary was produced by the Go compiler\nwith the debug symbols left unmodified, which is always helpful for the analysis.\n\nTo hide malicious functionality from basic static analysis, the authors encrypted all suspicious-looking\n[strings with XXTEA and the key fhu84ygf8643, and then base64 encoded them. Figure 1 shows some](https://github.com/xxtea/xxtea-go)\nof the code the malware uses to decrypt these strings at runtime.\n\n\n-----\n\n_Figure 1. The routine used to decrypt the binary’s strings_\n\nTo access internal data stored in the MySQL database, the malware reads credentials from Linknat\nVOS2009 and VOS3000 configuration files that it attempts to locate in the following paths:\n\n/usr/kunshi/vos2009/server/etc/server_db_config.xml\n/usr/kunshi/vos3000/server/etc/server_db_config.xml\n/home/kunshi/vos2009/server/etc/server_db_config.xml\n/home/kunshi/vos3000/server/etc/server_db_config.xml\n/home/kunshi/vos2009/etc/server_db_config.xml\n/home/kunshi/vos3000/etc/server_db_config.xml\n/usr/kunshi/vos2009/server/etc/serverdbconfig.xml\n/usr/kunshi/vos3000/server/etc/serverdbconfig.xml\n\n\n-----\n\nInterestingly, the password from the configuration file is stored encrypted. However, Linux/CDRThief\nmalware is still able to read and decrypt it. Thus, the attackers demonstrate deep knowledge of the\ntargeted platform, since the algorithm and encryption keys used are not documented as far as we can\ntell. It means that the attackers had to reverse engineer platform binaries or otherwise obtain\ninformation about the AES encryption algorithm and key used in the Linknat code.\n\nAs seen in Figure 2, CDRThief communicates with C&C servers using JSON over HTTP.\n\n_Figure 2. Captured network communication of the Linux/CDRThief malware_\n\nThere are multiple functions in Linux/CDRThief’s code used for communication with C&C servers.\nTable 1 contains the original names of these functions used by the malware authors.\n\n_Table 1. Functions used for communication with C&C_\n\n\n-----\n\n**Function name** **C&C path** **Purpose**\n\nmain.pingNet /dataswop/a Checks if C&C is\nalive\n\nmain.getToken /dataswop/API/b Obtains token\n\nmain.heartbeat /dataswop/API/gojvxs Main C&C loop,\ncalled every three\nminutes\n\nmain.baseInfo /dataswop/API/gojvxs Exfiltrates basic\ninformation about\ncompromised\nLinknat system:\n\n-    MAC address\n\n-    cat /proc/version\n\n-    whoami\n\n-    cat /etc/redhat-release\n\n-    UUID from\n/bin/ibus_10.mo (or /\nhome/kunshi/base/ibus_10.mo )\n\nmain.upVersion /dataswop/Download/updateGoGoGoGoGo Updates itself to\nthe latest version\n\nmain.pushLog /dataswop/API/gojvxs Uploads malware\nerror log\n\nmain.load /dataswop/API/gojvxs Exfiltrates various\ninformation about\nthe platform:\n\n-    SELECT\nSUM(TABLE_ROWS) FROM\ninformation_schema.TABLES\nWHERE table_name LIKE\n'e_cdr_%'\n\n-    cat /etc/motd\n\n-    username, encrypted\npassword, IP address of the\ndatabase\n\n-    ACCESS_UUID from\nserver.conf\n\n-    VOS software version\n\nmain.syslogCall /dataswop/API/gojvxs Exfiltrates data\nfrom e_syslog\ntables\n\n\n-----\n\n**Function name** **C&C path** **Purpose**\n\nmain.gatewaymapping /dataswop/API/gojvxs Exfiltrates data\nfrom\ne_gatewaymapping\ntables\n\nmain.cdr /dataswop/API/gojvxs Exfiltrates data\nfrom e_cdr tables\n\nIn order to exfiltrate data from the platform, Linux/CDRThief executes SQL queries directly to the\nMySQL database. Mainly, the malware is interested in three tables:\n\ne_syslog – contains log of system events\ne_gatewaymapping – contains information about VoIP gateways (see Figure 3)\ne_cdr – contains call data records (metadata of calls)\n\n_Figure 3. Disassembled code of the function that initializes an SQL query_\n\n\n-----\n\nData to be exfiltrated from the e_syslog, e_gatewaymapping, and e_cdr tables is compressed and then\nencrypted with a hardcoded RSA-1024 public key before exfiltration. Thus, only the malware authors\nor operators can decrypt the exfiltrated data.\n\nBased on the described functionality, we can say that the malware’s primary focus is on collecting data\nfrom the database. Unlike other backdoors, Linux/CDRThief does not have support for shell command\nexecution or exfiltrating specific files from the compromised softswitch’s disk. However, these functions\ncould be introduced in an updated version.\n\nThe malware can be deployed to any location on the disk under any file name. It’s unknown what type\nof persistence is used for starting the malicious binary at each boot. However, it should be noted that\nonce the malware is started, it attempts to launch a legitimate binary present on the Linknat\nVOS2009/VOS3000 platform using the following command:\n\nexec -a ‘/home/kunshi/callservice/bin/callservice -r /home/kunshi/.run/callservice.pid’\n\nThis suggests that the malicious binary might somehow be inserted into a regular boot chain of the\nplatform in order to achieve persistence and possibly masquerading as a component of the Linknat\nsoftswitch software.\n\nAt the time of writing we do not know how the malware is deployed onto compromised devices. We\nspeculate that attackers might obtain access to the device using a brute-force attack or by exploiting a\nvulnerability. Such vulnerabilities in VOS2009/VOS3000 have been reported publicly in the past.\n\n## Conclusion\n\nWe analyzed Linux/CDRThief malware, which has a unique purpose to target specific VoIP\nsoftswitches. We rarely see VoIP softswitches targeted by threat actors; this makes the\nLinux/CDRThief malware interesting.\n\nIt’s hard to know the ultimate goal of attackers who use this malware. However, since this malware\nexfiltrates sensitive information, including call metadata, it seems reasonable to assume that the\nmalware is used for cyberespionage. Another possible goal for attackers using this malware is VoIP\nfraud. Since the attackers obtain information about activity of VoIP softswitches and their gateways,\n[this information could be used to perform International Revenue Share Fraud (IRSF).](https://www.zdnet.com/article/phone-fraudsters-are-stealing-billions-each-year-through-a-scheme-known-as-irsf/)\n\n_For any inquiries, or to make sample submissions related to the subject, contact us at_\n_threatintel@eset.com._\n\n## Indicators of Compromise\n\n### ESET detection name\n\nLinux/CDRThief.A\n\n### File based mutexes\n\n/dev/shm/.bin\n\n/dev/shm/.linux\n\n\n-----\n\n### Files created during malware update\n\n/dev/shm/callservice\n\n/dev/shm/sys.png\n\n### Hashes\n\nCC373D633A16817F7D21372C56955923C9DDA825\n\n8E2624DA4D209ABD3364D90F7BC08230F84510DB (UPX packed)\n\nFC7CCABB239AD6FD22472E5B7BB6A5773B7A3DAC\n\n8532E858EB24AE38632091D2D790A1299B7BBC87 (Corrupted)\n\n82F51F098B85995C966135E9E7F63D1D8DC97589 (UPX packed)\n\n### C&C\n\nhttp://119.29.173[.]65\n\nhttp://129.211.157[.]244\n\nhttp://129.226.134[.]180\n\nhttp://150.109.79[.]136\n\nhttp://34.94.199[.]142\n\nhttp://35.236.173[.]187\n\nhttp://update[.]callercore[.]com\n\n### Exfiltration encryption key (RSA)\n\n—–BEGIN PUBLIC KEY—–\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCQ3k3GgS3FX4pI7s9x0krBYqbMcSaw4BPY91Ln\ntt5/X8s9l0BC6PUTbQcUzs6PPXhKKTx8ph5CYQqdWynxOLJah0FMMRYxS8d0HX+Qx9eWUeKRHm2E\nAtZQjdHxqTJ9EBpHYWV4RrWmeoOsWAOisvedlb23O0E55e8rrGGrZLhPbwIDAQAB\n\n—–END PUBLIC KEY—–\n\n## MITRE ATT&CK techniques\n\n[Note: This table was built using version 7 of the MITRE ATT&CK framework.](https://attack.mitre.org/versions/)\n\n**Tactic** **ID** **Name** **Description**\n\n\nDefense\nEvasion\n\n\nT1027 Obfuscated Files or\nInformation\n\n\nT1027.002 Obfuscated Files or\nInformation: Software\nPacking\n\n\nSome Linux/CDRThief\nsamples are packed\nwith UPX.\n\n\nCredential\nAccess\n\n\nT1552.001 Unsecured Credentials:\nCredentials In Files\n\n\nLinux/CDRThief contains\nobfuscates strings in the payload.\n\nLinux/CDRThief reads credentials\nfor MySQL database from a\nconfiguration file.\n\nLinux/CDRThief obtains detailed\ninformation about the compromised\ncomputer.\n\n\nDiscovery T1082 System Information\nDiscovery\n\n\n-----\n\n**Tactic** **ID** **Name** **Description**\n\n\nCollection T1560.003 Archive Collected Data:\nArchive via Custom\nMethod\n\n\nLinux/CDRThief compresses stolen\ndata with gzip before exfiltration.\n\nLinux/CDRThief uses HTTP for\ncommunication with C&C server.\n\nLinux/CDRThief exfiltrates data to\nthe C&C server.\n\n\nCommand\nand\nControl\n\n\nT1071.001 Application Layer\nProtocol: Web\nProtocols\n\n\nExfiltration T1041 Exfiltration Over C2\nChannel\n\n10 Sep 2020 - 11:30AM\n\n\n### Sign up to receive an email update whenever a new article is published in our Ukraine Crisis – Digital Security Resource Center\n\n Newsletter\n\n Discussion\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-09-10 - Who is calling- CDRThief targets Linux VoIP softswitches.pdf"
    ],
    "report_names": [
        "2020-09-10 - Who is calling- CDRThief targets Linux VoIP softswitches.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535839,
    "ts_updated_at": 1743041120,
    "ts_creation_date": 1653690968,
    "ts_modification_date": 1653690968,
    "files": {
        "pdf": "https://archive.orkl.eu/8c1ce736170f974298a074038f97b4c6c237e698.pdf",
        "text": "https://archive.orkl.eu/8c1ce736170f974298a074038f97b4c6c237e698.txt",
        "img": "https://archive.orkl.eu/8c1ce736170f974298a074038f97b4c6c237e698.jpg"
    }
}