{
    "id": "cb23e826-8232-4f12-b721-e02494eb5528",
    "created_at": "2023-04-05T02:09:44.993615Z",
    "updated_at": "2025-03-27T02:05:30.780686Z",
    "deleted_at": null,
    "sha1_hash": "6f4f80ccc9ee88f19048153e9bd81660c5fd818a",
    "title": "2023-03-28 - LimeRAT Malware Analysis- Extracting the Config",
    "authors": "",
    "file_creation_date": "2023-04-03T08:58:55Z",
    "file_modification_date": "2023-04-03T08:58:55Z",
    "file_size": 506431,
    "plain_text": "# LimeRAT Malware Analysis: Extracting the Config\n\n**any.run/cybersecurity-blog/limerat-malware-analysis/**\n\nhardee March 28, 2023\n\n[HomeMalware Analysis](https://any.run/cybersecurity-blog/)\nLimeRAT Malware Analysis: Extracting the Config\nIn today’s article, we’re going to look under the hood of a modular RAT — LimeRAT. Let’s get right into it!\n\n## What is LimeRat\n\nLimeRAT is a Remote Access Trojan (RAT) that’s been around for a few years now. It’s a versatile piece of malware designed to give\nattackers control over an infected system. With its relatively small file size, it tries to fly under the radar of traditional antivirus solutions.\n\n\nLimeRAT malware\n\n\nWhat makes LimeRAT particularly interesting is its ability to perform a wide range of malicious activities. Some of these include keylogging,\nstealing passwords, and capturing screenshots. Additionally, LimeRAT can execute arbitrary commands, download and upload files, and\neven use the infected machine for crypto-mining or DDoS attacks.\n\n## LimeRAT malware analysis\n\nTo start, let’s open a sample in Detect It Easy:\n\n\n-----\n\nFigure 1: sample\n\noverview in DiE\nUpon inspection, we observe that the code has been obfuscated (MITRE T1027) and unreadable: the names of classes, methods, and\nvariables are made out of random glyphs.\n\nSince the sample is written in a .NET language, let’s open it in DnSpy.\n\nFigure 2: sample overview in DnSpy; note that use of obfuscation techniques\n\n## Finding the configuration\n\nAfter examining the malware’s classes, we find something resembling a class with its configuration:\n\n\n-----\n\nFigure 3: possibly, malware configuration class\nWe notice that this class contains a field that appears to be a string encoded using the Base64 algorithm (MITRE T1132.001):\n\nFigure\n\n4: strange class field that looks like Base64 encoded string\nWe attempted to decode this string using CyberChef, but were unsuccessful. It is likely that the string is not only encoded but also encrypted.\n\n\n-----\n\nUnsuccessful attempt to decode LimeRAT string with CyberChef\n\n\nFigure 5: even though it seems that this string is Base64 encoded, we can’t obtain data by just decoding it\nLooks like the string is encoded and encrypted. Therefore, we will attempt to analyze this string and identify any functions or instructions that\nreference it. To do this, we right-click on the field and select “Analyse” from the context menu (alternatively, we can select the field and use\nthe Ctrl + Shift + R shortcut).\n\nIn the resulting window, we are interested in where the value of this string is being read. We expand the “Read by” section and see that the\nstring is being read in two methods:\n\nFigure 5: two x-refs to the string\n\nthat we discovered\n\n\n-----\n\nWe briefly inspect the first method but don t see anything interesting here. It appears that this method is not specifically related to the virus\nconfiguration:\n\nFigure\n\n6: the first method seems useless\nLet’s move on to the second method. We immediately notice some interesting code where our string is being used with the method\n[WebClient.DownloadString, which is used to download a string from a remote resource.](https://learn.microsoft.com/en-us/dotnet/api/system.net.webclient.downloadstring)\n\nFigure 7: the second x-ref is more interesting – looks like it uses our string in WebClient.DownloadString method\nBefore our string is passed to WebClient.DownloadString is passed through another method that clearly transforms it into something that\nDownloadString can consume.\n\nLet’s take a closer look at this method and see what it does to our string\n\n\n-----\n\nAfter a quick evaluation of the method, we see that it uses instances of the RijndaelManaged and MD5CryptoServiceProvider classes.\n\nIt appears that we have found the function where our string is decrypted:\n\nFigure 8: it seems that we found a method responsible for string decryption\n\n## LimeRAT decryption algorithm\n\nLet’s break down how the decryption algorithm works in more detail:\n\n1. Instances of the RijndaelManaged and MD5CryptoServiceProvider classes are created. If we search for the RijndaelManaged class\n\non MSDN, we see that it is essentially an obsolete implementation of the AES encryption algorithm (MITRE T1027). The\nMD5CryptoServiceProvider class, as the name implies, is used to compute an MD5 hash.\n\n1. An array of 32 bytes is created and initialized with zeros. This array will be used to store the AES key.\n\n1. To generate the key, the MD5 hash of another string from the configuration class is first computed (in our case, the string is\n\n“20[.]199.13.167”).\n\nFigure 9: another string from the configuration class is used to generate the AES key\n\n1. Next, the first 15 bytes and then the first 16 bytes of the computed hash are copied to the previously created array. The last element of\n\nthe array remains zero.\n\n1. The generated key is set to the key property of the RijndaelManaged instance. The Mode property is set to CipherMode.ECB.\n\n1. Finally, the original string is decoded using the Base64 algorithm and decrypted using the AES256-ECB algorithm.\n\nLet’s try to replicate this algorithm in CyberChef to confirm our findings. We will need 2 CyberChef tabs, one where we’ll use MD5 to generate\nthe AES key, and another where we’ll attempt to decrypt the data.\n\nGenerating the key:\n\n\n-----\n\nGenerating the LimeRAT key\n\n\nDecrypting the data:\n\nFigures 9, 10: we got the idea of the decryption algorithm right, as we were able to reproduce it in CyberChef\nAfter decrypting the string, we see a link to a PasteBin note: https://pastebin[.]com/raw/sxNJt2ek. When we navigate to the link, we see the\nC2 address of the malware.\n\n\n-----\n\nLimeRATs C2 using data that we decrypted\n\n\nFigure 10: we found LimeRATs C2 using data that we decrypted\n\n## Wrapping Up\n\nIn this article, we successfully analyzed LimeRAT and uncovered its configuration. We identified the use of the .NET language and examined\nthe malware classes, which revealed that obfuscation had been implemented. By meticulously inspecting these classes, we determined the\ndecryption algorithm employed to decode the string containing the C2 address.\n\n## IOCs\n\n### Analyzed files:\n\nSHA1 14836dd608efb4a0c552a4f370e5aafb340e2a5d\n\nSHA256 6d08ed6acac230f41d9d6fe2a26245eeaf08c84bc7a66fddc764d82d6786d334\n\nMD5 d36f15bef276fd447e91af6ee9e38b28\n\nSSDEEP 3072:DDiv2GSyn88sH888wQ2wmVgMk/211h36vEcIyNTY4WZd/w1UwIwEoTqPMinXHx+i:XOayy\n\n### IPv4:\n\n**IOC** **Description**\n\n20[.]199.13.167:8080 LimeRAT’s C2 server\n\n### Domains:\n\n**IOC** **Description**\n\nhttps://pastebin[.]com/raw/sxNJt2ek PasteBin used by LimeRAT to hide its original C2 server\n\n### MITRE (ARMATTACK):\n\n**Tactic** **Technique** **Description**\n\n\nTA0005: Defense\nEvasion\n\nTA0005: Defense\nEvasion\n\nTA0005: Defense\nEvasion\n\n\nT1027: Obfuscated Files or\nInformation\n\nT1027: Obfuscated Files or\nInformation\n\nT1027: Obfuscated Files or\nInformation\n\n\nMalware is using obfuscator to strip its method names, class names,\netc.\n\nMalware uses Base64 algorithm to encode and decode data\n\nMalware uses AES algorithm to encrypt and decrypt data\n\n\n-----\n\n[Although effective, this manual process can be time consuming. This is where interactive sandboxes, such as ANY.RUN, prove to be](https://any.run/?utm_source=anyrunblog&utm_medium=article&utm_campaign=limerat&utm_content=landing)\ninvaluable.\n\nANY.RUN offers a powerful and user-friendly platform for automating malware sample analysis. By enabling users to safely execute malware\nwithin a secure environment, ANY.RUN efficiently extracts configurations for malware like LimeRAT, ultimately saving security researchers\nprecious time and resources.\n\n[Let us show you how our interactive sandbox can fit into your workflow — book a demo with our friendly sales team.](https://any.run/demo/?utm_source=anyrunblog&utm_medium=article&utm_campaign=limerat&utm_content=demo)\n\nInterested in more content like this?\n\n[Read our analysis of Formbook/XLoader](https://any.run/cybersecurity-blog/xloader-formbook-encryption-analysis-and-malware-decryption/)\n[Learn how we used a sandbox to analyze CryptBot](https://any.run/cybersecurity-blog/cryptbot-infostealer-malware-analysis/)\n[Or check out our deep dive into Orcus Rat](https://any.run/cybersecurity-blog/orcus-rat-malware-analysis/)\n\nReverse\nEngineer. Malware\nAnalyst at ANY.RUN\n\n\nhardee\n\nI contribute to open source from time to time and I am always up for a challenge.\n\n[malware](https://any.run/cybersecurity-blog/tag/malware/) [malware analysis](https://any.run/cybersecurity-blog/tag/malware-analysis/)\n\nUser avatar\nhardee\nReverse Engineer, Malware Analyst at ANY.RUN\nI contribute to open source from time to time and I am always up for a challenge.\nWhat do you think about this post?\n\n9 answers\n\nAwful\nAverage\nGreat\n\nNo votes so far! Be the first to rate this post.\n\n0 comments\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2023/2023-03-28 - LimeRAT Malware Analysis- Extracting the Config.pdf"
    ],
    "report_names": [
        "2023-03-28 - LimeRAT Malware Analysis- Extracting the Config.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1680660584,
    "ts_updated_at": 1743041130,
    "ts_creation_date": 1680512335,
    "ts_modification_date": 1680512335,
    "files": {
        "pdf": "https://archive.orkl.eu/6f4f80ccc9ee88f19048153e9bd81660c5fd818a.pdf",
        "text": "https://archive.orkl.eu/6f4f80ccc9ee88f19048153e9bd81660c5fd818a.txt",
        "img": "https://archive.orkl.eu/6f4f80ccc9ee88f19048153e9bd81660c5fd818a.jpg"
    }
}