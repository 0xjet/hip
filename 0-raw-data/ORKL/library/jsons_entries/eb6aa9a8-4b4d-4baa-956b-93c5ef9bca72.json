{
    "id": "eb6aa9a8-4b4d-4baa-956b-93c5ef9bca72",
    "created_at": "2023-01-12T15:00:03.491819Z",
    "updated_at": "2025-03-27T02:05:40.999287Z",
    "deleted_at": null,
    "sha1_hash": "be5d00f679eb19dacc3a119efec4ffc0b2d48698",
    "title": "2019-09-19 - Fileless Cryptocurrency-Miner GhostMiner Weaponizes WMI Objects, Kills Other Cryptocurrency-Mining Payloads",
    "authors": "",
    "file_creation_date": "2022-05-28T17:29:44Z",
    "file_modification_date": "2022-05-28T17:29:44Z",
    "file_size": 174054,
    "plain_text": "# GhostMiner Weaponizes WMI, Kills Other Mining Payloads\n\n**[blog.trendmicro.com/trendlabs-security-intelligence/fileless-cryptocurrency-miner-ghostminer-weaponizes-wmi-objects-kills-other-cryptocurrency-mining-payloads/](https://blog.trendmicro.com/trendlabs-security-intelligence/fileless-cryptocurrency-miner-ghostminer-weaponizes-wmi-objects-kills-other-cryptocurrency-mining-payloads/)**\n\nSeptember 19, 2019\n\n[Cybercriminals continue to use cryptocurrency-mining malware to abuse computing resources for profit. As early as 2017, we have also](https://blog.trendmicro.com/trendlabs-security-intelligence/cryptocurrency-miner-uses-wmi-eternalblue-spread-filelessly/)\nobserved how they have applied fileless techniques to make detection and monitoring more difficult.\n\nOn August 2, we observed a fileless cryptocurrency-mining malware, dubbed GhostMiner, that weaponizes Windows management\ninstrumentation (WMI) objects for its fileless persistence, payload mechanisms, and AV-evasion capabilities. This GhostMiner variant was also\n[observed to modify infected host files that are heavily used by MyKings,](https://blog.trendmicro.com/en_us/research/19/h/uncovering-a-mykings-variant-with-bootloader-persistence-via-managed-detection-and-response.html) [PowerGhost,](https://www.trendmicro.com/vinfo/tmr/?/us/security/news/cybercrime-and-digital-threats/fileless-malware-powerghost-targets-corporate-systems) [PCASTLE, and](https://blog.trendmicro.com/en_us/research/19/f/monero-mining-malware-pcastle-zeroes-back-in-on-china-now-uses-multilayered-fileless-arrival-techniques.html) [BULEHERO, among others.](https://www.trendmicro.com/vinfo/tmr/?/us/threat-encyclopedia/malware/trojan.win32.blueroh.rpb)\n\nThis malware was observed mining Monero cryptocurrency, however, the arrival details of this variant has not been identified as of writing. An\n[earlier documented sighting of GhostMiner was noted to have used multiple vulnerabilities in MSSQL, phpMyAdmin, and Oracle’s WebLogic to](https://blog.minerva-labs.com/ghostminer-cryptomining-malware-goes-fileless)\nlook for and attack susceptible servers.\n\n## GhostMiner Details\n\nGhostMiner uses [WMI Event Subscriptions to install persistence in an infected machine as well as execute arbitrary code.](https://attack.mitre.org/techniques/T1084/)\n\n**Event Filter \\\\.\\ROOT\\subscription:__EventFilter.Name=\"PowerShell Event Log Filter\" EventNamespace : root\\cimv2 Query : SELECT ***\nFROM __InstanceModificationEvent WITHIN 3600 WHERE TargetInstance ISA 'Win32_PerfFormattedData_PerfOS_System'\n_QueryLanguage : WQL_\n\n**FilterToConsumerBinding**\n\\\\.\\ROOT\\subscription:__FilterToConsumerBinding.Consumer=\"CommandLineEventConsumer.Name=\\PowerShell Event Log\nConsumer\\\"\"\",Filter=\"\"__EventFilter.Name=\\\"PowerShell Event Log Filter\\\"\"\" Consumer :\nCommandLineEventConsumer.Name=\"\"PowerShell Event Log Consumer\"\" Filter : __EventFilter.Name=\"\"PowerShell Event Log Filter\"\"\n**Event Consumer \\\\.\\ROOT\\subscription:CommandLineEventConsumer.Name=\"\"PowerShell Event Log Consumer\"\"**\n_CommandLineTemplate : C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\PowerShell.eXe -NoP -NonI -EP ByPass -W Hidden -E_\n<Base-64 encoded script>\n\nGhostMiner will also install a WMI class named “PowerShell_Command” at the root\\Default namespace. This WMI class contains the entries\n**Command and CCBot that contains base-64 encoded functions.**\n\nWhen the EventConsumer is triggered, it will read entries from Command and CCBot from the installed WMI “PowerShell_Command”\nobject.\n\nThe Command script, when executed, will do the following:\n\n**Functions** **Task**\n\nWMI_KillFake Terminates processes and deletes corresponding files based on a list of conditions\n\nWMI_KillService Terminates services based on a set of conditions\n\nWMI_Scanner Terminates processes of known cryptominers in the process memory\n\nWMI_CheckFile Verifies the integrity of the file it drops\n\nT bl 1 Li t f f ti th C d i t f t d\n\n\n-----\n\ns de o t e abo e e t o ed u ct o s, t e Co a d sc pt a so as a **_** **e** u ct o, c te ates u g p ocesses, a d\ndeletes scheduled tasks and services that are associated with cryptocurrency-mining malware families such as:\n\n1. MyKings\n2. PowerGhost\n3. PCASTLE\n4. BULEHERO\n5. Other generic MALXMR variants used by malware families, including BlackSquid\n\n[Figure 1. List of service names that WMI_Killer terminates and deletes](https://blog.trendmicro.com/content/dam/trendmicro/global/en/research/19/i/fileless-cryptocurrency-miner-ghostminer-weaponizes-wmi-objects-kills-other-cryptocurrency-mining-payloads/fileless-cryptocurrency-miner-ghostminer-figure-1.png)\n\nFigure 1. List of service names that WMI_Killer terminates and deletes\n\n[Figure 2. List of scheduled tasks that WMI_Killer deletes](https://blog.trendmicro.com/content/dam/trendmicro/global/en/research/19/i/fileless-cryptocurrency-miner-ghostminer-weaponizes-wmi-objects-kills-other-cryptocurrency-mining-payloads/fileless-cryptocurrency-miner-ghostminer-figure-2.png)\n\nFigure 2. List of scheduled tasks that WMI_Killer deletes\n\n[Figure 3. List of cryptocurrency-mining-related processes that the the WMI_Killer terminate](https://blog.trendmicro.com/content/dam/trendmicro/global/en/research/19/i/fileless-cryptocurrency-miner-ghostminer-weaponizes-wmi-objects-kills-other-cryptocurrency-mining-payloads/fileless-cryptocurrency-miner-ghostminer-figure-3.png)\n\nFigure 3. List of cryptocurrency-mining-related processes that the the WMI_Killer terminates\n\n**WMI_Killer also terminates TCP traffic that uses a list of cryptocurrency-mining malware’s commonly used ports**\n\n[Figure 4. List of ports that the WMI_Killer monitor](https://blog.trendmicro.com/content/dam/trendmicro/global/en/research/19/i/fileless-cryptocurrency-miner-ghostminer-weaponizes-wmi-objects-kills-other-cryptocurrency-mining-payloads/fileless-cryptocurrency-miner-ghostminer-figure-4.png)\n\nFigure 4. List of ports that the WMI_Killer monitors\n\nAnother Command script function, the WMI_CheckHosts, is able to modify the host files of the infected machine and modifies entries that are\nrelated to malicious malware such as BULEHERO..\n\nFigure 5. WMI_CheckHosts function that modifies the infected machine’s hosts files based on the mapped entries that are related to its\ncompetition\n\nMeanwhile, the CCBOT entry uses two IP addresses, namely 118[.]24[.]63[.]208 and 103[.]105[.]59[.]68, as C&C servers. It uses Base-64 to\nencode the send command and ROT-13, a letter substitution cipher that changes the 13th letter after it, to decode the received command.\n\nWe observed that the backdoor communication is only enabled between 12AM to 5AM. It uses an invoke-expression (IEX) when the C&C\nserver receives a response. Otherwise, it will continuously try to connect to the abovementioned IP addresses every 30 seconds using the\n**“/Update/CC/CC.php” URI path.**\n\nAside from Command and CCBot, The “PowerShell_Command” class also contains the following objects:\n\n**Miner : <Base-64 encoded binary code>**\n\n**Ver : <Version Number> (The current version is v2.13.0)**\n\n**mPId : <Process ID of the running cryptocurrency-miner>**\n\n**nPId : <Process ID of the installer>**\n\nThe miner is a 64-bit payload that is dropped when Command is decoded and executed. However, before it gets dropped, GhostMiner\ndetermines the free disk space on the root drive. If the free space is less than 1 GB, it will drop a 10 MB-sized payload. Otherwise, it will drop a\n100 MB-sized payload. GhostMiner will then append 2,130 bytes of random value. The file will then be saved as\n**C:\\Windows\\Temp\\lsass.exe.**\n\nThe malware will then execute the following commands as part of the miner’s execution routine:\n\n_Takeown.exe /f C:\\Windows\\Temp_\n\n_iCACLs.exe C:\\Windows\\Temp /Reset /T /C_\n\n_iCACLs.exe C:\\Windows\\Temp /Grant Everyone:F /T /C_\n\n_iCACLs.exe C:\\Windows\\Temp\\lsass.exe /E /G Everyone:F /C_\n\n_NetSH Firewall Add AllowedProgram C:\\Windows\\Temp\\lsass.exe “Windows Update”_\n\n_Start-Process –FilePath C:\\Windows\\Temp\\lsass.exe –WindowStyle Hidden –PassThru_\n\nAs of writing time, the XMR wallet associated with this campaign only has 50.278384965000 XMR (US$3,868.02) in total paid value.\n\n\n-----\n\ne d c o eep sco e y specto p otects custo e s o t eats t at ay ead to C&C co ect o a d data e t at o a t s u e\n\n4219: GHOSTMINER - HTTP (Request)\n\n**Indicators of Compromise (IoCs)**\n\n\n**SHA-256** **Trend Micro Predictive Machine**\n**Learning Detection**\n\n\n**Trend Micro Pattern D**\n\n\n13a4751b83e53abdf0fb6d5876d6cc9dfbd33e343038dae6951de755d93c8284\n\n558914713cf3174c8b489aef12a1a7871ad886bc9483fd7b0790383702bfd75d\n\n7cec25bdb7c3cb2778168e9b02e0fdd608a6c94cb69feba7b4ee647aef0588b1\n\n8ffa7f991637e28fa5b4ae7f5522fe5fee622307bed87d1d478c48fa0696dc5a\n\n\nTroj.Win32.TRX.XXPE50FFF031 Coinminer.Win64.MAL\n\n\na0e0e5d0ff95e3193ed0999234588e3327ea8d759316a0d1175c5084daf5b083 Coinminer.Win64.MALXMR.TIAOODC\n\naa16c957a85ecedaac9f629082913dfdaefe95b8b8191d7cb3e8c02da2963452\nCoinminer.Win64.MALXMR.TIAOODBZ\n\nCyber Threats\n\nWe observed a fileless cryptocurrency-mining malware, dubbed GhostMiner, that weaponizes Windows management instrumentation (WMI)\nobjects for its fileless persistence, payload mechanisms, and AV-evasion capabilities.\n\nBy: Carl Maverick Pascual September 19, 2019 Read time: ( words)\n\nContent added to Folio\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-09-19 - Fileless Cryptocurrency-Miner GhostMiner Weaponizes WMI Objects, Kills Other Cryptocurrency-Mining Payloads.pdf"
    ],
    "report_names": [
        "2019-09-19 - Fileless Cryptocurrency-Miner GhostMiner Weaponizes WMI Objects, Kills Other Cryptocurrency-Mining Payloads.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535603,
    "ts_updated_at": 1743041140,
    "ts_creation_date": 1653758984,
    "ts_modification_date": 1653758984,
    "files": {
        "pdf": "https://archive.orkl.eu/be5d00f679eb19dacc3a119efec4ffc0b2d48698.pdf",
        "text": "https://archive.orkl.eu/be5d00f679eb19dacc3a119efec4ffc0b2d48698.txt",
        "img": "https://archive.orkl.eu/be5d00f679eb19dacc3a119efec4ffc0b2d48698.jpg"
    }
}