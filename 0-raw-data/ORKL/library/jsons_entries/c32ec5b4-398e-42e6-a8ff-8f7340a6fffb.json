{
    "id": "c32ec5b4-398e-42e6-a8ff-8f7340a6fffb",
    "created_at": "2023-01-12T15:07:15.157998Z",
    "updated_at": "2025-03-27T02:10:49.383148Z",
    "deleted_at": null,
    "sha1_hash": "22eea260c61ce419112890e7fc23fc98f3a04ba2",
    "title": "2021-11-03 - Credit card skimmer evades Virtual Machines",
    "authors": "",
    "file_creation_date": "2022-05-28T19:22:56Z",
    "file_modification_date": "2022-05-28T19:22:56Z",
    "file_size": 595635,
    "plain_text": "# Credit card skimmer evades Virtual Machines\n\n**[blog.malwarebytes.com/threat-intelligence/2021/11/credit-card-skimmer-evades-virtual-machines/](https://blog.malwarebytes.com/threat-intelligence/2021/11/credit-card-skimmer-evades-virtual-machines/)**\n\nThreat Intelligence Team November 3, 2021\n\n_This blog post was authored by Jérôme Segura_\n\nThere are many techniques threat actors use to slow down analysis or, even better, evade\ndetection. Perhaps the most popular method is to detect virtual machines commonly used by\nsecurity researchers and sandboxing solutions.\n\nReverse engineers are accustomed to encountering code snippets that check certain registry\nkeys, looking for specific values indicating the presence of VMware or Virtual Box, two of the\nmost popular pieces of virtualization software. Many malware families incorporate these antivm features, usually as a first layer.\n\nFor web threats, it is more rare to see detection of virtual machines via the browser. Typically\nthreat actors are content with filtering targets based on geolocation and user-agent strings.\nBut that feature does exist in modern browsers and can be quite effective.\n\n\n-----\n\nIn this blog post we show how a Magecart threat actor distributing a digital skimmer is\navoiding researchers and possibly sandboxes by ensuring users are running genuine\ncomputers and not virtual ones.\n\n## Virtual Machine detection\n\nOur investigation started by looking at a newly reported domain that could possibly be\nrelated to Magecart. Suspicious JavaScript is being loaded alongside an image of payment\nmethods. Note that browsing directly to the URL will return a decoy Angular library.\n\nThere is one interesting function within this skimmer script that uses the WebGL JavaScript\nAPI to gather information about the user’s machine. We can see that it identifies the graphics\nrenderer and returns its name.\n\nFor many Virtual Machines, the graphics card driver will be a software renderer fallback from\nthe hardware (GPU) renderer. Alternatively, it could be supported by the virtualization\nsoftware but still leak its name.\n\n\n-----\n\nWe notice that the skimmer is checking for the presence of the words swiftshader, llvmpipe\n[and virtualbox. Google Chrome uses SwiftShader while Firefox relies on llvmpipe as its](https://github.com/google/swiftshader)\nrenderer fallback.\n\nBy performing this in-browser check, the threat actor can exclude researchers and\nsandboxes and only allow real victims to be targeted by the skimmer.\n\n## Data exfiltration\n\nIf the machine passes the check, the personal data exfiltration process can take place\nnormally. The skimmer scrapes a number of fields including the customer’s name, address,\nemail and phone number as well as their credit card data.\n\n\n-----\n\nIt also collects any password (many online stores allow customers to register an account),\nthe browser’s user-agent and a unique user ID. The data is then encoded and exfiltrated to\nthe same host via a single POST request:\n\n\n-----\n\n## Evasion and defenders\n\nThis is not surprising to see such evasion techniques being adopted by criminals, however it\nshows that as we get better at detecting and reporting attacks, threat actors also evolve their\ncode eventually. This is a natural trade-off that we must expect.\n\nIn addition to code obfuscation, anti-debugger tricks and now anti-vm checks, defenders will\nhave to spend more time to identify and protect against those attacks or at least come up\nwith effective countermeasures.\n\nMalwarebytes users are protected against this campaign:\n\n\n-----\n\n## Indicators of Compromise (IOCs)\n\n[Skimmer code](https://github.com/MBThreatIntel/skimmers/blob/master/anti-vm_skimmer_raw.txt)\n[Skimmer code beautified](https://github.com/MBThreatIntel/skimmers/blob/master/anti-vm_skimmer_beautified.txt)\n\n\n-----\n\n```\ncdn[.]megalixe[.]org\ncon[.]digital-speed[.]net\napis[.]murdoog[.]org\nstatic[.]opendwin[.]com\ncss[.]tevidon[.]com\nmantisadnetwork[.]org\nstatic[.]mantisadnetwork[.]org\nstage[.]sleefnote[.]com\njs[.]speed-metrics[.]com\ntroadster[.]com\nnypi[.]dc-storm[.]org\nweb[.]webflows[.]net\njs[.]librarysetr[.]com\nlibrarysetr[.]com\nopendwin[.]com\napp[.]rolfinder[.]com\nlibsconnect[.]net\nartesfut[.]com\njs[.]artesfut[.]com\njs[.]rawgit[.]net\njs[.]demo-metrics[.]net\ndemo-metrics[.]net\ndev[.]crisconnect[.]net\nm[.]brands-watch[.]com\ngraph[.]cloud-chart[.]net\nhal-data[.]org\nstage[.]libsconnect[.]net\napp[.]iofrontcloud[.]com\niofrontcloud[.]com\nalligaturetrack[.]com\nwebflows[.]net\nweb[.]webflows[.]net\ntag[.]listrakbi[.]biz\napi[.]abtasty[.]net\ncloud-chart[.]net\ngraph[.]cloud-chart[.]net\ncdn[.]getambassador[.]net\nclimpstatic[.]com\nstst[.]climpstatic[.]com\nmarklibs[.]com\nst[.]adsrvr[.]biz\ncdn[.]cookieslaw[.]org\nclickcease[.]biz\n89.108.127[.]254\n89.108.127[.]16\n82.202.161[.]77\n89.108.116[.]123\n82.202.160[.]9\n89.108.116[.]48\n89.108.123[.]28\n89.108.109[.]167\n89.108.110[.]208\n50.63.202[.]56\n212.109.222[.]225\n82.202.160[.]8\n\n```\n\n-----\n\n```\n82.202.160[.]137\n192.64.119[.]156\n89.108.109[.]169\n82.202.160[.]10\n82.202.160[.]54\n82.146.50[.]89\n82.202.160[.]123\n82.202.160[.]119\n194.67.71[.]75\n77.246.157[.]133\n82.146.51[.]242\n89.108.127[.]57\n82.202.160[.]8\n185.63.188[.]84\n89.108.123[.]168\n77.246.157[.]133\n185.63.188[.]85\n82.146.51[.]202\n185.63.188[.]59\n89.108.123[.]169\n185.63.188[.]71\n89.108.127[.]16\n82.202.161[.]77\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-11-03 - Credit card skimmer evades Virtual Machines.pdf"
    ],
    "report_names": [
        "2021-11-03 - Credit card skimmer evades Virtual Machines.pdf"
    ],
    "threat_actors": [
        {
            "id": "1dadf04e-d725-426f-9f6c-08c5be7da159",
            "created_at": "2022-10-25T15:50:23.624538Z",
            "updated_at": "2025-03-27T02:00:55.508759Z",
            "deleted_at": null,
            "main_name": "Darkhotel",
            "aliases": [
                "Darkhotel",
                "DUBNIUM",
                "Zigzag Hail"
            ],
            "source_name": "MITRE:Darkhotel",
            "tools": null,
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "5a0483f5-09b3-4673-bb5a-56d41eaf91ed",
            "created_at": "2023-01-06T13:46:38.814104Z",
            "updated_at": "2025-03-27T02:00:02.925972Z",
            "deleted_at": null,
            "main_name": "MageCart",
            "aliases": [],
            "source_name": "MISPGALAXY:MageCart",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "2b4eec94-7672-4bee-acb2-b857d0d26d12",
            "created_at": "2023-01-06T13:46:38.272109Z",
            "updated_at": "2025-03-27T02:00:02.790029Z",
            "deleted_at": null,
            "main_name": "DarkHotel",
            "aliases": [
                "DUBNIUM",
                "Fallout Team",
                "Luder",
                "Tapaoux",
                "Shadow Crane",
                "APT-C-06",
                "SIG25",
                "Karba",
                "Nemim",
                "Nemin",
                "G0012",
                "ATK52",
                "T-APT-02",
                "TUNGSTEN BRIDGE",
                "Zigzag Hail"
            ],
            "source_name": "MISPGALAXY:DarkHotel",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "c0cedde3-5a9b-430f-9b77-e6568307205e",
            "created_at": "2022-10-25T16:07:23.528994Z",
            "updated_at": "2025-03-27T02:02:09.847683Z",
            "deleted_at": null,
            "main_name": "DarkHotel",
            "aliases": [
                "APT-C-06",
                "ATK 52",
                "CTG-1948",
                "Dubnium",
                "Fallout Team",
                "Higaisa",
                "Luder",
                "Operation DarkHotel",
                "Operation Daybreak",
                "Operation Inexsmar",
                "Operation PowerFall",
                "Operation The Gh0st Remains the Same",
                "SIG25",
                "Shadow Crane",
                "T-APT-02",
                "Tungsten Bridge",
                "Zigzag Hail"
            ],
            "source_name": "ETDA:DarkHotel",
            "tools": [
                "Asruex",
                "DarkHotel",
                "DmaUp3.exe",
                "GreezeBackdoor",
                "Karba",
                "Nemain",
                "Nemim",
                "Ramsay",
                "Retro",
                "Tapaoux",
                "Trojan.Win32.Karba.e",
                "Virus.Win32.Pioneer.dx",
                "igfxext.exe",
                "msieckc.exe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536035,
    "ts_updated_at": 1743041449,
    "ts_creation_date": 1653765776,
    "ts_modification_date": 1653765776,
    "files": {
        "pdf": "https://archive.orkl.eu/22eea260c61ce419112890e7fc23fc98f3a04ba2.pdf",
        "text": "https://archive.orkl.eu/22eea260c61ce419112890e7fc23fc98f3a04ba2.txt",
        "img": "https://archive.orkl.eu/22eea260c61ce419112890e7fc23fc98f3a04ba2.jpg"
    }
}