{
    "id": "4bb6b67c-b86a-482a-b72a-19c067bff1c4",
    "created_at": "2023-01-12T15:00:22.310633Z",
    "updated_at": "2025-03-27T02:17:05.677073Z",
    "deleted_at": null,
    "sha1_hash": "cb88c9822c1aec7eb6325d21d846ca9a11174925",
    "title": "2022-06-24 - Deep Analysis of Snake Keylogger",
    "authors": "",
    "file_creation_date": "2022-07-18T18:04:48Z",
    "file_modification_date": "2022-07-18T18:04:48Z",
    "file_size": 5519740,
    "plain_text": "# Deep Analysis of Snake Keylogger\n\n**x-junior.github.io/malware analysis/2022/06/24/Snakekeylogger.html**\n\n### Mohamed Ashraf\n\nMalware Analysis & Reverse Engineering & Cryptography\n\n15 minute read\n\n## Introduction\n\n\nJune 24, 2022\n\n\nSnake Keylogger is a malware developed using .NET. It’s focused on stealing sensitive information from a victim’s device, including saved\ncredentials, the victim’s keystrokes, screenshots of the victim’s screen, and clipboard data.\n\nThe malware usually is delivered by malicious doc and the malware comes packed, so let’s start unpacking.\n\n## Unpacking\n\n Stage1\n\nLet’s first check the resources, it’s always a good place to look .\n\nTheir are 2 suspicious resources `Rara3 and` `ResourceFallbackMana, so the malware might use them for next stages of unpacking.`\n\n\n-----\n\nChecking the entry point, there is a constructor called `Home`\n```\nHome constructor has function that initialize its component called IntializeComponent\n\n```\nscrolling to the end of it, a function call `nnn is called which call` `sss which call` `SponsorState, this function retrieve a resource call`\n```\nRara3 and loops through its bytes and decrypt it by calling DismatleCode, the decrypted resource is a DLL.\n\n```\n\n-----\n\nThen the malware invokes `MRMWrapperDictionary.memory..cctor() method from the loaded DLL.`\n\n## Stage 2\n\n\n-----\n\nThe DLL name is MLan and it’s obfuscated, so i decided to go with the flow, until i found the function `AnsiChar that decrypt the next stage.`\n\n1. Load a resource called `ResourceFallbackMana Which is CurrentA value` `5265736F7572636546616C6C6261636B4D616E61 but in hex.`\n2. Decrypt the resource .\n3. Invoke targeted method which is `UeAupokA536JGhxDyO.sW3Asla2NyvByhVDAa.JSwk4uviT2()`\n\n## Stage 3\n\nThe DLL IVectorView is heavily obfuscated even more than the previous stage and since it’s not our main payload i won’t bother renaming the\nfunctions.\n\nI will leave the functions names to make it easy for anyone who is going to try to unpack this sample.\n\nImportant Functions executed :\n\nGet path to the sample.\n```\nahGXTXMe7uAdQ8NrjfG.lk5MbtJFe(uK4AJrYGvvq1w2WkdOi.lk5MbtJFe(uK4AJrYGvvq1w2WkdOi.W1QYvJs3HW),\nahGXTXMe7uAdQ8NrjfG.A3vYOBZp64)\n\n```\nSleep for 4 seconds .\n```\ntSUHMWMAIim5ETkhruf.lk5MbtJFe(tPjaFIYeEJC8ehJovOA.lk5MbtJFe(sW3Asla2NyvByhVDAa.w2n8tHiqWL[35],\ntPjaFIYeEJC8ehJovOA.gMSY7bPola) * 1000, tSUHMWMAIim5ETkhruf.guWM0HK2GW)\n\n```\nGet Roaming folder path.\n```\ndoGHn4M3qsgWjpC57JN.lk5MbtJFe(sW3Asla2NyvByhVDAa.OMepjHU8u0PQqAcfgBt(Environment.SpecialFolder.ApplicationData),\nMtylF5MN0ZB1XUnlinq.lk5MbtJFe(4212, MtylF5MN0ZB1XUnlinq.cqxM4wlCTi), doGHn4M3qsgWjpC57JN.t77MmT7Umi)\n\n```\nAppend `jwoHTfo.exe to the path .`\n```\npsokcXYESiVIocWutWY.lk5MbtJFe(text3, sW3Asla2NyvByhVDAa.Bis8Nfj2u5, MtylF5MN0ZB1XUnlinq.lk5MbtJFe(4218,\nMtylF5MN0ZB1XUnlinq.cqxM4wlCTi), psokcXYESiVIocWutWY.PnTYcVPfsh)\n\n```\nCopy itself to C:\\Users\\UserName\\AppData\\Roaming .\n```\nLp9PmLMkZmvU1wvfDHu.lk5MbtJFe(text, text2, Lp9PmLMkZmvU1wvfDHu.TMGYWc0mXg)\n\n```\n\nExclude the path of the newly copied sample, write XML to tmp file, create scheduled task for persistence.\n```\nLp9PmLMkZmvU1wvfDHu.lk5MbtJFe(sW3Asla2NyvByhVDAa.Bis8Nfj2u5, text2, Lp9PmLMkZmvU1wvfDHu.AjQYS6EhjD)\n\n```\n\n-----\n\noad at u t e t at co ta s o y esou ce data\n```\nUeAupokA536JGhxDyO.ohMtKo8nMu0hWQpbYo2.XYtPy3Anye()\n\n```\n\nLoad a resource from the loaded DLL.\n```\nUeAupokA536JGhxDyO.MH1pvtk8kqaCIqEAbCh.n0BjAw3y3a()\n\n```\n\nDecrypt the resource to get our main payload.\n```\nIHeoJKYkPinpHknFH9q.lk5MbtJFe(yAWG7ZYlZIPfRxSYSsw.lk5MbtJFe(sW3Asla2NyvByhVDAa.CTs8UfsbAO,\nyAWG7ZYlZIPfRxSYSsw.v2CYiSRjI0), sW3Asla2NyvByhVDAa.j3J8Ic57Tf, IHeoJKYkPinpHknFH9q.UC8Yj8UgDU)\n\n```\nSpawn our main payload using process Hollowing .\n```\nUeAupokA536JGhxDyO.sW3Asla2NyvByhVDAa.Fgxk5Jy1sG()\n\n```\n\nExit .\n\n### Persistence\n\nThe following command is executed that disables Windows Defender scheduled and real-time scanning for files in this folder.\n```\nC:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\" Add-MpPreference -ExclusionPath\nC:\\Users\\UserName\\AppData\\Roaming\\jwoHTfo.exe\n\n```\nThe following command is executed to create a scheduled task:\n```\n\"C:\\Windows\\System32\\schtasks.exe\" /Create /TN \"Updates\\jwoHTfo\" /XML\n\"C:\\Users\\UserName\\AppData\\Local\\Temp\\tmp2BD2.tmp\"\n\n```\n\n-----\n\nThe tmp file has the following XML :\n\n\n-----\n\n```\n<Task version=\\\"1.2\\\" xmlns=\\\"http://schemas.microsoft.com/windows/2004/02/mit/task\\\"> \n\n  <RegistrationInfo>\n\n  <Date>2014-10-25T14:27:44.8929027</Date>\n\n  <Author>UserName</Author>\n\n  </RegistrationInfo>\n\n  <Triggers>\n\n    <LogonTrigger> <!-- Represents a trigger that starts a task when a user logs on -->\n\n      <Enabled>true</Enabled>\n\n      <UserId>UserName</UserId>    \n\n    </LogonTrigger>  \n\n    <RegistrationTrigger> <!-- Represents a trigger that starts a task when the task is registered or updated -->  \n\n      <Enabled>false</Enabled> \n\n    </RegistrationTrigger> \n\n  </Triggers>\n\n  <Principals>\n\n    <!--Specifies the security contexts that can be used to run the task.--> \n\n    <Principal id=\\\"Author\\\">\n\n<!-- Specifies the security credentials for a principal. These credentials define the security context that a task runs under.-->\n\n      <UserId>UserName</UserId>\n\n      <LogonType>InteractiveToken</LogonType>\n\n      <!-- User must already be logged on. The task will be run only in an existing interactive session.-->\n\n      <RunLevel>LeastPrivilege</RunLevel>\n\n    </Principal> \n\n  </Principals> \n\n  <Settings> \n\n    <MultipleInstancesPolicy>StopExisting</MultipleInstancesPolicy>\n\n    <!-- Starts a new instance while an existing instance is running. -->\n\n    <DisallowStartIfOnBatteries>false</DisallowStartIfOnBatteries>\n\n    <!--Specifies that the task will not be started if the computer is running on battery power.-->\n\n    <StopIfGoingOnBatteries>true</StopIfGoingOnBatteries>\n\n    <!--Specifies that the task will be stopped if the computer switches to battery power.--> \n\n    <AllowHardTerminate>false</AllowHardTerminate>\n\n    <!--Specifies if the Task Scheduler service allows hard termination of the task.-->\n\n    <StartWhenAvailable>true</StartWhenAvailable>\n\n    <!--Specifies that the Task Scheduler can start the task at any time after its scheduled time has passed.-->  \n\n    <RunOnlyIfNetworkAvailable>false</RunOnlyIfNetworkAvailable>\n\n    <!--Specifies that the Task Scheduler will run the task only when a network is available.--> \n\n    <IdleSettings>\n\n      <!--Specifies how the Task Scheduler performs tasks when the computer is in an idle state.-->\n\n      <StopOnIdleEnd>true</StopOnIdleEnd>   \n\n      <RestartOnIdle>false</RestartOnIdle> \n\n    </IdleSettings>  \n\n    <AllowStartOnDemand>true</AllowStartOnDemand>\n\n    <!--Specifies that the task can be started by using either the Run command or the Context menu.--> \n\n    <Enabled>true</Enabled> \n\n    <!--Specifies that the task is enabled. The task can be performed only when this setting is True. -->\n\n    <Hidden>false</Hidden>\n\n    <!--Specifies, by default, that the task will not be visible in the user interface (UI).-->\n\n    <RunOnlyIfIdle>false</RunOnlyIfIdle>\n\n    <!--Specifies that the task is run only when the computer is in an idle state.-->  \n\n    <WakeToRun>false</WakeToRun>\n\n    <!--Specifies that Task Scheduler will wake the computer before it runs the task.-->  \n\n    <ExecutionTimeLimit>PT0S</ExecutionTimeLimit>\n\n    <!-- 20 Days --> <!--Specifies the amount of time allowed to complete the task.-->\n\n    <Priority>7</Priority>\n    <!-- BELOW_NORMAL_PRIORITY_CLASS THREAD_PRIORITY_BELOW_NORMAL-->\n\n  </Settings>\n\n  <Actions Context=\\\"Author\\\"><!-- Execute the packed sample -->\n\n    <Exec>  \n\n      <Command>\n\n        C:\\\\Users\\\\UserName\\\\AppData\\\\Roaming\\\\jwoHTfo.exe\n\n      </Command>  \n\n    </Exec>\n\n  </Actions>\n\n</Task>\n\n### Load DLL at runtime\n\n```\nFor the last stage of unpacking the malware uses a local callback function `XYtPy3Anye that is registered to`\nAppDomain.CurrentDomain.ResourceResolve, which is then called when it fails to load a resource by name.\n\n\n-----\n\nThe malware reads a resource named `6XrMbvA from the current module, which has no such named resource in the resource directory. A`\nresource loading failure occurs and the registered local function is called `XYtPy3Anye to solve this error.`\n\nAnother DLL file appears in memory, decrypted from resource `wgESy1fvJpAjtLonUv.mtQ6crCqKVauvIWPi5 and then decompress. It`\ncontains a resource with the name `6XrMbvA, which is the original requested resource name.`\n\nThe payload of Snake Keylogger is encrypted in `6XrMbvA resource .`\n\nThe resource is decrypted in `UeAupokA536JGhxDyO.MH1pvtk8kqaCIqEAbCh.O9RjtGPl7D() method.`\n```\nIHeoJKYkPinpHknFH9q.lk5MbtJFe(yAWG7ZYlZIPfRxSYSsw.lk5MbtJFe(sW3Asla2NyvByhVDAa.CTs8UfsbAO,\nyAWG7ZYlZIPfRxSYSsw.v2CYiSRjI0), sW3Asla2NyvByhVDAa.j3J8Ic57Tf, IHeoJKYkPinpHknFH9q.UC8Yj8UgDU) all that happens under\n\n```\nthis method .\n\n\n-----\n\n### Process Hollowing\n\nThe program then creates a suspended child process and inject Snake Keylogger payload into the child process. It then resumes the child\nprocess to run. Then the parent process exits\n\nAll process hollowing functionality are under `UeAupokA536JGhxDyO.sW3Asla2NyvByhVDAa.Fgxk5Jy1sG() method.`\n\n\n-----\n\nC eate e p ocess\n```\nsW3Asla2NyvByhVDAa.t9k84Eca13(\\u0020, string.Empty, IntPtr.Zero, IntPtr.Zero, false, 134217732U, IntPtr.Zero,\nnull, ref q7wjRryksphgmH13gM, ref whaCmriILF5883Bt0r))\n\n```\nit calls API CreateProcess() to create the child process with Creation Flag 134217732U (0x8000004), which means\nCREATE_NO_WINDOW and CREATE_SUSPENDED.\n\nWrite process memory\n```\nBBDYpjYA3gIOGArn7ck.lk5MbtJFe()\n\n```\n\n-----\n\nSet eadCo te t\n```\nsW3Asla2NyvByhVDAa.j898gCWDUT(whaCmriILF5883Bt0r.Rs9GptxmvX, array2)\n\n```\n\nResume thread\n\n```\n   sW3Asla2NyvByhVDAa.RHI4KHUA4X2R7NW2kBr(sW3Asla2NyvByhVDAa.UTP8ZguGC0, whaCmriILF5883Bt0r.Rs9GptxmvX)\n\n## Malware Functionality\n\n```\nSnake Keylogger is obfuscated . let’s Use `de4dot to make it more readable.`\n\nAfter reversing and renaming .\n\n\n-----\n\nThe malware start initializing variables some of them are not used, the interesting part that the malware set a timer for some functions to\nexecute every 0.1 second.\n\nThese are the functions that executes periodically:\n\n1. Sending keylogs .\n2. Sending screenshot .\n3. Sending clipboard .\n4. Sending stolen data encrypted .\n5. Sending stolen data as plaintext .\n\n## KeyLogging\n\nIt calls API SetWindowsHookExA() to register a hook callback function `this.ProcessKey() to monitor low-level keyboard input events. The`\nfirst parameter is the hook type, where 13 indicates `WH_KEYBOARD_LL` .\n\nIt also records the foreground window title to identify where the victim types by calling the APIs `GetForegroundWindow() and`\n```\nGetWindowText() .\n\n```\nThe malware installs its own handler for keypress events on the keyboard. Logging is done as follows:\n\nBackspace, Delete, End, F1-F11 Not recorded\n\nF12 `[F12]`\n\nTAB `[tap]`\n\nENTER `[Entr]`\n\nSPACE `\" \"`\n\nOther key Uppercase or lowercase character depending on the position of the Shift and Caps Lock keys\n\n## Screenshot\n\n\n-----\n\nWhen a screenshot is taken, it is saved to `My Documents\\SnakeKeylogger folder with the name Screenshot.png. Then try to send the file.`\nAny result of the upload will delete the file.\n\nIt has a Timer which captures the victim’s screenshots from time to time by calling API `CopyFromScreen() .`\n\n## System Clipboard\n\nIt has two Timers. One timer to collect system clipboard data by calling `Clipboard.GetText() and save to a global variable. The other timer`\nis used to send clipboards data to the attacker.\n\n## Steal Credentials\n\nBefore stealing credentials, there are alot of methods that have empty body, it’ disabled features in this sample, i tried to get a sample that\nhave those functions enabled but had no luck .\n\nThese functions are anti-VM and persistence method, anti-emulation, Snake adds itself to autorun by changing the registry key:\n```\nHKCU\\software\\microsoft\\windows\\currentversion\\run, Snake kill certain processes and check for the presence of some of the virtual\n\n```\nmachines files, search for processes specific to virtual machines . it although removes cookies from Chrome and Firefox browsers, as well as\ndata from the general cookie repository in the system,so that the user has to re-login to accounts in this case, the data will be intercepted\nusing a keylogger .\n\nHow did i know that ?, while searching for samples to test my config extractor, i found a sample that have those functions named but still\nempty body, lucky me .\n\nI dont know why all that was disabled ! It would be nice to see those.\n\nBack to what we have in our sample .\n\nSnake kill chrome and firefox process if it’s running.\n\nSnake steals credentials from FTP clients, Email clients, Messengers, Browsers by static paths. It has four different methods to steal data\nfrom different types of browses, like Gecko-based browsers, Opera, Internet Explorer and Chromium-based browsers.\n\n**Application** **Folder/Registery**\n\nOutlook Software\\\\Microsoft\\\\Office\\\\15.0\\\\Outlook\\\\Profiles\\\\Outlook\\\\9375CFF0413111d3B88A00104B2A6676,\nSoftware\\\\Microsoft\\\\WindowsNT\\\\CurrentVersion\\\\WindowsMessagingSubsystem\\\\Profiles\\\\Outlook\\\\9375CFF0413111d3B\n‘Software\\\\Microsoft\\\\WindowsMessagingSubsystem\\\\Profiles\\\\9375CFF0413111d3B88A00104B2A6676,\nSoftware\\\\Microsoft\\\\Office\\\\16.0\\\\Outlook\\\\Profiles\\\\Outlook\\\\9375CFF0413111d3B88A00104B2A6676\n\nFoxMail SOFTWARE\\Classes\\Foxmail.url.mailto\\Shell\\open\\command\n\nTencent \\AppData\\Local\\Tencent\\QQBrowser\\UserData\\Default\\LoginData\n\n\n-----\n\n**Application** **Folder/Registery**\n\nThunderbird \\AppData\\Roaming\\Thunderbird\\Profiles|\n\nPostbox \\AppData\\RoamingPostboxApp\\Profiles\n\ndiscord \\AppData\\Local \\discord\\LocalStorage\\leveldb\\\n\nPidgin \\AppData\\Roaming\\.purple\\accounts.xml\n\nFileZilla \\AppData\\Roaming\\FileZilla\\recentservers.xml\n\nKinza \\AppData\\Local\\AppData\\Local \\Kinza\\UserData\\Default\\LoginData\n\nFalkon \\AppData\\Local \\Sputnik\\Sputnik\\UserData\\Default\\LoginData\n\nSputnik \\AppData\\Local\\Sputnik\\Sputnik\\UserData\\Default\\LoginData\n\nSalamWeb \\AppData\\Local\\SalamWeb\\UserData\\Default\\LoginData\n\nCoolNovo \\AppData\\Local\\MapleStudio\\ChromePlus\\UserData\\Default\\LoginData\n\nQIPSurf \\AppData\\Local \\QIPSurf\\UserData\\Default\\LoginData\n\nBlackHawk \\AppData\\Local \\BlackHawk\\UserData\\Default\\LoginData\n\n7Star \\AppData\\Local\\7Star\\7Star\\UserData\\Default\\LoginData\n\nFenrirInc \\AppData\\Local \\Sleipnir\\Sleipnir5\\setting\\modules\\ChromiumViewer\\Default\\LoginData\n\nCitrio \\AppData\\Local\\CatalinaGroup\\Citrio\\UserData\\Default\\LoginData\n\nChrome Canary \\AppData\\Local \\Google\\ChromeSxS\\UserData\\Default\\LoginData\n\nGoogle Chrome \\AppData\\Local \\Google\\Chrome\\UserData\\Default\\LoginData\n\nCoowon \\AppData\\Local\\Coowon\\Coowon\\UserData\\Default\\LoginData\n\nCocCoc \\AppData\\Local \\CocCoc\\Browser\\UserData\\Default\\LoginData\n\nUran \\AppData\\Local\\uCozMedia\\Uran\\UserData\\Default\\LoginData\n\nOrbitum \\AppData\\Local \\Orbitum\\UserData\\Default\\LoginData\n\nSlimjet \\AppData\\Local \\Slimjet\\UserData\\Default\\LoginData\n\nIridium \\AppData\\Local \\Iridium\\UserData\\Default\\LoginData\n\nVivaldi \\AppData\\Local \\Vivaldi\\UserData\\Default\\LoginData\n\nIron \\AppData\\Local \\Chromium\\UserData\\Default\\LoginData\n\n\nOther Chromium\nbased browsers\n\n\n\\AppData\\Local \\Chromium\\UserData\\Default\\LoginData\n\n\nGhost \\AppData\\Local \\GhostBrowser\\UserData\\Default\\LoginData\n\nCent \\AppData\\Local\\CentBrowser\\UserData\\Default\\LoginData\n\nXvast \\AppData\\Local \\Xvast\\UserData\\Default\\LoginData\n\nChedot \\AppData\\Local \\Chedot\\UserData\\Default\\LoginData\n\nSuperBird \\AppData\\Local \\SuperBird\\UserData\\Default\\LoginData\n\n360Browser \\AppData\\Local \\360Browser\\Browser\\UserData\\Default\\LoginData\n\n360Secure \\AppData\\Local \\360Chrome\\Chrome\\UserData\\Default\\LoginData\n\nComodo \\AppData\\Local \\Comodo\\Dragon\\UserData\\Default\\LoginData\n\nBraveSoftware \\AppData\\Local\\BraveSoftware\\Brave-Browser\\UserData\\Default\\LoginData\n\nTorch \\AppData\\Local \\Torch\\UserData\\Default\\LoginData\n\nUCBrowser \\AppData\\Local\\UCBrowser\\UserData_i18n\\Default\\UCLoginData.18\n\nBlisk \\AppData\\Local \\Blisk\\UserData\\Default\\LoginData\n\n\n-----\n\n**Application** **Folder/Registery**\n\nEpicPrivacyBrowser \\AppData\\Local\\EpicPrivacyBrowser\\UserData\\Default\\LoginData\n\nYandex \\AppData\\Local\\Yandex\\YandexBrowser\\UserData\\Default\\YaLoginData\n\nNichrome \\AppData\\Local \\Nichrome\\UserData\\Default\\LoginData\n\nAmigo \\AppData\\Local\\Amigo\\UserData\\Default\\LoginData\n\nKometa \\AppData\\Local \\Kometa\\UserData\\Default\\LoginData\n\nXpom \\AppData\\Local \\Xpom\\UserData\\Default\\LoginData\n\nElements \\AppData\\Local \\ElementsBrowser\\UserData\\Default\\LoginData\n\nMicrosoft edge \\AppData\\Local\\Microsoft\\Edge\\UserData\\Default\\LoginData\n\nelbatSarepO ataDnigoL\\elbatSarepO\\erawtfoSarepO\\\n\nelbatSarepO ataDnigoL\\elbatSarepO\\erawtfoSarepO\\\n\neliforp tad.dnaw\\eliforp\\arepO\\arepO\\\n\neliforp tad.dnaw\\eliforp\\arepO\\arepO\\\n\nLiebao7 \\AppData\\Local \\Liebao7\\UserData\\Default\\EncryptedStorage\n\nAVASTSoftware \\AppData\\Local\\AVASTSoftware\\Browser\\UserData\\Default\\LoginData\n\nMicrosoft \\AppData\\LocalSoftware\\Microsoft\\WindowsNT\\CurrentVersion\n\nicecat \\AppData\\Roaming\\Mozilla\\icecat\\Profiles\n\nSlim \\AppData\\Roaming\\FlashPeak\\SlimBrowser\\Profiles\n\nFirefox \\AppData\\Roaming\\Mozilla\\Firefox\\Profiles\n\nSeaMonkey \\AppData\\Roaming\\Mozilla\\SeaMonkey\\Profiles\n\nIceDragon \\AppData\\Roaming\\Comodo\\IceDragon\\Profiles\n\nCyberfox \\AppData\\Roaming\\8pecxstudios\\Cyberfox\\Profiles\n\nPale Moon \\AppData\\Roaming\\Moonchild Productions\\Pale Moon\\Profiles\n\nWaterfox \\AppData\\Roaming\\Waterfox\\Profiles\n\nOpera \\AppData\\Roaming\\Opera Software\\Opera Stable\\Login Data\n\nOpera \\AppData\\Roaming\\Opera\\Opera\\profile\\wand.dat\n\n## Stealing Mechanism\n\n1. Access the file that contains Credentials\n2. Parse the Credentials using SQL, have a whole class to handle SQL.\n3. Decrypt Passwords.\n4. Append to the global variable.\n\nMore details about stealing mechanism in my report about Mars stealer, it’s pretty much the same.\n\nSnake tries to load moazglue.dll and nss3.dll by checking if certain browsers is installed and try to load the DLLs from one of these paths.\n\n\n-----\n\n## C2 Communication\n\nIf `isProtected is initialized with` `ProtectTrue then all data will be encrypted before sending it.`\n\nDepending on the selected option in the configuration file, there are three options for interacting with the C2:\n\n### FTP\n\n\n-----\n\ne t a s e g a p otoco, a e t t e a e Co pute `a e` `ass o ds` `ot` `te s o` s c eated o t e\nhost.\n\nThe content of the file is `PW UserName Snake VictimInfo Passwords_Logs` .\n\nThe Bot ID is formed as follows: the first part is set in the configuration file, and the second part is a randomly generated 4-byte number.\n\n### SMTP\n\nA message of the following format will be generated:\n\nSubject: `Pc Name: Username Snake Keylogger`\n\nEmail body: `PW Username Snake`\n\nAttachment:\n\nPasswords.txt contains\n PW UserName Snake VictimInfo Passwords_Logs in `unicode`\n\nUser.txt same as Passwords.txt but in `ascii`\n\nVictimInfo contains `PC name, date and time, client IP, country name`\n\nAll data is sent as an attachment. It might be encrypted with DES or be plaintext .\n\n### Telegram\n\nThe data is transferred as an attached file.\nLog file attachments have the following format:\n\n\n-----\n\n```\ng\n\n```\n\nSame mechanism for sending:\n\n1. Keylogs:\n\nContent format : `KP UserName Snake VictimInfo KeyStrokes`\n\nFor FTP protocol :\n\nA file with the name `ComputerName - keystroke Logs ID - BotID FilExtension is created on the FTP host.`\n\n2. clipboard :\n\nContent format : `Clipboard UserName Snake VictimInfo GrabbedClipboard`\n\nFor FTP protocol :\n\nA file with the name `ComputerName - Clipboard Logs ID - BotID FilExtension is created on the FTP host.`\n\n3. Screenshot:\n\nContent format : `Screenshot UserName Snake VictimInfo ImageBytes`\n\nFor FTP protocol :\n\nA file with the name `ComputerName - Screenshot Logs ID - BotID .png` is created on the FTP host.\n\n## Static Config Extractor\n\n\n-----\n\n```\nimport os\n\nimport validators\n\nsys.path.append(os.path.dirname(__file__))\n\nclr.AddReference(\"System.Memory\")\n\nfrom System.Reflection import Assembly, MethodInfo, BindingFlags\n\nfrom System import Type\n\nDNLIB_PATH = r\"\"\n\nclr.AddReference(\"dnlib\")\n\nimport dnlib  \n\nfrom dnlib.DotNet import *\n\nfrom dnlib.DotNet.Emit import OpCodes\n\nSAMPLE_PATH = r''\n\nmodule = dnlib.DotNet.ModuleDefMD.Load(SAMPLE_PATH)\n\neFlags = BindingFlags.Static | BindingFlags.Public | BindingFlags.NonPublic\n\nHardcoded_String = []\n\ndef get_Hardcoded_String():\n\n  for mtype in module.GetTypes():\n\n    if not mtype.HasMethods:\n\n      continue\n\n    for method in mtype.Methods:\n\n      if not method.HasBody:\n\n        continue\n\n      if not method.Body.HasInstructions:\n\n        continue\n\n      for ptr in range(len(method.Body.Instructions)):\n\n        try:\n\n          if method.Body.Instructions[ptr].OpCode == OpCodes.Ldstr :\n\n            Hardcoded_String.append(method.Body.Instructions[ptr].ToString()[14:].replace('\"',\"\").replace(\"\n\",\"\").strip())\n\n        except :\n\n          continue\n\nget_Hardcoded_String()\n\n\nif \"CountryName:\" in Hardcoded_String:\n\n  config_offset = Hardcoded_String.index(\"CountryName:\") \n\n  for i in range(5):\n\n    SMTP_Host = \"\"\n\n    SMTP_Port = \"\"\n\n    SMTP_Email = \"\"\n\n    Tel_BOT = \"\"\n\n    FTP_Host = \"\"\n\n    if len(Hardcoded_String[config_offset + i + 9]) > 22 and Hardcoded_String[config_offset + i + 10].isdigit():\n\n      Tel_chaTID = Hardcoded_String[config_offset+ i + 10]\n      Tel_BOT = Hardcoded_String[config_offset + i + 9]\n\n    if ( validators.ipv4(Hardcoded_String[config_offset + i + 3]) or validators.domain(Hardcoded_String[config_offset + i + 3])\n) and Hardcoded_String[config_offset + i + 5].isdigit() and validators.email(Hardcoded_String[config_offset + i + 4]):\n\n        SMTP_Host = Hardcoded_String[config_offset + i + 3]\n\n        SMTP_Port = Hardcoded_String[config_offset + i + 5]\n\n        SMTP_Username = Hardcoded_String[config_offset + i + 1]\n\n        SMTP_Password = Hardcoded_String[config_offset + i + 2]\n\n        SMTP_Email = Hardcoded_String[config_offset + i + 4]\n\n    if \"ftp\" in Hardcoded_String[config_offset + i + 8] :\n\n      FTP_Host = Hardcoded_String[config_offset + i + 8]\n\n      FTP_Username = Hardcoded_String[config_offset + i + 6]\n\n      FTP_Password = Hardcoded_String[config_offset + i + 7]\n\n    if SMTP_Host != \"\" and SMTP_Port != \"\" and SMTP_Email!= \"\":\n\n      print(\"SMTP Host = \",SMTP_Host)\n\n      print(\"SMTP Port = \",SMTP_Port)\n\n      print(\"SMTP Username = \", SMTP_Username)\n\n      print(\"SMTP Password = \",SMTP_Password)\n\n      print(\"SMTP Email To = \",SMTP_Email)\n\n    if Tel_BOT != \"\":\n\n      Tel_C2 = \"https://api.telegram.org/bot\" +Tel_BOT+\"/sendMessage?chat_id=\"+Tel_chaTID\n\n        i (\" l \" l i ())\n\n```\n\n-----\n\n```\n    if FTP_Host != \"\":\n\n      print(\"FTP Host = \",FTP_Host)\n\n      print(\"FTP Port = \",21)\n\n      print(\"FTP Username = \",FTP_Username)\n\n      print(\"FTP Password = \",FTP_Password)\n\n## IOCs\n\n```\nHashes :\n\n1. 2022_Exportlist.pdf.exe aka TRACEPROVIDERINSTANCEI.exe aka jwoHTfo.exe\n\nMD5 : `96fe87fda1c50480609164fdfa7c56e1`\n\nSHA-1 : `548e2ae1da37cf3c58b1dc24b9020be915892412`\n\nSHA-256 : `605929594981dafbab968728e7a47ca70c6175e2b0c2394b1f6793145b338175`\n\nImphash : `f34d5f2d4577ed6d9ceec516c1f5a744`\n\nSSDEEP :\n\n```\n12288:xo9C8+jXbW9qT9q0VOf/1hCCy51Y325l4+2HyIQfEzT2Ovn8UT/e6R+Ha3VG/VRC:xolCXKOnk9/O1Yel4HH1U+qrce6R+6l7\n\n```\n\n2. MLang.dll aka lolno.dll\n\nMD5 : `ab47b292d4d39311539a0b97e6661f4f`\n\nSHA-1 : `54cd9efbebe4f41b23e6f24fffac0da8f72d921b`\n\nSHA-256 : `fe78017f2153de0c5ca645c4255899ab044502fe5c77d5c04ced635d9fe981d9`\n\nImphash : `dae02f32a21e03ce65412f6e56942daa`\n\nSSDEEP : `768:JacFZ4/H/ve5rv+jfs1j/3Lo1wndAYObbtDgbg6A0V5Xr1Kt9b:BCDI3LosObbtko8bAt9b`\n\n3. IVectorView.dll\n\nMD5 : `1f0d10c221bfe2cf55c71a36f960a94f`\n\nSHA-1 : `ccbce039ccd22c9adf2a3761dcd5dc2e1cfd9579`\n\nSHA-256 : `c555c0c042e85369b0aec6961a04cb5f33689f9a2d84bbb436793d8eabf9a641`\n\nImphash : `dae02f32a21e03ce65412f6e56942daa`\n\nSSDEEP : `12288:u4PeegK8DnyyBlfnCwWVazsNNw9vn0SNRiMcdxNF:59UlvJQosgfZbcdxNF`\n\n4. 96e46e73-3d6c-4438-a642-6355f4e5a32b.dll\n\nMD5 : `9685ca6802fcec12497c9de13e0828f7`\n\nSHA-1 : `07ff707126fe5ef9d81d930d1184c8acbca84447`\n\nSHA-256 : `900664051b305fa30b48392b7c3956c172d3b1b4248b0b1ba30a850010d4aeed`\n\nImphash : `dae02f32a21e03ce65412f6e56942daa`\n\nSSDEEP : `3072:BCfNUMO2WfOHSV897gRPLh5dHwRD+Y4eHxz8KHoCaN/ELEv5:6UqMuSVmi5mx3xz8pn/`\n\n5. YFGGCVyufgtwfyuTGFWTVFAUYVF.exe\n\nMD5 : `a90c091abded4a4f763de7537f569167`\n\nSHA-1 : `9394b05c2d518ee5d75fb030f2dca6d15c44bf0a`\n\nSHA-256 : `653b29296dcc50bfb59898d3ba38748b1c484701079ccc85f45bd2c0e4ecbe3e`\n\nImphash: `f34d5f2d4577ed6d9ceec516c1f5a744`\n\nSSDEEP : `3072:gFlAi/smc7Rkw3HTCnnnnnnnnnnnnnnnnnn9b8GOswBn7FbY8:crkIb4hbN`\n\n\n-----\n\nes\n\n1. C:\\Users\\UserName\\AppData\\Roaming\\jwoHTfo.exe\n\n2. C:\\Users\\UserName\\AppData\\Local\\Temp\\tmp(4bytes).tmp\n\nC2 Domain :\n\n```\n   https://api[.]telegram[.]org/bot5392870078:AAEZf0ajeo_PMkBddeC_JE--NP4u4367N6c/sendMessage?chat_id=1856108848\n\n## YARA Rule\n\nrule SnakeKeylogger :SnakeKeylogger {\n\n  meta:\n\n    author = \"X__Junior\"\n\n    description = \"Detects Snake Keylogger\"\n\n\n  strings:\n\n    $s1 = \"_KPPlogS\" fullword ascii\n\n    $s2 = \"_Scrlogtimerrr\" fullword ascii\n\n    $s3 = \"_Clpreptimerr\" fullword ascii\n\n    $s4 = \"_clprEPs\" fullword ascii\n\n    $s5 = \"_kLLTIm\" fullword ascii\n\n    $s6 = \"_TPSSends\" fullword ascii\n\n    $s7 = \"_ProHfutimer\" fullword ascii\n\n    $s8 = \"GrabbedClp\" fullword ascii\n\n    $s9 = \"StartKeylogger\" fullword ascii\n\n     $s10 = \"KPPlogS\" fullword ascii\n\n    $s11 = \"Scrlogtimerrr\" fullword ascii\n\n    $s12 = \"Clpreptimerr\" fullword ascii\n\n    $s13 = \"clprEPs\" fullword ascii\n\n    $s14 = \"kLLTIm\" fullword ascii\n\n    $s15 = \"TPSSends\" fullword ascii\n\n     $s16 = \"ProHfutimer\" fullword ascii\n\n    $x1 = \"$%SMTPDV$\" wide\n\n    $x2 = \"$#TheHashHere%&\" wide\n\n    $x3 = \"%FTPDV$\" wide\n\n    $x4 = \"$%TelegramDv$\" wide\n\n    $m1 = \"| Snake Keylogger\" ascii wide\n\n    $m2 = \"SnakePW\" ascii wide\n\n    $m3 = \"\\\\SnakeKeylogger\\\\\" ascii wide\n\n     $m4 = \"Snake\" ascii wide\n\n  condition:\n\n    (uint16(0) == 0x5a4d and (6 of ($s*) or 4 of ($x*) or 3 of ($m*)))\n\n}\n\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-06-24 - Deep Analysis of Snake Keylogger.pdf"
    ],
    "report_names": [
        "2022-06-24 - Deep Analysis of Snake Keylogger.pdf"
    ],
    "threat_actors": [
        {
            "id": "75455540-2f6e-467c-9225-8fe670e50c47",
            "created_at": "2022-10-25T16:07:23.740266Z",
            "updated_at": "2025-03-27T02:02:09.955585Z",
            "deleted_at": null,
            "main_name": "Iridium",
            "aliases": [],
            "source_name": "ETDA:Iridium",
            "tools": [
                "CHINACHOPPER",
                "China Chopper",
                "LazyCat",
                "Powerkatz",
                "SinoChopper",
                "reGeorg"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "0661a292-80f3-420b-9951-a50e03c831c0",
            "created_at": "2023-01-06T13:46:38.928796Z",
            "updated_at": "2025-03-27T02:00:02.953963Z",
            "deleted_at": null,
            "main_name": "IRIDIUM",
            "aliases": [],
            "source_name": "MISPGALAXY:IRIDIUM",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "9f101d9c-05ea-48b9-b6f1-168cd6d06d12",
            "created_at": "2023-01-06T13:46:39.396409Z",
            "updated_at": "2025-03-27T02:00:03.074969Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "CHROMIUM",
                "ControlX",
                "Red Dev 10",
                "RedHotel",
                "Red Scylla",
                "TAG-22",
                "BRONZE UNIVERSITY",
                "AQUATIC PANDA",
                "Charcoal Typhoon",
                "BountyGlad"
            ],
            "source_name": "MISPGALAXY:Earth Lusca",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "a66438a8-ebf6-4397-9ad5-ed07f93330aa",
            "created_at": "2022-10-25T16:47:55.919702Z",
            "updated_at": "2025-03-27T02:05:17.412024Z",
            "deleted_at": null,
            "main_name": "IRON VIKING",
            "aliases": [
                "ATK14 ",
                "BlackEnergy Group",
                "Blue Echidna ",
                "CTG-7263 ",
                "ELECTRUM ",
                "FROZENBARENTS ",
                "Hades/OlympicDestroyer ",
                "IRIDIUM ",
                "Qudedagh ",
                "Sandworm Team ",
                "Seashell Blizzard ",
                "TEMP.Noble ",
                "Telebots ",
                "Voodoo Bear ",
                "APT44 "
            ],
            "source_name": "Secureworks:IRON VIKING",
            "tools": [
                " BlackEnergy",
                " GCat",
                " GreyEnergy",
                " Industroyer",
                " KillDisk",
                " NotPetya",
                " PSCrypt",
                " TeleBot",
                " TeleDoor",
                " xData",
                "BadRabbit"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "b3e954e8-8bbb-46f3-84de-d6f12dc7e1a6",
            "created_at": "2022-10-25T15:50:23.339976Z",
            "updated_at": "2025-03-27T02:00:55.446795Z",
            "deleted_at": null,
            "main_name": "Sandworm Team",
            "aliases": [
                "Sandworm Team",
                "ELECTRUM",
                "Telebots",
                "IRON VIKING",
                "BlackEnergy (Group)",
                "Quedagh",
                "Voodoo Bear",
                "IRIDIUM",
                "Seashell Blizzard",
                "FROZENBARENTS",
                "APT44"
            ],
            "source_name": "MITRE:Sandworm Team",
            "tools": [
                "Bad Rabbit",
                "Mimikatz",
                "Exaramel for Linux",
                "Exaramel for Windows",
                "GreyEnergy",
                "PsExec",
                "Prestige",
                "P.A.S. Webshell",
                "VPNFilter",
                "Cyclops Blink",
                "SDelete",
                "AcidRain",
                "Industroyer",
                "Industroyer2",
                "BlackEnergy",
                "Cobalt Strike",
                "NotPetya",
                "KillDisk",
                "PoshC2",
                "Impacket",
                "Invoke-PSImage",
                "Olympic Destroyer"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "6abcc917-035c-4e9b-a53f-eaee636749c3",
            "created_at": "2022-10-25T16:07:23.565337Z",
            "updated_at": "2025-03-27T02:02:09.868522Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Bronze University",
                "Charcoal Typhoon",
                "Chromium",
                "Red Dev 10",
                "Red Scylla"
            ],
            "source_name": "ETDA:Earth Lusca",
            "tools": [
                "Agentemis",
                "AntSword",
                "BIOPASS",
                "BIOPASS RAT",
                "BadPotato",
                "Behinder",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "Doraemon",
                "FRP",
                "Fast Reverse Proxy",
                "FunnySwitch",
                "HUC Port Banner Scanner",
                "KTLVdoor",
                "Mimikatz",
                "NBTscan",
                "POISONPLUG.SHADOW",
                "PipeMon",
                "RbDoor",
                "RibDoor",
                "RouterGod",
                "SAMRID",
                "ShadowPad Winnti",
                "SprySOCKS",
                "WinRAR",
                "Winnti",
                "XShellGhost",
                "cobeacon",
                "fscan",
                "lcx",
                "nbtscan"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "8941e146-3e7f-4b4e-9b66-c2da052ee6df",
            "created_at": "2023-01-06T13:46:38.402513Z",
            "updated_at": "2025-03-27T02:00:02.824555Z",
            "deleted_at": null,
            "main_name": "Sandworm",
            "aliases": [
                "G0034",
                "IRIDIUM",
                "Blue Echidna",
                "FROZENBARENTS",
                "Seashell Blizzard",
                "IRON VIKING",
                "ELECTRUM",
                "TeleBots",
                "UAC-0113",
                "UAC-0082",
                "APT44",
                "Quedagh",
                "VOODOO BEAR",
                "TEMP.Noble"
            ],
            "source_name": "MISPGALAXY:Sandworm",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d53593c3-2819-4af3-bf16-0c39edc64920",
            "created_at": "2022-10-27T08:27:13.212301Z",
            "updated_at": "2025-03-27T02:00:55.529662Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Earth Lusca",
                "TAG-22",
                "Charcoal Typhoon",
                "CHROMIUM",
                "ControlX"
            ],
            "source_name": "MITRE:Earth Lusca",
            "tools": [
                "Mimikatz",
                "PowerSploit",
                "Tasklist",
                "certutil",
                "Cobalt Strike",
                "Winnti for Linux",
                "Nltest",
                "NBTscan",
                "ShadowPad"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "7bd810cb-d674-4763-86eb-2cc182d24ea0",
            "created_at": "2022-10-25T16:07:24.1537Z",
            "updated_at": "2025-03-27T02:02:10.126127Z",
            "deleted_at": null,
            "main_name": "Sandworm Team",
            "aliases": [
                "APT 44",
                "ATK 14",
                "BE2",
                "Blue Echidna",
                "CTG-7263",
                "FROZENBARENTS",
                "IRIDIUM",
                "Iron Viking",
                "Quedagh",
                "Sandworm",
                "Sandworm Team",
                "Seashell Blizzard",
                "TEMP.Noble",
                "UAC-0082",
                "UAC-0113",
                "UAC-0125",
                "UAC-0133",
                "Voodoo Bear"
            ],
            "source_name": "ETDA:Sandworm Team",
            "tools": [
                "AWFULSHRED",
                "ArguePatch",
                "BIASBOAT",
                "Black Energy",
                "BlackEnergy",
                "CaddyWiper",
                "Colibri Loader",
                "Cyclops Blink",
                "CyclopsBlink",
                "DCRat",
                "DarkCrystal RAT",
                "Fobushell",
                "GOSSIPFLOW",
                "Gcat",
                "IcyWell",
                "Industroyer2",
                "JaguarBlade",
                "JuicyPotato",
                "Kapeka",
                "KillDisk.NCX",
                "LOADGRIP",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "ORCSHRED",
                "P.A.S.",
                "PassKillDisk",
                "Pitvotnacci",
                "PsList",
                "QUEUESEED",
                "RansomBoggs",
                "RottenPotato",
                "SOLOSHRED",
                "SwiftSlicer",
                "VPNFilter",
                "Warzone",
                "Warzone RAT",
                "Weevly"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535622,
    "ts_updated_at": 1743041825,
    "ts_creation_date": 1658167488,
    "ts_modification_date": 1658167488,
    "files": {
        "pdf": "https://archive.orkl.eu/cb88c9822c1aec7eb6325d21d846ca9a11174925.pdf",
        "text": "https://archive.orkl.eu/cb88c9822c1aec7eb6325d21d846ca9a11174925.txt",
        "img": "https://archive.orkl.eu/cb88c9822c1aec7eb6325d21d846ca9a11174925.jpg"
    }
}