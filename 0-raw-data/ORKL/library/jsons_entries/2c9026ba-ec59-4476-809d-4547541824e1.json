{
    "id": "2c9026ba-ec59-4476-809d-4547541824e1",
    "created_at": "2023-01-12T15:09:07.155155Z",
    "updated_at": "2025-03-27T02:15:37.906891Z",
    "deleted_at": null,
    "sha1_hash": "df13e99acdda6e38e1ab8d56c2d21cc2c7916d4e",
    "title": "2021-08-12 - Signed MSI files, Raccoon and Amadey are used for installing ServHelper RAT",
    "authors": "",
    "file_creation_date": "2022-05-28T21:40:06Z",
    "file_modification_date": "2022-05-28T21:40:06Z",
    "file_size": 3447643,
    "plain_text": "# Signed MSI files, Raccoon and Amadey are used for installing ServHelper RAT\n\n**[blog.talosintelligence.com/2021/08/raccoon-and-amadey-install-servhelper.html](https://blog.talosintelligence.com/2021/08/raccoon-and-amadey-install-servhelper.html)**\n\n_By_ _[Vanja Svajcer.](https://twitter.com/vanjasvajcer)_\n\n## News summary\n\n\n-----\n\nGroup TA505 has been active for at least seven years, making wide ranging connections with other threat actors\ninvolved in ransomware, stealing credit card numbers and exfiltrating data. One of the common tools in TA505's\narsenal is ServHelper. In mid-June, Cisco Talos detected an increase in ServHelper's activity. We investigated the\nactivity and discovered a set of intertwined malware families and TTPs.\nWe found that ServHelper is being installed onto the targeted systems using several different mechanisms, ranging\nfrom fake installers for popular software to using other malware families such as Raccoon and Amadey as the\ninstallation proxies.\n[This threat demonstrates several techniques of the MITRE ATT&CK framework, most notably Scripting - T1064,](https://attack.mitre.org/)\n[PowerShell - T1059.001, Process Injection -](https://attack.mitre.org/techniques/T1059/001/) [T1055, Non-Standard Port - T1571, Remote Access Software -](https://attack.mitre.org/techniques/T1055/) [T1219,](https://attack.mitre.org/techniques/T1219/)\n[Input Capture - T1056, Obfuscated Files or Information -](https://attack.mitre.org/techniques/T1056/) [T1027, Ingress Tool Transfer -](https://attack.mitre.org/techniques/T1027/) [T1105, and Registry Run](https://attack.mitre.org/techniques/T1105/)\nKeys/Startup Folder - [T1547.001.](https://attack.mitre.org/techniques/T1547/)\n\n**What's new?**\n\nAlthough ServHelper has existed since at least early 2019, we detected the use of other malware families to install it. The\ninstallation comes as a GoLang dropper, .NET dropper or PowerShell script. Its activity is generally linked to Group TA505,\nbut we cannot be certain that they are the exclusive users of this RAT.\n\nServHelper will also sometimes install a module that includes either Monero or Ethereum cryptocurrency mining tools.\n\n**How did it work?**\n\nOne path for infection starts with the compromise of a legitimate site that hosts cryptographically signed MSI installers.\nThese install popular software such as Discord. However, they also launch a variant of the Raccoon stealer, which\ndownloads and installs a ServHelper RAT if instructed by the command and control (C2) server.\n\nAttackers also deploy the ServHelper RAT with a variant of the Amadey malware which gets a full command line from the\nserver to install an initial PowerShell downloader component for ServHelper.\n\nServHelper includes the functionality to remotely control the infected system, log keystrokes, exfiltrate users' confidential\ndata, launch RDP sessions, install cryptomining software and install the NetSupport remote access tool.\n\n**So what?**\n\nAlthough many threat actors, such as TA505 or its associated groups — to which we attribute these campaigns with\n[moderate confidence — have been affected by](https://blog.talosintelligence.com/2017/08/on-conveying-doubt.html) [the arrests of several CLOP members in Ukraine, they continued to operate](https://duo.com/decipher/ukrainian-police-arrest-suspected-cl0p-ransomware-operators)\nusing a different set of tools. These attacks are geared toward taking control over the infected systems and stealing\nconfidential data which the group will likely leverage for financial gain later on. Users need to make sure they install\nsoftware only from trusted sources. Even if installers are signed with a valid certificate, that does not mean that the\nfunctionality is legitimate.\n\n## Technical details\n\n**Introduction**\n\nThis investigation started as a single and simple call to an IP address hosting a PowerShell script found in Cisco Secure\n[product telemetry. Initially, while looking at the code, we thought it is just one of many cryptomining malware campaigns.](https://blog.talosintelligence.com/2021/07/cryptomining-analysis.html)\n\n\n-----\n\nHowever, we realized soon that the main payload is a variant of a ServHelper backdoor. The usage of the tool is generally\n[linked with the activity of the threat group TA505. TA505 is a crimeware-focused group active since at least 2014. They are](https://malpedia.caad.fkie.fraunhofer.de/actor/ta505)\nmostly known for their usage of the Dridex and CLOP ransomware families in their campaigns. There are some theories\n[that CLOP ransomware gang members, arrested in Ukraine in June 2021, originated from the group TA505.](https://krebsonsecurity.com/2021/06/ukrainian-police-nab-six-tied-to-clop-ransomware/)\n\nWhat started as an investigation into an Ethereum cryptominer, turned out to be a never-ending whirlwind of different\nmalware families. Apart from the usual suspects, often attributed to TA505, such as the Raccoon stealer and Amadey\nstealer/loader, we have encountered a couple of newer techniques from this group. TA505 now uses an MSI installer signed\nwith a valid certificate and a GoLang go-clr-based dropper that can load a .NET assembly from memory.\n\n**Initial discovery**\n\nWhile looking at the daily report of suspicious command lines, we encountered a call to a PowerShell script hosted at the IP\naddress 94.158.245.88.\n\n_Initial command in product telemetry._\n\nThe downloaded script was a simple PowerShell script to download additional scripts and launch a VBScript file, \"start.vbs.\"\nWe first assumed this was another cryptocurrency miner, but we decided to analyze the scripts because, as a\ncryptocurrency miner, it was not immediately familiar.\n\n_Downloaded PowerShell script, \"bi.ps1.\"_\n\nStart.vbs is a simple driver that seems to check for the size of the System Management BIOS memory to avoid executing\nwithin virtual machines, and then launches the script \"ready.ps1.\"\n\n_Start.vbs first checks for the amount of SMBIOS memory before it launches the initial loader._\n\nBefore executing the next stage, ready.ps1 decodes a base64-encoded string to reveal a tool for disabling the Microsoft\nAMSI interface, which is often used by anti-malware software for scanning the content of obfuscated PowerShell, VBA, VBS\nand scripts written in other Microsoft scripting languages. Once AMSI is disabled, ready.ps1 launches the next stage, which\n\n\n-----\n\nis the main PowerShell loader, resolve domain.ps1.\n\n_AMSI bypass in ready.ps1._\n\nThe AMSI bypass first loads the amsi.dll library and then gets the address of the function AmsiScanBuffer. The first six\nbytes of the function are patched with 2 x86 instructions \"MOV EAX,80070057;RET\" to return the value 0x80070057\n(INVALID ARG) to the caller so that it seems as if the scan has failed.\n\nMain PowerShell loader\n\nThe loader starts with a function for decrypting the content of a variable containing the real PowerShell code of the loader.\nThe function derives a TripleDES password from the parameters submitted to the function call.\n\n_TripleDES is used to decrypt the actual PowerShell loader._\n\nWhen decrypted, the main loader contains several base64-encoded buffers and a logic to drop and load files decoded from\nthose buffers. Before it's dropped to disc, the buffers need to be decrypted using a simple byte XOR scheme with a fixed\nseven-byte XOR key.\n\n\n-----\n\n_The main loader needs to deobfuscate the file content after Base64 decoding._\n\nThe loader will, depending on the characteristics of the system, attempt to drop the payloads into the following locations:\n\nC:\\Windows\\branding\\mediasvc.png\nC:\\Windows\\branding\\mediasrv.png\nC:\\Windows\\branding\\wupsvc.jpg\nC:\\Windows\\system32\\rdpclip.exe\nC:\\Windows\\system32\\rfxvmt.dll\n\nThese locations are a telltale sign of ServHelper infection, a RAT that's been active since at least early 2019.\n\nWhile reading the deobfuscated PowerShell script we noticed the download and execution of another URL:\nhxxp://45[.]61[.]136[.]223/get/m5.php. The call to this URL will be executed only if the amount of memory in the graphics\ncard is larger than 4MB, which may be a way to evade some virtual machines or just a check for a machine with sufficient\ncapacity to download the module, which is used for cryptocurrency mining.\nCryptomining module m5.php\n\nThe cryptomining module hosted on hxxp://45[.]61[.]136[.]223/get/m5.php is what prompted us to initially assume that the\nfinal payload of the campaign is just a cryptominer and not confidential information stealing and remote control of the\ninfected systems which may be attributed, based on the known TTPs, to Group TA505.\n\n_m5.php will only be downloaded if the size of the video controller memory is larger than 4MB._\n\nThe m5 is lightly obfuscated, first by adding a decimal 92 to each of the characters and then by base64 encoding it. The\nscript creates another PowerShell script in the C:\\Windows\\system32\\update-request.ps1. The update-request module will\nbe launched through a UAC bypass attempt which abuses a scheduled task\n\\Microsoft\\Windows\\DiskCleanup\\SilentCleanup by modifying the registry value HKCU:\\Environment\\windir to contain the\ncall to the modified slmgr.vbs script containing the call to launch update-request.ps1.\n\n\n-----\n\n_UAC_\n\n_bypass to launch update-request.ps1._\n\nUpdate-request.ps1 is obfuscated in a similarly simple manner to m5.php content. The script contains another layer of\nobfuscation with TripleDES similar to the one seen in resolve-domain.ps1. An interesting fact is that the decrypting function\nhas a name decra, which is the same name as an export of a ServHelper service loader, which will be described a bit later.\n\nOnce decoded, update-request contains instructions to download and run cryptomining software. In some previous\n[instances, ServHelper installations were linked to Monero mining but in this campaign, a choice is made between mining](https://www.gdatasoftware.com/blog/2020/07/36122-hidden-miners)\nMonero with XMRig and Ethereum. Ethermine and its configuration file are downloaded if Ethereum is the chosen miner.\n\nThe Ethminer payload is saved into the drive as C:\\windows\\system32\\mui_pack_es.json as a base64-encoded file, which\nis also encrypted using XOR with the byte-based key \"Asfianweiw\". The Monero mining XMRig payload may be\ndownloaded into C:\\windows\\system32\\mui_pack.json and decrypted before loading into memory using the same method.\nThis tactic is likely designed to avoid the detection of PE files by anti-malware software.\n\nThe mining payloads will only exist in the memory as PE modules and it will be loaded by injecting them reflectively into the\nlegitimate process c:\\windows\\system32\\msiexec.exe. The method to hollow msiexec seems to be a PowerShell port of the\n[C++ RunPE process hollowing project. It loads an embedded base64-encoded custom .NET assembly which is simply used](https://github.com/d35ha/RunPE/blob/master/RunPE.cpp)\nas a trampoline to avoid having to import all the required functions from the kernel32.dll module.\n\nLooking at the Ethereum payouts for the address 0x12420E4083F1E37b91AFA0E054682d049F9505C6 at the blockchain\nexplorer on ethermine.org, we can see that the pool of miners with this address earned just over 17 Ethereums over the\nperiod of fewer than four months, which at the time of writing this post is worth slightly more than $33,000 USD.\n\n\n-----\n\n_Ethermine payouts to the address associated with the TA505 ServHelper campaigns._\n\n**ServHelper installation**\n\nIn this campaign, the PowerShell loader resolve-domain.ps1 is responsible for dropping and installing the ServHelper\npayload. In this case, the main loader is downloaded from a website, but in some other cases, the main PowerShell loader\nis dropped by an executable dropper.\n\nThe PowerShell loader uses the same SilentCleanup UAC bypass seen in the mining module to execute the registry. The\nfile system can change without the UAC prompt.\n\nThe loading of ServHelper consists of two main DLL modules combined with helper modules to allow communication over\nRDP. The PowerShell module changes the registry keys related to the Windows service Terminal Server. The Terminal\nServer service is changed so that it listens on a non-default TCP port 7201 instead of the default port 3389. A new Remote\nDesktop service Termservice is created and its ServiceDLL value is set to point into the ServHelper DLL loader\nC:\\Windows\\branding\\mediasrv.png.\n\nThe loader DLL mediasrv.png is packed with UPX and employs a simple XOR decryption of strings that are dynamically\nconstructed in memory. The loader is a service DLL with the ServiceMain function containing the ability to load the main\nServHelper DLL module from C:\\Windows\\branding\\mediasvc.png.\n\nThe mediasrv.png contains the usual exports for a svchost-based service DLL, such as ServiceMain,\nSvcHostPushServiceGlobals and an additional export decra, which seems to be used for decryption.\nSvcHostPushServiceGlobals seems to be used to load the standard Remote Desktop DLL termserv.dll and loads an\n[RDPWrapper configuration from the dropped file C:\\Windows\\branding\\wupsvc.jpg. Some earlier analyses indicate that the](https://www.binarydefense.com/an-updated-servhelper-tunnel-variant/)\n\n\n-----\n\nfirst stage of the ServHelper DLL loader is in fact a modified variant of RDPWrapper which allows for remote concurrent\nRDP sessions on the host. This would also explain the loading of the RDPWrap configuration file.\n\n_Modified RDPWrap DLL first decrypts the name and then loads the main ServHelper module._\n\nThe main ServHelper RAT module is written in Delphi using the compilation to native code. It uses a modified Vigneres\n[cipher to encrypt and decrypt the strings used in the file. We used IDAPython to create a simple script for decoding the](https://hex-rays.com/products/ida/support/idapython_docs/)\nstrings and assigned a function key to patch the strings back into an IDA database file. We'll share this script at the bottom\nof this post.\n\nThe ServHelper module contains typical backdoor functionality. It launches many threads, some for tunneling the traffic over\nOpenSSH (which may be downloaded from a C2 server) tunnel and some as a main command processing loop, which for\nthe sample under analysis, accepts the following commands:\n\nxl\ninfo\nfixrdp\nreboot\nupdateuser\ndeployns\nkeylogadd\nkeylogdel\nkeyloglist\nkeylogreset\nkeylogstart\nsshurl\ngetkeylog\ngetchromepasswords\ngetmozillacookies\ngetchromecookies\nsearch\nbkport\n\n\n-----\n\nhijack\npersist\nstophijack\nsethijack\nsetcopyurl\nforcekill\nnop\ntun\nslp\nkilltun\nshell\nupdate\nload\nsocks\n\nAlthough the hijack and keylogging commands are accepted by the RAT, it seems like they are not implemented by the\nvariant. From the analysed code, it seems that, for example, the hijack functionality should be implemented by one of the\nDLL exports, gusiezo3. However, this functionality actually enters an infinite sleep loop. Other researchers have previously\ndescribed the other functions in depth.\n\n_Gusiezo3 export is supposed to handle the command hijack but it simply enters an infinite loop._\n\nThis is similar to other exports, like euefnaiw, which should handle keylogging and hitit, but no functionality is implemented.\nThe C2 domain name for this sample is \"novacation.cn.\" While searching for other related samples, we discovered another\ndropper written in GoLang.\n\n**GoLang go-clr dropper**\n\n[The dropper uses the go-clr loader, which allows a GoLang executable to load a .NET assembly from memory or from the](https://github.com/ropnop/go-clr)\ndisk. The dropper extracts a base64-encoded buffer from its own rdate section, decompresses the buffer using gzip deflate,\nand loads the .NET ServHelper dropper into memory to execute it. The base64 buffer is corrupt to avoid automatic\n\n\n-----\n\n[extraction by anti malware software. It automatically replaces itself before it is base64 decoded and decompressed.](https://medium.com/walmartglobaltech/ta505-adds-golang-crypter-for-delivering-miners-and-servhelper-af70b26a6e56)\n\n_Gzip buffer is corrected before it is base64 decoded into a binary buffer containing a .NET assembly._\n\nThe loaded assembly is a usual dropper for ServHelper. It extracts the PowerShell loader components for the ServHelper\ninto the temporary files folder and runs ready.ps1, which launches the infection as described above.\n\n_.NET ServHelper dropper drops and executes the PowerShell loader components._\n\nAs with every investigation, we tried to find similar files and their locations on the internet and found that GoLang droppers\nare downloaded and installed as a consequence of running a group of MSI installer packages signed with a valid certificate\nand not detected by any antimalware software. The installers purport to be MSI files that install various applications,\nincluding a video editor, a wiki program and Discord.\n\n**MSI installer downloaders**\n\nThe certificate belongs to a Russian company SGP-GEOLOGIYA, OOO. The first sample has been submitted to VirusTotal\non May 2 and again on July 15.\n\n\n-----\n\n_Malicious MSI installers signed by \"SGP-GEOLOGIYA, OOO\" are not detected._\n\n[The MSI installer file is created with a trial version of Advanced Installer. Files created with Advanced Installer contain a](https://www.advancedinstaller.com/)\nparser aipackagechainer.exe used to parse the package and communicate to msiexec.exe to download and run\nprerequisites. the AI_PreRequisite table contains a URL hxxp://91[.]212[.]150[.]205/filename.exe that points to an\nexecutable file that the installer downloads and runs.\n\n_MSI installer will download and run files from any URL specified in the AI_PreRequisite table._\n\nHowever, the URL of the GoLang ServHelper dropper, referenced as being downloaded by the MSI installer, is\nhxxp://91[.]212[.]150[.]205/al.exe and there is no reference to it in the MSI installation prerequisites. A logical assumption is\nthat the filename.exe is a downloader of the ServHelper dropper.\n\n**Raccoon and Amadey stealers entering the ServHelper play**\n\nThe sample filename.exe, (SHA256 7516b2271e4a887156d52f661cdfc561fded62338a72b56f50bf188c2f5f222a),\n[downloaded by the MSI installer is a variant of the Raccoon information stealing malware. Raccoon is a stealer that](https://malpedia.caad.fkie.fraunhofer.de/details/win.raccoon)\nattempts to find and exfiltrate information that can be used by the attacker to gain financial benefits, such as user\ncredentials, cookies, cryptocurrency wallet details and credit card numbers.\n\nThe sample we analysed, referenced by the MSI installer, communicates with a C2 server hosted on 34[.]76[.]8[.]115.\n\nRaccoon uses HTTP for communication with the C2 server. The data submitted and received is encrypted with RC4 using\nan encryption key hardcoded within the body of the stealer. When run for the first time, the Raccoon executable sends a\nPOST request to the C2 server. The request contains the basic information about the bot, such as a unique bot identifier,\n\n\n-----\n\nusername, configuration identifier and the format of data expected and the C2 server responds with the configuration in a\nformat specified by the bot, usually JSON.\n\n_The RC4 passphrase and all other Raccoon strings are encrypted with a simple XOR scheme._\n\nThe analysed sample RC4 passphrase was \"$Z2s`ten\\@bE9vzR\". We used it to decrypt the response sent back to the bot\nfrom the C2 server. Then, we obtained the JSON configuration, which shows that the C2 instructs the bot to download the\nGoLang ServHelper dropper.\n\n\n-----\n\n_Decrypted Raccoon configuration to download the ServHelper GoLang dropper._\n\nHowever, Raccoon is not the only family used to install ServHelper together with executing its information stealing objective.\n[Another stealer family samples, variants of Amadey are also instructed by its C2 server to download ServHelper samples.](https://malpedia.caad.fkie.fraunhofer.de/details/win.amadey)\nThis is done in a slightly different manner. The Amadey loader receives a PowerShell command line from its C2 server and\nexecutes it to download and install ServHelper samples in its PowerShell form. The usage of Amadey is also linked to\ngroup TA505.\n\nThe sample with SHA256 baad7552e8fc0461babc0293f7a3191509b347596d9ca8d2a82560992ff2c48e, apart from it\nscreen capture and credential dumping plugins receives from the C2 server 157[.]90[.]24[.]103 the command which\ndecodes to the same IP address we initially observed in our telemetry: 94[.]158[.]245[.]88.\n\n_Amadey C2 instructs the bot to download and run a ServHelper PowerShell installer._\n\nHowever, the pattern is similar: An information-stealing malware variant is instructed by its C2 server to download and\ninstall ServHelper.\n\n**Conclusion**\n\nIn this post we documented activities that may be attributed with moderate confidence to the threat group TA505 or a\nrelated group. The activities include several malware families geared toward stealing and exfiltrating confidential data.\n\n\n-----\n\nAll documented families as well as signed MSI installers are used to download and run ServHelper a RAT with different\nTTPs, such as usage of GoLang, .NET framework, PowerShell and Delphi.\n\n_Malware families in modules observed in these campaigns._\n\nUsers need to make sure they install software only from trusted sources. Even if installers are signed with a valid certificate\nthat does not mean that the functionality is legitimate. The question of storage of confidential data is also important as\npasswords and credit card numbers are sometimes stored in insecure storage facilities such as sqlite databases, which are\neasy targets for criminals. Session cookies can also be used for hijacking accounts and they have a value for attackers. It is\nvery likely that we will see groupe similar to TA505 adapting these tools in the future as the detection for them improves.\n\n**Coverage**\n\nWays our customers can detect and block this threat are listed below.\n\n\n-----\n\n[Cisco Secure Endpoint is ideally suited to prevent the execution of the malware detailed in this post. New users can try](https://www.cisco.com/c/en/us/products/security/amp-for-endpoints/index.html)\n[Cisco Secure Endpoint for free here.](https://www.cisco.com/c/en/us/products/security/amp-for-endpoints/free-trial.html?utm_medium%3Dweb-referral%26utm_source%3Dcisco%26utm_campaign%3Damp-free-trial%26utm_term%3Dpgm-talos-trial%26utm_content%3Damp-free-trial)\n\n[Cisco Secure Web Appliance web scanning prevents access to malicious websites and detects malware used in these](https://www.cisco.com/c/en/us/products/security/web-security-appliance/index.html)\nattacks.\n\n[Cisco Secure Firewall and](https://www.cisco.com/c/en/us/products/security/firewalls/index.html) [Meraki MX can detect malicious activity associated with this threat.](https://meraki.cisco.com/products/appliances)\n\n[Cisco Secure Malware Analytics helps identify malicious binaries and build protection into all Cisco Security products.](https://www.cisco.com/c/en/us/solutions/enterprise-networks/amp-threat-grid/index.html)\n\n[Cisco Umbrella, our secure internet gateway (SIG), blocks users from connecting to malicious domains, IPs, and URLs,](https://umbrella.cisco.com/)\nwhether users are on or off the corporate network.\n\nAdditional protections with context to your specific environment and threat data are available from the Cisco Secure Firewall\nManagement Center.\n\nOpen Source Snort Subscriber Rule Set customers can stay up to date by downloading the latest rule pack available for\n[purchase on Snort.org.](https://www.snort.org/products)\n\nThe following SIDs have been released to detect this threat: 57975.\n\nThe following ClamAV signatures have been released to detect this threat as well as tools and malware related to these\ncampaigns:\n\nWin.Downloader.Powershell-9883640\nWin.Trojan.Powershell-9883642\nWin.Downloader.Powershell-9883641\nWin.Downloader.ServHelper-9883708\nWin.Downloader.Powershell-9883847\nWin.Trojan.ServHelper-9883848\nWin.Trojan.ServHelper-9883866\nWin.Trojan.ServHelper-9883867\n\n[Cisco Secure Endpoint (AMP) users can use Orbital Advanced Search to run complex OSqueries to see if their endpoints](https://orbital.amp.cisco.com/help/%23:~:text%3DCisco%2520Orbital%2520(%25E2%2580%259COrbital%25E2%2580%259D),(Creators%2520Update)%2520or%2520later.)\n[are infected with this specific threat. For specific OSqueries on this threat, click here,](https://github.com/Cisco-Talos/osquery_queries/blob/master/win_malware/malware_amadey_filepath.yaml) [here,](https://github.com/Cisco-Talos/osquery_queries/blob/master/win_malware/malware_raccoon_mutex.json) [here and](https://github.com/Cisco-Talos/osquery_queries/blob/master/win_malware/malware_raccoon_filepath.yaml) [here.](https://github.com/Cisco-Talos/osquery_queries/blob/master/win_malware/malware_servhelper_filepath.yaml)\n\n**IOCs**\n\n**IPs**\n\n\n-----\n\n45[.]61[.]137[.]91 C2 IP\n91[.]212[.]150[.]205 - hosting a GoClr dropper variant\n193[.]150[.]70[.]5 - hosting a GoClr dropper variant\n94[.]158[.]245[.]88 - hosting original attack seen in the telemetry\n93[.]157[.]63[.]171 - hosting Raccoon and a GoClr dropper variant\n\n**Hosts**\n\nwww[.]homate[.]xyz\nwww[.]dsfamsi4b[.]cn\nwww[.]afspfigjeb[.]cn\nwww[.]pgf5ga4g4b[.]cn\nwww[.]wheredoyougo[.]cn\nwww[.]novacation[.]cn - C2 from the samples 1 and 2 of ServHelper\ndssagrgbe3irggg[.]xyz - C2 alternative from ServHelper\ndsgiutugagb[.]cn - C2 alternative from ServHelper sample1\nasfggagsa3[.]xyz - C2 alternative from an earlier sample - sample2\nsagbbrrww2[.]cn - C2 alternative from sample 2\nkbpsorjbus6[.]pw\nwww.sdfisdgj[.]xyz\nwww.kbpsorjbus6[.]pw\nsdfisdgj[.]xyz\ndsfamsi4b[.]cn\nnovacation[.]cn\nwheredoyougo[.]cn\nasdjausg[.]cn - C2 from a newer dropper\npgf5ga4g4b[.]cn\nhomate[.]xyz\nwww.asdjausg[.]cn\nafspfigje[.].cn\ngeyaeb[.]dev\ntelete[.]in - Raccoon C2\n\n**C2 Domain's IP addresses, changing frequently**\n\n185[.]163[.]45[.]103 - July 4, 2021 to July 15, 2021\n206[.]188[.]197[.]221 - July 2, 2021 to July 4, 2021\n206[.]188[.]196[.]143 - July 1, 2021 to July 2, 2021\n46[.]17[.]96[.]8 - June 29, 2021 to July 1, 2021\n45[.]61[.]137[.]91 - June 27, 2021 to June 29, 2021\n\n**URLs**\n\nhxxp://94[.]158[.]245[.]88/bi.ps1 - initial investigation point, also hosting Powershell versions of droppers without .NET and\nwithout GoClr\nhxxp://94[.]158[.]245[.]88/bf/start.vbs\nhxxp://94[.]158[.]245[.]88/bf/Get-Content.ps1\nhxxp://94[.]158[.]245[.]88/bf/ready.ps1\nhxxp://ww16[.]enroter1984[.]cn/bif/b.php - C2 (enroter1984.cn from at least November 2020)\nhxxp://novacation[.].cn/bif/b.php\nhxxp://novacation[.]cn/juytfft/b.php\nhxxp://193[.]150[.]70[.]5/al.exe\nhxxp://bromide[.]xyz/ssh.zip - hosts OpenSSH Zip use to tunnel the traffic\nhxxp://91[.]212[.]150[.]205/al.exe\nhxxp://94[.]158[.]245[.]88/cap/Get-Content.ps1 - earlier campaign, Feb 2021\nhxxp://94[.]158[.]245[.]88/drc.ps1 - downloaded by Amadey\nhxxp://94[.]158[.]245[.]88/cap/start.vbs\n\n\n-----\n\nhxxp://94[.]158[.]245[.]88/cap/ready.ps1 campaign March 2021\nhxxp://94[.]158[.]245[.]88/mae/start.vbs\nhxxp://94[.]158[.]245[.]88/mae/Get-Content.ps1\nhxxp://94[.]158[.]245[.]88/mae/ready.ps1\nhxxp://45[.]61[.]136[.]223/get/m5.php - Cryptomining portion\nhxxp://beautyiconltd[.]cn/ethged.txt - Ethminer\nhxxp://beautyiconltd[.]cn/ethcnf.txt - Ethminer configuration\nhxxp://beautyiconltd[.]cn/rigged.txt - xmrig for Monero mining\nhxxp://beautyiconltd[.]cn/cnf.txt - xmrig configuration\nhxxp://93[.]157[.]63[.]171/filename.exe\nhxxp://93[.]157[.]63[.]171/al.exe\nhxxps://mepcontechnologies[.]com/DiscordSetup.msi\n\n**Legitimate URLs**\n\nhxxps://raw[.]githubusercontent[.]com/sqlitey/sqlite/master/speed.ps1\n\n**Samples**\n\n**MSI Installers**\n\nf36277c6faaed23129efacc83847153091cd1ef0b05650e0b8c29d13d95182a5\na9fa2da9be5b473da0f2367f78494d3dc865774bf1ad93c729bbe329a29a1f9d\nf80df34accc8780a1eb9c733e4e5e5874cce6ad22e57ec8b827aa7f28318c5d1\n0fde5e73f96e6df0b75cc15cffb8d7ff0d7a1cda33777e7ee23c5d07011e6ae8\n569d0618131bbbe08498c1f90518df90d394c37e5c146ac3bc74429c4f7f113a\n\n**ServHelper samples**\n\n45732f9c8b3e853484464d5748a8879a7095dc0c1c08e66854d350254c38bb42 - mediasrv.png\na2b0ef2413399dbdb01de3a0d2dd310ba127bbfdad09352fecb8444d88a05662 - mediasvc.png\n02390b9368add3c496f779db617d19171379b36f1d79c0fa4ab3a07afc7c3e46 - wupsvc.jpg config file\n9c7fc1304f9dada69594f64d230cb20ce3c1f83a41ca0e27b6274361941b3c67 - PowerShell dropper Get_Content.ps1\n74333b02f97c1fbf44592463210a6962f1601ab91a4e28d037756b9804c5b2a0 - drc.ps1\n5b6b7899dd459fa0bb234a0b102af91f4ee412abf36b1c54d1253ae59dda6ee2 - ready.ps1\n9520067abc34ce8a4b7931256e4ca15f889ef61750ca8042f60f826cb6cb2ac9 - ready.ps1\nf00f8b0d2602fc2e8bcf5899377f6a23beae9ea9df2c0a3c4e9aad4cae2ef522 - Get-Content.ps1\nb65273062c9be6bfc6343438e51d7f68aaecf8382ae1373ff1b3adfacff1fd5d - Get-Content.ps1 earlier variant\n0d650a1ab25e820a8bcd2b49144daef20439c931d5bbd5b547c65511aab6d334 - Get-Content.ps1\n5d4a0661cfb3cca59acd8a9fa433ec2c48d686da36f3890b73e7b9f37c60e980 - start.vbs\na1351912f8ffeeb5ebe2eb8abf45e50a52b67f82328090ad4b1ba89f30106e00 - start.vbs\n7a9fae49143829692253d09fa7c66f6c2809d29cff52734567db688c91a01924 - bi.ps1\n20eb050c3c94f134ca7c812c712deb45870f6952086608a11d4d4e78ca3c8ff6 - mediasrv.png\nffcdccdae62c13b61f32d6fa0ad73ddbfda89d0e4fcab3bf074003ca73d522a5 - mediasvc.png\n4390543ecc7f39f0dcf6db2816edaaa6b64f720263c401c108f18df291241cb5 - wupsvc.jpg\n1f2f7c7e0ad496e8991e4495b8830961314baee109fb7e0d15d2c3dc0857ef0b - update-request.ps1\n42c277ada9c6f8ddcd6211e4792a8df1fa0d0ad8cbb867eee1a431cc1b79834d - mae.ps1\n\n**PowerShell mining loader**\n\n0b25a462efbb3c5459febae122e434f4a6ec6d2dbfacf03e4537e437f91c5dcc - m5.php\n\n**Amadey samples downloading ServHelper from hxxp://94[.]158[.]245[.]88/cap/**\n\n64926d011513a3083b0af3425b38fbfc66d2bad0e3993898ec4651252812685b\n45e81832542da0e190a1bf44c58b0c96f3ec11b488450aad7eb7a3e6e16f0703\nbaad7552e8fc0461babc0293f7a3191509b347596d9ca8d2a82560992ff2c48e\n\n**GoCLR droppers for ServHelper (some samples downloaded by Raccoon)**\n\n\n-----\n\nfe40b63a00a7d737baa87f493751a1b92ac782baaef2304b0ae65c5a1cbec58d\n5202c92268cb86785644bf0fd22eb6290498034878b6c41e84ac5b4bcc7d671a\n44815a42eb3317c7e567f8e20388bd9e28cf71096f45f4ee6094f26888dcfb0c\n8aa55a77613e1246a7ce499a85cd52ee2d48b4f4730d62850e249d6249214abf\nb3e3132a078fd8d266d709ecf351fc9283a63fbdcce4023c460363896593f6b8\n32c18e01aa78a0d07025e36ebaef5ae582cadb6d53d47aab1ee629ba4eee2fab\n526273ef0f1bfe161af24d9f1946bb72797d06a5b21ed750988797597d16c28d\n6ad5b2b54e8c01ca7f59a40564e897352c1e24ce0899ef10ee3c3e035f510c59\n6eca26fcfabbb12c6a37eb689de222e75b31574dd25e7fd3d8b446d700c40133\n\n**Raccoon samples downloading ServHelper**\n\n8fa841c71a956755f6f393ca92a04d0a6950343a7a765a3035f4581dda198488\n82d290c62cb838a94e1948ba84c2a90c42c0ad44bb79413ea0b8ae2560436c8e\n3dccc313dcf21c5504ce1808595979dec90f94626bdc8ef18518176ab20418a2\n7516b2271e4a887156d52f661cdfc561fded62338a72b56f50bf188c2f5f222a\n5f008ff774ae78a416b10f320840287d7c00affb9c1b2ea8e8c1931300135985\ne7e6e479b0fa5edb03f220084756fff778cf46865fe370924d272545e8181865\ndb710c90eaa2f83be99f1004b9eda6cfbf905a1ab116d1738a89f4eac443f4fe\n\n**.NET ServHelper dropper**\n\nfea63897b4634538e9e73c0f69c2e943aebc8cebcffc1415f5ce21207fdfef92\nfdc9788b38e06eafe34c6050f37224409e423f37d67d637ddac25e9cf879e2f2\n\n**Ethminer**\n\n561e9e4263908c470bb2ef9b64cac7174e43aeb795cb0168699cd4c219eab93c\n\n**Ethereum address**\n\n0x12420E4083F1E37b91AFA0E054682d049F9505C6\n\n**Monero address**\n\n47EEBQeqq661AchrUwicX1Nxqeuizqoxp4XEV7dUyhkzQgpxGdbJLYGa4xLeQXiBDqQ8xZFUbLCK1Gj2qFmDEZAREwGLjDG\n\n**IDAPython script to deobfuscate ServHelper strings using Vigneres cypher**\n\n\n-----\n\n```\n p y\nimport idaapi\nimport idc\nimport ida_bytes\nimport ida_expr\nimport ida_kernwin\n#Load this Python script into IDAPro. To run it, position the cursor at the screen address of the string to\ndeobfuscate and press the F2 key.\ndef getString(ea):\n  # We get the item-head because the `GetStringType` function only works on the head of an item.\n  string_type = idc.get_str_type(idaapi.get_item_head(ea))\n  string_content = idc.get_strlit_contents(ea, strtype=string_type)\n  return string_content,string_type\n# Python code to implement Vigenere Cipher as implemented in the Delphi code at\n# https://stackoverflow.com/questions/6800326/how-to-crypt-or-hide-a-string-in-delphi-exe/6801163\n# This algorithm was implemented in ServHelper malware\n# Generate the key stream from the keyword\ndef generateKey(string, key):\n  key = list(key)\n  if len(string) == len(key):\n    return(key)\n  else:\n    for i in range(len(string) - len(key)):\n      key.append(key[i % len(key)])\n  return(\"\" . join(key))\n# Decrypt the original text, skip non-alphabet characters\ndef originalText(cipher_text, key):\n  orig_text = []\n  for i in range(len(cipher_text)):\n    if (ord(cipher_text[i]) >= ord('A') and ord(cipher_text[i]) <= ord('Z')):\n      x = (ord(cipher_text[i]) - ord(key[i]) + 26) % 26\n      x += ord('A')\n      orig_text.append(chr(x))\n    elif (ord(cipher_text[i]) >= ord('a') and ord(cipher_text[i]) <= ord('z')):\n      x = (ord(cipher_text[i].upper())          ord(key[i]) + 26) % 26\n      x += ord('a')\n      orig_text.append(chr(x))\n    else:\n      orig_text.append(cipher_text[i])\n  return(\"\" . join(orig_text))\ndef patchString(strng):\n  \"\"\"Patch a decrypted utf-16le encoded string back to IDAPro\"\"\"\n  ida_bytes.patch_bytes(idc.get_screen_ea(), strng.encode('utf-16le'))\ndef decryptString(keyword = 'WBORRHOS'):\n  #change the keyword to a string appropriate for the sample under analysis\n  kemi,strtype=getString(idc.get_screen_ea())\n  strkemi=str(kemi,'utf-8')\n  key= generateKey(strkemi,keyword)\n  decrypted=originalText(strkemi,key)\n  patchString(decrypted)\n  #Make sure what was patched is defined as a string literal\n  ida_bytes.create_strlit(idc.get_screen_ea(),ida_bytes.get_item_size(idc.get_screen_ea()),strtype)\n\n```\n\n-----\n\n```\ndef key_decrypt():\n  decryptString( 'WBORRHOS')\n#Assign the decryption function to the function key F2\nida_kernwin.add_hotkey('F2', key_decrypt)\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-08-12 - Signed MSI files, Raccoon and Amadey are used for installing ServHelper RAT.pdf"
    ],
    "report_names": [
        "2021-08-12 - Signed MSI files, Raccoon and Amadey are used for installing ServHelper RAT.pdf"
    ],
    "threat_actors": [
        {
            "id": "99cb4e5b-8071-4f9e-aa1d-45bfbb6197e3",
            "created_at": "2023-01-06T13:46:38.860754Z",
            "updated_at": "2025-03-27T02:00:02.937438Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "SectorJ04 Group",
                "Dudear",
                "G0092",
                "ATK103",
                "Hive0065",
                "Spandex Tempest",
                "GRACEFUL SPIDER",
                "GOLD TAHOE",
                "CHIMBORAZO",
                "SectorJ04"
            ],
            "source_name": "MISPGALAXY:TA505",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "5e6b31a6-80e3-4e7d-8b0a-d94897ce9b59",
            "created_at": "2024-06-19T02:03:08.128175Z",
            "updated_at": "2025-03-27T02:05:17.400394Z",
            "deleted_at": null,
            "main_name": "GOLD TAHOE",
            "aliases": [
                "SectorJ04 ",
                "Spandex Tempest ",
                "TA505 ",
                "FIN11 "
            ],
            "source_name": "Secureworks:GOLD TAHOE",
            "tools": [
                " Cobalt Strike",
                " FlawedAmmy",
                " Get2",
                " GraceWire",
                " Malichus",
                " SDBbot",
                " ServHelper",
                " TrueBot",
                "Clop"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "75d4d6a9-b5d1-4087-a7a0-e4a9587c45f4",
            "created_at": "2022-10-25T15:50:23.5188Z",
            "updated_at": "2025-03-27T02:00:55.489882Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "TA505",
                "Hive0065",
                "Spandex Tempest",
                "CHIMBORAZO"
            ],
            "source_name": "MITRE:TA505",
            "tools": [
                "AdFind",
                "Azorult",
                "FlawedAmmyy",
                "Mimikatz",
                "Dridex",
                "TrickBot",
                "Get2",
                "FlawedGrace",
                "Cobalt Strike",
                "ServHelper",
                "Amadey",
                "SDBbot",
                "PowerSploit"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "e447d393-c259-46e2-9932-19be2ba67149",
            "created_at": "2022-10-25T16:07:24.28282Z",
            "updated_at": "2025-03-27T02:02:10.159466Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "ATK 103",
                "Chimborazo",
                "Gold Evergreen",
                "Gold Tahoe",
                "Graceful Spider",
                "Hive0065",
                "Operation Tovar",
                "Operation Trident Breach",
                "SectorJ04",
                "Spandex Tempest",
                "TA505",
                "TEMP.Warlock"
            ],
            "source_name": "ETDA:TA505",
            "tools": [
                "Amadey",
                "AmmyyRAT",
                "AndroMut",
                "Azer",
                "Bart",
                "Bugat v5",
                "CryptFile2",
                "CryptoLocker",
                "CryptoMix",
                "CryptoShield",
                "Dridex",
                "Dudear",
                "EmailStealer",
                "FRIENDSPEAK",
                "Fake Globe",
                "Fareit",
                "FlawedAmmyy",
                "FlawedGrace",
                "FlowerPippi",
                "GOZ",
                "GameOver Zeus",
                "GazGolder",
                "Gelup",
                "Get2",
                "GetandGo",
                "GlobeImposter",
                "Gorhax",
                "GraceWire",
                "Gussdoor",
                "Jaff",
                "Kasidet",
                "Kegotip",
                "Kneber",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Locky",
                "MINEBRIDGE",
                "MINEBRIDGE RAT",
                "MirrorBlast",
                "Neutrino Bot",
                "Neutrino Exploit Kit",
                "P2P Zeus",
                "Peer-to-Peer Zeus",
                "Philadelphia",
                "Philadephia Ransom",
                "Pony Loader",
                "Rakhni",
                "ReflectiveGnome",
                "Remote Manipulator System",
                "RockLoader",
                "RuRAT",
                "SDBbot",
                "ServHelper",
                "Shifu",
                "Siplog",
                "TeslaGun",
                "TiniMet",
                "TinyMet",
                "Trojan.Zbot",
                "Wsnpoem",
                "Zbot",
                "Zeta",
                "ZeuS",
                "Zeus"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536147,
    "ts_updated_at": 1743041737,
    "ts_creation_date": 1653774006,
    "ts_modification_date": 1653774006,
    "files": {
        "pdf": "https://archive.orkl.eu/df13e99acdda6e38e1ab8d56c2d21cc2c7916d4e.pdf",
        "text": "https://archive.orkl.eu/df13e99acdda6e38e1ab8d56c2d21cc2c7916d4e.txt",
        "img": "https://archive.orkl.eu/df13e99acdda6e38e1ab8d56c2d21cc2c7916d4e.jpg"
    }
}